"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_visitors_visitors_module_ts"],{31579:(Q,T,l)=>{l.r(T),l.d(T,{VisitorsModule:()=>Ot});var m=l(26575),h=l(28849),f=l(92649),A=l(97910),p=l(71670),v=l(70462),M=l(28159),L=l(9681),Z=l(85046),J=l(95933),u=l(36520),Y=l(58175),U=l(15746),z=l(680),R=l(47422),G=l(46939),H=l(57016),$=l(65822),F=l(67343),N=l(14884),d=l(34592),K=l(59524),x=l(78466),C=l(93121),t=l(29039),V=l(17401);let w=(()=>{class o extends d.cx{get search(){return this._search.getValue()}get time_format(){return this._settings.time_format}constructor(e,n,i){super(),this._dialog=e,this._org=n,this._settings=i,this._poll=new v.X(0),this._filters=new v.X({}),this._search=new v.X(""),this._loading=new v.X(!1),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.bookings=(0,M.aj)([this._org.active_building,this._filters,this._poll]).pipe((0,Z.h)(([s])=>!!s),(0,J.b)(150),(0,u.w)(([s,a])=>{this._loading.next(!0);const r=a.date?new Date(a.date):new Date,g=(0,H.Z)(r),_=(0,$.Z)(g,a.period||1);return(0,x.F2)({type:"visitor",period_start:(0,F.Z)(g),period_end:(0,F.Z)(_),zones:(a.zones||[]).join(",")||s.id,include_checked_out:!0,limit:1e3}).pipe((0,Y.K)(y=>(0,L.of)([])))}),(0,U.b)(()=>this._loading.next(!1)),(0,z.d)(1)),this.filtered_bookings=(0,M.aj)([this._search,this.bookings]).pipe((0,R.U)(([s,a])=>{const r=s.toLowerCase();return a.filter(_=>_.asset_name?.toLowerCase().includes(r)||_.user_name?.toLowerCase().includes(r)||_.user_email?.toLowerCase().includes(r)||_.asset_id?.toLowerCase().includes(r)).sort((_,y)=>_.date-y.date)}))}setFilters(e){this._filters.next({...this._filters.getValue(),...e})}setSearchString(e){this._search.next(e)}poll(){this._poll.next(Date.now())}startPolling(e=3e4){this.interval("poll",()=>this._poll.next(Date.now()),e)}stopPolling(){this.clearInterval("poll")}setExt(e,n,i){var s=this;return(0,p.Z)(function*(){const a={...e.extension_data};a[n]=i,yield(0,K.sF)(e.id,{...e,extension_data:a}).toPromise(),s._poll.next(Date.now())})()}approveVisitor(e){var n=this;return(0,p.Z)(function*(){const i=yield(0,d._5)({title:"Approve Visitor",content:`Approve attendance of ${e.asset_name||e.asset_id} to their meeting?`,icon:{content:"event_available"}},n._dialog);if("done"!==i.reason)return i.close();i.loading("Updating guest details"),yield(0,x.jT)(e.id).toPromise().catch(s=>{throw(0,d.cB)(`Error approving visitor: ${s.message||s.error||s}`),i.close(),s}),(0,d.t5)("Successfully approved visitor"),n._poll.next(Date.now()),i.close()})()}declineVisitor(e){var n=this;return(0,p.Z)(function*(){const i=yield(0,d._5)({title:"Decline Visitor",content:`Decline attendance of ${e.asset_name||e.asset_id} to their meeting?`,icon:{content:"event_available"}},n._dialog);if("done"!==i.reason)return i.close();i.loading("Updating guest details"),yield(0,x.FP)(e.id).toPromise().catch(s=>{throw(0,d.cB)(`Error declining visitor: ${s.message||s.error||s}`),i.close(),s}),(0,d.t5)("Successfully declining visitor"),n._poll.next(Date.now()),i.close()})()}setCheckinState(e,n=!0){return(0,p.Z)(function*(){yield(0,x.FD)(e.id,n).toPromise().catch(s=>{throw(0,d.cB)(`Error checking ${n?"in":"out"} ${e.asset_name||e.asset_id} for ${e.user_name}'s meeting`),s}),(0,d.t5)(`Successfully checked ${n?"in":"out"} ${e.asset_name||e.asset_id} from ${e.user_name}'s meeting`)})()}setCheckinStateForEvent(e,n=!0){var i=this;return(0,p.Z)(function*(){if(!e)return;const a=(yield i.bookings.pipe((0,G.q)(1)).toPromise()).filter(r=>r.parent_id===e||r.extension_data.parent_id===e||r.linked_event?.id===e||r.linked_event?.event_id===e);a.length&&(yield Promise.all(a.map(r=>(0,x.FD)(r.id,n).toPromise().catch(g=>{throw(0,d.cB)(`Error checking ${n?"in":"out"} ${r.asset_name||r.asset_id} for ${r.user_name}'s meeting`),g}))),(0,d.t5)(`Successfully checked ${n?"in":"out"} all visitors from ${a[0].user_name}'s meeting`),i._poll.next(Date.now()))})()}downloadVisitorsList(){var e=this;return(0,p.Z)(function*(){const n=yield e.filtered_bookings.pipe((0,G.q)(1)).toPromise();if(!n.length)return;const{date:i}=e._filters.getValue(),s=n.map(r=>({Name:r.asset_name,Email:r.asset_id,"Checked In":r.checked_in,Host:r.user_email||"",Status:r.status,Date:(0,N.Z)(r.date,"dd MMM "+e.time_format)})),a=(0,d.o3)(s);(0,d.Sv)(`visitor-list-${(0,N.Z)(i||Date.now(),"MMM-dd")}.csv`,a)})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.LFG(V.uw),t.LFG(C.w7),t.LFG(d.gb))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var W=l(42349),O=l(78173),X=l(17627),S=l(11771),P=l(97338),D=l(71268),E=l(96355),b=l(10257);function B(o,c){if(1&o&&(t.TgZ(0,"mat-option",5),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.display_name||e.name," ")}}let q=(()=>{class o extends d.cx{constructor(e,n,i,s){super(),this._state=e,this._org=n,this._route=i,this._router=s,this.zones=[],this.levels=this._org.active_levels,this.filters=this._state.filters,this.setDate=a=>this._state.setFilters({date:a}),this.setFilters=a=>this._state.setFilters(a),this.setSearch=a=>this._state.setSearchString(a),this.updateZones=a=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:a.join(",")}}),this._state.setFilters({zones:a})}}ngOnInit(){var e=this;return(0,p.Z)(function*(){yield e._org.initialised.pipe((0,X.P)(n=>n)).toPromise(),e.subscription("route.query",e._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const i=n.get("zone_ids").split(",");if(i.length){const s=e._org.levelWithID(i);if(e.zones=i,!s)return;e._org.building=e._org.buildings.find(a=>a.id===s.parent_id)}}})),e.subscription("levels",e._org.active_levels.subscribe(n=>{e.zones=e.zones.filter(i=>n.find(s=>s.id===i)),!e.zones.length&&n.length&&e.zones.push(n[0].id),e.updateZones(e.zones)})),e.setSearch("")})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(w),t.Y36(C.w7),t.Y36(f.gz),t.Y36(f.F0))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["visitors-topbar"]],features:[t.qOj],decls:17,vars:10,consts:[[1,"flex","items-center","bg-base-100","h-20","px-4","border-b","border-base-200","space-x-2"],["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["placeholder","Viewing Period",3,"ngModel","ngModelChange"],[3,"value"],[1,"flex-1","w-2"],[1,"mr-2",3,"modelChange"],[3,"dateChange"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(a){return i.zones=a})("ngModelChange",function(a){return i.updateZones(a)}),t.YNc(3,B,2,2,"mat-option",3),t.ALo(4,"async"),t.qZA()(),t.TgZ(5,"mat-form-field",1)(6,"mat-select",4),t.NdJ("ngModelChange",function(a){return i.setFilters({period:a})}),t.ALo(7,"async"),t.TgZ(8,"mat-option",5),t._uU(9,"Show Day"),t.qZA(),t.TgZ(10,"mat-option",5),t._uU(11,"Show Week"),t.qZA(),t.TgZ(12,"mat-option",5),t._uU(13,"Show Month"),t.qZA()()(),t._UZ(14,"div",6),t.TgZ(15,"searchbar",7),t.NdJ("modelChange",function(a){return i.setSearch(a)}),t.qZA(),t.TgZ(16,"date-options",8),t.NdJ("dateChange",function(a){return i.setDate(a)}),t.qZA()()),2&n){let s;t.xp6(2),t.Q6J("ngModel",i.zones),t.xp6(),t.Q6J("ngForOf",t.lcZ(4,6,i.levels)),t.xp6(3),t.Q6J("ngModel",(null==(s=t.lcZ(7,8,i.filters))?null:s.period)||1),t.xp6(2),t.Q6J("value",1),t.xp6(2),t.Q6J("value",7),t.xp6(2),t.Q6J("value",30)}},dependencies:[m.sg,h.JJ,h.On,S.E,P.U,D.KE,E.gD,b.ey,m.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=visitors-topbar.component.ts-angular-inline--114.css.map*/"]})}return o})();var tt=l(47298),k=l(78128),et=l(60702),nt=l(24702),ot=l(94888),it=l(27442),st=l(33884);function at(o,c){1&o&&(t.TgZ(0,"i",13),t._uU(1," close "),t.qZA())}function lt(o,c){1&o&&(t.TgZ(0,"i",14),t._uU(1," done "),t.qZA())}function rt(o,c){if(1&o&&t.YNc(0,at,2,0,"i",11)(1,lt,2,0,"ng-template",null,12,t.W1O),2&o){const e=c.row,n=t.MAs(2);t.Q6J("ngIf",!(null!=e&&e.checked_in))("ngIfElse",n)}}function ct(o,c){if(1&o&&t._uU(0),2&o){const e=c.row;t.hij(" ",null==e.extension_data?null:e.extension_data.host," ")}}function ut(o,c){if(1&o&&(t.TgZ(0,"button",18),t._uU(1),t.qZA()),2&o){const e=t.oxw().row;t.xp6(),t.hij(" ",null!=e.extension_data&&e.extension_data.vaccination_confirmed?"Confirmed":!1===(null==e.extension_data?null:e.extension_data.vaccination_confirmed)?"Rejected":"Submitted"," ")}}function dt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",19),t._UZ(1,"img",20),t.TgZ(2,"button",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().row,s=t.oxw();return t.KtG(s.setExt(i,"vaccination_confirmed",!0))}),t._uU(3," Confirm Vaccination Proof "),t.qZA(),t.TgZ(4,"button",22),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().row,s=t.oxw();return t.KtG(s.setExt(i,"vaccination_confirmed",!1))}),t._uU(5," Reject Vaccination Proof "),t.qZA()()}if(2&o){const e=t.oxw().row;t.xp6(),t.Q6J("src",null==e.extension_data||null==e.extension_data.vaccination_proof?null:e.extension_data.vaccination_proof.url,t.LSH)}}function mt(o,c){if(1&o&&(t.TgZ(0,"div",15),t.YNc(1,ut,2,1,"button",16),t.qZA(),t.YNc(2,dt,6,1,"ng-template",null,17,t.W1O)),2&o){const e=c.row,n=t.MAs(3);t.Q6J("content",n),t.xp6(),t.Q6J("ngIf",null==e.extension_data||null==e.extension_data.vaccination_proof?null:e.extension_data.vaccination_proof.url)}}function pt(o,c){if(1&o&&(t.TgZ(0,"button",18),t._uU(1),t.qZA()),2&o){const e=t.oxw().row;t.xp6(),t.hij(" ",null!=e.extension_data&&e.extension_data.id_confirmed?"Confirmed":!1===(null==e.extension_data?null:e.extension_data.id_confirmed)?"Rejected":"Submitted"," ")}}function _t(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",19),t._UZ(1,"img",24),t.TgZ(2,"button",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().row,s=t.oxw();return t.KtG(s.setExt(i,"id_confirmed",!0))}),t._uU(3," Confirm ID "),t.qZA(),t.TgZ(4,"button",22),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().row,s=t.oxw();return t.KtG(s.setExt(i,"id_confirmed",!1))}),t._uU(5," Reject ID "),t.qZA()()}if(2&o){const e=t.oxw().row;t.xp6(),t.Q6J("src",null==e.extension_data||null==e.extension_data.id_data?null:e.extension_data.id_data.url,t.LSH)}}function gt(o,c){if(1&o&&(t.TgZ(0,"div",15),t.YNc(1,pt,2,1,"button",16),t.qZA(),t.YNc(2,_t,6,1,"ng-template",null,23,t.W1O)),2&o){const e=c.row,n=t.MAs(3);t.Q6J("content",n),t.xp6(),t.Q6J("ngIf",null==e.extension_data||null==e.extension_data.id_data?null:e.extension_data.id_data.url)}}function ht(o,c){1&o&&(t.TgZ(0,"div",27)(1,"app-icon"),t._uU(2,"done"),t.qZA()())}function ft(o,c){1&o&&(t.TgZ(0,"div",28)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function vt(o,c){if(1&o&&t.YNc(0,ht,3,0,"div",25)(1,ft,3,0,"div",26),2&o){const e=c.row;t.Q6J("ngIf",e.induction),t.xp6(),t.Q6J("ngIf",!e.induction&&e.process_state.includes("declined"))}}function xt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",29)(1,"div",30)(2,"div",31),t._uU(3),t.qZA(),t.TgZ(4,"app-icon",32),t._uU(5,"arrow_drop_down"),t.qZA()()(),t.TgZ(6,"mat-menu",null,33)(8,"button",34),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.approveVisitor(s))}),t._uU(9," Approve Visitor "),t.qZA(),t.TgZ(10,"button",34),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.declineVisitor(s))}),t._uU(11," Decline Visitor "),t.qZA()()}if(2&o){const e=c.row,n=t.MAs(7);t.ekj("!text-success-content","approved"===(null==e?null:e.status))("!bg-success","approved"===(null==e?null:e.status))("!text-error-content","declined"===(null==e?null:e.status))("!bg-error","declined"===(null==e?null:e.status))("!text-neutral-content","ended"===(null==e?null:e.status))("!bg-neutral","ended"===(null==e?null:e.status))("opacity-60","ended"===(null==e?null:e.status)),t.Q6J("matMenuTriggerFor",n)("disabled","ended"===(null==e?null:e.status)),t.xp6(3),t.hij(" ","ended"===(null==e?null:e.status)?"Ended":"approved"===(null==e?null:e.status)?"Approved":"declined"===(null==e?null:e.status)?"Declined":"Pending"," ")}}function Tt(o,c){if(1&o&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"async")),2&o){const e=c.row,n=t.oxw();let i;t.hij(" ",t.xi3(1,1,e.date,(null==(i=t.lcZ(2,4,n.filters))?null:i.period)>1?"MMM d, "+n.time_format:n.time_format)," ")}}function Zt(o,c){if(1&o&&(t.TgZ(0,"a",46),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("href",e.url,t.LSH),t.xp6(),t.Oqu(e.name)}}function Ct(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",35)(1,"button",36)(2,"app-icon",32),t._uU(3," event "),t.qZA()(),t.TgZ(4,"mat-menu",null,37)(6,"button",34),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.checkinAllVisitors(s))}),t.TgZ(7,"div",38)(8,"app-icon",32),t._uU(9,"event_available"),t.qZA(),t.TgZ(10,"div"),t._uU(11,"Checkin All for Booking"),t.qZA()()(),t.TgZ(12,"button",34),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.checkoutAllVisitors(s))}),t.TgZ(13,"div",38)(14,"app-icon",32),t._uU(15,"event_busy"),t.qZA(),t.TgZ(16,"div"),t._uU(17,"Checkout All for Booking"),t.qZA()()()(),t.TgZ(18,"button",39)(19,"app-icon"),t._uU(20,"attachment"),t.qZA()(),t.TgZ(21,"mat-menu",null,33),t.YNc(23,Zt,2,2,"a",40),t.qZA(),t.TgZ(24,"action-icon",41),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.setExt(s,"remote",!s.extension_data.remote))}),t.qZA(),t.TgZ(25,"action-icon",42),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.checkin(s))}),t.qZA(),t.TgZ(26,"action-icon",43),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.checkout(s))}),t.qZA(),t.TgZ(27,"a",44)(28,"app-icon"),t._uU(29,"email"),t.qZA()(),t.TgZ(30,"action-icon",45),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.printQRCode())}),t.qZA()()}if(2&o){const e=c.row,n=t.MAs(5),i=t.MAs(22),s=t.oxw();t.xp6(),t.ekj("pointer-events-none",!e.linked_event),t.Q6J("matMenuTriggerFor",n),t.xp6(),t.ekj("opacity-0",!e.linked_event),t.xp6(16),t.Q6J("disabled",!(null!=e.attachments&&e.attachments.length))("matMenuTriggerFor",i),t.xp6(5),t.Q6J("ngForOf",e.attachments),t.xp6(),t.Q6J("matTooltip",e.extension_data.remote?"Set as In-Person Visitor":"Set as Remote Visitior")("loading","remote"===s.loading)("content",e.extension_data.remote?"tap_and_play":"business"),t.xp6(),t.Q6J("loading","checkin"===s.loading)("state",null!=e&&e.checked_in?"success":""),t.xp6(),t.Q6J("loading","checkout"===s.loading),t.xp6(),t.Q6J("href","mailto:"+(null==e?null:e.asset_id),t.LSH)("matTooltip",(null==e?null:e.user_email)===(null==e?null:e.asset_id)?"Email Host":"Email Guest"),t.xp6(3),t.ekj("invisible",!s.can_print),t.Q6J("loading","printing"===s.loading)}}function wt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",47),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.downloadVisitorList())}),t.TgZ(1,"app-icon"),t._uU(2,"download"),t.qZA()()}}const bt=(o,c,e,n,i,s,a)=>({state:o,status:c,date:e,host:n,id_data:i,actions:s,induction:a});let j=(()=>{class o extends d.cx{get columns(){return this._inductions_enabled?["state","date","asset_name","user_name","asset_id","status","induction","actions"]:["state","date","asset_name","user_name","asset_id","status","actions"]}get display_columns(){const e={state:" ",date:"Time",asset_name:"Person",user_name:"Host",asset_id:"Email",id_data:"ID",status:"State",induction:"Inducted",actions:" "};return this.columns.map(n=>e[n]||n)}get column_sizes(){const e={state:"3.5r",date:"8r",asset_name:"12r",user_name:"12r",asset_id:"flex",id_data:"8r",status:"10r",actions:"16r",induction:"5r"};return this.columns.map(n=>e[n]||n)}get time_format(){return this._settings.time_format}constructor(e,n,i){var s;super(),s=this,this._state=e,this._settings=n,this._org=i,this.guests=this._state.filtered_bookings.pipe((0,U.b)(a=>console.log(a))),this.search=this._state.search,this.filters=this._state.filters,this._inductions_enabled=!1,this.downloadVisitorList=()=>this._state.downloadVisitorsList(),this.approveVisitor=a=>this._state.approveVisitor(a),this.declineVisitor=a=>this._state.declineVisitor(a),this.checkinAllVisitors=a=>this._state.setCheckinStateForEvent(a.linked_event?.id,!0),this.checkoutAllVisitors=a=>this._state.setCheckinStateForEvent(a.linked_event?.id,!1),this.setExt=(a,r,g)=>this._state.setExt(a,r,g),this.checkin=function(){var a=(0,p.Z)(function*(r){yield s._state.setCheckinState(r,!0),s._state.poll()});return function(r){return a.apply(this,arguments)}}(),this.checkout=function(){var a=(0,p.Z)(function*(r){yield s._state.setCheckinState(r,!1),s._state.poll()});return function(r){return a.apply(this,arguments)}}()}ngOnInit(){var e=this;this.subscription("building",this._org.active_building.subscribe(function(){var n=(0,p.Z)(function*(i){if(!i)return;const s=e._settings.get("app.visitor_kiosk_app")||"visitor-kiosk_app",a=yield(0,tt.rlq)(i.id,s).toPromise();e._inductions_enabled=a.details?.induction_enabled&&a.details?.induction_details});return function(i){return n.apply(this,arguments)}}()))}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(w),t.Y36(d.gb),t.Y36(C.w7))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["guest-listings"]],features:[t.qOj],decls:22,vars:22,consts:[[1,"w-full","flex","flex-col","flex-1","text-sm","h-full","overflow-auto","pb-20"],[1,"min-w-[80rem]",3,"dataSource","filter","columns","display_column","column_size","template","empty"],["state_template",""],["host_template",""],["vaccinated_template",""],["id_template",""],["boolean_template",""],["status_template",""],["date_template",""],["action_template",""],["class","bg-secondary hover:shadow-lg shadow absolute bottom-4 right-4 text-white h-12 w-12","matTooltip","Download Visitor List","matTooltipPosition","left","icon","","matRipple","",3,"click",4,"ngIf"],["matTooltip","Not checked in","class","flex items-center justify-center rounded-full material-icons border-2 border-dashed border-neutral text-xl h-9 w-9",4,"ngIf","ngIfElse"],["checkin_state",""],["matTooltip","Not checked in",1,"flex","items-center","justify-center","rounded-full","material-icons","border-2","border-dashed","border-neutral","text-xl","h-9","w-9"],["matTooltip","Checked In",1,"flex","items-center","justify-center","rounded-full","material-icons","bg-success","border-2","border-neutral","text-white","text-xl","h-9","w-9"],["customTooltip","",3,"content"],["matRipple","","class","bg-success rounded-3xl px-4 py-2 text-white",4,"ngIf"],["vaccine_confirmation",""],["matRipple","",1,"bg-success","rounded-3xl","px-4","py-2","text-white"],[1,"bg-base-100","rounded","p-2","flex","flex-col","space-y-2","my-2","w-[20rem]"],[1,"max-w-[20rem]","max-h-[20rem]","p-2","object-contain",3,"src"],["matRipple","",3,"click"],["matRipple","",1,"inverse","mt-2",3,"click"],["id_confirmation",""],[1,"max-w-[20rem]","max-h-[20rem]","object-contain",3,"src"],["class","rounded h-8 w-8 flex items-center justify-center text-2xl bg-success text-success-content mx-auto",4,"ngIf"],["class","rounded h-8 w-8 flex items-center justify-center text-2xl bg-error text-error-content mx-auto",4,"ngIf"],[1,"rounded","h-8","w-8","flex","items-center","justify-center","text-2xl","bg-success","text-success-content","mx-auto"],[1,"rounded","h-8","w-8","flex","items-center","justify-center","text-2xl","bg-error","text-error-content","mx-auto"],["matRipple","",1,"rounded-3xl","bg-warning","text-warning-content","border-none",3,"matMenuTriggerFor","disabled"],[1,"flex","items-center"],[1,"mx-2"],[1,"text-2xl"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center","justify-end"],["icon","","matRipple","",3,"matMenuTriggerFor"],["checkin_menu","matMenu"],[1,"flex","items-center","space-x-2"],["icon","","matRipple","","title","","matTooltip","View Attachments",3,"disabled","matMenuTriggerFor"],["mat-menu-item","",3,"href",4,"ngFor","ngForOf"],["remote","",3,"matTooltip","loading","content","click"],["checkin","","matTooltip","Checkin Guest","content","event_available",3,"loading","state","click"],["checkout","","matTooltip","Checkout Guest","content","event_busy",3,"loading","click"],["icon","","matRipple","",3,"href","matTooltip"],["matTooltip","Print QR Code","content","event_busy",3,"loading","click"],["mat-menu-item","",3,"href"],["matTooltip","Download Visitor List","matTooltipPosition","left","icon","","matRipple","",1,"bg-secondary","hover:shadow-lg","shadow","absolute","bottom-4","right-4","text-white","h-12","w-12",3,"click"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0),t._UZ(1,"custom-table",1),t.ALo(2,"async"),t.ALo(3,"async"),t.qZA(),t.YNc(4,rt,3,2,"ng-template",null,2,t.W1O)(6,ct,1,1,"ng-template",null,3,t.W1O)(8,mt,4,2,"ng-template",null,4,t.W1O)(10,gt,4,2,"ng-template",null,5,t.W1O)(12,vt,2,2,"ng-template",null,6,t.W1O)(14,xt,12,17,"ng-template",null,7,t.W1O)(16,Tt,3,6,"ng-template",null,8,t.W1O)(18,Ct,31,19,"ng-template",null,9,t.W1O)(20,wt,3,0,"button",10),t.ALo(21,"async")),2&n){const s=t.MAs(5),a=t.MAs(7),r=t.MAs(11),g=t.MAs(13),_=t.MAs(15),y=t.MAs(17),St=t.MAs(19);let I;t.xp6(),t.Q6J("dataSource",i.guests)("filter",t.lcZ(2,8,i.search))("columns",i.columns)("display_column",i.display_columns)("column_size",i.column_sizes)("template",t.Hh0(14,bt,s,_,y,a,r,St,g))("empty",t.lcZ(3,10,i.search)?"No matching visitors":"There are visitors for the currently selected date."),t.xp6(19),t.Q6J("ngIf",null==(I=t.lcZ(21,12,i.guests))?null:I.length)}},dependencies:[m.sg,m.O5,k.VK,k.OP,k.p6,et.gM,b.wG,nt.m,ot.o,it.C,st.X,m.Ov,m.uU]})}return o})();const yt=["app-visitors",""];function At(o,c){1&o&&t._UZ(0,"mat-progress-bar",4)}let Mt=(()=>{class o{constructor(e){this._state=e,this.loading=this._state.loading,this.filters=this._state.filters}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","app-visitors",""]],attrs:yt,decls:6,vars:3,consts:[[1,"relative","w-full","flex","flex-col","bg-base-200"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(n,i){1&n&&(t._UZ(0,"sidebar"),t.TgZ(1,"main",0),t._UZ(2,"visitors-topbar",1)(3,"guest-listings",2),t.YNc(4,At,1,0,"mat-progress-bar",3),t.ALo(5,"async"),t.qZA()),2&n&&(t.xp6(4),t.Q6J("ngIf",t.lcZ(5,1,i.loading)))},dependencies:[m.O5,W.k,O.pW,q,j,m.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}\n\n/*# sourceMappingURL=visitors.component.ts-angular-inline--113.css.map*/"]})}return o})();var Lt=l(65080);let Vt=(()=>{class o{constructor(e){this._dialog_ref=e}onDone(){this._dialog_ref.close()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(V.so))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["invite-visitor-modal"]],decls:2,vars:0,consts:[[1,"relative","min-w-[40rem]","min-h-[40rem]"],[3,"done"]],template:function(n,i){1&n&&(t.TgZ(0,"main",0)(1,"invite-visitor-form",1),t.NdJ("done",function(){return i.onDone()}),t.qZA()())},dependencies:[Lt.C]})}return o})();var kt=l(33005),Jt=l(19842);const Ut=["app-new-visitors",""];function Gt(o,c){if(1&o&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.display_name||e.name," ")}}function Ft(o,c){1&o&&t._UZ(0,"mat-progress-bar",15)}const Nt=[{path:"",component:Mt},{path:"new",component:(()=>{class o{constructor(e,n,i,s,a){this._state=e,this._org=n,this._router=i,this._route=s,this._dialog=a,this.loading=this._state.loading,this.filters=this._state.filters,this.zones=[],this.levels=this._org.active_levels,this.setDate=r=>this._state.setFilters({date:r}),this.setFilters=r=>this._state.setFilters(r),this.setSearch=r=>this._state.setSearchString(r),this.updateZones=r=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:r.join(",")}}),this._state.setFilters({zones:r})}}inviteVisitor(){this._dialog.open(Vt)}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(w),t.Y36(C.w7),t.Y36(f.F0),t.Y36(f.gz),t.Y36(V.uw))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","app-new-visitors",""]],attrs:Ut,decls:21,vars:7,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","p-4","space-x-2"],[1,"text-2xl","font-medium"],[1,"flex-1","w-2"],[3,"dateChange"],["btn","","matRipple","",3,"click"],[1,"flex","items-center","px-4","pb-4"],["appearance","outline",1,"no-subscript"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"modelChange"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],[3,"value"],["mode","indeterminate",1,"w-full"]],template:function(n,i){1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1)(4,"div",2)(5,"h2",3),t._uU(6,"Visitors"),t.qZA(),t._UZ(7,"div",4),t.TgZ(8,"date-options",5),t.NdJ("dateChange",function(a){return i.setDate(a)}),t.qZA(),t.TgZ(9,"button",6),t.NdJ("click",function(){return i.inviteVisitor()}),t._uU(10," Invite Visitor "),t.qZA()(),t.TgZ(11,"div",7)(12,"mat-form-field",8)(13,"mat-select",9),t.NdJ("ngModelChange",function(a){return i.zones=a})("ngModelChange",function(a){return i.updateZones(a)}),t.YNc(14,Gt,2,2,"mat-option",10),t.ALo(15,"async"),t.qZA()(),t._UZ(16,"div",4),t.TgZ(17,"searchbar",11),t.NdJ("modelChange",function(a){return i.setSearch(a)}),t.qZA()(),t._UZ(18,"guest-listings",12),t.YNc(19,Ft,1,0,"mat-progress-bar",13),t.ALo(20,"async"),t.qZA()()),2&n&&(t.xp6(13),t.Q6J("ngModel",i.zones),t.xp6(),t.Q6J("ngForOf",t.lcZ(15,3,i.levels)),t.xp6(5),t.Q6J("ngIf",t.lcZ(20,5,i.loading)))},dependencies:[m.sg,m.O5,h.JJ,h.On,S.E,P.U,kt.O,Jt.u,D.KE,E.gD,b.ey,O.pW,b.wG,j,m.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=new-visitors.component.ts-angular-inline--115.css.map*/"]})}return o})()}];let Ot=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[m.ez,h.u5,A.v,x.EP,f.Bz.forChild(Nt)]})}return o})()},59524:(Q,T,l)=>{l.d(T,{Y:()=>p,PP:()=>m.P,mO:()=>v.mO,VE:()=>Z.VE,w0:()=>Z.w0,sF:()=>L.sF});var m=l(43211),A=(l(86755),l(80882),l(67343));class p{constructor(u={}){this.type=u.type||u.location||"other",this.position=u.position||u.map_id||u.asset_id||{x:u.x/u.map_width||0,y:u.y/u.map_height||0},this.variance=u.variance||0,this.last_seen=u.last_seen||(0,A.Z)(new Date),this.level=u.level,this.building=u.building,this.at_location=!!u.at_location,this.coordinates_from=u.coordinates_from||"top-left"}}var v=l(223),L=(l(11451),l(38125)),Z=l(48675)}}]);
//# sourceMappingURL=apps_concierge_src_app_visitors_visitors_module_ts.js.map