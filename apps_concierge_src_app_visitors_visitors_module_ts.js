"use strict";(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([["apps_concierge_src_app_visitors_visitors_module_ts"],{2040:(fe,y,r)=>{r.r(y),r.d(y,{VisitorsModule:()=>_e});var v=r(93),Z=r(9298),T=r(3259),V=r(2656),h=r(3786),f=r(6491),b=r(9097),M=r(639),q=r(9902),x=r(3927),U=r(2597),J=r(1930),j=r(6186),P=r(1516),I=r(8703),w=r(1361),g=r(2247),m=r(412),e=r(1477);let _=(()=>{class n extends g.KG{constructor(){super(),this._poll=new f.X(0),this._filters=new f.X({}),this._search=new f.X(""),this._loading=new f.X(!1),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.events=(0,b.aj)([this._filters,this._poll]).pipe((0,M.b)(150),(0,q.w)(([t])=>{this._loading.next(!0);const i=t.date?new Date(t.date):new Date,s=t.show_week?(0,J.Z)(i):(0,j.Z)(i),o=t.show_week?(0,P.Z)(i):(0,I.Z)(i);return(0,m.u$)({period_start:(0,w.Z)(s),period_end:(0,w.Z)(o),zone_ids:(t.zones||[]).join(",")})}),(0,x.U)(t=>(this._loading.next(!1),this._filters.getValue().all_bookings?t:t.filter(i=>{var s,o;return(null===(s=i.guests)||void 0===s?void 0:s.length)&&(null===(o=i.attendees)||void 0===o?void 0:o.length)>1}))),(0,U.d)(1)),this.filtered_events=(0,b.aj)([this._search,this.events]).pipe((0,x.U)(t=>{const[i,s]=t,o=i.toLowerCase();return s.filter(c=>c.attendees.find(a=>{var d,u;return(null===(d=a.name)||void 0===d?void 0:d.toLowerCase().includes(o))||(null===(u=a.email)||void 0===u?void 0:u.toLowerCase().includes(o))}))}))}get search(){return this._search.getValue()}setFilters(t){this._filters.next(Object.assign(Object.assign({},this._filters.getValue()),t))}setSearchString(t){this._search.next(t)}startPolling(t=3e4){this.interval("poll",()=>this._poll.next(Date.now()),t)}stopPolling(){this.clearInterval("poll")}checkGuestIn(t,i){var s,o,c;return(0,h.mG)(this,void 0,void 0,function*(){const a=yield(0,m.rq)(t.id,i.email,!0,{system_id:(null===(s=t.system)||void 0===s?void 0:s.id)||(null===(o=t.resources[0])||void 0===o?void 0:o.id)}).toPromise().catch(u=>{var p;throw(0,g.cB)(`Error checking in ${i.name} for ${null===(p=t.organiser)||void 0===p?void 0:p.name}'s meeting`),u});(0,g.t5)(`Successfully checked in ${i.name} for ${null===(c=t.organiser)||void 0===c?void 0:c.name}'s meeting`);const d=(0,g.Tw)([a,...t.attendees],"email");return d.sort((u,p)=>u.organizer?-1:u.email.localeCompare(p.email)),new m.ym(Object.assign(Object.assign({},t),{attendees:d}))})}checkGuestOut(t,i){var s,o,c;return(0,h.mG)(this,void 0,void 0,function*(){const a=yield(0,m.rq)(t.id,i.email,!1,{system_id:(null===(s=t.system)||void 0===s?void 0:s.id)||(null===(o=t.resources[0])||void 0===o?void 0:o.id)}).toPromise().catch(u=>{var p;throw(0,g.cB)(`Error checking out ${i.name} from ${null===(p=t.organiser)||void 0===p?void 0:p.name}'s meeting`),u});(0,g.t5)(`Successfully checked out ${i.name} from ${null===(c=t.organiser)||void 0===c?void 0:c.name}'s meeting`);const d=(0,g.Tw)([a,...t.attendees],"email");return d.sort((u,p)=>u.organizer?-1:u.email.localeCompare(p.email)),new m.ym(Object.assign(Object.assign({},t),{attendees:d}))})}checkAllGuestsIn(t){var i;return(0,h.mG)(this,void 0,void 0,function*(){const s=t.attendees.filter(a=>a.is_external&&!a.checked_in);if(s.length<=0)throw new Error("No Guests to checkin");const o=yield Promise.all(s.map(a=>{var d,u;return(0,m.rq)(t.id,a.email,!0,{system_id:(null===(d=t.system)||void 0===d?void 0:d.id)||(null===(u=t.resources[0])||void 0===u?void 0:u.id)}).toPromise()})).catch(a=>{var d;throw(0,g.cB)(`Error checking in all guests for ${null===(d=t.organiser)||void 0===d?void 0:d.name}'s meeting`),a});(0,g.t5)(`Successfully checked in all guests for ${null===(i=t.organiser)||void 0===i?void 0:i.name}'s meeting`);const c=(0,g.Tw)([...o,...t.attendees],"email");return c.sort((a,d)=>a.organizer?-1:a.email.localeCompare(d.email)),new m.ym(Object.assign(Object.assign({},t),{attendees:c}))})}checkAllGuestsOut(t){var i;return(0,h.mG)(this,void 0,void 0,function*(){const s=t.attendees.filter(a=>a.is_external&&a.checked_in&&!a.organizer);if(s.length<=0)throw new Error("No Guests to checkout");const o=yield Promise.all(s.map(a=>{var d,u;return(0,m.rq)(t.id,a.email,!1,{system_id:(null===(d=t.system)||void 0===d?void 0:d.id)||(null===(u=t.resources[0])||void 0===u?void 0:u.id)}).toPromise()})).catch(a=>{var d;throw(0,g.cB)(`Error checking out all guests from ${null===(d=t.organiser)||void 0===d?void 0:d.name}'s meeting`),a});(0,g.t5)(`Successfully checked out all guests from ${null===(i=t.organiser)||void 0===i?void 0:i.name}'s meeting`);const c=(0,g.Tw)([...o,...t.attendees],"email");return c.sort((a,d)=>a.organizer?-1:a.email.localeCompare(d.email)),new m.ym(Object.assign(Object.assign({},t),{attendees:c}))})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var G=r(4945),E=r(88),Q=r(8539),N=r(3176),z=r(7820),F=r(9031),L=r(9396),S=r(8441),D=r(6360);function Y(n,l){if(1&n&&(e.TgZ(0,"mat-option",8),e._uU(1),e.qZA()),2&n){const t=l.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}let $=(()=>{class n extends g.KG{constructor(t,i,s,o){super(),this._state=t,this._org=i,this._route=s,this._router=o,this.zones=[],this.levels=this._org.active_levels,this.filters=this._state.filters,this.setDate=c=>this._state.setFilters({date:c}),this.setFilters=c=>this._state.setFilters(c),this.setSearch=c=>this._state.setSearchString(c),this.updateZones=c=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:c.join(",")}}),this._state.setFilters({zones:c})}}ngOnInit(){return(0,h.mG)(this,void 0,void 0,function*(){yield this._org.initialised.pipe((0,E.P)(t=>t)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{if(t.has("zone_ids")){const i=t.get("zone_ids").split(",");if(i.length){const s=this._org.levelWithID(i);if(this.zones=i,!s)return;this._org.building=this._org.buildings.find(o=>o.id===s.parent_id)}}})),this.subscription("levels",this._org.active_levels.subscribe(t=>{this.zones=this.zones.filter(i=>t.find(s=>s.id===i)),!this.zones.length&&t.length&&this.zones.push(t[0].id),this.updateZones(this.zones)})),this.setSearch("")})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_),e.Y36(Q.w7),e.Y36(T.gz),e.Y36(T.F0))},n.\u0275cmp=e.Xpm({type:n,selectors:[["visitors-topbar"]],features:[e.qOj],decls:15,vars:10,consts:[["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"m-2",3,"ngModel","ngModelChange"],[1,"text-xs"],[1,"flex-1","w-2"],[1,"mr-2",3,"modelChange"],[3,"dateChange"],[3,"value"]],template:function(t,i){if(1&t&&(e.TgZ(0,"mat-form-field",0),e.TgZ(1,"mat-select",1),e.NdJ("ngModelChange",function(o){return i.zones=o})("ngModelChange",function(o){return i.updateZones(o)}),e.YNc(2,Y,2,2,"mat-option",2),e.ALo(3,"async"),e.qZA(),e.qZA(),e.TgZ(4,"mat-slide-toggle",3),e.NdJ("ngModelChange",function(o){return i.setFilters({all_bookings:o})}),e.ALo(5,"async"),e.TgZ(6,"div",4),e._uU(7,"All Bookings"),e.qZA(),e.qZA(),e.TgZ(8,"mat-slide-toggle",3),e.NdJ("ngModelChange",function(o){return i.setFilters({show_week:o})}),e.ALo(9,"async"),e.TgZ(10,"div",4),e._uU(11,"Show Week"),e.qZA(),e.qZA(),e._UZ(12,"div",5),e.TgZ(13,"searchbar",6),e.NdJ("modelChange",function(o){return i.setSearch(o)}),e.qZA(),e.TgZ(14,"date-options",7),e.NdJ("dateChange",function(o){return i.setDate(o)}),e.qZA()),2&t){let s,o;e.xp6(1),e.Q6J("ngModel",i.zones),e.xp6(1),e.Q6J("ngForOf",e.lcZ(3,4,i.levels)),e.xp6(2),e.Q6J("ngModel",null==(s=e.lcZ(5,6,i.filters))?null:s.all_bookings),e.xp6(4),e.Q6J("ngModel",null==(o=e.lcZ(9,8,i.filters))?null:o.show_week)}},directives:[N.KE,z.gD,Z.JJ,Z.On,v.sg,F.Rr,L.U,S.E,D.ey],pipes:[v.Ov],styles:["[_nghost-%COMP%]{display:flex;align-items:center;background-color:#fff;height:5em;padding:0 1em;border-bottom:1px solid #ccc}[_nghost-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-left:.5rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}"]}),n})();var A=r(1637),O=r(620),C=r(5159),k=r(5306),B=r(3702);function H(n,l){1&n&&(e.TgZ(0,"i",14),e._uU(1,"face"),e.qZA())}function R(n,l){if(1&n&&(e.ynx(0),e.YNc(1,H,2,0,"i",13),e.BQk()),2&n){const t=e.oxw(),i=e.MAs(3);e.xp6(1),e.Q6J("ngIf",!(null!=t.visitor&&t.visitor.checked_in))("ngIfElse",i)}}function W(n,l){1&n&&(e.TgZ(0,"i",15),e._uU(1,"done"),e.qZA())}function X(n,l){1&n&&(e.TgZ(0,"i",16),e._uU(1,"assignment_ind"),e.qZA())}function K(n,l){if(1&n&&(e.TgZ(0,"div",17),e.TgZ(1,"h2"),e._uU(2),e.qZA(),e.TgZ(3,"div"),e.TgZ(4,"span"),e._uU(5,"Host:"),e.qZA(),e._uU(6),e.qZA(),e.TgZ(7,"div"),e.TgZ(8,"span"),e._uU(9,"Purpose:"),e.qZA(),e._uU(10),e.qZA(),e.TgZ(11,"div"),e.TgZ(12,"span"),e._uU(13,"Location:"),e.qZA(),e._uU(14),e.qZA(),e.TgZ(15,"div"),e.TgZ(16,"span"),e._uU(17,"Issue Date:"),e.qZA(),e._uU(18),e.ALo(19,"date"),e.qZA(),e.TgZ(20,"div",18),e._UZ(21,"img",19),e.qZA(),e.qZA()),2&n){const t=e.oxw();e.xp6(2),e.Oqu((null==t.visitor?null:t.visitor.name)||(null==t.visitor?null:t.visitor.email)),e.xp6(4),e.hij(" ",(null==t.event||null==t.event.organiser?null:t.event.organiser.name)||(null==t.event||null==t.event.organiser?null:t.event.organiser.name)||(null==t.event?null:t.event.creator)," "),e.xp6(4),e.hij(" ",null==t.event?null:t.event.title,""),e.xp6(4),e.hij(" ",(null==t.event?null:t.event.location)||"<Unspecified>"," "),e.xp6(4),e.hij(" ",e.xi3(19,6,t.today,"mediumDate"),""),e.xp6(3),e.Q6J("src",(null==t.visitor||null==t.visitor.extension_data||null==t.visitor.extension_data.qr?null:t.visitor.extension_data.qr.code)||"",e.LSH)}}let ee=(()=>{class n extends g.KG{constructor(t,i){super(),this._state=t,this._settings=i,this.eventChange=new e.vpe,this.checkin=()=>(0,h.mG)(this,void 0,void 0,function*(){this.loading="checkin",this.event=yield this._state.checkGuestIn(this.event,this.visitor).catch(s=>this.event),this.eventChange.emit(this.event),this.loading=""}),this.toggleRemote=()=>(0,h.mG)(this,void 0,void 0,function*(){var s;this.loading="remote";const o=(null===(s=this.event.ext("remote"))||void 0===s?void 0:s.filter(a=>a!==this.visitor.email))||[];this.remote||o.push(this.visitor.email);const c=new m.ym(Object.assign(Object.assign({},this.event.toJSON()),{remote:o})).toJSON();this.event=yield(0,m.ry)(c).toPromise().catch(a=>((0,g.cB)(`Error setting visitor status. Error: ${a.statusText||a.message||a}`),this.event)),this.eventChange.emit(this.event),this.loading=""}),this.checkout=()=>(0,h.mG)(this,void 0,void 0,function*(){this.loading="checkout",this.event=yield this._state.checkGuestOut(this.event,this.visitor).catch(s=>this.event),this.eventChange.emit(this.event),this.loading=""}),this.printQRCode=()=>{this.show_qr_code=!0,this.timeout("print",()=>{window.print(),this.show_qr_code=!1},50)}}get can_print(){var t;return this._settings.get("app.can_print_qr")&&this.visitor.checked_in&&(null===(t=this.visitor)||void 0===t?void 0:t.extension_data.qr)}get today(){return Date.now()}get remote(){var t,i,s;return!!(null===(s=null===(i=null===(t=this.event)||void 0===t?void 0:t.extension_data)||void 0===i?void 0:i.remote)||void 0===s?void 0:s.find(o=>{var c;return o===(null===(c=this.visitor)||void 0===c?void 0:c.email)}))}ngOnChanges(t){t.visitor&&this.loadGuest()}loadGuest(t=0){var i,s;return(0,h.mG)(this,void 0,void 0,function*(){if(this.visitor)if(this.loading="printing",this.visitor.checked_in){const o=yield(0,B.pP)(this.visitor.email).toPromise().catch(c=>null);!(null===(s=null===(i=null==o?void 0:o.extension_data)||void 0===i?void 0:i.qr)||void 0===s?void 0:s.code)&&t<5?this.timeout("load_guest",()=>this.loadGuest(++t),1e3):this.loading=""}else this.loading=""})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_),e.Y36(g.gb))},n.\u0275cmp=e.Xpm({type:n,selectors:[["visitor-details"]],inputs:{event:"event",visitor:"visitor"},outputs:{eventChange:"eventChange"},features:[e.qOj,e.TTD],decls:18,vars:21,consts:[[1,"w-12","text-lg","flex","justify-center"],[4,"ngIf","ngIfElse"],["checkin_state",""],["host_state",""],["flex","",1,"p-2","flex-1"],[1,"w-48","py-2","flex","items-center","justify-end"],["remote","",3,"matTooltip","loading","content","click"],["checkin","","matTooltip","Checkin Guest","content","event_available",3,"loading","state","click"],["checkout","","matTooltip","Checkout Guest","content","event_busy",3,"loading","click"],["mat-icon-button","",3,"href","matTooltip"],["matTooltip","Print QR Code","content","event_busy",3,"loading","click"],[1,"w-14","p-2"],["qr-code","","class","print-only fixed inset-0 flex flex-col justify-center bg-white space-y-2",4,"ngIf"],["class","p-2 rounded-full material-icons border-2 border-dotted border-gray-600",4,"ngIf","ngIfElse"],[1,"p-2","rounded-full","material-icons","border-2","border-dotted","border-gray-600"],[1,"p-2","rounded-full","material-icons","bg-green-600","border-2","border-green-600","text-white"],[1,"p-2","rounded-full","material-icons","bg-blue-600","border-2","border-blue-600","text-white"],["qr-code","",1,"print-only","fixed","inset-0","flex","flex-col","justify-center","bg-white","space-y-2"],[1,"flex","justify-center"],["alt","qr-code",3,"src"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,R,2,2,"ng-container",1),e.YNc(2,W,2,0,"ng-template",null,2,e.W1O),e.YNc(4,X,2,0,"ng-template",null,3,e.W1O),e.qZA(),e.TgZ(6,"div",4),e._uU(7),e.qZA(),e.TgZ(8,"div",5),e.TgZ(9,"action-icon",6),e.NdJ("click",function(){return i.toggleRemote()}),e.qZA(),e.TgZ(10,"action-icon",7),e.NdJ("click",function(){return i.checkin()}),e.qZA(),e.TgZ(11,"action-icon",8),e.NdJ("click",function(){return i.checkout()}),e.qZA(),e.TgZ(12,"a",9),e.TgZ(13,"app-icon"),e._uU(14,"email"),e.qZA(),e.qZA(),e.TgZ(15,"action-icon",10),e.NdJ("click",function(){return i.printQRCode()}),e.qZA(),e.qZA(),e._UZ(16,"div",11),e.YNc(17,K,22,9,"div",12)),2&t){const s=e.MAs(5);e.xp6(1),e.Q6J("ngIf",!(null!=i.visitor&&i.visitor.organizer))("ngIfElse",s),e.xp6(6),e.Oqu((null==i.visitor?null:i.visitor.name)||(null==i.visitor?null:i.visitor.email)),e.xp6(2),e.ekj("invisible",!(null!=i.visitor&&i.visitor.is_external)||(null==i.visitor?null:i.visitor.organizer)),e.Q6J("matTooltip",i.remote?"Set as In-Person Visitor":"Set as Remote Visitior")("loading","remote"===i.loading)("content",i.remote?"tap_and_play":"business"),e.xp6(1),e.ekj("invisible",!(null!=i.visitor&&i.visitor.is_external)||(null==i.visitor?null:i.visitor.organizer)),e.Q6J("loading","checkin"===i.loading)("state",null!=i.visitor&&i.visitor.checked_in?"success":""),e.xp6(1),e.ekj("invisible",!(null!=i.visitor&&i.visitor.is_external)||(null==i.visitor?null:i.visitor.organizer)),e.Q6J("loading","checkout"===i.loading),e.xp6(1),e.Q6J("href","mailto:"+(null==i.visitor?null:i.visitor.email),e.LSH)("matTooltip",null!=i.visitor&&i.visitor.organizer?"Email Host":"Email Guest"),e.xp6(3),e.ekj("invisible",!i.can_print),e.Q6J("loading","printing"===i.loading),e.xp6(2),e.Q6J("ngIf",i.show_qr_code)}},directives:[v.O5,A.m,O.gM,C.zs,k.o],pipes:[v.uU],styles:["[_nghost-%COMP%]{display:flex;align-items:center;width:100%;padding:0 .5rem}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{display:flex;align-items:center;height:100%;border-bottom:1px solid #ccc;height:3.5rem}[_nghost-%COMP%] > div[_ngcontent-%COMP%]:first-child{border:none}.invisible[_ngcontent-%COMP%]{opacity:0;pointer-events:none}"]}),n})();function te(n,l){1&n&&(e.TgZ(0,"i",18),e._uU(1,"event"),e.qZA())}function ie(n,l){1&n&&(e.TgZ(0,"i",18),e._uU(1,"close"),e.qZA())}function ne(n,l){1&n&&(e.TgZ(0,"i",19),e._uU(1,"done"),e.qZA())}function se(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",4),e.TgZ(1,"div",5),e.YNc(2,te,2,0,"i",6),e.YNc(3,ie,2,0,"i",6),e.YNc(4,ne,2,0,"i",7),e.qZA(),e.TgZ(5,"div",8),e._uU(6),e.ALo(7,"date"),e.ALo(8,"async"),e.qZA(),e.TgZ(9,"div",9),e._uU(10),e.qZA(),e.TgZ(11,"div",10),e._uU(12),e.qZA(),e.TgZ(13,"div",11),e._uU(14),e.qZA(),e.TgZ(15,"div",12),e.TgZ(16,"action-icon",13),e.NdJ("click",function(){return e.CHM(t),e.oxw().checkinGuests()}),e.qZA(),e.TgZ(17,"action-icon",14),e.NdJ("click",function(){return e.CHM(t),e.oxw().checkoutGuests()}),e.qZA(),e.TgZ(18,"a",15),e.TgZ(19,"app-icon"),e._uU(20,"email"),e.qZA(),e.qZA(),e.qZA(),e.TgZ(21,"div",16),e.TgZ(22,"button",17),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return s.show_attendees=!s.show_attendees}),e.TgZ(23,"app-icon"),e._uU(24),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&n){const t=e.oxw();let i;e.xp6(2),e.Q6J("ngIf","declined"!==(null==t.event?null:t.event.status)&&"done"!==(null==t.event?null:t.event.state)),e.xp6(1),e.Q6J("ngIf","declined"===(null==t.event?null:t.event.status)),e.xp6(1),e.Q6J("ngIf","done"===(null==t.event?null:t.event.state)&&"declined"!==(null==t.event?null:t.event.status)),e.xp6(2),e.hij(" ",e.xi3(7,15,null==t.event?null:t.event.date,null!=(i=e.lcZ(8,18,t.filters))&&i.show_week?"MMM d, h:mm a":"shortTime")," "),e.xp6(4),e.hij(" ",(null==t.event||null==t.event.organiser?null:t.event.organiser.name)||(null==t.event||null==t.event.organiser?null:t.event.organiser.email)," "),e.xp6(2),e.Oqu(null==t.event?null:t.event.title),e.xp6(2),e.Oqu(null==t.event?null:t.event.location),e.xp6(2),e.Q6J("loading","checkin"===t.loading)("disabled",t.guestCount<=0),e.xp6(1),e.Q6J("loading","checkout"===t.loading)("disabled",t.guestCount<=0),e.xp6(1),e.Q6J("href","mailto:"+(null==t.event||null==t.event.organiser?null:t.event.organiser.email),e.LSH),e.xp6(4),e.Q6J("disabled",!(null!=t.event&&null!=t.event.attendees&&t.event.attendees.length))("matTooltip",t.show_attendees||t.has_search?"Hide Attendees":"Show Attendees"),e.xp6(2),e.Oqu(t.show_attendees?"keyboard_arrow_down":"keyboard_arrow_right")}}function oe(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"div",21),e._UZ(1,"div",22),e.TgZ(2,"visitor-details",23),e.NdJ("eventChange",function(s){return e.CHM(t),e.oxw(2).event=s}),e.qZA(),e.qZA()}if(2&n){const t=l.$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("visitor",t)("event",i.event),e.uIk("disabled",!i.matches[t.email])}}const le=function(){return[]};function re(n,l){if(1&n&&(e.ynx(0),e.YNc(1,oe,3,3,"div",20),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",(null==t.event?null:t.event.attendees)||e.DdM(1,le))}}let ae=(()=>{class n extends g.KG{constructor(t){super(),this._state=t,this.matches={},this.filters=this._state.filters,this.checkinGuests=()=>(0,h.mG)(this,void 0,void 0,function*(){this.loading="checkin",this.event=yield this._state.checkAllGuestsIn(this.event).catch(i=>this.event),this.loading=""}),this.checkoutGuests=()=>(0,h.mG)(this,void 0,void 0,function*(){this.loading="checkout",this.event=yield this._state.checkAllGuestsOut(this.event).catch(i=>this.event),this.loading=""})}get guestCount(){var t;return(null===(t=this.event)||void 0===t?void 0:t.attendees.reduce((i,s)=>i+(s.is_external&&!s.organizer?1:0),0))||0}get has_search(){return this._state.search}ngOnInit(){this.subscription("events",this._state.filtered_events.subscribe(()=>this.updateMatches()))}updateMatches(){var t;if(!this.event)return;this.matches={};const i=(this._state.search||"").toLowerCase();for(const s of(null===(t=this.event)||void 0===t?void 0:t.attendees)||[])this.matches[s.email]=!i||s.email.toLowerCase().includes(i)||s.name.toLowerCase().includes(i)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_))},n.\u0275cmp=e.Xpm({type:n,selectors:[["visitor-event"]],inputs:{event:"event"},features:[e.qOj],decls:4,vars:6,consts:[["class","flex items-center px-2 bg-gray-100",4,"ngIf"],["attendees","",1,"w-full","overflow-hidden","relative","border-b","border-gray-300"],["bar","",1,"absolute","top-0","bg-gray-400","z-10"],[4,"ngIf"],[1,"flex","items-center","px-2","bg-gray-100"],[1,"w-12","text-lg","flex","justify-center"],["class","p-2 rounded-full material-icons bg-gray-400",4,"ngIf"],["class","p-2 rounded-full material-icons bg-gray-400 opacity-40",4,"ngIf"],[1,"w-24","p-2"],[1,"w-48","p-2"],["flex","",1,"p-2","flex-1"],[1,"w-64","p-2","truncate"],[1,"w-32","py-2","flex","items-center"],["checkin","","matTooltip","Checkin All Guests","content","event_available",3,"loading","disabled","click"],["checkout","","matTooltip","Checkout All Guests","content","event_busy",3,"loading","disabled","click"],["mat-icon-button","","matTooltip","Email Host",3,"href"],[1,"w-16","p-2"],["mat-icon-button","",3,"disabled","matTooltip","click"],[1,"p-2","rounded-full","material-icons","bg-gray-400"],[1,"p-2","rounded-full","material-icons","bg-gray-400","opacity-40"],["visitor","","class","relative w-full pl-12 bg-gray-200",4,"ngFor","ngForOf"],["visitor","",1,"relative","w-full","pl-12","bg-gray-200"],["l-bar","",1,"absolute","bg-gray-400"],[3,"visitor","event","eventChange"]],template:function(t,i){1&t&&(e.YNc(0,se,25,20,"div",0),e.TgZ(1,"div",1),e._UZ(2,"div",2),e.YNc(3,re,2,2,"ng-container",3),e.qZA()),2&t&&(e.Q6J("ngIf",i.event),e.xp6(1),e.Udp("height",i.show_attendees||i.has_search?3.5*(null==i.event?null:i.event.attendees.length)+"rem":"0rem"),e.xp6(1),e.Udp("height","calc("+(3.5*((null==i.event?null:i.event.attendees.length)-1)+1.75)+"rem + 1px)"),e.xp6(1),e.Q6J("ngIf",i.show_attendees||i.has_search))},directives:[v.O5,A.m,O.gM,C.zs,k.o,C.lW,v.sg,ee],pipes:[v.uU,v.Ov],styles:["[_nghost-%COMP%]{width:100%}visitor-details[_ngcontent-%COMP%]{transition:opacity .2s}[attendees][_ngcontent-%COMP%]{transition:height .2s}[visitor][_ngcontent-%COMP%]{height:3.5rem}[bar][_ngcontent-%COMP%]{width:2px;left:calc(2rem - 1px)}[l-bar][_ngcontent-%COMP%]{height:2px;left:2rem;top:calc(50% - 1px);width:1rem}[disabled=true][_ngcontent-%COMP%]{opacity:.35}"]}),n})();function ce(n,l){1&n&&e._UZ(0,"visitor-event",13),2&n&&e.Q6J("event",l.$implicit)}function de(n,l){if(1&n&&(e.ynx(0),e.YNc(1,ce,1,1,"visitor-event",12),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,2,t.bookings))("ngForTrackBy",t.trackByFn)}}function ue(n,l){1&n&&(e.TgZ(0,"div",14),e.TgZ(1,"p",15),e._uU(2," There are no visitors for the currently selected date. "),e.qZA(),e.qZA())}let ge=(()=>{class n{constructor(t){this._state=t,this.bookings=this._state.filtered_events}trackByFn(t,i){return i?i.id:void 0}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_))},n.\u0275cmp=e.Xpm({type:n,selectors:[["visitor-listings"]],decls:19,vars:4,consts:[[1,"w-full","flex","flex-col","flex-1","text-sm","h-full"],[1,"w-full","flex","items-center","bg-white","border-b","border-gray-500","p-2","font-medium"],[1,"w-12","p-2"],[1,"w-24","p-2"],[1,"w-48","p-2"],["flex","",1,"p-2","flex-1"],[1,"w-64","p-2"],[1,"w-32","p-2"],[1,"w-16","p-2"],[1,"w-full","flex-1","overflow-auto","h-1/2"],[4,"ngIf","ngIfElse"],["empty_state",""],[3,"event",4,"ngFor","ngForOf","ngForTrackBy"],[3,"event"],[1,"h-full","w-full","flex","items-center","justify-center"],[1,"p-8"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"div",2),e.TgZ(3,"div",3),e._uU(4,"Time"),e.qZA(),e.TgZ(5,"div",4),e._uU(6,"Host"),e.qZA(),e.TgZ(7,"div",5),e._uU(8,"Title"),e.qZA(),e.TgZ(9,"div",6),e._uU(10,"Location"),e.qZA(),e.TgZ(11,"div",7),e._uU(12,"Actions"),e.qZA(),e._UZ(13,"div",8),e.qZA(),e.TgZ(14,"div",9),e.YNc(15,de,3,4,"ng-container",10),e.ALo(16,"async"),e.qZA(),e.qZA(),e.YNc(17,ue,3,0,"ng-template",null,11,e.W1O)),2&t){const s=e.MAs(18);let o;e.xp6(15),e.Q6J("ngIf",null==(o=e.lcZ(16,2,i.bookings))?null:o.length)("ngIfElse",s)}},directives:[v.O5,v.sg,ae],pipes:[v.Ov],styles:[""]}),n})();var ve=r(4590);const he=["app-visitors",""];function me(n,l){1&n&&e._UZ(0,"mat-progress-bar",4)}const pe=[{path:"",component:(()=>{class n{constructor(t){this._state=t,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_))},n.\u0275cmp=e.Xpm({type:n,selectors:[["","app-visitors",""]],attrs:he,decls:6,vars:3,consts:[[1,"relative","overflow-hidden","flex-1","flex","flex-col"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(t,i){1&t&&(e._UZ(0,"sidebar"),e.TgZ(1,"main",0),e._UZ(2,"visitors-topbar",1),e._UZ(3,"visitor-listings",2),e.YNc(4,me,1,0,"mat-progress-bar",3),e.ALo(5,"async"),e.qZA()),2&t&&(e.xp6(4),e.Q6J("ngIf",e.lcZ(5,1,i.loading)))},directives:[G.k,$,ge,v.O5,ve.pW],pipes:[v.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;background:var(--bg)}"]}),n})()}];let _e=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[v.ez,Z.u5,V.v,T.Bz.forChild(pe)]]}),n})()}}]);
//# sourceMappingURL=apps_concierge_src_app_visitors_visitors_module_ts.js.map