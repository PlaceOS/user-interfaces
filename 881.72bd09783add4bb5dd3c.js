(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([[881],{3720:(e,t,s)=>{"use strict";s.d(t,{d:()=>v,G:()=>x});var n=s(8512),r=s(4689),i=s(8303),o=s(3530),a=s(804),l=s(999),c=s(8774),u=s(8125),h=s(3206),f=s(7022),g=s(3743),m=s(9294),d=s(4587),p=s(2619),_=s(4608);function v(){sessionStorage.removeItem("PLACEOS.event"),sessionStorage.removeItem("PLACEOS.event_form"),localStorage.removeItem("PLACEOS.event_filters")}let x=(()=>{class e extends h.KG{constructor(e,t,s){super(),this._calendar=e,this._org=t,this._dialog=s,this._event=new n.X(null),this._form=new n.X(null),this._filters=new n.X({}),this._loading_spaces=new n.X(!1),this._loading_event=new n.X(!1),this.event=this._event.asObservable(),this.form=this._form.asObservable(),this.filters=this._filters.asObservable(),this.loading_spaces=this._loading_spaces.asObservable(),this.loading_event=this._loading_event.asObservable(),this.spaces=this._filters.pipe((0,r.w)(e=>{var t,s;this._loading_spaces.next(!0);const n=this._form.getValue().value;n.date||(n.date=(new Date).valueOf());const r=Math.floor(new Date(n.date).valueOf()/1e3),i=Math.floor((0,a.Z)(new Date(n.date),n.duration||60).valueOf()/1e3),o=(null===(t=null==e?void 0:e.zones)||void 0===t?void 0:t.length)?e.zones:[null===(s=this._org.building)||void 0===s?void 0:s.id];return this._calendar.freeBusy({zone_ids:o.join(","),period_start:r,period_end:i}).toPromise().then(t=>(this._loading_spaces.next(!1),t.filter(t=>!e.capacity||e.capacity>=t.capacity)))}),(0,i.d)()),this.clearState=()=>v(),this.setEvent(new f.ym({date:(0,l.Z)((0,a.Z)(new Date,2),{nearestTo:5}).valueOf()}))}get event_form(){return this._form.getValue()}get event_filters(){return this._filters.getValue()}get is_future_date(){var e,t;const s=(null===(t=null===(e=this._form.getValue())||void 0===e?void 0:e.controls)||void 0===t?void 0:t.date.value)||(new Date).valueOf();return(0,c.Z)(new Date(s),(0,u.Z)(new Date))}setEvent(e){this._event.next(e);const t=(0,f.r7)(e);this._form.next(t),this.subscription("form_change",()=>this.storeState())}setValue(e,t){const s=this._form.getValue();s&&s.controls[e]&&s.controls[e].setValue(t)}newAttendee(){const e=this._dialog.open(d.rW,{width:"auto",height:"auto",data:{}}),t=this._form.getValue();e.componentInstance.event.pipe((0,o.P)(e=>"done"===e.reason)).subscribe(s=>{const n=t.controls.attendees.value||[];n.push(s.metadata),t.controls.attendees.setValue((0,h.Tw)(n,"email")),e.close()})}clearForm(){this.setEvent(this._event.getValue()),this._filters.next({})}updateFilters(e){this._filters.next(e)}storeState(){const e=this._form.getValue();sessionStorage.setItem("PLACEOS.event",JSON.stringify(this._event.getValue().toJSON())),sessionStorage.setItem("PLACEOS.event_form",JSON.stringify(e.value)),localStorage.setItem("PLACEOS.event_filters",JSON.stringify(this._filters.getValue()))}loadState(){const e=sessionStorage.getItem("PLACEOS.event")||"{}";e&&this._event.next(new f.ym(JSON.parse(e)));const t=sessionStorage.getItem("PLACEOS.event_form");if(t){const e=(0,f.r7)(this._event.getValue());e.patchValue(JSON.parse(t)),this._form.next(e)}const s=localStorage.getItem("PLACEOS.event_filters");s&&this._filters.next(JSON.parse(s))}save(){const e=this._form.getValue();if(e.markAllAsTouched(),e.controls.organiser.value&&e.controls.host.value||e.patchValue({organiser:(0,h.ar)(),host:(0,h.ar)().email}),e.controls.title.value||e.patchValue({title:(0,h.ar)().email}),!e.valid){const t=[];for(const s in e.controls)e.controls[s].invalid&&t.push(s);return Promise.reject((0,h.cB)(`Some form fields are not valid: [${t.join(", ")}]`))}this._loading_event.next(!0);const t=new f.ym(Object.assign(Object.assign({},this._event.getValue()),this._form.getValue().value));return(0,f.ry)(t).toPromise().then(()=>this._loading_event.next(!1),()=>this._loading_event.next(!1))}}return e.\u0275fac=function(t){return new(t||e)(p.LFG(g.ot),p.LFG(m.w7),p.LFG(_.uw))},e.\u0275prov=p.Yz7({token:e,factory:e.\u0275fac}),e})()},9881:(e,t,s)=>{"use strict";s.r(t),s.d(t,{DirectoryModule:()=>M});var n=s(1511),r=s(6898),i=s(9144),o=s(5959),a=s(7701),l=s(8720),c=s(4689),u=s(9996),h=s(3206),f=s(4587),g=s(3720),m=s(2619),d=s(5251),p=s(6283),_=s(1548),v=s(6756),x=s(6073),w=s(6258),Z=s(5769),O=s(7806),y=s(5980),b=s(5969),S=s(7695);function A(e,t){if(1&e&&m._UZ(0,"a-user-avatar",9),2&e){const e=m.oxw(2);m.Q6J("user",e.user)}}function J(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"a",10),m.NdJ("click",function(){return m.CHM(e),m.oxw(2).sendCallEvent()}),m.ALo(1,"safe"),m._uU(2," Call "),m.qZA()}if(2&e){const e=m.oxw(2);m.Q6J("href",m.xi3(1,1,"tel:"+e.user.phone,"url"),m.LSH)}}const C=function(){return["/explore"]},I=function(e){return{user:e}};function q(e,t){if(1&e){const e=m.EpF();m.TgZ(0,"div",1),m.YNc(1,A,1,1,"a-user-avatar",2),m.TgZ(2,"div",3),m.TgZ(3,"div",4),m._uU(4),m.qZA(),m.TgZ(5,"a",5),m.ALo(6,"safe"),m._uU(7),m.qZA(),m.qZA(),m.TgZ(8,"div",6),m.TgZ(9,"a",7),m.NdJ("click",function(){return m.CHM(e),m.oxw().sendLocateEvent()}),m._uU(10," Locate "),m.qZA(),m.YNc(11,J,3,4,"a",8),m.qZA(),m.qZA()}if(2&e){const e=m.oxw();m.ekj("with-image",e.show_image),m.xp6(1),m.Q6J("ngIf",e.show_image),m.xp6(3),m.Oqu(e.user.name),m.xp6(1),m.Q6J("href",m.xi3(6,9,"mailto:"+e.user.email,"url"),m.LSH),m.xp6(2),m.hij(" ",e.user.email," "),m.xp6(2),m.Q6J("routerLink",m.DdM(12,C))("queryParams",m.VKq(13,I,e.user.email)),m.xp6(2),m.Q6J("ngIf",e.user.phone)}}let N=(()=>{class e{constructor(e){this._settings=e}get show_image(){return this._settings.get("app.directory.show_avatars")}sendLocateEvent(){}sendCallEvent(){}}return e.\u0275fac=function(t){return new(t||e)(m.Y36(h.gb))},e.\u0275cmp=m.Xpm({type:e,selectors:[["a-directory-user-list-item"]],inputs:{user:"user"},decls:1,vars:1,consts:[["class","flex flex-wrap items-center sm:space-x-4 bg-white hover:bg-gray-100 overflow-hidden p-4 mb-2",3,"with-image",4,"ngIf"],[1,"flex","flex-wrap","items-center","sm:space-x-4","bg-white","hover:bg-gray-100","overflow-hidden","p-4","mb-2"],[3,"user",4,"ngIf"],[1,"flex","flex-col","flex-1","w-1/2","ml-4","sm:ml-0"],[1,"name"],["name","email",1,"text-sm","underline",3,"href"],[1,"flex","w-full","sm:w-auto","sm:flex-col","items-center","space-x-2","sm:space-x-0","sm:space-y-2","mt-4","sm:mt-0"],["mat-button","","button","","name","locate",1,"w-32","flex-1","sm:flex-none",3,"routerLink","queryParams","click"],["mat-button","","button","","class","w-32 flex-1 sm:flex-nones","name","call",3,"href","click",4,"ngIf"],[3,"user"],["mat-button","","button","","name","call",1,"w-32","flex-1","sm:flex-nones",3,"href","click"]],template:function(e,t){1&e&&m.YNc(0,q,12,15,"div",0),2&e&&m.Q6J("ngIf",t.user)},directives:[n.O5,y.zs,r.yS,b.k],pipes:[S.y],styles:[""]}),e})();const E=["a-directory-user-list",""];function T(e,t){1&e&&m._UZ(0,"mat-spinner",10),2&e&&m.Q6J("diameter",32)}function V(e,t){1&e&&m._UZ(0,"a-directory-user-list-item",15),2&e&&m.Q6J("user",t.$implicit)}function L(e,t){if(1&e&&(m.ynx(0),m.TgZ(1,"div",13),m._uU(2),m.qZA(),m.YNc(3,V,1,1,"a-directory-user-list-item",14),m.BQk()),2&e){const e=m.oxw().$implicit,t=m.oxw(2);m.xp6(2),m.Oqu(e),m.xp6(1),m.Q6J("ngForOf",t.groupedUsers[e])}}function Q(e,t){if(1&e&&(m.ynx(0),m.YNc(1,L,4,2,"ng-container",12),m.BQk()),2&e){const e=t.$implicit,s=m.oxw(2);m.xp6(1),m.Q6J("ngIf",s.groupedUsers[e].length)}}function P(e,t){if(1&e&&(m.ynx(0),m.YNc(1,Q,2,1,"ng-container",11),m.BQk()),2&e){const e=m.oxw();m.xp6(1),m.Q6J("ngForOf",e.letters)}}function k(e,t){if(1&e&&(m.TgZ(0,"div",16),m.TgZ(1,"app-icon",17),m._uU(2),m.qZA(),m.TgZ(3,"div",18),m._uU(4),m.qZA(),m.qZA()),2&e){const e=m.oxw();m.xp6(2),m.Oqu(e.search_str&&e.search_str.length>=e.min_search_length?"close":"arrow_upward"),m.xp6(2),m.hij(" ",e.search_str&&e.search_str.length>=e.min_search_length?' No matches for "'+e.search_str+'"':"Type above to search for users"," ")}}const U="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),F=[{path:"",component:(()=>{class e extends h.KG{constructor(e){super(),this._settings=e,this.user_list=[],this.search$=new o.xQ,this.groupedUsers={}}get min_search_length(){const e=this._settings.get("app.directory.min_search_length");return"number"==typeof e&&e>=0?e:3}ngOnInit(){this.search_results$=this.search$.pipe((0,a.b)(400),(0,l.x)(),(0,c.w)(e=>(this.loading=!0,e.length>=this.min_search_length?(0,f.VE)(e).toPromise().catch(()=>[]):Promise.resolve(this.user_list||[]))),(0,u.U)(e=>(this.loading=!1,e))),this.subscription("search_results",this.search_results$.subscribe(e=>{this.user_list=e,this.buildGroups(this.user_list)})),this.search$.next(""),(0,g.d)()}get letters(){return U}buildGroups(e){const t=e.sort((e,t)=>e.name.localeCompare(t.name));for(const s of this.letters)this.groupedUsers[s]=t.filter(e=>e.name.startsWith(s))}}return e.\u0275fac=function(t){return new(t||e)(m.Y36(h.gb))},e.\u0275cmp=m.Xpm({type:e,selectors:[["","a-directory-user-list",""]],features:[m.qOj],attrs:E,decls:13,vars:6,consts:[[3,"menu","menuChange"],[1,"w-full","flex","items-center","justify-center","p-2"],["overlay","","appearance","outline",1,"rounded"],["matPrefix","",1,"text-xl"],["matInput","","placeholder","Search for a person...",3,"ngModel","ngModelChange"],["matSuffix","","class","top-2",3,"diameter",4,"ngIf"],[1,"flex-1","h-1/2","w-full"],[4,"ngIf","ngIfElse"],["empty_state",""],[3,"show","showChange"],["matSuffix","",1,"top-2",3,"diameter"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"py-2","px-4","font-medium"],[3,"user",4,"ngFor","ngForOf"],[3,"user"],[1,"flex","flex-col","items-center","p-8"],[1,"text-5xl"],[1,"text"]],template:function(e,t){if(1&e&&(m.TgZ(0,"a-topbar-header",0),m.NdJ("menuChange",function(e){return t.show_menu=e}),m.qZA(),m.TgZ(1,"div",1),m.TgZ(2,"mat-form-field",2),m.TgZ(3,"app-icon",3),m._uU(4,"search"),m.qZA(),m.TgZ(5,"input",4),m.NdJ("ngModelChange",function(e){return t.search_str=e})("ngModelChange",function(e){return t.search$.next(e)}),m.qZA(),m.YNc(6,T,1,1,"mat-spinner",5),m.qZA(),m.qZA(),m.TgZ(7,"main",6),m.YNc(8,P,2,1,"ng-container",7),m.qZA(),m._UZ(9,"a-footer-menu"),m.YNc(10,k,5,2,"ng-template",null,8,m.W1O),m.TgZ(12,"a-overlay-menu",9),m.NdJ("showChange",function(e){return t.show_menu=e}),m.qZA()),2&e){const e=m.MAs(11);m.Q6J("menu",t.show_menu),m.xp6(5),m.Q6J("ngModel",t.search_str),m.xp6(1),m.Q6J("ngIf",t.loading),m.xp6(2),m.Q6J("ngIf",t.groupedUsers&&t.user_list.length)("ngIfElse",e),m.xp6(4),m.Q6J("show",t.show_menu)}},directives:[d.B,p.KE,_.o,p.qo,v.Nt,x.Fj,x.JJ,x.On,n.O5,w.i,Z.t,O.$g,p.R9,n.sg,N],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background:#f0f0f0}mat-form-field[_ngcontent-%COMP%]{width:768px;max-width:calc(100% - 2rem)}"]}),e})()}];let M=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=m.oAB({type:e}),e.\u0275inj=m.cJS({imports:[[n.ez,x.u5,r.Bz.forChild(F),i.X]]}),e})()}}]);