(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{uHdG:function(t,e,n){"use strict";n.r(e),n.d(e,"ReportsModule",(function(){return St}));var c=n("EM62"),s=n("2kYt"),o=n("nIj0"),i=n("sEIs"),a=n("oRDy"),l=n("iAde"),r=n("UfDH"),d=n("D57K"),u=n("jOdJ"),p=n("20lr"),g=n("/It1"),h=n("05Mk"),m=n("eZII"),f=n("9MvL"),b=n("KuCG"),v=n("JuBR"),_=n("njY1"),y=n("mrqE"),O=864e5;function j(t,e){Object(y.a)(2,arguments);var n=Object(f.a)(t),c=Object(f.a)(e),s=n.getTime()-Object(_.a)(n),o=c.getTime()-Object(_.a)(c);return Math.round((s-o)/O)}function w(t,e){var n=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return n<0?-1:n>0?1:n}function x(t,e){Object(y.a)(2,arguments);var n=Object(v.a)(t),c=Object(v.a)(e),s=w(n,c),o=Math.abs(j(n,c));n.setDate(n.getDate()-s*o);var i=w(n,c)===-s,a=s*(o-i);return 0===a?0:a}var k=n("CzDk"),M=n("ZTXN"),D=n("C05f"),C=n("ROBh"),I=n("HM3f"),U=n("mWib"),z=n("TLy2"),H=n("4e/d"),R=n("YtkY"),E=n("wqq/"),P=n("dJst");let S=(()=>{class t{constructor(t){this._org=t,this._generate=new M.b,this._loading=new D.a(""),this._active_bookings=new D.a([]),this._options=new D.a({start:new Date,end:new Date}),this._bookings_list=this._generate.pipe(Object(U.a)(500),Object(z.a)(t=>{var e;console.log("Report:",t);const n=this._options.getValue();if(this._loading.next("Loading report details..."),!(null==n?void 0:n.type)&&!(null===(e=null==n?void 0:n.zones)||void 0===e?void 0:e.length))return Object(C.a)([]);const c=Object(f.a)((null==n?void 0:n.start)?new Date(n.start):new Date).valueOf(),s=Object(b.a)((null==n?void 0:n.end)?new Date(n.end):c).valueOf(),o=(null==n?void 0:n.zones)?n.zones.filter(t=>"All"!==t).join(","):"",i={period_start:Math.floor(c/1e3),period_end:Math.floor(s/1e3)};return"desks"===n.type?Object(h.e)(Object.assign(Object.assign({},i),{zones:o,type:"desk"})):Object(m.d)(Object.assign(Object.assign({},i),{zone_ids:o}))}),Object(H.a)(t=>[]),Object(R.a)(t=>(this._loading.next(""),(null==t?void 0:t.length)||Object(p.m)("No bookings for the selected levels and period"),this._active_bookings.next(t||[]),t)),Object(E.a)()),this.loading=this._loading.asObservable(),this.options=this._options.asObservable(),this.bookings=this._active_bookings.asObservable(),this.counts=this._options.pipe(Object(U.a)(500),Object(z.a)(t=>{const e=(t.zones||[]).filter(t=>-1!==t&&"All"!==t);return Promise.all(e.map(t=>Object(g.q)(t,{name:"desks"}).pipe(Object(R.a)(e=>[t,e.details.length])).toPromise()))}),Object(H.a)(t=>[]),Object(R.a)(t=>{const e={};return this._active_bookings.next([]),t.forEach(([t,n])=>e[t]=n),e}),Object(E.a)()),this.stats=Object(I.a)([this.counts,this.bookings]).pipe(Object(R.a)(([t,e])=>e[0]instanceof m.a?function(t,e=8){const n=t.reduce((t,e)=>t+e.attendees.length,0),c=t.reduce((t,e)=>{var n;return t+(null===(n=e.system)||void 0===n?void 0:n.capacity)},0),s=t.reduce((t,e)=>t+e.duration,0)/(60*e),o=n/c;return{count:t.length,avg_length:t.reduce((t,e)=>t+e.duration,0)/t.length,efficiency:(s+o)/2,total_users:n,total_capacity:c,occupancy:o,utilisation:s,events:t}}(e,8*this.duration):function(t,e=1,n={}){console.log("Counts:",n);const c=Object.keys(n).reduce((t,e)=>t+(n[e]||0),0);return{total:c,count:t.length,utilisation:t.length/c,events:t}}(e||[],this.duration,t))),this._bookings_list.subscribe(t=>t)}get duration(){const t=this._options.getValue();return Math.abs(x(t.start,t.end))}generateReport(){this._generate.next((new Date).valueOf())}setOptions(t){var e,n,c,s,o,i,a;(null===(e=t.zones)||void 0===e?void 0:e.includes("All"))?t.zones=["All",...this._org.levelsForBuilding(this._org.building).map(t=>t.id)]:t.zones&&(null===(c=null===(n=this._options.getValue())||void 0===n?void 0:n.zones)||void 0===c?void 0:c.includes("All"))&&(t.zones=[]),(null===(s=t.start)||void 0===s?void 0:s.valueOf())!==(null===(o=this._options.getValue().start)||void 0===o?void 0:o.valueOf())&&(null===(i=t.end)||void 0===i?void 0:i.valueOf())!==(null===(a=this._options.getValue().end)||void 0===a?void 0:a.valueOf())&&this._options.next(Object.assign(Object.assign({},this._options.getValue()),t))}downloadReport(){const t=this._options.getValue(),e=this._active_bookings.getValue();Object(p.i)(`report+${t.type}+${Object(k.a)(t.start,"yyyy-MM-dd")}+${Object(k.a)(t.end,"yyyy-MM-dd")}.csv`,Object(p.l)(e.map(t=>{const e=t.toJSON();return delete e.zones,delete e.server_names,e})))}}return t.\u0275fac=function(e){return new(e||t)(c.tc(P.c))},t.\u0275prov=c.cc({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var A=n("29Wa"),Y=n("R7+U"),F=n("mFH5"),B=n("gcUQ"),L=n("PBFl"),T=n("csyo");function V(t,e){if(1&t&&(c.mc(0,"mat-option",13),c.ad(1),c.lc()),2&t){const t=e.$implicit;c.Hc("value",t.id),c.Ub(1),c.cd(" ",t.display_name||t.name," ")}}function Z(t,e){1&t&&c.hc(0,"mat-spinner",14),2&t&&c.Hc("diameter",32)}function q(t,e){1&t&&(c.mc(0,"p"),c.ad(1,"Generate Report"),c.lc())}let J=(()=>{class t extends p.b{constructor(t,e,n){super(),this._state=t,this._org=e,this._route=n,this.zones=[],this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(t=>""+t.id),this.levels=this._org.active_levels,this.loading=this._state.loading,this.bookings=this._state.bookings,this.options=this._state.options,this.generateReport=()=>this._state.generateReport(),this.downloadReport=()=>this._state.downloadReport(),this.setStartDate=t=>this._state.setOptions({start:new Date(t)}),this.setEndDate=t=>this._state.setOptions({end:new Date(t)}),this.setZones=t=>this._state.setOptions({zones:t})}ngOnInit(){return Object(d.a)(this,void 0,void 0,(function*(){yield this._org.initialised.pipe(Object(u.a)(t=>t)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{if(t.has("zone_ids")){const e=t.get("zone_ids").split(",");if(e.length){const t=this._org.levelWithID(e);if(!t)return;this._org.building=this._org.buildings.find(e=>e.id===t.parent_id),this.setZones(e)}}}))}))}}return t.\u0275fac=function(e){return new(e||t)(c.gc(S),c.gc(P.c),c.gc(i.a))},t.\u0275cmp=c.ac({type:t,selectors:[["reports-options"]],features:[c.Rb],decls:27,vars:28,consts:[["appearance","outline",1,"w-48"],["multiple","","placeholder","Select Levels...",3,"ngModel","ngModelChange"],["value","All"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-64"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["mat-button","",1,"ml-4",3,"disabled","click"],[3,"diameter",4,"ngIf"],[4,"ngIf"],[3,"value"],[3,"diameter"]],template:function(t,e){if(1&t&&(c.mc(0,"mat-form-field",0),c.mc(1,"mat-select",1),c.xc("ngModelChange",(function(t){return e.setZones(t)})),c.Cc(2,"async"),c.mc(3,"mat-option",2),c.ad(4,"All Levels"),c.lc(),c.Yc(5,V,2,2,"mat-option",3),c.Cc(6,"async"),c.lc(),c.lc(),c.mc(7,"mat-form-field",4),c.mc(8,"mat-date-range-input",5),c.mc(9,"input",6),c.xc("ngModelChange",(function(t){return t?e.setStartDate(t):""})),c.Cc(10,"async"),c.lc(),c.mc(11,"input",7),c.xc("ngModelChange",(function(t){return t?e.setEndDate(t):""})),c.Cc(12,"async"),c.lc(),c.lc(),c.hc(13,"mat-datepicker-toggle",8),c.hc(14,"mat-date-range-picker",null,9),c.lc(),c.mc(16,"button",10),c.xc("click",(function(){return e.generateReport()})),c.Cc(17,"async"),c.Cc(18,"async"),c.Yc(19,Z,1,1,"mat-spinner",11),c.Cc(20,"async"),c.Yc(21,q,2,0,"p",12),c.Cc(22,"async"),c.lc(),c.mc(23,"button",10),c.xc("click",(function(){return e.downloadReport()})),c.Cc(24,"async"),c.mc(25,"p"),c.ad(26,"Download Report"),c.lc(),c.lc()),2&t){const t=c.Mc(15);let n=null,s=null,o=null,i=null,a=null;c.Ub(1),c.Hc("ngModel",null==(n=c.Dc(2,10,e.options))?null:n.zones),c.Ub(4),c.Hc("ngForOf",c.Dc(6,12,e.levels)),c.Ub(3),c.Hc("rangePicker",t),c.Ub(1),c.Hc("ngModel",null==(s=c.Dc(10,14,e.options))?null:s.start),c.Ub(2),c.Hc("ngModel",null==(o=c.Dc(12,16,e.options))?null:o.end),c.Ub(2),c.Hc("for",t),c.Ub(3),c.Hc("disabled",!!c.Dc(17,18,e.loading)||!(null!=(i=c.Dc(18,20,e.options))&&null!=i.zones&&i.zones.length)),c.Ub(3),c.Hc("ngIf",c.Dc(20,22,e.loading)),c.Ub(2),c.Hc("ngIf",!c.Dc(22,24,e.loading)),c.Ub(2),c.Hc("disabled",!(null!=(a=c.Dc(24,26,e.bookings))&&a.length))}},directives:[A.c,Y.a,o.l,o.o,F.l,s.m,B.a,B.h,o.c,B.g,B.f,A.g,B.b,L.b,s.n,T.b],pipes:[s.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                background-color: #fff;\n                height: 5em;\n                padding: 0 1em;\n            }\n\n            button[_ngcontent-%COMP%] {\n                min-width: 0;\n                padding: 0 0.85rem;\n            }\n\n            mat-form-field[_ngcontent-%COMP%] {\n                height: 3.25em;\n                margin-left: 1em;\n            }\n\n            mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] {\n                width: 5.5em;\n                white-space: initial;\n                line-height: 1.2em;\n            }"]}),t})();var N=n("0/Ep");const W=function(){return["/reports","desks"]},$=function(){return["/reports","spaces"]};let G=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.ac({type:t,selectors:[["reports-menu"],["","reports-menu",""]],decls:20,vars:4,consts:[["matRipple","",1,"h-64","w-64","m-4","p-4","flex","flex-col","items-center","justify-center","bg-white","rounded","shadow","hover:bg-gray-100",3,"routerLink"],[1,"text-8xl"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center"],[1,"ml-2"]],template:function(t,e){1&t&&(c.mc(0,"a",0),c.mc(1,"app-icon",1),c.ad(2,"room"),c.lc(),c.mc(3,"h3",2),c.ad(4,"Desks"),c.lc(),c.mc(5,"div",3),c.mc(6,"p"),c.ad(7,"View Report"),c.lc(),c.mc(8,"app-icon",4),c.ad(9,"chevron_right"),c.lc(),c.lc(),c.lc(),c.mc(10,"a",0),c.mc(11,"app-icon",1),c.ad(12,"meeting_room"),c.lc(),c.mc(13,"h3",2),c.ad(14,"Rooms"),c.lc(),c.mc(15,"div",3),c.mc(16,"p"),c.ad(17,"View Report"),c.lc(),c.mc(18,"app-icon",4),c.ad(19,"chevron_right"),c.lc(),c.lc(),c.lc()),2&t&&(c.Hc("routerLink",c.Ic(2,W)),c.Ub(10),c.Hc("routerLink",c.Ic(3,$)))},directives:[i.f,F.o,N.a],styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: var(--bg);\n            }"]}),t})();const Q=["app-reports",""];function K(t,e){1&t&&c.hc(0,"div",4)}let X=(()=>{class t{constructor(t){this._router=t}get path(){const t=this._router.url.split("/");return t[t.length-1]}}return t.\u0275fac=function(e){return new(e||t)(c.gc(i.d))},t.\u0275cmp=c.ac({type:t,selectors:[["","app-reports",""]],attrs:Q,decls:6,vars:1,consts:[[1,"h-full"],[1,"relative","overflow-hidden","flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex-1","h-1/2","w-full","overflow-auto"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(t,e){1&t&&(c.hc(0,"sidebar",0),c.mc(1,"main",1),c.hc(2,"reports-options"),c.mc(3,"div",2),c.hc(4,"router-outlet"),c.lc(),c.Yc(5,K,1,0,"div",3),c.lc()),2&t&&(c.Ub(5),c.Hc("ngIf","reports"===e.path))},directives:[r.a,J,i.h,s.n,G],styles:["[_nghost-%COMP%] {\n                display: flex;\n                height: 100%;\n                width: 100%;\n                background: var(--bg);\n            }"]}),t})();var tt=n("6CBO"),et=n("mjT4"),nt=n("QHQ3");let ct=(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe(Object(R.a)(t=>t.count||0)),this.avg_length=this._state.stats.pipe(Object(R.a)(t=>Object(nt.a)({minutes:t.avg_length||0}))),this.efficiency=this._state.stats.pipe(Object(R.a)(t=>(100*(t.efficiency||0)).toFixed(1))),this.total_users=this._state.stats.pipe(Object(R.a)(t=>t.total_users||0)),this.total_capacity=this._state.stats.pipe(Object(R.a)(t=>t.total_capacity||0)),this.occupancy=this._state.stats.pipe(Object(R.a)(t=>(100*(t.occupancy||0)).toFixed(1))),this.utilisation=this._state.stats.pipe(Object(R.a)(t=>(100*(t.utilisation||0)).toFixed(1)))}}return t.\u0275fac=function(e){return new(e||t)(c.gc(S))},t.\u0275cmp=c.ac({type:t,selectors:[["report-spaces-overall"]],decls:44,vars:21,consts:[[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"flex-1","flex","flex-col","items-center","justify-center"]],template:function(t,e){1&t&&(c.mc(0,"div",0),c.mc(1,"div",1),c.mc(2,"h3"),c.ad(3,"Total Bookings"),c.lc(),c.mc(4,"p"),c.ad(5),c.Cc(6,"async"),c.lc(),c.lc(),c.mc(7,"div",1),c.mc(8,"h3"),c.ad(9,"Average Bookings Length"),c.lc(),c.mc(10,"p"),c.ad(11),c.Cc(12,"async"),c.lc(),c.lc(),c.lc(),c.mc(13,"div",0),c.mc(14,"div",2),c.mc(15,"h3"),c.ad(16,"Overall Efficiency"),c.lc(),c.mc(17,"p"),c.ad(18),c.Cc(19,"async"),c.lc(),c.lc(),c.mc(20,"div",2),c.mc(21,"h3"),c.ad(22,"Occupancy"),c.lc(),c.mc(23,"p"),c.ad(24),c.Cc(25,"async"),c.lc(),c.lc(),c.mc(26,"div",2),c.mc(27,"h3"),c.ad(28,"Total Attendees"),c.lc(),c.mc(29,"p"),c.ad(30),c.Cc(31,"async"),c.lc(),c.lc(),c.mc(32,"div",2),c.mc(33,"h3"),c.ad(34,"Total Capacity"),c.lc(),c.mc(35,"p"),c.ad(36),c.Cc(37,"async"),c.lc(),c.lc(),c.mc(38,"div",2),c.mc(39,"h3"),c.ad(40,"Utilisation"),c.lc(),c.mc(41,"p"),c.ad(42),c.Cc(43,"async"),c.lc(),c.lc(),c.lc()),2&t&&(c.Ub(5),c.bd(c.Dc(6,7,e.total_count)||0),c.Ub(6),c.bd(c.Dc(12,9,e.avg_length)||"None"),c.Ub(7),c.cd("",c.Dc(19,11,e.efficiency)||0,"%"),c.Ub(6),c.cd("",c.Dc(25,13,e.occupancy)||0,"%"),c.Ub(6),c.bd(c.Dc(31,15,e.total_users)||0),c.Ub(6),c.bd(c.Dc(37,17,e.total_capacity)||0),c.Ub(6),c.cd("",c.Dc(43,19,e.utilisation)||0,"%"))},pipes:[s.b],styles:["h3[_ngcontent-%COMP%] {\n            font-weight: 500;\n        }\n\n        p[_ngcontent-%COMP%]:not([simple]) {\n            font-size: 1.75rem;\n        }"]}),t})();var st=n("J+dc"),ot=n("IsEO");const it=function(){return["name","capacity","count","utilisation","avg_attendees","occupancy"]},at=function(){return["Name","Capacity","Meeting Count","Utilisation","Avg. Attendees","Occupancy"]},lt=function(){return["flex"]};let rt=(()=>{class t{constructor(t){this._reports=t,this.space_list=Object(I.a)([this._reports.stats,this._reports.options]).pipe(Object(U.a)(300),Object(R.a)(([t,{start:e,end:n}])=>{let c=[];for(const o of t.events){const t=o.resources||[];for(const e of t){c.find(t=>t.id===e.id)||c.push({id:e.id,name:e.display_name||e.name,capacity:e.capacity||1,count:0,attendees:0,avg_attendees:0,usage:0,utilisation:0,occupancy:0});const t=c.find(t=>t.id===e.id);t.count+=1,t.usage+=o.duration,t.attendees+=o.attendees.length}}const s=x(n,e);for(const o of c)o.avg_attendees=o.attendees/o.count,o.utilisation=o.usage/60/8/s,o.occupancy=o.avg_attendees/o.capacity;return c})),this.download=()=>Object(d.a)(this,void 0,void 0,(function*(){const t=yield this.space_list.pipe(Object(st.a)(1)).toPromise();Object(p.i)("report-spaces-usage.csv",Object(p.l)(t))}))}}return t.\u0275fac=function(e){return new(e||t)(c.gc(S))},t.\u0275cmp=c.ac({type:t,selectors:[["report-spaces-space-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(c.mc(0,"div",0),c.mc(1,"div",1),c.mc(2,"h3",2),c.ad(3,"Space Utilisation"),c.lc(),c.mc(4,"button",3),c.xc("click",(function(){return e.download()})),c.mc(5,"app-icon"),c.ad(6,"download"),c.lc(),c.lc(),c.lc(),c.hc(7,"custom-table",4),c.lc()),2&t&&(c.Ub(7),c.Hc("dataSource",e.space_list)("pagination",!0)("columns",c.Ic(5,it))("display_column",c.Ic(6,at))("column_size",c.Ic(7,lt)))},directives:[L.b,N.a,ot.a],styles:[""]}),t})();const dt=function(){return["name","capacity","count","avg_attendees","occupancy"]},ut=function(){return["Name","Capacity","Meeting Count","Avg. Attendees","Occupancy"]},pt=function(){return["flex"]};let gt=(()=>{class t{constructor(t){this._reports=t,this.user_list=Object(I.a)([this._reports.stats]).pipe(Object(U.a)(300),Object(R.a)(([t])=>{let e=[];for(const n of t.events){const t=n.attendees||[],c=n.resources.reduce((t,e)=>t+e.capacity,0)||1;for(const s of t){e.find(t=>t.email===s.email)||e.push({id:s.email,name:s.name,capacity:c,count:0,attendees:0,avg_attendees:0,occupancy:0});const t=e.find(t=>t.id===s.email);t.count+=1,t.attendees+=n.attendees.length}}for(const n of e)n.avg_attendees=n.attendees/n.count,n.occupancy=n.avg_attendees/n.capacity;return e}),Object(E.a)(1)),this.download=()=>Object(d.a)(this,void 0,void 0,(function*(){const t=yield this.user_list.pipe(Object(st.a)(1)).toPromise();Object(p.i)("report-space-attendee-usage.csv",Object(p.l)(t))}))}}return t.\u0275fac=function(e){return new(e||t)(c.gc(S))},t.\u0275cmp=c.ac({type:t,selectors:[["report-spaces-user-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(c.mc(0,"div",0),c.mc(1,"div",1),c.mc(2,"h3",2),c.ad(3,"Staff Utilisation"),c.lc(),c.mc(4,"button",3),c.xc("click",(function(){return e.download()})),c.mc(5,"app-icon"),c.ad(6,"download"),c.lc(),c.lc(),c.lc(),c.hc(7,"custom-table",4),c.lc()),2&t&&(c.Ub(7),c.Hc("dataSource",e.user_list)("pagination",!0)("columns",c.Ic(5,dt))("display_column",c.Ic(6,ut))("column_size",c.Ic(7,pt)))},directives:[L.b,N.a,ot.a],styles:[""]}),t})();const ht=["report-spaces",""];function mt(t,e){1&t&&(c.kc(0),c.hc(1,"report-spaces-overall"),c.hc(2,"report-spaces-space-listing"),c.hc(3,"report-spaces-user-listing"),c.jc())}function ft(t,e){if(1&t&&(c.kc(0),c.Yc(1,mt,4,0,"ng-container",0),c.Cc(2,"async"),c.jc()),2&t){const t=c.Bc(),e=c.Mc(5);c.Ub(1),c.Hc("ngIf",c.Dc(2,2,t.total_count))("ngIfElse",e)}}function bt(t,e){1&t&&(c.mc(0,"div",3),c.hc(1,"mat-spinner",4),c.mc(2,"p",5),c.ad(3,"Loading report data..."),c.lc(),c.lc()),2&t&&(c.Ub(1),c.Hc("diameter",32))}function vt(t,e){1&t&&(c.mc(0,"div",3),c.mc(1,"p",5),c.ad(2," Select levels and time period to generate a report. "),c.lc(),c.lc())}let _t=(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe(Object(R.a)(t=>t.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}return t.\u0275fac=function(e){return new(e||t)(c.gc(S))},t.\u0275cmp=c.ac({type:t,selectors:[["","report-spaces",""]],attrs:ht,decls:6,vars:4,consts:[[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(t,e){if(1&t&&(c.Yc(0,ft,3,4,"ng-container",0),c.Cc(1,"async"),c.Yc(2,bt,4,1,"ng-template",null,1,c.Zc),c.Yc(4,vt,3,0,"ng-template",null,2,c.Zc)),2&t){const t=c.Mc(3);c.Hc("ngIf",!c.Dc(1,2,e.loading))("ngIfElse",t)}},directives:[s.n,ct,rt,gt,T.b],pipes:[s.b],styles:[""]}),t})();var yt=n("R3DB"),Ot=n("XyEp");const jt=function(){return["date","usage","approved","count","utilisation"]},wt=function(){return["Date","Used Desks","Approved Bookings","Total Requests","Utilisation"]},xt=function(){return["flex"]};let kt=(()=>{class t{constructor(t){this._state=t,this.day_list=Object(I.a)([this._state.options,this._state.stats]).pipe(Object(R.a)(([t,e])=>{const{start:n,end:c}=t;let s=n;const o=[];for(;Object(yt.a)(s,c);){const t=Object(f.a)(s).valueOf(),n=Object(b.a)(t).valueOf(),c=e.events.filter(e=>Object(p.w)(t,n,e.date,e.date+60*e.duration*1e3));o.push({date:t,total:e.total,free:e.total-c.length,approved:c.reduce((t,e)=>t+(e.approved?1:0),0),count:c.length,utilisation:(c.length/e.total*100).toFixed(1)}),s=Object(Ot.a)(s,1)}return o}),Object(E.a)(1)),this.download=()=>Object(d.a)(this,void 0,void 0,(function*(){let t=yield this.day_list.pipe(Object(st.a)(1)).toPromise();t=t.map(t=>Object.assign(Object.assign({},t),{date:Object(k.a)(t.date,"MMMM d, y(EEE)")})),Object(p.i)("desks-usage.csv",Object(p.l)(t))}))}}return t.\u0275fac=function(e){return new(e||t)(c.gc(S))},t.\u0275cmp=c.ac({type:t,selectors:[["report-desks-overall-list"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(c.mc(0,"div",0),c.mc(1,"div",1),c.mc(2,"h3",2),c.ad(3,"Daily Utilisation"),c.lc(),c.mc(4,"button",3),c.xc("click",(function(){return e.download()})),c.mc(5,"app-icon"),c.ad(6,"download"),c.lc(),c.lc(),c.lc(),c.hc(7,"custom-table",4),c.lc()),2&t&&(c.Ub(7),c.Hc("dataSource",e.day_list)("pagination",!0)("columns",c.Ic(5,jt))("display_column",c.Ic(6,wt))("column_size",c.Ic(7,xt)))},directives:[L.b,N.a,ot.a],encapsulation:2}),t})();const Mt=function(){return["name","avg_usage","approved","count","utilisation"]},Dt=function(){return["Level","Avg. Used Desks","Approved Bookings","Total Requests","Utilisation"]},Ct=function(){return["flex"]};let It=(()=>{class t{constructor(t,e){this._state=t,this._org=e,this.level_list=Object(I.a)([this._state.options,this._state.stats,this._state.counts]).pipe(Object(R.a)(([t,e,n])=>{const{start:c,end:s,zones:o}=t,i=x(s,c),a=[];console.log("Duration:",i);for(const l of o){if("All"===l)continue;const t=this._org.levelWithID([l]),c=n[l]||0,s=e.events.filter(t=>t.zones.includes(l));console.log("Evnets:",s.length);let o=(c*i-s.length)/i;o%1!=0&&(o=o.toFixed(2)),a.push({name:(null==t?void 0:t.display_name)||(null==t?void 0:t.name),free:o,total:c,count:s.length,utilisation:(s.length/(c*i)*100||0).toFixed(2)})}return a}),Object(E.a)(1)),this.download=()=>Object(d.a)(this,void 0,void 0,(function*(){let t=yield this.level_list.pipe(Object(st.a)(1)).toPromise();Object(p.i)("desks-levels-usage.csv",Object(p.l)(t))}))}}return t.\u0275fac=function(e){return new(e||t)(c.gc(S),c.gc(P.c))},t.\u0275cmp=c.ac({type:t,selectors:[["report-desks-levels-list"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(c.mc(0,"div",0),c.mc(1,"div",1),c.mc(2,"h3",2),c.ad(3,"Level Utilisation"),c.lc(),c.mc(4,"button",3),c.xc("click",(function(){return e.download()})),c.mc(5,"app-icon"),c.ad(6,"download"),c.lc(),c.lc(),c.lc(),c.hc(7,"custom-table",4),c.lc()),2&t&&(c.Ub(7),c.Hc("dataSource",e.level_list)("pagination",!0)("columns",c.Ic(5,Mt))("display_column",c.Ic(6,Dt))("column_size",c.Ic(7,Ct)))},directives:[L.b,N.a,ot.a],encapsulation:2}),t})();const Ut=["report-desks",""];function zt(t,e){if(1&t&&(c.kc(0),c.mc(1,"div",3),c.mc(2,"div",4),c.mc(3,"h3"),c.ad(4,"Total Bookings"),c.lc(),c.mc(5,"p"),c.ad(6),c.Cc(7,"async"),c.lc(),c.lc(),c.mc(8,"div",4),c.mc(9,"h3"),c.ad(10,"Utilisation"),c.lc(),c.mc(11,"p"),c.ad(12),c.Cc(13,"async"),c.lc(),c.lc(),c.lc(),c.hc(14,"report-desks-overall-list"),c.hc(15,"report-desks-levels-list"),c.jc()),2&t){const t=c.Bc(2);c.Ub(6),c.bd(c.Dc(7,2,t.total_count)||0),c.Ub(6),c.cd("",c.Dc(13,4,t.utilisation)||0,"%")}}function Ht(t,e){if(1&t&&(c.kc(0),c.Yc(1,zt,16,6,"ng-container",0),c.Cc(2,"async"),c.jc()),2&t){const t=c.Bc(),e=c.Mc(5);c.Ub(1),c.Hc("ngIf",c.Dc(2,2,t.total_count))("ngIfElse",e)}}function Rt(t,e){1&t&&(c.mc(0,"div",5),c.hc(1,"mat-spinner",6),c.mc(2,"p",7),c.ad(3,"Loading report data..."),c.lc(),c.lc()),2&t&&(c.Ub(1),c.Hc("diameter",32))}function Et(t,e){1&t&&(c.mc(0,"div",5),c.mc(1,"p",7),c.ad(2," Select levels and time period to generate a report. "),c.lc(),c.lc())}const Pt=[{path:"",component:X,children:[{path:""},{path:"spaces",component:_t},{path:"desks",component:(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe(Object(R.a)(t=>t.count||0)),this.utilisation=this._state.stats.pipe(Object(R.a)(t=>(100*(t.utilisation||0)).toFixed(1))),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"desks"})}}return t.\u0275fac=function(e){return new(e||t)(c.gc(S))},t.\u0275cmp=c.ac({type:t,selectors:[["","report-desks",""]],attrs:Ut,decls:6,vars:4,consts:[[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(t,e){if(1&t&&(c.Yc(0,Ht,3,4,"ng-container",0),c.Cc(1,"async"),c.Yc(2,Rt,4,1,"ng-template",null,1,c.Zc),c.Yc(4,Et,3,0,"ng-template",null,2,c.Zc)),2&t){const t=c.Mc(3);c.Hc("ngIf",!c.Dc(1,2,e.loading))("ngIfElse",t)}},directives:[s.n,kt,It,T.b],pipes:[s.b],styles:["h3[_ngcontent-%COMP%] {\n                font-weight: 500;\n            }\n\n            p[_ngcontent-%COMP%]:not([simple]) {\n                font-size: 1.75rem;\n            }"]}),t})()},{path:"**",redirectTo:"desks"}]}];let St=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.ec({type:t}),t.\u0275inj=c.dc({imports:[[s.c,o.h,a.a,tt.a,et.c,l.b,i.g.forChild(Pt)]]}),t})()}}]);