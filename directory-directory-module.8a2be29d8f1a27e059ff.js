(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{EA6B:function(t,e,n){"use strict";n.d(e,"b",(function(){return m})),n.d(e,"a",(function(){return p}));var s=n("C05f"),a=n("TLy2"),o=n("jOdJ"),c=n("WPBw"),i=n("SQLt"),r=n("D8Xy"),l=n("KuCG"),g=n("20lr"),u=n("eZII"),h=n("mjT4"),f=n("EM62"),_=n("7JBE"),d=n("dJst"),b=n("OZ4H");function m(){sessionStorage.removeItem("PLACEOS.event"),sessionStorage.removeItem("PLACEOS.event_form"),localStorage.removeItem("PLACEOS.event_filters")}let p=(()=>{class t extends g.c{constructor(t,e,n,o,r){super(),this._events=t,this._calendar=e,this._org=n,this._staff=o,this._dialog=r,this._event=new s.a(null),this._form=new s.a(null),this._filters=new s.a({}),this._loading_spaces=new s.a(!1),this._loading_event=new s.a(!1),this.event=this._event.asObservable(),this.form=this._form.asObservable(),this.filters=this._filters.asObservable(),this.loading_spaces=this._loading_spaces.asObservable(),this.loading_event=this._loading_event.asObservable(),this.spaces=this._filters.pipe(Object(a.a)(t=>{var e,n;this._loading_spaces.next(!0);const s=this._form.getValue().value,a=Math.floor(new Date(s.date).valueOf()/1e3),o=Math.floor(Object(c.a)(new Date(s.date),s.duration||60).valueOf()/1e3),i=(null===(e=null==t?void 0:t.zones)||void 0===e?void 0:e.length)?t.zones:[null===(n=this._org.building)||void 0===n?void 0:n.id];return this._calendar.availability({zone_ids:i.join(","),period_start:a,period_end:o}).then(e=>(this._loading_spaces.next(!1),e.filter(e=>!t.capacity||t.capacity>=e.capacity)))})),this.clearState=()=>m(),this.setEvent(new u.a({date:Object(i.a)(Object(c.a)(new Date,2),{nearestTo:5}).valueOf()}))}get event_form(){return this._form.getValue()}get event_filters(){return this._filters.getValue()}get is_future_date(){var t,e;const n=(null===(e=null===(t=this._form.getValue())||void 0===t?void 0:t.controls)||void 0===e?void 0:e.date.value)||(new Date).valueOf();return Object(r.a)(new Date(n),Object(l.a)(new Date))}setEvent(t){this._event.next(t);const e=Object(u.c)(t);this._form.next(e),this.subscription("form_change",()=>this.storeState())}setValue(t,e){const n=this._form.getValue();n&&n.controls[t]&&n.controls[t].setValue(e)}newAttendee(){const t=this._dialog.open(h.b,{width:"auto",height:"auto",data:{}}),e=this._form.getValue();t.componentInstance.event.pipe(Object(o.a)(t=>"done"===t.reason)).subscribe(n=>{const s=e.controls.attendees.value||[];s.push(n.metadata),e.controls.attendees.setValue(Object(g.x)(s,"email")),t.close()})}clearForm(){this.setEvent(this._event.getValue()),this._filters.next({})}updateFilters(t){this._filters.next(t)}storeState(){const t=this._form.getValue();sessionStorage.setItem("PLACEOS.event",JSON.stringify(this._event.getValue().toJSON())),sessionStorage.setItem("PLACEOS.event_form",JSON.stringify(t.value)),localStorage.setItem("PLACEOS.event_filters",JSON.stringify(this._filters.getValue()))}loadState(){const t=sessionStorage.getItem("PLACEOS.event")||"{}";t&&this._event.next(new u.a(JSON.parse(t)));const e=sessionStorage.getItem("PLACEOS.event_form");if(e){const t=Object(u.c)(this._event.getValue());t.patchValue(JSON.parse(e)),this._form.next(t)}const n=localStorage.getItem("PLACEOS.event_filters");n&&this._filters.next(JSON.parse(n))}save(){const t=this._form.getValue();if(t.markAllAsTouched(),t.controls.organiser.value&&t.controls.host.value||t.patchValue({organiser:this._staff.current,host:this._staff.current.email}),t.controls.title.value||t.patchValue({title:this._staff.current.email}),!t.valid){const e=[];for(const n in t.controls)t.controls[n].invalid&&e.push(n);return Promise.reject(Object(g.l)(`Some form fields are not valid: [${e.join(", ")}]`))}this._loading_event.next(!0);const e=new u.a(Object.assign(Object.assign({},this._event.getValue()),this._form.getValue().value));return this._events.save(e).then(()=>this._loading_event.next(!1),()=>this._loading_event.next(!1))}}return t.\u0275fac=function(e){return new(e||t)(f.cc(u.b),f.cc(_.a),f.cc(d.c),f.cc(h.d),f.cc(b.b))},t.\u0275prov=f.Lb({token:t,factory:t.\u0275fac}),t})()},KlkT:function(t,e,n){"use strict";n.r(e),n.d(e,"DirectoryModule",(function(){return A}));var s=n("2kYt"),a=n("sEIs"),o=n("R3Ii"),c=n("ZTXN"),i=n("mWib"),r=n("Ohay"),l=n("TLy2"),g=n("YtkY"),u=n("20lr"),h=n("EA6B"),f=n("EM62"),_=n("mjT4"),d=n("e81E"),b=n("ek5h"),m=n("C9Ki"),p=n("d4mj"),O=n("PBFl"),v=n("FGQ9"),C=n("81Qw");function P(t,e){if(1&t&&(f.Vb(0,"div",11),f.Qb(1,"a-user-avatar",12),f.Ub()),2&t){const t=f.jc(2);f.Db(1),f.qc("user",t.user)}}function M(t,e){if(1&t){const t=f.Wb();f.Vb(0,"a",13),f.fc("click",(function(){return f.Ac(t),f.jc(2).sendCallEvent()})),f.kc(1,"safe"),f.Nc(2," Call "),f.Ub()}if(2&t){const t=f.jc(2);f.qc("href",f.mc(1,1,"tel:"+t.user.phone,"url"),f.Cc)}}const w=function(){return["/explore"]},y=function(t){return{user:t}};function x(t,e){if(1&t){const t=f.Wb();f.Vb(0,"div",1),f.Vb(1,"div",2),f.Lc(2,P,2,1,"div",3),f.Vb(3,"div",4),f.Vb(4,"div",5),f.Nc(5),f.Ub(),f.Vb(6,"div",6),f.Vb(7,"a",7),f.kc(8,"safe"),f.Nc(9),f.Ub(),f.Ub(),f.Ub(),f.Ub(),f.Vb(10,"div",8),f.Vb(11,"a",9),f.fc("click",(function(){return f.Ac(t),f.jc().sendLocateEvent()})),f.Nc(12," Locate "),f.Ub(),f.Lc(13,M,3,4,"a",10),f.Ub(),f.Ub()}if(2&t){const t=f.jc();f.Hb("with-image",t.show_image),f.Db(2),f.qc("ngIf",t.show_image),f.Db(3),f.Oc(t.user.name),f.Db(2),f.qc("href",f.mc(8,9,"mailto:"+t.user.email,"url"),f.Cc),f.Db(2),f.Oc(t.user.email),f.Db(2),f.qc("routerLink",f.tc(12,w))("queryParams",f.uc(13,y,t.user.email)),f.Db(2),f.qc("ngIf",t.user.phone)}}let V=(()=>{class t{constructor(t){this._settings=t}get show_image(){return this._settings.get("app.directory.show_avatars")}sendLocateEvent(){}sendCallEvent(){}}return t.\u0275fac=function(e){return new(e||t)(f.Pb(u.f))},t.\u0275cmp=f.Jb({type:t,selectors:[["a-directory-user-list-item"]],inputs:{user:"user"},decls:1,vars:1,consts:[["class","space-details",3,"with-image",4,"ngIf"],[1,"space-details"],[1,"group"],["class","avatar",4,"ngIf"],[1,"details"],[1,"name"],[1,"info"],["name","email",3,"href"],[1,"actions"],["mat-flat-button","","color","primary","button","","name","locate",3,"routerLink","queryParams","click"],["mat-flat-button","","color","primary","button","","name","call",3,"href","click",4,"ngIf"],[1,"avatar"],[3,"user"],["mat-flat-button","","color","primary","button","","name","call",3,"href","click"]],template:function(t,e){1&t&&f.Lc(0,x,14,15,"div",0),2&t&&f.qc("ngIf",e.user)},directives:[s.o,O.a,a.f,v.a],pipes:[C.b],styles:[".space-details[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;background-color:#fff;flex-wrap:wrap;overflow:hidden;transition:all .2s;padding:0 1em}.space-details[_ngcontent-%COMP%]:hover{background:rgba(0,0,0,.1)}.space-details[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{display:none}.with-image[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{display:initial}.group[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}@media screen and (max-width:639px){.group[_ngcontent-%COMP%]{border-bottom:1px solid #ccc}}.details[_ngcontent-%COMP%]{flex:1;min-width:50%;padding:.5em 1em}@media screen and (max-width:639px){.details[_ngcontent-%COMP%]{padding:1em}}.info[_ngcontent-%COMP%]{display:flex;align-items:center}.info[_ngcontent-%COMP%], .info[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:rgba(0,0,0,.65)}.name[_ngcontent-%COMP%]{font-size:1.2em}.location[_ngcontent-%COMP%]{font-size:.8em;flex:1;min-width:50%}.actions[_ngcontent-%COMP%], .capacity[_ngcontent-%COMP%]{display:flex;align-items:center}.actions[_ngcontent-%COMP%]{justify-content:center;flex-direction:column}@media screen and (max-width:639px){.actions[_ngcontent-%COMP%]{flex-direction:row;flex:1}}a[button][_ngcontent-%COMP%]{width:8em;margin:.5em .5em 0}a[button][_ngcontent-%COMP%]:last-child{margin-bottom:.5em}@media screen and (max-width:639px){a[button][_ngcontent-%COMP%]{width:12em;margin:.5em}}"]}),t})();var j=n("ukpX");function k(t,e){1&t&&f.Qb(0,"a-directory-user-list-item",14),2&t&&f.qc("user",e.$implicit)}function S(t,e){if(1&t&&(f.Tb(0),f.Vb(1,"div",12),f.Nc(2),f.Ub(),f.Lc(3,k,1,1,"a-directory-user-list-item",13),f.Sb()),2&t){const t=f.jc().$implicit,e=f.jc(2);f.Db(2),f.Oc(t),f.Db(1),f.qc("ngForOf",e.groupedUsers[t])}}function U(t,e){if(1&t&&(f.Tb(0),f.Lc(1,S,4,2,"ng-container",11),f.Sb()),2&t){const t=e.$implicit,n=f.jc(2);f.Db(1),f.qc("ngIf",n.groupedUsers[t].length)}}function I(t,e){if(1&t&&(f.Tb(0),f.Lc(1,U,2,1,"ng-container",10),f.Sb()),2&t){const t=f.jc();f.Db(1),f.qc("ngForOf",t.letters)}}const D=function(t){return{type:"icon",class:"material-icons",content:t}};function L(t,e){if(1&t&&(f.Vb(0,"div",15),f.Vb(1,"div",16),f.Vb(2,"div",17),f.Qb(3,"app-icon",18),f.Ub(),f.Vb(4,"div",19),f.Nc(5),f.Ub(),f.Ub(),f.Ub()),2&t){const t=f.jc();f.Db(3),f.qc("icon",f.uc(2,D,t.search_str&&t.search_str.length>=t.min_search_length?"close":"arrow_upward")),f.Db(2),f.Pc(" ",t.search_str&&t.search_str.length>=t.min_search_length?' No matches for "'+t.search_str+'"':"Type above to search for users"," ")}}const E="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),q=[{path:"",component:(()=>{class t extends u.c{constructor(t,e){super(),this._settings=t,this._users=e,this.user_list=[],this.search$=new c.b,this.groupedUsers={}}get min_search_length(){const t=this._settings.get("app.directory.min_search_length");return"number"==typeof t&&t>=0?t:3}ngOnInit(){this.search_results$=this.search$.pipe(Object(i.a)(400),Object(r.a)(),Object(l.a)(t=>(this.loading=!0,t.length>=this.min_search_length?this._users.query({q:t}).catch(()=>[]):Promise.resolve(this.user_list||[]))),Object(g.a)(t=>(this.loading=!1,t))),this.subscription("search_results",this.search_results$.subscribe(t=>{this.user_list=t,this.buildGroups(this.user_list)})),this.search$.next(""),Object(h.b)()}get letters(){return E}buildGroups(t){const e=t.sort((t,e)=>t.name.localeCompare(e.name));for(const n of this.letters)this.groupedUsers[n]=e.filter(t=>t.name.startsWith(n))}}return t.\u0275fac=function(e){return new(e||t)(f.Pb(u.f),f.Pb(_.d))},t.\u0275cmp=f.Jb({type:t,selectors:[["a-directory-user-list"]],features:[f.Ab],decls:13,vars:12,consts:[[1,"directory","page"],[1,"header"],[3,"menu","menuChange"],[1,"actions"],[1,"search"],["placeholder","Search for a person...",3,"value","loading","autofocus","flat","valueChange"],[4,"ngIf","ngIfElse"],[1,"footer"],["empty_state",""],[3,"show","showChange"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"letter"],[3,"user",4,"ngFor","ngForOf"],[3,"user"],[1,"list"],[1,"info-block"],[1,"icon"],[3,"icon"],[1,"text"]],template:function(t,e){if(1&t&&(f.Vb(0,"div",0),f.Vb(1,"header",1),f.Vb(2,"a-topbar-header",2),f.fc("menuChange",(function(t){return e.show_menu=t})),f.Ub(),f.Ub(),f.Vb(3,"div",3),f.Vb(4,"div",4),f.Vb(5,"a-searchbar",5),f.fc("valueChange",(function(t){return e.search_str=t}))("valueChange",(function(t){return e.search$.next(t)})),f.Ub(),f.Ub(),f.Ub(),f.Vb(6,"main"),f.Lc(7,I,2,1,"ng-container",6),f.Ub(),f.Vb(8,"footer",7),f.Qb(9,"a-footer-menu"),f.Ub(),f.Ub(),f.Lc(10,L,6,4,"ng-template",null,8,f.Mc),f.Vb(12,"a-overlay-menu",9),f.fc("showChange",(function(t){return e.show_menu=t})),f.Ub()),2&t){const t=f.xc(11);f.Db(2),f.qc("menu",e.show_menu),f.Db(1),f.Hb("blank",!1)("has-back",!1),f.Db(2),f.qc("value",e.search_str)("loading",e.loading)("autofocus",!0)("flat",!0),f.Db(2),f.qc("ngIf",e.groupedUsers&&e.user_list.length)("ngIfElse",t),f.Db(5),f.qc("show",e.show_menu)}},directives:[d.a,b.a,s.o,m.a,p.a,s.n,V,j.a],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;background:#f0f0f0}.page[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{flex:1;overflow:auto}.page[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{height:3.5em}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{background:#fff;display:flex;align-items:center;flex-wrap:wrap}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:none}.page[_ngcontent-%COMP%]   .actions.has-back[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block}.page[_ngcontent-%COMP%]   .actions.has-back[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{margin-left:.5em;font-size:1.5em}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{height:100%}.page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]{background:transparent}.page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%], .page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{display:none}.page[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]{height:3.5em;background:#fff}.page.directory[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center}.page.directory[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{display:none;width:0}.page.directory[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:100%}.page.directory[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   a-searchbar[_ngcontent-%COMP%]   .searchbar[_ngcontent-%COMP%]{border-radius:unset;box-shadow:none}.page.directory[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{display:flex;flex-direction:column}.page.directory[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]   a-directory-user-list-item[_ngcontent-%COMP%]{width:100%;margin-bottom:.5em}.page.directory[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]   .letter[_ngcontent-%COMP%]{font-weight:700;font-size:1.2em;padding:.25em 1em}"]}),t})()}];let A=(()=>{class t{}return t.\u0275mod=f.Nb({type:t}),t.\u0275inj=f.Mb({factory:function(e){return new(e||t)},imports:[[s.c,a.g.forChild(q),o.a]]}),t})()}}]);
//# sourceMappingURL=directory-directory-module.8a2be29d8f1a27e059ff.js.map