"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_room-manager_room-manager_module_ts"],{3602:(To,b,l)=>{l.r(b),l.d(b,{RoomManagerModule:()=>No});var f=l(6477),m=l(9542),E=l(647),ne=l(3045),Z=l(2886),ae=l(5533),e=l(6839),ie=l(4945),g=l(1670),A=l(5912),c=l(308),y=l(4505),I=l(7716),_e=l(4139),le=l(9151),re=l(9095),N=l(6942),se=l(7418),me=l(9128),v=l(4387),p=l(337),u=l(7486),M=l(8750),G=l(380),L=l(6508),R=l(7728),w=l(7672),x=l(2423),D=l(5312),$=l(2556),ce=l(1022),de=l(3670),T=l(5306),C=l(1031);function pe(t,i){1&t&&(e.TgZ(0,"button",4)(1,"app-icon"),e._uU(2,"close"),e.qZA()())}function fe(t,i){if(1&t&&(e.TgZ(0,"mat-option",30),e._uU(1),e.qZA()),2&t){const o=i.$implicit;e.Q6J("value",o.id),e.xp6(1),e.hij(" ",o.display_name||o.name," ")}}function ge(t,i){if(1&t&&(e.TgZ(0,"div",19)(1,"label",27),e.tHW(2,28),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",21)(5,"mat-select",29),e.YNc(6,fe,2,2,"mat-option",25),e.ALo(7,"async"),e.qZA(),e.TgZ(8,"mat-error"),e._uU(9,"Level is required"),e.qZA()()()),2&t){const o=e.oxw(3);e.xp6(1),e.ekj("error",o.form.controls.zone.invalid&&o.form.controls.zone.touched),e.xp6(5),e.Q6J("ngForOf",e.lcZ(7,3,o.levels))}}function ue(t,i){1&t&&(e.TgZ(0,"mat-error"),e.SDv(1,36),e.qZA())}function Me(t,i){if(1&t&&(e.TgZ(0,"div",31)(1,"label",32),e.tHW(2,33),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",21),e._UZ(5,"input",34),e.YNc(6,ue,2,0,"mat-error",35),e.qZA()()),2&t){const o=e.oxw(3);e.xp6(1),e.ekj("error",o.form.controls.name.invalid&&o.form.controls.name.touched),e.xp6(5),e.Q6J("ngIf",o.form.controls.name.invalid)}}function Re(t,i){1&t&&(e.TgZ(0,"mat-error"),e.SDv(1,40),e.qZA())}function Ce(t,i){if(1&t&&(e.TgZ(0,"div",31)(1,"label",37),e.SDv(2,38),e.qZA(),e.TgZ(3,"mat-form-field",21),e._UZ(4,"input",39),e.YNc(5,Re,2,0,"mat-error",35),e.qZA()()),2&t){const o=e.oxw(3);e.xp6(1),e.ekj("error",o.form.controls.email.invalid&&o.form.controls.email.touched),e.xp6(4),e.Q6J("ngIf",o.form.controls.email.invalid)}}function Oe(t,i){1&t&&(e.TgZ(0,"div",31)(1,"label",41),e.SDv(2,42),e.qZA(),e.TgZ(3,"mat-form-field",21),e._UZ(4,"input",43),e.qZA()())}function Ae(t,i){1&t&&(e.TgZ(0,"div",31)(1,"label",44),e.SDv(2,45),e.qZA(),e.TgZ(3,"mat-form-field",21),e._UZ(4,"input",46),e.qZA()())}function Ne(t,i){1&t&&(e.TgZ(0,"mat-error"),e.SDv(1,50),e.qZA())}function Te(t,i){if(1&t&&(e.TgZ(0,"div",31)(1,"label",47),e.SDv(2,48),e.qZA(),e.TgZ(3,"mat-form-field",21),e._UZ(4,"input",49),e.YNc(5,Ne,2,0,"mat-error",35),e.qZA()()),2&t){const o=e.oxw(3);e.xp6(1),e.ekj("error",o.form.controls.capacity.invalid&&o.form.controls.capacity.touched),e.xp6(4),e.Q6J("ngIf",o.form.controls.capacity.invalid)}}function he(t,i){1&t&&(e.TgZ(0,"div",19)(1,"mat-checkbox",51),e.SDv(2,52),e.qZA()())}function Ee(t,i){1&t&&(e.TgZ(0,"div",19)(1,"label",53),e.SDv(2,54),e.qZA(),e.TgZ(3,"mat-form-field",21),e._UZ(4,"textarea",55),e.qZA()())}function ve(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"mat-chip-row",61),e.NdJ("removed",function(){const _=e.CHM(o).$implicit,r=e.oxw(4);return e.KtG(r.removeFeature(_))}),e._uU(1),e.TgZ(2,"app-icon",62),e._uU(3,"close"),e.qZA()()}if(2&t){const o=i.$implicit;e.Q6J("selectable",!0)("removable",!0),e.xp6(1),e.hij(" ",o," ")}}function xe(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"div",19)(1,"label"),e.SDv(2,56),e.qZA(),e.TgZ(3,"mat-form-field",21)(4,"mat-chip-grid",57,58),e.YNc(6,ve,4,3,"mat-chip-row",59),e.TgZ(7,"input",60),e.NdJ("matChipInputTokenEnd",function(a){e.CHM(o);const _=e.oxw(3);return e.KtG(_.addFeature(a))}),e.qZA()()()()}if(2&t){const o=e.MAs(5),n=e.oxw(3);e.xp6(1),e.ekj("error",n.form.controls.features.invalid&&n.form.controls.features.touched),e.xp6(5),e.Q6J("ngForOf",n.feature_list),e.xp6(1),e.Q6J("matChipInputFor",o)("matChipInputSeparatorKeyCodes",n.separators)("matChipInputAddOnBlur",!0)}}function Pe(t,i){1&t&&(e.TgZ(0,"div",19)(1,"label",63),e.SDv(2,64),e.qZA(),e.TgZ(3,"mat-form-field",21),e._UZ(4,"input",65),e.qZA()())}function Se(t,i){if(1&t&&(e.TgZ(0,"mat-option",30),e._uU(1),e.qZA()),2&t){const o=i.$implicit;e.Q6J("value",o),e.xp6(1),e.Oqu(o)}}function be(t,i){1&t&&(e.TgZ(0,"mat-option",66),e._uU(1," No matching timezones "),e.qZA()),2&t&&e.Q6J("disabled",!0)}function Ze(t,i){1&t&&(e.TgZ(0,"div",19)(1,"label",67),e.SDv(2,68),e.qZA(),e._UZ(3,"image-list-field",69),e.qZA())}function ye(t,i){if(1&t&&(e.TgZ(0,"form",7),e.YNc(1,ge,10,5,"div",8),e.TgZ(2,"div",9),e.YNc(3,Me,7,3,"div",10),e.YNc(4,Ce,6,3,"div",10),e.qZA(),e.TgZ(5,"div",9),e.YNc(6,Oe,5,0,"div",10),e.YNc(7,Ae,5,0,"div",10),e.qZA(),e.TgZ(8,"div",11)(9,"div",12)(10,"label",13),e._uU(11," Default Setup Duration "),e.TgZ(12,"app-icon",14),e._uU(13," info_outline "),e.qZA()(),e._UZ(14,"a-duration-field",15),e.qZA(),e.TgZ(15,"div",12)(16,"label",16),e._uU(17," Default Breakdown Duration "),e.TgZ(18,"app-icon",17),e._uU(19," info_outline "),e.qZA()(),e._UZ(20,"a-duration-field",18),e.qZA()(),e.TgZ(21,"div",9),e.YNc(22,Te,6,3,"div",10),e.YNc(23,he,3,0,"div",8),e.qZA(),e.YNc(24,Ee,5,0,"div",8),e.YNc(25,xe,8,6,"div",8),e.YNc(26,Pe,5,0,"div",8),e.TgZ(27,"div",19)(28,"label",20),e._uU(29,"Timezone"),e.qZA(),e.TgZ(30,"mat-form-field",21)(31,"app-icon",22),e._uU(32,"search"),e.qZA(),e._UZ(33,"input",23),e.qZA(),e.TgZ(34,"mat-autocomplete",null,24),e.YNc(36,Se,2,2,"mat-option",25),e.YNc(37,be,2,1,"mat-option",26),e.qZA()(),e.YNc(38,Ze,4,0,"div",8),e.qZA()),2&t){const o=e.MAs(35),n=e.oxw(2);e.Q6J("formGroup",n.form),e.xp6(1),e.Q6J("ngIf",n.form.controls.zone),e.xp6(2),e.Q6J("ngIf",n.form.controls.name),e.xp6(1),e.Q6J("ngIf",n.form.controls.email),e.xp6(2),e.Q6J("ngIf",n.form.controls.display_name),e.xp6(1),e.Q6J("ngIf",n.form.controls.display_name),e.xp6(1),e.Q6J("formGroup",n.settings_form),e.xp6(6),e.Q6J("min",0),e.xp6(6),e.Q6J("min",0),e.xp6(2),e.Q6J("ngIf",n.form.controls.capacity),e.xp6(1),e.Q6J("ngIf",n.form.controls.bookable),e.xp6(1),e.Q6J("ngIf",n.form.controls.description),e.xp6(1),e.Q6J("ngIf",n.form.controls.features),e.xp6(1),e.Q6J("ngIf",n.form.controls.map_id),e.xp6(7),e.Q6J("matAutocomplete",o),e.xp6(3),e.Q6J("ngForOf",n.filtered_timezones),e.xp6(1),e.Q6J("ngIf",!n.timezones.length),e.xp6(1),e.Q6J("ngIf",n.form.controls.images)}}function Ie(t,i){if(1&t&&(e.TgZ(0,"main",5),e.YNc(1,ye,39,18,"form",6),e.qZA()),2&t){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.form)}}function Ge(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"footer",70)(1,"button",71),e.NdJ("click",function(){e.CHM(o);const a=e.oxw();return e.KtG(a.save())}),e._uU(2,"Save"),e.qZA()()}}function Le(t,i){1&t&&(e.TgZ(0,"div",72),e._UZ(1,"mat-spinner",73),e.TgZ(2,"p",74),e._uU(3,"Saving room..."),e.qZA()())}let we=(()=>{class t extends p.cx{get feature_list(){return this.form.controls.features.value}constructor(o,n,a){super(),this._data=o,this._dialog_ref=n,this._org=a,this.loading=!1,this.timezones=[],this.filtered_timezones=[],this.levels=this._org.active_levels,this.form=(0,Z.ji)(this._data.room),this.settings_form=new m.cw({setup:new m.NI(0),breakdown:new m.NI(0)}),this.encryption_levels=[{id:c.sUp.None,name:"None"},{id:c.sUp.Support,name:"Support"},{id:c.sUp.Admin,name:"Admin"},{id:c.sUp.NeverDisplay,name:"Never Display"}],this.query_fn=_=>(0,c.I0G)({q:_}).pipe((0,N.U)(r=>r.data)),this.separators=[v.K5,v.OC,v.L_]}ngOnInit(){var o=this;return(0,g.Z)(function*(){const{details:n}=yield(0,c.rlq)(o._org.organisation.id,"settings").toPromise(),a=(0,p.Wn)(["events","overflow"],n)||{};o._data.room.id&&a[o._data.room.id]&&o.settings_form.patchValue(a[o._data.room.id])})()}ngOnChanges(o){o.form&&(this.updateTimezoneList(),this.subscription("tz-change",this.form.valueChanges.subscribe(({timezone:n})=>this.filtered_timezones=this.timezones.filter(a=>a.toLowerCase().includes(n.toLowerCase())))))}addFeature(o){if(!this.form||!this.form.controls.features)return;const n=o.input,a=o.value,_=this.feature_list;(a||"").trim()&&(_.push(a),this.form.controls.features.setValue(_)),n&&(n.value="")}removeFeature(o){if(!this.form||!this.form.controls.features)return;const n=this.feature_list,a=n.indexOf(o);a>=0&&(n.splice(a,1),this.form.controls.features.setValue(n))}updateTimezoneList(){const o=this.form?.value?.timezone||"";this.timezones=p.sM,this.filtered_timezones=this.timezones.filter(n=>n.toLowerCase().includes(o.toLowerCase()))}save(){var o=this;return(0,g.Z)(function*(){if(!o.form.valid)return(0,p.cB)(`Some form fields are invalid. [${(0,p.RD)(o.form).join(", ")}]`);o.form.value.id||o.form.patchValue({display_name:o.form.value.display_name||o.form.value.name,zones:(0,p.Tw)([o._org.organisation.id,o._org.building.parent_id,o._org.building.id,`${o.form.value.zone?.id||o.form.value.zone||""}`]).filter(r=>r)}),o.loading=!0,o._dialog_ref.disableClose=!0;const n=o.form.getRawValue(),{details:a}=yield(0,c.rlq)(o._org.organisation.id,"settings").toPromise(),_=(0,p.Wn)(["events","overflow"],a)||{};_[n.id]=o.settings_form.value,yield(0,c.Ymr)(o._org.organisation.id,{name:"settings",details:{...a,events:{...a.events||{},overflow:_}},description:""}).toPromise(),yield(n.id?(0,c.EQg)(n.id,n):(0,c.tgw)(n)).toPromise(),o._dialog_ref.disableClose=!1,o._dialog_ref.close(!0),o.loading=!1})()}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(u.WI),e.Y36(u.so),e.Y36(A.w7))},t.\u0275cmp=e.Xpm({type:t,selectors:[["room-form-modal"]],features:[e.qOj,e.TTD],decls:8,vars:5,consts:function(){let i,o,n,a,_,r,d,h,Y,X,k,j,K,H,B,W,V,ee,oe,te;return i=$localize`:@@zoneLabel␟805d5ab24c829f98df246a63541ee827ce04a4c4␟6308222021008136210: Level${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,o=$localize`:@@nameLabel␟ce22d533a3bc86b04d363cdacf055e861f719107␟253967969926135345: Name${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,n=$localize`:@@systemNamePlaceholder␟412d74982a750ad38d528a416090cad259267cf7␟3270670506078615677:Room Name`,a=$localize`:@@systemNameError␟a76167ad44bb224b5e970e7cdce5e03ba50bbf34␟4944106304667909261:Room name is required`,_=$localize`:@@emailLabel␟7e7d6d1958ec577b1f852c495aa8abb88a5a4e8c␟3680148548084285501: Email: `,r=$localize`:@@systemEmailPlaceholder␟796480f8af4a196dc6343cf00d09c7841f270f3a␟3140960526772549616:Room Email`,d=$localize`:@@emailError␟66a4553914df830f0bc1dd1f0a42c57fd85864de␟6407494155279173358:A valid email is required`,h=$localize`:@@displayNameLabel␟e966586c3aadb81b0555b483a36f46776d9792c8␟6691873398244034720:Display Name: `,Y=$localize`:@@displayNamePlaceholder␟e438ba78cbafdb5bcbce0820bfaad995a504f222␟3013055597615607317:Display Name`,X=$localize`:@@codeNameLabel␟61275d3a79a1234bf3fcb50f72d8dc798ef57e27␟7610172352109675938:Code: `,k=$localize`:@@codeNamePlaceholder␟68572de01b84c678be4bf8a27b990ecac2f41ce9␟8186013988289067040:Code`,j=$localize`:@@capacityLabel␟4fdfe5d0bf8898e5def2c3f9d5971f5e23e753d9␟255201359546348839: Capacity: `,K=$localize`:@@capacityPlaceholder␟ce9dfdc6dccb28dc75a78c704e09dc18fb02dcfa␟7825570888384392250:Capacity`,H=$localize`:@@capacityError␟dedde35e8848b99432791a4326aa103b8ec774c4␟8134498951699811316: A valid positive number is required `,B=$localize`:@@bookableLabel␟96462a3176e48f64fd7d25d58a6d49afe4628700␟414602767324525018: Bookable `,W=$localize`:@@descriptionLabel␟4a22c6843133f0b0d7dc0d28f864f2f90c1de7ad␟6996799422725544865:Description:`,V=$localize`:@@featuresLabel␟048b3adb78b9aabee65dbb43d9c5aadcda49015f␟1939786999396738714: Features: `,ee=$localize`:@@mapIdLabel␟46a8087017d0d929ed6d398ba5d3a5ea1be7ab9b␟1613414518051599973:Map ID:`,oe=$localize`:@@mapIdPlaceholder␟8936f99965a07edd4b09a0e4120f4dd5de79604d␟609514156045819245:Map SVG ID selector e.g. area-01.10-status`,te=$localize`:@@imagesLabel␟e5d9e00faa06714d7671b164cad364b26f4c585b␟5137125764814732349:Images:`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-gray-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[36rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[36rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","space-x-2"],["class","flex flex-col flex-1",4,"ngIf"],[1,"flex","space-x-2",3,"formGroup"],[1,"flex-1","flex","flex-col","space-y-2"],["for","setup",1,"flex","items-center"],["matTooltip","Time before a meeting needed for setup and preparation for the upcoming meeting",1,"ml-2"],["name","setup","formControlName","setup",3,"min"],["for","breakdown",1,"flex","items-center"],["matTooltip","Time after a meeting needed for cleaning and preparation for next meeting",1,"ml-2"],["name","breakdown","formControlName","breakdown",3,"min"],[1,"flex","flex-col"],["for","timezone"],["appearance","outline"],["matPrefix","",1,"text-2xl"],["matInput","","formControlName","timezone","placeholder","Room timezone",3,"matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],["for","zone"],i,["formControlName","zone","placeholder","Select Level"],[3,"value"],[1,"flex","flex-col","flex-1"],["for","system-name"],o,["matInput","","name","system-name","placeholder",n,"formControlName","name","required",""],[4,"ngIf"],a,["for","system-email"],_,["matInput","","name","system-email","placeholder",r,"formControlName","email"],d,["for","display-name"],h,["matInput","","name","display-name","placeholder",Y,"formControlName","display_name"],["for","code-name"],X,["matInput","","name","code-name","placeholder",k,"formControlName","code"],["for","capacity"],j,["matInput","","name","capacity","type","number","placeholder",K,"formControlName","capacity"],H,["name","bookable","formControlName","bookable"],B,["for","description"],W,["matInput","","name","description","placeholder","Description","formControlName","description"],V,["aria-label","Room features"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","New feature...",3,"matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],[3,"selectable","removable","removed"],["matChipRemove",""],["for","map_id"],ee,["matInput","","name","map_id","placeholder",oe,"formControlName","map_id"],[3,"disabled"],["for","images"],te,["name","images","formControlName","images"],[1,"p-2","flex","justify-end","border-t","border-gray-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(o,n){if(1&o&&(e.TgZ(0,"header")(1,"h2"),e._uU(2),e.qZA(),e.YNc(3,pe,3,0,"button",0),e.qZA(),e.YNc(4,Ie,2,1,"main",1),e.YNc(5,Ge,3,0,"footer",2),e.YNc(6,Le,4,0,"ng-template",null,3,e.W1O)),2&o){const a=e.MAs(7);e.xp6(2),e.hij("",n.form.value.id?"Edit":"Add"," Room"),e.xp6(1),e.Q6J("ngIf",!n.loading),e.xp6(1),e.Q6J("ngIf",!n.loading)("ngIfElse",a),e.xp6(1),e.Q6J("ngIf",!n.loading)}},dependencies:[f.sg,f.O5,m._Y,m.Fj,m.wV,m.JJ,m.JL,m.Q7,M.KE,M.TO,M.qo,G.Nt,L.gD,R.ey,w.oG,x.gM,D.Ou,u.ZT,$.XC,$.ZL,m.sg,m.u,ce.B,de.h,T.o,C.RA,C.oH,C.qH,C.z3,f.Ov],styles:["mat-checkbox[_ngcontent-%COMP%]{margin-top:2.5em;margin-bottom:1.5em}@media screen and (max-width: 640px){mat-checkbox[_ngcontent-%COMP%]{margin-top:0}}\n/*# sourceMappingURL=room-modal.component.ts-angular-inline--173.css.map*/"]}),t})(),P=(()=>{class t{constructor(o,n){this._org=o,this._dialog=n,this._options=new y.X({}),this._change=new y.X(0),this.options=this._options.asObservable(),this.room_list=(0,I.aj)([this._org.active_building,this._change]).pipe((0,le.h)(([a])=>!!a?.id),(0,re.w)(([a])=>(0,c.vIL)({zone_id:a.id}).pipe((0,N.U)(({data:_})=>_),(0,se.K)(()=>(0,_e.of)([])))),(0,N.U)(a=>a.filter(_=>this._org.levelWithID(_.zones)).sort((_,r)=>_.name.localeCompare(r.name))),(0,me.d)(1)),this.filtered_rooms=(0,I.aj)([this.room_list,this._options]).pipe((0,N.U)(([a,_])=>(_.zone&&(a=a.filter(r=>r.zones.includes(_.zone))),_.search&&(a=a.filter(r=>r.name.toLowerCase().includes(_.search.toLowerCase()))),a)))}setFilters(o){this._options.next({...this._options.getValue(),...o})}setSearchString(o){this._options.next({...this._options.getValue(),search:o})}editRoom(o=new c.G6j){this._dialog.open(we,{data:{room:o}}).afterClosed().subscribe(a=>{a&&setTimeout(()=>this._change.next(Date.now()),300)})}}return t.\u0275fac=function(o){return new(o||t)(e.LFG(A.w7),e.LFG(u.uw))},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var F=l(5670),J=l(3910),U=l(9377),S=l(3200),De=l(475),O=l(6844),$e=l(7303),z=l(1110);function Fe(t,i){1&t&&(e.ynx(0),e._uU(1,"Add"),e.BQk())}function Je(t,i){if(1&t&&(e._uU(0),e.ALo(1,"date"),e.ALo(2,"date")),2&t){const o=i.data,n=e.oxw(3);e.AsE(" ",e.xi3(1,2,o,"mediumDate")," ",e.xi3(2,5,o,n.time_format)," ")}}function Ue(t,i){if(1&t&&e._uU(0),2&t){const o=i.data;e.hij(" ",(null==o?null:o.length)||"0"," room(s) ")}}function ze(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(o);const a=e.oxw().row,_=e.oxw(3);return e.KtG(_.edit(a))}),e.TgZ(1,"app-icon"),e._uU(2,"edit"),e.qZA()()}}function qe(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"div",13),e.YNc(1,ze,3,0,"button",14),e.TgZ(2,"button",15),e.NdJ("click",function(){const _=e.CHM(o).row,r=e.oxw(3);return e.KtG(r.remove(_))}),e.TgZ(3,"app-icon"),e._uU(4,"delete"),e.qZA()()()}if(2&t){const o=i.row;e.xp6(1),e.Q6J("ngIf",o.id)}}const Qe=function(){return["start","end","items","actions"]},Ye=function(){return["Start","End","No. of Rooms"," "]},Xe=function(){return["10r","10r","flex","7r"]},ke=function(t,i,o,n){return{start:t,end:i,items:o,actions:n}};function je(t,i){if(1&t&&(e.TgZ(0,"main",8),e._UZ(1,"custom-table",9),e.YNc(2,Je,3,8,"ng-template",null,10,e.W1O),e.YNc(4,Ue,1,1,"ng-template",null,11,e.W1O),e.YNc(6,qe,5,1,"ng-template",null,12,e.W1O),e.qZA()),2&t){const o=e.MAs(3),n=e.MAs(5),a=e.MAs(7),_=e.oxw(2);e.xp6(1),e.Q6J("dataSource",_.restrictions)("columns",e.DdM(5,Qe))("display_column",e.DdM(6,Ye))("column_size",e.DdM(7,Xe))("template",e.l5B(8,ke,o,o,n,a))}}function Ke(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"footer",16)(1,"button",17),e.NdJ("click",function(){e.CHM(o);const a=e.oxw(2);return e.KtG(a.add())}),e._uU(2," Add Restriction "),e.qZA(),e.TgZ(3,"button",18),e.NdJ("click",function(){e.CHM(o);const a=e.oxw(2);return e.KtG(a.save())}),e._uU(4," Save Restrictions "),e.qZA()()}}function He(t,i){if(1&t&&(e.ynx(0),e.YNc(1,je,8,13,"main",6),e.YNc(2,Ke,5,0,"footer",7),e.BQk()),2&t){const o=e.oxw(),n=e.MAs(11);e.xp6(1),e.Q6J("ngIf",!o.adding)("ngIfElse",n),e.xp6(1),e.Q6J("ngIf",!o.adding)}}function Be(t,i){1&t&&(e.TgZ(0,"div",19),e._UZ(1,"mat-spinner",20),e.TgZ(2,"p"),e._uU(3,"Saving room restriction changes..."),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("diameter",32))}function We(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"mat-checkbox",41),e.NdJ("ngModelChange",function(a){const r=e.CHM(o).row,d=e.oxw(2);return e.KtG(d.selected[r.id||r.map_id]=a)}),e.qZA()}if(2&t){const o=i.row,n=e.oxw(2);e.Q6J("ngModel",n.selected[o.id||o.map_id])}}const Ve=function(){return["toggle","display_name","map_id"]},eo=function(){return[" ","Name","Map ID"]},oo=function(){return["4r","flex","12r"]},to=function(t){return{toggle:t}};function no(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"main",21)(1,"div",22)(2,"mat-form-field",23)(3,"mat-date-range-input",24)(4,"input",25),e.NdJ("ngModelChange",function(a){e.CHM(o);const _=e.oxw();return e.KtG(_.start_date=a)}),e.qZA(),e.TgZ(5,"input",26),e.NdJ("ngModelChange",function(a){e.CHM(o);const _=e.oxw();return e.KtG(_.setEndDate(a))}),e.qZA()(),e._UZ(6,"mat-datepicker-toggle",27)(7,"mat-date-range-picker",null,28),e.qZA(),e.TgZ(9,"mat-form-field",23)(10,"app-icon",29),e._uU(11,"search"),e.qZA(),e.TgZ(12,"input",30),e.NdJ("ngModelChange",function(a){e.CHM(o);const _=e.oxw();return e.KtG(_.search=a)}),e.qZA()()(),e.TgZ(13,"div",31)(14,"div",32)(15,"label",33),e._uU(16,"Start Time"),e.qZA(),e.TgZ(17,"a-time-field",34),e.NdJ("ngModelChange",function(a){e.CHM(o);const _=e.oxw();return e.KtG(_.setStart(a))}),e.qZA()(),e.TgZ(18,"div",32)(19,"label",35),e._uU(20,"End Time"),e.qZA(),e.TgZ(21,"a-time-field",36),e.NdJ("ngModelChange",function(a){e.CHM(o);const _=e.oxw();return e.KtG(_.setEnd(a))}),e.qZA()()(),e._UZ(22,"custom-table",37),e.YNc(23,We,1,1,"ng-template",null,38,e.W1O),e.qZA(),e.TgZ(25,"footer",16)(26,"button",39),e.NdJ("click",function(){e.CHM(o);const a=e.oxw();return e.KtG(a.adding=!1)}),e._uU(27," Back "),e.qZA(),e.TgZ(28,"button",40),e.NdJ("click",function(){e.CHM(o);const a=e.oxw();return e.KtG(a.addRestriction())}),e._uU(29," Add to Restrictions "),e.qZA()()}if(2&t){const o=e.MAs(8),n=e.MAs(24),a=e.oxw();e.xp6(3),e.Q6J("rangePicker",o),e.xp6(1),e.Q6J("ngModel",a.start_date),e.xp6(1),e.Q6J("ngModel",a.end_date),e.xp6(1),e.Q6J("for",o),e.xp6(6),e.Q6J("ngModel",a.search),e.xp6(5),e.Q6J("no_past_times",!1)("ngModel",a.start_date.valueOf()),e.xp6(4),e.Q6J("no_past_times",!1)("ngModel",a.end_date.valueOf()),e.xp6(1),e.Q6J("dataSource",a.room_list)("filter",a.search)("columns",e.DdM(15,Ve))("display_column",e.DdM(16,eo))("column_size",e.DdM(17,oo))("template",e.VKq(18,to,n))}}let ao=(()=>{class t{get time_format(){return this._settings.time_format}constructor(o,n,a,_){this._rooms=o,this._org=n,this._settings=a,this._dialog_ref=_,this.loading=!1,this.adding=!1,this.search="",this.id="",this.selected={},this.start_date=(0,U.Z)(Date.now()),this.end_date=(0,S.Z)(Date.now()),this.restrictions=[],this.room_list=this._rooms.room_list,this.setEndDate=r=>this.end_date=(0,S.Z)(r),this.setStart=r=>this.start_date=new Date(r),this.setEnd=r=>this.end_date=new Date(r)}ngOnInit(){var o=this;return(0,g.Z)(function*(){yield o._org.initialised.pipe((0,F.P)(n=>n)).toPromise(),(0,c.rlq)(o._org.building.id,"room_restrictions").subscribe(({details:n})=>{o.restrictions=n instanceof Array?n:[]})})()}add(){this.search="",this.id="",this.start_date=(0,U.Z)(Date.now()),this.end_date=(0,S.Z)(Date.now()),this.selected={},this.adding=!0}edit(o){this.search="",this.id=o.id,this.start_date=new Date(o.start),this.end_date=new Date(o.end),this.selected=o.items.reduce((n,a)=>({...n,[a]:!0}),{}),this.adding=!0}remove(o){this.restrictions=this.restrictions.filter(n=>n!==o)}addRestriction(){var o=this;return(0,g.Z)(function*(){const n=yield o.room_list.pipe((0,J.q)(1)).toPromise();o.id&&(o.restrictions=o.restrictions.filter(a=>a.id!==o.id)),o.restrictions.push({id:o.id||`restriction-${(0,p.Iy)(999999,9999999)}`,start:o.start_date.valueOf(),end:o.end_date.valueOf(),items:n.filter(a=>o.selected[a.id]).map(a=>a.id)}),o.adding=!1})()}save(){var o=this;return(0,g.Z)(function*(){o.loading=!0,o._dialog_ref.disableClose=!0,yield(0,c.Ymr)(o._org.building.id,{name:"room_restrictions",description:"Room restrictions",details:o.restrictions.filter(n=>(0,De.Z)(Date.now(),n.end))}).toPromise().catch(n=>{throw o.loading=!1,o._dialog_ref.disableClose=!1,(0,p.cB)("Failed to update room restrictions"),n}),o.loading=!1,o._dialog_ref.disableClose=!1,o._dialog_ref.close(),(0,p.t5)("Successfully updated room restrictions")})()}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(P),e.Y36(A.w7),e.Y36(p.gb),e.Y36(u.so))},t.\u0275cmp=e.Xpm({type:t,selectors:[["room-restriction-modal"]],decls:12,vars:3,consts:[[1,"flex","items-center","justify-between"],[4,"ngIf"],["btn","","icon","","matRipple","","mat-dialog-close",""],[4,"ngIf","ngIfElse"],["load_state",""],["add_state",""],["class","h-[65vh] overflow-auto",4,"ngIf","ngIfElse"],["class","flex items-center justify-end space-x-2 p-2 border-t border-gray-200",4,"ngIf"],[1,"h-[65vh]","overflow-auto"],["empty","No room restrictions set",1,"block","w-[36rem]","max-w-[80vw]",3,"dataSource","columns","display_column","column_size","template"],["date_template",""],["count_template",""],["actions_template",""],[1,"flex","items-center","justify-end","space-x-2","w-full"],["btn","","icon","","matRipple","",3,"click",4,"ngIf"],["btn","","icon","","matRipple","",3,"click"],[1,"flex","items-center","justify-end","space-x-2","p-2","border-t","border-gray-200"],["btn","","matRipple","",1,"inverse","w-40",3,"click"],["btn","","matRipple","",1,"w-40",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-[20rem]","h-[16rem]","space-y-2"],[3,"diameter"],[1,"flex","flex-col","h-[65vh]","overflow-auto"],[1,"flex","items-center","space-x-2","px-2","pt-2"],["appearance","outline",1,"flex-1"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matIconSuffix","",3,"for"],["picker",""],["matPrefix",""],["matInput","","placeholder","Filter rooms",3,"ngModel","ngModelChange"],[1,"flex","items-center","space-x-2","px-2","-mt-4"],[1,""],["for","start-time"],["name","start-time",1,"flex-1",3,"no_past_times","ngModel","ngModelChange"],["for","end-time"],["name","end-time",1,"flex-1",3,"no_past_times","ngModel","ngModelChange"],["empty","No room restrictions set",1,"block","w-[36rem]","max-w-[80vw]",3,"dataSource","filter","columns","display_column","column_size","template"],["toggle_template",""],["btn","","matRipple","",1,"inverse","w-32",3,"click"],["btn","","matRipple","",1,"w-48",3,"click"],[3,"ngModel","ngModelChange"]],template:function(o,n){if(1&o&&(e.TgZ(0,"header",0)(1,"h2"),e.YNc(2,Fe,2,0,"ng-container",1),e._uU(3," Room Restrictions "),e.qZA(),e.TgZ(4,"button",2)(5,"app-icon"),e._uU(6,"close"),e.qZA()()(),e.YNc(7,He,3,3,"ng-container",3),e.YNc(8,Be,4,1,"ng-template",null,4,e.W1O),e.YNc(10,no,30,20,"ng-template",null,5,e.W1O)),2&o){const a=e.MAs(9);e.xp6(2),e.Q6J("ngIf",n.adding),e.xp6(5),e.Q6J("ngIf",!n.loading)("ngIfElse",a)}},dependencies:[f.O5,m.Fj,m.JJ,m.On,M.KE,M.qo,M.R9,G.Nt,w.oG,O.nW,O.wx,O.zY,O.By,O._g,D.Ou,u.ZT,R.wG,$e.N,T.o,z.C,f.uU]}),t})();var io=l(9396);function _o(t,i){if(1&t&&(e.TgZ(0,"mat-option",6),e._uU(1),e.qZA()),2&t){const o=i.$implicit;e.Q6J("value",o.id),e.xp6(1),e.hij(" ",o.display_name||o.name," ")}}let q=(()=>{class t extends p.cx{get building(){return this._org.building}constructor(o,n,a,_,r){super(),this._manager=o,this._org=n,this._route=a,this._router=_,this._dialog=r,this.levels=this._org.active_levels,this.filters=this._manager.options,this.setFilters=d=>this._manager.setFilters(d),this.setSearch=d=>this._manager.setSearchString(d),this.updateZones=d=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_id:d}}),this._manager.setFilters({zone:d})},this.newRoom=()=>this._manager.editRoom()}manageRestrictions(){this._dialog.open(ao,{})}ngOnInit(){var o=this;return(0,g.Z)(function*(){yield o._org.initialised.pipe((0,F.P)(n=>n)).toPromise(),o.subscription("route.query",o._route.queryParamMap.subscribe(function(){var n=(0,g.Z)(function*(a){if(a.has("zone_id")){const _=a.get("zone_id"),{zone:r}=yield o._manager.options.pipe((0,J.q)(1)).toPromise();if(_&&_!==r){const d=o._org.levelWithID([_]);if(!d)return;o._org.building=o._org.buildings.find(h=>h.id===d.parent_id),o.setFilters({zone:_})}}});return function(a){return n.apply(this,arguments)}}())),o.subscription("levels",o._org.active_levels.subscribe(n=>{var a=n.find(_=>_.id===a);!a&&n.length&&(a=n[0].id),o.updateZones(a)})),o.setSearch("")})()}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(P),e.Y36(A.w7),e.Y36(E.gz),e.Y36(E.F0),e.Y36(u.uw))},t.\u0275cmp=e.Xpm({type:t,selectors:[["room-manager-topbar"]],features:[e.qOj],decls:18,vars:7,consts:[[1,"flex","items-center","justify-between","p-4"],[1,"text-2xl","font-medium"],["btn","",1,"w-32",3,"click"],[1,"flex","items-center","bg-white","dark:bg-neutral-700","h-20","px-4","space-x-2"],["appearance","outline"],["placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"flex-1","w-2"],["btn","","icon","","matRipple","","matTooltip","Room Restrictions",1,"bg-primary","text-white","rounded",3,"click"],[1,"mr-2",3,"modelChange"]],template:function(o,n){if(1&o&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2,"Room Management"),e.qZA(),e.TgZ(3,"button",2),e.NdJ("click",function(){return n.newRoom()}),e._uU(4,"New Room"),e.qZA()(),e.TgZ(5,"div",3)(6,"mat-form-field",4)(7,"mat-select",5),e.NdJ("ngModelChange",function(_){return n.updateZones(_)}),e.ALo(8,"async"),e.TgZ(9,"mat-option",6),e._uU(10,"All Levels"),e.qZA(),e.YNc(11,_o,2,2,"mat-option",7),e.ALo(12,"async"),e.qZA()(),e._UZ(13,"div",8),e.TgZ(14,"button",9),e.NdJ("click",function(){return n.manageRestrictions()}),e.TgZ(15,"app-icon"),e._uU(16,"lock_open"),e.qZA()(),e.TgZ(17,"searchbar",10),e.NdJ("modelChange",function(_){return n.setSearch(_)}),e.qZA()()),2&o){let a;e.xp6(7),e.Q6J("ngModel",null==(a=e.lcZ(8,3,n.filters))?null:a.zone),e.xp6(2),e.Q6J("value",null==n.building?null:n.building.id),e.xp6(2),e.Q6J("ngForOf",e.lcZ(12,5,n.levels))}},dependencies:[f.sg,m.JJ,m.On,io.U,M.KE,L.gD,R.ey,x.gM,R.wG,T.o,f.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25rem}\n/*# sourceMappingURL=room-manager-topbar.component.ts-angular-inline--174.css.map*/"]}),t})();var lo=l(3838);function ro(t,i){if(1&t&&(e._uU(0),e.ALo(1,"level"),e.ALo(2,"level")),2&t){const o=i.data;let n;e.hij(" ",(null==(n=e.lcZ(1,1,o))?null:n.display_name)||(null==(n=e.lcZ(2,3,o))?null:n.name)," ")}}function so(t,i){if(1&t&&(e.TgZ(0,"div",5)(1,"app-icon"),e._uU(2),e.qZA()()),2&t){const o=i.data;e.ekj("bg-red-500",!o)("bg-green-500",o),e.xp6(2),e.Oqu(o?"done":"close")}}function mo(t,i){if(1&t){const o=e.EpF();e.TgZ(0,"div",6)(1,"button",7),e.NdJ("click",function(){const _=e.CHM(o).row,r=e.oxw();return e.KtG(r.editRoom(_))}),e.TgZ(2,"app-icon"),e._uU(3,"edit"),e.qZA()()()}}const co=function(){return["display_name","zones","capacity","type","bookable","actions"]},po=function(){return["Room Name","Level","Capacity","Room Type","Bookable"," "]},fo=function(){return["flex","8r","6r","8r","6r","3.75r"]},go=function(t,i,o){return{bookable:t,zones:i,actions:o}};let Q=(()=>{class t{constructor(o){this._manager=o,this.rooms=this._manager.filtered_rooms,this.editRoom=n=>this._manager.editRoom(n)}}return t.\u0275fac=function(o){return new(o||t)(e.Y36(P))},t.\u0275cmp=e.Xpm({type:t,selectors:[["room-list"]],decls:8,vars:12,consts:[[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No rooms for selected level or building",1,"block","min-w-[48rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["level_template",""],["bool_template",""],["action_template",""],[1,"rounded","h-8","w-8","flex","items-center","justify-center","text-2xl","text-white","mx-auto"],[1,"w-full","flex","justify-end","space-x-2"],["btn","","icon","","matRipple","","matTooltip","Edit Room",3,"click"]],template:function(o,n){if(1&o&&(e.TgZ(0,"div",0),e._UZ(1,"custom-table",1),e.qZA(),e.YNc(2,ro,3,5,"ng-template",null,2,e.W1O),e.YNc(4,so,3,5,"ng-template",null,3,e.W1O),e.YNc(6,mo,4,0,"ng-template",null,4,e.W1O)),2&o){const a=e.MAs(3),_=e.MAs(5),r=e.MAs(7);e.xp6(1),e.Q6J("dataSource",n.rooms)("columns",e.DdM(5,co))("display_column",e.DdM(6,po))("column_size",e.DdM(7,fo))("template",e.kEZ(8,go,_,a,r))}},dependencies:[x.gM,R.wG,T.o,z.C,lo.M]}),t})();const uo=["app-room-manager",""];let Mo=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["","app-room-manager",""]],attrs:uo,decls:4,vars:0,consts:[[1,"relative","overflow-hidden","flex","flex-col"],[1,"block","w-full"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(o,n){1&o&&(e._UZ(0,"sidebar"),e.TgZ(1,"main",0),e._UZ(2,"room-manager-topbar",1)(3,"room-list",2),e.qZA())},dependencies:[ie.k,q,Q],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;background:var(--bg)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n/*# sourceMappingURL=room-manager.component.ts-angular-inline--172.css.map*/"]}),t})();var Ro=l(6866),Co=l(3320);const Oo=["app-new-room-manager",""],Ao=[{path:"",component:Mo},{path:"new",component:(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["","app-new-room-manager",""]],attrs:Oo,decls:6,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"block","w-full"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(o,n){1&o&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1),e._UZ(4,"room-manager-topbar",2)(5,"room-list",3),e.qZA()())},dependencies:[Ro.O,Co.u,q,Q],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:#fff}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n/*# sourceMappingURL=new-room-manager.component.ts-angular-inline--175.css.map*/"]}),t})()}];let No=(()=>{class t{}return t.\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.oAB({type:t}),t.\u0275inj=e.cJS({imports:[f.ez,m.u5,ne.v,Z.YR,ae.PP,C.Hi,E.Bz.forChild(Ao)]}),t})()}}]);
//# sourceMappingURL=apps_concierge_src_app_room-manager_room-manager_module_ts.js.map