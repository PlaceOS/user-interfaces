{"version":3,"sources":["./libs/explore/src/lib/explore-spaces.service.ts","./libs/explore/src/lib/explore-device-info.component.ts","./libs/explore/src/lib/explore-desk-info.component.ts","./libs/explore/src/lib/set-datetime-modal.component.ts","./libs/explore/src/lib/explore-desks.service.ts","./libs/explore/src/lib/explore.module.ts","./libs/explore/src/lib/explore-state.service.ts","./libs/explore/src/lib/explore-zoom-control.component.ts"],"names":["DEFAULT_COLOURS","free","pending","reserved","busy","unknown","ExploreDeviceInfoComponent","_details","_element","_overlay","username","user","this","mac","manufacturer","os","ssid","variance","toFixed","diameter","bg_color","distance_color","overlay_ref","onEnter","loadUser","onLeave","close","onClick","onTouch","formatDistanceToNow","last_seen","addSuffix","Math","abs","differenceInMinutes","Date","distance","tries","setTimeout","parent","nativeElement","parentElement","ngOnInit","position","parseInt","style","top","left","y_pos","x_pos","open","mod","system","details","execute","catch","_","assigned_to","_portal","create","positionStrategy","flexibleConnectedTo","_dot","withPositions","originX","originY","overlayX","overlayY","attach","dispose","ExploreDeskInfoComponent","map_id","start","end","form","SetDatetimeModalComponent","_data","book_until","until","date","duration","ExploreDesksService","_state","_org","_settings","_bookings","_dialog","super","_in_use","_options","_desks","_reserved","_statuses","_users","_poll","_desk_bookings","combineLatest","level","pipe","switchMap","lvl","period_start","period_end","type","zones","id","desk_list","map","i","Array","j","zone","catchError","e","_bind","unsubWith","building","buildings","find","bld","parent_id","system_id","bindings","area_management","organisation","binding","subscription","listen","subscribe","d","processBindingChange","bind","next","_state_change","desks","in_use","bookable","is_used","some","is_reserved","processDesks","init","initialised","toPromise","setOptions","enable_booking","get","delay","asset_id","interval","valueOf","clearInterval","options","getValue","value","devices","filter","v","includes","location","at_location","processDevices","timeout","updateStatus","style_map","colours","desk_id","fill","opacity","setStyles","list","device","x","map_width","y","map_height","push","coordinates_from","content","data","setFeatures","actions","desk","full_size","name","staff_name","status","z_index","book_fn","newForm","_setBookingTime","patchValue","asset_name","description","host","booking_type","confirmPost","action","callback","setActions","addDays","now","ref","afterClosed","SharedExploreModule","ExploreStateService","_spaces","_level","_positions","zoom","center","_styles","_features","_actions","_labels","disable","_message","asObservable","message","spaces","space","map_url","map_positions","map_features","features","key","disable_features","concat","map_actions","disable_actions","map_labels","labels","disable_labels","map_styles","styles","style_mappings","text","display","disable_styles","active_building","level_list","levelsForBuilding","length","setLevel","old_options","zone_id","levelWithID","feature_map","actions_map","labels_map","ExploreZoomControlComponent","zoomIn","setPositions","min","positions","zoomOut","max","reset"],"mappings":"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","file":"default-libs_explore_src_index_ts.js","sourcesContent":["import { Injectable, OnDestroy } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { getModule } from '@placeos/ts-client';\nimport { ViewAction, ViewerFeature } from '@placeos/svg-viewer';\nimport { map } from 'rxjs/operators';\n\nimport {\n    BaseClass,\n    HashMap,\n    notifyError,\n    SettingsService,\n} from '@placeos/common';\nimport { Space } from '@placeos/spaces';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { ExploreSpaceInfoComponent } from './explore-space-info.component';\nimport { ExploreBookingModalComponent } from './explore-booking-modal.component';\n\nexport const DEFAULT_COLOURS = {\n    free: '#43a047',\n    pending: '#ffb300',\n    reserved: '#e65100',\n    busy: '#e53935',\n    'not-bookable': '#757575',\n    unknown: '#757575',\n};\n\n@Injectable()\nexport class ExploreSpacesService extends BaseClass implements OnDestroy {\n    private _bookings: HashMap<CalendarEvent[]> = {};\n    private _statuses: HashMap<string> = {};\n\n    private _bind = this._state.spaces.pipe(\n        map((list) => {\n            this.unsubWith('b-');\n            this.unsubWith('s-');\n            this._statuses = {};\n            if (!list?.length) return;\n            for (const space of list) {\n                const mod = getModule(space.id, 'Bookings');\n                let binding = mod.binding('bookings');\n                this.subscription(\n                    `b-${space.id}`,\n                    binding\n                        .listen()\n                        .subscribe((d) =>\n                            this.handleBookingsChange(list, space, d)\n                        )\n                );\n                this.subscription(`b-bind-${space.id}`, binding.bind());\n                binding = mod.binding('status');\n                this.subscription(\n                    `s-${space.id}`,\n                    binding\n                        .listen()\n                        .subscribe((d) =>\n                            this.handleStatusChange(list, space, d)\n                        )\n                );\n                this.subscription(`s-bind-${space.id}`, binding.bind());\n            }\n            this.updateActions(list);\n            this.updateHoverElements(list);\n        })\n    );\n\n    constructor(\n        private _state: ExploreStateService,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this.subscription('spaces', this._bind.subscribe());\n    }\n\n    public bookSpace(space: Space) {\n        if (this._statuses[space.id] === 'busy' || !space.bookable) {\n            return notifyError(\n                `${\n                    space.display_name || space.name\n                } is unavailable at the current time`\n            );\n        }\n        this._dialog.open(ExploreBookingModalComponent, {\n            data: { space },\n        });\n    }\n\n    public handleBookingsChange(\n        spaces: Space[],\n        space: Space,\n        bookings: HashMap[]\n    ) {\n        if (!bookings) return;\n        this._bookings[space.id] = bookings.map((i) => new CalendarEvent(i));\n        this.timeout(\n            'update_hover_els',\n            () => this.updateHoverElements(spaces),\n            100\n        );\n    }\n\n    public handleStatusChange(spaces: Space[], space: Space, status: string) {\n        this._statuses[space.id] = space.bookable\n            ? status || 'free'\n            : 'not-bookable';\n        this.timeout(\n            'update_statuses',\n            () => {\n                this.clearTimeout('update_hover_els');\n                this.updateStatus(spaces);\n                this.updateHoverElements(spaces);\n            },\n            100\n        );\n    }\n\n    private updateStatus(spaces: Space[]) {\n        const style_map = {};\n        const colours = this._settings.get('app.explore.colors') || {};\n        for (const space of spaces) {\n            const status = this._statuses[space.id] || 'not-bookable';\n            style_map[`#${space.map_id}`] = {\n                fill:\n                    colours[`space-${status}`] ||\n                    colours[`${status}`] ||\n                    DEFAULT_COLOURS[`${status}`],\n                opacity: 0.6,\n            };\n        }\n        this._state.setStyles('spaces', style_map);\n    }\n\n    private updateHoverElements(spaces: Space[]) {\n        const features: ViewerFeature[] = [];\n        for (const space of spaces) {\n            features.push({\n                location: space.map_id,\n                full_size: true,\n                content: ExploreSpaceInfoComponent,\n                data: {\n                    space,\n                    events: this._bookings[space.id],\n                    status: this._statuses[space.id],\n                },\n            } as any);\n        }\n        this._state.setFeatures('spaces', features);\n    }\n\n    private updateActions(spaces: Space[]) {\n        const actions: ViewAction[] = [];\n        for (const space of spaces) {\n            actions.push({\n                id: space.map_id,\n                action: 'click',\n                callback: () => this.bookSpace(space),\n            });\n            actions.push({\n                id: space.map_id,\n                action: 'touchend',\n                callback: () => this.bookSpace(space),\n            });\n        }\n        this._state.setActions('spaces', actions);\n    }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Inject,\n    OnInit,\n    ViewChild,\n} from '@angular/core';\nimport { getModule } from '@placeos/ts-client';\nimport { MAP_FEATURE_DATA } from '@placeos/components';\nimport { differenceInMinutes, formatDistanceToNow } from 'date-fns';\nexport interface DeviceInfoData {\n    mac: string;\n    variance: number;\n    last_seen: number;\n    system: string;\n    manufacturer?: string;\n    os?: string;\n    ssid?: string;\n    user?: any;\n    bg_color?: string;\n}\n\n@Component({\n    selector: '[explore-device-info]',\n    template: `\n        <div\n            name=\"radius\"\n            (mouseenter)=\"loadUser()\"\n            class=\"radius absolute center bg-blue-600 bg-opacity-25 border-4 border-dashed border-blue-600 rounded-full\"\n            [style]=\"'height: ' + diameter + '%; width: ' + diameter + '%;'\"\n        ></div>\n        <div\n            name=\"dot\"\n            #dot\n            class=\"h-2 w-2 absolute center rounded-full pointer-events-auto shadow\"\n            [style.background-color]=\"bg_color\"\n        ></div>\n\n        <ng-template cdk-portal>\n            <div\n                name=\"device-info\"\n                class=\"w-64 rounded bg-white p-4 top-0 left-0 shadow pointer-events-none\"\n                (mouseleave)=\"close()\"\n            >\n                <div class=\"arrow\"></div>\n                <div class=\"details\">\n                    <p><label>MAC:</label> {{ mac }}</p>\n                    <p><label>Accuracy:</label> {{ variance }}m</p>\n                    <p><label>Last Seen:</label> {{ last_seen }}</p>\n                    <p type *ngIf=\"manufacturer\">\n                        <label>Manufacturer:</label> {{ manufacturer }}\n                    </p>\n                    <p os *ngIf=\"os\"><label>OS:</label> {{ os }}</p>\n                    <p ssid *ngIf=\"ssid\"><label>SSID:</label> {{ ssid }}</p>\n                    <p username *ngIf=\"username\">\n                        <label>Username:</label>\n                        {{ user?.name || user?.username || username }}\n                    </p>\n                    <p user *ngIf=\"user\">\n                        <label>Type:</label> {{ user.type }}\n                    </p>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                pointer-events: auto;\n            }\n\n            :host > [name='dot'] {\n                background-color: #616161;\n            }\n\n            :host:hover > [name='radius'] {\n                opacity: 1;\n            }\n\n            [name='radius'] {\n                opacity: 0;\n                transition: opacity 200ms;\n                pointer-events: none;\n            }\n        `,\n    ],\n})\nexport class ExploreDeviceInfoComponent implements OnInit {\n    /** Name of the user associated with the mac address */\n    public username = '';\n    /** User details associated with device */\n    public readonly user = this._details.user;\n    /** Mac Address of the device */\n    public readonly mac = this._details.mac;\n    /** Mac Address of the device */\n    public readonly manufacturer = this._details.manufacturer;\n    /** Mac Address of the device */\n    public readonly os = this._details.os;\n    /** Mac Address of the device */\n    public readonly ssid = this._details.ssid;\n    /** Accuracy of the location data */\n    public readonly variance = this._details.variance?.toFixed(2);\n    /** Diameter of the radius circle */\n    public readonly diameter = this._details.variance * 100;\n    /** Background color for the dot */\n    public readonly bg_color = this._details.bg_color || this.distance_color;\n\n    public overlay_ref: OverlayRef = null;\n    /** Time of the last update */\n    public get last_seen() {\n        return formatDistanceToNow((this._details.last_seen || 0) * 1000, {\n            addSuffix: true,\n        });\n    }\n\n    public y_pos: 'top' | 'bottom';\n\n    public x_pos: 'end' | 'start';\n    public get distance() {\n        return Math.abs(\n            differenceInMinutes(\n                (this._details.last_seen || 0) * 1000,\n                new Date()\n            )\n        );\n    }\n\n    public get distance_color() {\n        return this.distance < 10\n            ? '#43a047'\n            : this.distance < 20\n            ? '#ffb300'\n            : '#e53935';\n    }\n\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n    @ViewChild('dot') private _dot: ElementRef<HTMLDivElement>;\n\n    @HostListener('mouseenter') public onEnter = () => this.loadUser();\n    @HostListener('mouseleave') public onLeave = () => this.close();\n    @HostListener('click') public onClick = () => this.loadUser();\n    @HostListener('touchend') public onTouch = () => this.loadUser();\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: DeviceInfoData,\n        private _element: ElementRef<HTMLElement>,\n        private _overlay: Overlay\n    ) {}\n\n    public ngOnInit(tries: number = 0) {\n        if (tries > 10) return;\n        setTimeout(() => {\n            const parent = this._element.nativeElement.parentElement\n                ?.parentElement;\n            if (!parent) return this.ngOnInit(++tries);\n            const position = {\n                y: parseInt(parent.style.top, 10) / 100,\n                x: parseInt(parent.style.left, 10) / 100,\n            };\n            this.y_pos = position.y >= 0.5 ? 'bottom' : 'top';\n            this.x_pos = position.x >= 0.5 ? 'end' : 'start';\n        }, 200);\n    }\n\n    public async loadUser() {\n        this.open();\n        if (this.username) return;\n        const mod = getModule(this._details.system, 'LocationServices');\n        if (mod) {\n            this.username = 'Loading...';\n            const details = await mod\n                .execute('check_ownership_of', [this.mac])\n                .catch((_) => null);\n            this.username =\n                details && details.assigned_to ? details.assigned_to : '';\n        }\n    }\n\n    public open() {\n        if (this.overlay_ref) this.close();\n        if (!this._portal) return;\n        this.overlay_ref = this._overlay.create({\n            positionStrategy: this._overlay\n                .position()\n                .flexibleConnectedTo(this._dot)\n                .withPositions([\n                    {\n                        originX: this.x_pos === 'start' ? 'end' : 'start',\n                        originY: this.y_pos === 'top' ? 'bottom' : 'top',\n                        overlayX: this.x_pos || 'end',\n                        overlayY: this.y_pos || 'bottom',\n                    },\n                ]),\n        });\n        this.overlay_ref.attach(this._portal);\n    }\n\n    public close() {\n        if (this.overlay_ref) {\n            this.overlay_ref.dispose();\n            this.overlay_ref = null;\n        }\n    }\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\n\nimport { MAP_FEATURE_DATA } from '@placeos/components';\n\nexport interface DeskInfoData {\n    map_id: string;\n    user: string;\n    start?: number;\n    end?: number;\n    status: 'free' | 'busy' | 'pending' | 'reserved' | 'unknown' | '';\n}\n\n@Component({\n    selector: 'explore-desk-info',\n    template: `\n        <div\n            customTooltip\n            [content]=\"desk_tooltip\"\n            [backdrop]=\"false\"\n            [xPosition]=\"'center'\"\n            [yPosition]=\"'center'\"\n            [hover]=\"true\"\n            class=\"h-full w-full pointer-events-auto relative\"\n        ></div>\n        <ng-template #desk_tooltip>\n            <div\n                name=\"space-info\"\n                [id]=\"map_id\"\n                [class]=\"\n                    'absolute rounded bg-white p-4 top-0 left-0 shadow ' +\n                    x_pos +\n                    ' ' +\n                    y_pos\n                \"\n            >\n                <div class=\"arrow\"></div>\n                <div class=\"details\">\n                    <h4 map-id class=\"m-0 font-medium\">{{ map_id }}</h4>\n                    <p user class=\"mt-2 text-sm\" *ngIf=\"user\">{{ user }}</p>\n                    <p start class=\"mt-1 text-sm\" *ngIf=\"start\">\n                        {{ start | date: 'shortTime' }} &ndash;\n                        {{ end | date: 'shortTime' }}\n                    </p>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n\n            [name='space-info'] {\n                width: 16rem;\n            }\n\n            [name='status'] {\n                background-color: #43a047;\n                font-weight: 500;\n            }\n\n            [name='status'].busy {\n                background-color: #e53935;\n            }\n\n            [name='status'].pending {\n                background-color: #ffb300;\n            }\n\n            [name='status'].not-bookable {\n                background-color: #757575;\n            }\n        `,\n    ],\n})\nexport class ExploreDeskInfoComponent implements OnInit {\n    /** Space to display details for */\n    public readonly map_id = this._details.map_id;\n    public readonly user = this._details.user;\n    public readonly start = this._details.start;\n    public readonly end = this._details.end;\n\n    public y_pos: 'top' | 'bottom';\n\n    public x_pos: 'left' | 'right';\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: DeskInfoData,\n        private _element: ElementRef<HTMLElement>\n    ) {}\n\n    public ngOnInit(tries: number = 0) {\n        if (tries > 10) return;\n        setTimeout(() => {\n            const parent = this._element.nativeElement.parentElement\n                ?.parentElement;\n            if (!parent) return this.ngOnInit(++tries);\n            const position = {\n                y: parseInt(parent.style.top, 10) / 100,\n                x: parseInt(parent.style.left, 10) / 100,\n            };\n            this.y_pos = position.y >= 0.5 ? 'bottom' : 'top';\n            this.x_pos = position.x >= 0.5 ? 'right' : 'left';\n        }, 200);\n    }\n\n    public get available_until() {\n        return '';\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\n@Component({\n    selector: 'set-datetime-modal',\n    template: `\n        <header classs=\"flex items-center justify-between\">\n            <h2>Set date and time</h2>\n            <button mat-icon-button mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main *ngIf=\"form\" [formGroup]=\"form\" class=\"w-[24rem] pt-4\">\n            <div\n                class=\"flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto\"\n            >\n                <div class=\"flex flex-col flex-1 w-full sm:w-1/4\">\n                    <label>Date</label>\n                    <a-date-field [to]=\"book_until\" formControlName=\"date\">\n                        Date and time must be in the future\n                    </a-date-field>\n                </div>\n            </div>\n            <div\n                class=\"flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto\"\n            >\n                <div class=\"flex flex-col flex-1 w-full sm:w-1/3\">\n                    <label>Start Time</label>\n                    <a-time-field\n                        [ngModel]=\"form.value.date\"\n                        (ngModelChange)=\"form.patchValue({ date: $event })\"\n                        [ngModelOptions]=\"{ standalone: true }\"\n                    ></a-time-field>\n                </div>\n                <div class=\"flex flex-col flex-1 w-full sm:w-1/3\">\n                    <label>End Time</label>\n                    <a-duration-field\n                        formControlName=\"duration\"\n                        [time]=\"form.get('date')?.value\"\n                        [max]=\"12 * 60\"\n                        [min]=\"60\"\n                        [step]=\"60\"\n                    >\n                    </a-duration-field>\n                </div>\n            </div>\n        </main>\n        <footer class=\"w-full p-2 border-t border-gray-200 flex items-center justify-center\">\n            <button mat-button [mat-dialog-close]=\"form.value\" class=\"w-32\">Continue</button>\n        </footer>\n    `,\n    styles: [``],\n})\nexport class SetDatetimeModalComponent {\n    public form: FormGroup;\n\n    public readonly book_until = this._data.until\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: { date: number; duration: number, until: number }\n    ) {\n        this.form = new FormGroup({\n            date: new FormControl(_data.date),\n            duration: new FormControl(_data.duration),\n        });\n    }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { getModule, showMetadata } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { catchError, first, map, switchMap } from 'rxjs/operators';\nimport { addDays, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\nimport {\n    BaseClass,\n    currentUser,\n    HashMap,\n    notifySuccess,\n    SettingsService,\n} from '@placeos/common';\nimport { BookingFormService, queryBookings } from '@placeos/bookings';\nimport { StaffUser } from '@placeos/users';\nimport { Desk, OrganisationService } from '@placeos/organisation';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { DEFAULT_COLOURS } from './explore-spaces.service';\nimport { ExploreDeviceInfoComponent } from './explore-device-info.component';\nimport { ExploreDeskInfoComponent } from './explore-desk-info.component';\nimport { SetDatetimeModalComponent } from 'libs/explore/src/lib/set-datetime-modal.component';\nimport { MatDialog } from '@angular/material/dialog';\n\nexport interface DeskOptions {\n    enable_booking?: boolean;\n    date?: number | Date;\n    zones?: string[];\n    host?: StaffUser;\n}\nexport interface DesksStats {\n    free: number;\n    occupied: number;\n    total: number;\n}\n\n@Injectable()\nexport class ExploreDesksService extends BaseClass implements OnDestroy {\n    private _in_use = new BehaviorSubject<string[]>([]);\n    private _options = new BehaviorSubject<DeskOptions>({});\n    private _desks = new BehaviorSubject<string[]>([]);\n    private _reserved = new BehaviorSubject<string[]>([]);\n    private _statuses: HashMap<string> = {};\n    private _users: HashMap<string> = {};\n    private _poll = new BehaviorSubject<number>(0);\n\n    private _desk_bookings = combineLatest([\n        this._state.level,\n        this._poll,\n    ]).pipe(\n        switchMap(([lvl]) =>\n            queryBookings({\n                period_start: getUnixTime(startOfDay(new Date())),\n                period_end: getUnixTime(endOfDay(new Date())),\n                type: 'desk',\n                zones: lvl.id,\n            })\n        )\n    );\n\n    public readonly desk_list = this._state.level.pipe(\n        switchMap((lvl) =>\n            showMetadata(lvl.id, 'desks').pipe(\n                map((i) =>\n                    (i.details instanceof Array ? i.details : []).map(\n                        (j: HashMap) => new Desk({ ...j, zone: lvl as any })\n                    )\n                )\n            )\n        ),\n        catchError((e) => [])\n    );\n\n    private _bind = this._state.level.pipe(\n        map((lvl) => {\n            this._statuses = {};\n            this.unsubWith('lvl');\n            if (!lvl) return;\n            const building = this._org.buildings.find(\n                (bld) => bld.id === lvl.parent_id\n            );\n            if (!building) return;\n            const system_id =\n                building.bindings?.area_management ||\n                this._org.organisation.bindings?.area_management;\n            if (!system_id) return;\n            let binding = getModule(system_id, 'AreaManagement').binding(\n                lvl.id\n            );\n            this.subscription(\n                `lvl-in_use`,\n                binding\n                    .listen()\n                    .subscribe((d) =>\n                        this.processBindingChange(d || {}, system_id)\n                    )\n            );\n            this.subscription('lvl-in_use_bind', binding.bind());\n            binding = getModule(system_id, 'AreaManagement').binding(\n                `${lvl.id}:desk_ids`\n            );\n            this.subscription(\n                `lvl-desks_list`,\n                binding.listen().subscribe((d) => this._desks.next(d || []))\n            );\n            this.subscription('lvl-desk_list_bind', binding.bind());\n        })\n    );\n\n    private _state_change = combineLatest([\n        this.desk_list,\n        this._in_use,\n        this._reserved,\n        this._options,\n    ]).pipe(\n        // debounceTime(50),\n        map(([desks, in_use, reserved]) => {\n            this._statuses = {};\n            for (const { id, bookable } of desks) {\n                const is_used = in_use.some((i) => id === i);\n                const is_reserved = reserved.some((i) => id === i);\n                this._statuses[id] = bookable\n                    ? !is_used\n                        ? 'free'\n                        : is_reserved\n                        ? 'reserved'\n                        : 'busy'\n                    : 'not-bookable';\n            }\n            this.processDesks(desks);\n        })\n    );\n\n    constructor(\n        private _state: ExploreStateService,\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        private _bookings: BookingFormService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.setOptions({\n            enable_booking: this._settings.get('app.desks.enabled') !== false,\n        });\n        this.subscription('bind', this._bind.subscribe());\n        this.subscription('changes', this._state_change.subscribe());\n        this.subscription(\n            'desks',\n            this.desk_list.subscribe((desks) => this.processDesks(desks))\n        );\n    }\n\n    public startPolling(delay: number = 30 * 1000) {\n        this.subscription(\n            'desks_in_use_bookings',\n            this._desk_bookings.subscribe((_) =>\n                this._in_use.next(_.map((i) => i.asset_id))\n            )\n        );\n        this.interval(\n            'poll',\n            () => this._poll.next(new Date().valueOf()),\n            delay\n        );\n    }\n\n    public stopPolling() {\n        this.clearInterval('poll');\n    }\n\n    public setOptions(options: DeskOptions) {\n        this._options.next({ ...this._options.getValue(), ...options });\n    }\n\n    public processBindingChange(\n        { value }: { value: any[] },\n        system_id: string\n    ) {\n        const devices = (value || []).filter(\n            (v) => !['desk', 'booking'].includes(v.location)\n        );\n        const desks = (value || []).filter(\n            (v) =>\n                v.location === 'desk' ||\n                (v.location === 'booking' && v.type === 'desk')\n        );\n        this._in_use.next(desks.map((v) => v.map_id || v.asset_id));\n        this._reserved.next(\n            desks\n                .filter((v) => !v.at_location)\n                .map((v) => v.map_id || v.asset_id)\n        );\n        this.processDevices(devices, system_id);\n        this.timeout('update', () => this.updateStatus(), 100);\n    }\n\n    private updateStatus() {\n        const style_map = {};\n        const colours = this._settings.get('app.explore.colors') || {};\n        for (const desk_id in this._statuses) {\n            if (!this._statuses[desk_id]) continue;\n            style_map[`#${desk_id}`] = {\n                fill:\n                    colours[`desk-${this._statuses[desk_id]}`] ||\n                    colours[`${this._statuses[desk_id]}`] ||\n                    DEFAULT_COLOURS[`${this._statuses[desk_id]}`],\n                opacity: 0.6,\n            };\n        }\n        this._state.setStyles('desks', style_map);\n    }\n\n    private processDevices(devices: HashMap[], system_id: string) {\n        const list = [];\n        for (const device of devices) {\n            const x = device.x / device.map_width;\n            const y = device.y / device.map_height;\n            list.push({\n                location: {\n                    x: device.coordinates_from?.includes('right') ? 1 - x : x,\n                    y: device.coordinates_from?.includes('bottom') ? 1 - y : y,\n                },\n                content: ExploreDeviceInfoComponent,\n                data: { ...device, system: system_id },\n            });\n        }\n        this._state.setFeatures('devices', list);\n    }\n\n    private processDesks(desks: HashMap[]) {\n        const list = [];\n        const actions = [];\n        const options = this._options.getValue();\n        for (const desk of desks) {\n            list.push({\n                location: desk.id,\n                content: ExploreDeskInfoComponent,\n                full_size: true,\n                data: {\n                    map_id: desk.name,\n                    user: this._users[desk.map_id] || desk.staff_name,\n                    status: this._statuses[desk.map_id],\n                },\n                z_index: 20,\n            });\n            if (!desk.bookable) continue;\n            const book_fn = async () => {\n                this._bookings.newForm();\n                const { date, duration } = await this._setBookingTime(\n                    this._bookings.form.value.date,\n                    this._bookings.form.value.duration\n                );\n                this._bookings.form.patchValue({\n                    asset_id: desk.id,\n                    asset_name: desk.name,\n                    date,\n                    duration,\n                    map_id: desk?.map_id || desk?.id,\n                    description: desk.name,\n                    user: options.host || currentUser(),\n                    booking_type: 'desk',\n                    zones: desk.zone\n                        ? [desk.zone?.parent_id, desk.zone?.id]\n                        : [],\n                });\n                await this._bookings.confirmPost();\n                notifySuccess(\n                    `Successfull booked desk ${desk.name || desk.id}`\n                );\n            };\n            actions.push({\n                id: desk.id,\n                action: 'click',\n                callback: book_fn,\n            });\n            actions.push({\n                id: desk.id,\n                action: 'touchend',\n                callback: book_fn,\n            });\n        }\n        this._state.setActions(\n            'desks',\n            this._options.getValue().enable_booking ? actions : []\n        );\n        this._state.setFeatures('desks', list);\n        this.timeout('update', () => this.updateStatus(), 100);\n    }\n\n    private async _setBookingTime(date: number, duration: number) {\n        if (!!this._settings.get('app.desks.allow_time_changes')) {\n            const until = endOfDay(\n                addDays(\n                    Date.now(),\n                    this._settings.get('app.desks.available_period') || 90\n                )\n            );\n            const ref = this._dialog.open(SetDatetimeModalComponent, {\n                data: { date, duration, until },\n            });\n            const details = await ref.afterClosed().toPromise();\n            if (!details) throw 'User cancelled';\n            date = details.date;\n            duration = details.duration;\n        }\n        return { date, duration };\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { ComponentsModule } from '@placeos/components';\n\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { OverlayModule } from '@angular/cdk/overlay';\nimport { PortalModule } from '@angular/cdk/portal';\n\nimport { FormFieldsModule } from '@placeos/form-fields';\n\nimport { ExploreMapControlComponent } from './explore-map-control.component';\nimport { ExploreMapViewComponent } from './explore-map-view.component';\nimport { ExploreSearchComponent } from './explore-search.component';\nimport { ExploreSpaceInfoComponent } from './explore-space-info.component';\nimport { ExploreZoomControlComponent } from './explore-zoom-control.component';\nimport { ExploreDeviceInfoComponent } from './explore-device-info.component';\nimport { ExploreBookingModalComponent } from './explore-booking-modal.component';\nimport { ExploreDeskInfoComponent } from './explore-desk-info.component';\nimport { SetDatetimeModalComponent } from './set-datetime-modal.component';\n\nconst COMPONENTS: Type<any>[] = [\n    ExploreMapControlComponent,\n    ExploreMapViewComponent,\n    ExploreSearchComponent,\n    ExploreSpaceInfoComponent,\n    ExploreDeviceInfoComponent,\n    ExploreDeskInfoComponent,\n    ExploreZoomControlComponent,\n    ExploreBookingModalComponent,\n    SetDatetimeModalComponent\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        ComponentsModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatSlideToggleModule,\n        OverlayModule,\n        PortalModule,\n        FormFieldsModule\n    ],\n    exports: [...COMPONENTS],\n})\nexport class SharedExploreModule {}\n","import { Injectable } from '@angular/core';\nimport {\n    Point,\n    ViewAction,\n    ViewerFeature,\n    ViewerLabel,\n    ViewerStyles,\n} from '@placeos/svg-viewer';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { debounceTime, filter, first, map } from 'rxjs/operators';\n\nimport { BaseClass, HashMap, SettingsService, unique } from '@placeos/common';\nimport { BuildingLevel, OrganisationService } from '@placeos/organisation';\nimport { SpacesService } from '@placeos/spaces';\n\nexport interface MapOptions {\n    /** List of keys to ignore for any map resource */\n    disable?: string[];\n    /** List of keys to ignore for map labels */\n    disable_labels?: string[];\n    /** List of keys to ignore for map actions */\n    disable_actions?: string[];\n    /** List of keys to ignore for map features */\n    disable_features?: string[];\n    /** List of keys to ignore for map styles */\n    disable_styles?: string[];\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class ExploreStateService extends BaseClass {\n    /** Currently active level */\n    private _level = new BehaviorSubject<BuildingLevel>(null);\n    /** Currently active level */\n    private _positions = new BehaviorSubject<{ zoom: number; center: Point }>({\n        zoom: 1,\n        center: { x: 0.5, y: 0.5 },\n    });\n    /** Mapping of groups to their styles */\n    private _styles = new BehaviorSubject<HashMap<ViewerStyles>>({});\n    /** Mapping of groups to their features */\n    private _features = new BehaviorSubject<HashMap<ViewerFeature[]>>({});\n    /** Mapping of groups to their actions */\n    private _actions = new BehaviorSubject<HashMap<ViewAction[]>>({});\n    /** Mapping of groups to their actions */\n    private _labels = new BehaviorSubject<HashMap<ViewerLabel[]>>({});\n\n    private _options = new BehaviorSubject<MapOptions>({\n        disable: ['zones', 'devices'],\n    });\n\n    private _message = new BehaviorSubject<string>('');\n\n    /** Currently active level */\n    public readonly level = this._level.asObservable();\n    /** Currently active level */\n    public readonly message = this._message.asObservable();\n    /** Spaces associated with the active level */\n    public readonly spaces = combineLatest([\n        this._level,\n        this._spaces.list,\n    ]).pipe(\n        map(([level, spaces]) =>\n            spaces.filter((space) => space.zones.includes(level?.id))\n        )\n    );\n    /** Currently shown space's map URL */\n    public readonly map_url = this._level.pipe(\n        map((lvl) => (lvl ? lvl.map_id : '') || '')\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_positions = this._positions.asObservable();\n    /** Currently center and zoom positions for map */\n    public readonly map_features = combineLatest([\n        this._features,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([features, options]) => {\n            let list = [];\n            for (const key in features) {\n                if (\n                    options.disable?.includes(key) ||\n                    options.disable_features?.includes(key)\n                )\n                    continue;\n                list = list.concat(features[key]);\n            }\n            return list;\n        })\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_actions = combineLatest([\n        this._actions,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([actions, options]) => {\n            let list = [];\n            for (const key in actions) {\n                if (\n                    options.disable?.includes(key) ||\n                    options.disable_actions?.includes(key)\n                )\n                    continue;\n                list = list.concat(actions[key]);\n            }\n            return list;\n        })\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_labels = combineLatest([\n        this._labels,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([labels, options]) => {\n            let list = [];\n            for (const key in labels) {\n                if (\n                    options.disable?.includes(key) ||\n                    options.disable_labels?.includes(key)\n                )\n                    continue;\n                list = list.concat(labels[key]);\n            }\n            return list;\n        })\n    );\n    /** Current map styles */\n    public readonly map_styles = combineLatest([\n        this._styles,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([styles, options]) => {\n            let style_mappings = { text: { display: 'none' } };\n            for (const key in styles) {\n                if (\n                    options.disable?.includes(key) ||\n                    options.disable_styles?.includes(key)\n                )\n                    continue;\n                style_mappings = { ...style_mappings, ...styles[key] };\n            }\n            if (options.disable?.includes('zones')) {\n                style_mappings['#zones'] = { display: 'none' };\n                style_mappings['#Zones'] = { display: 'none' };\n            }\n            return style_mappings;\n        })\n    );\n\n    public readonly options = this._options.asObservable();\n\n    public get positions() {\n        return this._positions.getValue();\n    }\n\n    public get active_level() {\n        return this._level.getValue();\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _spaces: SpacesService,\n        private _settings: SettingsService\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this._org.active_building.pipe(filter((_) => !!_)).subscribe((bld) => {\n            const level = this._level.getValue();\n            const level_list = this._org.levelsForBuilding(bld);\n            const has_level = level_list.find((lvl) => level?.id === lvl.id);\n            if (!has_level && level_list.length) {\n                this.setLevel(level_list[0].id);\n            }\n            if (this._settings.get('app.explore.disable_actions')) {\n                this.setOptions({\n                    disable_actions: this._settings.get(\n                        'app.explore.disable_actions'\n                    ),\n                });\n            }\n            if (this._settings.get('app.explore.disable_labels')) {\n                this.setOptions({\n                    disable_labels: this._settings.get(\n                        'app.explore.disable_labels'\n                    ),\n                });\n            }\n            if (this._settings.get('app.explore.disable_features')) {\n                this.setOptions({\n                    disable_features: this._settings.get(\n                        'app.explore.disable_features'\n                    ),\n                });\n            }\n            if (this._settings.get('app.explore.disable_styles')) {\n                this.setOptions({\n                    disable_styles: this._settings.get(\n                        'app.explore.disable_styles'\n                    ),\n                });\n            }\n        });\n    }\n\n    public setOptions(options: MapOptions) {\n        const old_options = this._options.getValue();\n        const disable = unique([\n            ...(options.disable || old_options.disable),\n            ...(this._settings.get('app.explore.disable') || []),\n        ]);\n        this._options.next({\n            ...this._options.getValue(),\n            ...options,\n            disable,\n        });\n    }\n\n    public setLevel(zone_id: string) {\n        const lvl = this._org.levelWithID([zone_id]);\n        if (lvl) {\n            this._level.next(lvl);\n        }\n    }\n\n    public setStyles(name: string, styles: ViewerStyles) {\n        const style_map = this._styles.getValue();\n        style_map[name] = styles;\n        this._styles.next(style_map);\n    }\n\n    public setFeatures(name: string, features: ViewerFeature[]) {\n        const feature_map = this._features.getValue();\n        feature_map[name] = features;\n        this._features.next(feature_map);\n    }\n\n    public setActions(name: string, actions: ViewAction[]) {\n        const actions_map = this._actions.getValue();\n        actions_map[name] = actions;\n        this._actions.next(actions_map);\n    }\n\n    public setLabels(name: string, labels: ViewerLabel[]) {\n        const labels_map = this._labels.getValue();\n        labels_map[name] = labels;\n        this._labels.next(labels_map);\n    }\n\n    public setPositions(zoom: number, center: Point) {\n        this._positions.next({ zoom, center });\n    }\n}\n","import { Component } from '@angular/core';\nimport { ExploreStateService } from './explore-state.service';\n\n@Component({\n    selector: `explore-zoom-controls`,\n    template: `\n        <button z-in mat-icon-button class=\"bg-white\" (click)=\"zoomIn()\">\n            <app-icon>add</app-icon>\n        </button>\n        <button z-out mat-icon-button class=\"bg-white\" (click)=\"zoomOut()\">\n            <app-icon>remove</app-icon>\n        </button>\n        <button reset mat-icon-button class=\"bg-white\" (click)=\"reset()\">\n            <app-icon>autorenew</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                padding: 0.5rem;\n            }\n\n            button {\n                border: 1px solid #ccc;\n                border-radius: 0;\n            }\n\n            button:first-child {\n                border-radius: 0.25rem 0.25rem 0 0;\n                border-bottom: none;\n            }\n\n            button:last-child {\n                border-radius: 0 0 0.25rem 0.25rem;\n                border-top: none;\n            }\n        `,\n    ],\n})\nexport class ExploreZoomControlComponent {\n    public readonly zoomIn = () =>\n        this._state.setPositions(\n            Math.min(10, this._state.positions.zoom * 1.2),\n            this._state.positions.center\n        );\n    public readonly zoomOut = () =>\n        this._state.setPositions(\n            Math.max(1, this._state.positions.zoom * (1 / 1.2)),\n            this._state.positions.center\n        );\n    public readonly reset = () =>\n        this._state.setPositions(1, { x: 0.5, y: 0.5 });\n\n    constructor(private _state: ExploreStateService) {}\n}\n"],"sourceRoot":"webpack:///"}