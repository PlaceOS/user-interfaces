{"version":3,"file":"default-libs_users_src_index_ts.js","mappings":"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","names":["USER_LIST","EMPTY_USER","User","UserPipe","transform","user_id","user","find","id","email","showStaff","toPromise","showGuest","push","pure","i0","WFH_SETTING_KEY","WFHSettingsModalComponent","constructor","_settings","_dialog_ref","this","name","options","Booking","type","asset_id","ngOnInit","settings","get","_initWeekdays","_loadOptionForToday","currentUser","saveChanges","_this","loading","disableClose","option","_booking","saveBooking","catch","e","saveUserSetting","close","day","Date","weekdays","available_weekdays","map","_","setDay","dirtyDate","dirtyDay","_ref","_ref2","_ref3","_options$weekStartsOn","_options$locale","_options$locale$optio","_defaultOptions$local","_defaultOptions$local2","requiredArgs","arguments","defaultOptions","getDefaultOptions","weekStartsOn","toInteger","locale","RangeError","date","toDate","currentDay","getDay","delta","addDays","valueOf","list","queryBookings","period_start","getUnixTime","startOfDay","now","period_end","endOfDay","length","_this2","core","selectors","fromUnixTime","dirtyUnixTime","unixTime","FindAvailabilityModalComponent","AsyncHandler","today","isSameDay","current_hour","getHours","selection_left","getMinutes","selection_width","duration","_data","_renderer","super","BehaviorSubject","host","Array","fill","users","pipe","debounceTime","switchMap","queryUserFreeBusy","calendars","join","catchError","of","availability_list","availability_map","item","availability","filter","status","block","starts_at","differenceInMinutes","ends_at","console","log","start","size","defaultIfEmpty","shareReplay","next","addUser","getValue","u","removeUser","closeAndUpdate","ngAfterViewInit","timeout","el","_container_el","nativeElement","querySelector","rect","getBoundingClientRect","el_rect","scrollTo","left","updateWidth","updateScroll","container_size","width","user_list_size","Math","floor","_move_size","offset","scrollLeft","startMovePeriod","event","preventDefault","stopPropagation","_move_last","MouseEvent","clientX","touches","move_time","_start_time","subscription","listen","_onMovePeriod","_onMoveEnd","startMoveDuration","_onMoveDuration","change_px","change_min","abs","old_date","addMinutes","max","unsub","MAT_DIALOG_DATA","ctx","UserAvailabilityComponent","SharedUsersModule","CommonModule","FormsModule","ReactiveFormsModule","MatDialogModule","FormFieldsModule","ComponentsModule","MatCheckboxModule","MatProgressSpinnerModule","MatMenuModule","MapLocation","location","position","map_id","x","map_width","y","map_height","variance","last_seen","level","building","at_location","coordinates_from"],"sourceRoot":"webpack:///","sources":["./libs/users/src/lib/user.pipe.ts","./libs/users/src/lib/wfh-settings-modal.component.ts","./node_modules/date-fns/esm/setDay/index.js","./node_modules/date-fns/esm/fromUnixTime/index.js","./libs/users/src/lib/find-availability-modal/find-availability-modal.component.ts","./libs/users/src/lib/find-availability-modal/user-availability.component.ts","./libs/users/src/lib/users.module.ts","./libs/users/src/lib/location.class.ts"],"sourcesContent":["import { Pipe } from \"@angular/core\";\nimport { showGuest } from \"./guests.fn\";\nimport { showStaff } from \"./staff.fn\";\nimport { User } from \"./user.class\";\n\nconst USER_LIST: User[] = [];\n\nconst EMPTY_USER = new User();\n\n@Pipe({\n    name: 'user'\n})\nexport class UserPipe {\n    /**\n     * Get details of the user with the given ID\n     * @param user_id ID or Email of the user\n     */\n    public async transform(user_id: string): Promise<User> {\n        if (!user_id) return EMPTY_USER;\n        let user = USER_LIST.find(({ id, email }) => id === user_id || email === user_id);\n        if (user) return user;\n        user = await showStaff(user_id).toPromise();\n        if (user) {\n            USER_LIST.push(user);\n            return user;\n        }\n        user = await showGuest(user_id).toPromise();\n        if (user) {\n            USER_LIST.push(user);\n            return user;\n        }\n        return EMPTY_USER;\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\nimport { currentUser, SettingsService } from '@placeos/common';\nimport { endOfDay, getUnixTime, setDay, startOfDay } from 'date-fns';\nimport { Booking } from 'libs/bookings/src/lib/booking.class';\nimport { queryBookings, saveBooking } from 'libs/bookings/src/lib/bookings.fn';\n\nconst WFH_SETTING_KEY = 'wfh-days';\n\n@Component({\n    selector: `wfh-settings-modal`,\n    template: `\n        <div\n            class=\"relative flex flex-col rounded overflow-hidden w-[18rem]\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <div\n                class=\"w-full px-4 py-8 flex flex-col items-center border-b border-gray-200\"\n            >\n                <a-user-avatar [user]=\"user\"></a-user-avatar>\n                <div>{{ user.name }}</div>\n                <div class=\"text-xs opacity-30\">{{ user.email }}</div>\n                <div class=\"text-xs opacity-30\">{{ user.phone }}</div>\n            </div>\n            <div class=\"w-full p-4 flex flex-col  border-b border-gray-200\">\n                <h3 class=\"-mt-2 mb-2 text-sm font-medium\">\n                    Today's Working Location\n                </h3>\n                <button\n                    btn\n                    matRipple\n                    today-location\n                    class=\"inverse rounded-3xl w-auto\"\n                    [matMenuTriggerFor]=\"menu\"\n                >\n                    <div class=\"flex items-center justify-between w-full\">\n                        <div class=\"uppercase flex-1 w-1/2\">{{ option }}</div>\n                        <app-icon class=\"text-2xl\">arrow_drop_down</app-icon>\n                    </div>\n                </button>\n                <div class=\"flex items-center pt-4 space-x-2\">\n                    <div\n                        class=\"h-8 w-8 rounded-full bg-gray-300 dark:bg-neutral-800 flex items-center justify-center\"\n                    >\n                        <app-icon>home</app-icon>\n                    </div>\n                    <div class=\"flex-1 w-1/2 text-sm\">\n                        Today is a working from home day. Available for online\n                        meetings.\n                    </div>\n                </div>\n            </div>\n            <div class=\"w-full p-4 flex flex-col\">\n                <h3 class=\"-mt-2 mb-2 text-sm font-medium\">\n                    Default Office Days\n                </h3>\n                <div\n                    class=\"border border-gray-200 rounded flex items-center justify-between px-2 pt-2\"\n                >\n                    <div\n                        class=\"flex flex-col items-center flex-1 w-px\"\n                        *ngFor=\"let day of weekdays; let i = index\"\n                    >\n                        <div class=\"text-sm font-light\">\n                            {{ day | date: 'EEE' }}\n                        </div>\n                        <div class=\"h-8 w-8 flex items-center justify-center\">\n                            <mat-checkbox\n                                [(ngModel)]=\"settings[available_weekdays[i]]\"\n                                (ngModelChange)=\"changed = true\"\n                            ></mat-checkbox>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"flex items-center justify-end px-4 pb-4\">\n                <button\n                    btn\n                    matRipple\n                    save\n                    [disabled]=\"!changed\"\n                    (click)=\"saveChanges()\"\n                >\n                    Update\n                </button>\n            </div>\n            <button\n                icon\n                matRipple\n                mat-dialog-close\n                class=\"absolute top-0 left-0\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n        <mat-menu #menu=\"matMenu\">\n            <button\n                mat-menu-item\n                *ngFor=\"let type of options\"\n                [attr.id]=\"type.id\"\n                (click)=\"option = type.id; changed = true\"\n            >\n                {{ type.name }}\n            </button>\n        </mat-menu>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"relative bg-white flex flex-col justify-center items-center rounded overflow-hidden w-[18rem] h-[18rem]\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>Saving changes to work location settings...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class WFHSettingsModalComponent implements OnInit {\n    public readonly options = [\n        { id: 'wfo', name: 'Work from office (WFO)' },\n        { id: 'wfh', name: 'Work from home (WFH)' },\n        { id: 'aol', name: 'Away on Leave (AOL)' },\n    ];\n    public option = this.options[0].id;\n    public settings = [true, true, true, true, true, true, true];\n    public weekdays = [];\n    public changed = false;\n    public loading = false;\n    public readonly available_weekdays = [1, 2, 3, 4, 5];\n\n    private _booking: Booking = new Booking({\n        type: 'wfh-settings',\n        asset_id: this.options[0].id,\n    });\n\n    constructor(\n        private _settings: SettingsService,\n        private _dialog_ref: MatDialogRef<WFHSettingsModalComponent>\n    ) {}\n\n    public ngOnInit() {\n        this.settings = this._settings.get(WFH_SETTING_KEY) || [\n            true,\n            true,\n            true,\n            true,\n            true,\n            true,\n            true,\n        ];\n        this._initWeekdays();\n        this._loadOptionForToday();\n    }\n\n    public get user() {\n        return currentUser();\n    }\n\n    public async saveChanges() {\n        this.loading = true;\n        this._dialog_ref.disableClose = true;\n        if (\n            this.option !== this.options[0].id &&\n            this.option !== this._booking.asset_id\n        ) {\n            await saveBooking(\n                new Booking({ ...this._booking, asset_id: this.option })\n            )\n                .toPromise()\n                .catch((e) => {\n                    this._dialog_ref.disableClose = false;\n                    this.loading = false;\n                    throw e;\n                });\n        }\n        this._settings.saveUserSetting(WFH_SETTING_KEY, this.settings);\n        this.loading = false;\n        this._dialog_ref.close();\n    }\n\n    private _initWeekdays() {\n        let day = new Date();\n        this.weekdays = this.available_weekdays.map((_) =>\n            setDay(day, _).valueOf()\n        );\n    }\n\n    private async _loadOptionForToday() {\n        const list = await queryBookings({\n            type: 'wfh-setting',\n            period_start: getUnixTime(startOfDay(Date.now())),\n            period_end: getUnixTime(endOfDay(Date.now())),\n        }).toPromise();\n        if (list.length) {\n            this.option = list[0].asset_id;\n            this._booking = list[0];\n        }\n    }\n}\n","import addDays from \"../addDays/index.js\";\nimport toDate from \"../toDate/index.js\";\nimport toInteger from \"../_lib/toInteger/index.js\";\nimport requiredArgs from \"../_lib/requiredArgs/index.js\";\nimport { getDefaultOptions } from \"../_lib/defaultOptions/index.js\";\n/**\n * @name setDay\n * @category Weekday Helpers\n * @summary Set the day of the week to the given date.\n *\n * @description\n * Set the day of the week to the given date.\n *\n * @param {Date|Number} date - the date to be changed\n * @param {Number} day - the day of the week of the new date\n * @param {Object} [options] - an object with options.\n * @param {Locale} [options.locale=defaultLocale] - the locale object. See [Locale]{@link https://date-fns.org/docs/Locale}\n * @param {0|1|2|3|4|5|6} [options.weekStartsOn=0] - the index of the first day of the week (0 - Sunday)\n * @returns {Date} the new date with the day of the week set\n * @throws {TypeError} 2 arguments required\n * @throws {RangeError} `options.weekStartsOn` must be between 0 and 6\n *\n * @example\n * // Set week day to Sunday, with the default weekStartsOn of Sunday:\n * const result = setDay(new Date(2014, 8, 1), 0)\n * //=> Sun Aug 31 2014 00:00:00\n *\n * @example\n * // Set week day to Sunday, with a weekStartsOn of Monday:\n * const result = setDay(new Date(2014, 8, 1), 0, { weekStartsOn: 1 })\n * //=> Sun Sep 07 2014 00:00:00\n */\n\nexport default function setDay(dirtyDate, dirtyDay, options) {\n  var _ref, _ref2, _ref3, _options$weekStartsOn, _options$locale, _options$locale$optio, _defaultOptions$local, _defaultOptions$local2;\n\n  requiredArgs(2, arguments);\n  var defaultOptions = getDefaultOptions();\n  var weekStartsOn = toInteger((_ref = (_ref2 = (_ref3 = (_options$weekStartsOn = options === null || options === void 0 ? void 0 : options.weekStartsOn) !== null && _options$weekStartsOn !== void 0 ? _options$weekStartsOn : options === null || options === void 0 ? void 0 : (_options$locale = options.locale) === null || _options$locale === void 0 ? void 0 : (_options$locale$optio = _options$locale.options) === null || _options$locale$optio === void 0 ? void 0 : _options$locale$optio.weekStartsOn) !== null && _ref3 !== void 0 ? _ref3 : defaultOptions.weekStartsOn) !== null && _ref2 !== void 0 ? _ref2 : (_defaultOptions$local = defaultOptions.locale) === null || _defaultOptions$local === void 0 ? void 0 : (_defaultOptions$local2 = _defaultOptions$local.options) === null || _defaultOptions$local2 === void 0 ? void 0 : _defaultOptions$local2.weekStartsOn) !== null && _ref !== void 0 ? _ref : 0); // Test if weekStartsOn is between 0 and 6 _and_ is not NaN\n\n  if (!(weekStartsOn >= 0 && weekStartsOn <= 6)) {\n    throw new RangeError('weekStartsOn must be between 0 and 6 inclusively');\n  }\n\n  var date = toDate(dirtyDate);\n  var day = toInteger(dirtyDay);\n  var currentDay = date.getDay();\n  var remainder = day % 7;\n  var dayIndex = (remainder + 7) % 7;\n  var delta = 7 - weekStartsOn;\n  var diff = day < 0 || day > 6 ? day - (currentDay + delta) % 7 : (dayIndex + delta) % 7 - (currentDay + delta) % 7;\n  return addDays(date, diff);\n}","import toDate from \"../toDate/index.js\";\nimport toInteger from \"../_lib/toInteger/index.js\";\nimport requiredArgs from \"../_lib/requiredArgs/index.js\";\n/**\n * @name fromUnixTime\n * @category Timestamp Helpers\n * @summary Create a date from a Unix timestamp.\n *\n * @description\n * Create a date from a Unix timestamp (in seconds). Decimal values will be discarded.\n *\n * @param {Number} unixTime - the given Unix timestamp (in seconds)\n * @returns {Date} the date\n * @throws {TypeError} 1 argument required\n *\n * @example\n * // Create the date 29 February 2012 11:45:05:\n * const result = fromUnixTime(1330515905)\n * //=> Wed Feb 29 2012 11:45:05\n */\n\nexport default function fromUnixTime(dirtyUnixTime) {\n  requiredArgs(1, arguments);\n  var unixTime = toInteger(dirtyUnixTime);\n  return toDate(unixTime * 1000);\n}","import {\n    Component,\n    ElementRef,\n    Inject,\n    Renderer2,\n    ViewChild,\n} from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { AsyncHandler } from '@placeos/common';\nimport {\n    addMinutes,\n    differenceInMinutes,\n    endOfDay,\n    fromUnixTime,\n    getUnixTime,\n    isSameDay,\n    startOfDay,\n} from 'date-fns';\nimport { queryUserFreeBusy } from 'libs/calendar/src/lib/calendar.fn';\nimport { BehaviorSubject, of } from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    defaultIfEmpty,\n    map,\n    shareReplay,\n    switchMap,\n} from 'rxjs/operators';\nimport { User } from '../user.class';\nimport { AvailabilityBlock } from './user-availability.component';\n\nexport interface FindAvailabilityData {\n    host: User;\n    users: User[];\n    date: number;\n    duration: number;\n}\n\n@Component({\n    selector: 'find-availability-modal',\n    template: `\n        <header class=\"relative flex items-center justify-center p-4\">\n            <h2 class=\"text-center\">Find Availability</h2>\n            <button\n                icon\n                matRipple\n                mat-dialog-close\n                class=\"absolute top-1/2 left-1 -translate-y-1/2\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"flex flex-col h-[calc(100vh-7rem)] sm:h-[65vh]\"\n            (window:resize)=\"updateWidth()\"\n        >\n            <div\n                class=\"w-full flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 p-2\"\n            >\n                <a-date-field\n                    [(ngModel)]=\"date\"\n                    class=\"max-h-[3.25rem] flex-1\"\n                ></a-date-field>\n                <a-user-search-field\n                    [(ngModel)]=\"user\"\n                    (ngModelChange)=\"addUser($event)\"\n                    class=\"max-h-[3.25rem] flex-1\"\n                ></a-user-search-field>\n            </div>\n            <div\n                #container\n                class=\"flex flex-1 h-1/2 w-full border-t border-gray-300 dark:border-neutral-500 relative overflow-auto divide-x divide-gray-300 dark:divide-neutral-500 max-w-[100vw] sm:max-w-[80vw]\"\n                (scroll)=\"updateScroll()\"\n            >\n                <div\n                    users\n                    class=\"sticky left-0 min-h-full bg-white dark:bg-neutral-700 border-r border-gray-300 dark:border-neutral-500 z-30\"\n                >\n                    <div\n                        header\n                        class=\"h-10 w-[6rem] border-b border-gray-300 dark:border-neutral-500\"\n                    ></div>\n                    <div\n                        host\n                        class=\"flex flex-col items-center justify-center h-32 w-[6rem] relative border-b border-gray-300 dark:border-neutral-500 py-2\"\n                    >\n                        <a-user-avatar\n                            class=\"text-2xl\"\n                            [user]=\"host\"\n                        ></a-user-avatar>\n                        <div\n                            class=\"text-xs break-words overflow-hidden max-w-full px-2 text-center\"\n                        >\n                            {{ host.name || host.email }}\n                        </div>\n                        <user-availability-list\n                            class=\"absolute top-0 -bottom-px left-full pointer-events-none\"\n                            [user]=\"host\"\n                            [date]=\"date\"\n                            [offset]=\"offset\"\n                            [availability]=\"\n                                (availability | async)\n                                    ? (availability | async)[host.email]\n                                    : []\n                            \"\n                            [width]=\"width\"\n                        ></user-availability-list>\n                    </div>\n                    <div\n                        person\n                        class=\"flex flex-col items-center justify-center h-32 w-[6rem] relative border-b border-gray-300 dark:border-neutral-500 py-2\"\n                        *ngFor=\"let user of users | async\"\n                    >\n                        <a-user-avatar\n                            class=\"text-2xl\"\n                            [user]=\"user\"\n                        ></a-user-avatar>\n                        <div\n                            class=\"text-xs break-words max-w-full px-2 text-center\"\n                        >\n                            {{ user.name || host.email }}\n                        </div>\n                        <button\n                            icon\n                            class=\"absolute -top-1 -left-1\"\n                            (click)=\"removeUser(user)\"\n                        >\n                            <app-icon>close</app-icon>\n                        </button>\n                        <user-availability-list\n                            class=\"absolute top-0 -bottom-px left-full pointer-events-none\"\n                            [user]=\"user\"\n                            [availability]=\"\n                                (availability | async)\n                                    ? (availability | async)[user.email]\n                                    : []\n                            \"\n                            [date]=\"date\"\n                            [offset]=\"offset\"\n                            [width]=\"width\"\n                        ></user-availability-list>\n                    </div>\n                </div>\n                <div\n                    [attr.hour]=\"i\"\n                    class=\"min-w-[5rem] bg-gray-50 dark:bg-neutral-600 min-h-full pointer-events-none\"\n                    [attr.disabled]=\"today && i < current_hour\"\n                    *ngFor=\"let h of hours; let i = index\"\n                >\n                    <div\n                        header\n                        class=\"h-10 border-b border-gray-300 dark:border-neutral-500 p-2\"\n                    >\n                        {{ i % 12 ? i % 12 : '12' }}{{ i >= 12 ? 'pm' : 'am' }}\n                    </div>\n                </div>\n                <div\n                    selection\n                    class=\"absolute top-10 bottom-0 !border-x-2 !border-blue-500 bg-blue-500/30 z-20 cursor-grab active:cursor-grabbing\"\n                    [style.left]=\"selection_left + 'rem'\"\n                    [style.width]=\"selection_width + 'rem'\"\n                    (mousedown)=\"startMovePeriod($event)\"\n                    (touchstart)=\"startMovePeriod($event)\"\n                >\n                    <div\n                        handle\n                        class=\"absolute top-1/2 -left-px -translate-x-1/2 -translate-y-1/2 h-3 w-3 rounded-full bg-blue-500\"\n                    ></div>\n                    <div\n                        handle\n                        class=\"absolute top-1/2 -right-px translate-x-1/2 -translate-y-1/2 h-3 w-3 rounded-full bg-blue-500 hover:h-4 hover:w-4 active:bg-primary\"\n                        (mousedown)=\"startMoveDuration($event)\"\n                        (touchstart)=\"startMoveDuration($event)\"\n                    ></div>\n                    <div\n                        class=\"bg-white dark:bg-neutral-600 border border-gray-300 dark:border-neutral-500 p-2 absolute top-2 left-1/2 -translate-x-1/2 shadow text-xs whitespace-nowrap rounded\"\n                    >\n                        {{ duration | duration }}\n                    </div>\n                    <div\n                        *ngIf=\"move_time\"\n                        class=\"bg-white dark:bg-neutral-600 border border-gray-300 dark:border-neutral-500 p-2 absolute top-12 left-1/2 -translate-x-1/2 shadow text-xs whitespace-nowrap rounded\"\n                    >\n                        {{ date | date: 'shortTime' }}\n                    </div>\n                </div>\n            </div>\n        </main>\n        <footer\n            class=\"flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n        >\n            <button\n                matRipple\n                [mat-dialog-close]=\"true\"\n                class=\"clear text-primary\"\n            >\n                <div class=\"flex items-center\">\n                    <app-icon class=\"text-xl\">arrow_back</app-icon>\n                    <div class=\"mr-1 underline\">Back to form</div>\n                </div>\n            </button>\n        </footer>\n    `,\n    styles: [\n        `\n            [disabled='true'] {\n                background: rgba(0, 0, 0, 0.05) !important;\n                pointer-events: none;\n            }\n            [disabled='true'] > * {\n                color: rgba(0, 0, 0, 0.3);\n            }\n        `,\n    ],\n})\nexport class FindAvailabilityModalComponent extends AsyncHandler {\n    public readonly users = new BehaviorSubject([]);\n    public search = '';\n    public date = this._data.date || Date.now();\n    public duration = this._data.duration || 60;\n    public user?: User;\n    public offset = 0;\n    public width = 0;\n\n    public readonly host = this._data.host;\n    public readonly hours = new Array(24).fill(0);\n\n    public readonly availability = this.users.pipe(\n        debounceTime(300),\n        switchMap((users) => {\n            if (!users.length) return of([]);\n            return queryUserFreeBusy({\n                calendars: [this.host.email, ...users.map((_) => _.email)].join(\n                    ','\n                ),\n                period_start: getUnixTime(startOfDay(this.date)),\n                period_end: getUnixTime(endOfDay(this.date)),\n            }).pipe(catchError(() => of([])));\n        }),\n        map((availability_list) => {\n            const availability_map: Record<string, AvailabilityBlock[]> = {};\n            for (const item of availability_list) {\n                availability_map[item.id] = item.availability\n                    .filter((_) => _.status === 'busy')\n                    .map((block) => {\n                        const date = fromUnixTime(block.starts_at);\n                        const duration = differenceInMinutes(\n                            fromUnixTime(block.ends_at),\n                            fromUnixTime(block.starts_at)\n                        );\n                        console.log('Block:', block, date, duration);\n                        return {\n                            date,\n                            duration,\n                            start:\n                                ((date.getHours() + date.getMinutes() / 60) /\n                                    24) *\n                                100,\n                            size: (duration / 60 / 24) * 100,\n                        };\n                    });\n            }\n            return availability_map;\n        }),\n        defaultIfEmpty({}),\n        shareReplay(1)\n    );\n\n    @ViewChild('container', { static: true })\n    private _container_el!: ElementRef<HTMLDivElement>;\n\n    public get today() {\n        return isSameDay(this.date, Date.now());\n    }\n\n    public get current_hour() {\n        return new Date().getHours();\n    }\n\n    public get selection_left() {\n        const date = new Date(this.date);\n        return (date.getHours() + date.getMinutes() / 60) * 5 + 6;\n    }\n\n    public get selection_width() {\n        return (this.duration / 60) * 5;\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: FindAvailabilityData,\n        private _renderer: Renderer2,\n        private _dialog_ref: MatDialogRef<FindAvailabilityModalComponent>\n    ) {\n        super();\n        this.users.next([...this._data.users]);\n    }\n\n    public addUser(user: User) {\n        this.users.next([\n            ...this.users.getValue().filter((u) => u.email !== user.email),\n            user,\n        ]);\n        this.user = null;\n    }\n\n    public removeUser(user: User) {\n        this.users.next(\n            this.users.getValue().filter((u) => u.email !== user.email)\n        );\n        this.user = null;\n    }\n\n    public closeAndUpdate() {\n        this._dialog_ref.close(true);\n    }\n\n    public ngAfterViewInit() {\n        const date = new Date(this.date);\n        this.timeout(\n            'init',\n            () => {\n                const el = this._container_el.nativeElement.querySelector(\n                    `[hour=\"${date.getHours()}\"]`\n                );\n                if (el) {\n                    const rect =\n                        this._container_el.nativeElement.getBoundingClientRect();\n                    const el_rect = el.getBoundingClientRect();\n                    this._container_el.nativeElement.scrollTo(\n                        el_rect.left - 128 - rect.left,\n                        0\n                    );\n                }\n                this.updateWidth();\n                this.updateScroll();\n            },\n            300\n        );\n    }\n\n    public updateWidth() {\n        const container_size =\n            this._container_el.nativeElement.getBoundingClientRect().width;\n        const user_list_size = this._container_el.nativeElement\n            .querySelector('[users]')\n            .getBoundingClientRect().width;\n        this.width = Math.floor(container_size - user_list_size);\n        this._move_size =\n            this._container_el.nativeElement\n                .querySelector('[hour]')\n                .getBoundingClientRect().width * 24;\n    }\n\n    public updateScroll() {\n        this.offset = this._container_el.nativeElement.scrollLeft;\n    }\n\n    public move_time = false;\n    private _start_time = 0;\n    private _move_last = 0;\n    private _move_size = 0;\n\n    public startMovePeriod(event: MouseEvent | TouchEvent) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.updateWidth();\n        this._move_last =\n            event instanceof MouseEvent\n                ? event.clientX\n                : event.touches[0].clientX;\n        this.move_time = true;\n        this._start_time = this.date;\n        event instanceof MouseEvent\n            ? this.subscription(\n                  'on_move',\n                  this._renderer.listen('window', 'mousemove', (e) =>\n                      this._onMovePeriod(e)\n                  )\n              )\n            : this.subscription(\n                  'on_move',\n                  this._renderer.listen('window', 'touchmove', (e) =>\n                      this._onMovePeriod(e)\n                  )\n              );\n        event instanceof MouseEvent\n            ? this.subscription(\n                  'on_move_end',\n                  this._renderer.listen('window', 'mouseup', () =>\n                      this._onMoveEnd()\n                  )\n              )\n            : this.subscription(\n                  'on_move_end',\n                  this._renderer.listen('window', 'touchend', () =>\n                      this._onMoveEnd()\n                  )\n              );\n    }\n\n    public startMoveDuration(event: MouseEvent | TouchEvent) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.updateWidth();\n        this._move_last =\n            event instanceof MouseEvent\n                ? event.clientX\n                : event.touches[0].clientX;\n        this._start_time = this.duration;\n        event instanceof MouseEvent\n            ? this.subscription(\n                  'on_move',\n                  this._renderer.listen('window', 'mousemove', (e) =>\n                      this._onMoveDuration(e)\n                  )\n              )\n            : this.subscription(\n                  'on_move',\n                  this._renderer.listen('window', 'touchmove', (e) =>\n                      this._onMoveDuration(e)\n                  )\n              );\n        event instanceof MouseEvent\n            ? this.subscription(\n                  'on_move_end',\n                  this._renderer.listen('window', 'mouseup', () =>\n                      this._onMoveEnd()\n                  )\n              )\n            : this.subscription(\n                  'on_move_end',\n                  this._renderer.listen('window', 'touchend', () =>\n                      this._onMoveEnd()\n                  )\n              );\n    }\n\n    private _onMovePeriod(event: MouseEvent | TouchEvent) {\n        const change_px =\n            this._move_last -\n            (event instanceof MouseEvent\n                ? event.clientX\n                : event.touches[0].clientX);\n        const dir = change_px > 0 ? -1 : 1;\n        const change_min =\n            dir *\n            Math.floor(Math.abs((change_px / this._move_size) * 24 * 60) / 5) *\n            5;\n        if (change_min) {\n            const old_date = this.date;\n            this.date = addMinutes(this._start_time, change_min).valueOf();\n            if (this.date < Date.now()) this.date = old_date;\n        }\n    }\n\n    private _onMoveDuration(event: MouseEvent | TouchEvent) {\n        const change_px =\n            this._move_last -\n            (event instanceof MouseEvent\n                ? event.clientX\n                : event.touches[0].clientX);\n        const dir = change_px > 0 ? -1 : 1;\n        const change_min =\n            dir *\n            Math.floor(Math.abs((change_px / this._move_size) * 24 * 60) / 5) *\n            5;\n        if (change_min) {\n            this.duration = Math.max(30, this._start_time + change_min);\n        }\n    }\n\n    private _onMoveEnd() {\n        this.unsub('on_move');\n        this.unsub('on_move_end');\n        this._move_last = 0;\n        this.move_time = false;\n    }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { User } from '../user.class';\n\nexport interface AvailabilityBlock {\n    date: number;\n    duration: number;\n    start: number;\n    size: number;\n}\n\n@Component({\n    selector: 'user-availability-list',\n    template: `\n        <div\n            class=\"overflow-hidden relative border-b border-gray-300 dark:border-neutral-500 h-full pointer-events-none\"\n            [style.width]=\"width + 'px'\"\n        >\n            <div\n                class=\"absolute w-[120rem] h-full inset-y-0\"\n                [style.left]=\"-offset + 'px'\"\n            >\n                <div\n                    event\n                    *ngFor=\"let event of availability\"\n                    class=\"absolute inset-y-0 bg-primary text-white p-2 overflow-hidden border border-white rounded\"\n                    [style.left]=\"event.start + '%'\"\n                    [style.width]=\"event.size + '%'\"\n                >\n                    <div class=\"text-xs\">Unavailable</div>\n                    <div class=\"text-xs max-w-full\">\n                        {{ event.date | date: 'shortTime' }} -\n                        {{\n                            event.date.valueOf() + event.duration * 60 * 1000\n                                | date: 'shortTime'\n                        }}\n                    </div>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class UserAvailabilityComponent {\n    @Input() public user: User;\n    @Input() public availability: AvailabilityBlock[] = [];\n    @Input() public date: number = Date.now();\n    @Input() public offset = 0;\n    @Input() public width = 0;\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\n\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\nimport { FormFieldsModule } from 'libs/form-fields/src/lib/form-fields.module';\n\nimport { NewUserModalComponent } from './new-user-modal.component';\nimport { UserFormComponent } from './user-form.component';\nimport { UserPipe } from './user.pipe';\nimport { WFHSettingsModalComponent } from './wfh-settings-modal.component';\nimport { FindAvailabilityModalComponent } from './find-availability-modal/find-availability-modal.component';\nimport { UserAvailabilityComponent } from './find-availability-modal/user-availability.component';\n\nconst COMPONENTS = [\n    NewUserModalComponent,\n    UserFormComponent,\n    WFHSettingsModalComponent,\n    UserPipe,\n    FindAvailabilityModalComponent,\n    UserAvailabilityComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatDialogModule,\n        FormFieldsModule,\n        ComponentsModule,\n        MatCheckboxModule,\n        MatProgressSpinnerModule,\n        MatMenuModule,\n    ],\n    exports: [...COMPONENTS],\n})\nexport class SharedUsersModule {}\n","import { HashMap } from '@placeos/common';\nimport { getUnixTime } from 'date-fns';\n\nexport class MapLocation {\n    /** Source that the location was generated */\n    public type: 'desk' | 'wireless' | 'meeting' | 'other';\n    /** Details of the location */\n    public position: string | { x: number, y: number };\n    /** Accuracy of the location data */\n    public variance: number;\n    /** Unix epoch in seconds that the data was last updated */\n    public last_seen: number;\n    /** ID of the level associated with the location */\n    public level: string;\n    /** ID of the building associated with the location */\n    public building: string;\n    /** Whether user is currently at the location if fixed */\n    public at_location: boolean;\n    /**  */\n    public coordinates_from:\n        | 'top-left'\n        | 'top-right'\n        | 'bottom-left'\n        | 'bottom-right';\n\n    constructor(_data: HashMap = {}) {\n        this.type = _data.type || _data.location || 'other';\n        this.position = _data.position ||\n            _data.map_id || _data.asset_id || {\n                x: _data.x / _data.map_width || 0,\n                y: _data.y / _data.map_height || 0,\n            };\n        this.variance = _data.variance || 0;\n        this.last_seen = _data.last_seen || getUnixTime(new Date());\n        this.level = _data.level;\n        this.building = _data.building;\n        this.at_location = !!_data.at_location;\n        this.coordinates_from = _data.coordinates_from || 'top-left';\n    }\n}\n"],"x_google_ignoreList":[2,3]}