"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[450],{5450:(I,m,s)=>{s.r(m),s.d(m,{WeekViewModule:()=>ee});var c=s(177),v=s(9417),p=s(3141),u=s(363),w=s(2168),h=s(8390),e=s(3953),T=s(4605),g=s(467),k=s(4046),l=s(7375),O=s(2185),f=s(1954),F=s(1583),W=s(3719),E=s(2798),y=s(6600),G=s(450),j=s(9434);function R(n,d){if(1&n&&(e.j41(0,"mat-option",11),e.EFF(1),e.k0s()),2&n){const t=d.$implicit;e.Y8G("value",t.id),e.R7$(),e.SpI(" ",t.display_name||t.name," ")}}let D=(()=>{class n extends l.Tv{constructor(t,i,o,r){super(),this._state=t,this._org=i,this._route=o,this._router=r,this.zones=[],this.levels=this._org.active_levels,this.options=this._state.options,this.setDate=a=>this._state.setDate(a),this.setWeekends=a=>this._state.setUIOptions({show_weekends:a}),this.newBooking=a=>this._state.newBooking(a),this.updateZones=a=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:a.join(",")}}),this._state.setZones(a)}}ngOnInit(){var t=this;return(0,g.A)(function*(){yield t._org.initialised.pipe((0,k.$)(i=>i)).toPromise(),t.subscription("route.query",t._route.queryParamMap.subscribe(i=>{if(i.has("zone_ids")){const o=i.get("zone_ids").split(",");if(o.length){const r=t._org.levelWithID(o);if(t.zones=o,!r)return;t._org.building=t._org.buildings.find(a=>a.id===r.parent_id)}}})),t.subscription("levels",t._org.active_levels.subscribe(i=>{t.zones=t.zones.filter(o=>i.find(r=>r.id===o)),!t.zones.length&&i.length&&t.zones.push(i[0].id),t.updateZones(t.zones)}))})()}static#e=this.\u0275fac=function(i){return new(i||n)(e.rXU(f.G),e.rXU(O.yb),e.rXU(p.nX),e.rXU(p.Ix))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["week-view-topbar"]],features:[e.Vt3],decls:16,vars:7,consts:[["btn","","matRipple","","new","",1,"w-12","xl:w-auto",3,"click"],[1,"flex","items-center"],[1,"mr-2"],[1,"hidden","xl:block"],["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"m-2",3,"ngModelChange","ngModel"],[1,"text-xs"],[1,"flex-1","w-0"],[3,"dateChange"],[3,"value"]],template:function(i,o){if(1&i&&(e.j41(0,"button",0),e.bIt("click",function(){return o.newBooking()}),e.j41(1,"div",1)(2,"app-icon",2),e.EFF(3,"add"),e.k0s(),e.j41(4,"div",3),e.EFF(5,"New Booking"),e.k0s()()(),e.j41(6,"mat-form-field",4)(7,"mat-select",5),e.mxI("ngModelChange",function(a){return e.DH7(o.zones,a)||(o.zones=a),a}),e.bIt("ngModelChange",function(a){return o.updateZones(a)}),e.DNE(8,R,2,2,"mat-option",6),e.nI1(9,"async"),e.k0s()(),e.j41(10,"mat-slide-toggle",7),e.nI1(11,"async"),e.bIt("ngModelChange",function(a){return o.setWeekends(a)}),e.j41(12,"div",8),e.EFF(13,"Show weekends"),e.k0s()(),e.nrm(14,"div",9),e.j41(15,"date-options",10),e.bIt("dateChange",function(a){return o.setDate(a)}),e.k0s()),2&i){let r;e.R7$(7),e.R50("ngModel",o.zones),e.R7$(),e.Y8G("ngForOf",e.bMT(9,3,o.levels)),e.R7$(2),e.Y8G("ngModel",null==(r=e.bMT(11,5,o.options))?null:r.show_weekends)}},dependencies:[c.Sq,v.BC,v.vS,F.o,W.rl,E.VO,y.wT,G.sG,y.r6,j.R,c.Jj],styles:["[_nghost-%COMP%]{display:flex;align-items:center;background-color:var(--b1);height:5em;padding:0 1em}button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em;margin-left:1em}"]})}return n})();var _=s(2232),$=s(7575),x=s(906),b=s(7793),P=s(4512),U=s(9928),N=s(9714),M=s(5006);function X(n,d){if(1&n){const t=e.RV6();e.j41(0,"div",1),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.view(o.event))}),e.j41(1,"div",2),e.EFF(2),e.k0s(),e.j41(3,"div",3),e.EFF(4),e.nI1(5,"date"),e.k0s(),e.j41(6,"div",3),e.EFF(7),e.k0s()()}if(2&n){const t=e.XpG();e.HbH("m-2 p-2 bg-base-100 shadow rounded border-2 text-black text-left font-normal "+("done"===(null==t.event?null:t.event.state)?"done":null==t.event?null:t.event.type)),e.R7$(2),e.JRh(null==t.event?null:t.event.title),e.R7$(2),e.JRh(e.i5U(5,6,null==t.event?null:t.event.date,t.time_format)),e.R7$(3),e.Lme(" ",null==t.event?null:t.event.attendees.length," Attendee",1===(null==t.event?null:t.event.attendees.length)?"":"s"," ")}}s(8113);let z=(()=>{class n{get time_format(){return this._settings.time_format}constructor(t,i){this._state=t,this._settings=i,this.view=o=>this._state.setEvent(o)}static#e=this.\u0275fac=function(i){return new(i||n)(e.rXU(f.G),e.rXU(l.h$))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["week-view-event"]],inputs:{event:"event"},decls:1,vars:1,consts:[["content","","matRipple","",3,"class","click",4,"ngIf"],["content","","matRipple","",3,"click"],[1,"text-base"],[1,"text-sm"]],template:function(i,o){1&i&&e.DNE(0,X,8,9,"div",0),2&i&&e.Y8G("ngIf",o.event)},dependencies:[c.bT,y.r6,c.vh],styles:["button[_ngcontent-%COMP%]{background:none!important;border:none!important}[content][_ngcontent-%COMP%]{width:calc(100% - 1rem)}.done[_ngcontent-%COMP%]{opacity:.5}.done[_ngcontent-%COMP%]:hover{opacity:1}.cancelled[_ngcontent-%COMP%]{border-color:#626262}.external[_ngcontent-%COMP%]{border-color:#d85be0}.internal[_ngcontent-%COMP%]{border-color:#00a4c7}"]})}return n})();function Y(n,d){1&n&&e.nrm(0,"week-view-event",5),2&n&&e.Y8G("event",d.$implicit)}function B(n,d){if(1&n&&(e.qex(0),e.DNE(1,Y,1,1,"week-view-event",4),e.nI1(2,"async"),e.bVm()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",e.bMT(2,1,t.events))}}function S(n,d){1&n&&(e.j41(0,"p",6),e.EFF(1,"No events"),e.k0s())}let J=(()=>{class n{constructor(t){this._state=t,this._index=new U.t(0),this.date=this._state.date.pipe((0,M.T)(i=>(0,x.f)((0,b.k)(i),this.index).valueOf())),this.events=(0,N.zV)([this._state.filtered,this._state.date,this._index]).pipe((0,M.T)(([i,o,r])=>{const a=(0,x.f)((0,b.k)(o),r).valueOf(),te=(0,P.D)(a).valueOf();return i.filter(C=>(0,l.dH)(a,te,C.date,C.date+60*C.duration*1e3))}))}ngOnChanges(t){t.index&&this._index.next(this.index)}static#e=this.\u0275fac=function(i){return new(i||n)(e.rXU(f.G))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["week-view-day"]],inputs:{index:"index"},features:[e.OA$],decls:9,vars:10,consts:[["empty_state",""],[1,"flex","items-center","justify-center","border-b","border-base-200","bg-base-300","w-full","py-3","text-white"],[1,"flex-1","h-1/2","overflow-auto","w-full"],[4,"ngIf","ngIfElse"],[3,"event",4,"ngFor","ngForOf"],[3,"event"],[1,"text-center","p-2"]],template:function(i,o){if(1&i&&(e.j41(0,"header",1),e.EFF(1),e.nI1(2,"async"),e.nI1(3,"date"),e.k0s(),e.j41(4,"div",2),e.DNE(5,B,3,3,"ng-container",3),e.nI1(6,"async"),e.k0s(),e.DNE(7,S,2,0,"ng-template",null,0,e.C5r)),2&i){let r;const a=e.sdS(8);e.R7$(),e.SpI(" ",e.i5U(3,5,e.bMT(2,3,o.date),"EEE, MMM d, y")," "),e.R7$(4),e.Y8G("ngIf",null==(r=e.bMT(6,8,o.events))?null:r.length)("ngIfElse",a)}},dependencies:[c.Sq,c.bT,z,c.Jj,c.vh],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;align-items:center;height:100%}"]})}return n})();function Z(n,d){if(1&n&&(e.qex(0),e.nrm(1,"week-view-day",5),e.bVm()),2&n){const t=e.XpG().$implicit;e.R7$(),e.Y8G("index",t)}}function H(n,d){if(1&n&&(e.qex(0),e.DNE(1,Z,2,1,"ng-container",4),e.nI1(2,"async"),e.bVm()),2&n){const t=d.$implicit,i=e.XpG();e.R7$(),e.Y8G("ngIf",0!==t&&6!==t||e.bMT(2,1,i.options).show_weekends)}}function A(n,d){1&n&&e.nrm(0,"mat-progress-bar",6)}function L(n,d){if(1&n&&(e.nrm(0,"view-event-details",7),e.nI1(1,"async")),2&n){const t=e.XpG();e.Y8G("event",e.bMT(1,1,t.event))}}let K=(()=>{class n{constructor(t){this._state=t,this.weekdays=[0,1,2,3,4,5,6],this.options=this._state.options,this.event=this._state.event,this.loading=this._state.loading}ngOnInit(){this._state.startPolling("week")}ngOnDestroy(){this._state.stopPolling()}static#e=this.\u0275fac=function(i){return new(i||n)(e.rXU(f.G))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["week-view-timeline"]],decls:6,vars:7,consts:[[1,"flex","divide-x","border-base-200","h-full"],[4,"ngFor","ngForOf"],["mode","indeterminate",4,"ngIf"],[3,"event",4,"ngIf"],[4,"ngIf"],[1,"h-full","flex-1",3,"index"],["mode","indeterminate"],[3,"event"]],template:function(i,o){1&i&&(e.j41(0,"div",0),e.DNE(1,H,3,3,"ng-container",1),e.k0s(),e.DNE(2,A,1,0,"mat-progress-bar",2),e.nI1(3,"async"),e.DNE(4,L,2,3,"view-event-details",3),e.nI1(5,"async")),2&i&&(e.R7$(),e.Y8G("ngForOf",o.weekdays),e.R7$(),e.Y8G("ngIf",e.bMT(3,3,o.loading)),e.R7$(2),e.Y8G("ngIf",e.bMT(5,5,o.event)))},dependencies:[c.Sq,c.bT,_.x,$.HM,J,c.Jj],styles:["[_nghost-%COMP%]{position:relative;height:100%;width:100%;overflow:hidden}"]})}return n})();const Q=["app-weekview",""];let V=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["","app-weekview",""]],attrs:Q,decls:4,vars:0,consts:[[1,"relative","overflow-hidden"]],template:function(i,o){1&i&&(e.nrm(0,"sidebar"),e.j41(1,"main",0),e.nrm(2,"week-view-topbar")(3,"week-view-timeline"),e.k0s())},dependencies:[T.k,D,K],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;background:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}"]})}return n})();const q=[{path:"",component:V},{path:"new",component:V}];let ee=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[c.MD,v.YN,u.r,w.lx,h.kR,p.iI.forChild(q)]})}return n})()},8390:(I,m,s)=>{s.d(m,{g8:()=>w,kR:()=>c.k,Gp:()=>h.Gp,KJ:()=>h.KJ,N8:()=>g.N8,SZ:()=>g.SZ});var c=s(3850),u=(s(1543),s(8737),s(5987));class w{constructor(l={}){this.type=l.type||l.location||"other",this.position=l.position||l.map_id||l.asset_id||{x:l.x/l.map_width||0,y:l.y/l.map_height||0},this.variance=l.variance||0,this.last_seen=l.last_seen||(0,u._)(new Date),this.level=l.level,this.building=l.building,this.at_location=!!l.at_location,this.coordinates_from=l.coordinates_from||"top-left"}}var h=s(3693),g=(s(4129),s(6039),s(2372))}}]);