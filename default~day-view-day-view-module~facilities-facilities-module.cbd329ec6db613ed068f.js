(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{HWRp:function(e,t,n){"use strict";n.d(t,"a",(function(){return Z}));var o=n("D57K"),s=n("9MvL"),i=n("KuCG"),a=n("zYp8"),r=n("JS2V"),l=n("JuBR"),c=n("mrqE");function b(e){Object(c.a)(1,arguments);var t=Object(l.a)(e);return t.setDate(1),t.setHours(0,0,0,0),t}function d(e){Object(c.a)(1,arguments);var t=Object(l.a)(e),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}var u=n("CzDk"),h=n("C05f"),f=n("HM3f"),m=n("ROBh"),p=n("YtkY"),v=n("xVbo"),g=n("mWib"),_=n("TLy2"),O=n("4e/d"),j=n("jOdJ"),w=n("20lr"),V=n("eZII"),k=n("EM62"),y=n("OZ4H"),x=n("7JBE"),U=n("PBFl"),D=n("ukpX"),L=n("2kYt"),I=n("6CBO"),S=n("nIj0"),P=n("29Wa"),z=n("Cd2c"),C=n("kD+q"),M=n("NhjZ"),E=n("gpkD"),J=n("lfZe"),B=n("mnsz"),N=n("7u5P");function Q(e,t){if(1&e){const e=k.Wb();k.Vb(0,"form",1),k.Vb(1,"div",2),k.Vb(2,"label",3),k.Lc(3,"Title"),k.Vb(4,"span"),k.Lc(5,"*"),k.Ub(),k.Lc(6,":"),k.Ub(),k.Vb(7,"mat-form-field",4),k.Qb(8,"input",5),k.Vb(9,"mat-error"),k.Lc(10,"A valid title is required"),k.Ub(),k.Ub(),k.Ub(),k.Vb(11,"div",2),k.Vb(12,"label",6),k.Lc(13,"Date"),k.Vb(14,"span"),k.Lc(15,"*"),k.Ub(),k.Lc(16,":"),k.Ub(),k.Qb(17,"a-date-field",7),k.Ub(),k.Vb(18,"div",8),k.Vb(19,"div",9),k.Vb(20,"label",10),k.Lc(21,"Start Time"),k.Vb(22,"span"),k.Lc(23,"*"),k.Ub(),k.Lc(24,":"),k.Ub(),k.Qb(25,"a-time-field",11),k.Ub(),k.Vb(26,"div",9),k.Vb(27,"label",12),k.Lc(28,"Duration"),k.Vb(29,"span"),k.Lc(30,"*"),k.Ub(),k.Lc(31,":"),k.Ub(),k.Qb(32,"a-duration-field",13),k.Ub(),k.Ub(),k.Vb(33,"div",9),k.Vb(34,"label",14),k.Lc(35,"Host"),k.Vb(36,"span"),k.Lc(37,"*"),k.Ub(),k.Lc(38,":"),k.Ub(),k.Qb(39,"a-user-search-field",15),k.Ub(),k.Vb(40,"div",9),k.Vb(41,"label",16),k.Lc(42,"Attendees"),k.Vb(43,"span"),k.Lc(44,"*"),k.Ub(),k.Lc(45,":"),k.Ub(),k.Qb(46,"a-user-list-field",17),k.Ub(),k.Vb(47,"div",9),k.Vb(48,"label",18),k.Lc(49,"Space"),k.Vb(50,"span"),k.Lc(51,"*"),k.Ub(),k.Lc(52,":"),k.Ub(),k.Vb(53,"an-action-field",19),k.fc("onAction",(function(){return k.yc(e),k.jc().selectSpace()})),k.Ub(),k.Ub(),k.Ub()}if(2&e){const e=k.jc();k.pc("formGroup",e.form),k.Db(32),k.pc("time",e.form.controls.date.value),k.Db(21),k.pc("placeholder",e.spaces)}}let H=(()=>{class e{constructor(e){this._dialog=e}get spaces(){var e,t;return(null===(t=null===(e=this.form.controls.resources)||void 0===e?void 0:e.value)||void 0===t?void 0:t.map(e=>e.display_name||e.name).join(", "))||"Select a space"}selectSpace(){return Object(o.a)(this,void 0,void 0,(function*(){const e=this._dialog.open(I.b,{data:{spaces:this.form.controls.resources.value,date:this.form.controls.date.value,duration:this.form.controls.duration.value}}),t=yield Promise.race([e.componentInstance.event.pipe(Object(j.a)(e=>"done"===e.reason)).toPromise(),e.afterClosed().pipe(Object(p.a)(e=>null)).toPromise()]);t&&this.form.controls.resources.setValue(t.metadata),e.close()}))}}return e.\u0275fac=function(t){return new(t||e)(k.Pb(y.b))},e.\u0275cmp=k.Jb({type:e,selectors:[["event-form"]],inputs:{form:"form"},decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"flex","flex-col"],["for","title"],["appearance","outline"],["matInput","","name","title","formControlName","title","placeholder","Meeting Title"],["for","date"],["name","date","formControlName","date"],[1,"flex","space-x-2"],[1,"flex","flex-col","flex-1"],["for","start-time"],["name","start-time","formControlName","date",2,"margin-top",".3rem"],["for","duration"],["name","duration","formControlName","duration",3,"time"],["for","organiser"],["name","organiser","formControlName","organiser"],["for","attendees"],["name","attendees","formControlName","attendees"],["for","space"],["name","space",3,"placeholder","onAction"]],template:function(e,t){1&e&&k.Jc(0,Q,54,3,"form",0),2&e&&k.pc("ngIf",t.form)},directives:[L.n,S.r,S.m,S.g,P.c,z.b,S.c,S.l,S.e,P.b,C.a,M.a,E.a,J.a,B.a,N.a],styles:[""]}),e})();var R=n("csyo");function q(e,t){if(1&e&&(k.Vb(0,"main",6),k.Qb(1,"event-form",7),k.Ub()),2&e){const e=k.jc();k.Db(1),k.pc("form",e.form)}}function A(e,t){if(1&e){const e=k.Wb();k.Vb(0,"footer",8),k.Vb(1,"button",9),k.fc("click",(function(){return k.yc(e),k.jc().save()})),k.Lc(2,"Save"),k.Ub(),k.Ub()}}function Y(e,t){if(1&e&&(k.Vb(0,"main",10),k.Qb(1,"mat-spinner",11),k.Vb(2,"p"),k.Lc(3),k.Ub(),k.Ub()),2&e){const e=k.jc();k.Db(1),k.pc("diameter",48),k.Db(2),k.Mc(e.loading)}}let W=(()=>{class e{constructor(e,t,n,o){this._data=e,this._calendar=t,this._event=n,this._dialog_ref=o,this.event=new k.o}ngOnInit(){this.form=Object(V.c)(new V.a(this._data.event||{})),this.form.controls.host.setValue(null)}save(){var e;return Object(o.a)(this,void 0,void 0,(function*(){if(this.form.markAllAsTouched(),this.form.controls.organiser.value&&!this.form.controls.host.value&&this.form.controls.host.setValue(this.form.controls.organiser.value.email),!this.form.valid||!(null===(e=this.form.value.resources)||void 0===e?void 0:e.length)){const e=[];for(const t in this.form.controls)this.form.controls[t].invalid&&e.push(t);return Object(w.l)(`Some form fields are not valid: [${e.join(", ")}]`)}const t=this.form.value;if(this.loading="Check space availability...",(yield this._calendar.availability({period_start:Math.floor(new Date(t.date).valueOf()/1e3),period_end:Math.floor(new Date(t.date).valueOf()/1e3)+60*t.duration,system_ids:t.resources.map(e=>e.id).join(",")}).catch(e=>[])).length<t.resources.length)return this.loading="",Object(w.l)("Some of the selected spaces are not available for the selected time and duration");this.loading="Creating calendar event...",t.system=t.resources[0];const n=yield this._event.save(new V.a(t).toJSON(),{calendar:t.calendar}).catch(e=>null);if(this.loading="",!n)return Object(w.l)("Error creating booking.");this.event.emit({reason:"done",metadata:n}),Object(w.n)("Successfully created booking."),this._dialog_ref.close()}))}}return e.\u0275fac=function(t){return new(t||e)(k.Pb(y.a),k.Pb(x.a),k.Pb(V.b),k.Pb(y.g))},e.\u0275cmp=k.Jb({type:e,selectors:[["booking-modal"]],outputs:{event:"event"},decls:11,vars:3,consts:[[1,"flex-1","w-0"],["mat-icon-button","","mat-dialog-close",""],["className","material-icons"],["class","overflow-auto p-4",4,"ngIf","ngIfElse"],["class","flex justify-center items-center p-2 border-t border-gray-200",4,"ngIf"],["load_state",""],[1,"overflow-auto","p-4"],[3,"form"],[1,"flex","justify-center","items-center","p-2","border-t","border-gray-200"],["mat-button","",3,"click"],[1,"h-64","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(e,t){if(1&e&&(k.Vb(0,"header"),k.Vb(1,"h2"),k.Lc(2,"New Booking"),k.Ub(),k.Qb(3,"div",0),k.Vb(4,"button",1),k.Vb(5,"app-icon",2),k.Lc(6,"close"),k.Ub(),k.Ub(),k.Ub(),k.Jc(7,q,2,1,"main",3),k.Jc(8,A,3,0,"footer",4),k.Jc(9,Y,4,2,"ng-template",null,5,k.Kc)),2&e){const e=k.vc(10);k.Db(7),k.pc("ngIf",!t.loading)("ngIfElse",e),k.Db(1),k.pc("ngIf",!t.loading)}},directives:[U.b,y.d,D.a,L.n,H,R.b],styles:["main[_ngcontent-%COMP%] {\n                width: 32rem;\n                max-height: 65vh;\n                max-width: calc(100vw - 4rem);\n            }"]}),e})();var T=n("Rc+I");let Z=(()=>{class e extends w.c{constructor(e,t,n){super(),this._events=e,this._spaces=t,this._dialog=n,this._poll=new h.a(!1),this._long_poll=new h.a(""),this._bookings=new h.a([]),this._filters=new h.a({}),this._ui_options=new h.a({}),this._date=new h.a((new Date).valueOf()),this._zones=new h.a([]),this._loading=new h.a(!1),this._state=Object(f.b)(this._bookings,this._filters,this._date,this._zones),this._event=new h.a(null),this.bookings=this._bookings.asObservable(),this.date=this._date.asObservable(),this.zones=this._zones.asObservable(),this.ui_options=this._ui_options.asObservable(),this.loading=this._loading.asObservable(),this.event=this._event.asObservable(),this.filtered=this._state.pipe(Object(p.a)(()=>{const e=Object(s.a)(new Date(this._date.getValue())),t=Object(i.a)(e);return this.filterEvents(e,t)})),this.filtered_week=this._state.pipe(Object(p.a)(()=>{const e=Object(a.a)(new Date(this._date.getValue())),t=Object(r.a)(e);return this.filterEvents(e,t)})),this.filtered_month=this._state.pipe(Object(p.a)(()=>{const e=b(new Date(this._date.getValue())),t=d(e);return this.filterEvents(e,t)}));const o=Object(f.b)([this._poll,this._zones,this._date]).pipe(Object(v.a)(e=>!!e[0]),Object(g.a)(500),Object(_.a)(()=>{const e=this._zones.getValue();if(!e||!e.length)return Object(m.a)([]);this._loading.next(!0);const t=Object(s.a)(new Date(this._date.getValue())),n=Object(i.a)(t);return this._events.query({zone_ids:e.join(","),period_start:Math.floor(t.valueOf()/1e3),period_end:Math.floor(n.valueOf()/1e3)})}),Object(O.a)(()=>Object(m.a)([]))),l=Object(f.b)([this._long_poll,this._zones,this._date]).pipe(Object(v.a)(e=>!!e[0]),Object(g.a)(500),Object(_.a)(e=>{const t=e[0],n=e[1];if(!n||!n.length)return Object(m.a)([]);this._loading.next(!0);const o=("week"===t?a.a:b)(new Date(e[2])),s=("week"===t?r.a:d)(o);return this._events.query({zone_ids:n.join(","),period_start:Math.floor(o.valueOf()/1e3),period_end:Math.floor(s.valueOf()/1e3)})}),Object(O.a)(()=>Object(m.a)([])));o.subscribe(e=>{this.processBookings(e),this._loading.next(!1)}),l.subscribe(e=>{this.processBookings(e,this._long_poll.getValue()),this._loading.next(!1)})}get filters(){return this._filters.getValue()}setFilters(e){this._filters.next(e)}setDate(e){this._date.next(e)}setZones(e){this._zones.next(e)}setEvent(e){this._event.next(e)}setUIOptions(e){const t=this._ui_options.getValue();this._ui_options.next(Object.assign(Object.assign({},t),e))}startPolling(e=1e4){this._poll.next(!0),this.interval("polling",()=>this._poll.next(!0),e)}startPollingWeek(e=3e4){this._long_poll.next("week"),this.interval("polling_long",()=>this._long_poll.next("week"),e)}startPollingMonth(e=3e5){this._long_poll.next("month"),this.interval("polling_long",()=>this._long_poll.next("month"),e)}stopPolling(){this._poll.next(!1),this.clearInterval("polling"),this._long_poll.next(""),this.clearInterval("polling_long")}newBooking(e){return Object(o.a)(this,void 0,void 0,(function*(){const t=this._dialog.open(W,{data:{event:e}}),n=yield Promise.race([t.componentInstance.event.pipe(Object(j.a)(e=>"done"===e.reason)).toPromise(),t.afterClosed().toPromise()]);n instanceof V.a&&this.replace(n)}))}removeBooking(e){var t;return Object(o.a)(this,void 0,void 0,(function*(){const n=this._dialog.open(T.c,{data:{title:"Delete meeting?",content:`Are you sure you want to delete the meeting at ${Object(u.a)(new Date(e.date),"dd MMM yyyy, h:mma")}<br> in ${e.location}?`,icon:{class:"material-icons",content:"delete"}}});(yield Promise.race([n.componentInstance.event.pipe(Object(j.a)(e=>"done"===e.reason),Object(p.a)(e=>!0)).toPromise(),n.afterClosed().toPromise()]))&&(n.componentInstance.loading="Deleting booking...",yield this._events.delete(e.id,{system_id:null===(t=e.system)||void 0===t?void 0:t.id}),this.remove(e),n.close())}))}add(e){const t=this._bookings.getValue().concat([e]);this._bookings.next(t)}replace(e){const t=this._bookings.getValue().filter(t=>t.id!==e.id).concat([e]);this._bookings.next(t)}remove(e){const t=this._bookings.getValue().filter(t=>t.id!==e.id);this._bookings.next(t)}processBookings(e,t="day"){const n=("month"===t?b:"week"===t?a.a:s.a)(new Date(this._date.getValue())),o=("month"===t?d:"week"===t?r.a:i.a)(n);let l=this._bookings.getValue();Object(w.x)(Object(w.i)(e.map(e=>e.resources)),"email").forEach(t=>{l=Object(V.d)(l,e.filter(e=>e.resources.find(e=>e.email===t.email)).map(e=>new V.a(e)),{space:t.email,from:n.valueOf(),to:o.valueOf()})}),this._bookings.next(l)}filterEvents(e,t){const n=this._filters.getValue(),o=this._bookings.getValue(),s=this._zones.getValue();return o.filter(o=>{var i,a,r;const l=Object(w.v)(e.valueOf(),t.valueOf(),o.date,o.date+60*o.duration*1e3),c=!!o.resources.map(e=>this._spaces.find(e.id)).find(e=>s.find(t=>e.zones.includes(t))),b=!(null===(i=n.space_emails)||void 0===i?void 0:i.length)||!!o.resources.find(e=>n.space_emails.includes(e.email)),d=!(null===(a=n.zone_ids)||void 0===a?void 0:a.length)||!!o.resources.find(e=>e.zones.find(e=>n.zone_ids.includes(e))),u=!(null===(r=n.hide_type)||void 0===r?void 0:r.length)||!n.hide_type.includes(o.has_visitors?"external":"cancelled"===o.status?"cancelled":"internal");return l&&b&&c&&d&&u})}}return e.\u0275fac=function(t){return new(t||e)(k.cc(V.b),k.cc(I.c),k.cc(y.b))},e.\u0275prov=k.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},JS2V:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n("JuBR"),s=n("N1LS"),i=n("mrqE");function a(e,t){Object(i.a)(1,arguments);var n=t||{},a=n.locale,r=a&&a.options&&a.options.weekStartsOn,l=null==r?0:Object(s.a)(r),c=null==n.weekStartsOn?l:Object(s.a)(n.weekStartsOn);if(!(c>=0&&c<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var b=Object(o.a)(e),d=b.getDay(),u=6+(d<c?-7:0)-(d-c);return b.setDate(b.getDate()+u),b.setHours(23,59,59,999),b}},zYp8:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var o=n("JuBR"),s=n("N1LS"),i=n("mrqE");function a(e,t){Object(i.a)(1,arguments);var n=t||{},a=n.locale,r=a&&a.options&&a.options.weekStartsOn,l=null==r?0:Object(s.a)(r),c=null==n.weekStartsOn?l:Object(s.a)(n.weekStartsOn);if(!(c>=0&&c<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var b=Object(o.a)(e),d=b.getDay(),u=(d<c?7:0)+d-c;return b.setDate(b.getDate()-u),b.setHours(0,0,0,0),b}}}]);
//# sourceMappingURL=default~day-view-day-view-module~facilities-facilities-module.cbd329ec6db613ed068f.js.map