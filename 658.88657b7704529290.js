"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[658],{2658:(io,fe,g)=>{g.r(fe),g.d(fe,{ReportsModule:()=>ct});var x=g(6895),V=g(4006),G=g(3007),Be=g(3045),qe=g(8739),t=g(4650),Je=g(4945),w=g(9112),dt=g(3238),W=g(5306);const Pe=function(){return["/reports","desks"]};function Qe(o,e){1&o&&(t.TgZ(0,"a",2)(1,"app-icon",3),t._uU(2,"room"),t.qZA(),t.TgZ(3,"h3",4),t._uU(4,"Desks"),t.qZA(),t.TgZ(5,"div",5)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",6),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,Pe))}const Fe=function(){return["/reports","spaces"]};function Xe(o,e){1&o&&(t.TgZ(0,"a",2)(1,"app-icon",3),t._uU(2,"meeting_room"),t.qZA(),t.TgZ(3,"h3",4),t._uU(4,"Rooms"),t.qZA(),t.TgZ(5,"div",5)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",6),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,Fe))}const Ve=function(){return["/reports","catering"]};function Ge(o,e){1&o&&(t.TgZ(0,"a",2)(1,"app-icon",3),t._uU(2,"room_service"),t.qZA(),t.TgZ(3,"h3",4),t._uU(4,"Catering"),t.qZA(),t.TgZ(5,"div",5)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",6),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,Ve))}const We=function(){return["/reports","contact-tracing"]};function He(o,e){1&o&&(t.TgZ(0,"a",2)(1,"app-icon",3),t._uU(2,"connect_without_contact"),t.qZA(),t.TgZ(3,"h3",4),t._uU(4,"Contact Tracing"),t.qZA(),t.TgZ(5,"div",5)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",6),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,We))}const $e=function(o){return["/reports",o]};function Ke(o,e){if(1&o&&(t.TgZ(0,"a",2)(1,"app-icon",3),t._uU(2),t.qZA(),t.TgZ(3,"h3",4),t._uU(4),t.qZA(),t.TgZ(5,"div",5)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",6),t._uU(9,"chevron_right"),t.qZA()()()),2&o){const n=e.$implicit;t.Q6J("routerLink",t.VKq(3,$e,n.id)),t.xp6(2),t.Oqu(n.icon),t.xp6(2),t.Oqu(n.name)}}const tn=["desks","spaces","catering","contact-tracing"];class pt{get custom_reports(){return this._settings.get("app.custom_reports")||[]}get features(){return this._settings.get("app.reports.features")||tn}constructor(e){this._settings=e}}function nn(o,e){1&o&&t._UZ(0,"div",3)}pt.\u0275fac=function(e){return new(e||pt)(t.Y36(w.gb))},pt.\u0275cmp=t.Xpm({type:pt,selectors:[["reports-menu"],["","reports-menu",""]],decls:5,vars:5,consts:[["matRipple","","class","h-64 w-64 m-4 p-4 flex flex-col items-center justify-center bg-white dark:bg-neutral-700 rounded shadow hover:opacity-80",3,"routerLink",4,"ngIf"],["matRipple","","class","h-64 w-64 m-4 p-4 flex flex-col items-center justify-center bg-white dark:bg-neutral-700 rounded shadow hover:opacity-80",3,"routerLink",4,"ngFor","ngForOf"],["matRipple","",1,"h-64","w-64","m-4","p-4","flex","flex-col","items-center","justify-center","bg-white","dark:bg-neutral-700","rounded","shadow","hover:opacity-80",3,"routerLink"],[1,"text-8xl"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center"],[1,"ml-2"]],template:function(e,n){1&e&&(t.YNc(0,Qe,10,2,"a",0),t.YNc(1,Xe,10,2,"a",0),t.YNc(2,Ge,10,2,"a",0),t.YNc(3,He,10,2,"a",0),t.YNc(4,Ke,10,5,"a",1)),2&e&&(t.Q6J("ngIf",n.features.includes("desks")),t.xp6(1),t.Q6J("ngIf",n.features.includes("spaces")),t.xp6(1),t.Q6J("ngIf",n.features.includes("catering")),t.xp6(1),t.Q6J("ngIf",n.features.includes("contact-tracing")),t.xp6(1),t.Q6J("ngForOf",n.custom_reports))},dependencies:[x.sg,x.O5,dt.wG,W.o,G.rH],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row!important;align-items:center;justify-content:center;background:inherit}"]});class mt{get path(){const e=this._router.url.split("/");return e[e.length-1]}constructor(e){this._router=e}}mt.\u0275fac=function(e){return new(e||mt)(t.Y36(G.F0))},mt.\u0275cmp=t.Xpm({type:mt,selectors:[["","app-reports",""]],attrs:["app-reports",""],decls:4,vars:1,consts:[[1,"h-full"],[1,"relative","overflow-hidden","flex","flex-col","flex-1","w-1/2","h-full","bg-gray-300","dark:bg-neutral-600"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(e,n){1&e&&(t._UZ(0,"sidebar",0),t.TgZ(1,"main",1),t._UZ(2,"router-outlet"),t.YNc(3,nn,1,0,"div",2),t.qZA()),2&e&&(t.xp6(3),t.Q6J("ngIf","reports"===n.path))},dependencies:[x.O5,Je.k,G.lC,pt],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}main[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(router-outlet){display:flex;flex-direction:column;width:100%;height:100%}"]});var sn=g(2886),Yt=g(1529),k=g(5861),on=g(7224),J=g(6221),ge=g(8186),an=g(1722),$t=g(9830),Kt=g(5882),ot=g(8115),rn=g(9756),at=g(2722),ln=g(4960),te=g(5650),H=g(9925),cn=g(8929),it=g(591),$=g(1086),P=g(3426),It=g(13),ht=g(7545),jt=g(7221),Z=g(4850),j=g(5154),pn=g(6198);class M{get duration(){const e=this._options.getValue();return Math.max(1,Math.abs((0,Kt.Z)((0,ot.Z)(e.start),(0,rn.Z)((0,at.Z)(e.end),1))))}constructor(e){var n=this;this._org=e,this._space_pipe=new pn.X(this._org),this._generate=new cn.xQ,this._loading=new it.X(""),this._active_bookings=new it.X([]),this._options=new it.X({start:new Date,end:new Date}),this._bookings_list=this._generate.pipe((0,It.b)(500),(0,ht.w)(s=>{const a=this._options.getValue();if(this._loading.next("Loading report details..."),!a?.type&&!a?.zones?.length)return(0,$.of)([]);const i=(0,ot.Z)(a?.start?new Date(a.start):new Date).valueOf(),r=(0,at.Z)(a?.end?new Date(a.end):i).valueOf(),l=a?.zones?a.zones.filter(c=>"All"!==c).join(","):"",d={period_start:Math.floor(i/1e3),period_end:Math.floor(r/1e3)};return"desks"===a.type?(0,an.F2)({...d,zones:l,type:"desk"}):(0,$t.u$)({...d,zone_ids:l}).pipe((0,ht.w)(function(){var c=(0,k.Z)(function*(p){return Promise.all(p.map(function(){var h=(0,k.Z)(function*(u){return new $t.ym({...u,resources:yield Promise.all(u.resources.map(f=>n._space_pipe.transform(f.id||f.email)))})});return function(u){return h.apply(this,arguments)}}()))});return function(p){return c.apply(this,arguments)}}()))}),(0,jt.K)(s=>[]),(0,Z.U)(s=>(this._loading.next(""),s?.length||(0,w.cB)("No bookings for the selected levels and period"),this._active_bookings.next(s||[]),s)),(0,j.d)()),this.loading=this._loading.asObservable(),this.options=this._options.asObservable(),this.bookings=this._active_bookings.asObservable(),this.counts=this._options.pipe((0,It.b)(500),(0,ht.w)(s=>{const a=(s.zones||[]).filter(i=>-1!==i&&"All"!==i);return Promise.all(a.map(i=>(0,ge.rlq)(i,"desks").pipe((0,Z.U)(r=>[i,r.details.length])).toPromise()))}),(0,jt.K)(s=>[]),(0,Z.U)(s=>{const a={};return this._active_bookings.next([]),s.forEach(([i,r])=>a[i]=r),a}),(0,j.d)()),this.stats=(0,P.aj)([this.counts,this.bookings]).pipe((0,ht.w)(function(){var s=(0,k.Z)(function*([a,i]){return i[0]instanceof $t.ym?function dn(o,e=8){e=Math.max(1,e);const n=o.reduce((r,l)=>r+l.attendees.length,0),s=o.reduce((r,l)=>r+l.system?.capacity,0),a=Math.floor(o.reduce((r,l)=>r+l.duration,0)/(60*e)*100)/100,i=Math.floor(n/s*100)/100;return{count:o.length,avg_length:Math.floor(o.reduce((r,l)=>r+l.duration,0)/o.length*100)/100,efficiency:Math.floor((a+i)/2*100)/100,total_users:n,total_capacity:s,occupancy:i,utilisation:a,events:o}}(i,8*n.duration):function un(o,e=1,n={}){e=Math.max(1,e);const s=Object.keys(n).reduce((i,r)=>i+(n[r]||0),0),a=Math.floor(o.length/s/e*1e4)/1e4;return{total:s,count:o.length,utilisation:a,events:o}}(i||[],n.duration,a)});return function(a){return s.apply(this,arguments)}}())),this.day_list=(0,P.aj)([this.options,this.stats]).pipe((0,Z.U)(([s,a])=>{const{start:i}=s;let r=(0,ot.Z)(i);const l=(0,at.Z)(s.end||r),d=[];for(;(0,ln.Z)(r,l);){const c=(0,ot.Z)(r).valueOf(),p=(0,at.Z)(c).valueOf(),h=a.events.filter(u=>(0,w.MZ)(c,p,u.date,u.date+60*u.duration*1e3));d.push({date:c,total:a.total,free:a.total-h.length,approved:h.reduce((u,f)=>u+(f.approved?1:0),0),count:h.length,utilisation:(h.length/a.total*100).toFixed(1)}),r=(0,te.Z)(r,1)}return d}),(0,j.d)(1)),this._bookings_list.subscribe(s=>s)}generateReport(){this._generate.next((new Date).valueOf())}setOptions(e){e.zones?.includes("All")?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(n=>n.id)]:e.zones&&this._options.getValue()?.zones?.includes("All")&&(e.zones=[]),e.start?.valueOf()!==this._options.getValue().start?.valueOf()&&e.end?.valueOf()!==this._options.getValue().end?.valueOf()&&this._options.next({...this._options.getValue(),...e})}downloadReport(){const e=this._options.getValue(),n=this._active_bookings.getValue();(0,w.Sv)(`report+${e.type}+${(0,H.Z)(e.start,"yyyy-MM-dd")}+${(0,H.Z)(e.end,"yyyy-MM-dd")}.csv`,(0,w.o3)(n.map(s=>{const a=s.toJSON();return delete a.zones,delete a.server_names,delete a.extension_data,a})))}}M.\u0275fac=function(e){return new(e||M)(t.LFG(J.w7))},M.\u0275prov=t.Yz7({token:M,factory:M.\u0275fac,providedIn:"root"});var Bt=g(9549),mn=g(4385),z=g(9602),qt=g(1572);function hn(o,e){if(1&o&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&o){const n=e.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij(" ",n.display_name||n.name," ")}}function fn(o,e){1&o&&t._UZ(0,"mat-spinner",15),2&o&&t.Q6J("diameter",32)}function gn(o,e){1&o&&(t.TgZ(0,"p"),t._uU(1,"Generate Report"),t.qZA())}class Q extends w.cx{constructor(e,n,s,a){super(),this._state=e,this._org=n,this._route=s,this._router=a,this.zones=[],this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(i=>`${i.id}`),this.levels=this._org.active_levels,this.loading=this._state.loading,this.bookings=this._state.bookings,this.options=this._state.options,this.page="",this.generateReport=()=>this._state.generateReport(),this.downloadReport=()=>this._state.downloadReport(),this.setStartDate=i=>this._state.setOptions({start:new Date(i)}),this.setEndDate=i=>this._state.setOptions({end:new Date(i)}),this.setZones=i=>this._state.setOptions({zones:i})}ngOnInit(){var e=this;return(0,k.Z)(function*(){yield e._org.initialised.pipe((0,on.P)(n=>n)).toPromise(),e.page=e._router.url,e.subscription("routing",e._router.events.subscribe(()=>{e.page=e._router.url})),e.subscription("route.query",e._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const s=n.get("zone_ids").split(",");if(s.length){const a=e._org.levelWithID(s);if(!a)return;e._org.building=e._org.buildings.find(i=>i.id===a.parent_id),e.setZones(s)}}}))})()}}Q.\u0275fac=function(e){return new(e||Q)(t.Y36(M),t.Y36(J.w7),t.Y36(G.gz),t.Y36(G.F0))},Q.\u0275cmp=t.Xpm({type:Q,selectors:[["reports-options"]],features:[t.qOj],decls:28,vars:28,consts:[[1,"bg-white","dark:bg-neutral-700","h-20","w-full","flex","items-center","px-2","shadow","z-20","border-b","border-gray-200"],["appearance","outline",1,"w-48"],["multiple","","placeholder","Select Levels...",3,"ngModel","ngModelChange"],["value","All"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-64"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["btn","","matRipple","",1,"ml-4",3,"disabled","click"],[3,"diameter",4,"ngIf"],[4,"ngIf"],[3,"value"],[3,"diameter"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(a){return n.setZones(a)}),t.ALo(3,"async"),t.TgZ(4,"mat-option",3),t._uU(5,"All Levels"),t.qZA(),t.YNc(6,hn,2,2,"mat-option",4),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"mat-form-field",5)(9,"mat-date-range-input",6)(10,"input",7),t.NdJ("ngModelChange",function(a){return a?n.setStartDate(a):""}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"input",8),t.NdJ("ngModelChange",function(a){return a?n.setEndDate(a):""}),t.ALo(13,"async"),t.qZA()(),t._UZ(14,"mat-datepicker-toggle",9)(15,"mat-date-range-picker",null,10),t.qZA(),t.TgZ(17,"button",11),t.NdJ("click",function(){return n.generateReport()}),t.ALo(18,"async"),t.ALo(19,"async"),t.YNc(20,fn,1,1,"mat-spinner",12),t.ALo(21,"async"),t.YNc(22,gn,2,0,"p",13),t.ALo(23,"async"),t.qZA(),t.TgZ(24,"button",11),t.NdJ("click",function(){return n.downloadReport()}),t.ALo(25,"async"),t.TgZ(26,"p"),t._uU(27,"Download Report"),t.qZA()()()),2&e){const s=t.MAs(16);let a,i,r,l,d;t.xp6(2),t.Q6J("ngModel",null==(a=t.lcZ(3,10,n.options))?null:a.zones),t.xp6(4),t.Q6J("ngForOf",t.lcZ(7,12,n.levels)),t.xp6(3),t.Q6J("rangePicker",s),t.xp6(1),t.Q6J("ngModel",null==(i=t.lcZ(11,14,n.options))?null:i.start),t.xp6(2),t.Q6J("ngModel",null==(r=t.lcZ(13,16,n.options))?null:r.end),t.xp6(2),t.Q6J("for",s),t.xp6(3),t.Q6J("disabled",!!t.lcZ(18,18,n.loading)||!(null!=(l=t.lcZ(19,20,n.options))&&null!=l.zones&&l.zones.length)),t.xp6(3),t.Q6J("ngIf",t.lcZ(21,22,n.loading)),t.xp6(2),t.Q6J("ngIf",!t.lcZ(23,24,n.loading)),t.xp6(2),t.Q6J("disabled",!(null!=(d=t.lcZ(25,26,n.bookings))&&d.length))}},dependencies:[x.sg,x.O5,V.Fj,V.JJ,V.On,Bt.KE,Bt.R9,mn.gD,dt.ey,z.nW,z.wx,z.zY,z.By,z._g,qt.Ou,dt.wG,x.Ov],styles:["button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;margin-left:1em}mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:5.5em;white-space:initial;line-height:1.2em}"]});var _n=g(7623),vn=g(2641),_e=g(900),ee=g(953),ve=g(833);function yn(o){(0,ve.Z)(1,arguments);var n=(0,ee.Z)(o).getDay();return 0===n||6===n}var xn=g(1998),ne=g(9833);function Zn(o,e){if(1&o&&(t.TgZ(0,"div",0)(1,"div",3)(2,"h3"),t._uU(3,"No show count"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"div",3)(8,"h3"),t._uU(9,"% of No show Bookings"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",3)(14,"h3"),t._uU(15,"Total in-room attendance"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"async"),t.qZA()()()),2&o){const n=t.oxw();t.xp6(5),t.Oqu(t.lcZ(6,3,n.no_shows)||0),t.xp6(6),t.hij("",t.lcZ(12,5,n.no_show_percent)||0,"%"),t.xp6(6),t.Oqu(t.lcZ(18,7,n.attendance)||0)}}class ft{constructor(e){this._state=e,this.business_days=this._state.options.pipe((0,Z.U)(({start:n,end:s})=>function wn(o,e){(0,ve.Z)(2,arguments);var n=(0,ee.Z)(o),s=(0,ee.Z)(e);if(!(0,_e.Z)(n)||!(0,_e.Z)(s))return NaN;var a=(0,_n.Z)(n,s),i=a<0?-1:1,r=(0,xn.Z)(a/7),l=5*r;for(s=(0,te.Z)(s,7*r);!(0,vn.Z)(n,s);)l+=yn(s)?0:i,s=(0,te.Z)(s,i);return 0===l?0:l}((0,ot.Z)(s||Date.now()),(0,at.Z)(n||Date.now()))||1)),this.total_count=this._state.stats.pipe((0,Z.U)(n=>n.count||0)),this.avg_length=this._state.stats.pipe((0,Z.U)(n=>(0,ne.Z)({minutes:Math.floor(n.avg_length||0)}))),this.attendance=this._state.stats.pipe((0,Z.U)(({events:n})=>n.reduce((s,{extension_data:a})=>s+(+a?.people_count?.max||0),0))),this.no_shows=this._state.stats.pipe((0,Z.U)(({events:n})=>n.reduce((s,{extension_data:a})=>s+ +a?.people_count?.max?1:0,0))),this.no_show_percent=this._state.stats.pipe((0,Z.U)(({events:n})=>Math.floor(n.reduce((s,{extension_data:a})=>s+ +a?.people_count?.max?1:0,0)/n.length*1e4)/100)),this.has_attendance=this._state.stats.pipe((0,Z.U)(({events:n})=>!!n.find(({extension_data:s})=>!!s?.people_count)))}}ft.\u0275fac=function(e){return new(e||ft)(t.Y36(M))},ft.\u0275cmp=t.Xpm({type:ft,selectors:[["report-spaces-overall"]],decls:21,vars:12,consts:[[1,"m-4","p-4","rounded","bg-white","dark:bg-neutral-700","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],["class","m-4 p-4 rounded bg-white dark:bg-neutral-700 shadow flex justify-center items-center space-x-2",4,"ngIf"],[1,"flex-1","flex","flex-col","items-center","justify-center"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3"),t._uU(3,"Business Days"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"div",1)(8,"h3"),t._uU(9,"Total Bookings"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",1)(14,"h3"),t._uU(15,"Average Booking Length"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"async"),t.qZA()()(),t.YNc(19,Zn,19,9,"div",2),t.ALo(20,"async")),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,4,n.business_days)||0),t.xp6(6),t.Oqu(t.lcZ(12,6,n.total_count)||0),t.xp6(6),t.Oqu(t.lcZ(18,8,n.avg_length)||"None"),t.xp6(2),t.Q6J("ngIf",t.lcZ(20,10,n.has_attendance)))},dependencies:[x.O5,x.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}"]});var K=g(2986),tt=g(1110);const bn=function(){return["flex"]};class gt{constructor(e){var n=this;this._reports=e,this.space_list=(0,P.aj)([this._reports.stats,this._reports.options]).pipe((0,It.b)(300),(0,Z.U)(([s,{start:a,end:i}])=>{let r=[],l=!1;for(const c of s.events){const p=(0,w.Tw)(c.resources,"email")||[c.system];for(const h of p){let u=r.find(f=>f.id===h.id||f.id?.toLowerCase()===h.email.toLowerCase());if(!u){if(u={id:h.id||h.email,name:h.display_name||h.name,capacity:h.capacity||1,count:0,attendance:0,avg_attendance:0,min_attendance:99,max_attendance:0,attendees:0,avg_attendees:0,usage:0,no_shows:0,utilisation:0,occupancy:0},!u.id||!u.name)continue;r.push(u)}0===c.extension_data?.people_count?.max&&(u.no_shows+=1),u.count+=1,u.attendance+=c.extension_data?.people_count?.max??0,u.avg_attendance+=c.extension_data?.people_count?.avg??0,u.min_attendance=Math.min(u.max_attendance,c.extension_data?.people_count?.max??99),u.max_attendance=Math.max(u.max_attendance,c.extension_data?.people_count?.max??0),u.usage+=c.duration,u.attendees+=c.attendees.length,l=l||!!c.extension_data.people_count}}const d=Math.max(1,(0,Kt.Z)(i,a)+1);for(const c of r)c.avg_attendees=Math.floor(c.attendees/c.count*100)/100,c.avg_attendance=Math.floor(c.attendance/c.count*100)/100,c.utilisation=`${Math.floor(c.usage/60/8/d*100)}%`,c.min_attendance=99===c.min_attendance?"?":c.min_attendance,c.occupancy=Math.floor(c.avg_attendees/c.capacity*1e3)/10+"%",(c.attendance<0||!l)&&(c.attendance="?",c.avg_attendance="?");return r})),this.has_attendance=this.space_list.pipe((0,Z.U)(s=>!!s.find(({attendance:a})=>"?"!==a))),this.column_list=this.has_attendance.pipe((0,Z.U)(s=>s?["name","capacity","count","utilisation","avg_attendees","attendance","avg_attendance","no_shows","min_attendance","max_attendance"]:["name","capacity","count","utilisation","avg_attendees"])),this.column_name_list=this.has_attendance.pipe((0,Z.U)(s=>s?["Name","Room Capacity","Bookings","% Time booked during office hrs","Avg. invitees per booking","Total In-room Attendance","Avg. In-room Attendance","No Shows","Min. In-room Attendance","Max. In-room Attendance"]:["Name","Room Capacity","Bookings","% Time booked during office hrs","Avg. invitees per booking"])),this.download=(0,k.Z)(function*(){const s=yield n.space_list.pipe((0,K.q)(1)).toPromise();(0,w.Sv)("report-spaces-usage.csv",(0,w.o3)(s))})}}gt.\u0275fac=function(e){return new(e||gt)(t.Y36(M))},gt.\u0275cmp=t.Xpm({type:gt,selectors:[["report-spaces-space-listing"]],decls:10,vars:10,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Room Utilisation"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.ALo(8,"async"),t.ALo(9,"async"),t.qZA()),2&e&&(t.xp6(7),t.Q6J("dataSource",n.space_list)("pagination",!0)("columns",t.lcZ(8,5,n.column_list))("display_column",t.lcZ(9,7,n.column_name_list))("column_size",t.DdM(9,bn)))},dependencies:[W.o,tt.C,x.Ov]});const An=function(){return["name","count","avg_attendees","total_time","no_shows"]},Cn=function(){return["Name","Bookings","Avg. Invitees per Booking","Total Booked Time","No Shows"]},Mn=function(){return["flex"]};class _t{constructor(e){var n=this;this._reports=e,this.user_list=(0,P.aj)([this._reports.stats]).pipe((0,It.b)(300),(0,Z.U)(([s])=>{let a=[];for(const i of s.events){const r=i.attendees?.find(c=>c.email===i.host);if(!r)continue;const l=Math.max(i.resources.reduce((c,p)=>c+p.capacity,0)||1,1);let d=a.find(c=>c.id?.toLowerCase()===r.email.toLowerCase());d||(d={id:r.email,name:r.name,capacity:l,count:0,attendees:0,avg_attendees:0,no_shows:0,occupancy:0,total_time:0},a.push(d)),0===i.extension_data?.people_count?.max&&(d.no_shows+=1),d.count+=1,d.attendees+=i.attendees.length,d.total_time+=i.duration||15}for(const i of a)i.avg_attendees=Math.floor(i.attendees/i.count*100)/100,i.occupancy=Math.floor(i.avg_attendees/i.capacity*100)/100,i.total_time=(0,ne.Z)({hours:Math.floor(i.total_time/60),minutes:i.total_time%60});return a}),(0,j.d)(1)),this.download=(0,k.Z)(function*(){const s=yield n.user_list.pipe((0,K.q)(1)).toPromise();(0,w.Sv)("report-space-attendee-usage.csv",(0,w.o3)(s))})}}function On(o,e){1&o&&(t.ynx(0),t._UZ(1,"report-spaces-overall")(2,"report-spaces-space-listing")(3,"report-spaces-user-listing"),t.BQk())}function Un(o,e){if(1&o&&(t.ynx(0),t.YNc(1,On,4,0,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&o){const n=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",s)}}function Ln(o,e){1&o&&(t.TgZ(0,"div",4),t._UZ(1,"mat-spinner",5),t.TgZ(2,"p",6),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function Rn(o,e){1&o&&(t.TgZ(0,"div",4)(1,"p",6),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}_t.\u0275fac=function(e){return new(e||_t)(t.Y36(M))},_t.\u0275cmp=t.Xpm({type:_t,selectors:[["report-spaces-user-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Meeting Organisers"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.qZA()),2&e&&(t.xp6(7),t.Q6J("dataSource",n.user_list)("pagination",!0)("columns",t.DdM(5,An))("display_column",t.DdM(6,Cn))("column_size",t.DdM(7,Mn)))},dependencies:[W.o,tt.C]});class vt{constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,Z.U)(n=>n.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}function Nn(o,e){1&o&&(t._uU(0),t.ALo(1,"date")),2&o&&t.hij(" ",t.xi3(1,1,e.data,"mediumDate")," ")}function En(o,e){1&o&&t._uU(0),2&o&&t.hij(" ",e.data||"0","% ")}vt.\u0275fac=function(e){return new(e||vt)(t.Y36(M))},vt.\u0275cmp=t.Xpm({type:vt,selectors:[["","report-spaces",""]],attrs:["report-spaces",""],decls:8,vars:4,consts:[[1,"relative","flex-1","h-1/2","w-full","overflow-auto","z-0"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,n){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,Un,3,4,"ng-container",1),t.ALo(3,"async"),t.qZA(),t.YNc(4,Ln,4,1,"ng-template",null,2,t.W1O),t.YNc(6,Rn,3,0,"ng-template",null,3,t.W1O)),2&e){const s=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,n.loading))("ngIfElse",s)}},dependencies:[x.O5,qt.Ou,Q,ft,gt,_t,x.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]});const Sn=function(){return["date","usage","approved","count","utilisation"]},kn=function(){return["Date","Used Desks","Approved Bookings","Total Requests","Utilisation"]},Dn=function(){return["flex"]},zn=function(o,e,n){return{date:o,usage:e,utilisation:n}};class yt{constructor(e){var n=this;this._state=e,this.day_list=this._state.day_list,this.download=(0,k.Z)(function*(){let s=yield n.day_list.pipe((0,K.q)(1)).toPromise();s=s.map(a=>({...a,date:(0,H.Z)(a.date,"MMMM d, y(EEE)")})),(0,w.Sv)("desks-usage.csv",(0,w.o3)(s))})}}function Yn(o,e){1&o&&t._uU(0),2&o&&t.hij(" ",e.data||"0","% ")}yt.\u0275fac=function(e){return new(e||yt)(t.Y36(M))},yt.\u0275cmp=t.Xpm({type:yt,selectors:[["report-desks-overall-list"]],decls:12,vars:13,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size","template"],["date_view",""],["percent_view",""]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Daily Utilisation"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.YNc(8,Nn,2,4,"ng-template",null,5,t.W1O),t.YNc(10,En,1,1,"ng-template",null,6,t.W1O),t.qZA()),2&e){const s=t.MAs(9),a=t.MAs(11);t.xp6(7),t.Q6J("dataSource",n.day_list)("pagination",!0)("columns",t.DdM(6,Sn))("display_column",t.DdM(7,kn))("column_size",t.DdM(8,Dn))("template",t.kEZ(9,zn,s,a,a))}},dependencies:[W.o,tt.C,x.uU],encapsulation:2});const In=function(){return["name","avg_usage","approved","count","utilisation"]},jn=function(){return["Level","Avg. Used Desks","Approved Bookings","Total Requests","Utilisation"]},Bn=function(){return["flex"]},qn=function(o){return{utilisation:o}};class xt{constructor(e,n){var s=this;this._state=e,this._org=n,this.level_list=(0,P.aj)([this._state.options,this._state.stats,this._state.counts]).pipe((0,Z.U)(([a,i,r])=>{const{start:l,end:d,zones:c}=a,p=(0,Kt.Z)(d,l)||1,h=[];for(const u of c){if("All"===u)continue;const f=this._org.levelWithID([u]),m=r[u]||0,A=i.events.filter(N=>N.zones.includes(u));let v=(m*p-A.length)/p;v%1!=0&&(v=v.toFixed(2)),h.push({name:f?.display_name||f?.name,free:v,approved:A.filter(N=>N.approved).length||0,avg_usage:A.length/p,total:m,count:A.length,utilisation:(A.length/((m||1)*p)*100||0).toFixed(2)})}return h}),(0,j.d)(1)),this.download=(0,k.Z)(function*(){let a=yield s.level_list.pipe((0,K.q)(1)).toPromise();(0,w.Sv)("desks-levels-usage.csv",(0,w.o3)(a))})}}xt.\u0275fac=function(e){return new(e||xt)(t.Y36(M),t.Y36(J.w7))},xt.\u0275cmp=t.Xpm({type:xt,selectors:[["report-desks-levels-list"]],decls:11,vars:11,consts:[[1,"px-4","mb-4","w-full"],[1,"rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden","w-full"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size","template"],["percent_view",""]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),t._uU(4,"Level Utilisation"),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return n.download()}),t.TgZ(6,"app-icon"),t._uU(7,"download"),t.qZA()()(),t._UZ(8,"custom-table",5),t.YNc(9,Yn,1,1,"ng-template",null,6,t.W1O),t.qZA()()),2&e){const s=t.MAs(10);t.xp6(8),t.Q6J("dataSource",n.level_list)("pagination",!0)("columns",t.DdM(6,In))("display_column",t.DdM(7,jn))("column_size",t.DdM(8,Bn))("template",t.VKq(9,qn,s))}},dependencies:[W.o,tt.C],encapsulation:2});const wt={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",ct:"http://gionkunz.github.com/chartist-js/ct"},Jn=8,Jt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function ye(o,e){return"number"==typeof o?o+e:o}function Pt(o){if("string"==typeof o){const e=/^(\d+)\s*(.*)$/g.exec(o);return{value:e?+e[1]:0,unit:e?.[2]||void 0}}return{value:Number(o)}}function se(o){return String.fromCharCode(97+o%26)}const oe=2221e-19;function Zt(o,e,n){return e/n.range*o}function Qn(o,e){const n=Math.pow(10,e||Jn);return Math.round(o*n)/n}function ae(o,e,n,s){const a=(s-90)*Math.PI/180;return{x:o+n*Math.cos(a),y:e+n*Math.sin(a)}}function et(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];for(let a=0;a<n.length;a++){const i=n[a];for(const r in i){const l=i[r];o[r]="object"!=typeof l||null===l||l instanceof Array?l:et(o[r],l)}}return o}const bt=o=>o;function Qt(o,e){return Array.from({length:o},e?(n,s)=>e(s):()=>{})}const Vn=(o,e)=>o+(e||0);function b(o,e){return null!==o&&"object"==typeof o&&Reflect.has(o,e)}function At(o){return null!==o&&isFinite(o)}function xe(o){return!o&&0!==o}function rt(o){return At(o)?Number(o):void 0}function Ze(o,e){const n=Array.isArray(o)?o[e]:b(o,"data")?o.data[e]:null;return b(n,"meta")?n.meta:void 0}function be(o){return null==o||"number"==typeof o&&isNaN(o)}function Ft(o){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";return function $n(o){return"object"==typeof o&&null!==o&&(Reflect.has(o,"x")||Reflect.has(o,"y"))}(o)&&b(o,e)?rt(o[e]):rt(o)}function ie(o){let a,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;const i={labels:(o.labels||[]).slice(),series:es(o.series,n,s)},r=i.labels.length;return function Wn(o){return!!Array.isArray(o)&&o.every(Array.isArray)}(i.series)?(a=Math.max(r,...i.series.map(l=>l.length)),i.series.forEach(l=>{l.push(...Qt(Math.max(0,a-l.length)))})):a=i.series.length,i.labels.push(...Qt(Math.max(0,a-r),()=>"")),e&&function Kn(o){var e;null===(e=o.labels)||void 0===e||e.reverse(),o.series.reverse();for(const n of o.series)b(n,"data")?n.data.reverse():Array.isArray(n)&&n.reverse()}(i),i}function Ae(o,e){if(!be(o))return e?function ts(o,e){let n,s;if("object"!=typeof o){const a=rt(o);"x"===e?n=a:s=a}else b(o,"x")&&(n=rt(o.x)),b(o,"y")&&(s=rt(o.y));if(void 0!==n||void 0!==s)return{x:n,y:s}}(o,e):rt(o)}function re(o,e){return Array.isArray(o)?o.map(n=>b(n,"value")?Ae(n.value,e):Ae(n,e)):re(o.data,e)}function es(o,e,n){if(function Hn(o){return Array.isArray(o)&&o.every(e=>Array.isArray(e)||b(e,"data"))}(o))return o.map(a=>re(a,e));const s=re(o,e);return n?s.map(a=>[a]):s}function Ct(o){let e="";return null==o?o:(e="number"==typeof o?""+o:"object"==typeof o?JSON.stringify({data:o}):String(o),Object.keys(Jt).reduce((n,s)=>n.replaceAll(s,Jt[s]),e))}class ns{call(e,n){return this.svgElements.forEach(s=>Reflect.apply(s[e],s,n)),this}attr(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("attr",n)}elem(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("elem",n)}root(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("root",n)}getNode(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("getNode",n)}foreignObject(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("foreignObject",n)}text(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("text",n)}empty(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("empty",n)}remove(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("remove",n)}addClass(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("addClass",n)}removeClass(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("removeClass",n)}removeAllClasses(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("removeAllClasses",n)}animate(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];return this.call("animate",n)}constructor(e){this.svgElements=[];for(let n=0;n<e.length;n++)this.svgElements.push(new Oe(e[n]))}}const Me={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]};function Te(o,e,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;const{easing:i,...r}=n,l={};let d,c;i&&(d=Array.isArray(i)?i:Me[i]),r.begin=ye(r.begin,"ms"),r.dur=ye(r.dur,"ms"),d&&(r.calcMode="spline",r.keySplines=d.join(" "),r.keyTimes="0;1"),s&&(r.fill="freeze",l[e]=r.from,o.attr(l),c=Pt(r.begin||0).value,r.begin="indefinite");const p=o.elem("animate",{attributeName:e,...r});s&&setTimeout(()=>{try{p._node.beginElement()}catch{l[e]=r.to,o.attr(l),p.remove()}},c);const h=p.getNode();a&&h.addEventListener("beginEvent",()=>a.emit("animationBegin",{element:o,animate:h,params:n})),h.addEventListener("endEvent",()=>{a&&a.emit("animationEnd",{element:o,animate:h,params:n}),s&&(l[e]=r.to,o.attr(l),p.remove())})}let Oe=(()=>{class o{attr(n,s){return"string"==typeof n?s?this._node.getAttributeNS(s,n):this._node.getAttribute(n):(Object.keys(n).forEach(a=>{if(void 0!==n[a])if(-1!==a.indexOf(":")){const i=a.split(":");this._node.setAttributeNS(wt[i[0]],a,String(n[a]))}else this._node.setAttribute(a,String(n[a]))}),this)}elem(n,s,a){return new o(n,s,a,this,arguments.length>3&&void 0!==arguments[3]&&arguments[3])}parent(){return this._node.parentNode instanceof SVGElement?new o(this._node.parentNode):null}root(){let n=this._node;for(;"svg"!==n.nodeName&&n.parentElement;)n=n.parentElement;return new o(n)}querySelector(n){const s=this._node.querySelector(n);return s?new o(s):null}querySelectorAll(n){const s=this._node.querySelectorAll(n);return new ns(s)}getNode(){return this._node}foreignObject(n,s,a){let r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"==typeof n){const d=document.createElement("div");d.innerHTML=n,r=d.firstChild}else r=n;r instanceof Element&&r.setAttribute("xmlns",wt.xmlns);const l=this.elem("foreignObject",s,a,i);return l._node.appendChild(r),l}text(n){return this._node.appendChild(document.createTextNode(n)),this}empty(){for(;this._node.firstChild;)this._node.removeChild(this._node.firstChild);return this}remove(){var n;return null===(n=this._node.parentNode)||void 0===n||n.removeChild(this._node),this.parent()}replace(n){var s;return null===(s=this._node.parentNode)||void 0===s||s.replaceChild(n._node,this._node),n}append(n){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this._node.firstChild?this._node.insertBefore(n._node,this._node.firstChild):this._node.appendChild(n._node),this}classes(){const n=this._node.getAttribute("class");return n?n.trim().split(/\s+/):[]}addClass(n){return this._node.setAttribute("class",this.classes().concat(n.trim().split(/\s+/)).filter(function(s,a,i){return i.indexOf(s)===a}).join(" ")),this}removeClass(n){const s=n.trim().split(/\s+/);return this._node.setAttribute("class",this.classes().filter(a=>-1===s.indexOf(a)).join(" ")),this}removeAllClasses(){return this._node.setAttribute("class",""),this}height(){return this._node.getBoundingClientRect().height}width(){return this._node.getBoundingClientRect().width}animate(n){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0;return Object.keys(n).forEach(i=>{const r=n[i];Array.isArray(r)?r.forEach(l=>Te(this,i,l,!1,a)):Te(this,i,r,s,a)}),this}constructor(n,s,a,i,r=!1){n instanceof Element?this._node=n:(this._node=document.createElementNS(wt.svg,n),"svg"===n&&this.attr({"xmlns:ct":wt.ct})),s&&this.attr(s),a&&this.addClass(a),i&&(r&&i._node.firstChild?i._node.insertBefore(this._node,i._node.firstChild):i._node.appendChild(this._node))}}return o.Easing=Me,o})();function le(o){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"100%",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"100%",s=arguments.length>3?arguments[3]:void 0;Array.from(o.querySelectorAll("svg")).filter(i=>i.getAttributeNS(wt.xmlns,"ct")).forEach(i=>o.removeChild(i));const a=new Oe("svg").attr({width:e,height:n}).attr({style:"width: ".concat(e,"; height: ").concat(n,";")});return s&&a.addClass(s),o.appendChild(a.getNode()),a}function ce(o,e){var n,s,a,i;const r=Boolean(e.axisX||e.axisY),l=(null===(n=e.axisY)||void 0===n?void 0:n.offset)||0,d=(null===(s=e.axisX)||void 0===s?void 0:s.offset)||0,c=null===(a=e.axisY)||void 0===a?void 0:a.position,p=null===(i=e.axisX)||void 0===i?void 0:i.position;let h=o.width()||Pt(e.width).value||0,u=o.height()||Pt(e.height).value||0;const f=function ss(o){return"number"==typeof o?{top:o,right:o,bottom:o,left:o}:void 0===o?{top:0,right:0,bottom:0,left:0}:{top:"number"==typeof o.top?o.top:0,right:"number"==typeof o.right?o.right:0,bottom:"number"==typeof o.bottom?o.bottom:0,left:"number"==typeof o.left?o.left:0}}(e.chartPadding);h=Math.max(h,l+f.left+f.right),u=Math.max(u,d+f.top+f.bottom);const m={x1:0,x2:0,y1:0,y2:0,padding:f,width(){return this.x2-this.x1},height(){return this.y1-this.y2}};return r?("start"===p?(m.y2=f.top+d,m.y1=Math.max(u-f.bottom,m.y2+1)):(m.y2=f.top,m.y1=Math.max(u-f.bottom-d,m.y2+1)),"start"===c?(m.x1=f.left+l,m.x2=Math.max(h-f.right,m.x1+1)):(m.x1=f.left,m.x2=Math.max(h-f.right-l,m.x1+1))):(m.x1=f.left,m.x2=Math.max(h-f.right,m.x1+1),m.y2=f.top,m.y1=Math.max(u-f.bottom,m.y2+1)),m}function Le(o,e,n){let s;const a=[];function i(l){const d=s;s=et({},o),e&&e.forEach(c=>{window.matchMedia(c[0]).matches&&(s=et(s,c[1]))}),n&&l&&n.emit("optionsChanged",{previousOptions:d,currentOptions:s})}if(!window.matchMedia)throw new Error("window.matchMedia not found! Make sure you're using a polyfill.");return e&&e.forEach(l=>{const d=window.matchMedia(l[0]);d.addEventListener("change",i),a.push(d)}),i(),{removeMediaQueryListeners:function r(){a.forEach(l=>l.removeEventListener("change",i))},getCurrentOptions:()=>s}}const ue={m:["x","y"],l:["x","y"],c:["x1","y1","x2","y2","x","y"],a:["rx","ry","xAr","lAf","sf","x","y"]},is={accuracy:3};function Vt(o,e,n,s,a,i){const r={command:a?o.toLowerCase():o.toUpperCase(),...e,...i?{data:i}:{}};n.splice(s,0,r)}function de(o,e){o.forEach((n,s)=>{ue[n.command.toLowerCase()].forEach((a,i)=>{e(n,a,s,i,o)})})}class R{static join(e){const a=new R(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2?arguments[2]:void 0);for(let i=0;i<e.length;i++){const r=e[i];for(let l=0;l<r.pathElements.length;l++)a.pathElements.push(r.pathElements[l])}return a}position(e){return void 0!==e?(this.pos=Math.max(0,Math.min(this.pathElements.length,e)),this):this.pos}remove(e){return this.pathElements.splice(this.pos,e),this}move(e,n){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;return Vt("M",{x:+e,y:+n},this.pathElements,this.pos++,s,a),this}line(e,n){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;return Vt("L",{x:+e,y:+n},this.pathElements,this.pos++,s,a),this}curve(e,n,s,a,i,r){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0;return Vt("C",{x1:+e,y1:+n,x2:+s,y2:+a,x:+i,y:+r},this.pathElements,this.pos++,l,d),this}arc(e,n,s,a,i,r,l){let d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;return Vt("A",{rx:e,ry:n,xAr:s,lAf:a,sf:i,x:r,y:l},this.pathElements,this.pos++,d,c),this}parse(e){const n=e.replace(/([A-Za-z])(-?[0-9])/g,"$1 $2").replace(/([0-9])([A-Za-z])/g,"$1 $2").split(/[\s,]+/).reduce((a,i)=>(i.match(/[A-Za-z]/)&&a.push([]),a[a.length-1].push(i),a),[]);"Z"===n[n.length-1][0].toUpperCase()&&n.pop();const s=n.map(a=>{const i=a.shift(),r=ue[i.toLowerCase()];return{command:i,...r.reduce((l,d,c)=>(l[d]=+a[c],l),{})}});return this.pathElements.splice(this.pos,0,...s),this.pos+=s.length,this}stringify(){const e=Math.pow(10,this.options.accuracy);return this.pathElements.reduce((n,s)=>{const a=ue[s.command.toLowerCase()].map(i=>{const r=s[i];return this.options.accuracy?Math.round(r*e)/e:r});return n+s.command+a.join(",")},"")+(this.close?"Z":"")}scale(e,n){return de(this.pathElements,(s,a)=>{s[a]*="x"===a[0]?e:n}),this}translate(e,n){return de(this.pathElements,(s,a)=>{s[a]+="x"===a[0]?e:n}),this}transform(e){return de(this.pathElements,(n,s,a,i,r)=>{const l=e(n,s,a,i,r);(l||0===l)&&(n[s]=l)}),this}clone(){const n=new R(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.close);return n.pos=this.pos,n.pathElements=this.pathElements.slice().map(s=>({...s})),n.options={...this.options},n}splitByCommand(e){const n=[new R];return this.pathElements.forEach(s=>{s.command===e.toUpperCase()&&0!==n[n.length-1].pathElements.length&&n.push(new R),n[n.length-1].pathElements.push(s)}),n}constructor(e=!1,n){this.close=e,this.pathElements=[],this.pos=0,this.options={...is,...n}}}function lt(o){const e={fillHoles:!1,...o};return function(s,a){const i=new R;let r=!0;for(let l=0;l<s.length;l+=2){const d=s[l],c=s[l+1],p=a[l/2];void 0!==Ft(p.value)?(r?i.move(d,c,!1,p):i.line(d,c,!1,p),r=!1):e.fillHoles||(r=!0)}return i}}function Re(o){const e={fillHoles:!1,...o};return function n(s,a){const i=function Ce(o,e,n){const s={increasingX:!1,fillHoles:!1,...n},a=[];let i=!0;for(let r=0;r<o.length;r+=2)void 0===Ft(e[r/2].value)?s.fillHoles||(i=!0):(s.increasingX&&r>=2&&o[r]<=o[r-2]&&(i=!0),i&&(a.push({pathCoordinates:[],valueData:[]}),i=!1),a[a.length-1].pathCoordinates.push(o[r],o[r+1]),a[a.length-1].valueData.push(e[r/2]));return a}(s,a,{fillHoles:e.fillHoles,increasingX:!0});if(i.length){if(i.length>1)return R.join(i.map(r=>n(r.pathCoordinates,r.valueData)));{if(a=i[0].valueData,(s=i[0].pathCoordinates).length<=4)return lt()(s,a);const r=[],l=[],d=s.length/2,c=[],p=[],h=[],u=[];for(let m=0;m<d;m++)r[m]=s[2*m],l[m]=s[2*m+1];for(let m=0;m<d-1;m++)h[m]=l[m+1]-l[m],u[m]=r[m+1]-r[m],p[m]=h[m]/u[m];c[0]=p[0],c[d-1]=p[d-2];for(let m=1;m<d-1;m++)0===p[m]||0===p[m-1]||p[m-1]>0!=p[m]>0?c[m]=0:(c[m]=3*(u[m-1]+u[m])/((2*u[m]+u[m-1])/p[m-1]+(u[m]+2*u[m-1])/p[m]),isFinite(c[m])||(c[m]=0));const f=(new R).move(r[0],l[0],!1,a[0]);for(let m=0;m<d-1;m++)f.curve(r[m]+u[m]/3,l[m]+c[m]*u[m]/3,r[m+1]-u[m]/3,l[m+1]-c[m+1]*u[m]/3,r[m+1],l[m+1],!1,a[m+1]);return f}}return lt()([],[])}}class us{on(e,n){const{allListeners:s,listeners:a}=this;"*"===e?s.add(n):(a.has(e)||a.set(e,new Set),a.get(e).add(n))}off(e,n){const{allListeners:s,listeners:a}=this;if("*"===e)n?s.delete(n):s.clear();else if(a.has(e)){const i=a.get(e);n?i.delete(n):i.clear(),i.size||a.delete(e)}}emit(e,n){const{allListeners:s,listeners:a}=this;a.has(e)&&a.get(e).forEach(i=>i(n)),s.forEach(i=>i(e,n))}constructor(){this.listeners=new Map,this.allListeners=new Set}}const pe=new WeakMap;class Ne{update(e,n){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a;return e&&(this.data=e||{},this.data.labels=this.data.labels||[],this.data.series=this.data.series||[],this.eventEmitter.emit("data",{type:"update",data:this.data})),n&&(this.options=et({},s?this.options:this.defaultOptions,n),!this.initializeTimeoutId)&&(null===(a=this.optionsProvider)||void 0===a||a.removeMediaQueryListeners(),this.optionsProvider=Le(this.options,this.responsiveOptions,this.eventEmitter)),!this.initializeTimeoutId&&this.optionsProvider&&this.createChart(this.optionsProvider.getCurrentOptions()),this}detach(){var e;return this.initializeTimeoutId?window.clearTimeout(this.initializeTimeoutId):(window.removeEventListener("resize",this.resizeListener),null===(e=this.optionsProvider)||void 0===e||e.removeMediaQueryListeners()),pe.delete(this.container),this}on(e,n){return this.eventEmitter.on(e,n),this}off(e,n){return this.eventEmitter.off(e,n),this}initialize(){window.addEventListener("resize",this.resizeListener),this.optionsProvider=Le(this.options,this.responsiveOptions,this.eventEmitter),this.eventEmitter.on("optionsChanged",()=>this.update()),this.options.plugins&&this.options.plugins.forEach(e=>{Array.isArray(e)?e[0](this,e[1]):e(this)}),this.eventEmitter.emit("data",{type:"initial",data:this.data}),this.createChart(this.optionsProvider.getCurrentOptions()),this.initializeTimeoutId=null}constructor(e,n,s,a,i){this.data=n,this.defaultOptions=s,this.options=a,this.responsiveOptions=i,this.eventEmitter=new us,this.resizeListener=()=>this.update(),this.initializeTimeoutId=setTimeout(()=>this.initialize(),0);const r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error("Target element is not found");this.container=r;const l=pe.get(r);l&&l.detach(),pe.set(r,this)}}const U={x:{pos:"x",len:"width",dir:"horizontal",rectStart:"x1",rectEnd:"x2",rectOffset:"y2"},y:{pos:"y",len:"height",dir:"vertical",rectStart:"y2",rectEnd:"y1",rectOffset:"x1"}};class Ee{createGridAndLabels(e,n,s,a){const i="x"===this.units.pos?s.axisX:s.axisY,r=this.ticks.map((d,c)=>this.projectValue(d,c)),l=this.ticks.map(i.labelInterpolationFnc);r.forEach((d,c)=>{const p=l[c],h={x:0,y:0};let u;u=r[c+1]?r[c+1]-d:Math.max(this.axisLength-d,this.axisLength/this.ticks.length),(""===p||!xe(p))&&("x"===this.units.pos?(d=this.chartRect.x1+d,h.x=s.axisX.labelOffset.x,h.y="start"===s.axisX.position?this.chartRect.padding.top+s.axisX.labelOffset.y+5:this.chartRect.y1+s.axisX.labelOffset.y+5):(d=this.chartRect.y1-d,h.y=s.axisY.labelOffset.y-u,h.x="start"===s.axisY.position?this.chartRect.padding.left+s.axisY.labelOffset.x:this.chartRect.x2+s.axisY.labelOffset.x+10),i.showGrid&&function os(o,e,n,s,a,i,r,l){const d={["".concat(n.units.pos,"1")]:o,["".concat(n.units.pos,"2")]:o,["".concat(n.counterUnits.pos,"1")]:s,["".concat(n.counterUnits.pos,"2")]:s+a},c=i.elem("line",d,r.join(" "));l.emit("draw",{type:"grid",axis:n,index:e,group:i,element:c,...d})}(d,c,this,this.gridOffset,this.chartRect[this.counterUnits.len](),e,[s.classNames.grid,s.classNames[this.units.dir]],a),i.showLabel&&function as(o,e,n,s,a,i,r,l,d,c){const p={[a.units.pos]:o+r[a.units.pos],[a.counterUnits.pos]:r[a.counterUnits.pos],[a.units.len]:e,[a.counterUnits.len]:Math.max(0,i-10)},h=Math.round(p[a.units.len]),u=Math.round(p[a.counterUnits.len]),f=document.createElement("span");f.className=d.join(" "),f.style[a.units.len]=h+"px",f.style[a.counterUnits.len]=u+"px",f.textContent=String(s);const m=l.foreignObject(f,{style:"overflow: visible;",...p});c.emit("draw",{type:"label",axis:a,index:n,group:l,element:m,text:s,...p})}(d,u,c,p,this,i.offset,h,n,[s.classNames.label,s.classNames[this.units.dir],"start"===i.position?s.classNames[i.position]:s.classNames.end],a))})}constructor(e,n,s){this.units=e,this.chartRect=n,this.ticks=s,this.counterUnits=e===U.x?U.y:U.x,this.axisLength=n[this.units.rectEnd]-n[this.units.rectStart],this.gridOffset=n[this.units.rectOffset]}}class me extends Ee{projectValue(e){const n=Number(Ft(e,this.units.pos));return this.axisLength*(n-this.bounds.min)/this.bounds.range}constructor(e,n,s,a){const i=a.highLow||function Xt(o,e,n){const s={high:void 0===(e={...e,...n?"x"===n?e.axisX:e.axisY:{}}).high?-Number.MAX_VALUE:+e.high,low:void 0===e.low?Number.MAX_VALUE:+e.low},a=void 0===e.high,i=void 0===e.low;return(a||i)&&function r(l){if(!be(l))if(Array.isArray(l))for(let d=0;d<l.length;d++)r(l[d]);else{const d=Number(n&&b(l,n)?l[n]:l);a&&d>s.high&&(s.high=d),i&&d<s.low&&(s.low=d)}}(o),(e.referenceValue||0===e.referenceValue)&&(s.high=Math.max(e.referenceValue,s.high),s.low=Math.min(e.referenceValue,s.low)),s.high<=s.low&&(0===s.low?s.high=1:s.low<0?s.high=0:(s.high>0||(s.high=1),s.low=0)),s}(n,a,e.pos),r=function Xn(o,e,n){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={high:e.high,low:e.low,valueRange:0,oom:0,step:0,min:0,max:0,range:0,numberOfSteps:0,values:[]};a.valueRange=a.high-a.low,a.oom=function Pn(o){return Math.floor(Math.log(Math.abs(o))/Math.LN10)}(a.valueRange),a.step=Math.pow(10,a.oom),a.min=Math.floor(a.low/a.step)*a.step,a.max=Math.ceil(a.high/a.step)*a.step,a.range=a.max-a.min,a.numberOfSteps=Math.round(a.range/a.step);const r=Zt(o,a.step,a)<n,l=s?function Fn(o){if(1===o)return o;function e(r,l){return r%l==0?l:e(l,r%l)}function n(r){return r*r+1}let i,s=2,a=2;if(o%2==0)return 2;do{s=n(s)%o,a=n(n(a))%o,i=e(Math.abs(s-a),o)}while(1===i);return i}(a.range):0;if(s&&Zt(o,1,a)>=n)a.step=1;else if(s&&l<a.step&&Zt(o,l,a)>=n)a.step=l;else{let u=0;for(;;){if(r&&Zt(o,a.step,a)<=n)a.step*=2;else{if(r||!(Zt(o,a.step/2,a)>=n))break;if(a.step/=2,s&&a.step%1!=0){a.step*=2;break}}if(u++>1e3)throw new Error("Exceeded maximum number of iterations while optimizing scale step!")}}function d(u,f){return u===(u+=f)&&(u*=1+(f>0?oe:-oe)),u}a.step=Math.max(a.step,oe);let c=a.min,p=a.max;for(;c+a.step<=a.low;)c=d(c,a.step);for(;p-a.step>=a.high;)p=d(p,-a.step);a.min=c,a.max=p,a.range=a.max-a.min;const h=[];for(let u=a.min;u<=a.max;u=d(u,a.step)){const f=Qn(u);f!==h[h.length-1]&&h.push(f)}return a.values=h,a}(s[e.rectEnd]-s[e.rectStart],i,a.scaleMinSpace||20,a.onlyInteger),l={min:r.min,max:r.max};super(e,s,r.values),this.bounds=r,this.range=l}}class Gt extends Ee{projectValue(e,n){return this.stepLength*n}constructor(e,n,s,a){const i=a.ticks||[];super(e,s,i);const r=Math.max(1,i.length-(a.stretch?1:0));this.stepLength=this.axisLength/r,this.stretch=Boolean(a.stretch)}}function Mt(o,e,n){var s;if(b(o,"name")&&o.name&&null!==(s=e.series)&&void 0!==s&&s[o.name]){const i=e?.series[o.name][n];return void 0===i?e[n]:i}return e[n]}const Se={axisX:{offset:30,position:"end",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:bt,type:void 0},axisY:{offset:40,position:"start",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:bt,type:void 0,scaleMinSpace:20,onlyInteger:!1},width:void 0,height:void 0,showLine:!0,showPoint:!0,showArea:!1,areaBase:0,lineSmooth:!0,showGridBackground:!1,low:void 0,high:void 0,chartPadding:{top:15,right:15,bottom:5,left:10},fullWidth:!1,reverseData:!1,classNames:{chart:"ct-chart-line",label:"ct-label",labelGroup:"ct-labels",series:"ct-series",line:"ct-line",point:"ct-point",area:"ct-area",grid:"ct-grid",gridGroup:"ct-grids",gridBackground:"ct-grid-background",vertical:"ct-vertical",horizontal:"ct-horizontal",start:"ct-start",end:"ct-end"}};class ds extends Ne{createChart(e){const{data:n}=this,s=ie(n,e.reverseData,!0),a=le(this.container,e.width,e.height,e.classNames.chart);this.svg=a;const i=a.elem("g").addClass(e.classNames.gridGroup),r=a.elem("g"),l=a.elem("g").addClass(e.classNames.labelGroup),d=ce(a,e);let c,p;c=void 0===e.axisX.type?new Gt(U.x,s.series,d,{...e.axisX,ticks:s.labels,stretch:e.fullWidth}):new e.axisX.type(U.x,s.series,d,e.axisX),p=void 0===e.axisY.type?new me(U.y,s.series,d,{...e.axisY,high:At(e.high)?e.high:e.axisY.high,low:At(e.low)?e.low:e.axisY.low}):new e.axisY.type(U.y,s.series,d,e.axisY),c.createGridAndLabels(i,l,e,this.eventEmitter),p.createGridAndLabels(i,l,e,this.eventEmitter),e.showGridBackground&&function Ue(o,e,n,s){const a=o.elem("rect",{x:e.x1,y:e.y2,width:e.width(),height:e.height()},n,!0);s.emit("draw",{type:"gridBackground",group:o,element:a})}(i,d,e.classNames.gridBackground,this.eventEmitter),function we(o,e){let s=0;o[arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"reduceRight":"reduce"]((a,i,r)=>e(i,s++,r),void 0)}(n.series,(h,u)=>{const f=r.elem("g"),m=b(h,"name")&&h.name,A=b(h,"className")&&h.className,v=b(h,"meta")?h.meta:void 0;m&&f.attr({"ct:series-name":m}),v&&f.attr({"ct:meta":Ct(v)}),f.addClass([e.classNames.series,A||"".concat(e.classNames.series,"-").concat(se(u))].join(" "));const N=[],B=[];s.series[u].forEach((_,y)=>{const C={x:d.x1+c.projectValue(_,y,s.series[u]),y:d.y1-p.projectValue(_,y,s.series[u])};N.push(C.x,C.y),B.push({value:_,valueIndex:y,meta:Ze(h,y)})});const S={lineSmooth:Mt(h,e,"lineSmooth"),showPoint:Mt(h,e,"showPoint"),showLine:Mt(h,e,"showLine"),showArea:Mt(h,e,"showArea"),areaBase:Mt(h,e,"areaBase")};let Y;Y="function"==typeof S.lineSmooth?S.lineSmooth:S.lineSmooth?Re():lt();const T=Y(N,B);if(S.showPoint&&T.pathElements.forEach(_=>{const{data:y}=_,C=f.elem("line",{x1:_.x,y1:_.y,x2:_.x+.01,y2:_.y},e.classNames.point);if(y){let O,D;b(y.value,"x")&&(O=y.value.x),b(y.value,"y")&&(D=y.value.y),C.attr({"ct:value":[O,D].filter(At).join(","),"ct:meta":Ct(y.meta)})}this.eventEmitter.emit("draw",{type:"point",value:y?.value,index:y?.valueIndex||0,meta:y?.meta,series:h,seriesIndex:u,axisX:c,axisY:p,group:f,element:C,x:_.x,y:_.y,chartRect:d})}),S.showLine){const _=f.elem("path",{d:T.stringify()},e.classNames.line,!0);this.eventEmitter.emit("draw",{type:"line",values:s.series[u],path:T.clone(),chartRect:d,index:u,series:h,seriesIndex:u,meta:v,axisX:c,axisY:p,group:f,element:_})}if(S.showArea&&p.range){const _=Math.max(Math.min(S.areaBase,p.range.max),p.range.min),y=d.y1-p.projectValue(_);T.splitByCommand("M").filter(C=>C.pathElements.length>1).map(C=>{const O=C.pathElements[0],D=C.pathElements[C.pathElements.length-1];return C.clone(!0).position(0).remove(1).move(O.x,y).line(O.x,O.y).position(C.pathElements.length+1).line(D.x,y)}).forEach(C=>{const O=f.elem("path",{d:C.stringify()},e.classNames.area,!0);this.eventEmitter.emit("draw",{type:"area",values:s.series[u],path:C.clone(),series:h,seriesIndex:u,axisX:c,axisY:p,chartRect:d,index:u,group:f,element:O,meta:v})})}},e.reverseData),this.eventEmitter.emit("created",{chartRect:d,axisX:c,axisY:p,svg:a,options:e})}constructor(e,n,s,a){super(e,n,Se,et({},Se,s),a),this.data=n}}const De={width:void 0,height:void 0,chartPadding:5,classNames:{chartPie:"ct-chart-pie",chartDonut:"ct-chart-donut",series:"ct-series",slicePie:"ct-slice-pie",sliceDonut:"ct-slice-donut",label:"ct-label"},startAngle:0,total:void 0,donut:!1,donutWidth:60,showLabel:!0,labelOffset:0,labelPosition:"inside",labelInterpolationFnc:bt,labelDirection:"neutral",ignoreEmptyValues:!1};function ms(o,e,n){const s=e.x>o.x;return s&&"explode"===n||!s&&"implode"===n?"start":s&&"implode"===n||!s&&"explode"===n?"end":"middle"}class hs extends Ne{createChart(e){const{data:n}=this,s=ie(n),a=[];let i,r,l=e.startAngle;const d=le(this.container,e.width,e.height,e.donut?e.classNames.chartDonut:e.classNames.chartPie);this.svg=d;const c=ce(d,e);let p=Math.min(c.width()/2,c.height()/2);const h=e.total||s.series.reduce(Vn,0),u=Pt(e.donutWidth);"%"===u.unit&&(u.value*=p/100),p-=e.donut?u.value/2:0,r="outside"===e.labelPosition||e.donut?p:"center"===e.labelPosition?0:p/2,e.labelOffset&&(r+=e.labelOffset);const f={x:c.x1+c.width()/2,y:c.y2+c.height()/2},m=1===n.series.filter(A=>b(A,"value")?0!==A.value:0!==A).length;n.series.forEach((A,v)=>a[v]=d.elem("g")),e.showLabel&&(i=d.elem("g")),n.series.forEach((A,v)=>{var N,B;if(0===s.series[v]&&e.ignoreEmptyValues)return;const S=b(A,"name")&&A.name,Y=b(A,"className")&&A.className,T=b(A,"meta")?A.meta:void 0;S&&a[v].attr({"ct:series-name":S}),a[v].addClass([null===(N=e.classNames)||void 0===N?void 0:N.series,Y||"".concat(null===(B=e.classNames)||void 0===B?void 0:B.series,"-").concat(se(v))].join(" "));let _=h>0?l+s.series[v]/h*360:0;const y=Math.max(0,l-(0===v||m?0:.2));_-y>=359.99&&(_=y+359.99);const C=ae(f.x,f.y,p,y),O=ae(f.x,f.y,p,_),D=new R(!e.donut).move(O.x,O.y).arc(p,p,0,Number(_-l>180),0,C.x,C.y);e.donut||D.line(f.x,f.y);const Dt=a[v].elem("path",{d:D.stringify()},e.donut?e.classNames.sliceDonut:e.classNames.slicePie);if(Dt.attr({"ct:value":s.series[v],"ct:meta":Ct(T)}),e.donut&&Dt.attr({style:"stroke-width: "+u.value+"px"}),this.eventEmitter.emit("draw",{type:"slice",value:s.series[v],totalDataSum:h,index:v,meta:T,series:A,group:a[v],element:Dt,path:D.clone(),center:f,radius:p,startAngle:l,endAngle:_,chartRect:c}),e.showLabel){let q,I;q=1===n.series.length?{x:f.x,y:f.y}:ae(f.x,f.y,r,l+(_-l)/2),I=s.labels&&!xe(s.labels[v])?s.labels[v]:s.series[v];const E=e.labelInterpolationFnc(I,v);if(E||0===E){const ut=i.elem("text",{dx:q.x,dy:q.y,"text-anchor":ms(f,q,e.labelDirection)},e.classNames.label).text(String(E));this.eventEmitter.emit("draw",{type:"label",index:v,group:i,element:ut,text:""+E,chartRect:c,series:A,meta:T,...q})}}l=_}),this.eventEmitter.emit("created",{chartRect:c,svg:d,options:e})}constructor(e,n,s,a){super(e,n,De,et({},De,s),a),this.data=n}}class Tt extends w.cx{constructor(e,n){super(),this._state=e,this._org=n,this.day_list=this._state.day_list,this.stats=(0,P.aj)([this._state.options,this._state.counts])}ngOnInit(){this.subscription("day_list",this.day_list.subscribe(e=>this.updateDailyChart(e))),this.subscription("stats",this.stats.subscribe(([e,n])=>this.updateLevelChart(e,n)))}updateDailyChart(e){const n={labels:e.map(s=>(0,H.Z)(s.date,"dd MMM")),series:[e.map(s=>s.utilisation)]};this._day_chart=new ds("#day-chart",n)}updateLevelChart(e,n){let{zones:s}=e||{};s.includes("All")&&(s=this._org.levels.filter(i=>i.parent_id===this._org.building.id).map(i=>i.id));const a={labels:(s||[]).map(i=>{const r=this._org.levelWithID([i]);return r?.display_name||r.name||""}),series:(s||[]).map(i=>n[i])};this._level_chart=new hs("#level-chart",a)}}function gs(o,e){if(1&o&&(t.ynx(0),t.TgZ(1,"div",4)(2,"div",5)(3,"h3"),t._uU(4,"Total Bookings"),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"div",5)(9,"h3"),t._uU(10,"Utilisation"),t.qZA(),t.TgZ(11,"p"),t._uU(12),t.ALo(13,"async"),t.qZA()()(),t._UZ(14,"report-desks-charts")(15,"report-desks-overall-list")(16,"report-desks-levels-list"),t.BQk()),2&o){const n=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,2,n.total_count)||0),t.xp6(6),t.hij("",t.lcZ(13,4,n.utilisation)||0,"%")}}function _s(o,e){if(1&o&&(t.ynx(0),t.YNc(1,gs,17,6,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&o){const n=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",s)}}function vs(o,e){1&o&&(t.TgZ(0,"div",6),t._UZ(1,"mat-spinner",7),t.TgZ(2,"p",8),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function ys(o,e){1&o&&(t.TgZ(0,"div",6)(1,"p",8),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}Tt.\u0275fac=function(e){return new(e||Tt)(t.Y36(M),t.Y36(J.w7))},Tt.\u0275cmp=t.Xpm({type:Tt,selectors:[["report-desks-charts"]],features:[t.qOj],decls:11,vars:0,consts:[[1,"flex","items-center","space-x-4","w-full","px-4"],[1,"bg-white","dark:bg-neutral-700","rounded","shadow","flex-1"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","text-xl","font-bold"],["id","day-chart",1,"ct-chart","ct-octave"],["util_chart",""],["id","level-chart",1,"ct-chart","ct-octave"],["level_chart",""]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3," Daily Utilisation "),t.qZA(),t._UZ(4,"div",3,4),t.qZA(),t.TgZ(6,"div",1)(7,"div",2),t._uU(8," Level Utilisation "),t.qZA(),t._UZ(9,"div",5,6),t.qZA()())},styles:["[_nghost-%COMP%]{display:block}"]});class Ot{constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,Z.U)(n=>n.count||0)),this.utilisation=this._state.stats.pipe((0,Z.U)(n=>(100*(n.utilisation||0)).toFixed(1))),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"desks"})}}Ot.\u0275fac=function(e){return new(e||Ot)(t.Y36(M))},Ot.\u0275cmp=t.Xpm({type:Ot,selectors:[["","report-desks",""]],attrs:["report-desks",""],decls:8,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,n){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,_s,3,4,"ng-container",1),t.ALo(3,"async"),t.YNc(4,vs,4,1,"ng-template",null,2,t.W1O),t.YNc(6,ys,3,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const s=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,n.loading))("ngIfElse",s)}},dependencies:[x.O5,qt.Ou,Q,yt,xt,Tt,x.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}"]});var ze=g(1950);class F{constructor(e){this._reports=e,this.catering_orders=this._reports.bookings.pipe((0,Z.U)(n=>(0,w.xH)(n.filter(a=>a.extension_data?.catering?.length).map(a=>a.extension_data?.catering.map(i=>new ze.GX({...i,deliver_at:a.date,event:a})))).filter(a=>a).sort((a,i)=>a.event?.date-i.event?.date)),(0,j.d)(1)),this.catering_items=this.catering_orders.pipe((0,Z.U)(n=>{const s=[];for(const a of n)for(const i of a?.items||[]){const r=s.findIndex(l=>i.options_string===l.options_string);r>=0?i[r]=new ze.Ud({...i,quantity:i?.quantity+i[r]?.quantity}):s.push(i)}return s.sort((a,i)=>i.quantity-a.quantity)})),this.stats=(0,P.aj)([this.catering_orders,this.catering_items]).pipe((0,Z.U)(([n,s])=>{const a=n.reduce((i,r)=>i+r.total_cost,0);return{order_count:n.length,unique_items:s.length,item_count:n.reduce((i,r)=>i+r.item_count,0),total_cost:a,avg_cost:a/n.length}}))}downloadOrders(){var e=this;return(0,k.Z)(function*(){const n=yield e.catering_orders.pipe((0,K.q)(1)).toPromise(),s=(0,w.o3)(n);return(0,w.Sv)("catering-orders.csv",s)})()}}F.\u0275fac=function(e){return new(e||F)(t.LFG(M))},F.\u0275prov=t.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"});class Ut{get code(){return this._org.currency_code}constructor(e,n){this._report=e,this._org=n,this.stats=this._report.stats}}Ut.\u0275fac=function(e){return new(e||Ut)(t.Y36(F),t.Y36(J.w7))},Ut.\u0275cmp=t.Xpm({type:Ut,selectors:[["catering-report-overall"]],decls:32,vars:21,consts:[[1,"bg-white","dark:bg-neutral-700","shadow","rounded","m-2","px-8","w-48","h-24","flex","flex-col","items-center","justify-center"],["count","",1,"text-3xl"],[1,""],["unique","",1,"text-3xl"],["items","",1,"text-3xl"],["total","",1,"text-3xl"],["average","",1,"text-3xl"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"div",2),t._uU(5,"Orders"),t.qZA()(),t.TgZ(6,"div",0)(7,"div",3),t._uU(8),t.ALo(9,"async"),t.qZA(),t.TgZ(10,"div",2),t._uU(11,"Unique Items"),t.qZA()(),t.TgZ(12,"div",0)(13,"div",4),t._uU(14),t.ALo(15,"async"),t.qZA(),t.TgZ(16,"div",2),t._uU(17,"Ordered Items"),t.qZA()(),t.TgZ(18,"div",0)(19,"div",5),t._uU(20),t.ALo(21,"currency"),t.ALo(22,"async"),t.qZA(),t.TgZ(23,"div",2),t._uU(24,"Total"),t.qZA()(),t.TgZ(25,"div",0)(26,"div",6),t._uU(27),t.ALo(28,"currency"),t.ALo(29,"async"),t.qZA(),t.TgZ(30,"div",2),t._uU(31,"Order Average"),t.qZA()()),2&e){let s,a,i,r,l;t.xp6(2),t.hij(" ",(null==(s=t.lcZ(3,5,n.stats))?null:s.order_count)||"0"," "),t.xp6(6),t.hij(" ",(null==(a=t.lcZ(9,7,n.stats))?null:a.unique_items)||"0"," "),t.xp6(6),t.Oqu((null==(i=t.lcZ(15,9,n.stats))?null:i.item_count)||"0"),t.xp6(6),t.hij(" ",t.xi3(21,11,(null==(r=t.lcZ(22,14,n.stats))?null:r.total_cost)/100||0,n.code)," "),t.xp6(7),t.hij(" ",t.xi3(28,16,(null==(l=t.lcZ(29,19,n.stats))?null:l.avg_cost)/100||0,n.code)," ")}},dependencies:[x.Ov,x.H9],styles:["[_nghost-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;padding:.5rem}"]});var he=g(266);function xs(o,e){if(1&o&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&o){const n=e.data;t.AsE(" ",t.lcZ(1,2,n)," at ",t.xi3(2,4,n,"shortTime")," ")}}function ws(o,e){if(1&o&&(t._uU(0),t.ALo(1,"currency")),2&o){const n=e.data,s=t.oxw();t.hij(" ",t.xi3(1,1,n/100,s.code)," ")}}const Zs=function(){return["deliver_at","item_count","total_cost"]},bs=function(){return["Date","Items","Total Cost"]},As=function(){return["flex"]},Cs=function(o,e){return{deliver_at:o,total_cost:e}};class Lt{get code(){return this._org.currency_code}constructor(e,n){this._report=e,this._org=n,this.orders=this._report.catering_orders,this.download=()=>this._report.downloadOrders()}}function Ms(o,e){if(1&o&&(t.TgZ(0,"span",7),t._uU(1),t.qZA()),2&o){const n=t.oxw().data,s=t.oxw();t.Q6J("matTooltip",s.options(n)),t.xp6(1),t.hij(" ",n.length," option(s) ")}}function Ts(o,e){1&o&&t.YNc(0,Ms,2,2,"span",6),2&o&&t.Q6J("ngIf",e.data.length)}function Os(o,e){if(1&o&&(t._uU(0),t.ALo(1,"currency")),2&o){const n=e.data,s=t.oxw();t.hij(" ",t.xi3(1,1,(n||0)/100,s.code)," ")}}Lt.\u0275fac=function(e){return new(e||Lt)(t.Y36(F),t.Y36(J.w7))},Lt.\u0275cmp=t.Xpm({type:Lt,selectors:[["catering-report-orders"]],decls:12,vars:12,consts:[[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["matRipple-icon","","matTooltip","Download list",3,"click"],["empty","No orders for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination"],["date_state",""],["cost_state",""]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),t._uU(3,"Orders"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.YNc(8,xs,3,7,"ng-template",null,5,t.W1O),t.YNc(10,ws,2,4,"ng-template",null,6,t.W1O),t.qZA()),2&e){const s=t.MAs(9),a=t.MAs(11);t.xp6(7),t.Q6J("dataSource",n.orders)("columns",t.DdM(6,Zs))("display_column",t.DdM(7,bs))("column_size",t.DdM(8,As))("template",t.WLB(9,Cs,s,a))("pagination",!0)}},dependencies:[he.gM,W.o,tt.C,x.H9,x.uU]});const Us=function(){return["name","options","quantity","unit_price","total_cost"]},Ls=function(){return["Name","Options","Quantity","Unit Price","Total Cost"]},Rs=function(){return["flex"]},Ns=function(o,e,n){return{options:o,unit_price:e,total_cost:n}};class Rt{get code(){return this._org.currency_code}constructor(e,n){this._report=e,this._org=n,this.items=this._report.catering_items}options(e){return e.map(n=>n.name).join("\n")}}function Es(o,e){1&o&&(t.TgZ(0,"div",5),t._UZ(1,"catering-report-overall")(2,"catering-report-orders")(3,"catering-report-items"),t.qZA())}function Ss(o,e){if(1&o&&(t.ynx(0),t.YNc(1,Es,4,0,"div",4),t.ALo(2,"async"),t.BQk()),2&o){const n=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",s)}}function ks(o,e){1&o&&(t.TgZ(0,"div",6),t._UZ(1,"mat-spinner",7),t.TgZ(2,"p",8),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function Ds(o,e){1&o&&(t.TgZ(0,"div",6)(1,"p",8),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}Rt.\u0275fac=function(e){return new(e||Rt)(t.Y36(F),t.Y36(J.w7))},Rt.\u0275cmp=t.Xpm({type:Rt,selectors:[["catering-report-items"]],decls:9,vars:13,consts:[[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty","No orders for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination"],["option_state",""],["cost_state",""],["class","text-xs px-2 py-1 rounded bg-gray-300",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-gray-300",3,"matTooltip"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),t._uU(3,"Ordered Items"),t.qZA()(),t._UZ(4,"custom-table",3),t.YNc(5,Ts,1,1,"ng-template",null,4,t.W1O),t.YNc(7,Os,2,4,"ng-template",null,5,t.W1O),t.qZA()),2&e){const s=t.MAs(6),a=t.MAs(8);t.xp6(4),t.Q6J("dataSource",n.items)("columns",t.DdM(6,Us))("display_column",t.DdM(7,Ls))("column_size",t.DdM(8,Rs))("template",t.kEZ(9,Ns,s,a,a))("pagination",!0)}},dependencies:[x.O5,he.gM,tt.C,x.H9]});class Nt{constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,Z.U)(n=>n.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}Nt.\u0275fac=function(e){return new(e||Nt)(t.Y36(M))},Nt.\u0275cmp=t.Xpm({type:Nt,selectors:[["catering-report"]],decls:8,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["class","h-full w-full",4,"ngIf","ngIfElse"],[1,"h-full","w-full"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,n){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,Ss,3,4,"ng-container",1),t.ALo(3,"async"),t.YNc(4,ks,4,1,"ng-template",null,2,t.W1O),t.YNc(6,Ds,3,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const s=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,n.loading))("ngIfElse",s)}},dependencies:[x.O5,qt.Ou,Q,Ut,Lt,Rt,x.Ov]});var Ye=g(9972),zs=g(5778),Ys=g(2198),Is=g(2994);const Wt={};class nt{transform(e){return e?(Wt[e]||(Wt[e]=(0,Yt.VE)(e).pipe((0,Z.U)(n=>n[0]||new Yt.mO({id:e,name:e})),(0,jt.K)(n=>(0,$.of)(new Yt.mO({id:e,name:e}))),(0,j.d)(1))),Wt[e]):(0,$.of)(null)}static addUser(e){Wt[e.id]=(0,$.of)(e).pipe((0,j.d)(1))}}nt.\u0275fac=function(e){return new(e||nt)},nt.\u0275pipe=t.Yjl({name:"user",type:nt,pure:!0});class st{get system_id(){return this._org.binding("contact_tracing")}constructor(e,n){this._org=e,this._reports=n,this._loading=new it.X(""),this._generate=new it.X(0),this._options=new it.X({start:(0,ot.Z)(Date.now()),end:(0,at.Z)(Date.now())}),this.events=(0,P.aj)([this._options,this._generate]).pipe((0,zs.x)((s,a)=>s[1]===a[1]),(0,Ys.h)(([s,a])=>!!a),(0,ht.w)(([{start:s,end:a,user:i}])=>{if(!i)return(0,$.of)([]);this._loading.next("Loading contact events...");const r=(0,ge.rTZ)(this.system_id,"ContactTracing");return i=i||(0,w.ar)(),nt.addUser(i),this.system_id&&r?r.execute("close_contacts",[i.email,i.username,(0,Ye.Z)(s),(0,Ye.Z)(a)]).catch(l=>((0,w.cB)(`${l?.msg||JSON.stringify(l)}`),[])):(0,$.of)([])}),(0,Z.U)(s=>{const a=this._options.getValue().user||(0,w.ar)();return s.map(i=>({mac_address:i.mac_address,date:1e3*i.contact_time,duration:Math.floor(i.duration/60)||0,user_id:a.id,user:a.name,contact_id:i.username,distance:1}))}),(0,jt.K)(s=>((0,w.cB)(`${s?.msg||JSON.stringify(s)}`),(0,$.of)([]))),(0,Is.b)(s=>this._loading.next("")),(0,j.d)(1)),this.options=this._options.asObservable(),this.loading=this._loading.asObservable()}setOptions(e){this._options.next({...this._options.getValue(),...e})}generateReport(){this._generate.next(Date.now())}downloadReport(){var e=this;return(0,k.Z)(function*(){const{start:n,end:s}=yield e._reports.options.pipe((0,K.q)(1)).toPromise(),a=yield e.events.pipe((0,K.q)(1)).toPromise(),i=new nt,r=yield Promise.all(a.map(function(){var l=(0,k.Z)(function*(d){return{"MAC Address":d.mac_address,Date:(0,H.Z)(d.date,"dd MMM yyyy, h:mm a"),"User Name":d.user,"Contact Name":(yield i.transform(d.contact_id).toPromise())?.name||("null"!==d.contact_id?d.contact_id:null)||d.mac_address,Duration:`${Math.floor(d.duration/60)?Math.floor(d.duration/60)+"h ":""}${Math.floor(d.duration%60)+"m"}`,Distance:d.distance}});return function(d){return l.apply(this,arguments)}}()));(0,w.Sv)(`report+contact-tracing+${(0,H.Z)(n,"yyyy-MM-dd")}+${(0,H.Z)(s,"yyyy-MM-dd")}.csv`,(0,w.o3)(r))})()}}st.\u0275fac=function(e){return new(e||st)(t.LFG(J.w7),t.LFG(M))},st.\u0275prov=t.Yz7({token:st,factory:st.\u0275fac,providedIn:"root"});var js=g(9697);class Et{constructor(e){this._state=e,this.options=this._state.options,this.setOptions=n=>this._state.setOptions(n),this.generate=()=>this._state.generateReport()}}function Bs(o,e){if(1&o&&(t.TgZ(0,"span",16),t._uU(1),t.qZA()),2&o){const n=t.oxw().data,s=t.oxw(3);t.Q6J("matTooltip",s.options(n)),t.xp6(1),t.hij(" ",n.length," option(s) ")}}function qs(o,e){1&o&&t.YNc(0,Bs,2,2,"span",15),2&o&&t.Q6J("ngIf",e.data.length)}function Js(o,e){if(1&o&&(t._uU(0),t.ALo(1,"async"),t.ALo(2,"user")),2&o){const s=e.row;let a;t.Oqu((null==(a=t.lcZ(1,1,t.lcZ(2,3,e.data)))?null:a.name)||s.mac_address)}}function Ps(o,e){if(1&o&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&o){const n=e.data;t.AsE(" ",t.xi3(1,2,n,"mediumDate"),", ",t.xi3(2,5,n,"shortTime")," ")}}function Qs(o,e){if(1&o&&t._uU(0),2&o){const n=e.data,s=t.oxw(3);t.hij(" ",s.formatDuration(n||0)||"Less than a minute"," ")}}function Fs(o,e){1&o&&t._uU(0),2&o&&t.hij(" ",e.data,"m ")}Et.\u0275fac=function(e){return new(e||Et)(t.Y36(st))},Et.\u0275cmp=t.Xpm({type:Et,selectors:[["contact-tracing-options"]],decls:15,vars:14,consts:[[1,"flex","items-center","space-x-2","w-full","p-2","bg-white","dark:bg-neutral-700","shadow"],["appearance","outline",1,"w-[18rem]"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["placeholder","Search for user to trace...",1,"w-64","h-12","mb-2","mt-1",3,"ngModel","ngModelChange"],["matRipple","",3,"disabled","click"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-date-range-input",2)(3,"input",3),t.NdJ("ngModelChange",function(a){return a?n.setOptions({start:a,user:null}):""}),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(a){return a?n.setOptions({end:a,user:null}):""}),t.ALo(6,"async"),t.qZA()(),t._UZ(7,"mat-datepicker-toggle",5)(8,"mat-date-range-picker",null,6),t.qZA(),t.TgZ(10,"a-user-search-field",7),t.NdJ("ngModelChange",function(a){return n.setOptions({user:a})}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"button",8),t.NdJ("click",function(){return n.generate()}),t.ALo(13,"async"),t._uU(14," Generate Report "),t.qZA()()),2&e){const s=t.MAs(9);let a,i,r,l;t.xp6(2),t.Q6J("rangePicker",s),t.xp6(1),t.Q6J("ngModel",null==(a=t.lcZ(4,6,n.options))?null:a.start),t.xp6(2),t.Q6J("ngModel",null==(i=t.lcZ(6,8,n.options))?null:i.end),t.xp6(2),t.Q6J("for",s),t.xp6(3),t.Q6J("ngModel",null==(r=t.lcZ(11,10,n.options))?null:r.user),t.xp6(2),t.Q6J("disabled",!(null!=(l=t.lcZ(13,12,n.options))&&l.user))}},dependencies:[V.Fj,V.JJ,V.On,Bt.KE,Bt.R9,z.nW,z.wx,z.zY,z.By,z._g,dt.wG,js.d,x.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25rem}"]});const Xs=function(){return["date","user_id","contact_id","duration"]},Vs=function(){return["Time of Contact","Person","Close Contact","Duration"]},Gs=function(){return["12r","14r","flex","10r"]},Ws=function(o,e,n,s,a,i){return{options:o,date:e,distance:n,user_id:s,contact_id:a,duration:i}};function Hs(o,e){if(1&o&&(t.TgZ(0,"div",6)(1,"div",7)(2,"h2",8),t._uU(3,"Contact Events"),t.qZA()(),t._UZ(4,"custom-table",9),t.YNc(5,qs,1,1,"ng-template",null,10,t.W1O),t.YNc(7,Js,3,5,"ng-template",null,11,t.W1O),t.YNc(9,Ps,3,8,"ng-template",null,12,t.W1O),t.YNc(11,Qs,1,1,"ng-template",null,13,t.W1O),t.YNc(13,Fs,1,1,"ng-template",null,14,t.W1O),t.qZA()),2&o){const n=t.MAs(6),s=t.MAs(8),a=t.MAs(10),i=t.MAs(12),r=t.MAs(14),l=t.oxw(2);t.xp6(4),t.Q6J("dataSource",l.tracing_events)("columns",t.DdM(7,Xs))("display_column",t.DdM(8,Vs))("column_size",t.DdM(9,Gs))("template",t.HTZ(10,Ws,n,a,r,s,s,i))("pagination",!0)("page_size",30)}}function $s(o,e){if(1&o&&(t.ynx(0),t.YNc(1,Hs,15,17,"div",5),t.ALo(2,"async"),t.BQk()),2&o){const n=t.oxw(),s=t.MAs(10);let a;t.xp6(1),t.Q6J("ngIf",null==(a=t.lcZ(2,2,n.options))?null:a.user)("ngIfElse",s)}}function Ks(o,e){if(1&o&&(t.TgZ(0,"div",17),t._UZ(1,"map-spinner",18),t.TgZ(2,"p"),t._uU(3),t.ALo(4,"async"),t.qZA()()),2&o){const n=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,1,n.loading))}}function to(o,e){1&o&&(t.TgZ(0,"div",17)(1,"p",19),t._uU(2,"Select a user from the topbar to begin"),t.qZA()())}class St{constructor(e){this._state=e,this.loading=this._state.loading,this.options=this._state.options,this.tracing_events=this._state.events,this.setOptions=n=>this._state.setOptions(n),this.downloadReport=()=>this._state.downloadReport(),this.formatDuration=n=>(0,ne.Z)({hours:Math.floor(n/60),minutes:n%60})}}St.\u0275fac=function(e){return new(e||St)(t.Y36(st))},St.\u0275cmp=t.Xpm({type:St,selectors:[["app-contact-tracing-report"]],decls:11,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["icon","","matRipple","","matTooltip","Download Report",1,"bg-white","dark:bg-neutral-700","absolute","bottom-2","left-2","shadow",3,"click"],["load_state",""],["empty_state",""],["class","w-[64rem] max-w-[calc(100%-2rem)] rounded overflow-hidden bg-white dark:bg-neutral-700 shadow mx-auto my-2",4,"ngIf","ngIfElse"],[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty","No contact records for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination","page_size"],["option_state",""],["user_state",""],["date_state",""],["duration_state",""],["distance_state",""],["class","text-xs px-2 py-1 rounded bg-gray-300 dark:bg-neutral-600",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-gray-300","dark:bg-neutral-600",3,"matTooltip"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"],[1,"opacity-60"]],template:function(e,n){if(1&e&&(t._UZ(0,"contact-tracing-options"),t.TgZ(1,"div",0),t.YNc(2,$s,3,4,"ng-container",1),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"button",2),t.NdJ("click",function(){return n.downloadReport()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()(),t.YNc(7,Ks,5,3,"ng-template",null,3,t.W1O),t.YNc(9,to,3,0,"ng-template",null,4,t.W1O)),2&e){const s=t.MAs(8);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,n.loading))("ngIfElse",s)}},dependencies:[x.O5,he.gM,dt.wG,W.o,tt.C,Et,x.Ov,x.uU,nt],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}"]});var eo=g(158);function no(o,e){if(1&o&&(t._UZ(0,"iframe",1),t.ALo(1,"safe")),2&o){const n=t.oxw();t.Q6J("src",t.xi3(1,1,n.report_url,"resource"),t.uOi)}}const so={};class kt extends w.cx{get report_url(){let e=(this._settings.get("app.custom_reports")||[]).find(s=>s.id===this.id)||so;return e.url?e.url+(e.url.includes("?")?"&":"?")+"kiosk=tv"+(e.api_key?`&key=${encodeURIComponent(e.api_key)}`:""):""}constructor(e,n){super(),this._settings=e,this._route=n,this.id=""}ngOnInit(){this.subscription("route.params",this._route.paramMap.subscribe(e=>this.id=e.get("id")||""))}}kt.\u0275fac=function(e){return new(e||kt)(t.Y36(w.gb),t.Y36(G.gz))},kt.\u0275cmp=t.Xpm({type:kt,selectors:[["custom-report"]],features:[t.qOj],decls:1,vars:1,consts:[["class","w-full h-full",3,"src",4,"ngIf"],[1,"w-full","h-full",3,"src"]],template:function(e,n){1&e&&t.YNc(0,no,2,4,"iframe",0),2&e&&t.Q6J("ngIf",n.id)},dependencies:[x.O5,eo.y],styles:["[_nghost-%COMP%]{height:100%;width:100%}"]});const oo=[{path:"",component:mt,children:[{path:"",component:Q},{path:"spaces",component:vt},{path:"desks",component:Ot},{path:"catering",component:Nt},{path:"contact-tracing",component:St},{path:":id",component:kt},{path:"**",redirectTo:"desks",pathMatch:"full"}]}];class ct{}ct.\u0275fac=function(e){return new(e||ct)},ct.\u0275mod=t.oAB({type:ct}),ct.\u0275inj=t.cJS({imports:[x.ez,V.u5,Be.v,sn.YR,Yt.PP,qe.TU,G.Bz.forChild(oo)]})}}]);