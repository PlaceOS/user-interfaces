"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[88],{7577:(pt,J,n)=>{n.d(J,{OO:()=>p.OO,Y:()=>ft,PP:()=>mt,mO:()=>p.mO,ro:()=>m.ro,VE:()=>f.VE,pP:()=>m.pP,w0:()=>f.w0,sF:()=>m.sF});var l=n(4755),u=n(9401),M=n(8467),v=n(7406),c=n(6286),w=n(1292),D=n(3723),Q=n(8150),m=(n(9645),n(9036),n(5861),n(4283)),f=n(9012),p=n(5197),t=n(2223);new p.n5;var A=n(5236),X=n(1426),Y=n(2641),y=n(9972),I=n(8115),R=n(2722),z=n(953),B=n(1998),G=n(833);function b(i){(0,G.Z)(1,arguments);var r=(0,B.Z)(i);return(0,z.Z)(1e3*r)}var H=n(3494),V=n(9756),$=n(8313),K=n(591),W=n(1086),k=n(13),q=n(7545),tt=n(7221),et=n(4850),ot=n(7314),it=n(5154);const nt=["container"];function rt(i,r){if(1&i&&(t.TgZ(0,"div",31),t._uU(1),t.qZA()),2&i){const o=r.index,e=t.oxw();t.Udp("left",-e.offset_x+"px"),t.uIk("disabled",e.today&&e.current_hour>o),t.xp6(1),t.AsE(" ",o%12==0?"12":o%12,"",o>=12?"pm":"am"," ")}}function st(i,r){if(1&i){const o=t.EpF();t.TgZ(0,"div",32),t._UZ(1,"a-user-avatar",11),t.TgZ(2,"div",33),t._uU(3),t.qZA(),t.TgZ(4,"button",34),t.NdJ("click",function(){const s=t.CHM(o).$implicit,d=t.oxw();return t.KtG(d.removeUser(s))}),t.TgZ(5,"app-icon"),t._uU(6,"close"),t.qZA()()()}if(2&i){const o=r.$implicit,e=t.oxw();t.Udp("top",-e.offset_y+"px"),t.xp6(1),t.Q6J("user",o),t.xp6(2),t.hij(" ",o.name||e.host.email," ")}}function at(i,r){if(1&i&&t._UZ(0,"div",35),2&i){const o=r.index,e=t.oxw();t.Udp("left",-(e.offset_x+1)+"px"),t.uIk("disabled",e.today&&e.current_hour>o)}}function lt(i,r){if(1&i&&(t.TgZ(0,"div",36),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const o=t.oxw();t.xp6(1),t.hij(" ",t.xi3(2,1,o.date,"shortTime")," ")}}const _=function(){return[]};function dt(i,r){if(1&i&&(t._UZ(0,"user-availability-list",24),t.ALo(1,"async"),t.ALo(2,"async")),2&i){const o=r.$implicit,e=t.oxw();t.Q6J("user",o)("date",e.date)("availability",t.lcZ(1,3,e.availability)?t.lcZ(2,5,e.availability)[o.email]:t.DdM(7,_))}}let T=(()=>{class i extends X.cx{get today(){return(0,Y.Z)(this.date,Date.now())}get current_hour(){return(new Date).getHours()}get selection_left(){const o=new Date(this.date);return 5*(o.getHours()+o.getMinutes()/60)}get selection_width(){return this.duration/60*5}constructor(o,e,a){super(),this._data=o,this._renderer=e,this._dialog_ref=a,this.users=new K.X([]),this.search="",this.date=this._data.date||Date.now(),this.duration=this._data.duration||60,this.offset_y=0,this.offset_x=0,this.host=this._data.host,this.hours=new Array(24).fill(0),this.availability=this.users.pipe((0,k.b)(300),(0,q.w)(s=>(0,$.LE)({calendars:[this.host.email,...s.map(d=>d.email.toLowerCase())].join(","),period_start:(0,y.Z)((0,I.Z)(this.date)),period_end:(0,y.Z)((0,R.Z)(this.date))}).pipe((0,tt.K)(()=>(0,W.of)([])))),(0,et.U)(s=>{const d={};for(const E of s)d[E.id]=E.availability.filter(h=>"busy"===h.status).map(h=>{const x=b(h.starts_at),P=(0,H.Z)(b(h.ends_at),b(h.starts_at));return{date:x,duration:P,start:(x.getHours()+x.getMinutes()/60)/24*100,size:P/60/24*100}});return d}),(0,ot.d)({}),(0,it.d)(1)),this.move_time=!1,this._start_time=0,this._move_last=0,this._move_size=1920,this.users.next([...this._data.users])}addUser(o){this.users.next([...this.users.getValue().filter(e=>e.email!==o.email),o]),this.user=null}removeUser(o){this.users.next(this.users.getValue().filter(e=>e.email!==o.email)),this.user=null}closeAndUpdate(){this._dialog_ref.close(!0)}ngAfterViewInit(){const o=new Date(this.date);this.timeout("init",()=>{const e=this._container_el.nativeElement.querySelector(`[hour="${o.getHours()}"]`);if(e){const a=this._container_el.nativeElement.getBoundingClientRect(),s=e.getBoundingClientRect();this._container_el.nativeElement.scrollTo(s.left-128-a.left,0)}this.onScroll()},300)}onScroll(){this.offset_x=this._container_el.nativeElement.scrollLeft,this.offset_y=this._container_el.nativeElement.scrollTop}startMovePeriod(o){o.preventDefault(),o.stopPropagation(),this._move_last=o instanceof MouseEvent?o.clientX:o.touches[0].clientX,this.move_time=!0,this._start_time=this.date,o instanceof MouseEvent?this.subscription("on_move",this._renderer.listen("window","mousemove",e=>this._onMovePeriod(e))):this.subscription("on_move",this._renderer.listen("window","touchmove",e=>this._onMovePeriod(e))),o instanceof MouseEvent?this.subscription("on_move_end",this._renderer.listen("window","mouseup",()=>this._onMoveEnd())):this.subscription("on_move_end",this._renderer.listen("window","touchend",()=>this._onMoveEnd()))}startMoveDuration(o){o.preventDefault(),o.stopPropagation(),this._move_last=o instanceof MouseEvent?o.clientX:o.touches[0].clientX,this._start_time=this.duration,o instanceof MouseEvent?this.subscription("on_move",this._renderer.listen("window","mousemove",e=>this._onMoveDuration(e))):this.subscription("on_move",this._renderer.listen("window","touchmove",e=>this._onMoveDuration(e))),o instanceof MouseEvent?this.subscription("on_move_end",this._renderer.listen("window","mouseup",()=>this._onMoveEnd())):this.subscription("on_move_end",this._renderer.listen("window","touchend",()=>this._onMoveEnd()))}_onMovePeriod(o){const e=this._move_last-(o instanceof MouseEvent?o.clientX:o.touches[0].clientX),s=(e>0?-1:1)*Math.floor(Math.abs(e/this._move_size*24*60)/5)*5;if(s){const d=this.date;this.date=(0,V.Z)(this._start_time,s).valueOf(),this.date<Date.now()&&(this.date=d)}}_onMoveDuration(o){const e=this._move_last-(o instanceof MouseEvent?o.clientX:o.touches[0].clientX),s=(e>0?-1:1)*Math.floor(Math.abs(e/this._move_size*24*60)/5)*5;s&&(this.duration=Math.max(30,this._start_time+s))}_onMoveEnd(){this.unsub("on_move"),this.unsub("on_move_end"),this._move_last=0,this.move_time=!1}}return i.\u0275fac=function(o){return new(o||i)(t.Y36(c.WI),t.Y36(t.Qsj),t.Y36(c.so))},i.\u0275cmp=t.Xpm({type:i,selectors:[["find-availability-modal"]],viewQuery:function(o,e){if(1&o&&t.Gf(nt,7),2&o){let a;t.iGM(a=t.CRH())&&(e._container_el=a.first)}},features:[t.qOj],decls:44,vars:31,consts:[[1,"relative","flex","items-center","justify-center","p-4"],[1,"text-center"],["icon","","matRipple","","mat-dialog-close","",1,"absolute","top-1/2","left-1","-translate-y-1/2"],[1,"flex","flex-col","h-[calc(100vh-7rem)]","sm:h-[65vh]","overflow-hidden"],[1,"w-full","flex","flex-col","sm:flex-row","space-y-2","sm:space-y-0","sm:space-x-2","p-2"],[1,"max-h-[3.25rem]","flex-1",3,"ngModel","ngModelChange"],[1,"grid","flex-1","h-1/2","w-full","border-t","border-gray-300","dark:border-neutral-500","relative","overflow-hidden","divide-x","divide-y","divide-gray-300","dark:divide-neutral-500","max-w-[100vw]","sm:max-w-[80vw]"],["times","",1,"col-start-2","h-10","flex","overflow-hidden","border-l","border-gray-300"],["hour","","class","relative border-r border-gray-300 h-10 min-w-[5rem] p-2",3,"left",4,"ngFor","ngForOf"],["users","",1,"row-start-2","w-24","overflow-hidden"],["host","",1,"flex","flex-col","items-center","justify-center","h-32","w-24","relative","border-b","border-gray-300","dark:border-neutral-500","py-2"],[1,"text-2xl",3,"user"],[1,"text-xs","break-words","overflow-hidden","max-w-full","px-2","text-center"],["person","","class","flex flex-col items-center justify-center h-32 w-24 relative border-b border-gray-300 dark:border-neutral-500 py-2",3,"top",4,"ngFor","ngForOf"],["blocks","",1,"relative","row-start-2","overflow-hidden"],["fixed","",1,"absolute","inset-0","flex","overflow-hidden"],["divider","","class","relative h-full min-w-[5rem] border-l border-gray-300",3,"left",4,"ngFor","ngForOf"],["selection","",1,"absolute","inset-y-0","!border-x-2","!border-blue-500","bg-blue-500/30","z-20","cursor-grab","active:cursor-grabbing",3,"mousedown","touchstart"],["handle","",1,"absolute","top-1/2","-left-px","-translate-x-1/2","-translate-y-1/2","h-3","w-3","rounded-full","bg-blue-500"],["handle","",1,"absolute","top-1/2","-right-px","translate-x-1/2","-translate-y-1/2","h-3","w-3","rounded-full","bg-blue-500","hover:h-4","hover:w-4","active:bg-primary",3,"mousedown","touchstart"],[1,"bg-white","dark:bg-neutral-600","border","border-gray-300","dark:border-neutral-500","p-2","absolute","top-2","left-1/2","-translate-x-1/2","shadow","text-xs","whitespace-nowrap","rounded"],["class","bg-white dark:bg-neutral-600 border border-gray-300 dark:border-neutral-500 p-2 absolute top-12 left-1/2 -translate-x-1/2 shadow text-xs whitespace-nowrap rounded",4,"ngIf"],["scroll","",1,"absolute","inset-0","overflow-auto",3,"scroll"],["container",""],[1,"pointer-events-none",3,"user","date","availability"],["class","pointer-events-none",3,"user","date","availability",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-2","border-t","border-gray-200","dark:border-neutral-500","w-full"],["btn","","matRipple","",1,"clear","text-primary",3,"mat-dialog-close"],[1,"flex","items-center"],[1,"text-xl"],[1,"mr-1","underline"],["hour","",1,"relative","border-r","border-gray-300","h-10","min-w-[5rem]","p-2"],["person","",1,"flex","flex-col","items-center","justify-center","h-32","w-24","relative","border-b","border-gray-300","dark:border-neutral-500","py-2"],[1,"text-xs","break-words","max-w-full","px-2","text-center"],["icon","",1,"absolute","-top-1","-left-1",3,"click"],["divider","",1,"relative","h-full","min-w-[5rem]","border-l","border-gray-300"],[1,"bg-white","dark:bg-neutral-600","border","border-gray-300","dark:border-neutral-500","p-2","absolute","top-12","left-1/2","-translate-x-1/2","shadow","text-xs","whitespace-nowrap","rounded"]],template:function(o,e){1&o&&(t.TgZ(0,"header",0)(1,"h2",1),t._uU(2,"Find Availability"),t.qZA(),t.TgZ(3,"button",2)(4,"app-icon"),t._uU(5,"close"),t.qZA()()(),t.TgZ(6,"main",3)(7,"div",4)(8,"a-date-field",5),t.NdJ("ngModelChange",function(s){return e.date=s}),t.qZA(),t.TgZ(9,"a-user-search-field",5),t.NdJ("ngModelChange",function(s){return e.user=s})("ngModelChange",function(s){return e.addUser(s)}),t.qZA()(),t.TgZ(10,"div",6)(11,"div",7),t.YNc(12,rt,2,5,"div",8),t.qZA(),t.TgZ(13,"div",9)(14,"div",10),t._UZ(15,"a-user-avatar",11),t.TgZ(16,"div",12),t._uU(17),t.qZA()(),t.YNc(18,st,7,4,"div",13),t.ALo(19,"async"),t.qZA(),t.TgZ(20,"div",14)(21,"div",15),t.YNc(22,at,1,3,"div",16),t.TgZ(23,"div",17),t.NdJ("mousedown",function(s){return e.startMovePeriod(s)})("touchstart",function(s){return e.startMovePeriod(s)}),t._UZ(24,"div",18),t.TgZ(25,"div",19),t.NdJ("mousedown",function(s){return e.startMoveDuration(s)})("touchstart",function(s){return e.startMoveDuration(s)}),t.qZA(),t.TgZ(26,"div",20),t._uU(27),t.ALo(28,"duration"),t.qZA(),t.YNc(29,lt,3,4,"div",21),t.qZA()(),t.TgZ(30,"div",22,23),t.NdJ("scroll",function(){return e.onScroll()}),t._UZ(32,"user-availability-list",24),t.ALo(33,"async"),t.ALo(34,"async"),t.YNc(35,dt,3,8,"user-availability-list",25),t.ALo(36,"async"),t.qZA()()()(),t.TgZ(37,"footer",26)(38,"button",27)(39,"div",28)(40,"app-icon",29),t._uU(41,"arrow_back"),t.qZA(),t.TgZ(42,"div",30),t._uU(43,"Back to form"),t.qZA()()()()),2&o&&(t.xp6(8),t.Q6J("ngModel",e.date),t.xp6(1),t.Q6J("ngModel",e.user),t.xp6(3),t.Q6J("ngForOf",e.hours),t.xp6(2),t.Udp("top",-e.offset_y+"px"),t.xp6(1),t.Q6J("user",e.host),t.xp6(2),t.hij(" ",e.host.name||e.host.email," "),t.xp6(1),t.Q6J("ngForOf",t.lcZ(19,20,e.users)),t.xp6(4),t.Q6J("ngForOf",e.hours),t.xp6(1),t.Udp("left","calc("+e.selection_left+"rem - "+e.offset_x+"px)")("width",e.selection_width+"rem"),t.xp6(4),t.hij(" ",t.lcZ(28,22,e.duration)," "),t.xp6(2),t.Q6J("ngIf",e.move_time),t.xp6(3),t.Q6J("user",e.host)("date",e.date)("availability",t.lcZ(33,24,e.availability)?t.lcZ(34,26,e.availability)[e.host.email]:t.DdM(30,_)),t.xp6(3),t.Q6J("ngForOf",t.lcZ(36,28,e.users)),t.xp6(3),t.Q6J("mat-dialog-close",!0))},styles:[".grid[_ngcontent-%COMP%]{grid-template-columns:6rem 1fr;grid-template-rows:2.5rem minmax(0,1fr)}[disabled=true][_ngcontent-%COMP%], [disabled=true][_ngcontent-%COMP%]   [header][_ngcontent-%COMP%]{background:#eee!important;pointer-events:none}[disabled=true][_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{color:#0000004d}"]}),i})();function ut(i,r){if(1&i&&(t.TgZ(0,"div",2)(1,"div",3),t._uU(2),t.ALo(3,"date"),t.ALo(4,"date"),t.qZA()()),2&i){const o=r.$implicit;t.Udp("left",o.start+"%")("width",o.size+"%"),t.xp6(2),t.AsE(" ",t.xi3(3,6,o.date,"shortTime")," - ",t.xi3(4,9,o.date.valueOf()+60*o.duration*1e3,"shortTime")," ")}}let C=(()=>{class i{constructor(){this.availability=[],this.date=Date.now()}}return i.\u0275fac=function(o){return new(o||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["user-availability-list"]],inputs:{user:"user",availability:"availability",date:"date"},decls:2,vars:1,consts:[[1,"relative","w-[120rem]","h-32","inset-y-0","border-b","border-gray-300","dark:border-neutral-500"],["event","","class","absolute inset-y-0 bg-red-600 text-white p-2 overflow-hidden border border-red-700 rounded",3,"left","width",4,"ngFor","ngForOf"],["event","",1,"absolute","inset-y-0","bg-red-600","text-white","p-2","overflow-hidden","border","border-red-700","rounded"],[1,"text-xs","max-w-full"]],template:function(o,e){1&o&&(t.TgZ(0,"div",0),t.YNc(1,ut,5,12,"div",1),t.qZA()),2&o&&(t.xp6(1),t.Q6J("ngForOf",e.availability))},dependencies:[l.sg,l.uU],styles:["[_nghost-%COMP%]{display:block}"]}),i})();var U=n(5306),F=n(9685),O=n(1217),ct=n(2329),ht=n(9697),vt=n(2193);let mt=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[l.ez,u.u5,u.UX,c.Is,Q.W,D.K,w.p9,M.Cq,v.Tx]}),i})();t.B6R(A.J,[l.sg,l.O5,u.JJ,u.On,c.ZT,U.o,F.k,v.VK,v.OP,v.p6,O.wG,M.Ou,w.oG],[l.uU]),t.B6R(T,[l.sg,l.O5,u.JJ,u.On,c.ZT,ct.Q,ht.d,U.o,F.k,O.wG,C],[l.Ov,l.uU,vt.u]);class ft{constructor(r={}){this.type=r.type||r.location||"other",this.position=r.position||r.map_id||r.asset_id||{x:r.x/r.map_width||0,y:r.y/r.map_height||0},this.variance=r.variance||0,this.last_seen=r.last_seen||(0,y.Z)(new Date),this.level=r.level,this.building=r.building,this.at_location=!!r.at_location,this.coordinates_from=r.coordinates_from||"top-left"}}n(9375)}}]);