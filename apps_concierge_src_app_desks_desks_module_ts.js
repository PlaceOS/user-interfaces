"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_desks_desks_module_ts"],{74508:(Ft,L,r)=>{r.r(L),r.d(L,{DesksModule:()=>yt});var p=r(26575),u=r(28849),T=r(92649),V=r(92106),N=r(60989),E=r(2978),ee=r(97910),c=r(22798),v=r(34381),e=r(29039),te=r(42349),R=r(78173),g=r(71670),ne=r(17627),b=r(46939),f=r(93121),A=r(78466),oe=r(70462),Z=r(17401),K=r(33910),x=r(10257),D=r(94888),se=r(4512),ie=r(65822),ae=r(25864),C=r(71268),S=r(99674),y=r(56658),le=r(46362),re=r(28442),_e=r(59590),ce=r(24741),I=r(20576),de=r(33243),pe=r(17351);function ue(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"section",23)(1,"button",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.setOptions({group:!1,members:[]}))}),e.ALo(2,"async"),e.TgZ(3,"app-icon",25),e._uU(4,"person"),e.qZA(),e.TgZ(5,"div",26),e.SDv(6,27),e.qZA(),e._UZ(7,"div",28),e.ALo(8,"async"),e.ALo(9,"async"),e.qZA(),e.TgZ(10,"button",24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.setOptions({group:!0}))}),e.ALo(11,"async"),e.TgZ(12,"app-icon",25),e._uU(13,"group_add"),e.qZA(),e.TgZ(14,"div",26),e.SDv(15,29),e.qZA(),e._UZ(16,"div",28),e.ALo(17,"async"),e.ALo(18,"async"),e.qZA()()}if(2&s){const t=e.oxw(2);let o,n,i,a,_,d;e.xp6(),e.ekj("text-secondary",!(null!=(o=e.lcZ(2,12,t.options))&&o.group)),e.xp6(6),e.ekj("bg-base-200",null==(n=e.lcZ(8,14,t.options))?null:n.group)("bg-secondary",!(null!=(i=e.lcZ(9,16,t.options))&&i.group)),e.xp6(3),e.ekj("text-secondary",null==(a=e.lcZ(11,18,t.options))?null:a.group),e.xp6(6),e.ekj("bg-base-200",!(null!=(_=e.lcZ(17,20,t.options))&&_.group))("bg-secondary",null==(d=e.lcZ(18,22,t.options))?null:d.group)}}function ge(s,l){1&s&&(e.TgZ(0,"div",30)(1,"label",11),e._uU(2,"Host"),e.TgZ(3,"span"),e._uU(4,"*"),e.qZA()(),e._UZ(5,"a-user-search-field",31),e.qZA())}function me(s,l){1&s&&(e.TgZ(0,"mat-checkbox",32),e.SDv(1,33),e.qZA())}const F=()=>({standalone:!0});function fe(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"div",34)(1,"div",35)(2,"label",36),e.tHW(3,37),e._UZ(4,"span"),e.N_p(),e.qZA(),e.TgZ(5,"a-time-field",38),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw(2);return e.KtG(i.form.patchValue({date:n}))}),e.qZA()(),e.TgZ(6,"div",35)(7,"label",39),e.tHW(8,40),e._UZ(9,"span"),e.N_p(),e.qZA(),e._UZ(10,"a-duration-field",41),e.qZA()()}if(2&s){const t=e.oxw(2);let o;e.xp6(5),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(8,F))("use_24hr",t.use_24hr),e.xp6(5),e.Q6J("time",null==(o=t.form.get("date"))?null:o.value)("max",600)("min",60)("step",60)("use_24hr",t.use_24hr)}}function he(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"div",34)(1,"div",35)(2,"mat-checkbox",42),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw(2);return e.KtG(i.form.patchValue({secondary_resource:n?"locker":""}))}),e.SDv(3,43),e.qZA()()()}if(2&s){const t=e.oxw(2);e.xp6(2),e.Q6J("ngModel",!!t.form.value.secondary_resource)("ngModelOptions",e.DdM(2,F))}}const ke=()=>[];function Te(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"section",3)(1,"h3",44)(2,"div",5),e._uU(3," 2 "),e.qZA(),e.TgZ(4,"div",6),e.SDv(5,45),e.qZA(),e._UZ(6,"div",46),e.qZA(),e.TgZ(7,"div",47)(8,"a-user-list-field",48),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw(2);return e.KtG(i.setOptions({members:n}))}),e.ALo(9,"async"),e.qZA()()()}if(2&s){const t=e.oxw(2);let o;e.xp6(8),e.Q6J("ngModel",(null==(o=e.lcZ(9,2,t.options))?null:o.members)||e.DdM(4,ke))("ngModelOptions",e.DdM(5,F))}}function xe(s,l){1&s&&(e.TgZ(0,"p",52),e._uU(1," Desks nearby to the selected desk will booked for group members "),e.qZA())}function be(s,l){if(1&s&&(e.TgZ(0,"section",3)(1,"h3",4)(2,"div",5),e._uU(3),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"div",6),e.SDv(6,49),e.qZA()(),e._UZ(7,"desk-list-field",50),e.YNc(8,xe,2,0,"p",51),e.ALo(9,"async"),e.qZA()),2&s){const t=e.oxw(2);let o,n;e.xp6(3),e.hij(" ",null!=(o=e.lcZ(4,2,t.options))&&o.group?3:2," "),e.xp6(5),e.Q6J("ngIf",null==(n=e.lcZ(9,4,t.options))?null:n.group)}}const ve=(s,l,t)=>({date:s,duration:l,all_day:t});function De(s,l){if(1&s&&(e.TgZ(0,"section",3)(1,"h3",4)(2,"div",5),e._uU(3),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"div",6),e.SDv(6,53),e.qZA()(),e._UZ(7,"asset-list-field",54),e.qZA()),2&s){const t=e.oxw(2);let o;e.xp6(3),e.hij(" ",null!=(o=e.lcZ(4,2,t.options))&&o.group?4:3," "),e.xp6(4),e.Q6J("options",e.kEZ(4,ve,t.form.getRawValue().date,t.form.value.duration,t.form.value.all_day))}}function Ce(s,l){if(1&s&&(e.TgZ(0,"div",1),e.YNc(1,ue,19,24,"section",2),e.TgZ(2,"section",3)(3,"h3",4)(4,"div",5),e._uU(5," 1 "),e.qZA(),e.TgZ(6,"div",6),e.SDv(7,7),e.qZA()(),e.YNc(8,ge,6,0,"div",8),e.ALo(9,"async"),e.TgZ(10,"div",9)(11,"div",10)(12,"label",11),e._uU(13,"Add Title"),e.TgZ(14,"span"),e._uU(15,"*"),e.qZA()(),e.TgZ(16,"mat-form-field",12),e._UZ(17,"input",13),e.TgZ(18,"mat-error"),e.SDv(19,14),e.qZA()()(),e.TgZ(20,"div",15)(21,"label",16),e.tHW(22,17),e._UZ(23,"span"),e.N_p(),e.qZA(),e.TgZ(24,"a-date-field",18),e.SDv(25,19),e.qZA(),e.YNc(26,me,2,0,"mat-checkbox",20),e.qZA()(),e.YNc(27,fe,11,9,"div",21)(28,he,4,3,"div",21),e.qZA(),e.YNc(29,Te,10,6,"section",22),e.ALo(30,"async"),e.YNc(31,be,10,6,"section",22)(32,De,8,8,"section",22),e.qZA()),2&s){const t=e.oxw();let o,n;e.Q6J("formGroup",t.form),e.xp6(),e.Q6J("ngIf",t.allow_groups),e.xp6(),e.ekj("!border-none",t.allow_groups),e.xp6(6),e.Q6J("ngIf",t.can_book_for_others&&!(null!=(o=e.lcZ(9,12,t.options))&&o.group)),e.xp6(16),e.Q6J("to",t.end_date),e.xp6(2),e.Q6J("ngIf",t.allow_all_day),e.xp6(),e.Q6J("ngIf",!t.form.value.all_day),e.xp6(),e.Q6J("ngIf",t.can_book_lockers),e.xp6(),e.Q6J("ngIf",null==(n=e.lcZ(30,14,t.options))?null:n.group),e.xp6(2),e.Q6J("ngIf",t.form.contains("resources")),e.xp6(),e.Q6J("ngIf",t.has_assets)}}let Ae=(()=>{class s extends c.cx{get building(){return this._org.building}set building(t){this._org.building=t}get can_book_for_others(){return this._settings.get("app.desks.can_book_for_others")}get can_book_lockers(){return this._settings.get("app.desks.can_book_lockers")}get can_recurr(){return this._settings.get("app.desks.recurrence_allowed")}get allow_groups(){return this._settings.get("app.desks.allow_groups")}get has_assets(){return!!this._settings.get("app.desks.has_assets")}get needs_reason(){return!0===this._settings.get("app.desks.needs_reason")}get allow_time_changes(){return!!this._settings.get("app.desks.allow_time_changes")}get allow_all_day(){return this.allow_time_changes&&!!this._settings.get("app.desks.allow_all_day")}get end_date(){return(0,se.Z)((0,ie.Z)(Date.now(),this._settings.get("app.desks.available_period")||90)).valueOf()}get use_24hr(){return this._settings.get("app.use_24_hour_time")}constructor(t,o,n){super(),this._state=t,this._org=o,this._settings=n,this.find=new e.vpe,this.buildings=this._org.building_list,this.levels=this._org.active_levels,this.options=this._state.options,this.features=this._state.features,this.force_time=(0,ae.Z)(Date.now(),{hours:6,minutes:0}).valueOf(),this.from_id=!1,this.recurrence_options=["daily","weekly","monthly"],this.setOptions=i=>this._state.setOptions(i),this.setFeature=(i,a)=>this._state.setFeature(i,a)}ngOnChanges(t){t.form&&this.form&&this.selected_desk?.id&&this.form.patchValue({resources:[this.selected_desk]})}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(A.fy),e.Y36(f.w7),e.Y36(c.gb))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["new-desk-form-details"]],inputs:{form:"form"},outputs:{find:"find"},features:[e.qOj,e.TTD],decls:1,vars:1,consts:()=>{let t,o,n,i,a,_,d,h,m,M,w,z,X;return t=$localize`:␟4f8b2bb476981727ab34ed40fde1218361f92c45␟5028777105388019087:Details`,o=$localize`:␟3501a14ee1e89ea7009e8c9d1d6796a9ac9c3718␟4954033536980360307:Booking title is required.`,n=$localize`:␟04cfb5fd033651743bc4b9408bd52ba4ee894070␟3158758063619980932:Date${"\ufffd#23\ufffd"}:START_TAG_SPAN:*${"\ufffd/#23\ufffd"}:CLOSE_TAG_SPAN:`,i=$localize`:␟407bcc42df8640bf3b85c58145c8d24572bb47b6␟6682406734296000735: Date and time must be in the future `,a=$localize`:␟ee6b1f617dd5320b23fbed018c38ac092db5e40a␟3413004253239957216:Single`,_=$localize`:␟4c90059afafb7e160384d9f512797c95bb95c6dc␟8623978917681527907:Group`,d=$localize`:␟8a5018aa2d4dd0e8a98f4499d4b7b4a9255441a5␟8093595438228616861: All Day `,h=$localize`:␟02d39ddac5bbf95c424df03d5f0d22cc257556bd␟4735431816432396893: Start Time${"\ufffd#4\ufffd"}:START_TAG_SPAN:*${"\ufffd/#4\ufffd"}:CLOSE_TAG_SPAN:`,m=$localize`:␟96ca8377bef76dbcd3eb3b4d39e5414763c7033b␟7899923133926994657: End Time${"\ufffd#9\ufffd"}:START_TAG_SPAN:*${"\ufffd/#9\ufffd"}:CLOSE_TAG_SPAN:`,M=$localize`:␟f1701d7a0d6bfb739979f9e406793d97acd138e3␟8675972661523566351: Require locker `,w=$localize`:␟60ae849c087ccc322073478a12b2504433fbdd61␟9086691296106045671:Group Members`,z=$localize`:␟654c7e59b2003acf985bee710bad11e8cdd461f8␟6078724721705612215:Desk`,X=$localize`:␟1bdfc0dfd2ac89f5d0d2af3a66e5e959d094b39c␟8637135334686190699:Request Asset`,[["class","p-0 sm:py-4 sm:px-16 divide-y divide-base-200 space-y-2",3,"formGroup",4,"ngIf"],[1,"p-0","sm:py-4","sm:px-16","divide-y","divide-base-200","space-y-2",3,"formGroup"],["class","flex items-center",4,"ngIf"],[1,"p-2"],[1,"space-x-2","flex","items-center","mb-4"],[1,"bg-base-200","rounded-full","h-6","w-6","flex","items-center","justify-center"],[1,"text-xl"],t,["class","w-full",4,"ngIf"],[1,"flex","items-center","flex-wrap","sm:space-x-2"],[1,"flex-1","min-w-[256px]"],["for","title"],["appearance","outline",1,"w-full"],["matInput","","name","title","formControlName","title","placeholder","e.g. Focus Time"],o,[1,"flex-1","min-w-[256px]","relative"],["for","date"],n,["name","date","formControlName","date",3,"to"],i,["formControlName","all_day","class","absolute -top-2 right-0",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],["class","p-2",4,"ngIf"],[1,"flex","items-center"],["matRipple","",1,"relative","h-16","flex","items-center","justify-center","flex-1","space-x-2",3,"click"],[1,"text-2xl"],[1,""],a,[1,"absolute","h-1","inset-x-0","bottom-0","!m-0"],_,[1,"w-full"],["formControlName","user"],["formControlName","all_day",1,"absolute","-top-2","right-0"],d,[1,"flex","items-center","space-x-2"],[1,"flex-1","w-1/3"],["for","start-time"],h,["name","start-time",3,"ngModel","ngModelOptions","use_24hr","ngModelChange"],["for","end-time"],m,["name","end-time","formControlName","duration",3,"time","max","min","step","use_24hr"],[3,"ngModel","ngModelOptions","ngModelChange"],M,[1,"space-x-2","flex","items-center"],w,[1,"flex-1","w-px"],[1,"overflow-hidden"],[1,"mt-4",3,"ngModel","ngModelOptions","ngModelChange"],z,["formControlName","resources"],["class","text-center rounded px-2 py-1 bg-warning shadow text-xs",4,"ngIf"],[1,"text-center","rounded","px-2","py-1","bg-warning","shadow","text-xs"],X,["formControlName","assets",3,"options"]]},template:function(o,n){1&o&&e.YNc(0,Ce,33,16,"div",0),2&o&&e.Q6J("ngIf",n.form)},dependencies:[p.O5,u.Fj,u.JJ,u.JL,u.On,u.sg,u.u,C.KE,C.TO,S.Nt,y.oG,x.wG,le.Q,re.B,_e.N,ce.E,I.d,D.o,de.k,pe.A,p.Ov],encapsulation:2})}return s})();function Ze(s,l){if(1&s&&(e.TgZ(0,"main",5),e._UZ(1,"new-desk-form-details",6),e.qZA()),2&s){const t=e.oxw();e.xp6(),e.Q6J("form",t.form)}}function Me(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"footer",7)(1,"button",8),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.save())}),e._uU(2,"Save"),e.qZA()()}}function we(s,l){1&s&&(e.TgZ(0,"main",9),e._UZ(1,"mat-spinner",10),e.TgZ(2,"p"),e._uU(3,"Making booking request..."),e.qZA()()),2&s&&(e.xp6(),e.Q6J("diameter",48))}let W=(()=>{class s{get form(){return this._booking_form.form}constructor(t,o){this._booking_form=t,this._dialog_ref=o,this.event=new e.vpe,this.loading=new oe.X(!1)}save(){var t=this;return(0,g.Z)(function*(){t.loading.next(!0),t.form.patchValue({booking_type:"desk"});const o=yield t._booking_form.postForm().catch(n=>{throw(0,c.cB)(n),t.loading.next(!1),n});t.event.emit({reason:"done",metadata:o}),(0,c.t5)("Successfully created booking"),t._dialog_ref.close(),t.loading.next(!1)})()}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(A.fy),e.Y36(Z.so))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["desk-book-modal"]],outputs:{event:"event"},decls:13,vars:7,consts:[[1,"flex-1","w-0"],["icon","","mat-dialog-close",""],["class","overflow-auto p-4 max-h-[65vh]",4,"ngIf","ngIfElse"],["class","flex justify-center items-center p-2 border-t border-base-200",4,"ngIf"],["load_state",""],[1,"overflow-auto","p-4","max-h-[65vh]"],[3,"form"],[1,"flex","justify-center","items-center","p-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-32",3,"click"],["loading","",1,"h-64","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(o,n){if(1&o&&(e.TgZ(0,"header")(1,"h2"),e._uU(2,"New Desk Booking"),e.qZA(),e._UZ(3,"div",0),e.TgZ(4,"button",1)(5,"app-icon"),e._uU(6,"close"),e.qZA()()(),e.YNc(7,Ze,2,1,"main",2),e.ALo(8,"async"),e.YNc(9,Me,3,0,"footer",3),e.ALo(10,"async"),e.YNc(11,we,4,1,"ng-template",null,4,e.W1O)),2&o){const i=e.MAs(12);e.xp6(7),e.Q6J("ngIf",!e.lcZ(8,3,n.loading))("ngIfElse",i),e.xp6(2),e.Q6J("ngIf",!e.lcZ(10,5,n.loading))}},dependencies:[p.O5,K.Ou,Z.ZT,x.wG,D.o,Ae,p.Ov]})}return s})();var J=r(67232),U=r(11771),q=r(97338),$=r(96355),O=r(60702);function Ee(s,l){1&s&&(e.TgZ(0,"mat-option",13),e._uU(1," All Levels "),e.qZA())}function Oe(s,l){if(1&s&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&s){const t=l.$implicit;e.Q6J("value",t.id),e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function Ne(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.newDeskBooking())}),e._uU(1," New Booking "),e.qZA()}}function Se(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.newDesk())}),e.TgZ(1,"app-icon"),e._uU(2,"add"),e.qZA()()}}function ye(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"button",17)(1,"app-icon"),e._uU(2,"cloud_upload"),e.qZA(),e.TgZ(3,"input",18),e.NdJ("change",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.loadCSVData(n))}),e.qZA()()}}function Fe(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.downloadTemplate())}),e.TgZ(1,"app-icon"),e._uU(2,"download"),e.qZA()()}}function Pe(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.manageRestrictions())}),e.TgZ(1,"app-icon"),e._uU(2,"lock_open"),e.qZA()()}}let Le=(()=>{class s extends c.cx{constructor(t,o,n,i,a){super(),this._desks=t,this._org=o,this._route=n,this._router=i,this._dialog=a,this.levels=this._org.active_levels,this.filters=this._desks.filters,this.manage=!1,this.is_map=!1,this.setDate=_=>this._desks.setFilters({date:_}),this.setFilters=_=>this._desks.setFilters(_),this.updateZones=_=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:_.join(",")},queryParamsHandling:"merge"}),this._desks.setFilters({zones:_})}}ngOnInit(){var t=this;return(0,g.Z)(function*(){yield t._org.initialised.pipe((0,ne.P)(o=>o)).toPromise(),t.subscription("route.query",t._route.queryParamMap.subscribe(o=>{if(o.has("zone_ids")){const n=o.get("zone_ids").split(",");if(n.length){t.updateZones(n);const i=t._org.levelWithID(n);if(!i)return;t._org.building=t._org.buildings.find(a=>a.id===i.parent_id)}}o.has("date")&&t.setDate(new Date(+o.get("date"))),o.has("approve")?t.approve(o.get("approve")):o.has("reject")&&t.reject(o.get("reject")),t.manage=t._router.url?.includes("manage"),t.is_map=t._router.url?.includes("map")})),t.subscription("router.events",t._router.events.subscribe(()=>{t.manage=t._router.url?.includes("manage"),t.is_map=t._router.url?.includes("map")})),t.subscription("levels",t._org.active_levels.subscribe(function(){var o=(0,g.Z)(function*(n){const a=(yield t.filters.pipe((0,b.q)(1)).toPromise())?.zones?.filter(_=>n.find(d=>d.id===_)||"All"===_)||[];!a.length&&n.length&&a.push(n[0].id),t.updateZones(a)});return function(n){return o.apply(this,arguments)}}())),t.manage=t._router.url?.includes("manage"),t.is_map=t._router.url?.includes("map")})()}newDesk(){const t=new f.nk({id:`desk-${(0,c.Iy)(999999)}`});t.staff_name="[NEW_DESK]",this._desks.addDesks([t]),(0,c.QD)("New desk added to local data.",void 0,()=>(0,c.QD)("Make sure to save the new desk before using it."))}newDeskBooking(){this._dialog.open(W,{})}manageRestrictions(){this._dialog.open(J.i,{data:{type:"desk"}})}loadCSVData(t){var o=this;return(0,g.Z)(function*(){const n=yield(0,c.fT)(t).catch(([i,a])=>{throw(0,c.cB)(i),a});try{const i=(0,c.n5)(n)||[];o._desks.addDesks(i.map(a=>new f.nk({...a,id:a.id||`desk-${(0,c.Iy)(999999)}`})))}catch(i){console.error(i)}})()}downloadTemplate(){const t=new f.nk({id:"desk-123",name:"Test Desk",bookable:!0,groups:["test-desk-group","desk-bookers"],features:["Standing Desk","Dual Monitor"]}).toJSON();delete t.images;const o=(0,c.o3)([t]);(0,c.Sv)("desk-template.csv",o)}approve(t){var o=this;return(0,g.Z)(function*(){const n=yield(0,A.Fo)(t).toPromise();n&&o._desks.approveDesk(n)})()}reject(t){var o=this;return(0,g.Z)(function*(){const n=yield(0,A.Fo)(t).toPromise();n&&o._desks.rejectDesk(n)})()}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(v.H),e.Y36(f.w7),e.Y36(T.gz),e.Y36(T.F0),e.Y36(Z.uw))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["desks-topbar"]],features:[e.qOj],decls:17,vars:17,consts:[[1,"flex","items-center","bg-base-100","h-20","px-4","border-b","border-base-200","space-x-2"],["appearance","outline"],["placeholder","All Levels",3,"ngModel","ngModelChange"],["value","All",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["btn","","matRipple","","class","mx-2 w-36","matTooltip","New Desk Booking",3,"click",4,"ngIf"],["btn","","icon","","matRipple","","class","bg-primary mx-2 text-white rounded","matTooltip","New Desk",3,"click",4,"ngIf"],["btn","","icon","","matRipple","","class","bg-primary relative text-white rounded","matTooltip","Upload Desks CSV",4,"ngIf"],["btn","","icon","","matRipple","","class","bg-primary mx-2 text-white rounded","matTooltip","Download Template Desk CSV",3,"click",4,"ngIf"],["btn","","icon","","matRipple","","class","bg-primary mx-2 text-white rounded","matTooltip","Desk Restrictions",3,"click",4,"ngIf"],[1,"flex-1","w-2"],[1,"mr-2",3,"model","modelChange"],[3,"dateChange"],["value","All"],[3,"value"],["btn","","matRipple","","matTooltip","New Desk Booking",1,"mx-2","w-36",3,"click"],["btn","","icon","","matRipple","","matTooltip","New Desk",1,"bg-primary","mx-2","text-white","rounded",3,"click"],["btn","","icon","","matRipple","","matTooltip","Upload Desks CSV",1,"bg-primary","relative","text-white","rounded"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"],["btn","","icon","","matRipple","","matTooltip","Download Template Desk CSV",1,"bg-primary","mx-2","text-white","rounded",3,"click"],["btn","","icon","","matRipple","","matTooltip","Desk Restrictions",1,"bg-primary","mx-2","text-white","rounded",3,"click"]],template:function(o,n){if(1&o&&(e.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),e.NdJ("ngModelChange",function(a){return n.updateZones([a])}),e.ALo(3,"async"),e.ALo(4,"async"),e.YNc(5,Ee,2,0,"mat-option",3)(6,Oe,2,2,"mat-option",4),e.ALo(7,"async"),e.qZA()(),e.YNc(8,Ne,2,0,"button",5)(9,Se,3,0,"button",6)(10,ye,4,0,"button",7)(11,Fe,3,0,"button",8)(12,Pe,3,0,"button",9),e._UZ(13,"div",10),e.TgZ(14,"searchbar",11),e.NdJ("modelChange",function(a){return n.setFilters({search:a})}),e.ALo(15,"async"),e.qZA(),e.TgZ(16,"date-options",12),e.NdJ("dateChange",function(a){return n.setDate(a)}),e.qZA()()),2&o){let i;e.xp6(2),e.Q6J("ngModel",e.lcZ(3,9,n.filters).zones?e.lcZ(4,11,n.filters).zones[0]:"All"),e.xp6(3),e.Q6J("ngIf",!n.is_map),e.xp6(),e.Q6J("ngForOf",e.lcZ(7,13,n.levels)),e.xp6(2),e.Q6J("ngIf",!n.manage),e.xp6(),e.Q6J("ngIf",n.manage),e.xp6(),e.Q6J("ngIf",n.manage),e.xp6(),e.Q6J("ngIf",n.manage),e.xp6(),e.Q6J("ngIf",n.manage),e.xp6(2),e.Q6J("model",null==(i=e.lcZ(15,15,n.filters))?null:i.search)}},dependencies:[p.sg,p.O5,u.JJ,u.On,U.E,q.U,C.KE,$.gD,x.ey,O.gM,x.wG,D.o,p.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=desks-topbar.component.ts-angular-inline--124.css.map*/"]})}return s})();const Re=["app-desks",""];function Ke(s,l){1&s&&e._UZ(0,"mat-progress-bar",7)}const Ie=()=>["/book","desks","events"],We=()=>["/book","desks","map"],Je=()=>["/book","desks","manage"];let Ue=(()=>{class s extends c.cx{constructor(t,o){super(),this._state=t,this._router=o,this.loading=this._state.loading}ngOnInit(){this._state.refresh(),this.subscription("router.events",this._router.events.subscribe(o=>{if(o instanceof T.m2){const n=this._router.url?.split("/")||[""];this.path=n[t.length-1].split("?")[0]}}));const t=this._router.url?.split("/")||[""];this.path=t[t.length-1].split("?")[0]}ngOnDestroy(){super.ngOnDestroy()}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(v.H),e.Y36(T.F0))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["","app-desks",""]],features:[e.qOj],attrs:Re,decls:15,vars:12,consts:[[1,"flex-1","relative","w-1/2","flex","flex-col","bg-base-100","overflow-hidden"],[1,"w-full"],[1,"dark"],["mat-tab-nav-bar",""],["mat-tab-link","","queryParamsHandling","merge",3,"routerLink","active"],[1,"flex-1","h-1/2","w-full","relative","overflow-auto"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(o,n){1&o&&(e._UZ(0,"sidebar"),e.TgZ(1,"main",0),e._UZ(2,"desks-topbar",1),e.TgZ(3,"div",2)(4,"nav",3)(5,"a",4),e._uU(6," Bookings "),e.qZA(),e.TgZ(7,"a",4),e._uU(8," Map View "),e.qZA(),e.TgZ(9,"a",4),e._uU(10," Manage Desks "),e.qZA()()(),e.TgZ(11,"div",5),e._UZ(12,"router-outlet"),e.qZA(),e.YNc(13,Ke,1,0,"mat-progress-bar",6),e.ALo(14,"async"),e.qZA()),2&o&&(e.xp6(5),e.Q6J("routerLink",e.DdM(9,Ie))("active","events"===n.path),e.xp6(2),e.Q6J("routerLink",e.DdM(10,We))("active","map"===n.path),e.xp6(2),e.Q6J("routerLink",e.DdM(11,Je))("active","manage"===n.path),e.xp6(4),e.Q6J("ngIf",e.lcZ(14,7,n.loading)))},dependencies:[p.O5,N.BU,N.Nj,te.k,R.pW,T.lC,T.rH,Le,p.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}\n\n/*# sourceMappingURL=desks.component.ts-angular-inline--122.css.map*/"]})}return s})();var B=r(47422),P=r(78128),G=r(27442);function qe(s,l){if(1&s&&(e.TgZ(0,"div",12)(1,"div",13),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.ALo(6,"date"),e.qZA()()),2&s){const t=l.data;e.xp6(2),e.Oqu(e.xi3(3,2,t,"MMM")),e.xp6(3),e.Oqu(e.xi3(6,5,t,"dd"))}}function $e(s,l){if(1&s&&(e.ynx(0),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.BQk()),2&s){const t=e.oxw(2).row,o=e.oxw();e.xp6(),e.AsE(" ",e.xi3(2,2,t.date,o.time_format)," \u2013 ",e.xi3(3,5,t.end,o.time_format)," ")}}function Be(s,l){1&s&&(e.ynx(0),e._uU(1,"All Day"),e.BQk())}function Ge(s,l){if(1&s&&(e.ynx(0),e.YNc(1,$e,4,8,"ng-container",15)(2,Be,2,0,"ng-container",15),e.BQk()),2&s){const t=e.oxw().row;e.xp6(),e.Q6J("ngIf",!t.all_day),e.xp6(),e.Q6J("ngIf",t.all_day)}}function Qe(s,l){if(1&s&&(e.ynx(0),e.TgZ(1,"div",16),e._uU(2),e.qZA(),e.BQk()),2&s){const t=e.oxw().row;e.xp6(2),e.hij(" ","ended"===t.status?"Manually Ended":"Expired"," ")}}function je(s,l){if(1&s&&e.YNc(0,Ge,3,2,"ng-container",15)(1,Qe,3,1,"ng-container",15),2&s){const t=l.row;e.Q6J("ngIf","declined"!==t.status&&!t.deleted&&"ended"!==t.status),e.xp6(),e.Q6J("ngIf","declined"===t.status||t.deleted||"ended"===t.status)}}function Ye(s,l){if(1&s&&(e.TgZ(0,"div",20),e._uU(1),e.qZA()),2&s){const t=e.oxw().row;e.xp6(),e.hij(" ",t.user_email," ")}}function He(s,l){if(1&s&&(e.TgZ(0,"div",17)(1,"div",18),e._uU(2),e.qZA(),e.YNc(3,Ye,2,1,"div",19),e.qZA()),2&s){const t=l.row;e.xp6(2),e.hij(" ",t.user_name||t.user_email||t.booked_by_name||t.booked_by_email," "),e.xp6(),e.Q6J("ngIf",t.user_name)}}function ze(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"button",21)(1,"div",22),e._uU(2),e.qZA(),e.TgZ(3,"app-icon",14),e._uU(4,"arrow_drop_down"),e.qZA()(),e.TgZ(5,"mat-menu",null,23)(7,"button",11),e.NdJ("click",function(){const i=e.CHM(t).row,a=e.oxw();return e.KtG(a.approve(i))}),e.TgZ(8,"div",24)(9,"app-icon",25),e._uU(10,"event_available"),e.qZA(),e.TgZ(11,"div"),e._uU(12,"Approve Desk"),e.qZA()()(),e.TgZ(13,"button",11),e.NdJ("click",function(){const i=e.CHM(t).row,a=e.oxw();return e.KtG(a.reject(i))}),e.TgZ(14,"div",24)(15,"app-icon",25),e._uU(16,"event_busy"),e.qZA(),e.TgZ(17,"div"),e._uU(18,"Decline Desk"),e.qZA()()()()}if(2&s){const t=l.row,o=e.MAs(6);e.ekj("bg-success",t.approved)("text-white",t.approved||t.rejected)("bg-warning",!t.approved&&!t.rejected)("text-black",!t.approved&&!t.rejected)("bg-error",t.rejected),e.Q6J("matMenuTriggerFor",o),e.xp6(2),e.hij(" ",t.approved?"Approved":t.rejected?"Declined":"Tentative"," ")}}function Xe(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"button",26)(1,"div",22),e._uU(2),e.qZA(),e.TgZ(3,"app-icon",14),e._uU(4,"arrow_drop_down"),e.qZA()(),e.TgZ(5,"mat-menu",null,27)(7,"button",11),e.NdJ("click",function(){const i=e.CHM(t).row,a=e.oxw();return e.KtG(a.checkin(i,!0))}),e.TgZ(8,"div",24)(9,"app-icon",25),e._uU(10,"check"),e.qZA(),e.TgZ(11,"div"),e._uU(12,"Check-in"),e.qZA()()(),e.TgZ(13,"button",11),e.NdJ("click",function(){const i=e.CHM(t).row,a=e.oxw();return e.KtG(a.checkin(i,!1))}),e.TgZ(14,"div",24)(15,"app-icon",25),e._uU(16,"cancel"),e.qZA(),e.TgZ(17,"div"),e._uU(18,"Check-out"),e.qZA()()()()}if(2&s){const t=l.data,o=l.row,n=e.MAs(6);e.ekj("bg-neutral",!t)("bg-success",t)("opacity-30","ended"===o.status),e.Q6J("matMenuTriggerFor",n)("disabled","ended"===o.status)("matTooltip","ended"===o.status?"Desk booking has ended":"Check-in or check-out desk"),e.xp6(2),e.Oqu(t?"Yes":"No")}}function Ve(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.loadMore())}),e._uU(1," Load More "),e.qZA()}}const et=()=>["date","period","user_name","group","asset_name","approver_name","status","checked_in"],tt=()=>["Date","Period","Person","Group","Desk","Approver","Status","Checked In"],nt=()=>["4r","10r","flex","10r","10r","10r","8r","7r"],ot=(s,l,t,o,n,i)=>({user_name:s,date:l,period:t,status:o,checked_in:n,access:i});let Q=(()=>{class s{get time_format(){return this._settings.time_format}constructor(t,o){var n=this;this._state=t,this._settings=o,this.filters=this._state.filters,this.has_more_pages=this._state.has_more_pages,this.bookings=this._state.bookings.pipe((0,B.U)(i=>i.map(a=>({...a,end:a.date+60*a.duration*1e3})))),this.rejectAll=()=>this._state.rejectAllDesks(),this.loadMore=()=>this._state.nextPage(),this.checkin=(i,a)=>this.runMethod("checkin",(0,g.Z)(function*(){yield n._state.checkinDesk(i,a),i.checked_in=a??!0})),this.approve=i=>this.runMethod("approve",(0,g.Z)(function*(){return n._state.approveDesk(i)})),this.reject=i=>this.runMethod("reject",(0,g.Z)(function*(){return n._state.rejectDesk(i)}))}runMethod(t,o){var n=this;return(0,g.Z)(function*(){n.loading=t,yield o().catch(i=>null),n.loading=""})()}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(v.H),e.Y36(c.gb))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["desk-bookings"]],decls:24,vars:25,consts:[[1,"w-full","h-4"],[1,"overflow-auto","h-full","w-full","px-4","pb-4"],[1,"min-w-[76rem]","block",3,"dataSource","filter","columns","display_column","column_size","template","empty"],["date_template",""],["period_template",""],["user_template",""],["status_template",""],["option_template",""],["btn","","matRipple","","class","absolute bottom-2 left-2 w-32 mx-auto my-4",3,"click",4,"ngIf"],["icon","","matRipple","",1,"absolute","bottom-2","right-2","bg-base-100","shadow",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-full"],[1,"opacity-60"],[1,"text-xl"],[4,"ngIf"],[1,"text-xs","py-1","px-2","bg-error","rounded-2xl","text-white"],[1,"flex","flex-col","justify-center"],[1,"select-all"],["class","text-xs opacity-30 select-all",4,"ngIf"],[1,"text-xs","opacity-30","select-all"],["matRipple","",1,"rounded-3xl","px-2","py-1","flex","items-center","space-x-2","capitalize",3,"matMenuTriggerFor"],[1,"ml-2"],["statusMenu","matMenu"],[1,"flex","items-center","space-x-2"],[1,"text-2xl"],["matRipple","",1,"rounded-3xl","px-2","py-1","text-white","flex","items-center","space-x-2",3,"matMenuTriggerFor","disabled","matTooltip"],["checkinMenu","matMenu"],["btn","","matRipple","",1,"absolute","bottom-2","left-2","w-32","mx-auto","my-4",3,"click"]],template:function(o,n){if(1&o&&(e._UZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"custom-table",2),e.ALo(3,"async"),e.ALo(4,"async"),e.YNc(5,qe,7,8,"ng-template",null,3,e.W1O)(7,je,2,2,"ng-template",null,4,e.W1O)(9,He,4,2,"ng-template",null,5,e.W1O)(11,ze,19,12,"ng-template",null,6,e.W1O)(13,Xe,19,10,"ng-template",null,7,e.W1O),e.qZA(),e.YNc(15,Ve,2,0,"button",8),e.ALo(16,"async"),e.TgZ(17,"button",9)(18,"app-icon"),e._uU(19,"more_vert"),e.qZA()(),e.TgZ(20,"mat-menu",null,10)(22,"button",11),e.NdJ("click",function(){return n.rejectAll()}),e._uU(23,"Reject All"),e.qZA()()),2&o){const i=e.MAs(6),a=e.MAs(8),_=e.MAs(10),d=e.MAs(12),h=e.MAs(14),m=e.MAs(21);let M,w;e.xp6(2),e.Q6J("dataSource",n.bookings)("filter",null==(M=e.lcZ(3,9,n.filters))?null:M.search)("columns",e.DdM(15,et))("display_column",e.DdM(16,tt))("column_size",e.DdM(17,nt))("template",e.HTZ(18,ot,_,i,a,d,h,h))("empty",null!=(w=e.lcZ(4,11,n.filters))&&w.search?"No matching desk bookings":"There are no desk booking for the currently selected date."),e.xp6(13),e.Q6J("ngIf",!n.loading&&e.lcZ(16,13,n.has_more_pages)),e.xp6(2),e.Q6J("matMenuTriggerFor",m)}},dependencies:[p.O5,P.VK,P.OP,P.p6,O.gM,x.wG,D.o,G.C,p.Ov,p.uU],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;height:100%;width:100%}\n\n/*# sourceMappingURL=desk-bookings.component.ts-angular-inline--123.css.map*/"]})}return s})();var st=r(51674),it=r(92791);let j=(()=>{class s extends c.cx{constructor(t,o,n,i){super(),this._state=t,this._desk=o,this._desks_state=n,this._org=i,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.actions=this._state.map_actions,this.features=this._state.map_features,this.setHost=a=>this._desks_state.setOptions({host:a})}ngOnInit(){this._desks_state.setOptions({use_api:!0}),this.subscription("date",this._desk.filters.subscribe(t=>{const o=this._org.levelWithID(t.zones);o&&this._state.setLevel(o.id),this._desks_state.setOptions({date:t.date||Date.now(),all_day:!0,zones:t.zones})}))}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(E.ck),e.Y36(v.H),e.Y36(E.Xp),e.Y36(f.w7))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["desk-map-view"]],features:[e._Bn([E.Xp]),e.qOj],decls:13,vars:19,consts:[["map","",1,"h-full","w-full","relative"],[3,"src","zoom","center","styles","features","actions"],[1,"absolute","bottom-2","right-2"],[1,"absolute","top-0","left-0","p-2","text-black"],["placeholder","User for bookings...",1,"white",3,"ngModel","ngModelChange"],["info","",1,"absolute","bottom-0","rounded","p-2","m-2","bg-base-100","shadow","text-center"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"i-map",1),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e._UZ(8,"explore-zoom-controls",2),e.TgZ(9,"div",3)(10,"a-user-search-field",4),e.NdJ("ngModelChange",function(a){return n.setHost(a)}),e.qZA()(),e.TgZ(11,"div",5),e._uU(12," Click/Tap an available desk to book it. "),e.qZA()()),2&o&&(e.xp6(),e.Q6J("src",e.lcZ(2,7,n.url))("zoom",e.lcZ(3,9,n.positions).zoom)("center",e.lcZ(4,11,n.positions).center)("styles",e.lcZ(5,13,n.styles))("features",e.lcZ(6,15,n.features))("actions",e.lcZ(7,17,n.actions)),e.xp6(9),e.Q6J("ngModel",null))},dependencies:[u.JJ,u.On,I.d,st.p,it.s,p.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;position:relative;height:100%;width:100%}[info][_ngcontent-%COMP%]{left:50%;transform:translate(-50%)}\n\n/*# sourceMappingURL=desk-map-view.component.ts-angular-inline--125.css.map*/"]})}return s})();var Y=r(47298),at=r(89680),lt=r(28159),rt=r(44220),_t=r(33884),ct=r(81886),dt=r(16318);function pt(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"item-list-field",10),e.NdJ("ngModelChange",function(n){const i=e.CHM(t),a=i.row,_=i.key,d=e.oxw();return e.KtG(d.setRowValue(a.id,_,n))}),e.qZA()}if(2&s){const t=l.data,o=l.row,n=l.key,i=e.oxw();e.Q6J("placeholder","groups"===n?"User Groups":"Features")("name",n)("ngModel",(i.changes[o.id]?i.changes[o.id][n]:null)||t)}}function ut(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"div",11)(1,"mat-form-field",12)(2,"input",13),e.NdJ("ngModelChange",function(n){const i=e.CHM(t),a=i.row,_=i.key,d=e.oxw();return e.KtG(d.setRowValue(a.id,_,n))}),e.qZA()()()}if(2&s){const t=l.data,o=l.row,n=l.key,i=e.oxw();e.xp6(2),e.Q6J("placeholder",n)("name",n)("ngModel",(i.changes[o.id]?i.changes[o.id][n]:null)||t)}}function gt(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"div",14)(1,"mat-checkbox",15),e.NdJ("ngModelChange",function(n){const a=e.CHM(t).row,_=e.oxw();return e.KtG(_.setRowValue(a.id,"bookable",n))}),e.qZA()()}if(2&s){const t=l.data,o=l.row,n=e.oxw();let i;e.xp6(),e.Q6J("ngModel",null!==(i=null==n.changes[o.id]?null:n.changes[o.id].bookable)&&void 0!==i?i:t)}}function mt(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"div",21)(1,"div",22)(2,"a",23),e.ALo(3,"safe"),e._UZ(4,"img",24),e.qZA(),e.TgZ(5,"div",25),e._uU(6),e.qZA()(),e.TgZ(7,"button",26),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.print())}),e._uU(8," Print QR Code "),e.qZA()()}if(2&s){const t=e.oxw().row;e.xp6(2),e.Q6J("href",e.xi3(3,3,t.qr_link,"url"),e.LSH),e.xp6(2),e.Q6J("src",t.qr_code,e.LSH),e.xp6(2),e.hij(" ",t.name||t.id," ")}}function ft(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"div",16)(1,"div",17)(2,"app-icon"),e._uU(3,"warning"),e.qZA()(),e.TgZ(4,"button",18),e.NdJ("click",function(){const i=e.CHM(t).row,a=e.oxw();return e.KtG(a.removeDesk(i))}),e.TgZ(5,"app-icon"),e._uU(6,"delete"),e.qZA()(),e.TgZ(7,"button",19),e.NdJ("click",function(){const i=e.CHM(t).row,a=e.oxw();return e.KtG(a.loadQrCode(i))}),e.TgZ(8,"app-icon"),e._uU(9,"qr_code"),e.qZA()(),e.YNc(10,mt,9,6,"ng-template",null,20,e.W1O),e.qZA()}if(2&s){const t=l.row,o=e.MAs(11),n=e.oxw();e.xp6(),e.ekj("opacity-0",!n.changes[t.id]),e.xp6(6),e.Q6J("content",o)}}function ht(s,l){if(1&s&&(e.TgZ(0,"div",27),e._UZ(1,"mat-spinner",28),e.TgZ(2,"p"),e._uU(3),e.qZA()()),2&s){const t=e.oxw();e.xp6(3),e.Oqu(t.loading)}}function kt(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"div",29)(1,"div",30)(2,"div",31),e._uU(3," Drop CSV file to add desks "),e.qZA()(),e.TgZ(4,"input",32),e.NdJ("change",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.loadCSVData(n))}),e.qZA()()}}function Tt(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"div",33)(1,"p",34),e._uU(2),e.qZA(),e.TgZ(3,"div",35)(4,"button",36),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.clear())}),e._uU(5," Clear Changes "),e.qZA(),e.TgZ(6,"button",37),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.save())}),e._uU(7," Save Changes "),e.qZA()()()}if(2&s){const t=e.oxw();e.xp6(2),e.hij(" ",t.changed," Desk(s) with unsaved changes ")}}const xt=()=>["map_id","bookable","name","groups","features","actions"],bt=()=>["ID","Bookable","Name","Groups","Features"," "],vt=()=>["12r","6r","12r","flex","16r","10r"],Dt=(s,l,t,o,n,i)=>({map_id:s,name:l,bookable:t,groups:o,features:n,actions:i});let H=(()=>{class s extends c.cx{get changed(){return Object.keys(this.changes).length||0}constructor(t,o,n,i,a){super(),this._state=t,this._org=o,this._dialog=n,this._settings=i,this._element=a,this.changes={},this.dragging=!1,this.page_reset=0,this.filters=this._state.filters,this.desks=(0,lt.aj)([this._state.new_desks,this._state.desks]).pipe((0,B.U)(([_,d])=>_.concat(d)))}ngOnInit(){this.subscription("new_desks",this._state.new_desks.subscribe(t=>{this.page_reset=Date.now();const o=this._element?.nativeElement?.parentElement;o&&(o.scrollTop=0);for(const n of t)this.changes[n.id]={}}))}setRowValue(t,o,n){this.changes[t]||(this.changes[t]={}),this.changes[t][o]=n}removeDesk(t){var o=this;return(0,g.Z)(function*(){if((yield o._state.new_desks.pipe((0,b.q)(1)).toPromise()).find(m=>m.id===t.id))return delete o.changes[t.id],o._state.removeNewDesk(t);const i=yield(0,c._5)({title:"Remove desk",content:`Remove desk ${t.name}?`,icon:{content:"delete"}},o._dialog);if("done"!==i.reason)return;i.close();const _=(yield o.desks.pipe((0,b.q)(1)).toPromise()).filter(m=>m.id!==t.id),d=yield o.filters.pipe((0,b.q)(1)).toPromise(),h=o._org.levelWithID(d.zones);o.loading="Removing desk...",yield(0,Y.Ymr)(h.id,{name:"desks",description:"desks",details:_}).toPromise().catch(m=>{throw o.loading="",(0,c.cB)(`Error saving desk data. Error: ${m.message||m}`),m}),delete o.changes[t.id],(0,c.t5)("Successfully updated desks"),o._state.setFilters({}),o.loading=""})()}save(){var t=this;return(0,g.Z)(function*(){t.loading="Saving changes to desks...";const o=yield t.desks.pipe((0,b.q)(1)).toPromise(),n=(0,c.Tw)(o.map(_=>new f.nk({..._,...t.changes[_.id]||{}}).toJSON()),"id"),i=yield t.filters.pipe((0,b.q)(1)).toPromise(),a=t._org.levelWithID(i.zones);yield(0,Y.Ymr)(a.id,{name:"desks",description:"desks",details:n}).toPromise().catch(_=>{throw t.loading="",(0,c.cB)(`Error saving desk data. Error: ${403===_?.status?"You do not have the required permissions to save desk changes.":_.message||_}`),_}),(0,c.t5)("Successfully updated desks"),t._state.clearNewDesks(),t.loading="",t.changes={}})()}clear(){this._state.clearNewDesks(),this.changes={}}get kiosk_url(){const t=this._settings.get("app.workplace_url_path")||"/workplace";return`${window.location.origin}${t}`}loadQrCode(t){const o=`${this.kiosk_url}/#/book/code?asset_id=${encodeURIComponent(t.id)}`;t.qr_link=o,t.qr_code=(0,at.w)(o)}print(){window.print()}loadCSVData(t){var o=this;return(0,g.Z)(function*(){o.loading="Loading CSV file...",o.dragging=!1;const n=yield(0,c.fT)(t).catch(([i,a])=>{throw(0,c.cB)(i),a});try{const i=(0,c.n5)(n)||[];o._state.addDesks(i.map(a=>new f.nk({...a,id:a.id||`desk-${(0,c.Iy)(999999)}`})))}catch(i){console.error(i)}o.loading=""})()}handleDrag(t,o){this.dragging="enter"===t}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(v.H),e.Y36(f.w7),e.Y36(Z.uw),e.Y36(c.gb),e.Y36(e.SBq))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["desks-manage"]],features:[e.qOj],decls:16,vars:29,consts:[[1,"w-full","h-4"],[1,"w-full","relative","pl-8","pb-4",3,"dragenter","dragend"],[1,"min-w-[76rem]","block",3,"dataSource","filter","columns","display_column","column_size","template","empty","reset_page","pagination","page_size"],["list_edit_template",""],["text_edit_template",""],["bookable_edit_template",""],["action_template",""],["class","absolute inset-0 flex flex-col items-center justify-center space-y-2 bg-base-100 bg-opacity-60",4,"ngIf"],["class","absolute inset-0 bg-neutral flex items-center justify-center",4,"ngIf"],["class","fixed bottom-0 left-64 right-0 p-2 bg-base-100 shadow border-t border-base-200 flex items-center justify-center space-x-4",4,"ngIf"],["hide-outline","",1,"w-full",3,"placeholder","name","ngModel","ngModelChange"],["hide-outline","",1,"w-full","h-12"],["appearance","outline",1,"h-12","w-full"],["matInput","",3,"placeholder","name","ngModel","ngModelChange"],[1,"flex","items-center","justify-center","pl-4"],[3,"ngModel","ngModelChange"],[1,"flex","items-center","justify-end","space-x-2"],["matTooltip","Desk has unsaved changes",1,"p-2","text-2xl","text-warning"],["icon","",3,"click"],["icon","","matRipple","","customTooltip","",3,"content","click"],["qr_menu",""],[1,"bg-base-100","py-2","shadow","rounded"],["printable","",1,""],["target","_blank","ref","noopener noreferrer",1,"block","p-2","mx-4","my-2","rounded-lg","border","border-base-200","bg-base-100",3,"href"],[1,"w-48",3,"src"],[1,"w-[calc(100%-2rem)]","text-center","mt-2","font-mono","text-sm","bg-base-200","rounded","p-2","mx-4"],["btn","","matRipple","",1,"w-[calc(100%-2rem)]","mx-4","my-2",3,"click"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2","bg-base-100","bg-opacity-60"],["diameter","32"],[1,"absolute","inset-0","bg-neutral","flex","items-center","justify-center"],[1,"bg-base-100","p-4","rounded","shadow"],[1,"border-4","border-base-200","border-dashed","rounded","flex","flex-col","items-center","justify-center","w-64","h-64"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"],[1,"fixed","bottom-0","left-64","right-0","p-2","bg-base-100","shadow","border-t","border-base-200","flex","items-center","justify-center","space-x-4"],[1,"flex-1","text-center","pl-8"],[1,"flex","items-center","justify-center","space-x-2"],["clear","","btn","","matRipple","",1,"inverse",3,"click"],["save","","btn","","matRipple","",3,"click"]],template:function(o,n){if(1&o&&(e._UZ(0,"div",0),e.TgZ(1,"div",1),e.NdJ("dragenter",function(a){return n.handleDrag("enter",a)})("dragend",function(a){return n.handleDrag("end",a)},!1,e.Jf7),e._UZ(2,"custom-table",2),e.ALo(3,"async"),e.ALo(4,"async"),e.YNc(5,pt,1,3,"ng-template",null,3,e.W1O)(7,ut,3,3,"ng-template",null,4,e.W1O)(9,gt,2,1,"ng-template",null,5,e.W1O)(11,ft,12,3,"ng-template",null,6,e.W1O)(13,ht,4,1,"div",7)(14,kt,5,0,"div",8),e.qZA(),e.YNc(15,Tt,8,1,"div",9)),2&o){const i=e.MAs(6),a=e.MAs(8),_=e.MAs(10),d=e.MAs(12);let h,m;e.xp6(),e.Udp("margin-bottom",n.changed>0?"4rem":""),e.xp6(),e.Q6J("dataSource",n.desks)("filter",null==(h=e.lcZ(3,15,n.filters))?null:h.search)("columns",e.DdM(19,xt))("display_column",e.DdM(20,bt))("column_size",e.DdM(21,vt))("template",e.HTZ(22,Dt,a,a,_,i,i,d))("empty",null!=(m=e.lcZ(4,17,n.filters))&&m.search?"No matching desks":"No desks for selected level")("reset_page",n.page_reset)("pagination",!0)("page_size",20),e.xp6(11),e.Q6J("ngIf",n.loading),e.xp6(),e.Q6J("ngIf",n.dragging),e.xp6(),e.Q6J("ngIf",n.changed>0)}},dependencies:[p.O5,u.Fj,u.JJ,u.On,C.KE,S.Nt,y.oG,O.gM,K.Ou,x.wG,rt.q9,D.o,G.C,_t.X,ct.o,p.Ov,dt.y]})}return s})();var Ct=r(39304),At=r(33005),Zt=r(19842);const Mt=["app-new-desks",""];function wt(s,l){if(1&s&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&s){const t=l.$implicit;e.Q6J("value",t.id),e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function Et(s,l){if(1&s){const t=e.EpF();e.ynx(0),e.TgZ(1,"date-options",17),e.NdJ("dateChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.setDate(n))}),e.qZA(),e.TgZ(2,"button",18),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.refresh())}),e.ALo(3,"async"),e.TgZ(4,"app-icon"),e._uU(5,"refresh"),e.qZA()(),e.BQk()}if(2&s){const t=e.oxw();e.xp6(2),e.Q6J("disabled",e.lcZ(3,1,t.loading))}}function Ot(s,l){if(1&s){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",19),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.newDesk())}),e.TgZ(2,"app-icon"),e._uU(3,"add"),e.qZA()(),e.TgZ(4,"button",20)(5,"app-icon"),e._uU(6,"cloud_upload"),e.qZA(),e.TgZ(7,"input",21),e.NdJ("change",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.loadCSVData(n))}),e.qZA()(),e.TgZ(8,"button",22),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.downloadTemplate())}),e.TgZ(9,"app-icon"),e._uU(10,"download"),e.qZA()(),e.TgZ(11,"button",23),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.manageRestrictions())}),e.TgZ(12,"app-icon"),e._uU(13,"lock_open"),e.qZA()(),e.BQk()}}function Nt(s,l){1&s&&e._UZ(0,"mat-progress-bar",24)}const St=[{path:"new",component:(()=>{class s extends c.cx{constructor(t,o,n,i,a){super(),this._state=t,this._router=o,this._route=n,this._dialog=i,this._org=a,this.loading=this._state.loading,this.filters=this._state.filters,this.levels=this._org.active_levels,this.setDate=_=>this._state.setFilters({date:_}),this.setFilters=_=>this._state.setFilters(_),this.refresh=()=>this._state.refresh(),this.updateZones=_=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:_.join(",")},queryParamsHandling:"merge"}),this._state.setFilters({zones:_})},this.page_title="Desk Bookings"}ngOnInit(){var t=this;this._state.refresh(),this.subscription("router.events",this._router.events.subscribe(n=>{if(n instanceof T.m2){const i=this._router.url?.split("/")||[""];this.path=i[o.length-1].split("?")[0],this.page_title=this.path.includes("manage")?"Desk Management":"Desk Bookings"}})),this.subscription("levels",this._org.active_levels.subscribe(function(){var n=(0,g.Z)(function*(i){const _=(yield t.filters.pipe((0,b.q)(1)).toPromise())?.zones?.filter(d=>i.find(h=>h.id===d)||"All"===d)||[];!_.length&&i.length&&_.push(i[0].id),t.updateZones(_)});return function(i){return n.apply(this,arguments)}}()));const o=this._router.url?.split("/")||[""];this.path=o[o.length-1].split("?")[0]}ngOnDestroy(){super.ngOnDestroy()}newDeskBooking(){this._dialog.open(W,{}).afterClosed().subscribe(o=>{this._state.refresh()})}manageRestrictions(){this._dialog.open(J.i,{data:{type:"desk"}})}newDesk(){this._state.addDesks([new f.nk({id:`desk-${(0,c.Iy)(999999)}`})]),(0,c.QD)("New desk added to local data.",void 0,()=>(0,c.QD)("Make sure to save the new desk before using it."))}downloadTemplate(){const t=new f.nk({id:"desk-123",name:"Test Desk",bookable:!0,groups:["test-desk-group","desk-bookers"],features:["Standing Desk","Dual Monitor"]}).toJSON();delete t.images;const o=(0,c.o3)([t]);(0,c.Sv)("desk-template.csv",o)}loadCSVData(t){var o=this;return(0,g.Z)(function*(){const n=yield(0,c.fT)(t).catch(([i,a])=>{throw(0,c.cB)(i),a});try{const i=(0,c.n5)(n)||[];o._state.addDesks(i.map(a=>new f.nk({...a,id:a.id||`desk-${(0,c.Iy)(999999)}`})))}catch(i){console.error(i)}})()}static#e=this.\u0275fac=function(o){return new(o||s)(e.Y36(v.H),e.Y36(T.F0),e.Y36(T.gz),e.Y36(Z.uw),e.Y36(f.w7))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["","app-new-desks",""]],features:[e.qOj],attrs:Mt,decls:29,vars:15,consts:[[1,"print:hidden"],[1,"flex","flex-1","h-px","print:hidden"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","w-full","py-4","px-8","space-x-2"],[1,"text-2xl","font-medium"],[1,"flex-1","w-px"],[1,"mr-2",3,"model","modelChange"],["btn","","matRipple","",1,"space-x-2",3,"click"],[1,"w-full","flex","items-center","px-8","space-x-2"],["appearance","outline",1,"h-[3.5rem]"],["placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"border-l","h-full","!ml-8","!mr-4"],[4,"ngIf"],[1,"flex-1","h-1/2","w-full","relative","overflow-auto"],["class","w-full","mode","indeterminate",4,"ngIf"],[3,"value"],[3,"dateChange"],["btn","","icon","","matRipple","","matTooltip","Refresh List",1,"ml-2","rounded","border","border-base-200",3,"disabled","click"],["btn","","icon","","matRipple","","matTooltip","New Desk",1,"bg-secondary","text-white","rounded",3,"click"],["btn","","icon","","matRipple","","matTooltip","Upload Desks CSV",1,"bg-secondary","relative","text-white","rounded"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"],["btn","","icon","","matRipple","","matTooltip","Download Template Desk CSV",1,"bg-secondary","text-white","rounded",3,"click"],["btn","","icon","","matRipple","","matTooltip","Desk Restrictions",1,"bg-secondary","text-white","rounded",3,"click"],["mode","indeterminate",1,"w-full"]],template:function(o,n){if(1&o&&(e._UZ(0,"app-topbar",0),e.TgZ(1,"div",1),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",2)(4,"div",3)(5,"h2",4),e._uU(6),e.qZA(),e._UZ(7,"div",5),e.TgZ(8,"searchbar",6),e.NdJ("modelChange",function(a){return n.setFilters({search:a})}),e.ALo(9,"async"),e.qZA(),e.TgZ(10,"button",7),e.NdJ("click",function(){return n.newDeskBooking()}),e.TgZ(11,"div"),e._uU(12,"New Booking"),e.qZA(),e.TgZ(13,"app-icon"),e._uU(14,"add"),e.qZA()()(),e.TgZ(15,"div",8)(16,"mat-form-field",9)(17,"mat-select",10),e.NdJ("ngModelChange",function(a){return n.updateZones([a])}),e.ALo(18,"async"),e.YNc(19,wt,2,2,"mat-option",11),e.ALo(20,"async"),e.qZA()(),e._UZ(21,"div",12)(22,"div",5),e.YNc(23,Et,6,3,"ng-container",13)(24,Ot,14,0,"ng-container",13),e.qZA(),e.TgZ(25,"div",14),e._UZ(26,"router-outlet"),e.qZA(),e.YNc(27,Nt,1,0,"mat-progress-bar",15),e.ALo(28,"async"),e.qZA()()),2&o){let i,a;e.xp6(6),e.hij(" ",n.page_title," "),e.xp6(2),e.Q6J("model",null==(i=e.lcZ(9,7,n.filters))?null:i.search),e.xp6(9),e.Q6J("ngModel",null==(a=e.lcZ(18,9,n.filters))?null:a.zones[0]),e.xp6(2),e.Q6J("ngForOf",e.lcZ(20,11,n.levels)),e.xp6(4),e.Q6J("ngIf","events"===n.path),e.xp6(),e.Q6J("ngIf","manage"===n.path),e.xp6(3),e.Q6J("ngIf",e.lcZ(28,13,n.loading)&&"events"===n.path)}},dependencies:[p.sg,p.O5,u.JJ,u.On,U.E,q.U,At.O,Zt.u,C.KE,$.gD,x.ey,O.gM,R.pW,x.wG,D.o,T.lC,p.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=new-desks.component.ts-angular-inline--126.css.map*/"]})}return s})(),children:[{path:"events",component:Q},{path:"map",component:j},{path:"manage",component:H},{path:"**",redirectTo:"events"}]},{path:"",component:Ue,children:[{path:"events",component:Q},{path:"map",component:j},{path:"manage",component:H},{path:"**",redirectTo:"events"}]}];let yt=(()=>{class s{static#e=this.\u0275fac=function(o){return new(o||s)};static#t=this.\u0275mod=e.oAB({type:s});static#n=this.\u0275inj=e.cJS({imports:[p.ez,u.u5,N.Nh,u.UX,ee.v,E.P2,A.EP,Ct.W9,V.Fk,C.lN,y.p9,S.c,T.Bz.forChild(St)]})}return s})()}}]);
//# sourceMappingURL=apps_concierge_src_app_desks_desks_module_ts.js.map