"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_desks_desks_module_ts"],{4655:(Le,J,r)=>{r.r(J),r.d(J,{DesksModule:()=>k});var u=r(4666),g=r(2508),_=r(9885),P=r(9843),M=r(1916),D=r(1709),z=r(3045),c=r(3770),v=r(9519),e=r(2560),B=r(4945),H=r(4984),m=r(3918),q=r(5670),b=r(3910),h=r(6221),U=r(9232),S=r(8441),G=r(9396),w=r(9159),A=r(1204),K=r(9732),R=r(7090);function V(a,n){1&a&&(e.TgZ(0,"mat-option",10),e._uU(1,"All Levels"),e.qZA())}function E(a,n){if(1&a&&(e.TgZ(0,"mat-option",11),e._uU(1),e.qZA()),2&a){const t=n.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function W(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",12),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.newDesk())}),e._uU(1," New Desk "),e.qZA()}}function X(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"button",13),e._uU(1," Upload CSV "),e.TgZ(2,"input",14),e.NdJ("change",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.loadCSVData(o))}),e.qZA()()}}class Z extends c.KG{constructor(n,t,s,o){super(),this._desks=n,this._org=t,this._route=s,this._router=o,this.levels=this._org.active_levels,this.filters=this._desks.filters,this.manage=!1,this.is_map=!1,this.setDate=i=>this._desks.setFilters({date:i}),this.setFilters=i=>this._desks.setFilters(i),this.updateZones=i=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:i.join(",")},queryParamsHandling:"merge"}),this._desks.setFilters({zones:i})}}ngOnInit(){var n=this;return(0,m.Z)(function*(){yield n._org.initialised.pipe((0,q.P)(t=>t)).toPromise(),n.subscription("route.query",n._route.queryParamMap.subscribe(t=>{if(t.has("zone_ids")){const s=t.get("zone_ids").split(",");if(s.length){n.updateZones(s);const o=n._org.levelWithID(s);if(!o)return;n._org.building=n._org.buildings.find(i=>i.id===o.parent_id)}}t.has("date")&&n.setDate(new Date(+t.get("date"))),t.has("approve")?n.approve(t.get("approve")):t.has("reject")&&n.reject(t.get("reject")),n.manage=n._router.url?.includes("manage"),n.is_map=n._router.url?.includes("map")})),n.subscription("levels",n._org.active_levels.subscribe(function(){var t=(0,m.Z)(function*(s){const i=(yield n.filters.pipe((0,b.q)(1)).toPromise())?.zones?.filter(l=>s.find(d=>d.id===l)||"All"===l)||[];!i.length&&s.length&&i.push(s[0].id),n.updateZones(i)});return function(s){return t.apply(this,arguments)}}())),n.manage=n._router.url?.includes("manage"),n.is_map=n._router.url?.includes("map")})()}newDesk(){this._desks.addDesks([new h.nk({id:`desk-${(0,c.Iy)(999999)}`})]),(0,c.t5)("New desk added to local data. Make sure to save the desk before using it.")}loadCSVData(n){var t=this;return(0,m.Z)(function*(){const s=yield(0,c.fT)(n).catch(([o,i])=>{throw(0,c.cB)(o),i});try{const o=(0,c.n5)(s)||[];t._desks.addDesks(o.map(i=>new h.nk({...i,id:i.id||`desk-${(0,c.Iy)(999999)}`})))}catch(o){console.error(o)}})()}approve(n){var t=this;return(0,m.Z)(function*(){const s=yield(0,U.Fo)(n).toPromise();s&&t._desks.approveDesk(s)})()}reject(n){var t=this;return(0,m.Z)(function*(){const s=yield(0,U.Fo)(n).toPromise();s&&t._desks.rejectDesk(s)})()}}function ee(a,n){1&a&&e._UZ(0,"mat-progress-bar",7)}Z.\u0275fac=function(n){return new(n||Z)(e.Y36(v.H),e.Y36(h.w7),e.Y36(_.gz),e.Y36(_.F0))},Z.\u0275cmp=e.Xpm({type:Z,selectors:[["desks-topbar"]],features:[e.qOj],decls:14,vars:14,consts:[[1,"flex","items-center","bg-white","dark:bg-neutral-700","h-20","px-4","border-b","border-gray-300","dark:border-neutral-500","space-x-2"],["appearance","outline"],["placeholder","All Levels",3,"ngModel","ngModelChange"],["value","All",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["mat-button","","class","mx-2 w-32",3,"click",4,"ngIf"],["mat-button","","class","relative w-32",4,"ngIf"],[1,"flex-1","w-2"],[1,"mr-2",3,"model","modelChange"],[3,"dateChange"],["value","All"],[3,"value"],["mat-button","",1,"mx-2","w-32",3,"click"],["mat-button","",1,"relative","w-32"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),e.NdJ("ngModelChange",function(o){return t.updateZones([o])}),e.ALo(3,"async"),e.ALo(4,"async"),e.YNc(5,V,2,0,"mat-option",3),e.YNc(6,E,2,2,"mat-option",4),e.ALo(7,"async"),e.qZA()(),e.YNc(8,W,2,0,"button",5),e.YNc(9,X,3,0,"button",6),e._UZ(10,"div",7),e.TgZ(11,"searchbar",8),e.NdJ("modelChange",function(o){return t.setFilters({search:o})}),e.ALo(12,"async"),e.qZA(),e.TgZ(13,"date-options",9),e.NdJ("dateChange",function(o){return t.setDate(o)}),e.qZA()()),2&n){let s;e.xp6(2),e.Q6J("ngModel",e.lcZ(3,6,t.filters).zones?e.lcZ(4,8,t.filters).zones[0]:"All"),e.xp6(3),e.Q6J("ngIf",!t.is_map),e.xp6(1),e.Q6J("ngForOf",e.lcZ(7,10,t.levels)),e.xp6(2),e.Q6J("ngIf",t.manage),e.xp6(1),e.Q6J("ngIf",t.manage),e.xp6(2),e.Q6J("model",null==(s=e.lcZ(12,12,t.filters))?null:s.search)}},dependencies:[u.sg,u.O5,g.JJ,g.On,S.E,G.U,w.eB,A.v_,K.x8,R.CK,u.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n/*# sourceMappingURL=desks-topbar.component.ts-angular-inline--94.css.map*/"]});const te=function(){return["/desks","events"]},ne=function(){return["/desks","map"]},se=function(){return["/desks","manage"]};class y extends c.KG{constructor(n,t){super(),this._state=n,this._router=t,this.loading=this._state.loading}ngOnInit(){this._state.startPolling(),this.subscription("router.events",this._router.events.subscribe(t=>{if(t instanceof _.m2){const s=this._router.url?.split("/")||[""];this.path=s[n.length-1].split("?")[0]}}));const n=this._router.url?.split("/")||[""];this.path=n[n.length-1].split("?")[0]}ngOnDestroy(){super.ngOnDestroy(),this._state.stopPolling()}}y.\u0275fac=function(n){return new(n||y)(e.Y36(v.H),e.Y36(_.F0))},y.\u0275cmp=e.Xpm({type:y,selectors:[["","app-desks",""]],features:[e.qOj],attrs:["app-desks",""],decls:15,vars:12,consts:[[1,"relative","w-full","flex","flex-col","bg-gray-200","dark:bg-neutral-600"],[1,"w-full"],[1,"dark"],["mat-tab-nav-bar",""],["mat-tab-link","","queryParamsHandling","merge",3,"routerLink","active"],[1,"flex-1","h-1/2","w-full","relative","overflow-auto"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(n,t){1&n&&(e._UZ(0,"sidebar"),e.TgZ(1,"main",0),e._UZ(2,"desks-topbar",1),e.TgZ(3,"div",2)(4,"nav",3)(5,"a",4),e._uU(6," Bookings "),e.qZA(),e.TgZ(7,"a",4),e._uU(8," Map View "),e.qZA(),e.TgZ(9,"a",4),e._uU(10," Manage Desks "),e.qZA()()(),e.TgZ(11,"div",5),e._UZ(12,"router-outlet"),e.qZA(),e.YNc(13,ee,1,0,"mat-progress-bar",6),e.ALo(14,"async"),e.qZA()),2&n&&(e.xp6(5),e.Q6J("routerLink",e.DdM(9,te))("active","events"===t.path),e.xp6(2),e.Q6J("routerLink",e.DdM(10,ne))("active","map"===t.path),e.xp6(2),e.Q6J("routerLink",e.DdM(11,se))("active","manage"===t.path),e.xp6(4),e.Q6J("ngIf",e.lcZ(14,7,t.loading)))},dependencies:[u.O5,M.vP,M.JV,B.k,H.eI,_.lC,_.rH,Z,u.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}\n/*# sourceMappingURL=desks.component.ts-angular-inline--92.css.map*/"]});var f=r(7344),N=r(6029),oe=r(1637),O=r(5306),j=r(1110);function ae(a,n){if(1&a&&(e._uU(0),e.ALo(1,"date"),e.ALo(2,"date")),2&a){const t=n.data;e.AsE(" ",e.lcZ(1,2,t)," at ",e.xi3(2,4,t,"shortTime")," ")}}function ie(a,n){if(1&a&&e._uU(0),2&a){const t=n.row;e.hij(" ",t.asset_name||t.asset_id," ")}}function re(a,n){if(1&a&&e._uU(0),2&a){const t=n.row;e.hij(" ",t.user_name||t.user_email||t.booked_by_name||t.booked_by_email," ")}}function le(a,n){if(1&a&&(e.TgZ(0,"span",11),e._uU(1),e.qZA()),2&a){const t=n.data;e.ekj("bg-success","approved"===t)("bg-pending","tentative"===t)("bg-error","cancelled"===t||"declined"===t),e.xp6(1),e.hij(" ",t," ")}}function ce(a,n){1&a&&e._uU(0),2&a&&e.hij(" ",n.data?"Yes":"No"," ")}function de(a,n){1&a&&(e.TgZ(0,"app-icon"),e._uU(1," qr_code "),e.qZA())}function pe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",12)(1,"action-icon",13),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.checkin(i))}),e._uU(2,"how_to_reg"),e.qZA(),e.TgZ(3,"button",14),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.approve(i))}),e.TgZ(4,"app-icon"),e._uU(5,"event_available"),e.qZA()(),e.TgZ(6,"button",15),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.reject(i))}),e.TgZ(7,"app-icon"),e._uU(8,"event_busy"),e.qZA()(),e.TgZ(9,"button",16),e.YNc(10,de,2,0,"app-icon",17),e.qZA(),e.TgZ(11,"mat-menu",null,9)(13,"div",18),e._UZ(14,"img",19),e.qZA(),e.TgZ(15,"div",20)(16,"button",21),e._uU(17," Print QR Code "),e.qZA()()()()}if(2&a){const t=n.row,s=e.MAs(12);e.xp6(9),e.Q6J("disabled",!(null!=t.extension_data&&t.extension_data.checkin_qr_code))("matMenuTriggerFor",s),e.xp6(1),e.Q6J("ngIf",null==t.extension_data?null:t.extension_data.checkin_qr_code),e.xp6(4),e.Q6J("src",null==t.extension_data?null:t.extension_data.checkin_qr_code,e.LSH)}}const ue=function(){return["user_name","group","desk_name","date","status","approver_name","checked_in","access","actions"]},me=function(){return["Person","Group","Desk","Date","Status","Approver","Checked In","Access"," "]},ge=function(){return["flex","","","12r","","10r","","","12r"]},_e=function(a,n,t,s,o,i,l){return{user_name:a,desk_name:n,date:t,status:s,checked_in:o,access:i,actions:l}};class C{constructor(n){var t=this;this._state=n,this.filters=this._state.filters,this.bookings=this._state.bookings,this.rejectAll=()=>this._state.rejectAllDesks(),this.checkin=s=>this.runMethod("checkin",(0,m.Z)(function*(){return t._state.checkinDesk(s)})),this.approve=s=>this.runMethod("approve",(0,m.Z)(function*(){return t._state.approveDesk(s)})),this.reject=s=>this.runMethod("reject",(0,m.Z)(function*(){return t._state.rejectDesk(s)}))}runMethod(n,t){var s=this;return(0,m.Z)(function*(){s.loading=n,yield t().catch(o=>null),s.loading=""})()}}C.\u0275fac=function(n){return new(n||C)(e.Y36(v.H))},C.\u0275cmp=e.Xpm({type:C,selectors:[["desk-bookings"]],decls:23,vars:23,consts:[[1,"overflow-auto","h-full","w-full"],[1,"min-w-[76rem]",3,"dataSource","filter","columns","display_column","column_size","template","empty"],["date_template",""],["desk_template",""],["user_template",""],["status_template",""],["bool_template",""],["action_template",""],["mat-icon-button","",1,"absolute","bottom-2","right-2","bg-white","shadow",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"capitalize","text-white","px-2","py-1","rounded","border","border-gray-200"],[1,"flex","items-center","justify-end","space-x-2"],[3,"click"],["mat-icon-button","","matTooltip","Approve Desk",3,"click"],["mat-icon-button","","matTooltip","Reject Desk",3,"click"],["mat-icon-button","","matTooltip","View Desk QR code",3,"disabled","matMenuTriggerFor"],[4,"ngIf"],[1,"p-2","mx-4","my-2","rounded-lg","border","border-black"],[1,"w-48",3,"src"],["mat-menu-item","",1,"underline"],["mat-button","",1,"w-full"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0),e._UZ(1,"custom-table",1),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,ae,3,7,"ng-template",null,2,e.W1O),e.YNc(6,ie,1,1,"ng-template",null,3,e.W1O),e.YNc(8,re,1,1,"ng-template",null,4,e.W1O),e.YNc(10,le,2,7,"ng-template",null,5,e.W1O),e.YNc(12,ce,1,1,"ng-template",null,6,e.W1O),e.YNc(14,pe,18,4,"ng-template",null,7,e.W1O),e.qZA(),e.TgZ(16,"button",8)(17,"app-icon"),e._uU(18,"more_vert"),e.qZA()(),e.TgZ(19,"mat-menu",null,9)(21,"button",10),e.NdJ("click",function(){return t.rejectAll()}),e._uU(22,"Reject All"),e.qZA()()),2&n){const s=e.MAs(5),o=e.MAs(7),i=e.MAs(9),l=e.MAs(11),d=e.MAs(13),p=e.MAs(15),Qe=e.MAs(20);let L,I;e.xp6(1),e.Q6J("dataSource",t.bookings)("filter",null==(L=e.lcZ(2,8,t.filters))?null:L.search)("columns",e.DdM(12,ue))("display_column",e.DdM(13,me))("column_size",e.DdM(14,ge))("template",e.Hh0(15,_e,i,o,s,l,d,d,p))("empty",null!=(I=e.lcZ(3,10,t.filters))&&I.search?"No matching desk bookings":"There are no desk booking for the currently selected date."),e.xp6(15),e.Q6J("matMenuTriggerFor",Qe)}},dependencies:[u.O5,w.eB,f.W0,f.tN,f.D8,N.Kd,oe.m,O.o,j.C,u.Ov,u.uU],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;height:100%;width:100%}\n/*# sourceMappingURL=desk-bookings.component.ts-angular-inline--93.css.map*/"]});var he=r(9697),fe=r(9136),ke=r(8461);class T extends c.KG{constructor(n,t,s,o){super(),this._state=n,this._desk=t,this._desks_state=s,this._org=o,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.actions=this._state.map_actions,this.features=this._state.map_features,this.setHost=i=>this._desks_state.setOptions({host:i})}ngOnInit(){this.subscription("desk_polling",this._desks_state.startPolling()),this.subscription("date",this._desk.filters.subscribe(n=>{const t=this._org.levelWithID(n.zones);t&&this._state.setLevel(t.id),this._desks_state.setOptions({date:n.date?new Date(n.date):new Date,zones:n.zones})}))}}T.\u0275fac=function(n){return new(n||T)(e.Y36(D.ck),e.Y36(v.H),e.Y36(D.Xp),e.Y36(h.w7))},T.\u0275cmp=e.Xpm({type:T,selectors:[["desk-map-view"]],features:[e._Bn([D.Xp]),e.qOj],decls:13,vars:19,consts:[["map","",1,"h-full","w-full","relative"],[3,"src","zoom","center","styles","features","actions"],[1,"absolute","bottom-2","right-2"],[1,"absolute","top-0","left-0","p-2","text-black"],["placeholder","User for bookings...",3,"ngModel","ngModelChange"],["info","",1,"absolute","bottom-0","rounded","p-2","m-2","bg-white","dark:bg-neutral-700","shadow","text-center"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"i-map",1),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e._UZ(8,"explore-zoom-controls",2),e.TgZ(9,"div",3)(10,"a-user-search-field",4),e.NdJ("ngModelChange",function(o){return t.setHost(o)}),e.qZA()(),e.TgZ(11,"div",5),e._uU(12," Click/Tap an available desk to book it. "),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("src",e.lcZ(2,7,t.url))("zoom",e.lcZ(3,9,t.positions).zoom)("center",e.lcZ(4,11,t.positions).center)("styles",e.lcZ(5,13,t.styles))("features",e.lcZ(6,15,t.features))("actions",e.lcZ(7,17,t.actions)),e.xp6(9),e.Q6J("ngModel",null))},dependencies:[g.JJ,g.On,he.d,fe.p,ke.s,u.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;position:relative;height:100%;width:100%}[info][_ngcontent-%COMP%]{left:50%;transform:translate(-50%)}\n/*# sourceMappingURL=desk-map-view.component.ts-angular-inline--95.css.map*/"]});var F=r(3690),ve=r(6168),be=r(7716),Ze=r(6942),ye=r(9740),Y=r(2044),Q=r(8307),Ce=r(4217),Te=r(6048);function xe(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"item-list-field",9),e.NdJ("ngModelChange",function(o){const i=e.CHM(t),l=i.row,d=i.key,p=e.oxw();return e.KtG(p.setRowValue(l.id,d,o))}),e.qZA()}if(2&a){const t=n.data,s=n.row,o=n.key,i=e.oxw();e.Q6J("placeholder","groups"===o?"User Groups":"Features")("name",o)("ngModel",(i.changes[s.id]?i.changes[s.id][o]:null)||t)}}function De(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field",11)(2,"input",12),e.NdJ("ngModelChange",function(o){const i=e.CHM(t),l=i.row,d=i.key,p=e.oxw();return e.KtG(p.setRowValue(l.id,d,o))}),e.qZA()()()}if(2&a){const t=n.data,s=n.row,o=n.key,i=e.oxw();e.xp6(2),e.Q6J("placeholder",o)("name",o)("ngModel",(i.changes[s.id]?i.changes[s.id][o]:null)||t)}}function Me(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",13)(1,"mat-checkbox",14),e.NdJ("ngModelChange",function(o){const l=e.CHM(t).row,d=e.oxw();return e.KtG(d.setRowValue(l.id,"bookable",o))}),e.qZA()()}if(2&a){const t=n.data,s=n.row,o=e.oxw();let i;e.xp6(1),e.Q6J("ngModel",null!==(i=null==o.changes[s.id]?null:o.changes[s.id].bookable)&&void 0!==i?i:t)}}function we(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",16)(2,"app-icon"),e._uU(3,"warning"),e.qZA()(),e.TgZ(4,"button",17),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.removeDesk(i))}),e.TgZ(5,"app-icon"),e._uU(6,"delete"),e.qZA()(),e.TgZ(7,"button",18),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.loadQrCode(i))}),e.TgZ(8,"app-icon"),e._uU(9,"qr_code"),e.qZA()(),e.TgZ(10,"mat-menu",null,19)(12,"div",20),e._UZ(13,"img",21),e.qZA(),e.TgZ(14,"div",22)(15,"button",23),e._uU(16," Print QR Code "),e.qZA()()()()}if(2&a){const t=n.row,s=e.MAs(11),o=e.oxw();e.xp6(1),e.ekj("opacity-0",!o.changes[t.id]),e.xp6(6),e.Q6J("matMenuTriggerFor",s),e.xp6(6),e.Q6J("src",t.qr_code,e.LSH)}}function Ae(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",24)(1,"p",25),e._uU(2),e.qZA(),e.TgZ(3,"div",26)(4,"button",27),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.save())}),e._uU(5," Save Changes "),e.qZA()()()}if(2&a){const t=e.oxw();e.xp6(2),e.hij(" ",t.changed," Desk(s) with unsaved changes ")}}function Je(a,n){if(1&a&&(e.TgZ(0,"div",28),e._UZ(1,"mat-spinner",29),e.TgZ(2,"p"),e._uU(3),e.qZA()()),2&a){const t=e.oxw();e.xp6(3),e.Oqu(t.loading)}}function Ue(a,n){if(1&a){const t=e.EpF();e.TgZ(0,"div",30)(1,"div",31)(2,"div",32),e._uU(3," Drop CSV file to add desks "),e.qZA()(),e.TgZ(4,"input",33),e.NdJ("change",function(o){e.CHM(t);const i=e.oxw();return e.KtG(i.loadCSVData(o))}),e.qZA()()}}const Ne=function(){return["map_id","bookable","name","groups","features","actions"]},Oe=function(){return["ID","Bookable","Name","Groups","Features"," "]},je=function(){return["8r","6r","12r","flex","16r","10r"]},Fe=function(a,n,t,s,o,i){return{map_id:a,name:n,bookable:t,groups:s,features:o,actions:i}};class x extends c.KG{constructor(n,t,s){super(),this._state=n,this._org=t,this._dialog=s,this.changes={},this.dragging=!1,this.filters=this._state.filters,this.desks=(0,be.aj)([this._state.desks,this._state.new_desks]).pipe((0,Ze.U)(([o,i])=>o.concat(i)))}get changed(){return(Object.keys(this.changes).length||0)+(this._state.new_desk_count||0)}setRowValue(n,t,s){this.changes[n]||(this.changes[n]={}),this.changes[n][t]=s}removeDesk(n){var t=this;return(0,m.Z)(function*(){const s=yield(0,c._5)({title:"Remove desk",content:`Remove desk ${n.name}?`,icon:{content:"delete"}},t._dialog);if("done"!==s.reason)return;s.close();const i=(yield t.desks.pipe((0,b.q)(1)).toPromise()).filter(p=>p.id!==n.id),l=yield t.filters.pipe((0,b.q)(1)).toPromise(),d=t._org.levelWithID(l.zones);t.loading="Removing desk...",yield(0,F.Ymr)(d.id,{name:"desks",description:"desks",details:i}).toPromise().catch(p=>{throw t.loading="",(0,c.cB)(`Error saving desk data. Error: ${p.message||p}`),p}),(0,c.t5)("Successfully updated desks"),t.loading="",t.changes={}})()}save(){var n=this;return(0,m.Z)(function*(){n.loading="Saving changes to desks...";const t=yield n.desks.pipe((0,b.q)(1)).toPromise(),s=(0,c.Tw)(t.map(l=>new h.nk({...l,...n.changes[l.id]||{}}).toJSON()),"id"),o=yield n.filters.pipe((0,b.q)(1)).toPromise(),i=n._org.levelWithID(o.zones);yield(0,F.Ymr)(i.id,{name:"desks",description:"desks",details:s}).toPromise().catch(l=>{throw n.loading="",(0,c.cB)(`Error saving desk data. Error: ${403===l?.status?"You do not have the required permissions to save desk changes.":l.message||l}`),l}),(0,c.t5)("Successfully updated desks"),n._state.clearNewDesks(),n.loading="",n.changes={}})()}loadQrCode(n){n.qr_code=(0,ve.w)(`${location.origin}/workplace/#/book/code?asset_id=${encodeURIComponent(n.id)}`)}loadCSVData(n){var t=this;return(0,m.Z)(function*(){t.loading="Loading CSV file...",t.dragging=!1;const s=yield(0,c.fT)(n).catch(([o,i])=>{throw(0,c.cB)(o),i});try{const o=(0,c.n5)(s)||[];t._state.addDesks(o.map(i=>new h.nk({...i,id:i.id||`desk-${(0,c.Iy)(999999)}`})))}catch(o){console.error(o)}t.loading=""})()}handleDrag(n,t){this.dragging="enter"===n}}x.\u0275fac=function(n){return new(n||x)(e.Y36(v.H),e.Y36(h.w7),e.Y36(ye.on))},x.\u0275cmp=e.Xpm({type:x,selectors:[["desks-manage"]],features:[e.qOj],decls:15,vars:26,consts:[[1,"w-full","h-full","overflow-auto","relative",3,"dragenter","dragend"],[1,"min-w-[72rem]","block",3,"dataSource","filter","columns","display_column","column_size","template","pagination","page_size","empty"],["list_edit_template",""],["text_edit_template",""],["bookable_edit_template",""],["action_template",""],["class","fixed bottom-2 left-1/2 transform -translate-x-1/2 p-4 rounded bg-white shadow",4,"ngIf"],["class","absolute inset-0 flex flex-col items-center justify-center space-y-2 bg-white bg-opacity-60",4,"ngIf"],["class","absolute inset-0 bg-black/60 flex items-center justify-center",4,"ngIf"],["hide-outline","",1,"w-full",3,"placeholder","name","ngModel","ngModelChange"],["hide-outline","",1,"w-full","h-12"],["appearance","outline",1,"h-12","w-full"],["matInput","",3,"placeholder","name","ngModel","ngModelChange"],[1,"flex","items-center","justify-center","pl-4"],[3,"ngModel","ngModelChange"],[1,"flex","items-center","justify-end","space-x-2"],["matTooltip","Desk has unsaved changes",1,"p-2","text-2xl","text-pending"],["mat-icon-button","",3,"click"],["mat-icon-button","",3,"matMenuTriggerFor","click"],["menu","matMenu"],[1,"p-2","mx-4","my-2","rounded-lg","border","border-black"],[1,"w-48",3,"src"],["mat-menu-item","",1,"underline"],["mat-button","",1,"w-full"],[1,"fixed","bottom-2","left-1/2","transform","-translate-x-1/2","p-4","rounded","bg-white","shadow"],[1,"mb-2","text-xl"],[1,"flex","items-center","justify-center"],["save","","mat-button","",3,"click"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2","bg-white","bg-opacity-60"],["diameter","32"],[1,"absolute","inset-0","bg-black/60","flex","items-center","justify-center"],[1,"bg-white","p-4","rounded","shadow"],[1,"border-4","border-gray-300","border-dashed","rounded","flex","flex-col","items-center","justify-center","w-64","h-64"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0),e.NdJ("dragenter",function(o){return t.handleDrag("enter",o)})("dragend",function(o){return t.handleDrag("end",o)},!1,e.Jf7),e._UZ(1,"custom-table",1),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,xe,1,3,"ng-template",null,2,e.W1O),e.YNc(6,De,3,3,"ng-template",null,3,e.W1O),e.YNc(8,Me,2,1,"ng-template",null,4,e.W1O),e.YNc(10,we,17,4,"ng-template",null,5,e.W1O),e.YNc(12,Ae,6,1,"div",6),e.YNc(13,Je,4,1,"div",7),e.YNc(14,Ue,5,0,"div",8),e.qZA()),2&n){const s=e.MAs(5),o=e.MAs(7),i=e.MAs(9),l=e.MAs(11);let d,p;e.xp6(1),e.Q6J("dataSource",t.desks)("filter",null==(d=e.lcZ(2,12,t.filters))?null:d.search)("columns",e.DdM(16,Ne))("display_column",e.DdM(17,Oe))("column_size",e.DdM(18,je))("template",e.HTZ(19,Fe,o,o,i,s,s,l))("pagination",!0)("page_size",30)("empty",null!=(p=e.lcZ(3,14,t.filters))&&p.search?"No matching desks":"No desks for selected level"),e.xp6(11),e.Q6J("ngIf",t.changed>0),e.xp6(1),e.Q6J("ngIf",t.loading),e.xp6(1),e.Q6J("ngIf",t.dragging)}},dependencies:[u.O5,g.Fj,g.JJ,g.On,w.eB,A.v_,Y.k0,Q.FC,f.W0,f.tN,f.D8,N.Kd,Ce.sN,Te.q9,O.o,j.C,u.Ov]});const Ye=[{path:"",component:y,children:[{path:"events",component:C},{path:"map",component:T},{path:"manage",component:x},{path:"**",redirectTo:"events"}]},{path:"**",redirectTo:"events"}];class k{}k.\u0275fac=function(n){return new(n||k)},k.\u0275mod=e.oAB({type:k}),k.\u0275inj=e.cJS({imports:[u.ez,g.u5,M.Nn,g.UX,z.v,D.P2,P.Xo,A.wp,Q.Zh,Y.x4,_.Bz.forChild(Ye)]})}}]);
//# sourceMappingURL=apps_concierge_src_app_desks_desks_module_ts.js.map