"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_desks_desks_module_ts"],{9870:(Ut,U,r)=>{r.r(U),r.d(U,{DesksModule:()=>Jt});var p=r(6477),u=r(9542),h=r(647),te=r(8046),L=r(2128),w=r(1983),ne=r(3045),c=r(337),C=r(9519),e=r(6839),oe=r(4945),q=r(6297),g=r(1670),$=r(5670),D=r(3910),k=r(5912),Z=r(5375),se=r(4505),M=r(7486),K=r(5312),T=r(7728),v=r(5306),W=r(3200),ie=r(312),x=r(8750),S=r(380),y=r(7672),ae=r(2306),le=r(1022),re=r(7303),_e=r(6471),B=r(9697),ce=r(9254),de=r(321);function pe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"section",31)(1,"button",32),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.setOptions({group:!1,members:[]}))}),e.ALo(2,"async"),e.ALo(3,"async"),e.TgZ(4,"app-icon",33),e._uU(5,"person"),e.qZA(),e.TgZ(6,"div",34),e.SDv(7,35),e.qZA(),e._UZ(8,"div",36),e.ALo(9,"async"),e.ALo(10,"async"),e.qZA(),e.TgZ(11,"button",32),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.setOptions({group:!0}))}),e.ALo(12,"async"),e.ALo(13,"async"),e.TgZ(14,"app-icon",33),e._uU(15,"group_add"),e.qZA(),e.TgZ(16,"div",34),e.SDv(17,37),e.qZA(),e._UZ(18,"div",36),e.ALo(19,"async"),e.ALo(20,"async"),e.qZA()()}if(2&o){const t=e.oxw(2);let n,s,i,l,_,d,m,A;e.xp6(1),e.ekj("text-primary",!(null!=(n=e.lcZ(2,16,t.options))&&n.group))("opacity-60",null==(s=e.lcZ(3,18,t.options))?null:s.group),e.xp6(7),e.ekj("bg-gray-200",null==(i=e.lcZ(9,20,t.options))?null:i.group)("bg-primary",!(null!=(l=e.lcZ(10,22,t.options))&&l.group)),e.xp6(3),e.ekj("text-primary",null==(_=e.lcZ(12,24,t.options))?null:_.group)("opacity-60",!(null!=(d=e.lcZ(13,26,t.options))&&d.group)),e.xp6(7),e.ekj("bg-gray-200",!(null!=(m=e.lcZ(19,28,t.options))&&m.group))("bg-primary",null==(A=e.lcZ(20,30,t.options))?null:A.group)}}function ue(o,a){1&o&&(e.TgZ(0,"div",38)(1,"label",11),e._uU(2,"Host"),e.TgZ(3,"span"),e._uU(4,"*"),e.qZA()(),e._UZ(5,"a-user-search-field",39),e.qZA())}function me(o,a){1&o&&(e.TgZ(0,"mat-checkbox",40),e.SDv(1,41),e.qZA())}const I=function(){return{standalone:!0}};function ge(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",19)(1,"div",20)(2,"mat-checkbox",42),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw(2);return e.KtG(i.form.patchValue({secondary_resource:s?"locker":""}))}),e.SDv(3,43),e.qZA()()()}if(2&o){const t=e.oxw(2);e.xp6(2),e.Q6J("ngModel",!!t.form.value.secondary_resource)("ngModelOptions",e.DdM(2,I))}}const fe=function(){return[]};function he(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"section",3)(1,"h3",44)(2,"div",5),e._uU(3," 2 "),e.qZA(),e.TgZ(4,"div",6),e.SDv(5,45),e.qZA(),e._UZ(6,"div",46),e.qZA(),e.TgZ(7,"div",47)(8,"a-user-list-field",48),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw(2);return e.KtG(i.setOptions({members:s}))}),e.ALo(9,"async"),e.qZA()()()}if(2&o){const t=e.oxw(2);let n;e.xp6(8),e.Q6J("ngModel",(null==(n=e.lcZ(9,2,t.options))?null:n.members)||e.DdM(4,fe))("ngModelOptions",e.DdM(5,I))}}function ke(o,a){1&o&&(e.TgZ(0,"p",52),e._uU(1," Desks nearby to the selected desk will booked for group members "),e.qZA())}function Te(o,a){if(1&o&&(e.TgZ(0,"section",3)(1,"h3",4)(2,"div",5),e._uU(3),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"div",6),e.SDv(6,49),e.qZA()(),e._UZ(7,"desk-list-field",50),e.YNc(8,ke,2,0,"p",51),e.ALo(9,"async"),e.qZA()),2&o){const t=e.oxw(2);let n,s;e.xp6(3),e.hij(" ",null!=(n=e.lcZ(4,2,t.options))&&n.group?3:2," "),e.xp6(5),e.Q6J("ngIf",null==(s=e.lcZ(9,4,t.options))?null:s.group)}}function xe(o,a){if(1&o&&(e.TgZ(0,"section",3)(1,"h3",4)(2,"div",5),e._uU(3),e.ALo(4,"async"),e.qZA(),e.TgZ(5,"div",6),e.SDv(6,53),e.qZA()(),e._UZ(7,"asset-list-field",54),e.qZA()),2&o){const t=e.oxw(2);let n;e.xp6(3),e.hij(" ",null!=(n=e.lcZ(4,3,t.options))&&n.group?4:3," "),e.xp6(4),e.Q6J("date",t.form.value.date)("duration",t.form.value.duration)}}function Ce(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",1),e.YNc(1,pe,21,32,"section",2),e.TgZ(2,"section",3)(3,"h3",4)(4,"div",5),e._uU(5," 1 "),e.qZA(),e.TgZ(6,"div",6),e.SDv(7,7),e.qZA()(),e.YNc(8,ue,6,0,"div",8),e.ALo(9,"async"),e.TgZ(10,"div",9)(11,"div",10)(12,"label",11),e._uU(13,"Add Title"),e.TgZ(14,"span"),e._uU(15,"*"),e.qZA()(),e.TgZ(16,"mat-form-field",12),e._UZ(17,"input",13),e.TgZ(18,"mat-error"),e.SDv(19,14),e.qZA()()(),e.TgZ(20,"div",10)(21,"label",15),e.tHW(22,16),e._UZ(23,"span"),e.N_p(),e.qZA(),e.TgZ(24,"a-date-field",17),e.SDv(25,18),e.qZA()()(),e.TgZ(26,"div",19)(27,"div",20)(28,"label",21),e.tHW(29,22),e._UZ(30,"span"),e.N_p(),e.qZA(),e.TgZ(31,"a-time-field",23),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.form.patchValue({date:s}))}),e.qZA()(),e.TgZ(32,"div",24)(33,"label",25),e.tHW(34,26),e._UZ(35,"span"),e.N_p(),e.qZA(),e._UZ(36,"a-duration-field",27),e.YNc(37,me,2,0,"mat-checkbox",28),e.qZA()(),e.YNc(38,ge,4,3,"div",29),e.qZA(),e.YNc(39,he,10,6,"section",30),e.ALo(40,"async"),e.YNc(41,Te,10,6,"section",30),e.YNc(42,xe,8,5,"section",30),e.qZA()}if(2&o){const t=e.oxw();let n,s,i,l;e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",t.allow_groups),e.xp6(1),e.ekj("!border-none",t.allow_groups),e.xp6(6),e.Q6J("ngIf",t.can_book_for_others&&!(null!=(n=e.lcZ(9,21,t.options))&&n.group)),e.xp6(16),e.Q6J("to",t.end_date),e.xp6(7),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(25,I))("use_24hr",t.use_24hr)("disabled",t.form.value.all_day||(null==(s=t.form.get("date"))?null:s.disabled)),e.xp6(5),e.Q6J("time",null==(i=t.form.get("date"))?null:i.value)("max",720)("min",60)("step",60)("use_24hr",t.use_24hr)("force",t.form.value.all_day?"All Day":""),e.xp6(1),e.Q6J("ngIf",t.allow_all_day),e.xp6(1),e.Q6J("ngIf",t.can_book_lockers),e.xp6(1),e.Q6J("ngIf",null==(l=e.lcZ(40,23,t.options))?null:l.group),e.xp6(2),e.Q6J("ngIf",t.form.contains("resources")),e.xp6(1),e.Q6J("ngIf",t.has_assets)}}let De=(()=>{class o extends c.cx{get building(){return this._org.building}set building(t){this._org.building=t}get can_book_for_others(){return this._settings.get("app.desks.can_book_for_others")}get can_book_lockers(){return this._settings.get("app.desks.can_book_lockers")}get can_recurr(){return this._settings.get("app.desks.recurrence_allowed")}get allow_groups(){return this._settings.get("app.desks.allow_groups")}get has_assets(){return!!this._settings.get("app.desks.has_assets")}get needs_reason(){return!0===this._settings.get("app.desks.needs_reason")}get allow_time_changes(){return!!this._settings.get("app.desks.allow_time_changes")}get allow_all_day(){return this.allow_time_changes&&!!this._settings.get("app.desks.allow_all_day")}get end_date(){return(0,W.Z)((0,ie.Z)(Date.now(),this._settings.get("app.desks.available_period")||90))}get use_24hr(){return this._settings.get("app.use_24_hour_time")}constructor(t,n,s){super(),this._state=t,this._org=n,this._settings=s,this.find=new e.vpe,this.buildings=this._org.building_list,this.levels=this._org.active_levels,this.options=this._state.options,this.features=this._state.features,this.from_id=!1,this.recurrence_options=["daily","weekly","monthly"],this.setOptions=i=>this._state.setOptions(i),this.setFeature=(i,l)=>this._state.setFeature(i,l)}ngOnChanges(t){t.form&&this.form&&this.selected_desk?.id&&this.form.patchValue({resources:[this.selected_desk]})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Z.fy),e.Y36(k.w7),e.Y36(c.gb))},o.\u0275cmp=e.Xpm({type:o,selectors:[["new-desk-form-details"]],inputs:{form:"form"},outputs:{find:"find"},features:[e.qOj,e.TTD],decls:1,vars:1,consts:function(){let a,t,n,s,i,l,_,d,m,A,R,O,E;return a=$localize`:␟4f8b2bb476981727ab34ed40fde1218361f92c45␟5028777105388019087:Details`,t=$localize`:␟3501a14ee1e89ea7009e8c9d1d6796a9ac9c3718␟4954033536980360307:Booking title is required.`,n=$localize`:␟04cfb5fd033651743bc4b9408bd52ba4ee894070␟3158758063619980932:Date${"\ufffd#23\ufffd"}:START_TAG_SPAN:*${"\ufffd/#23\ufffd"}:CLOSE_TAG_SPAN:`,s=$localize`:␟407bcc42df8640bf3b85c58145c8d24572bb47b6␟6682406734296000735: Date and time must be in the future `,i=$localize`:␟02d39ddac5bbf95c424df03d5f0d22cc257556bd␟4735431816432396893: Start Time${"\ufffd#30\ufffd"}:START_TAG_SPAN:*${"\ufffd/#30\ufffd"}:CLOSE_TAG_SPAN:`,l=$localize`:␟96ca8377bef76dbcd3eb3b4d39e5414763c7033b␟7899923133926994657: End Time${"\ufffd#35\ufffd"}:START_TAG_SPAN:*${"\ufffd/#35\ufffd"}:CLOSE_TAG_SPAN:`,_=$localize`:␟ee6b1f617dd5320b23fbed018c38ac092db5e40a␟3413004253239957216:Single`,d=$localize`:␟4c90059afafb7e160384d9f512797c95bb95c6dc␟8623978917681527907:Group`,m=$localize`:␟8a5018aa2d4dd0e8a98f4499d4b7b4a9255441a5␟8093595438228616861: All Day `,A=$localize`:␟f1701d7a0d6bfb739979f9e406793d97acd138e3␟8675972661523566351: Require locker `,R=$localize`:␟60ae849c087ccc322073478a12b2504433fbdd61␟9086691296106045671:Group Members`,O=$localize`:␟654c7e59b2003acf985bee710bad11e8cdd461f8␟6078724721705612215:Desk`,E=$localize`:␟1bdfc0dfd2ac89f5d0d2af3a66e5e959d094b39c␟8637135334686190699:Request Asset`,[["class","p-0 sm:py-4 sm:px-16 divide-y divide-gray-300 space-y-2",3,"formGroup",4,"ngIf"],[1,"p-0","sm:py-4","sm:px-16","divide-y","divide-gray-300","space-y-2",3,"formGroup"],["class","flex items-center",4,"ngIf"],[1,"p-2"],[1,"space-x-2","flex","items-center","mb-4"],[1,"bg-black/20","rounded-full","h-6","w-6","flex","items-center","justify-center"],[1,"text-xl"],a,["class","w-full",4,"ngIf"],[1,"flex","items-center","flex-wrap","sm:space-x-2"],[1,"flex-1","min-w-[256px]"],["for","title"],["appearance","outline",1,"w-full"],["matInput","","name","title","formControlName","title","placeholder","e.g. Focus Time"],t,["for","date"],n,["name","date","formControlName","date",3,"to"],s,[1,"flex","items-center","space-x-2"],[1,"flex-1","w-1/3"],["for","start-time"],i,["name","start-time",3,"ngModel","ngModelOptions","use_24hr","disabled","ngModelChange"],[1,"flex-1","w-1/3","relative"],["for","end-time"],l,["name","end-time","formControlName","duration",3,"time","max","min","step","use_24hr","force"],["formControlName","all_day","class","absolute -top-2 right-0",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],["class","p-2",4,"ngIf"],[1,"flex","items-center"],["matRipple","",1,"relative","h-16","flex","items-center","justify-center","flex-1","space-x-2",3,"click"],[1,"text-2xl"],[1,""],_,[1,"absolute","h-2","inset-x-0","bottom-0","!m-0"],d,[1,"w-full"],["formControlName","user"],["formControlName","all_day",1,"absolute","-top-2","right-0"],m,[3,"ngModel","ngModelOptions","ngModelChange"],A,[1,"space-x-2","flex","items-center"],R,[1,"flex-1","w-px"],[1,"overflow-hidden"],[1,"mt-4",3,"ngModel","ngModelOptions","ngModelChange"],O,["formControlName","resources"],["class","text-center rounded px-2 py-1 bg-yellow-400 shadow text-xs",4,"ngIf"],[1,"text-center","rounded","px-2","py-1","bg-yellow-400","shadow","text-xs"],E,["formControlName","assets",3,"date","duration"]]},template:function(t,n){1&t&&e.YNc(0,Ce,43,26,"div",0),2&t&&e.Q6J("ngIf",n.form)},dependencies:[p.O5,u.Fj,u.JJ,u.JL,u.On,u.sg,u.u,x.KE,x.TO,S.Nt,y.oG,T.wG,ae.Q,le.B,re.N,_e.E,B.d,v.o,ce.k,de.A,p.Ov],encapsulation:2}),o})();function Me(o,a){if(1&o&&(e.TgZ(0,"main",5),e._UZ(1,"new-desk-form-details",6),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("form",t.form)}}function ve(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"footer",7)(1,"button",8),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.save())}),e._uU(2,"Save"),e.qZA()()}}function Ae(o,a){if(1&o&&(e.TgZ(0,"main",9),e._UZ(1,"mat-spinner",10),e.TgZ(2,"p"),e._uU(3),e.ALo(4,"async"),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("diameter",48),e.xp6(2),e.Oqu(e.lcZ(4,2,t.loading))}}let G=(()=>{class o{get form(){return this._booking_form.form}constructor(t,n){this._booking_form=t,this._dialog_ref=n,this.event=new e.vpe,this.loading=new se.X(!1)}save(){var t=this;return(0,g.Z)(function*(){t.loading.next(!0);const n=yield t._booking_form.postForm().catch(s=>{throw(0,c.cB)(s),t.loading.next(!1),s});t.event.emit({reason:"done",metadata:n}),(0,c.t5)("Successfully created booking"),t._dialog_ref.close(),t.loading.next(!1)})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(Z.fy),e.Y36(M.so))},o.\u0275cmp=e.Xpm({type:o,selectors:[["desk-book-modal"]],outputs:{event:"event"},decls:13,vars:7,consts:[[1,"flex-1","w-0"],["icon","","mat-dialog-close",""],["class","overflow-auto p-4 max-h-[65vh]",4,"ngIf","ngIfElse"],["class","flex justify-center items-center p-2 border-t border-gray-200",4,"ngIf"],["load_state",""],[1,"overflow-auto","p-4","max-h-[65vh]"],[3,"form"],[1,"flex","justify-center","items-center","p-2","border-t","border-gray-200"],["btn","","matRipple","",1,"w-32",3,"click"],["loading","",1,"h-64","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(t,n){if(1&t&&(e.TgZ(0,"header")(1,"h2"),e._uU(2,"New Desk Booking"),e.qZA(),e._UZ(3,"div",0),e.TgZ(4,"button",1)(5,"app-icon"),e._uU(6,"close"),e.qZA()()(),e.YNc(7,Me,2,1,"main",2),e.ALo(8,"async"),e.YNc(9,ve,3,0,"footer",3),e.ALo(10,"async"),e.YNc(11,Ae,5,4,"ng-template",null,4,e.W1O)),2&t){const s=e.MAs(12);e.xp6(7),e.Q6J("ngIf",!e.lcZ(8,3,n.loading))("ngIfElse",s),e.xp6(2),e.Q6J("ngIf",!e.lcZ(10,5,n.loading))}},dependencies:[p.O5,K.Ou,M.ZT,T.wG,v.o,De,p.Ov]}),o})();var F=r(308),Y=r(9377),be=r(475),N=r(6844),J=r(1110);function Ze(o,a){1&o&&(e.ynx(0),e._uU(1,"Add"),e.BQk())}function Ne(o,a){1&o&&(e._uU(0),e.ALo(1,"date")),2&o&&e.hij(" ",e.xi3(1,1,a.data,"mediumDate")," ")}function Oe(o,a){1&o&&e._uU(0),2&o&&e.hij(" ",a.data," ")}function Ee(o,a){if(1&o&&e._uU(0),2&o){const t=a.data;e.hij(" ",(null==t?null:t.length)||"0"," desk(s) ")}}function we(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",14),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw(3);return e.KtG(l.remove(i))}),e.TgZ(1,"app-icon"),e._uU(2,"delete"),e.qZA()()}}const Se=function(){return["start","duration","assets","actions"]},ye=function(){return["Date","Period","No. of Desks"," "]},Fe=function(o,a,t,n){return{start:o,duration:a,assets:t,actions:n}};function Pe(o,a){if(1&o&&(e.TgZ(0,"main",8),e._UZ(1,"custom-table",9),e.YNc(2,Ne,2,4,"ng-template",null,10,e.W1O),e.YNc(4,Oe,1,1,"ng-template",null,11,e.W1O),e.YNc(6,Ee,1,1,"ng-template",null,12,e.W1O),e.YNc(8,we,3,0,"ng-template",null,13,e.W1O),e.qZA()),2&o){const t=e.MAs(3),n=e.MAs(5),s=e.MAs(7),i=e.MAs(9),l=e.oxw(2);e.xp6(1),e.Q6J("dataSource",l.restrictions)("columns",e.DdM(4,Se))("display_column",e.DdM(5,ye))("template",e.l5B(6,Fe,t,n,s,i))}}function Re(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"footer",15)(1,"button",16),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.add())}),e._uU(2," Add Restriction "),e.qZA(),e.TgZ(3,"button",17),e.NdJ("click",function(){e.CHM(t);const s=e.oxw(2);return e.KtG(s.save())}),e._uU(4," Save Restrictions "),e.qZA()()}}function Le(o,a){if(1&o&&(e.ynx(0),e.YNc(1,Pe,10,11,"main",6),e.YNc(2,Re,5,0,"footer",7),e.BQk()),2&o){const t=e.oxw(),n=e.MAs(11);e.xp6(1),e.Q6J("ngIf",!t.adding)("ngIfElse",n),e.xp6(1),e.Q6J("ngIf",!t.adding)}}function Ke(o,a){1&o&&(e.TgZ(0,"div",18),e._UZ(1,"mat-spinner",19),e.TgZ(2,"p"),e._uU(3,"Saving desk restriction changes..."),e.qZA()()),2&o&&(e.xp6(1),e.Q6J("diameter",32))}function We(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"mat-checkbox",34),e.NdJ("ngModelChange",function(s){const l=e.CHM(t).row,_=e.oxw(2);return e.KtG(_.selected[l.id||l.map_id]=s)}),e.qZA()}if(2&o){const t=a.row,n=e.oxw(2);e.Q6J("ngModel",n.selected[t.id||t.map_id])}}const Ie=function(){return["toggle","name","map_id"]},Je=function(){return[" ","name","MapID"]},Ue=function(o){return{toggle:o}};function qe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"main",20)(1,"div",21)(2,"mat-form-field",22)(3,"mat-date-range-input",23)(4,"input",24),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.start_date=s)}),e.qZA(),e.TgZ(5,"input",25),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.end_date=s)}),e.qZA()(),e._UZ(6,"mat-datepicker-toggle",26)(7,"mat-date-range-picker",null,27),e.qZA(),e.TgZ(9,"mat-form-field",22)(10,"app-icon",28),e._uU(11,"search"),e.qZA(),e.TgZ(12,"input",29),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.search=s)}),e.qZA()()(),e._UZ(13,"custom-table",30),e.YNc(14,We,1,1,"ng-template",null,31,e.W1O),e.qZA(),e.TgZ(16,"footer",15)(17,"button",32),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.adding=!1)}),e._uU(18," Back "),e.qZA(),e.TgZ(19,"button",33),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.addRestriction())}),e._uU(20," Add to Restrictions "),e.qZA()()}if(2&o){const t=e.MAs(8),n=e.MAs(15),s=e.oxw();e.xp6(3),e.Q6J("rangePicker",t),e.xp6(1),e.Q6J("ngModel",s.start_date),e.xp6(1),e.Q6J("ngModel",s.end_date),e.xp6(1),e.Q6J("for",t),e.xp6(6),e.Q6J("ngModel",s.search),e.xp6(1),e.Q6J("dataSource",s.desk_list)("filter",s.search)("columns",e.DdM(10,Ie))("display_column",e.DdM(11,Je))("template",e.VKq(12,Ue,n))}}let $e=(()=>{class o{constructor(t,n,s){this._desks=t,this._org=n,this._dialog_ref=s,this.loading=!1,this.adding=!1,this.search="",this.selected={},this.start_date=(0,Y.Z)(Date.now()),this.end_date=(0,W.Z)(Date.now()),this.restrictions=[],this.desk_list=this._desks.desks}ngOnInit(){var t=this;return(0,g.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(n=>n)).toPromise(),(0,F.rlq)(t._org.building.id,"desk_restrictions").subscribe(({details:n})=>{t.restrictions=n instanceof Array?n:[]})})()}add(){this.search="",this.start_date=(0,Y.Z)(Date.now()),this.end_date=(0,W.Z)(Date.now()),this.selected={},this.adding=!0}remove(t){this.restrictions=this.restrictions.filter(n=>n!==t)}addRestriction(){var t=this;return(0,g.Z)(function*(){const n=yield t.desk_list.pipe((0,D.q)(1)).toPromise();t.restrictions.push({start:t.start_date.valueOf(),end:t.end_date.valueOf(),assets:n.filter(s=>t.selected[s.id]).map(s=>s.id)}),t.adding=!1})()}save(){var t=this;return(0,g.Z)(function*(){t.loading=!0,t._dialog_ref.disableClose=!0,yield(0,F.Ymr)(t._org.building.id,{name:"desk_restrictions",description:"Desk restrictions",details:t.restrictions.filter(n=>(0,be.Z)(Date.now(),n.end))}).toPromise().catch(n=>{throw t.loading=!1,t._dialog_ref.disableClose=!1,(0,c.cB)("Failed to update desk restrictions"),n}),t.loading=!1,t._dialog_ref.disableClose=!1,t._dialog_ref.close(),(0,c.t5)("Successfully updated desk restrictions")})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.H),e.Y36(k.w7),e.Y36(M.so))},o.\u0275cmp=e.Xpm({type:o,selectors:[["desk-restriction-modal"]],decls:12,vars:3,consts:[[1,"flex","items-center","justify-between"],[4,"ngIf"],["btn","","icon","","matRipple","","mat-dialog-close",""],[4,"ngIf","ngIfElse"],["load_state",""],["add_state",""],["class","h-[65vh] overflow-auto",4,"ngIf","ngIfElse"],["class","flex items-center justify-end space-x-2 p-2 border-t border-gray-200",4,"ngIf"],[1,"h-[65vh]","overflow-auto"],["empty","No desk restrictions set",1,"block","w-[calc(80vw)]",3,"dataSource","columns","display_column","template"],["date_template",""],["duration_template",""],["count_template",""],["actions_template",""],["btn","","icon","","matRipple","",3,"click"],[1,"flex","items-center","justify-end","space-x-2","p-2","border-t","border-gray-200"],["btn","","matRipple","",1,"inverse",3,"click"],["btn","","matRipple","",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-[20rem]","h-[16rem]","space-y-2"],[3,"diameter"],[1,"flex","flex-col","h-[65vh]","overflow-auto"],[1,"flex","items-center","space-x-2","px-2","pt-2"],["appearance","outline",1,"flex-1"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matIconSuffix","",3,"for"],["picker",""],["matPrefix",""],["matInput","","placeholder","Filter desks",3,"ngModel","ngModelChange"],["empty","No desk restrictions set",1,"block","w-[calc(65vw)]",3,"dataSource","filter","columns","display_column","template"],["toggle_template",""],["btn","","matRipple","",1,"inverse","w-32",3,"click"],["btn","","matRipple","",1,"w-32",3,"click"],[3,"ngModel","ngModelChange"]],template:function(t,n){if(1&t&&(e.TgZ(0,"header",0)(1,"h2"),e.YNc(2,Ze,2,0,"ng-container",1),e._uU(3," Desk Restrictions "),e.qZA(),e.TgZ(4,"button",2)(5,"app-icon"),e._uU(6,"close"),e.qZA()()(),e.YNc(7,Le,3,3,"ng-container",3),e.YNc(8,Ke,4,1,"ng-template",null,4,e.W1O),e.YNc(10,qe,21,14,"ng-template",null,5,e.W1O)),2&t){const s=e.MAs(9);e.xp6(2),e.Q6J("ngIf",n.adding),e.xp6(5),e.Q6J("ngIf",!n.loading)("ngIfElse",s)}},dependencies:[p.O5,u.Fj,u.JJ,u.On,x.KE,x.qo,x.R9,S.Nt,y.oG,N.nW,N.wx,N.zY,N.By,N._g,K.Ou,M.ZT,T.wG,v.o,J.C,p.uU]}),o})();var Q=r(8441),j=r(9396),H=r(6508),P=r(2423);function Be(o,a){1&o&&(e.TgZ(0,"mat-option",13),e._uU(1,"All Levels"),e.qZA())}function Ge(o,a){if(1&o&&(e.TgZ(0,"mat-option",14),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function Ye(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.newDeskBooking())}),e._uU(1," New Booking "),e.qZA()}}function Qe(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.newDesk())}),e.TgZ(1,"app-icon"),e._uU(2,"add"),e.qZA()()}}function je(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",17)(1,"app-icon"),e._uU(2,"cloud_upload"),e.qZA(),e.TgZ(3,"input",18),e.NdJ("change",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.loadCSVData(s))}),e.qZA()()}}function He(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.downloadTemplate())}),e.TgZ(1,"app-icon"),e._uU(2,"download"),e.qZA()()}}function ze(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.manageRestrictions())}),e.TgZ(1,"app-icon"),e._uU(2,"lock_open"),e.qZA()()}}let Xe=(()=>{class o extends c.cx{constructor(t,n,s,i,l){super(),this._desks=t,this._org=n,this._route=s,this._router=i,this._dialog=l,this.levels=this._org.active_levels,this.filters=this._desks.filters,this.manage=!1,this.is_map=!1,this.setDate=_=>this._desks.setFilters({date:_}),this.setFilters=_=>this._desks.setFilters(_),this.updateZones=_=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:_.join(",")},queryParamsHandling:"merge"}),this._desks.setFilters({zones:_})}}ngOnInit(){var t=this;return(0,g.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(n=>n)).toPromise(),t.subscription("route.query",t._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const s=n.get("zone_ids").split(",");if(s.length){t.updateZones(s);const i=t._org.levelWithID(s);if(!i)return;t._org.building=t._org.buildings.find(l=>l.id===i.parent_id)}}n.has("date")&&t.setDate(new Date(+n.get("date"))),n.has("approve")?t.approve(n.get("approve")):n.has("reject")&&t.reject(n.get("reject")),t.manage=t._router.url?.includes("manage"),t.is_map=t._router.url?.includes("map")})),t.subscription("router.events",t._router.events.subscribe(()=>{t.manage=t._router.url?.includes("manage"),t.is_map=t._router.url?.includes("map")})),t.subscription("levels",t._org.active_levels.subscribe(function(){var n=(0,g.Z)(function*(s){const l=(yield t.filters.pipe((0,D.q)(1)).toPromise())?.zones?.filter(_=>s.find(d=>d.id===_)||"All"===_)||[];!l.length&&s.length&&l.push(s[0].id),t.updateZones(l)});return function(s){return n.apply(this,arguments)}}())),t.manage=t._router.url?.includes("manage"),t.is_map=t._router.url?.includes("map")})()}newDesk(){this._desks.addDesks([new k.nk({id:`desk-${(0,c.Iy)(999999)}`})]),(0,c.t5)("New desk added to local data. Make sure to save the desk before using it.")}newDeskBooking(){this._dialog.open(G,{})}manageRestrictions(){this._dialog.open($e,{})}loadCSVData(t){var n=this;return(0,g.Z)(function*(){const s=yield(0,c.fT)(t).catch(([i,l])=>{throw(0,c.cB)(i),l});try{const i=(0,c.n5)(s)||[];n._desks.addDesks(i.map(l=>new k.nk({...l,id:l.id||`desk-${(0,c.Iy)(999999)}`})))}catch(i){console.error(i)}})()}downloadTemplate(){const t=new k.nk({id:"desk-123",name:"Test Desk",bookable:!0,groups:["test-desk-group","desk-bookers"],features:["Standing Desk","Dual Monitor"]}).toJSON(),n=(0,c.o3)([t]);(0,c.Sv)("desk-template.csv",n)}approve(t){var n=this;return(0,g.Z)(function*(){const s=yield(0,Z.Fo)(t).toPromise();s&&n._desks.approveDesk(s)})()}reject(t){var n=this;return(0,g.Z)(function*(){const s=yield(0,Z.Fo)(t).toPromise();s&&n._desks.rejectDesk(s)})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.H),e.Y36(k.w7),e.Y36(h.gz),e.Y36(h.F0),e.Y36(M.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["desks-topbar"]],features:[e.qOj],decls:17,vars:17,consts:[[1,"flex","items-center","bg-white","dark:bg-neutral-700","h-20","px-4","border-b","border-gray-300","dark:border-neutral-500","space-x-2"],["appearance","outline"],["placeholder","All Levels",3,"ngModel","ngModelChange"],["value","All",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["btn","","matRipple","","class","mx-2 w-36","matTooltip","New Desk Booking",3,"click",4,"ngIf"],["btn","","icon","","matRipple","","class","bg-primary mx-2 text-white rounded","matTooltip","New Desk",3,"click",4,"ngIf"],["btn","","icon","","matRipple","","class","bg-primary relative text-white rounded","matTooltip","Upload Desks CSV",4,"ngIf"],["btn","","icon","","matRipple","","class","bg-primary mx-2 text-white rounded","matTooltip","Download Template Desk CSV",3,"click",4,"ngIf"],["btn","","icon","","matRipple","","class","bg-primary mx-2 text-white rounded","matTooltip","Desk Restrictions",3,"click",4,"ngIf"],[1,"flex-1","w-2"],[1,"mr-2",3,"model","modelChange"],[3,"dateChange"],["value","All"],[3,"value"],["btn","","matRipple","","matTooltip","New Desk Booking",1,"mx-2","w-36",3,"click"],["btn","","icon","","matRipple","","matTooltip","New Desk",1,"bg-primary","mx-2","text-white","rounded",3,"click"],["btn","","icon","","matRipple","","matTooltip","Upload Desks CSV",1,"bg-primary","relative","text-white","rounded"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"],["btn","","icon","","matRipple","","matTooltip","Download Template Desk CSV",1,"bg-primary","mx-2","text-white","rounded",3,"click"],["btn","","icon","","matRipple","","matTooltip","Desk Restrictions",1,"bg-primary","mx-2","text-white","rounded",3,"click"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),e.NdJ("ngModelChange",function(i){return n.updateZones([i])}),e.ALo(3,"async"),e.ALo(4,"async"),e.YNc(5,Be,2,0,"mat-option",3),e.YNc(6,Ge,2,2,"mat-option",4),e.ALo(7,"async"),e.qZA()(),e.YNc(8,Ye,2,0,"button",5),e.YNc(9,Qe,3,0,"button",6),e.YNc(10,je,4,0,"button",7),e.YNc(11,He,3,0,"button",8),e.YNc(12,ze,3,0,"button",9),e._UZ(13,"div",10),e.TgZ(14,"searchbar",11),e.NdJ("modelChange",function(i){return n.setFilters({search:i})}),e.ALo(15,"async"),e.qZA(),e.TgZ(16,"date-options",12),e.NdJ("dateChange",function(i){return n.setDate(i)}),e.qZA()()),2&t){let s;e.xp6(2),e.Q6J("ngModel",e.lcZ(3,9,n.filters).zones?e.lcZ(4,11,n.filters).zones[0]:"All"),e.xp6(3),e.Q6J("ngIf",!n.is_map),e.xp6(1),e.Q6J("ngForOf",e.lcZ(7,13,n.levels)),e.xp6(2),e.Q6J("ngIf",!n.manage),e.xp6(1),e.Q6J("ngIf",n.manage),e.xp6(1),e.Q6J("ngIf",n.manage),e.xp6(1),e.Q6J("ngIf",n.manage),e.xp6(1),e.Q6J("ngIf",n.manage),e.xp6(2),e.Q6J("model",null==(s=e.lcZ(15,15,n.filters))?null:s.search)}},dependencies:[p.sg,p.O5,u.JJ,u.On,Q.E,j.U,x.KE,H.gD,T.ey,P.gM,T.wG,v.o,p.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n/*# sourceMappingURL=desks-topbar.component.ts-angular-inline--123.css.map*/"]}),o})();const Ve=["app-desks",""];function et(o,a){1&o&&e._UZ(0,"mat-progress-bar",7)}const tt=function(){return["/book","desks","events"]},nt=function(){return["/book","desks","map"]},ot=function(){return["/book","desks","manage"]};let st=(()=>{class o extends c.cx{constructor(t,n){super(),this._state=t,this._router=n,this.loading=this._state.loading}ngOnInit(){this._state.refresh(),this.subscription("router.events",this._router.events.subscribe(n=>{if(n instanceof h.m2){const s=this._router.url?.split("/")||[""];this.path=s[t.length-1].split("?")[0]}}));const t=this._router.url?.split("/")||[""];this.path=t[t.length-1].split("?")[0]}ngOnDestroy(){super.ngOnDestroy()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.H),e.Y36(h.F0))},o.\u0275cmp=e.Xpm({type:o,selectors:[["","app-desks",""]],features:[e.qOj],attrs:Ve,decls:15,vars:12,consts:[[1,"flex-1","relative","w-1/2","flex","flex-col","bg-gray-200","dark:bg-neutral-600","overflow-hidden"],[1,"w-full"],[1,"dark"],["mat-tab-nav-bar",""],["mat-tab-link","","queryParamsHandling","merge",3,"routerLink","active"],[1,"flex-1","h-1/2","w-full","relative","overflow-auto"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(t,n){1&t&&(e._UZ(0,"sidebar"),e.TgZ(1,"main",0),e._UZ(2,"desks-topbar",1),e.TgZ(3,"div",2)(4,"nav",3)(5,"a",4),e._uU(6," Bookings "),e.qZA(),e.TgZ(7,"a",4),e._uU(8," Map View "),e.qZA(),e.TgZ(9,"a",4),e._uU(10," Manage Desks "),e.qZA()()(),e.TgZ(11,"div",5),e._UZ(12,"router-outlet"),e.qZA(),e.YNc(13,et,1,0,"mat-progress-bar",6),e.ALo(14,"async"),e.qZA()),2&t&&(e.xp6(5),e.Q6J("routerLink",e.DdM(9,tt))("active","events"===n.path),e.xp6(2),e.Q6J("routerLink",e.DdM(10,nt))("active","map"===n.path),e.xp6(2),e.Q6J("routerLink",e.DdM(11,ot))("active","manage"===n.path),e.xp6(4),e.Q6J("ngIf",e.lcZ(14,7,n.loading)))},dependencies:[p.O5,L.BU,L.Nj,oe.k,q.pW,h.lC,h.rH,Xe,p.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}\n/*# sourceMappingURL=desks.component.ts-angular-inline--121.css.map*/"]}),o})();var z=r(6942),b=r(9314);function it(o,a){if(1&o&&(e.TgZ(0,"div",14)(1,"div",15),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"div",16),e._uU(5),e.ALo(6,"date"),e.qZA()()),2&o){const t=a.data;e.xp6(2),e.Oqu(e.xi3(3,2,t,"MMM")),e.xp6(3),e.Oqu(e.xi3(6,5,t,"dd"))}}function at(o,a){if(1&o&&(e._uU(0),e.ALo(1,"date"),e.ALo(2,"date")),2&o){const t=a.row,n=e.oxw();e.AsE(" ",e.xi3(1,2,t.date,n.time_format)," \u2013 ",e.xi3(2,5,t.end,n.time_format)," ")}}function lt(o,a){if(1&o&&e._uU(0),2&o){const t=a.row;e.hij(" ",t.asset_name||t.asset_id," ")}}function rt(o,a){if(1&o&&(e.TgZ(0,"div",20),e._uU(1),e.qZA()),2&o){const t=e.oxw().row;e.xp6(1),e.hij(" ",t.user_email," ")}}function _t(o,a){if(1&o&&(e.TgZ(0,"div",17)(1,"div",18),e._uU(2),e.qZA(),e.YNc(3,rt,2,1,"div",19),e.qZA()),2&o){const t=a.row;e.xp6(2),e.hij(" ",t.user_name||t.user_email||t.booked_by_name||t.booked_by_email," "),e.xp6(1),e.Q6J("ngIf",t.user_name)}}function ct(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",21)(1,"div",22),e._uU(2),e.qZA(),e.TgZ(3,"app-icon",16),e._uU(4,"arrow_drop_down"),e.qZA()(),e.TgZ(5,"mat-menu",null,23)(7,"button",13),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.approve(s.row))}),e.TgZ(8,"div",24)(9,"app-icon",25),e._uU(10,"event_available"),e.qZA(),e.TgZ(11,"div"),e._uU(12,"Approve Desk"),e.qZA()()(),e.TgZ(13,"button",13),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.reject(s.row))}),e.TgZ(14,"div",24)(15,"app-icon",25),e._uU(16,"event_busy"),e.qZA(),e.TgZ(17,"div"),e._uU(18,"Decline Desk"),e.qZA()()()()}if(2&o){const t=a.data,n=e.MAs(6);e.ekj("bg-success","approved"===t)("text-white","tentative"!==t)("bg-pending","tentative"===t)("text-black","tentative"===t)("bg-error","cancelled"===t||"declined"===t||"ended"===t),e.Q6J("matMenuTriggerFor",n),e.xp6(2),e.Oqu(t)}}function dt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",26)(1,"div",22),e._uU(2),e.qZA(),e.TgZ(3,"app-icon",16),e._uU(4,"arrow_drop_down"),e.qZA()(),e.TgZ(5,"mat-menu",null,27)(7,"button",13),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.checkin(i,!0))}),e.TgZ(8,"div",24)(9,"app-icon",25),e._uU(10,"check"),e.qZA(),e.TgZ(11,"div"),e._uU(12,"Check-in"),e.qZA()()(),e.TgZ(13,"button",13),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.checkin(i,!1))}),e.TgZ(14,"div",24)(15,"app-icon",25),e._uU(16,"cancel"),e.qZA(),e.TgZ(17,"div"),e._uU(18,"Check-out"),e.qZA()()()()}if(2&o){const t=a.data,n=e.MAs(6);e.ekj("bg-neutral-600",!t)("bg-success",t),e.Q6J("matMenuTriggerFor",n),e.xp6(2),e.Oqu(t?"Yes":"No")}}function pt(o,a){if(1&o&&(e.TgZ(0,"div",28)(1,"button",29)(2,"app-icon"),e._uU(3,"qr_code"),e.qZA()(),e.TgZ(4,"mat-menu",null,12)(6,"div",30),e._UZ(7,"img",31),e.qZA(),e.TgZ(8,"div",32)(9,"button",33),e._uU(10," Print QR Code "),e.qZA()()()()),2&o){const t=a.row,n=e.MAs(5);e.xp6(1),e.Q6J("disabled",!(null!=t.extension_data&&t.extension_data.checkin_qr_code))("matMenuTriggerFor",n),e.xp6(6),e.Q6J("src",null==t.extension_data?null:t.extension_data.checkin_qr_code,e.LSH)}}function ut(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"button",34),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.loadMore())}),e._uU(1," Load More "),e.qZA()}}const mt=function(){return["date","period","user_name","group","asset_name","approver_name","status","checked_in","actions"]},gt=function(){return["Date","Period","Person","Group","Desk","Approver","Status","Checked In"," "]},ft=function(){return["4r","10r","flex","10r","10r","10r","8r","7r","3.5r"]},ht=function(o,a,t,n,s,i,l,_){return{user_name:o,asset_name:a,date:t,period:n,status:s,checked_in:i,access:l,actions:_}};let X=(()=>{class o{get time_format(){return this._settings.time_format}constructor(t,n){var s=this;this._state=t,this._settings=n,this.filters=this._state.filters,this.has_more_pages=this._state.has_more_pages,this.bookings=this._state.bookings.pipe((0,z.U)(i=>i.map(l=>({...l,end:l.date+60*l.duration*1e3})))),this.rejectAll=()=>this._state.rejectAllDesks(),this.loadMore=()=>this._state.nextPage(),this.checkin=(i,l)=>this.runMethod("checkin",(0,g.Z)(function*(){yield s._state.checkinDesk(i,l),i.checked_in=l??!0})),this.approve=i=>this.runMethod("approve",(0,g.Z)(function*(){return s._state.approveDesk(i)})),this.reject=i=>this.runMethod("reject",(0,g.Z)(function*(){return s._state.rejectDesk(i)}))}runMethod(t,n){var s=this;return(0,g.Z)(function*(){s.loading=t,yield n().catch(i=>null),s.loading=""})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.H),e.Y36(c.gb))},o.\u0275cmp=e.Xpm({type:o,selectors:[["desk-bookings"]],decls:28,vars:27,consts:[[1,"w-full","h-4"],[1,"overflow-auto","h-full","w-full","px-4","pb-4"],[1,"min-w-[76rem]","block",3,"dataSource","filter","columns","display_column","column_size","template","empty"],["date_template",""],["period_template",""],["desk_template",""],["user_template",""],["status_template",""],["option_template",""],["action_template",""],["btn","","matRipple","","class","absolute bottom-2 left-2 w-32 mx-auto my-4",3,"click",4,"ngIf"],["icon","","matRipple","",1,"absolute","bottom-2","right-2","bg-white","shadow",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-full"],[1,"opacity-60"],[1,"text-xl"],[1,"flex","flex-col","justify-center"],[1,"select-all"],["class","text-xs opacity-30 select-all",4,"ngIf"],[1,"text-xs","opacity-30","select-all"],["matRipple","",1,"rounded-3xl","px-2","py-1","flex","items-center","space-x-2","capitalize",3,"matMenuTriggerFor"],[1,"ml-2"],["statusMenu","matMenu"],[1,"flex","items-center","space-x-2"],[1,"text-2xl"],["matRipple","",1,"rounded-3xl","px-2","py-1","text-white","flex","items-center","space-x-2",3,"matMenuTriggerFor"],["checkinMenu","matMenu"],[1,"flex","items-center","justify-end","space-x-2","w-full"],["icon","","matRipple","","matTooltip","View Desk QR code","title","",3,"disabled","matMenuTriggerFor"],[1,"p-2","mx-4","my-2","rounded-lg","border","border-black"],[1,"w-48",3,"src"],["mat-menu-item","",1,"underline"],["btn","","matRipple","",1,"w-full"],["btn","","matRipple","",1,"absolute","bottom-2","left-2","w-32","mx-auto","my-4",3,"click"]],template:function(t,n){if(1&t&&(e._UZ(0,"div",0),e.TgZ(1,"div",1),e._UZ(2,"custom-table",2),e.ALo(3,"async"),e.ALo(4,"async"),e.YNc(5,it,7,8,"ng-template",null,3,e.W1O),e.YNc(7,at,3,8,"ng-template",null,4,e.W1O),e.YNc(9,lt,1,1,"ng-template",null,5,e.W1O),e.YNc(11,_t,4,2,"ng-template",null,6,e.W1O),e.YNc(13,ct,19,12,"ng-template",null,7,e.W1O),e.YNc(15,dt,19,6,"ng-template",null,8,e.W1O),e.YNc(17,pt,11,3,"ng-template",null,9,e.W1O),e.qZA(),e.YNc(19,ut,2,0,"button",10),e.ALo(20,"async"),e.TgZ(21,"button",11)(22,"app-icon"),e._uU(23,"more_vert"),e.qZA()(),e.TgZ(24,"mat-menu",null,12)(26,"button",13),e.NdJ("click",function(){return n.rejectAll()}),e._uU(27,"Reject All"),e.qZA()()),2&t){const s=e.MAs(6),i=e.MAs(8),l=e.MAs(10),_=e.MAs(12),d=e.MAs(14),m=e.MAs(16),A=e.MAs(18),R=e.MAs(25);let O,E;e.xp6(2),e.Q6J("dataSource",n.bookings)("filter",null==(O=e.lcZ(3,9,n.filters))?null:O.search)("columns",e.DdM(15,mt))("display_column",e.DdM(16,gt))("column_size",e.DdM(17,ft))("template",e.qlk(18,ht,_,l,s,i,d,m,m,A))("empty",null!=(E=e.lcZ(4,11,n.filters))&&E.search?"No matching desk bookings":"There are no desk booking for the currently selected date."),e.xp6(17),e.Q6J("ngIf",!n.loading&&e.lcZ(20,13,n.has_more_pages)),e.xp6(2),e.Q6J("matMenuTriggerFor",R)}},dependencies:[p.O5,b.VK,b.OP,b.p6,P.gM,T.wG,v.o,J.C,p.Ov,p.uU],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;height:100%;width:100%}\n/*# sourceMappingURL=desk-bookings.component.ts-angular-inline--122.css.map*/"]}),o})();var kt=r(9136),Tt=r(8461);let V=(()=>{class o extends c.cx{constructor(t,n,s,i){super(),this._state=t,this._desk=n,this._desks_state=s,this._org=i,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.actions=this._state.map_actions,this.features=this._state.map_features,this.setHost=l=>this._desks_state.setOptions({host:l})}ngOnInit(){this._desks_state.setOptions({use_api:!0}),this.subscription("date",this._desk.filters.subscribe(t=>{const n=this._org.levelWithID(t.zones);n&&this._state.setLevel(n.id),this._desks_state.setOptions({date:t.date||Date.now(),all_day:!0,zones:t.zones})}))}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(w.ck),e.Y36(C.H),e.Y36(w.Xp),e.Y36(k.w7))},o.\u0275cmp=e.Xpm({type:o,selectors:[["desk-map-view"]],features:[e._Bn([w.Xp]),e.qOj],decls:13,vars:19,consts:[["map","",1,"h-full","w-full","relative"],[3,"src","zoom","center","styles","features","actions"],[1,"absolute","bottom-2","right-2"],[1,"absolute","top-0","left-0","p-2","text-black"],["placeholder","User for bookings...",1,"white",3,"ngModel","ngModelChange"],["info","",1,"absolute","bottom-0","rounded","p-2","m-2","bg-white","dark:bg-neutral-700","shadow","text-center"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e._UZ(1,"i-map",1),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e._UZ(8,"explore-zoom-controls",2),e.TgZ(9,"div",3)(10,"a-user-search-field",4),e.NdJ("ngModelChange",function(i){return n.setHost(i)}),e.qZA()(),e.TgZ(11,"div",5),e._uU(12," Click/Tap an available desk to book it. "),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("src",e.lcZ(2,7,n.url))("zoom",e.lcZ(3,9,n.positions).zoom)("center",e.lcZ(4,11,n.positions).center)("styles",e.lcZ(5,13,n.styles))("features",e.lcZ(6,15,n.features))("actions",e.lcZ(7,17,n.actions)),e.xp6(9),e.Q6J("ngModel",null))},dependencies:[u.JJ,u.On,B.d,kt.p,Tt.s,p.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;position:relative;height:100%;width:100%}[info][_ngcontent-%COMP%]{left:50%;transform:translate(-50%)}\n/*# sourceMappingURL=desk-map-view.component.ts-angular-inline--124.css.map*/"]}),o})();var xt=r(6168),Ct=r(7716),Dt=r(6048);function Mt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"item-list-field",9),e.NdJ("ngModelChange",function(s){const i=e.CHM(t),l=i.row,_=i.key,d=e.oxw();return e.KtG(d.setRowValue(l.id,_,s))}),e.qZA()}if(2&o){const t=a.data,n=a.row,s=a.key,i=e.oxw();e.Q6J("placeholder","groups"===s?"User Groups":"Features")("name",s)("ngModel",(i.changes[n.id]?i.changes[n.id][s]:null)||t)}}function vt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",10)(1,"mat-form-field",11)(2,"input",12),e.NdJ("ngModelChange",function(s){const i=e.CHM(t),l=i.row,_=i.key,d=e.oxw();return e.KtG(d.setRowValue(l.id,_,s))}),e.qZA()()()}if(2&o){const t=a.data,n=a.row,s=a.key,i=e.oxw();e.xp6(2),e.Q6J("placeholder",s)("name",s)("ngModel",(i.changes[n.id]?i.changes[n.id][s]:null)||t)}}function At(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",13)(1,"mat-checkbox",14),e.NdJ("ngModelChange",function(s){const l=e.CHM(t).row,_=e.oxw();return e.KtG(_.setRowValue(l.id,"bookable",s))}),e.qZA()()}if(2&o){const t=a.data,n=a.row,s=e.oxw();let i;e.xp6(1),e.Q6J("ngModel",null!==(i=null==s.changes[n.id]?null:s.changes[n.id].bookable)&&void 0!==i?i:t)}}function bt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",15)(1,"div",16)(2,"app-icon"),e._uU(3,"warning"),e.qZA()(),e.TgZ(4,"button",17),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.removeDesk(i))}),e.TgZ(5,"app-icon"),e._uU(6,"delete"),e.qZA()(),e.TgZ(7,"button",18),e.NdJ("click",function(){const i=e.CHM(t).row,l=e.oxw();return e.KtG(l.loadQrCode(i))}),e.TgZ(8,"app-icon"),e._uU(9,"qr_code"),e.qZA()(),e.TgZ(10,"mat-menu",null,19)(12,"div",20),e._UZ(13,"img",21),e.qZA(),e.TgZ(14,"div",22)(15,"button",23),e._uU(16," Print QR Code "),e.qZA()()()()}if(2&o){const t=a.row,n=e.MAs(11),s=e.oxw();e.xp6(1),e.ekj("opacity-0",!s.changes[t.id]),e.xp6(6),e.Q6J("matMenuTriggerFor",n),e.xp6(6),e.Q6J("src",t.qr_code,e.LSH)}}function Zt(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",24)(1,"p",25),e._uU(2),e.qZA(),e.TgZ(3,"div",26)(4,"button",27),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.save())}),e._uU(5," Save Changes "),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(2),e.hij(" ",t.changed," Desk(s) with unsaved changes ")}}function Nt(o,a){if(1&o&&(e.TgZ(0,"div",28),e._UZ(1,"mat-spinner",29),e.TgZ(2,"p"),e._uU(3),e.qZA()()),2&o){const t=e.oxw();e.xp6(3),e.Oqu(t.loading)}}function Ot(o,a){if(1&o){const t=e.EpF();e.TgZ(0,"div",30)(1,"div",31)(2,"div",32),e._uU(3," Drop CSV file to add desks "),e.qZA()(),e.TgZ(4,"input",33),e.NdJ("change",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.loadCSVData(s))}),e.qZA()()}}const Et=function(){return["map_id","bookable","name","groups","features","actions"]},wt=function(){return["ID","Bookable","Name","Groups","Features"," "]},St=function(){return["8r","6r","12r","flex","16r","10r"]},yt=function(o,a,t,n,s,i){return{map_id:o,name:a,bookable:t,groups:n,features:s,actions:i}};let ee=(()=>{class o extends c.cx{get changed(){return(Object.keys(this.changes).length||0)+(this._state.new_desk_count||0)}setRowValue(t,n,s){this.changes[t]||(this.changes[t]={}),this.changes[t][n]=s}removeDesk(t){var n=this;return(0,g.Z)(function*(){const s=yield(0,c._5)({title:"Remove desk",content:`Remove desk ${t.name}?`,icon:{content:"delete"}},n._dialog);if("done"!==s.reason)return;s.close();const l=(yield n.desks.pipe((0,D.q)(1)).toPromise()).filter(m=>m.id!==t.id),_=yield n.filters.pipe((0,D.q)(1)).toPromise(),d=n._org.levelWithID(_.zones);n.loading="Removing desk...",yield(0,F.Ymr)(d.id,{name:"desks",description:"desks",details:l}).toPromise().catch(m=>{throw n.loading="",(0,c.cB)(`Error saving desk data. Error: ${m.message||m}`),m}),(0,c.t5)("Successfully updated desks"),n._state.setFilters({}),n.loading="",n.changes={}})()}save(){var t=this;return(0,g.Z)(function*(){t.loading="Saving changes to desks...";const n=yield t.desks.pipe((0,D.q)(1)).toPromise(),s=(0,c.Tw)(n.map(_=>new k.nk({..._,...t.changes[_.id]||{}}).toJSON()),"id"),i=yield t.filters.pipe((0,D.q)(1)).toPromise(),l=t._org.levelWithID(i.zones);yield(0,F.Ymr)(l.id,{name:"desks",description:"desks",details:s}).toPromise().catch(_=>{throw t.loading="",(0,c.cB)(`Error saving desk data. Error: ${403===_?.status?"You do not have the required permissions to save desk changes.":_.message||_}`),_}),(0,c.t5)("Successfully updated desks"),t._state.clearNewDesks(),t.loading="",t.changes={}})()}loadQrCode(t){t.qr_code=(0,xt.w)(`${location.origin}/workplace/#/book/code?asset_id=${encodeURIComponent(t.id)}`)}constructor(t,n,s){super(),this._state=t,this._org=n,this._dialog=s,this.changes={},this.dragging=!1,this.filters=this._state.filters,this.desks=(0,Ct.aj)([this._state.desks,this._state.new_desks]).pipe((0,z.U)(([i,l])=>i.concat(l)))}loadCSVData(t){var n=this;return(0,g.Z)(function*(){n.loading="Loading CSV file...",n.dragging=!1;const s=yield(0,c.fT)(t).catch(([i,l])=>{throw(0,c.cB)(i),l});try{const i=(0,c.n5)(s)||[];n._state.addDesks(i.map(l=>new k.nk({...l,id:l.id||`desk-${(0,c.Iy)(999999)}`})))}catch(i){console.error(i)}n.loading=""})()}handleDrag(t,n){this.dragging="enter"===t}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.H),e.Y36(k.w7),e.Y36(M.uw))},o.\u0275cmp=e.Xpm({type:o,selectors:[["desks-manage"]],features:[e.qOj],decls:15,vars:26,consts:[[1,"w-full","h-full","overflow-auto","relative","p-4",3,"dragenter","dragend"],[1,"min-w-[72rem]","block",3,"dataSource","filter","columns","display_column","column_size","template","empty","pagination","page_size"],["list_edit_template",""],["text_edit_template",""],["bookable_edit_template",""],["action_template",""],["class","fixed bottom-2 left-1/2 transform -translate-x-1/2 p-4 rounded bg-white shadow",4,"ngIf"],["class","absolute inset-0 flex flex-col items-center justify-center space-y-2 bg-white bg-opacity-60",4,"ngIf"],["class","absolute inset-0 bg-black/60 flex items-center justify-center",4,"ngIf"],["hide-outline","",1,"w-full",3,"placeholder","name","ngModel","ngModelChange"],["hide-outline","",1,"w-full","h-12"],["appearance","outline",1,"h-12","w-full"],["matInput","",3,"placeholder","name","ngModel","ngModelChange"],[1,"flex","items-center","justify-center","pl-4"],[3,"ngModel","ngModelChange"],[1,"flex","items-center","justify-end","space-x-2"],["matTooltip","Desk has unsaved changes",1,"p-2","text-2xl","text-pending"],["icon","",3,"click"],["icon","","matRipple","",3,"matMenuTriggerFor","click"],["menu","matMenu"],[1,"p-2","mx-4","my-2","rounded-lg","border","border-black"],[1,"w-48",3,"src"],["mat-menu-item","",1,"underline"],["btn","","matRipple","",1,"w-full"],[1,"fixed","bottom-2","left-1/2","transform","-translate-x-1/2","p-4","rounded","bg-white","shadow"],[1,"mb-2","text-xl"],[1,"flex","items-center","justify-center"],["save","","btn","","matRipple","",3,"click"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2","bg-white","bg-opacity-60"],["diameter","32"],[1,"absolute","inset-0","bg-black/60","flex","items-center","justify-center"],[1,"bg-white","p-4","rounded","shadow"],[1,"border-4","border-gray-300","border-dashed","rounded","flex","flex-col","items-center","justify-center","w-64","h-64"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"]],template:function(t,n){if(1&t&&(e.TgZ(0,"div",0),e.NdJ("dragenter",function(i){return n.handleDrag("enter",i)})("dragend",function(i){return n.handleDrag("end",i)},!1,e.Jf7),e._UZ(1,"custom-table",1),e.ALo(2,"async"),e.ALo(3,"async"),e.YNc(4,Mt,1,3,"ng-template",null,2,e.W1O),e.YNc(6,vt,3,3,"ng-template",null,3,e.W1O),e.YNc(8,At,2,1,"ng-template",null,4,e.W1O),e.YNc(10,bt,17,4,"ng-template",null,5,e.W1O),e.YNc(12,Zt,6,1,"div",6),e.YNc(13,Nt,4,1,"div",7),e.YNc(14,Ot,5,0,"div",8),e.qZA()),2&t){const s=e.MAs(5),i=e.MAs(7),l=e.MAs(9),_=e.MAs(11);let d,m;e.xp6(1),e.Q6J("dataSource",n.desks)("filter",null==(d=e.lcZ(2,12,n.filters))?null:d.search)("columns",e.DdM(16,Et))("display_column",e.DdM(17,wt))("column_size",e.DdM(18,St))("template",e.HTZ(19,yt,i,i,l,s,s,_))("empty",null!=(m=e.lcZ(3,14,n.filters))&&m.search?"No matching desks":"No desks for selected level")("pagination",!0)("page_size",20),e.xp6(11),e.Q6J("ngIf",n.changed>0),e.xp6(1),e.Q6J("ngIf",n.loading),e.xp6(1),e.Q6J("ngIf",n.dragging)}},dependencies:[p.O5,u.Fj,u.JJ,u.On,x.KE,S.Nt,y.oG,b.VK,b.OP,b.p6,P.gM,K.Ou,T.wG,Dt.q9,v.o,J.C,p.Ov]}),o})();var Ft=r(9816),Pt=r(6866),Rt=r(3320);const Lt=["app-new-desks",""];function Kt(o,a){if(1&o&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&o){const t=a.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function Wt(o,a){1&o&&e._UZ(0,"mat-progress-bar",17)}const It=[{path:"new",component:(()=>{class o extends c.cx{constructor(t,n,s,i,l){super(),this._state=t,this._router=n,this._route=s,this._dialog=i,this._org=l,this.loading=this._state.loading,this.filters=this._state.filters,this.levels=this._org.active_levels,this.setDate=_=>this._state.setFilters({date:_}),this.setFilters=_=>this._state.setFilters(_),this.refresh=()=>this._state.refresh(),this.updateZones=_=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:_.join(",")},queryParamsHandling:"merge"}),this._state.setFilters({zones:_})}}ngOnInit(){var t=this;this._state.refresh(),this.subscription("router.events",this._router.events.subscribe(s=>{if(s instanceof h.m2){const i=this._router.url?.split("/")||[""];this.path=i[n.length-1].split("?")[0]}})),this.subscription("levels",this._org.active_levels.subscribe(function(){var s=(0,g.Z)(function*(i){const _=(yield t.filters.pipe((0,D.q)(1)).toPromise())?.zones?.filter(d=>i.find(m=>m.id===d)||"All"===d)||[];!_.length&&i.length&&_.push(i[0].id),t.updateZones(_)});return function(i){return s.apply(this,arguments)}}()));const n=this._router.url?.split("/")||[""];this.path=n[n.length-1].split("?")[0]}ngOnDestroy(){super.ngOnDestroy()}newDeskBooking(){this._dialog.open(G,{})}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(C.H),e.Y36(h.F0),e.Y36(h.gz),e.Y36(M.uw),e.Y36(k.w7))},o.\u0275cmp=e.Xpm({type:o,selectors:[["","app-new-desks",""]],features:[e.qOj],attrs:Lt,decls:32,vars:15,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","w-full","py-4","px-8","space-x-2"],[1,"text-2xl","font-medium"],[1,"flex-1","w-px"],[1,"mr-2",3,"model","modelChange"],["btn","","matRipple","",1,"space-x-2",3,"click"],[1,"w-full","flex","items-center","px-8"],["appearance","outline",1,"h-[3.5rem]"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"border-l","h-full","ml-8","mr-4"],[3,"dateChange"],["btn","","icon","","matRipple","","matTooltip","Refresh List",1,"ml-2","rounded","border","border-gray-200",3,"disabled","click"],[1,"flex-1","h-1/2","w-full","relative","overflow-auto","px-4"],["class","w-full","mode","indeterminate",4,"ngIf"],[3,"value"],["mode","indeterminate",1,"w-full"]],template:function(t,n){if(1&t&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1)(4,"div",2)(5,"h2",3),e._uU(6,"Desk Bookings"),e.qZA(),e._UZ(7,"div",4),e.TgZ(8,"searchbar",5),e.NdJ("modelChange",function(i){return n.setFilters({search:i})}),e.ALo(9,"async"),e.qZA(),e.TgZ(10,"button",6),e.NdJ("click",function(){return n.newDeskBooking()}),e.TgZ(11,"div"),e._uU(12,"New Booking"),e.qZA(),e.TgZ(13,"app-icon"),e._uU(14,"add"),e.qZA()()(),e.TgZ(15,"div",7)(16,"mat-form-field",8)(17,"mat-select",9),e.NdJ("ngModelChange",function(i){return n.updateZones(i)}),e.ALo(18,"async"),e.YNc(19,Kt,2,2,"mat-option",10),e.ALo(20,"async"),e.qZA()(),e._UZ(21,"div",11)(22,"div",4),e.TgZ(23,"date-options",12),e.NdJ("dateChange",function(i){return n.setDate(i)}),e.qZA(),e.TgZ(24,"button",13),e.NdJ("click",function(){return n.refresh()}),e.ALo(25,"async"),e.TgZ(26,"app-icon"),e._uU(27,"refresh"),e.qZA()()(),e.TgZ(28,"div",14),e._UZ(29,"router-outlet"),e.qZA(),e.YNc(30,Wt,1,0,"mat-progress-bar",15),e.ALo(31,"async"),e.qZA()()),2&t){let s,i;e.xp6(8),e.Q6J("model",null==(s=e.lcZ(9,5,n.filters))?null:s.search),e.xp6(9),e.Q6J("ngModel",null==(i=e.lcZ(18,7,n.filters))?null:i.zones),e.xp6(2),e.Q6J("ngForOf",e.lcZ(20,9,n.levels)),e.xp6(5),e.Q6J("disabled",e.lcZ(25,11,n.loading)),e.xp6(6),e.Q6J("ngIf",e.lcZ(31,13,n.loading))}},dependencies:[p.sg,p.O5,u.JJ,u.On,Q.E,j.U,Pt.O,Rt.u,x.KE,H.gD,T.ey,P.gM,q.pW,T.wG,v.o,h.lC,p.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:#fff}\n/*# sourceMappingURL=new-desks.component.ts-angular-inline--125.css.map*/"]}),o})(),children:[{path:"events",component:X},{path:"map",component:V},{path:"manage",component:ee},{path:"**",redirectTo:"events"}]},{path:"",component:st,children:[{path:"events",component:X},{path:"map",component:V},{path:"manage",component:ee},{path:"**",redirectTo:"events"}]}];let Jt=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[p.ez,u.u5,L.Nh,u.UX,ne.v,w.P2,Z.EP,Ft.W9,te.Fk,x.lN,y.p9,S.c,h.Bz.forChild(It)]}),o})()}}]);
//# sourceMappingURL=apps_concierge_src_app_desks_desks_module_ts.js.map