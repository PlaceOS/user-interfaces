(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([["apps_workplace_src_app_control_control_module_ts"],{3720:(e,t,s)=>{"use strict";s.d(t,{d:()=>v,G:()=>w});var n=s(8512),o=s(4689),a=s(8303),i=s(3530),r=s(804),l=s(999),c=s(8774),u=s(8125),f=s(8223),p=s(8376),h=s(4587),d=s(2619),g=s(3743),m=s(9294),_=s(4608);function v(){sessionStorage.removeItem("PLACEOS.event"),sessionStorage.removeItem("PLACEOS.event_form"),localStorage.removeItem("PLACEOS.event_filters")}let w=(()=>{class e extends f.KG{constructor(e,t,s){super(),this._calendar=e,this._org=t,this._dialog=s,this._event=new n.X(null),this._form=new n.X(null),this._filters=new n.X({}),this._loading_spaces=new n.X(!1),this._loading_event=new n.X(!1),this.event=this._event.asObservable(),this.form=this._form.asObservable(),this.filters=this._filters.asObservable(),this.loading_spaces=this._loading_spaces.asObservable(),this.loading_event=this._loading_event.asObservable(),this.spaces=this._filters.pipe((0,o.w)(e=>{var t,s;this._loading_spaces.next(!0);const n=this._form.getValue().value;n.date||(n.date=(new Date).valueOf());const o=Math.floor(new Date(n.date).valueOf()/1e3),a=Math.floor((0,r.Z)(new Date(n.date),n.duration||60).valueOf()/1e3),i=(null===(t=null==e?void 0:e.zones)||void 0===t?void 0:t.length)?e.zones:[null===(s=this._org.building)||void 0===s?void 0:s.id];return this._calendar.freeBusy({zone_ids:i.join(","),period_start:o,period_end:a}).toPromise().then(t=>(this._loading_spaces.next(!1),t.filter(t=>!e.capacity||e.capacity>=t.capacity)))}),(0,a.d)()),this.clearState=()=>v(),this.setEvent(new p.ym({date:(0,l.Z)((0,r.Z)(new Date,2),{nearestTo:5}).valueOf()}))}get event_form(){return this._form.getValue()}get event_filters(){return this._filters.getValue()}get is_future_date(){var e,t;const s=(null===(t=null===(e=this._form.getValue())||void 0===e?void 0:e.controls)||void 0===t?void 0:t.date.value)||(new Date).valueOf();return(0,c.Z)(new Date(s),(0,u.Z)(new Date))}setEvent(e){this._event.next(e);const t=(0,p.r7)(e);this._form.next(t),this.subscription("form_change",()=>this.storeState())}setValue(e,t){const s=this._form.getValue();s&&s.controls[e]&&s.controls[e].setValue(t)}newAttendee(){const e=this._dialog.open(h.rW,{width:"auto",height:"auto",data:{}}),t=this._form.getValue();e.componentInstance.event.pipe((0,i.P)(e=>"done"===e.reason)).subscribe(s=>{const n=t.controls.attendees.value||[];n.push(s.metadata),t.controls.attendees.setValue((0,f.Tw)(n,"email")),e.close()})}clearForm(){this.setEvent(this._event.getValue()),this._filters.next({})}updateFilters(e){this._filters.next(e)}storeState(){const e=this._form.getValue();sessionStorage.setItem("PLACEOS.event",JSON.stringify(this._event.getValue().toJSON())),sessionStorage.setItem("PLACEOS.event_form",JSON.stringify(e.value)),localStorage.setItem("PLACEOS.event_filters",JSON.stringify(this._filters.getValue()))}loadState(){const e=sessionStorage.getItem("PLACEOS.event")||"{}";e&&this._event.next(new p.ym(JSON.parse(e)));const t=sessionStorage.getItem("PLACEOS.event_form");if(t){const e=(0,p.r7)(this._event.getValue());e.patchValue(JSON.parse(t)),this._form.next(e)}const s=localStorage.getItem("PLACEOS.event_filters");s&&this._filters.next(JSON.parse(s))}save(){const e=this._form.getValue();if(e.markAllAsTouched(),e.controls.organiser.value&&e.controls.host.value||e.patchValue({organiser:(0,f.ar)(),host:(0,f.ar)().email}),e.controls.title.value||e.patchValue({title:(0,f.ar)().email}),!e.valid){const t=[];for(const s in e.controls)e.controls[s].invalid&&t.push(s);return Promise.reject((0,f.cB)(`Some form fields are not valid: [${t.join(", ")}]`))}this._loading_event.next(!0);const t=new p.ym(Object.assign(Object.assign({},this._event.getValue()),this._form.getValue().value));return(0,p.ry)(t).toPromise().then(()=>this._loading_event.next(!1),()=>this._loading_event.next(!1))}}return e.\u0275fac=function(t){return new(t||e)(d.LFG(g.ot),d.LFG(m.w7),d.LFG(_.uw))},e.\u0275prov=d.Yz7({token:e,factory:e.\u0275fac}),e})()},5088:(e,t,s)=>{"use strict";s.r(t),s.d(t,{ControlModule:()=>P});var n=s(1511),o=s(6898),a=s(8223),i=s(3720),r=s(2619),l=s(5251),c=s(3530),u=s(4164),f=s(9294),p=s(6283),h=s(1548),d=s(6756),g=s(6073),m=s(7806),_=s(5980),v=s(7695);const w=function(){return["/explore"]},x=function(e){return{space:e}};function Z(e,t){if(1&e&&(r.TgZ(0,"div",1),r.TgZ(1,"div",2),r.TgZ(2,"div",3),r._uU(3),r.qZA(),r.TgZ(4,"div",4),r.TgZ(5,"div",5),r._uU(6),r.qZA(),r.TgZ(7,"div",6),r.TgZ(8,"app-icon"),r._uU(9,"account_circle"),r.qZA(),r._uU(10),r.qZA(),r.qZA(),r.qZA(),r.TgZ(11,"div",7),r.TgZ(12,"a",8),r.ALo(13,"safe"),r._uU(14," Control "),r.qZA(),r.TgZ(15,"a",9),r._uU(16," Find "),r.qZA(),r.qZA(),r.qZA()),2&e){const e=r.oxw();r.ekj("with-image",e.show_image),r.xp6(3),r.Oqu(e.space.name),r.xp6(3),r.Oqu(e.location),r.xp6(4),r.hij(" ",e.space.capacity||"0"," "),r.xp6(2),r.Q6J("href",r.xi3(13,8,e.space.support_url,"url"),r.LSH),r.xp6(3),r.Q6J("routerLink",r.DdM(11,w))("queryParams",r.VKq(12,x,e.space.id))}}let O=(()=>{class e{constructor(e,t){this._settings=e,this._org=t}get show_image(){return this._settings.get("app.space_display.show_images")}get location(){if(!this.space)return"Unable to determine location";const e=this.space.level,t=this._org.buildings.find(t=>t.id===e.parent_id);return`${t?(t.display_name||t.name)+", ":""}${e.display_name||e.name}`}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(a.gb),r.Y36(f.w7))},e.\u0275cmp=r.Xpm({type:e,selectors:[["a-control-space-list-item"]],inputs:{space:"space"},decls:1,vars:1,consts:[["class","flex flex-wrap items-center sm:space-x-4 bg-white hover:bg-gray-100 overflow-hidden p-2 pl-4 mb-2",3,"with-image",4,"ngIf"],[1,"flex","flex-wrap","items-center","sm:space-x-4","bg-white","hover:bg-gray-100","overflow-hidden","p-2","pl-4","mb-2"],[1,"flex","flex-col","flex-1"],[1,"text-xl"],[1,"flex","items-center","w-full","text-sm"],[1,"flex-1"],[1,"flex","items-center","text-lg"],[1,"flex","w-full","sm:w-auto","sm:flex-col","items-center","space-x-2","sm:space-x-0","sm:space-y-2","mt-4","sm:mt-0"],["mat-button","","button","",1,"w-32","flex-1","sm:flex-none",3,"href"],["mat-button","","button","",1,"w-32","flex-1","sm:flex-none","inverse",3,"routerLink","queryParams"]],template:function(e,t){1&e&&r.YNc(0,Z,17,14,"div",0),2&e&&r.Q6J("ngIf",t.space)},directives:[n.O5,h.o,_.zs,o.yS],pipes:[v.y],styles:[""]}),e})();function b(e,t){1&e&&r._UZ(0,"mat-spinner",7),2&e&&r.Q6J("diameter",32)}function C(e,t){1&e&&r._UZ(0,"a-control-space-list-item",10),2&e&&r.Q6J("space",t.$implicit)}function y(e,t){if(1&e&&(r.TgZ(0,"div",8),r.YNc(1,C,1,1,"a-control-space-list-item",9),r.qZA()),2&e){const e=r.oxw();r.xp6(1),r.Q6J("ngForOf",e.filtered_list)}}function A(e,t){if(1&e&&(r.TgZ(0,"div",11),r.TgZ(1,"app-icon"),r._uU(2,"close"),r.qZA(),r.TgZ(3,"p"),r._uU(4),r.qZA(),r.qZA()),2&e){const e=r.oxw();r.xp6(4),r.hij(" ",e.search_str?' No matches for "'+e.search_str+'"':"No controllable spaces"," ")}}let S=(()=>{class e extends a.KG{constructor(e,t){super(),this._spaces=e,this._org=t,this.space_list=[]}ngOnInit(){this._spaces.initialised.pipe((0,c.P)(e=>e)).subscribe(()=>{this.space_list=this._spaces.filter(e=>!!e.support_url),this.space_list.sort((e,t)=>{const s=this._org.buildings.find(t=>t.id===e.level.parent_id),n=(e.name||"").toLowerCase(),o=((e.level?e.level.name:"")||"").toLowerCase(),a=((s?s.name:"")||"").toLowerCase(),i=this._org.buildings.find(e=>e.id===t.level.parent_id),r=(t.name||"").toLowerCase(),l=((t.level?t.level.name:"")||"").toLowerCase(),c=((i?i.name:"")||"").toLowerCase();return a.localeCompare(c)||o.localeCompare(l)||n.localeCompare(r)})})}get filtered_list(){const e=(this.search_str||"").toLowerCase();return(this.space_list||[]).filter(t=>{const s=this._org.buildings.find(e=>e.id===t.level.parent_id),n=(t.name||"").toLowerCase(),o=((t.level?t.level.name:"")||"").toLowerCase(),a=((s?s.name:"")||"").toLowerCase();return n.indexOf(e)>=0||o&&o.indexOf(e)>=0||a&&a.indexOf(e)>=0})}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(u.sK),r.Y36(f.w7))},e.\u0275cmp=r.Xpm({type:e,selectors:[["a-control-space-list"]],features:[r.qOj],decls:9,vars:4,consts:[[1,"w-full","flex","items-center","justify-center","p-2"],["overlay","","appearance","outline",1,"rounded"],["matPrefix","",1,"text-xl"],["matInput","","placeholder","Search...",3,"ngModel","ngModelChange"],["matSuffix","","class","top-2",3,"diameter",4,"ngIf"],["class","flex flex-col flex-1 overflow-auto w-full",4,"ngIf","ngIfElse"],["empty_state",""],["matSuffix","",1,"top-2",3,"diameter"],[1,"flex","flex-col","flex-1","overflow-auto","w-full"],[3,"space",4,"ngFor","ngForOf"],[3,"space"],[1,"flex","flex-col","items-center","p-8"]],template:function(e,t){if(1&e&&(r.TgZ(0,"div",0),r.TgZ(1,"mat-form-field",1),r.TgZ(2,"app-icon",2),r._uU(3,"search"),r.qZA(),r.TgZ(4,"input",3),r.NdJ("ngModelChange",function(e){return t.search_str=e}),r.qZA(),r.YNc(5,b,1,1,"mat-spinner",4),r.qZA(),r.qZA(),r.YNc(6,y,2,1,"div",5),r.YNc(7,A,5,1,"ng-template",null,6,r.W1O)),2&e){const e=r.MAs(8);r.xp6(4),r.Q6J("ngModel",t.search_str),r.xp6(1),r.Q6J("ngIf",t.loading),r.xp6(1),r.Q6J("ngIf",t.filtered_list.length)("ngIfElse",e)}},directives:[p.KE,h.o,p.qo,d.Nt,g.Fj,g.JJ,g.On,n.O5,m.$g,p.R9,n.sg,O],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}mat-form-field[_ngcontent-%COMP%]{width:768px;max-width:calc(100% - 2rem)}"]}),e})();var q=s(6258),L=s(5769);const J=["app-control",""];let T=(()=>{class e extends a.KG{constructor(e){super(),this._settings=e}ngOnInit(){this._settings.title="Control",(0,i.d)()}}return e.\u0275fac=function(t){return new(t||e)(r.Y36(a.gb))},e.\u0275cmp=r.Xpm({type:e,selectors:[["","app-control",""]],features:[r.qOj],attrs:J,decls:5,vars:2,consts:[[1,"w-full",3,"menu","menuChange"],[1,"flex-1","h-1/2","w-full"],[1,"w-full",3,"show","showChange"]],template:function(e,t){1&e&&(r.TgZ(0,"a-topbar-header",0),r.NdJ("menuChange",function(e){return t.show_menu=e}),r.qZA(),r.TgZ(1,"main",1),r._UZ(2,"a-control-space-list"),r.qZA(),r._UZ(3,"a-footer-menu"),r.TgZ(4,"a-overlay-menu",2),r.NdJ("showChange",function(e){return t.show_menu=e}),r.qZA()),2&e&&(r.Q6J("menu",t.show_menu),r.xp6(4),r.Q6J("show",t.show_menu))},directives:[l.B,S,q.i,L.t],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background:#f0f0f0}"]}),e})();var I=s(5312);const V=[{path:"",component:T}];let P=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=r.oAB({type:e}),e.\u0275inj=r.cJS({imports:[[n.ez,g.u5,o.Bz.forChild(V),I.X]]}),e})()}}]);
//# sourceMappingURL=apps_workplace_src_app_control_control_module_ts.js.map