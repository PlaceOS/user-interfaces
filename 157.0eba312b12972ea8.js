"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[157],{5157:(xt,P,i)=>{i.d(P,{Y:()=>yt,PP:()=>bt,mO:()=>w.mO,VE:()=>m.VE,w0:()=>m.w0,sF:()=>M.sF});var d=i(6814),c=i(6223),x=i(5940),v=i(7988),u=i(9347),D=i(5986),L=i(7393),Q=i(4931),M=(i(6755),i(5396),i(5861),i(8125)),m=i(8675),w=i(223),t=i(9212);new w.n5;var A=i(2081),Y=i(2798),I=i(3166),p=i(3740),R=i(9189),z=i(8372),B=i(581),V=i(6156),G=i(2816);function g(s){(0,G.Z)(1,arguments);var a=(0,V.Z)(s);return(0,B.Z)(1e3*a)}var H=i(6278),K=i(5091),$=i(6511),T=i(5125),W=i(2994),q=i(9193),k=i(6776),tt=i(5222),et=i(2413),ot=i(6124),it=i(7428),nt=i(9185);const st=["container"];function at(s,a){if(1&s&&(t.TgZ(0,"div",32),t._uU(1),t.qZA()),2&s){const e=a.index,o=t.oxw();t.Udp("left",-o.offset_x+"px"),t.uIk("disabled",o.today&&o.current_hour>e),t.xp6(),t.AsE(" ",e%12==0?"12":e%12,"",e>=12?"pm":"am"," ")}}function rt(s,a){if(1&s){const e=t.EpF();t.TgZ(0,"div",33),t._UZ(1,"a-user-avatar",11),t.TgZ(2,"div",34),t._uU(3),t.qZA(),t.TgZ(4,"button",35),t.NdJ("click",function(){const r=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.removeUser(r))}),t.TgZ(5,"app-icon"),t._uU(6,"close"),t.qZA()()()}if(2&s){const e=a.$implicit,o=t.oxw();t.Udp("top",-o.offset_y+"px"),t.xp6(),t.Q6J("user",e),t.xp6(2),t.hij(" ",e.name||o.host.email," ")}}function lt(s,a){if(1&s&&t._UZ(0,"div",36),2&s){const e=a.index,o=t.oxw();t.Udp("left",-(o.offset_x+1)+"px"),t.uIk("disabled",o.today&&o.current_hour>e)}}function dt(s,a){if(1&s&&(t.TgZ(0,"div",37),t._uU(1),t.ALo(2,"date"),t.qZA()),2&s){const e=t.oxw();t.xp6(),t.hij(" ",t.xi3(2,1,e.date,"shortTime")," ")}}const _=()=>[];function ct(s,a){if(1&s&&(t._UZ(0,"user-availability-list",25),t.ALo(1,"async"),t.ALo(2,"async")),2&s){const e=a.$implicit,o=t.oxw();t.Q6J("user",e)("date",o.date)("availability",t.lcZ(1,3,o.availability)?t.lcZ(2,5,o.availability)[e.email.toLowerCase()]:t.DdM(7,_))}}let C=(()=>{class s extends Y.cx{get today(){return(0,I.Z)(this.date,Date.now())}get current_hour(){return(new Date).getHours()}get selection_left(){const e=new Date(this.date);return 5*(e.getHours()+e.getMinutes()/60)}get selection_width(){return this.duration/60*5}constructor(e,o,n){super(),this._data=e,this._renderer=o,this._dialog_ref=n,this.users=new T.X([]),this.search="",this.date=this._data.date||Date.now(),this.duration=this._data.duration||60,this.offset_y=0,this.offset_x=0,this.host=this._data.host,this.hours=new Array(24).fill(0),this.on_change=new T.X(0),this.availability=(0,W.aj)([this.users,this.on_change]).pipe((0,k.b)(300),(0,tt.w)(([r])=>(0,$.LE)({calendars:[this.host.email,...r.map(l=>l.email.toLowerCase())].join(","),period_start:(0,p.Z)((0,R.Z)(this.date)),period_end:(0,p.Z)((0,z.Z)(this.date))}).pipe((0,et.K)(()=>(0,q.of)([])))),(0,ot.U)(r=>{const l={};for(const E of r)l[E.id.toLowerCase()]=E.availability.filter(h=>"busy"===h.status).map(h=>{const y=g(h.starts_at),J=(0,H.Z)(g(h.ends_at),g(h.starts_at));return{date:y,duration:J,start:(y.getHours()+y.getMinutes()/60)/24*100,size:J/60/24*100}});return l}),(0,it.d)({}),(0,nt.d)(1)),this.move_time=!1,this._start_time=0,this._move_last=0,this._move_size=1920,this.users.next([...this._data.users])}addUser(e){this.users.next([...this.users.getValue().filter(o=>o.email!==e.email),e]),this.user=null}removeUser(e){this.users.next(this.users.getValue().filter(o=>o.email!==e.email)),this.user=null}closeAndUpdate(){this._dialog_ref.close(!0)}ngAfterViewInit(){const e=new Date(this.date);this.timeout("init",()=>{const o=this._container_el.nativeElement.querySelector(`[hour="${e.getHours()}"]`);if(o){const n=this._container_el.nativeElement.getBoundingClientRect(),r=o.getBoundingClientRect();this._container_el.nativeElement.scrollTo(r.left-128-n.left,0)}this.onScroll()},300)}onScroll(){this.offset_x=this._container_el.nativeElement.scrollLeft,this.offset_y=this._container_el.nativeElement.scrollTop}startMovePeriod(e){e.preventDefault(),e.stopPropagation(),this._move_last=e instanceof MouseEvent?e.clientX:e.touches[0].clientX,this.move_time=!0,this._start_time=this.date,e instanceof MouseEvent?this.subscription("on_move",this._renderer.listen("window","mousemove",o=>this._onMovePeriod(o))):this.subscription("on_move",this._renderer.listen("window","touchmove",o=>this._onMovePeriod(o))),e instanceof MouseEvent?this.subscription("on_move_end",this._renderer.listen("window","mouseup",()=>this._onMoveEnd())):this.subscription("on_move_end",this._renderer.listen("window","touchend",()=>this._onMoveEnd()))}startMoveDuration(e){e.preventDefault(),e.stopPropagation(),this._move_last=e instanceof MouseEvent?e.clientX:e.touches[0].clientX,this._start_time=this.duration,e instanceof MouseEvent?this.subscription("on_move",this._renderer.listen("window","mousemove",o=>this._onMoveDuration(o))):this.subscription("on_move",this._renderer.listen("window","touchmove",o=>this._onMoveDuration(o))),e instanceof MouseEvent?this.subscription("on_move_end",this._renderer.listen("window","mouseup",()=>this._onMoveEnd())):this.subscription("on_move_end",this._renderer.listen("window","touchend",()=>this._onMoveEnd()))}_onMovePeriod(e){const o=this._move_last-(e instanceof MouseEvent?e.clientX:e.touches[0].clientX),r=(o>0?-1:1)*Math.floor(Math.abs(o/this._move_size*24*60)/5)*5;if(r){const l=this.date;this.date=(0,K.Z)(this._start_time,r).valueOf(),this.date<Date.now()&&(this.date=l)}}_onMoveDuration(e){const o=this._move_last-(e instanceof MouseEvent?e.clientX:e.touches[0].clientX),r=(o>0?-1:1)*Math.floor(Math.abs(o/this._move_size*24*60)/5)*5;r&&(this.duration=Math.max(30,this._start_time+r))}_onMoveEnd(){this.unsub("on_move"),this.unsub("on_move_end"),this._move_last=0,this.move_time=!1}static#t=this.\u0275fac=function(o){return new(o||s)(t.Y36(u.WI),t.Y36(t.Qsj),t.Y36(u.so))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["find-availability-modal"]],viewQuery:function(o,n){if(1&o&&t.Gf(st,7),2&o){let r;t.iGM(r=t.CRH())&&(n._container_el=r.first)}},features:[t.qOj],decls:45,vars:31,consts:[[1,"relative","flex","items-center","justify-center","p-4"],[1,"text-center"],["icon","","matRipple","","mat-dialog-close","",1,"absolute","top-1/2","left-1","-translate-y-1/2"],[1,"flex","flex-col","h-[calc(100vh-7rem)]","sm:h-[65vh]","overflow-hidden"],[1,"w-full","flex","flex-col","sm:flex-row","space-y-2","sm:space-y-0","sm:space-x-2","p-2"],[1,"max-h-[3.25rem]","flex-1",3,"ngModel","ngModelChange"],[1,"grid","flex-1","h-1/2","w-full","border-t","border-base-200","relative","overflow-hidden","divide-x","divide-y","divide-base-200","max-w-[100vw]","sm:max-w-[80vw]"],["times","",1,"col-start-2","h-10","flex","overflow-hidden","border-l","border-base-200"],["hour","","class","relative border-r border-base-200 h-10 min-w-[5rem] p-2",3,"left",4,"ngFor","ngForOf"],["users","",1,"row-start-2","w-24","overflow-hidden"],["host","",1,"flex","flex-col","items-center","justify-center","h-32","w-24","relative","border-b","border-base-200","py-2"],[1,"text-2xl",3,"user"],[1,"text-xs","break-words","overflow-hidden","max-w-full","px-2","text-center"],["person","","class","flex flex-col items-center justify-center h-32 w-24 relative border-b border-base-200 py-2",3,"top",4,"ngFor","ngForOf"],["blocks","",1,"relative","row-start-2","overflow-hidden"],["fixed","",1,"absolute","inset-0","flex","overflow-hidden"],["divider","","class","relative h-full min-w-[5rem] border-l border-base-200",3,"left",4,"ngFor","ngForOf"],["selection","",1,"absolute","inset-y-0","!border-x-2","!border-info","z-20","cursor-grab","active:cursor-grabbing",3,"mousedown","touchstart"],[1,"absolute","inset-0","bg-info","opacity-30"],["handle","",1,"absolute","top-1/2","-left-px","-translate-x-1/2","-translate-y-1/2","h-3","w-3","rounded-full","bg-info"],["handle","",1,"absolute","top-1/2","-right-px","translate-x-1/2","-translate-y-1/2","h-3","w-3","rounded-full","bg-info","hover:h-4","hover:w-4","active:bg-secondary",3,"mousedown","touchstart"],[1,"bg-base-100","border","border-base-200","p-2","absolute","top-2","left-1/2","-translate-x-1/2","shadow","text-xs","whitespace-nowrap","rounded"],["class","bg-base-100 border border-base-200 p-2 absolute top-12 left-1/2 -translate-x-1/2 shadow text-xs whitespace-nowrap rounded",4,"ngIf"],["scroll","",1,"absolute","inset-0","overflow-auto",3,"scroll"],["container",""],[1,"pointer-events-none",3,"user","date","availability"],["class","pointer-events-none",3,"user","date","availability",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-2","border-t","border-base-200","w-full"],["btn","","matRipple","",1,"clear","text-secondary",3,"mat-dialog-close"],[1,"flex","items-center"],[1,"text-xl"],[1,"mr-1","underline"],["hour","",1,"relative","border-r","border-base-200","h-10","min-w-[5rem]","p-2"],["person","",1,"flex","flex-col","items-center","justify-center","h-32","w-24","relative","border-b","border-base-200","py-2"],[1,"text-xs","break-words","max-w-full","px-2","text-center"],["icon","",1,"absolute","-top-1","-left-1",3,"click"],["divider","",1,"relative","h-full","min-w-[5rem]","border-l","border-base-200"],[1,"bg-base-100","border","border-base-200","p-2","absolute","top-12","left-1/2","-translate-x-1/2","shadow","text-xs","whitespace-nowrap","rounded"]],template:function(o,n){1&o&&(t.TgZ(0,"header",0)(1,"h2",1),t._uU(2,"Find Availability"),t.qZA(),t.TgZ(3,"button",2)(4,"app-icon"),t._uU(5,"close"),t.qZA()()(),t.TgZ(6,"main",3)(7,"div",4)(8,"a-date-field",5),t.NdJ("ngModelChange",function(l){return n.date=l})("ngModelChange",function(){return n.on_change.next(n.on_change.getValue()+1)}),t.qZA(),t.TgZ(9,"a-user-search-field",5),t.NdJ("ngModelChange",function(l){return n.user=l})("ngModelChange",function(l){return n.addUser(l)}),t.qZA()(),t.TgZ(10,"div",6)(11,"div",7),t.YNc(12,at,2,5,"div",8),t.qZA(),t.TgZ(13,"div",9)(14,"div",10),t._UZ(15,"a-user-avatar",11),t.TgZ(16,"div",12),t._uU(17),t.qZA()(),t.YNc(18,rt,7,4,"div",13),t.ALo(19,"async"),t.qZA(),t.TgZ(20,"div",14)(21,"div",15),t.YNc(22,lt,1,3,"div",16),t.TgZ(23,"div",17),t.NdJ("mousedown",function(l){return n.startMovePeriod(l)})("touchstart",function(l){return n.startMovePeriod(l)}),t._UZ(24,"div",18)(25,"div",19),t.TgZ(26,"div",20),t.NdJ("mousedown",function(l){return n.startMoveDuration(l)})("touchstart",function(l){return n.startMoveDuration(l)}),t.qZA(),t.TgZ(27,"div",21),t._uU(28),t.ALo(29,"duration"),t.qZA(),t.YNc(30,dt,3,4,"div",22),t.qZA()(),t.TgZ(31,"div",23,24),t.NdJ("scroll",function(){return n.onScroll()}),t._UZ(33,"user-availability-list",25),t.ALo(34,"async"),t.ALo(35,"async"),t.YNc(36,ct,3,8,"user-availability-list",26),t.ALo(37,"async"),t.qZA()()()(),t.TgZ(38,"footer",27)(39,"button",28)(40,"div",29)(41,"app-icon",30),t._uU(42,"arrow_back"),t.qZA(),t.TgZ(43,"div",31),t._uU(44,"Back to form"),t.qZA()()()()),2&o&&(t.xp6(8),t.Q6J("ngModel",n.date),t.xp6(),t.Q6J("ngModel",n.user),t.xp6(3),t.Q6J("ngForOf",n.hours),t.xp6(2),t.Udp("top",-n.offset_y+"px"),t.xp6(),t.Q6J("user",n.host),t.xp6(2),t.hij(" ",n.host.name||n.host.email," "),t.xp6(),t.Q6J("ngForOf",t.lcZ(19,20,n.users)),t.xp6(4),t.Q6J("ngForOf",n.hours),t.xp6(),t.Udp("left","calc("+n.selection_left+"rem - "+n.offset_x+"px)")("width",n.selection_width+"rem"),t.xp6(5),t.hij(" ",t.lcZ(29,22,n.duration)," "),t.xp6(2),t.Q6J("ngIf",n.move_time),t.xp6(3),t.Q6J("user",n.host)("date",n.date)("availability",t.lcZ(34,24,n.availability)?t.lcZ(35,26,n.availability)[n.host.email]:t.DdM(30,_)),t.xp6(3),t.Q6J("ngForOf",t.lcZ(37,28,n.users)),t.xp6(3),t.Q6J("mat-dialog-close",!0))},styles:[".grid[_ngcontent-%COMP%]{grid-template-columns:6rem 1fr;grid-template-rows:2.5rem minmax(0,1fr)}[disabled=true][_ngcontent-%COMP%], [disabled=true][_ngcontent-%COMP%]   [header][_ngcontent-%COMP%]{background:var(--b3)!important;pointer-events:none}[disabled=true][_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{opacity:.3}"]})}return s})();function ut(s,a){if(1&s&&(t.TgZ(0,"div",2)(1,"div",3),t._uU(2),t.ALo(3,"date"),t.ALo(4,"date"),t.qZA()()),2&s){const e=a.$implicit;t.Udp("left",e.start+"%")("width",e.size+"%"),t.xp6(2),t.AsE(" ",t.xi3(3,6,e.date,"shortTime")," - ",t.xi3(4,9,e.date.valueOf()+60*e.duration*1e3,"shortTime")," ")}}let U=(()=>{class s{constructor(){this.availability=[],this.date=Date.now()}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["user-availability-list"]],inputs:{user:"user",availability:"availability",date:"date"},decls:2,vars:1,consts:[[1,"relative","w-[120rem]","h-32","inset-y-0","border-b","border-base-200"],["event","","class","absolute inset-y-0 bg-error text-white p-2 overflow-hidden border border-red-700 rounded",3,"left","width",4,"ngFor","ngForOf"],["event","",1,"absolute","inset-y-0","bg-error","text-white","p-2","overflow-hidden","border","border-red-700","rounded"],[1,"text-xs","max-w-full"]],template:function(o,n){1&o&&(t.TgZ(0,"div",0),t.YNc(1,ut,5,12,"div",1),t.qZA()),2&o&&(t.xp6(),t.Q6J("ngForOf",n.availability))},dependencies:[d.sg,d.uU],styles:["[_nghost-%COMP%]{display:block}"]})}return s})();var ht=i(9590),F=i(4888),O=i(2882),b=i(3680),vt=i(4170),mt=i(8525),ft=i(8668),pt=i(576),gt=i(5522);let bt=(()=>{class s{static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275mod=t.oAB({type:s});static#o=this.\u0275inj=t.cJS({imports:[d.ez,c.u5,c.UX,u.Is,Q.W,L.K,D.p9,x.Cq,v.Tx]})}return s})();t.B6R(A.J,[d.sg,d.O5,c.JJ,c.On,u.ZT,ht.N,F.o,O.k,b.ey,v.VK,v.OP,v.p6,vt.KE,mt.gD,b.wG,x.Ou],[d.uU]),t.B6R(C,[d.sg,d.O5,c.JJ,c.On,u.ZT,ft.Q,pt.d,F.o,O.k,b.wG,U],[d.Ov,d.uU,gt.u]);class yt{constructor(a={}){this.type=a.type||a.location||"other",this.position=a.position||a.map_id||a.asset_id||{x:a.x/a.map_width||0,y:a.y/a.map_height||0},this.variance=a.variance||0,this.last_seen=a.last_seen||(0,p.Z)(new Date),this.level=a.level,this.building=a.building,this.at_location=!!a.at_location,this.coordinates_from=a.coordinates_from||"top-left"}}i(1451)}}]);