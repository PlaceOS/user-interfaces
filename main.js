(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e,n){t.exports=n("Guln")},Guln:function(t,e,n){"use strict";n.r(e);var s=n("cUpR"),i=n("8Y7J"),o=n("s7LF"),a=n("omvX"),c=n("iInd"),r=n("3pDu"),l=n("zHaW"),d=n("iELJ"),u=n("pu8Q"),b=n("UhP/"),h=n("Ynp+"),p=n("SVse"),m=n("Dxy4"),f=n("rJgo"),g=n("Q2Ze"),_=n("ZTz/"),v=n("vrAh"),y=n("TN/R"),O=n("e6WT"),w=n("f44v"),k=n("Tr4x"),x=n("5QHs"),j=n("GXRp"),M=n("1z/I"),W=n("K2Fw"),C=n("2Vo4"),X=n("quSY");let F=(()=>{class t{constructor(){this._timers={},this._intervals={},this._subscriptions={},this._initialised=new C.a(!1),this.initialised=this._initialised.asObservable()}get is_initialised(){return this._initialised.getValue()}ngOnDestroy(){this.destroy()}destroy(){for(const t in this._timers)this._timers.hasOwnProperty(t)&&this.clearTimeout(t);for(const t in this._intervals)this._intervals.hasOwnProperty(t)&&this.clearInterval(t);for(const t in this._subscriptions)this._subscriptions.hasOwnProperty(t)&&this.unsub(t)}timeout(t,e,n=300){if(!(t&&e&&e instanceof Function))throw new Error(t?"Cannot create named timeout without a name":"Cannot create a timeout without a callback");this.clearTimeout(t),this._timers[t]=setTimeout(()=>{e(),this._timers[t]=null},n)}clearTimeout(t){this._timers[t]&&(clearTimeout(this._timers[t]),this._timers[t]=null)}interval(t,e,n=300){if(!(t&&e&&e instanceof Function))throw new Error(t?"Cannot create named interval without a name":"Cannot create a interval without a callback");this.clearInterval(t),this._intervals[t]=setInterval(()=>e(),n)}clearInterval(t){this._intervals[t]&&(clearInterval(this._intervals[t]),this._intervals[t]=null)}subscription(t,e){this.unsub(t),this._subscriptions[t]=e}unsub(t){this._subscriptions&&this._subscriptions[t]&&(this._subscriptions[t]instanceof X.a?this._subscriptions[t].unsubscribe():this._subscriptions[t](),this._subscriptions[t]=null)}unsubWith(t){const e=Object.keys(this._subscriptions).filter(e=>e.includes(t));for(const n of e)this.unsub(n)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var I=n("mrSG"),S=n("SxV6");function $(t,e){if(1&t&&(i.Xb(0,"main",4),i.Sb(1,"app-icon",5),i.Sb(2,"p",6),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.tc("icon",t.icon),i.Fb(1),i.tc("innerHTML",t.content,i.Cc)}}function P(t,e){if(1&t){const t=i.Yb();i.Xb(0,"footer",7),i.Xb(1,"button",8),i.Mc(2),i.Wb(),i.Xb(3,"button",9),i.ic("click",function(){return i.Bc(t),i.mc().onConfirm()}),i.Mc(4),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.Fb(2),i.Oc(" ",t.cancel_text," "),i.Fb(2),i.Oc(" ",t.confirm_text," ")}}function E(t,e){if(1&t&&(i.Xb(0,"main",10),i.Xb(1,"div",11),i.Sb(2,"mat-spinner",12),i.Xb(3,"p"),i.Mc(4),i.Wb(),i.Wb(),i.Wb()),2&t){const t=i.mc();i.Fb(4),i.Nc(t.loading)}}let z=(()=>{class t{constructor(t,e){this._dialog_ref=t,this._data=e,this.event=new i.p,this.title=this._data.title||"Confirm",this.content=this._data.content||"Are you sure?",this.confirm_text=this._data.confirm_text||"Ok",this.cancel_text=this._data.cancel_text||"Cancel",this.icon=this._data.icon||{class:"material-icons",content:"done"},this.disableClose=()=>this._dialog_ref.disableClose=!0,this.enableClose=()=>this._dialog_ref.disableClose=!1}onConfirm(){this._dialog_ref.close("done"),this.event.emit({reason:"done"})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(d.e),i.Rb(d.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["confirm-modal"]],outputs:{event:"event"},decls:7,vars:4,consts:[["mat-dialog-title",""],["class","flex flex-col items-center space-y-2 px-2",4,"ngIf","ngIfElse"],["class","flex items-center justify-center p-2 space-x-2",4,"ngIf"],["load_state",""],[1,"flex","flex-col","items-center","space-y-2","px-2"],[1,"text-5xl",3,"icon"],["content","",1,"text-center","text-sm",3,"innerHTML"],[1,"flex","items-center","justify-center","p-2","space-x-2"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","","name","accept",3,"click"],["loading",""],[1,"h-48","w-64","flex","flex-col","items-center","space-y-2"],["diameter","32"]],template:function(t,e){if(1&t&&(i.Xb(0,"header"),i.Xb(1,"h3",0),i.Mc(2),i.Wb(),i.Wb(),i.Kc(3,$,3,2,"main",1),i.Kc(4,P,5,2,"footer",2),i.Kc(5,E,5,1,"ng-template",null,3,i.Lc)),2&t){const t=i.xc(6);i.Fb(2),i.Nc(e.title),i.Fb(1),i.tc("ngIf",!e.loading)("ngIfElse",t),i.Fb(1),i.tc("ngIf",!e.loading)}},styles:["mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\n                min-width: 8em;\n            }"]}),t})(),K="APP";function D(t,e,n,s="debug",i=!1,o=K){if(window.debug||i){const i=["color: #E91E63","color: #3F51B5","color: default"];n?console[s](`%c[${o}]%c[${t}] %c${e}`,...i,n):console[s](`%c[${o}]%c[${t}] %c${e}`,...i)}}function L(t,e){const n=t.shift();return e&&null!=e[n]?t.length>0?L(t,e[n]):e[n]:null}function T(t=[],e=""){return t.filter((t,n,s)=>s.indexOf(s.find(e?n=>n[e]===t[e]:e=>e===t))===n)}function R(t,e=0){return Math.floor(Math.random()*(t-e))+e}function A(t,e,n,s){return t>=n&&t<s||e>n&&e<s||n>=t&&n<e||s>t&&s<=e}const q=function(t){for(var e=0,n=1779033703^t.length;e<t.length;e++)n=(n=Math.imul(n^t.charCodeAt(e),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}("PlaceOS"),V=(B=2654435769,N=608135816,U=3084996962,Y=q(),function(){var t=(B>>>=0)+(N>>>=0)|0;return B=N^N>>>9,N=(U>>>=0)+(U<<3)|0,U=(U=U<<21|U>>>11)+(t=t+(Y=1+(Y>>>=0)|0)|0)|0,(t>>>0)/4294967296});var B,N,U,Y;function G(t=100,e=0){return Math.floor(V()*(t-e))+e}const H=["control","shift","alt","meta","os"];let J=(()=>{class t{constructor(){this.keydown_states={},this.keydown_observers={},this.combo_end=[],this.registered_combos=[],this.counter=0,window.addEventListener("keydown",t=>{const e=this.mapKey((t.code||"").toLowerCase());this.last_down!==e&&(this.keydown_states[e]||(this.keydown_states[e]=new C.a(null),this.keydown_observers[e]=this.keydown_states[e].asObservable()),this.keydown_states[e].next(++this.counter),this.combo_end.indexOf(e)>=0&&t.preventDefault(),this.last_down=e)}),window.addEventListener("keyup",t=>{const e=this.mapKey((t.code||"").toLowerCase());this.keydown_states[e].next(null),this.last_down===e&&(this.last_down=null)})}listen(t,e){const n=(t=t instanceof Array?t:t.split("+")).map(t=>this.mapKey(t.toLowerCase()));if(n.length>0&&this.validCombination(n)){this.registered_combos.push(n);const t=n[n.length-1];return this.keydown_states[t]||(this.keydown_states[t]=new C.a(null),this.keydown_observers[t]=this.keydown_states[t].asObservable()),this.updateCombinationEndList(),this.keydown_observers[t].subscribe(t=>{if(t){const t=[];if(n.length>0){for(const e of n){const n=this.keydown_states[e];t.push(n&&n.getValue()||-1)}for(let e=0;e<n.length-1;e++)if(t[e]>t[e+1])return}t.reduce((t,e)=>t+(e>0?1:-1),0)>=n.length&&e()}})}return null}mapKey(t){return t.indexOf("alt")>=0||t.indexOf("shift")>=0||t.indexOf("control")>=0?t.replace("left","").replace("right",""):t}updateCombinationEndList(){for(const t of this.registered_combos)this.combo_end.push(t[t.length-1]);this.combo_end=T([])}validCombination(t){let e=0;for(const n of t)H.indexOf(n)<0&&e++;return e>0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Q=n("G6Tw"),Z=n("sWYD");const tt={debug:!0,composer:{domain:"",route:"/kiosk",protocol:"",port:"",use_domain:!1,local_login:!1},app:{name:"MapKiosk",title:"PlaceOS",description:"Map Kiosk UI",short_name:"PlaceOS",logo:{type:"img",src:"assets/logo-light.svg"},logo_dark:{type:"img",src:"assets/logo-dark.svg"},general:{},desks:{hide_reason:!0,can_set_host:!0}}};let et=(()=>{class t extends F{constructor(t){super(),this._title=t,this._app_name="PlaceOS",this._overrides=new C.a([]),this._subjects={},this._observables={};const e=new Date,n=new Date(1620610894831),s=Object(Q.a)(e,n)?`Today at ${Object(Z.a)(n,"h:mma")}`:Object(Z.a)(n,"do MMM yyyy, h:mma");D("CORE","null",null,"debug",!0),D("APP",`3702493 | Built: ${s}`,null,"debug",!0),this.init()}set overrides(t){this._overrides.next(t)}listen(t){return this._observables[t]||(this._subjects[t]=new C.a(null),this._observables[t]=this._subjects[t].asObservable()),this._observables[t]}post(t,e){this._observables[t]||(this._subjects[t]=new C.a(null),this._observables[t]=this._subjects[t].asObservable()),this._subjects[t].next(e)}value(t){return this._observables[t]?this._subjects[t].getValue():null}get title(){return this._title.getTitle()}set title(t){this._title.setTitle(`${t} | ${this.get("app.name")||this._app_name}`)}init(){var t;return Object(I.a)(this,void 0,void 0,function*(){this.get("debug")&&(window.debug=!0),(null===(t=this.get("app"))||void 0===t?void 0:t.name)&&(this._app_name=this.get("app").name),D("Settings","Successfully loaded settings"),this._initialised.next(!0),window.debug&&(window.application||(window.application={}),window.application.settings=this)})}get app_name(){return this._app_name}get(t){const e=t.split(".");if("app"!==e[0])return L(e,tt);const n=this._overrides.getValue();for(const s of n){const t=L(e.slice(1),s);if(null!=t)return t}return L(e,tt)}}return t.\u0275fac=function(e){return new(e||t)(i.ec(s.c))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var nt=n("GS7A");function st(t){let e="";if(t)for(const n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=`${e?"&":""}${n}=${t[n]}`);return e}let it,ot,at,ct;function rt(t,e,n="OK",s,i={}){if(!it)throw new Error("Snackbar service hasn't been initialised");const o=it.open(e,n,Object.assign({panelClass:[t],duration:5e3},i));n&&(s=s||(()=>o.dismiss()),o.onAction().subscribe(()=>s()))}function lt(t,e,n,s={}){console.debug(t),rt("success",t,e,n,s)}function dt(t,e,n,s={}){console.error(t),rt("error",t,e,n,s)}function ut(t,e,n,s={}){console.info(t),rt("info",t,e,n,s)}Object(nt.m)("show",[Object(nt.l)(":enter",[Object(nt.k)({opacity:0,height:0}),Object(nt.e)(300,Object(nt.k)({opacity:1,height:"*"}))]),Object(nt.l)(":leave",[Object(nt.k)({opacity:1,height:"*"}),Object(nt.e)(300,Object(nt.k)({opacity:0,height:0}))])]),Object(nt.m)("show",[Object(nt.j)("show",Object(nt.k)({opacity:1,height:"*"})),Object(nt.j)("hide",Object(nt.k)({opacity:0,height:0,"pointer-events":"none"})),Object(nt.l)("show <=> hide",Object(nt.e)("200ms ease-in"))]);class bt{constructor(t){this._server_names={},this.id=t.id||t.zone_id||t.email||"",this.name=t.name||"",this.email=(t.email||"").toLowerCase()}toJSON(t=!0){const e=Object.assign({},this),n=Object.keys(e);for(const s of n)"_"===s[0]?(e[this._server_names[s.substr(1)]||s.substr(1)]=e[s],delete e[s]):void 0===e[s]&&delete e[s];return e}clone(){return new bt(this)}duplicate(){return new bt(Object.assign(Object.assign({},this),{id:null,email:null}))}}var ht=n("3E0/"),pt=n("un/a"),mt=n("lJxs");class ft extends bt{constructor(t={}){var e;super(t),this.first_name=t.first_name||t.name||"",this.last_name=t.last_name||"",this.phone=t.phone||"",this.organisation=t.organisation||"",this.notes=t.notes||"",this.photo=t.photo||"",this.organizer=!!t.organizer,this.visit_expected=!!t.visit_expected,this.checked_in=!!t.checked_in,this.response_status=t.response_status||"";const n=(t.groups||[]).map(t=>(t||"").toLowerCase());t.sys_admin&&n.push("placeos_admin"),t.support&&n.push("placeos_support"),this.groups=n,this.extension_data=t.extension_data||{},this.extension_data.assistance_required=t.assistance_required||this.extension_data.assistance_required,this.is_external=!!this.email&&!this.email.includes("@place.tech")||this.visit_expected,this.assistance_required=!!(null===(e=this.extension_data)||void 0===e?void 0:e.assistance_required)}}class gt extends ft{constructor(t={}){super(t),this.preferred_beverage=t.preferred_beverage||"",this.accepted_terms_conditions=t.accepted_terms_conditions||!1}}class _t extends ft{constructor(t={}){super(t),this.card_number=t.card_number||"",this.staff_id=t.staff_id||"",this.location=t.location||{},this.is_logged_in=!!t.is_logged_in}}const vt=new C.a(null),yt=vt.asObservable();function Ot(){return vt.getValue()}function wt(t,e){if(1&t&&(i.Xb(0,"div"),i.Xb(1,"app-icon"),i.Mc(2),i.Wb(),i.Wb()),2&t){const t=i.mc();i.Hb("state center "+t.state),i.Fb(2),i.Oc(" ","success"===t.state?"done":"close"," ")}}function kt(t,e){1&t&&(i.Xb(0,"div",4),i.Sb(1,"mat-spinner",5),i.Wb()),2&t&&(i.Fb(1),i.tc("diameter",16))}setTimeout(()=>{try{if(jest)return}catch(t){}console.log("Loading logged in user details..."),Object(W.u)("current").pipe(Object(ht.a)(1e3),Object(pt.a)(10),Object(mt.a)(t=>new _t(t))).subscribe(t=>vt.next(t))},300);const xt=["*"];let jt=(()=>{class t{constructor(){this.className="material-icons",this.state=""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["action-icon"]],inputs:{icon:"icon",className:"className",content:"content",loading:"loading",disabled:"disabled",state:"state"},ngContentSelectors:xt,decls:6,vars:8,consts:[["mat-icon-button","",1,"relative","flex","items-center","justify-center","h-8","w-8",3,"disabled"],["root","",3,"className","icon"],[3,"class",4,"ngIf"],["class","loader center",4,"ngIf"],[1,"loader","center"],[3,"diameter"]],template:function(t,e){1&t&&(i.sc(),i.Xb(0,"button",0),i.Xb(1,"app-icon",1),i.Mc(2),i.rc(3),i.Wb(),i.Kc(4,wt,3,3,"div",2),i.Kc(5,kt,2,1,"div",3),i.Wb()),2&t&&(i.Jb("success","success"===e.state),i.tc("disabled",e.loading||e.disabled),i.Fb(1),i.tc("className",e.className)("icon",e.icon),i.Fb(1),i.Oc(" ",e.content," "),i.Fb(2),i.tc("ngIf",!e.loading&&e.state),i.Fb(1),i.tc("ngIf",e.loading))},styles:[".action-icon.fade[_ngcontent-%COMP%]    > app-icon[_ngcontent-%COMP%] {\n                opacity: 0.35;\n            }\n\n            [center][_ngcontent-%COMP%] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n\n            .success[_ngcontent-%COMP%] {\n                pointer-events: none;\n            }\n\n            .success[_ngcontent-%COMP%]   app-icon[root][_ngcontent-%COMP%] {\n                opacity: 0.2;\n            }\n\n            .state.success[_ngcontent-%COMP%] {\n                color: #388e3c;\n            }\n\n            .state.error[_ngcontent-%COMP%] {\n                color: #e53935;\n            }"]}),t})(),Mt=(()=>{class t{constructor(t){this.sanitizer=t}transform(t,e="html"){switch(e){case"resource":return this.sanitizer.bypassSecurityTrustResourceUrl(t);case"url":return this.sanitizer.bypassSecurityTrustUrl(t);case"script":return this.sanitizer.bypassSecurityTrustScript(t);case"style":return this.sanitizer.bypassSecurityTrustStyle(t);default:return this.sanitizer.bypassSecurityTrustHtml(t)}}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(s.b))},t.\u0275pipe=i.Qb({name:"safe",type:t,pure:!0}),t})();function Wt(t,e){if(1&t&&(i.Xb(0,"i"),i.Mc(1),i.rc(2),i.Wb()),2&t){const t=i.mc();i.Hb((null==t.icon?null:t.icon.class)||t.className),i.Fb(1),i.Oc(" ",null==t.icon?null:t.icon.content," ")}}function Ct(t,e){if(1&t&&(i.Sb(0,"img",3),i.nc(1,"safe")),2&t){const t=i.mc();i.tc("src",i.pc(1,1,t.icon.src,"resource"),i.Dc)}}const Xt=["*"];let Ft=(()=>{class t{constructor(){this.className="material-icons"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["app-icon"]],inputs:{className:"className",icon:"icon"},ngContentSelectors:Xt,decls:3,vars:2,consts:[[1,"app-icon"],[3,"class",4,"ngIf"],[3,"src",4,"ngIf"],[3,"src"]],template:function(t,e){1&t&&(i.sc(),i.Xb(0,"div",0),i.Kc(1,Wt,3,3,"i",1),i.Kc(2,Ct,2,4,"img",2),i.Wb()),2&t&&(i.Fb(1),i.tc("ngIf",!e.icon||"img"!==e.icon.type),i.Fb(1),i.tc("ngIf",e.icon&&"img"===e.icon.type))},directives:[p.m],pipes:[Mt],styles:[".app-icon[_ngcontent-%COMP%] {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 1.25em;\n                width: 1.25em;\n            }\n\n            i[_ngcontent-%COMP%] {\n                font-size: 1em;\n            }\n\n            img[_ngcontent-%COMP%] {\n                height: 1em;\n                width: 1em;\n            }"]}),t})();function It(t,e){if(1&t){const t=i.Yb();i.Xb(0,"button",2),i.ic("click",function(){i.Bc(t);const n=e.$implicit,s=i.mc();return s.action.emit(n.id),s.show=!1}),i.Sb(1,"app-icon",3),i.Wb()}if(2&t){const t=e.$implicit,n=e.index,s=i.mc();i.Hc("top",s.show?-110*n-60+"%":""),i.Fb(1),i.tc("icon",t)}}let St=(()=>{class t extends F{constructor(){super(...arguments),this.actions=[],this.action=new i.p}close(){this.timeout("close",()=>this.show=!1)}}return t.\u0275fac=function(e){return $t(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["a-popout-menu"]],inputs:{actions:"actions"},outputs:{action:"action"},features:[i.Cb],decls:4,vars:4,consts:[["mat-icon-button","","class","small absolute text-base center shadow",3,"top","click",4,"ngFor","ngForOf"],["name","root","mat-icon-button","",3,"click"],["mat-icon-button","",1,"small","absolute","text-base","center","shadow",3,"click"],[3,"icon"]],template:function(t,e){1&t&&(i.Kc(0,It,2,3,"button",0),i.Xb(1,"button",1),i.ic("click",function(){return e.show=!e.show})("click",function(){return e.show?e.close():""},!1,i.Ac),i.Xb(2,"app-icon"),i.Mc(3),i.Wb(),i.Wb()),2&t&&(i.tc("ngForOf",e.actions),i.Fb(1),i.Jb("show",e.show),i.Fb(2),i.Nc(e.show?"add":"more_vert"))},styles:["[_nghost-%COMP%] {\n                position: relative;\n            }\n\n            app-icon[_ngcontent-%COMP%] {\n                transition: transform 200ms;\n            }\n\n            button[_ngcontent-%COMP%] {\n                background-color: #fff;\n                color: rgba(#000, 0.85);\n                font-size: 1.25rem;\n                height: 2.5em;\n                width: 2.5em;\n            }\n\n            button.show[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%] {\n                transform: rotate(45deg);\n            }\n\n            button.small[_ngcontent-%COMP%] {\n                transition: top 200ms, left 200ms;\n            }"]}),t})();const $t=i.Zb(St);var Pt=n("ktL7");const Et=["outlet"],zt=["feature"];function Kt(t,e){1&t&&i.Sb(0,"mat-spinner",4),2&t&&i.tc("diameter",48)}function Dt(t,e){if(1&t&&(i.Vb(0),i.Sb(1,"div",13),i.Ub()),2&t){const t=i.mc(2).$implicit;i.Fb(1),i.tc("innerHtml",t.content,i.Cc)}}function Lt(t,e){1&t&&i.Tb(0)}const Tt=function(t){return{data:t}};function Rt(t,e){if(1&t&&(i.Vb(0),i.Kc(1,Lt,1,0,"ng-container",14),i.Ub()),2&t){const t=i.mc(2).$implicit;i.Fb(1),i.tc("ngTemplateOutlet",t.content)("ngTemplateOutletContext",i.vc(2,Tt,t.data))}}function At(t,e){1&t&&i.Tb(0)}function qt(t,e){if(1&t&&(i.Vb(0),i.Kc(1,At,1,0,"ng-container",15),i.Ub()),2&t){const t=i.mc(2),e=t.$implicit,n=t.index,s=i.mc(2);i.Fb(1),i.tc("ngComponentOutlet",e.content)("ngComponentOutletInjector",s.injectors[n])}}function Vt(t,e){if(1&t&&(i.Xb(0,"div"),i.Xb(1,"div",8,9),i.Vb(3,10),i.Kc(4,Dt,2,1,"ng-container",11),i.Kc(5,Rt,2,4,"ng-container",11),i.Kc(6,qt,2,2,"ng-container",12),i.Ub(),i.Wb(),i.Wb()),2&t){const t=i.mc().$implicit,e=i.mc(2);i.Fb(1),i.Gb("el-id",t.location)("view-id",e.viewer),i.Fb(2),i.tc("ngSwitch",e.featureType(t.content)),i.Fb(1),i.tc("ngSwitchCase","html"),i.Fb(1),i.tc("ngSwitchCase","template")}}function Bt(t,e){if(1&t&&(i.Vb(0),i.Kc(1,Vt,7,5,"div",7),i.Ub()),2&t){const t=e.$implicit;i.Fb(1),i.tc("ngIf",t)}}function Nt(t,e){if(1&t&&(i.Xb(0,"div",5),i.Kc(1,Bt,2,1,"ng-container",6),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.tc("ngForOf",t.features)}}const Ut=new i.u("Data for Map Features");let Yt=(()=>{class t extends F{constructor(t){super(),this._injector=t,this.zoom=1,this.center={x:.5,y:.5},this.injectors=[]}get feature_list(){return(this.features||[]).map((t,e)=>{var n;return Object.assign(Object.assign({},t),{content:null===(n=this._feature_list.toArray()[e])||void 0===n?void 0:n.nativeElement})}).filter(t=>t.content)}ngOnInit(){Object(Pt.a)()}ngOnDestroy(){this.viewer&&Object(Pt.d)(this.viewer)}ngOnChanges(t){t.src&&this.src&&this.createView(),this.viewer&&((t.zoom||t.center)&&this.updateDisplay(),(t.styles||t.features||t.labels||t.actions)&&(this.injectors=(this.features||[]).map(t=>i.v.create({providers:[{provide:Ut,useValue:Object.assign({},t.data)}],parent:this._injector})),this.timeout("update_view",()=>this.updateView(),100)))}ngAfterViewInit(){this.createView()}featureType(t){return"string"==typeof t?"html":t instanceof i.Q?"template":"component"}updateView(){if(!Object(Pt.c)(this.viewer)||this.loading)return this.timeout("update_view",()=>this.updateView());try{Object(Pt.e)(this.viewer,{styles:this.styles,features:this.feature_list,labels:this.labels,actions:this.actions})}catch(t){}}updateDisplay(){Object(Pt.e)(this.viewer,{zoom:this.zoom,desired_zoom:this.zoom,center:this.center,desired_center:this.center})}createView(){var t,e;return Object(I.a)(this,void 0,void 0,function*(){this.src&&(null===(t=this._outlet_el)||void 0===t?void 0:t.nativeElement)&&(this.loading=!0,this.viewer&&Object(Pt.d)(this.viewer),this.viewer=yield Object(Pt.b)({element:null===(e=this._outlet_el)||void 0===e?void 0:e.nativeElement,url:this.src,styles:this.styles,zoom:this.zoom,desired_zoom:this.zoom,center:this.center,features:this.feature_list,labels:this.labels,actions:this.actions}),this.timeout("update_view",()=>{this.updateView(),this.updateDisplay()},100),this.loading=!1)})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(i.v))},t.\u0275cmp=i.Lb({type:t,selectors:[["i-map"],["interactive-map"]],viewQuery:function(t,e){if(1&t&&(i.Rc(Et,1),i.Rc(zt,1)),2&t){let t;i.wc(t=i.jc())&&(e._outlet_el=t.first),i.wc(t=i.jc())&&(e._feature_list=t)}},inputs:{src:"src",styles:"styles",zoom:"zoom",center:"center",features:"features",labels:"labels",actions:"actions"},features:[i.Cb,i.Db],decls:4,vars:2,consts:[["tabindex","0","role","map",1,"absolute","inset-0"],["outlet",""],["class","center",3,"diameter",4,"ngIf"],["hidden","",4,"ngIf"],[1,"center",3,"diameter"],["hidden",""],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"pointer-events-none"],["feature",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"innerHtml"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[4,"ngComponentOutlet","ngComponentOutletInjector"]],template:function(t,e){1&t&&(i.Sb(0,"div",0,1),i.Kc(2,Kt,1,1,"mat-spinner",2),i.Kc(3,Nt,2,1,"div",3)),2&t&&(i.Fb(2),i.tc("ngIf",!e.viewer||e.loading),i.Fb(1),i.tc("ngIf",null==e.injectors?null:e.injectors.length))},directives:[p.m,u.b,p.l,p.n,p.o,p.p,p.q,p.k],styles:["[_nghost-%COMP%] {\n                height: 100%;\n                width: 100%;\n            }"]}),t})();var Gt=n("7xvl");function Ht(t,e){1&t&&(i.Vb(0),i.rc(1),i.Ub())}const Jt=function(t){return[t]};function Qt(t,e){if(1&t&&(i.Xb(0,"a",8),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("routerLink",i.vc(2,Jt,t.route)),i.Fb(1),i.Oc(" ",t.name," ")}}function Zt(t,e){if(1&t&&(i.Vb(0),i.Xb(1,"div",4),i.Xb(2,"app-icon"),i.Mc(3),i.Wb(),i.Wb(),i.Xb(4,"div",5),i.Kc(5,Ht,2,0,"ng-container",1),i.Wb(),i.Xb(6,"div",6),i.Kc(7,Qt,2,4,"a",7),i.Wb(),i.Ub()),2&t){const t=i.mc(),e=i.xc(3);i.Fb(1),i.Jb("text-success",!t.error)("text-error",t.error),i.Fb(2),i.Nc(t.error?"close":"done"),i.Fb(2),i.tc("ngIf",!t.error)("ngIfElse",e),i.Fb(2),i.tc("ngForOf",t.links)}}function te(t,e){if(1&t&&(i.Xb(0,"p",9),i.Mc(1),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.Nc(t.error)}}function ee(t,e){if(1&t&&(i.Sb(0,"mat-spinner",10),i.Xb(1,"p",11),i.Mc(2),i.Wb()),2&t){const t=i.mc();i.tc("diameter",32),i.Fb(2),i.Nc(t.loading)}}const ne=["*"];let se=(()=>{class t{constructor(){this.loading="",this.error="",this.links=[]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["status-overlay"]],inputs:{loading:"loading",error:"error",links:"links"},ngContentSelectors:ne,decls:6,vars:2,consts:[["status-overlay","",1,"fixed","inset-0","flex","flex-col","bg-secondary","items-center","justify-center","z-50","text-white"],[4,"ngIf","ngIfElse"],["error_msg",""],["load_state",""],[1,"text-4xl","rounded-full","bg-white","mb-4"],[1,"text-center","text-lg","mb-4"],[1,"flex","items-center","space-x-2"],["button","","mat-button","","class","w-32",3,"routerLink",4,"ngFor","ngForOf"],["button","","mat-button","",1,"w-32",3,"routerLink"],["error",""],[1,"mb-4",3,"diameter"],["loading","",1,"text-center","text-lg"]],template:function(t,e){if(1&t&&(i.sc(),i.Xb(0,"div",0),i.Kc(1,Zt,8,8,"ng-container",1),i.Wb(),i.Kc(2,te,2,1,"ng-template",null,2,i.Lc),i.Kc(4,ee,3,2,"ng-template",null,3,i.Lc)),2&t){const t=i.xc(5);i.Fb(1),i.tc("ngIf",!e.loading)("ngIfElse",t)}},styles:[""]}),t})();n("LUZP"),n("OaSA"),n("HDdC");var ie=n("1O3W");const oe=["keyboard",""];function ae(t,e){if(1&t&&i.Sb(0,"div",7),2&t){const t=i.mc(4);i.Jb("bg-success","shift"===t.state)}}function ce(t,e){if(1&t){const t=i.Yb();i.Vb(0),i.Xb(1,"div",5),i.ic("focus",function(){return i.Bc(t),i.mc(3).focusInput()})("click",function(){i.Bc(t);const n=e.$implicit;return i.mc(3).handleKeyPress(n)}),i.Mc(2),i.Kc(3,ae,1,2,"div",6),i.Wb(),i.Ub()}if(2&t){const t=e.$implicit;i.Fb(1),i.Jb("special","{"===t[0]&&t.length>1)("space","{space}"===t),i.Gb("key",t),i.Fb(1),i.Oc(" ","{space}"===t?"Space":"{caps}"===t?"Caps Lock":"{backspace}"===t?"Backspace":t," "),i.Fb(1),i.tc("ngIf","{caps}"===t)}}function re(t,e){if(1&t&&(i.Xb(0,"div",3),i.Kc(1,ce,4,7,"ng-container",4),i.Wb()),2&t){const t=e.$implicit;i.Fb(1),i.tc("ngForOf",t)}}function le(t,e){if(1&t&&(i.Xb(0,"div",1),i.Kc(1,re,2,1,"div",2),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.tc("ngForOf",t.keyset)}}const de=["*"],ue=["0123456789".split(""),"qwertyuiop".split(""),"asdfghjkl".split(""),"zxcvbnm".split(""),["{caps}","{space}","{backspace}"]];let be=(()=>{class t extends F{constructor(e,n){super(),this._element=e,this._overlay=n,this.keyset=ue,this.state="normal",this._overlay_ref=null,this.onFocus=()=>{t.enabled&&(this.open(),this.clearTimeout("blur"))},this.onBlur=()=>this.timeout("blur",()=>this.close())}ngOnDestroy(){super.ngOnDestroy(),this.close()}focusInput(){var t,e,n,s;null===(e=null===(t=this._element)||void 0===t?void 0:t.nativeElement)||void 0===e||e.blur(),null===(s=null===(n=this._element)||void 0===n?void 0:n.nativeElement)||void 0===s||s.focus()}open(){this._overlay_ref||this._portal&&(this._overlay_ref=this._overlay.create({positionStrategy:this._overlay.position().global().bottom().centerHorizontally()}),this._overlay_ref.attach(this._portal))}close(){this._overlay_ref&&(this._overlay_ref.dispose(),this._overlay_ref=null)}handleKeyPress(t){let e=this._element.nativeElement.selectionStart;const n=this._element.nativeElement.value||"";switch(t.toLowerCase()){case"{caps}":case"{shift}":this.state="shift";break;case"{backspace}":this._element.nativeElement.value=`${n.substr(0,e-1)}${n.substr(e,n.length)}`,e=Math.max(0,e-1);break;case"{space}":this._element.nativeElement.value=`${n.substr(0,e)} ${n.substr(e,n.length)}`,e+=1;break;default:"shift"===this.state&&(this.state="normal"),this._element.nativeElement.value=`${n.substr(0,e)}${t}${n.substr(e,n.length)}`,e+=1}this._element.nativeElement.dispatchEvent(new InputEvent("input")),this.updateKeyState(),this.timeout("focus",()=>{this.focusInput(),this._element.nativeElement.selectionStart=e,this._element.nativeElement.selectionEnd=e},50)}updateKeyState(){this.keyset=this.keyset.map(t=>t.map(t=>t.length>1?t:t["normal"!==this.state?"toUpperCase":"toLowerCase"]()))}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(i.m),i.Rb(ie.c))},t.\u0275cmp=i.Lb({type:t,selectors:[["input","keyboard",""],["textarea","keyboard",""]],viewQuery:function(t,e){if(1&t&&i.Rc(M.b,1),2&t){let t;i.wc(t=i.jc())&&(e._portal=t.first)}},hostBindings:function(t,e){1&t&&i.ic("focus",function(){return e.onFocus()})("blur",function(){return e.onBlur()})},inputs:{keyset:"keyset"},features:[i.Cb],attrs:oe,ngContentSelectors:de,decls:2,vars:0,consts:[["cdk-portal",""],["keyboard","",1,"w-screen","flex","flex-col","space-y-4","bg-gray-200","p-2","border-t","border-gray-400"],["row","","class","flex items-center justify-center space-x-2",4,"ngFor","ngForOf"],["row","",1,"flex","items-center","justify-center","space-x-2"],[4,"ngFor","ngForOf"],["tabindex","0",1,"rounded-xl","p-2","border","border-gray-300","relative","cursor-pointer","bg-white",3,"focus","click"],["dot","","class","absolute top-2 right-2 h-2 w-2 rounded-full bg-gray-300",3,"bg-success",4,"ngIf"],["dot","",1,"absolute","top-2","right-2","h-2","w-2","rounded-full","bg-gray-300"]],template:function(t,e){1&t&&(i.sc(),i.rc(0),i.Kc(1,le,2,1,"ng-template",0))},directives:[M.h,p.l,p.m],styles:["[key][_ngcontent-%COMP%] {\n                height: 3.5rem;\n                width: 4rem;\n                transition: box-shadow 200ms, top 200ms;\n                box-shadow: 0 4px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key].special[_ngcontent-%COMP%] {\n                width: 10rem;\n            }\n\n            [key].space[_ngcontent-%COMP%] {\n                flex: 1;\n                min-width: 10rem;\n                max-width: 25rem;\n            }\n\n            [key][_ngcontent-%COMP%]:hover {\n                top: 2px;\n                box-shadow: 0 2px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key][_ngcontent-%COMP%]:active {\n                top: 4px;\n                box-shadow: 0 0 0 0.04px rgba(0, 0, 0, 0.1);\n            }"]}),t})(),he=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["app-unauthorised"]],decls:9,vars:0,consts:function(){let t,e,n;return t=$localize`:@@forbiddenLabel␟56a20d819b6e59b0de025988a3f9ed7d6a1bc08c␟4136336337692896315:Access forbidden.`,e=$localize`:@@invalidPermissionLabel␟7afe2eb69e486929c5a29d67e6f24975f97604c4␟8887025903012875176: You do not have permission to view this page and your access attempt has been recorded. `,n=$localize`:@@contactAdminLabel␟1520ecc736c82366b62d64a515b1c3b222c9e1df␟1824441478452454363: Contact your Administrator if you feel that you should have access. `,[[1,"unauthorised","rounded","m-4","text-center","bg-white","text-black","border","border-gray-400","p-4","shadow"],[1,"text-4xl"],[1,"text-2xl"],t,[1,"py-4"],e,n]},template:function(t,e){1&t&&(i.Xb(0,"div",0),i.Xb(1,"h1",1),i.Mc(2,"403"),i.Wb(),i.Xb(3,"h3",2),i.bc(4,3),i.Wb(),i.Xb(5,"p",4),i.bc(6,5),i.Wb(),i.Xb(7,"p"),i.bc(8,6),i.Wb(),i.Wb())},styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .unauthorised[_ngcontent-%COMP%] {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                .unauthorised[_ngcontent-%COMP%] {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }"]}),t})();const pe=[v.b,f.a,g.e,_.b,m.c,v.b,_.b,d.d,y.c,O.c,k.b,u.a,w.e,x.b,j.r,M.f];let me=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Pb({type:t}),t.\u0275inj=i.Ob({providers:[{provide:b.f,useValue:"en-GB"},{provide:Ut,useValue:{}}],imports:[[p.c,o.h,o.p,...pe],v.b,f.a,g.e,_.b,m.c,v.b,_.b,d.d,y.c,O.c,k.b,u.a,w.e,x.b,j.r,M.f]}),t})();i.Ec(jt,[m.b,Ft,p.m,u.b],[]),i.Ec(St,[p.l,m.b,Ft],[]),i.Ec(z,[d.f,p.m,Ft,m.b,d.c,u.b],[]),i.Ec(se,[p.m,Ft,p.l,m.a,u.b],[]);var fe=n("jMqV"),ge=n("c32n"),_e=n("Wgwc");let ve=(()=>{class t extends b.p{format(t,e){return"input"===e?Object(Z.a)(t,"MMMM d, yyyy"):Object(Z.a)(t,"MMM yyyy")}}return t.\u0275fac=function(e){return ye(e||t)},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac}),t})();const ye=i.Zb(ve),Oe={parse:{dateInput:"LL"},display:{dateInput:"input",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};let we=(()=>{class t extends F{constructor(){super(...arguments),this._from=_e().valueOf(),this.position="right",this.offset="bottom"}get from(){return new Date(this._from)||_e().startOf("d").toDate()}get until(){return new Date(this._to)||_e().endOf("d").add(1,"y").toDate()}get date_string(){return _e(this.date).format("DD MMM YYYY")}ngOnInit(){this.date=(new Date).toISOString()}setValue(t){const e=_e(this.date);let n=_e(t).hour(e.hour()).minute(e.minute()).startOf("m").valueOf();n<this.from.valueOf()&&(n=this.from.valueOf()),this.date=Object(ge.a)(n||new Date),this._onChange&&this._onChange(n),this.show_tooltip=!1}writeValue(t){this.date=Object(ge.a)(t||new Date),console.log("Date:",this.date),this.show_tooltip=!1}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouch=t}setDisabledState(t){this.disabled=t}}return t.\u0275fac=function(e){return ke(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["a-date-field"]],inputs:{_from:["from","_from"],_to:["to","_to"],position:"position",offset:"offset",disabled:"disabled"},features:[i.Eb([{provide:b.c,useClass:ve},{provide:b.e,useValue:Oe},{provide:o.j,useExisting:Object(i.Y)(()=>t),multi:!0}]),i.Cb],decls:5,vars:6,consts:[["appearance","outline","overlay","",3,"click"],["matInput","",3,"ngModel","disabled","min","max","matDatepicker","ngModelChange"],["matSuffix","",3,"for"],["picker",""]],template:function(t,e){if(1&t){const t=i.Yb();i.Xb(0,"mat-form-field",0),i.ic("click",function(){return i.Bc(t),i.xc(4).open()}),i.Xb(1,"input",1),i.ic("ngModelChange",function(t){return e.setValue(t)}),i.Wb(),i.Sb(2,"mat-datepicker-toggle",2),i.Sb(3,"mat-datepicker",null,3),i.Wb()}if(2&t){const t=i.xc(4);i.Fb(1),i.tc("ngModel",e.date)("disabled",e.disabled)("min",e.from)("max",e.until)("matDatepicker",t),i.Fb(1),i.tc("for",t)}},directives:[g.c,O.b,o.c,y.b,o.l,o.o,y.d,g.g,y.a],styles:["mat-form-field[_ngcontent-%COMP%] {\n                width: 100%;\n            }"]}),t})();const ke=i.Zb(we);var xe=n("VSY4");function je(t,e){if(1&t&&(i.Xb(0,"mat-option",5),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t.id),i.Fb(1),i.Oc(" ",t.name," ")}}let Me=(()=>{class t{constructor(){this.max=240,this.min=30,this.step=15,this.specialPreprops=[],this.duration=60}ngOnInit(){this.duration_options=this.generateDurationOptions(this.max,this.min,this.step)}ngOnChanges(t){(t.max||t.min||t.step||t.time)&&(this.duration_options=this.generateDurationOptions(this.max,this.min,this.step))}setValue(t){this.duration=t,this._onChange&&this._onChange(+t)}writeValue(t){this.duration=t}setDisabledState(t){this.disabled=t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouch=t}generateDurationOptions(t,e,n){const s=[];let i=e,o=this.time?_e(this.time):null;for(const a of this.specialPreprops)s.push({id:a,name:o?`${o.add(a,"m").format("h:mm A")} (${Object(xe.a)({hours:Math.floor(a/60),minutes:a%60})})`:`${Object(xe.a)({hours:Math.floor(a/60),minutes:a%60})}`});for(;i<=t;)s.push({id:i,name:o?`${o.add(i,"m").format("h:mm A")} (${Object(xe.a)({hours:Math.floor(i/60),minutes:i%60})})`:`${Object(xe.a)({hours:Math.floor(i/60),minutes:i%60})}`}),i+=n;return s}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["a-duration-field"]],inputs:{max:"max",min:"min",step:"step",time:"time",disabled:"disabled",specialPreprops:"specialPreprops"},features:[i.Eb([{provide:o.j,useExisting:Object(i.Y)(()=>t),multi:!0}]),i.Db],decls:5,vars:4,consts:[[1,"duration-field"],["appearance","outline"],[3,"value","disabled","valueChange"],["select",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(i.Xb(0,"div",0),i.Xb(1,"mat-form-field",1),i.Xb(2,"mat-select",2,3),i.ic("valueChange",function(t){return e.setValue(t)}),i.Kc(4,je,2,2,"mat-option",4),i.Wb(),i.Wb(),i.Wb()),2&t&&(i.Gb("disabled",e.disabled),i.Fb(2),i.tc("value",e.duration)("disabled",e.disabled),i.Fb(2),i.tc("ngForOf",e.duration_options))},directives:[g.c,_.a,p.l,b.k],styles:["[_nghost-%COMP%] {\n                width: 100%;\n            }\n\n            mat-form-field[_ngcontent-%COMP%] {\n                width: 100%;\n            }"]}),t})();var We=n("gME1"),Ce=(n("0LOL"),n("ILtH")),Xe=n("EhJz"),Fe=n("M34a"),Ie=n("piIK"),Se=n("IYaI"),$e=n("pMoy");function Pe(t,e){if(1&t&&(i.Xb(0,"main",6),i.Sb(1,"user-form",7),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.tc("form",t.form)}}function Ee(t,e){if(1&t){const t=i.Yb();i.Xb(0,"footer",8),i.Xb(1,"button",9),i.Mc(2,"Cancel"),i.Wb(),i.Xb(3,"button",10),i.ic("click",function(){return i.Bc(t),i.mc().saveChanges()}),i.Mc(4,"Save"),i.Wb(),i.Wb()}}function ze(t,e){1&t&&(i.Xb(0,"main",11),i.Sb(1,"mat-spinner",12),i.Xb(2,"p"),i.Mc(3,"Saving attendee..."),i.Wb(),i.Wb())}let Ke=(()=>{class t extends F{constructor(t){super(),this._data=t,this.event=new i.p}ngOnInit(){this.user=this._data.user||{},this.form=function(t){var e;if(!t)throw Error("No user passed");const n={name:new o.d(t.name||""),email:new o.d(t.email||"",[o.q.email,o.q.required]),organisation:new o.d(t.organisation||"",o.q.required),phone:new o.d(t.phone||""),assistance_required:new o.d(t.assistance_required||!1),visit_expected:new o.d(null===(e=t.visit_expected)||void 0===e||e)};return new o.f(n)}(this.user)}saveChanges(){if(this.form.markAllAsTouched(),this.form.valid){const t=new ft(Object.assign(Object.assign({},this.form.value),{type:"external",visit_expected:!this.form.value.email.endsWith("place.tech")}));this.event.emit({reason:"done",metadata:t})}}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(d.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["new-user-modal"]],outputs:{event:"event"},features:[i.Cb],decls:11,vars:4,consts:[["mat-dialog-title","",1,"heading"],[1,"flex-1"],["mat-icon-button","","mat-dialog-close",""],["class","flex flex-col items-center w-full p-2",4,"ngIf","ngIfElse"],["class","flex items-center justify-center w-full p-2 border-t border-gray-300 space-x-2",4,"ngIf"],["load_state",""],[1,"flex","flex-col","items-center","w-full","p-2"],[3,"form"],[1,"flex","items-center","justify-center","w-full","p-2","border-t","border-gray-300","space-x-2"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","",3,"click"],[1,"flex","flex-col","items-center","w-full","p-2","space-y-2"],["diameter","32"]],template:function(t,e){if(1&t&&(i.Xb(0,"header"),i.Xb(1,"div",0),i.Mc(2),i.Wb(),i.Sb(3,"div",1),i.Xb(4,"button",2),i.Xb(5,"app-icon"),i.Mc(6,"close"),i.Wb(),i.Wb(),i.Wb(),i.Kc(7,Pe,2,1,"main",3),i.Kc(8,Ee,5,0,"footer",4),i.Kc(9,ze,4,0,"ng-template",null,5,i.Lc)),2&t){const t=i.xc(10);i.Fb(2),i.Oc(" ",null!=e.user&&e.user.id?"Edit":"Add"," External Attendee "),i.Fb(5),i.tc("ngIf",!e.loading)("ngIfElse",t),i.Fb(1),i.tc("ngIf",!e.loading)}},styles:["main[_ngcontent-%COMP%] {\n                min-height: 20em !important;\n                width: 100%;\n            }\n\n            footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\n                min-width: 8em;\n            }"]}),t})();function De(t,e){if(1&t&&(i.Xb(0,"div",3),i.Xb(1,"label",4),i.Mc(2," Name"),i.Xb(3,"span"),i.Mc(4,"*"),i.Wb(),i.Mc(5,": "),i.Wb(),i.Xb(6,"mat-form-field",5),i.Sb(7,"input",6),i.Xb(8,"mat-error"),i.Mc(9,"Name is required"),i.Wb(),i.Wb(),i.Wb()),2&t){const t=i.mc(2);i.Fb(1),i.Jb("error",t.hasError("name"))}}function Le(t,e){if(1&t&&(i.Xb(0,"div",3),i.Xb(1,"label",7),i.Mc(2," Email"),i.Xb(3,"span"),i.Mc(4,"*"),i.Wb(),i.Mc(5,": "),i.Wb(),i.Xb(6,"mat-form-field",5),i.Sb(7,"input",8),i.Xb(8,"mat-error"),i.Mc(9,"A valid email is required"),i.Wb(),i.Wb(),i.Wb()),2&t){const t=i.mc(2);i.Fb(1),i.Jb("error",t.hasError("email"))}}function Te(t,e){if(1&t&&(i.Xb(0,"div",3),i.Xb(1,"label",9),i.Mc(2," Organisation"),i.Xb(3,"span"),i.Mc(4,"*"),i.Wb(),i.Mc(5,": "),i.Wb(),i.Xb(6,"mat-form-field",5),i.Sb(7,"input",10),i.Xb(8,"mat-error"),i.Mc(9,"Organisation is required"),i.Wb(),i.Wb(),i.Wb()),2&t){const t=i.mc(2);i.Fb(1),i.Jb("error",t.hasError("organisation"))}}function Re(t,e){if(1&t&&(i.Xb(0,"div",3),i.Xb(1,"label",11),i.Mc(2," Phone: "),i.Wb(),i.Xb(3,"mat-form-field",5),i.Sb(4,"input",12),i.Xb(5,"mat-error"),i.Mc(6,"Phone format is invalid"),i.Wb(),i.Wb(),i.Wb()),2&t){const t=i.mc(2);i.Fb(1),i.Jb("error",t.hasError("phone"))}}function Ae(t,e){1&t&&(i.Xb(0,"div",3),i.Xb(1,"mat-checkbox",13),i.Mc(2," Assistance required "),i.Wb(),i.Wb())}function qe(t,e){1&t&&(i.Xb(0,"div",3),i.Xb(1,"mat-checkbox",14),i.Mc(2," Visit expected "),i.Wb(),i.Wb())}function Ve(t,e){if(1&t&&(i.Xb(0,"form",1),i.Kc(1,De,10,2,"div",2),i.Kc(2,Le,10,2,"div",2),i.Kc(3,Te,10,2,"div",2),i.Kc(4,Re,7,2,"div",2),i.Kc(5,Ae,3,0,"div",2),i.Kc(6,qe,3,0,"div",2),i.Wb()),2&t){const t=i.mc();i.tc("formGroup",t.form),i.Fb(1),i.tc("ngIf",t.form.controls.name),i.Fb(1),i.tc("ngIf",t.form.controls.email),i.Fb(1),i.tc("ngIf",t.form.controls.organisation),i.Fb(1),i.tc("ngIf",t.form.controls.phone),i.Fb(1),i.tc("ngIf",t.form.controls.assistance_required),i.Fb(1),i.tc("ngIf",t.form.controls.visit_expected)}}let Be=(()=>{class t{hasError(t){return this.form.controls[t].invalid&&this.form.controls[t].touched}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["user-form"]],inputs:{form:"form"},decls:1,vars:1,consts:[["user-form","",3,"formGroup",4,"ngIf"],["user-form","",3,"formGroup"],["class","field",4,"ngIf"],[1,"field"],["for","name"],["appearance","outline"],["matInput","","name","name","placeholder","Name","formControlName","name"],["for","email"],["matInput","","name","email","placeholder","Email Address","formControlName","email"],["for","org"],["matInput","","name","org","placeholder","Organisation","formControlName","organisation"],["for","phone"],["matInput","","name","phone","placeholder","Phone","formControlName","phone"],["name","assistance-required","color","primary","formControlName","assistance_required"],["name","visit-expected","color","primary","formControlName","visit_expected"]],template:function(t,e){1&t&&i.Kc(0,Ve,7,7,"form",0),2&t&&i.tc("ngIf",e.form)},directives:[p.m,o.r,o.m,o.g,g.c,O.b,o.c,o.l,o.e,g.b,$e.a],styles:[".field[_ngcontent-%COMP%] {\n                display: flex;\n                flex-wrap: wrap;\n            }\n\n            mat-form-field[_ngcontent-%COMP%] {\n                width: 100%;\n            }"]}),t})();i.Ec(Ke,[d.f,m.b,d.c,Ft,p.m,Be,u.b],[]);var Ne=n("odh7"),Ue=n("jG/O"),Ye=n("dndX"),Ge=n("IjAw");class He{constructor(t={}){var e;this.settings={},this.id=t.id||"",this.parent_id=t.parent_id||"",this.name=t.name||"",this.display_name=t.display_name||"",this.map_id=t.map_id||"",this.capacity=t.capacity||0,this.locations=t.locations||[];const n=this.display_name.split(" ");this.number=(null===(e=n.length>=2?n[n.length-1]:this.display_name[0])||void 0===e?void 0:e.toUpperCase())||""}}class Je extends bt{constructor(t={}){super(t);const e=t.settings||{};this.display_name=t.display_name;const n=e.discovery_info||e;this.zone_id=t.zone_id||t.zone,this.extras=(t.extras||n.extras||[]).map(t=>({id:t.extra_id||t.id,name:t.extra_name||t.name})),this.loan_items=(t.loan_items||n.loan_items||[]).map(t=>({id:t.extra_id||t.id,name:t.extra_name||t.name})),this.levels=(t.levels||n.levels||[]).map(t=>new He(Object.assign(Object.assign({},t),{building_id:this.id}))),this._roles=t.roles||n.roles||{},this._lockers=t.lockers||t.locker_structure||n.locker_structure||{},this._systems=t.systems||n.systems||{},this._phone_numbers=t.phone_numbers||n.phone_numbers||{},this._location=t.location||n.location||{longitude:null,latitude:null},this.room_configurations=t.room_configurations||n.room_configurations||[],this.attributes=t.attributes||n.attributes||[];const s=[];if(t.neighbourhoods)for(const i in t.neighbourhoods)if(i in t.neighbourhoods){const e=t.neighbourhoods[i]||{};for(const t in e)t in e&&s.push({id:e[t],name:t,level_id:i})}this.bindings=t.bindings||{},this.searchables=s,this.timezone=t.timezone||n.timezone||e.timezone||"",this.catering_hours=t.catering_hours||n.catering_hours||e.catering_hours||{start:7,end:20},this.visitor_space=t.visitor_space||n.visitor_space||e.visitor_space||"",this.holding_bay=t.holding_bay||n.holding_bay||e.holding_bay||"",this.code=t.code||n.code||e.code||"",this.address=t.address||n.address||e.address||"",this.orientations=t.orientations||n.orientations||e.orientations||{},this.booking_details=t.booking_details||n.booking_details||e.booking_details||null,this.booking_rules=t.booking_rules||n.booking_rules||e.booking_rules||{},this.catering_restricted_from=t.catering_restricted_from||n.catering_restricted_from||e.catering_restricted_from||-1440,this.currency=t.currency||n.currency||e.currency||"USD"}role(t){return[...this._roles[t]||[]]}get role_names(){return Object.keys(this._roles).filter(t=>this._roles.hasOwnProperty(t))}get lockers(){return Object.assign({},this._lockers||{})}get systems(){return Object.assign({},this._systems||{})}get phone_numbers(){return Object.assign({},this._phone_numbers||{})}featuresForLevel(t){return(this.searchables||[]).filter(e=>e.level_id===t)}}class Qe extends bt{constructor(t={}){super(t),this.description=t.description||"",this.tags=t.tags||[],this.count=t.count||0,this.capacity=t.capacity||0,this.bindings=t.bindings||{},this._settings=t.settings||{}}setting(t){return L(t.split("."),this._settings)}}var Ze=n("itXk");let tn=(()=>{class t{constructor(t,e){this._service=t,this._router=e,this._initialised=new C.a(!1),this.initialised=this._initialised.asObservable(),this.buildings_subject=new C.a([]),this.active_building_subject=new C.a(null),this.levels_subject=new C.a([]),this.building_list=this.buildings_subject.asObservable(),this.level_list=this.levels_subject.asObservable(),this.active_building=this.active_building_subject.asObservable(),this.active_levels=Object(Ze.a)([this.level_list,this.active_building]).pipe(Object(mt.a)(t=>t[1]?this.levelsForBuilding(t[1]):[])),this._settings={},this._building_settings={},Object(W.j)().pipe(Object(S.a)(t=>t)).subscribe(()=>setTimeout(()=>this.init(),1e3)),this.active_building.subscribe(t=>{t&&(this._service.overrides=[this._settings,this.buildingSettings(t.id)])})}get settings(){return this._settings}get building_settings(){return this._building_settings}buildingSettings(t=""){return!t&&this.building&&(t=this.building.id),this._building_settings&&this._building_settings[t]||{}}get organisation(){return this._organisation}get buildings(){return this.buildings_subject.getValue()}get building(){return this.active_building_subject.getValue()}set building(t){this.active_building_subject.next(t),this._service.overrides=[this._settings.details,this.buildingSettings(t.id).details]}find(t){return this.buildings.find(e=>e.id===t||e.email===t)}get levels(){return this.levels_subject.getValue()}levelWithID(t){return this.levels.find(e=>null==t?void 0:t.includes(e.id))}levelsForBuilding(t){return this.levels.filter(e=>e.parent_id===t.id)}init(t=0){return Object(I.a)(this,void 0,void 0,function*(){this._initialised.next(!1),yield this.load().catch(e=>{throw dt("Error loading organisation data. Retrying..."),setTimeout(()=>this.init(t),Math.min(1e4,300*++t)),e}),this._initialised.next(!0),window.debug&&(window.application||(window.application={}),window.application.orgs=this)})}load(){return Object(I.a)(this,void 0,void 0,function*(){yield this.loadOrganisation(),yield this.loadBuildings(),yield this.loadLevels(),yield this.loadSettings()})}loadOrganisation(){var t;return Object(I.a)(this,void 0,void 0,function*(){const e=yield Object(W.o)({tags:"org"}).pipe(Object(mt.a)(t=>t.data)).toPromise();if(e.length){const n=Object(W.b)(),s=e.find(t=>{var e;return Object(W.h)()||t.id===(null===(e=null==n?void 0:n.config)||void 0===e?void 0:e.org_zone)})||e[0],i=null===(t=yield Object(W.t)(s.id,{name:"bindings"}).toPromise())||void 0===t?void 0:t.details;this._organisation=new Qe(Object.assign(Object.assign({},s),{bindings:i}))}else this._router.navigate(["/misconfigured"])})}loadBuildings(){var t;return Object(I.a)(this,void 0,void 0,function*(){const e=yield Object(W.o)({tags:"building",limit:500}).pipe(Object(mt.a)(t=>t.data)).toPromise();(null==e?void 0:e.length)||this._router.navigate(["/misconfigured"]);const n=[];for(const i of e){const e=null===(t=yield Object(W.t)(i.id,{name:"bindings"}).toPromise())||void 0===t?void 0:t.details;n.push(new Je(Object.assign(Object.assign({},i),{bindings:e})))}this.buildings_subject.next(n);const s=localStorage.getItem("PLACEOS.building");s&&this.buildings.find(t=>t.id===s)&&this.active_building_subject.next(this.buildings.find(t=>t.id===s)),!this.building&&n&&n.length>0&&(this.building=n[0])})}loadLevels(){return Object(I.a)(this,void 0,void 0,function*(){const t=yield Object(W.o)({tags:"level",limit:2500}).pipe(Object(mt.a)(t=>t.data)).toPromise();(null==t?void 0:t.length)||this._router.navigate(["/misconfigured"]);const e=t.map(t=>new He(t));e.sort((t,e)=>(t.name||"").localeCompare(e.name||"")),this.levels_subject.next(e)})}get available_room_configs(){return this.buildings.map(t=>[...t.room_configurations]).reduce((t,e)=>t.concat(e),[]).sort((t,e)=>t.name.localeCompare(e.name))}loadSettings(){return Object(I.a)(this,void 0,void 0,function*(){if(!this._organisation)return;const t=`${(this._service.get("app.name")||"workplace").toLowerCase()}_app`;this._settings=yield Object(W.t)(this._organisation.id,{name:t}).toPromise();const e=this.buildings;for(const n of e)this._building_settings[n.id]=yield Object(W.t)(n.id,{name:t}).toPromise();this._service.overrides=[this._settings.details,this.buildingSettings(this.building.id).details]})}saveBuilding(t){localStorage.setItem("PLACEOS.building",t)}}return t.\u0275fac=function(e){return new(e||t)(i.ec(et),i.ec(c.d))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();class en{constructor(t={}){var e;this.toJSON=()=>this.format(),this.id=t.id||"",this.name=t.name||"",this.bookable=null!==(e=t.bookable)&&void 0!==e&&e,this.zone=t.zone||new W.a,this.groups=t.groups||[]}format(){const{id:t,name:e,bookable:n,groups:s}=this;return{id:t,name:e,bookable:n,groups:s}}}class nn{constructor(t={}){this.id=t.id||"",this.name=t.name||"",this.display_name=t.display_name||"",this.email=(t.email||"").toLowerCase(),this.capacity=t.capacity||-1,this.feature_list=t.feature_list||t.features||[],this.bookable=!!t.bookable,this.zones=t.zones||[],this.support_url=t.support_url||"",this.map_id=t.map_id||"",this.image=t.image||"",this.configurations=t.configurations||[],this.features=t.features||[],this.response_status=t.response_status,this.level=t.level||new He}}class sn{constructor(t={}){this.id=t.id||"",this.name=t.name||t.id||"",this.category=t.category||"",this.unit_price=t.unit_price||0,this.description=t.description||"",this.quantity=t.quantity||0,this.options=t.options||[],this.tags=t.tags||[],this.total_cost=(this.unit_price+this.options.map(t=>t.unit_price||0).reduce((t,e)=>t+e,0))*this.quantity}}class on{constructor(t={}){var e,n;this.id=t.id||`order-${R(9999999,1e6)}`,this.system_id=t.system_id||"",this.event_id=t.event_id||(null===(e=t.event)||void 0===e?void 0:e.id)||"",this.items=(t.items||[]).map(t=>new sn(t)),this.item_count=this.items.reduce((t,e)=>t+e.quantity,0),this.total_cost=this.items.reduce((t,e)=>t+(e.total_cost||0),0),this.charge_code=t.charge_code||"",this.status=t.status||"accepted",this.invoice_number=t.invoice_number||"",this.event=t.event||null,this.deliver_at=t.deliver_at||t.date||(null===(n=this.event)||void 0===n?void 0:n.date)||(new Date).getTime()}}n("s+wp");var an=n("Ctv7");const cn={month:43200,months:43200,week:10080,weeks:10080,day:1440,days:1440,hour:60,hours:60,minute:1,minutes:1},rn={auto_approve:!0,hidden:!1};function ln(t){const e=(t||"").split(" ");return e.length>1?+e[0]*cn[e[1]]:0}function dn(t,e=new Date){return Object(Se.a)(e,ln(t))}function un({date:t,duration:e,host:n},s){let i=0;const{conditions:o}=s;return o.groups instanceof Array&&o.groups.every(t=>n.groups.includes(t))&&(i+=1),o.is_before&&Object(Ye.a)(Object(Se.a)(t,e),dn(o.is_before))&&(i+=1),o.is_after&&Object(Xe.a)(t,dn(o.is_after))&&(i+=1),console.log(ln(o.min_length)<=e,ln(o.min_length),e),o.min_length&&ln(o.min_length)<=e&&(i+=1),o.max_length&&ln(o.max_length)>=e&&(i+=1),i>=Object.keys(o).length}let bn={id:"default",name:"Default User"};class hn{constructor(t={}){var e,n;this.id=t.id||"",this.event_start=t.event_start||Object(Ne.a)(t.date||Object(Ce.a)(Object(Se.a)(new Date,3),{nearestTo:5})),this.event_end=t.event_end||Object(Ne.a)(Object(Se.a)(1e3*this.event_start,t.duration||30)),this.calendar=t.calendar||"",this.creator=(null===(e=t.creator||bn.email)||void 0===e?void 0:e.toLowerCase())||"",this.host=(t.host||this.creator||"").toLowerCase();const s=t.attendees||[];this.attendees=s.filter(t=>!t.resource).map(t=>new ft(t)),this.resources=T(t.resources||s.filter(t=>t.resource).map(t=>new nn(t)),"email")||[],this.title=t.title||"",this.body=t.body||"",this.private=!!t.private,this.all_day=!!t.all_day,this.date=1e3*this.event_start,this.duration=this.all_day?1440:t.duration||Object(Ue.a)(1e3*t.event_end,this.date)||30,this.timezone=t.timezone||"",this.location=t.location||"",this.recurring=!!t.recurring,this.recurring_master_id=t.recurring_master_id||"",this.organiser=this.attendees.find(t=>t.email===this.host),this.master=t.master?new hn(t.master):null,this.recurrence=t.recurring?{start:1e3*this.event_start||new Date(1e3*t.recurrence.range_start).valueOf(),end:t.recurrence.end||new Date(1e3*t.recurrence.range_end).valueOf(),interval:t.recurrence.interval,pattern:t.recurrence.pattern,days_of_week:t.recurrence.days_of_week}:{},this.system=t.system,(null===(n=this.system)||void 0===n?void 0:n.email)&&this.resources.push(new nn(this.system)),this.old_system=t.old_system||t.system,this.attachments=t.attachments||[],this.extension_data=t.extension_data||{},this.status=function(t){var e;return(null===(e=t.resources)||void 0===e?void 0:e.length)?t.resources.every(t=>"accepted"===t.response_status)?"confirmed":t.resources.some(t=>"tentative"===t.response_status||"needsAction"===t.response_status)?"tentative":"cancelled":"confirmed"}(this)||"none",this.type="cancelled"===this.status?"cancelled":this.attendees.find(t=>t.is_external)?"external":"internal";for(const i in t)i in this||(this.extension_data[i]=t[i]||this.extension_data[i]);this.extension_data.catering=(this.extension_data.catering||[]).map(t=>new on(Object.assign(Object.assign({},t),{event:this})))}ext(t){return this.extension_data[t]}get guests(){return this.attendees.filter(t=>!!t.visit_expected)}get space(){return this.resources[0]||null}get is_today(){return Object(Q.a)(new Date(this.date),new Date)}toJSON(){var t;const e=Object.assign({},this),n=Object(Ne.a)(Object(Se.a)(this.date,this.duration)),s=this.all_day?Object(We.a)(this.date,{hours:12}):this.date;e.event_start=Object(Ne.a)(s),e.event_end=n;const i=this.attendees;return this.recurring&&(e.recurrence=Object.assign(Object.assign({},this.recurrence),{range_start:e.event_start,range_end:Object(Ne.a)(this.recurrence.end)})),e.recurrence=e.recurrence&&Object.keys(e.recurrence).length?e.recurrence:null,e.attendees=T(i,"email"),this.all_day||(e.extension_data.breakdown=15),e.extension_data.catering=e.extension_data.catering.map(t=>new on(Object.assign(Object.assign({},t),{event:null}))),e.system_id=null===(t=this.system)||void 0===t?void 0:t.id,delete e.catering,delete e.date,delete e.duration,e}get state(){const t=new Date,e=this.date;return Object(Ye.a)(t,Object(Ge.a)(e,{minutes:-15}))?"future":Object(Ye.a)(t,e)?"upcoming":Object(Ye.a)(t,Object(Ge.a)(e,{minutes:15}))?"started":Object(Ye.a)(t,Object(Ge.a)(e,{minutes:this.duration}))?"in_progress":"done"}get can_check_in(){const t=new Date;return this.is_today||Object(Xe.a)(t,this.date)&&Object(Ye.a)(t,Object(Se.a)(this.date,this.duration))}}function pn(t){const e=st({q:t});return Object(W.e)("/api/staff/v1/guests"+(t?"?"+e:"")).pipe(Object(mt.a)(t=>t.map(t=>new gt(t))))}function mn(t){const e=st({q:t});return Object(W.e)("/api/staff/v1/people"+(t?"?"+e:"")).pipe(Object(mt.a)(t=>t.map(t=>new _t(t))))}var fn=n("XNiG"),gn=n("LRne"),_n=n("cp0P"),vn=n("Kj3r"),yn=n("/uUt"),On=n("eIep"),wn=n("JIr8");const kn=["input"];function xn(t,e){1&t&&i.Sb(0,"mat-spinner",9)}function jn(t,e){if(1&t){const t=i.Yb();i.Xb(0,"mat-option",10),i.ic("click",function(){return i.Bc(t),i.mc().blurInput()}),i.Xb(1,"div",11),i.Mc(2),i.Wb(),i.Xb(3,"div",12),i.Mc(4),i.Wb(),i.Wb()}if(2&t){const t=e.$implicit;i.tc("value",t),i.Fb(2),i.Nc(t.name),i.Fb(2),i.Oc(" ",t.email," ")}}let Mn=(()=>{class t extends F{constructor(){super(...arguments),this.query_fn=t=>mn(t),this.search$=new fn.b,this.search_results$=this.search$.pipe(Object(vn.a)(400),Object(yn.a)(),Object(On.a)(t=>(this.loading=!0,this.options&&this.options.length>0?Object(gn.a)(this.options):t.length>=3?this.guests?Object(_n.a)([mn(t),pn(t)]):this.query_fn(t):Object(gn.a)([]))),Object(wn.a)(t=>Object(gn.a)([])),Object(mt.a)(t=>{this.loading=!1,t=function(t){const e=[...t],n=[];for(;e.length;){const t=e.pop();Array.isArray(t)?e.push(...t):n.push(t)}return n.reverse()}(t);const e=this.search_str.toLowerCase();return t.filter(t=>!this.filter||this.filter(t,e))})),this.cancelReset=()=>this.clearTimeout("reset"),this.blurInput=()=>{console.log("Blur",this._input_el),this.timeout("blur",()=>{var t,e;return null===(e=null===(t=this._input_el)||void 0===t?void 0:t.nativeElement)||void 0===e?void 0:e.blur()})}}ngOnInit(){this.subscription("search_results",this.search_results$.subscribe(t=>this.user_list=t))}resetSearchString(){this.timeout("reset",()=>{var t;return this.search_str=(null===(t=this.active_user)||void 0===t?void 0:t.name)||""},50)}setValue(t){this.active_user=t,this._onChange&&this._onChange(t),this.resetSearchString()}writeValue(t){this.active_user=t,this.resetSearchString()}setDisabledState(t){this.disabled=t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouch=t}}return t.\u0275fac=function(e){return Wn(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["a-user-search-field"]],viewQuery:function(t,e){if(1&t&&i.Rc(kn,1,i.m),2&t){let t;i.wc(t=i.jc())&&(e._input_el=t.first)}},inputs:{disabled:"disabled",placeholder:"placeholder",options:"options",guests:"guests",filter:"filter",query_fn:"query_fn"},features:[i.Eb([{provide:o.j,useExisting:Object(i.Y)(()=>t),multi:!0}]),i.Cb],decls:10,vars:6,consts:[["form-field","",1,"user-search-field","text-black"],["overlay","","appearance","outline"],["matInput","","keyboard","","name","user-search",3,"ngModel","disabled","placeholder","matAutocomplete","ngModelChange","blur","focus"],["input",""],["matPrefix","",1,"text-2xl","relative"],["matSuffix","","diameter","16",4,"ngIf"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value","click",4,"ngFor","ngForOf"],["matSuffix","","diameter","16"],[3,"value","click"],[1,"leading-tight"],[1,"text-xs","text-black","opacity-60"]],template:function(t,e){if(1&t&&(i.Xb(0,"div",0),i.Xb(1,"mat-form-field",1),i.Xb(2,"input",2,3),i.ic("ngModelChange",function(t){return e.search_str=t})("ngModelChange",function(t){return e.search$.next(t)})("blur",function(){return e.resetSearchString()})("focus",function(){return e.cancelReset()}),i.Wb(),i.Xb(4,"app-icon",4),i.Mc(5,"search"),i.Wb(),i.Kc(6,xn,1,0,"mat-spinner",5),i.Wb(),i.Xb(7,"mat-autocomplete",6,7),i.ic("optionSelected",function(t){return e.setValue(t.option.value)}),i.Kc(9,jn,5,3,"mat-option",8),i.Wb(),i.Wb()),2&t){const t=i.xc(8);i.Fb(2),i.tc("ngModel",e.search_str)("disabled",e.disabled)("placeholder",e.placeholder||"Search for user...")("matAutocomplete",t),i.Fb(4),i.tc("ngIf",e.loading),i.Fb(3),i.tc("ngForOf",e.user_list)}},directives:[g.c,O.b,be,o.c,v.d,o.l,o.o,Ft,g.f,p.m,v.a,p.l,u.b,g.g,b.k],styles:["[_nghost-%COMP%], mat-form-field[_ngcontent-%COMP%] {\n                width: 100%;\n            }\n\n            app-icon[_ngcontent-%COMP%] {\n                top: 0.15em;\n                left: -0.15em;\n            }"]}),t})();const Wn=i.Zb(Mn);function Cn(t,e){if(1&t){const t=i.Yb();i.Xb(0,"mat-chip",9),i.ic("removed",function(){i.Bc(t);const n=e.$implicit;return i.mc(2).removeUser(n)}),i.Mc(1),i.Xb(2,"app-icon",10),i.Mc(3,"close"),i.Wb(),i.Wb()}if(2&t){const t=e.$implicit;i.tc("id",t.email)("removable",!0),i.Gb("color",t.is_external?"external":"internal"),i.Fb(1),i.Oc(" ",t.name," ")}}function Xn(t,e){if(1&t&&(i.Xb(0,"mat-chip-list",7),i.Kc(1,Cn,4,4,"mat-chip",8),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.tc("ngForOf",t.active_list)}}function Fn(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div",11),i.Xb(1,"button",12),i.ic("click",function(){return i.Bc(t),i.mc().openNewUserModal()}),i.bc(2,13),i.Wb(),i.Xb(3,"button",14),i.dc(4,15),i.Xb(5,"input",16),i.ic("change",function(e){return i.Bc(t),i.mc().addUsersFromFile(e)}),i.Wb(),i.cc(),i.Wb(),i.Xb(6,"button",17),i.ic("click",function(){return i.Bc(t),i.mc().downloadCSVTemplate()}),i.bc(7,18),i.Wb(),i.Wb()}}function In(t,e){1&t&&(i.Xb(0,"div",19),i.bc(1,20),i.Wb())}let Sn=(()=>{class t extends F{constructor(t){super(),this._dialog=t,this.limit=3,this.guests=!1,this.hide_actions=!1,this.new_user=new i.p,this.user_list=[],this.active_list=[]}addUser(t){console.log("Add User:",t);const e=this.active_list.findIndex(e=>e.email===t.email);let n=[...this.active_list];e<0&&(n=[...this.active_list,t]),this.setValue(n),this.search_user=null}removeUser(t){const e=this.active_list.filter(e=>e.email!==t.email);this.setValue(e)}addUsersFromFile(t){if(t.target){const e=t.target.files[0];if(e){const n=new FileReader;n.readAsText(e,"UTF-8"),n.addEventListener("load",e=>{this.processCsvData(e.srcElement.result),t.target.value=""}),n.addEventListener("error",t=>dt("Error reading file."))}}}processCsvData(t){var e;const n=function(t,e=","){const n=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^\\,\\r\\n]*))',"gi");let s=null,i=[[]];for(;s=n.exec(t);)s[1].length&&","!==s[1]&&i.push([]),i[i.length-1].push(s[2]?s[2].replace(new RegExp('""',"g"),'"'):s[3]);const o=i.splice(0,1)[0];return i.map(t=>{const e={};for(let s=0;s<t.length;s++)try{e[o[s]]=JSON.parse(t[s])}catch(n){e[o[s]]=t[s]||""}return e})}(t)||[],s=(null===(e=Ot())||void 0===e?void 0:e.staff_id)||"unknown";console.log("List:",n);for(const i of n){console.log("Element:",i),i.name=i.name||`${i.first_name} ${i.last_name}`;const t=(i.name||`${Math.floor(99999999*Math.random())}`).split(" ").join("_").toLowerCase();i.email||(i.email=`${t}+${s}@guest.place.tech`),i.visit_expected=!i.email.endsWith("place.tech"),this.addUser(new ft(i)),console.log("List:",this.active_list)}console.log("Finished processing CSV",this.active_list)}downloadCSVTemplate(){!function(t,e){const n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent("Organisation,First Name,Last Name,Email,Phone,Assistance Required\nFake Org,John,Smith,john.smith@example.com,01234567898, yes")),n.setAttribute("download","template.csv"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}()}setValue(t){this.active_list=t,this._onChange&&this._onChange(t)}writeValue(t){this.active_list=t}setDisabledState(t){this.disabled=t}registerOnChange(t){this._onChange=t}registerOnTouched(t){this._onTouch=t}displayFn(t){return(null==t?void 0:t.name)||""}openNewUserModal(){var t;const e=this._dialog.open(Ke,{width:"auto",height:"auto",data:{}});null===(t=e.componentInstance)||void 0===t||t.event.pipe(Object(S.a)(t=>"done"===t.reason)).subscribe(t=>{this.addUser(t.metadata),e.close()})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(d.b))},t.\u0275cmp=i.Lb({type:t,selectors:[["a-user-list-field"]],inputs:{disabled:"disabled",limit:"limit",guests:"guests",hide_actions:["hideActions","hide_actions"],filter:"filter"},outputs:{new_user:"new_user"},features:[i.Eb([{provide:o.j,useExisting:Object(i.Y)(()=>t),multi:!0}]),i.Cb],decls:8,vars:7,consts:function(){let t,e,n,s;return t=$localize`:Add new external attendee␟cfa9f539daab981e6bc8f4b38cae105813735035␟7132920070281100371: Add External `,e=$localize`:Upload attendee list from CSV file␟73be48b95c09cbc56aaa9a0fa44de228a47ccf2c␟4067369998249979171: Upload CSV ${"\ufffd#5\ufffd\ufffd/#5\ufffd"}:TAG_INPUT:`,n=$localize`:Download template CSV file␟ead3080cd17f13589ea91969555a469d9f426da2␟6011687430454365334: CSV Template `,s=$localize`:Attendee empty state␟33e355c508c5fb4524f9b01d1d81271cd3de91a0␟7244704459700721325:No attendees`,[["form-field","",1,"mb-4","border","border-grey-200","rounded","bg-white","text-black"],["search",""],[3,"ngModel","guests","filter","ngModelChange"],[1,"p-2","-mt-2","border-b","border-grey-200"],["aria-label","User List",4,"ngIf","ngIfElse"],["class","flex items-center border-t border-gray-300 divide-x divide-gray-300",4,"ngIf"],["empty_state",""],["aria-label","User List"],[3,"id","removable","removed",4,"ngFor","ngForOf"],[3,"id","removable","removed"],["matChipRemove",""],[1,"flex","items-center","border-t","border-gray-300","divide-x","divide-gray-300"],["mat-button","","name","new-contact",1,"clear","underline","flex-1",3,"click"],t,["mat-button","","name","upload-csv",1,"clear","underline","flex-1","relative"],e,["type","file",1,"opacity-0","absolute","inset-0",3,"change"],["mat-button","","name","download-template",1,"clear","underline","flex-1",3,"click"],n,[1,"m-2"],s]},template:function(t,e){if(1&t&&(i.Xb(0,"div",0),i.Xb(1,"div",1),i.Xb(2,"a-user-search-field",2),i.ic("ngModelChange",function(t){return e.search_user=t})("ngModelChange",function(t){return e.addUser(t)}),i.Wb(),i.Wb(),i.Xb(3,"div",3),i.Kc(4,Xn,2,1,"mat-chip-list",4),i.Wb(),i.Kc(5,Fn,8,0,"div",5),i.Wb(),i.Kc(6,In,2,0,"ng-template",null,6,i.Lc)),2&t){const t=i.xc(7);i.Gb("disabled",e.disabled),i.Fb(2),i.tc("ngModel",e.search_user)("guests",e.guests)("filter",e.filter),i.Fb(2),i.tc("ngIf",e.active_list&&e.active_list.length)("ngIfElse",t),i.Fb(1),i.tc("ngIf",!e.hide_actions)}},directives:[Mn,o.l,o.o,p.m,w.c,p.l,w.a,Ft,w.d,m.b],styles:["button[_ngcontent-%COMP%] {\n                background: transparent;\n            }\n\n            [search][_ngcontent-%COMP%] {\n                height: 3.5rem;\n                margin-top: -0.25rem;\n            }"]}),t})();n("Ht+U");let $n=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Pb({type:t}),t.\u0275inj=i.Ob({imports:[[p.c,o.h,o.p,g.e,O.c,_.b,v.b,me]]}),t})();var Pn=n("pLZG");function En(t,e){if(1&t&&(i.Xb(0,"div",8),i.Xb(1,"app-icon"),i.Mc(2,"account_circle"),i.Wb(),i.Xb(3,"div"),i.Mc(4),i.Wb(),i.Wb()),2&t){const t=i.mc(2);i.Fb(4),i.Nc(t.space.capacity)}}function zn(t,e){if(1&t){const t=i.Yb();i.Xb(0,"button",9),i.ic("click",function(){return i.Bc(t),i.mc(2).action.emit()}),i.Xb(1,"app-icon"),i.Mc(2),i.Wb(),i.Wb()}if(2&t){const t=i.mc(2);i.Fb(2),i.Nc("available"===t.type?"add":"close")}}function Kn(t,e){if(1&t&&(i.Xb(0,"div",2),i.Xb(1,"div",3),i.Xb(2,"div",4),i.Mc(3),i.Wb(),i.Xb(4,"div",5),i.Mc(5),i.Wb(),i.Wb(),i.Kc(6,En,5,1,"div",6),i.Kc(7,zn,3,1,"button",7),i.Wb()),2&t){const t=i.mc(),e=i.xc(2);i.Fb(3),i.Nc(t.space.name),i.Fb(2),i.Oc(" ",(null==t.space.level?null:t.space.level.display_name)||(null==t.space.level?null:t.space.level.name)," "),i.Fb(1),i.tc("ngIf",-1!==t.space.capacity),i.Fb(1),i.tc("ngIf",t.multiple)("ngIfElse",e)}}function Dn(t,e){if(1&t&&(i.Xb(0,"button",10),i.Mc(1),i.Wb()),2&t){const t=i.mc();i.Jb("request",t.space.by_request),i.Fb(1),i.Oc(" ",t.space.by_request?"Request":"Book"," ")}}let Ln=(()=>{class t{constructor(){this.action=new i.p}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["a-space-select-item"]],inputs:{space:"space",type:"type",multiple:"multiple"},outputs:{action:"action"},decls:3,vars:1,consts:[["space","","class","w-full flex items-center p-2 space-x-2",4,"ngIf"],["single_button",""],["space","",1,"w-full","flex","items-center","p-2","space-x-2"],[1,"flex-1","w-1/2"],[1,"text-base","truncate"],[1,"text-xs"],["class","flex items-center",4,"ngIf"],["mat-icon-button","",3,"click",4,"ngIf","ngIfElse"],[1,"flex","items-center"],["mat-icon-button","",3,"click"],["mat-button",""]],template:function(t,e){1&t&&(i.Kc(0,Kn,8,5,"div",0),i.Kc(1,Dn,2,3,"ng-template",null,1,i.Lc)),2&t&&i.tc("ngIf",e.space)},styles:[""]}),t})();var Tn=n("UXun"),Rn=n("vkgz");class An{constructor(t={}){this.id=t.id||"",this.name=t.name||"",this.primary=!!t.primary,this.summary=t.summary||"",this.can_edit=!!t.can_edit,this.resource=new nn(t.resource||t.system),this.availability=(t.availability||[]).map(t=>({date:new Date(t.starts_at.dateTime).valueOf(),duration:Object(Ue.a)(new Date(t.ends_at.dateTime),new Date(t.starts_at.dateTime)),status:t.status})),this.hidden=!!t.hidden}}const qn="/api/staff/v1/calendars",Vn=t=>Object(mt.a)(e=>e.filter(t=>!!t.resource).map(e=>new nn(Object.assign(Object.assign({},e.resource),{level:null==t?void 0:t.levelWithID(e.resource.zones)}))).filter(t=>t.bookable));function Bn(t,e){if(1&t&&(i.Xb(0,"mat-option",13),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t),i.Fb(1),i.Oc(" ",t.display_name||t.name," ")}}function Nn(t,e){if(1&t){const t=i.Yb();i.Xb(0,"mat-form-field",10),i.Xb(1,"mat-select",11),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc().building.next(e)}),i.Kc(2,Bn,2,2,"mat-option",12),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.Fb(1),i.tc("ngModel",t.building.getValue()),i.Fb(1),i.tc("ngForOf",t.buildings)}}function Un(t,e){if(1&t&&(i.Xb(0,"mat-option",13),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t.id),i.Fb(1),i.Oc(" ",t.name," ")}}function Yn(t,e){if(1&t){const t=i.Yb();i.Xb(0,"mat-form-field",10),i.Xb(1,"mat-select",14),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc().type=e}),i.Kc(2,Un,2,2,"mat-option",12),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.Fb(1),i.tc("ngModel",t.type),i.Fb(1),i.tc("ngForOf",t.space_types)}}function Gn(t,e){if(1&t){const t=i.Yb();i.Xb(0,"a-space-select-item",17),i.ic("click",function(){i.Bc(t);const e=i.mc().$implicit;return i.mc(3).spaceSelected(e)}),i.Wb()}if(2&t){const t=i.mc().$implicit,e=i.mc(3);i.tc("space",t)("multiple",e.multiple)}}function Hn(t,e){if(1&t&&(i.Vb(0),i.Kc(1,Gn,1,2,"a-space-select-item",16),i.Ub()),2&t){const t=e.$implicit,n=i.mc(3);i.Fb(1),i.tc("ngIf",!n.space_map[t.id])}}function Jn(t,e){if(1&t&&(i.Vb(0),i.Kc(1,Hn,2,1,"ng-container",15),i.nc(2,"async"),i.Ub()),2&t){const t=i.mc(2);i.Fb(1),i.tc("ngForOf",i.oc(2,1,t.filtered_spaces))}}function Qn(t,e){if(1&t&&(i.Vb(0),i.Kc(1,Jn,3,3,"ng-container",5),i.nc(2,"async"),i.Ub()),2&t){const t=i.mc(),e=i.xc(16);let n=null;i.Fb(1),i.tc("ngIf",null==(n=i.oc(2,2,t.filtered_spaces))?null:n.length)("ngIfElse",e)}}function Zn(t,e){if(1&t&&i.Sb(0,"a-space-select-item",20),2&t){const t=e.$implicit,n=i.mc(3);i.tc("space",t)("multiple",n.multiple)}}function ts(t,e){if(1&t&&(i.Vb(0),i.Kc(1,Zn,1,2,"a-space-select-item",19),i.Ub()),2&t){const t=i.mc(2);i.Fb(1),i.tc("ngForOf",t.spaces)}}function es(t,e){if(1&t&&(i.Xb(0,"div",18),i.Kc(1,ts,2,1,"ng-container",5),i.Wb()),2&t){const t=i.mc(),e=i.xc(16);i.Jb("show",t.show_selected),i.Fb(1),i.tc("ngIf",t.spaces&&t.spaces.length)("ngIfElse",e)}}function ns(t,e){if(1&t){const t=i.Yb();i.Xb(0,"footer"),i.Xb(1,"button",21),i.ic("click",function(){return i.Bc(t),i.mc().save()}),i.Mc(2),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.Fb(2),i.Oc(" Save selected spaces(",t.spaces.length||"0",") ")}}function ss(t,e){1&t&&(i.Xb(0,"div",22),i.Xb(1,"app-icon",0),i.Mc(2,"close"),i.Wb(),i.Xb(3,"p"),i.Mc(4,"No spaces"),i.Wb(),i.Wb())}function is(t,e){1&t&&(i.Xb(0,"div",23),i.Sb(1,"mat-spinner",24),i.Xb(2,"p"),i.Mc(3,"Finding available spaces..."),i.Wb(),i.Wb())}let os=(()=>{class t extends F{constructor(t,e,n){super(),this._org=t,this._settings=e,this._data=n,this.event=new i.p,this.spaces=[...this._data.spaces||[]],this.building=new C.a(null),this.space_types=[],this.available_spaces=Object(Ze.a)([this.building]).pipe(Object(On.a)(([t])=>(this.loading=!0,function(t,e){const n=st(t);return Object(W.e)(`${qn}/free_busy${n?"?"+n:""}`).pipe(Object(mt.a)(t=>t.map(t=>new An(t))),Vn(void 0))}({zone_ids:null==t?void 0:t.id,period_start:Object(Ne.a)(this._data.date),period_end:Object(Ne.a)(Object(Se.a)(this._data.date,this._data.duration))}))),Object(Tn.a)(1)),this.filtered_spaces=this.available_spaces.pipe(Object(mt.a)(t=>{return e=t,n=Object.assign(Object.assign({},this._data),{host:Ot()}),s=this._org.building.booking_rules,e.filter(t=>{var e;return!(null===(e=function(t,e){const{space:n}=t;for(const s of n.zones)if(e[s]&&un(t,e[s]))return Object.assign(Object.assign({},rn),e[s].rules);return rn}(Object.assign(Object.assign({},n),{space:t}),s))||void 0===e?void 0:e.hidden)});var e,n,s}),Object(Rn.a)(()=>this.loading=!1)),this.building.next(this._org.building||this.buildings[0]),this.subscription("spaces",this.filtered_spaces.subscribe(t=>t))}get buildings(){return this._org.buildings}get multiple(){return!!this._settings.get("app.booking.multiple_spaces")}get space_map(){const t={};return this.spaces.forEach(e=>t[e.id]=!0),t}spaceSelected(t){this.multiple?this.space_map[t.id]||this.spaces.push(t):(this.spaces=[t],this.save())}save(){this.event.emit({reason:"done",metadata:this.spaces})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(tn),i.Rb(et),i.Rb(d.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["a-space-select-modal"]],outputs:{event:"event"},features:[i.Cb],decls:19,vars:7,consts:[[1,"text-3xl"],[1,"text-xl","font-semibold","flex-1"],["mat-icon-button","","mat-dialog-close",""],["appearance","outline",4,"ngIf"],[1,"body",2,"width","32rem"],[4,"ngIf","ngIfElse"],["class","space-list",3,"show",4,"ngIf"],[4,"ngIf"],["empty_state",""],["load_state",""],["appearance","outline"],["name","booking-type","placeholder","Select building",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["name","booking-type","placeholder","Any space type",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["type","available",3,"space","multiple","click",4,"ngIf"],["type","available",3,"space","multiple","click"],[1,"space-list"],["type","selected",3,"space","multiple",4,"ngFor","ngForOf"],["type","selected",3,"space","multiple"],["mat-button","",3,"click"],["empty","",1,"flex","flex-col","items-center","space-y-2"],["load","",1,"flex","flex-col","items-center","space-y-2"],["diameter","48"]],template:function(t,e){if(1&t&&(i.Xb(0,"header"),i.Xb(1,"app-icon",0),i.Mc(2,"place"),i.Wb(),i.Xb(3,"div",1),i.Mc(4),i.Wb(),i.Xb(5,"button",2),i.Xb(6,"app-icon",0),i.Mc(7,"close"),i.Wb(),i.Wb(),i.Wb(),i.Xb(8,"main"),i.Kc(9,Nn,3,2,"mat-form-field",3),i.Kc(10,Yn,3,2,"mat-form-field",3),i.Xb(11,"div",4),i.Kc(12,Qn,3,4,"ng-container",5),i.Kc(13,es,2,4,"div",6),i.Wb(),i.Kc(14,ns,3,1,"footer",7),i.Kc(15,ss,5,0,"ng-template",null,8,i.Lc),i.Kc(17,is,4,0,"ng-template",null,9,i.Lc),i.Wb()),2&t){const t=i.xc(18);i.Fb(4),i.Oc(" Select space",e.multiple?"s":""," "),i.Fb(5),i.tc("ngIf",e.buildings&&e.buildings.length>1),i.Fb(1),i.tc("ngIf",e.space_types&&e.space_types.length>1),i.Fb(2),i.tc("ngIf",!e.loading)("ngIfElse",t),i.Fb(1),i.tc("ngIf",e.multiple),i.Fb(1),i.tc("ngIf",e.multiple)}},styles:["mat-form-field[_ngcontent-%COMP%] {\n                height: 3.5em;\n                width: 100%;\n                padding: 0 0.25em;\n            }\n\n            .body[_ngcontent-%COMP%] {\n                min-width: 20rem;\n                max-width: calc(100vw - 2rem);\n            }"]}),t})();i.Ec(os,[Ft,m.b,d.c,p.m,g.c,_.a,p.l,b.k,Ln,u.b],[p.b]),i.Ec(Ln,[p.m,Ft,m.b],[]);let as=0,cs=(()=>{class t{constructor(t){this._org=t,this._list=new C.a([]),this._initialised=new C.a(!1),this.initialised=this._initialised.asObservable(),this.list=this._list.asObservable(),this._compare=t=>t.zones.includes(this._org.building.id),this._org.initialised.pipe(Object(S.a)(t=>t)).subscribe(()=>this.loadSpaces())}get space_list(){return this._list.getValue()}filter(t=this._compare){return this._list.getValue().filter(e=>t(e))}find(t){return this._list.getValue().find(e=>e.id===t||e.email===t)}loadSpaces(){return Object(I.a)(this,void 0,void 0,function*(){const t=(yield Object(W.n)({zone_id:this._org.organisation.id,limit:5e3}).pipe(Object(mt.a)(t=>t.data)).toPromise()).map(t=>new nn(Object.assign(Object.assign({},t),{level:this._org.levelWithID([...t.zones])}))).filter(t=>t.map_id);this._list.next(t),this._initialised.next(!0)})}}return t.\u0275fac=function(e){return new(e||t)(i.ec(tn))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),rs=(()=>{class t extends F{constructor(t,e,n){super(),this._org=t,this._spaces=e,this._settings=n,this._level=new C.a(null),this._positions=new C.a({zoom:1,center:{x:.5,y:.5}}),this._styles=new C.a({}),this._features=new C.a({}),this._actions=new C.a({}),this._labels=new C.a({}),this._options=new C.a({}),this._message=new C.a(""),this.level=this._level.asObservable(),this.message=this._message.asObservable(),this.spaces=Object(Ze.a)([this._level,this._spaces.list]).pipe(Object(mt.a)(([t,e])=>e.filter(e=>e.zones.includes(t.id)))),this.map_url=this._level.pipe(Object(mt.a)(t=>(t?t.map_id:"")||"")),this.map_positions=this._positions.asObservable(),this.map_features=Object(Ze.a)([this._features,this._options]).pipe(Object(vn.a)(200),Object(mt.a)(([t,e])=>{let n=[];for(const s in t)switch(s){case"devices":e.show_zones&&e.show_devices&&(n=n.concat(t[s]));break;case"contacts":e.show_contacts&&(n=n.concat(t[s]));break;default:n=n.concat(t[s])}return n})),this.map_actions=this._actions.pipe(Object(vn.a)(200),Object(mt.a)(t=>Object.values(t).reduce((t,e)=>t.concat(e),[]))),this.map_labels=Object(Ze.a)([this._labels,this._options]).pipe(Object(vn.a)(200),Object(mt.a)(([t,e])=>{let n=[];for(const s in t)("zones"!==s||e.show_zones)&&(n=n.concat(t[s]));return n})),this.map_styles=Object(Ze.a)([this._styles,this._options]).pipe(Object(vn.a)(200),Object(mt.a)(([t,e])=>{const n=Object.keys(t).reduce((e,n)=>Object.assign(Object.assign({},e),t[n]),{});return e.show_zones||(n["#zones"]={display:"none"},n["#Zones"]={display:"none"}),n.text={display:"none"},n})),this.options=this._options.asObservable(),this.init()}get positions(){return this._positions.getValue()}get active_level(){return this._level.getValue()}init(){return Object(I.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(S.a)(t=>t)).toPromise(),this._org.active_building.pipe(Object(Pn.a)(t=>!!t)).subscribe(t=>{const e=this._level.getValue(),n=this._org.levelsForBuilding(t);!n.find(t=>(null==e?void 0:e.id)===t.id)&&n.length&&this.setLevel(n[0].id),this.setOptions({show_devices:!1!==this._settings.get("app.explore.display_devices")})})})}setOptions(t){this._options.next(Object.assign(Object.assign({},this._options.getValue()),t))}setLevel(t){const e=this._org.levelWithID([t]);e&&this._level.next(e)}setStyles(t,e){const n=this._styles.getValue();n[t]=e,this._styles.next(n)}setFeatures(t,e){const n=this._features.getValue();n[t]=e,this._features.next(n)}setActions(t,e){const n=this._actions.getValue();n[t]=e,this._actions.next(n)}setLabels(t,e){const n=this._labels.getValue();n[t]=e,this._labels.next(n)}setPositions(t,e){this._positions.next({zoom:t,center:e})}}return t.\u0275fac=function(e){return new(e||t)(i.ec(tn),i.ec(cs),i.ec(et))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var ls=n("4bjS"),ds=n("XQXX");n("5wMr");const us=t=>{var e;return(null===(e=t.parent)||void 0===e?void 0:e.get("date"))&&Object(Xe.a)(new Date,Object(Se.a)(t.parent.get("date").value,t.value))?{duration:!0}:null};Object(Ge.a)(Object(ls.a)(Object(ds.a)(new Date,6),0),{days:-1});const bs="/api/staff/v1/events";function hs(t,e){if(1&t&&(i.Xb(0,"div",10),i.Xb(1,"span"),i.Mc(2,"Capacity: "),i.Wb(),i.Mc(3),i.Wb()),2&t){const t=i.mc(2);i.Fb(3),i.Pc("",t.space.capacity," ",1===t.space.capacity?"person":"people"," ")}}function ps(t,e){if(1&t&&(i.Xb(0,"div",11),i.Mc(1),i.Wb()),2&t){const t=i.mc(2);i.Fb(1),i.Oc(" ",t.available_until," ")}}function ms(t,e){if(1&t&&(i.Xb(0,"li",15),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.Fb(1),i.Oc(" ",t," ")}}function fs(t,e){if(1&t&&(i.Xb(0,"div",12),i.Xb(1,"h4",4),i.Mc(2,"Room Features"),i.Wb(),i.Xb(3,"ul",13),i.Kc(4,ms,2,1,"li",14),i.Wb(),i.Wb()),2&t){const t=i.mc(2);i.Fb(4),i.tc("ngForOf",t.space.features)}}function gs(t,e){if(1&t&&(i.Xb(0,"div",1),i.Sb(1,"div",2),i.Xb(2,"div",3),i.Xb(3,"h4",4),i.Mc(4),i.Wb(),i.Kc(5,hs,4,2,"div",5),i.Xb(6,"div",6),i.Xb(7,"div",7),i.Mc(8),i.Wb(),i.Kc(9,ps,2,1,"div",8),i.Wb(),i.Kc(10,fs,5,1,"div",9),i.Wb(),i.Wb()),2&t){const t=i.mc();i.Hb("absolute rounded bg-white p-4 top-0 left-0 shadow "+t.x_pos+" "+t.y_pos),i.tc("id",t.space.id),i.Fb(4),i.Nc(t.space.display_name||t.space.name),i.Fb(1),i.tc("ngIf",t.space.capacity>=0),i.Fb(2),i.Hb("capitalize rounded p-1 px-2 text-light "+t.status),i.Fb(1),i.Oc(" ",t.status," "),i.Fb(1),i.tc("ngIf","not-bookable"!==t.status),i.Fb(1),i.tc("ngIf",(null==t.space.features?null:t.space.features.length)>0)}}let _s=(()=>{class t{constructor(t,e){this._details=t,this._element=e,this.space=this._details.space,this.events=this._details.events,this.status=this._details.status}ngOnInit(t=0){t>10||setTimeout(()=>{var e;const n=null===(e=this._element.nativeElement.parentElement)||void 0===e?void 0:e.parentElement;if(!n)return this.ngOnInit(++t);const s=parseInt(n.style.top,10)/100,i=parseInt(n.style.left,10)/100;this.y_pos=s>=.5?"bottom":"top",this.x_pos=i>=.5?"right":"left"},200)}get available_until(){return""}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(Ut),i.Rb(i.m))},t.\u0275cmp=i.Lb({type:t,selectors:[["explore-space-info"]],decls:1,vars:1,consts:[["name","space-info",3,"id","class",4,"ngIf"],["name","space-info",3,"id"],[1,"arrow"],[1,"details"],[1,"m-0","mb-2"],["capacity","","class","text-sm",4,"ngIf"],[1,"flex","flex-wrap","my-2","text-sm"],["status",""],["available-until","",4,"ngIf"],["features","",4,"ngIf"],["capacity","",1,"text-sm"],["available-until",""],["features",""],[1,"pl-2"],["class","text-sm",4,"ngFor","ngForOf"],[1,"text-sm"]],template:function(t,e){1&t&&i.Kc(0,gs,11,10,"div",0),2&t&&i.tc("ngIf",e.space)},directives:[p.m,p.l],styles:["[_nghost-%COMP%] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                pointer-events: none;\n                z-index: 1;\n            }\n\n            [name='space-info'][_ngcontent-%COMP%] {\n                width: 16rem;\n            }\n\n            [status][_ngcontent-%COMP%] {\n                background-color: #43a047;\n                font-weight: 500;\n\n                &.busy {\n                    background-color: #e53935;\n                }\n\n                &.pending {\n                    background-color: #ffb300;\n                }\n\n                &.not-bookable {\n                    background-color: #757575;\n                }\n            }"]}),t})();function vs(t,e){1&t&&(i.Xb(0,"button",4),i.Xb(1,"app-icon"),i.Mc(2,"close"),i.Wb(),i.Wb())}function ys(t,e){if(1&t&&(i.Xb(0,"div",9),i.Xb(1,"label"),i.Mc(2,"Date:"),i.Wb(),i.Xb(3,"div",16),i.Mc(4),i.nc(5,"date"),i.Wb(),i.Wb()),2&t){const t=i.mc(3);i.Fb(4),i.Oc(" ",i.pc(5,1,null==t.form.controls.date?null:t.form.controls.date.value,"medium")," ")}}function Os(t,e){1&t&&(i.Xb(0,"div",9),i.Xb(1,"label"),i.Mc(2,"Duration:"),i.Wb(),i.Sb(3,"a-duration-field",17),i.Wb())}function ws(t,e){if(1&t&&(i.Xb(0,"main",8),i.Xb(1,"div",9),i.Xb(2,"label",10),i.Mc(3,"Title"),i.Xb(4,"span"),i.Mc(5,"*"),i.Wb(),i.Mc(6,":"),i.Wb(),i.Xb(7,"mat-form-field",11),i.Sb(8,"input",12),i.Xb(9,"mat-error"),i.Mc(10,"Booking title is required"),i.Wb(),i.Wb(),i.Wb(),i.Xb(11,"div",9),i.Xb(12,"label"),i.Mc(13,"Space:"),i.Wb(),i.Xb(14,"div",13),i.Mc(15),i.Wb(),i.Wb(),i.Xb(16,"div",14),i.Kc(17,ys,6,4,"div",15),i.Kc(18,Os,4,0,"div",15),i.Wb(),i.Wb()),2&t){const t=i.mc(2);i.tc("formGroup",t.form),i.Fb(15),i.Oc(" ",(null==t.form.controls.resources||null==t.form.controls.resources.value[0]?null:t.form.controls.resources.value[0].display_name)||(null==t.form.controls.resources||null==t.form.controls.resources.value[0]?null:t.form.controls.resources.value[0].name)," "),i.Fb(2),i.tc("ngIf",t.form.controls.date),i.Fb(1),i.tc("ngIf",t.form.controls.duration)}}function ks(t,e){if(1&t){const t=i.Yb();i.Vb(0),i.Kc(1,ws,19,4,"main",5),i.Xb(2,"footer",6),i.Xb(3,"button",7),i.ic("click",function(){return i.Bc(t),i.mc().save()}),i.Mc(4,"Save"),i.Wb(),i.Wb(),i.Ub()}if(2&t){const t=i.mc();i.Fb(1),i.tc("ngIf",t.form)}}function xs(t,e){if(1&t&&(i.Xb(0,"div",18),i.Sb(1,"mat-spinner",19),i.Xb(2,"p"),i.Mc(3),i.Wb(),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.tc("diameter",48),i.Fb(2),i.Nc(t.loading)}}let js=(()=>{class t{constructor(t,e){this._data=t,this._dialog_ref=e,this.loading=""}ngOnInit(){this.booking=new hn({attendees:[Object.assign(Object.assign({},this._data.space||{}),{resource:!0})]}),this.form=function(t){const e=new o.f({id:new o.d(t.id),host:new o.d(t.host||"",[o.q.required]),organiser:new o.d(t.organiser||{},[o.q.required]),creator:new o.d(t.creator,[o.q.required]),calendar:new o.d(t.calendar),attendees:new o.d(t.attendees||[]),resources:new o.d(t.resources||[]),title:new o.d(t.title,[o.q.required]),body:new o.d(t.body),private:new o.d(t.private),date:new o.d(t.date,[o.q.required]),duration:new o.d(t.duration,[us]),all_day:new o.d(t.all_day),recurring:new o.d(t.recurring),recurrence:new o.d(t.recurrence),recurring_master_id:new o.d(t.recurring_master_id),master:new o.d(t.master),attachments:new o.d(t.attachments),catering:new o.d(t.extension_data.catering||[]),visitor_type:new o.d(t.ext("visitor_type")),location:new o.d(t.location),needs_space:new o.d(!0),needs_parking:new o.d(t.ext("needs_parking")||!1),system:new o.d(t.system)});return e.controls.organiser.valueChanges.subscribe(t=>e.controls.host.setValue(null==t?void 0:t.email)),t.id&&(e.controls.host.disable(),e.controls.organiser.disable()),"started"===t.state&&e.controls.date.disable(),e}(this.booking)}save(){var t;return Object(I.a)(this,void 0,void 0,function*(){this.form.markAllAsTouched();const e=t=>{this.loading="",dt(t),this._dialog_ref.disableClose=!1};if(!this.form.valid){const t=[];for(const e in this.form.controls)this.form.controls[e].invalid&&t.push(e);throw e(`Some form fields are not valid: [${t.join(", ")}]`)}var n,s;if(this._dialog_ref.disableClose=!0,this.loading="Checking space availability...",(yield(n={system_ids:null===(t=this.form.controls.resources.value)||void 0===t?void 0:t.map(t=>t.id).join(","),period_start:Math.floor(this.form.value.date/1e3),period_end:Math.floor(this.form.value.date/1e3)+60*this.form.value.duration},function(t){const e=st(t);return Object(W.e)(`${qn}/availability${e?"?"+e:""}`).pipe(Object(mt.a)(t=>t.map(t=>new An(t))))}(n).pipe(Vn(void 0))).toPromise().catch(t=>{throw e("Space is unavailble for the selected time and duration"),t})).length<=0)return e("Space is unavailble for the selected time and duration");this.loading="Creating booking...",yield(s=new hn(this.form.value),s.id?function(t,e,n={},s="patch"){const i=st(n);return("patch"===s?W.k:W.m)(`${bs}/${encodeURIComponent(t)}${i?"?"+i:""}`,e).pipe(Object(mt.a)(t=>new hn(t)))}(s.id,s,void 0):function(t){return Object(W.l)(`${bs}`,t).pipe(Object(mt.a)(t=>new hn(t)))}(s)).toPromise().catch(t=>{throw e("Error creating booking."),t}),lt(`Successfully created booking in ${this._data.space.display_name||this._data.space.name}`),this._dialog_ref.close()})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(d.a),i.Rb(d.e))},t.\u0275cmp=i.Lb({type:t,selectors:[["explore-booking-modal"]],decls:8,vars:3,consts:[[1,"flex-1"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],[4,"ngIf","ngIfElse"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],["class","p-4",3,"formGroup",4,"ngIf"],[1,"flex","justify-center","p-2","border-t","border-gray-200"],["mat-button","",3,"click"],[1,"p-4",3,"formGroup"],[1,"flex","flex-col"],["for","title"],["appearance","outline"],["matInput","","name","title","formControlName","title","placeholder","Booking Title"],["name","space",1,"sm:mt-4","mb-4"],[1,"flex","sm:space-x-4","flex-wrap"],["class","flex flex-col",4,"ngIf"],[1,"sm:mt-4","mb-4"],["formControlName","duration"],["load","",1,"h-64","flex","flex-col","items-center","justify-center"],[1,"m-4",3,"diameter"]],template:function(t,e){if(1&t&&(i.Xb(0,"header"),i.Xb(1,"h2"),i.Mc(2,"New Booking"),i.Wb(),i.Sb(3,"div",0),i.Kc(4,vs,3,0,"button",1),i.Wb(),i.Kc(5,ks,5,1,"ng-container",2),i.Kc(6,xs,4,2,"ng-template",null,3,i.Lc)),2&t){const t=i.xc(7);i.Fb(4),i.tc("ngIf",!e.loading),i.Fb(1),i.tc("ngIf",!e.loading)("ngIfElse",t)}},directives:[p.m,m.b,d.c,Ft,o.m,o.g,g.c,O.b,o.c,o.l,o.e,g.b,Me,u.b],pipes:[p.e],styles:["header[_ngcontent-%COMP%] {\n                max-width: calc(100vw + 100%);\n            }\n\n            [load][_ngcontent-%COMP%] {\n                width: 32rem;\n                max-width: calc(100vw - 2rem);\n            }"]}),t})();const Ms={free:"#43a047",pending:"#ffb300",reserved:"#e65100",busy:"#e53935","not-bookable":"#757575",unknown:"#757575"};let Ws=(()=>{class t extends F{constructor(t,e,n){super(),this._state=t,this._settings=e,this._dialog=n,this._bookings={},this._statuses={},this._bind=this._state.spaces.pipe(Object(mt.a)(t=>{if(this.unsubWith("b-"),this.unsubWith("s-"),this._statuses={},null==t?void 0:t.length){for(const e of t){const n=Object(W.f)(e.id,"Bookings");let s=n.binding("bookings");this.subscription(`b-${e.id}`,s.listen().subscribe(n=>this.handleBookingsChange(t,e,n))),this.subscription(`b-bind-${e.id}`,s.bind()),s=n.binding("status"),this.subscription(`s-${e.id}`,s.listen().subscribe(n=>this.handleStatusChange(t,e,n))),this.subscription(`s-bind-${e.id}`,s.bind())}this.updateActions(t),this.updateHoverElements(t)}})),this.subscription("spaces",this._bind.subscribe())}bookSpace(t){if("busy"===this._statuses[t.id]||!t.bookable)return dt(`${t.display_name||t.name} is unavailable at the current time`);this._dialog.open(js,{data:{space:t}})}handleBookingsChange(t,e,n){n&&(this._bookings[e.id]=n.map(t=>new hn(t)),this.timeout("update_hover_els",()=>this.updateHoverElements(t),100))}handleStatusChange(t,e,n){this._statuses[e.id]=e.bookable?n||"free":"not-bookable",this.timeout("update_statuses",()=>{this.clearTimeout("update_hover_els"),this.updateStatus(t),this.updateHoverElements(t)},100)}updateStatus(t){const e={},n=this._settings.get("app.explore.colors")||{};for(const s of t){const t=this._statuses[s.id]||"not-bookable";e[`#${s.map_id}`]={fill:n[`space-${t}`]||n[`${t}`]||Ms[`${t}`],opacity:.6}}this._state.setStyles("spaces",e)}updateHoverElements(t){const e=[];for(const n of t)e.push({location:n.map_id,hover:!0,content:_s,data:{space:n,events:this._bookings[n.id],status:this._statuses[n.id]}});this._state.setFeatures("spaces",e)}updateActions(t){const e=[];for(const n of t)e.push({id:n.map_id,action:"click",callback:()=>this.bookSpace(n)}),e.push({id:n.map_id,action:"touchend",callback:()=>this.bookSpace(n)});this._state.setActions("spaces",e)}}return t.\u0275fac=function(e){return new(e||t)(i.ec(rs),i.ec(et),i.ec(d.b))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac}),t})(),Cs=(()=>{class t extends F{constructor(t,e,n){super(),this._state=t,this._org=e,this._settings=n,this._statuses={},this._labels={},this._location={},this._capacity={},this._bind=this._state.level.pipe(Object(mt.a)(t=>{if(!t)return;this._statuses={};const e=this._org.buildings.find(e=>e.id===t.parent_id);if(!e)return;const n=e.bindings.area_management||this._org.organisation.bindings.area_management;if(!n)return;const s=Object(W.f)(n,"AreaManagement").binding(`${t.id}:areas`);console.log("Bind:",s),this.subscription("zones",s.listen().subscribe(t=>this.parseData(t))),this.subscription("binding",s.bind())})),this.init()}init(){var t,e,n;return Object(I.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(S.a)(t=>t)).toPromise();const s=yield Promise.all(this._org.levels.map(t=>Object(W.t)(t.id,{name:"map_regions"}).toPromise()));for(const i of s){const s=null===(t=null==i?void 0:i.details)||void 0===t?void 0:t.areas;if(s)for(const t of s)this._capacity[t.id]=(null===(e=t.properties)||void 0===e?void 0:e.capacity)||100,this._location[t.id]=(null===(n=t.properties)||void 0===n?void 0:n.label_location)||{x:.5,y:.5}}this.subscription("bind",this._bind.subscribe())})}parseData(t){const e=(null==t?void 0:t.value)||[],n=[];for(const s of e){const t=s.count/(this._capacity[s.area_id]||100);this._statuses[s.area_id]=t<.4?"free":t<.75?"pending":"busy",this._labels[s.area_id]={location:this._location[s.area_id],content:`${s.count} ${1===s.count?"Device":"Devices"}`},n.push(this._labels[s.area_id])}this._state.setLabels("zones",n),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},e=this._settings.get("app.explore.colors")||{};for(const n in this._statuses)this._statuses[n]&&(t[`#${n}`]={fill:e[`zone-${this._statuses[n]}`]||e[`${this._statuses[n]}`]||Ms[`${this._statuses[n]}`],opacity:.6});this._state.setStyles("zones",t)}}return t.\u0275fac=function(e){return new(e||t)(i.ec(rs),i.ec(tn),i.ec(et))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac}),t})();var Xs=n("zQhy");function Fs(t,e){1&t&&(i.Xb(0,"button",4),i.Xb(1,"i",5),i.Mc(2,"close"),i.Wb(),i.Wb())}function Is(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div",14),i.Xb(1,"label"),i.Mc(2,"Host"),i.Wb(),i.Xb(3,"a-user-search-field",15),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc(2).host=e}),i.Wb(),i.Wb()}if(2&t){const t=i.mc(2);i.Fb(3),i.tc("ngModel",t.host)}}function Ss(t,e){if(1&t&&(i.Xb(0,"div"),i.Mc(1),i.nc(2,"date"),i.Wb()),2&t){const t=i.mc(2);i.Fb(1),i.Oc(" ",i.pc(2,1,t.date,"mediumDate")," ")}}function $s(t,e){if(1&t){const t=i.Yb();i.Xb(0,"a-date-field",15),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc(2).date=e}),i.Wb()}if(2&t){const t=i.mc(2);i.tc("ngModel",t.date)}}function Ps(t,e){if(1&t&&(i.Xb(0,"div",16),i.Xb(1,"label"),i.Mc(2,"Reason"),i.Wb(),i.Xb(3,"div"),i.Mc(4),i.Wb(),i.Wb()),2&t){const t=i.mc(2);i.Fb(4),i.Nc(t.reason||"~No set reason~")}}function Es(t,e){if(1&t){const t=i.Yb();i.Vb(0),i.Xb(1,"main",6),i.Kc(2,Is,4,1,"div",7),i.Xb(3,"div",8),i.Xb(4,"label"),i.Mc(5,"Date"),i.Wb(),i.Kc(6,Ss,3,4,"div",9),i.Kc(7,$s,1,1,"a-date-field",10),i.Wb(),i.Kc(8,Ps,5,1,"div",11),i.Xb(9,"p"),i.Mc(10),i.Wb(),i.Wb(),i.Xb(11,"footer",12),i.Xb(12,"button",13),i.ic("click",function(){return i.Bc(t),i.mc().confirm()}),i.Mc(13,"Confirm"),i.Wb(),i.Wb(),i.Ub()}if(2&t){const t=i.mc();i.Fb(2),i.tc("ngIf",t.can_set_host),i.Fb(4),i.tc("ngIf",!t.can_set_date),i.Fb(1),i.tc("ngIf",t.can_set_date),i.Fb(1),i.tc("ngIf",!t.hide_reason),i.Fb(2),i.Qc(" Your desk",1===t.desks.length?"":"s"," will be ",t.desk_list," on ",(null==t.level?null:t.level.display_name)||(null==t.level?null:t.level.name)," ")}}function zs(t,e){if(1&t&&(i.Xb(0,"main",17),i.Sb(1,"mat-spinner",18),i.Xb(2,"p"),i.Mc(3),i.Wb(),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.tc("diameter",48),i.Fb(2),i.Nc(t.loading)}}let Ks=(()=>{class t{constructor(t,e){this._data=t,this._settings=e,this.event=new i.p,this.desks=this._data.desks||[],this.date=this._data.date,this.host=this._data.host,this.can_set_date=this._data.can_set_date,this.reason=this._data.reason,this.level=this._data.level}get desk_list(){return this.desks.map(t=>t.name).join(", ")}get hide_reason(){return!!this._settings.get("app.desks.hide_reason")}get can_set_host(){return!!this._settings.get("app.desks.can_set_host")}confirm(){this.loading="Requesting desk booking...",this.event.emit({reason:"done"})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(d.a),i.Rb(et))},t.\u0275cmp=i.Lb({type:t,selectors:[["desk-flow-confirm-modal-component"]],outputs:{event:"event"},decls:8,vars:3,consts:[[1,"flex-1"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],[4,"ngIf","ngIfElse"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],[1,"material-icons"],[1,"p-4"],["host","","class","flex flex-col",4,"ngIf"],["date","",1,"mb-4"],[4,"ngIf"],[3,"ngModel","ngModelChange",4,"ngIf"],["reason","","class","mb-4",4,"ngIf"],[1,"flex","items-center","justify-center","p-2"],["mat-button","",3,"click"],["host","",1,"flex","flex-col"],[3,"ngModel","ngModelChange"],["reason","",1,"mb-4"],["load","",1,"flex","flex-col","p-12","items-center","justify-center"],[1,"mb-4",3,"diameter"]],template:function(t,e){if(1&t&&(i.Xb(0,"header"),i.Xb(1,"h2"),i.Mc(2,"Confirm Booking"),i.Wb(),i.Sb(3,"div",0),i.Kc(4,Fs,3,0,"button",1),i.Wb(),i.Kc(5,Es,14,7,"ng-container",2),i.Kc(6,zs,4,2,"ng-template",null,3,i.Lc)),2&t){const t=i.xc(7);i.Fb(4),i.tc("ngIf",!e.loading),i.Fb(1),i.tc("ngIf",!e.loading)("ngIfElse",t)}},directives:[p.m,m.b,d.c,Mn,o.l,o.o,we,u.b],pipes:[p.e],styles:["main[_ngcontent-%COMP%] {\n                width: 24rem;\n                max-width: calc(100vw - 4.5rem);\n            }"]}),t})();function Ds(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div",2),i.Xb(1,"h2",3),i.Mc(2,"COVID-19 Questionnaire"),i.Wb(),i.Xb(3,"main",4),i.Xb(4,"div",5),i.Xb(5,"label"),i.Mc(6," Have you travelled overseas within the last 14 days?"),i.Xb(7,"span"),i.Mc(8,"*"),i.Wb(),i.Wb(),i.Xb(9,"mat-radio-group",6),i.Xb(10,"mat-radio-button",7),i.Mc(11,"Yes"),i.Wb(),i.Xb(12,"mat-radio-button",7),i.Mc(13,"No"),i.Wb(),i.Wb(),i.Wb(),i.Xb(14,"div",5),i.Xb(15,"label"),i.Mc(16," Are you unwell or experiencing any cold or flu-like symptoms?"),i.Xb(17,"span"),i.Mc(18,"*"),i.Wb(),i.Wb(),i.Xb(19,"mat-radio-group",8),i.Xb(20,"mat-radio-button",7),i.Mc(21,"Yes"),i.Wb(),i.Xb(22,"mat-radio-button",7),i.Mc(23,"No"),i.Wb(),i.Wb(),i.Wb(),i.Xb(24,"div",9),i.Xb(25,"label"),i.Mc(26," Have you had contact with anyone with suspected COVID-19?"),i.Xb(27,"span"),i.Mc(28,"*"),i.Wb(),i.Wb(),i.Xb(29,"mat-radio-group",10),i.Xb(30,"mat-radio-button",7),i.Mc(31,"Yes"),i.Wb(),i.Xb(32,"mat-radio-button",7),i.Mc(33,"No"),i.Wb(),i.Wb(),i.Wb(),i.Wb(),i.Xb(34,"footer",11),i.Xb(35,"button",12),i.ic("click",function(){return i.Bc(t),i.mc().submit()}),i.Mc(36,"Submit"),i.Wb(),i.Wb(),i.Xb(37,"button",13),i.Xb(38,"i",14),i.Mc(39,"close"),i.Wb(),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.Fb(3),i.tc("formGroup",t.form),i.Fb(7),i.tc("value",!0),i.Fb(2),i.tc("value",!1),i.Fb(8),i.tc("value",!0),i.Fb(2),i.tc("value",!1),i.Fb(8),i.tc("value",!0),i.Fb(2),i.tc("value",!1)}}function Ls(t,e){1&t&&(i.Xb(0,"main",15),i.Xb(1,"p",16),i.Mc(2," Your request to work from the office has been rejected based on your response to the compulsory Covid-19 questions. Please feel free to submit a new request when circumstances change in a way that changes your answer to the questions. "),i.Wb(),i.Xb(3,"button",13),i.Xb(4,"app-icon"),i.Mc(5,"close"),i.Wb(),i.Wb(),i.Wb())}let Ts=(()=>{class t{constructor(){this.event=new i.p}ngOnInit(){this.form=new o.f({travelled:new o.d("",[o.q.required]),unwell:new o.d("",[o.q.required]),contact:new o.d("",[o.q.required])})}submit(){this.form.markAllAsTouched(),this.form.valid?Object.keys(this.form.value).find(t=>!0===this.form.value[t]||"true"===this.form.value[t])?this.failure=!0:this.event.emit({reason:"done"}):dt("All the questions must be answered")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["desk-question-modal"]],outputs:{event:"event"},decls:3,vars:2,consts:[["class","relative",4,"ngIf","ngIfElse"],["fail_state",""],[1,"relative"],[1,"p-4","text-xl"],[1,"p-4",3,"formGroup"],[1,"flex","flex-col","mb-4"],["formControlName","travelled",1,"space-x-2"],[3,"value"],["formControlName","unwell",1,"space-x-2"],[1,"flex","flex-col"],["formControlName","contact",1,"space-x-2"],[1,"flex","justify-center","items-center","p-2"],["mat-button","",3,"click"],["close","","mat-icon-button","","mat-dialog-close",""],[1,"material-icons"],["failure","",1,"pt-8","relative"],[1,"p-4"]],template:function(t,e){if(1&t&&(i.Kc(0,Ds,40,7,"div",0),i.Kc(1,Ls,6,0,"ng-template",null,1,i.Lc)),2&t){const t=i.xc(2);i.tc("ngIf",!e.failure)("ngIfElse",t)}},directives:[p.m,o.m,o.g,Xs.b,o.l,o.e,Xs.a,m.b,d.c],styles:["main[_ngcontent-%COMP%] {\n                width: 24rem;\n                max-width: calc(100vw - 4.5rem);\n            }\n\n            [close][_ngcontent-%COMP%] {\n                position: absolute;\n                top: 0.5rem;\n                right: 0.5rem;\n            }"]}),t})();var Rs=n("Da6A");class As{constructor(t={}){var e,n;this.id=t.id||"",this.asset_id=t.asset_id||"",this.zones=t.zones||[],this.booking_start=t.booking_start||Object(Ne.a)(t.date||Object(Ce.a)(Object(Se.a)(new Date,2),{nearestTo:5})),this.booking_end=t.booking_end||Object(Ne.a)(Object(Se.a)(this.booking_start,t.duration||60)),this.booking_type=t.booking_type||"",this.type=t.type||"booking",this.date=t.date||1e3*this.booking_start,this.duration=t.duration||Object(Ue.a)(1e3*this.booking_start,1e3*this.booking_end),this.timezone=t.timezone||Intl.DateTimeFormat().resolvedOptions().timeZone,this.user_email=t.user_email||"",this.user_id=t.user_id||"",this.user_name=t.user_name||"",this.title=t.title||"Desk booking",this.description=t.description||"",this.checked_in=!!t.checked_in,this.rejected=!!t.rejected,this.approved=!!t.approved,this.approver_id=t.approver_id||"",this.approver_email=t.approver_email||"",this.approver_name=t.approver_name||"",this.extension_data=t.extension_data||{},this.access=!!(null===(e=t.extension_data)||void 0===e?void 0:e.access),this.all_day=null===(n=t.all_day)||void 0===n||n,this.status=this.rejected?"declined":this.approved?"approved":"tentative"}toJSON(){const t=Object.assign({},this);return this.id||delete t.id,delete t.date,delete t.duration,t}get location(){return this.description}get is_today(){return Object(Q.a)(this.date,new Date)}get is_done(){const t=new Date,e=this.all_day?Object(Rs.a)(this.date,24):Object(Se.a)(this.date,this.duration);return Object(Xe.a)(t,e)}}var qs=n("+QaA");_e.extend(qs),_e().hour(6).minute(0).subtract(1,"d").startOf("m");const Vs="/api/staff/v1/bookings";function Bs(t){const e=st(t);return Object(W.e)(`${Vs}${e?"?"+e:""}`).pipe(Object(mt.a)(t=>t.map(t=>new As(t))))}let Ns=(()=>{class t{constructor(t,e){this._org=t,this._dialog=e,this.can_set_date=!0,this.error_on_host=!0}bookDesk({desks:t,host:e,reason:n,attendees:s,date:i}){var o;return Object(I.a)(this,void 0,void 0,function*(){if(this.error_on_host&&!e)return dt("You need to select a host to book a desk.");n=n||"";const a=this._org.levelWithID(t[0].zone instanceof Array?t[0].zone:[null===(o=t[0].zone)||void 0===o?void 0:o.id]);let c=this._dialog.open(Ts),r=yield Promise.race([c.componentInstance.event.pipe(Object(S.a)(t=>"done"===t.reason)).toPromise(),c.afterClosed().pipe(Object(mt.a)(t=>null)).toPromise()]);if(!r)return;if(c.close(),c=this._dialog.open(Ks,{data:{host:e,desks:t,date:i?new Date(i):new Date,reason:n,level:a,can_set_date:this.can_set_date}}),r=yield Promise.race([c.componentInstance.event.pipe(Object(S.a)(t=>"done"===t.reason)).toPromise(),c.afterClosed().pipe(Object(mt.a)(t=>null)).toPromise()]),!r)return;if(i=c.componentInstance.date||i,!(e=c.componentInstance.host||e))return c.close(),dt("You need to select a host to book a desk. ");c.componentInstance.loading="Checking for existing desk bookings...";const l=(yield Bs({type:"desk",period_start:Object(Ne.a)(Object(Fe.a)(i||new Date)),period_end:Object(Ne.a)(Object(Ie.a)(i||new Date))}).toPromise()).filter(t=>t.user_email.toLowerCase()===e.email.toLowerCase());if(null==l?void 0:l.length)return c.close(),dt("You currently already have a desk booked for the selected date.");c.componentInstance.loading="Booking desk...";const d=[e,...s||[]];return yield Promise.all([t.map((t,s)=>this.makeDeskBooking(t,e,i.valueOf()||(new Date).valueOf(),n,d[s]))]),lt("Successfully booked desk"),c.close(),!0})}makeDeskBooking(t,e,n,s,i=null){var o,a,c,r;return Object(I.a)(this,void 0,void 0,function*(){const l=`${null===(o=t.zone)||void 0===o?void 0:o.name}-${t.id}`,d=this._org.levelWithID(t.zone instanceof Array?t.zone:[null===(a=t.zone)||void 0===a?void 0:a.id]),u=(null===(c=t.zone)||void 0===c?void 0:c.id)?[null===(r=t.zone)||void 0===r?void 0:r.id,null==d?void 0:d.parent_id]:[null==d?void 0:d.parent_id];return(b={booking_start:Object(Ne.a)(Object(Fe.a)(n)),user_id:(null==i?void 0:i.id)||e.id,user_name:(null==i?void 0:i.name)||e.name,user_email:(null==i?void 0:i.email)||e.email,booking_end:Math.floor(Object(Ie.a)(n).valueOf()/1e3),asset_id:t.id,title:s,description:l,zones:u,booking_type:"desk",extension_data:{groups:t.groups,for_user:null==i?void 0:i.email}},b.id?function(t,e,n="patch"){return("patch"===n?W.k:W.m)(`${Vs}/${encodeURIComponent(t)}`,e).pipe(Object(mt.a)(t=>new As(t)))}(b.id,b):function(t){return Object(W.l)(`${Vs}`,t).pipe(Object(mt.a)(t=>new As(t)))}(b)).toPromise();var b})}}return t.\u0275fac=function(e){return new(e||t)(i.ec(tn),i.ec(d.b))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const Us=["dot"],Ys=["explore-device-info",""];function Gs(t,e){if(1&t&&(i.Xb(0,"p",12),i.Xb(1,"label"),i.Mc(2,"Manufacturer:"),i.Wb(),i.Mc(3),i.Wb()),2&t){const t=i.mc(2);i.Fb(3),i.Oc(" ",t.manufacturer," ")}}function Hs(t,e){if(1&t&&(i.Xb(0,"p",13),i.Xb(1,"label"),i.Mc(2,"OS:"),i.Wb(),i.Mc(3),i.Wb()),2&t){const t=i.mc(2);i.Fb(3),i.Oc(" ",t.os,"")}}function Js(t,e){if(1&t&&(i.Xb(0,"p",14),i.Xb(1,"label"),i.Mc(2,"SSID:"),i.Wb(),i.Mc(3),i.Wb()),2&t){const t=i.mc(2);i.Fb(3),i.Oc(" ",t.ssid,"")}}function Qs(t,e){if(1&t&&(i.Xb(0,"p",15),i.Xb(1,"label"),i.Mc(2,"Username:"),i.Wb(),i.Mc(3),i.Wb()),2&t){const t=i.mc(2);i.Fb(3),i.Oc(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function Zs(t,e){if(1&t&&(i.Xb(0,"p",16),i.Xb(1,"label"),i.Mc(2,"Type:"),i.Wb(),i.Mc(3),i.Wb()),2&t){const t=i.mc(2);i.Fb(3),i.Oc(" ",t.user.type," ")}}function ti(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div",4),i.ic("mouseleave",function(){return i.Bc(t),i.mc().close()}),i.Sb(1,"div",5),i.Xb(2,"div",6),i.Xb(3,"p"),i.Xb(4,"label"),i.Mc(5,"MAC:"),i.Wb(),i.Mc(6),i.Wb(),i.Xb(7,"p"),i.Xb(8,"label"),i.Mc(9,"Accuracy:"),i.Wb(),i.Mc(10),i.Wb(),i.Xb(11,"p"),i.Xb(12,"label"),i.Mc(13,"Last Seen:"),i.Wb(),i.Mc(14),i.Wb(),i.Kc(15,Gs,4,1,"p",7),i.Kc(16,Hs,4,1,"p",8),i.Kc(17,Js,4,1,"p",9),i.Kc(18,Qs,4,1,"p",10),i.Kc(19,Zs,4,1,"p",11),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.Fb(6),i.Oc(" ",t.mac,""),i.Fb(4),i.Oc(" ",t.variance,"m"),i.Fb(4),i.Oc(" ",t.last_seen,""),i.Fb(1),i.tc("ngIf",t.manufacturer),i.Fb(1),i.tc("ngIf",t.os),i.Fb(1),i.tc("ngIf",t.ssid),i.Fb(1),i.tc("ngIf",t.username),i.Fb(1),i.tc("ngIf",t.user)}}let ei=(()=>{class t{constructor(t,e,n){var s;this._details=t,this._element=e,this._overlay=n,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=null===(s=this._details.variance)||void 0===s?void 0:s.toFixed(2),this.diameter=100*this._details.variance,this.bg_color=this._details.bg_color||this.distance_color,this.overlay_ref=null,this.onEnter=()=>this.loadUser(),this.onLeave=()=>this.close(),this.onClick=()=>this.loadUser(),this.onTouch=()=>this.loadUser()}get last_seen(){return Object(Gt.a)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get distance(){return Math.abs(Object(Ue.a)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}ngOnInit(t=0){t>10||setTimeout(()=>{var e;const n=null===(e=this._element.nativeElement.parentElement)||void 0===e?void 0:e.parentElement;if(!n)return this.ngOnInit(++t);const s=parseInt(n.style.top,10)/100,i=parseInt(n.style.left,10)/100;this.y_pos=s>=.5?"bottom":"top",this.x_pos=i>=.5?"end":"start"},200)}loadUser(){return Object(I.a)(this,void 0,void 0,function*(){if(this.open(),this.username)return;const t=Object(W.f)(this._details.system,"LocationServices");if(t){this.username="Loading...";const e=yield t.execute("check_ownership_of",[this.mac]).catch(t=>null);this.username=e&&e.assigned_to?e.assigned_to:""}})}open(){this.overlay_ref&&this.close(),this._portal&&(this.overlay_ref=this._overlay.create({positionStrategy:this._overlay.position().flexibleConnectedTo(this._dot).withPositions([{originX:"start"===this.x_pos?"end":"start",originY:"top"===this.y_pos?"bottom":"top",overlayX:this.x_pos||"end",overlayY:this.y_pos||"bottom"}])}),this.overlay_ref.attach(this._portal),console.log("Open"))}close(){this.overlay_ref&&(this.overlay_ref.dispose(),this.overlay_ref=null)}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(Ut),i.Rb(i.m),i.Rb(ie.c))},t.\u0275cmp=i.Lb({type:t,selectors:[["","explore-device-info",""]],viewQuery:function(t,e){if(1&t&&(i.Rc(M.b,1),i.Rc(Us,1)),2&t){let t;i.wc(t=i.jc())&&(e._portal=t.first),i.wc(t=i.jc())&&(e._dot=t.first)}},hostBindings:function(t,e){1&t&&i.ic("mouseenter",function(){return e.onEnter()})("mouseleave",function(){return e.onLeave()})("click",function(){return e.onClick()})("touchend",function(){return e.onTouch()})},attrs:Ys,decls:4,vars:4,consts:[["name","radius",1,"radius","absolute","center","bg-blue-600","bg-opacity-25","border-4","border-dashed","border-blue-600","rounded-full",3,"mouseenter"],["name","dot",1,"h-2","w-2","absolute","center","rounded-full","pointer-events-auto","shadow"],["dot",""],["cdk-portal",""],["name","device-info",1,"w-64","rounded","bg-white","p-4","top-0","left-0","shadow","pointer-events-none",3,"mouseleave"],[1,"arrow"],[1,"details"],["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],["type",""],["os",""],["ssid",""],["username",""],["user",""]],template:function(t,e){1&t&&(i.Xb(0,"div",0),i.ic("mouseenter",function(){return e.loadUser()}),i.Wb(),i.Sb(1,"div",1,2),i.Kc(3,ti,20,8,"ng-template",3)),2&t&&(i.Gc("height: "+e.diameter+"%; width: "+e.diameter+"%;"),i.Fb(1),i.Hc("background-color",e.bg_color))},directives:[M.h,p.m],styles:["[_nghost-%COMP%] {\n                pointer-events: auto;\n            }\n\n            [_nghost-%COMP%]    > [name='dot'][_ngcontent-%COMP%] {\n                background-color: #616161;\n            }\n\n            [_nghost-%COMP%]:hover    > [name='radius'][_ngcontent-%COMP%] {\n                opacity: 1;\n            }\n\n            [name='radius'][_ngcontent-%COMP%] {\n                opacity: 0;\n                transition: opacity 200ms;\n                pointer-events: none;\n            }"]}),t})();function ni(t,e){if(1&t&&(i.Xb(0,"p",6),i.Mc(1),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.Nc(t.user)}}function si(t,e){if(1&t&&(i.Xb(0,"p",7),i.Mc(1),i.nc(2,"date"),i.nc(3,"date"),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.Pc(" ",i.pc(2,2,t.start,"shortTime")," \u2013 ",i.pc(3,5,t.end,"shortTime")," ")}}let ii=(()=>{class t{constructor(t,e){this._details=t,this._element=e,this.map_id=this._details.map_id,this.user=this._details.user,this.start=this._details.start,this.end=this._details.end}ngOnInit(t=0){t>10||setTimeout(()=>{var e;const n=null===(e=this._element.nativeElement.parentElement)||void 0===e?void 0:e.parentElement;if(!n)return this.ngOnInit(++t);const s=parseInt(n.style.top,10)/100,i=parseInt(n.style.left,10)/100;this.y_pos=s>=.5?"bottom":"top",this.x_pos=i>=.5?"right":"left"},200)}get available_until(){return""}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(Ut),i.Rb(i.m))},t.\u0275cmp=i.Lb({type:t,selectors:[["explore-desk-info"]],decls:7,vars:6,consts:[["name","space-info",3,"id"],[1,"arrow"],[1,"details"],["map-id","",1,"m-0","font-medium"],["user","","class","mt-2 text-sm",4,"ngIf"],["start","","class","mt-1 text-sm",4,"ngIf"],["user","",1,"mt-2","text-sm"],["start","",1,"mt-1","text-sm"]],template:function(t,e){1&t&&(i.Xb(0,"div",0),i.Sb(1,"div",1),i.Xb(2,"div",2),i.Xb(3,"h4",3),i.Mc(4),i.Wb(),i.Kc(5,ni,2,1,"p",4),i.Kc(6,si,4,8,"p",5),i.Wb(),i.Wb()),2&t&&(i.Hb("absolute rounded bg-white p-4 top-0 left-0 shadow "+e.x_pos+" "+e.y_pos),i.tc("id",e.map_id),i.Fb(4),i.Nc(e.map_id),i.Fb(1),i.tc("ngIf",e.user),i.Fb(1),i.tc("ngIf",e.start))},directives:[p.m],pipes:[p.e],styles:["[_nghost-%COMP%] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                pointer-events: none;\n                z-index: 1;\n            }\n\n            [name='space-info'][_ngcontent-%COMP%] {\n                width: 16rem;\n            }\n\n            [name='status'][_ngcontent-%COMP%] {\n                background-color: #43a047;\n                font-weight: 500;\n            }\n\n            [name='status'].busy[_ngcontent-%COMP%] {\n                background-color: #e53935;\n            }\n\n            [name='status'].pending[_ngcontent-%COMP%] {\n                background-color: #ffb300;\n            }\n\n            [name='status'].not-bookable[_ngcontent-%COMP%] {\n                background-color: #757575;\n            }"]}),t})(),oi=(()=>{class t extends F{constructor(t,e,n,s){super(),this._state=t,this._org=e,this._settings=n,this._desks_service=s,this._in_use=new C.a([]),this._options=new C.a({}),this._desks=new C.a([]),this._reserved=new C.a([]),this._statuses={},this._poll=new C.a(0),this._desk_bookings=Object(Ze.a)([this._state.level,this._poll]).pipe(Object(On.a)(([t])=>Bs({period_start:Object(Ne.a)(Object(Fe.a)(new Date)),period_end:Object(Ne.a)(Object(Ie.a)(new Date)),type:"desk",zones:t.id}))),this.desk_list=this._state.level.pipe(Object(On.a)(t=>Object(W.t)(t.id,{name:"desks"}).pipe(Object(mt.a)(e=>(e.details instanceof Array?e.details:[]).map(e=>new en(Object.assign(Object.assign({},e),{zone:t})))))),Object(wn.a)(t=>[])),this._bind=this._state.level.pipe(Object(mt.a)(t=>{var e,n;if(this._statuses={},this.unsubWith("lvl"),!t)return;const s=this._org.buildings.find(e=>e.id===t.parent_id);if(!s)return;const i=(null===(e=s.bindings)||void 0===e?void 0:e.area_management)||(null===(n=this._org.organisation.bindings)||void 0===n?void 0:n.area_management);if(!i)return;let o=Object(W.f)(i,"AreaManagement").binding(t.id);this.subscription("lvl-in_use",o.listen().subscribe(t=>this.processBindingChange(t,i))),this.subscription("lvl-in_use_bind",o.bind()),o=Object(W.f)(i,"AreaManagement").binding(`${t.id}:desk_ids`),this.subscription("lvl-desks_list",o.listen().subscribe(t=>this._desks.next(t||[]))),this.subscription("lvl-desk_list_bind",o.bind())})),this._state_change=Object(Ze.a)([this.desk_list,this._in_use,this._reserved,this._options]).pipe(Object(mt.a)(([t,e,n])=>{this._statuses={};for(const{id:s,bookable:i}of t){const t=e.some(t=>s===t),o=n.some(t=>s===t);this._statuses[s]=i?t?o?"reserved":"busy":"free":"not-bookable"}this.processDesks(t)})),this.init()}init(){return Object(I.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(S.a)(t=>t)).toPromise(),this.setOptions({enable_booking:!1!==this._settings.get("app.desks.enabled")}),this.subscription("bind",this._bind.subscribe()),this.subscription("changes",this._state_change.subscribe()),this.subscription("desks",this.desk_list.subscribe(t=>this.processDesks(t)))})}startPolling(t=3e4){this.subscription("desks_in_use_bookings",this._desk_bookings.subscribe(t=>this._in_use.next(t.map(t=>t.asset_id)))),this.interval("poll",()=>this._poll.next((new Date).valueOf()),t)}stopPolling(){this.clearInterval("poll")}setOptions(t){this._options.next(Object.assign(Object.assign({},this._options.getValue()),t))}processBindingChange({value:t},e){const n=(t||[]).filter(t=>!["desk","booking"].includes(t.location)),s=(t||[]).filter(t=>"desk"===t.location||"booking"===t.location&&"desk"===t.type);this._in_use.next(s.map(t=>t.map_id||t.asset_id)),this._reserved.next(s.filter(t=>!t.at_location).map(t=>t.map_id||t.asset_id)),this.processDevices(n,e),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},e=this._settings.get("app.explore.colors")||{};for(const n in this._statuses)this._statuses[n]&&(t[`#${n}`]={fill:e[`desk-${this._statuses[n]}`]||e[`${this._statuses[n]}`]||Ms[`${this._statuses[n]}`],opacity:.6});this._state.setStyles("desks",t)}processDevices(t,e){var n,s;const i=[];for(const o of t){const t=o.x/o.map_width,a=o.y/o.map_height;i.push({location:{x:(null===(n=o.coordinates_from)||void 0===n?void 0:n.includes("right"))?1-t:t,y:(null===(s=o.coordinates_from)||void 0===s?void 0:s.includes("bottom"))?1-a:a},content:ei,data:Object.assign(Object.assign({},o),{system:e})})}this._state.setFeatures("devices",i)}processDesks(t){const e=[],n=[],s=this._options.getValue();for(const i of t){e.push({location:i.id,content:ii,hover:!0,data:{map_id:i.name,status:this._statuses[i.map_id]}});const t=()=>this._desks_service.bookDesk({desks:[i],host:s.host,date:s.date});n.push({id:i.id,action:"click",callback:t}),n.push({id:i.id,action:"touchend",callback:t})}this._state.setActions("desks",this._options.getValue().enable_booking?n:[]),this._state.setFeatures("desks",e),this.timeout("update",()=>this.updateStatus(),100)}}return t.\u0275fac=function(e){return new(e||t)(i.ec(rs),i.ec(tn),i.ec(et),i.ec(Ns))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac}),t})(),ai=(()=>{class t{constructor(t){this._state=t,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(rs))},t.\u0275cmp=i.Lb({type:t,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:[["z-in","","mat-icon-button","",1,"bg-white",3,"click"],["z-out","","mat-icon-button","",1,"bg-white",3,"click"],["reset","","mat-icon-button","",1,"bg-white",3,"click"]],template:function(t,e){1&t&&(i.Xb(0,"button",0),i.ic("click",function(){return e.zoomIn()}),i.Xb(1,"app-icon"),i.Mc(2,"add"),i.Wb(),i.Wb(),i.Xb(3,"button",1),i.ic("click",function(){return e.zoomOut()}),i.Xb(4,"app-icon"),i.Mc(5,"remove"),i.Wb(),i.Wb(),i.Xb(6,"button",2),i.ic("click",function(){return e.reset()}),i.Xb(7,"app-icon"),i.Mc(8,"autorenew"),i.Wb(),i.Wb())},directives:[m.b,Ft],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                padding: 0.5rem;\n            }\n\n            button[_ngcontent-%COMP%] {\n                border: 1px solid #ccc;\n                border-radius: 0;\n            }\n\n            button[_ngcontent-%COMP%]:first-child {\n                border-radius: 0.25rem 0.25rem 0 0;\n                border-bottom: none;\n            }\n\n            button[_ngcontent-%COMP%]:last-child {\n                border-radius: 0 0 0.25rem 0.25rem;\n                border-top: none;\n            }"]}),t})(),ci=(()=>{class t{constructor(t,e){this._spaces=t,this._org=e,this._emergency_contacts=new C.a([]),this._filter=new C.a(""),this._loading=new C.a(!1),this.emergency_contacts=this._emergency_contacts.asObservable(),this._user_search=this._filter.pipe(Object(vn.a)(400),Object(Rn.a)(()=>this._loading.next(!0)),Object(On.a)(t=>(null==t?void 0:t.length)>2?this.search_fn(t):Object(gn.a)([])),Object(wn.a)(()=>[])),this.search_results=Object(Ze.a)([this._spaces.list,this._user_search,this._emergency_contacts]).pipe(Object(vn.a)(1e3),Object(mt.a)(([t,e,n])=>{const s=this._filter.getValue().toLowerCase(),i=T([...t.filter(t=>t.email.toLowerCase().includes(s)||t.name.toLowerCase().includes(s)||t.display_name.toLowerCase().includes(s)).map(t=>({id:t.id,type:"space",name:t.display_name||t.name,description:`Capacity: ${t.capacity} `})),...n.map(t=>({id:t.email,type:t.type||"contact",name:t.name,description:t.email})).filter(t=>t.name.toLowerCase().includes(s)||t.description.toLowerCase().includes(s)||t.type.toLowerCase().includes(s)),...e.map(t=>({id:t.email,type:"user",name:t.name,description:t.email}))],"id");return i.sort((t,e)=>t.name.localeCompare(e.name)),i}),Object(Rn.a)(()=>this._loading.next(!1)),Object(Tn.a)(1)),this.loading=this._loading.asObservable(),this.search_fn=t=>mn(t),this._spaces.list.subscribe(),this.search_results.subscribe(),this.init()}init(){var t;return Object(I.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(S.a)(t=>t)).toPromise();const e=Object(W.f)(null===(t=this._org.organisation.bindings)||void 0===t?void 0:t.location_services,"LocationServices");if(e){const t=e.binding("emergency_contacts");t.listen().subscribe(t=>{const e=[];for(const n in t)for(const s of t[n])e.push(Object.assign(Object.assign({},s),{type:n}));this._emergency_contacts.next(e)}),t.bind()}})}setFilter(t){this._filter.next(t)}}return t.\u0275fac=function(e){return new(e||t)(i.ec(cs),i.ec(tn))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const ri=["input"];function li(t,e){1&t&&i.Sb(0,"mat-spinner",9),2&t&&i.tc("diameter",32)}function di(t,e){1&t&&(i.Xb(0,"mat-option",12),i.Mc(1," No matches found "),i.Wb())}function ui(t,e){if(1&t&&(i.Xb(0,"mat-option",13),i.Xb(1,"div",14),i.Xb(2,"div",15),i.Xb(3,"div",16),i.Mc(4),i.Wb(),i.Xb(5,"div",17),i.Mc(6),i.Wb(),i.Wb(),i.Xb(7,"div",18),i.Mc(8),i.Wb(),i.Wb(),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t),i.Fb(4),i.Nc(t.name),i.Fb(2),i.Nc(t.description),i.Fb(2),i.Oc(" ",t.type," ")}}function bi(t,e){if(1&t&&(i.Vb(0),i.Kc(1,di,2,0,"mat-option",10),i.nc(2,"async"),i.Kc(3,ui,9,4,"mat-option",11),i.nc(4,"slice"),i.nc(5,"async"),i.Ub()),2&t){const t=i.mc();let e=null;i.Fb(1),i.tc("ngIf",!(null!=(e=i.oc(2,2,t.results))&&e.length)),i.Fb(2),i.tc("ngForOf",i.qc(4,4,i.oc(5,8,t.results),0,5))}}let hi=(()=>{class t extends F{constructor(t,e,n,s){super(),this._el=t,this._search=e,this._router=n,this._route=s,this.show=!1,this.search_str="",this.results=this._search.search_results,this.loading=this._search.loading,this.setFilter=t=>this._search.setFilter(t),this.setItem=t=>t instanceof Object?this.select(t):this.setFilter(t),this.onTouch=t=>this.checkClick(t)}checkClick(t){var e,n;(null===(n=null===(e=this._el)||void 0===e?void 0:e.nativeElement)||void 0===n?void 0:n.contains(t.target))||(this.show=!1,this._input_el.nativeElement.blur())}showSearch(){var t;this.show=!0,(null===(t=this._input_el)||void 0===t?void 0:t.nativeElement)&&this.timeout("focus",()=>this._input_el.nativeElement.focus(),300)}closeSearch(t){var e;this.show=!1,this.search_str="",this.setFilter(""),(null===(e=this._input_el)||void 0===e?void 0:e.nativeElement)&&(this._input_el.nativeElement.focus(),this._input_el.nativeElement.blur())}select(t){this.search_str=t.name;const e={};e["space"===t.type?"space":"feature"===t.type?"feature":"user"]=t.id,this._router.navigate([],{relativeTo:this._route,queryParams:e})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(i.m),i.Rb(ci),i.Rb(c.d),i.Rb(c.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["explore-search"]],viewQuery:function(t,e){if(1&t&&i.Rc(ri,1),2&t){let t;i.wc(t=i.jc())&&(e._input_el=t.first)}},hostBindings:function(t,e){1&t&&i.ic("click",function(t){return e.checkClick(t)},!1,i.zc)("touchstart",function(t){return e.onTouch(t)},!1,i.zc)},features:[i.Cb],decls:13,vars:12,consts:[["role","search","tabindex","0","matRipple","",1,"bg-white","m-2","flex","items-center","z-10","relative","overflow-hidden","outline-none"],["tabindex","0",1,"text-2xl","outline-none",3,"click"],["placeholder","Search for...",1,"flex-1","text-base","border-none","outline-none",3,"ngModel","matAutocomplete","matAutocompleteConnectedTo","ngModelChange","blur"],["input",""],["class","mr-2",3,"diameter",4,"ngIf"],["matAutocompleteOrigin","",1,"absolute","bottom-0","left-8","right-8","min-w-[20rem]"],["origin","matAutocompleteOrigin"],["auto","matAutocomplete"],[4,"ngIf"],[1,"mr-2",3,"diameter"],["class","pointer-events-none",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none"],[3,"value"],[1,"flex","items-center","leading-tight"],[1,"flex-1","overflow-hidden"],[1,"truncate","w-full"],[1,"text-xs"],[1,"text-xs","font-bold","p-2","capitalize","text-white","bg-gray-500","rounded"]],template:function(t,e){if(1&t&&(i.Xb(0,"div",0),i.Xb(1,"app-icon",1),i.ic("click",function(t){return e.show?e.closeSearch(t):e.showSearch()}),i.Mc(2),i.Wb(),i.Xb(3,"input",2,3),i.ic("ngModelChange",function(t){return e.search_str=t})("ngModelChange",function(t){return e.setItem(t)})("blur",function(){return e.show=!!e.search_str}),i.Wb(),i.Kc(5,li,1,1,"mat-spinner",4),i.nc(6,"async"),i.Sb(7,"div",5,6),i.Wb(),i.Xb(9,"mat-autocomplete",null,7),i.Kc(11,bi,6,10,"ng-container",8),i.nc(12,"async"),i.Wb()),2&t){const t=i.xc(8),n=i.xc(10);i.Jb("show",e.show||e.search_str),i.Fb(2),i.Oc(" ",e.show||e.search_str?"close":"search"," "),i.Fb(1),i.tc("ngModel",e.search_str)("matAutocomplete",n)("matAutocompleteConnectedTo",t),i.Fb(2),i.tc("ngIf",i.oc(6,8,e.loading)),i.Fb(6),i.tc("ngIf",!0!==i.oc(12,10,e.loading)&&(e.show||e.search_str))}},directives:[Ft,o.c,v.d,o.l,o.o,p.m,v.c,v.a,u.b,p.l,b.k],pipes:[p.b,p.t],styles:["[_nghost-%COMP%] {\n                z-index: 99;\n            }\n\n            [role='search'][_ngcontent-%COMP%] {\n                height: 3.125rem;\n                width: 3.125rem;\n                border-radius: 1.5rem;\n                border: 1px solid #ccc;\n                transition: width 200ms;\n            }\n\n            app-icon[_ngcontent-%COMP%] {\n                margin: 0.55rem;\n            }\n\n            [role='search'].show[_ngcontent-%COMP%] {\n                width: 32rem;\n                max-width: calc(100vw - 1rem);\n                border-color: #1e88e5;\n            }"]}),t})(),pi=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Pb({type:t}),t.\u0275inj=i.Ob({imports:[[p.c,me,o.h,o.p,fe.b,ie.f,M.f,$n]]}),t})();const mi=["bootstrap",""];function fi(t,e){if(1&t&&(i.Xb(0,"mat-option",10),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t),i.Fb(1),i.Oc(" ",t.name," ")}}function gi(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div"),i.Xb(1,"label"),i.Mc(2,"Select a building from the dropdown below"),i.Wb(),i.Xb(3,"mat-form-field",6),i.Xb(4,"mat-select",7,8),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc(2).active_building=e})("ngModelChange",function(){return i.Bc(t),i.mc(2).updateRotations()}),i.Kc(6,fi,2,2,"mat-option",9),i.Wb(),i.Wb(),i.Wb()}if(2&t){const t=i.mc(2);i.Fb(4),i.tc("ngModel",t.active_building),i.Fb(2),i.tc("ngForOf",t.buildings)}}function _i(t,e){if(1&t&&(i.Xb(0,"mat-option",10),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t),i.Fb(1),i.Oc(" ",t.name," ")}}function vi(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div"),i.Xb(1,"label"),i.Mc(2,"Select a level from the dropdown below"),i.Wb(),i.Xb(3,"mat-form-field",6),i.Xb(4,"mat-select",11,8),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc(2).active_level=e}),i.Kc(6,_i,2,2,"mat-option",9),i.Wb(),i.Wb(),i.Wb()}if(2&t){const t=i.mc(2);i.Fb(4),i.tc("ngModel",t.active_level),i.Fb(2),i.tc("ngForOf",t.levels)}}function yi(t,e){if(1&t&&(i.Xb(0,"mat-option",10),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t),i.Fb(1),i.Oc(" ",t.name," ")}}function Oi(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div"),i.Xb(1,"label"),i.Mc(2," Please select an orientation from the dropdown below "),i.Wb(),i.Xb(3,"mat-form-field",6),i.Xb(4,"mat-select",12,8),i.ic("valueChange",function(e){return i.Bc(t),i.mc(2).active_rotation=e}),i.Kc(6,yi,2,2,"mat-option",9),i.Wb(),i.Wb(),i.Wb()}if(2&t){const t=i.mc(2);i.Fb(4),i.tc("value",t.active_rotation),i.Fb(2),i.tc("ngForOf",t.rotations)}}function wi(t,e){if(1&t&&(i.Xb(0,"mat-option",10),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t),i.Fb(1),i.Oc(" ",t.name," ")}}function ki(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div"),i.Xb(1,"label"),i.Mc(2," Please select an fixed location from the dropdown below "),i.Wb(),i.Xb(3,"mat-form-field",6),i.Xb(4,"mat-select",13,8),i.ic("valueChange",function(e){return i.Bc(t),i.mc(2).active_location=e}),i.Kc(6,wi,2,2,"mat-option",9),i.Wb(),i.Wb(),i.Wb()}if(2&t){const t=i.mc(2);i.Fb(4),i.tc("value",t.active_location),i.Fb(2),i.tc("ngForOf",t.locations)}}function xi(t,e){if(1&t){const t=i.Yb();i.Vb(0),i.Kc(1,gi,7,2,"div",4),i.Kc(2,vi,7,2,"div",4),i.Kc(3,Oi,7,2,"div",4),i.Kc(4,ki,7,2,"div",4),i.Xb(5,"button",5),i.ic("click",function(){return i.Bc(t),i.mc().bootstrapKiosk()}),i.Mc(6," Finish Setup "),i.Wb(),i.Ub()}if(2&t){const t=i.mc();i.Fb(1),i.tc("ngIf",t.buildings&&t.buildings.length),i.Fb(1),i.tc("ngIf",t.levels&&t.levels.length),i.Fb(1),i.tc("ngIf",t.rotations&&t.rotations.length),i.Fb(1),i.tc("ngIf",t.locations&&t.locations.length),i.Fb(1),i.tc("disabled",!t.active_building&&!t.active_level)}}function ji(t,e){if(1&t&&(i.Xb(0,"div",14),i.Sb(1,"mat-spinner",15),i.Xb(2,"p"),i.Mc(3),i.Wb(),i.Wb()),2&t){const t=i.mc();i.Fb(1),i.tc("diameter",32),i.Fb(2),i.Nc(t.loading)}}let Mi=(()=>{class t extends F{constructor(t,e,n){super(),this._org=t,this._route=e,this._router=n,this.rotations=[]}get buildings(){return this._org.buildings}get levels(){return this.active_building&&this._org.levelsForBuilding(this.active_building)||[]}get locations(){return this.active_level&&this.active_level.locations||[]}ngOnInit(){this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{t.has("clear")&&"true"===t.get("clear")&&(localStorage.removeItem("KIOSK.building"),localStorage.removeItem("KIOSK.level"),localStorage.removeItem("KIOSK.orientation"))})),this.timeout("check",()=>this.checkBootstrap(),1e3)}updateRotations(){const t=this.active_building.orientations,e=[];for(const n in t)t[n]&&e.push({id:n,name:`${n.split("_").join(" ")} (${90*t[n]}\xb0)`,value:t[n]});this.rotations=e,this.active_rotation=this.rotations[0]}bootstrapKiosk(){this.loading="Bootstrapping application...",this.active_building&&this.active_level&&(localStorage&&(localStorage.setItem("KIOSK.building",this.active_building.id),localStorage.setItem("KIOSK.level",this.active_level.id),this.active_rotation&&localStorage.setItem("KIOSK.orientation",`${this.active_rotation.id}`),this.active_location&&localStorage.setItem("KIOSK.location",`${this.active_location.id}`)),this._router.navigate(["/explore"])),this.loading=null}checkBootstrap(){if(this.loading="Checking for existing parameters...",localStorage){const t=localStorage.getItem("KIOSK.building"),e=localStorage.getItem("KIOSK.level");t&&e&&this._router.navigate(["/explore"])}this.loading=null}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(tn),i.Rb(c.a),i.Rb(c.d))},t.\u0275cmp=i.Lb({type:t,selectors:[["","bootstrap",""]],features:[i.Cb],attrs:mi,decls:6,vars:2,consts:[["form","",1,"absolute","top-2","left-1/2","transform","-translate-x-1/2","bg-white","overflow-hidden","flex","flex-col","items-center","shadow","rounded"],[1,"px-4","py-2","bg-primary","text-white","w-full","text-lg","font-medium","mb-2"],[4,"ngIf","ngIfElse"],["load_state",""],[4,"ngIf"],["mat-button","",1,"mb-2",3,"disabled","click"],["appearance","outline"],["building","","placeholder","Select building",3,"ngModel","ngModelChange"],["select",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["level","","placeholder","Select level",3,"ngModel","ngModelChange"],["placeholder","Select orientation",3,"value","valueChange"],["placeholder","Select location",3,"value","valueChange"],[1,"flex","flex-col","items-center","p-8","m-auto"],[3,"diameter"]],template:function(t,e){if(1&t&&(i.Xb(0,"div",0),i.Xb(1,"header",1),i.Mc(2," Map Kiosk Setup "),i.Wb(),i.Kc(3,xi,7,5,"ng-container",2),i.Wb(),i.Kc(4,ji,4,2,"ng-template",null,3,i.Lc)),2&t){const t=i.xc(5);i.Fb(3),i.tc("ngIf",!e.loading)("ngIfElse",t)}},directives:[p.m,m.b,g.c,_.a,o.l,o.o,p.l,b.k,u.b],styles:["[_nghost-%COMP%]    > div[_ngcontent-%COMP%] {\n                width: 24rem;\n                max-width: calc(100vw - 2rem);\n            }\n\n            mat-form-field[_ngcontent-%COMP%] {\n                width: 100%;\n            }\n\n            [form][_ngcontent-%COMP%]    > div[_ngcontent-%COMP%] {\n                padding: 0 1em;\n            }"]}),t})();var Wi=n("PqYM");let Ci=(()=>{class t extends F{constructor(t,e,n,s){super(),this._state=t,this._settings=e,this._org=n,this._desks=s,this._options=new C.a({date:(new Date).valueOf(),zones:[],attendees:[],filter_sit_to_stand:!1,filter_dual_monitors:!1}),this._loading=new C.a(!1),this._host=new C.a(null),this.host=this._host.asObservable(),this.options=this._options.asObservable(),this.loading=this._loading.asObservable(),this.todays_bookings=Object(Wi.a)(1e3).pipe(Object(On.a)(t=>Bs({period_start:Math.floor(Object(Fe.a)(new Date).valueOf()/1e3),period_end:Math.floor(Object(Ie.a)(new Date).valueOf()/1e3),type:"desk"})),Object(mt.a)(t=>t.filter(t=>t.user_email===Ot().email))),this.desk_list=this._options.pipe(Object(vn.a)(500),Object(yn.a)(),Object(On.a)(t=>{const{zones:e}=t;if(e.length){const n=this._org.levelWithID(e);return n?Object(W.t)(n.id,{name:"desks"}).pipe(Object(mt.a)(e=>e.details.filter(e=>!t.filter_sit_to_stand||e.sit_to_stand).filter(e=>!t.filter_dual_monitors||e.dual_monitors).map(t=>new en(Object.assign(Object.assign({},t),{zone:n}))))):Object(W.i)(e[0],{name:"desks"}).pipe(Object(mt.a)(e=>e.reduce((e,n)=>{var s;return e.concat((null===(s=n.metadata.desks)||void 0===s?void 0:s.details)instanceof Array?n.metadata.desks.details.filter(e=>!t.filter_sit_to_stand||e.sit_to_stand).filter(e=>!t.filter_dual_monitors||e.dual_monitors).map(t=>new en(Object.assign(Object.assign({},t),{zone:n.zone}))):[])},[])))}return Promise.resolve([])}),Object(Tn.a)(1)),this.desk_availability=Object(Ze.a)([this._options,this.desk_list]).pipe(Object(vn.a)(500),Object(yn.a)(),Object(On.a)(t=>Object(I.a)(this,void 0,void 0,function*(){this._loading.next(!0);const[e,n]=t,s=Object(Fe.a)(e.date?new Date(e.date):new Date);return[n,yield Bs({period_start:Math.floor(s.valueOf()/1e3),period_end:Math.floor(Object(Ie.a)(s).valueOf()/1e3),type:"desk",zones:(e.zones||[])[0]}).toPromise().catch(t=>[])]})),Object(mt.a)(t=>{var e;const[n,s]=t,i=s.filter(t=>"declined"!==t.status),o=(null===(e=Ot())||void 0===e?void 0:e.groups)||[],a=n.filter(t=>t.bookable&&(!t.group||o.includes((t.group||"").toLowerCase())));return this.processDeskBookings(t),this._loading.next(!1),a.filter(t=>!i.find(e=>e.asset_id===t.id))}),Object(Tn.a)(1)),this.subscription("level",this._state.level.subscribe(t=>t?this.setOptions({zones:[t.id]}):"")),this.subscription("availability",Object(Ze.a)([this.desk_availability,this.desk_list]).pipe(Object(vn.a)(500)).subscribe(t=>this.handleDeskAvailability(t))),this._desks.can_set_date=!1,this._desks.error_on_host=!1}ngOnDestroy(){super.ngOnDestroy(),this._desks.can_set_date=!0}startPolling(t=5e3){this.interval("poll",()=>this._options.next(Object.assign({},this._options.getValue())),t)}stopPolling(){this.clearInterval("poll")}setOptions(t){this._options.next(Object.assign(Object.assign({},this._options.getValue()),t))}setHost(t){this._host.next(t)}checkin(t){return Object(I.a)(this,void 0,void 0,function*(){const e=(yield Bs({period_start:Math.floor(Object(Fe.a)(new Date).valueOf()/1e3),period_end:Math.floor(Object(Ie.a)(new Date).valueOf()/1e3),type:"desk"}).toPromise()).find(e=>e.asset_id===t);return!!e&&(yield function(t,e){const n=st({state:!0});return Object(W.l)(`${Vs}/${encodeURIComponent(t)}/check_in?${n}`,"").pipe(Object(mt.a)(t=>new As(t)))}(e.id).toPromise(),!0)})}bookDesk(t,e=""){return Object(I.a)(this,void 0,void 0,function*(){return this._desks.bookDesk({desks:t instanceof en?[t]:t,host:this._host.getValue(),attendees:this._options.getValue().attendees||[],reason:e,date:new Date(this._options.getValue().date)})})}handleDeskAvailability([t,e]){var n;const s={},i=[],o=(null===(n=Ot())||void 0===n?void 0:n.groups)||[],a=this._settings.get("app.explore.colors")||{};for(const c of e){const e=!c.bookable||c.groups&&!c.groups.find(t=>o.includes(t))?"not-bookable":t.find(t=>t.id===c.id)?"free":"busy";s[`#${c.id}`]={fill:a[`desk-${e}`]||a[`${e}`]||Ms[`${e}`],opacity:.6},"free"===e&&(i.push({id:c.id,action:"click",zone:!1,callback:()=>this.bookDesk(c)}),i.push({id:c.id,action:"touchend",zone:!1,callback:()=>this.bookDesk(c)}))}}processDeskBookings(t){const[e,n]=t,s=[];for(const i of e){const t=n.find(t=>t.asset_id===i.id);s.push({location:i.id,content:ii,hover:!0,data:{map_id:i.name,user:null==t?void 0:t.user_name,start:null==t?void 0:t.date,end:(null==t?void 0:t.date)+60*(null==t?void 0:t.duration)*1e3,status:t?"busy":"free"}})}this._state.setFeatures("desks",s)}}return t.\u0275fac=function(e){return new(e||t)(i.ec(rs),i.ec(et),i.ec(tn),i.ec(Ns))},t.\u0275prov=i.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function Xi(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div",11),i.Xb(1,"label"),i.Mc(2,"Host"),i.Wb(),i.Xb(3,"a-user-search-field",12),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc().setHost(e)}),i.nc(4,"async"),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.Fb(3),i.tc("ngModel",i.oc(4,1,t.host))}}function Fi(t,e){if(1&t){const t=i.Yb();i.Xb(0,"mat-button-toggle-group",13),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc().booking_type=e}),i.Xb(1,"mat-button-toggle",14),i.ic("click",function(){return i.Bc(t),i.mc().setAttendees([])}),i.Mc(2," Single "),i.Wb(),i.Xb(3,"mat-button-toggle",15),i.Mc(4," Group "),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.tc("ngModel",t.booking_type)}}function Ii(t,e){if(1&t&&(i.Xb(0,"mat-option",16),i.Mc(1),i.Wb()),2&t){const t=e.$implicit;i.tc("value",t.id),i.Fb(1),i.Oc(" ",t.display_name||t.name," ")}}function Si(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div",11),i.Xb(1,"label"),i.Mc(2,"Reason"),i.Wb(),i.Xb(3,"mat-form-field",7),i.Xb(4,"input",17),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc().reason=e}),i.Wb(),i.Wb(),i.Wb()}if(2&t){const t=i.mc();i.Fb(4),i.tc("ngModel",t.reason)}}function $i(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div",11),i.Xb(1,"label"),i.Mc(2,"Group Members"),i.Wb(),i.Xb(3,"a-user-list-field",12),i.ic("ngModelChange",function(e){return i.Bc(t),i.mc().setAttendees(e)}),i.nc(4,"async"),i.Wb(),i.Wb()}if(2&t){const t=i.mc();let e=null;i.Fb(3),i.tc("ngModel",null==(e=i.oc(4,1,t.options))?null:e.attendees)}}let Pi=(()=>{class t{constructor(t,e,n){this._org=t,this._state=e,this._settings=n,this.booking_type="single",this.reason="",this.buildings=this._org.building_list,this.options=this._state.options,this.host=this._state.host,this.setAttendees=t=>this._state.setOptions({attendees:t}),this.setOptions=t=>this._state.setOptions(t),this.setHost=t=>this._state.setHost(t)}get can_book_group(){return!1!==this._settings.get("app.desks.has_group_booking")}get hide_reason(){return!!this._settings.get("app.desks.hide_reason")}get can_set_host(){return!!this._settings.get("app.desks.can_set_host")}ngOnInit(){return Object(I.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(S.a)(t=>t)).toPromise(),this.setOptions({zones:[this._org.building.id]}),this.can_set_host||this._state.setHost(Ot())})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(tn),i.Rb(Ci),i.Rb(et))},t.\u0275cmp=i.Lb({type:t,selectors:[["desk-flow-form"]],decls:22,vars:13,consts:[[1,"w-full","bg-gray-800","text-white","p-4"],["options","",1,"m-auto"],[1,"text-xl","font-medium","mb-4","text-center"],["class","flex flex-col",4,"ngIf"],["name","booking-type","class","w-full mb-4","aria-label","Desk Booking Type",3,"ngModel","ngModelChange",4,"ngIf"],[1,"flex","items-center","space-x-2"],[1,"flex","flex-col","flex-1","w-40"],["overlay","","appearance","outline"],["placeholder","Select Building...",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"text-black",3,"ngModel","ngModelChange"],[1,"flex","flex-col"],[3,"ngModel","ngModelChange"],["name","booking-type","aria-label","Desk Booking Type",1,"w-full","mb-4",3,"ngModel","ngModelChange"],["value","single",1,"flex-1",3,"click"],["value","group",1,"flex-1"],[3,"value"],["matInput","","placeholder","Reason for booking",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(i.Xb(0,"div",0),i.Xb(1,"div",1),i.Xb(2,"h2",2),i.Mc(3," Request a desk "),i.Wb(),i.Kc(4,Xi,5,3,"div",3),i.Kc(5,Fi,5,1,"mat-button-toggle-group",4),i.Xb(6,"div",5),i.Xb(7,"div",6),i.Xb(8,"label"),i.Mc(9,"Building"),i.Wb(),i.Xb(10,"mat-form-field",7),i.Xb(11,"mat-select",8),i.ic("ngModelChange",function(t){return e.setOptions({zones:[t]})}),i.nc(12,"async"),i.Kc(13,Ii,2,2,"mat-option",9),i.nc(14,"async"),i.Wb(),i.Wb(),i.Wb(),i.Xb(15,"div",6),i.Xb(16,"label"),i.Mc(17,"Date"),i.Wb(),i.Xb(18,"a-date-field",10),i.ic("ngModelChange",function(t){return e.setOptions({date:t})}),i.nc(19,"async"),i.Wb(),i.Wb(),i.Wb(),i.Kc(20,Si,5,1,"div",3),i.Kc(21,$i,5,3,"div",3),i.Wb(),i.Wb()),2&t&&(i.Fb(4),i.tc("ngIf",e.can_set_host),i.Fb(1),i.tc("ngIf",e.can_book_group),i.Fb(6),i.tc("ngModel",i.oc(12,7,e.options).zones[0]),i.Fb(2),i.tc("ngForOf",i.oc(14,9,e.buildings)),i.Fb(5),i.tc("ngModel",i.oc(19,11,e.options).date),i.Fb(2),i.tc("ngIf",!e.hide_reason),i.Fb(1),i.tc("ngIf","group"===e.booking_type))},directives:[p.m,g.c,_.a,o.l,o.o,p.l,we,Mn,h.b,h.a,b.k,O.b,o.c,Sn],pipes:[p.b],styles:["[options][_ngcontent-%COMP%] {\n                width: 480px;\n                max-width: calc(100vw - 2rem);\n            }"]}),t})();const Ei=function(){return{class:"material-icons",content:"done"}},zi=function(t){return["/book",t]},Ki=function(){return{}},Di=function(){return["/schedule"]},Li=function(t){return{email:t}};let Ti=(()=>{class t{constructor(){this.route="spaces",this.type="space"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["booking-success"]],inputs:{calendar:"calendar",route:"route",type:"type"},decls:12,vars:13,consts:[["name","success",1,"fixed","inset-0","flex","flex-col","bg-secondary","items-center","justify-center"],[1,"text-4xl","rounded-full","bg-white","text-success","mb-4"],[3,"icon"],[1,"text-center","text-lg","text-white","mb-4"],[1,"flex","items-center","space-x-2"],["button","","mat-button","",1,"w-32",3,"routerLink","queryParams"]],template:function(t,e){1&t&&(i.Xb(0,"div",0),i.Xb(1,"div",1),i.Sb(2,"app-icon",2),i.Wb(),i.Xb(3,"div",3),i.Mc(4),i.Sb(5,"br"),i.Mc(6," An event has been added to your calendar "),i.Wb(),i.Xb(7,"div",4),i.Xb(8,"a",5),i.Mc(9," New Booking "),i.Wb(),i.Xb(10,"a",5),i.Mc(11," My Day "),i.Wb(),i.Wb(),i.Wb()),2&t&&(i.Fb(2),i.tc("icon",i.uc(6,Ei)),i.Fb(2),i.Oc(" Thank you, you ",e.type," booking was successful!"),i.Fb(4),i.tc("routerLink",i.vc(7,zi,e.route))("queryParams",i.uc(9,Ki)),i.Fb(2),i.tc("routerLink",i.uc(10,Di))("queryParams",i.vc(11,Li,e.calendar)))},directives:[Ft,m.a,c.f],styles:[""]}),t})();function Ri(t,e){if(1&t){const t=i.Yb();i.Xb(0,"div",9),i.Xb(1,"div"),i.Mc(2),i.Wb(),i.Xb(3,"div",10),i.Mc(4),i.Wb(),i.Xb(5,"button",11),i.ic("click",function(){i.Bc(t);const n=e.$implicit;return i.mc(4).bookDesk(n)}),i.Mc(6," Book "),i.Wb(),i.Wb()}if(2&t){const t=e.$implicit;i.Fb(2),i.Nc(t.name),i.Fb(2),i.Oc(" ",(null==t.zone?null:t.zone.display_name)||(null==t.zone?null:t.zone.name)," ")}}function Ai(t,e){if(1&t&&(i.Xb(0,"div",7),i.Kc(1,Ri,7,2,"div",8),i.nc(2,"async"),i.Wb()),2&t){const t=i.mc(3);i.Fb(1),i.tc("ngForOf",i.oc(2,1,t.available))}}function qi(t,e){if(1&t&&(i.Vb(0),i.Kc(1,Ai,3,3,"div",6),i.nc(2,"async"),i.Ub()),2&t){const t=i.mc(2),e=i.xc(2);let n=null;i.Fb(1),i.tc("ngIf",null==(n=i.oc(2,2,t.available))?null:n.length)("ngIfElse",e)}}function Vi(t,e){if(1&t&&(i.Vb(0),i.Sb(1,"desk-flow-form"),i.Xb(2,"div",5),i.Kc(3,qi,3,4,"ng-container",0),i.nc(4,"async"),i.Wb(),i.Ub()),2&t){const t=i.mc(),e=i.xc(4);i.Fb(3),i.tc("ngIf",!i.oc(4,2,t.loading))("ngIfElse",e)}}function Bi(t,e){1&t&&(i.Xb(0,"div",12),i.Mc(1," No desks available for selected building and time "),i.Wb())}function Ni(t,e){1&t&&(i.Xb(0,"div",12),i.Sb(1,"mat-spinner",13),i.Xb(2,"p"),i.Mc(3,"Retrieving available desks for building and time..."),i.Wb(),i.Wb()),2&t&&(i.Fb(1),i.tc("diameter",48))}function Ui(t,e){1&t&&(i.Xb(0,"div",14),i.Sb(1,"mat-spinner",13),i.Xb(2,"p"),i.Mc(3,"Checking in desk..."),i.Wb(),i.Wb()),2&t&&(i.Fb(1),i.tc("diameter",48))}function Yi(t,e){1&t&&(i.Vb(0),i.Sb(1,"booking-success",15),i.Ub())}let Gi=(()=>{class t extends F{constructor(t,e,n,s){super(),this._org=t,this._desks=e,this._router=n,this._route=s,this.available=Object(Ze.a)([this._desks.desk_availability,this._desks.options]).pipe(Object(vn.a)(50),Object(mt.a)(([t,{attendees:e}])=>{const n=e.length+1,s=t.sort((t,e)=>{var n,s,i;return(null===(s=null===(n=t.zone)||void 0===n?void 0:n.name)||void 0===s?void 0:s.localeCompare(e.zone.name))||(null===(i=t.name)||void 0===i?void 0:i.localeCompare(e.name))}),i=Math.floor(s.length/n),o=[];for(let a=0;a<i;a++){const t=s.splice(0,n);o.push({id:`group-${a}`,name:`${t.map(t=>t.name).join(", ")}`,desks:t,zone:t[0].zone})}return o}),Object(Tn.a)(1)),this.loading=this._desks.loading,this.bookDesk=t=>Object(I.a)(this,void 0,void 0,function*(){(yield this._desks.bookDesk(t.desks,""))&&(this._router.navigate([],{relativeTo:this._route,queryParams:{success:"true"}}),this.success=!0)})}ngOnInit(){return Object(I.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(S.a)(t=>t)).toPromise(),yield yt.pipe(Object(S.a)(t=>!!t)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>Object(I.a)(this,void 0,void 0,function*(){if(t.has("checkin")){this.checkin=!0;const e=yield this._desks.checkin(t.get("checkin"));if(this.checkin=!1,!e)return dt("Error checking in desk.");lt("Successfully checked in to desk")}this.success=t.has("success")})))})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(tn),i.Rb(Ci),i.Rb(c.d),i.Rb(c.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["desk-flow-listing"]],features:[i.Cb],decls:8,vars:3,consts:[[4,"ngIf","ngIfElse"],["empty_state",""],["load_state",""],["checkin_state",""],[4,"ngIf"],[1,"flex-1","overflow-auto","w-full","bg-gray-200","relative"],["list","","class","flex flex-wrap p-2 justify-center m-auto",4,"ngIf","ngIfElse"],["list","",1,"flex","flex-wrap","p-2","justify-center","m-auto"],["desk","","class","bg-white rounded shadow p-2 m-1",4,"ngFor","ngForOf"],["desk","",1,"bg-white","rounded","shadow","p-2","m-1"],[1,"mb-2","text-sm"],["mat-button","",1,"w-full",3,"click"],[1,"absolute","flex","flex-col","inset-0","items-center","justify-center"],[1,"mb-4",3,"diameter"],[1,"flex-1","flex","flex-col","items-center","justify-center","w-full"],["calendar","desks","route","desks","type","desk"]],template:function(t,e){if(1&t&&(i.Kc(0,Vi,5,4,"ng-container",0),i.Kc(1,Bi,2,0,"ng-template",null,1,i.Lc),i.Kc(3,Ni,4,1,"ng-template",null,2,i.Lc),i.Kc(5,Ui,4,1,"ng-template",null,3,i.Lc),i.Kc(7,Yi,2,0,"ng-container",4)),2&t){const t=i.xc(6);i.tc("ngIf",!e.checkin)("ngIfElse",t),i.Fb(7),i.tc("ngIf",e.success)}},directives:[p.m,Pi,p.l,m.b,u.b,Ti],pipes:[p.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n            }\n\n            [list][_ngcontent-%COMP%] {\n                width: 768px;\n                max-width: 100vw;\n            }\n\n            [desk][_ngcontent-%COMP%] {\n                width: 240px;\n                max-width: calc(100vw - 1rem);\n            }"]}),t})();const Hi=function(){return["/desks"]},Ji=function(){return["/explore"]};let Qi=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=i.Lb({type:t,selectors:[["footer-menu"]],decls:13,vars:4,consts:[[1,"flex","items-center","bg-white","divide-x","border-t","border-solid","border-gray-300","w-full"],["mat-button","","routerLinkActive","!bg-primary !text-white",1,"flex-1","h-16","!rounded-none",3,"routerLink"],[1,"flex","flex-col","items-center","justify-center"],[1,"text-2xl"],[1,"m-0"]],template:function(t,e){1&t&&(i.Xb(0,"div",0),i.Xb(1,"a",1),i.Xb(2,"div",2),i.Xb(3,"app-icon",3),i.Mc(4,"book"),i.Wb(),i.Xb(5,"p",4),i.Mc(6,"Book Desk"),i.Wb(),i.Wb(),i.Wb(),i.Xb(7,"a",1),i.Xb(8,"div",2),i.Xb(9,"app-icon",3),i.Mc(10,"place"),i.Wb(),i.Xb(11,"p",4),i.Mc(12,"Map"),i.Wb(),i.Wb(),i.Wb(),i.Wb()),2&t&&(i.Fb(1),i.tc("routerLink",i.uc(2,Hi)),i.Fb(6),i.tc("routerLink",i.uc(3,Ji)))},directives:[m.a,c.f,c.e,Ft],encapsulation:2}),t})();const Zi=["desk-booking",""];let to=(()=>{class t extends F{constructor(t,e,n){super(),this._state=t,this._settings=e,this._router=n}get countdown_time(){return this._settings.get("app.general.kiosk_reset_delay")||3e5}ngOnInit(){return Object(I.a)(this,void 0,void 0,function*(){yield yt.pipe(Object(S.a)(t=>!!t)).toPromise(),setTimeout(()=>this._state.setHost(null),1e3),this.resetCountdown()})}resetCountdown(){this.timeout("reset",()=>this._router.navigate(["/explore"]),this.countdown_time)}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(Ci),i.Rb(et),i.Rb(c.d))},t.\u0275cmp=i.Lb({type:t,selectors:[["","desk-booking",""]],features:[i.Cb],attrs:Zi,decls:2,vars:0,consts:[[1,"h-1/2","flex-1","overflow-hidden",3,"click"]],template:function(t,e){1&t&&(i.Xb(0,"desk-flow-listing",0),i.ic("click",function(){return e.resetCountdown()},!1,i.Ac),i.Wb(),i.Sb(1,"footer-menu"))},directives:[Gi,Qi],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n                background: #f0f0f0;\n            }\n\n            desk-flow-listing[_ngcontent-%COMP%] {\n                max-height: calc(100% - 4rem);\n            }"]}),t})();function eo(t,e){if(1&t){const t=i.Yb();i.Xb(0,"button",2),i.ic("click",function(){i.Bc(t);const n=e.$implicit;return i.mc().setLevel(n)}),i.nc(1,"async"),i.Xb(2,"div",3),i.Mc(3),i.Wb(),i.Xb(4,"p",4),i.Mc(5),i.Wb(),i.Wb()}if(2&t){const t=e.$implicit,n=i.mc();let s=null;i.Jb("active",t.id===(null==(s=i.oc(1,4,n.level))?null:s.id)),i.Fb(3),i.Nc(t.number),i.Fb(2),i.Oc(" ",t.display_name||t.name," ")}}let no=(()=>{class t{constructor(t,e){this._orgs=t,this._state=e,this.levels=this._orgs.active_levels,this.level=this._state.level,this.setLevel=t=>this._state.setLevel(t.id)}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(tn),i.Rb(rs))},t.\u0275cmp=i.Lb({type:t,selectors:[["explore-level-select"]],decls:3,vars:3,consts:[[1,"m-2","rounded","overflow-hidden","bg-white","shadow","border","border-solid","border-gray-300"],["class","flex flex-col items-center justify-center h-16 w-16 p-2 border-none","matRipple","",3,"active","click",4,"ngFor","ngForOf"],["matRipple","",1,"flex","flex-col","items-center","justify-center","h-16","w-16","p-2","border-none",3,"click"],[1,"text-2xl"],[1,"text-sm","whitespace-nowrap","m-0"]],template:function(t,e){1&t&&(i.Xb(0,"div",0),i.Kc(1,eo,6,6,"button",1),i.nc(2,"async"),i.Wb()),2&t&&(i.Fb(1),i.tc("ngForOf",i.oc(2,1,e.levels)))},directives:[p.l,b.n],pipes:[p.b],styles:[".active[_ngcontent-%COMP%] {\n                color: var(--primary) !important;\n            }\n\n            button[_ngcontent-%COMP%]:not(:first-child) {\n                border-top: 1px solid #ccc !important;\n            }"]}),t})();const so=["app-explore",""],io=[{path:"unauthorised",component:he},{path:"bootstrap",component:Mi},{path:"explore",component:(()=>{class t{constructor(t,e,n,s,i,o,a){this._state=t,this._s=e,this._desks=n,this._zones=s,this._settings=i,this._desk_state=o,this._org=a,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options}get logo(){return this._settings.get("app.logo")}ngOnInit(){return Object(I.a)(this,void 0,void 0,function*(){yield yt.pipe(Object(S.a)(t=>!!t)).toPromise(),yield this._org.initialised.pipe(Object(S.a)(t=>t)).toPromise(),setTimeout(()=>this._desk_state.setHost(null),1e3)})}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(rs),i.Rb(Ws),i.Rb(oi),i.Rb(Cs),i.Rb(et),i.Rb(Ci),i.Rb(tn))},t.\u0275cmp=i.Lb({type:t,selectors:[["","app-explore",""]],features:[i.Eb([Ws,oi,Cs])],attrs:so,decls:14,vars:22,consts:[[1,"absolute","top-0","left-0","bg-white","rounded-br-xl","p-2","z-10","shadow"],[1,"w-32",3,"src"],[1,"flex-1","h-1/2","w-full","relative"],[3,"src","zoom","center","styles","features","actions","labels"],[1,"absolute","top-1/2","transform","-translate-y-1/2","right-0"],[1,"absolute","left-1","top-1/2","transform","-translate-y-1/2","z-10"],[1,"absolute","top-1","right-1"]],template:function(t,e){if(1&t&&(i.Xb(0,"div",0),i.Sb(1,"img",1),i.Wb(),i.Xb(2,"div",2),i.Sb(3,"i-map",3),i.nc(4,"async"),i.nc(5,"async"),i.nc(6,"async"),i.nc(7,"async"),i.nc(8,"async"),i.nc(9,"async"),i.nc(10,"async"),i.Wb(),i.Sb(11,"explore-zoom-controls",4),i.Sb(12,"explore-level-select",5),i.Sb(13,"explore-search",6)),2&t){let t=null,n=null;i.Fb(1),i.tc("src",null==e.logo?null:e.logo.src,i.Dc),i.Fb(2),i.tc("src",i.oc(4,8,e.url))("zoom",null==(t=i.oc(5,10,e.positions))?null:t.zoom)("center",null==(n=i.oc(6,12,e.positions))?null:n.center)("styles",i.oc(7,14,e.styles))("features",i.oc(8,16,e.features))("actions",i.oc(9,18,e.actions))("labels",i.oc(10,20,e.labels))}},directives:[Yt,ai,no,hi],pipes:[p.b],styles:["[_nghost-%COMP%] {\n                position: absolute;\n                display: flex;\n                flex-direction: column;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background-color: #f0f0f0;\n            }"]}),t})()},{path:"desks",component:to},{path:"**",redirectTo:"bootstrap"}];let oo=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Pb({type:t}),t.\u0275inj=i.Ob({imports:[[c.g.forRoot(io,{useHash:!0})],c.g]}),t})();var ao=n("hxh6"),co=n("rgd1"),ro=n("aI3+");function lo(t,e){1&t&&(i.Xb(0,"div",1),i.Xb(1,"div",2),i.Xb(2,"div",3),i.Sb(3,"mat-spinner",4),i.Wb(),i.Wb(),i.Wb()),2&t&&(i.Fb(3),i.tc("diameter",64))}let uo=(()=>{class t extends F{constructor(t,e,n,s,i,o,a,c){super(),this._tracing=t,this._settings=e,this._org=n,this._spaces=s,this._cache=i,this._snackbar=o,this._hotkey=a,this._clipboard=c,this._loading=new C.a(!1),this.loading=this._loading.asObservable()}ngOnInit(){return Object(I.a)(this,void 0,void 0,function*(){var t;this._hotkey.listen(["Control","Alt","Shift","KeyM"],()=>{localStorage.setItem("mock",`${"true"!==localStorage.getItem("mock")}`),location.reload()}),this._hotkey.listen(["Control","Alt","Shift","KeyC"],()=>{this._clipboard.copy(`${Object(W.v)()}|${Object(W.p)()}`),lt("Successfully copied token.")}),this._hotkey.listen(["Control","Alt","Shift","KeyV"],()=>{var t;null===(t=navigator.clipboard)||void 0===t||t.readText().then(t=>{t.split("|"),localStorage.setItem(`${Object(W.c)()}_access_token`,`${t[0]}`),localStorage.setItem(`${Object(W.c)()}_refresh_token`,`${t[1]}`),localStorage.setItem(`${Object(W.c)()}_expires_at`,`${Object(Rs.a)(new Date,6).valueOf()}`),lt("Successfully pasted token."),setTimeout(()=>location.reload(),2e3)})}),it=this._snackbar,this._loading.next(!0),yield this._settings.initialised.pipe(Object(S.a)(t=>t)).toPromise(),t=this._settings.get("app.short_name"),K=t;const e=this._settings.get("composer")||{};var n;e.mock=!!this._settings.get("mock"),yield function(t){return Object(I.a)(this,void 0,void 0,function*(){const e=t.protocol||location.protocol,n=t.domain||location.hostname,s=t.port||location.port,i=t.use_domain?`${e}//${n}:${s}`:location.origin,o=(location.pathname+"/").replace("//","/"),a=t.mock||location.href.includes("mock=true")||"true"===localStorage.getItem("mock"),c={auth_type:"auth_code",scope:"public",host:`${n}${s?":"+s:""}`,auth_uri:`${i}/auth/oauth/authorize`,token_uri:`${i}/auth/oauth/token`,redirect_uri:`${location.origin}${o}oauth-resp.html`,handle_login:!t.local_login,use_iframe:!0,mock:a};return localStorage&&localStorage.setItem("mock",`${!!a&&!location.href.includes("mock=false")}`),a&&ut("Application in mock mode."),Object(W.s)(c)})}(e).catch(()=>this.onInitError()),this._loading.next(!1),function(t,e=(()=>null),n=3e5){t.isEnabled&&(ot&&ot.unsubscribe(),at&&at.unsubscribe(),ct&&clearInterval(ct),ot=t.available.subscribe(e=>{D("CACHE",`Update available: current version is ${e.current.hash} available version is ${e.available.hash}`),function(t){t.isEnabled&&(D("CACHE","Activating changes to the cache..."),t.activateUpdate().then(()=>{ut("Newer version of the application is available","Refresh",()=>location.reload(!0))}))}(t)}),at=t.activated.subscribe(()=>{D("CACHE","Updates activated. Reloading..."),e("Newer version of the application is available",()=>location.reload(!0))}),ct=setInterval(()=>{D("CACHE","Checking for updates..."),t.checkForUpdate()},n))}(this._cache),this.timeout("wait_for_user",()=>this.onInitError(),5e3),yield yt.pipe(Object(S.a)(t=>!!t)).toPromise(),this.clearTimeout("wait_for_user"),(n=Ot())&&(bn=n),function(t,e=.2){t&&ao.a({dsn:t,integrations:[new ro.a.BrowserTracing({tracingOrigins:["localhost",location.origin],routingInstrumentation:co.b})],tracesSampleRate:e})}(this._settings.get("app.sentry_dsn"))})}onInitError(){var t;Object(W.h)()||(null===(t=Ot())||void 0===t?void 0:t.is_logged_in)||(console.error("Error initialising user."),Object(W.g)(),location.reload())}}return t.\u0275fac=function(e){return new(e||t)(i.Rb(co.a),i.Rb(et),i.Rb(tn),i.Rb(cs),i.Rb(r.b),i.Rb(l.a),i.Rb(J),i.Rb(k.a))},t.\u0275cmp=i.Lb({type:t,selectors:[["app-root"]],features:[i.Cb],decls:3,vars:3,consts:[["class","loading-block",4,"ngIf"],[1,"loading-block"],[1,"info-block","center"],[1,"icon"],[3,"diameter"]],template:function(t,e){1&t&&(i.Sb(0,"router-outlet"),i.Kc(1,lo,4,1,"div",0),i.nc(2,"async")),2&t&&(i.Fb(1),i.tc("ngIf",i.oc(2,1,e.loading)))},directives:[c.h,p.m,u.b],pipes:[p.b],styles:[""]}),t})();const bo=[{created_at:1587057070,updated_at:1587692680,name:"PlaceOS",description:"",tags:"org",count:0,capacity:0,parent_id:"",triggers:[],id:"zone-EmWFTjuYExK"}],ho=[{name:"Sydney",description:"",tags:"building",count:0,capacity:0,parent_id:"zone-EmWFTjuYExK",triggers:[],id:"bld-01"},{name:"Brisbane",description:"",tags:"building",count:0,capacity:0,parent_id:"zone-EmWFTjuYExK",triggers:[],id:"bld-02"},{name:"Melbourne",description:"",tags:"building",count:0,capacity:0,parent_id:"zone-EmWFTjuYExK",triggers:[],id:"bld-03"}],po=["lvl-00","lvl-01","lvl-02","lvl-03","lvl-04","lvl-05","lvl-06"],mo=ho.map(t=>po.map((e,n)=>((t,e,n)=>{let s=t.substr(4);return s="https://s3-ap-southeast-2.amazonaws.com/os.place.tech/16012682998688307492.svg",{id:`${n.id}_${t}`,name:`Level ${t.endsWith("0")?"G":e}`,parent_id:n.id,description:"",tags:"level",map_id:"https://s3-ap-southeast-2.amazonaws.com/os.place.tech/16012682998688307492.svg",code:"level code 12",type:"staff floor",count:5,capacity:30,location:"optional lat,long",display_name:""}})(e,n,t))).reduce((t,e)=>t.concat(e),[]);Object(W.q)({path:"/api/engine/v2/zones",metadata:{},method:"GET",callback:t=>{if("org"===t.query_params.tags)return bo;if("building"===t.query_params.tags)return ho;if("level"===t.query_params.tags)return mo;throw{status:404,message:"Zones not found"}}}),Object(W.q)({path:"/api/engine/v2/metadata/:id",metadata:{},method:"GET",callback:t=>"catering"===t.query_params.name?[]:"desks"===t.query_params.name?{details:[{id:"table-01.001",name:"1.001",bookable:!0,group:""},{id:"table-01.002",name:"1.002",bookable:!0,group:""},{id:"table-01.003",name:"1.003",bookable:!0,group:""},{id:"table-01.004",name:"1.004",bookable:!0,group:""},{id:"table-01.005",name:"1.005",bookable:!1,group:""},{id:"table-01.006",name:"1.006",bookable:!0,group:""}]}:{}}),Object(W.q)({path:"/api/engine/v2/metadata/:id/children",metadata:{},method:"GET",callback:t=>[{zone:{id:"bld-01_lvl-01",name:"Level 1"},metadata:{desks:{details:[{id:"table-01.001",name:"1.001",bookable:!0,group:""},{id:"table-01.002",name:"1.002",bookable:!0,group:""},{id:"table-01.003",name:"1.003",bookable:!0,group:""},{id:"table-01.004",name:"1.004",bookable:!0,group:""},{id:"table-01.005",name:"1.005",bookable:!1,group:""},{id:"table-01.006",name:"1.006",bookable:!0,group:""}]}}}]});const fo="place.tech",go=["Jonathan McFarlane","Alex Sorafumo","Jim Doe","Cristina Boston","Jeremy West","Alexandre Chuvand","Viv Briffa","Candy Russo","Jeff Wiz","Sravani Kotha","Kim Burgess","Landell Archer","Caspian Baska","Stephen Von Takach","Cameron Reeves","Shane Boseley"],_o={id:"current",name:"PlaceOS - Mock User",email:"dev@place.tech",groups:["deals",""]},vo=go.map((t,e)=>({id:`user-${e+1}`,name:t,email:`${t.split(" ").join(".").toLowerCase()}@${fo}`})).concat([_o]),yo=go.map((t,e)=>({id:`guest-${e+1}`,name:t,email:`${t.split(" ").join(".").toLowerCase()}@not-${fo}`})),Oo=()=>{const t=["Whiteboard","VidConf","Projector","Views"],e=G(t.length+1),n=[];for(let s=0;s<e;s++)n.push(t[G(t.length)]);return n.filter((t,e,n)=>n.indexOf(t)===e).join(" ")},wo=[{name:"Meeting Room 1.01",map_id:"area-1.01-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.02",map_id:"area-1.02-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.03",map_id:"area-1.03-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.04",map_id:"area-1.04-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.05",map_id:"area-1.05-status",zones:["bld-01_lvl-01"],bookable:!1},{name:"Meeting Room 1.06",map_id:"area-1.06-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.07",map_id:"area-1.07-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.08",map_id:"area-1.08-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.09",map_id:"area-1.01-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.10",map_id:"area-1.10-status",zones:["bld-01_lvl-01"]}].map(t=>function(t={}){const e="space-"+as++,n=`Test Space ${as}`,s=Math.floor(99999*Math.random())%2==0&&as>1,i=Object.assign({id:e,name:n,long_name:`${n} with an long name`,map_id:`${as}`,capacity:2*Math.floor(20*Math.random()+1),email:`${n.toLowerCase().split(" ").join(".")}@place.tech`,type:"",searchable:Math.floor(99999*Math.random())%2==0,controlable:Math.floor(99999*Math.random())%2==0,bookable:Math.floor(99999*Math.random())%2==0,cost_hour:100*Math.floor(300*Math.random()),setup:5*Math.floor(6*Math.random()),breakdown:5*Math.floor(6*Math.random()),zones:["zone_lvl-0"],support_url:`/control/#/${e}`,bookings:[],linked_rooms:s?[`space-${Math.floor(Math.random()*(as-1))}`]:[],image:""},t);return i.configurations&&i.configurations.length>0&&(i.configurations.forEach(t=>t.capacity=Math.floor(Math.random()*i.capacity)+1),i.configurations[0].capacity=i.capacity),i}(Object.assign(Object.assign({},t),{features:Oo()})));let ko=_e().startOf("d").hour(7);const xo=(t=!1)=>{const e=ko.add(15*(G(8)+1),"m");return t&&(ko=e),e.unix()},jo=["tentative","confirmed","cancelled"],Mo=()=>{const t=G(10);return t<2?jo[2]:t<5?jo[0]:jo[1]},Wo=new Array(200).fill(0).map((t,e)=>{let n=vo.concat(yo).filter(t=>G(9999)%3==0);n.unshift(vo[G(vo.length)]),n=T(n,"email");const s=wo[G(wo.length)];n=n.concat(Object.assign(Object.assign({},s),{resource:!0}));const i=G(9999)%2==0;return i&&n.push(_o),{id:`cal-event-${e}`,status:Mo(),host:i?_o.email:n[0].email,calendar:"calendar_id",creator:"optional@fake.com",attendees:T(n,"email"),title:`Some Meeting ${e}`,body:"A Description",private:!1,event_start:xo(!0),event_end:xo(),timezone:"Sydney",all_day:!1,location:"clear text location",recurring:!1,recurrence:{},attachments:{},system:s,extension_data:{}}}),Co={};Wo.forEach(t=>{Co[t.system.id]||(Co[t.system.id]=[]),Co[t.system.id].push(t)}),Object(W.q)({path:"/api/engine/v2/users/:id",metadata:{},method:"GET",callback:t=>{if("current"===t.route_params.id)return _o;const e=vo.find(e=>e.email===t.route_params.id);if(e)return e;throw{status:404,message:"User not found"}}}),Object(W.q)({path:"/api/staff/v1/people",metadata:{},method:"GET",callback:t=>{if(t.query_params.q){const e=t.query_params.q.toLowerCase();return vo.filter(t=>t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e))}return vo}}),Object(W.q)({path:"/api/staff/v1/people/:id",metadata:{},method:"GET",callback:t=>{const e=decodeURIComponent(t.route_params.id),n=vo.find(t=>t.email===e);if(n)return Object.assign(Object.assign({},n),{location:Fo()});throw{status:404,message:"User not found"}}}),Object(W.q)({path:"/api/staff/v1/guests",metadata:{},method:"GET",callback:t=>{if(t.query_params.q){const e=t.query_params.q.toLowerCase();return yo.filter(t=>t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e))}return vo}}),Object(W.q)({path:"/api/staff/v1/guests/:email",metadata:{},method:"GET",callback:t=>{const e=yo.find(e=>e.email===t.route_params.email);if(e)return e;throw{status:404,message:"Guest not found"}}}),Object(W.q)({path:"/api/staff/v1/guests/:email/meetings",metadata:{},method:"GET",callback:t=>{if(t.route_params.email){const e=t.route_params.email.toLowerCase();return Wo.filter(t=>t.attendees.find(t=>t.email.toLowerCase()===e))}throw{status:404,message:`Unable to find meetings with guest with email ${t.route_params.email}`}}});const Xo=["meeting","desk_id","laptop","mobile","geo","none"];function Fo(){const t=Xo[G(Xo.length)],e=mo[G(mo.length)],n=wo.filter(t=>t.zones.includes(e.id)),s=n[G(n.length)]||{},i={};switch(t){case"meeting":i.meeting={building:e.parent_id,level:e.id,system:s.id,map_id:s.map_id,event_id:""};break;case"desk_id":i.meeting={building:e.parent_id,level:e.id,map_id:s.map_id,checked_in:_e().unix()};break;case"laptop":case"mobile":i[t]={building:e.parent_id,level:e.id,x:+G(1e4),y:+G(5e3),last_seen:_e().subtract(G(60),"m").unix()};break;case"geo":i.geo={lat:G(180)-90,lon:G(360)-180,last_seen:_e().subtract(G(60),"m").unix()}}return i}class Io{constructor(t){var e;this.volume=0,this.name=t.name||"Test Module",this.connected=null===(e=t.connected)||void 0===e||e,this.active=t.active||!1,this.input_list=t.input_list,this.output_list=t.output_list,this.env_sources=t.env_sources||[],this.inputs=Object.keys(this.input_list||{})||[],this.outputs=Object.keys(this.output_list||{})||[],T(this.env_sources.map(t=>t.type)).forEach(t=>this[`${t}`]=this.env_sources.filter(e=>e.type===t).map(t=>t.id)),this.env_sources.forEach(t=>this[`${t.type}/${t.id}`]=t),this.inputs.forEach(t=>this[`input/${t}`]=this.input_list[t]),this.outputs.forEach(t=>this[`output/${t}`]=this.output_list[t])}$powerup(){console.log("Power On"),this.active=!0}$shutdown(){this.active=!1}$share(){}$route(t,e){this.inputs.includes(t)&&this.outputs.includes(e)&&(this.$updateState(t,{routes:T([...this.input_list[t].routes||[],e])}),this.$updateState(e,{source:t,following:t}))}$unroute(){}$connect(){}$disconnect(){}$link(){}$merge(){}$split(){}$notify(){}$preset(){}$volume(t,e="all"){"all"===e&&(this.volume=t)}$mute(t=!0,e="all"){this.$updateState(e,{mute:t})}$unmute(t="all"){this.$mute(!1,t)}$environment(t,e){const n=this.env_sources.find(e=>e.id===t);n&&(this[`${n.type}/${n.id}`]=Object.assign(Object.assign({},n),{state:e}))}$lock(t){this.$updateState(t,{locked:!0})}$unlock(t){this.$updateState(t,{locked:!1})}$updateState(t,e){this[`input/${t}`]?(this[`input/${t}`]=Object.assign(Object.assign({},this[`input/${t}`]),e),this.input_list[t]=Object.assign(Object.assign({},this[`input/${t}`]),e)):this[`output/${t}`]&&(this[`output/${t}`]=Object.assign(Object.assign({},this[`output/${t}`]),e),this.output_list[t]=Object.assign(Object.assign({},this[`output/${t}`]),e))}}const So={Mic1:{name:"Lectern Mic",type:"Microphone",mod:"Microphone_1"},Mic2:{name:"Lapel Mic",type:"Microphone",mod:"Microphone_2"},Mic3:{name:"Handheld Mic",type:"Microphone",mod:"Microphone_3"},PC1:{name:"PC-1",type:"PC"},PC2:{name:"PC-2",type:"PC"},PC3:{name:"PC-3",type:"PC"},PC4:{name:"PC-4",type:"PC"},HDMI:{name:"Laptop HDMI",type:"Laptop"},VGA:{name:"Laptop VGA",type:"Laptop"},Camera1:{name:"Camera Rear",type:"Camera",mod:"Camera_1"},Camera2:{name:"Camera Front",type:"Camera",mod:"Camera_2"},Camera3:{name:"Camera Rear 2",type:"Camera",mod:"Camera_3"},Camera4:{name:"Camera Front 2",type:"Camera",mod:"Camera_4"},TV1:{name:"IPTV 1",type:"TV",mod:"IPTV_1"}},$o={Display1:{name:"Display 1",type:"Display",source:"PC1",mod:"Display_1"},Display2:{name:"Display 2",type:"Display",mod:"Display_2"},Display3:{name:"Display 3",type:"Display",source:"PC2",mod:"Display_3"},Display4:{name:"Display 4",type:"Display",mod:"Display_4"},Display5:{name:"Display 5",type:"Display",mod:"Display_5",source:"TV1"}},Po=[{id:"light1",name:"Lighting",type:"lights",states:["Off","Presentation","Meeting","Full"],state:"Off"},{id:"blind1",name:"Blinds",type:"blinds",states:["Off","Presentation","Meeting"],state:"Off"},{id:"screen1",name:"Screen",type:"screen",states:["Up","Down"],state:"Down"}],Eo=(t,e={})=>new Io(Object.assign(Object.assign(Object.assign({},t),{input_list:So,output_list:$o,env_sources:Po}),e));var zo=n("SuC2");class Ko{constructor(){this.time_zone="Australia/Sydney",this.disable_book_now=!1,this.disable_end_meeting=!1,this.bookings=[],this.pending_period=0,this.pending_before=0,this.control_ui="",this.catering_ui="",this.last_booking_started=0,this.status="free"}}function Do(t,e={}){const n=Object.assign(Object.assign(Object.assign({},new Ko),e),{$start_meeting:function(t){this.last_booking_started=t},$end_meeting:function(t){},$book_now:function(t,e,n){}});return Lo(t,n),setInterval(()=>Lo(t,n),1e3),n}function Lo(t,e){var n;const s=Wo.filter(e=>e.attendees.find(e=>e.email===t.email));if(s.sort((t,e)=>t.event_start-e.event_start),e.bookings=s,!t.bookable)return e.status="not-bookable";const i=new Date,o=s.find(t=>A(i.valueOf(),i.valueOf(),t.event_start,t.event_end)),a=s.find(t=>Object(Ye.a)(i.valueOf(),t.event_start)),c=new Date(null===(n=o||a)||void 0===n?void 0:n.event_start),r=A(i,i,Object(zo.a)(c,e.pending_before),Object(an.a)(c,e.pending_period));e.status=o?r?"pending":"busy":a&&r?"pending":"free"}var To=n("kScs");class Ro{constructor(){this.overview={}}$locate_user(t,e){}}function Ao(t,e=3){let n=`${t}`;for(;n.length<e;)n="0"+n;return n}function qo(t,e={}){const n=new Ro;for(const s of mo)n.overview[s.id]={desk_count:100,desk_usage:0,device_capacity:100,device_count:0,estimated_people:0,percentage_use:0,recommendation:1e4},n[`${s.id}:desk_ids`]=new Array(n.overview[s.id].desk_count).fill(0).map((t,e)=>`table-${s.number}.${Ao(e)}`),n[`${s.id}`]={value:[]};return Vo(n,mo),setInterval(()=>Vo(n,mo),6e4),n}function Vo(t,e){for(const n of e)t[n.id]={value:new Array(G(20)).fill(0).map(()=>Bo(n,t[`${n.id}:desk_ids`]))}}function Bo(t,e,n=vo){return G(9999)%3==0?{location:"desk",at_location:G(9999)%5!=0,map_id:e[G(e.length)],mac:To.Md5.hashStr(n[G(n.length)].email),level:t.id,building:t.parent_id}:{location:"wireless",coordinates_from:"bottom-left",x:G(1e3)/10,y:G(1e3)/10,lon:55.27476066828535,lat:25.20106100633537,s2_cell_id:"3e5f4281459c",mac:To.Md5.hashStr(n[G(n.length)].email),variance:9.62534032222287,last_seen:Math.floor((new Date).valueOf()/1e3),map_width:100,map_height:100}}class No{constructor(t){this.presets=["Preset One","Preset 2","Preset Three"]}$pan(t){}$tilt(t){}$recall(t){}$save_preset(t){}}class Uo{constructor(t){this.volume=R(100)}$mute(t=!0){this.mute=t}$volume(t){this.volume=t}}class Yo{constructor(t){this.volume=R(100)}$mute(t=!0){this.mute=t}$volume(t){this.volume=t}}let Go;class Ho{constructor(t){this.status="stopped",this.live=!1,this.remaining=R(86400)}$start(){this.status="playing",Go=setInterval(()=>{this.remaining<1&&clearInterval(Go),this.remaining=this.remaining-1,this.current=this.current+1},3e3)}$pause(){this.status="paused",clearInterval(Go)}$resume(){this.$start()}$stop(){this.status="stopped",this.current=0,clearInterval(Go)}}const Jo=(t,e={})=>new Ho(Object.assign(Object.assign({},t),e));wo.forEach((t,e)=>function(t){Object(W.r)(t.id,{System:[Eo(t)],Bookings:[Do(t)],AreaManagement:[qo()],Camera:new Array(10).fill(0).map(e=>((t,e={})=>new No(Object.assign(Object.assign({},t),e)))(t)),Display:new Array(10).fill(0).map(e=>((t,e={})=>new Uo(Object.assign(Object.assign({},t),e)))(t)),Microphone:new Array(10).fill(0).map(e=>((t,e={})=>new Yo(Object.assign(Object.assign({},t),e)))(t)),Capture:[Jo(t)]})}(t)),Object(W.q)({path:"/api/engine/v2/systems",metadata:{},method:"GET",callback:t=>wo}),Object(W.q)({path:"/api/staff/v1/events",metadata:{},method:"GET",callback:t=>Wo.filter(t=>!!t.attendees.find(t=>t.email===_o.email))}),Object(W.q)({path:"/api/staff/v1/events",metadata:{},method:"POST",callback:t=>{const e=Object.assign(Object.assign({},t.body),{id:`-cal-event-${G(999)}`});return e.attendees.forEach(t=>{t.zones&&(t.resource=!0)}),Wo.push(e),e}}),Object(W.q)({path:"/api/staff/v1/events/:id",metadata:{},method:"GET",callback:t=>{const e=Wo.find(e=>e.id===t.route_params.id);if(e)return e;throw{status:404,message:"Event not found"}}}),Object(W.q)({path:"/api/staff/v1/events/:id",metadata:{},method:"PATCH",callback:t=>{const e=Wo.findIndex(e=>e.id===t.route_params.id);if(e>=0)return Wo.splice(e,1,t.body);throw{status:404,message:"Event not found"}}}),Object(W.q)({path:"/api/staff/v1/events/:id/guests/:email/checkin",metadata:{},method:"POST",callback:t=>{const e=Wo.find(e=>e.id===t.route_params.id);if(e)return e.extension_data.checked_in=(e.extension_data.checked_in||[]).concat([t.route_params.email]),e;throw{status:404,message:"Guest not found"}}}),Object(W.q)({path:"/api/staff/v1/calendars",metadata:{},method:"GET",callback:t=>[]}),Object(W.q)({path:"/api/staff/v1/calendars/availability",metadata:{},method:"GET",callback:t=>{const e=_e(1e3*+t.query_params.period_start),n=_e(1e3*+t.query_params.period_end),s=(t.query_params.zone_ids||"").split(",").filter(t=>!!t),i=(t.query_params.system_ids||"").split(",").filter(t=>!!t),o=wo.filter(t=>s.length?s.reduce((e,n)=>e&&t.zones.includes(n),!0):!i.length||i.includes(t.id)).filter(t=>{const s=Wo.filter(e=>e.attendees.find(e=>e.id===t.id));for(const i of s){const t=_e(1e3*i.event_start),s=_e(1e3*i.event_end);if(e.isAfter(t,"s")&&e.isBefore(s,"m")||n.isAfter(t,"m")&&n.isBefore(s,"m")||t.isAfter(e,"m")&&t.isBefore(n,"m"))return!1}return!0}),a={};return o.forEach(t=>a[t.email]=t),a}}),Object(W.q)({path:"/api/staff/v1/bookings",metadata:{},method:"GET",callback:t=>[]});var Qo=n("8w4p");let Zo=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=i.Pb({type:t,bootstrap:[uo]}),t.\u0275inj=i.Ob({providers:[{provide:i.o,useValue:Qo.a({showDialog:!1})},{provide:co.a,deps:[c.d]}],imports:[[s.a,a.b,o.h,o.p,oo,l.b,d.d,u.a,b.o,h.c,me,$n,pi,r.a.register("ngsw-worker.js",{enabled:!0})]]}),t})();Object(i.X)(),s.d().bootstrapModule(Zo).catch(t=>console.error(t))},zn8P:function(t,e){function n(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="zn8P"}},[[0,0,4]]]);
//# sourceMappingURL=main.js.map