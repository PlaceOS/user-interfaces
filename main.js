(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(t,e,n){t.exports=n("Gv2X")},Gv2X:function(t,e,n){"use strict";n.r(e);var i=n("cUpR"),s=n("8Y7J"),o=n("omvX"),a=n("iInd"),c=n("s7LF"),r=n("3pDu"),l=n("zHaW"),d=n("iELJ"),u=n("pu8Q"),b=n("M9ds"),m=n("f44v"),p=n("SVse"),g=n("vrAh"),h=n("rJgo"),f=n("Dxy4"),_=n("Q2Ze"),v=n("ZTz/"),y=n("TN/R"),O=n("e6WT"),w=n("Tr4x"),k=n("UhP/"),I=n("5QHs"),x=n("GXRp"),j=n("1z/I"),W=n("K2Fw"),X=n("2Vo4"),C=n("quSY");let F=(()=>{class t{constructor(){this._timers={},this._intervals={},this._subscriptions={},this._initialised=new X.a(!1),this.initialised=this._initialised.asObservable()}get is_initialised(){return this._initialised.getValue()}ngOnDestroy(){this.destroy()}destroy(){for(const t in this._timers)this._timers.hasOwnProperty(t)&&this.clearTimeout(t);for(const t in this._intervals)this._intervals.hasOwnProperty(t)&&this.clearInterval(t);for(const t in this._subscriptions)this._subscriptions.hasOwnProperty(t)&&this.unsub(t)}timeout(t,e,n=300){if(!(t&&e&&e instanceof Function))throw new Error(t?"Cannot create named timeout without a name":"Cannot create a timeout without a callback");this.clearTimeout(t),this._timers[t]=setTimeout(()=>{e(),this._timers[t]=null},n)}clearTimeout(t){this._timers[t]&&(clearTimeout(this._timers[t]),this._timers[t]=null)}interval(t,e,n=300){if(!(t&&e&&e instanceof Function))throw new Error(t?"Cannot create named interval without a name":"Cannot create a interval without a callback");this.clearInterval(t),this._intervals[t]=setInterval(()=>e(),n)}clearInterval(t){this._intervals[t]&&(clearInterval(this._intervals[t]),this._intervals[t]=null)}subscription(t,e){this.unsub(t),this._subscriptions[t]=e}unsub(t){this._subscriptions&&this._subscriptions[t]&&(this._subscriptions[t]instanceof C.a?this._subscriptions[t].unsubscribe():this._subscriptions[t](),this._subscriptions[t]=null)}unsubWith(t){const e=Object.keys(this._subscriptions).filter(e=>e.includes(t));for(const n of e)this.unsub(n)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var M=n("mrSG"),q=n("SxV6");function $(t,e){if(1&t&&(s.Xb(0,"main",4),s.Sb(1,"app-icon",5),s.Sb(2,"p",6),s.Wb()),2&t){const t=s.kc();s.Fb(1),s.qc("icon",t.icon),s.Fb(1),s.qc("innerHTML",t.content,s.zc)}}function P(t,e){if(1&t){const t=s.Yb();s.Xb(0,"footer",7),s.Xb(1,"button",8),s.Ic(2),s.Wb(),s.Xb(3,"button",9),s.gc("click",function(){return s.yc(t),s.kc().onConfirm()}),s.Ic(4),s.Wb(),s.Wb()}if(2&t){const t=s.kc();s.Fb(2),s.Kc(" ",t.cancel_text," "),s.Fb(2),s.Kc(" ",t.confirm_text," ")}}function S(t,e){if(1&t&&(s.Xb(0,"main",10),s.Xb(1,"div",11),s.Sb(2,"mat-spinner",12),s.Xb(3,"p"),s.Ic(4),s.Wb(),s.Wb(),s.Wb()),2&t){const t=s.kc();s.Fb(4),s.Jc(t.loading)}}const G={height:"auto",width:"24em",maxHeight:"calc(100vh - 2em)",maxWidth:"calc(100vw - 2em)"};let E=(()=>{class t{constructor(t,e){this._dialog_ref=t,this._data=e,this.event=new s.p,this.title=this._data.title||"Confirm",this.content=this._data.content||"Are you sure?",this.confirm_text=this._data.confirm_text||"Ok",this.cancel_text=this._data.cancel_text||"Cancel",this.icon=this._data.icon||{class:"material-icons",content:"done"},this.disableClose=()=>this._dialog_ref.disableClose=!0,this.enableClose=()=>this._dialog_ref.disableClose=!1}onConfirm(){this._dialog_ref.close("done"),this.event.emit({reason:"done"})}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(d.g),s.Rb(d.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["confirm-modal"]],outputs:{event:"event"},decls:7,vars:4,consts:[["mat-dialog-title",""],["class","flex flex-col items-center space-y-2 px-2",4,"ngIf","ngIfElse"],["class","flex items-center justify-center p-2 space-x-2",4,"ngIf"],["load_state",""],[1,"flex","flex-col","items-center","space-y-2","px-2"],[1,"text-5xl",3,"icon"],["content","",1,"text-center","text-sm",3,"innerHTML"],[1,"flex","items-center","justify-center","p-2","space-x-2"],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","","name","accept",3,"click"],["loading",""],[1,"h-48","w-64","flex","flex-col","items-center","space-y-2"],["diameter","32"]],template:function(t,e){if(1&t&&(s.Xb(0,"header"),s.Xb(1,"h3",0),s.Ic(2),s.Wb(),s.Wb(),s.Gc(3,$,3,2,"main",1),s.Gc(4,P,5,2,"footer",2),s.Gc(5,S,5,1,"ng-template",null,3,s.Hc)),2&t){const t=s.vc(6);s.Fb(2),s.Jc(e.title),s.Fb(1),s.qc("ngIf",!e.loading)("ngIfElse",t),s.Fb(1),s.qc("ngIf",!e.loading)}},styles:["mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%] {\n                min-width: 8em;\n            }"]}),t})(),z="APP";function D(t,e,n,i="debug",s=!1,o=z){if(window.debug||s){const s=["color: #E91E63","color: #3F51B5","color: default"];n?console[i](`%c[${o}]%c[${t}] %c${e}`,...s,n):console[i](`%c[${o}]%c[${t}] %c${e}`,...s)}}function L(t,e){const n=t.shift();return e&&null!=e[n]?t.length>0?L(t,e[n]):e[n]:null}function T(t=[],e=""){return t.filter((t,n,i)=>i.indexOf(i.find(e?n=>n[e]===t[e]:e=>e===t))===n)}function A(t,e=0){return Math.floor(Math.random()*(t-e))+e}function R(t){const e=[...t],n=[];for(;e.length;){const t=e.pop();Array.isArray(t)?e.push(...t):n.push(t)}return n.reverse()}function V(t,e,n,i){return t>=n&&t<i||e>n&&e<i||n>=t&&n<e||i>t&&i<=e}const J=function(t){for(var e=0,n=1779033703^t.length;e<t.length;e++)n=(n=Math.imul(n^t.charCodeAt(e),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}("PlaceOS"),N=(U=2654435769,K=608135816,B=3084996962,H=J(),function(){var t=(U>>>=0)+(K>>>=0)|0;return U=K^K>>>9,K=(B>>>=0)+(B<<3)|0,B=(B=B<<21|B>>>11)+(t=t+(H=1+(H>>>=0)|0)|0)|0,(t>>>0)/4294967296});var U,K,B,H;function Y(t=100,e=0){return Math.floor(N()*(t-e))+e}const Z=["control","shift","alt","meta","os"];let Q=(()=>{class t{constructor(){this.keydown_states={},this.keydown_observers={},this.combo_end=[],this.registered_combos=[],this.counter=0,window.addEventListener("keydown",t=>{const e=this.mapKey((t.code||"").toLowerCase());this.last_down!==e&&(this.keydown_states[e]||(this.keydown_states[e]=new X.a(null),this.keydown_observers[e]=this.keydown_states[e].asObservable()),this.keydown_states[e].next(++this.counter),this.combo_end.indexOf(e)>=0&&t.preventDefault(),this.last_down=e)}),window.addEventListener("keyup",t=>{const e=this.mapKey((t.code||"").toLowerCase());this.keydown_states[e].next(null),this.last_down===e&&(this.last_down=null)})}listen(t,e){const n=(t=t instanceof Array?t:t.split("+")).map(t=>this.mapKey(t.toLowerCase()));if(n.length>0&&this.validCombination(n)){this.registered_combos.push(n);const t=n[n.length-1];return this.keydown_states[t]||(this.keydown_states[t]=new X.a(null),this.keydown_observers[t]=this.keydown_states[t].asObservable()),this.updateCombinationEndList(),this.keydown_observers[t].subscribe(t=>{if(t){const t=[];if(n.length>0){for(const e of n){const n=this.keydown_states[e];t.push(n&&n.getValue()||-1)}for(let e=0;e<n.length-1;e++)if(t[e]>t[e+1])return}t.reduce((t,e)=>t+(e>0?1:-1),0)>=n.length&&e()}})}return null}mapKey(t){return t.indexOf("alt")>=0||t.indexOf("shift")>=0||t.indexOf("control")>=0?t.replace("left","").replace("right",""):t}updateCombinationEndList(){for(const t of this.registered_combos)this.combo_end.push(t[t.length-1]);this.combo_end=T([])}validCombination(t){let e=0;for(const n of t)Z.indexOf(n)<0&&e++;return e>0}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var tt=n("G6Tw"),et=n("sWYD");const nt={debug:!0,composer:{domain:"",route:"/catering",protocol:"",port:"",use_domain:!1,local_login:!1},app:{name:"Catering",title:"PlaceOS",description:"Caterers UI",short_name:"PlaceOS",logo:{type:"img",src:"assets/logo-light.svg"},logo_dark:{type:"img",src:"assets/logo-dark.svg"},general:{}}};let it=(()=>{class t extends F{constructor(t){super(),this._title=t,this._app_name="PlaceOS",this._overrides=new X.a([]),this._subjects={},this._observables={};const e=new Date,n=new Date(1620022642407),i=Object(tt.a)(e,n)?`Today at ${Object(et.a)(n,"h:mma")}`:Object(et.a)(n,"do MMM yyyy, h:mma");D("CORE","null",null,"debug",!0),D("APP",`329721d | Built: ${i}`,null,"debug",!0),this.init()}set overrides(t){this._overrides.next(t)}listen(t){return this._observables[t]||(this._subjects[t]=new X.a(null),this._observables[t]=this._subjects[t].asObservable()),this._observables[t]}post(t,e){this._observables[t]||(this._subjects[t]=new X.a(null),this._observables[t]=this._subjects[t].asObservable()),this._subjects[t].next(e)}value(t){return this._observables[t]?this._subjects[t].getValue():null}get title(){return this._title.getTitle()}set title(t){this._title.setTitle(`${t} | ${this.get("app.name")||this._app_name}`)}init(){var t;return Object(M.a)(this,void 0,void 0,function*(){this.get("debug")&&(window.debug=!0),(null===(t=this.get("app"))||void 0===t?void 0:t.name)&&(this._app_name=this.get("app").name),D("Settings","Successfully loaded settings"),this._initialised.next(!0),window.debug&&(window.application||(window.application={}),window.application.settings=this)})}get app_name(){return this._app_name}get(t){const e=t.split(".");if("app"!==e[0])return L(e,nt);const n=this._overrides.getValue();for(const i of n){const t=L(e.slice(1),i);if(null!=t)return t}return L(e,nt)}}return t.\u0275fac=function(e){return new(e||t)(s.cc(i.c))},t.\u0275prov=s.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var st=n("GS7A");Object(st.m)("show",[Object(st.l)(":enter",[Object(st.k)({opacity:0,height:0}),Object(st.e)(300,Object(st.k)({opacity:1,height:"*"}))]),Object(st.l)(":leave",[Object(st.k)({opacity:1,height:"*"}),Object(st.e)(300,Object(st.k)({opacity:0,height:0}))])]);const ot=Object(st.m)("show",[Object(st.j)("show",Object(st.k)({opacity:1,height:"*"})),Object(st.j)("hide",Object(st.k)({opacity:0,height:0,"pointer-events":"none"})),Object(st.l)("show <=> hide",Object(st.e)("200ms ease-in"))]);function at(t){let e="";if(t)for(const n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=`${e?"&":""}${n}=${t[n]}`);return e}let ct,rt,lt,dt;function ut(t,e,n="OK",i,s={}){if(!ct)throw new Error("Snackbar service hasn't been initialised");const o=ct.open(e,n,Object.assign({panelClass:[t],duration:5e3},s));n&&(i=i||(()=>o.dismiss()),o.onAction().subscribe(()=>i()))}function bt(t,e,n,i={}){console.debug(t),ut("success",t,e,n,i)}function mt(t,e,n,i={}){console.info(t),ut("info",t,e,n,i)}class pt{constructor(t){this._server_names={},this.id=t.id||t.zone_id||t.email||"",this.name=t.name||"",this.email=(t.email||"").toLowerCase()}toJSON(t=!0){const e=Object.assign({},this),n=Object.keys(e);for(const i of n)"_"===i[0]?(e[this._server_names[i.substr(1)]||i.substr(1)]=e[i],delete e[i]):void 0===e[i]&&delete e[i];return e}clone(){return new pt(this)}duplicate(){return new pt(Object.assign(Object.assign({},this),{id:null,email:null}))}}var gt=n("3E0/"),ht=n("un/a"),ft=n("lJxs");class _t extends pt{constructor(t={}){var e;super(t),this.first_name=t.first_name||t.name||"",this.last_name=t.last_name||"",this.phone=t.phone||"",this.organisation=t.organisation||"",this.notes=t.notes||"",this.photo=t.photo||"",this.organizer=!!t.organizer,this.visit_expected=!!t.visit_expected,this.checked_in=!!t.checked_in,this.response_status=t.response_status||"";const n=(t.groups||[]).map(t=>(t||"").toLowerCase());t.sys_admin&&n.push("placeos_admin"),t.support&&n.push("placeos_support"),this.groups=n,this.extension_data=t.extension_data||{},this.extension_data.assistance_required=t.assistance_required||this.extension_data.assistance_required,this.is_external=!!this.email&&!this.email.includes("@place.tech")||this.visit_expected,this.assistance_required=!!(null===(e=this.extension_data)||void 0===e?void 0:e.assistance_required)}}class vt extends _t{constructor(t={}){super(t),this.card_number=t.card_number||"",this.staff_id=t.staff_id||"",this.location=t.location||{},this.is_logged_in=!!t.is_logged_in}}const yt=new X.a(null),Ot=yt.asObservable();function wt(){return yt.getValue()}function kt(t,e){if(1&t&&(s.Xb(0,"div"),s.Xb(1,"app-icon"),s.Ic(2),s.Wb(),s.Wb()),2&t){const t=s.kc();s.Hb("state center "+t.state),s.Fb(2),s.Kc(" ","success"===t.state?"done":"close"," ")}}function It(t,e){1&t&&(s.Xb(0,"div",4),s.Sb(1,"mat-spinner",5),s.Wb()),2&t&&(s.Fb(1),s.qc("diameter",16))}setTimeout(()=>{try{if(jest)return}catch(t){}console.log("Loading logged in user details..."),Object(W.t)("current").pipe(Object(gt.a)(1e3),Object(ht.a)(10),Object(ft.a)(t=>new vt(t))).subscribe(t=>yt.next(t))},300);const xt=["*"];let jt=(()=>{class t{constructor(){this.className="material-icons",this.state=""}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Lb({type:t,selectors:[["action-icon"]],inputs:{icon:"icon",className:"className",content:"content",loading:"loading",disabled:"disabled",state:"state"},ngContentSelectors:xt,decls:6,vars:8,consts:[["mat-icon-button","",1,"relative","flex","items-center","justify-center","h-8","w-8",3,"disabled"],["root","",3,"className","icon"],[3,"class",4,"ngIf"],["class","loader center",4,"ngIf"],[1,"loader","center"],[3,"diameter"]],template:function(t,e){1&t&&(s.pc(),s.Xb(0,"button",0),s.Xb(1,"app-icon",1),s.Ic(2),s.oc(3),s.Wb(),s.Gc(4,kt,3,3,"div",2),s.Gc(5,It,2,1,"div",3),s.Wb()),2&t&&(s.Jb("success","success"===e.state),s.qc("disabled",e.loading||e.disabled),s.Fb(1),s.qc("className",e.className)("icon",e.icon),s.Fb(1),s.Kc(" ",e.content," "),s.Fb(2),s.qc("ngIf",!e.loading&&e.state),s.Fb(1),s.qc("ngIf",e.loading))},styles:[".action-icon.fade[_ngcontent-%COMP%]    > app-icon[_ngcontent-%COMP%] {\n                opacity: 0.35;\n            }\n\n            [center][_ngcontent-%COMP%] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n\n            .success[_ngcontent-%COMP%] {\n                pointer-events: none;\n            }\n\n            .success[_ngcontent-%COMP%]   app-icon[root][_ngcontent-%COMP%] {\n                opacity: 0.2;\n            }\n\n            .state.success[_ngcontent-%COMP%] {\n                color: #388e3c;\n            }\n\n            .state.error[_ngcontent-%COMP%] {\n                color: #e53935;\n            }"]}),t})(),Wt=(()=>{class t{constructor(t){this.sanitizer=t}transform(t,e="html"){switch(e){case"resource":return this.sanitizer.bypassSecurityTrustResourceUrl(t);case"url":return this.sanitizer.bypassSecurityTrustUrl(t);case"script":return this.sanitizer.bypassSecurityTrustScript(t);case"style":return this.sanitizer.bypassSecurityTrustStyle(t);default:return this.sanitizer.bypassSecurityTrustHtml(t)}}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(i.b))},t.\u0275pipe=s.Qb({name:"safe",type:t,pure:!0}),t})();function Xt(t,e){if(1&t&&(s.Xb(0,"i"),s.Ic(1),s.oc(2),s.Wb()),2&t){const t=s.kc();s.Hb((null==t.icon?null:t.icon.class)||t.className),s.Fb(1),s.Kc(" ",null==t.icon?null:t.icon.content," ")}}function Ct(t,e){if(1&t&&(s.Sb(0,"img",3),s.lc(1,"safe")),2&t){const t=s.kc();s.qc("src",s.nc(1,1,t.icon.src,"resource"),s.Ac)}}const Ft=["*"];let Mt=(()=>{class t{constructor(){this.className="material-icons"}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Lb({type:t,selectors:[["app-icon"]],inputs:{className:"className",icon:"icon"},ngContentSelectors:Ft,decls:3,vars:2,consts:[[1,"app-icon"],[3,"class",4,"ngIf"],[3,"src",4,"ngIf"],[3,"src"]],template:function(t,e){1&t&&(s.pc(),s.Xb(0,"div",0),s.Gc(1,Xt,3,3,"i",1),s.Gc(2,Ct,2,4,"img",2),s.Wb()),2&t&&(s.Fb(1),s.qc("ngIf",!e.icon||"img"!==e.icon.type),s.Fb(1),s.qc("ngIf",e.icon&&"img"===e.icon.type))},directives:[p.n],pipes:[Wt],styles:[".app-icon[_ngcontent-%COMP%] {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 1.25em;\n                width: 1.25em;\n            }\n\n            i[_ngcontent-%COMP%] {\n                font-size: 1em;\n            }\n\n            img[_ngcontent-%COMP%] {\n                height: 1em;\n                width: 1em;\n            }"]}),t})();function qt(t,e){if(1&t){const t=s.Yb();s.Xb(0,"button",2),s.gc("click",function(){s.yc(t);const n=e.$implicit,i=s.kc();return i.action.emit(n.id),i.show=!1}),s.Sb(1,"app-icon",3),s.Wb()}if(2&t){const t=e.$implicit,n=e.index,i=s.kc();s.Dc("top",i.show?-110*n-60+"%":""),s.Fb(1),s.qc("icon",t)}}let $t=(()=>{class t extends F{constructor(){super(...arguments),this.actions=[],this.action=new s.p}close(){this.timeout("close",()=>this.show=!1)}}return t.\u0275fac=function(e){return Pt(e||t)},t.\u0275cmp=s.Lb({type:t,selectors:[["a-popout-menu"]],inputs:{actions:"actions"},outputs:{action:"action"},features:[s.Cb],decls:4,vars:4,consts:[["mat-icon-button","","class","small absolute text-base center shadow",3,"top","click",4,"ngFor","ngForOf"],["name","root","mat-icon-button","",3,"click"],["mat-icon-button","",1,"small","absolute","text-base","center","shadow",3,"click"],[3,"icon"]],template:function(t,e){1&t&&(s.Gc(0,qt,2,3,"button",0),s.Xb(1,"button",1),s.gc("click",function(){return e.show=!e.show})("click",function(){return e.show?e.close():""},!1,s.xc),s.Xb(2,"app-icon"),s.Ic(3),s.Wb(),s.Wb()),2&t&&(s.qc("ngForOf",e.actions),s.Fb(1),s.Jb("show",e.show),s.Fb(2),s.Jc(e.show?"add":"more_vert"))},styles:["[_nghost-%COMP%] {\n                position: relative;\n            }\n\n            app-icon[_ngcontent-%COMP%] {\n                transition: transform 200ms;\n            }\n\n            button[_ngcontent-%COMP%] {\n                background-color: #fff;\n                color: rgba(#000, 0.85);\n                font-size: 1.25rem;\n                height: 2.5em;\n                width: 2.5em;\n            }\n\n            button.show[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%] {\n                transform: rotate(45deg);\n            }\n\n            button.small[_ngcontent-%COMP%] {\n                transition: top 200ms, left 200ms;\n            }"]}),t})();const Pt=s.Zb($t);n("ktL7");const St=new s.u("Data for Map Features");function Gt(t,e){1&t&&(s.Vb(0),s.oc(1),s.Ub())}n("7xvl");const Et=function(t){return[t]};function zt(t,e){if(1&t&&(s.Xb(0,"a",8),s.Ic(1),s.Wb()),2&t){const t=e.$implicit;s.qc("routerLink",s.sc(2,Et,t.route)),s.Fb(1),s.Kc(" ",t.name," ")}}function Dt(t,e){if(1&t&&(s.Vb(0),s.Xb(1,"div",4),s.Xb(2,"app-icon"),s.Ic(3),s.Wb(),s.Wb(),s.Xb(4,"div",5),s.Gc(5,Gt,2,0,"ng-container",1),s.Wb(),s.Xb(6,"div",6),s.Gc(7,zt,2,4,"a",7),s.Wb(),s.Ub()),2&t){const t=s.kc(),e=s.vc(3);s.Fb(1),s.Jb("text-success",!t.error)("text-error",t.error),s.Fb(2),s.Jc(t.error?"close":"done"),s.Fb(2),s.qc("ngIf",!t.error)("ngIfElse",e),s.Fb(2),s.qc("ngForOf",t.links)}}function Lt(t,e){if(1&t&&(s.Xb(0,"p",9),s.Ic(1),s.Wb()),2&t){const t=s.kc();s.Fb(1),s.Jc(t.error)}}function Tt(t,e){if(1&t&&(s.Sb(0,"mat-spinner",10),s.Xb(1,"p",11),s.Ic(2),s.Wb()),2&t){const t=s.kc();s.qc("diameter",32),s.Fb(2),s.Jc(t.loading)}}const At=["*"];let Rt=(()=>{class t{constructor(){this.loading="",this.error="",this.links=[]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Lb({type:t,selectors:[["status-overlay"]],inputs:{loading:"loading",error:"error",links:"links"},ngContentSelectors:At,decls:6,vars:2,consts:[["status-overlay","",1,"fixed","inset-0","flex","flex-col","bg-secondary","items-center","justify-center","z-50","text-white"],[4,"ngIf","ngIfElse"],["error_msg",""],["load_state",""],[1,"text-4xl","rounded-full","bg-white","mb-4"],[1,"text-center","text-lg","mb-4"],[1,"flex","items-center","space-x-2"],["button","","mat-button","","class","w-32",3,"routerLink",4,"ngFor","ngForOf"],["button","","mat-button","",1,"w-32",3,"routerLink"],["error",""],[1,"mb-4",3,"diameter"],["loading","",1,"text-center","text-lg"]],template:function(t,e){if(1&t&&(s.pc(),s.Xb(0,"div",0),s.Gc(1,Dt,8,8,"ng-container",1),s.Wb(),s.Gc(2,Lt,2,1,"ng-template",null,2,s.Hc),s.Gc(4,Tt,3,2,"ng-template",null,3,s.Hc)),2&t){const t=s.vc(5);s.Fb(1),s.qc("ngIf",!e.loading)("ngIfElse",t)}},styles:[""]}),t})();n("LUZP"),n("OaSA"),n("HDdC"),n("1O3W"),"0123456789".split(""),"qwertyuiop".split(""),"asdfghjkl".split(""),"zxcvbnm".split("");let Vt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Lb({type:t,selectors:[["app-unauthorised"]],decls:9,vars:0,consts:function(){let t,e,n;return t=$localize`:@@forbiddenLabel␟56a20d819b6e59b0de025988a3f9ed7d6a1bc08c␟4136336337692896315:Access forbidden.`,e=$localize`:@@invalidPermissionLabel␟7afe2eb69e486929c5a29d67e6f24975f97604c4␟8887025903012875176: You do not have permission to view this page and your access attempt has been recorded. `,n=$localize`:@@contactAdminLabel␟1520ecc736c82366b62d64a515b1c3b222c9e1df␟1824441478452454363: Contact your Administrator if you feel that you should have access. `,[[1,"unauthorised","rounded","m-4","text-center","bg-white","text-black","border","border-gray-400","p-4","shadow"],[1,"text-4xl"],[1,"text-2xl"],t,[1,"py-4"],e,n]},template:function(t,e){1&t&&(s.Xb(0,"div",0),s.Xb(1,"h1",1),s.Ic(2,"403"),s.Wb(),s.Xb(3,"h3",2),s.bc(4,3),s.Wb(),s.Xb(5,"p",4),s.bc(6,5),s.Wb(),s.Xb(7,"p"),s.bc(8,6),s.Wb(),s.Wb())},styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .unauthorised[_ngcontent-%COMP%] {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                .unauthorised[_ngcontent-%COMP%] {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }"]}),t})();const Jt=[g.b,h.c,_.e,v.b,f.c,g.b,v.b,d.f,y.a,O.c,w.b,u.a,m.e,I.b,x.r,j.f];let Nt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.Pb({type:t}),t.\u0275inj=s.Ob({providers:[{provide:k.f,useValue:"en-GB"},{provide:St,useValue:{}}],imports:[[p.c,c.e,c.l,...Jt],g.b,h.c,_.e,v.b,f.c,g.b,v.b,d.f,y.a,O.c,w.b,u.a,m.e,I.b,x.r,j.f]}),t})();s.Bc(jt,[f.b,Mt,p.n,u.b],[]),s.Bc($t,[p.m,f.b,Mt],[]),s.Bc(E,[d.h,p.n,Mt,f.b,d.d,u.b],[]),s.Bc(Rt,[p.n,Mt,p.m,f.a,u.b],[]);const Ut=[{id:"after_hour",name:"After Hour"},{id:"before_hour",name:"Before Hour"},{id:"min_length",name:"Min. Meeting Length"},{id:"max_length",name:"Max. Meeting Length"},{id:"is_before",name:"Is Before Time"},{id:"is_after",name:"Is After Time"},{id:"visitor_type",name:"Visitor Type"},{id:"groups",name:"User in Groups"}];function Kt(t,e){1&t&&(s.Xb(0,"button",5),s.Xb(1,"app-icon"),s.Ic(2,"close"),s.Wb(),s.Wb())}function Bt(t,e){if(1&t&&(s.Xb(0,"mat-option",18),s.Ic(1),s.Wb()),2&t){const t=e.$implicit;s.qc("value",t.id),s.Fb(1),s.Kc(" ",t.name," ")}}function Ht(t,e){if(1&t&&(s.Xb(0,"div",14),s.Xb(1,"mat-form-field",8),s.Xb(2,"mat-select",15),s.gc("ngModelChange",function(t){return e.$implicit[0]=t}),s.Gc(3,Bt,2,2,"mat-option",16),s.Wb(),s.Wb(),s.Xb(4,"mat-form-field",8),s.Xb(5,"input",17),s.gc("ngModelChange",function(t){return e.$implicit[1]=t}),s.Wb(),s.Xb(6,"mat-error"),s.Ic(7,"Rule value is required"),s.Wb(),s.Wb(),s.Wb()),2&t){const t=e.$implicit,n=s.kc(2);s.Fb(2),s.qc("ngModel",t[0]),s.Fb(1),s.qc("ngForOf",n.rule_types),s.Fb(2),s.qc("ngModel",t[1])}}function Yt(t,e){if(1&t){const t=s.Yb();s.Xb(0,"div",6),s.Xb(1,"div",7),s.Xb(2,"mat-form-field",8),s.Xb(3,"input",9),s.gc("ngModelChange",function(t){return e.$implicit.name=t}),s.Wb(),s.Xb(4,"mat-error"),s.Ic(5,"Ruleset name is required"),s.Wb(),s.Wb(),s.Xb(6,"button",10),s.gc("click",function(){s.yc(t);const n=e.$implicit,i=s.kc();return n.rules.push(["",""]),i.show_rules=n.id}),s.Xb(7,"app-icon"),s.Ic(8,"add"),s.Wb(),s.Wb(),s.Xb(9,"button",11),s.gc("click",function(){s.yc(t);const n=e.$implicit,i=s.kc();return i.show_rules=i.show_rules!==n.id?n.id:""}),s.Xb(10,"app-icon"),s.Ic(11),s.Wb(),s.Wb(),s.Wb(),s.Xb(12,"div",12),s.Gc(13,Ht,8,3,"div",13),s.Wb(),s.Wb()}if(2&t){const t=e.$implicit,n=s.kc();s.Fb(3),s.qc("ngModel",t.name),s.Fb(6),s.qc("disabled",!t.rules.length),s.Fb(2),s.Jc(n.show_rules===t.id?"expand_less":"expand_more"),s.Fb(1),s.Dc("height",(n.show_rules===t.id?3.5*t.rules.length:0)+"em"),s.Fb(1),s.qc("ngForOf",t.rules)}}let Zt=(()=>{class t{constructor(t){this._data=t,this.event=new s.p,this.loading=!1,this.rule_types=Ut,this.rulesets=(t.config||[]).map(t=>(t.rules=t.rules.map(t=>[t[0],JSON.stringify(t[1])]),t))}get new_id(){return"ruleset-"+Math.floor(99999999*Math.random())}saveChanges(){const t=this.rulesets.map(t=>Object.assign(Object.assign({},t),{rules:t.rules.map(t=>{let e=t[1];try{e=JSON.parse(t[1])}catch(n){}return[t[0],e]})}));this.event.emit({reason:"done",metadata:t})}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(d.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["catering-config-modal"]],outputs:{event:"event"},decls:11,vars:2,consts:[["mat-icon-button","","mat-dialog-close","",4,"ngIf"],[1,"overflow-auto","text-center"],["mat-button","",3,"click"],["class","ruleset",4,"ngFor","ngForOf"],[1,"flex","p-2","items-center","justify-center","border-none","border-t","border-solid","border-gray-300"],["mat-icon-button","","mat-dialog-close",""],[1,"ruleset"],[1,"flex"],["appearance","outline",1,"flex-1"],["matInput","","name","name","placeholder","Zone ID, Category or Tag","required","",3,"ngModel","ngModelChange"],["mat-icon-button","",1,"mb-6",3,"click"],["mat-icon-button","",1,"mb-6",3,"disabled","click"],["name","rules",1,"bg-gray-100","rounded","overflow-hidden"],["class","flex px-2 h-14 space-x-2",4,"ngFor","ngForOf"],[1,"flex","px-2","h-14","space-x-2"],["name","booking-type","placeholder","Select Rule",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","name","value","placeholder","Rule value","required","",3,"ngModel","ngModelChange"],[3,"value"]],template:function(t,e){1&t&&(s.Xb(0,"header"),s.Xb(1,"h3"),s.Ic(2,"Edit Catering Configuration"),s.Wb(),s.Gc(3,Kt,3,0,"button",0),s.Wb(),s.Xb(4,"main",1),s.Xb(5,"button",2),s.gc("click",function(){return e.rulesets.push({id:e.new_id,rules:[]})}),s.Ic(6," New Ruleset "),s.Wb(),s.Gc(7,Yt,14,6,"div",3),s.Wb(),s.Xb(8,"footer",4),s.Xb(9,"button",2),s.gc("click",function(){return e.saveChanges()}),s.Ic(10,"Save Changes"),s.Wb(),s.Wb()),2&t&&(s.Fb(3),s.qc("ngIf",!e.loading),s.Fb(4),s.qc("ngForOf",e.rulesets))},directives:[p.n,f.b,p.m,d.d,Mt,_.c,O.b,_.b,v.a,k.k],styles:["[name='rules'][_ngcontent-%COMP%] {\n                transition: height 200ms;\n            }\n\n            main[_ngcontent-%COMP%] {\n                width: 32em;\n                padding: 0.5em 1em 1em;\n            }\n\n            main[_ngcontent-%COMP%]   button.mat-button[_ngcontent-%COMP%] {\n                margin: 0 auto 0.5em;\n                min-width: 12em;\n            }"]}),t})();var Qt=n("Ht+U");class te{constructor(t={}){this.id=t.id||"",this.name=t.name||t.id||"",this.category=t.category||"",this.unit_price=t.unit_price||0,this.description=t.description||"",this.quantity=t.quantity||0,this.options=t.options||[],this.tags=t.tags||[],this.total_cost=(this.unit_price+this.options.map(t=>t.unit_price||0).reduce((t,e)=>t+e,0))*this.quantity}}const ee=function(){return{type:"icon",class:"material-icons",content:"close"}};function ne(t,e){1&t&&(s.Xb(0,"button",7),s.Sb(1,"app-icon",8),s.Wb()),2&t&&(s.Fb(1),s.qc("icon",s.rc(1,ee)))}function ie(t,e){if(1&t&&(s.Xb(0,"div",11),s.Xb(1,"label",12),s.Ic(2," Name"),s.Xb(3,"span"),s.Ic(4,"*"),s.Wb(),s.Ic(5,": "),s.Wb(),s.Xb(6,"mat-form-field",13),s.Sb(7,"input",14),s.Xb(8,"mat-error"),s.Ic(9,"Name is required"),s.Wb(),s.Wb(),s.Wb()),2&t){const t=s.kc(2);s.Fb(1),s.Jb("error",t.form.controls.name.invalid&&t.form.controls.name.touched)}}function se(t,e){if(1&t&&(s.Xb(0,"div",11),s.Xb(1,"label",15),s.Ic(2," Category"),s.Xb(3,"span"),s.Ic(4,"*"),s.Wb(),s.Ic(5,": "),s.Wb(),s.Xb(6,"mat-form-field",13),s.Sb(7,"input",16),s.Xb(8,"mat-error"),s.Ic(9,"Category is required"),s.Wb(),s.Wb(),s.Wb()),2&t){const t=s.kc(2),e=s.vc(9);s.Fb(1),s.Jb("error",t.form.controls.category.invalid&&t.form.controls.category.touched),s.Fb(6),s.qc("matAutocomplete",e)}}const oe=function(){return{class:"material-icons",content:"close"}};function ae(t,e){if(1&t){const t=s.Yb();s.Xb(0,"mat-chip",23),s.gc("removed",function(){s.yc(t);const n=e.$implicit;return s.kc(3).removeTag(n)}),s.Ic(1),s.Sb(2,"app-icon",24),s.Wb()}if(2&t){const t=e.$implicit;s.qc("selectable",!0)("removable",!0),s.Fb(1),s.Kc(" ",t," "),s.Fb(1),s.qc("icon",s.rc(4,oe))}}function ce(t,e){if(1&t){const t=s.Yb();s.Xb(0,"div",11),s.Xb(1,"label",17),s.bc(2,18),s.Wb(),s.Xb(3,"mat-form-field",13),s.Xb(4,"mat-chip-list",19,20),s.Gc(6,ae,3,5,"mat-chip",21),s.Xb(7,"input",22),s.gc("matChipInputTokenEnd",function(e){return s.yc(t),s.kc(2).addTag(e)}),s.Wb(),s.Wb(),s.Wb(),s.Wb()}if(2&t){const t=s.vc(5),e=s.kc(2);s.Fb(1),s.Jb("error",e.form.controls.tags.invalid&&e.form.controls.tags.touched),s.Fb(5),s.qc("ngForOf",e.tag_list),s.Fb(1),s.qc("matChipInputFor",t)("matChipInputSeparatorKeyCodes",e.separators)("matChipInputAddOnBlur",!0)}}function re(t,e){1&t&&(s.Xb(0,"div",11),s.Xb(1,"label",25),s.Ic(2,"Description:"),s.Wb(),s.Xb(3,"mat-form-field",13),s.Sb(4,"textarea",26),s.Wb(),s.Wb())}function le(t,e){if(1&t&&(s.Xb(0,"div",11),s.Xb(1,"label",12),s.Ic(2," Unit Price"),s.Xb(3,"span"),s.Ic(4,"*"),s.Wb(),s.Ic(5,": "),s.Wb(),s.Xb(6,"mat-form-field",13),s.Sb(7,"input",27),s.Xb(8,"mat-error"),s.Ic(9,"Unit Price is required"),s.Wb(),s.Wb(),s.Wb()),2&t){const t=s.kc(2);s.Fb(1),s.Jb("error",t.form.controls.unit_price.invalid&&t.form.controls.unit_price.touched)}}function de(t,e){if(1&t&&(s.Xb(0,"form",9),s.Gc(1,ie,10,2,"div",10),s.Gc(2,se,10,3,"div",10),s.Gc(3,ce,8,6,"div",10),s.Gc(4,re,5,0,"div",10),s.Gc(5,le,10,2,"div",10),s.Wb()),2&t){const t=s.kc();s.qc("formGroup",t.form),s.Fb(1),s.qc("ngIf",t.form.controls.name),s.Fb(1),s.qc("ngIf",t.form.controls.category),s.Fb(1),s.qc("ngIf",t.form.controls.tags),s.Fb(1),s.qc("ngIf",t.form.controls.description),s.Fb(1),s.qc("ngIf",t.form.controls.unit_price)}}function ue(t,e){if(1&t){const t=s.Yb();s.Xb(0,"footer",28),s.Xb(1,"button",29),s.gc("click",function(){return s.yc(t),s.kc().saveChanges()}),s.Ic(2,"Save"),s.Wb(),s.Wb()}if(2&t){const t=s.kc();s.Fb(1),s.qc("disabled",!t.form.dirty)}}function be(t,e){1&t&&(s.Xb(0,"div",30),s.Xb(1,"div",31),s.Xb(2,"div",32),s.Sb(3,"mat-spinner",33),s.Wb(),s.Xb(4,"div",34),s.Ic(5,"Saving catering item..."),s.Wb(),s.Wb(),s.Wb())}function me(t,e){if(1&t&&(s.Xb(0,"mat-option",35),s.Ic(1),s.Wb()),2&t){const t=e.$implicit;s.qc("value",t),s.Fb(1),s.Kc(" ",t," ")}}let pe=(()=>{class t{constructor(t){this._data=t,this.event=new s.p,this.loading=!1,this.separators=[Qt.g,Qt.c,Qt.o]}get item(){return this._data.item}get categories(){return this._data.categories||[]}get tag_list(){return this.form.controls.tags.value}ngOnInit(){this.form=new c.c({name:new c.b(this.item.name||"",[c.m.required]),description:new c.b(this.item.description||""),category:new c.b(this.item.category||"",[c.m.required]),unit_price:new c.b(this.item.unit_price,[c.m.required]),tags:new c.b(this.item.tags||[])})}addTag(t){if(!this.form||!this.form.controls.tags)return;this.form.controls.tags.markAsDirty();const e=t.input,n=t.value,i=this.tag_list;(n||"").trim()&&(i.push(n),this.form.controls.tags.setValue(i)),e&&(e.value="")}removeTag(t){if(!this.form||!this.form.controls.tags)return;const e=this.tag_list;this.form.controls.tags.markAsDirty();const n=e.indexOf(t);n>=0&&(e.splice(n,1),this.form.controls.tags.setValue(e))}saveChanges(){this.loading=!0,this.event.emit({reason:"done",metadata:{item:new te(Object.assign(Object.assign(Object.assign({},this.item),{id:this.item.id||`item-${A(99999999)}`}),this.form.value))}})}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(d.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["catering-item-modal"]],outputs:{event:"event"},decls:11,vars:6,consts:function(){let t,e;return t=$localize`:@@tagsLabel␟800ffadd463cfe152c5af3fa9f13803ab2e77b93␟4746186018558508280: Tags: `,e=$localize`:@@zoneTagsPlaceholder␟8dc7c13b0c6b8ad9c770bce0ad72e14b4aef8456␟3986010900542572161:Zone tags...`,[["mat-dialog-title",""],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","p-4 overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex p-2 items-center justify-center border-none border-t border-solid border-gray-300",4,"ngIf"],["load_state",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","mat-dialog-close",""],[3,"icon"],[1,"p-4","overflow-auto",3,"formGroup"],["class","field",4,"ngIf"],[1,"field"],["for","title"],["appearance","outline"],["matInput","","name","name","placeholder","Item name","formControlName","name"],["for","category"],["matInput","","name","category","placeholder","Category","formControlName","category",3,"matAutocomplete"],["for","tags"],t,["aria-label","Item Tags"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["name","tags","placeholder",e,3,"matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],[3,"selectable","removable","removed"],["matChipRemove","",3,"icon"],["for","description"],["matInput","","name","description","placeholder","Item Description","formControlName","description"],["matInput","","name","unit-price","type","number","placeholder","Unit Price","formControlName","unit_price"],[1,"flex","p-2","items-center","justify-center","border-none","border-t","border-solid","border-gray-300"],["mat-button","",3,"disabled","click"],[1,"body"],[1,"info-block"],[1,"icon"],["diameter","32"],[1,"text"],[3,"value"]]},template:function(t,e){if(1&t&&(s.Xb(0,"header"),s.Xb(1,"h3",0),s.Ic(2),s.Wb(),s.Gc(3,ne,2,2,"button",1),s.Wb(),s.Gc(4,de,6,6,"form",2),s.Gc(5,ue,3,1,"footer",3),s.Gc(6,be,6,0,"ng-template",null,4,s.Hc),s.Xb(8,"mat-autocomplete",null,5),s.Gc(10,me,2,2,"mat-option",6),s.Wb()),2&t){const t=s.vc(7);s.Fb(2),s.Kc("",e.item.id?"Edit":"Add"," Item"),s.Fb(1),s.qc("ngIf",!e.loading),s.Fb(1),s.qc("ngIf",e.form&&!e.loading)("ngIfElse",t),s.Fb(1),s.qc("ngIf",!e.loading),s.Fb(5),s.qc("ngForOf",e.categories)}},directives:[d.h,p.n,g.a,p.m,f.b,d.d,Mt,_.c,O.b,_.b,g.c,m.c,m.b,m.a,m.d,u.b,k.k],styles:[".field[_ngcontent-%COMP%] {\n                display: flex;\n                flex-wrap: wrap;\n            }"]}),t})();const ge=function(){return{type:"icon",class:"material-icons",content:"close"}};function he(t,e){1&t&&(s.Xb(0,"button",7),s.Sb(1,"app-icon",8),s.Wb()),2&t&&(s.Fb(1),s.qc("icon",s.rc(1,ge)))}function fe(t,e){if(1&t&&(s.Xb(0,"div",11),s.Xb(1,"label",12),s.Ic(2," Name"),s.Xb(3,"span"),s.Ic(4,"*"),s.Wb(),s.Ic(5,": "),s.Wb(),s.Xb(6,"mat-form-field",13),s.Sb(7,"input",14),s.Xb(8,"mat-error"),s.Ic(9,"Name is required"),s.Wb(),s.Wb(),s.Wb()),2&t){const t=s.kc(2);s.Fb(1),s.Jb("error",t.form.controls.name.invalid&&t.form.controls.name.touched)}}function _e(t,e){if(1&t&&(s.Xb(0,"div",11),s.Xb(1,"label",15),s.Ic(2," Type"),s.Xb(3,"span"),s.Ic(4,"*"),s.Wb(),s.Ic(5,": "),s.Wb(),s.Xb(6,"mat-form-field",13),s.Sb(7,"input",16),s.Xb(8,"mat-error"),s.Ic(9,"Type is required"),s.Wb(),s.Wb(),s.Wb()),2&t){const t=s.kc(2),e=s.vc(9);s.Fb(1),s.Jb("error",t.form.controls.group.invalid&&t.form.controls.group.touched),s.Fb(6),s.qc("matAutocomplete",e)}}function ve(t,e){1&t&&(s.Xb(0,"div",11),s.Xb(1,"label",12),s.Ic(2,"Unit Price:"),s.Wb(),s.Xb(3,"mat-form-field",13),s.Sb(4,"input",17),s.Wb(),s.Wb())}function ye(t,e){1&t&&(s.Xb(0,"div",11),s.Xb(1,"mat-checkbox",18),s.Ic(2,"Can select multiple of type"),s.Wb(),s.Wb())}function Oe(t,e){if(1&t&&(s.Xb(0,"form",9),s.Gc(1,fe,10,2,"div",10),s.Gc(2,_e,10,3,"div",10),s.Gc(3,ve,5,0,"div",10),s.Gc(4,ye,3,0,"div",10),s.Wb()),2&t){const t=s.kc();s.qc("formGroup",t.form),s.Fb(1),s.qc("ngIf",t.form.controls.name),s.Fb(1),s.qc("ngIf",t.form.controls.group),s.Fb(1),s.qc("ngIf",t.form.controls.unit_price),s.Fb(1),s.qc("ngIf",t.form.controls.multiple)}}function we(t,e){if(1&t){const t=s.Yb();s.Xb(0,"footer",19),s.Xb(1,"button",20),s.gc("click",function(){return s.yc(t),s.kc().saveChanges()}),s.Ic(2,"Save"),s.Wb(),s.Wb()}if(2&t){const t=s.kc();s.Fb(1),s.qc("disabled",!t.form.dirty)}}function ke(t,e){1&t&&(s.Xb(0,"div",21),s.Xb(1,"div",22),s.Xb(2,"div",23),s.Sb(3,"mat-spinner",24),s.Wb(),s.Xb(4,"div",25),s.Ic(5,"Saving catering item..."),s.Wb(),s.Wb(),s.Wb())}function Ie(t,e){if(1&t&&(s.Xb(0,"mat-option",26),s.Ic(1),s.Wb()),2&t){const t=e.$implicit;s.qc("value",t),s.Fb(1),s.Kc(" ",t," ")}}let xe=(()=>{class t{constructor(t){this._data=t,this.event=new s.p,this.loading=!1}get option(){return this._data.option}get types(){return this._data.types||[]}ngOnInit(){this.form=new c.c({name:new c.b(this.option.name||"",[c.m.required]),group:new c.b(this.option.group||"",[c.m.required]),unit_price:new c.b(this.option.unit_price),multiple:new c.b(!!this.option.multiple,[])})}saveChanges(){this.loading=!0;const t=Object.assign(Object.assign(Object.assign({},this.option),{id:this.option.id||`option-${A(99999999)}`}),this.form.value);this.event.emit({reason:"done",metadata:{item:new te(Object.assign(Object.assign({},this._data.parent),{options:this._data.parent.options.filter(e=>e.id!==t.id).concat([t])}))}})}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(d.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["catering-option-modal"]],outputs:{event:"event"},decls:11,vars:6,consts:[["mat-dialog-title",""],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","p-4 overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex p-2 items-center justify-center border-none border-t border-solid border-gray-300",4,"ngIf"],["load_state",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","mat-dialog-close",""],[3,"icon"],[1,"p-4","overflow-auto",3,"formGroup"],["class","field",4,"ngIf"],[1,"field"],["for","title"],["appearance","outline"],["matInput","","name","name","placeholder","Item name","formControlName","name"],["for","group"],["matInput","","name","group","placeholder","Type of option e.g. Number of sugars","formControlName","group",3,"matAutocomplete"],["matInput","","name","unit-price","type","number","placeholder","Unit Price","formControlName","unit_price"],["name","multiple","formControlName","multiple"],[1,"flex","p-2","items-center","justify-center","border-none","border-t","border-solid","border-gray-300"],["mat-button","",3,"disabled","click"],[1,"body"],[1,"info-block"],[1,"icon"],["diameter","32"],[1,"text"],[3,"value"]],template:function(t,e){if(1&t&&(s.Xb(0,"header"),s.Xb(1,"h3",0),s.Ic(2),s.Wb(),s.Gc(3,he,2,2,"button",1),s.Wb(),s.Gc(4,Oe,5,5,"form",2),s.Gc(5,we,3,1,"footer",3),s.Gc(6,ke,6,0,"ng-template",null,4,s.Hc),s.Xb(8,"mat-autocomplete",null,5),s.Gc(10,Ie,2,2,"mat-option",6),s.Wb()),2&t){const t=s.vc(7);s.Fb(2),s.Kc("",e.option.id?"Edit":"Add"," Item Option"),s.Fb(1),s.qc("ngIf",!e.loading),s.Fb(1),s.qc("ngIf",e.form&&!e.loading)("ngIfElse",t),s.Fb(1),s.qc("ngIf",!e.loading),s.Fb(5),s.qc("ngForOf",e.types)}},directives:[d.h,p.n,g.a,p.m,f.b,d.d,Mt,_.c,O.b,_.b,g.c,u.b,k.k],styles:[".field[_ngcontent-%COMP%] {\n                display: flex;\n                flex-wrap: wrap;\n            }"]}),t})();class je{constructor(t={}){var e,n;this.id=t.id||`order-${A(9999999,1e6)}`,this.event_id=t.event_id||(null===(e=t.event)||void 0===e?void 0:e.id)||"",this.items=(t.items||[]).map(t=>new te(t)),this.system_id=t.system_id,this.item_count=this.items.reduce((t,e)=>t+e.quantity,0),this.total_cost=this.items.reduce((t,e)=>t+(e.total_cost||0),0),this.charge_code=t.charge_code||"",this.status=t.status||"accepted",this.invoice_number=t.invoice_number||"",this.event=t.event||null,this.deliver_at=t.deliver_at||t.date||(null===(n=this.event)||void 0===n?void 0:n.date)||(new Date).getTime()}}var We=n("EhJz"),Xe=n("XQXX"),Ce=n("dndX"),Fe=n("IjAw"),Me=n("4bjS"),qe=(n("0LOL"),n("5wMr"),n("VSY4"),n("jG/O")),$e=n("IYaI");const Pe={month:43200,months:43200,week:10080,weeks:10080,day:1440,days:1440,hour:60,hours:60,minute:1,minutes:1};function Se(t){const e=t.split(" ");return+e[0]*Pe[e[1]]}function Ge(t,e){1&t&&(s.Xb(0,"div",18),s.Ic(1," Options Available "),s.Wb())}Object(Fe.a)(Object(Me.a)(Object(Xe.a)(new Date,6),0),{days:-1});const Ee=function(){return{class:"material-icons",content:"add"}};function ze(t,e){if(1&t){const t=s.Yb();s.Xb(0,"div",11),s.Xb(1,"div",12),s.Xb(2,"div",13),s.Ic(3),s.Wb(),s.Gc(4,Ge,2,0,"div",14),s.Wb(),s.Xb(5,"div",15),s.Ic(6),s.lc(7,"currency"),s.Wb(),s.Xb(8,"button",16),s.gc("click",function(){s.yc(t);const n=e.$implicit;return s.kc(5).addItem(n)}),s.Sb(9,"app-icon",17),s.Wb(),s.Wb()}if(2&t){const t=e.$implicit;s.Fb(3),s.Jc(t.name),s.Fb(1),s.qc("ngIf",t.options.length),s.Fb(2),s.Jc(s.mc(7,4,t.unit_price/100)),s.Fb(3),s.qc("icon",s.rc(6,Ee))}}const De=function(){return{}};function Le(t,e){if(1&t&&(s.Xb(0,"mat-tab",8),s.Xb(1,"div",9),s.Gc(2,ze,10,7,"div",10),s.lc(3,"async"),s.Wb(),s.Wb()),2&t){const t=s.kc().$implicit,e=s.kc(3);s.qc("label",t),s.Fb(2),s.qc("ngForOf",(s.mc(3,2,e.menu_items$)||s.rc(4,De))[t])}}function Te(t,e){if(1&t&&(s.Vb(0),s.Gc(1,Le,4,5,"mat-tab",7),s.lc(2,"async"),s.Ub()),2&t){const t=e.$implicit,n=s.kc(3);s.Fb(1),s.qc("ngIf",(s.mc(2,1,n.menu_items$)||s.rc(3,De))[t].length)}}function Ae(t,e){if(1&t&&(s.Vb(0),s.Xb(1,"mat-tab-group"),s.Gc(2,Te,3,4,"ng-container",6),s.lc(3,"async"),s.Wb(),s.Ub()),2&t){const t=s.kc(2);s.Fb(2),s.qc("ngForOf",s.mc(3,1,t.categories))}}function Re(t,e){if(1&t&&(s.Xb(0,"div",4),s.Gc(1,Ae,4,3,"ng-container",5),s.Wb()),2&t){const t=s.kc(),e=s.vc(6);s.Fb(1),s.qc("ngIf",!t.show_order_details)("ngIfElse",e)}}function Ve(t,e){if(1&t){const t=s.Yb();s.Vb(0),s.Xb(1,"button",20),s.Ic(2,"Cancel"),s.Wb(),s.Xb(3,"button",21),s.gc("click",function(){return s.yc(t),s.kc(2).confirmOrder()}),s.Ic(4," Confirm "),s.Wb(),s.Ub()}if(2&t){const t=s.kc(2);s.Fb(3),s.qc("disabled",!t.order.item_count)("matBadge",t.order.item_count)("matBadgeHidden",!t.order.item_count)}}function Je(t,e){if(1&t){const t=s.Yb();s.Xb(0,"button",22),s.gc("click",function(){return s.yc(t),s.kc(2).show_order_details=!1}),s.Ic(1,"Back"),s.Wb(),s.Xb(2,"button",23),s.gc("click",function(){return s.yc(t),s.kc(2).saveOrder()}),s.Ic(3,"Save Order"),s.Wb()}}function Ne(t,e){if(1&t&&(s.Xb(0,"mat-dialog-actions"),s.Xb(1,"footer"),s.Gc(2,Ve,5,3,"ng-container",5),s.Gc(3,Je,4,0,"ng-template",null,19,s.Hc),s.Wb(),s.Wb()),2&t){const t=s.vc(4),e=s.kc();s.Fb(2),s.qc("ngIf",!e.show_order_details)("ngIfElse",t)}}function Ue(t,e){if(1&t&&(s.Xb(0,"div",24),s.Xb(1,"div",25),s.Xb(2,"div",26),s.Sb(3,"mat-spinner",27),s.Wb(),s.Xb(4,"div",28),s.Ic(5),s.Wb(),s.Wb(),s.Wb()),2&t){const t=s.kc();s.Fb(5),s.Kc(" ",t.loading," ")}}function Ke(t,e){if(1&t&&(s.Xb(0,"div",33),s.Ic(1),s.Wb()),2&t){const t=s.kc().$implicit,e=s.kc(2);s.qc("matTooltip",e.optionsFor(t)),s.Fb(1),s.Lc(" ",t.options.length," option",1===t.options.length?"":"s"," selected ")}}function Be(t,e){if(1&t){const t=s.Yb();s.Xb(0,"div",11),s.Xb(1,"div",12),s.Xb(2,"div",13),s.Ic(3),s.Wb(),s.Gc(4,Ke,2,3,"div",31),s.Wb(),s.Xb(5,"div",15),s.Ic(6),s.lc(7,"currency"),s.Wb(),s.Xb(8,"a-counter",32),s.gc("ngModelChange",function(n){s.yc(t);const i=e.$implicit;return s.kc(2).updateItemQuantity(i,n)}),s.Wb(),s.Wb()}if(2&t){const t=e.$implicit;s.Fb(3),s.Jc(t.name),s.Fb(1),s.qc("ngIf",t.options.length),s.Fb(2),s.Jc(s.mc(7,4,t.total_cost/100)),s.Fb(2),s.qc("ngModel",t.quantity)}}function He(t,e){if(1&t&&(s.Xb(0,"header"),s.Xb(1,"h3"),s.Ic(2,"Confirm Order"),s.Wb(),s.Wb(),s.Xb(3,"div",9),s.Gc(4,Be,9,6,"div",10),s.Wb(),s.Xb(5,"div",29),s.Sb(6,"input",30),s.Wb()),2&t){const t=s.kc();s.Fb(4),s.qc("ngForOf",t.order.items),s.Fb(1),s.qc("formGroup",t.form),s.Fb(1),s.Jb("error",t.form.controls.charge_code.touched&&t.form.controls.charge_code.invalid)}}function Ye(t,e,n){var i;let s=!0;for(const o of e)if(t.category===o.name||t.tags.includes(o.name)||(null===(i=n.space)||void 0===i?void 0:i.zones.includes(o.name))||"*"===o.name){let t=0;for(const e of o.rules){const i=new Date(n.date);switch(e[0]){case"after_hour":t+=Object(We.a)(i,Object(Xe.a)(i,e[1]))?1:0;break;case"before_hour":t+=Object(Ce.a)(i,Object(Xe.a)(i,e[1]))?1:0;break;case"min_length":t+=n.duration>=Se(e[1])?1:0;break;case"max_length":t+=n.duration<=Se(e[1])?1:0;break;case"visitor_type":t+=n.visitor_type===e[1]?1:0;break;default:t++}}s=t>=o.rules.length}return s}let Ze=(()=>{class t extends F{constructor(t){super(),this._data=t,this.event=new s.p,this.loading="",this.loading="Loading menu...",this.menu_items$=this._data.menu.pipe(Object(ft.a)(t=>{const e=T(t.map(t=>t.category)),n={};for(const i of e)n[i]=t.filter(t=>t.category===i&&Ye(t,this.rules,this.order.event));return n})),this.order=new je(this._data.order),this.form=new c.c({charge_code:new c.b(this.order.charge_code,[c.m.required])}),this.subscription("charge_code",this.form.controls.charge_code.valueChanges.subscribe(t=>this.order=new je(Object.assign(Object.assign({},this.order),{charge_code:t})))),this.subscription("loading",this._data.loading.subscribe(t=>this.loading=t?"Loading menu...":"")),this.loading="Loading menu...",this.timeout("loading",()=>this.loading="",1e3)}get categories(){return this._data.menu.pipe(Object(ft.a)(t=>T(t.map(t=>t.category))))}ngOnInit(){var t,e;return Object(M.a)(this,void 0,void 0,function*(){this.rules=yield this._data.getCateringConfig(null===(e=null===(t=this.order.event.space)||void 0===t?void 0:t.level)||void 0===e?void 0:e.parent_id)})}addItem(t,e=!0){var n;const i=this.order.items.find(e=>e.id===t.id&&e.options.length===e.options.reduce((e,n)=>e+(t.options.find(t=>n.id===t.id)?1:0),0));e&&(null===(n=t.options)||void 0===n?void 0:n.length)?this._data.selectOptions(t.options).then(e=>{const n=new te(Object.assign(Object.assign({},t),{options:e}));this.addItem(n,!1)}):this.order=new je(Object.assign(Object.assign({},this.order),i?{items:this.order.items.filter(t=>t!==i&&t.options.length===i.options.length).concat([new te(Object.assign(Object.assign({},t),{quantity:i.quantity+1}))])}:{items:this.order.items.concat([new te(Object.assign(Object.assign({},t),{quantity:1}))])}))}updateItemQuantity(t,e){const n=this.order.items.find(e=>e.id===t.id&&t.options.length===t.options.reduce((t,n)=>t+(e.options.find(t=>n.id===t.id)?1:0),0));let i=[...this.order.items];i=n?this.order.items.filter(e=>e.id!==t.id).concat([new te(Object.assign(Object.assign({},t),{quantity:e}))]):this.order.items.concat([new te(Object.assign(Object.assign({},t),{quantity:e}))]),i.sort((t,e)=>t.name.localeCompare(e.name)),this.order=new je(Object.assign(Object.assign({},this.order),{items:i}))}optionsFor(t){return t.options.map(t=>t.name).join("\n")}saveOrder(){this.form.markAllAsTouched(),this.form.valid&&this.event.emit({reason:"done",metadata:{order:this.order}})}confirmOrder(){this.show_order_details=!0}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(d.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["app-catering-order-modal"]],outputs:{event:"event"},features:[s.Cb],decls:7,vars:3,consts:[["class","main",4,"ngIf","ngIfElse"],[4,"ngIf"],["load_state",""],["order_details",""],[1,"main"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[1,"list"],["class","item",4,"ngFor","ngForOf"],[1,"item"],[1,"details"],[1,"name"],["class","info no-underline",4,"ngIf"],[1,"price"],["mat-icon-button","",3,"click"],[3,"icon"],[1,"info","no-underline"],["order_actions",""],["mat-button","","mat-dialog-close","",1,"inverse"],["mat-button","","matBadgeColor","warn",3,"disabled","matBadge","matBadgeHidden","click"],["mat-button","",1,"inverse",3,"click"],["mat-button","",3,"click"],[1,"body"],[1,"info-block"],[1,"icon"],["diameter","32"],[1,"text"],[1,"charge-code",3,"formGroup"],["formControlName","charge_code","placeholder","Charge Code*","required",""],["class","info",3,"matTooltip",4,"ngIf"],[3,"ngModel","ngModelChange"],[1,"info",3,"matTooltip"]],template:function(t,e){if(1&t&&(s.Xb(0,"mat-dialog-content"),s.Gc(1,Re,2,2,"div",0),s.Wb(),s.Gc(2,Ne,5,2,"mat-dialog-actions",1),s.Gc(3,Ue,6,1,"ng-template",null,2,s.Hc),s.Gc(5,He,7,4,"ng-template",null,3,s.Hc)),2&t){const t=s.vc(4);s.Fb(1),s.qc("ngIf",!e.loading)("ngIfElse",t),s.Fb(1),s.qc("ngIf",!e.loading)}},directives:[d.e,p.n,b.b,p.m,b.a,f.b,Mt,d.c,d.d,u.b],pipes:[p.b,p.d],styles:[".list[_ngcontent-%COMP%]{height:24em;min-width:24em;max-width:calc(100vw - 1em)}.item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.5em;border-bottom:1px solid #f0f0f0}header[_ngcontent-%COMP%]{height:3.25em}.main[_ngcontent-%COMP%], mat-dialog-content[_ngcontent-%COMP%]{min-width:20em}.details[_ngcontent-%COMP%], .name[_ngcontent-%COMP%]{flex:1;min-width:50%}.info[_ngcontent-%COMP%]{font-size:.6em;text-decoration:underline}.no-underline[_ngcontent-%COMP%]{text-decoration:none}.price[_ngcontent-%COMP%]{background-color:var(--primary);padding:.5em 1em;border-radius:4px;font-size:.7em;margin:0 .5em;color:#fff;font-weight:500}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:8em}input[_ngcontent-%COMP%]{position:relative;width:100%;padding:1em;border-radius:0!important;border:1px solid #ccc;border-right:none;border-left:none;outline:none;font-size:1em}input[_ngcontent-%COMP%]:focus{border:none;border-top:2px solid var(--primary);border-bottom:2px solid var(--primary);box-shadow:none}input.error[_ngcontent-%COMP%]::-moz-placeholder{color:rgba(var(--error),.45)}input.error[_ngcontent-%COMP%]:-ms-input-placeholder{color:rgba(var(--error),.45)}input.error[_ngcontent-%COMP%]::placeholder{color:rgba(var(--error),.45)}"]}),t})();function Qe(t,e){if(1&t&&(s.Xb(0,"div",15),s.Ic(1),s.lc(2,"currency"),s.Wb()),2&t){const t=s.kc().$implicit;s.Fb(1),s.Kc(" +",s.mc(2,1,t.unit_price/100)," ")}}function tn(t,e){if(1&t&&(s.Xb(0,"mat-radio-button",12),s.Xb(1,"div",13),s.Xb(2,"div",5),s.Ic(3),s.Wb(),s.Gc(4,Qe,3,3,"div",14),s.Wb(),s.Wb()),2&t){const t=e.$implicit;s.qc("value",t.id),s.Fb(3),s.Jc(t.name),s.Fb(1),s.qc("ngIf",t.unit_price)}}function en(t,e){if(1&t){const t=s.Yb();s.Vb(0),s.Xb(1,"mat-radio-group",9),s.gc("ngModelChange",function(e){s.yc(t);const n=s.kc().$implicit;return s.kc().updateGroupOption(n,e)}),s.Xb(2,"mat-radio-button",10),s.Ic(3,"None"),s.Wb(),s.Gc(4,tn,5,3,"mat-radio-button",11),s.Wb(),s.Ub()}if(2&t){const t=s.kc().$implicit;s.Fb(1),s.qc("ngModel",""),s.Fb(3),s.qc("ngForOf",t.options)}}function nn(t,e){if(1&t&&(s.Xb(0,"div",15),s.Ic(1),s.lc(2,"currency"),s.Wb()),2&t){const t=s.kc().$implicit;s.Fb(1),s.Kc(" +",s.mc(2,1,t.unit_price/100)," ")}}function sn(t,e){if(1&t){const t=s.Yb();s.Xb(0,"mat-checkbox",17),s.gc("ngModelChange",function(n){s.yc(t);const i=e.$implicit;return s.kc(3).option_state[i.id]=n}),s.Xb(1,"div",13),s.Xb(2,"div",5),s.Ic(3),s.Wb(),s.Gc(4,nn,3,3,"div",14),s.Wb(),s.Wb()}if(2&t){const t=e.$implicit,n=s.kc(3);s.qc("ngModel",n.option_state[t.id]),s.Fb(3),s.Jc(t.name),s.Fb(1),s.qc("ngIf",t.unit_price)}}function on(t,e){if(1&t&&s.Gc(0,sn,5,3,"mat-checkbox",16),2&t){const t=s.kc().$implicit;s.qc("ngForOf",t.options)}}function an(t,e){if(1&t&&(s.Xb(0,"div",4),s.Xb(1,"div",5),s.Ic(2),s.Wb(),s.Xb(3,"div",6),s.Gc(4,en,5,2,"ng-container",7),s.Gc(5,on,1,1,"ng-template",null,8,s.Hc),s.Wb(),s.Wb()),2&t){const t=e.$implicit,n=s.vc(6);s.Fb(2),s.Jc(t.name),s.Fb(2),s.qc("ngIf",!t.multiple)("ngIfElse",n)}}const cn=function(){return{class:"material-icons",content:"close"}};let rn=(()=>{class t{constructor(t){this._data=t,this.event=new s.p,this.option_state={};const e=T(this._data.options.map(t=>t.group||"Other")),n=[];for(const i of e){const t=this._data.options.filter(t=>t.group===i);n.push({name:i,multiple:!!t.find(t=>t.multiple),options:t})}this.groups=n}updateGroupOption(t,e){for(const n of t.options)this.option_state[n.id]=n.id===e}saveOptions(){const t=this._data.options.filter(t=>this.option_state[t.id]);this.event.emit({reason:"done",metadata:{options:t}})}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(d.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["app-catering-options-modal"]],outputs:{event:"event"},decls:12,vars:3,consts:[["mat-icon-button","","mat-dialog-close",""],[3,"icon"],["class","group",4,"ngFor","ngForOf"],["mat-button","",3,"click"],[1,"group"],[1,"name"],[1,"options"],[4,"ngIf","ngIfElse"],["multi_options",""],["aria-label","Select an option",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"details"],["class","price",4,"ngIf"],[1,"price"],[3,"ngModel","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(s.Xb(0,"header"),s.Xb(1,"h3"),s.Ic(2,"Select options"),s.Wb(),s.Xb(3,"button",0),s.Sb(4,"app-icon",1),s.Wb(),s.Wb(),s.Xb(5,"mat-dialog-content"),s.Xb(6,"main"),s.Gc(7,an,7,3,"div",2),s.Wb(),s.Wb(),s.Xb(8,"mat-dialog-actions"),s.Xb(9,"footer"),s.Xb(10,"button",3),s.gc("click",function(){return e.saveOptions()}),s.Ic(11,"Save"),s.Wb(),s.Wb(),s.Wb()),2&t&&(s.Fb(4),s.qc("icon",s.rc(2,cn)),s.Fb(3),s.qc("ngForOf",e.groups))},directives:[f.b,d.d,Mt,d.e,p.m,d.c,p.n],pipes:[p.d],styles:["main[_ngcontent-%COMP%]{min-height:24em;overflow:auto}.group[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;padding:.25em 0 .5em}.name[_ngcontent-%COMP%]{font-weight:500;padding:.5em}mat-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}mat-radio-button[_ngcontent-%COMP%]{margin:.25em 0}.options[_ngcontent-%COMP%]{padding-left:1.5em;display:flex;flex-direction:column}.details[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{flex:1;min-width:50%;width:16em}.details[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-size:.8em;opacity:.65}"]}),t})();class ln{constructor(t={}){var e;this.settings={},this.id=t.id||"",this.parent_id=t.parent_id||"",this.name=t.name||"",this.display_name=t.display_name||"",this.map_id=t.map_id||"",this.capacity=t.capacity||0,this.locations=t.locations||[];const n=this.display_name.split(" ");this.number=(null===(e=n.length>=2?n[n.length-1]:this.display_name[0])||void 0===e?void 0:e.toUpperCase())||""}}class dn extends pt{constructor(t={}){super(t);const e=t.settings||{};this.display_name=t.display_name;const n=e.discovery_info||e;this.zone_id=t.zone_id||t.zone,this.extras=(t.extras||n.extras||[]).map(t=>({id:t.extra_id||t.id,name:t.extra_name||t.name})),this.loan_items=(t.loan_items||n.loan_items||[]).map(t=>({id:t.extra_id||t.id,name:t.extra_name||t.name})),this.levels=(t.levels||n.levels||[]).map(t=>new ln(Object.assign(Object.assign({},t),{building_id:this.id}))),this._roles=t.roles||n.roles||{},this._lockers=t.lockers||t.locker_structure||n.locker_structure||{},this._systems=t.systems||n.systems||{},this._phone_numbers=t.phone_numbers||n.phone_numbers||{},this._location=t.location||n.location||{longitude:null,latitude:null},this.room_configurations=t.room_configurations||n.room_configurations||[],this.attributes=t.attributes||n.attributes||[];const i=[];if(t.neighbourhoods)for(const s in t.neighbourhoods)if(t.neighbourhoods.hasOwnProperty(s)){const e=t.neighbourhoods[s]||{};for(const t in e)e.hasOwnProperty(t)&&i.push({id:e[t],name:t,level_id:s})}this.bindings=t.bindings||{},this.searchables=i,this.timezone=t.timezone||n.timezone||e.timezone||"",this.catering_hours=t.catering_hours||n.catering_hours||e.catering_hours||{start:7,end:20},this.visitor_space=t.visitor_space||n.visitor_space||e.visitor_space||"",this.holding_bay=t.holding_bay||n.holding_bay||e.holding_bay||"",this.code=t.code||n.code||e.code||"",this.address=t.address||n.address||e.address||"",this.orientations=t.orientations||n.orientations||e.orientations||{},this.booking_details=t.booking_details||n.booking_details||e.booking_details||null,this.booking_rules=t.booking_rules||n.booking_rules||e.booking_rules||{},this.catering_restricted_from=t.catering_restricted_from||n.catering_restricted_from||e.catering_restricted_from||-1440,this.currency=t.currency||n.currency||e.currency||"USD"}role(t){return[...this._roles[t]||[]]}get role_names(){return Object.keys(this._roles).filter(t=>this._roles.hasOwnProperty(t))}get lockers(){return Object.assign({},this._lockers||{})}get systems(){return Object.assign({},this._systems||{})}get phone_numbers(){return Object.assign({},this._phone_numbers||{})}featuresForLevel(t){return(this.searchables||[]).filter(e=>e.level_id===t)}}class un extends pt{constructor(t={}){super(t),this.description=t.description||"",this.tags=t.tags||[],this.count=t.count||0,this.capacity=t.capacity||0,this.bindings=t.bindings||{},this._settings=t.settings||{}}setting(t){return L(t.split("."),this._settings)}}var bn=n("itXk");let mn=(()=>{class t{constructor(t,e){this._service=t,this._router=e,this._initialised=new X.a(!1),this.initialised=this._initialised.asObservable(),this.buildings_subject=new X.a([]),this.active_building_subject=new X.a(null),this.levels_subject=new X.a([]),this.building_list=this.buildings_subject.asObservable(),this.level_list=this.levels_subject.asObservable(),this.active_building=this.active_building_subject.asObservable(),this.active_levels=Object(bn.a)([this.level_list,this.active_building]).pipe(Object(ft.a)(t=>t[1]?this.levelsForBuilding(t[1]):[])),this._settings={},this._building_settings={},Object(W.i)().pipe(Object(q.a)(t=>t)).subscribe(()=>setTimeout(()=>this.init(),1e3)),this.active_building.subscribe(t=>{t&&(this._service.overrides=[this._settings,this.buildingSettings(t.id)])})}get settings(){return this._settings}get building_settings(){return this._building_settings}buildingSettings(t=""){return!t&&this.building&&(t=this.building.id),this._building_settings&&this._building_settings[t]||{}}get organisation(){return this._organisation}get buildings(){return this.buildings_subject.getValue()}get building(){return this.active_building_subject.getValue()}set building(t){this.active_building_subject.next(t),this._service.overrides=[this._settings.details,this.buildingSettings(t.id).details]}find(t){return this.buildings.find(e=>e.id===t||e.email===t)}get levels(){return this.levels_subject.getValue()}levelWithID(t){return this.levels.find(e=>null==t?void 0:t.includes(e.id))}levelsForBuilding(t){return this.levels.filter(e=>e.parent_id===t.id)}init(t=0){return Object(M.a)(this,void 0,void 0,function*(){this._initialised.next(!1),yield this.load().catch(e=>{throw function(t,e,n,i={}){console.error(t),ut("error",t,e,n,i)}("Error loading organisation data. Retrying..."),setTimeout(()=>this.init(t),Math.min(1e4,300*++t)),e}),this._initialised.next(!0),window.debug&&(window.application||(window.application={}),window.application.orgs=this)})}load(){return Object(M.a)(this,void 0,void 0,function*(){yield this.loadOrganisation(),yield this.loadBuildings(),yield this.loadLevels(),yield this.loadSettings()})}loadOrganisation(){var t;return Object(M.a)(this,void 0,void 0,function*(){const e=yield Object(W.n)({tags:"org"}).pipe(Object(ft.a)(t=>t.data)).toPromise();if(e.length){const n=Object(W.b)(),i=e.find(t=>{var e;return Object(W.h)()||t.id===(null===(e=null==n?void 0:n.config)||void 0===e?void 0:e.org_zone)})||e[0],s=null===(t=yield Object(W.s)(i.id,{name:"bindings"}).toPromise())||void 0===t?void 0:t.details;this._organisation=new un(Object.assign(Object.assign({},i),{bindings:s}))}else this._router.navigate(["/misconfigured"])})}loadBuildings(){var t;return Object(M.a)(this,void 0,void 0,function*(){const e=yield Object(W.n)({tags:"building",limit:500}).pipe(Object(ft.a)(t=>t.data)).toPromise();(null==e?void 0:e.length)||this._router.navigate(["/misconfigured"]);const n=[];for(const s of e){const e=null===(t=yield Object(W.s)(s.id,{name:"bindings"}).toPromise())||void 0===t?void 0:t.details;n.push(new dn(Object.assign(Object.assign({},s),{bindings:e})))}this.buildings_subject.next(n);const i=localStorage.getItem("PLACEOS.building");i&&this.buildings.find(t=>t.id===i)&&this.active_building_subject.next(this.buildings.find(t=>t.id===i)),!this.building&&n&&n.length>0&&(this.building=n[0])})}loadLevels(){return Object(M.a)(this,void 0,void 0,function*(){const t=yield Object(W.n)({tags:"level",limit:2500}).pipe(Object(ft.a)(t=>t.data)).toPromise();(null==t?void 0:t.length)||this._router.navigate(["/misconfigured"]);const e=t.map(t=>new ln(t));e.sort((t,e)=>(t.name||"").localeCompare(e.name||"")),this.levels_subject.next(e)})}get available_room_configs(){return this.buildings.map(t=>[...t.room_configurations]).reduce((t,e)=>t.concat(e),[]).sort((t,e)=>t.name.localeCompare(e.name))}loadSettings(){return Object(M.a)(this,void 0,void 0,function*(){if(!this._organisation)return;const t=`${(this._service.get("app.name")||"workplace").toLowerCase()}_app`;this._settings=yield Object(W.s)(this._organisation.id,{name:t}).toPromise();const e=this.buildings;for(const n of e)this._building_settings[n.id]=yield Object(W.s)(n.id,{name:t}).toPromise();this._service.overrides=[this._settings.details,this.buildingSettings(this.building.id).details]})}saveBuilding(t){localStorage.setItem("PLACEOS.building",t)}}return t.\u0275fac=function(e){return new(e||t)(s.cc(it),s.cc(a.d))},t.\u0275prov=s.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),pn=(()=>{class t extends F{constructor(t,e){super(),this._org=t,this._dialog=e,this._menu=new X.a([]),this._loading=new X.a(!1),this._currency=new X.a("USD"),this.menu=this._menu.asObservable(),this.loading=this._loading.asObservable(),this.currency=this._currency.asObservable(),this.subscription("building",this._org.active_building.subscribe(t=>Object(M.a)(this,void 0,void 0,function*(){if(t){const e=(yield this.getCateringForZone(t.id)).map(t=>new te(t));this._currency.next(t.currency||"USD"),this._menu.next(e)}})))}get categories(){return T(this._menu.getValue().map(t=>t.category))}manageCateringOrder(t){return new Promise(e=>{let n=!1;const i=this._dialog.open(Ze,{data:{order:t,menu:this.menu,loading:this.loading,getCateringConfig:t=>this.getCateringConfig(t),selectOptions:t=>this.selectOptions(t)}});i.componentInstance.event.pipe(Object(q.a)(t=>"done"===t.reason)).subscribe(t=>{n=!0,e(t.metadata.order),i.close()}),i.afterClosed().subscribe(()=>n?"":e(t))})}addItem(t=new te){const e=this._dialog.open(pe,Object.assign(Object.assign({},G),{data:{item:t,categories:this.categories}}));e.componentInstance.event.pipe(Object(q.a)(t=>"done"===t.reason)).subscribe(n=>{let i=this._menu.getValue();const s=i.findIndex(e=>e.id===t.id);s>=0?i.splice(s,1,n.metadata.item):i.push(n.metadata.item),this.updateMenu(this._org.building.id,i).then(()=>{this._menu.next([...i]),e.close()},()=>e.componentInstance.loading=!1)})}addOption(t,e={}){const n=T(t.options.map(t=>t.group)),i=this._dialog.open(xe,Object.assign(Object.assign({},G),{data:{parent:t,option:e,types:n}}));i.componentInstance.event.pipe(Object(q.a)(t=>"done"===t.reason)).subscribe(e=>{let n=this._menu.getValue();const s=n.findIndex(e=>e.id===t.id);s>=0?n.splice(s,1,e.metadata.item):n.push(e.metadata.item),this.updateMenu(this._org.building.id,n).then(()=>{this._menu.next([...n]),i.close()},()=>i.componentInstance.loading=!1)})}selectOptions(t){return new Promise((e,n)=>{let i=!1;const s=this._dialog.open(rn,Object.assign(Object.assign({},G),{data:{options:t}}));s.componentInstance.event.pipe(Object(q.a)(t=>"done"===t.reason)).subscribe(t=>{i=!0,e(t.metadata.options),s.close()}),s.afterClosed().subscribe(()=>i?"":n())})}deleteItem(t){const e=this._dialog.open(E,Object.assign(Object.assign({},G),{data:{title:"Delete Catering Item",content:`Are you sure you wish to remove the catering item ${t.name} from the menu?`,icon:{type:"icon",class:"material-icons",content:"delete"}}}));e.componentInstance.event.pipe(Object(q.a)(t=>"done"===t.reason)).subscribe(()=>{const n=this._menu.getValue().filter(e=>t.id!==e.id);this.updateMenu(this._org.building.id,n).then(()=>{this._menu.next([...n]),e.close()},()=>e.componentInstance.loading="")})}deleteOption(t,e){const n=this._dialog.open(E,Object.assign(Object.assign({},G),{data:{title:"Delete Catering Item Option",content:`Are you sure you wish to remove the catering option "${e.name}" from "${t.name}"?`,icon:{type:"icon",class:"material-icons",content:"delete"}}}));n.componentInstance.event.pipe(Object(q.a)(t=>"done"===t.reason)).subscribe(()=>{const i=this._menu.getValue();i.splice(i.findIndex(e=>e.id===t.id),1,new te(Object.assign(Object.assign({},t),{options:t.options.filter(t=>t.id!==e.id)}))),this.updateMenu(this._org.building.id,i).then(()=>{this._menu.next([...i]),n.close()},()=>n.componentInstance.loading="")})}editConfig(){return Object(M.a)(this,void 0,void 0,function*(){const t=yield this.getCateringConfig(this._org.building.id),e=T(R(this._menu.getValue().map(t=>[t.category,...t.tags]))),n=this._dialog.open(Zt,{data:{config:t,types:e}});n.componentInstance.event.pipe(Object(q.a)(t=>"done"===t.reason)).subscribe(t=>{this.updateConfig(this._org.building.id,t.metadata).then(()=>n.close(),()=>n.componentInstance.loading=!1)})})}updateMenu(t,e){return Object(W.v)(t,{id:t,name:"catering",details:e,description:`Catering menu for ${t}`}).toPromise()}getCateringForZone(t){return Object(M.a)(this,void 0,void 0,function*(){const e=(yield Object(W.s)(t,{name:"catering"}).toPromise()).details;return e instanceof Array?e:[]})}getCateringConfig(t=this._org.building.id){return Object(M.a)(this,void 0,void 0,function*(){const e=(yield Object(W.s)(t,{name:"catering_config"}).toPromise()).details;return e instanceof Array?e:[]})}updateConfig(t,e){return Object(W.v)(t,{id:t,name:"catering_config",details:e,description:`Catering menu config for ${t}`}).toPromise()}addItemToOrder(t,e){let n;if(t){let i=t.items;const s=i.find(t=>{var n,i;return t.id===e.id&&(null===(n=e.options)||void 0===n?void 0:n.length)===(null===(i=t.options)||void 0===i?void 0:i.reduce((t,n)=>t+(e.options.find(t=>n.id===t.id)?1:0),0))});s?s.quantity+=1:i=i.concat([new te(Object.assign(Object.assign({},e),{quantity:1}))]),n=new je(Object.assign(Object.assign({},t),{items:i,event:null}))}else n=new je({items:[Object.assign(Object.assign({},e),{quantity:1})]});return n}}return t.\u0275fac=function(e){return new(e||t)(s.cc(mn),s.cc(d.b))},t.\u0275prov=s.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const gn=["catering-menu-item",""];function hn(t,e){if(1&t){const t=s.Yb();s.Xb(0,"div",12),s.Xb(1,"div",13),s.Xb(2,"div",14),s.Ic(3),s.Wb(),s.Xb(4,"div",3),s.Ic(5),s.Wb(),s.Wb(),s.Xb(6,"button",15),s.gc("click",function(){s.yc(t);const n=e.$implicit;return s.kc().editOption(n)}),s.Xb(7,"app-icon"),s.Ic(8,"edit"),s.Wb(),s.Wb(),s.Xb(9,"button",15),s.gc("click",function(){s.yc(t);const n=e.$implicit;return s.kc().removeOption(n)}),s.Xb(10,"app-icon"),s.Ic(11,"delete"),s.Wb(),s.Wb(),s.Wb()}if(2&t){const t=e.$implicit;s.Fb(3),s.Jc(t.name),s.Fb(2),s.Jc(t.group)}}let fn=(()=>{class t{constructor(t){this._catering=t,this.show_options=!1,this.addOption=()=>this._catering.addOption(this.item),this.editOption=t=>this._catering.addOption(this.item,t),this.removeOption=t=>this._catering.deleteOption(this.item,t),this.editItem=()=>this._catering.addItem(this.item),this.removeItem=()=>this._catering.deleteItem(this.item)}get symbol(){return this._catering.currency}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(pn))},t.\u0275cmp=s.Lb({type:t,selectors:[["","catering-menu-item",""]],inputs:{item:"item"},attrs:gn,decls:36,vars:13,consts:[[1,"flex","items-center","px-2"],[1,"flex","items-center","p-2","flex-1"],[1,"flex-1"],[1,"text-xs","text-dark-fade"],[1,"p-2","m-2","text-xs","font-bold","text-white","rounded","bg-primary"],["mat-icon-button","",3,"matMenuTriggerFor"],["mat-icon-button","",3,"disabled","click"],["name","options",1,"bg-gray-100","overflow-hidden"],["class","flex p-2 items-center border-none border-t border-solid border-gray-300",4,"ngFor","ngForOf"],["menu","matMenu"],["mat-menu-item","",1,"flex","items-center",3,"click"],[1,"ml-2"],[1,"flex","p-2","items-center","border-none","border-t","border-solid","border-gray-300"],[1,"flex-1","px-2"],[1,"text"],["mat-icon-button","",1,"mx-2",3,"click"]],template:function(t,e){if(1&t&&(s.Xb(0,"div",0),s.Xb(1,"div",1),s.Xb(2,"div",2),s.Xb(3,"div"),s.Ic(4),s.Wb(),s.Xb(5,"div",3),s.Ic(6),s.Wb(),s.Wb(),s.Xb(7,"div",4),s.Ic(8),s.lc(9,"currency"),s.lc(10,"async"),s.Wb(),s.Wb(),s.Xb(11,"button",5),s.Xb(12,"app-icon"),s.Ic(13,"more_vert"),s.Wb(),s.Wb(),s.Xb(14,"button",6),s.gc("click",function(){return e.show_options=!e.show_options}),s.Xb(15,"app-icon"),s.Ic(16,"expand_more"),s.Wb(),s.Wb(),s.Wb(),s.Xb(17,"div",7),s.Gc(18,hn,12,2,"div",8),s.Wb(),s.Xb(19,"mat-menu",null,9),s.Xb(21,"button",10),s.gc("click",function(){return e.addOption()}),s.Xb(22,"app-icon"),s.Ic(23,"add"),s.Wb(),s.Xb(24,"div",11),s.Ic(25,"Add Option"),s.Wb(),s.Wb(),s.Xb(26,"button",10),s.gc("click",function(){return e.editItem()}),s.Xb(27,"app-icon"),s.Ic(28,"edit"),s.Wb(),s.Xb(29,"div",11),s.Ic(30,"Edit Item"),s.Wb(),s.Wb(),s.Xb(31,"button",10),s.gc("click",function(){return e.removeItem()}),s.Xb(32,"app-icon"),s.Ic(33,"delete"),s.Wb(),s.Xb(34,"div",11),s.Ic(35,"Remove Item"),s.Wb(),s.Wb(),s.Wb()),2&t){const t=s.vc(20);s.Fb(4),s.Jc(e.item.name),s.Fb(2),s.Jc(e.item.category),s.Fb(2),s.Kc(" ",s.nc(9,8,e.item.unit_price/100,s.mc(10,11,e.symbol))," "),s.Fb(3),s.qc("matMenuTriggerFor",t),s.Fb(3),s.qc("disabled",!e.item.options.length),s.Fb(3),s.Dc("height",e.show_options?3.5*e.item.options.length+"rem":"0"),s.Fb(1),s.qc("ngForOf",e.item.options)}},directives:[f.b,h.d,Mt,p.m,h.a,h.b],pipes:[p.d,p.b],styles:['[_nghost-%COMP%] {\n            background-color: #fff;\n            border: 1px solid #ccc;\n            border-radius: .25rem;\n            overflow: hidden;\n            width: 768px;\n            margin: .5rem auto;\n            max-width: calc(100vw - 1rem);\n        }\n\n        button[mat-menu-item][_ngcontent-%COMP%] {\n            display: flex;\n        }\n\n        [name="options"][_ngcontent-%COMP%] {\n            transition: height 200ms;\n        }']}),t})();function _n(t,e){if(1&t&&(s.Vb(0),s.Sb(1,"div",6),s.Ub()),2&t){const t=e.$implicit;s.Fb(1),s.qc("item",t)}}function vn(t,e){if(1&t&&(s.Vb(0),s.Gc(1,_n,2,1,"ng-container",5),s.lc(2,"async"),s.Ub()),2&t){const t=s.kc();s.Fb(1),s.qc("ngForOf",s.mc(2,1,t.menu))}}function yn(t,e){if(1&t&&(s.Vb(0),s.Sb(1,"div",6),s.Ub()),2&t){const t=e.$implicit;s.Fb(1),s.qc("item",t)}}function On(t,e){if(1&t&&(s.Xb(0,"mat-tab",7),s.Gc(1,yn,2,1,"ng-container",5),s.lc(2,"async"),s.Wb()),2&t){const t=e.$implicit,n=s.kc();s.qc("label",t),s.Fb(1),s.qc("ngForOf",s.mc(2,2,n.tab_menu)[t])}}const wn=function(){return{class:"material-icons",content:"close"}};function kn(t,e){1&t&&(s.Xb(0,"div",8),s.Xb(1,"div",9),s.Sb(2,"app-icon",10),s.Wb(),s.Xb(3,"div",11),s.Ic(4,"No items in menu"),s.Wb(),s.Wb()),2&t&&(s.Fb(2),s.qc("icon",s.rc(1,wn)))}let In=(()=>{class t{constructor(t){this._catering=t,this.menu=this._catering.menu,this.shown_tab=new X.a(""),this.tab_menu=this.menu.pipe(Object(ft.a)(t=>{const e={};for(const n of this.categories)e[n]=t.filter(t=>t.category===n);return e}))}get categories(){return this._catering.categories}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(pn))},t.\u0275cmp=s.Lb({type:t,selectors:[["catering-menu"]],decls:7,vars:5,consts:[[1,"h-full",3,"selectedIndexChange"],["label","All Items"],[4,"ngIf","ngIfElse"],[3,"label",4,"ngFor","ngForOf"],["empty_state",""],[4,"ngFor","ngForOf"],["catering-menu-item","",3,"item"],[3,"label"],[1,"info-block"],[1,"icon"],[3,"icon"],[1,"text"]],template:function(t,e){if(1&t&&(s.Xb(0,"mat-tab-group",0),s.gc("selectedIndexChange",function(t){return e.shown_tab.next(0===t?"":e.categories[t-1])}),s.Xb(1,"mat-tab",1),s.Gc(2,vn,3,3,"ng-container",2),s.lc(3,"async"),s.Wb(),s.Gc(4,On,3,4,"mat-tab",3),s.Wb(),s.Gc(5,kn,5,2,"ng-template",null,4,s.Hc)),2&t){const t=s.vc(6);let n=null;s.Fb(2),s.qc("ngIf",null==(n=s.mc(3,3,e.menu))?null:n.length)("ngIfElse",t),s.Fb(2),s.qc("ngForOf",e.categories)}},directives:[b.b,b.a,p.n,p.m,fn,Mt],pipes:[p.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                height: 90%;\n                width: 100%;\n            }"]}),t})();const xn=["catering-order-list-order-item",""];let jn=(()=>{class t{constructor(){this.active=!1}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Lb({type:t,selectors:[["","catering-order-list-order-item",""]],inputs:{item:"item"},attrs:xn,decls:8,vars:8,consts:[[1,"w-20","text-right"],["name","item-bar",1,"bg-gray-300"],[1,"w-12","mr-4"],["mat-icon-button","",1,"border","border-gray-300","border-dashed","text-2xl","text-dark-fade"],[1,"flex-1","border-none","border-b","border-gray-300","border-solid","py-4"]],template:function(t,e){1&t&&(s.Xb(0,"div",0),s.Sb(1,"div",1),s.Wb(),s.Xb(2,"div",2),s.Xb(3,"button",3),s.Xb(4,"app-icon"),s.Ic(5),s.Wb(),s.Wb(),s.Wb(),s.Xb(6,"div",4),s.Ic(7),s.Wb()),2&t&&(s.Fb(3),s.Jb("bg-success",e.active)("text-white",e.active)("border-solid",e.active),s.Fb(2),s.Jc(e.active?"done":"local_pizza"),s.Fb(2),s.Kc(" ",e.item.name," "))},directives:[f.b,Mt],styles:["[_nghost-%COMP%]:last-child    > div[_ngcontent-%COMP%] {\n                border: none !important;\n            }\n\n            [name='item-bar'][_ngcontent-%COMP%] {\n                height: 2px;\n                margin-left: auto;\n                margin-right: 1rem;\n                width: calc(50% - 0.9375rem);\n            }"]}),t})();const Wn=[{id:"pending",name:"Pending",icon:{class:"custom-pending"},colour:"#ccc"},{id:"accepted",name:"Accepted",icon:{class:"custom-accepted"},colour:"#3996B6"},{id:"preparing",name:"Preparing",icon:{class:"custom-preparing"},colour:"#E7536B"},{id:"ready",name:"Ready",icon:{class:"custom-ready"},colour:"#FFD028"},{id:"delivered",name:"Delivered",icon:{class:"custom-delivered"},colour:"#75BB43"},{id:"cancelled",name:"Cancelled",icon:{class:"custom-cancelled"},colour:"#747474"}];var Xn=n("Kj3r"),Cn=n("eIep"),Fn=n("M34a"),Mn=n("piIK"),qn=n("ILtH");class $n{constructor(t={}){this.id=t.id||"",this.name=t.name||"",this.display_name=t.display_name||"",this.email=(t.email||"").toLowerCase(),this.capacity=t.capacity||-1,this.feature_list=t.feature_list||t.features||[],this.bookable=!!t.bookable,this.zones=t.zones||[],this.support_url=t.support_url||"",this.map_id=t.map_id||"",this.image=t.image||"",this.configurations=t.configurations||[],this.features=t.features||[],this.response_status=t.response_status,this.level=t.level||new ln}}let Pn={id:"default",name:"Default User"};class Sn{constructor(t={}){var e,n;this.id=t.id||"",this.calendar=t.calendar||"",this.creator=null===(e=t.creator||Pn.email)||void 0===e?void 0:e.toLowerCase(),this.host=(t.host||this.creator||"").toLowerCase();const i=t.attendees||[];this.attendees=i.filter(t=>!t.resource).map(t=>new _t(t)),this.resources=t.resources||i.filter(t=>t.resource).map(t=>new $n(t)),this.title=t.title||"",this.body=t.body||"",this.private=!!t.private,this.all_day=!!t.all_day;const s=1e3*t.event_start||t.date,o=s?new Date(s):Object(qn.a)((new Date).setMinutes((new Date).getMinutes()+3),{nearestTo:5});this.date=this.all_day?Object(Fn.a)(o).valueOf():o.valueOf(),this.duration=this.all_day?1440:t.duration||Object(qe.a)(new Date(1e3*t.event_end),o)||30,this.timezone=t.timezone,this.location=t.location||"",this.recurring=t.recurring,this.recurring_master_id=t.recurring_master_id,this.meeting_link=t.meeting_link||"",this.organiser=this.attendees.find(t=>t.email===this.host),this.master=t.master?new Sn(t.master):null,this.recurrence=t.recurring?{start:o.valueOf()||new Date(1e3*t.recurrence.range_start).valueOf(),end:t.recurrence.end||new Date(1e3*t.recurrence.range_end).valueOf(),interval:t.recurrence.interval,pattern:t.recurrence.pattern,days_of_week:t.recurrence.days_of_week}:{},this.system=t.system,(null===(n=this.system)||void 0===n?void 0:n.email)&&this.resources.push(new $n(this.system)),this.old_system=t.old_system||t.system,this.attachments=t.attachments||[],this.extension_data=t.extension_data||{},this.extension_data.catering=(t.catering||this.extension_data.catering||[]).map(t=>new je(Object.assign(Object.assign({},t),{event:this}))),this.extension_data.needs_parking=!!t.needs_parking,this.extension_data.remote=t.remote||this.extension_data.remote||[],this.extension_data.visitor_type=t.visitor_type||this.extension_data.visitor_type||"",this.can_access_lift=t.can_access_lift||this.extension_data.can_access_lift||!1,this.resources=T(this.resources,"email"),this.status=function(t){var e;return(null===(e=t.resources)||void 0===e?void 0:e.length)?t.resources.every(t=>"accepted"===t.response_status)?"confirmed":t.resources.some(t=>"tentative"===t.response_status||"needsAction"===t.response_status)?"tentative":"cancelled":"confirmed"}(this)||"none",this.has_visitors=!!this.attendees.find(t=>t.visit_expected||t.is_external),this.has_catering=this.extension_data.catering&&!!this.extension_data.catering.length,this.catering=this.extension_data.catering||[],this.remote=this.extension_data.remote||[],this.needs_parking=!!this.extension_data.needs_parking,this.setup=this.extension_data.setup||0,this.breakdown=this.extension_data.breakdown||0,this.visitor_type=this.extension_data.visitor_type||"",this.type="cancelled"===this.status?"cancelled":this.has_visitors?"external":"internal",this.attendee_emails=this.attendees.map(t=>t.email),this.guests=this.attendees.filter(t=>!!t.visit_expected),this.notes=this.extension_data.notes||[],this.space=this.resources[0]||null}get is_today(){return Object(tt.a)(new Date(this.date),new Date)}get cleaning_status(){return this.extension_data.cleaned?"done":""}toJSON(){var t;const e=Object.assign({},this),n=Math.floor(Object($e.a)(new Date(this.date),this.duration).valueOf()/1e3);e.event_start=Math.floor(this.date/1e3),e.event_end=n;const i=this.attendees;return this.recurring&&(e.recurrence=Object.assign(Object.assign({},this.recurrence),{range_start:e.event_start,range_end:Math.floor(new Date(this.recurrence.end).valueOf()/1e3)})),e.recurrence=e.recurrence&&Object.keys(e.recurrence).length?e.recurrence:null,e.attendees=T(i,"email"),this.all_day||(e.extension_data.breakdown=15),e.extension_data.catering=e.extension_data.catering.map(t=>new je(Object.assign(Object.assign({},t),{event:null}))),e.system_id=null===(t=this.system)||void 0===t?void 0:t.id,delete e.catering,delete e.date,delete e.duration,e}get state(){const t=new Date,e=new Date(this.date);return Object(Ce.a)(t,Object(Fe.a)(e,{minutes:-15}))?"future":Object(Ce.a)(t,e)?"upcoming":Object(Ce.a)(t,Object(Fe.a)(e,{minutes:15}))?"started":Object(Ce.a)(t,Object(Fe.a)(e,{minutes:this.duration}))?"in_progress":"done"}get event_start(){return Math.floor(new Date(this.date).valueOf()/1e3)}get event_end(){return Math.floor(Object($e.a)(new Date(this.date),this.duration).valueOf()/1e3)}get can_check_in(){return Object(tt.a)(new Date,new Date(this.date))}}const Gn="/api/staff/v1/events";let En=(()=>{class t extends F{constructor(){super(),this._loading=new X.a(!1),this._orders=new X.a([]),this._filters=new X.a({count:0}),this._update=this._filters.pipe(Object(Xn.a)(500),Object(Cn.a)(t=>{this._loading.next(!0);const e=Math.floor(Object(Fn.a)(new Date(t.date||Date.now())).valueOf()/1e3),n=Math.floor(Object(Mn.a)(new Date(t.date||Date.now())).valueOf()/1e3);return function(t){const e=at(t);return Object(W.e)(`${Gn}${e?"?"+e:""}`).pipe(Object(ft.a)(t=>t.map(t=>new Sn(t))))}({zone_ids:(t.zones||[]).join(","),period_start:e,period_end:n})}),Object(ft.a)(t=>R(t.map(t=>t.catering)))),this.loading=this._loading.asObservable(),this.orders=this._orders.asObservable(),this.filtered=this._orders.pipe(Object(ft.a)(t=>t.filter(t=>function(t,e){const n=(e.search||"").toLowerCase();return!!t.items.find(t=>t.name.toLowerCase().includes(n)||!!t.options.find(t=>t.name.toLowerCase().includes(n)))}(t,this._filters.getValue())))),this.subscription("changes",this._update.subscribe(t=>{this._loading.next(!1),this._orders.next(t)}))}get filters(){return this._filters.getValue()}set filters(t){this._filters.next(t)}startPolling(t=15e3){this.interval("polling",()=>{const t=this._filters.getValue();this._filters.next(Object.assign(Object.assign({},t),{count:t.count+1}))},t)}stopPolling(){this.clearInterval("polling")}updateStatus(t,e){const n=new je(Object.assign(Object.assign({},t),{status:e}));return(i=new Sn(Object.assign(Object.assign({},t.event),{catering:[...t.event.catering.filter(e=>e.id!==t.id),n].map(t=>new je(Object.assign({},t)))}))).id?function(t,e,n={},i="patch"){const s=at(n);return("patch"===i?W.j:W.l)(`${Gn}/${encodeURIComponent(t)}${s?"?"+s:""}`,e).pipe(Object(ft.a)(t=>new Sn(t)))}(i.id,i,undefined):function(t){return Object(W.k)(`${Gn}`,t).pipe(Object(ft.a)(t=>new Sn(t)))}(i);var i}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=s.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function zn(t,e){1&t&&s.Sb(0,"li",18),2&t&&s.qc("item",e.$implicit)}function Dn(t,e){if(1&t){const t=s.Yb();s.Xb(0,"button",19),s.gc("click",function(){s.yc(t);const n=e.$implicit;return s.kc().updateStatus(n.id)}),s.Sb(1,"div",20),s.Xb(2,"span",21),s.Ic(3),s.Wb(),s.Wb()}if(2&t){const t=e.$implicit;s.Fb(1),s.Dc("background-color",t.colour),s.Fb(2),s.Jc(t.name)}}let Ln=(()=>{class t{constructor(t){this._orders=t,this.show_items=!1,this.statuses=Wn,this.updateStatus=t=>this._orders.updateStatus(this.order,t)}get status(){return this.statuses.find(t=>t.id===this.order.status)}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(En))},t.\u0275cmp=s.Lb({type:t,selectors:[["catering-order-list-item"]],inputs:{order:"order"},decls:32,vars:22,consts:[[1,"w-full","font-medium","flex","items-center","py-2","bg-gray-100"],[1,"w-20","flex","items-center","justify-center"],[1,"rounded-full","bg-gray-300","p-2","text-2xl","text-dark-fade","flex","items-center","justify-center"],[1,"w-24"],[1,"flex-1"],[1,"w-56"],[1,"w-28"],[1,"w-36"],["name","status","matRipple","",1,"text-base","border-none","h-10","px-4","flex","items-center","text-white",3,"matMenuTriggerFor"],[1,"flex","text-center","capitalize","mx-2"],[1,"pl-2"],[1,"w-12"],["mat-icon-button","",3,"click"],[1,"list-none","p-0","m-0","w-full","relative"],["name","bar",1,"absolute","top-0","bg-gray-300"],["catering-order-list-order-item","","class","flex items-center",3,"item",4,"ngFor","ngForOf"],["menu","matMenu"],["mat-menu-item","","class","flex items-center",3,"click",4,"ngFor","ngForOf"],["catering-order-list-order-item","",1,"flex","items-center",3,"item"],["mat-menu-item","",1,"flex","items-center",3,"click"],[1,"rounded-full","h-4","w-4","mr-2"],[1,"mr-2","w-20"]],template:function(t,e){if(1&t&&(s.Xb(0,"div",0),s.Xb(1,"div",1),s.Xb(2,"div",2),s.Xb(3,"app-icon"),s.Ic(4,"room_service"),s.Wb(),s.Wb(),s.Wb(),s.Xb(5,"div",3),s.Ic(6),s.lc(7,"date"),s.Wb(),s.Xb(8,"div",4),s.Ic(9),s.Wb(),s.Xb(10,"div",5),s.Ic(11),s.Wb(),s.Xb(12,"div",3),s.Ic(13),s.Wb(),s.Xb(14,"div",6),s.Ic(15),s.Wb(),s.Xb(16,"div",7),s.Xb(17,"button",8),s.Xb(18,"div",9),s.Ic(19),s.Wb(),s.Xb(20,"app-icon",10),s.Ic(21,"arrow_drop_down"),s.Wb(),s.Wb(),s.Wb(),s.Xb(22,"div",11),s.Xb(23,"button",12),s.gc("click",function(){return e.show_items=!e.show_items}),s.Xb(24,"app-icon"),s.Ic(25),s.Wb(),s.Wb(),s.Wb(),s.Wb(),s.Xb(26,"ul",13),s.Sb(27,"div",14),s.Gc(28,zn,1,1,"li",15),s.Wb(),s.Xb(29,"mat-menu",null,16),s.Gc(31,Dn,4,3,"button",17),s.Wb()),2&t){const t=s.vc(30);s.Jb("shown",e.show_items),s.Fb(6),s.Jc(s.nc(7,19,e.order.deliver_at,"shortTime")),s.Fb(3),s.Kc(" ",(null==e.order.event?null:e.order.event.space.display_name)||(null==e.order.event?null:e.order.event.space.name)||"~ No Location ~"," "),s.Fb(2),s.Kc(" ",(null==e.order.event||null==e.order.event.organiser?null:e.order.event.organiser.name)||(null==e.order.event?null:e.order.event.host)||"~ Unknown Host ~"," "),s.Fb(2),s.Jc(e.order.charge_code||"~ No Code ~"),s.Fb(2),s.Jc(e.order.invoice_number||"~ No Invoice ~"),s.Fb(2),s.Dc("background",null==e.status?null:e.status.colour),s.qc("matMenuTriggerFor",t),s.Fb(2),s.Jc(null==e.status?null:e.status.name),s.Fb(6),s.Jc(e.show_items?"keyboard_arrow_down":"keyboard_arrow_right"),s.Fb(1),s.Jb("shown",e.show_items),s.qc("@show",e.show_items?"show":"hide"),s.Fb(1),s.Dc("height",3.125*e.order.items.length-1+"rem"),s.Fb(1),s.qc("ngForOf",e.order.items),s.Fb(3),s.qc("ngForOf",e.statuses)}},directives:[Mt,h.d,f.b,p.m,h.a,jn,h.b],pipes:[p.f],styles:["[name='status'][_ngcontent-%COMP%] {\n                border-radius: 1.55rem;\n            }\n\n            button[mat-menu-item][_ngcontent-%COMP%] {\n                display: flex;\n            }\n\n            .shown[_ngcontent-%COMP%] {\n                background-color: #eee;\n            }\n\n            [name='bar'][_ngcontent-%COMP%] {\n                width: 2px;\n                top: -0.5rem;\n                left: calc(2.5rem - 1px);\n            }"],data:{animation:[ot]}}),t})();function Tn(t,e){if(1&t&&(s.Xb(0,"li",12),s.Sb(1,"catering-order-list-item",13),s.Wb()),2&t){const t=e.$implicit;s.Fb(1),s.qc("order",t)}}function An(t,e){1&t&&(s.Xb(0,"div",14),s.Xb(1,"div",15),s.Ic(2,"No Catering Orders"),s.Wb(),s.Wb())}function Rn(t,e){1&t&&s.Sb(0,"mat-progress-bar",16)}let Vn=(()=>{class t{constructor(t){this._orders=t,this.order_list=this._orders.filtered,this.loading=this._orders.loading}ngOnInit(){this._orders.startPolling()}ngOnDestroy(){this._orders.stopPolling()}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(En))},t.\u0275cmp=s.Lb({type:t,selectors:[["catering-order-list"]],decls:22,vars:9,consts:[[1,"w-full","text-sm","font-medium","flex","items-center","py-4","border-none","border-solid","border-b","border-gray-300","bg-white"],[1,"w-20"],[1,"w-24"],[1,"flex-1"],[1,"w-56"],[1,"w-28"],[1,"w-36"],[1,"w-12"],[1,"list-none","p-0","m-0","w-full","flex-1","overflow-auto"],["class","border-none border-solid border-b border-gray-300",4,"ngFor","ngForOf"],["class","info-block text-dark-fade",4,"ngIf"],["class","w-full","mode","indeterminate",4,"ngIf"],[1,"border-none","border-solid","border-b","border-gray-300"],[3,"order"],[1,"info-block","text-dark-fade"],[1,"text"],["mode","indeterminate",1,"w-full"]],template:function(t,e){1&t&&(s.Xb(0,"div",0),s.Sb(1,"div",1),s.Xb(2,"div",2),s.Ic(3,"Time"),s.Wb(),s.Xb(4,"div",3),s.Ic(5,"Location"),s.Wb(),s.Xb(6,"div",4),s.Ic(7,"Host"),s.Wb(),s.Xb(8,"div",2),s.Ic(9,"Charge Code"),s.Wb(),s.Xb(10,"div",5),s.Ic(11,"Invoice No."),s.Wb(),s.Xb(12,"div",6),s.Ic(13,"Status"),s.Wb(),s.Sb(14,"div",7),s.Wb(),s.Xb(15,"ul",8),s.Gc(16,Tn,2,1,"li",9),s.lc(17,"async"),s.Gc(18,An,3,0,"div",10),s.lc(19,"async"),s.Wb(),s.Gc(20,Rn,1,0,"mat-progress-bar",11),s.lc(21,"async")),2&t&&(s.Fb(16),s.qc("ngForOf",s.mc(17,3,e.order_list)),s.Fb(2),s.qc("ngIf",!s.mc(19,5,e.order_list).length),s.Fb(2),s.qc("ngIf",s.mc(21,7,e.loading)))},directives:[p.m,p.n,Ln],pipes:[p.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n            }"]}),t})(),Jn=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.Pb({type:t}),t.\u0275inj=s.Ob({providers:[],imports:[[p.c,h.c,b.c,g.b,d.f,Nt]]}),t})();const Nn=function(){return["/"]};function Un(t,e){1&t&&(s.Xb(0,"a",6),s.Xb(1,"div",7),s.Xb(2,"app-icon"),s.Ic(3,"arrow_back"),s.Wb(),s.Xb(4,"p",8),s.Ic(5,"Back"),s.Wb(),s.Wb(),s.Wb()),2&t&&s.qc("routerLink",s.rc(1,Nn))}function Kn(t,e){if(1&t&&(s.Xb(0,"mat-option",9),s.Ic(1),s.Wb()),2&t){const t=e.$implicit;s.qc("value",t.id),s.Fb(1),s.Kc(" ",t.display_name||t.name," ")}}function Bn(t,e){if(1&t){const t=s.Yb();s.Xb(0,"button",10),s.gc("click",function(){return s.yc(t),s.kc().addItem()}),s.Ic(1," Add Item "),s.Wb()}}function Hn(t,e){if(1&t){const t=s.Yb();s.Xb(0,"button",10),s.gc("click",function(){return s.yc(t),s.kc().editConfig()}),s.Ic(1," Edit Config "),s.Wb()}}let Yn=(()=>{class t extends F{constructor(t,e,n,i,s){super(),this._orders=t,this._catering=e,this._org=n,this._route=i,this._router=s,this.zones=[],this.setDate=t=>this._orders.filters=Object.assign(Object.assign({},this._orders.filters),{date:t}),this.levels=this._org.active_levels,this.updateZones=t=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:t.join(",")}}),this._orders.filters=Object.assign(Object.assign({},this._orders.filters),{zones:[t]})},this.addItem=()=>this._catering.addItem(),this.editConfig=()=>this._catering.editConfig()}ngOnInit(){return Object(M.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(q.a)(t=>t)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{if(t.has("zone_ids")){const e=t.get("zone_ids").split(",");if(e.length){const t=this._org.levelWithID(e);if(!t)return;this._org.building=this._org.buildings.find(e=>e.id===t.parent_id),this.zones=e}}})),this.subscription("route.params",this._route.paramMap.subscribe(t=>this.page=t.has("view")?t.get("view"):"")),this.subscription("levels",this._org.active_levels.subscribe(t=>{this.zones=this.zones.filter(e=>t.find(t=>t.id===e)),!this.zones.length&&t.length&&this.zones.push(t[0].id),this.updateZones(this.zones)}))})}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(En),s.Rb(pn),s.Rb(mn),s.Rb(a.a),s.Rb(a.d))},t.\u0275cmp=s.Lb({type:t,selectors:[["catering-topbar"]],features:[s.Cb],decls:8,vars:7,consts:[["mat-button","",3,"routerLink",4,"ngIf"],["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["mat-button","",3,"click",4,"ngIf"],[1,"flex-1","w-2"],["mat-button","",3,"routerLink"],[1,"flex","items-center","space-x-2"],[1,"underline"],[3,"value"],["mat-button","",3,"click"]],template:function(t,e){1&t&&(s.Gc(0,Un,6,2,"a",0),s.Xb(1,"mat-form-field",1),s.Xb(2,"mat-select",2),s.gc("ngModelChange",function(t){return e.zones=t})("ngModelChange",function(t){return e.updateZones(t)}),s.Gc(3,Kn,2,2,"mat-option",3),s.lc(4,"async"),s.Wb(),s.Wb(),s.Gc(5,Bn,2,0,"button",4),s.Gc(6,Hn,2,0,"button",4),s.Sb(7,"div",5)),2&t&&(s.qc("ngIf",e.page),s.Fb(2),s.qc("ngModel",e.zones),s.Fb(1),s.qc("ngForOf",s.mc(4,5,e.levels)),s.Fb(2),s.qc("ngIf","menu"===e.page),s.Fb(1),s.qc("ngIf","menu"===e.page))},directives:[p.n,_.c,v.a,c.i,c.k,p.m,f.a,a.e,Mt,k.k,f.b],pipes:[p.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                background-color: #fff;\n                height: 5em;\n                padding: 0 1em;\n                border-bottom: 1px solid #ccc;\n            }\n\n            [_nghost-%COMP%]    > *[_ngcontent-%COMP%]    + *[_ngcontent-%COMP%] {\n                margin-left: 0.5rem;\n            }\n\n            mat-form-field[_ngcontent-%COMP%] {\n                height: 3.25em;\n                width: 8em;\n            }"]}),t})();function Zn(t,e){1&t&&s.Sb(0,"catering-topbar",5)}function Qn(t,e){1&t&&s.Sb(0,"catering-order-list",6)}function ti(t,e){1&t&&s.Sb(0,"catering-menu",6)}const ei=function(){return["/menu"]},ni=function(){return["/orders"]};function ii(t,e){1&t&&(s.Xb(0,"div",7),s.Xb(1,"a",8),s.Xb(2,"div",9),s.Ic(3," Menus and Pricing "),s.Wb(),s.Xb(4,"div",10),s.Ic(5," View and Edit Menus and Pricing "),s.Wb(),s.Wb(),s.Xb(6,"a",8),s.Xb(7,"div",9),s.Ic(8," Today's Orders "),s.Wb(),s.Xb(9,"div",10),s.Ic(10," View Catering Orders and their statuses upon arrival "),s.Wb(),s.Wb(),s.Wb()),2&t&&(s.Fb(1),s.qc("routerLink",s.rc(6,ei)),s.Fb(1),s.Dc("background","rgba(0,0,0, .45) url(assets/img/menus.jpg)"),s.Fb(4),s.qc("routerLink",s.rc(7,ni)),s.Fb(1),s.Dc("background","rgba(0,0,0, .45) url(assets/img/orders.jpg)"))}let si=(()=>{class t extends F{constructor(t){super(),this._route=t}ngOnInit(){this.subscription("route.params",this._route.paramMap.subscribe(t=>this.page=t.has("view")?t.get("view"):""))}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(a.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["app-catering"]],features:[s.Cb],decls:6,vars:4,consts:[[1,"relative","w-full","flex","flex-col"],["class","relative z-10",4,"ngIf"],[3,"ngSwitch"],["class","flex-1",4,"ngSwitchCase"],["class","flex flex-1 items-center justify-center",4,"ngSwitchDefault"],[1,"relative","z-10"],[1,"flex-1"],[1,"flex","flex-1","items-center","justify-center"],["matRipple","",1,"rounded","flex","flex-col","items-center","bg-white","shadow","text-black",3,"routerLink"],["name","img",1,"w-full","flex","flex-1","items-center","justify-center","text-2xl","text-white"],[1,"p-2","h-14","w-full","text-sm","text-center","flex","items-center","justify-center"]],template:function(t,e){1&t&&(s.Xb(0,"main",0),s.Gc(1,Zn,1,0,"catering-topbar",1),s.Vb(2,2),s.Gc(3,Qn,1,0,"catering-order-list",3),s.Gc(4,ti,1,0,"catering-menu",3),s.Gc(5,ii,11,8,"div",4),s.Ub(),s.Wb()),2&t&&(s.Fb(1),s.qc("ngIf",e.page),s.Fb(1),s.qc("ngSwitch",e.page),s.Fb(1),s.qc("ngSwitchCase","orders"),s.Fb(1),s.qc("ngSwitchCase","menu"))},directives:[p.n,p.o,p.p,p.q,Yn,Vn,In,a.e],styles:["[_nghost-%COMP%] {\n                display: flex;\n                height: 100%;\n                width: 100%;\n            }\n\n            a[_ngcontent-%COMP%] {\n                width: 28rem;\n                height: 16rem;\n                margin-left: 0.5rem;\n                text-decoration: none;\n                transition: background 200ms;\n            }\n\n            a[_ngcontent-%COMP%]:hover {\n                background-color: #00000001 !important;\n            }\n\n            a[_ngcontent-%COMP%]:first-child {\n                margin: 0;\n            }\n\n            [name='img'][_ngcontent-%COMP%] {\n                background: rgba(0, 0, 0, 0.45);\n            }"]}),t})();const oi=[{path:"unauthorised",component:Vt},{path:"",component:si},{path:":view",component:si},{path:"**",redirectTo:"unauthorised"}];let ai=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.Pb({type:t}),t.\u0275inj=s.Ob({imports:[[a.f.forRoot(oi,{useHash:!0})],a.f]}),t})();var ci=n("Da6A"),ri=n("hxh6"),li=n("rgd1"),di=n("aI3+");let ui=(()=>{class t{constructor(t){this._org=t,this._list=new X.a([]),this._initialised=new X.a(!1),this.initialised=this._initialised.asObservable(),this.list=this._list.asObservable(),this._compare=t=>t.zones.includes(this._org.building.id),this._org.initialised.pipe(Object(q.a)(t=>t)).subscribe(()=>this.loadSpaces())}get space_list(){return this._list.getValue()}filter(t=this._compare){return this._list.getValue().filter(e=>t(e))}find(t){return this._list.getValue().find(e=>e.id===t||e.email===t)}loadSpaces(){return Object(M.a)(this,void 0,void 0,function*(){const t=(yield Object(W.m)({zone_id:this._org.organisation.id,limit:5e3}).pipe(Object(ft.a)(t=>t.data)).toPromise()).map(t=>new $n(Object.assign(Object.assign({},t),{level:this._org.levelWithID([...t.zones])}))).filter(t=>t.map_id);this._list.next(t),this._initialised.next(!0)})}}return t.\u0275fac=function(e){return new(e||t)(s.cc(mn))},t.\u0275prov=s.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function bi(t,e){1&t&&(s.Xb(0,"div",1),s.Xb(1,"div",2),s.Xb(2,"div",3),s.Sb(3,"mat-spinner",4),s.Wb(),s.Wb(),s.Wb()),2&t&&(s.Fb(3),s.qc("diameter",64))}let mi=(()=>{class t extends F{constructor(t,e,n,i,s,o,a,c){super(),this._tracing=t,this._settings=e,this._org=n,this._spaces=i,this._cache=s,this._snackbar=o,this._hotkey=a,this._clipboard=c,this._loading=new X.a(!1),this.loading=this._loading.asObservable()}ngOnInit(){return Object(M.a)(this,void 0,void 0,function*(){var t;this._hotkey.listen(["Control","Alt","Shift","KeyM"],()=>{localStorage.setItem("mock",`${"true"!==localStorage.getItem("mock")}`),location.reload()}),this._hotkey.listen(["Control","Alt","Shift","KeyC"],()=>{this._clipboard.copy(`${Object(W.u)()}|${Object(W.o)()}`),bt("Successfully copied token.")}),this._hotkey.listen(["Control","Alt","Shift","KeyV"],()=>{var t;null===(t=navigator.clipboard)||void 0===t||t.readText().then(t=>{t.split("|"),localStorage.setItem(`${Object(W.c)()}_access_token`,`${t[0]}`),localStorage.setItem(`${Object(W.c)()}_refresh_token`,`${t[1]}`),localStorage.setItem(`${Object(W.c)()}_expires_at`,`${Object(ci.a)(new Date,6).valueOf()}`),bt("Successfully pasted token."),setTimeout(()=>location.reload(),2e3)})}),ct=this._snackbar,this._loading.next(!0),yield this._settings.initialised.pipe(Object(q.a)(t=>t)).toPromise(),t=this._settings.get("app.short_name"),z=t;const e=this._settings.get("composer")||{};var n;e.mock=!!this._settings.get("mock"),yield function(t){return Object(M.a)(this,void 0,void 0,function*(){const e=t.protocol||location.protocol,n=t.domain||location.hostname,i=t.port||location.port,s=t.use_domain?`${e}//${n}:${i}`:location.origin,o=(location.pathname+"/").replace("//","/"),a=t.mock||location.href.includes("mock=true")||"true"===localStorage.getItem("mock"),c={auth_type:"auth_code",scope:"public",host:`${n}${i?":"+i:""}`,auth_uri:`${s}/auth/oauth/authorize`,token_uri:`${s}/auth/oauth/token`,redirect_uri:`${location.origin}${o}oauth-resp.html`,handle_login:!t.local_login,use_iframe:!0,mock:a};return localStorage&&localStorage.setItem("mock",`${!!a&&!location.href.includes("mock=false")}`),a&&mt("Application in mock mode."),Object(W.r)(c)})}(e).catch(()=>this.onInitError()),this._loading.next(!1),function(t,e=(()=>null),n=3e5){t.isEnabled&&(rt&&rt.unsubscribe(),lt&&lt.unsubscribe(),dt&&clearInterval(dt),rt=t.available.subscribe(e=>{D("CACHE",`Update available: current version is ${e.current.hash} available version is ${e.available.hash}`),function(t){t.isEnabled&&(D("CACHE","Activating changes to the cache..."),t.activateUpdate().then(()=>{mt("Newer version of the application is available","Refresh",()=>location.reload(!0))}))}(t)}),lt=t.activated.subscribe(()=>{D("CACHE","Updates activated. Reloading..."),e("Newer version of the application is available",()=>location.reload(!0))}),dt=setInterval(()=>{D("CACHE","Checking for updates..."),t.checkForUpdate()},n))}(this._cache),this.timeout("wait_for_user",()=>this.onInitError(),5e3),yield Ot.pipe(Object(q.a)(t=>!!t)).toPromise(),this.clearTimeout("wait_for_user"),(n=wt())&&(Pn=n),function(t,e=.2){t&&ri.a({dsn:t,integrations:[new di.a.BrowserTracing({tracingOrigins:["localhost",location.origin],routingInstrumentation:li.b})],tracesSampleRate:e})}(this._settings.get("app.sentry_dsn"))})}onInitError(){var t;Object(W.h)()||(null===(t=wt())||void 0===t?void 0:t.is_logged_in)||(console.error("Error initialising user."),Object(W.g)(),location.reload())}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(li.a),s.Rb(it),s.Rb(mn),s.Rb(ui),s.Rb(r.b),s.Rb(l.a),s.Rb(Q),s.Rb(w.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["app-root"]],features:[s.Cb],decls:3,vars:3,consts:[["class","loading-block",4,"ngIf"],[1,"loading-block"],[1,"info-block","center"],[1,"icon"],[3,"diameter"]],template:function(t,e){1&t&&(s.Sb(0,"router-outlet"),s.Gc(1,bi,4,1,"div",0),s.lc(2,"async")),2&t&&(s.Fb(1),s.qc("ngIf",s.mc(2,1,e.loading)))},directives:[a.g,p.n,u.b],pipes:[p.b],styles:[""]}),t})();const pi=[{created_at:1587057070,updated_at:1587692680,name:"PlaceOS",description:"",tags:"org",count:0,capacity:0,parent_id:"",triggers:[],id:"zone-EmWFTjuYExK"}],gi=[{name:"Sydney",description:"",tags:"building",count:0,capacity:0,parent_id:"zone-EmWFTjuYExK",triggers:[],id:"bld-01"},{name:"Brisbane",description:"",tags:"building",count:0,capacity:0,parent_id:"zone-EmWFTjuYExK",triggers:[],id:"bld-02"},{name:"Melbourne",description:"",tags:"building",count:0,capacity:0,parent_id:"zone-EmWFTjuYExK",triggers:[],id:"bld-03"}],hi=["lvl-00","lvl-01","lvl-02","lvl-03","lvl-04","lvl-05","lvl-06"],fi=gi.map(t=>hi.map((e,n)=>((t,e,n)=>{let i=t.substr(4);return i="https://s3-ap-southeast-2.amazonaws.com/os.place.tech/16012682998688307492.svg",{id:`${n.id}_${t}`,name:`Level ${t.endsWith("0")?"G":e}`,parent_id:n.id,description:"",tags:"level",map_id:"https://s3-ap-southeast-2.amazonaws.com/os.place.tech/16012682998688307492.svg",code:"level code 12",type:"staff floor",count:5,capacity:30,location:"optional lat,long",display_name:""}})(e,n,t))).reduce((t,e)=>t.concat(e),[]);Object(W.p)({path:"/api/engine/v2/zones",metadata:{},method:"GET",callback:t=>{if("org"===t.query_params.tags)return pi;if("building"===t.query_params.tags)return gi;if("level"===t.query_params.tags)return fi;throw{status:404,message:"Zones not found"}}}),Object(W.p)({path:"/api/engine/v2/metadata/:id",metadata:{},method:"GET",callback:t=>"catering"===t.query_params.name?[]:"desks"===t.query_params.name?{details:[{id:"table-01.001",name:"1.001",bookable:!0,group:""},{id:"table-01.002",name:"1.002",bookable:!0,group:""},{id:"table-01.003",name:"1.003",bookable:!0,group:""},{id:"table-01.004",name:"1.004",bookable:!0,group:""},{id:"table-01.005",name:"1.005",bookable:!1,group:""},{id:"table-01.006",name:"1.006",bookable:!0,group:""}]}:{}}),Object(W.p)({path:"/api/engine/v2/metadata/:id/children",metadata:{},method:"GET",callback:t=>[{zone:{id:"bld-01_lvl-01",name:"Level 1"},metadata:{desks:{details:[{id:"table-01.001",name:"1.001",bookable:!0,group:""},{id:"table-01.002",name:"1.002",bookable:!0,group:""},{id:"table-01.003",name:"1.003",bookable:!0,group:""},{id:"table-01.004",name:"1.004",bookable:!0,group:""},{id:"table-01.005",name:"1.005",bookable:!1,group:""},{id:"table-01.006",name:"1.006",bookable:!0,group:""}]}}}]});const _i="place.tech",vi=["Jonathan McFarlane","Alex Sorafumo","Jim Doe","Cristina Boston","Jeremy West","Alexandre Chuvand","Viv Briffa","Candy Russo","Jeff Wiz","Sravani Kotha","Kim Burgess","Landell Archer","Caspian Baska","Stephen Von Takach","Cameron Reeves","Shane Boseley"],yi={id:"current",name:"PlaceOS - Mock User",email:"dev@place.tech",groups:["deals",""]},Oi=vi.map((t,e)=>({id:`user-${e+1}`,name:t,email:`${t.split(" ").join(".").toLowerCase()}@${_i}`})).concat([yi]),wi=vi.map((t,e)=>({id:`guest-${e+1}`,name:t,email:`${t.split(" ").join(".").toLowerCase()}@not-${_i}`}));function ki(t,e){if(1&t&&(s.Xb(0,"div",8),s.Xb(1,"app-icon"),s.Ic(2,"account_circle"),s.Wb(),s.Xb(3,"div"),s.Ic(4),s.Wb(),s.Wb()),2&t){const t=s.kc(2);s.Fb(4),s.Jc(t.space.capacity)}}function Ii(t,e){if(1&t){const t=s.Yb();s.Xb(0,"button",9),s.gc("click",function(){return s.yc(t),s.kc(2).action.emit()}),s.Xb(1,"app-icon"),s.Ic(2),s.Wb(),s.Wb()}if(2&t){const t=s.kc(2);s.Fb(2),s.Jc("available"===t.type?"add":"close")}}function xi(t,e){if(1&t&&(s.Xb(0,"div",2),s.Xb(1,"div",3),s.Xb(2,"div",4),s.Ic(3),s.Wb(),s.Xb(4,"div",5),s.Ic(5),s.Wb(),s.Wb(),s.Gc(6,ki,5,1,"div",6),s.Gc(7,Ii,3,1,"button",7),s.Wb()),2&t){const t=s.kc(),e=s.vc(2);s.Fb(3),s.Jc(t.space.name),s.Fb(2),s.Kc(" ",(null==t.space.level?null:t.space.level.display_name)||(null==t.space.level?null:t.space.level.name)," "),s.Fb(1),s.qc("ngIf",-1!==t.space.capacity),s.Fb(1),s.qc("ngIf",t.multiple)("ngIfElse",e)}}function ji(t,e){if(1&t&&(s.Xb(0,"button",10),s.Ic(1),s.Wb()),2&t){const t=s.kc();s.Jb("request",t.space.by_request),s.Fb(1),s.Kc(" ",t.space.by_request?"Request":"Book"," ")}}let Wi=(()=>{class t{constructor(){this.action=new s.p}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=s.Lb({type:t,selectors:[["a-space-select-item"]],inputs:{space:"space",type:"type",multiple:"multiple"},outputs:{action:"action"},decls:3,vars:1,consts:[["space","","class","w-full flex items-center p-2 space-x-2",4,"ngIf"],["single_button",""],["space","",1,"w-full","flex","items-center","p-2","space-x-2"],[1,"flex-1","w-1/2"],[1,"text-base","truncate"],[1,"text-xs"],["class","flex items-center",4,"ngIf"],["mat-icon-button","",3,"click",4,"ngIf","ngIfElse"],[1,"flex","items-center"],["mat-icon-button","",3,"click"],["mat-button",""]],template:function(t,e){1&t&&(s.Gc(0,xi,8,5,"div",0),s.Gc(1,ji,2,3,"ng-template",null,1,s.Hc)),2&t&&s.qc("ngIf",e.space)},styles:[""]}),t})();var Xi=n("UXun"),Ci=n("vkgz"),Fi=n("odh7"),Mi=n("Wgwc"),qi=n("+QaA");Mi.extend(qi);const $i={month:43200,months:43200,week:10080,weeks:10080,day:1440,days:1440,hour:60,hours:60,minute:1,minutes:1};function Pi(t){if(t.rules){const e=Mi(t.time),n=Object.keys(t.rules).length;let i=0;for(const s of Object.keys(t.rules)){let n=0;const o=t.rules[s]instanceof Array?t.rules[s]:[t.rules[s]];switch(s){case"group":case"groups":t.user&&t.user.groups&&(n=0,o.forEach(e=>t.user.groups.find(t=>t===e)?n++:null),n>0&&i++);break;case"location":case"locations":break;case"is_before":if(t.time){const t=Gi(o[0]),n=Mi().add(t,"m");i+=e.isBefore(n,"m")?1:0}break;case"is_after":if(t.time){const[t,n]=o[0].split(" "),s=Mi().add(+t,n);e.isAfter(s,n)&&i++}break;case"from_time":const s=Mi(o[0],"HH:mm");Mi().isAfter(s,"m")&&i++;break;case"min_length":t.duration&&Si(t.duration,o[0])&&i++;break;case"max_length":t.duration&&Si(o[0],t.duration)&&i++;break;case"visitor_types":t.visitor_type&&(n=0,o.forEach(e=>e===t.visitor_type?n++:null),n>0&&i++)}}return i>=n}return!1}function Si(t,e){return("string"==typeof t?Gi(t):t)>=("string"==typeof e?Gi(e):e)}function Gi(t){const e=t.split(" ");return+e[0]*$i[e[1]]}Mi().hour(6).minute(0).subtract(1,"d").startOf("m");class Ei extends pt{constructor(t={}){super(t),this.primary=t.primary,this.summary=t.summary,this.can_edit=t.can_edit,this.resource=new $n(t.resource||t.system),this.availability=(t.availability||[]).map(t=>({date:new Date(t.starts_at.dateTime).valueOf(),duration:Object(qe.a)(new Date(t.ends_at.dateTime),new Date(t.starts_at.dateTime)),status:t.status}))}}function zi(t,e){if(1&t&&(s.Xb(0,"mat-option",13),s.Ic(1),s.Wb()),2&t){const t=e.$implicit;s.qc("value",t),s.Fb(1),s.Kc(" ",t.display_name||t.name," ")}}function Di(t,e){if(1&t){const t=s.Yb();s.Xb(0,"mat-form-field",10),s.Xb(1,"mat-select",11),s.gc("ngModelChange",function(e){return s.yc(t),s.kc().building.next(e)}),s.Gc(2,zi,2,2,"mat-option",12),s.Wb(),s.Wb()}if(2&t){const t=s.kc();s.Fb(1),s.qc("ngModel",t.building.getValue()),s.Fb(1),s.qc("ngForOf",t.buildings)}}function Li(t,e){if(1&t&&(s.Xb(0,"mat-option",13),s.Ic(1),s.Wb()),2&t){const t=e.$implicit;s.qc("value",t.id),s.Fb(1),s.Kc(" ",t.name," ")}}function Ti(t,e){if(1&t){const t=s.Yb();s.Xb(0,"mat-form-field",10),s.Xb(1,"mat-select",14),s.gc("ngModelChange",function(e){return s.yc(t),s.kc().type=e}),s.Gc(2,Li,2,2,"mat-option",12),s.Wb(),s.Wb()}if(2&t){const t=s.kc();s.Fb(1),s.qc("ngModel",t.type),s.Fb(1),s.qc("ngForOf",t.space_types)}}function Ai(t,e){if(1&t){const t=s.Yb();s.Xb(0,"a-space-select-item",17),s.gc("click",function(){s.yc(t);const e=s.kc().$implicit;return s.kc(3).spaceSelected(e)}),s.Wb()}if(2&t){const t=s.kc().$implicit,e=s.kc(3);s.qc("space",t)("multiple",e.multiple)}}function Ri(t,e){if(1&t&&(s.Vb(0),s.Gc(1,Ai,1,2,"a-space-select-item",16),s.Ub()),2&t){const t=e.$implicit,n=s.kc(3);s.Fb(1),s.qc("ngIf",!n.space_map[t.id])}}function Vi(t,e){if(1&t&&(s.Vb(0),s.Gc(1,Ri,2,1,"ng-container",15),s.lc(2,"async"),s.Ub()),2&t){const t=s.kc(2);s.Fb(1),s.qc("ngForOf",s.mc(2,1,t.filtered_spaces))}}function Ji(t,e){if(1&t&&(s.Vb(0),s.Gc(1,Vi,3,3,"ng-container",5),s.lc(2,"async"),s.Ub()),2&t){const t=s.kc(),e=s.vc(16);let n=null;s.Fb(1),s.qc("ngIf",null==(n=s.mc(2,2,t.filtered_spaces))?null:n.length)("ngIfElse",e)}}function Ni(t,e){if(1&t&&s.Sb(0,"a-space-select-item",20),2&t){const t=e.$implicit,n=s.kc(3);s.qc("space",t)("multiple",n.multiple)}}function Ui(t,e){if(1&t&&(s.Vb(0),s.Gc(1,Ni,1,2,"a-space-select-item",19),s.Ub()),2&t){const t=s.kc(2);s.Fb(1),s.qc("ngForOf",t.spaces)}}function Ki(t,e){if(1&t&&(s.Xb(0,"div",18),s.Gc(1,Ui,2,1,"ng-container",5),s.Wb()),2&t){const t=s.kc(),e=s.vc(16);s.Jb("show",t.show_selected),s.Fb(1),s.qc("ngIf",t.spaces&&t.spaces.length)("ngIfElse",e)}}function Bi(t,e){if(1&t){const t=s.Yb();s.Xb(0,"footer"),s.Xb(1,"button",21),s.gc("click",function(){return s.yc(t),s.kc().save()}),s.Ic(2),s.Wb(),s.Wb()}if(2&t){const t=s.kc();s.Fb(2),s.Kc(" Save selected spaces(",t.spaces.length||"0",") ")}}function Hi(t,e){1&t&&(s.Xb(0,"div",22),s.Xb(1,"app-icon",0),s.Ic(2,"close"),s.Wb(),s.Xb(3,"p"),s.Ic(4,"No spaces"),s.Wb(),s.Wb())}function Yi(t,e){1&t&&(s.Xb(0,"div",23),s.Sb(1,"mat-spinner",24),s.Xb(2,"p"),s.Ic(3,"Finding available spaces..."),s.Wb(),s.Wb())}let Zi=(()=>{class t extends F{constructor(t,e,n){super(),this._org=t,this._settings=e,this._data=n,this.event=new s.p,this.spaces=[...this._data.spaces||[]],this.building=new X.a(null),this.space_types=[],this.available_spaces=Object(bn.a)([this.building]).pipe(Object(Cn.a)(([t])=>(this.loading=!0,function(t,e){const n=at(t);return Object(W.e)("/api/staff/v1/calendars/free_busy"+(n?"?"+n:"")).pipe(Object(ft.a)(t=>t.map(t=>new Ei(t))),Object(ft.a)(t=>t.filter(t=>!!t.resource).map(t=>new $n(Object.assign(Object.assign({},t.resource),{level:void 0}))).filter(t=>t.bookable)))}({zone_ids:null==t?void 0:t.id,period_start:Object(Fi.a)(this._data.date),period_end:Object(Fi.a)(Object($e.a)(this._data.date,this._data.duration))}))),Object(Xi.a)(1)),this.filtered_spaces=this.available_spaces.pipe(Object(ft.a)(t=>function(t=[],e,n,i){return t.filter(t=>{var s;const o=null===(s=e[t.level.parent_id].details)||void 0===s?void 0:s.booking_rules,{date:a,all_day:c,duration:r,visitor_type:l}=i,d=function(t){if(!t)throw Error("Options are needed to check for rule matches");const e={auto_approve:!0,hide:!1};if(t.space)for(const n of Object.keys(t.rules||{}))if(t.rules.hasOwnProperty(n)&&t.rules[n]instanceof Array&&(t.space.zones||[]).find(t=>t===n)){e.hide=!0;for(const i of t.rules[n])if(Pi({user:t.user,space:t.space,time:t.time,visitor_type:t.visitor_type,duration:t.duration,rules:i.conditions})){const t=i.rules,n=i.conditions;e.hide=!1,n.max_length&&(e.max_length=Gi(n.max_length)),n.min_length&&(e.min_length=Gi(n.min_length)),void 0!==t.auto_approve&&(e.auto_approve=t.auto_approve),void 0!==t.room_type&&(e.room_type=t.room_type);break}if(!e.hide)break}return e}({space:t,time:a,duration:c?1440:r,visitor_type:l,user:n,rules:o});return l?!d.hide&&d.room_type===l:!d.hide})}(t,this._org.building_settings,wt(),Object.assign({},this._data))),Object(Ci.a)(()=>this.loading=!1)),this.building.next(this._org.building||this.buildings[0]),this.subscription("spaces",this.filtered_spaces.subscribe(t=>t))}get buildings(){return this._org.buildings}get multiple(){return!!this._settings.get("app.booking.multiple_spaces")}get space_map(){const t={};return this.spaces.forEach(e=>t[e.id]=!0),t}spaceSelected(t){this.multiple?this.space_map[t.id]||this.spaces.push(t):(this.spaces=[t],this.save())}save(){this.event.emit({reason:"done",metadata:this.spaces})}}return t.\u0275fac=function(e){return new(e||t)(s.Rb(mn),s.Rb(it),s.Rb(d.a))},t.\u0275cmp=s.Lb({type:t,selectors:[["a-space-select-modal"]],outputs:{event:"event"},features:[s.Cb],decls:19,vars:7,consts:[[1,"text-3xl"],[1,"text-xl","font-semibold","flex-1"],["mat-icon-button","","mat-dialog-close",""],["appearance","outline",4,"ngIf"],[1,"body",2,"width","32rem"],[4,"ngIf","ngIfElse"],["class","space-list",3,"show",4,"ngIf"],[4,"ngIf"],["empty_state",""],["load_state",""],["appearance","outline"],["name","booking-type","placeholder","Select building",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["name","booking-type","placeholder","Any space type",3,"ngModel","ngModelChange"],[4,"ngFor","ngForOf"],["type","available",3,"space","multiple","click",4,"ngIf"],["type","available",3,"space","multiple","click"],[1,"space-list"],["type","selected",3,"space","multiple",4,"ngFor","ngForOf"],["type","selected",3,"space","multiple"],["mat-button","",3,"click"],["empty","",1,"flex","flex-col","items-center","space-y-2"],["load","",1,"flex","flex-col","items-center","space-y-2"],["diameter","48"]],template:function(t,e){if(1&t&&(s.Xb(0,"header"),s.Xb(1,"app-icon",0),s.Ic(2,"place"),s.Wb(),s.Xb(3,"div",1),s.Ic(4),s.Wb(),s.Xb(5,"button",2),s.Xb(6,"app-icon",0),s.Ic(7,"close"),s.Wb(),s.Wb(),s.Wb(),s.Xb(8,"main"),s.Gc(9,Di,3,2,"mat-form-field",3),s.Gc(10,Ti,3,2,"mat-form-field",3),s.Xb(11,"div",4),s.Gc(12,Ji,3,4,"ng-container",5),s.Gc(13,Ki,2,4,"div",6),s.Wb(),s.Gc(14,Bi,3,1,"footer",7),s.Gc(15,Hi,5,0,"ng-template",null,8,s.Hc),s.Gc(17,Yi,4,0,"ng-template",null,9,s.Hc),s.Wb()),2&t){const t=s.vc(18);s.Fb(4),s.Kc(" Select space",e.multiple?"s":""," "),s.Fb(5),s.qc("ngIf",e.buildings&&e.buildings.length>1),s.Fb(1),s.qc("ngIf",e.space_types&&e.space_types.length>1),s.Fb(2),s.qc("ngIf",!e.loading)("ngIfElse",t),s.Fb(1),s.qc("ngIf",e.multiple),s.Fb(1),s.qc("ngIf",e.multiple)}},styles:["mat-form-field[_ngcontent-%COMP%] {\n                height: 3.5em;\n                width: 100%;\n                padding: 0 0.25em;\n            }\n\n            .body[_ngcontent-%COMP%] {\n                min-width: 20rem;\n                max-width: calc(100vw - 2rem);\n            }"]}),t})();s.Bc(Zi,[Mt,f.b,d.d,p.n,_.c,v.a,p.m,k.k,Wi,u.b],[p.b]),s.Bc(Wi,[p.n,Mt,f.b],[]);let Qi=0;const ts=()=>{const t=["Whiteboard","VidConf","Projector","Views"],e=Y(t.length+1),n=[];for(let i=0;i<e;i++)n.push(t[Y(t.length)]);return n.filter((t,e,n)=>n.indexOf(t)===e).join(" ")},es=[{name:"Meeting Room 1.01",map_id:"area-1.01-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.02",map_id:"area-1.02-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.03",map_id:"area-1.03-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.04",map_id:"area-1.04-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.05",map_id:"area-1.05-status",zones:["bld-01_lvl-01"],bookable:!1},{name:"Meeting Room 1.06",map_id:"area-1.06-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.07",map_id:"area-1.07-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.08",map_id:"area-1.08-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.09",map_id:"area-1.01-status",zones:["bld-01_lvl-01"]},{name:"Meeting Room 1.10",map_id:"area-1.10-status",zones:["bld-01_lvl-01"]}].map(t=>function(t={}){const e="space-"+Qi++,n=`Test Space ${Qi}`,i=Math.floor(99999*Math.random())%2==0&&Qi>1,s=Object.assign({id:e,name:n,long_name:`${n} with an long name`,map_id:`${Qi}`,capacity:2*Math.floor(20*Math.random()+1),email:`${n.toLowerCase().split(" ").join(".")}@place.tech`,type:"",searchable:Math.floor(99999*Math.random())%2==0,controlable:Math.floor(99999*Math.random())%2==0,bookable:Math.floor(99999*Math.random())%2==0,cost_hour:100*Math.floor(300*Math.random()),setup:5*Math.floor(6*Math.random()),breakdown:5*Math.floor(6*Math.random()),zones:["zone_lvl-0"],support_url:`/control/#/${e}`,bookings:[],linked_rooms:i?[`space-${Math.floor(Math.random()*(Qi-1))}`]:[],image:""},t);return s.configurations&&s.configurations.length>0&&(s.configurations.forEach(t=>t.capacity=Math.floor(Math.random()*s.capacity)+1),s.configurations[0].capacity=s.capacity),s}(Object.assign(Object.assign({},t),{features:ts()})));let ns=Mi().startOf("d").hour(7);const is=(t=!1)=>{const e=ns.add(15*(Y(8)+1),"m");return t&&(ns=e),e.unix()},ss=["tentative","confirmed","cancelled"],os=()=>{const t=Y(10);return t<2?ss[2]:t<5?ss[0]:ss[1]},as=new Array(200).fill(0).map((t,e)=>{let n=Oi.concat(wi).filter(t=>Y(9999)%3==0);n.unshift(Oi[Y(Oi.length)]),n=T(n,"email");const i=es[Y(es.length)];n=n.concat(Object.assign(Object.assign({},i),{resource:!0}));const s=Y(9999)%2==0;return s&&n.push(yi),{id:`cal-event-${e}`,status:os(),host:s?yi.email:n[0].email,calendar:"calendar_id",creator:"optional@fake.com",attendees:T(n,"email"),title:`Some Meeting ${e}`,body:"A Description",private:!1,event_start:is(!0),event_end:is(),timezone:"Sydney",all_day:!1,location:"clear text location",recurring:!1,recurrence:{},attachments:{},system:i,extension_data:{}}}),cs={};as.forEach(t=>{cs[t.system.id]||(cs[t.system.id]=[]),cs[t.system.id].push(t)}),Object(W.p)({path:"/api/engine/v2/users/:id",metadata:{},method:"GET",callback:t=>{if("current"===t.route_params.id)return yi;const e=Oi.find(e=>e.email===t.route_params.id);if(e)return e;throw{status:404,message:"User not found"}}}),Object(W.p)({path:"/api/staff/v1/people",metadata:{},method:"GET",callback:t=>{if(t.query_params.q){const e=t.query_params.q.toLowerCase();return Oi.filter(t=>t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e))}return Oi}}),Object(W.p)({path:"/api/staff/v1/people/:id",metadata:{},method:"GET",callback:t=>{const e=decodeURIComponent(t.route_params.id),n=Oi.find(t=>t.email===e);if(n)return Object.assign(Object.assign({},n),{location:ls()});throw{status:404,message:"User not found"}}}),Object(W.p)({path:"/api/staff/v1/guests",metadata:{},method:"GET",callback:t=>{if(t.query_params.q){const e=t.query_params.q.toLowerCase();return wi.filter(t=>t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e))}return Oi}}),Object(W.p)({path:"/api/staff/v1/guests/:email",metadata:{},method:"GET",callback:t=>{const e=wi.find(e=>e.email===t.route_params.email);if(e)return e;throw{status:404,message:"Guest not found"}}}),Object(W.p)({path:"/api/staff/v1/guests/:email/meetings",metadata:{},method:"GET",callback:t=>{if(t.route_params.email){const e=t.route_params.email.toLowerCase();return as.filter(t=>t.attendees.find(t=>t.email.toLowerCase()===e))}throw{status:404,message:`Unable to find meetings with guest with email ${t.route_params.email}`}}});const rs=["meeting","desk_id","laptop","mobile","geo","none"];function ls(){const t=rs[Y(rs.length)],e=fi[Y(fi.length)],n=es.filter(t=>t.zones.includes(e.id)),i=n[Y(n.length)]||{},s={};switch(t){case"meeting":s.meeting={building:e.parent_id,level:e.id,system:i.id,map_id:i.map_id,event_id:""};break;case"desk_id":s.meeting={building:e.parent_id,level:e.id,map_id:i.map_id,checked_in:Mi().unix()};break;case"laptop":case"mobile":s[t]={building:e.parent_id,level:e.id,x:+Y(1e4),y:+Y(5e3),last_seen:Mi().subtract(Y(60),"m").unix()};break;case"geo":s.geo={lat:Y(180)-90,lon:Y(360)-180,last_seen:Mi().subtract(Y(60),"m").unix()}}return s}class ds{constructor(t){var e;this.recording=!0,this.volume=0,this.name=t.name||"Test Module",this.connected=null===(e=t.connected)||void 0===e||e,this.active=t.active||!1,this.input_list=t.input_list,this.output_list=t.output_list,this.env_sources=t.env_sources||[],this.inputs=Object.keys(this.input_list||{})||[],this.outputs=Object.keys(this.output_list||{})||[],T(this.env_sources.map(t=>t.type)).forEach(t=>this[`${t}`]=this.env_sources.filter(e=>e.type===t).map(t=>t.id)),this.env_sources.forEach(t=>this[`${t.type}/${t.id}`]=t),this.inputs.forEach(t=>this[`input/${t}`]=this.input_list[t]),this.outputs.forEach(t=>this[`output/${t}`]=this.output_list[t])}$powerup(){console.log("Power On"),this.active=!0}$shutdown(){this.active=!1}$share(){}$route(t,e){this.inputs.includes(t)&&this.outputs.includes(e)&&(this.$updateState(t,{routes:T([...this.input_list[t].routes||[],e])}),this.$updateState(e,{source:t,following:t}))}$unroute(){}$connect(){}$disconnect(){}$link(){}$merge(){}$split(){}$notify(){}$preset(){}$volume(t,e="all"){"all"===e&&(this.volume=t)}$mute(t=!0,e="all"){this.$updateState(e,{mute:t})}$unmute(t="all"){this.$mute(!1,t)}$environment(t,e){const n=this.env_sources.find(e=>e.id===t);n&&(this[`${n.type}/${n.id}`]=Object.assign(Object.assign({},n),{state:e}))}$lock(t){this.$updateState(t,{locked:!0})}$unlock(t){this.$updateState(t,{locked:!1})}$updateState(t,e){this[`input/${t}`]?(this[`input/${t}`]=Object.assign(Object.assign({},this[`input/${t}`]),e),this.input_list[t]=Object.assign(Object.assign({},this[`input/${t}`]),e)):this[`output/${t}`]&&(this[`output/${t}`]=Object.assign(Object.assign({},this[`output/${t}`]),e),this.output_list[t]=Object.assign(Object.assign({},this[`output/${t}`]),e))}}const us={Mic1:{name:"Lectern Mic",type:"Microphone",module:"Microphone_1"},Mic2:{name:"Lapel Mic",type:"Microphone",module:"Microphone_2"},Mic3:{name:"Handheld Mic",type:"Microphone",module:"Microphone_3"},PC1:{name:"PC-1",type:"PC"},PC2:{name:"PC-2",type:"PC"},PC3:{name:"PC-3",type:"PC"},PC4:{name:"PC-4",type:"PC"},HDMI:{name:"Laptop HDMI",type:"Laptop"},VGA:{name:"Laptop VGA",type:"Laptop"},Camera1:{name:"Camera Rear",type:"Camera",module:"Camera_1"},Camera2:{name:"Camera Front",type:"Camera",module:"Camera_2"},Camera3:{name:"Camera Rear 2",type:"Camera",module:"Camera_3"},Camera4:{name:"Camera Front 2",type:"Camera",module:"Camera_4"},TV1:{name:"IPTV 1",type:"TV",module:"IPTV_1"}},bs={Display1:{name:"Display 1",type:"Display",source:"PC1",module:"Display_1"},Display2:{name:"Display 2",type:"Display",module:"Display_2"},Display3:{name:"Display 3",type:"Display",source:"PC2",module:"Display_3"},Display4:{name:"Display 4",type:"Display",module:"Display_4"},Display5:{name:"Display 5",type:"Display",module:"Display_5",source:"TV1"}},ms=[{id:"light1",name:"Lighting",type:"lights",states:["Off","Presentation","Meeting","Full"],state:"Off"},{id:"blind1",name:"Blinds",type:"blinds",states:["Off","Presentation","Meeting"],state:"Off"},{id:"screen1",name:"Screen",type:"screen",states:["Up","Down"],state:"Down"}],ps=(t,e={})=>new ds(Object.assign(Object.assign(Object.assign({},t),{input_list:us,output_list:bs,env_sources:ms}),e));var gs=n("SuC2"),hs=n("Ctv7");class fs{constructor(){this.time_zone="Australia/Sydney",this.disable_book_now=!1,this.disable_end_meeting=!1,this.bookings=[],this.pending_period=0,this.pending_before=0,this.control_ui="",this.catering_ui="",this.last_booking_started=0,this.status="free"}}function _s(t,e={}){const n=Object.assign(Object.assign(Object.assign({},new fs),e),{$start_meeting:function(t){this.last_booking_started=t},$end_meeting:function(t){},$book_now:function(t,e,n){}});return vs(t,n),setInterval(()=>vs(t,n),1e3),n}function vs(t,e){var n;const i=as.filter(e=>e.attendees.find(e=>e.email===t.email));if(i.sort((t,e)=>t.event_start-e.event_start),e.bookings=i,!t.bookable)return e.status="not-bookable";const s=new Date,o=i.find(t=>V(s.valueOf(),s.valueOf(),t.event_start,t.event_end)),a=i.find(t=>Object(Ce.a)(s.valueOf(),t.event_start)),c=new Date(null===(n=o||a)||void 0===n?void 0:n.event_start),r=V(s,s,Object(gs.a)(c,e.pending_before),Object(hs.a)(c,e.pending_period));e.status=o?r?"pending":"busy":a&&r?"pending":"free"}var ys=n("kScs");class Os{constructor(){this.overview={}}$locate_user(t,e){}}function ws(t,e=3){let n=`${t}`;for(;n.length<e;)n="0"+n;return n}function ks(t,e={}){const n=new Os;for(const i of fi)n.overview[i.id]={desk_count:100,desk_usage:0,device_capacity:100,device_count:0,estimated_people:0,percentage_use:0,recommendation:1e4},n[`${i.id}:desk_ids`]=new Array(n.overview[i.id].desk_count).fill(0).map((t,e)=>`table-${i.number}.${ws(e)}`),n[`${i.id}`]={value:[]};return Is(n,fi),setInterval(()=>Is(n,fi),6e4),n}function Is(t,e){for(const n of e)t[n.id]={value:new Array(Y(20)).fill(0).map(()=>xs(n,t[`${n.id}:desk_ids`]))}}function xs(t,e,n=Oi){return Y(9999)%3==0?{location:"desk",at_location:Y(9999)%5!=0,map_id:e[Y(e.length)],mac:ys.Md5.hashStr(n[Y(n.length)].email),level:t.id,building:t.parent_id}:{location:"wireless",coordinates_from:"bottom-left",x:Y(1e3)/10,y:Y(1e3)/10,lon:55.27476066828535,lat:25.20106100633537,s2_cell_id:"3e5f4281459c",mac:ys.Md5.hashStr(n[Y(n.length)].email),variance:9.62534032222287,last_seen:Math.floor((new Date).valueOf()/1e3),map_width:100,map_height:100}}class js{constructor(t){this.presets=["Preset One","Preset 2","Preset Three"]}$pan(t){}$tilt(t){}$recall(t){}$save_preset(t){}}class Ws{constructor(t){this.volume=A(100)}$mute(t=!0){this.mute=t}$volume(t){this.volume=t}}class Xs{constructor(t){this.volume=A(100)}$mute(t=!0){this.mute=t}$volume(t){this.volume=t}}let Cs;class Fs{constructor(t){this.status="stopped",this.live=!1,this.remaining=A(86400)}$start(){this.status="playing",Cs=setInterval(()=>{this.remaining<1&&clearInterval(Cs),this.remaining=this.remaining-1,this.current=this.current+1},3e3)}$pause(){this.status="paused",clearInterval(Cs)}$resume(){this.$start()}$stop(){this.status="stopped",this.current=0,clearInterval(Cs)}}const Ms=(t,e={})=>new Fs(Object.assign(Object.assign({},t),e));es.forEach((t,e)=>function(t){Object(W.q)(t.id,{System:[ps(t)],Bookings:[_s(t)],AreaManagement:[ks()],Camera:new Array(10).fill(0).map(e=>((t,e={})=>new js(Object.assign(Object.assign({},t),e)))(t)),Display:new Array(10).fill(0).map(e=>((t,e={})=>new Ws(Object.assign(Object.assign({},t),e)))(t)),Microphone:new Array(10).fill(0).map(e=>((t,e={})=>new Xs(Object.assign(Object.assign({},t),e)))(t)),Capture:[Ms(t)]})}(t)),Object(W.p)({path:"/api/engine/v2/systems",metadata:{},method:"GET",callback:t=>es}),Object(W.p)({path:"/api/staff/v1/events",metadata:{},method:"GET",callback:t=>as.filter(t=>!!t.attendees.find(t=>t.email===yi.email))}),Object(W.p)({path:"/api/staff/v1/events",metadata:{},method:"POST",callback:t=>{const e=Object.assign(Object.assign({},t.body),{id:`-cal-event-${Y(999)}`});return e.attendees.forEach(t=>{t.zones&&(t.resource=!0)}),as.push(e),e}}),Object(W.p)({path:"/api/staff/v1/events/:id",metadata:{},method:"GET",callback:t=>{const e=as.find(e=>e.id===t.route_params.id);if(e)return e;throw{status:404,message:"Event not found"}}}),Object(W.p)({path:"/api/staff/v1/events/:id",metadata:{},method:"PATCH",callback:t=>{const e=as.findIndex(e=>e.id===t.route_params.id);if(e>=0)return as.splice(e,1,t.body);throw{status:404,message:"Event not found"}}}),Object(W.p)({path:"/api/staff/v1/events/:id/guests/:email/checkin",metadata:{},method:"POST",callback:t=>{const e=as.find(e=>e.id===t.route_params.id);if(e)return e.extension_data.checked_in=(e.extension_data.checked_in||[]).concat([t.route_params.email]),e;throw{status:404,message:"Guest not found"}}}),Object(W.p)({path:"/api/staff/v1/calendars",metadata:{},method:"GET",callback:t=>[]}),Object(W.p)({path:"/api/staff/v1/calendars/availability",metadata:{},method:"GET",callback:t=>{const e=Mi(1e3*+t.query_params.period_start),n=Mi(1e3*+t.query_params.period_end),i=(t.query_params.zone_ids||"").split(",").filter(t=>!!t),s=(t.query_params.system_ids||"").split(",").filter(t=>!!t),o=es.filter(t=>i.length?i.reduce((e,n)=>e&&t.zones.includes(n),!0):!s.length||s.includes(t.id)).filter(t=>{const i=as.filter(e=>e.attendees.find(e=>e.id===t.id));for(const s of i){const t=Mi(1e3*s.event_start),i=Mi(1e3*s.event_end);if(e.isAfter(t,"s")&&e.isBefore(i,"m")||n.isAfter(t,"m")&&n.isBefore(i,"m")||t.isAfter(e,"m")&&t.isBefore(n,"m"))return!1}return!0}),a={};return o.forEach(t=>a[t.email]=t),a}}),Object(W.p)({path:"/api/staff/v1/bookings",metadata:{},method:"GET",callback:t=>[]});var qs=n("8w4p");let $s=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.Pb({type:t,bootstrap:[mi]}),t.\u0275inj=s.Ob({providers:[{provide:s.o,useValue:qs.a({showDialog:!1})},{provide:li.a,deps:[a.d]}],imports:[[i.a,o.b,c.e,c.l,ai,l.b,d.f,u.a,b.c,m.e,Jn,Nt,r.a.register("ngsw-worker.js",{enabled:!0})]]}),t})();Object(s.X)(),i.d().bootstrapModule($s).catch(t=>console.error(t))},zn8P:function(t,e){function n(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="zn8P"}},[[0,0,4]]]);
//# sourceMappingURL=main.js.map