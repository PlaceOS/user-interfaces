(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([[461],{6461:(e,t,s)=>{"use strict";s.r(t),s.d(t,{DesksModule:()=>K});var n=s(1511),i=s(6073),o=s(6898),l=s(4810),a=s(787),r=s(5633),c=s(2619),u=s(1490),d=s(4762),p=s(3530),h=s(611),g=s(3206),f=s(9294),m=s(1663),_=s(6283),Z=s(4786),k=s(1522),v=s(3708),A=s(5980);function x(e,t){if(1&e&&(c.TgZ(0,"mat-option",7),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.Q6J("value",e.id),c.xp6(1),c.hij(" ",e.display_name||e.name," ")}}const q=function(){return["/desks"]},w=function(e){return{show_map:e}};function b(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"a",8),c.NdJ("click",function(){return c.CHM(e),c.oxw().toggleMapShow()}),c.ALo(1,"async"),c._uU(2),c.ALo(3,"async"),c.qZA()}if(2&e){const e=c.oxw();let t,s;c.Q6J("routerLink",c.DdM(7,q))("queryParams",c.VKq(8,w,!(null!=(t=c.lcZ(1,3,e.filters))&&t.show_map))),c.xp6(2),c.hij(" ",null!=(s=c.lcZ(3,5,e.filters))&&s.show_map?"Show List View":"Show Map View"," ")}}const y=function(){return[]};let T=(()=>{class e extends g.KG{constructor(e,t,s,n){super(),this._desks=e,this._org=t,this._route=s,this._router=n,this.levels=this._org.active_levels,this.filters=this._desks.filters,this.toggleMapShow=()=>{this._desks.setFilters({show_map:!this.show_map}),this.show_map=!this.show_map},this.setDate=e=>this._desks.setFilters({date:e}),this.updateZones=e=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:e.join(",")},queryParamsHandling:"merge"}),this._desks.setFilters({zones:e})}}ngOnInit(){return(0,d.mG)(this,void 0,void 0,function*(){yield this._org.initialised.pipe((0,p.P)(e=>e)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(e=>{if(e.has("zone_ids")){const t=e.get("zone_ids").split(",");if(t.length){const e=this._org.levelWithID(t);if(!e)return;this._org.building=this._org.buildings.find(t=>t.id===e.parent_id),this.updateZones(t)}}e.has("date")&&this.setDate(new Date(+e.get("date"))),e.has("approve")?this.approve(e.get("approve")):e.has("reject")&&this.reject(e.get("reject")),this.show_map=e.has("show_map")&&"true"===e.get("show_map"),this._desks.setFilters({show_map:this.show_map})})),this.subscription("levels",this._org.active_levels.subscribe(e=>(0,d.mG)(this,void 0,void 0,function*(){var t;const s=(null===(t=(yield this.filters.pipe((0,h.q)(1)).toPromise()).zones)||void 0===t?void 0:t.filter(t=>e.find(e=>e.id===t)||"All"===t))||[];!s.length&&e.length&&s.push(e[0].id),this.updateZones(s)})))})}approve(e){return(0,d.mG)(this,void 0,void 0,function*(){const t=yield(0,m.Fo)(e).toPromise();t&&this._desks.approveDesk(t)})}reject(e){return(0,d.mG)(this,void 0,void 0,function*(){const t=yield(0,m.Fo)(e).toPromise();t&&this._desks.rejectDesk(t)})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(r.H),c.Y36(f.w7),c.Y36(o.gz),c.Y36(o.F0))},e.\u0275cmp=c.Xpm({type:e,selectors:[["desks-topbar"]],features:[c.qOj],decls:11,vars:10,consts:[["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],["value","All"],[3,"value",4,"ngFor","ngForOf"],["button","","mat-button","","queryParamsHandling","merge",3,"routerLink","queryParams","click",4,"ngIf"],[1,"flex-1","w-2"],[3,"dateChange"],[3,"value"],["button","","mat-button","","queryParamsHandling","merge",3,"routerLink","queryParams","click"]],template:function(e,t){1&e&&(c.TgZ(0,"mat-form-field",0),c.TgZ(1,"mat-select",1),c.NdJ("ngModelChange",function(e){return t.updateZones(e)}),c.ALo(2,"async"),c.TgZ(3,"mat-option",2),c._uU(4,"All Levels"),c.qZA(),c.YNc(5,x,2,2,"mat-option",3),c.ALo(6,"async"),c.qZA(),c.qZA(),c.YNc(7,b,4,10,"a",4),c.ALo(8,"async"),c._UZ(9,"div",5),c.TgZ(10,"date-options",6),c.NdJ("dateChange",function(e){return t.setDate(e)}),c.qZA()),2&e&&(c.xp6(1),c.Q6J("ngModel",c.lcZ(2,3,t.filters).zones||c.DdM(9,y)),c.xp6(4),c.Q6J("ngForOf",c.lcZ(6,5,t.levels)),c.xp6(2),c.Q6J("ngIf",1===(null==c.lcZ(8,7,t.filters).zones?null:c.lcZ(8,7,t.filters).zones.length)))},directives:[_.KE,Z.gD,i.JJ,i.On,k.ey,n.sg,n.O5,v.E,A.zs,o.yS],pipes:[n.Ov],styles:["[_nghost-%COMP%]{display:flex;align-items:center;background-color:#fff;height:5em;padding:0 1em;border-bottom:1px solid #ccc}[_nghost-%COMP%] > *[_ngcontent-%COMP%] + *[_ngcontent-%COMP%]{margin-left:.5rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}"]}),e})();var O=s(9996),U=s(8055),M=s(1548),P=s(9436);let J=(()=>{class e{constructor(e){this._state=e,this.checkin=()=>this.runMethod("checkin",()=>(0,d.mG)(this,void 0,void 0,function*(){return this._state.checkinDesk(this.desk)})),this.approve=()=>this.runMethod("approve",()=>(0,d.mG)(this,void 0,void 0,function*(){return this._state.approveDesk(this.desk)})),this.reject=()=>this.runMethod("reject",()=>(0,d.mG)(this,void 0,void 0,function*(){return this._state.rejectDesk(this.desk)}))}runMethod(e,t){return(0,d.mG)(this,void 0,void 0,function*(){this.loading=e,yield t().catch(e=>null),this.loading=""})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(r.H))},e.\u0275cmp=c.Xpm({type:e,selectors:[["desk-details"]],inputs:{desk:"desk"},decls:21,vars:19,consts:[[1,"w-32","p-2","bg"],[1,"w-32","p-2"],[1,"w-24","p-2"],["flex","",1,"p-2","flex-1","truncate"],[1,"w-32","p-2","flex","items-center"],["mat-icon-button","","content","how_to_reg",3,"loading","state","click"],["mat-icon-button","","content","event_available",3,"loading","state","click"],["mat-icon-button","","content","event_busy",3,"loading","state","click"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c._uU(1),c.qZA(),c.TgZ(2,"div",1),c._uU(3),c.qZA(),c.TgZ(4,"div",2),c._uU(5),c.ALo(6,"date"),c.qZA(),c.TgZ(7,"div",3),c._uU(8),c.qZA(),c.TgZ(9,"div"),c._uU(10),c.qZA(),c.TgZ(11,"div",1),c._uU(12),c.qZA(),c.TgZ(13,"div",1),c._uU(14),c.qZA(),c.TgZ(15,"div",2),c._uU(16),c.qZA(),c.TgZ(17,"div",4),c.TgZ(18,"action-icon",5),c.NdJ("click",function(){return t.checkin()}),c.qZA(),c.TgZ(19,"action-icon",6),c.NdJ("click",function(){return t.approve()}),c.qZA(),c.TgZ(20,"action-icon",7),c.NdJ("click",function(){return t.reject()}),c.qZA(),c.qZA()),2&e&&(c.xp6(1),c.Oqu(null==t.desk?null:t.desk.user_name),c.xp6(2),c.Oqu(null==t.desk||null==t.desk.extension_data?null:t.desk.extension_data.group),c.xp6(2),c.Oqu(c.xi3(6,16,t.desk.date,"shortTime")),c.xp6(3),c.Oqu(null==t.desk?null:t.desk.description),c.xp6(1),c.Tol("w-24 p-2 capitalize text-red-600 "+(null==t.desk?null:t.desk.status)),c.xp6(1),c.hij(" ",null==t.desk?null:t.desk.status," "),c.xp6(2),c.Oqu(null==t.desk?null:t.desk.approver_name),c.xp6(2),c.Oqu(null!=t.desk&&t.desk.checked_in?"Yes":"No"),c.xp6(2),c.Oqu(null!=t.desk&&t.desk.access?"Yes":"No"),c.xp6(2),c.Q6J("loading","checkin"===t.loading)("state",null!=t.desk&&t.desk.checked_in?"success":""),c.xp6(1),c.Q6J("loading","approve"===t.loading)("state",null!=t.desk&&t.desk.approved?"success":""),c.xp6(1),c.Q6J("loading","reject"===t.loading)("state","declined"===(null==t.desk?null:t.desk.status)?"success":""))},directives:[P.m],pipes:[n.uU],styles:["[_nghost-%COMP%]{width:100%;display:flex;align-items:center;padding:0 .5rem;background-color:#f8f8f8;border-bottom:1px solid #ccc}[_nghost-%COMP%]:hover{background-color:#f0f0f0}.tentative[_ngcontent-%COMP%]{color:#ffa000!important}.approved[_ngcontent-%COMP%]{color:#388e3c!important}"]}),e})();var C=s(6393),L=s(4090),D=s(2571),j=s(3881);let z=(()=>{class e extends g.KG{constructor(e,t,s){super(),this._state=e,this._desk=t,this._desks_state=s,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.actions=this._state.map_actions,this.features=this._state.map_features,this.setHost=e=>this._desks_state.setOptions({host:e})}ngOnInit(){this.subscription("date",this._desk.filters.subscribe(e=>{this._desks_state.setOptions({date:e.date?new Date(e.date):new Date,zones:e.zones})}))}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(C.ck),c.Y36(r.H),c.Y36(C.Xp))},e.\u0275cmp=c.Xpm({type:e,selectors:[["desk-map-view"]],features:[c._Bn([C.Xp]),c.qOj],decls:13,vars:19,consts:[["map","",1,"h-full","w-full","relative"],[3,"src","zoom","center","styles","features","actions"],[1,"absolute","bottom-0","right-0"],[1,"absolute","top-0","left-0","p-2","text-black"],["placeholder","User for bookings...",3,"ngModel","ngModelChange"],["info","",1,"absolute","bottom-0","rounded","p-2","m-2","bg-white","shadow","text-center"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c._UZ(1,"i-map",1),c.ALo(2,"async"),c.ALo(3,"async"),c.ALo(4,"async"),c.ALo(5,"async"),c.ALo(6,"async"),c.ALo(7,"async"),c._UZ(8,"explore-zoom-controls",2),c.TgZ(9,"div",3),c.TgZ(10,"a-user-search-field",4),c.NdJ("ngModelChange",function(e){return t.setHost(e)}),c.qZA(),c.qZA(),c.TgZ(11,"div",5),c._uU(12," Click/Tap an available desk to book it. "),c.qZA(),c.qZA()),2&e&&(c.xp6(1),c.Q6J("src",c.lcZ(2,7,t.url))("zoom",c.lcZ(3,9,t.positions).zoom)("center",c.lcZ(4,11,t.positions).center)("styles",c.lcZ(5,13,t.styles))("features",c.lcZ(6,15,t.features))("actions",c.lcZ(7,17,t.actions)),c.xp6(9),c.Q6J("ngModel",null))},directives:[L.p,D.s,j.d,i.JJ,i.On],pipes:[n.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;position:relative;height:100%;width:100%}[info][_ngcontent-%COMP%]{left:50%;transform:translateX(-50%)}"]}),e})();function Y(e,t){if(1&e&&(c.TgZ(0,"button",18),c.TgZ(1,"app-icon"),c._uU(2,"more_vert"),c.qZA(),c.qZA()),2&e){c.oxw(2);const e=c.MAs(5);c.Q6J("matMenuTriggerFor",e)}}function N(e,t){1&e&&c._UZ(0,"desk-details",20),2&e&&c.Q6J("desk",t.$implicit)}function F(e,t){if(1&e&&(c.ynx(0),c.YNc(1,N,1,1,"desk-details",19),c.ALo(2,"async"),c.BQk()),2&e){const e=c.oxw(2);c.xp6(1),c.Q6J("ngForOf",c.lcZ(2,1,e.bookings))}}function Q(e,t){if(1&e&&(c.ynx(0),c.TgZ(1,"div",7),c._UZ(2,"div",8),c.TgZ(3,"div",9),c._uU(4),c.ALo(5,"async"),c.qZA(),c.TgZ(6,"div",10),c._uU(7),c.ALo(8,"async"),c.ALo(9,"async"),c.qZA(),c.YNc(10,Y,3,1,"button",11),c.ALo(11,"async"),c.qZA(),c.TgZ(12,"div",12),c.TgZ(13,"div",13),c.TgZ(14,"div",14),c._uU(15,"Person"),c.qZA(),c.TgZ(16,"div",14),c._uU(17,"Group"),c.qZA(),c.TgZ(18,"div",15),c._uU(19,"Date"),c.qZA(),c.TgZ(20,"div",16),c._uU(21,"Desk"),c.qZA(),c.TgZ(22,"div",15),c._uU(23,"Status"),c.qZA(),c.TgZ(24,"div",14),c._uU(25,"Approver"),c.qZA(),c.TgZ(26,"div",14),c._uU(27,"Checked In"),c.qZA(),c.TgZ(28,"div",15),c._uU(29,"Access"),c.qZA(),c._UZ(30,"div",14),c.qZA(),c.TgZ(31,"div",17),c.YNc(32,F,3,3,"ng-container",0),c.ALo(33,"async"),c.qZA(),c.qZA(),c.BQk()),2&e){const e=c.oxw(),t=c.MAs(3);let s,n,i;c.xp6(4),c.hij(" Requests: ",(null==(s=c.lcZ(5,5,e.bookings))?null:s.length)||"0"," "),c.xp6(3),c.hij(" Free Desks: ",((null==(n=c.lcZ(8,7,e.desks))?null:n.length)||0)-((null==(n=c.lcZ(9,9,e.bookings))?null:n.length)||0)," "),c.xp6(3),c.Q6J("ngIf",null==c.lcZ(11,11,e.filters).zones?null:c.lcZ(11,11,e.filters).zones.length),c.xp6(22),c.Q6J("ngIf",null==(i=c.lcZ(33,13,e.bookings))?null:i.length)("ngIfElse",t)}}function I(e,t){1&e&&(c.TgZ(0,"div",21),c.TgZ(1,"p",22),c._uU(2," There are no desks for the currently selected date. "),c.qZA(),c.qZA())}function G(e,t){1&e&&(c.TgZ(0,"div",23),c._UZ(1,"desk-map-view"),c.qZA())}let H=(()=>{class e{constructor(e){this._state=e,this.filters=this._state.filters,this.desks=this._state.desks.pipe((0,O.U)(e=>e.filter(e=>e.bookable))),this.bookings=this._state.bookings,this.rejectAll=()=>this._state.rejectAllDesks(),this.updateDesks=()=>this._state.updateDesks()}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(r.H))},e.\u0275cmp=c.Xpm({type:e,selectors:[["desk-listings"]],decls:20,vars:4,consts:[[4,"ngIf","ngIfElse"],["empty_state",""],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center"],[1,"pl-2"],["map_state",""],["details","",1,"w-full","bg-gray-900","text-white","flex","items-center","px-2"],[1,"flex-1","w-0"],[1,"p-2"],[1,"px-8"],["mat-icon-button","",3,"matMenuTriggerFor",4,"ngIf"],[1,"w-full","flex","flex-col","flex-1","text-sm","h-1/2"],[1,"w-full","flex","items-center","bg-white","border-b","border-gray-500","p-2","font-medium"],[1,"w-32","p-2"],[1,"w-24","p-2"],["flex","",1,"p-2","flex-1"],[1,"w-full","flex-1","overflow-auto","h-1/2"],["mat-icon-button","",3,"matMenuTriggerFor"],[3,"desk",4,"ngFor","ngForOf"],[3,"desk"],[1,"h-full","w-full","flex","items-center","justify-center"],[1,"p-8"],[1,"absolute","inset-0"]],template:function(e,t){if(1&e&&(c.YNc(0,Q,34,15,"ng-container",0),c.ALo(1,"async"),c.YNc(2,I,3,0,"ng-template",null,1,c.W1O),c.TgZ(4,"mat-menu",null,2),c.TgZ(6,"button",3),c.NdJ("click",function(){return t.updateDesks()}),c.TgZ(7,"div",4),c.TgZ(8,"app-icon"),c._uU(9,"edit"),c.qZA(),c.TgZ(10,"span",5),c._uU(11,"Edit Desks"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(12,"button",3),c.NdJ("click",function(){return t.rejectAll()}),c.TgZ(13,"div",4),c.TgZ(14,"app-icon"),c._uU(15,"event_busy"),c.qZA(),c.TgZ(16,"span",5),c._uU(17,"Reject All"),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.YNc(18,G,2,0,"ng-template",null,6,c.W1O)),2&e){const e=c.MAs(19);let s;c.Q6J("ngIf",!(null!=(s=c.lcZ(1,2,t.filters))&&s.show_map))("ngIfElse",e)}},directives:[n.O5,U.VK,U.OP,M.o,A.lW,U.p6,n.sg,J,z],pipes:[n.Ov],styles:["[_nghost-%COMP%]{position:relative;display:flex;flex-direction:column;height:100%;width:100%;overflow:hidden}[details][_ngcontent-%COMP%]{height:3.5rem}[flex][_ngcontent-%COMP%]{min-width:8rem}"]}),e})();var X=s(5994);const E=["app-desks",""];function S(e,t){1&e&&c._UZ(0,"mat-progress-bar",4)}const B=[{path:"",component:(()=>{class e{constructor(e){this._state=e,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(r.H))},e.\u0275cmp=c.Xpm({type:e,selectors:[["","app-desks",""]],attrs:E,decls:6,vars:3,consts:[[1,"relative","overflow-hidden","flex-1","flex","flex-col"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(e,t){1&e&&(c._UZ(0,"sidebar"),c.TgZ(1,"main",0),c._UZ(2,"desks-topbar",1),c._UZ(3,"desk-listings",2),c.YNc(4,S,1,0,"mat-progress-bar",3),c.ALo(5,"async"),c.qZA()),2&e&&(c.xp6(4),c.Q6J("ngIf",c.lcZ(5,1,t.loading)))},directives:[u.k,T,H,n.O5,X.pW],pipes:[n.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;background:var(--bg)}"]}),e})()}];let K=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[n.ez,i.u5,i.UX,a.v,C.P2,l.Fk,o.Bz.forChild(B)]]}),e})()}}]);