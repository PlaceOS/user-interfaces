{"version":3,"file":"apps_concierge_src_app_signage_signage_module_ts.js","mappings":"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","names":["i0","ctx_r0","resource","toString","SignageMediaPreviewModalComponent_main_6_img_2_Template","SignageMediaPreviewModalComponent_main_6_video_3_Template","type","_r2","save","emit","loading","SignageMediaPreviewModalComponent","constructor","_data","this","EventEmitter","url","name","file","can_save","static","__ngFactoryType__","MAT_DIALOG_DATA","core","VBU","selectors","outputs","decls","vars","consts","template","rf","ctx","SignageMediaPreviewModalComponent_main_6_Template","SignageMediaPreviewModalComponent_footer_7_Template","SignageMediaPreviewModalComponent_ng_template_8_Template","load_state_r3","form","value","default_duration","valid_from","savePlaylist","SignagePlaylistModalComponent","_state","_dialog","_dialog_ref","playlist","media","search","BehaviorSubject","FormGroup","id","FormControl","Validators","required","description","default_animation","MediaAnimation","Cut","orientation","enabled","random","Math","max","valid_until","_this","_asyncToGenerator","markAllAsTouched","updateValueAndValidity","invalid","form_value","getRawValue","result","getUnixTime","catch","_","notifyError","close","i1","i2","viewQuery","SignagePlaylistModalComponent_button_3_Template","SignagePlaylistModalComponent_main_4_Template","SignagePlaylistModalComponent_footer_5_Template","SignagePlaylistModalComponent_ng_template_6_Template","ctx_r1","start_time","item","video_length","play_time","_r1","preview","SignageMediaModalComponent_main_4_Conditional_12_Template","SignageMediaModalComponent_main_4_Conditional_17_Template","SignageMediaModalComponent_main_4_Conditional_18_Template","thumbnail","media_type","_r3","saveMedia","SignageMediaModalComponent","includes","media_url","_file_url","URL","createObjectURL","file_thumbnail","thumbnail_url","animation","Default","startOfDay","Date","now","valueOf","addYears","endOfDay","patchValue","file_metadata","floor","ngOnDestroy","revokeObjectURL","valid","disableClose","new_media","onError","e","updateSignageMedia","toPromise","onAdd","notifySuccess","SignageMediaModalComponent_button_3_Template","SignageMediaModalComponent_main_4_Template","SignageMediaModalComponent_footer_5_Template","SignageMediaModalComponent_ng_template_6_Template","load_state_r4","SignageDisplayModalComponent","_org","display","display_name","new_display","PlaceSystem","signage","zones","unique","organisation","region","building","filter","updateSystem","addSystem","SignageDisplayModalComponent_button_3_Template","SignageDisplayModalComponent_main_4_Template","SignageDisplayModalComponent_footer_5_Template","SignageDisplayModalComponent_ng_template_6_Template","SignageStateService","AsyncHandler","changed","_change","next","_settings","super","_loading","_active_upload","asObservable","has_changed","combineLatest","active_building","pipe","debounceTime","switchMap","bld","querySignageMedia","limit","map","data","sort","a","b","created_at","shareReplay","playlists","querySignagePlaylists","localeCompare","displays","active_region","querySystems","zone_id","get","queryZones","catchError","of","editPlaylist","SignagePlaylist","Promise","resolve","open","afterClosed","subscribe","timeout","editMedia","SignageMedia","playlist_id","_ref","_getMediaMetadata","_generateThumbnail","f","m","addMedia","previewMedia","_x","apply","arguments","editDisplay","_this2","console","log","removeDisplay","_this3","openConfirmModal","title","content","icon","reason","map_id","email","module_list","length","removeSystem","_this4","updateSignagePlaylist","addSignagePlaylist","removePlaylist","_this5","removeSignagePlaylist","updatePlaylistMedia","list","updateSignagePlaylistMedia","getPlaylistMedia","listSignagePlaylistMedia","then","items","previewFileFromInput","event","element","target","files","undefined","previewFileMedia","_this6","ref","componentInstance","new_media_list","media_item","_this7","upload","reject","state","resolved","uploadFile","s","link","is_landscape","thumbnail_image","dataURLtoFile","dataURL","filename","prefix","split","mimeType","byteString","atob","arrayBuffer","ArrayBuffer","uint8Array","Uint8Array","i","charCodeAt","File","media_id","media_uri","thumbnail_id","key","addSignageMedia","updateMedia","removeMedia","_this8","removeSignageMedia","video","document","createElement","src","addEventListener","videoWidth","videoHeight","duration","load","img","Image","onload","width","height","max_width","max_height","_this9","_generateVideoThumbnail","_generateImageThumbnail","image","_generateThumbnailFromResource","onerror","autoplay","muted","onloadeddata","source_width","source_height","canvas","getContext","thumbnailWidth","thumbnailHeight","aspectRatio","drawImage","toDataURL","i3","jDH","factory","fac","providedIn","newItem","active_link","singular","link_r4","$implicit","SignageComponent","_router","navigate","queryParams","links","previewFile","ngOnInit","subscription","events","NavigationEnd","find","toLowerCase","features","attrs","_c0","SignageComponent_button_7_Template","SignageComponent_For_11_Template","tabPanel_r5","SignageTopbarComponent","_route","levels","active_levels","initialised","first","queryParamMap","params","has","level","levelWithID","buildings","parent_id","zone","lvl","push","media_r4","SignageMediaListComponent_Conditional_5_For_3_Conditional_1_Template","SignageMediaListComponent_Conditional_5_For_3_Conditional_2_Template","SignageMediaListComponent_Conditional_5_For_3_div_3_Template","SignageMediaListComponent_Conditional_5_For_3_img_5_Template","SignageMediaListComponent_Conditional_5_For_3_div_8_Template","editItem","previewItem","removeItem","menu_r5","$event","drop","SignageMediaListComponent_Conditional_5_For_3_Template","_forTrack0","playlist_ids","SignageMediaListComponent","startOfMinute","playlist_count","ngOnChanges","changes","Array","fill","idx","inputs","SignageMediaListComponent_Conditional_5_Template","SignageMediaListComponent_Conditional_7_Template","getValue","tmp_1_0","SignagePlaylistMediaListComponent_Conditional_47_ng_container_2_Conditional_2_Template","SignagePlaylistMediaListComponent_Conditional_47_ng_container_2_Conditional_3_Template","SignagePlaylistMediaListComponent_Conditional_47_ng_container_2_div_4_Template","item_r5","_r4","ctx_r2","menu_r6","SignagePlaylistMediaListComponent_Conditional_47_ng_container_2_Template","SignagePlaylistMediaListComponent","_playlist","selected_playlist","take","_ref2","_playlist_media","startWith","animation_name","CrossFade","SlideBottom","SlideLeft","SlideRight","SlideTop","previousIndex","currentIndex","moveItemInArray","SignagePlaylistMediaListComponent_div_29_Template","SignagePlaylistMediaListComponent_Conditional_47_Template","SignagePlaylistMediaListComponent_Conditional_49_Template","menu_r7","tmp_3_0","tmp_4_0","tmp_5_0","tmp_6_0","tmp_7_0","tmp_8_0","tmp_9_0","tmp_10_0","tmp_11_0","playlist_r2","_c2","$index_r4","_c3","SignageMediaComponent_Conditional_9_For_1_Template","_r5","addPlaylist","SignageMediaComponent_Conditional_11_button_5_Template","tmp_2_0","_r6","hideOverlay","SignageMediaComponent","onEnter","clearTimeout","show_dropzone","dataTransfer","types","HTMLInputElement","preventDefault","query","previousContainer","SignageMediaComponent_Conditional_9_Template","SignageMediaComponent_Conditional_11_Template","SignageMediaComponent_signage_media_list_14_Template","SignageMediaComponent_signage_playlist_media_list_15_Template","SignageMediaComponent_div_16_Template","_c1","SearchOverlayComponent_For_8_Conditional_1_ng_container_0_Template","result_template","item_r2","selected","SearchOverlayComponent_For_8_Conditional_1_Template","SearchOverlayComponent_For_8_Conditional_2_Template","SearchOverlayComponent","item_list","_items","stopPropagation","SearchOverlayComponent_For_8_Template","SearchOverlayComponent_Conditional_9_Template","extra","SignageItemPlaylistsComponent_Conditional_5_For_2_div_1_Template","item_r4","remove","playlistCount","ondrop","SignageItemPlaylistsComponent_Conditional_5_For_2_Template","add","active_playlists","PLAYLIST_ITEM_COUNTS","SignageItemPlaylistsComponent","count","_playlist_ids","ids","tap","old_counts","last_updated","updated_at","ngContentSelectors","SignageItemPlaylistsComponent_div_3_Template","SignageItemPlaylistsComponent_Conditional_5_Template","SignageItemPlaylistsComponent_Conditional_7_Template","selected_trigger","trigger_r1","display_r2","SignageDisplaysComponent_Conditional_6_For_2_Conditional_2_For_1_Template","triggers","SignageDisplaysComponent_Conditional_6_For_2_Conditional_2_Template","tmp_16_0","active_display","switching","SignageDisplaysComponent_Conditional_6_For_2_Template","_c4","zone_r5","tmp_15_0","SignageDisplaysComponent_Conditional_10_div_6_For_2_Template","adding","SignageDisplaysComponent_Conditional_10_div_6_Template","active_trigger","signage_path","_r7","SignageDisplaysComponent","listSystemTriggers","setTimeout","sys_id","control_system_id","trigger","updateTrigger","version","old_playlist","SignageDisplaysComponent_Conditional_6_Template","SignageDisplaysComponent_Conditional_8_Template","SignageDisplaysComponent_Conditional_10_Template","SignageDisplaysComponent_Conditional_12_Template","SignageDisplaysComponent_search_overlay_13_Template","zone_r2","SignageZonesComponent_Conditional_6_For_2_Conditional_2_For_1_Template","SignageZonesComponent_Conditional_6_For_2_Conditional_2_Template","active_zone","SignageZonesComponent_Conditional_6_For_2_Template","SignageZonesComponent","listZoneTriggers","updateZone","SignageZonesComponent_Conditional_6_Template","SignageZonesComponent_Conditional_8_Template","SignageZonesComponent_Conditional_10_Template","SignageZonesComponent_Conditional_12_Template","SignageZonesComponent_search_overlay_13_Template","ROUTES","path","component","children","redirectTo","pathMatch","COMPONENTS","SignageModule","$C","G2t","CommonModule","FormsModule","UIModule","ComponentsModule","RouterModule","forChild","MatTabsModule","DragDropModule"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./apps/concierge/src/app/signage/signage-media-preview-modal.component.ts","./apps/concierge/src/app/signage/signage-playlist-modal.component.ts","./apps/concierge/src/app/signage/signage-media-modal.component.ts","./apps/concierge/src/app/signage/signage-display-modal.component.ts","./apps/concierge/src/app/signage/signage-state.service.ts","./apps/concierge/src/app/signage/signage.component.ts","./apps/concierge/src/app/signage/signage-topbar.component.ts","./apps/concierge/src/app/signage/signage-media-list.component.ts","./apps/concierge/src/app/signage/signage-playlist-media-list.component.ts","./apps/concierge/src/app/signage/signage-media.component.ts","./apps/concierge/src/app/signage/search-overlay.component.ts","./apps/concierge/src/app/signage/signage-item-playlists.component.ts","./apps/concierge/src/app/signage/signage-displays.component.ts","./apps/concierge/src/app/signage/signage-zones.component.ts","./apps/concierge/src/app/signage/signage.module.ts"],"sourcesContent":["import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\n@Component({\n    selector: 'signage-media-preview-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between p-2 border-b border-base-300\"\n        >\n            <h1 class=\"px-2\">Preview - {{ name }}</h1>\n            <button icon matRipple mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main class=\"bg-base-200\" *ngIf=\"!loading; else load_state\">\n            <div\n                class=\"max-w-[80vw] max-h-[65vh] w-[80vw] h-[65vh] flex items-center justify-center\"\n            >\n                <img\n                    *ngIf=\"type === 'image'\"\n                    class=\"w-full h-full object-contain object-center\"\n                    auth\n                    [source]=\"resource.toString()\"\n                />\n                <video\n                    *ngIf=\"type === 'video'\"\n                    class=\"w-full h-full object-contain object-center\"\n                    auth\n                    [source]=\"resource.toString()\"\n                    autoplay\n                    controls\n                ></video>\n            </div>\n        </main>\n        <footer\n            *ngIf=\"can_save && !loading\"\n            class=\"p-2 flex items-center justify-end space-x-2 border-t border-base-300\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"save.emit()\">\n                Save Media\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main\n                class=\"flex flex-col items-center justify-center p-8 w-[28rem] h-[20rem] max-w-[80vw] max-h-[65vh]\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignageMediaPreviewModalComponent {\n    @Output() public readonly save = new EventEmitter<any>();\n    public loading = '';\n    public readonly resource = this._data.url;\n    public readonly type = this._data.type;\n    public readonly name = this._data.name;\n    public readonly file = this._data.file;\n    public readonly can_save = this._data.save !== false;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: {\n            url: URL;\n            type: 'image' | 'video';\n            save: boolean;\n            name: string;\n            file?: File;\n        },\n    ) {}\n}\n","import {\n    MAT_DIALOG_DATA,\n    MatDialog,\n    MatDialogRef,\n} from '@angular/material/dialog';\nimport { SignageStateService } from './signage-state.service';\nimport { Component, ElementRef, Inject, ViewChild } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\nimport { notifyError } from '@placeos/common';\nimport { MediaAnimation } from '@placeos/ts-client/dist/esm/signage/media.class';\nimport { SignagePlaylist } from '@placeos/ts-client';\nimport { addYears, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\n@Component({\n    selector: 'signage-playlist-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between border-b border-base-300\"\n        >\n            <h1 class=\"p-2 font-medium text-xl\">\n                {{ playlist.id ? 'Edit' : 'New' }} Playlist\n            </h1>\n            <button icon matRipple mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            [formGroup]=\"form\"\n            class=\"p-4 flex flex-col w-[32rem] max-w-[calc(100vw-2rem)]\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <label for=\"name\">Name<span required>*</span></label>\n            <mat-form-field appearance=\"outline\" class=\"w-full\">\n                <input\n                    matInput\n                    name=\"name\"\n                    placeholder=\"Name\"\n                    formControlName=\"name\"\n                />\n                <mat-error>Name is required</mat-error>\n            </mat-form-field>\n            <div class=\"flex items-center space-x-8 mb-4\">\n                <mat-checkbox formControlName=\"enabled\">Enabled</mat-checkbox>\n                <mat-checkbox formControlName=\"random\">\n                    Shuffle Playback\n                </mat-checkbox>\n            </div>\n            <div class=\"flex items-center space-x-4\">\n                <label\n                    for=\"default-duration\"\n                    class=\"w-auto min-w-0 m-0 space-x-2 flex items-center\"\n                >\n                    <div>Default Play Time</div>\n                    <app-icon\n                        class=\"text-xl\"\n                        matTooltip=\"Default length of time to hold images on screen\"\n                    >\n                        info\n                    </app-icon>\n                </label>\n                <div class=\"text-xs font-mono\">\n                    {{ form.value.default_duration / 1000 | mediaDuration }}\n                </div>\n            </div>\n            <mat-slider min=\"5000\" max=\"300000\" step=\"1000\">\n                <input\n                    name=\"default-duration\"\n                    matSliderThumb\n                    formControlName=\"default_duration\"\n                />\n            </mat-slider>\n            <div class=\"flex space-x-2\">\n                <div class=\"flex-1\">\n                    <label for=\"orientation\">Orientation</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"orientation\"\n                            formControlName=\"orientation\"\n                            placeholder=\"Unspecified\"\n                        >\n                            <mat-option value=\"unspecified\">\n                                Unspecified\n                            </mat-option>\n                            <mat-option value=\"landscape\">Landscape</mat-option>\n                            <mat-option value=\"portrait\">Portrait</mat-option>\n                            <mat-option value=\"square\">Square</mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex-1\">\n                    <label for=\"animation\">Animation</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"animation\"\n                            formControlName=\"default_animation\"\n                            placeholder=\"Playlist Default\"\n                        >\n                            <mat-option [value]=\"1\">Cut</mat-option>\n                            <mat-option [value]=\"2\">Cross Fade</mat-option>\n                            <mat-option [value]=\"3\">Slide Top</mat-option>\n                            <mat-option [value]=\"4\">Slide Left</mat-option>\n                            <mat-option [value]=\"5\">Slide Right</mat-option>\n                            <mat-option [value]=\"6\">Slide Bottom</mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n            </div>\n            <label for=\"description\">Description</label>\n            <mat-form-field appearance=\"outline\" class=\"w-full\">\n                <textarea\n                    matInput\n                    name=\"description\"\n                    placeholder=\"Description\"\n                    formControlName=\"description\"\n                    class=\"min-h-32\"\n                ></textarea>\n            </mat-form-field>\n            <div class=\"flex space-x-4\">\n                <div class=\"flex-1\">\n                    <label for=\"valid-from\">Valid From</label>\n                    <a-date-field\n                        name=\"valid-from\"\n                        formControlName=\"valid_from\"\n                    ></a-date-field>\n                </div>\n                <div class=\"flex-1\">\n                    <label for=\"valid-until\">Valid Until</label>\n                    <a-date-field\n                        name=\"valid-until\"\n                        [from]=\"form.value.valid_from\"\n                        formControlName=\"valid_until\"\n                        [disabled]=\"!form.value.valid_from\"\n                    ></a-date-field>\n                </div>\n            </div>\n        </main>\n        <footer\n            class=\"p-4 flex items-center justify-end space-x-2 border-t border-base-300\"\n            *ngIf=\"!loading\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"savePlaylist()\">\n                Save Playlist\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main class=\"flex flex-col items-center justify-center p-8\">\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"mt-4\">Saving Playlist...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignagePlaylistModalComponent {\n    public loading = false;\n    public readonly playlist = this._data;\n    public readonly media = this._state.media;\n\n    public readonly search = new BehaviorSubject('');\n\n    public readonly form = new FormGroup({\n        id: new FormControl(this.playlist.id || ''),\n        name: new FormControl(this.playlist.name || '', [Validators.required]),\n        description: new FormControl(this.playlist.description || ''),\n        default_animation: new FormControl<MediaAnimation>(\n            this.playlist.default_animation || MediaAnimation.Cut,\n        ),\n        orientation: new FormControl(\n            this.playlist.orientation || 'unspecified',\n        ),\n        enabled: new FormControl(this.playlist.enabled),\n        random: new FormControl(this.playlist.random),\n        default_duration: new FormControl(\n            Math.max(this.playlist.default_duration || 15 * 1000, 5000),\n        ),\n        valid_from: new FormControl(this.playlist.valid_from * 1000),\n        valid_until: new FormControl(this.playlist.valid_until * 1000),\n    });\n\n    @ViewChild('search_input')\n    public search_input: ElementRef<HTMLInputElement>;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: SignagePlaylist = {} as any,\n        private _state: SignageStateService,\n        private _dialog: MatDialog,\n        private _dialog_ref: MatDialogRef<SignagePlaylistModalComponent>,\n    ) {}\n\n    public async savePlaylist() {\n        this.form.markAllAsTouched();\n        this.form.updateValueAndValidity();\n        if (this.form.invalid) return;\n        this.loading = true;\n        const form_value = this.form.getRawValue();\n        const result = await this._state\n            .savePlaylist({\n                ...form_value,\n                valid_from: getUnixTime(form_value.valid_from),\n                valid_until: getUnixTime(form_value.valid_until),\n            })\n            .catch((_) => {\n                notifyError('Error saving playlist');\n                this.loading = false;\n                throw _;\n            });\n        this._dialog_ref.close(result);\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { notifySuccess } from '@placeos/common';\nimport { SignageMedia, updateSignageMedia } from '@placeos/ts-client';\nimport { MediaAnimation } from '@placeos/ts-client/dist/esm/signage/media.class';\nimport { addYears, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\n@Component({\n    selector: 'signage-media-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between border-b border-base-300\"\n        >\n            <h2 class=\"p-2 text-xl font-medium\">\n                {{ item.id ? 'Edit' : 'New' }} Media Item\n            </h2>\n            <button icon matRipple mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"p-4 max-w-[calc(100vw-2rem)] w-[32rem] max-h-[65vh] overflow-auto\"\n            [formGroup]=\"form\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <div class=\"flex flex-col\">\n                <button\n                    matRipple\n                    class=\"relative w-full h-48 mx-auto bg-base-300 rounded-xl overflow-hidden mb-4\"\n                    (click)=\"preview()\"\n                >\n                    <img\n                        class=\"h-full w-full object-contain object-center\"\n                        auth\n                        [source]=\"thumbnail || url\"\n                    />\n                    <div\n                        class=\"absolute top-2 left-2 px-2 py-1 rounded text-xs bg-base-400 capitalize\"\n                    >\n                        {{ media_type }}\n                    </div>\n                </button>\n                <label for=\"name\">Name</label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        formControlName=\"name\"\n                        placeholder=\"Media Name\"\n                    />\n                    <mat-error>A name is required</mat-error>\n                </mat-form-field>\n                @if (media_type === 'video') {\n                    <div class=\"flex items-center space-x-4\">\n                        <label for=\"start-time\" class=\"w-auto min-w-0 m-0\"\n                            >Start Time</label\n                        >\n                        <div class=\"text-xs font-mono\">\n                            {{\n                                form.value.start_time / 1000\n                                    | mediaDuration: true\n                            }}\n                        </div>\n                    </div>\n                    <mat-slider\n                        min=\"0\"\n                        [max]=\"(item.video_length || 300000) - 1000\"\n                        step=\"100\"\n                    >\n                        <input\n                            name=\"start-time\"\n                            matSliderThumb\n                            formControlName=\"start_time\"\n                        />\n                    </mat-slider>\n                }\n                <div class=\"flex items-center space-x-4\">\n                    <label for=\"play-time\" class=\"w-auto min-w-0 m-0\">\n                        Play Time</label\n                    >\n                    <div class=\"text-xs font-mono\">\n                        @if (form.value.play_time) {\n                            {{\n                                form.value.play_time / 1000\n                                    | mediaDuration: true\n                            }}\n                        } @else {\n                            <span class=\"opacity-30\">\n                                Default ({{\n                                    item.video_length\n                                        ? (item.video_length / 1000\n                                          | mediaDuration)\n                                        : ''\n                                }})\n                            </span>\n                        }\n                    </div>\n                </div>\n                <mat-slider\n                    [min]=\"form.value.start_time\"\n                    [max]=\"item.video_length || 300000\"\n                    step=\"100\"\n                >\n                    <input\n                        name=\"play-time\"\n                        matSliderThumb\n                        formControlName=\"play_time\"\n                    />\n                </mat-slider>\n                <label for=\"animation\">Animation</label>\n                <mat-form-field appearance=\"outline\">\n                    <mat-select\n                        name=\"animation\"\n                        formControlName=\"animation\"\n                        placeholder=\"Playlist Default\"\n                    >\n                        <mat-option [value]=\"0\">Playlist Default</mat-option>\n                        <mat-option [value]=\"1\">Cut</mat-option>\n                        <mat-option [value]=\"2\">Cross Fade</mat-option>\n                        <mat-option [value]=\"3\">Slide Top</mat-option>\n                        <mat-option [value]=\"4\">Slide Left</mat-option>\n                        <mat-option [value]=\"5\">Slide Right</mat-option>\n                        <mat-option [value]=\"6\">Slide Bottom</mat-option>\n                    </mat-select>\n                </mat-form-field>\n                <label for=\"description\">Description</label>\n                <mat-form-field appearance=\"outline\" class=\"w-full\">\n                    <textarea\n                        matInput\n                        name=\"description\"\n                        placeholder=\"Description\"\n                        formControlName=\"description\"\n                        class=\"min-h-32\"\n                    ></textarea>\n                </mat-form-field>\n                <div class=\"flex space-x-4\">\n                    <div class=\"flex-1\">\n                        <label for=\"valid-from\">Valid From</label>\n                        <a-date-field\n                            name=\"valid-from\"\n                            formControlName=\"valid_from\"\n                        ></a-date-field>\n                    </div>\n                    <div class=\"flex-1\">\n                        <label for=\"valid-until\">Valid Until</label>\n                        <a-date-field\n                            name=\"valid-until\"\n                            [from]=\"form.value.valid_from\"\n                            formControlName=\"valid_until\"\n                        ></a-date-field>\n                    </div>\n                </div>\n            </div>\n        </main>\n        <footer\n            *ngIf=\"!loading\"\n            class=\"flex justify-end p-4 border-t border-base-300\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"saveMedia()\">\n                Save\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main\n                class=\"flex flex-col items-center justify-center p-8 max-w-[calc(100vw-2rem)] min-h-64 w-[32rem] space-y-4\"\n            >\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving media item...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignageMediaModalComponent {\n    public loading = false;\n    public readonly item = this._data.media;\n    public readonly file = this._data.file;\n    public readonly thumbnail =\n        this._data.file_thumbnail || this._data.media.thumbnail_url;\n\n    public readonly form = new FormGroup({\n        name: new FormControl('', [Validators.required]),\n        description: new FormControl(''),\n        animation: new FormControl<MediaAnimation>(MediaAnimation.Default),\n        start_time: new FormControl(0),\n        play_time: new FormControl<number | null>(null),\n        valid_from: new FormControl(startOfDay(Date.now()).valueOf()),\n        valid_until: new FormControl(\n            addYears(endOfDay(Date.now()), 10).valueOf(),\n        ),\n    });\n\n    private _file_url: string;\n\n    public readonly preview = () =>\n        this._data.preview({\n            media_url: this.url,\n            media_type: this.media_type,\n            name: this.form.value.name,\n        });\n\n    public get media_type() {\n        if (!this.file) return this.item.media_type;\n        return (\n            (this.file.type.includes('video')\n                ? 'video'\n                : this.file.type.includes('image')\n                  ? 'image'\n                  : '') || this.item.media_type\n        );\n    }\n\n    public get url() {\n        if (this.item.id) return this.item.media_url;\n        if (this._file_url) return this._file_url;\n        this._file_url = URL.createObjectURL(this.file);\n        return this._file_url;\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: {\n            media: SignageMedia;\n            file?: File;\n            file_metadata?: [boolean, number];\n            file_thumbnail?: string;\n            onAdd: (f, m) => Promise<SignageMedia>;\n            preview: (url) => void;\n        },\n        private _dialog_ref: MatDialogRef<SignageMediaModalComponent>,\n    ) {\n        this.form.patchValue({\n            ...this._data.media,\n            valid_from: this._data.media.valid_from * 1000,\n            valid_until: this._data.media.valid_until * 1000,\n        });\n        if (this._data.file) {\n            this.form.patchValue({\n                name: this._data.file.name,\n            });\n        }\n        if (this._data.file_metadata) {\n            (this.item as any).video_length = Math.floor(\n                this._data.file_metadata[1] * 1000,\n            );\n        }\n    }\n\n    public ngOnDestroy() {\n        if (this._file_url) URL.revokeObjectURL(this._file_url);\n    }\n\n    public async saveMedia() {\n        this.form.markAllAsTouched();\n        this.form.updateValueAndValidity();\n        if (!this.form.valid) return;\n        this.loading = true;\n        this._dialog_ref.disableClose = true;\n        const form_value = this.form.getRawValue();\n        const new_media = {\n            ...this.item,\n            ...form_value,\n            valid_from: getUnixTime(new Date(form_value.valid_from)),\n            valid_until: getUnixTime(form_value.valid_until),\n        };\n        const onError = (e) => {\n            this._dialog_ref.disableClose = false;\n            this.loading = false;\n            throw e;\n        };\n        if (this.item.id) {\n            await updateSignageMedia(this.item.id, new_media)\n                .toPromise()\n                .catch(onError);\n        } else {\n            await this._data.onAdd(this.file, new_media).catch(onError);\n        }\n        this._dialog_ref.disableClose = false;\n        this._dialog_ref.close();\n        notifySuccess('Successfully saved media item.');\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { unique } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { addSystem, PlaceSystem, updateSystem } from '@placeos/ts-client';\n\n@Component({\n    selector: 'signage-display-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between border-b border-base-300 p-2\"\n        >\n            <h1 class=\"p-2 font-medium text-xl\">\n                {{ display.id ? 'Edit' : 'New' }} Display\n            </h1>\n            <button icon matRipple mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            [formGroup]=\"form\"\n            class=\"p-4 flex flex-col w-[32rem] max-w-[calc(100vw-2rem)]\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <div class=\"flex flex-col\">\n                <label for=\"name\">Name<span required>*</span></label>\n                <mat-form-field appearance=\"outline\" class=\"w-full\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        placeholder=\"Name\"\n                        formControlName=\"name\"\n                        required\n                    />\n                    <mat-error>Name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"flex flex-col\">\n                <label for=\"description\">Description</label>\n                <mat-form-field appearance=\"outline\" class=\"w-full\">\n                    <textarea\n                        matInput\n                        name=\"description\"\n                        placeholder=\"Description\"\n                        formControlName=\"description\"\n                        class=\"min-h-32\"\n                    ></textarea>\n                </mat-form-field>\n            </div>\n            <div class=\"flex flex-col\">\n                <label for=\"orientation\">Orientation</label>\n                <mat-form-field appearance=\"outline\" class=\"w-full\">\n                    <mat-select\n                        name=\"orientation\"\n                        formControlName=\"orientation\"\n                        placeholder=\"Unspecified\"\n                    >\n                        <mat-option value=\"unspecified\">\n                            Unspecified\n                        </mat-option>\n                        <mat-option value=\"landscape\">Landscape</mat-option>\n                        <mat-option value=\"portrait\">Portrait</mat-option>\n                        <mat-option value=\"square\">Square</mat-option>\n                    </mat-select>\n                </mat-form-field>\n            </div>\n        </main>\n        <footer\n            *ngIf=\"!loading\"\n            class=\"flex justify-end p-4 border-t border-base-200\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"save()\">Save</button>\n        </footer>\n        <ng-template #load_state>\n            <main class=\"flex flex-col items-center justify-center p-8\">\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"mt-4\">Saving display...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignageDisplayModalComponent {\n    public loading = false;\n    public readonly display = this._data.display;\n\n    public readonly form = new FormGroup({\n        id: new FormControl(this._data.display?.id || ''),\n        name: new FormControl(this._data.display?.display_name || '', [\n            Validators.required,\n        ]),\n        description: new FormControl(this._data.display?.description || ''),\n        orientation: new FormControl(\n            this._data.display?.orientation || 'unspecified',\n        ),\n    });\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: { display?: PlaceSystem },\n        private _dialog_ref: MatDialogRef<SignageDisplayModalComponent>,\n        private _org: OrganisationService,\n    ) {}\n\n    public async save() {\n        this.form.markAllAsTouched();\n        this.form.updateValueAndValidity();\n        if (this.form.invalid) return;\n        this.loading = true;\n        const form_value = this.form.getRawValue();\n        const new_display = new PlaceSystem({\n            ...form_value,\n            name: `SIGNAGE ${form_value.name}`,\n            display_name: form_value.name,\n            signage: true,\n            zones: unique(\n                [\n                    this._org.organisation.id,\n                    this._org.region?.id,\n                    this._org.building?.id,\n                    ...this.display.zones,\n                ].filter((_) => !!_),\n            ),\n        });\n        const method = this.display.id\n            ? updateSystem(this.display.id, new_display)\n            : addSystem(new_display);\n        const result = await method.toPromise();\n        this._dialog_ref.close(result);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport {\n    AsyncHandler,\n    notifyError,\n    notifySuccess,\n    openConfirmModal,\n    SettingsService,\n    uploadFile,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport {\n    addSignageMedia,\n    addSignagePlaylist,\n    listSignagePlaylistMedia,\n    PlaceSystem,\n    querySignageMedia,\n    querySignagePlaylists,\n    querySystems,\n    queryZones,\n    removeSignageMedia,\n    removeSignagePlaylist,\n    removeSystem,\n    SignageMedia,\n    SignagePlaylist,\n    updateSignageMedia,\n    updateSignagePlaylist,\n    updateSignagePlaylistMedia,\n    updateSystem,\n} from '@placeos/ts-client';\nimport { Attachment } from '@placeos/users';\nimport { BehaviorSubject, Observable, combineLatest, of } from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    filter,\n    map,\n    shareReplay,\n    switchMap,\n} from 'rxjs/operators';\n\nimport { MatDialog } from '@angular/material/dialog';\nimport { SignageMediaPreviewModalComponent } from './signage-media-preview-modal.component';\nimport { SignagePlaylistModalComponent } from './signage-playlist-modal.component';\nimport { SignageMediaModalComponent } from './signage-media-modal.component';\nimport { SignageDisplayModalComponent } from './signage-display-modal.component';\n\nfunction dataURLtoBlob(dataURL) {\n    // Split the data URL to get the mime type and the data\n    const [prefix, data] = dataURL.split(',');\n    const mimeType = prefix.split(':')[1].split(';')[0];\n\n    // Convert base64 to raw binary data\n    const byteString = atob(data);\n\n    // Create an ArrayBuffer and fill it with the binary data\n    const arrayBuffer = new ArrayBuffer(byteString.length);\n    const uint8Array = new Uint8Array(arrayBuffer);\n    for (let i = 0; i < byteString.length; i++) {\n        uint8Array[i] = byteString.charCodeAt(i);\n    }\n\n    // Create and return the Blob\n    return new Blob([arrayBuffer], { type: mimeType });\n}\n\nfunction dataURLtoFile(dataURL, filename) {\n    // Split the data URL to get the mime type and the data\n    const [prefix, data] = dataURL.split(',');\n    const mimeType = prefix.split(':')[1].split(';')[0];\n\n    // Convert base64 to raw binary data\n    const byteString = atob(data);\n\n    // Create an ArrayBuffer and fill it with the binary data\n    const arrayBuffer = new ArrayBuffer(byteString.length);\n    const uint8Array = new Uint8Array(arrayBuffer);\n    for (let i = 0; i < byteString.length; i++) {\n        uint8Array[i] = byteString.charCodeAt(i);\n    }\n\n    // Create and return the File\n    return new File([uint8Array], filename, { type: mimeType });\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SignageStateService extends AsyncHandler {\n    private _loading = new BehaviorSubject(false);\n    private _change = new BehaviorSubject(0);\n    private _active_upload = new BehaviorSubject<Attachment>(null);\n\n    public readonly loading = this._loading.asObservable();\n    public readonly has_changed = this._change.asObservable();\n\n    public readonly media: Observable<SignageMedia[]> = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([_]) => !!_?.id),\n        debounceTime(300),\n        switchMap(([bld]) => querySignageMedia({ limit: 2500 } as any)),\n        map((_) => _.data.sort((a, b) => b.created_at - a.created_at)),\n        shareReplay(1),\n    );\n\n    public readonly playlists: Observable<SignagePlaylist[]> = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([_]) => !!_?.id),\n        debounceTime(300),\n        switchMap(() => querySignagePlaylists({ limit: 500 } as any)),\n        map((_) => (_.data || []).sort((a, b) => a.name.localeCompare(b.name))),\n        shareReplay(1),\n    );\n\n    public readonly displays: Observable<PlaceSystem[]> = combineLatest([\n        this._org.active_region,\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([region, bld]) => !!bld?.id),\n        switchMap(([region, bld]) =>\n            querySystems({\n                zone_id:\n                    (this._settings.get('app.use_region') ? region?.id : '') ||\n                    bld?.id,\n                limit: 500,\n                signage: true,\n            }).pipe(\n                map((_) =>\n                    (_.data || [])\n                        .sort((a, b) =>\n                            (a.display_name || a.name).localeCompare(\n                                b.display_name || b.name,\n                            ),\n                        )\n                        .filter((_) => _.signage),\n                ),\n            ),\n        ),\n        shareReplay(1),\n    );\n\n    public readonly zones = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        switchMap(([bld]) =>\n            queryZones({\n                limit: 250,\n            } as any).pipe(catchError(() => of({ data: [] }))),\n        ),\n        map((_) =>\n            (_.data || []).sort((a, b) =>\n                (a.display_name || a.name).localeCompare(\n                    b.display_name || b.name,\n                ),\n            ),\n        ),\n    );\n\n    public changed() {\n        this._change.next(Date.now());\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _dialog: MatDialog,\n        private _settings: SettingsService,\n    ) {\n        super();\n    }\n\n    public editPlaylist(playlist: SignagePlaylist = new SignagePlaylist({})) {\n        return new Promise<SignagePlaylist | null>((resolve) => {\n            const ref = this._dialog.open(SignagePlaylistModalComponent, {\n                data: playlist,\n            });\n            ref.afterClosed().subscribe((result) => {\n                this.timeout('changed', () => this._change.next(Date.now()));\n                resolve(result);\n            });\n        });\n    }\n\n    public editMedia(\n        media: SignageMedia = new SignageMedia({}),\n        file?: File,\n        playlist_id: string = '',\n    ) {\n        return new Promise<SignagePlaylist | null>(async (resolve) => {\n            const ref = this._dialog.open(SignageMediaModalComponent, {\n                data: {\n                    media,\n                    file,\n                    file_metadata: file\n                        ? await this._getMediaMetadata(file)\n                        : [media.orientation === 'landscape', 0],\n                    file_thumbnail: file\n                        ? await this._generateThumbnail(file, 1024, 720)\n                        : '',\n                    playlist_id,\n                    onAdd: (f, m) => this.addMedia(f, m),\n                    preview: (item) => this.previewMedia(item),\n                },\n            });\n            ref.afterClosed().subscribe((result) => {\n                this.timeout('changed', () => this._change.next(Date.now()));\n                resolve(result);\n            });\n        });\n    }\n\n    public async editDisplay(display: PlaceSystem = new PlaceSystem({})) {\n        console.log('Edit Display:', display);\n        const ref = this._dialog.open(SignageDisplayModalComponent, {\n            data: { display },\n        });\n        const result = await ref.afterClosed().toPromise();\n        this.timeout('changed', () => this._change.next(Date.now()));\n        return result;\n    }\n\n    public async removeDisplay(display: PlaceSystem) {\n        const result = await openConfirmModal(\n            {\n                title: `Remove Display`,\n                content: `\n                Are you sure you wish to remove the display \"<strong>${display.display_name}</strong>\"?\n                `,\n                icon: { content: 'delete' },\n            },\n            this._dialog,\n        );\n        if (result.reason !== 'done') return;\n        result.loading('Removing display...');\n        if (display.map_id || display.email || display.module_list.length > 0) {\n            await updateSystem(display.id, {\n                signage: false,\n            } as any).toPromise();\n        } else {\n            await removeSystem(display.id).toPromise();\n        }\n        this._change.next(Date.now());\n        result.close();\n    }\n\n    public async savePlaylist(playlist: Partial<SignagePlaylist>) {\n        const call = playlist.id\n            ? updateSignagePlaylist(playlist.id, playlist)\n            : addSignagePlaylist(playlist);\n        const new_playlist = await call.toPromise();\n        notifySuccess(`Successfully saved playlist.`);\n        this._change.next(Date.now());\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        if (!playlist?.id) return;\n        const result = await openConfirmModal(\n            {\n                title: `Remove Playlist`,\n                content: `\n            Are you sure you wish to remove the playlist \"<strong>${playlist.name}</strong>\"?<br/><br/>`,\n                icon: { content: 'delete' },\n            },\n            this._dialog,\n        );\n        if (result.reason !== 'done') return;\n        await removeSignagePlaylist(playlist.id).toPromise();\n        notifySuccess(`Successfully removed playlist.`);\n        this._change.next(Date.now());\n        result.close();\n    }\n\n    public async updatePlaylistMedia(playlist_id: string, list: string[]) {\n        await updateSignagePlaylistMedia(playlist_id, list).toPromise();\n        notifySuccess(`Successfully updated playlist media.`);\n    }\n\n    public getPlaylistMedia(playlist_id: string) {\n        return listSignagePlaylistMedia(playlist_id)\n            .toPromise()\n            .then((_) => _.items);\n    }\n\n    public previewMedia(item: SignageMedia) {\n        const ref = this._dialog.open(SignageMediaPreviewModalComponent, {\n            data: {\n                url: item.media_url,\n                type: item.media_type,\n                name: item.name,\n                save: false,\n            },\n        });\n    }\n\n    public previewFileFromInput(event, playlist_id: string = '') {\n        const element: HTMLInputElement = event.target as any;\n        /* istanbul ignore else */\n        if (!element?.files?.length) return;\n        const files: FileList = element.files;\n        const file = files[0];\n        if (\n            file &&\n            (file.type.includes('image') || file.type.includes('video'))\n        ) {\n            this.editMedia(undefined, file, playlist_id);\n        } else {\n            notifyError('Invalid file type.');\n        }\n    }\n\n    public previewFileMedia(media: File, playlist_id: string = '') {\n        const url = URL.createObjectURL(media);\n        const type = media.type.includes('image') ? 'image' : 'video';\n        const ref = this._dialog.open(SignageMediaPreviewModalComponent, {\n            data: { url, type, name: media.name, save: true, file: media },\n        });\n        ref.afterClosed().subscribe(() => URL.revokeObjectURL(url));\n        ref.componentInstance.save.subscribe(async () => {\n            ref.componentInstance.loading = 'Saving...';\n            const new_media = await this.addMedia(media).catch((e) => {\n                notifyError('Error saving media.');\n                ref.componentInstance.loading = '';\n                throw e;\n            });\n            if (playlist_id && new_media.id) {\n                const media_list =\n                    await listSignagePlaylistMedia(playlist_id).toPromise();\n                const new_media_list = [...media_list.items, new_media.id];\n                await updateSignagePlaylistMedia(\n                    playlist_id,\n                    new_media_list,\n                ).toPromise();\n            }\n            ref.close();\n        });\n    }\n\n    public async addMedia(\n        file: File,\n        media_item: SignageMedia = new SignageMedia({}),\n    ) {\n        const upload = (file) =>\n            new Promise<{ id: string; link: string }>((resolve, reject) => {\n                let state = null;\n                let resolved = false;\n                uploadFile(file).subscribe(\n                    (s) => {\n                        state = s;\n                        if (s.link) {\n                            resolved = true;\n                            resolve({ id: s.upload.id, link: s.link });\n                        }\n                    },\n                    reject,\n                    () => (!resolved ? resolve(state) : null),\n                );\n            });\n        const [is_landscape, _] = await this._getMediaMetadata(file);\n        const thumbnail_image = await this._generateThumbnail(\n            file,\n            1280,\n            720,\n        ).catch((_) => null);\n        const media = await upload(file);\n        let thumbnail = null;\n        if (thumbnail_image) {\n            thumbnail = await upload(\n                dataURLtoFile(thumbnail_image, `thumb+${file.name}`),\n            );\n        }\n        const data = {\n            ...new SignageMedia({\n                ...media_item,\n                name: media_item.name || file.name,\n                media_id: media.id,\n                media_uri: media.link,\n                media_type: file.type.includes('image') ? 'image' : 'video',\n                orientation: is_landscape ? 'landscape' : 'portrait',\n                thumbnail_id: thumbnail.id,\n            }),\n        };\n        for (const key in data) {\n            if (!data[key]) delete data[key];\n        }\n        const result = await addSignageMedia(data).toPromise();\n        this._active_upload.next(null);\n        this._change.next(Date.now());\n        return result;\n    }\n\n    public async updateMedia(item: SignageMedia) {\n        if (!item?.id) return;\n        await updateSignageMedia(item.id, item).toPromise();\n    }\n\n    public async removeMedia(item: SignageMedia) {\n        if (!item?.id) return;\n        const result = await openConfirmModal(\n            {\n                title: `Remove Media item`,\n                content: `\n                Are you sure you wish to remove the media item \"<strong>${item.name}</strong>\"?<br/><br/>\n                <i class=\"text-sm\">The item will be removed from all playlists and the files deleted from storage.</i>\n                `,\n                icon: { content: 'delete' },\n            },\n            this._dialog,\n        );\n        if (result.reason !== 'done') return;\n        result.loading('Removing media...');\n        await removeSignageMedia(item.id).toPromise();\n        this._change.next(Date.now());\n        result.close();\n    }\n\n    private _getMediaMetadata(file: File) {\n        return new Promise<[boolean, number]>((resolve) => {\n            const url = URL.createObjectURL(file);\n            // file is loaded\n            if (file.type.includes('video')) {\n                let video = document.createElement('video');\n                video.src = url.toString();\n                video.addEventListener('loadedmetadata', () => {\n                    const { videoWidth, videoHeight } = video;\n                    resolve([videoWidth > videoHeight, video.duration]);\n                });\n                video.load();\n            } else {\n                let img = new Image();\n                img.onload = () => resolve([img.width > img.height, 0]);\n                img.src = url.toString(); // is the data URL because called with readAsDataURL\n            }\n        });\n    }\n\n    private async _generateThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        console.log('File:', file, max_width, max_height);\n        if (file.type.includes('video')) {\n            return this._generateVideoThumbnail(file, max_width, max_height);\n        } else {\n            return this._generateImageThumbnail(file, max_width, max_height);\n        }\n    }\n\n    private _generateImageThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        return new Promise<string>((resolve, reject) => {\n            const img = new Image();\n            img.src = URL.createObjectURL(file);\n            console.log('Image:', img.src);\n\n            img.onload = () => {\n                const image = this._generateThumbnailFromResource(\n                    img,\n                    img.width,\n                    img.height,\n                    max_width,\n                    max_height,\n                );\n                URL.revokeObjectURL(img.src);\n                resolve(image);\n            };\n\n            img.onerror = reject;\n        });\n    }\n\n    private _generateVideoThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        return new Promise<string>((resolve, reject) => {\n            // Create video element\n            const video = document.createElement('video');\n            video.autoplay = true;\n            video.muted = true;\n            video.src = URL.createObjectURL(file);\n\n            video.onloadeddata = () => {\n                const image = this._generateThumbnailFromResource(\n                    video,\n                    video.videoWidth,\n                    video.videoHeight,\n                    max_width,\n                    max_height,\n                );\n\n                // Clean up\n                URL.revokeObjectURL(video.src);\n                resolve(image);\n            };\n\n            video.onerror = reject;\n        });\n    }\n\n    private _generateThumbnailFromResource(\n        data,\n        source_width,\n        source_height,\n        max_width: number,\n        max_height: number,\n    ) {\n        // Create canvas element\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n\n        // Calculate thumbnail dimensions\n        let thumbnailWidth = source_width;\n        let thumbnailHeight = source_height;\n        const aspectRatio = thumbnailWidth / thumbnailHeight;\n\n        if (thumbnailWidth > max_width) {\n            thumbnailWidth = max_height;\n            thumbnailHeight = thumbnailWidth / aspectRatio;\n        }\n\n        if (thumbnailHeight > max_height) {\n            thumbnailHeight = max_width;\n            thumbnailWidth = thumbnailHeight * aspectRatio;\n        }\n\n        canvas.width = thumbnailWidth;\n        canvas.height = thumbnailHeight;\n\n        // Draw video frame on canvas\n        ctx.drawImage(data, 0, 0, thumbnailWidth, thumbnailHeight);\n\n        // Convert canvas to data URL\n        const dataURL = canvas.toDataURL('image/jpeg');\n\n        return dataURL;\n    }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport { SignageStateService } from './signage-state.service';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { AsyncHandler } from '@placeos/common';\n\n@Component({\n    selector: '[app-new-staff]',\n    template: `\n        <app-topbar></app-topbar>\n        <div class=\"flex flex-1 h-px\">\n            <app-sidebar></app-sidebar>\n            <main class=\"flex flex-col flex-1 w-1/2 h-full\">\n                <div class=\"p-8 h-28 flex items-center justify-between\">\n                    <h2 class=\"text-2xl font-medium\">\n                        Digital Signage Management\n                    </h2>\n                    <button\n                        btn\n                        matRipple\n                        class=\"w-40\"\n                        *ngIf=\"\n                            active_link === 'Media' ||\n                            active_link === 'Displays'\n                        \"\n                        (click)=\"newItem(active_link)\"\n                    >\n                        Add {{ singular(active_link) }}\n                    </button>\n                </div>\n                <div class=\"px-8\">\n                    <nav mat-tab-nav-bar [tabPanel]=\"tabPanel\">\n                        @for (link of links; track link) {\n                            <a\n                                mat-tab-link\n                                [routerLink]=\"'/signage/' + (link | lowercase)\"\n                                (click)=\"active_link = link\"\n                                [active]=\"active_link == link\"\n                            >\n                                {{ link }}\n                            </a>\n                        }\n                    </nav>\n                </div>\n                <mat-tab-nav-panel\n                    class=\"flex-1 h-1/2 overflow-auto px-8 py-4\"\n                    #tabPanel\n                >\n                    <router-outlet></router-outlet>\n                </mat-tab-nav-panel>\n            </main>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n                background-color: var(--b1);\n            }\n        `,\n    ],\n})\nexport class SignageComponent extends AsyncHandler implements OnInit {\n    public readonly loading = this._state.loading;\n    public links = ['Media', 'Displays', 'Zones'];\n    public active_link = this.links[0];\n\n    public readonly previewFile = (event) =>\n        this._state.previewFileFromInput(event);\n\n    public singular(name: string) {\n        if (name === 'Media') return 'Playlist';\n        if (name === 'Playlists') return 'Playlist';\n        if (name === 'Displays') return 'Display';\n        return '';\n    }\n\n    public async newItem(name: string) {\n        let result = null;\n        switch (name) {\n            case 'Media':\n            case 'Playlists':\n                result = await this._state.editPlaylist();\n                if (result) {\n                    this._router.navigate(['/signage/media'], {\n                        queryParams: { playlist: result.id },\n                    });\n                }\n                break;\n            case 'Displays':\n                result = await this._state.editDisplay();\n                if (!result) return;\n                this._router.navigate(['/signage/displays'], {\n                    queryParams: { display: result.id },\n                });\n                break;\n        }\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.query',\n            this._router.events.subscribe((event) => {\n                if (event instanceof NavigationEnd) {\n                    this.active_link = this.links.find((_) =>\n                        this._router.url.includes(_.toLowerCase()),\n                    );\n                }\n            }),\n        );\n        this.active_link = this.links.find((_) =>\n            this._router.url.includes(_.toLowerCase()),\n        );\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { first } from 'rxjs/operators';\n\nimport { AsyncHandler } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { SignageStateService } from './signage-state.service';\n\n@Component({\n    selector: 'signage-topbar',\n    template: `\n        <div\n            class=\"flex items-center bg-base-100 h-20 px-4 border-b border-base-200 space-x-2\"\n        >\n            <!-- <mat-form-field appearance=\"outline\">\n                <mat-select\n                    multiple\n                    [(ngModel)]=\"zones\"\n                    (ngModelChange)=\"updateZones($event)\"\n                    placeholder=\"All Levels\"\n                >\n                    <mat-option\n                        *ngFor=\"let level of levels | async\"\n                        [value]=\"level.id\"\n                    >\n                        {{ level.display_name || level.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <mat-slide-toggle\n                class=\"m-2\"\n                [ngModel]=\"(filters | async)?.only_onsite\"\n                (ngModelChange)=\"setFilters({ only_onsite: $event })\"\n                ><div class=\"text-xs\">Onsite Only</div></mat-slide-toggle\n            >\n            <div class=\"flex-1 w-2\"></div>\n            <searchbar\n                class=\"mr-2\"\n                (modelChange)=\"setSearch($event)\"\n            ></searchbar> -->\n        </div>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.25em;\n                width: 8em;\n            }\n        `,\n    ],\n})\nexport class SignageTopbarComponent extends AsyncHandler implements OnInit {\n    /** List of selected levels */\n    public zones: string[] = [];\n    /** List of levels for the active building */\n    public readonly levels = this._org.active_levels;\n\n    // public readonly filters = this._state.filters;\n    // /** Set filtered date */\n    // public readonly setDate = (date) => this._state.setFilters({ date });\n    // /** Set filtered date */\n    // public readonly setFilters = (filters) => this._state.setFilters(filters);\n    // /** Set filter string */\n    // public readonly setSearch = (str) => this._state.setSearchString(str);\n    // /** Update active zones for desks */\n    // public readonly updateZones = (zones) => {\n    //     this._router.navigate([], {\n    //         relativeTo: this._route,\n    //         queryParams: { zone_ids: zones.join(',') },\n    //     });\n    //     this._state.setFilters({ zones });\n    // };\n\n    constructor(\n        private _state: SignageStateService,\n        private _org: OrganisationService,\n        private _route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) => {\n                if (params.has('zone_ids')) {\n                    const zones = params.get('zone_ids').split(',');\n                    if (zones.length) {\n                        const level = this._org.levelWithID(zones);\n                        if (!level) {\n                            return;\n                        }\n                        this._org.building = this._org.buildings.find(\n                            (bld) => bld.id === level.parent_id\n                        );\n                        this.zones = zones;\n                    }\n                }\n            })\n        );\n        this.subscription(\n            'levels',\n            this._org.active_levels.subscribe((levels) => {\n                this.zones = this.zones.filter((zone) =>\n                    levels.find((lvl) => lvl.id === zone)\n                );\n                if (!this.zones.length && levels.length) {\n                    this.zones.push(levels[0].id);\n                }\n                // this.updateZones(this.zones);\n            })\n        );\n        // this.setSearch('');\n    }\n}\n","import { Component, Input, SimpleChanges, ViewChild } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { SignageStateService } from './signage-state.service';\nimport { SignageMedia } from '@placeos/ts-client';\nimport { CdkDropList } from '@angular/cdk/drag-drop';\nimport { getUnixTime, startOfMinute } from 'date-fns';\n\n@Component({\n    selector: 'signage-media-list',\n    template: `\n        <div class=\"p-4\">\n            <h3 class=\"text-xl font-medium text-center mb-4\">Media</h3>\n            <mat-form-field appearance=\"outline\" class=\"w-full no-subscript\">\n                <input\n                    matInput\n                    placeholder=\"Search...\"\n                    [ngModel]=\"search.getValue()\"\n                    (ngModelChange)=\"search.next($event)\"\n                />\n            </mat-form-field>\n        </div>\n        @if ((media | async)?.length > 0) {\n            <div\n                class=\"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-3 p-4\"\n                cdkDropList\n                id=\"media-list\"\n                [cdkDropListData]=\"media | async\"\n                [cdkDropListConnectedTo]=\"playlist_ids\"\n                (cdkDropListDropped)=\"drop($event)\"\n            >\n                @for (media of media | async; track media.id) {\n                    <div\n                        class=\"relative bg-base-100 rounded-lg flex flex-col items-center justify-center p-3 hover:opacity-80 border border-base-300\"\n                        cdkDrag\n                    >\n                        @if (media.valid_from && now < media.valid_from) {\n                            <div\n                                class=\"absolute inset-0 z-0 bg-warning opacity-10 rounded-lg\"\n                            ></div>\n                        } @else if (\n                            media.valid_until && now > media.valid_until\n                        ) {\n                            <div\n                                class=\"absolute inset-0 z-0 bg-error opacity-10 rounded-lg\"\n                            ></div>\n                        }\n                        <div\n                            class=\"min-h-10 min-w-10 border-4 rounded-2xl border-base-400 bg-base-300 border-dashed flex items-center justify-center\"\n                            *cdkDragPlaceholder\n                        >\n                            <app-icon class=\"text-2xl text-base-100\">\n                                add\n                            </app-icon>\n                        </div>\n                        <div\n                            preview\n                            class=\"relative w-full h-36 bg-base-200 rounded-lg overflow-hidden\"\n                        >\n                            <img\n                                auth\n                                [source]=\"media.thumbnail_url\"\n                                *ngIf=\"media.thumbnail_url\"\n                                class=\"w-full h-full object-contain rounded-lg\"\n                            />\n                            <div\n                                class=\"absolute top-1 left-1 px-2 py-1 text-xs rounded-lg capitalize font-mono\"\n                                [class.bg-info]=\"media.media_type === 'video'\"\n                                [class.text-info-content]=\"\n                                    media.media_type === 'video'\n                                \"\n                                [class.bg-warning]=\"\n                                    media.media_type === 'image'\n                                \"\n                                [class.text-warning-content]=\"\n                                    media.media_type === 'image'\n                                \"\n                            >\n                                {{ media.media_type }}\n                            </div>\n                            <div\n                                class=\"absolute bottom-1 right-1 px-2 py-1 text-xs rounded-lg bg-info text-info-content capitalize font-mono\"\n                                *ngIf=\"media.play_time\"\n                            >\n                                {{ media.play_time / 1000 | mediaDuration }}\n                            </div>\n                        </div>\n                        <div\n                            class=\"flex items-center justify-between w-full relative top-1\"\n                        >\n                            <div\n                                class=\"text-base-content truncate flex-1 w-1/2\"\n                                [matTooltip]=\"media.name\"\n                            >\n                                {{ media.name }}\n                            </div>\n                            <button\n                                icon\n                                matRipple\n                                [matMenuTriggerFor]=\"menu\"\n                                aria-label=\"Media Actions\"\n                            >\n                                <app-icon>more_vert</app-icon>\n                            </button>\n                            <mat-menu #menu=\"matMenu\">\n                                <button mat-menu-item (click)=\"editItem(media)\">\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\"\n                                            >edit</app-icon\n                                        >\n                                        <div class=\"pr-2\">Edit Media Item</div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"previewItem(media)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\"\n                                            >visibility</app-icon\n                                        >\n                                        <div class=\"pr-2\">\n                                            Preview Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"removeItem(media)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl text-error\">\n                                            delete\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Remove Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                            </mat-menu>\n                        </div>\n                    </div>\n                }\n            </div>\n        } @else {\n            <div\n                class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30 mx-auto flex-1\"\n            >\n                <app-icon class=\"text-6xl\">hide_image</app-icon>\n                <p>No media found.</p>\n            </div>\n        }\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignageMediaListComponent {\n    @Input() public playlist_count = 0;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly media = combineLatest([\n        this.search,\n        this._state.media,\n    ]).pipe(\n        map(([search, media]) =>\n            media.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n\n    public playlist_ids: string[] = [];\n\n    public get now() {\n        return getUnixTime(startOfMinute(Date.now()));\n    }\n\n    public readonly previewItem = (item: SignageMedia) =>\n        this._state.previewMedia(item);\n\n    public readonly editItem = (item: SignageMedia) =>\n        this._state.editMedia(item);\n\n    public readonly removeItem = async (item: SignageMedia) =>\n        this._state.removeMedia(item);\n\n    constructor(private _state: SignageStateService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.playlist_count) {\n            this.playlist_ids = new Array(this.playlist_count)\n                .fill(0)\n                .map((_, idx) => `playlist-${idx}`);\n        }\n    }\n\n    public drop(event) {}\n}\n","import { Component, Input, SimpleChanges } from '@angular/core';\nimport { BehaviorSubject, combineLatest, of } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport {\n    catchError,\n    debounceTime,\n    filter,\n    map,\n    shareReplay,\n    startWith,\n    switchMap,\n    take,\n} from 'rxjs/operators';\nimport {\n    listSignagePlaylistMedia,\n    MediaAnimation,\n    SignageMedia,\n    SignagePlaylist,\n} from '@placeos/ts-client';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport { Router } from '@angular/router';\nimport { getUnixTime, startOfMinute } from 'date-fns';\n\n@Component({\n    selector: 'signage-playlist-media-list',\n    template: `\n        <div class=\"flex flex-col space-y-4 relative p-4 h-full w-full\">\n            <h3 class=\"text-xl font-medium text-center\">\n                Playlist - {{ (selected_playlist | async)?.name }}\n            </h3>\n            <button\n                icon\n                matRipple\n                [matMenuTriggerFor]=\"menu\"\n                class=\"absolute top-2 right-2 !m-0\"\n            >\n                <app-icon>more_vert</app-icon>\n            </button>\n            <mat-menu #menu=\"matMenu\">\n                <button mat-menu-item (click)=\"editPlaylist()\">\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon class=\"text-2xl\">edit</app-icon>\n                        <div class=\"pr-2\">Edit Playlist</div>\n                    </div>\n                </button>\n                <button mat-menu-item (click)=\"removePlaylist()\">\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon class=\"text-2xl text-error\">delete</app-icon>\n                        <div class=\"pr-2\">Remove Playlist</div>\n                    </div>\n                </button>\n            </mat-menu>\n            <div details class=\"flex items-center flex-wrap\">\n                <div\n                    class=\"ml-2 text-xs px-2 py-1 m-1 rounded\"\n                    [class.bg-success]=\"(selected_playlist | async)?.enabled\"\n                    [class.text-success-content]=\"\n                        (selected_playlist | async)?.enabled\n                    \"\n                    [class.bg-error]=\"!(selected_playlist | async)?.enabled\"\n                    [class.text-error-content]=\"\n                        !(selected_playlist | async)?.enabled\n                    \"\n                >\n                    {{\n                        (selected_playlist | async)?.enabled\n                            ? 'Enabled'\n                            : 'Disabled'\n                    }}\n                </div>\n                <div\n                    class=\"ml-2 text-xs px-2 py-1 m-1 rounded bg-secondary text-secondary-content\"\n                    *ngIf=\"(selected_playlist | async)?.random\"\n                >\n                    Shuffle ON\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1 \"\n                    matTooltip=\"Default Transition Animation\"\n                >\n                    Animation:\n                    <span\n                        class=\"ml-1 uppercase bg-base-200 px-2 py-1 rounded\"\n                        >{{\n                            animation_name(\n                                (selected_playlist | async)?.default_animation\n                            )\n                        }}</span\n                    >\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1\"\n                    matTooltip=\"Default Playback Duration\"\n                >\n                    Duration:\n                    <span\n                        class=\"ml-1 font-mono bg-base-200 px-2 py-1 rounded\"\n                        >{{\n                            (selected_playlist | async)?.default_duration / 1000\n                                | mediaDuration\n                        }}</span\n                    >\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1\"\n                    matTooltip=\"Prefered Orientation\"\n                >\n                    Orientation:\n                    <span\n                        class=\"ml-1 uppercase bg-base-200 px-2 py-1 rounded\"\n                        >{{ (selected_playlist | async)?.orientation }}</span\n                    >\n                </div>\n            </div>\n            @if ((media | async).length > 0) {\n                <div\n                    cdkDropList\n                    class=\"flex-1 h-1/2 overflow-auto flex flex-col space-y-2\"\n                    id=\"playlist-list\"\n                    [cdkDropListData]=\"media | async\"\n                    [cdkDropListConnectedTo]=\"playlist_ids\"\n                    (cdkDropListDropped)=\"drop($event)\"\n                >\n                    <ng-container *ngFor=\"let item of media | async\">\n                        <div\n                            cdkDrag\n                            class=\"relative w-full bg-base-100 h-20 rounded-lg flex items-center p-2 space-x-2 border border-base-300\"\n                        >\n                            @if (item.valid_from && now < item.valid_from) {\n                                <div\n                                    class=\"absolute inset-0 z-0 bg-warning opacity-10 rounded-lg\"\n                                ></div>\n                            } @else if (\n                                item.valid_until && now > item.valid_until\n                            ) {\n                                <div\n                                    class=\"absolute inset-0 z-0 bg-error opacity-10 rounded-lg\"\n                                ></div>\n                            }\n                            <div\n                                class=\"min-h-10 min-w-10 border-4 rounded-2xl border-base-400 bg-base-300 border-dashed flex items-center justify-center\"\n                                *cdkDragPlaceholder\n                            >\n                                <app-icon class=\"text-2xl text-base-100\">\n                                    add\n                                </app-icon>\n                            </div>\n                            <button\n                                matRipple\n                                cdkDragHandle\n                                class=\"flex items-center justify-center w-6 h-full rounded hover:bg-base-200\"\n                                matTooltip=\"Drag to reorder\"\n                            >\n                                <app-icon>drag_handle</app-icon>\n                            </button>\n                            <div\n                                preview\n                                class=\"w-[4.5rem] h-16 bg-base-200 rounded-lg overflow-hidden\"\n                            >\n                                <img\n                                    auth\n                                    [source]=\"item.thumbnail_url\"\n                                    class=\"w-full h-full object-contain\"\n                                />\n                            </div>\n                            <div\n                                class=\"text-base-content truncate flex-1 w-1/2\"\n                            >\n                                {{ item.name }}\n                            </div>\n                            <button\n                                icon\n                                matRipple\n                                aria-label=\"Media Actions\"\n                                [matMenuTriggerFor]=\"menu\"\n                            >\n                                <app-icon>more_vert</app-icon>\n                            </button>\n                            <mat-menu #menu=\"matMenu\">\n                                <button mat-menu-item (click)=\"editItem(item)\">\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\">\n                                            edit\n                                        </app-icon>\n                                        <div class=\"pr-2\">Edit Media Item</div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"previewItem(item)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\">\n                                            visibility\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Preview Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"removeItem(item)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl text-error\">\n                                            delete\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Remove Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                            </mat-menu>\n                        </div>\n                    </ng-container>\n                </div>\n            } @else {\n                <div\n                    class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30 mx-auto flex-1\"\n                >\n                    <app-icon class=\"text-6xl\">hide_image</app-icon>\n                    <p>No media in playlist.</p>\n                </div>\n            }\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignagePlaylistMediaListComponent {\n    @Input() public playlist = '';\n    @Input() public playlist_count = 0;\n\n    public playlist_ids: string[] = [];\n\n    private _playlist = new BehaviorSubject<string>('');\n\n    public readonly editPlaylist = async () => {\n        const playlist = await this.selected_playlist.pipe(take(1)).toPromise();\n        this._state.editPlaylist(playlist);\n    };\n\n    public readonly removeItem = async (item: SignageMedia) => {\n        const playlist = await this._playlist_media.pipe(take(1)).toPromise();\n        const list = playlist.items.filter((_) => _ !== item.id);\n        await this._state.updatePlaylistMedia(this.playlist, list);\n        this._playlist.next(this.playlist);\n    };\n\n    public readonly previewItem = (item: SignageMedia) =>\n        this._state.previewMedia(item);\n\n    public readonly editItem = (item: SignageMedia) =>\n        this._state.editMedia(item);\n\n    public readonly removePlaylist = async () =>\n        this._state.removePlaylist(\n            await this.selected_playlist.pipe(take(1)).toPromise(),\n        );\n\n    public readonly selected_playlist = combineLatest([\n        this._playlist,\n        this._state.playlists,\n    ]).pipe(\n        map(([playlist, list]) => {\n            const item = list.find((_) => _.id === playlist);\n            if (!item) this._router.navigate(['/signage/media', {}]);\n            return item;\n        }),\n    );\n\n    private _playlist_media = this._playlist.pipe(\n        filter((playlist) => !!playlist),\n        debounceTime(300),\n        switchMap((playlist) =>\n            listSignagePlaylistMedia(playlist).pipe(\n                catchError(() => of({ id: '', items: [] })),\n            ),\n        ),\n        shareReplay(1),\n    );\n\n    public readonly media = combineLatest([\n        this._playlist_media,\n        this._state.media,\n    ]).pipe(\n        map(([playlist, media]) =>\n            playlist.items\n                .map((_) => media.find((m) => m.id === _))\n                .filter((_) => _),\n        ),\n        startWith([]),\n    );\n\n    public get now() {\n        return getUnixTime(startOfMinute(Date.now()));\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n    ) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.playlist) {\n            this._playlist.next(this.playlist);\n        }\n        if (changes.playlist_count) {\n            this.playlist_ids = new Array(this.playlist_count)\n                .fill(0)\n                .map((_, idx) => `playlist-${idx}`);\n        }\n    }\n\n    public animation_name(value: MediaAnimation) {\n        switch (value) {\n            case MediaAnimation.Cut:\n                return 'Cut';\n            case MediaAnimation.CrossFade:\n                return 'Cross Fade';\n            case MediaAnimation.SlideBottom:\n                return 'Slide Bottom';\n            case MediaAnimation.SlideLeft:\n                return 'Slide Left';\n            case MediaAnimation.SlideRight:\n                return 'Slide Right';\n            case MediaAnimation.SlideTop:\n                return 'Slide Top';\n        }\n        return 'Default';\n    }\n\n    public async drop(event: CdkDragDrop<SignageMedia[]>) {\n        if (event.previousIndex === event.currentIndex) return;\n        const id = await this._playlist.pipe(take(1)).toPromise();\n        const playlist = await this._playlist_media.pipe(take(1)).toPromise();\n        if (!id && playlist) return;\n        const list = [...playlist.items];\n        moveItemInArray(list, event.previousIndex, event.currentIndex);\n        await this._state.updatePlaylistMedia(id, list);\n        this._playlist.next(this.playlist);\n    }\n}\n","import { Component, ViewChild } from '@angular/core';\n\nimport { SignageStateService } from './signage-state.service';\nimport { AsyncHandler, unique } from '@placeos/common';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { SignageMediaListComponent } from './signage-media-list.component';\nimport { listSignagePlaylistMedia, SignagePlaylist } from '@placeos/ts-client';\nimport { CdkDragDrop } from '@angular/cdk/drag-drop';\n\n@Component({\n    selector: 'signage-media',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div\n                sidebar\n                class=\"w-64 h-full flex flex-col space-y-4 py-4 overflow-auto\"\n            >\n                <h3 class=\"text-xl font-medium text-center\">Playlists</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                <a\n                    matRipple\n                    class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200\"\n                    [class.!bg-secondary]=\"!selected_playlist\"\n                    [class.text-secondary-content]=\"!selected_playlist\"\n                    [routerLink]=\"[]\"\n                    [queryParams]=\"{ playlist: '' }\"\n                >\n                    All Media\n                </a>\n                <hr class=\"w-full\" />\n                @if ((playlists | async)?.length > 0) {\n                    @for (playlist of playlists | async; track playlist.id) {\n                        <a\n                            matRipple\n                            class=\"w-full px-6 rounded-3xl h-12 min-h-12 flex items-center hover:bg-base-200\"\n                            [class.!bg-secondary]=\"\n                                selected_playlist === playlist.id\n                            \"\n                            [class.text-secondary-content]=\"\n                                selected_playlist === playlist.id\n                            \"\n                            [routerLink]=\"[]\"\n                            [queryParams]=\"{ playlist: playlist.id }\"\n                            cdkDropList\n                            [id]=\"'playlist-' + $index\"\n                            [cdkDropListConnectedTo]=\"[\n                                'media-list',\n                                'playlist-list',\n                            ]\"\n                            (cdkDropListDropped)=\"\n                                selected_playlist === playlist.id\n                                    ? ''\n                                    : drop(playlist, $event)\n                            \"\n                        >\n                            <div class=\"flex-1\">\n                                {{ playlist.name }}\n                            </div>\n                        </a>\n                    }\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching playlists found'\n                                    : 'No playlists'\n                            }}\n                        </p>\n                    </div>\n                    <button\n                        *ngIf=\"!search.getValue()\"\n                        btn\n                        matRipple\n                        class=\"inverse\"\n                        (click)=\"addPlaylist()\"\n                    >\n                        <div class=\"flex items-center justify-center w-full\">\n                            <app-icon class=\"text-2xl\">add</app-icon>\n                            <span class=\"ml-2 mr-4\">Add Playlist</span>\n                        </div>\n                    </button>\n                }\n            </div>\n            <div\n                class=\"relative flex-1 w-1/2 h-full overflow-hidden rounded-lg border border-base-300 shadow\"\n                (dragover)=\"onEnter($event)\"\n                (dragenter)=\"onEnter($event)\"\n                (window:drop)=\"hideOverlay($event)\"\n            >\n                <div class=\"h-full w-full overflow-auto\">\n                    <signage-media-list\n                        *ngIf=\"!selected_playlist\"\n                        [playlist_count]=\"(playlists | async)?.length\"\n                    ></signage-media-list>\n                    <signage-playlist-media-list\n                        *ngIf=\"selected_playlist\"\n                        [playlist]=\"selected_playlist\"\n                        [playlist_count]=\"(playlists | async)?.length\"\n                    ></signage-playlist-media-list>\n                </div>\n                <div\n                    class=\"absolute inset-0\"\n                    *ngIf=\"show_dropzone\"\n                    (dragleave)=\"hideOverlay($event)\"\n                    (drop)=\"previewFile($event)\"\n                >\n                    <div\n                        class=\"absolute inset-0 bg-base-content opacity-60\"\n                    ></div>\n                    <div\n                        class=\"absolute inset-4 border-4 border-dashed border-base-300 flex flex-col items-center justify-center rounded-2xl text-base-100 space-y-4\"\n                    >\n                        <app-icon class=\"text-6xl\">cloud_upload</app-icon>\n                        <p>Drop Media to upload</p>\n                    </div>\n                    <input\n                        type=\"file\"\n                        (change)=\"previewFile($event)\"\n                        class=\"absolute inset-0 opacity-0\"\n                    />\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                min-height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignageMediaComponent extends AsyncHandler {\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly playlists = combineLatest([\n        this.search,\n        this._state.playlists,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public selected_playlist = '';\n    public show_dropzone = false;\n\n    public readonly addPlaylist = async () => {\n        const result = await this._state.editPlaylist();\n        if (result) {\n            this._router.navigate([\n                '/signage/media',\n                { query: { playlist: result.id } },\n            ]);\n        }\n    };\n    public readonly previewMedia = (item) => this._state.previewMedia(item);\n    public readonly previewFile = (event) =>\n        this._state.previewFileFromInput(event, this.selected_playlist);\n\n    public onEnter(e) {\n        this.clearTimeout('hide_overlay');\n        this.show_dropzone = e?.dataTransfer?.types.includes('Files');\n    }\n\n    public hideOverlay(e) {\n        if (!this.show_dropzone) return;\n        if (!(e.target instanceof HTMLInputElement)) {\n            e.preventDefault();\n        }\n        this.timeout('hide_overlay', () => (this.show_dropzone = false));\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n        private _route: ActivatedRoute,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                if (params.has('playlist')) {\n                    this.selected_playlist = params.get('playlist');\n                }\n            }),\n        );\n    }\n\n    public async drop(\n        playlist: SignagePlaylist,\n        event: CdkDragDrop<SignagePlaylist[]>,\n    ) {\n        const media = event.previousContainer.data[event.previousIndex];\n        const media_list = await listSignagePlaylistMedia(\n            playlist.id,\n        ).toPromise();\n        const new_media_list = [...media_list.items, media.id];\n        await this._state.updatePlaylistMedia(playlist.id, new_media_list);\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n    TemplateRef,\n} from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n    selector: 'search-overlay',\n    template: `\n        <div\n            class=\"absolute inset-0 flex flex-col p-8 items-center\"\n            (click)=\"close.next()\"\n            (window:keydown.esc)=\"close.next()\"\n        >\n            <div class=\"absolute inset-0 bg-base-content opacity-70 z-0\"></div>\n            <div\n                class=\"relative mb-4 w-[32rem] max-w-[calc(100%-2rem)] mx-auto z-10\"\n                (click)=\"$event.stopPropagation()\"\n            >\n                <input\n                    class=\"rounded-[4rem] text-xl text-base-content bg-base-100 border border-base-300 shadow pl-14 pr-6 py-4 w-full\"\n                    [ngModel]=\"search.getValue()\"\n                    (ngModelChange)=\"search.next($event)\"\n                    placeholder=\"Search...\"\n                />\n                <app-icon\n                    class=\"absolute left-3 top-1/2 -translate-y-1/2 text-3xl pointer-events-none\"\n                >\n                    search\n                </app-icon>\n            </div>\n            <div\n                class=\"overflow-auto max-h-[65%] w-[32rem] max-w-[calc(100%-2rem)] mx-auto rounded z-10\"\n                (click)=\"$event.stopPropagation()\"\n            >\n                @for (item of item_list; track item) {\n                    <button\n                        matRipple\n                        class=\"w-full text-left\"\n                        (click)=\"selected.next(item)\"\n                    >\n                        @if (result_template) {\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    result_template;\n                                    context: { item: item }\n                                \"\n                            ></ng-container>\n                        } @else {\n                            <div\n                                class=\"p-4 w-full bg-base-100 hover:bg-base-200 border border-base-300\"\n                            >\n                                {{ item.name || item }}\n                            </div>\n                        }\n                    </button>\n                }\n                @if (!item_list?.length) {\n                    <button\n                        matRipple\n                        class=\"w-full p-4 text-base-100\"\n                        (click)=\"close.next()\"\n                    >\n                        <div class=\"opacity-30\">\n                            No items available to select\n                        </div>\n                    </button>\n                }\n            </div>\n            <button\n                icon\n                matRipple\n                class=\"absolute top-10 right-8 text-base-100 text-xl h-12 w-12\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SearchOverlayComponent<T extends {} = any> {\n    @Input() public item_list: T[] = [];\n    @Input() public result_template: TemplateRef<any>;\n\n    @Output() public selected = new EventEmitter<T>();\n    @Output() public close = new EventEmitter<void>();\n\n    public readonly search = new BehaviorSubject('');\n    private _items = new BehaviorSubject<T[]>([]);\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item_list) {\n            this._items.next(this.item_list || []);\n        }\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport { map, startWith, tap } from 'rxjs/operators';\nimport { SignagePlaylist } from '@placeos/ts-client';\n\nconst PLAYLIST_ITEM_COUNTS = {};\n\n@Component({\n    selector: `signage-item-playlists`,\n    template: `\n        <div class=\"flex items-center justify-center space-x-2\">\n            <h3 class=\"text-xl font-medium\">\n                {{ item?.display_name || item?.name }}\n            </h3>\n            <div\n                *ngIf=\"extra\"\n                class=\"px-2 py-1 text-xs font-mono bg-base-200 rounded-lg uppercase\"\n            >\n                {{ extra }}\n            </div>\n        </div>\n        <ng-content></ng-content>\n        @if ((active_playlists | async).length > 0 && item) {\n            <div\n                cdkDropList\n                class=\"flex-1 h-1/2 overflow-auto flex flex-col space-y-2 mt-4\"\n                (cdkDropListDropped)=\"ondrop.next($event)\"\n            >\n                @for (item of active_playlists | async; track item.id) {\n                    <div\n                        cdkDrag\n                        class=\"w-full bg-base-100 h-20 rounded-lg flex items-center p-2 space-x-2 border border-base-300\"\n                    >\n                        <div\n                            class=\"h-20 w-full border-4 border-dashed border-base-400 bg-base-300 rounded-xl\"\n                            *cdkDragPlaceholder\n                        ></div>\n                        <button\n                            matRipple\n                            cdkDragHandle\n                            class=\"flex items-center justify-center w-6 h-full rounded hover:bg-base-200\"\n                            matTooltip=\"Drag to reorder\"\n                        >\n                            <app-icon>drag_handle</app-icon>\n                        </button>\n                        <div class=\"text-base-content flex-1 w-1/2\">\n                            <div class=\"truncate\">\n                                {{ item.name }}\n                            </div>\n                            <div class=\"truncate text-sm opacity-30\">\n                                {{ playlistCount(item.id) || 0 }} Media items\n                            </div>\n                        </div>\n                        <button\n                            icon\n                            matRipple\n                            aria-label=\"Media Actions\"\n                            [matMenuTriggerFor]=\"menu\"\n                        >\n                            <app-icon>more_vert</app-icon>\n                        </button>\n                        <mat-menu #menu=\"matMenu\">\n                            <a\n                                mat-menu-item\n                                [routerLink]=\"['/signage', 'media']\"\n                                [queryParams]=\"{\n                                    playlist: item.id,\n                                }\"\n                            >\n                                <div class=\"flex items-center space-x-2\">\n                                    <app-icon class=\"text-2xl\">\n                                        visibility\n                                    </app-icon>\n                                    <div class=\"pr-2\">View Playlist</div>\n                                </div>\n                            </a>\n                            <button mat-menu-item (click)=\"remove.next(item)\">\n                                <div class=\"flex items-center space-x-2\">\n                                    <app-icon class=\"text-2xl text-error\">\n                                        delete\n                                    </app-icon>\n                                    <div class=\"pr-2\">Remove Playlist</div>\n                                </div>\n                            </button>\n                        </mat-menu>\n                    </div>\n                }\n            </div>\n            <button btn matRipple (click)=\"add.emit()\">Add Playlist</button>\n        } @else {\n            <div\n                class=\"flex flex-col items-center justify-center p-8 space-y-2 mx-auto flex-1\"\n            >\n                <div\n                    class=\"flex flex-col items-center justify-center opacity-30\"\n                >\n                    <app-icon class=\"text-6xl\">hide_image</app-icon>\n                    <p>No playlists in {{ name }}.</p>\n                </div>\n                <button btn matRipple (click)=\"add.emit()\" class=\"w-40\">\n                    Add Playlist\n                </button>\n            </div>\n        }\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n            }\n        `,\n    ],\n})\nexport class SignageItemPlaylistsComponent {\n    @Input() public item: any;\n    @Input() public name: string = 'zone';\n    @Input() public extra: string = '';\n    @Output() public readonly add = new EventEmitter();\n    @Output() public readonly remove = new EventEmitter<SignagePlaylist>();\n    @Output() public readonly ondrop = new EventEmitter<any>();\n\n    private _playlist_ids = new BehaviorSubject<string[]>([]);\n\n    public readonly active_playlists = combineLatest([\n        this._state.playlists,\n        this._playlist_ids,\n        this._state.has_changed,\n    ]).pipe(\n        map(([playlists, ids]) =>\n            ids.map((id) => playlists.find((_) => _.id === id)),\n        ),\n        tap((playlists) => {\n            for (const item of playlists) {\n                const old_counts = PLAYLIST_ITEM_COUNTS[item.id];\n                if (\n                    old_counts &&\n                    old_counts.last_updated > item.updated_at * 1000\n                ) {\n                    continue;\n                }\n                this._state.getPlaylistMedia(item.id).then((media) => {\n                    PLAYLIST_ITEM_COUNTS[item.id] = {\n                        count: media.length,\n                        last_updated: Date.now(),\n                    };\n                });\n            }\n        }),\n        startWith([]),\n    );\n\n    public playlistCount(id: string) {\n        return PLAYLIST_ITEM_COUNTS[id]?.count || 0;\n    }\n\n    constructor(private _state: SignageStateService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item) {\n            this._playlist_ids.next(this.item?.playlists || []);\n        }\n    }\n}\n","import { Component } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport { map, shareReplay, switchMap, take, tap } from 'rxjs/operators';\nimport { ActivatedRoute } from '@angular/router';\nimport { AsyncHandler, notifySuccess, SettingsService } from '@placeos/common';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport {\n    listSystemTriggers,\n    SignagePlaylist,\n    updateSystem,\n    updateTrigger,\n} from '@placeos/ts-client';\n\n@Component({\n    selector: 'signage-displays',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div sidebar class=\"w-64 h-full flex flex-col space-y-4 py-4\">\n                <h3 class=\"text-xl font-medium text-center\">Displays</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                @if ((displays | async)?.length > 0) {\n                    <div class=\"h-1/2 flex-1 w-full overflow-auto space-y-2\">\n                        @for (display of displays | async; track display.id) {\n                            <a\n                                matRipple\n                                class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate z-10\"\n                                [class.!bg-secondary]=\"\n                                    selected.getValue() === display.id\n                                \"\n                                [class.text-secondary-content]=\"\n                                    selected.getValue() === display.id\n                                \"\n                                [routerLink]=\"[]\"\n                                [queryParams]=\"{ display: display.id }\"\n                            >\n                                {{ display.display_name || display.name }}\n                            </a>\n                            @if (\n                                (active_display | async)?.id === display.id &&\n                                !switching\n                            ) {\n                                @for (\n                                    trigger of triggers | async;\n                                    track trigger.id\n                                ) {\n                                    <div\n                                        class=\"relative flex items-center space-x-2 z-0\"\n                                    >\n                                        <div class=\"w-6\">\n                                            <div\n                                                class=\"absolute h-16 w-4 border-b-2 border-l-2 border-base-300 top-1/2 left-6 -translate-y-full\"\n                                            ></div>\n                                        </div>\n                                        <a\n                                            matRipple\n                                            class=\"w-1/2 flex-1 px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate\"\n                                            [class.!bg-secondary]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [class.text-secondary-content]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [routerLink]=\"[]\"\n                                            [queryParams]=\"{\n                                                display: display.id,\n                                                trigger: trigger?.id,\n                                            }\"\n                                        >\n                                            <span class=\"max-w-full truncate\">{{\n                                                trigger?.display_name ||\n                                                    trigger?.name ||\n                                                    'Trigger'\n                                            }}</span>\n                                        </a>\n                                    </div>\n                                }\n                            }\n                        }\n                    </div>\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching displays found'\n                                    : 'No displays'\n                            }}\n                        </p>\n                    </div>\n                }\n            </div>\n            <div\n                class=\"relative flex flex-col flex-1 w-1/2 h-full overflow-auto rounded-lg border border-base-300 p-4 shadow space-y-4\"\n            >\n                @if (active_display | async) {\n                    <signage-item-playlists\n                        class=\"flex flex-col flex-1\"\n                        [item]=\"\n                            (active_trigger | async) || (active_display | async)\n                        \"\n                        [name]=\"\n                            (active_trigger | async) ? 'trigger' : 'display'\n                        \"\n                        [extra]=\"\n                            (active_trigger | async)\n                                ? ''\n                                : (active_display | async)?.orientation\n                        \"\n                        (add)=\"this.adding = true\"\n                        (remove)=\"removePlaylist($event)\"\n                        (ondrop)=\"drop($event)\"\n                    >\n                        <div\n                            class=\"flex flex-wrap items-center overflow-auto mt-4\"\n                            *ngIf=\"!(active_trigger | async)\"\n                        >\n                            @for (\n                                zone of (active_display | async)?.zones;\n                                track zone\n                            ) {\n                                <a\n                                    class=\"px-2 py-1 font-mono text-xs bg-base-200 rounded whitespace-nowrap m-1\"\n                                    matRipple\n                                    [routerLink]=\"['/signage', 'zones']\"\n                                    [queryParams]=\"{ zone: zone }\"\n                                >\n                                    {{\n                                        (zone | zone | async)?.display_name ||\n                                            (zone | zone | async)?.name\n                                    }}\n                                </a>\n                            }\n                            <button\n                                class=\"underline font-mono text-xs px-2 py-1 rounded m-1\"\n                                matRipple\n                            >\n                                Add Zone\n                            </button>\n                        </div>\n                        <button\n                            icon\n                            matRipple\n                            [matMenuTriggerFor]=\"menu\"\n                            class=\"absolute top-2 right-2 !m-0\"\n                        >\n                            <app-icon>more_vert</app-icon>\n                        </button>\n                        <mat-menu #menu=\"matMenu\">\n                            <a\n                                mat-menu-item\n                                [href]=\"\n                                    signage_path +\n                                    '/#/signage/' +\n                                    (active_display | async)?.id\n                                \"\n                                target=\"_blank\"\n                                ref=\"noopener noreferrer\"\n                            >\n                                <div class=\"flex items-center space-x-2\">\n                                    <app-icon class=\"text-2xl\"\n                                        >open_in_new</app-icon\n                                    >\n                                    <div class=\"pr-2\">Open Signage Player</div>\n                                </div>\n                            </a>\n                            <button mat-menu-item (click)=\"removeDisplay()\">\n                                <div class=\"flex items-center space-x-2\">\n                                    <app-icon class=\"text-2xl text-error\"\n                                        >delete</app-icon\n                                    >\n                                    <div class=\"pr-2\">Remove Display</div>\n                                </div>\n                            </button>\n                        </mat-menu>\n                    </signage-item-playlists>\n                } @else {\n                    <div\n                        class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">desktop_windows</app-icon>\n                        <p>Select a display from the left to view playlists</p>\n                    </div>\n                }\n                <search-overlay\n                    *ngIf=\"adding\"\n                    [item_list]=\"playlists | async\"\n                    (selected)=\"addPlaylist($event)\"\n                    (close)=\"adding = false\"\n                ></search-overlay>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SignageDisplaysComponent extends AsyncHandler {\n    public adding = false;\n    public switching = false;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly displays = combineLatest([\n        this.search,\n        this._state.displays,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public readonly selected = new BehaviorSubject('');\n    public readonly selected_trigger = new BehaviorSubject('');\n    public readonly active_display = combineLatest([\n        this.displays,\n        this.selected,\n    ]).pipe(map(([displays, id]) => displays.find((item) => item.id === id)));\n\n    public readonly triggers = this.selected.pipe(\n        switchMap((id) => listSystemTriggers(id)),\n        map((_) => _.data),\n        tap((_) => setTimeout(() => (this.switching = false), 200)),\n        shareReplay(1),\n    );\n\n    public readonly active_trigger = combineLatest([\n        this.triggers,\n        this.selected_trigger,\n        this.selected,\n    ]).pipe(\n        map(([list, id, sys_id]) =>\n            list.find(\n                (item) => item.id === id && item.control_system_id === sys_id,\n            ),\n        ),\n    );\n\n    public readonly playlists = combineLatest([\n        this.active_display,\n        this.active_trigger,\n        this._state.playlists,\n        this._state.has_changed,\n    ]).pipe(\n        map(([display, trigger, playlists]) =>\n            playlists.filter(\n                (_) =>\n                    !(trigger || display)?.playlists.find((id) => _.id === id),\n            ),\n        ),\n    );\n\n    public readonly removeDisplay = async () =>\n        this._state.removeDisplay(\n            await this.active_display.pipe(take(1)).toPromise(),\n        );\n\n    public get signage_path() {\n        return this._settings.get('app.signage_path') || '/signage';\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _route: ActivatedRoute,\n        private _settings: SettingsService,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                this.switching =\n                    params.get('display') !== this.selected.getValue();\n                this.selected.next(params.get('display') || '');\n                this.selected_trigger.next(params.get('trigger') || '');\n            }),\n        );\n    }\n\n    public async addPlaylist(playlist: SignagePlaylist) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const playlists = [...item.playlists, playlist.id];\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(\n            item.id,\n            { playlists, version: display.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully added playlist to the ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const playlists = item.playlists.filter((id) => playlist.id !== id);\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(\n            item.id,\n            { playlists, version: display.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully removed playlist from ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async drop(event: CdkDragDrop<SignagePlaylist[]>) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const old_playlist = item.playlists;\n        const playlists = [...old_playlist];\n        moveItemInArray(playlists, event.previousIndex, event.currentIndex);\n        (item as any).playlists = playlists;\n        this._state.changed();\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(item.id, { playlists, version: display.version }, 'patch')\n            .toPromise()\n            .catch((e) => {\n                (item as any).playlists = old_playlist;\n                this._state.changed();\n                throw e;\n            });\n        notifySuccess(\n            `Successfully re-ordered playlists on ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n    }\n}\n","import { Component } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport {\n    map,\n    shareReplay,\n    startWith,\n    switchMap,\n    take,\n    tap,\n} from 'rxjs/operators';\nimport { ActivatedRoute } from '@angular/router';\nimport { AsyncHandler, notifySuccess, unique } from '@placeos/common';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport {\n    listZoneTriggers,\n    SignagePlaylist,\n    updateTrigger,\n    updateZone,\n} from '@placeos/ts-client';\n\n@Component({\n    selector: 'signage-zones',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div sidebar class=\"w-64 h-full flex flex-col space-y-4 py-4\">\n                <h3 class=\"text-xl font-medium text-center\">Zones</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                @if ((zones | async)?.length > 0) {\n                    <div class=\"h-1/2 flex-1 w-full overflow-auto space-y-2\">\n                        @for (zone of zones | async; track zone.id) {\n                            <a\n                                matRipple\n                                class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate z-10\"\n                                [class.!bg-secondary]=\"\n                                    selected.getValue() === zone.id\n                                \"\n                                [class.text-secondary-content]=\"\n                                    selected.getValue() === zone.id\n                                \"\n                                [routerLink]=\"[]\"\n                                [queryParams]=\"{ zone: zone.id }\"\n                            >\n                                {{ zone.display_name || zone.name }}\n                            </a>\n                            @if (\n                                (active_zone | async)?.id === zone.id &&\n                                !switching\n                            ) {\n                                @for (\n                                    trigger of triggers | async;\n                                    track trigger.id\n                                ) {\n                                    <div\n                                        class=\"relative flex items-center space-x-2 z-0\"\n                                    >\n                                        <div class=\"w-6\">\n                                            <div\n                                                class=\"absolute h-16 w-4 border-b-2 border-l-2 border-base-300 top-1/2 left-6 -translate-y-full\"\n                                            ></div>\n                                        </div>\n                                        <a\n                                            matRipple\n                                            class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate\"\n                                            [class.!bg-secondary]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [class.text-secondary-content]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [routerLink]=\"[]\"\n                                            [queryParams]=\"{\n                                                zone: zone.id,\n                                                trigger: trigger?.id,\n                                            }\"\n                                        >\n                                            {{\n                                                trigger?.display_name ||\n                                                    trigger?.name ||\n                                                    'Trigger'\n                                            }}\n                                        </a>\n                                    </div>\n                                }\n                            }\n                        }\n                    </div>\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching zones found'\n                                    : 'No zones'\n                            }}\n                        </p>\n                    </div>\n                }\n            </div>\n            <div\n                class=\"relative flex flex-col flex-1 w-1/2 h-full overflow-auto rounded-lg border border-base-300 p-4 shadow space-y-4\"\n            >\n                @if (active_zone | async) {\n                    <signage-item-playlists\n                        class=\"flex flex-col flex-1\"\n                        [item]=\"\n                            (active_trigger | async) || (active_zone | async)\n                        \"\n                        [name]=\"(active_trigger | async) ? 'trigger' : 'zone'\"\n                        (add)=\"this.adding = true\"\n                        (remove)=\"removePlaylist($event)\"\n                        (ondrop)=\"drop($event)\"\n                    ></signage-item-playlists>\n                } @else {\n                    <div\n                        class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">desktop_windows</app-icon>\n                        <p>Select a zone from the left to view playlists</p>\n                    </div>\n                }\n                <search-overlay\n                    *ngIf=\"adding\"\n                    [item_list]=\"playlists | async\"\n                    (selected)=\"addPlaylist($event)\"\n                    (close)=\"adding = false\"\n                ></search-overlay>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SignageZonesComponent extends AsyncHandler {\n    public adding = false;\n    public switching = false;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly zones = combineLatest([\n        this.search,\n        this._state.zones,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public readonly selected = new BehaviorSubject('');\n    public readonly selected_trigger = new BehaviorSubject('');\n    public readonly active_zone = combineLatest([\n        this.zones,\n        this.selected,\n    ]).pipe(map(([zones, id]) => zones.find((item) => item.id === id)));\n\n    public readonly triggers = this.selected.pipe(\n        switchMap((id) => listZoneTriggers(id)),\n        map((_) => _.data),\n        tap((_) => setTimeout(() => (this.switching = false), 100)),\n        shareReplay(1),\n    );\n\n    public readonly active_trigger = combineLatest([\n        this.triggers,\n        this.selected_trigger,\n    ]).pipe(map(([list, id]) => list.find((item) => item.id === id)));\n\n    public readonly playlists = combineLatest([\n        this.active_zone,\n        this.active_trigger,\n        this._state.playlists,\n        this._state.has_changed,\n    ]).pipe(\n        map(([zone, trigger, playlists]) =>\n            playlists.filter(\n                (_) => !(trigger || zone)?.playlists.find((id) => _.id === id),\n            ),\n        ),\n    );\n\n    constructor(\n        private _state: SignageStateService,\n        private _route: ActivatedRoute,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                this.switching =\n                    params.get('zone') !== this.selected.getValue();\n                this.selected.next(params.get('zone') || '');\n                this.selected_trigger.next(params.get('trigger') || '');\n            }),\n        );\n    }\n\n    public async addPlaylist(playlist: SignagePlaylist) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const playlists = [...item.playlists, playlist.id];\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(\n            item.id,\n            { playlists, version: zone.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully added playlist to the ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const playlists = item.filter((id) => playlist.id !== id);\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(\n            item.id,\n            { playlists, version: zone.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully removed playlist from ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async drop(event: CdkDragDrop<SignagePlaylist[]>) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const old_playlist = item.playlists;\n        const playlists = [...old_playlist];\n        moveItemInArray(playlists, event.previousIndex, event.currentIndex);\n        (item as any).playlists = playlists;\n        this._state.changed();\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(item.id, { playlists, version: zone.version }, 'patch')\n            .toPromise()\n            .catch((e) => {\n                (item as any).playlists = old_playlist;\n                this._state.changed();\n                throw e;\n            });\n        notifySuccess(\n            `Successfully re-ordered playlists on ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule, Route } from '@angular/router';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\n\nimport { UIModule } from '../ui/ui.module';\nimport { SignageComponent } from './signage.component';\nimport { SignageTopbarComponent } from './signage-topbar.component';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { SignageMediaComponent } from './signage-media.component';\nimport { SignageMediaPreviewModalComponent } from './signage-media-preview-modal.component';\nimport { ComponentsModule } from '@placeos/components';\nimport { SignagePlaylistModalComponent } from './signage-playlist-modal.component';\nimport { SignagePlaylistMediaListComponent } from './signage-playlist-media-list.component';\nimport { SignageMediaListComponent } from './signage-media-list.component';\nimport { SignageDisplaysComponent } from './signage-displays.component';\nimport { SearchOverlayComponent } from './search-overlay.component';\nimport { SignageZonesComponent } from './signage-zones.component';\nimport { SignageItemPlaylistsComponent } from './signage-item-playlists.component';\nimport { SignageMediaModalComponent } from './signage-media-modal.component';\nimport { SignageDisplayModalComponent } from './signage-display-modal.component';\n\nconst ROUTES: Route[] = [\n    {\n        path: '',\n        component: SignageComponent,\n        children: [\n            { path: '', redirectTo: 'media', pathMatch: 'full' },\n            { path: 'media', component: SignageMediaComponent },\n            { path: 'displays', component: SignageDisplaysComponent },\n            { path: 'zones', component: SignageZonesComponent },\n            { path: '*', redirectTo: 'media', pathMatch: 'full' },\n        ],\n    },\n];\n\nexport const COMPONENTS: Type<any>[] = [\n    SignageComponent,\n    SignageTopbarComponent,\n    SignageMediaComponent,\n    SignageMediaModalComponent,\n    SignageMediaPreviewModalComponent,\n    SignagePlaylistModalComponent,\n    SignageMediaListComponent,\n    SignagePlaylistMediaListComponent,\n\n    SignageDisplaysComponent,\n    SignageDisplayModalComponent,\n    SignageZonesComponent,\n    SearchOverlayComponent,\n    SignageItemPlaylistsComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        UIModule,\n        ComponentsModule,\n        RouterModule.forChild(ROUTES),\n        MatTabsModule,\n        DragDropModule,\n    ],\n})\nexport class SignageModule {}\n"],"x_google_ignoreList":[]}