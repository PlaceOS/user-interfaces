{"version":3,"file":"apps_concierge_src_app_signage_signage_module_ts.js","mappings":"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","names":["i0","ctx_r0","resource","toString","SignageMediaPreviewModalComponent_main_6_img_2_Template","SignageMediaPreviewModalComponent_main_6_video_3_Template","type","_r2","save","emit","loading","SignageMediaPreviewModalComponent","constructor","_data","this","EventEmitter","url","name","file","can_save","static","__ngFactoryType__","MAT_DIALOG_DATA","core","VBU","selectors","outputs","decls","vars","consts","template","rf","ctx","SignageMediaPreviewModalComponent_main_6_Template","SignageMediaPreviewModalComponent_footer_7_Template","SignageMediaPreviewModalComponent_ng_template_8_Template","load_state_r3","form","value","default_duration","valid_from","savePlaylist","SignagePlaylistModalComponent","_state","_dialog","_dialog_ref","playlist","media","search","BehaviorSubject","FormGroup","id","FormControl","Validators","required","description","default_animation","MediaAnimation","Cut","orientation","enabled","random","Math","max","valid_until","_this","_asyncToGenerator","markAllAsTouched","updateValueAndValidity","invalid","form_value","getRawValue","result","getUnixTime","catch","_","notifyError","close","i1","i2","viewQuery","SignagePlaylistModalComponent_button_3_Template","SignagePlaylistModalComponent_main_4_Template","SignagePlaylistModalComponent_footer_5_Template","SignagePlaylistModalComponent_ng_template_6_Template","ctx_r1","start_time","item","video_length","play_time","_r1","preview","SignageMediaModalComponent_main_4_Conditional_12_Template","SignageMediaModalComponent_main_4_Conditional_17_Template","SignageMediaModalComponent_main_4_Conditional_18_Template","thumbnail","media_type","_r3","saveMedia","SignageMediaModalComponent","includes","media_url","_file_url","URL","createObjectURL","file_thumbnail","thumbnail_url","animation","Default","startOfDay","Date","now","valueOf","addYears","endOfDay","patchValue","file_metadata","floor","ngOnDestroy","revokeObjectURL","valid","disableClose","new_media","onError","e","updateSignageMedia","toPromise","onAdd","notifySuccess","SignageMediaModalComponent_button_3_Template","SignageMediaModalComponent_main_4_Template","SignageMediaModalComponent_footer_5_Template","SignageMediaModalComponent_ng_template_6_Template","load_state_r4","SignageStateService","AsyncHandler","changed","_change","next","_org","_settings","super","_loading","_active_upload","asObservable","has_changed","combineLatest","active_building","pipe","filter","debounceTime","switchMap","bld","querySignageMedia","limit","map","data","sort","a","b","created_at","shareReplay","playlists","querySignagePlaylists","localeCompare","displays","active_region","region","querySystems","zone_id","get","signage","display_name","zones","queryZones","catchError","of","editPlaylist","SignagePlaylist","Promise","resolve","open","afterClosed","subscribe","timeout","editMedia","SignageMedia","playlist_id","_ref","_getMediaMetadata","_generateThumbnail","f","m","addMedia","previewMedia","_x","apply","arguments","_this2","updateSignagePlaylist","addSignagePlaylist","removePlaylist","_this3","openConfirmModal","title","content","icon","reason","removeSignagePlaylist","updatePlaylistMedia","list","updateSignagePlaylistMedia","previewFileFromInput","event","element","target","files","length","undefined","previewFileMedia","_this4","ref","componentInstance","new_media_list","listSignagePlaylistMedia","items","media_item","_this5","upload","reject","state","resolved","uploadFile","s","link","is_landscape","thumbnail_image","dataURLtoFile","dataURL","filename","prefix","split","mimeType","byteString","atob","arrayBuffer","ArrayBuffer","uint8Array","Uint8Array","i","charCodeAt","File","media_id","media_uri","thumbnail_id","key","addSignageMedia","updateMedia","removeMedia","_this6","removeSignageMedia","video","document","createElement","src","addEventListener","videoWidth","videoHeight","duration","load","img","Image","onload","width","height","max_width","max_height","_this7","console","log","_generateVideoThumbnail","_generateImageThumbnail","image","_generateThumbnailFromResource","onerror","autoplay","muted","onloadeddata","source_width","source_height","canvas","getContext","thumbnailWidth","thumbnailHeight","aspectRatio","drawImage","toDataURL","i3","jDH","factory","fac","providedIn","newItem","active_link","singular","link_r4","$implicit","SignageComponent","_router","navigate","query","links","previewFile","ngOnInit","subscription","events","NavigationEnd","find","toLowerCase","features","attrs","_c0","SignageComponent_button_7_Template","SignageComponent_For_11_Template","tabPanel_r5","SignageTopbarComponent","_route","levels","active_levels","initialised","first","queryParamMap","params","has","level","levelWithID","building","buildings","parent_id","zone","lvl","push","media_r4","SignageMediaListComponent_Conditional_5_For_3_Conditional_1_Template","SignageMediaListComponent_Conditional_5_For_3_Conditional_2_Template","SignageMediaListComponent_Conditional_5_For_3_div_3_Template","SignageMediaListComponent_Conditional_5_For_3_img_5_Template","SignageMediaListComponent_Conditional_5_For_3_div_8_Template","editItem","previewItem","removeItem","menu_r5","$event","drop","SignageMediaListComponent_Conditional_5_For_3_Template","_forTrack0","playlist_ids","SignageMediaListComponent","startOfMinute","playlist_count","ngOnChanges","changes","Array","fill","idx","inputs","SignageMediaListComponent_Conditional_5_Template","SignageMediaListComponent_Conditional_7_Template","getValue","tmp_1_0","SignagePlaylistMediaListComponent_Conditional_47_ng_container_2_Conditional_2_Template","SignagePlaylistMediaListComponent_Conditional_47_ng_container_2_Conditional_3_Template","SignagePlaylistMediaListComponent_Conditional_47_ng_container_2_div_4_Template","item_r5","_r4","ctx_r2","menu_r6","SignagePlaylistMediaListComponent_Conditional_47_ng_container_2_Template","SignagePlaylistMediaListComponent","_playlist","selected_playlist","take","_ref2","_playlist_media","startWith","animation_name","CrossFade","SlideBottom","SlideLeft","SlideRight","SlideTop","previousIndex","currentIndex","moveItemInArray","SignagePlaylistMediaListComponent_div_29_Template","SignagePlaylistMediaListComponent_Conditional_47_Template","SignagePlaylistMediaListComponent_Conditional_49_Template","menu_r7","tmp_3_0","tmp_4_0","tmp_5_0","tmp_6_0","tmp_7_0","tmp_8_0","tmp_9_0","tmp_10_0","tmp_11_0","playlist_r2","_c2","$index_r4","_c3","SignageMediaComponent_Conditional_9_For_1_Template","_r5","addPlaylist","SignageMediaComponent_Conditional_11_button_5_Template","tmp_2_0","_r6","hideOverlay","SignageMediaComponent","onEnter","clearTimeout","show_dropzone","dataTransfer","types","HTMLInputElement","preventDefault","previousContainer","SignageMediaComponent_Conditional_9_Template","SignageMediaComponent_Conditional_11_Template","SignageMediaComponent_signage_media_list_14_Template","SignageMediaComponent_signage_playlist_media_list_15_Template","SignageMediaComponent_div_16_Template","_c1","SearchOverlayComponent_For_8_Conditional_1_ng_container_0_Template","result_template","item_r2","selected","SearchOverlayComponent_For_8_Conditional_1_Template","SearchOverlayComponent_For_8_Conditional_2_Template","SearchOverlayComponent","item_list","_items","stopPropagation","SearchOverlayComponent_For_8_Template","SearchOverlayComponent_Conditional_9_Template","extra","SignageItemPlaylistsComponent_Conditional_6_For_2_div_1_Template","item_r4","remove","media_count","ondrop","SignageItemPlaylistsComponent_Conditional_6_For_2_Template","add","active_playlists","SignageItemPlaylistsComponent","_playlist_ids","ids","ngContentSelectors","SignageItemPlaylistsComponent_div_3_Template","SignageItemPlaylistsComponent_a_4_Template","SignageItemPlaylistsComponent_Conditional_6_Template","SignageItemPlaylistsComponent_Conditional_8_Template","selected_trigger","trigger_r1","display_r2","SignageDisplaysComponent_Conditional_6_For_2_Conditional_2_For_1_Template","triggers","SignageDisplaysComponent_Conditional_6_For_2_Conditional_2_Template","tmp_16_0","active_display","switching","SignageDisplaysComponent_Conditional_6_For_2_Template","_c4","zone_r5","tmp_14_0","SignageDisplaysComponent_Conditional_10_div_7_For_2_Template","adding","SignageDisplaysComponent_Conditional_10_div_7_Template","active_trigger","signage_path","SignageDisplaysComponent","listSystemTriggers","tap","setTimeout","sys_id","control_system_id","display","trigger","updateTrigger","updateSystem","version","old_playlist","SignageDisplaysComponent_Conditional_6_Template","SignageDisplaysComponent_Conditional_8_Template","SignageDisplaysComponent_Conditional_10_Template","SignageDisplaysComponent_Conditional_12_Template","SignageDisplaysComponent_search_overlay_13_Template","zone_r2","SignageZonesComponent_Conditional_6_For_2_Conditional_2_For_1_Template","SignageZonesComponent_Conditional_6_For_2_Conditional_2_Template","active_zone","SignageZonesComponent_Conditional_6_For_2_Template","SignageZonesComponent","listZoneTriggers","updateZone","SignageZonesComponent_Conditional_6_Template","SignageZonesComponent_Conditional_8_Template","SignageZonesComponent_Conditional_10_Template","SignageZonesComponent_Conditional_12_Template","SignageZonesComponent_search_overlay_13_Template","ROUTES","path","component","children","redirectTo","pathMatch","COMPONENTS","SignageModule","$C","G2t","CommonModule","FormsModule","UIModule","ComponentsModule","RouterModule","forChild","MatTabsModule","DragDropModule"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./apps/concierge/src/app/signage/signage-media-preview-modal.component.ts","./apps/concierge/src/app/signage/signage-playlist-modal.component.ts","./apps/concierge/src/app/signage/signage-media-modal.component.ts","./apps/concierge/src/app/signage/signage-state.service.ts","./apps/concierge/src/app/signage/signage.component.ts","./apps/concierge/src/app/signage/signage-topbar.component.ts","./apps/concierge/src/app/signage/signage-media-list.component.ts","./apps/concierge/src/app/signage/signage-playlist-media-list.component.ts","./apps/concierge/src/app/signage/signage-media.component.ts","./apps/concierge/src/app/signage/search-overlay.component.ts","./apps/concierge/src/app/signage/signage-item-playlists.component.ts","./apps/concierge/src/app/signage/signage-displays.component.ts","./apps/concierge/src/app/signage/signage-zones.component.ts","./apps/concierge/src/app/signage/signage.module.ts"],"sourcesContent":["import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\n@Component({\n    selector: 'signage-media-preview-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between p-2 border-b border-base-300\"\n        >\n            <h1 class=\"px-2\">Preview - {{ name }}</h1>\n            <button icon matRipple mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main class=\"bg-base-200\" *ngIf=\"!loading; else load_state\">\n            <div\n                class=\"max-w-[80vw] max-h-[65vh] w-[80vw] h-[65vh] flex items-center justify-center\"\n            >\n                <img\n                    *ngIf=\"type === 'image'\"\n                    class=\"w-full h-full object-contain object-center\"\n                    auth\n                    [source]=\"resource.toString()\"\n                />\n                <video\n                    *ngIf=\"type === 'video'\"\n                    class=\"w-full h-full object-contain object-center\"\n                    auth\n                    [source]=\"resource.toString()\"\n                    autoplay\n                    controls\n                ></video>\n            </div>\n        </main>\n        <footer\n            *ngIf=\"can_save && !loading\"\n            class=\"p-2 flex items-center justify-end space-x-2 border-t border-base-300\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"save.emit()\">\n                Save Media\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main\n                class=\"flex flex-col items-center justify-center p-8 w-[28rem] h-[20rem] max-w-[80vw] max-h-[65vh]\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignageMediaPreviewModalComponent {\n    @Output() public readonly save = new EventEmitter<any>();\n    public loading = '';\n    public readonly resource = this._data.url;\n    public readonly type = this._data.type;\n    public readonly name = this._data.name;\n    public readonly file = this._data.file;\n    public readonly can_save = this._data.save !== false;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: {\n            url: URL;\n            type: 'image' | 'video';\n            save: boolean;\n            name: string;\n            file?: File;\n        },\n    ) {}\n}\n","import {\n    MAT_DIALOG_DATA,\n    MatDialog,\n    MatDialogRef,\n} from '@angular/material/dialog';\nimport { SignageStateService } from './signage-state.service';\nimport { Component, ElementRef, Inject, ViewChild } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\nimport { notifyError } from '@placeos/common';\nimport { MediaAnimation } from '@placeos/ts-client/dist/esm/signage/media.class';\nimport { SignagePlaylist } from '@placeos/ts-client';\nimport { addYears, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\n@Component({\n    selector: 'signage-playlist-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between border-b border-base-300\"\n        >\n            <h1 class=\"p-2 font-medium text-xl\">\n                {{ playlist.id ? 'Edit' : 'New' }} Playlist\n            </h1>\n            <button icon matRipple mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            [formGroup]=\"form\"\n            class=\"p-4 flex flex-col w-[32rem] max-w-[calc(100vw-2rem)]\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <label for=\"name\">Name<span required>*</span></label>\n            <mat-form-field appearance=\"outline\" class=\"w-full\">\n                <input\n                    matInput\n                    name=\"name\"\n                    placeholder=\"Name\"\n                    formControlName=\"name\"\n                />\n                <mat-error>Name is required</mat-error>\n            </mat-form-field>\n            <div class=\"flex items-center space-x-8 mb-4\">\n                <mat-checkbox formControlName=\"enabled\">Enabled</mat-checkbox>\n                <mat-checkbox formControlName=\"random\">\n                    Shuffle Playback\n                </mat-checkbox>\n            </div>\n            <div class=\"flex items-center space-x-4\">\n                <label\n                    for=\"default-duration\"\n                    class=\"w-auto min-w-0 m-0 space-x-2 flex items-center\"\n                >\n                    <div>Default Play Time</div>\n                    <app-icon\n                        class=\"text-xl\"\n                        matTooltip=\"Default length of time to hold images on screen\"\n                    >\n                        info\n                    </app-icon>\n                </label>\n                <div class=\"text-xs font-mono\">\n                    {{ form.value.default_duration / 1000 | mediaDuration }}\n                </div>\n            </div>\n            <mat-slider min=\"5000\" max=\"300000\" step=\"1000\">\n                <input\n                    name=\"default-duration\"\n                    matSliderThumb\n                    formControlName=\"default_duration\"\n                />\n            </mat-slider>\n            <div class=\"flex space-x-2\">\n                <div class=\"flex-1\">\n                    <label for=\"orientation\">Orientation</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"orientation\"\n                            formControlName=\"orientation\"\n                            placeholder=\"Unspecified\"\n                        >\n                            <mat-option value=\"unspecified\">\n                                Unspecified\n                            </mat-option>\n                            <mat-option value=\"landscape\">Landscape</mat-option>\n                            <mat-option value=\"portrait\">Portrait</mat-option>\n                            <mat-option value=\"square\">Square</mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex-1\">\n                    <label for=\"animation\">Animation</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"animation\"\n                            formControlName=\"default_animation\"\n                            placeholder=\"Playlist Default\"\n                        >\n                            <mat-option [value]=\"1\">Cut</mat-option>\n                            <mat-option [value]=\"2\">Cross Fade</mat-option>\n                            <mat-option [value]=\"3\">Slide Top</mat-option>\n                            <mat-option [value]=\"4\">Slide Left</mat-option>\n                            <mat-option [value]=\"5\">Slide Right</mat-option>\n                            <mat-option [value]=\"6\">Slide Bottom</mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n            </div>\n            <label for=\"description\">Description</label>\n            <mat-form-field appearance=\"outline\" class=\"w-full\">\n                <textarea\n                    matInput\n                    name=\"description\"\n                    placeholder=\"Description\"\n                    formControlName=\"description\"\n                    class=\"min-h-32\"\n                ></textarea>\n            </mat-form-field>\n            <div class=\"flex space-x-4\">\n                <div class=\"flex-1\">\n                    <label for=\"valid-from\">Valid From</label>\n                    <a-date-field\n                        name=\"valid-from\"\n                        formControlName=\"valid_from\"\n                    ></a-date-field>\n                </div>\n                <div class=\"flex-1\">\n                    <label for=\"valid-until\">Valid Until</label>\n                    <a-date-field\n                        name=\"valid-until\"\n                        [from]=\"form.value.valid_from\"\n                        formControlName=\"valid_until\"\n                        [disabled]=\"!form.value.valid_from\"\n                    ></a-date-field>\n                </div>\n            </div>\n        </main>\n        <footer\n            class=\"p-4 flex items-center justify-end space-x-2 border-t border-base-300\"\n            *ngIf=\"!loading\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"savePlaylist()\">\n                Save Playlist\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main class=\"flex flex-col items-center justify-center p-8\">\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"mt-4\">Saving Playlist...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignagePlaylistModalComponent {\n    public loading = false;\n    public readonly playlist = this._data;\n    public readonly media = this._state.media;\n\n    public readonly search = new BehaviorSubject('');\n\n    public readonly form = new FormGroup({\n        id: new FormControl(this.playlist.id || ''),\n        name: new FormControl(this.playlist.name || '', [Validators.required]),\n        description: new FormControl(this.playlist.description || ''),\n        default_animation: new FormControl<MediaAnimation>(\n            this.playlist.default_animation || MediaAnimation.Cut,\n        ),\n        orientation: new FormControl(\n            this.playlist.orientation || 'unspecified',\n        ),\n        enabled: new FormControl(this.playlist.enabled),\n        random: new FormControl(this.playlist.random),\n        default_duration: new FormControl(\n            Math.max(this.playlist.default_duration || 15 * 1000, 5000),\n        ),\n        valid_from: new FormControl(this.playlist.valid_from * 1000),\n        valid_until: new FormControl(this.playlist.valid_until * 1000),\n    });\n\n    @ViewChild('search_input')\n    public search_input: ElementRef<HTMLInputElement>;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: SignagePlaylist = {} as any,\n        private _state: SignageStateService,\n        private _dialog: MatDialog,\n        private _dialog_ref: MatDialogRef<SignagePlaylistModalComponent>,\n    ) {}\n\n    public async savePlaylist() {\n        this.form.markAllAsTouched();\n        this.form.updateValueAndValidity();\n        if (this.form.invalid) return;\n        this.loading = true;\n        const form_value = this.form.getRawValue();\n        const result = await this._state\n            .savePlaylist({\n                ...form_value,\n                valid_from: getUnixTime(form_value.valid_from),\n                valid_until: getUnixTime(form_value.valid_until),\n            })\n            .catch((_) => {\n                notifyError('Error saving playlist');\n                this.loading = false;\n                throw _;\n            });\n        this._dialog_ref.close(result);\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { notifySuccess } from '@placeos/common';\nimport { SignageMedia, updateSignageMedia } from '@placeos/ts-client';\nimport { MediaAnimation } from '@placeos/ts-client/dist/esm/signage/media.class';\nimport { addYears, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\n@Component({\n    selector: 'signage-media-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between border-b border-base-300\"\n        >\n            <h2 class=\"p-2 text-xl font-medium\">\n                {{ item.id ? 'Edit' : 'New' }} Media Item\n            </h2>\n            <button icon matRipple mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"p-4 max-w-[calc(100vw-2rem)] w-[32rem] max-h-[65vh] overflow-auto\"\n            [formGroup]=\"form\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <div class=\"flex flex-col\">\n                <button\n                    matRipple\n                    class=\"relative w-full h-48 mx-auto bg-base-300 rounded-xl overflow-hidden mb-4\"\n                    (click)=\"preview()\"\n                >\n                    <img\n                        class=\"h-full w-full object-contain object-center\"\n                        auth\n                        [source]=\"thumbnail || url\"\n                    />\n                    <div\n                        class=\"absolute top-2 left-2 px-2 py-1 rounded text-xs bg-base-400 capitalize\"\n                    >\n                        {{ media_type }}\n                    </div>\n                </button>\n                <label for=\"name\">Name</label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        formControlName=\"name\"\n                        placeholder=\"Media Name\"\n                    />\n                    <mat-error>A name is required</mat-error>\n                </mat-form-field>\n                @if (media_type === 'video') {\n                    <div class=\"flex items-center space-x-4\">\n                        <label for=\"start-time\" class=\"w-auto min-w-0 m-0\"\n                            >Start Time</label\n                        >\n                        <div class=\"text-xs font-mono\">\n                            {{\n                                form.value.start_time / 1000\n                                    | mediaDuration: true\n                            }}\n                        </div>\n                    </div>\n                    <mat-slider\n                        min=\"0\"\n                        [max]=\"(item.video_length || 300000) - 1000\"\n                        step=\"100\"\n                    >\n                        <input\n                            name=\"start-time\"\n                            matSliderThumb\n                            formControlName=\"start_time\"\n                        />\n                    </mat-slider>\n                }\n                <div class=\"flex items-center space-x-4\">\n                    <label for=\"play-time\" class=\"w-auto min-w-0 m-0\">\n                        Play Time</label\n                    >\n                    <div class=\"text-xs font-mono\">\n                        @if (form.value.play_time) {\n                            {{\n                                form.value.play_time / 1000\n                                    | mediaDuration: true\n                            }}\n                        } @else {\n                            <span class=\"opacity-30\">\n                                Default ({{\n                                    item.video_length\n                                        ? (item.video_length / 1000\n                                          | mediaDuration)\n                                        : ''\n                                }})\n                            </span>\n                        }\n                    </div>\n                </div>\n                <mat-slider\n                    [min]=\"form.value.start_time\"\n                    [max]=\"item.video_length || 300000\"\n                    step=\"100\"\n                >\n                    <input\n                        name=\"play-time\"\n                        matSliderThumb\n                        formControlName=\"play_time\"\n                    />\n                </mat-slider>\n                <label for=\"animation\">Animation</label>\n                <mat-form-field appearance=\"outline\">\n                    <mat-select\n                        name=\"animation\"\n                        formControlName=\"animation\"\n                        placeholder=\"Playlist Default\"\n                    >\n                        <mat-option [value]=\"0\">Playlist Default</mat-option>\n                        <mat-option [value]=\"1\">Cut</mat-option>\n                        <mat-option [value]=\"2\">Cross Fade</mat-option>\n                        <mat-option [value]=\"3\">Slide Top</mat-option>\n                        <mat-option [value]=\"4\">Slide Left</mat-option>\n                        <mat-option [value]=\"5\">Slide Right</mat-option>\n                        <mat-option [value]=\"6\">Slide Bottom</mat-option>\n                    </mat-select>\n                </mat-form-field>\n                <label for=\"description\">Description</label>\n                <mat-form-field appearance=\"outline\" class=\"w-full\">\n                    <textarea\n                        matInput\n                        name=\"description\"\n                        placeholder=\"Description\"\n                        formControlName=\"description\"\n                        class=\"min-h-32\"\n                    ></textarea>\n                </mat-form-field>\n                <div class=\"flex space-x-4\">\n                    <div class=\"flex-1\">\n                        <label for=\"valid-from\">Valid From</label>\n                        <a-date-field\n                            name=\"valid-from\"\n                            formControlName=\"valid_from\"\n                        ></a-date-field>\n                    </div>\n                    <div class=\"flex-1\">\n                        <label for=\"valid-until\">Valid Until</label>\n                        <a-date-field\n                            name=\"valid-until\"\n                            [from]=\"form.value.valid_from\"\n                            formControlName=\"valid_until\"\n                        ></a-date-field>\n                    </div>\n                </div>\n            </div>\n        </main>\n        <footer\n            *ngIf=\"!loading\"\n            class=\"flex justify-end p-4 border-t border-base-300\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"saveMedia()\">\n                Save\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main\n                class=\"flex flex-col items-center justify-center p-8 max-w-[calc(100vw-2rem)] min-h-64 w-[32rem] space-y-4\"\n            >\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving media item...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignageMediaModalComponent {\n    public loading = false;\n    public readonly item = this._data.media;\n    public readonly file = this._data.file;\n    public readonly thumbnail =\n        this._data.file_thumbnail || this._data.media.thumbnail_url;\n\n    public readonly form = new FormGroup({\n        name: new FormControl('', [Validators.required]),\n        description: new FormControl(''),\n        animation: new FormControl<MediaAnimation>(MediaAnimation.Default),\n        start_time: new FormControl(0),\n        play_time: new FormControl<number | null>(null),\n        valid_from: new FormControl(startOfDay(Date.now()).valueOf()),\n        valid_until: new FormControl(\n            addYears(endOfDay(Date.now()), 10).valueOf(),\n        ),\n    });\n\n    private _file_url: string;\n\n    public readonly preview = () =>\n        this._data.preview({\n            media_url: this.url,\n            media_type: this.media_type,\n            name: this.form.value.name,\n        });\n\n    public get media_type() {\n        if (!this.file) return this.item.media_type;\n        return (\n            (this.file.type.includes('video')\n                ? 'video'\n                : this.file.type.includes('image')\n                  ? 'image'\n                  : '') || this.item.media_type\n        );\n    }\n\n    public get url() {\n        if (this.item.id) return this.item.media_url;\n        if (this._file_url) return this._file_url;\n        this._file_url = URL.createObjectURL(this.file);\n        return this._file_url;\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: {\n            media: SignageMedia;\n            file?: File;\n            file_metadata?: [boolean, number];\n            file_thumbnail?: string;\n            onAdd: (f, m) => Promise<SignageMedia>;\n            preview: (url) => void;\n        },\n        private _dialog_ref: MatDialogRef<SignageMediaModalComponent>,\n    ) {\n        this.form.patchValue({\n            ...this._data.media,\n            valid_from: this._data.media.valid_from * 1000,\n            valid_until: this._data.media.valid_until * 1000,\n        });\n        if (this._data.file) {\n            this.form.patchValue({\n                name: this._data.file.name,\n            });\n        }\n        if (this._data.file_metadata) {\n            (this.item as any).video_length = Math.floor(\n                this._data.file_metadata[1] * 1000,\n            );\n        }\n    }\n\n    public ngOnDestroy() {\n        if (this._file_url) URL.revokeObjectURL(this._file_url);\n    }\n\n    public async saveMedia() {\n        this.form.markAllAsTouched();\n        this.form.updateValueAndValidity();\n        if (!this.form.valid) return;\n        this.loading = true;\n        this._dialog_ref.disableClose = true;\n        const form_value = this.form.getRawValue();\n        const new_media = {\n            ...this.item,\n            ...form_value,\n            valid_from: getUnixTime(new Date(form_value.valid_from)),\n            valid_until: getUnixTime(form_value.valid_until),\n        };\n        const onError = (e) => {\n            this._dialog_ref.disableClose = false;\n            this.loading = false;\n            throw e;\n        };\n        if (this.item.id) {\n            await updateSignageMedia(this.item.id, new_media)\n                .toPromise()\n                .catch(onError);\n        } else {\n            await this._data.onAdd(this.file, new_media).catch(onError);\n        }\n        this._dialog_ref.disableClose = false;\n        this._dialog_ref.close();\n        notifySuccess('Successfully saved media item.');\n    }\n}\n","import { Injectable } from '@angular/core';\nimport {\n    AsyncHandler,\n    notifyError,\n    notifySuccess,\n    openConfirmModal,\n    SettingsService,\n    uploadFile,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport {\n    addSignageMedia,\n    addSignagePlaylist,\n    listSignagePlaylistMedia,\n    PlaceSystem,\n    querySignageMedia,\n    querySignagePlaylists,\n    querySystems,\n    queryZones,\n    removeSignageMedia,\n    removeSignagePlaylist,\n    SignageMedia,\n    SignagePlaylist,\n    updateSignageMedia,\n    updateSignagePlaylist,\n    updateSignagePlaylistMedia,\n} from '@placeos/ts-client';\nimport { Attachment } from '@placeos/users';\nimport { BehaviorSubject, Observable, combineLatest, of } from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    filter,\n    map,\n    shareReplay,\n    switchMap,\n} from 'rxjs/operators';\n\nimport { MatDialog } from '@angular/material/dialog';\nimport { SignageMediaPreviewModalComponent } from './signage-media-preview-modal.component';\nimport { SignagePlaylistModalComponent } from './signage-playlist-modal.component';\nimport { SignageMediaModalComponent } from './signage-media-modal.component';\n\nfunction dataURLtoBlob(dataURL) {\n    // Split the data URL to get the mime type and the data\n    const [prefix, data] = dataURL.split(',');\n    const mimeType = prefix.split(':')[1].split(';')[0];\n\n    // Convert base64 to raw binary data\n    const byteString = atob(data);\n\n    // Create an ArrayBuffer and fill it with the binary data\n    const arrayBuffer = new ArrayBuffer(byteString.length);\n    const uint8Array = new Uint8Array(arrayBuffer);\n    for (let i = 0; i < byteString.length; i++) {\n        uint8Array[i] = byteString.charCodeAt(i);\n    }\n\n    // Create and return the Blob\n    return new Blob([arrayBuffer], { type: mimeType });\n}\n\nfunction dataURLtoFile(dataURL, filename) {\n    // Split the data URL to get the mime type and the data\n    const [prefix, data] = dataURL.split(',');\n    const mimeType = prefix.split(':')[1].split(';')[0];\n\n    // Convert base64 to raw binary data\n    const byteString = atob(data);\n\n    // Create an ArrayBuffer and fill it with the binary data\n    const arrayBuffer = new ArrayBuffer(byteString.length);\n    const uint8Array = new Uint8Array(arrayBuffer);\n    for (let i = 0; i < byteString.length; i++) {\n        uint8Array[i] = byteString.charCodeAt(i);\n    }\n\n    // Create and return the File\n    return new File([uint8Array], filename, { type: mimeType });\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SignageStateService extends AsyncHandler {\n    private _loading = new BehaviorSubject(false);\n    private _change = new BehaviorSubject(0);\n    private _active_upload = new BehaviorSubject<Attachment>(null);\n\n    public readonly loading = this._loading.asObservable();\n    public readonly has_changed = this._change.asObservable();\n\n    public readonly media: Observable<SignageMedia[]> = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([_]) => !!_?.id),\n        debounceTime(300),\n        switchMap(([bld]) => querySignageMedia({ limit: 2500 } as any)),\n        map((_) => _.data.sort((a, b) => b.created_at - a.created_at)),\n        shareReplay(1),\n    );\n\n    public readonly playlists: Observable<SignagePlaylist[]> = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([_]) => !!_?.id),\n        debounceTime(300),\n        switchMap(() => querySignagePlaylists({ limit: 500 } as any)),\n        map((_) => (_.data || []).sort((a, b) => a.name.localeCompare(b.name))),\n        shareReplay(1),\n    );\n\n    public readonly displays: Observable<PlaceSystem[]> = combineLatest([\n        this._org.active_region,\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([region, bld]) => !!bld?.id),\n        switchMap(([region, bld]) =>\n            querySystems({\n                zone_id:\n                    (this._settings.get('app.use_region') ? region?.id : '') ||\n                    bld?.id,\n                limit: 500,\n                signage: true,\n            }).pipe(\n                map((_) =>\n                    (_.data || []).sort((a, b) =>\n                        (a.display_name || a.name).localeCompare(\n                            b.display_name || b.name,\n                        ),\n                    ),\n                ),\n            ),\n        ),\n        shareReplay(1),\n    );\n\n    public readonly zones = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        switchMap(([bld]) =>\n            queryZones({\n                limit: 250,\n            } as any).pipe(catchError(() => of({ data: [] }))),\n        ),\n        map((_) =>\n            (_.data || []).sort((a, b) =>\n                (a.display_name || a.name).localeCompare(\n                    b.display_name || b.name,\n                ),\n            ),\n        ),\n    );\n\n    public changed() {\n        this._change.next(Date.now());\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _dialog: MatDialog,\n        private _settings: SettingsService,\n    ) {\n        super();\n    }\n\n    public editPlaylist(playlist: SignagePlaylist = new SignagePlaylist({})) {\n        return new Promise<SignagePlaylist | null>((resolve) => {\n            const ref = this._dialog.open(SignagePlaylistModalComponent, {\n                data: playlist,\n            });\n            ref.afterClosed().subscribe((result) => {\n                this.timeout('changed', () => this._change.next(Date.now()));\n                resolve(result);\n            });\n        });\n    }\n\n    public editMedia(\n        media: SignageMedia = new SignageMedia({}),\n        file?: File,\n        playlist_id: string = '',\n    ) {\n        return new Promise<SignagePlaylist | null>(async (resolve) => {\n            const ref = this._dialog.open(SignageMediaModalComponent, {\n                data: {\n                    media,\n                    file,\n                    file_metadata: file\n                        ? await this._getMediaMetadata(file)\n                        : [media.orientation === 'landscape', 0],\n                    file_thumbnail: file\n                        ? await this._generateThumbnail(file, 1024, 720)\n                        : '',\n                    playlist_id,\n                    onAdd: (f, m) => this.addMedia(f, m),\n                    preview: (item) => this.previewMedia(item),\n                },\n            });\n            ref.afterClosed().subscribe((result) => {\n                this.timeout('changed', () => this._change.next(Date.now()));\n                resolve(result);\n            });\n        });\n    }\n\n    public async savePlaylist(playlist: Partial<SignagePlaylist>) {\n        const call = playlist.id\n            ? updateSignagePlaylist(playlist.id, playlist)\n            : addSignagePlaylist(playlist);\n        const new_playlist = await call.toPromise();\n        notifySuccess(`Successfully saved playlist.`);\n        this._change.next(Date.now());\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        if (!playlist?.id) return;\n        const result = await openConfirmModal(\n            {\n                title: `Remove Playlist`,\n                content: `\n            Are you sure you wish to remove the playlist \"<strong>${playlist.name}</strong>\"?<br/><br/>`,\n                icon: { content: 'delete' },\n            },\n            this._dialog,\n        );\n        if (result.reason !== 'done') return;\n        await removeSignagePlaylist(playlist.id).toPromise();\n        notifySuccess(`Successfully removed playlist.`);\n    }\n\n    public async updatePlaylistMedia(playlist_id: string, list: string[]) {\n        await updateSignagePlaylistMedia(playlist_id, list).toPromise();\n        notifySuccess(`Successfully updated playlist media.`);\n    }\n\n    public previewMedia(item: SignageMedia) {\n        const ref = this._dialog.open(SignageMediaPreviewModalComponent, {\n            data: {\n                url: item.media_url,\n                type: item.media_type,\n                name: item.name,\n                save: false,\n            },\n        });\n    }\n\n    public previewFileFromInput(event, playlist_id: string = '') {\n        const element: HTMLInputElement = event.target as any;\n        /* istanbul ignore else */\n        if (!element?.files?.length) return;\n        const files: FileList = element.files;\n        const file = files[0];\n        if (\n            file &&\n            (file.type.includes('image') || file.type.includes('video'))\n        ) {\n            this.editMedia(undefined, file, playlist_id);\n        } else {\n            notifyError('Invalid file type.');\n        }\n    }\n\n    public previewFileMedia(media: File, playlist_id: string = '') {\n        const url = URL.createObjectURL(media);\n        const type = media.type.includes('image') ? 'image' : 'video';\n        const ref = this._dialog.open(SignageMediaPreviewModalComponent, {\n            data: { url, type, name: media.name, save: true, file: media },\n        });\n        ref.afterClosed().subscribe(() => URL.revokeObjectURL(url));\n        ref.componentInstance.save.subscribe(async () => {\n            ref.componentInstance.loading = 'Saving...';\n            const new_media = await this.addMedia(media).catch((e) => {\n                notifyError('Error saving media.');\n                ref.componentInstance.loading = '';\n                throw e;\n            });\n            if (playlist_id && new_media.id) {\n                const media_list =\n                    await listSignagePlaylistMedia(playlist_id).toPromise();\n                const new_media_list = [...media_list.items, new_media.id];\n                await updateSignagePlaylistMedia(\n                    playlist_id,\n                    new_media_list,\n                ).toPromise();\n            }\n            ref.close();\n        });\n    }\n\n    public async addMedia(\n        file: File,\n        media_item: SignageMedia = new SignageMedia({}),\n    ) {\n        const upload = (file) =>\n            new Promise<{ id: string; link: string }>((resolve, reject) => {\n                let state = null;\n                let resolved = false;\n                uploadFile(file).subscribe(\n                    (s) => {\n                        state = s;\n                        if (s.link) {\n                            resolved = true;\n                            resolve({ id: s.upload.id, link: s.link });\n                        }\n                    },\n                    reject,\n                    () => (!resolved ? resolve(state) : null),\n                );\n            });\n        const [is_landscape, _] = await this._getMediaMetadata(file);\n        const thumbnail_image = await this._generateThumbnail(\n            file,\n            1280,\n            720,\n        ).catch((_) => null);\n        const media = await upload(file);\n        let thumbnail = null;\n        if (thumbnail_image) {\n            thumbnail = await upload(\n                dataURLtoFile(thumbnail_image, `thumb+${file.name}`),\n            );\n        }\n        const data = {\n            ...new SignageMedia({\n                ...media_item,\n                name: media_item.name || file.name,\n                media_id: media.id,\n                media_uri: media.link,\n                media_type: file.type.includes('image') ? 'image' : 'video',\n                orientation: is_landscape ? 'landscape' : 'portrait',\n                thumbnail_id: thumbnail.id,\n            }),\n        };\n        for (const key in data) {\n            if (!data[key]) delete data[key];\n        }\n        const result = await addSignageMedia(data).toPromise();\n        this._active_upload.next(null);\n        this._change.next(Date.now());\n        return result;\n    }\n\n    public async updateMedia(item: SignageMedia) {\n        if (!item?.id) return;\n        await updateSignageMedia(item.id, item).toPromise();\n    }\n\n    public async removeMedia(item: SignageMedia) {\n        if (!item?.id) return;\n        const result = await openConfirmModal(\n            {\n                title: `Remove Media item`,\n                content: `\n                Are you sure you wish to remove the media item \"<strong>${item.name}</strong>\"?<br/><br/>\n                <i class=\"text-sm\">The item will be removed from all playlists and the files deleted from storage.</i>\n                `,\n                icon: { content: 'delete' },\n            },\n            this._dialog,\n        );\n        if (result.reason !== 'done') return;\n        result.loading('Removing media...');\n        await removeSignageMedia(item.id).toPromise();\n        this._change.next(Date.now());\n        result.close();\n    }\n\n    private _getMediaMetadata(file: File) {\n        return new Promise<[boolean, number]>((resolve) => {\n            const url = URL.createObjectURL(file);\n            // file is loaded\n            if (file.type.includes('video')) {\n                let video = document.createElement('video');\n                video.src = url.toString();\n                video.addEventListener('loadedmetadata', () => {\n                    const { videoWidth, videoHeight } = video;\n                    resolve([videoWidth > videoHeight, video.duration]);\n                });\n                video.load();\n            } else {\n                let img = new Image();\n                img.onload = () => resolve([img.width > img.height, 0]);\n                img.src = url.toString(); // is the data URL because called with readAsDataURL\n            }\n        });\n    }\n\n    private async _generateThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        console.log('File:', file, max_width, max_height);\n        if (file.type.includes('video')) {\n            return this._generateVideoThumbnail(file, max_width, max_height);\n        } else {\n            return this._generateImageThumbnail(file, max_width, max_height);\n        }\n    }\n\n    private _generateImageThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        return new Promise<string>((resolve, reject) => {\n            const img = new Image();\n            img.src = URL.createObjectURL(file);\n            console.log('Image:', img.src);\n\n            img.onload = () => {\n                const image = this._generateThumbnailFromResource(\n                    img,\n                    img.width,\n                    img.height,\n                    max_width,\n                    max_height,\n                );\n                URL.revokeObjectURL(img.src);\n                resolve(image);\n            };\n\n            img.onerror = reject;\n        });\n    }\n\n    private _generateVideoThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        return new Promise<string>((resolve, reject) => {\n            // Create video element\n            const video = document.createElement('video');\n            video.autoplay = true;\n            video.muted = true;\n            video.src = URL.createObjectURL(file);\n\n            video.onloadeddata = () => {\n                const image = this._generateThumbnailFromResource(\n                    video,\n                    video.videoWidth,\n                    video.videoHeight,\n                    max_width,\n                    max_height,\n                );\n\n                // Clean up\n                URL.revokeObjectURL(video.src);\n                resolve(image);\n            };\n\n            video.onerror = reject;\n        });\n    }\n\n    private _generateThumbnailFromResource(\n        data,\n        source_width,\n        source_height,\n        max_width: number,\n        max_height: number,\n    ) {\n        // Create canvas element\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n\n        // Calculate thumbnail dimensions\n        let thumbnailWidth = source_width;\n        let thumbnailHeight = source_height;\n        const aspectRatio = thumbnailWidth / thumbnailHeight;\n\n        if (thumbnailWidth > max_width) {\n            thumbnailWidth = max_height;\n            thumbnailHeight = thumbnailWidth / aspectRatio;\n        }\n\n        if (thumbnailHeight > max_height) {\n            thumbnailHeight = max_width;\n            thumbnailWidth = thumbnailHeight * aspectRatio;\n        }\n\n        canvas.width = thumbnailWidth;\n        canvas.height = thumbnailHeight;\n\n        // Draw video frame on canvas\n        ctx.drawImage(data, 0, 0, thumbnailWidth, thumbnailHeight);\n\n        // Convert canvas to data URL\n        const dataURL = canvas.toDataURL('image/jpeg');\n\n        return dataURL;\n    }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport { SignageStateService } from './signage-state.service';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { AsyncHandler } from '@placeos/common';\n\n@Component({\n    selector: '[app-new-staff]',\n    template: `\n        <app-topbar></app-topbar>\n        <div class=\"flex flex-1 h-px\">\n            <app-sidebar></app-sidebar>\n            <main class=\"flex flex-col flex-1 w-1/2 h-full\">\n                <div class=\"p-8 h-28 flex items-center justify-between\">\n                    <h2 class=\"text-2xl font-medium\">\n                        Digital Signage Management\n                    </h2>\n                    <button\n                        btn\n                        matRipple\n                        class=\"w-40\"\n                        *ngIf=\"active_link === 'Media'\"\n                        (click)=\"newItem(active_link)\"\n                    >\n                        Add {{ singular(active_link) }}\n                    </button>\n                </div>\n                <div class=\"px-8\">\n                    <nav mat-tab-nav-bar [tabPanel]=\"tabPanel\">\n                        @for (link of links; track link) {\n                            <a\n                                mat-tab-link\n                                [routerLink]=\"'/signage/' + (link | lowercase)\"\n                                (click)=\"active_link = link\"\n                                [active]=\"active_link == link\"\n                            >\n                                {{ link }}\n                            </a>\n                        }\n                    </nav>\n                </div>\n                <mat-tab-nav-panel\n                    class=\"flex-1 h-1/2 overflow-auto px-8 py-4\"\n                    #tabPanel\n                >\n                    <router-outlet></router-outlet>\n                </mat-tab-nav-panel>\n            </main>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n                background-color: var(--b1);\n            }\n        `,\n    ],\n})\nexport class SignageComponent extends AsyncHandler implements OnInit {\n    public readonly loading = this._state.loading;\n    public links = ['Media', 'Displays', 'Zones'];\n    public active_link = this.links[0];\n\n    public readonly previewFile = (event) =>\n        this._state.previewFileFromInput(event);\n\n    public singular(name: string) {\n        if (name === 'Media') return 'Playlist';\n        if (name === 'Playlists') return 'Playlist';\n        return '';\n    }\n\n    public async newItem(name: string) {\n        switch (name) {\n            case 'Media':\n            case 'Playlists':\n                const result = await this._state.editPlaylist();\n                if (result) {\n                    this._router.navigate([\n                        '/signage/media',\n                        { query: { playlist: result.id } },\n                    ]);\n                }\n                break;\n        }\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.query',\n            this._router.events.subscribe((event) => {\n                if (event instanceof NavigationEnd) {\n                    this.active_link = this.links.find((_) =>\n                        this._router.url.includes(_.toLowerCase()),\n                    );\n                }\n            }),\n        );\n        this.active_link = this.links.find((_) =>\n            this._router.url.includes(_.toLowerCase()),\n        );\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { first } from 'rxjs/operators';\n\nimport { AsyncHandler } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { SignageStateService } from './signage-state.service';\n\n@Component({\n    selector: 'signage-topbar',\n    template: `\n        <div\n            class=\"flex items-center bg-base-100 h-20 px-4 border-b border-base-200 space-x-2\"\n        >\n            <!-- <mat-form-field appearance=\"outline\">\n                <mat-select\n                    multiple\n                    [(ngModel)]=\"zones\"\n                    (ngModelChange)=\"updateZones($event)\"\n                    placeholder=\"All Levels\"\n                >\n                    <mat-option\n                        *ngFor=\"let level of levels | async\"\n                        [value]=\"level.id\"\n                    >\n                        {{ level.display_name || level.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <mat-slide-toggle\n                class=\"m-2\"\n                [ngModel]=\"(filters | async)?.only_onsite\"\n                (ngModelChange)=\"setFilters({ only_onsite: $event })\"\n                ><div class=\"text-xs\">Onsite Only</div></mat-slide-toggle\n            >\n            <div class=\"flex-1 w-2\"></div>\n            <searchbar\n                class=\"mr-2\"\n                (modelChange)=\"setSearch($event)\"\n            ></searchbar> -->\n        </div>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.25em;\n                width: 8em;\n            }\n        `,\n    ],\n})\nexport class SignageTopbarComponent extends AsyncHandler implements OnInit {\n    /** List of selected levels */\n    public zones: string[] = [];\n    /** List of levels for the active building */\n    public readonly levels = this._org.active_levels;\n\n    // public readonly filters = this._state.filters;\n    // /** Set filtered date */\n    // public readonly setDate = (date) => this._state.setFilters({ date });\n    // /** Set filtered date */\n    // public readonly setFilters = (filters) => this._state.setFilters(filters);\n    // /** Set filter string */\n    // public readonly setSearch = (str) => this._state.setSearchString(str);\n    // /** Update active zones for desks */\n    // public readonly updateZones = (zones) => {\n    //     this._router.navigate([], {\n    //         relativeTo: this._route,\n    //         queryParams: { zone_ids: zones.join(',') },\n    //     });\n    //     this._state.setFilters({ zones });\n    // };\n\n    constructor(\n        private _state: SignageStateService,\n        private _org: OrganisationService,\n        private _route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) => {\n                if (params.has('zone_ids')) {\n                    const zones = params.get('zone_ids').split(',');\n                    if (zones.length) {\n                        const level = this._org.levelWithID(zones);\n                        if (!level) {\n                            return;\n                        }\n                        this._org.building = this._org.buildings.find(\n                            (bld) => bld.id === level.parent_id\n                        );\n                        this.zones = zones;\n                    }\n                }\n            })\n        );\n        this.subscription(\n            'levels',\n            this._org.active_levels.subscribe((levels) => {\n                this.zones = this.zones.filter((zone) =>\n                    levels.find((lvl) => lvl.id === zone)\n                );\n                if (!this.zones.length && levels.length) {\n                    this.zones.push(levels[0].id);\n                }\n                // this.updateZones(this.zones);\n            })\n        );\n        // this.setSearch('');\n    }\n}\n","import { Component, Input, SimpleChanges, ViewChild } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { SignageStateService } from './signage-state.service';\nimport { SignageMedia } from '@placeos/ts-client';\nimport { CdkDropList } from '@angular/cdk/drag-drop';\nimport { getUnixTime, startOfMinute } from 'date-fns';\n\n@Component({\n    selector: 'signage-media-list',\n    template: `\n        <div class=\"p-4\">\n            <h3 class=\"text-xl font-medium text-center mb-4\">Media</h3>\n            <mat-form-field appearance=\"outline\" class=\"w-full no-subscript\">\n                <input\n                    matInput\n                    placeholder=\"Search...\"\n                    [ngModel]=\"search.getValue()\"\n                    (ngModelChange)=\"search.next($event)\"\n                />\n            </mat-form-field>\n        </div>\n        @if ((media | async)?.length > 0) {\n            <div\n                class=\"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-3 p-4\"\n                cdkDropList\n                id=\"media-list\"\n                [cdkDropListData]=\"media | async\"\n                [cdkDropListConnectedTo]=\"playlist_ids\"\n                (cdkDropListDropped)=\"drop($event)\"\n            >\n                @for (media of media | async; track media.id) {\n                    <div\n                        class=\"relative bg-base-100 rounded-lg flex flex-col items-center justify-center p-3 hover:opacity-80 border border-base-300\"\n                        cdkDrag\n                    >\n                        @if (media.valid_from && now < media.valid_from) {\n                            <div\n                                class=\"absolute inset-0 z-0 bg-warning opacity-10 rounded-lg\"\n                            ></div>\n                        } @else if (\n                            media.valid_until && now > media.valid_until\n                        ) {\n                            <div\n                                class=\"absolute inset-0 z-0 bg-error opacity-10 rounded-lg\"\n                            ></div>\n                        }\n                        <div\n                            class=\"min-h-10 min-w-10 border-4 rounded-2xl border-base-400 bg-base-300 border-dashed flex items-center justify-center\"\n                            *cdkDragPlaceholder\n                        >\n                            <app-icon class=\"text-2xl text-base-100\">\n                                add\n                            </app-icon>\n                        </div>\n                        <div\n                            preview\n                            class=\"relative w-full h-36 bg-base-200 rounded-lg overflow-hidden\"\n                        >\n                            <img\n                                auth\n                                [source]=\"media.thumbnail_url\"\n                                *ngIf=\"media.thumbnail_url\"\n                                class=\"w-full h-full object-contain rounded-lg\"\n                            />\n                            <div\n                                class=\"absolute top-1 left-1 px-2 py-1 text-xs rounded-lg capitalize font-mono\"\n                                [class.bg-info]=\"media.media_type === 'video'\"\n                                [class.text-info-content]=\"\n                                    media.media_type === 'video'\n                                \"\n                                [class.bg-warning]=\"\n                                    media.media_type === 'image'\n                                \"\n                                [class.text-warning-content]=\"\n                                    media.media_type === 'image'\n                                \"\n                            >\n                                {{ media.media_type }}\n                            </div>\n                            <div\n                                class=\"absolute bottom-1 right-1 px-2 py-1 text-xs rounded-lg bg-info text-info-content capitalize font-mono\"\n                                *ngIf=\"media.play_time\"\n                            >\n                                {{ media.play_time / 1000 | mediaDuration }}\n                            </div>\n                        </div>\n                        <div\n                            class=\"flex items-center justify-between w-full relative top-1\"\n                        >\n                            <div\n                                class=\"text-base-content truncate flex-1 w-1/2\"\n                                [matTooltip]=\"media.name\"\n                            >\n                                {{ media.name }}\n                            </div>\n                            <button\n                                icon\n                                matRipple\n                                [matMenuTriggerFor]=\"menu\"\n                                aria-label=\"Media Actions\"\n                            >\n                                <app-icon>more_vert</app-icon>\n                            </button>\n                            <mat-menu #menu=\"matMenu\">\n                                <button mat-menu-item (click)=\"editItem(media)\">\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\"\n                                            >edit</app-icon\n                                        >\n                                        <div class=\"pr-2\">Edit Media Item</div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"previewItem(media)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\"\n                                            >visibility</app-icon\n                                        >\n                                        <div class=\"pr-2\">\n                                            Preview Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"removeItem(media)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl text-error\">\n                                            delete\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Remove Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                            </mat-menu>\n                        </div>\n                    </div>\n                }\n            </div>\n        } @else {\n            <div\n                class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30 mx-auto flex-1\"\n            >\n                <app-icon class=\"text-6xl\">hide_image</app-icon>\n                <p>No media found.</p>\n            </div>\n        }\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignageMediaListComponent {\n    @Input() public playlist_count = 0;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly media = combineLatest([\n        this.search,\n        this._state.media,\n    ]).pipe(\n        map(([search, media]) =>\n            media.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n\n    public playlist_ids: string[] = [];\n\n    public get now() {\n        return getUnixTime(startOfMinute(Date.now()));\n    }\n\n    public readonly previewItem = (item: SignageMedia) =>\n        this._state.previewMedia(item);\n\n    public readonly editItem = (item: SignageMedia) =>\n        this._state.editMedia(item);\n\n    public readonly removeItem = async (item: SignageMedia) =>\n        this._state.removeMedia(item);\n\n    constructor(private _state: SignageStateService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.playlist_count) {\n            this.playlist_ids = new Array(this.playlist_count)\n                .fill(0)\n                .map((_, idx) => `playlist-${idx}`);\n        }\n    }\n\n    public drop(event) {}\n}\n","import { Component, Input, SimpleChanges } from '@angular/core';\nimport { BehaviorSubject, combineLatest, of } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport {\n    catchError,\n    debounceTime,\n    filter,\n    map,\n    shareReplay,\n    startWith,\n    switchMap,\n    take,\n} from 'rxjs/operators';\nimport {\n    listSignagePlaylistMedia,\n    MediaAnimation,\n    SignageMedia,\n    SignagePlaylist,\n} from '@placeos/ts-client';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport { Router } from '@angular/router';\nimport { getUnixTime, startOfMinute } from 'date-fns';\n\n@Component({\n    selector: 'signage-playlist-media-list',\n    template: `\n        <div class=\"flex flex-col space-y-4 relative p-4 h-full w-full\">\n            <h3 class=\"text-xl font-medium text-center\">\n                Playlist - {{ (selected_playlist | async)?.name }}\n            </h3>\n            <button\n                icon\n                matRipple\n                [matMenuTriggerFor]=\"menu\"\n                class=\"absolute top-2 right-2 !m-0\"\n            >\n                <app-icon>more_vert</app-icon>\n            </button>\n            <mat-menu #menu=\"matMenu\">\n                <button mat-menu-item (click)=\"editPlaylist()\">\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon class=\"text-2xl\">edit</app-icon>\n                        <div class=\"pr-2\">Edit Playlist</div>\n                    </div>\n                </button>\n                <button mat-menu-item (click)=\"removePlaylist()\">\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon class=\"text-2xl text-error\">delete</app-icon>\n                        <div class=\"pr-2\">Remove Playlist</div>\n                    </div>\n                </button>\n            </mat-menu>\n            <div details class=\"flex items-center flex-wrap\">\n                <div\n                    class=\"ml-2 text-xs px-2 py-1 m-1 rounded\"\n                    [class.bg-success]=\"(selected_playlist | async)?.enabled\"\n                    [class.text-success-content]=\"\n                        (selected_playlist | async)?.enabled\n                    \"\n                    [class.bg-error]=\"!(selected_playlist | async)?.enabled\"\n                    [class.text-error-content]=\"\n                        !(selected_playlist | async)?.enabled\n                    \"\n                >\n                    {{\n                        (selected_playlist | async)?.enabled\n                            ? 'Enabled'\n                            : 'Disabled'\n                    }}\n                </div>\n                <div\n                    class=\"ml-2 text-xs px-2 py-1 m-1 rounded bg-secondary text-secondary-content\"\n                    *ngIf=\"(selected_playlist | async)?.random\"\n                >\n                    Shuffle ON\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1 \"\n                    matTooltip=\"Default Transition Animation\"\n                >\n                    Animation:\n                    <span\n                        class=\"ml-1 uppercase bg-base-200 px-2 py-1 rounded\"\n                        >{{\n                            animation_name(\n                                (selected_playlist | async)?.default_animation\n                            )\n                        }}</span\n                    >\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1\"\n                    matTooltip=\"Default Playback Duration\"\n                >\n                    Duration:\n                    <span\n                        class=\"ml-1 font-mono bg-base-200 px-2 py-1 rounded\"\n                        >{{\n                            (selected_playlist | async)?.default_duration / 1000\n                                | mediaDuration\n                        }}</span\n                    >\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1\"\n                    matTooltip=\"Prefered Orientation\"\n                >\n                    Orientation:\n                    <span\n                        class=\"ml-1 uppercase bg-base-200 px-2 py-1 rounded\"\n                        >{{ (selected_playlist | async)?.orientation }}</span\n                    >\n                </div>\n            </div>\n            @if ((media | async).length > 0) {\n                <div\n                    cdkDropList\n                    class=\"flex-1 h-1/2 overflow-auto flex flex-col space-y-2\"\n                    id=\"playlist-list\"\n                    [cdkDropListData]=\"media | async\"\n                    [cdkDropListConnectedTo]=\"playlist_ids\"\n                    (cdkDropListDropped)=\"drop($event)\"\n                >\n                    <ng-container *ngFor=\"let item of media | async\">\n                        <div\n                            cdkDrag\n                            class=\"relative w-full bg-base-100 h-20 rounded-lg flex items-center p-2 space-x-2 border border-base-300\"\n                        >\n                            @if (item.valid_from && now < item.valid_from) {\n                                <div\n                                    class=\"absolute inset-0 z-0 bg-warning opacity-10 rounded-lg\"\n                                ></div>\n                            } @else if (\n                                item.valid_until && now > item.valid_until\n                            ) {\n                                <div\n                                    class=\"absolute inset-0 z-0 bg-error opacity-10 rounded-lg\"\n                                ></div>\n                            }\n                            <div\n                                class=\"min-h-10 min-w-10 border-4 rounded-2xl border-base-400 bg-base-300 border-dashed flex items-center justify-center\"\n                                *cdkDragPlaceholder\n                            >\n                                <app-icon class=\"text-2xl text-base-100\">\n                                    add\n                                </app-icon>\n                            </div>\n                            <button\n                                matRipple\n                                cdkDragHandle\n                                class=\"flex items-center justify-center w-6 h-full rounded hover:bg-base-200\"\n                                matTooltip=\"Drag to reorder\"\n                            >\n                                <app-icon>drag_handle</app-icon>\n                            </button>\n                            <div\n                                preview\n                                class=\"w-[4.5rem] h-16 bg-base-200 rounded-lg overflow-hidden\"\n                            >\n                                <img\n                                    auth\n                                    [source]=\"item.thumbnail_url\"\n                                    class=\"w-full h-full object-contain\"\n                                />\n                            </div>\n                            <div\n                                class=\"text-base-content truncate flex-1 w-1/2\"\n                            >\n                                {{ item.name }}\n                            </div>\n                            <button\n                                icon\n                                matRipple\n                                aria-label=\"Media Actions\"\n                                [matMenuTriggerFor]=\"menu\"\n                            >\n                                <app-icon>more_vert</app-icon>\n                            </button>\n                            <mat-menu #menu=\"matMenu\">\n                                <button mat-menu-item (click)=\"editItem(item)\">\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\">\n                                            edit\n                                        </app-icon>\n                                        <div class=\"pr-2\">Edit Media Item</div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"previewItem(item)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\">\n                                            visibility\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Preview Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"removeItem(item)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl text-error\">\n                                            delete\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Remove Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                            </mat-menu>\n                        </div>\n                    </ng-container>\n                </div>\n            } @else {\n                <div\n                    class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30 mx-auto flex-1\"\n                >\n                    <app-icon class=\"text-6xl\">hide_image</app-icon>\n                    <p>No media in playlist.</p>\n                </div>\n            }\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignagePlaylistMediaListComponent {\n    @Input() public playlist = '';\n    @Input() public playlist_count = 0;\n\n    public playlist_ids: string[] = [];\n\n    private _playlist = new BehaviorSubject<string>('');\n\n    public readonly editPlaylist = async () => {\n        const playlist = await this.selected_playlist.pipe(take(1)).toPromise();\n        this._state.editPlaylist(playlist);\n    };\n\n    public readonly removeItem = async (item: SignageMedia) => {\n        const playlist = await this._playlist_media.pipe(take(1)).toPromise();\n        const list = playlist.items.filter((_) => _ !== item.id);\n        await this._state.updatePlaylistMedia(this.playlist, list);\n        this._playlist.next(this.playlist);\n    };\n\n    public readonly previewItem = (item: SignageMedia) =>\n        this._state.previewMedia(item);\n\n    public readonly editItem = (item: SignageMedia) =>\n        this._state.editMedia(item);\n\n    public readonly removePlaylist = async () =>\n        this._state.removePlaylist(\n            await this.selected_playlist.pipe(take(1)).toPromise(),\n        );\n\n    public readonly selected_playlist = combineLatest([\n        this._playlist,\n        this._state.playlists,\n    ]).pipe(\n        map(([playlist, list]) => {\n            const item = list.find((_) => _.id === playlist);\n            if (!item) this._router.navigate(['/signage/media', {}]);\n            return item;\n        }),\n    );\n\n    private _playlist_media = this._playlist.pipe(\n        filter((playlist) => !!playlist),\n        debounceTime(300),\n        switchMap((playlist) =>\n            listSignagePlaylistMedia(playlist).pipe(\n                catchError(() => of({ id: '', items: [] })),\n            ),\n        ),\n        shareReplay(1),\n    );\n\n    public readonly media = combineLatest([\n        this._playlist_media,\n        this._state.media,\n    ]).pipe(\n        map(([playlist, media]) =>\n            playlist.items\n                .map((_) => media.find((m) => m.id === _))\n                .filter((_) => _),\n        ),\n        startWith([]),\n    );\n\n    public get now() {\n        return getUnixTime(startOfMinute(Date.now()));\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n    ) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.playlist) {\n            this._playlist.next(this.playlist);\n        }\n        if (changes.playlist_count) {\n            this.playlist_ids = new Array(this.playlist_count)\n                .fill(0)\n                .map((_, idx) => `playlist-${idx}`);\n        }\n    }\n\n    public animation_name(value: MediaAnimation) {\n        switch (value) {\n            case MediaAnimation.Cut:\n                return 'Cut';\n            case MediaAnimation.CrossFade:\n                return 'Cross Fade';\n            case MediaAnimation.SlideBottom:\n                return 'Slide Bottom';\n            case MediaAnimation.SlideLeft:\n                return 'Slide Left';\n            case MediaAnimation.SlideRight:\n                return 'Slide Right';\n            case MediaAnimation.SlideTop:\n                return 'Slide Top';\n        }\n        return 'Default';\n    }\n\n    public async drop(event: CdkDragDrop<SignageMedia[]>) {\n        if (event.previousIndex === event.currentIndex) return;\n        const id = await this._playlist.pipe(take(1)).toPromise();\n        const playlist = await this._playlist_media.pipe(take(1)).toPromise();\n        if (!id && playlist) return;\n        const list = [...playlist.items];\n        moveItemInArray(list, event.previousIndex, event.currentIndex);\n        await this._state.updatePlaylistMedia(id, list);\n        this._playlist.next(this.playlist);\n    }\n}\n","import { Component, ViewChild } from '@angular/core';\n\nimport { SignageStateService } from './signage-state.service';\nimport { AsyncHandler, unique } from '@placeos/common';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { SignageMediaListComponent } from './signage-media-list.component';\nimport { listSignagePlaylistMedia, SignagePlaylist } from '@placeos/ts-client';\nimport { CdkDragDrop } from '@angular/cdk/drag-drop';\n\n@Component({\n    selector: 'signage-media',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div\n                sidebar\n                class=\"w-64 h-full flex flex-col space-y-4 py-4 overflow-auto\"\n            >\n                <h3 class=\"text-xl font-medium text-center\">Playlists</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                <a\n                    matRipple\n                    class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200\"\n                    [class.!bg-secondary]=\"!selected_playlist\"\n                    [class.text-secondary-content]=\"!selected_playlist\"\n                    [routerLink]=\"[]\"\n                    [queryParams]=\"{ playlist: '' }\"\n                >\n                    All Media\n                </a>\n                <hr class=\"w-full\" />\n                @if ((playlists | async)?.length > 0) {\n                    @for (playlist of playlists | async; track playlist.id) {\n                        <a\n                            matRipple\n                            class=\"w-full px-6 rounded-3xl h-12 min-h-12 flex items-center hover:bg-base-200\"\n                            [class.!bg-secondary]=\"\n                                selected_playlist === playlist.id\n                            \"\n                            [class.text-secondary-content]=\"\n                                selected_playlist === playlist.id\n                            \"\n                            [routerLink]=\"[]\"\n                            [queryParams]=\"{ playlist: playlist.id }\"\n                            cdkDropList\n                            [id]=\"'playlist-' + $index\"\n                            [cdkDropListConnectedTo]=\"[\n                                'media-list',\n                                'playlist-list',\n                            ]\"\n                            (cdkDropListDropped)=\"\n                                selected_playlist === playlist.id\n                                    ? ''\n                                    : drop(playlist, $event)\n                            \"\n                        >\n                            <div class=\"flex-1\">\n                                {{ playlist.name }}\n                            </div>\n                        </a>\n                    }\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching playlists found'\n                                    : 'No playlists'\n                            }}\n                        </p>\n                    </div>\n                    <button\n                        *ngIf=\"!search.getValue()\"\n                        btn\n                        matRipple\n                        class=\"inverse\"\n                        (click)=\"addPlaylist()\"\n                    >\n                        <div class=\"flex items-center justify-center w-full\">\n                            <app-icon class=\"text-2xl\">add</app-icon>\n                            <span class=\"ml-2 mr-4\">Add Playlist</span>\n                        </div>\n                    </button>\n                }\n            </div>\n            <div\n                class=\"relative flex-1 w-1/2 h-full overflow-hidden rounded-lg border border-base-300 shadow\"\n                (dragover)=\"onEnter($event)\"\n                (dragenter)=\"onEnter($event)\"\n                (window:drop)=\"hideOverlay($event)\"\n            >\n                <div class=\"h-full w-full overflow-auto\">\n                    <signage-media-list\n                        *ngIf=\"!selected_playlist\"\n                        [playlist_count]=\"(playlists | async)?.length\"\n                    ></signage-media-list>\n                    <signage-playlist-media-list\n                        *ngIf=\"selected_playlist\"\n                        [playlist]=\"selected_playlist\"\n                        [playlist_count]=\"(playlists | async)?.length\"\n                    ></signage-playlist-media-list>\n                </div>\n                <div\n                    class=\"absolute inset-0\"\n                    *ngIf=\"show_dropzone\"\n                    (dragleave)=\"hideOverlay($event)\"\n                    (drop)=\"previewFile($event)\"\n                >\n                    <div\n                        class=\"absolute inset-0 bg-base-content opacity-60\"\n                    ></div>\n                    <div\n                        class=\"absolute inset-4 border-4 border-dashed border-base-300 flex flex-col items-center justify-center rounded-2xl text-base-100 space-y-4\"\n                    >\n                        <app-icon class=\"text-6xl\">cloud_upload</app-icon>\n                        <p>Drop Media to upload</p>\n                    </div>\n                    <input\n                        type=\"file\"\n                        (change)=\"previewFile($event)\"\n                        class=\"absolute inset-0 opacity-0\"\n                    />\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                min-height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignageMediaComponent extends AsyncHandler {\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly playlists = combineLatest([\n        this.search,\n        this._state.playlists,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public selected_playlist = '';\n    public show_dropzone = false;\n\n    public readonly addPlaylist = async () => {\n        const result = await this._state.editPlaylist();\n        if (result) {\n            this._router.navigate([\n                '/signage/media',\n                { query: { playlist: result.id } },\n            ]);\n        }\n    };\n    public readonly previewMedia = (item) => this._state.previewMedia(item);\n    public readonly previewFile = (event) =>\n        this._state.previewFileFromInput(event, this.selected_playlist);\n\n    public onEnter(e) {\n        this.clearTimeout('hide_overlay');\n        this.show_dropzone = e?.dataTransfer?.types.includes('Files');\n    }\n\n    public hideOverlay(e) {\n        if (!this.show_dropzone) return;\n        if (!(e.target instanceof HTMLInputElement)) {\n            e.preventDefault();\n        }\n        this.timeout('hide_overlay', () => (this.show_dropzone = false));\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n        private _route: ActivatedRoute,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                if (params.has('playlist')) {\n                    this.selected_playlist = params.get('playlist');\n                }\n            }),\n        );\n    }\n\n    public async drop(\n        playlist: SignagePlaylist,\n        event: CdkDragDrop<SignagePlaylist[]>,\n    ) {\n        const media = event.previousContainer.data[event.previousIndex];\n        const media_list = await listSignagePlaylistMedia(\n            playlist.id,\n        ).toPromise();\n        const new_media_list = [...media_list.items, media.id];\n        await this._state.updatePlaylistMedia(playlist.id, new_media_list);\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n    TemplateRef,\n} from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n    selector: 'search-overlay',\n    template: `\n        <div\n            class=\"absolute inset-0 flex flex-col p-8 items-center\"\n            (click)=\"close.next()\"\n            (window:keydown.esc)=\"close.next()\"\n        >\n            <div class=\"absolute inset-0 bg-base-content opacity-70 z-0\"></div>\n            <div\n                class=\"relative mb-4 w-[32rem] max-w-[calc(100%-2rem)] mx-auto z-10\"\n                (click)=\"$event.stopPropagation()\"\n            >\n                <input\n                    class=\"rounded-[4rem] text-xl text-base-content bg-base-100 border border-base-300 shadow pl-14 pr-6 py-4 w-full\"\n                    [ngModel]=\"search.getValue()\"\n                    (ngModelChange)=\"search.next($event)\"\n                    placeholder=\"Search...\"\n                />\n                <app-icon\n                    class=\"absolute left-3 top-1/2 -translate-y-1/2 text-3xl pointer-events-none\"\n                >\n                    search\n                </app-icon>\n            </div>\n            <div\n                class=\"overflow-auto max-h-[65%] w-[32rem] max-w-[calc(100%-2rem)] mx-auto rounded z-10\"\n                (click)=\"$event.stopPropagation()\"\n            >\n                @for (item of item_list; track item) {\n                    <button\n                        matRipple\n                        class=\"w-full text-left\"\n                        (click)=\"selected.next(item)\"\n                    >\n                        @if (result_template) {\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    result_template;\n                                    context: { item: item }\n                                \"\n                            ></ng-container>\n                        } @else {\n                            <div\n                                class=\"p-4 w-full bg-base-100 hover:bg-base-200 border border-base-300\"\n                            >\n                                {{ item.name || item }}\n                            </div>\n                        }\n                    </button>\n                }\n                @if (!item_list?.length) {\n                    <button\n                        matRipple\n                        class=\"w-full p-4 text-base-100\"\n                        (click)=\"close.next()\"\n                    >\n                        <div class=\"opacity-30\">\n                            No items available to select\n                        </div>\n                    </button>\n                }\n            </div>\n            <button\n                icon\n                matRipple\n                class=\"absolute top-10 right-8 text-base-100 text-xl h-12 w-12\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SearchOverlayComponent<T extends {} = any> {\n    @Input() public item_list: T[] = [];\n    @Input() public result_template: TemplateRef<any>;\n\n    @Output() public selected = new EventEmitter<T>();\n    @Output() public close = new EventEmitter<void>();\n\n    public readonly search = new BehaviorSubject('');\n    private _items = new BehaviorSubject<T[]>([]);\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item_list) {\n            this._items.next(this.item_list || []);\n        }\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport { map, startWith } from 'rxjs/operators';\nimport { SignagePlaylist } from '@placeos/ts-client';\n\n@Component({\n    selector: `signage-item-playlists`,\n    template: `\n        <div class=\"flex items-center justify-center space-x-2\">\n            <h3 class=\"text-xl font-medium\">\n                {{ item?.display_name || item?.name }}\n            </h3>\n            <div\n                *ngIf=\"extra\"\n                class=\"px-2 py-1 text-xs font-mono bg-base-200 rounded-lg uppercase\"\n            >\n                {{ extra }}\n            </div>\n            <a\n                icon\n                matRipple\n                [href]=\"link + item.id\"\n                *ngIf=\"link\"\n                target=\"_blank\"\n                ref=\"noopener noreferrer\"\n            >\n                <app-icon>link</app-icon>\n            </a>\n        </div>\n        <ng-content></ng-content>\n        @if ((active_playlists | async).length > 0 && item) {\n            <div\n                cdkDropList\n                class=\"flex-1 h-1/2 overflow-auto flex flex-col space-y-2 mt-4\"\n                (cdkDropListDropped)=\"ondrop.next($event)\"\n            >\n                @for (item of active_playlists | async; track item.id) {\n                    <div\n                        cdkDrag\n                        class=\"w-full bg-base-100 h-20 rounded-lg flex items-center p-2 space-x-2 border border-base-300\"\n                    >\n                        <div\n                            class=\"h-20 w-full border-4 border-dashed border-base-400 bg-base-300 rounded-xl\"\n                            *cdkDragPlaceholder\n                        ></div>\n                        <button\n                            matRipple\n                            cdkDragHandle\n                            class=\"flex items-center justify-center w-6 h-full rounded hover:bg-base-200\"\n                            matTooltip=\"Drag to reorder\"\n                        >\n                            <app-icon>drag_handle</app-icon>\n                        </button>\n                        <div class=\"text-base-content flex-1 w-1/2\">\n                            <div class=\"truncate\">\n                                {{ item.name }}\n                            </div>\n                            <div class=\"truncate text-sm opacity-30\">\n                                {{ item.media_count || 0 }} Media items\n                            </div>\n                        </div>\n                        <button\n                            icon\n                            matRipple\n                            aria-label=\"Media Actions\"\n                            [matMenuTriggerFor]=\"menu\"\n                        >\n                            <app-icon>more_vert</app-icon>\n                        </button>\n                        <mat-menu #menu=\"matMenu\">\n                            <a\n                                mat-menu-item\n                                [routerLink]=\"['/signage', 'media']\"\n                                [queryParams]=\"{\n                                    playlist: item.id,\n                                }\"\n                            >\n                                <div class=\"flex items-center space-x-2\">\n                                    <app-icon class=\"text-2xl\">\n                                        visibility\n                                    </app-icon>\n                                    <div class=\"pr-2\">View Playlist</div>\n                                </div>\n                            </a>\n                            <button mat-menu-item (click)=\"remove.next(item)\">\n                                <div class=\"flex items-center space-x-2\">\n                                    <app-icon class=\"text-2xl text-error\">\n                                        delete\n                                    </app-icon>\n                                    <div class=\"pr-2\">Remove Playlist</div>\n                                </div>\n                            </button>\n                        </mat-menu>\n                    </div>\n                }\n            </div>\n            <button btn matRipple (click)=\"add.emit()\">Add Playlist</button>\n        } @else {\n            <div\n                class=\"flex flex-col items-center justify-center p-8 space-y-2 mx-auto flex-1\"\n            >\n                <div\n                    class=\"flex flex-col items-center justify-center opacity-30\"\n                >\n                    <app-icon class=\"text-6xl\">hide_image</app-icon>\n                    <p>No playlists in {{ name }}.</p>\n                </div>\n                <button btn matRipple (click)=\"add.emit()\" class=\"w-40\">\n                    Add Playlist\n                </button>\n            </div>\n        }\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n            }\n        `,\n    ],\n})\nexport class SignageItemPlaylistsComponent {\n    @Input() public item: any;\n    @Input() public name: string = 'zone';\n    @Input() public extra: string = '';\n    @Input() public link: string = '';\n    @Output() public readonly add = new EventEmitter();\n    @Output() public readonly remove = new EventEmitter<SignagePlaylist>();\n    @Output() public readonly ondrop = new EventEmitter<any>();\n\n    private _playlist_ids = new BehaviorSubject<string[]>([]);\n\n    public readonly active_playlists = combineLatest([\n        this._state.playlists,\n        this._playlist_ids,\n        this._state.has_changed,\n    ]).pipe(\n        map(([playlists, ids]) =>\n            ids.map((id) => playlists.find((_) => _.id === id)),\n        ),\n        startWith([]),\n    );\n\n    constructor(private _state: SignageStateService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item) {\n            this._playlist_ids.next(this.item?.playlists || []);\n        }\n    }\n}\n","import { Component } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport {\n    debounce,\n    debounceTime,\n    map,\n    shareReplay,\n    startWith,\n    switchMap,\n    take,\n    tap,\n} from 'rxjs/operators';\nimport { ActivatedRoute } from '@angular/router';\nimport {\n    AsyncHandler,\n    notifySuccess,\n    SettingsService,\n    unique,\n} from '@placeos/common';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport {\n    listSystemTriggers,\n    SignagePlaylist,\n    updateSystem,\n    updateTrigger,\n} from '@placeos/ts-client';\n\n@Component({\n    selector: 'signage-displays',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div sidebar class=\"w-64 h-full flex flex-col space-y-4 py-4\">\n                <h3 class=\"text-xl font-medium text-center\">Displays</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                @if ((displays | async)?.length > 0) {\n                    <div class=\"h-1/2 flex-1 w-full overflow-auto space-y-2\">\n                        @for (display of displays | async; track display.id) {\n                            <a\n                                matRipple\n                                class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate z-10\"\n                                [class.!bg-secondary]=\"\n                                    selected.getValue() === display.id\n                                \"\n                                [class.text-secondary-content]=\"\n                                    selected.getValue() === display.id\n                                \"\n                                [routerLink]=\"[]\"\n                                [queryParams]=\"{ display: display.id }\"\n                            >\n                                {{ display.display_name || display.name }}\n                            </a>\n                            @if (\n                                (active_display | async)?.id === display.id &&\n                                !switching\n                            ) {\n                                @for (\n                                    trigger of triggers | async;\n                                    track trigger.id\n                                ) {\n                                    <div\n                                        class=\"relative flex items-center space-x-2 z-0\"\n                                    >\n                                        <div class=\"w-6\">\n                                            <div\n                                                class=\"absolute h-16 w-4 border-b-2 border-l-2 border-base-300 top-1/2 left-6 -translate-y-full\"\n                                            ></div>\n                                        </div>\n                                        <a\n                                            matRipple\n                                            class=\"w-1/2 flex-1 px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate\"\n                                            [class.!bg-secondary]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [class.text-secondary-content]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [routerLink]=\"[]\"\n                                            [queryParams]=\"{\n                                                display: display.id,\n                                                trigger: trigger?.id,\n                                            }\"\n                                        >\n                                            <span class=\"max-w-full truncate\">{{\n                                                trigger?.display_name ||\n                                                    trigger?.name ||\n                                                    'Trigger'\n                                            }}</span>\n                                        </a>\n                                    </div>\n                                }\n                            }\n                        }\n                    </div>\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching displays found'\n                                    : 'No displays'\n                            }}\n                        </p>\n                    </div>\n                }\n            </div>\n            <div\n                class=\"relative flex flex-col flex-1 w-1/2 h-full overflow-auto rounded-lg border border-base-300 p-4 shadow space-y-4\"\n            >\n                @if (active_display | async) {\n                    <signage-item-playlists\n                        class=\"flex flex-col flex-1\"\n                        [item]=\"\n                            (active_trigger | async) || (active_display | async)\n                        \"\n                        [name]=\"\n                            (active_trigger | async) ? 'trigger' : 'display'\n                        \"\n                        [extra]=\"\n                            (active_trigger | async)\n                                ? ''\n                                : (active_display | async)?.orientation\n                        \"\n                        [link]=\"\n                            (active_trigger | async)\n                                ? ''\n                                : signage_path + '/#/signage/'\n                        \"\n                        (add)=\"this.adding = true\"\n                        (remove)=\"removePlaylist($event)\"\n                        (ondrop)=\"drop($event)\"\n                    >\n                        <div\n                            class=\"flex flex-wrap items-center overflow-auto mt-4\"\n                            *ngIf=\"!(active_trigger | async)\"\n                        >\n                            @for (\n                                zone of (active_display | async)?.zones;\n                                track zone\n                            ) {\n                                <a\n                                    class=\"px-2 py-1 font-mono text-xs bg-base-200 rounded whitespace-nowrap m-1\"\n                                    matRipple\n                                    [routerLink]=\"['/signage', 'zones']\"\n                                    [queryParams]=\"{ zone: zone }\"\n                                >\n                                    {{\n                                        (zone | zone | async)?.display_name ||\n                                            (zone | zone | async)?.name\n                                    }}\n                                </a>\n                            }\n                            <button\n                                class=\"underline font-mono text-xs px-2 py-1 rounded m-1\"\n                                matRipple\n                            >\n                                Add Zone\n                            </button>\n                        </div>\n                    </signage-item-playlists>\n                } @else {\n                    <div\n                        class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">desktop_windows</app-icon>\n                        <p>Select a display from the left to view playlists</p>\n                    </div>\n                }\n                <search-overlay\n                    *ngIf=\"adding\"\n                    [item_list]=\"playlists | async\"\n                    (selected)=\"addPlaylist($event)\"\n                    (close)=\"adding = false\"\n                ></search-overlay>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SignageDisplaysComponent extends AsyncHandler {\n    public adding = false;\n    public switching = false;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly displays = combineLatest([\n        this.search,\n        this._state.displays,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public readonly selected = new BehaviorSubject('');\n    public readonly selected_trigger = new BehaviorSubject('');\n    public readonly active_display = combineLatest([\n        this.displays,\n        this.selected,\n    ]).pipe(map(([displays, id]) => displays.find((item) => item.id === id)));\n\n    public readonly triggers = this.selected.pipe(\n        switchMap((id) => listSystemTriggers(id)),\n        map((_) => _.data),\n        tap((_) => setTimeout(() => (this.switching = false), 200)),\n        shareReplay(1),\n    );\n\n    public readonly active_trigger = combineLatest([\n        this.triggers,\n        this.selected_trigger,\n        this.selected,\n    ]).pipe(\n        map(([list, id, sys_id]) =>\n            list.find(\n                (item) => item.id === id && item.control_system_id === sys_id,\n            ),\n        ),\n    );\n\n    public readonly playlists = combineLatest([\n        this.active_display,\n        this.active_trigger,\n        this._state.playlists,\n        this._state.has_changed,\n    ]).pipe(\n        map(([display, trigger, playlists]) =>\n            playlists.filter(\n                (_) =>\n                    !(trigger || display)?.playlists.find((id) => _.id === id),\n            ),\n        ),\n    );\n\n    public get signage_path() {\n        return this._settings.get('app.signage_path') || '/signage';\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _route: ActivatedRoute,\n        private _settings: SettingsService,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                this.switching =\n                    params.get('display') !== this.selected.getValue();\n                this.selected.next(params.get('display') || '');\n                this.selected_trigger.next(params.get('trigger') || '');\n            }),\n        );\n    }\n\n    public async addPlaylist(playlist: SignagePlaylist) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const playlists = [...item.playlists, playlist.id];\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(\n            item.id,\n            { playlists, version: display.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully added playlist to the ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const playlists = item.playlists.filter((id) => playlist.id !== id);\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(\n            item.id,\n            { playlists, version: display.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully removed playlist from ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async drop(event: CdkDragDrop<SignagePlaylist[]>) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const old_playlist = item.playlists;\n        const playlists = [...old_playlist];\n        moveItemInArray(playlists, event.previousIndex, event.currentIndex);\n        (item as any).playlists = playlists;\n        this._state.changed();\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(item.id, { playlists, version: display.version }, 'patch')\n            .toPromise()\n            .catch((e) => {\n                (item as any).playlists = old_playlist;\n                this._state.changed();\n                throw e;\n            });\n        notifySuccess(\n            `Successfully re-ordered playlists on ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n    }\n}\n","import { Component } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport {\n    map,\n    shareReplay,\n    startWith,\n    switchMap,\n    take,\n    tap,\n} from 'rxjs/operators';\nimport { ActivatedRoute } from '@angular/router';\nimport { AsyncHandler, notifySuccess, unique } from '@placeos/common';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport {\n    listZoneTriggers,\n    SignagePlaylist,\n    updateTrigger,\n    updateZone,\n} from '@placeos/ts-client';\n\n@Component({\n    selector: 'signage-zones',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div sidebar class=\"w-64 h-full flex flex-col space-y-4 py-4\">\n                <h3 class=\"text-xl font-medium text-center\">Zones</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                @if ((zones | async)?.length > 0) {\n                    <div class=\"h-1/2 flex-1 w-full overflow-auto space-y-2\">\n                        @for (zone of zones | async; track zone.id) {\n                            <a\n                                matRipple\n                                class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate z-10\"\n                                [class.!bg-secondary]=\"\n                                    selected.getValue() === zone.id\n                                \"\n                                [class.text-secondary-content]=\"\n                                    selected.getValue() === zone.id\n                                \"\n                                [routerLink]=\"[]\"\n                                [queryParams]=\"{ zone: zone.id }\"\n                            >\n                                {{ zone.display_name || zone.name }}\n                            </a>\n                            @if (\n                                (active_zone | async)?.id === zone.id &&\n                                !switching\n                            ) {\n                                @for (\n                                    trigger of triggers | async;\n                                    track trigger.id\n                                ) {\n                                    <div\n                                        class=\"relative flex items-center space-x-2 z-0\"\n                                    >\n                                        <div class=\"w-6\">\n                                            <div\n                                                class=\"absolute h-16 w-4 border-b-2 border-l-2 border-base-300 top-1/2 left-6 -translate-y-full\"\n                                            ></div>\n                                        </div>\n                                        <a\n                                            matRipple\n                                            class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate\"\n                                            [class.!bg-secondary]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [class.text-secondary-content]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [routerLink]=\"[]\"\n                                            [queryParams]=\"{\n                                                zone: zone.id,\n                                                trigger: trigger?.id,\n                                            }\"\n                                        >\n                                            {{\n                                                trigger?.display_name ||\n                                                    trigger?.name ||\n                                                    'Trigger'\n                                            }}\n                                        </a>\n                                    </div>\n                                }\n                            }\n                        }\n                    </div>\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching zones found'\n                                    : 'No zones'\n                            }}\n                        </p>\n                    </div>\n                }\n            </div>\n            <div\n                class=\"relative flex flex-col flex-1 w-1/2 h-full overflow-auto rounded-lg border border-base-300 p-4 shadow space-y-4\"\n            >\n                @if (active_zone | async) {\n                    <signage-item-playlists\n                        class=\"flex flex-col flex-1\"\n                        [item]=\"\n                            (active_trigger | async) || (active_zone | async)\n                        \"\n                        [name]=\"(active_trigger | async) ? 'trigger' : 'zone'\"\n                        (add)=\"this.adding = true\"\n                        (remove)=\"removePlaylist($event)\"\n                        (ondrop)=\"drop($event)\"\n                    ></signage-item-playlists>\n                } @else {\n                    <div\n                        class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">desktop_windows</app-icon>\n                        <p>Select a zone from the left to view playlists</p>\n                    </div>\n                }\n                <search-overlay\n                    *ngIf=\"adding\"\n                    [item_list]=\"playlists | async\"\n                    (selected)=\"addPlaylist($event)\"\n                    (close)=\"adding = false\"\n                ></search-overlay>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SignageZonesComponent extends AsyncHandler {\n    public adding = false;\n    public switching = false;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly zones = combineLatest([\n        this.search,\n        this._state.zones,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public readonly selected = new BehaviorSubject('');\n    public readonly selected_trigger = new BehaviorSubject('');\n    public readonly active_zone = combineLatest([\n        this.zones,\n        this.selected,\n    ]).pipe(map(([zones, id]) => zones.find((item) => item.id === id)));\n\n    public readonly triggers = this.selected.pipe(\n        switchMap((id) => listZoneTriggers(id)),\n        map((_) => _.data),\n        tap((_) => setTimeout(() => (this.switching = false), 100)),\n        shareReplay(1),\n    );\n\n    public readonly active_trigger = combineLatest([\n        this.triggers,\n        this.selected_trigger,\n    ]).pipe(map(([list, id]) => list.find((item) => item.id === id)));\n\n    public readonly playlists = combineLatest([\n        this.active_zone,\n        this.active_trigger,\n        this._state.playlists,\n        this._state.has_changed,\n    ]).pipe(\n        map(([zone, trigger, playlists]) =>\n            playlists.filter(\n                (_) => !(trigger || zone)?.playlists.find((id) => _.id === id),\n            ),\n        ),\n    );\n\n    constructor(\n        private _state: SignageStateService,\n        private _route: ActivatedRoute,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                this.switching =\n                    params.get('zone') !== this.selected.getValue();\n                this.selected.next(params.get('zone') || '');\n                this.selected_trigger.next(params.get('trigger') || '');\n            }),\n        );\n    }\n\n    public async addPlaylist(playlist: SignagePlaylist) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const playlists = [...item.playlists, playlist.id];\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(\n            item.id,\n            { playlists, version: zone.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully added playlist to the ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const playlists = item.filter((id) => playlist.id !== id);\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(\n            item.id,\n            { playlists, version: zone.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully removed playlist from ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async drop(event: CdkDragDrop<SignagePlaylist[]>) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const old_playlist = item.playlists;\n        const playlists = [...old_playlist];\n        moveItemInArray(playlists, event.previousIndex, event.currentIndex);\n        (item as any).playlists = playlists;\n        this._state.changed();\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(item.id, { playlists, version: zone.version }, 'patch')\n            .toPromise()\n            .catch((e) => {\n                (item as any).playlists = old_playlist;\n                this._state.changed();\n                throw e;\n            });\n        notifySuccess(\n            `Successfully re-ordered playlists on ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule, Route } from '@angular/router';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\n\nimport { UIModule } from '../ui/ui.module';\nimport { SignageComponent } from './signage.component';\nimport { SignageTopbarComponent } from './signage-topbar.component';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { SignageMediaComponent } from './signage-media.component';\nimport { SignageMediaPreviewModalComponent } from './signage-media-preview-modal.component';\nimport { ComponentsModule } from '@placeos/components';\nimport { SignagePlaylistModalComponent } from './signage-playlist-modal.component';\nimport { SignagePlaylistMediaListComponent } from './signage-playlist-media-list.component';\nimport { SignageMediaListComponent } from './signage-media-list.component';\nimport { SignageDisplaysComponent } from './signage-displays.component';\nimport { SearchOverlayComponent } from './search-overlay.component';\nimport { SignageZonesComponent } from './signage-zones.component';\nimport { SignageItemPlaylistsComponent } from './signage-item-playlists.component';\nimport { SignageMediaModalComponent } from './signage-media-modal.component';\n\nconst ROUTES: Route[] = [\n    {\n        path: '',\n        component: SignageComponent,\n        children: [\n            { path: '', redirectTo: 'media', pathMatch: 'full' },\n            { path: 'media', component: SignageMediaComponent },\n            { path: 'displays', component: SignageDisplaysComponent },\n            { path: 'zones', component: SignageZonesComponent },\n            { path: '*', redirectTo: 'media', pathMatch: 'full' },\n        ],\n    },\n];\n\nexport const COMPONENTS: Type<any>[] = [\n    SignageComponent,\n    SignageTopbarComponent,\n    SignageMediaComponent,\n    SignageMediaModalComponent,\n    SignageMediaPreviewModalComponent,\n    SignagePlaylistModalComponent,\n    SignageMediaListComponent,\n    SignagePlaylistMediaListComponent,\n\n    SignageDisplaysComponent,\n    SignageZonesComponent,\n    SearchOverlayComponent,\n    SignageItemPlaylistsComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        UIModule,\n        ComponentsModule,\n        RouterModule.forChild(ROUTES),\n        MatTabsModule,\n        DragDropModule,\n    ],\n})\nexport class SignageModule {}\n"],"x_google_ignoreList":[]}