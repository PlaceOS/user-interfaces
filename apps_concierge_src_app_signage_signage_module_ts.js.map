{"version":3,"file":"apps_concierge_src_app_signage_signage_module_ts.js","mappings":"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","names":["i0","ctx_r0","resource","toString","SignageMediaPreviewModalComponent_main_6_img_2_Template","SignageMediaPreviewModalComponent_main_6_video_3_Template","type","_r2","save","emit","loading","SignageMediaPreviewModalComponent","constructor","_data","this","EventEmitter","url","name","file","can_save","static","__ngFactoryType__","MAT_DIALOG_DATA","core","VBU","selectors","outputs","decls","vars","consts","template","rf","ctx","SignageMediaPreviewModalComponent_main_6_Template","SignageMediaPreviewModalComponent_footer_7_Template","SignageMediaPreviewModalComponent_ng_template_8_Template","load_state_r3","form","value","default_duration","valid_from","savePlaylist","SignagePlaylistModalComponent","_state","_dialog","_dialog_ref","playlist","media","search","BehaviorSubject","FormGroup","id","FormControl","Validators","required","description","default_animation","MediaAnimation","Cut","orientation","enabled","random","valid_until","_this","_asyncToGenerator","markAllAsTouched","updateValueAndValidity","invalid","form_value","getRawValue","result","getUnixTime","catch","_","notifyError","close","i1","i2","viewQuery","SignagePlaylistModalComponent_button_3_Template","SignagePlaylistModalComponent_main_4_Template","SignagePlaylistModalComponent_footer_5_Template","SignagePlaylistModalComponent_ng_template_6_Template","ctx_r1","start_time","item","video_length","play_time","_r1","preview","SignageMediaModalComponent_main_4_Conditional_12_Template","SignageMediaModalComponent_main_4_Conditional_17_Template","SignageMediaModalComponent_main_4_Conditional_18_Template","thumbnail","media_type","_r3","saveMedia","SignageMediaModalComponent","includes","media_url","_file_url","URL","createObjectURL","file_thumbnail","thumbnail_url","animation","Default","startOfDay","Date","now","valueOf","addYears","endOfDay","patchValue","file_metadata","Math","floor","ngOnDestroy","revokeObjectURL","valid","disableClose","new_media","onError","e","updateSignageMedia","toPromise","onAdd","notifySuccess","SignageMediaModalComponent_button_3_Template","SignageMediaModalComponent_main_4_Template","SignageMediaModalComponent_footer_5_Template","SignageMediaModalComponent_ng_template_6_Template","load_state_r4","SignageStateService","AsyncHandler","changed","_change","next","_org","_settings","super","_loading","_active_upload","asObservable","has_changed","combineLatest","active_building","pipe","filter","debounceTime","switchMap","bld","querySignageMedia","limit","map","data","sort","a","b","created_at","shareReplay","playlists","querySignagePlaylists","localeCompare","displays","active_region","region","querySystems","zone_id","get","signage","display_name","zones","queryZones","catchError","of","editPlaylist","SignagePlaylist","Promise","resolve","open","afterClosed","subscribe","timeout","editMedia","SignageMedia","playlist_id","_ref","_getMediaMetadata","_generateThumbnail","f","m","addMedia","previewMedia","_x","apply","arguments","_this2","updateSignagePlaylist","addSignagePlaylist","removePlaylist","removeSignagePlaylist","updatePlaylistMedia","list","updateSignagePlaylistMedia","previewFileFromInput","event","element","target","files","length","undefined","previewFileMedia","_this3","ref","componentInstance","new_media_list","listSignagePlaylistMedia","items","media_item","_this4","upload","reject","state","resolved","uploadFile","s","link","is_landscape","thumbnail_image","dataURLtoFile","dataURL","filename","prefix","split","mimeType","byteString","atob","arrayBuffer","ArrayBuffer","uint8Array","Uint8Array","i","charCodeAt","File","media_id","media_uri","thumbnail_id","key","addSignageMedia","updateMedia","removeMedia","_this5","openConfirmModal","title","content","icon","reason","removeSignageMedia","video","document","createElement","src","addEventListener","videoWidth","videoHeight","duration","load","img","Image","onload","width","height","max_width","max_height","_this6","console","log","_generateVideoThumbnail","_generateImageThumbnail","image","_generateThumbnailFromResource","onerror","autoplay","muted","onloadeddata","source_width","source_height","canvas","getContext","thumbnailWidth","thumbnailHeight","aspectRatio","drawImage","toDataURL","i3","jDH","factory","ɵfac","providedIn","newItem","active_link","singular","link_r4","$implicit","SignageComponent","_router","navigate","query","links","previewFile","ngOnInit","subscription","events","NavigationEnd","find","toLowerCase","features","attrs","_c0","SignageComponent_button_7_Template","SignageComponent_For_11_Template","tabPanel_r5","SignageTopbarComponent","_route","levels","active_levels","initialised","first","queryParamMap","params","has","level","levelWithID","building","buildings","parent_id","zone","lvl","push","media_r4","SignageMediaListComponent_Conditional_5_For_3_Conditional_1_Template","SignageMediaListComponent_Conditional_5_For_3_Conditional_2_Template","SignageMediaListComponent_Conditional_5_For_3_div_3_Template","SignageMediaListComponent_Conditional_5_For_3_img_5_Template","SignageMediaListComponent_Conditional_5_For_3_div_8_Template","editItem","previewItem","removeItem","menu_r5","$event","drop","SignageMediaListComponent_Conditional_5_For_3_Template","_forTrack0","playlist_ids","SignageMediaListComponent","startOfMinute","playlist_count","ngOnChanges","changes","Array","fill","idx","inputs","SignageMediaListComponent_Conditional_5_Template","SignageMediaListComponent_Conditional_7_Template","getValue","tmp_1_0","SignagePlaylistMediaListComponent_Conditional_33_ng_container_2_Conditional_2_Template","SignagePlaylistMediaListComponent_Conditional_33_ng_container_2_Conditional_3_Template","SignagePlaylistMediaListComponent_Conditional_33_ng_container_2_div_4_Template","item_r4","SignagePlaylistMediaListComponent_Conditional_33_ng_container_2_Template","SignagePlaylistMediaListComponent","_playlist","selected_playlist","take","_ref2","_playlist_media","startWith","animation_name","CrossFade","SlideBottom","SlideLeft","SlideRight","SlideTop","previousIndex","currentIndex","moveItemInArray","SignagePlaylistMediaListComponent_div_15_Template","SignagePlaylistMediaListComponent_Conditional_33_Template","SignagePlaylistMediaListComponent_Conditional_35_Template","tmp_0_0","tmp_2_0","tmp_3_0","tmp_4_0","tmp_5_0","tmp_6_0","tmp_7_0","tmp_8_0","tmp_9_0","playlist_r2","ctx_r2","_c2","$index_r4","_c3","SignageMediaComponent_Conditional_9_For_1_Template","_r5","addPlaylist","SignageMediaComponent_Conditional_11_button_5_Template","_r6","hideOverlay","SignageMediaComponent","onEnter","clearTimeout","show_dropzone","dataTransfer","types","HTMLInputElement","preventDefault","previousContainer","SignageMediaComponent_Conditional_9_Template","SignageMediaComponent_Conditional_11_Template","SignageMediaComponent_signage_media_list_14_Template","SignageMediaComponent_signage_playlist_media_list_15_Template","SignageMediaComponent_div_16_Template","_c1","SearchOverlayComponent_For_8_Conditional_1_ng_container_0_Template","result_template","item_r2","selected","SearchOverlayComponent_For_8_Conditional_1_Template","SearchOverlayComponent_For_8_Conditional_2_Template","_r4","SearchOverlayComponent","item_list","_items","stopPropagation","SearchOverlayComponent_For_8_Template","SearchOverlayComponent_Conditional_9_Template","extra","SignageItemPlaylistsComponent_Conditional_6_For_2_div_1_Template","remove","media_count","ondrop","SignageItemPlaylistsComponent_Conditional_6_For_2_Template","add","active_playlists","SignageItemPlaylistsComponent","_playlist_ids","ids","ngContentSelectors","SignageItemPlaylistsComponent_div_3_Template","SignageItemPlaylistsComponent_a_4_Template","SignageItemPlaylistsComponent_Conditional_6_Template","SignageItemPlaylistsComponent_Conditional_8_Template","selected_trigger","trigger_r1","display_r2","SignageDisplaysComponent_Conditional_6_For_2_Conditional_2_For_1_Template","triggers","SignageDisplaysComponent_Conditional_6_For_2_Conditional_2_Template","tmp_16_0","active_display","switching","SignageDisplaysComponent_Conditional_6_For_2_Template","_c4","zone_r5","tmp_14_0","SignageDisplaysComponent_Conditional_10_div_7_For_2_Template","adding","SignageDisplaysComponent_Conditional_10_div_7_Template","active_trigger","signage_path","SignageDisplaysComponent","listSystemTriggers","tap","setTimeout","sys_id","control_system_id","display","trigger","updateTrigger","updateSystem","version","old_playlist","SignageDisplaysComponent_Conditional_6_Template","SignageDisplaysComponent_Conditional_8_Template","SignageDisplaysComponent_Conditional_10_Template","SignageDisplaysComponent_Conditional_12_Template","SignageDisplaysComponent_search_overlay_13_Template","zone_r2","SignageZonesComponent_Conditional_6_For_2_Conditional_2_For_1_Template","SignageZonesComponent_Conditional_6_For_2_Conditional_2_Template","active_zone","SignageZonesComponent_Conditional_6_For_2_Template","SignageZonesComponent","listZoneTriggers","updateZone","SignageZonesComponent_Conditional_6_Template","SignageZonesComponent_Conditional_8_Template","SignageZonesComponent_Conditional_10_Template","SignageZonesComponent_Conditional_12_Template","SignageZonesComponent_search_overlay_13_Template","ROUTES","path","component","children","redirectTo","pathMatch","COMPONENTS","SignageModule","$C","G2t","CommonModule","FormsModule","UIModule","ComponentsModule","RouterModule","forChild","MatTabsModule","DragDropModule"],"ignoreList":[],"sourceRoot":"webpack:///","sources":["./apps/concierge/src/app/signage/signage-media-preview-modal.component.ts","./apps/concierge/src/app/signage/signage-playlist-modal.component.ts","./apps/concierge/src/app/signage/signage-media-modal.component.ts","./apps/concierge/src/app/signage/signage-state.service.ts","./apps/concierge/src/app/signage/signage.component.ts","./apps/concierge/src/app/signage/signage-topbar.component.ts","./apps/concierge/src/app/signage/signage-media-list.component.ts","./apps/concierge/src/app/signage/signage-playlist-media-list.component.ts","./apps/concierge/src/app/signage/signage-media.component.ts","./apps/concierge/src/app/signage/search-overlay.component.ts","./apps/concierge/src/app/signage/signage-item-playlists.component.ts","./apps/concierge/src/app/signage/signage-displays.component.ts","./apps/concierge/src/app/signage/signage-zones.component.ts","./apps/concierge/src/app/signage/signage.module.ts"],"sourcesContent":["import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\n@Component({\n    selector: 'signage-media-preview-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between p-2 border-b border-base-300\"\n        >\n            <h1 class=\"px-2\">Preview - {{ name }}</h1>\n            <button icon matRipple mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main class=\"bg-base-200\" *ngIf=\"!loading; else load_state\">\n            <div\n                class=\"max-w-[80vw] max-h-[65vh] w-[80vw] h-[65vh] flex items-center justify-center\"\n            >\n                <img\n                    *ngIf=\"type === 'image'\"\n                    class=\"w-full h-full object-contain object-center\"\n                    auth\n                    [source]=\"resource.toString()\"\n                />\n                <video\n                    *ngIf=\"type === 'video'\"\n                    class=\"w-full h-full object-contain object-center\"\n                    auth\n                    [source]=\"resource.toString()\"\n                    autoplay\n                    controls\n                ></video>\n            </div>\n        </main>\n        <footer\n            *ngIf=\"can_save && !loading\"\n            class=\"p-2 flex items-center justify-end space-x-2 border-t border-base-300\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"save.emit()\">\n                Save Media\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main\n                class=\"flex flex-col items-center justify-center p-8 w-[28rem] h-[20rem] max-w-[80vw] max-h-[65vh]\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignageMediaPreviewModalComponent {\n    @Output() public readonly save = new EventEmitter<any>();\n    public loading = '';\n    public readonly resource = this._data.url;\n    public readonly type = this._data.type;\n    public readonly name = this._data.name;\n    public readonly file = this._data.file;\n    public readonly can_save = this._data.save !== false;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: {\n            url: URL;\n            type: 'image' | 'video';\n            save: boolean;\n            name: string;\n            file?: File;\n        },\n    ) {}\n}\n","import {\n    MAT_DIALOG_DATA,\n    MatDialog,\n    MatDialogRef,\n} from '@angular/material/dialog';\nimport { SignageStateService } from './signage-state.service';\nimport { Component, ElementRef, Inject, ViewChild } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\nimport { notifyError } from '@placeos/common';\nimport { MediaAnimation } from '@placeos/ts-client/dist/esm/signage/media.class';\nimport { SignagePlaylist } from '@placeos/ts-client';\nimport { addYears, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\n@Component({\n    selector: 'signage-playlist-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between border-b border-base-300\"\n        >\n            <h1 class=\"p-2 font-medium text-xl\">\n                {{ playlist.id ? 'Edit' : 'New' }} Playlist\n            </h1>\n            <button icon matRipple mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            [formGroup]=\"form\"\n            class=\"p-4 flex flex-col w-[32rem] max-w-[calc(100vw-2rem)]\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <label for=\"name\">Name<span required>*</span></label>\n            <mat-form-field appearance=\"outline\" class=\"w-full\">\n                <input\n                    matInput\n                    name=\"name\"\n                    placeholder=\"Name\"\n                    formControlName=\"name\"\n                />\n                <mat-error>Name is required</mat-error>\n            </mat-form-field>\n            <div class=\"flex items-center space-x-8 mb-4\">\n                <mat-checkbox formControlName=\"enabled\">Enabled</mat-checkbox>\n                <mat-checkbox formControlName=\"random\">\n                    Shuffle Playback\n                </mat-checkbox>\n            </div>\n            <div class=\"flex items-center space-x-4\">\n                <label for=\"default-duration\" class=\"w-auto min-w-0 m-0\">\n                    Default Play Time</label\n                >\n                <div class=\"text-xs font-mono\">\n                    {{ form.value.default_duration / 1000 | mediaDuration }}\n                </div>\n            </div>\n            <mat-slider min=\"5000\" max=\"300000\" step=\"1000\">\n                <input\n                    name=\"default-duration\"\n                    matSliderThumb\n                    formControlName=\"default_duration\"\n                />\n            </mat-slider>\n            <div class=\"flex space-x-2\">\n                <div class=\"flex-1\">\n                    <label for=\"orientation\">Orientation</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"orientation\"\n                            formControlName=\"orientation\"\n                            placeholder=\"Unspecified\"\n                        >\n                            <mat-option value=\"unspecified\">\n                                Unspecified\n                            </mat-option>\n                            <mat-option value=\"landscape\">Landscape</mat-option>\n                            <mat-option value=\"portrait\">Portrait</mat-option>\n                            <mat-option value=\"square\">Square</mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex-1\">\n                    <label for=\"animation\">Animation</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"animation\"\n                            formControlName=\"default_animation\"\n                            placeholder=\"Playlist Default\"\n                        >\n                            <mat-option [value]=\"1\">Cut</mat-option>\n                            <mat-option [value]=\"2\">Cross Fade</mat-option>\n                            <mat-option [value]=\"3\">Slide Top</mat-option>\n                            <mat-option [value]=\"4\">Slide Left</mat-option>\n                            <mat-option [value]=\"5\">Slide Right</mat-option>\n                            <mat-option [value]=\"6\">Slide Bottom</mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n            </div>\n            <label for=\"description\">Description</label>\n            <mat-form-field appearance=\"outline\" class=\"w-full\">\n                <textarea\n                    matInput\n                    name=\"description\"\n                    placeholder=\"Description\"\n                    formControlName=\"description\"\n                    class=\"min-h-32\"\n                ></textarea>\n            </mat-form-field>\n            <div class=\"flex space-x-4\">\n                <div class=\"flex-1\">\n                    <label for=\"valid-from\">Valid From</label>\n                    <a-date-field\n                        name=\"valid-from\"\n                        formControlName=\"valid_from\"\n                    ></a-date-field>\n                </div>\n                <div class=\"flex-1\">\n                    <label for=\"valid-until\">Valid Until</label>\n                    <a-date-field\n                        name=\"valid-until\"\n                        [from]=\"form.value.valid_from\"\n                        formControlName=\"valid_until\"\n                        [disabled]=\"!form.value.valid_from\"\n                    ></a-date-field>\n                </div>\n            </div>\n        </main>\n        <footer\n            class=\"p-4 flex items-center justify-end space-x-2 border-t border-base-300\"\n            *ngIf=\"!loading\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"savePlaylist()\">\n                Save Playlist\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main class=\"flex flex-col items-center justify-center p-8\">\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"mt-4\">Saving Playlist...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignagePlaylistModalComponent {\n    public loading = false;\n    public readonly playlist = this._data;\n    public readonly media = this._state.media;\n\n    public readonly search = new BehaviorSubject('');\n\n    public readonly form = new FormGroup({\n        id: new FormControl(this.playlist.id || ''),\n        name: new FormControl(this.playlist.name || '', [Validators.required]),\n        description: new FormControl(this.playlist.description || ''),\n        default_animation: new FormControl<MediaAnimation>(\n            this.playlist.default_animation || MediaAnimation.Cut,\n        ),\n        orientation: new FormControl(\n            this.playlist.orientation || 'unspecified',\n        ),\n        enabled: new FormControl(this.playlist.enabled),\n        random: new FormControl(this.playlist.random),\n        default_duration: new FormControl(\n            this.playlist.default_duration || 15 * 1000,\n        ),\n        valid_from: new FormControl(this.playlist.valid_from * 1000),\n        valid_until: new FormControl(this.playlist.valid_until * 1000),\n    });\n\n    @ViewChild('search_input')\n    public search_input: ElementRef<HTMLInputElement>;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: SignagePlaylist = {} as any,\n        private _state: SignageStateService,\n        private _dialog: MatDialog,\n        private _dialog_ref: MatDialogRef<SignagePlaylistModalComponent>,\n    ) {}\n\n    public async savePlaylist() {\n        this.form.markAllAsTouched();\n        this.form.updateValueAndValidity();\n        if (this.form.invalid) return;\n        this.loading = true;\n        const form_value = this.form.getRawValue();\n        const result = await this._state\n            .savePlaylist({\n                ...form_value,\n                valid_from: getUnixTime(form_value.valid_from),\n                valid_until: getUnixTime(form_value.valid_until),\n            })\n            .catch((_) => {\n                notifyError('Error saving playlist');\n                this.loading = false;\n                throw _;\n            });\n        this._dialog_ref.close(result);\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { notifySuccess } from '@placeos/common';\nimport { SignageMedia, updateSignageMedia } from '@placeos/ts-client';\nimport { MediaAnimation } from '@placeos/ts-client/dist/esm/signage/media.class';\nimport { addYears, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\n@Component({\n    selector: 'signage-media-modal',\n    template: `\n        <header\n            class=\"flex items-center justify-between border-b border-base-300\"\n        >\n            <h2 class=\"p-2 text-xl font-medium\">\n                {{ item.id ? 'Edit' : 'New' }} Media Item\n            </h2>\n            <button icon matRipple mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"p-4 max-w-[calc(100vw-2rem)] w-[32rem] max-h-[65vh] overflow-auto\"\n            [formGroup]=\"form\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <div class=\"flex flex-col\">\n                <button\n                    matRipple\n                    class=\"relative w-full h-48 mx-auto bg-base-300 rounded-xl overflow-hidden mb-4\"\n                    (click)=\"preview()\"\n                >\n                    <img\n                        class=\"h-full w-full object-contain object-center\"\n                        auth\n                        [source]=\"thumbnail || url\"\n                    />\n                    <div\n                        class=\"absolute top-2 left-2 px-2 py-1 rounded text-xs bg-base-400 capitalize\"\n                    >\n                        {{ media_type }}\n                    </div>\n                </button>\n                <label for=\"name\">Name</label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        formControlName=\"name\"\n                        placeholder=\"Media Name\"\n                    />\n                    <mat-error>A name is required</mat-error>\n                </mat-form-field>\n                @if (media_type === 'video') {\n                    <div class=\"flex items-center space-x-4\">\n                        <label for=\"start-time\" class=\"w-auto min-w-0 m-0\"\n                            >Start Time</label\n                        >\n                        <div class=\"text-xs font-mono\">\n                            {{\n                                form.value.start_time / 1000\n                                    | mediaDuration: true\n                            }}\n                        </div>\n                    </div>\n                    <mat-slider\n                        min=\"0\"\n                        [max]=\"(item.video_length || 300000) - 1000\"\n                        step=\"100\"\n                    >\n                        <input\n                            name=\"start-time\"\n                            matSliderThumb\n                            formControlName=\"start_time\"\n                        />\n                    </mat-slider>\n                }\n                <div class=\"flex items-center space-x-4\">\n                    <label for=\"play-time\" class=\"w-auto min-w-0 m-0\">\n                        Play Time</label\n                    >\n                    <div class=\"text-xs font-mono\">\n                        @if (form.value.play_time) {\n                            {{\n                                form.value.play_time / 1000\n                                    | mediaDuration: true\n                            }}\n                        } @else {\n                            <span class=\"opacity-30\">\n                                Default ({{\n                                    item.video_length\n                                        ? (item.video_length / 1000\n                                          | mediaDuration)\n                                        : ''\n                                }})\n                            </span>\n                        }\n                    </div>\n                </div>\n                <mat-slider\n                    [min]=\"form.value.start_time\"\n                    [max]=\"item.video_length || 300000\"\n                    step=\"100\"\n                >\n                    <input\n                        name=\"play-time\"\n                        matSliderThumb\n                        formControlName=\"play_time\"\n                    />\n                </mat-slider>\n                <label for=\"animation\">Animation</label>\n                <mat-form-field appearance=\"outline\">\n                    <mat-select\n                        name=\"animation\"\n                        formControlName=\"animation\"\n                        placeholder=\"Playlist Default\"\n                    >\n                        <mat-option [value]=\"0\">Playlist Default</mat-option>\n                        <mat-option [value]=\"1\">Cut</mat-option>\n                        <mat-option [value]=\"2\">Cross Fade</mat-option>\n                        <mat-option [value]=\"3\">Slide Top</mat-option>\n                        <mat-option [value]=\"4\">Slide Left</mat-option>\n                        <mat-option [value]=\"5\">Slide Right</mat-option>\n                        <mat-option [value]=\"6\">Slide Bottom</mat-option>\n                    </mat-select>\n                </mat-form-field>\n                <label for=\"description\">Description</label>\n                <mat-form-field appearance=\"outline\" class=\"w-full\">\n                    <textarea\n                        matInput\n                        name=\"description\"\n                        placeholder=\"Description\"\n                        formControlName=\"description\"\n                        class=\"min-h-32\"\n                    ></textarea>\n                </mat-form-field>\n                <div class=\"flex space-x-4\">\n                    <div class=\"flex-1\">\n                        <label for=\"valid-from\">Valid From</label>\n                        <a-date-field\n                            name=\"valid-from\"\n                            formControlName=\"valid_from\"\n                        ></a-date-field>\n                    </div>\n                    <div class=\"flex-1\">\n                        <label for=\"valid-until\">Valid Until</label>\n                        <a-date-field\n                            name=\"valid-until\"\n                            [from]=\"form.value.valid_from\"\n                            formControlName=\"valid_until\"\n                        ></a-date-field>\n                    </div>\n                </div>\n            </div>\n        </main>\n        <footer\n            *ngIf=\"!loading\"\n            class=\"flex justify-end p-4 border-t border-base-300\"\n        >\n            <button btn matRipple class=\"w-32\" (click)=\"saveMedia()\">\n                Save\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main\n                class=\"flex flex-col items-center justify-center p-8 max-w-[calc(100vw-2rem)] min-h-64 w-[32rem] space-y-4\"\n            >\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving media item...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SignageMediaModalComponent {\n    public loading = false;\n    public readonly item = this._data.media;\n    public readonly file = this._data.file;\n    public readonly thumbnail =\n        this._data.file_thumbnail || this._data.media.thumbnail_url;\n\n    public readonly form = new FormGroup({\n        name: new FormControl('', [Validators.required]),\n        description: new FormControl(''),\n        animation: new FormControl<MediaAnimation>(MediaAnimation.Default),\n        start_time: new FormControl(0),\n        play_time: new FormControl<number | null>(null),\n        valid_from: new FormControl(startOfDay(Date.now()).valueOf()),\n        valid_until: new FormControl(\n            addYears(endOfDay(Date.now()), 10).valueOf(),\n        ),\n    });\n\n    private _file_url: string;\n\n    public readonly preview = () =>\n        this._data.preview({\n            media_url: this.url,\n            media_type: this.media_type,\n            name: this.form.value.name,\n        });\n\n    public get media_type() {\n        if (!this.file) return this.item.media_type;\n        return (\n            (this.file.type.includes('video')\n                ? 'video'\n                : this.file.type.includes('image')\n                  ? 'image'\n                  : '') || this.item.media_type\n        );\n    }\n\n    public get url() {\n        if (this.item.id) return this.item.media_url;\n        if (this._file_url) return this._file_url;\n        this._file_url = URL.createObjectURL(this.file);\n        return this._file_url;\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: {\n            media: SignageMedia;\n            file?: File;\n            file_metadata?: [boolean, number];\n            file_thumbnail?: string;\n            onAdd: (f, m) => Promise<SignageMedia>;\n            preview: (url) => void;\n        },\n        private _dialog_ref: MatDialogRef<SignageMediaModalComponent>,\n    ) {\n        this.form.patchValue({\n            ...this._data.media,\n            valid_from: this._data.media.valid_from * 1000,\n            valid_until: this._data.media.valid_until * 1000,\n        });\n        if (this._data.file) {\n            this.form.patchValue({\n                name: this._data.file.name,\n            });\n        }\n        if (this._data.file_metadata) {\n            (this.item as any).video_length = Math.floor(\n                this._data.file_metadata[1] * 1000,\n            );\n        }\n    }\n\n    public ngOnDestroy() {\n        if (this._file_url) URL.revokeObjectURL(this._file_url);\n    }\n\n    public async saveMedia() {\n        this.form.markAllAsTouched();\n        this.form.updateValueAndValidity();\n        if (!this.form.valid) return;\n        this.loading = true;\n        this._dialog_ref.disableClose = true;\n        const form_value = this.form.getRawValue();\n        const new_media = {\n            ...this.item,\n            ...form_value,\n            valid_from: getUnixTime(new Date(form_value.valid_from)),\n            valid_until: getUnixTime(form_value.valid_until),\n        };\n        const onError = (e) => {\n            this._dialog_ref.disableClose = false;\n            this.loading = false;\n            throw e;\n        };\n        if (this.item.id) {\n            await updateSignageMedia(this.item.id, new_media)\n                .toPromise()\n                .catch(onError);\n        } else {\n            await this._data.onAdd(this.file, new_media).catch(onError);\n        }\n        this._dialog_ref.disableClose = false;\n        this._dialog_ref.close();\n        notifySuccess('Successfully saved media item.');\n    }\n}\n","import { Injectable } from '@angular/core';\nimport {\n    AsyncHandler,\n    notifyError,\n    notifySuccess,\n    openConfirmModal,\n    SettingsService,\n    uploadFile,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport {\n    addSignageMedia,\n    addSignagePlaylist,\n    listSignagePlaylistMedia,\n    PlaceSystem,\n    querySignageMedia,\n    querySignagePlaylists,\n    querySystems,\n    queryZones,\n    removeSignageMedia,\n    removeSignagePlaylist,\n    SignageMedia,\n    SignagePlaylist,\n    updateSignageMedia,\n    updateSignagePlaylist,\n    updateSignagePlaylistMedia,\n} from '@placeos/ts-client';\nimport { Attachment } from '@placeos/users';\nimport { BehaviorSubject, Observable, combineLatest, of } from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    filter,\n    map,\n    shareReplay,\n    switchMap,\n} from 'rxjs/operators';\n\nimport { MatDialog } from '@angular/material/dialog';\nimport { SignageMediaPreviewModalComponent } from './signage-media-preview-modal.component';\nimport { SignagePlaylistModalComponent } from './signage-playlist-modal.component';\nimport { SignageMediaModalComponent } from './signage-media-modal.component';\n\nfunction dataURLtoBlob(dataURL) {\n    // Split the data URL to get the mime type and the data\n    const [prefix, data] = dataURL.split(',');\n    const mimeType = prefix.split(':')[1].split(';')[0];\n\n    // Convert base64 to raw binary data\n    const byteString = atob(data);\n\n    // Create an ArrayBuffer and fill it with the binary data\n    const arrayBuffer = new ArrayBuffer(byteString.length);\n    const uint8Array = new Uint8Array(arrayBuffer);\n    for (let i = 0; i < byteString.length; i++) {\n        uint8Array[i] = byteString.charCodeAt(i);\n    }\n\n    // Create and return the Blob\n    return new Blob([arrayBuffer], { type: mimeType });\n}\n\nfunction dataURLtoFile(dataURL, filename) {\n    // Split the data URL to get the mime type and the data\n    const [prefix, data] = dataURL.split(',');\n    const mimeType = prefix.split(':')[1].split(';')[0];\n\n    // Convert base64 to raw binary data\n    const byteString = atob(data);\n\n    // Create an ArrayBuffer and fill it with the binary data\n    const arrayBuffer = new ArrayBuffer(byteString.length);\n    const uint8Array = new Uint8Array(arrayBuffer);\n    for (let i = 0; i < byteString.length; i++) {\n        uint8Array[i] = byteString.charCodeAt(i);\n    }\n\n    // Create and return the File\n    return new File([uint8Array], filename, { type: mimeType });\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SignageStateService extends AsyncHandler {\n    private _loading = new BehaviorSubject(false);\n    private _change = new BehaviorSubject(0);\n    private _active_upload = new BehaviorSubject<Attachment>(null);\n\n    public readonly loading = this._loading.asObservable();\n    public readonly has_changed = this._change.asObservable();\n\n    public readonly media: Observable<SignageMedia[]> = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([_]) => !!_?.id),\n        debounceTime(300),\n        switchMap(([bld]) => querySignageMedia({ limit: 2500 } as any)),\n        map((_) => _.data.sort((a, b) => b.created_at - a.created_at)),\n        shareReplay(1),\n    );\n\n    public readonly playlists: Observable<SignagePlaylist[]> = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([_]) => !!_?.id),\n        debounceTime(300),\n        switchMap(() => querySignagePlaylists({ limit: 500 } as any)),\n        map((_) => (_.data || []).sort((a, b) => a.name.localeCompare(b.name))),\n        shareReplay(1),\n    );\n\n    public readonly displays: Observable<PlaceSystem[]> = combineLatest([\n        this._org.active_region,\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        filter(([region, bld]) => !!bld?.id),\n        switchMap(([region, bld]) =>\n            querySystems({\n                zone_id:\n                    (this._settings.get('app.use_region') ? region?.id : '') ||\n                    bld?.id,\n                limit: 500,\n                signage: true,\n            }).pipe(\n                map((_) =>\n                    (_.data || []).sort((a, b) =>\n                        (a.display_name || a.name).localeCompare(\n                            b.display_name || b.name,\n                        ),\n                    ),\n                ),\n            ),\n        ),\n        shareReplay(1),\n    );\n\n    public readonly zones = combineLatest([\n        this._org.active_building,\n        this._change,\n    ]).pipe(\n        switchMap(([bld]) =>\n            queryZones({\n                limit: 250,\n            } as any).pipe(catchError(() => of({ data: [] }))),\n        ),\n        map((_) =>\n            (_.data || []).sort((a, b) =>\n                (a.display_name || a.name).localeCompare(\n                    b.display_name || b.name,\n                ),\n            ),\n        ),\n    );\n\n    public changed() {\n        this._change.next(Date.now());\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _dialog: MatDialog,\n        private _settings: SettingsService,\n    ) {\n        super();\n    }\n\n    public editPlaylist(playlist: SignagePlaylist = new SignagePlaylist({})) {\n        return new Promise<SignagePlaylist | null>((resolve) => {\n            const ref = this._dialog.open(SignagePlaylistModalComponent, {\n                data: playlist,\n            });\n            ref.afterClosed().subscribe((result) => {\n                this.timeout('changed', () => this._change.next(Date.now()));\n                resolve(result);\n            });\n        });\n    }\n\n    public editMedia(\n        media: SignageMedia = new SignageMedia({}),\n        file?: File,\n        playlist_id: string = '',\n    ) {\n        return new Promise<SignagePlaylist | null>(async (resolve) => {\n            const ref = this._dialog.open(SignageMediaModalComponent, {\n                data: {\n                    media,\n                    file,\n                    file_metadata: file\n                        ? await this._getMediaMetadata(file)\n                        : [media.orientation === 'landscape', 0],\n                    file_thumbnail: file\n                        ? await this._generateThumbnail(file, 1024, 720)\n                        : '',\n                    playlist_id,\n                    onAdd: (f, m) => this.addMedia(f, m),\n                    preview: (item) => this.previewMedia(item),\n                },\n            });\n            ref.afterClosed().subscribe((result) => {\n                this.timeout('changed', () => this._change.next(Date.now()));\n                resolve(result);\n            });\n        });\n    }\n\n    public async savePlaylist(playlist: Partial<SignagePlaylist>) {\n        const call = playlist.id\n            ? updateSignagePlaylist(playlist.id, playlist)\n            : addSignagePlaylist(playlist);\n        const new_playlist = await call.toPromise();\n        notifySuccess(`Successfully saved playlist.`);\n        this._change.next(Date.now());\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        if (!playlist?.id) return;\n        await removeSignagePlaylist(playlist.id).toPromise();\n        notifySuccess(`Successfully removed playlist.`);\n    }\n\n    public async updatePlaylistMedia(playlist_id: string, list: string[]) {\n        await updateSignagePlaylistMedia(playlist_id, list).toPromise();\n        notifySuccess(`Successfully updated playlist media.`);\n    }\n\n    public previewMedia(item: SignageMedia) {\n        const ref = this._dialog.open(SignageMediaPreviewModalComponent, {\n            data: {\n                url: item.media_url,\n                type: item.media_type,\n                name: item.name,\n                save: false,\n            },\n        });\n    }\n\n    public previewFileFromInput(event, playlist_id: string = '') {\n        const element: HTMLInputElement = event.target as any;\n        /* istanbul ignore else */\n        if (!element?.files?.length) return;\n        const files: FileList = element.files;\n        const file = files[0];\n        if (\n            file &&\n            (file.type.includes('image') || file.type.includes('video'))\n        ) {\n            this.editMedia(undefined, file, playlist_id);\n        } else {\n            notifyError('Invalid file type.');\n        }\n    }\n\n    public previewFileMedia(media: File, playlist_id: string = '') {\n        const url = URL.createObjectURL(media);\n        const type = media.type.includes('image') ? 'image' : 'video';\n        const ref = this._dialog.open(SignageMediaPreviewModalComponent, {\n            data: { url, type, name: media.name, save: true, file: media },\n        });\n        ref.afterClosed().subscribe(() => URL.revokeObjectURL(url));\n        ref.componentInstance.save.subscribe(async () => {\n            ref.componentInstance.loading = 'Saving...';\n            const new_media = await this.addMedia(media).catch((e) => {\n                notifyError('Error saving media.');\n                ref.componentInstance.loading = '';\n                throw e;\n            });\n            if (playlist_id && new_media.id) {\n                const media_list =\n                    await listSignagePlaylistMedia(playlist_id).toPromise();\n                const new_media_list = [...media_list.items, new_media.id];\n                await updateSignagePlaylistMedia(\n                    playlist_id,\n                    new_media_list,\n                ).toPromise();\n            }\n            ref.close();\n        });\n    }\n\n    public async addMedia(\n        file: File,\n        media_item: SignageMedia = new SignageMedia({}),\n    ) {\n        const upload = (file) =>\n            new Promise<{ id: string; link: string }>((resolve, reject) => {\n                let state = null;\n                let resolved = false;\n                uploadFile(file).subscribe(\n                    (s) => {\n                        state = s;\n                        if (s.link) {\n                            resolved = true;\n                            resolve({ id: s.upload.id, link: s.link });\n                        }\n                    },\n                    reject,\n                    () => (!resolved ? resolve(state) : null),\n                );\n            });\n        const [is_landscape, _] = await this._getMediaMetadata(file);\n        const thumbnail_image = await this._generateThumbnail(\n            file,\n            1280,\n            720,\n        ).catch((_) => null);\n        const media = await upload(file);\n        let thumbnail = null;\n        if (thumbnail_image) {\n            thumbnail = await upload(\n                dataURLtoFile(thumbnail_image, `thumb+${file.name}`),\n            );\n        }\n        const data = {\n            ...new SignageMedia({\n                ...media_item,\n                name: media_item.name || file.name,\n                media_id: media.id,\n                media_uri: media.link,\n                media_type: file.type.includes('image') ? 'image' : 'video',\n                orientation: is_landscape ? 'landscape' : 'portrait',\n                thumbnail_id: thumbnail.id,\n            }),\n        };\n        for (const key in data) {\n            if (!data[key]) delete data[key];\n        }\n        const result = await addSignageMedia(data).toPromise();\n        this._active_upload.next(null);\n        this._change.next(Date.now());\n        return result;\n    }\n\n    public async updateMedia(item: SignageMedia) {\n        if (!item?.id) return;\n        await updateSignageMedia(item.id, item).toPromise();\n    }\n\n    public async removeMedia(item: SignageMedia) {\n        if (!item?.id) return;\n        const result = await openConfirmModal(\n            {\n                title: `Remove Media item`,\n                content: `\n                Are you sure you wish to remove the media item \"<strong>${item.name}</strong>\"?<br/><br/>\n                <i class=\"text-sm\">The item will be removed from all playlists and the files deleted from storage.</i>\n                `,\n                icon: { content: 'delete' },\n            },\n            this._dialog,\n        );\n        if (result.reason !== 'done') return;\n        result.loading('Removing media...');\n        await removeSignageMedia(item.id).toPromise();\n        this._change.next(Date.now());\n        result.close();\n    }\n\n    private _getMediaMetadata(file: File) {\n        return new Promise<[boolean, number]>((resolve) => {\n            const url = URL.createObjectURL(file);\n            // file is loaded\n            if (file.type.includes('video')) {\n                let video = document.createElement('video');\n                video.src = url.toString();\n                video.addEventListener('loadedmetadata', () => {\n                    const { videoWidth, videoHeight } = video;\n                    resolve([videoWidth > videoHeight, video.duration]);\n                });\n                video.load();\n            } else {\n                let img = new Image();\n                img.onload = () => resolve([img.width > img.height, 0]);\n                img.src = url.toString(); // is the data URL because called with readAsDataURL\n            }\n        });\n    }\n\n    private async _generateThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        console.log('File:', file, max_width, max_height);\n        if (file.type.includes('video')) {\n            return this._generateVideoThumbnail(file, max_width, max_height);\n        } else {\n            return this._generateImageThumbnail(file, max_width, max_height);\n        }\n    }\n\n    private _generateImageThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        return new Promise<string>((resolve, reject) => {\n            const img = new Image();\n            img.src = URL.createObjectURL(file);\n            console.log('Image:', img.src);\n\n            img.onload = () => {\n                const image = this._generateThumbnailFromResource(\n                    img,\n                    img.width,\n                    img.height,\n                    max_width,\n                    max_height,\n                );\n                URL.revokeObjectURL(img.src);\n                resolve(image);\n            };\n\n            img.onerror = reject;\n        });\n    }\n\n    private _generateVideoThumbnail(\n        file: File,\n        max_width: number,\n        max_height: number,\n    ) {\n        return new Promise<string>((resolve, reject) => {\n            // Create video element\n            const video = document.createElement('video');\n            video.autoplay = true;\n            video.muted = true;\n            video.src = URL.createObjectURL(file);\n\n            video.onloadeddata = () => {\n                const image = this._generateThumbnailFromResource(\n                    video,\n                    video.videoWidth,\n                    video.videoHeight,\n                    max_width,\n                    max_height,\n                );\n\n                // Clean up\n                URL.revokeObjectURL(video.src);\n                resolve(image);\n            };\n\n            video.onerror = reject;\n        });\n    }\n\n    private _generateThumbnailFromResource(\n        data,\n        source_width,\n        source_height,\n        max_width: number,\n        max_height: number,\n    ) {\n        // Create canvas element\n        const canvas = document.createElement('canvas');\n        const ctx = canvas.getContext('2d');\n\n        // Calculate thumbnail dimensions\n        let thumbnailWidth = source_width;\n        let thumbnailHeight = source_height;\n        const aspectRatio = thumbnailWidth / thumbnailHeight;\n\n        if (thumbnailWidth > max_width) {\n            thumbnailWidth = max_height;\n            thumbnailHeight = thumbnailWidth / aspectRatio;\n        }\n\n        if (thumbnailHeight > max_height) {\n            thumbnailHeight = max_width;\n            thumbnailWidth = thumbnailHeight * aspectRatio;\n        }\n\n        canvas.width = thumbnailWidth;\n        canvas.height = thumbnailHeight;\n\n        // Draw video frame on canvas\n        ctx.drawImage(data, 0, 0, thumbnailWidth, thumbnailHeight);\n\n        // Convert canvas to data URL\n        const dataURL = canvas.toDataURL('image/jpeg');\n\n        return dataURL;\n    }\n}\n","import { Component, OnInit } from '@angular/core';\n\nimport { SignageStateService } from './signage-state.service';\nimport { NavigationEnd, Router } from '@angular/router';\nimport { AsyncHandler } from '@placeos/common';\n\n@Component({\n    selector: '[app-new-staff]',\n    template: `\n        <app-topbar></app-topbar>\n        <div class=\"flex flex-1 h-px\">\n            <app-sidebar></app-sidebar>\n            <main class=\"flex flex-col flex-1 w-1/2 h-full\">\n                <div class=\"p-8 h-28 flex items-center justify-between\">\n                    <h2 class=\"text-2xl font-medium\">\n                        Digital Signage Management\n                    </h2>\n                    <button\n                        btn\n                        matRipple\n                        class=\"w-40\"\n                        *ngIf=\"active_link === 'Media'\"\n                        (click)=\"newItem(active_link)\"\n                    >\n                        Add {{ singular(active_link) }}\n                    </button>\n                </div>\n                <div class=\"px-8\">\n                    <nav mat-tab-nav-bar [tabPanel]=\"tabPanel\">\n                        @for (link of links; track link) {\n                            <a\n                                mat-tab-link\n                                [routerLink]=\"'/signage/' + (link | lowercase)\"\n                                (click)=\"active_link = link\"\n                                [active]=\"active_link == link\"\n                            >\n                                {{ link }}\n                            </a>\n                        }\n                    </nav>\n                </div>\n                <mat-tab-nav-panel\n                    class=\"flex-1 h-1/2 overflow-auto px-8 py-4\"\n                    #tabPanel\n                >\n                    <router-outlet></router-outlet>\n                </mat-tab-nav-panel>\n            </main>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n                background-color: var(--b1);\n            }\n        `,\n    ],\n})\nexport class SignageComponent extends AsyncHandler implements OnInit {\n    public readonly loading = this._state.loading;\n    public links = ['Media', 'Displays', 'Zones'];\n    public active_link = this.links[0];\n\n    public readonly previewFile = (event) =>\n        this._state.previewFileFromInput(event);\n\n    public singular(name: string) {\n        if (name === 'Media') return 'Playlist';\n        if (name === 'Playlists') return 'Playlist';\n        return '';\n    }\n\n    public async newItem(name: string) {\n        switch (name) {\n            case 'Media':\n            case 'Playlists':\n                const result = await this._state.editPlaylist();\n                if (result) {\n                    this._router.navigate([\n                        '/signage/media',\n                        { query: { playlist: result.id } },\n                    ]);\n                }\n                break;\n        }\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.query',\n            this._router.events.subscribe((event) => {\n                if (event instanceof NavigationEnd) {\n                    this.active_link = this.links.find((_) =>\n                        this._router.url.includes(_.toLowerCase()),\n                    );\n                }\n            }),\n        );\n        this.active_link = this.links.find((_) =>\n            this._router.url.includes(_.toLowerCase()),\n        );\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { first } from 'rxjs/operators';\n\nimport { AsyncHandler } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { SignageStateService } from './signage-state.service';\n\n@Component({\n    selector: 'signage-topbar',\n    template: `\n        <div\n            class=\"flex items-center bg-base-100 h-20 px-4 border-b border-base-200 space-x-2\"\n        >\n            <!-- <mat-form-field appearance=\"outline\">\n                <mat-select\n                    multiple\n                    [(ngModel)]=\"zones\"\n                    (ngModelChange)=\"updateZones($event)\"\n                    placeholder=\"All Levels\"\n                >\n                    <mat-option\n                        *ngFor=\"let level of levels | async\"\n                        [value]=\"level.id\"\n                    >\n                        {{ level.display_name || level.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <mat-slide-toggle\n                class=\"m-2\"\n                [ngModel]=\"(filters | async)?.only_onsite\"\n                (ngModelChange)=\"setFilters({ only_onsite: $event })\"\n                ><div class=\"text-xs\">Onsite Only</div></mat-slide-toggle\n            >\n            <div class=\"flex-1 w-2\"></div>\n            <searchbar\n                class=\"mr-2\"\n                (modelChange)=\"setSearch($event)\"\n            ></searchbar> -->\n        </div>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.25em;\n                width: 8em;\n            }\n        `,\n    ],\n})\nexport class SignageTopbarComponent extends AsyncHandler implements OnInit {\n    /** List of selected levels */\n    public zones: string[] = [];\n    /** List of levels for the active building */\n    public readonly levels = this._org.active_levels;\n\n    // public readonly filters = this._state.filters;\n    // /** Set filtered date */\n    // public readonly setDate = (date) => this._state.setFilters({ date });\n    // /** Set filtered date */\n    // public readonly setFilters = (filters) => this._state.setFilters(filters);\n    // /** Set filter string */\n    // public readonly setSearch = (str) => this._state.setSearchString(str);\n    // /** Update active zones for desks */\n    // public readonly updateZones = (zones) => {\n    //     this._router.navigate([], {\n    //         relativeTo: this._route,\n    //         queryParams: { zone_ids: zones.join(',') },\n    //     });\n    //     this._state.setFilters({ zones });\n    // };\n\n    constructor(\n        private _state: SignageStateService,\n        private _org: OrganisationService,\n        private _route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) => {\n                if (params.has('zone_ids')) {\n                    const zones = params.get('zone_ids').split(',');\n                    if (zones.length) {\n                        const level = this._org.levelWithID(zones);\n                        if (!level) {\n                            return;\n                        }\n                        this._org.building = this._org.buildings.find(\n                            (bld) => bld.id === level.parent_id\n                        );\n                        this.zones = zones;\n                    }\n                }\n            })\n        );\n        this.subscription(\n            'levels',\n            this._org.active_levels.subscribe((levels) => {\n                this.zones = this.zones.filter((zone) =>\n                    levels.find((lvl) => lvl.id === zone)\n                );\n                if (!this.zones.length && levels.length) {\n                    this.zones.push(levels[0].id);\n                }\n                // this.updateZones(this.zones);\n            })\n        );\n        // this.setSearch('');\n    }\n}\n","import { Component, Input, SimpleChanges, ViewChild } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { SignageStateService } from './signage-state.service';\nimport { SignageMedia } from '@placeos/ts-client';\nimport { CdkDropList } from '@angular/cdk/drag-drop';\nimport { getUnixTime, startOfMinute } from 'date-fns';\n\n@Component({\n    selector: 'signage-media-list',\n    template: `\n        <div class=\"p-4\">\n            <h3 class=\"text-xl font-medium text-center mb-4\">Media</h3>\n            <mat-form-field appearance=\"outline\" class=\"w-full no-subscript\">\n                <input\n                    matInput\n                    placeholder=\"Search...\"\n                    [ngModel]=\"search.getValue()\"\n                    (ngModelChange)=\"search.next($event)\"\n                />\n            </mat-form-field>\n        </div>\n        @if ((media | async)?.length > 0) {\n            <div\n                class=\"grid w-full gap-4 md:grid-cols-2 lg:grid-cols-3 p-4\"\n                cdkDropList\n                id=\"media-list\"\n                [cdkDropListData]=\"media | async\"\n                [cdkDropListConnectedTo]=\"playlist_ids\"\n                (cdkDropListDropped)=\"drop($event)\"\n            >\n                @for (media of media | async; track media.id) {\n                    <div\n                        class=\"relative bg-base-100 rounded-lg flex flex-col items-center justify-center p-3 hover:opacity-80 border border-base-300\"\n                        cdkDrag\n                    >\n                        @if (media.valid_from && now < media.valid_from) {\n                            <div\n                                class=\"absolute inset-0 z-0 bg-warning opacity-10 rounded-lg\"\n                            ></div>\n                        } @else if (\n                            media.valid_until && now > media.valid_until\n                        ) {\n                            <div\n                                class=\"absolute inset-0 z-0 bg-error opacity-10 rounded-lg\"\n                            ></div>\n                        }\n                        <div\n                            class=\"min-h-10 min-w-10 border-4 rounded-2xl border-base-400 bg-base-300 border-dashed flex items-center justify-center\"\n                            *cdkDragPlaceholder\n                        >\n                            <app-icon class=\"text-2xl text-base-100\">\n                                add\n                            </app-icon>\n                        </div>\n                        <div\n                            preview\n                            class=\"relative w-full h-36 bg-base-200 rounded-lg overflow-hidden\"\n                        >\n                            <img\n                                auth\n                                [source]=\"media.thumbnail_url\"\n                                *ngIf=\"media.thumbnail_url\"\n                                class=\"w-full h-full object-contain rounded-lg\"\n                            />\n                            <div\n                                class=\"absolute top-1 left-1 px-2 py-1 text-xs rounded-lg capitalize font-mono\"\n                                [class.bg-info]=\"media.media_type === 'video'\"\n                                [class.text-info-content]=\"\n                                    media.media_type === 'video'\n                                \"\n                                [class.bg-warning]=\"\n                                    media.media_type === 'image'\n                                \"\n                                [class.text-warning-content]=\"\n                                    media.media_type === 'image'\n                                \"\n                            >\n                                {{ media.media_type }}\n                            </div>\n                            <div\n                                class=\"absolute bottom-1 right-1 px-2 py-1 text-xs rounded-lg bg-info text-info-content capitalize font-mono\"\n                                *ngIf=\"media.play_time\"\n                            >\n                                {{ media.play_time / 1000 | mediaDuration }}\n                            </div>\n                        </div>\n                        <div\n                            class=\"flex items-center justify-between w-full relative top-1\"\n                        >\n                            <div\n                                class=\"text-base-content truncate flex-1 w-1/2\"\n                                [matTooltip]=\"media.name\"\n                            >\n                                {{ media.name }}\n                            </div>\n                            <button\n                                icon\n                                matRipple\n                                [matMenuTriggerFor]=\"menu\"\n                                aria-label=\"Media Actions\"\n                            >\n                                <app-icon>more_vert</app-icon>\n                            </button>\n                            <mat-menu #menu=\"matMenu\">\n                                <button mat-menu-item (click)=\"editItem(media)\">\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\"\n                                            >edit</app-icon\n                                        >\n                                        <div class=\"pr-2\">Edit Media Item</div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"previewItem(media)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\"\n                                            >visibility</app-icon\n                                        >\n                                        <div class=\"pr-2\">\n                                            Preview Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"removeItem(media)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl text-error\">\n                                            delete\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Remove Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                            </mat-menu>\n                        </div>\n                    </div>\n                }\n            </div>\n        } @else {\n            <div\n                class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30 mx-auto flex-1\"\n            >\n                <app-icon class=\"text-6xl\">hide_image</app-icon>\n                <p>No media found.</p>\n            </div>\n        }\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignageMediaListComponent {\n    @Input() public playlist_count = 0;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly media = combineLatest([\n        this.search,\n        this._state.media,\n    ]).pipe(\n        map(([search, media]) =>\n            media.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n\n    public playlist_ids: string[] = [];\n\n    public get now() {\n        return getUnixTime(startOfMinute(Date.now()));\n    }\n\n    public readonly previewItem = (item: SignageMedia) =>\n        this._state.previewMedia(item);\n\n    public readonly editItem = (item: SignageMedia) =>\n        this._state.editMedia(item);\n\n    public readonly removeItem = async (item: SignageMedia) =>\n        this._state.removeMedia(item);\n\n    constructor(private _state: SignageStateService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.playlist_count) {\n            this.playlist_ids = new Array(this.playlist_count)\n                .fill(0)\n                .map((_, idx) => `playlist-${idx}`);\n        }\n    }\n\n    public drop(event) {}\n}\n","import { Component, Input, SimpleChanges } from '@angular/core';\nimport { BehaviorSubject, combineLatest, of } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport {\n    catchError,\n    debounceTime,\n    filter,\n    map,\n    shareReplay,\n    startWith,\n    switchMap,\n    take,\n} from 'rxjs/operators';\nimport {\n    listSignagePlaylistMedia,\n    MediaAnimation,\n    SignageMedia,\n} from '@placeos/ts-client';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport { Router } from '@angular/router';\nimport { getUnixTime, startOfMinute } from 'date-fns';\n\n@Component({\n    selector: 'signage-playlist-media-list',\n    template: `\n        <div class=\"flex flex-col space-y-4 relative p-4 h-full w-full\">\n            <h3 class=\"text-xl font-medium text-center\">\n                Playlist - {{ (selected_playlist | async)?.name }}\n            </h3>\n            <button\n                icon\n                matRipple\n                matTooltip=\"Edit Playlist\"\n                class=\"absolute top-2 right-2 !m-0\"\n                (click)=\"editPlaylist()\"\n            >\n                <app-icon>edit</app-icon>\n            </button>\n            <div details class=\"flex items-center flex-wrap\">\n                <div\n                    class=\"ml-2 text-xs px-2 py-1 m-1 rounded\"\n                    [class.bg-success]=\"(selected_playlist | async)?.enabled\"\n                    [class.text-success-content]=\"\n                        (selected_playlist | async)?.enabled\n                    \"\n                    [class.bg-error]=\"!(selected_playlist | async)?.enabled\"\n                    [class.text-error-content]=\"\n                        !(selected_playlist | async)?.enabled\n                    \"\n                >\n                    {{\n                        (selected_playlist | async)?.enabled\n                            ? 'Enabled'\n                            : 'Disabled'\n                    }}\n                </div>\n                <div\n                    class=\"ml-2 text-xs px-2 py-1 m-1 rounded bg-secondary text-secondary-content\"\n                    *ngIf=\"(selected_playlist | async)?.random\"\n                >\n                    Shuffle ON\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1 \"\n                    matTooltip=\"Default Transition Animation\"\n                >\n                    Animation:\n                    <span\n                        class=\"ml-1 uppercase bg-base-200 px-2 py-1 rounded\"\n                        >{{\n                            animation_name(\n                                (selected_playlist | async)?.default_animation\n                            )\n                        }}</span\n                    >\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1\"\n                    matTooltip=\"Default Playback Duration\"\n                >\n                    Duration:\n                    <span\n                        class=\"ml-1 font-mono bg-base-200 px-2 py-1 rounded\"\n                        >{{\n                            (selected_playlist | async)?.default_duration / 1000\n                                | mediaDuration\n                        }}</span\n                    >\n                </div>\n                <div\n                    class=\"text-xs px-2 py-1 m-1\"\n                    matTooltip=\"Prefered Orientation\"\n                >\n                    Orientation:\n                    <span\n                        class=\"ml-1 uppercase bg-base-200 px-2 py-1 rounded\"\n                        >{{ (selected_playlist | async)?.orientation }}</span\n                    >\n                </div>\n            </div>\n            @if ((media | async).length > 0) {\n                <div\n                    cdkDropList\n                    class=\"flex-1 h-1/2 overflow-auto flex flex-col space-y-2\"\n                    id=\"playlist-list\"\n                    [cdkDropListData]=\"media | async\"\n                    [cdkDropListConnectedTo]=\"playlist_ids\"\n                    (cdkDropListDropped)=\"drop($event)\"\n                >\n                    <ng-container *ngFor=\"let item of media | async\">\n                        <div\n                            cdkDrag\n                            class=\"relative w-full bg-base-100 h-20 rounded-lg flex items-center p-2 space-x-2 border border-base-300\"\n                        >\n                            @if (item.valid_from && now < item.valid_from) {\n                                <div\n                                    class=\"absolute inset-0 z-0 bg-warning opacity-10 rounded-lg\"\n                                ></div>\n                            } @else if (\n                                item.valid_until && now > item.valid_until\n                            ) {\n                                <div\n                                    class=\"absolute inset-0 z-0 bg-error opacity-10 rounded-lg\"\n                                ></div>\n                            }\n                            <div\n                                class=\"min-h-10 min-w-10 border-4 rounded-2xl border-base-400 bg-base-300 border-dashed flex items-center justify-center\"\n                                *cdkDragPlaceholder\n                            >\n                                <app-icon class=\"text-2xl text-base-100\">\n                                    add\n                                </app-icon>\n                            </div>\n                            <button\n                                matRipple\n                                cdkDragHandle\n                                class=\"flex items-center justify-center w-6 h-full rounded hover:bg-base-200\"\n                                matTooltip=\"Drag to reorder\"\n                            >\n                                <app-icon>drag_handle</app-icon>\n                            </button>\n                            <div\n                                preview\n                                class=\"w-[4.5rem] h-16 bg-base-200 rounded-lg overflow-hidden\"\n                            >\n                                <img\n                                    auth\n                                    [source]=\"item.thumbnail_url\"\n                                    class=\"w-full h-full object-contain\"\n                                />\n                            </div>\n                            <div\n                                class=\"text-base-content truncate flex-1 w-1/2\"\n                            >\n                                {{ item.name }}\n                            </div>\n                            <button\n                                icon\n                                matRipple\n                                aria-label=\"Media Actions\"\n                                [matMenuTriggerFor]=\"menu\"\n                            >\n                                <app-icon>more_vert</app-icon>\n                            </button>\n                            <mat-menu #menu=\"matMenu\">\n                                <button mat-menu-item (click)=\"editItem(item)\">\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\">\n                                            edit\n                                        </app-icon>\n                                        <div class=\"pr-2\">Edit Media Item</div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"previewItem(item)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl\">\n                                            visibility\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Preview Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                                <button\n                                    mat-menu-item\n                                    (click)=\"removeItem(item)\"\n                                >\n                                    <div class=\"flex items-center space-x-2\">\n                                        <app-icon class=\"text-2xl text-error\">\n                                            delete\n                                        </app-icon>\n                                        <div class=\"pr-2\">\n                                            Remove Media Item\n                                        </div>\n                                    </div>\n                                </button>\n                            </mat-menu>\n                        </div>\n                    </ng-container>\n                </div>\n            } @else {\n                <div\n                    class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30 mx-auto flex-1\"\n                >\n                    <app-icon class=\"text-6xl\">hide_image</app-icon>\n                    <p>No media in playlist.</p>\n                </div>\n            }\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignagePlaylistMediaListComponent {\n    @Input() public playlist = '';\n    @Input() public playlist_count = 0;\n\n    public playlist_ids: string[] = [];\n\n    private _playlist = new BehaviorSubject<string>('');\n\n    public readonly editPlaylist = async () => {\n        const playlist = await this.selected_playlist.pipe(take(1)).toPromise();\n        this._state.editPlaylist(playlist);\n    };\n\n    public readonly removeItem = async (item: SignageMedia) => {\n        const playlist = await this._playlist_media.pipe(take(1)).toPromise();\n        const list = playlist.items.filter((_) => _ !== item.id);\n        await this._state.updatePlaylistMedia(this.playlist, list);\n        this._playlist.next(this.playlist);\n    };\n\n    public readonly previewItem = (item: SignageMedia) =>\n        this._state.previewMedia(item);\n\n    public readonly editItem = (item: SignageMedia) =>\n        this._state.editMedia(item);\n\n    public readonly selected_playlist = combineLatest([\n        this._playlist,\n        this._state.playlists,\n    ]).pipe(\n        map(([playlist, list]) => {\n            const item = list.find((_) => _.id === playlist);\n            if (!item) this._router.navigate(['/signage/media', {}]);\n            return item;\n        }),\n    );\n\n    private _playlist_media = this._playlist.pipe(\n        filter((playlist) => !!playlist),\n        debounceTime(300),\n        switchMap((playlist) =>\n            listSignagePlaylistMedia(playlist).pipe(\n                catchError(() => of({ id: '', items: [] })),\n            ),\n        ),\n        shareReplay(1),\n    );\n\n    public readonly media = combineLatest([\n        this._playlist_media,\n        this._state.media,\n    ]).pipe(\n        map(([playlist, media]) =>\n            playlist.items\n                .map((_) => media.find((m) => m.id === _))\n                .filter((_) => _),\n        ),\n        startWith([]),\n    );\n\n    public get now() {\n        return getUnixTime(startOfMinute(Date.now()));\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n    ) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.playlist) {\n            this._playlist.next(this.playlist);\n        }\n        if (changes.playlist_count) {\n            this.playlist_ids = new Array(this.playlist_count)\n                .fill(0)\n                .map((_, idx) => `playlist-${idx}`);\n        }\n    }\n\n    public animation_name(value: MediaAnimation) {\n        switch (value) {\n            case MediaAnimation.Cut:\n                return 'Cut';\n            case MediaAnimation.CrossFade:\n                return 'Cross Fade';\n            case MediaAnimation.SlideBottom:\n                return 'Slide Bottom';\n            case MediaAnimation.SlideLeft:\n                return 'Slide Left';\n            case MediaAnimation.SlideRight:\n                return 'Slide Right';\n            case MediaAnimation.SlideTop:\n                return 'Slide Top';\n        }\n        return 'Default';\n    }\n\n    public async drop(event: CdkDragDrop<SignageMedia[]>) {\n        if (event.previousIndex === event.currentIndex) return;\n        const id = await this._playlist.pipe(take(1)).toPromise();\n        const playlist = await this._playlist_media.pipe(take(1)).toPromise();\n        if (!id && playlist) return;\n        const list = [...playlist.items];\n        moveItemInArray(list, event.previousIndex, event.currentIndex);\n        await this._state.updatePlaylistMedia(id, list);\n        this._playlist.next(this.playlist);\n    }\n}\n","import { Component, ViewChild } from '@angular/core';\n\nimport { SignageStateService } from './signage-state.service';\nimport { AsyncHandler, unique } from '@placeos/common';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { SignageMediaListComponent } from './signage-media-list.component';\nimport { listSignagePlaylistMedia, SignagePlaylist } from '@placeos/ts-client';\nimport { CdkDragDrop } from '@angular/cdk/drag-drop';\n\n@Component({\n    selector: 'signage-media',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div sidebar class=\"w-64 h-full flex flex-col space-y-4 py-4\">\n                <h3 class=\"text-xl font-medium text-center\">Playlists</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                <a\n                    matRipple\n                    class=\"w-full px-6 rounded-3xl h-12 flex items-center hover:bg-base-200\"\n                    [class.!bg-secondary]=\"!selected_playlist\"\n                    [class.text-secondary-content]=\"!selected_playlist\"\n                    [routerLink]=\"[]\"\n                    [queryParams]=\"{ playlist: '' }\"\n                >\n                    All Media\n                </a>\n                <hr class=\"w-full\" />\n                @if ((playlists | async)?.length > 0) {\n                    @for (playlist of playlists | async; track playlist.id) {\n                        <a\n                            matRipple\n                            class=\"w-full px-6 rounded-3xl h-12 flex items-center hover:bg-base-200\"\n                            [class.!bg-secondary]=\"\n                                selected_playlist === playlist.id\n                            \"\n                            [class.text-secondary-content]=\"\n                                selected_playlist === playlist.id\n                            \"\n                            [routerLink]=\"[]\"\n                            [queryParams]=\"{ playlist: playlist.id }\"\n                            cdkDropList\n                            [id]=\"'playlist-' + $index\"\n                            [cdkDropListConnectedTo]=\"[\n                                'media-list',\n                                'playlist-list',\n                            ]\"\n                            (cdkDropListDropped)=\"\n                                selected_playlist === playlist.id\n                                    ? ''\n                                    : drop(playlist, $event)\n                            \"\n                        >\n                            <div class=\"flex-1\">\n                                {{ playlist.name }}\n                            </div>\n                        </a>\n                    }\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching playlists found'\n                                    : 'No playlists'\n                            }}\n                        </p>\n                    </div>\n                    <button\n                        *ngIf=\"!search.getValue()\"\n                        btn\n                        matRipple\n                        class=\"inverse\"\n                        (click)=\"addPlaylist()\"\n                    >\n                        <div class=\"flex items-center justify-center w-full\">\n                            <app-icon class=\"text-2xl\">add</app-icon>\n                            <span class=\"ml-2 mr-4\">Add Playlist</span>\n                        </div>\n                    </button>\n                }\n            </div>\n            <div\n                class=\"relative flex-1 w-1/2 h-full overflow-hidden rounded-lg border border-base-300 shadow\"\n                (dragover)=\"onEnter($event)\"\n                (dragenter)=\"onEnter($event)\"\n                (window:drop)=\"hideOverlay($event)\"\n            >\n                <div class=\"h-full w-full overflow-auto\">\n                    <signage-media-list\n                        *ngIf=\"!selected_playlist\"\n                        [playlist_count]=\"(playlists | async)?.length\"\n                    ></signage-media-list>\n                    <signage-playlist-media-list\n                        *ngIf=\"selected_playlist\"\n                        [playlist]=\"selected_playlist\"\n                        [playlist_count]=\"(playlists | async)?.length\"\n                    ></signage-playlist-media-list>\n                </div>\n                <div\n                    class=\"absolute inset-0\"\n                    *ngIf=\"show_dropzone\"\n                    (dragleave)=\"hideOverlay($event)\"\n                    (drop)=\"previewFile($event)\"\n                >\n                    <div\n                        class=\"absolute inset-0 bg-base-content opacity-60\"\n                    ></div>\n                    <div\n                        class=\"absolute inset-4 border-4 border-dashed border-base-300 flex flex-col items-center justify-center rounded-2xl text-base-100 space-y-4\"\n                    >\n                        <app-icon class=\"text-6xl\">cloud_upload</app-icon>\n                        <p>Drop Media to upload</p>\n                    </div>\n                    <input\n                        type=\"file\"\n                        (change)=\"previewFile($event)\"\n                        class=\"absolute inset-0 opacity-0\"\n                    />\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                min-height: 100%;\n            }\n        `,\n    ],\n})\nexport class SignageMediaComponent extends AsyncHandler {\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly playlists = combineLatest([\n        this.search,\n        this._state.playlists,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public selected_playlist = '';\n    public show_dropzone = false;\n\n    public readonly addPlaylist = async () => {\n        const result = await this._state.editPlaylist();\n        if (result) {\n            this._router.navigate([\n                '/signage/media',\n                { query: { playlist: result.id } },\n            ]);\n        }\n    };\n    public readonly previewMedia = (item) => this._state.previewMedia(item);\n    public readonly previewFile = (event) =>\n        this._state.previewFileFromInput(event, this.selected_playlist);\n\n    public onEnter(e) {\n        this.clearTimeout('hide_overlay');\n        this.show_dropzone = e?.dataTransfer?.types.includes('Files');\n    }\n\n    public hideOverlay(e) {\n        if (!this.show_dropzone) return;\n        if (!(e.target instanceof HTMLInputElement)) {\n            e.preventDefault();\n        }\n        this.timeout('hide_overlay', () => (this.show_dropzone = false));\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _router: Router,\n        private _route: ActivatedRoute,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                if (params.has('playlist')) {\n                    this.selected_playlist = params.get('playlist');\n                }\n            }),\n        );\n    }\n\n    public async drop(\n        playlist: SignagePlaylist,\n        event: CdkDragDrop<SignagePlaylist[]>,\n    ) {\n        const media = event.previousContainer.data[event.previousIndex];\n        const media_list = await listSignagePlaylistMedia(\n            playlist.id,\n        ).toPromise();\n        const new_media_list = [...media_list.items, media.id];\n        await this._state.updatePlaylistMedia(playlist.id, new_media_list);\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n    TemplateRef,\n} from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\n@Component({\n    selector: 'search-overlay',\n    template: `\n        <div\n            class=\"absolute inset-0 flex flex-col p-8 items-center\"\n            (click)=\"close.next()\"\n            (window:keydown.esc)=\"close.next()\"\n        >\n            <div class=\"absolute inset-0 bg-base-content opacity-70 z-0\"></div>\n            <div\n                class=\"relative mb-4 w-[32rem] max-w-[calc(100%-2rem)] mx-auto z-10\"\n                (click)=\"$event.stopPropagation()\"\n            >\n                <input\n                    class=\"rounded-[4rem] text-xl text-base-content bg-base-100 border border-base-300 shadow pl-14 pr-6 py-4 w-full\"\n                    [ngModel]=\"search.getValue()\"\n                    (ngModelChange)=\"search.next($event)\"\n                    placeholder=\"Search...\"\n                />\n                <app-icon\n                    class=\"absolute left-3 top-1/2 -translate-y-1/2 text-3xl pointer-events-none\"\n                >\n                    search\n                </app-icon>\n            </div>\n            <div\n                class=\"overflow-auto max-h-[65%] w-[32rem] max-w-[calc(100%-2rem)] mx-auto rounded z-10\"\n                (click)=\"$event.stopPropagation()\"\n            >\n                @for (item of item_list; track item) {\n                    <button\n                        matRipple\n                        class=\"w-full text-left\"\n                        (click)=\"selected.next(item)\"\n                    >\n                        @if (result_template) {\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    result_template;\n                                    context: { item: item }\n                                \"\n                            ></ng-container>\n                        } @else {\n                            <div\n                                class=\"p-4 w-full bg-base-100 hover:bg-base-200 border border-base-300\"\n                            >\n                                {{ item.name || item }}\n                            </div>\n                        }\n                    </button>\n                }\n                @if (!item_list?.length) {\n                    <button\n                        matRipple\n                        class=\"w-full p-4 text-base-100\"\n                        (click)=\"close.next()\"\n                    >\n                        <div class=\"opacity-30\">\n                            No items available to select\n                        </div>\n                    </button>\n                }\n            </div>\n            <button\n                icon\n                matRipple\n                class=\"absolute top-10 right-8 text-base-100 text-xl h-12 w-12\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SearchOverlayComponent<T extends {} = any> {\n    @Input() public item_list: T[] = [];\n    @Input() public result_template: TemplateRef<any>;\n\n    @Output() public selected = new EventEmitter<T>();\n    @Output() public close = new EventEmitter<void>();\n\n    public readonly search = new BehaviorSubject('');\n    private _items = new BehaviorSubject<T[]>([]);\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item_list) {\n            this._items.next(this.item_list || []);\n        }\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport { map, startWith } from 'rxjs/operators';\nimport { SignagePlaylist } from '@placeos/ts-client';\n\n@Component({\n    selector: `signage-item-playlists`,\n    template: `\n        <div class=\"flex items-center justify-center space-x-2\">\n            <h3 class=\"text-xl font-medium\">\n                {{ item?.display_name || item?.name }}\n            </h3>\n            <div\n                *ngIf=\"extra\"\n                class=\"px-2 py-1 text-xs font-mono bg-base-200 rounded-lg uppercase\"\n            >\n                {{ extra }}\n            </div>\n            <a\n                icon\n                matRipple\n                [href]=\"link + item.id\"\n                *ngIf=\"link\"\n                target=\"_blank\"\n                ref=\"noopener noreferrer\"\n            >\n                <app-icon>link</app-icon>\n            </a>\n        </div>\n        <ng-content></ng-content>\n        @if ((active_playlists | async).length > 0 && item) {\n            <div\n                cdkDropList\n                class=\"flex-1 h-1/2 overflow-auto flex flex-col space-y-2 mt-4\"\n                (cdkDropListDropped)=\"ondrop.next($event)\"\n            >\n                @for (item of active_playlists | async; track item.id) {\n                    <div\n                        cdkDrag\n                        class=\"w-full bg-base-100 h-20 rounded-lg flex items-center p-2 space-x-2 border border-base-300\"\n                    >\n                        <div\n                            class=\"h-20 w-full border-4 border-dashed border-base-400 bg-base-300 rounded-xl\"\n                            *cdkDragPlaceholder\n                        ></div>\n                        <button\n                            matRipple\n                            cdkDragHandle\n                            class=\"flex items-center justify-center w-6 h-full rounded hover:bg-base-200\"\n                            matTooltip=\"Drag to reorder\"\n                        >\n                            <app-icon>drag_handle</app-icon>\n                        </button>\n                        <div class=\"text-base-content flex-1 w-1/2\">\n                            <div class=\"truncate\">\n                                {{ item.name }}\n                            </div>\n                            <div class=\"truncate text-sm opacity-30\">\n                                {{ item.media_count || 0 }} Media items\n                            </div>\n                        </div>\n                        <button\n                            icon\n                            matRipple\n                            aria-label=\"Media Actions\"\n                            [matMenuTriggerFor]=\"menu\"\n                        >\n                            <app-icon>more_vert</app-icon>\n                        </button>\n                        <mat-menu #menu=\"matMenu\">\n                            <a\n                                mat-menu-item\n                                [routerLink]=\"['/signage', 'media']\"\n                                [queryParams]=\"{\n                                    playlist: item.id,\n                                }\"\n                            >\n                                <div class=\"flex items-center space-x-2\">\n                                    <app-icon class=\"text-2xl\">\n                                        visibility\n                                    </app-icon>\n                                    <div class=\"pr-2\">View Playlist</div>\n                                </div>\n                            </a>\n                            <button mat-menu-item (click)=\"remove.next(item)\">\n                                <div class=\"flex items-center space-x-2\">\n                                    <app-icon class=\"text-2xl text-error\">\n                                        delete\n                                    </app-icon>\n                                    <div class=\"pr-2\">Remove Playlist</div>\n                                </div>\n                            </button>\n                        </mat-menu>\n                    </div>\n                }\n            </div>\n            <button btn matRipple (click)=\"add.emit()\">Add Playlist</button>\n        } @else {\n            <div\n                class=\"flex flex-col items-center justify-center p-8 space-y-2 mx-auto flex-1\"\n            >\n                <div\n                    class=\"flex flex-col items-center justify-center opacity-30\"\n                >\n                    <app-icon class=\"text-6xl\">hide_image</app-icon>\n                    <p>No playlists in {{ name }}.</p>\n                </div>\n                <button btn matRipple (click)=\"add.emit()\" class=\"w-40\">\n                    Add Playlist\n                </button>\n            </div>\n        }\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n            }\n        `,\n    ],\n})\nexport class SignageItemPlaylistsComponent {\n    @Input() public item: any;\n    @Input() public name: string = 'zone';\n    @Input() public extra: string = '';\n    @Input() public link: string = '';\n    @Output() public readonly add = new EventEmitter();\n    @Output() public readonly remove = new EventEmitter<SignagePlaylist>();\n    @Output() public readonly ondrop = new EventEmitter<any>();\n\n    private _playlist_ids = new BehaviorSubject<string[]>([]);\n\n    public readonly active_playlists = combineLatest([\n        this._state.playlists,\n        this._playlist_ids,\n        this._state.has_changed,\n    ]).pipe(\n        map(([playlists, ids]) =>\n            ids.map((id) => playlists.find((_) => _.id === id)),\n        ),\n        startWith([]),\n    );\n\n    constructor(private _state: SignageStateService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item) {\n            this._playlist_ids.next(this.item?.playlists || []);\n        }\n    }\n}\n","import { Component } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport {\n    debounce,\n    debounceTime,\n    map,\n    shareReplay,\n    startWith,\n    switchMap,\n    take,\n    tap,\n} from 'rxjs/operators';\nimport { ActivatedRoute } from '@angular/router';\nimport {\n    AsyncHandler,\n    notifySuccess,\n    SettingsService,\n    unique,\n} from '@placeos/common';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport {\n    listSystemTriggers,\n    SignagePlaylist,\n    updateSystem,\n    updateTrigger,\n} from '@placeos/ts-client';\n\n@Component({\n    selector: 'signage-displays',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div sidebar class=\"w-64 h-full flex flex-col space-y-4 py-4\">\n                <h3 class=\"text-xl font-medium text-center\">Displays</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                @if ((displays | async)?.length > 0) {\n                    <div class=\"h-1/2 flex-1 w-full overflow-auto space-y-2\">\n                        @for (display of displays | async; track display.id) {\n                            <a\n                                matRipple\n                                class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate z-10\"\n                                [class.!bg-secondary]=\"\n                                    selected.getValue() === display.id\n                                \"\n                                [class.text-secondary-content]=\"\n                                    selected.getValue() === display.id\n                                \"\n                                [routerLink]=\"[]\"\n                                [queryParams]=\"{ display: display.id }\"\n                            >\n                                {{ display.display_name || display.name }}\n                            </a>\n                            @if (\n                                (active_display | async)?.id === display.id &&\n                                !switching\n                            ) {\n                                @for (\n                                    trigger of triggers | async;\n                                    track trigger.id\n                                ) {\n                                    <div\n                                        class=\"relative flex items-center space-x-2 z-0\"\n                                    >\n                                        <div class=\"w-6\">\n                                            <div\n                                                class=\"absolute h-16 w-4 border-b-2 border-l-2 border-base-300 top-1/2 left-6 -translate-y-full\"\n                                            ></div>\n                                        </div>\n                                        <a\n                                            matRipple\n                                            class=\"w-1/2 flex-1 px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate\"\n                                            [class.!bg-secondary]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [class.text-secondary-content]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [routerLink]=\"[]\"\n                                            [queryParams]=\"{\n                                                display: display.id,\n                                                trigger: trigger?.id,\n                                            }\"\n                                        >\n                                            <span class=\"max-w-full truncate\">{{\n                                                trigger?.display_name ||\n                                                    trigger?.name ||\n                                                    'Trigger'\n                                            }}</span>\n                                        </a>\n                                    </div>\n                                }\n                            }\n                        }\n                    </div>\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching displays found'\n                                    : 'No displays'\n                            }}\n                        </p>\n                    </div>\n                }\n            </div>\n            <div\n                class=\"relative flex flex-col flex-1 w-1/2 h-full overflow-auto rounded-lg border border-base-300 p-4 shadow space-y-4\"\n            >\n                @if (active_display | async) {\n                    <signage-item-playlists\n                        class=\"flex flex-col flex-1\"\n                        [item]=\"\n                            (active_trigger | async) || (active_display | async)\n                        \"\n                        [name]=\"\n                            (active_trigger | async) ? 'trigger' : 'display'\n                        \"\n                        [extra]=\"\n                            (active_trigger | async)\n                                ? ''\n                                : (active_display | async)?.orientation\n                        \"\n                        [link]=\"\n                            (active_trigger | async)\n                                ? ''\n                                : signage_path + '/#/signage/'\n                        \"\n                        (add)=\"this.adding = true\"\n                        (remove)=\"removePlaylist($event)\"\n                        (ondrop)=\"drop($event)\"\n                    >\n                        <div\n                            class=\"flex flex-wrap items-center overflow-auto mt-4\"\n                            *ngIf=\"!(active_trigger | async)\"\n                        >\n                            @for (\n                                zone of (active_display | async)?.zones;\n                                track zone\n                            ) {\n                                <a\n                                    class=\"px-2 py-1 font-mono text-xs bg-base-200 rounded whitespace-nowrap m-1\"\n                                    matRipple\n                                    [routerLink]=\"['/signage', 'zones']\"\n                                    [queryParams]=\"{ zone: zone }\"\n                                >\n                                    {{\n                                        (zone | zone | async)?.display_name ||\n                                            (zone | zone | async)?.name\n                                    }}\n                                </a>\n                            }\n                            <button\n                                class=\"underline font-mono text-xs px-2 py-1 rounded m-1\"\n                                matRipple\n                            >\n                                Add Zone\n                            </button>\n                        </div>\n                    </signage-item-playlists>\n                } @else {\n                    <div\n                        class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">desktop_windows</app-icon>\n                        <p>Select a display from the left to view playlists</p>\n                    </div>\n                }\n                <search-overlay\n                    *ngIf=\"adding\"\n                    [item_list]=\"playlists | async\"\n                    (selected)=\"addPlaylist($event)\"\n                    (close)=\"adding = false\"\n                ></search-overlay>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SignageDisplaysComponent extends AsyncHandler {\n    public adding = false;\n    public switching = false;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly displays = combineLatest([\n        this.search,\n        this._state.displays,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public readonly selected = new BehaviorSubject('');\n    public readonly selected_trigger = new BehaviorSubject('');\n    public readonly active_display = combineLatest([\n        this.displays,\n        this.selected,\n    ]).pipe(map(([displays, id]) => displays.find((item) => item.id === id)));\n\n    public readonly triggers = this.selected.pipe(\n        switchMap((id) => listSystemTriggers(id)),\n        map((_) => _.data),\n        tap((_) => setTimeout(() => (this.switching = false), 200)),\n        shareReplay(1),\n    );\n\n    public readonly active_trigger = combineLatest([\n        this.triggers,\n        this.selected_trigger,\n        this.selected,\n    ]).pipe(\n        map(([list, id, sys_id]) =>\n            list.find(\n                (item) => item.id === id && item.control_system_id === sys_id,\n            ),\n        ),\n    );\n\n    public readonly playlists = combineLatest([\n        this.active_display,\n        this.active_trigger,\n        this._state.playlists,\n        this._state.has_changed,\n    ]).pipe(\n        map(([display, trigger, playlists]) =>\n            playlists.filter(\n                (_) =>\n                    !(trigger || display)?.playlists.find((id) => _.id === id),\n            ),\n        ),\n    );\n\n    public get signage_path() {\n        return this._settings.get('app.signage_path') || '/signage';\n    }\n\n    constructor(\n        private _state: SignageStateService,\n        private _route: ActivatedRoute,\n        private _settings: SettingsService,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                this.switching =\n                    params.get('display') !== this.selected.getValue();\n                this.selected.next(params.get('display') || '');\n                this.selected_trigger.next(params.get('trigger') || '');\n            }),\n        );\n    }\n\n    public async addPlaylist(playlist: SignagePlaylist) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const playlists = [...item.playlists, playlist.id];\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(\n            item.id,\n            { playlists, version: display.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully added playlist to the ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const playlists = item.playlists.filter((id) => playlist.id !== id);\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(\n            item.id,\n            { playlists, version: display.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully removed playlist from ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async drop(event: CdkDragDrop<SignagePlaylist[]>) {\n        const display = await this.active_display.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || display;\n        const old_playlist = item.playlists;\n        const playlists = [...old_playlist];\n        moveItemInArray(playlists, event.previousIndex, event.currentIndex);\n        (item as any).playlists = playlists;\n        this._state.changed();\n        const method: any = trigger ? updateTrigger : updateSystem;\n        await method(item.id, { playlists, version: display.version }, 'patch')\n            .toPromise()\n            .catch((e) => {\n                (item as any).playlists = old_playlist;\n                this._state.changed();\n                throw e;\n            });\n        notifySuccess(\n            `Successfully re-ordered playlists on ${trigger ? 'trigger' : 'display'}`,\n        );\n        this._state.changed();\n    }\n}\n","import { Component } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { SignageStateService } from './signage-state.service';\nimport {\n    map,\n    shareReplay,\n    startWith,\n    switchMap,\n    take,\n    tap,\n} from 'rxjs/operators';\nimport { ActivatedRoute } from '@angular/router';\nimport { AsyncHandler, notifySuccess, unique } from '@placeos/common';\nimport { CdkDragDrop, moveItemInArray } from '@angular/cdk/drag-drop';\nimport {\n    listZoneTriggers,\n    SignagePlaylist,\n    updateTrigger,\n    updateZone,\n} from '@placeos/ts-client';\n\n@Component({\n    selector: 'signage-zones',\n    template: `\n        <div class=\"relative h-full w-full overflow-visible flex space-x-4\">\n            <div sidebar class=\"w-64 h-full flex flex-col space-y-4 py-4\">\n                <h3 class=\"text-xl font-medium text-center\">Zones</h3>\n                <mat-form-field\n                    appearance=\"outline\"\n                    class=\"w-full no-subscript\"\n                >\n                    <input\n                        matInput\n                        placeholder=\"Search...\"\n                        [ngModel]=\"search.getValue()\"\n                        (ngModelChange)=\"search.next($event)\"\n                    />\n                </mat-form-field>\n                @if ((zones | async)?.length > 0) {\n                    <div class=\"h-1/2 flex-1 w-full overflow-auto space-y-2\">\n                        @for (zone of zones | async; track zone.id) {\n                            <a\n                                matRipple\n                                class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate z-10\"\n                                [class.!bg-secondary]=\"\n                                    selected.getValue() === zone.id\n                                \"\n                                [class.text-secondary-content]=\"\n                                    selected.getValue() === zone.id\n                                \"\n                                [routerLink]=\"[]\"\n                                [queryParams]=\"{ zone: zone.id }\"\n                            >\n                                {{ zone.display_name || zone.name }}\n                            </a>\n                            @if (\n                                (active_zone | async)?.id === zone.id &&\n                                !switching\n                            ) {\n                                @for (\n                                    trigger of triggers | async;\n                                    track trigger.id\n                                ) {\n                                    <div\n                                        class=\"relative flex items-center space-x-2 z-0\"\n                                    >\n                                        <div class=\"w-6\">\n                                            <div\n                                                class=\"absolute h-16 w-4 border-b-2 border-l-2 border-base-300 top-1/2 left-6 -translate-y-full\"\n                                            ></div>\n                                        </div>\n                                        <a\n                                            matRipple\n                                            class=\"w-full px-6 rounded-3xl min-h-12 flex items-center hover:bg-base-200 truncate\"\n                                            [class.!bg-secondary]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [class.text-secondary-content]=\"\n                                                selected_trigger.getValue() ===\n                                                trigger?.id\n                                            \"\n                                            [routerLink]=\"[]\"\n                                            [queryParams]=\"{\n                                                zone: zone.id,\n                                                trigger: trigger?.id,\n                                            }\"\n                                        >\n                                            {{\n                                                trigger?.display_name ||\n                                                    trigger?.name ||\n                                                    'Trigger'\n                                            }}\n                                        </a>\n                                    </div>\n                                }\n                            }\n                        }\n                    </div>\n                } @else {\n                    <div\n                        class=\"flex flex-col items-center justify-center p-8 space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">hide_image</app-icon>\n                        <p class=\"text-center\">\n                            {{\n                                search.getValue()\n                                    ? 'No matching zones found'\n                                    : 'No zones'\n                            }}\n                        </p>\n                    </div>\n                }\n            </div>\n            <div\n                class=\"relative flex flex-col flex-1 w-1/2 h-full overflow-auto rounded-lg border border-base-300 p-4 shadow space-y-4\"\n            >\n                @if (active_zone | async) {\n                    <signage-item-playlists\n                        class=\"flex flex-col flex-1\"\n                        [item]=\"\n                            (active_trigger | async) || (active_zone | async)\n                        \"\n                        [name]=\"(active_trigger | async) ? 'trigger' : 'zone'\"\n                        (add)=\"this.adding = true\"\n                        (remove)=\"removePlaylist($event)\"\n                        (ondrop)=\"drop($event)\"\n                    ></signage-item-playlists>\n                } @else {\n                    <div\n                        class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2 opacity-30\"\n                    >\n                        <app-icon class=\"text-6xl\">desktop_windows</app-icon>\n                        <p>Select a zone from the left to view playlists</p>\n                    </div>\n                }\n                <search-overlay\n                    *ngIf=\"adding\"\n                    [item_list]=\"playlists | async\"\n                    (selected)=\"addPlaylist($event)\"\n                    (close)=\"adding = false\"\n                ></search-overlay>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class SignageZonesComponent extends AsyncHandler {\n    public adding = false;\n    public switching = false;\n    public readonly search = new BehaviorSubject<string>('');\n    public readonly loading = this._state.loading;\n    public readonly zones = combineLatest([\n        this.search,\n        this._state.zones,\n    ]).pipe(\n        map(([search, list]) =>\n            list.filter((_) =>\n                _.name.toLowerCase().includes(search.toLowerCase()),\n            ),\n        ),\n    );\n    public readonly selected = new BehaviorSubject('');\n    public readonly selected_trigger = new BehaviorSubject('');\n    public readonly active_zone = combineLatest([\n        this.zones,\n        this.selected,\n    ]).pipe(map(([zones, id]) => zones.find((item) => item.id === id)));\n\n    public readonly triggers = this.selected.pipe(\n        switchMap((id) => listZoneTriggers(id)),\n        map((_) => _.data),\n        tap((_) => setTimeout(() => (this.switching = false), 100)),\n        shareReplay(1),\n    );\n\n    public readonly active_trigger = combineLatest([\n        this.triggers,\n        this.selected_trigger,\n    ]).pipe(map(([list, id]) => list.find((item) => item.id === id)));\n\n    public readonly playlists = combineLatest([\n        this.active_zone,\n        this.active_trigger,\n        this._state.playlists,\n        this._state.has_changed,\n    ]).pipe(\n        map(([zone, trigger, playlists]) =>\n            playlists.filter(\n                (_) => !(trigger || zone)?.playlists.find((id) => _.id === id),\n            ),\n        ),\n    );\n\n    constructor(\n        private _state: SignageStateService,\n        private _route: ActivatedRoute,\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.queryParamMap.subscribe((params) => {\n                this.switching =\n                    params.get('zone') !== this.selected.getValue();\n                this.selected.next(params.get('zone') || '');\n                this.selected_trigger.next(params.get('trigger') || '');\n            }),\n        );\n    }\n\n    public async addPlaylist(playlist: SignagePlaylist) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const playlists = [...item.playlists, playlist.id];\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(\n            item.id,\n            { playlists, version: zone.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully added playlist to the ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async removePlaylist(playlist: SignagePlaylist) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const playlists = item.filter((id) => playlist.id !== id);\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(\n            item.id,\n            { playlists, version: zone.version },\n            'patch',\n        ).toPromise();\n        notifySuccess(\n            `Successfully removed playlist from ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n        this.adding = false;\n    }\n\n    public async drop(event: CdkDragDrop<SignagePlaylist[]>) {\n        const zone = await this.active_zone.pipe(take(1)).toPromise();\n        const trigger = await this.active_trigger.pipe(take(1)).toPromise();\n        const item = trigger || zone;\n        const old_playlist = item.playlists;\n        const playlists = [...old_playlist];\n        moveItemInArray(playlists, event.previousIndex, event.currentIndex);\n        (item as any).playlists = playlists;\n        this._state.changed();\n        const method: any = trigger ? updateTrigger : updateZone;\n        await method(item.id, { playlists, version: zone.version }, 'patch')\n            .toPromise()\n            .catch((e) => {\n                (item as any).playlists = old_playlist;\n                this._state.changed();\n                throw e;\n            });\n        notifySuccess(\n            `Successfully re-ordered playlists on ${trigger ? 'trigger' : 'zone'}`,\n        );\n        this._state.changed();\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule, Route } from '@angular/router';\nimport { DragDropModule } from '@angular/cdk/drag-drop';\n\nimport { UIModule } from '../ui/ui.module';\nimport { SignageComponent } from './signage.component';\nimport { SignageTopbarComponent } from './signage-topbar.component';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { SignageMediaComponent } from './signage-media.component';\nimport { SignageMediaPreviewModalComponent } from './signage-media-preview-modal.component';\nimport { ComponentsModule } from '@placeos/components';\nimport { SignagePlaylistModalComponent } from './signage-playlist-modal.component';\nimport { SignagePlaylistMediaListComponent } from './signage-playlist-media-list.component';\nimport { SignageMediaListComponent } from './signage-media-list.component';\nimport { SignageDisplaysComponent } from './signage-displays.component';\nimport { SearchOverlayComponent } from './search-overlay.component';\nimport { SignageZonesComponent } from './signage-zones.component';\nimport { SignageItemPlaylistsComponent } from './signage-item-playlists.component';\nimport { SignageMediaModalComponent } from './signage-media-modal.component';\n\nconst ROUTES: Route[] = [\n    {\n        path: '',\n        component: SignageComponent,\n        children: [\n            { path: '', redirectTo: 'media', pathMatch: 'full' },\n            { path: 'media', component: SignageMediaComponent },\n            { path: 'displays', component: SignageDisplaysComponent },\n            { path: 'zones', component: SignageZonesComponent },\n            { path: '*', redirectTo: 'media', pathMatch: 'full' },\n        ],\n    },\n];\n\nexport const COMPONENTS: Type<any>[] = [\n    SignageComponent,\n    SignageTopbarComponent,\n    SignageMediaComponent,\n    SignageMediaModalComponent,\n    SignageMediaPreviewModalComponent,\n    SignagePlaylistModalComponent,\n    SignageMediaListComponent,\n    SignagePlaylistMediaListComponent,\n\n    SignageDisplaysComponent,\n    SignageZonesComponent,\n    SearchOverlayComponent,\n    SignageItemPlaylistsComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        UIModule,\n        ComponentsModule,\n        RouterModule.forChild(ROUTES),\n        MatTabsModule,\n        DragDropModule,\n    ],\n})\nexport class SignageModule {}\n"],"x_google_ignoreList":[]}