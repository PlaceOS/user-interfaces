{"version":3,"sources":["./apps/workplace/src/app/directory/user-details.component.ts","./apps/workplace/src/app/directory/user-list.component.ts","./apps/workplace/src/app/directory/directory.module.ts","./apps/workplace/src/app/bookings/space-flow/space-flow.service.ts"],"names":["DirectoryUserListItemComponent","_settings","this","get","LETTERS","split","ROUTES","path","component","DirectoryUserListComponent","super","user_list","search$","Subject","groupedUsers","length","search_results$","pipe","debounceTime","distinctUntilChanged","switchMap","query","loading","min_search_length","toPromise","catch","Promise","resolve","map","list","subscription","subscribe","buildGroups","next","users","sorted","sort","a","b","name","localeCompare","letter","letters","filter","f","startsWith","DirectoryModule","forChild","clearEventFormState","sessionStorage","removeItem","localStorage","SpaceFlowService","_calendar","_org","_dialog","_event","_form","_filters","_loading_spaces","_loading_event","event","asObservable","form","filters","loading_spaces","loading_event","spaces","getValue","value","date","Date","valueOf","period_start","Math","floor","period_end","duration","zones","building","id","freeBusy","zone_ids","join","then","space","capacity","clearState","setEvent","nearestTo","controls","storeState","setValue","ref","open","width","height","data","componentInstance","_","reason","attendees","push","metadata","close","setItem","JSON","stringify","toJSON","event_data","getItem","parse","form_data","patchValue","filter_data","markAllAsTouched","organiser","host","email","title","valid","key","invalid","reject","values"],"mappings":"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","file":"directory-directory-module.js","sourcesContent":["import { Component, Input } from '@angular/core';\n\nimport { SettingsService } from '@placeos/common';\nimport { User } from '@placeos/users';\n\n@Component({\n    selector: 'a-directory-user-list-item',\n    template: `\n        <div\n            class=\"flex flex-wrap items-center sm:space-x-4 bg-white hover:bg-gray-100 overflow-hidden p-4 mb-2\"\n            *ngIf=\"user\"\n            [class.with-image]=\"show_image\"\n        >\n            <a-user-avatar *ngIf=\"show_image\" [user]=\"user\"></a-user-avatar>\n            <div class=\"flex flex-col flex-1 w-1/2 ml-4 sm:ml-0\">\n                <div class=\"name\">{{ user.name }}</div>\n                <a\n                    class=\"text-sm underline\"\n                    name=\"email\"\n                    [href]=\"'mailto:' + user.email | safe: 'url'\"\n                >\n                    {{ user.email }}\n                </a>\n            </div>\n            <div\n                class=\"flex w-full sm:w-auto sm:flex-col items-center space-x-2 sm:space-x-0 sm:space-y-2 mt-4 sm:mt-0\"\n            >\n                <a\n                    mat-button\n                    button\n                    class=\"w-32 flex-1 sm:flex-none\"\n                    name=\"locate\"\n                    [routerLink]=\"['/explore']\"\n                    [queryParams]=\"{ user: user.email }\"\n                    (click)=\"sendLocateEvent()\"\n                >\n                    Locate\n                </a>\n                <a\n                    mat-button\n                    button\n                    class=\"w-32 flex-1 sm:flex-nones\"\n                    name=\"call\"\n                    *ngIf=\"user.phone\"\n                    [href]=\"'tel:' + user.phone | safe: 'url'\"\n                    (click)=\"sendCallEvent()\"\n                >\n                    Call\n                </a>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n        `,\n    ],\n})\nexport class DirectoryUserListItemComponent {\n    /** Space to display */\n    @Input() public user: User;\n\n    public get show_image() {\n        return this._settings.get('app.directory.show_avatars');\n    }\n\n    public sendLocateEvent() {\n        // this._service.Analytics.event('Locate', `locate_clicked_user_${this.user.name}`);\n    }\n\n    public sendCallEvent() {\n        // this._service.Analytics.event('Call', `call_clicked_user_${this.user.name}`);\n    }\n\n    constructor(private _settings: SettingsService) {}\n}\n","import { Component, OnInit } from '@angular/core';\nimport { Subject, Observable } from 'rxjs';\nimport {\n    switchMap,\n    debounceTime,\n    distinctUntilChanged,\n    map,\n} from 'rxjs/operators';\n\nimport { BaseClass, SettingsService } from '@placeos/common';\nimport { searchStaff, User } from '@placeos/users';\nimport { clearEventFormState } from '../bookings/space-flow/space-flow.service';\n\nconst LETTERS = `ABCDEFGHIJKLMNOPQRSTUVWXYZ`.split('');\n\n@Component({\n    selector: '[a-directory-user-list]',\n    template: `\n        <a-topbar-header [(menu)]=\"show_menu\"></a-topbar-header>\n        <div class=\"w-full flex items-center justify-center p-2\">\n            <mat-form-field overlay class=\"rounded\" appearance=\"outline\">\n                <app-icon class=\"text-xl\" matPrefix>search</app-icon>\n                <input\n                    matInput\n                    [(ngModel)]=\"search_str\"\n                    (ngModelChange)=\"search$.next($event)\"\n                    placeholder=\"Search for a person...\"\n                />\n                <mat-spinner\n                    matSuffix\n                    class=\"top-2\"\n                    *ngIf=\"loading\"\n                    [diameter]=\"32\"\n                ></mat-spinner>\n            </mat-form-field>\n        </div>\n        <main class=\"flex-1 h-1/2 w-full\">\n            <ng-container\n                *ngIf=\"groupedUsers && user_list.length; else empty_state\"\n            >\n                <ng-container *ngFor=\"let letter of letters\">\n                    <ng-container *ngIf=\"groupedUsers[letter].length\">\n                        <div class=\"py-2 px-4 font-medium\">{{ letter }}</div>\n                        <a-directory-user-list-item\n                            *ngFor=\"let user of groupedUsers[letter]\"\n                            [user]=\"user\"\n                        ></a-directory-user-list-item>\n                    </ng-container>\n                </ng-container>\n            </ng-container>\n        </main>\n        <a-footer-menu></a-footer-menu>\n        <ng-template #empty_state>\n            <div class=\"flex flex-col items-center p-8\">\n                <app-icon class=\"text-5xl\">{{\n                    search_str && search_str.length >= min_search_length\n                        ? 'close'\n                        : 'arrow_upward'\n                }}</app-icon>\n                <div class=\"text\">\n                    {{\n                        search_str && search_str.length >= min_search_length\n                            ? ' No matches for \"' + search_str + '\"'\n                            : 'Type above to search for users'\n                    }}\n                </div>\n            </div>\n        </ng-template>\n        <a-overlay-menu [(show)]=\"show_menu\"></a-overlay-menu>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n                background: #f0f0f0;\n            }\n\n            mat-form-field {\n                width: 768px;\n                max-width: calc(100% - 2rem);\n            }\n        `,\n    ],\n})\nexport class DirectoryUserListComponent extends BaseClass implements OnInit {\n    /** List of controllable spaces */\n    public user_list: User[] = [];\n    /** String  */\n    public search_str: string;\n    /** List of users from an API search */\n    public search_results$: Observable<User[]>;\n    /** Whether space list is being filtered */\n    public loading: boolean;\n    /** Subject holding the value of the search */\n    public readonly search$ = new Subject<string>();\n    /** Whether to show menu */\n    public show_menu: boolean;\n\n    public groupedUsers: { [id: string]: User[] } = {};\n\n    /** Minimum length of the search string needed to initial a search */\n    public get min_search_length(): number {\n        const length = this._settings.get('app.directory.min_search_length');\n        return typeof length === 'number' && length >= 0 ? length : 3;\n    }\n\n    constructor(private _settings: SettingsService) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        // Listen for input changes\n        this.search_results$ = this.search$.pipe(\n            debounceTime(400),\n            distinctUntilChanged(),\n            switchMap((query) => {\n                this.loading = true;\n                const retVal =\n                    query.length >= this.min_search_length\n                        ? searchStaff(query)\n                              .toPromise()\n                              .catch(() => [])\n                        : Promise.resolve(this.user_list || []);\n                return retVal;\n            }),\n            map((list: User[]) => {\n                this.loading = false;\n                return list;\n            })\n        );\n        // Process API results\n        this.subscription(\n            'search_results',\n            this.search_results$.subscribe((list) => {\n                this.user_list = list;\n                this.buildGroups(this.user_list);\n            })\n        );\n        this.search$.next('');\n        clearEventFormState();\n    }\n\n    public get letters(): string[] {\n        return LETTERS;\n    }\n\n    private buildGroups(users: User[]) {\n        const sorted = users.sort((a, b) => a.name.localeCompare(b.name));\n        for (const letter of this.letters) {\n            this.groupedUsers[letter] = sorted.filter((f) =>\n                f.name.startsWith(letter)\n            );\n        }\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule, Route } from '@angular/router';\n\nimport { SharedContentModule } from '../ui/shared.module';\nimport { DirectoryUserListComponent } from './user-list.component';\nimport { DirectoryUserListItemComponent } from './user-details.component';\nimport { FormsModule } from '@angular/forms';\n\nconst ROUTES: Route[] = [{ path: '', component: DirectoryUserListComponent }];\n\n@NgModule({\n    declarations: [DirectoryUserListComponent, DirectoryUserListItemComponent],\n    imports: [\n        CommonModule,\n        FormsModule,\n        RouterModule.forChild(ROUTES),\n        SharedContentModule,\n    ],\n})\nexport class DirectoryModule {}\n","import { Injectable } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { BehaviorSubject } from 'rxjs';\nimport { first, shareReplay, switchMap } from 'rxjs/operators';\nimport { addMinutes, roundToNearestMinutes, isAfter, endOfDay } from 'date-fns';\n\nimport { BaseClass, currentUser, notifyError, unique } from '@placeos/common';\nimport {\n    CalendarEvent,\n    generateEventForm,\n    saveEvent,\n} from '@placeos/events';\nimport { CalendarService } from '@placeos/calendar';\nimport { OrganisationService } from '@placeos/organisation';\nimport { NewUserModalComponent } from '@placeos/users';\nimport { MatDialog } from '@angular/material/dialog';\n\nexport interface EventFormFilters {\n    capacity?: number;\n    zones?: string[];\n}\n\nexport function clearEventFormState(): void {\n    sessionStorage.removeItem('PLACEOS.event');\n    sessionStorage.removeItem('PLACEOS.event_form');\n    localStorage.removeItem('PLACEOS.event_filters');\n}\n\n@Injectable()\nexport class SpaceFlowService extends BaseClass {\n    /** Active event being worked on */\n    private _event = new BehaviorSubject<CalendarEvent>(null);\n    /** Form fields for the current flow */\n    private _form = new BehaviorSubject<FormGroup>(null);\n    /** Form fields for the current flow */\n    private _filters = new BehaviorSubject<EventFormFilters>({});\n    /** Whether space listing is being retrieved */\n    private _loading_spaces = new BehaviorSubject<boolean>(false);\n    /** Whether changes to event are being saved */\n    private _loading_event = new BehaviorSubject<boolean>(false);\n\n    public readonly event = this._event.asObservable();\n    public readonly form = this._form.asObservable();\n    public get event_form() {\n        return this._form.getValue();\n    }\n    public readonly filters = this._filters.asObservable();\n    public readonly loading_spaces = this._loading_spaces.asObservable();\n    public readonly loading_event = this._loading_event.asObservable();\n    public get event_filters() {\n        return this._filters.getValue();\n    }\n    public readonly spaces = this._filters.pipe(\n        switchMap((filters) => {\n            this._loading_spaces.next(true);\n            const form = this._form.getValue().value;\n            if (!form.date) form.date = new Date().valueOf();\n            const period_start = Math.floor(\n                new Date(form.date).valueOf() / 1000\n            );\n            const period_end = Math.floor(\n                addMinutes(new Date(form.date), form.duration || 60).valueOf() /\n                    1000\n            );\n            const zones = filters?.zones?.length\n                ? filters.zones\n                : [this._org.building?.id];\n            return this._calendar\n                .freeBusy({\n                    zone_ids: zones.join(','),\n                    period_start,\n                    period_end,\n                }).toPromise()\n                .then((list) => {\n                    this._loading_spaces.next(false);\n                    return list.filter(\n                        (space) =>\n                            !filters.capacity ||\n                            filters.capacity >= space.capacity\n                    );\n                });\n        }),\n        shareReplay()\n    );\n\n    public get is_future_date() {\n        const date = this._form.getValue()?.controls?.date.value || new Date().valueOf();\n        return isAfter(new Date(date), endOfDay(new Date()));\n    }\n\n    public readonly clearState = () => clearEventFormState();\n\n    constructor(\n        private _calendar: CalendarService,\n        private _org: OrganisationService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this.setEvent(\n            new CalendarEvent({\n                date: roundToNearestMinutes(addMinutes(new Date(), 2), {\n                    nearestTo: 5,\n                }).valueOf(),\n            })\n        );\n    }\n\n    /** Set the event being worked on */\n    public setEvent(event: CalendarEvent): void {\n        this._event.next(event);\n        const form = generateEventForm(event);\n        this._form.next(form);\n        this.subscription('form_change', () => this.storeState());\n    }\n\n    /** Set the value of the form control */\n    public setValue<T = any>(name: string, value: T): void {\n        const form = this._form.getValue();\n        if (form && form.controls[name]) {\n            form.controls[name].setValue(value);\n        }\n    }\n\n    public newAttendee() {\n        const ref = this._dialog.open<NewUserModalComponent>(\n            NewUserModalComponent,\n            {\n                width: 'auto',\n                height: 'auto',\n                data: {},\n            }\n        );\n        const form = this._form.getValue();\n        ref.componentInstance.event\n            .pipe(first((_) => _.reason === 'done'))\n            .subscribe((event) => {\n                const attendees = form.controls.attendees.value || [];\n                attendees.push(event.metadata);\n                form.controls.attendees.setValue(unique(attendees, 'email'));\n                ref.close();\n            });\n    }\n\n    /** Reset the form fields for the active event */\n    public clearForm(): void {\n        this.setEvent(this._event.getValue());\n        this._filters.next({});\n    }\n\n    /** Update the current form filters */\n    public updateFilters(filters: EventFormFilters) {\n        this._filters.next(filters);\n    }\n\n    /** Store current event details and form values */\n    public storeState(): void {\n        const form = this._form.getValue();\n        sessionStorage.setItem(\n            'PLACEOS.event',\n            JSON.stringify(this._event.getValue().toJSON())\n        );\n        sessionStorage.setItem('PLACEOS.event_form', JSON.stringify(form.value));\n        localStorage.setItem(\n            'PLACEOS.event_filters',\n            JSON.stringify(this._filters.getValue())\n        );\n    }\n\n    /** Load old event details and form values */\n    public loadState(): void {\n        const event_data = sessionStorage.getItem('PLACEOS.event') || '{}';\n        if (event_data) {\n            this._event.next(new CalendarEvent(JSON.parse(event_data)));\n        }\n        const form_data = sessionStorage.getItem('PLACEOS.event_form');\n        if (form_data) {\n            const form = generateEventForm(this._event.getValue());\n            form.patchValue(JSON.parse(form_data));\n            this._form.next(form);\n        }\n        const filter_data = localStorage.getItem('PLACEOS.event_filters');\n        if (filter_data) {\n            this._filters.next(JSON.parse(filter_data));\n        }\n    }\n\n    /** Save changes to event to the server */\n    public save(): Promise<void> {\n        const form = this._form.getValue();\n        form.markAllAsTouched();\n        if (!form.controls.organiser.value || !form.controls.host.value)\n            form.patchValue({\n                organiser: currentUser(),\n                host: currentUser().email,\n            });\n        if (!form.controls.title.value) {\n            form.patchValue({\n                title: currentUser().email\n            });\n        }\n        if (!form.valid) {\n            const list = [];\n            for (const key in form.controls) {\n                if (form.controls[key].invalid) {\n                    list.push(key);\n                }\n            }\n            return Promise.reject(\n                notifyError(\n                    `Some form fields are not valid: [${list.join(', ')}]`\n                )\n            );\n        }\n        this._loading_event.next(true);\n        const values = new CalendarEvent({\n            ...this._event.getValue(),\n            ...this._form.getValue().value,\n        });\n        return saveEvent(values).toPromise().then(\n            () => this._loading_event.next(false),\n            () => this._loading_event.next(false)\n        );\n    }\n}\n"],"sourceRoot":"webpack:///"}