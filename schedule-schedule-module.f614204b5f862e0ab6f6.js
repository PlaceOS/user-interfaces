(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{L0xO:function(e,t,n){"use strict";n.r(t),n.d(t,"ScheduleModule",(function(){return Me}));var i=n("2kYt"),c=n("nIj0"),s=n("qvOF"),a=n("sEIs"),o=n("YtkY"),l=n("20lr"),r=n("9MvL"),d=n("XyEp"),u=n("R3DB"),b=n("KuCG"),h=n("EDDe"),f=n("CzDk"),p=n("HM3f"),m=n("EM62"),g=n("D57K"),v=n("05Mk"),_=n("eZII"),y=n("mrqE"),O=n("C05f"),w=n("ROBh"),k=n("TLy2"),D=n("4e/d"),x=n("wqq/"),j=n("mWib"),V=n("7JBE"),M=n("OZ4H");let U=(()=>{class e extends l.c{constructor(e,t,n,i,c){super(),this._events=e,this._bookings=t,this._calendars=n,this._dialog=i,this._router=c,this._loading=new O.a(""),this._poll=new O.a(!1),this._active_item=new O.a(""),this._event_list=new O.a([]),this._options=new O.a({date:(new Date).valueOf()}),this.loading=this._loading.asObservable(),this.events=this._event_list.asObservable(),this.options=this._options.asObservable(),this.calendars=this._calendars.calendar_list,this.active_item=this._active_item.pipe(Object(k.a)(e=>this._bookings.show(e,{calendar:this._options.getValue().calendar})),Object(D.a)(e=>this._events.show(this._active_item.getValue())),Object(D.a)(e=>Object(w.a)(null)),Object(o.a)(e=>(this._item=e,e)),Object(x.a)()),this.filtered_events=Object(p.b)([this._options,this._event_list]).pipe(Object(o.a)(([e,t])=>t.filter(t=>e.calendar&&t instanceof _.a||(!e.calendar||"desks"===e.calendar)&&t instanceof v.a))),this.subscription("event_list",Object(p.b)([this._options,this._poll]).pipe(Object(j.a)(1e3),Object(k.a)(([e])=>{this._loading.next(" ");const t=Object(r.a)(e.date).valueOf();let n=function(e){return Object(y.a)(1,arguments),Object(h.a)(e,Date.now())}(t)?6:4;const i=Object(b.a)(Object(d.a)(t,n)).valueOf();return Promise.all([this._events.query({period_start:Math.floor(t/1e3),period_end:Math.floor(i/1e3),calendars:e.calendar}),this._bookings.query({period_start:Math.floor(t/1e3),period_end:Math.floor(i/1e3),type:"desk"})])}),Object(o.a)(([e,t])=>e.concat(t)),Object(D.a)(e=>[])).subscribe(e=>{const t=Object(r.a)(this._options.getValue().date).valueOf(),n=Object(b.a)(Object(d.a)(t,6)).valueOf();let i=this._event_list.getValue().filter(i=>!Object(l.v)(t,n,i.date,i.date+60*i.duration*1e3)&&!e.find(e=>e.id===i.id));i=i.concat(e),i.sort((e,t)=>e.date-t.date),this._event_list.next(i),this._loading.next("")}))}get date(){return this._options.getValue().date}setOptions(e){this._options.next(Object.assign(Object.assign({},this._options.getValue()),e))}setItem(e){console.log("Set ID:",e),this._active_item.next(e)}startPolling(e=15e3){this._poll.next(!this._poll.getValue()),this.interval("poll",()=>this._poll.next(!this._poll.getValue()),e)}stopPolling(){this.clearInterval("poll")}deleteEvent(){return Object(g.a)(this,void 0,void 0,(function*(){if(!this._item)return;const e=yield Object(l.n)({title:"Cancel Meeting",content:"Are you sure you want to cancel this meeting: "+this._item.title,icon:{content:"delete"}},this._dialog);if(!e)return;const t=this._item instanceof _.a;e.loading(`Cancelling ${t?"meeting":"desk booking"}...`);const n=t?this._events.delete:this._bookings.delete,i=yield n(this._item.id).catch(e=>e);if(e.close(),i)return Object(l.l)(`Error unable to cancel ${t?"meeting":"desk booking"}. Error: ${i.statusText||i.message||i}`);Object(l.m)(`Successfully cancelled ${t?"meeting":"desk booking"}.`),this._router.navigate(["/schedule","listing"],{queryParamsHandling:"preserve"})}))}}return e.\u0275fac=function(t){return new(t||e)(m.cc(_.b),m.cc(v.b),m.cc(V.a),m.cc(M.b),m.cc(a.d))},e.\u0275prov=m.Lb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var P=n("29Wa"),q=n("R7+U"),C=n("mFH5"),I=n("PBFl"),N=n("Jb3d"),Q=n("ukpX"),L=n("Cd2c"),S=n("gcUQ"),A=n("D8Xy"),E=n("WPBw");function Y(e,t){1&e&&(m.Vb(0,"app-icon"),m.Nc(1,"cancel"),m.Ub())}function F(e,t){1&e&&(m.Vb(0,"app-icon"),m.Nc(1,"forum"),m.Ub())}function T(e,t){1&e&&(m.Vb(0,"label"),m.Nc(1,"(Cancelled)"),m.Ub())}const B=function(){return{type:"icon",class:"material-icons",content:"place"}};function J(e,t){1&e&&m.Qb(0,"app-icon",10),2&e&&m.qc("icon",m.tc(1,B))}const $=function(e){return["/schedule","view",e]};let W=(()=>{class e{constructor(e){this._router=e}get isFuture(){return Object(A.a)(this.event.date,new Date)}get status(){return this.event.status}get is_done(){return Object(u.a)(Object(E.a)(this.event.date,this.event.duration),new Date)}get location(){return this.event&&"date"!==this.event.type&&"empty"!==this.event.type?this.event.location:"No location"}get type_image(){return this.event&&"date"!==this.event.type&&"empty"!==this.event.type?this.event instanceof _.a&&this.event.has_visitors?"external":"book_room":"block"}get time(){return this.event.all_day||this.event.duration>1380?"All Day":Object(f.a)(this.event.date,"h:mm a")}get query(){return{calendar:this.event.calendar,type:this.event.type}}}return e.\u0275fac=function(t){return new(t||e)(m.Pb(a.d))},e.\u0275cmp=m.Jb({type:e,selectors:[["schedule-event-item"]],inputs:{event:"event"},decls:15,vars:15,consts:[["matRipple","",1,"flex","mb-1",3,"routerLink","queryParams"],[1,"icon",3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[4,"ngIf"],[1,"flex","flex-col","h-20","flex-1","w-1/2","bg-white","p-2","justify-center"],[1,"text-lg","font-medium","capitalize","pl-1","truncate"],[1,"flex","items-center"],[3,"icon",4,"ngIf"],[1,"truncate","pl-1"],[3,"icon"]],template:function(e,t){1&e&&(m.Vb(0,"a",0),m.Vb(1,"div"),m.Vb(2,"div",1),m.Lc(3,Y,2,0,"app-icon",2),m.Lc(4,F,2,0,"app-icon",3),m.Ub(),m.Vb(5,"div"),m.Nc(6),m.Ub(),m.Lc(7,T,2,0,"label",4),m.Ub(),m.Vb(8,"div",5),m.Vb(9,"div",6),m.Nc(10),m.Ub(),m.Vb(11,"div",7),m.Lc(12,J,1,2,"app-icon",8),m.Vb(13,"div",9),m.Nc(14),m.Ub(),m.Ub(),m.Ub(),m.Ub()),2&e&&(m.qc("routerLink",m.uc(13,$,t.event.id))("queryParams",t.query),m.Db(1),m.Fb("h-20 w-20 flex flex-col items-center justify-center "+t.status),m.Hb("done",t.is_done),m.Db(1),m.qc("ngSwitch",t.event.status),m.Db(1),m.qc("ngSwitchCase","cancelled"),m.Db(3),m.Oc(t.time),m.Db(1),m.qc("ngIf","cancelled"===t.event.status),m.Db(3),m.Pc(" ",t.event.title," "),m.Db(2),m.qc("ngIf",!!t.location),m.Db(2),m.Oc(t.location||"No location"))},directives:[a.f,C.m,i.q,i.r,i.s,i.o,Q.a],styles:[".confirmed[_ngcontent-%COMP%], .approved[_ngcontent-%COMP%] {\n                background: #388e3c;\n                color: #fff;\n            }\n\n            .tentative[_ngcontent-%COMP%] {\n                background: #ffa000;\n                color: #000;\n            }\n\n            .declined[_ngcontent-%COMP%], .cancelled[_ngcontent-%COMP%] {\n                background: #d32f2f;\n                color: #fff;\n            }\n\n            .done[_ngcontent-%COMP%] {\n                opacity: 0.35;\n            }"]}),e})();function z(e,t){if(1&e&&m.Qb(0,"schedule-event-item",5),2&e){const e=t.$implicit;m.rc("id",t.index),m.qc("event",e)}}function H(e,t){if(1&e&&(m.Tb(0),m.Lc(1,z,1,2,"schedule-event-item",4),m.Sb()),2&e){const e=m.jc();m.Db(1),m.qc("ngForOf",e.events)}}function R(e,t){if(1&e&&(m.Vb(0,"div",6),m.Nc(1),m.kc(2,"date"),m.Ub()),2&e){const e=m.jc();m.Db(1),m.Pc("No events for ",m.lc(2,1,e.date),"")}}let X=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Jb({type:e,selectors:[["schedule-event-date-list"]],inputs:{date:"date",events:"events"},decls:7,vars:6,consts:[[1,"text-xl","mb-4"],[4,"ngIf","ngIfElse"],["empty_state",""],[1,"mb-4"],[3,"id","event",4,"ngFor","ngForOf"],[3,"id","event"],[1,"p-8"]],template:function(e,t){if(1&e&&(m.Vb(0,"div",0),m.Nc(1),m.kc(2,"date"),m.Ub(),m.Lc(3,H,2,1,"ng-container",1),m.Lc(4,R,3,3,"ng-template",null,2,m.Mc),m.Qb(6,"div",3)),2&e){const e=m.xc(5);m.Db(1),m.Pc(" ",m.mc(2,3,t.date,"fullDate")," "),m.Db(2),m.qc("ngIf",null==t.events?null:t.events.length)("ngIfElse",e)}},directives:[i.o,i.n,W],pipes:[i.f],styles:[""]}),e})();var K=n("66mq");function Z(e,t){if(1&e&&(m.Vb(0,"mat-option",22),m.Nc(1),m.Ub()),2&e){const e=t.$implicit;m.qc("value",e.id),m.Db(1),m.Pc(" ",e.summary," ")}}function G(e,t){if(1&e&&(m.Qb(0,"schedule-event-date-list",23),m.kc(1,"date")),2&e){const e=t.$implicit;m.qc("date",e.key)("events",e.value),m.Eb("date",m.mc(1,3,e.key,"yyyy-MM-dd"))}}function ee(e,t){1&e&&m.Qb(0,"mat-progress-bar",24)}const te=function(){return{class:"material-icons",content:"event"}};let ne=(()=>{class e extends l.c{constructor(e,t){super(),this._state=e,this._el=t,this.loading=this._state.loading,this.options=this._state.options,this.calendars=this._state.calendars,this.events=Object(p.b)([this._state.filtered_events,this._state.options]).pipe(Object(o.a)(([e,t])=>{let n=Object(r.a)(new Date);const i=Object(d.a)(t.date||n,12),c={};let s=0;for(;s<e.length||Object(u.a)(n,i);){const t=Object(b.a)(n),i=e.filter(e=>Object(l.v)(n.valueOf(),t.valueOf(),e.date,e.date+60*e.duration*1e3));s+=i.length,c[n.valueOf()]=i,n=Object(d.a)(n,1)}return c})),this.min_date=Object(r.a)(new Date),this.setDate=e=>this._state.setOptions({date:e}),this.setCalendar=e=>this._state.setOptions({calendar:e})}ngOnInit(){this._state.startPolling()}ngOnDestroy(){super.ngOnDestroy(),this._state.stopPolling()}onScroll(e){var t;const n=Array.prototype.slice.call((null===(t=this._el)||void 0===t?void 0:t.nativeElement.querySelectorAll("schedule-event-date-list"))||[]);if(!(null==n?void 0:n.length))return;const i=e.target.scrollTop;let c=null;for(const a of n)if(a.offsetTop-i>0){c=a;break}if(!c)return;const s=new Date(c.getAttribute("date"));Object(h.a)(s,this._state.date)||(console.log("Date:",Object(f.a)(s,"dd MMM yyyy")),this.setDate(s.valueOf()))}scrollTo(e){this.timeout("scroll_to",()=>{var t;const n=null===(t=this._el)||void 0===t?void 0:t.nativeElement.querySelector(`[date="${Object(f.a)(e,"yyyy-MM-dd")}"]`);n&&n.scrollIntoView({behavior:"smooth",inline:"center"})},1e3)}}return e.\u0275fac=function(t){return new(t||e)(m.Pb(U),m.Pb(m.m))},e.\u0275cmp=m.Jb({type:e,selectors:[["schedule-event-list"]],features:[m.Ab],decls:37,vars:23,consts:[[1,"flex","p-2","items-center","bg-white","border-b","border-gray-200","shadow","space-x-2"],["appearance","outline",1,"h-12"],["name","calendars",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","desks"],[1,"flex-1","w-0"],["mat-button","",1,"clear",3,"matMenuTriggerFor"],["legend","matMenu"],[1,"flex","items-center","px-4","py-2","hover:bg-gray-100"],[1,"bg-success","h-2","w-2","rounded-full","mr-4"],[1,"bg-pending","h-2","w-2","rounded-full","mr-4"],[1,"bg-error","h-2","w-2","rounded-full","mr-4"],["mat-icon-button","",1,"relative"],["dateMenu",""],[3,"icon"],["matInput","",1,"opacity-0","absolute","inset-0",3,"ngModel","matDatepicker","min","ngModelChange"],["matSuffix","",1,"opacity-0","absolute","inset-0",3,"for"],["picker",""],[1,"w-full","flex-1","h-1/2","flex","flex-col"],[1,"flex-1","w-full","h-1/2","overflow-auto","p-4",3,"scroll"],[3,"date","events",4,"ngFor","ngForOf"],["mode","indeterminate",4,"ngIf"],[3,"value"],[3,"date","events"],["mode","indeterminate"]],template:function(e,t){if(1&e&&(m.Vb(0,"div",0),m.Vb(1,"mat-form-field",1),m.Vb(2,"mat-select",2),m.fc("ngModelChange",(function(e){return t.setCalendar(e)})),m.kc(3,"async"),m.Lc(4,Z,2,2,"mat-option",3),m.kc(5,"async"),m.Vb(6,"mat-option",4),m.Nc(7,"Desks"),m.Ub(),m.Ub(),m.Ub(),m.Qb(8,"div",5),m.Vb(9,"button",6),m.Nc(10," Legend "),m.Ub(),m.Vb(11,"mat-menu",null,7),m.Vb(13,"div",8),m.Qb(14,"div",9),m.Nc(15," Approved "),m.Ub(),m.Vb(16,"div",8),m.Qb(17,"div",10),m.Nc(18," Tentative "),m.Ub(),m.Vb(19,"div",8),m.Qb(20,"div",11),m.Nc(21," Declined "),m.Ub(),m.Ub(),m.Vb(22,"button",12,13),m.Qb(24,"app-icon",14),m.Vb(25,"input",15),m.fc("ngModelChange",(function(e){return t.setDate(e),t.scrollTo(e)})),m.kc(26,"async"),m.Ub(),m.Qb(27,"mat-datepicker-toggle",16),m.Ub(),m.Qb(28,"mat-datepicker",null,17),m.Ub(),m.Vb(30,"main",18),m.Vb(31,"div",19),m.fc("scroll",(function(e){return t.onScroll(e)})),m.Lc(32,G,2,6,"schedule-event-date-list",20),m.kc(33,"keyvalue"),m.kc(34,"async"),m.Ub(),m.Lc(35,ee,1,0,"mat-progress-bar",21),m.kc(36,"async"),m.Ub()),2&e){const e=m.xc(12),n=m.xc(29);let i=null;m.Db(2),m.qc("ngModel",m.lc(3,10,t.options).calendar),m.Db(2),m.qc("ngForOf",m.lc(5,12,t.calendars)),m.Db(5),m.qc("matMenuTriggerFor",e),m.Db(15),m.qc("icon",m.tc(22,te)),m.Db(1),m.qc("ngModel",null==(i=m.lc(26,14,t.options))?null:i.date)("matDatepicker",n)("min",t.min_date),m.Db(2),m.qc("for",n),m.Db(5),m.qc("ngForOf",m.lc(33,16,m.lc(34,18,t.events))),m.Db(3),m.qc("ngIf",m.lc(36,20,t.loading))}},directives:[P.c,q.a,c.l,c.o,i.n,C.j,I.b,N.d,N.a,Q.a,L.b,c.c,S.b,S.d,P.g,S.a,i.o,X,K.a],pipes:[i.b,i.h,i.f],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                width: 100%;\n                height: 50%;\n                flex: 1;\n            }"]}),e})();var ie=n("e81E"),ce=n("C9Ki"),se=n("d4mj");let ae=(()=>{class e{constructor(){this.show_menu=!1}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=m.Jb({type:e,selectors:[["app-schedule"]],decls:4,vars:2,consts:[[3,"menu","menuChange"],[1,"w-full"],[3,"show","showChange"]],template:function(e,t){1&e&&(m.Vb(0,"a-topbar-header",0),m.fc("menuChange",(function(e){return t.show_menu=e})),m.Ub(),m.Qb(1,"router-outlet"),m.Qb(2,"a-footer-menu",1),m.Vb(3,"a-overlay-menu",2),m.fc("showChange",(function(e){return t.show_menu=e})),m.Ub()),2&e&&(m.qc("menu",t.show_menu),m.Db(3),m.qc("show",t.show_menu))},directives:[ie.a,a.h,ce.a,se.a],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n            }"]}),e})();var oe=n("6CBO"),le=n("ceWj"),re=n("BQ33");function de(e,t){if(1&e){const e=m.Wb();m.Vb(0,"button",10),m.fc("click",(function(){return m.Ac(e),m.jc().locate()})),m.Nc(1," View "),m.Ub()}}let ue=(()=>{class e extends l.c{constructor(e,t){super(),this._state=e,this._dialog=t,this.event=this._state.active_item,this.when=this.event.pipe(Object(o.a)(e=>{if(!e)return"Unable to determine.";const t=re(e.date),n=t.add(e.duration||60,"m");return e.all_day||e.duration>1380?t.format("DD MMM YYYY")+" - All Day":t.isSame(n,"d")?`${t.format("DD MMM YYYY, h:mm A")} - ${n.format("h:mm A")}`:`${t.format("DD MMM YYYY, h:mm A")} - ${n.format("DD MMM YYYY, h:mm A")}`})),this.deleteEvent=()=>this._state.deleteEvent()}locate(){return Object(g.a)(this,void 0,void 0,(function*(){const e=yield this.event.toPromise(),t=new oe.b({name:"Desk Booking",map_id:e.asset_id,zones:e.zones});this._dialog.open(le.a,{width:"32em",maxWidth:"95vw",maxHeight:"95vh",data:{space:t}})}))}}return e.\u0275fac=function(t){return new(t||e)(m.Pb(U),m.Pb(M.b))},e.\u0275cmp=m.Jb({type:e,selectors:[["schedule-booking-details"]],features:[m.Ab],decls:33,vars:15,consts:[[1,"flex","flex-col","items-center","mb-4"],[1,"text-xl","capitalize","mb-2","font-medium"],[1,"rounded","py-4","bg-white","border-gray-300","shadow","space-y-4","w-full","text-lg"],[1,"flex","items-center","space-x-2","px-3"],[1,"text-2xl"],[1,"flex-1"],[1,"ml-12"],[1,"flex","items-center","space-x-2","px-4"],["class","w-24","mat-button","",3,"click",4,"ngIf"],["mat-button","",1,"error","w-24",3,"click"],["mat-button","",1,"w-24",3,"click"]],template:function(e,t){if(1&e&&(m.Vb(0,"div"),m.Vb(1,"div",0),m.Vb(2,"div",1),m.Nc(3),m.kc(4,"async"),m.Ub(),m.Ub(),m.Vb(5,"div",2),m.Vb(6,"div",3),m.Vb(7,"app-icon",4),m.Nc(8,"perm_identity"),m.Ub(),m.Vb(9,"div",5),m.Nc(10),m.kc(11,"async"),m.Ub(),m.Ub(),m.Qb(12,"hr",6),m.Vb(13,"div",3),m.Vb(14,"app-icon",4),m.Nc(15,"schedule"),m.Ub(),m.Vb(16,"div",5),m.Nc(17),m.kc(18,"async"),m.Ub(),m.Ub(),m.Qb(19,"hr",6),m.Vb(20,"div",3),m.Vb(21,"app-icon",4),m.Nc(22,"place"),m.Ub(),m.Vb(23,"div",5),m.Nc(24),m.kc(25,"async"),m.Ub(),m.Ub(),m.Qb(26,"hr",6),m.Vb(27,"div",7),m.Lc(28,de,2,0,"button",8),m.kc(29,"async"),m.Qb(30,"div",5),m.Vb(31,"button",9),m.fc("click",(function(){return t.deleteEvent()})),m.Nc(32," Delete "),m.Ub(),m.Ub(),m.Ub(),m.Ub()),2&e){let e=null,n=null,i=null,c=null;m.Db(3),m.Pc(" ",(null==(e=m.lc(4,5,t.event))?null:e.title)||"No Title"," "),m.Db(7),m.Oc(null==(n=m.lc(11,7,t.event))?null:n.user_name),m.Db(7),m.Oc(m.lc(18,9,t.when)),m.Db(7),m.Oc(null==(i=m.lc(25,11,t.event))?null:i.description),m.Db(4),m.qc("ngIf",null==(c=m.lc(29,13,t.event))?null:c.asset_id)}},directives:[Q.a,i.o,I.b],pipes:[i.b],styles:["[_nghost-%COMP%]    > div[_ngcontent-%COMP%] {\n                margin: auto;\n                width: 640px;\n                max-width: 100vw;\n                padding: 1rem;\n            }"]}),e})();var be=n("mjT4"),he=n("XTcU");const fe=function(){return{type:"icon",class:"material-icons",content:"delete_forever"}};function pe(e,t){if(1&e){const e=m.Wb();m.Vb(0,"button",8),m.fc("click",(function(){return m.Ac(e),m.jc(3).cancelBooking()})),m.Qb(1,"app-icon",12),m.Ub()}2&e&&(m.Db(1),m.qc("icon",m.tc(1,fe)))}const me=function(){return{type:"icon",class:"material-icons",content:"edit"}},ge=function(){return{type:"icon",class:"material-icons",content:"control_point_duplicate"}};function ve(e,t){if(1&e){const e=m.Wb();m.Vb(0,"div",7),m.Vb(1,"button",8),m.fc("click",(function(){return m.Ac(e),m.jc(2).edit()})),m.Qb(2,"app-icon",9),m.Ub(),m.Lc(3,pe,2,2,"button",10),m.Vb(4,"button",8),m.fc("click",(function(){return m.Ac(e),m.jc(2).duplicate()})),m.Qb(5,"app-icon",11),m.Ub(),m.Ub()}if(2&e){const e=m.jc(2);m.Db(2),m.qc("icon",m.tc(3,me)),m.Db(1),m.qc("ngIf",e.can_cancel),m.Db(2),m.qc("icon",m.tc(4,ge))}}function _e(e,t){if(1&e&&(m.Vb(0,"div",1),m.Vb(1,"div",2),m.Vb(2,"div",3),m.Nc(3),m.Ub(),m.Lc(4,ve,6,5,"div",4),m.Ub(),m.Vb(5,"div",5),m.Qb(6,"schedule-event-view",6),m.Ub(),m.Ub()),2&e){const e=m.jc();m.Db(3),m.Oc(e.item.title||"No Title"),m.Db(1),m.qc("ngIf",e.can_edit),m.Db(2),m.qc("event",e.item)}}let ye=(()=>{class e extends l.c{constructor(e,t){super(),this._users=e,this._router=t,this.event=new m.o,this.loading=new m.o,this.last_start={}}get spaces(){return this.item.resources}get organiser(){return this.item.creator||this._users.current.name}get can_edit(){return this.item.creator===this._users.current.email&&"done"!==this.status}get can_cancel(){return this.can_edit&&"future"===this.status}get status(){if(this.item){const e=re(),t=re(this.item.date);if(e.isBefore(t.subtract(15,"m"),"m"))return"future";if(e.isBefore(t,"m"))return"upcoming";if(e.isBefore(t.add(15,"m"),"m"))return"started";if(e.isBefore(t.add(this.item.duration,"m"),"m"))return"in_progress"}return"done"}get is_checked_in(){return this.spaces.reduce((e,t)=>e&&this.item.date<=(this.last_start[t.id]||0),!0)}get can_control(){return this.spaces.length>0&&"future"!==this.status&&"done"!==this.status}get can_checkin(){return this.spaces.length>0&&("upcoming"===this.status||"started"===this.status)}edit(){this.event.emit({type:"edit"})}checkin(){this.checked_in=!this.checked_in}duplicate(){if(localStorage){const e=new v.a(Object.assign(Object.assign({},this.item),{id:""}));localStorage.setItem("STAFF.booking_form",JSON.stringify(e))}this._router.navigate(["/book"])}cancelBooking(){this.event.emit({type:"cancel_booking"})}}return e.\u0275fac=function(t){return new(t||e)(m.Pb(be.d),m.Pb(a.d))},e.\u0275cmp=m.Jb({type:e,selectors:[["schedule-event-details"]],inputs:{item:"item"},outputs:{event:"event",loading:"loading"},features:[m.Ab],decls:1,vars:1,consts:[["class","event-details",4,"ngIf"],[1,"event-details"],[1,"header"],[1,"title"],["class","icons",4,"ngIf"],[1,"event"],[3,"event"],[1,"icons"],["mat-fab","","color","primary",3,"click"],["name","edit",3,"icon"],["mat-fab","","color","primary",3,"click",4,"ngIf"],["name","duplicate",3,"icon"],["name","cancel",3,"icon"]],template:function(e,t){1&e&&m.Lc(0,_e,7,3,"div",0),2&e&&m.qc("ngIf",t.item)},directives:[i.o,he.a,I.b,Q.a],styles:[".header[_ngcontent-%COMP%]{padding:1em 0;width:100%}.header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:1.1em;font-weight:600;margin-bottom:.5em}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:.5em}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.5em}.event[_ngcontent-%COMP%]{display:flex;justify-content:center}"]}),e})();var Oe=n("csyo");function we(e,t){1&e&&m.Qb(0,"schedule-booking-details")}function ke(e,t){1&e&&m.Qb(0,"schedule-event-details")}function De(e,t){if(1&e&&(m.Vb(0,"div"),m.Tb(1,7),m.Lc(2,we,1,0,"schedule-booking-details",8),m.Lc(3,ke,1,0,"schedule-event-details",9),m.Sb(),m.Ub()),2&e){const e=m.jc();m.Db(1),m.qc("ngSwitch",e.type),m.Db(1),m.qc("ngSwitchCase","booking")}}function xe(e,t){if(1&e&&(m.Vb(0,"div",10),m.Qb(1,"mat-spinner",11),m.Vb(2,"p"),m.Nc(3),m.kc(4,"async"),m.Ub(),m.Ub()),2&e){const e=m.jc();m.Db(1),m.qc("diameter",48),m.Db(2),m.Oc(m.lc(4,2,e.loading)||"Loading event details...")}}const je=[{path:"",component:ae,children:[{path:"listing",component:ne},{path:"view/:id",component:(()=>{class e extends l.c{constructor(e,t,n,i){super(),this._state=e,this._router=t,this._route=n,this._location=i,this.loading=this._state.loading,this.event=this._state.active_item,this.setOptions=e=>this._state.setOptions(e),this.setID=e=>this._state.setItem(e),this.type=""}ngOnInit(){this.subscription("route.params",Object(p.b)([this._route.paramMap,this._route.queryParamMap]).subscribe(([e,t])=>{e.has("id")&&this.setID(e.get("id")),t.has("type")&&(this.type=t.get("type")),t.has("calendar")&&this.setOptions({calendar:t.get("calendar")})})),this.timeout("check_event",()=>Object(g.a)(this,void 0,void 0,(function*(){(yield this._state.active_item.toPromise())||this._router.navigate(["/schedule","listing"],{queryParamsHandling:"preserve"})})),2e3)}back(){this._location.back()}}return e.\u0275fac=function(t){return new(t||e)(m.Pb(U),m.Pb(a.d),m.Pb(a.a),m.Pb(i.j))},e.\u0275cmp=m.Jb({type:e,selectors:[["schedule-view-event"]],features:[m.Ab],decls:12,vars:6,consts:[[1,"w-full","h-12","flex","items-center","bg-white","shadow","px-2"],["mat-button","",1,"clear",3,"click"],[1,"flex","items-center"],[1,"mr-2"],[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"p-8","flex","flex-col","items-center","justify-center","h-full","w-full"],[1,"mb-4",3,"diameter"]],template:function(e,t){if(1&e&&(m.Vb(0,"div",0),m.Vb(1,"button",1),m.fc("click",(function(){return t.back()})),m.Vb(2,"div",2),m.Vb(3,"app-icon",3),m.Nc(4,"keyboard_backspace"),m.Ub(),m.Nc(5," Back "),m.Ub(),m.Ub(),m.Ub(),m.Vb(6,"main",4),m.Lc(7,De,4,2,"div",5),m.kc(8,"async"),m.kc(9,"async"),m.Ub(),m.Lc(10,xe,5,4,"ng-template",null,6,m.Mc)),2&e){const e=m.xc(11);m.Db(7),m.qc("ngIf",m.lc(8,2,t.event)&&!m.lc(9,4,t.loading))("ngIfElse",e)}},directives:[I.b,Q.a,i.o,i.q,i.r,i.s,ue,ye,Oe.b],pipes:[i.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                width: 100%;\n                height: 50%;\n                flex: 1;\n            }"]}),e})()},{path:"**",redirectTo:"listing"}]},{path:"**",redirectTo:""}];var Ve=n("R3Ii");let Me=(()=>{class e{}return e.\u0275mod=m.Nb({type:e}),e.\u0275inj=m.Mb({factory:function(t){return new(t||e)},imports:[[i.c,c.h,c.p,a.g.forChild(je),Ve.a,s.c]]}),e})()}}]);
//# sourceMappingURL=schedule-schedule-module.f614204b5f862e0ab6f6.js.map