"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_reports_reports_module_ts"],{26347:(ye,ct,f)=>{f.r(ct),f.d(ct,{ReportsModule:()=>sr});var v=f(60316),q=f(34456),F=f(26842),Ft=f(40363),M=f(24624),t=f(7404),Jt=f(74605),_=f(77375),j=f(85060),O=f(69434);const I=()=>["/reports","desks"],be=()=>["/reports","bookings"],xe=()=>["/reports","catering"],ke=()=>["/reports","contact-tracing"],we=s=>["/reports",s];function Re(s,i){1&s&&(t.j41(0,"a",4)(1,"app-icon",5),t.EFF(2,"room"),t.k0s(),t.j41(3,"h3",6),t.EFF(4,"Desks"),t.k0s(),t.j41(5,"div",7)(6,"p"),t.EFF(7,"View Report"),t.k0s(),t.j41(8,"app-icon",8),t.EFF(9,"chevron_right"),t.k0s()()()),2&s&&t.Y8G("routerLink",t.lJ4(1,I))}function Ce(s,i){1&s&&(t.j41(0,"a",4)(1,"app-icon",5),t.EFF(2,"meeting_room"),t.k0s(),t.j41(3,"h3",6),t.EFF(4,"Rooms"),t.k0s(),t.j41(5,"div",7)(6,"p"),t.EFF(7,"View Report"),t.k0s(),t.j41(8,"app-icon",8),t.EFF(9,"chevron_right"),t.k0s()()()),2&s&&t.Y8G("routerLink",t.lJ4(1,be))}function vt(s,i){1&s&&(t.j41(0,"a",4)(1,"app-icon",5),t.EFF(2,"room_service"),t.k0s(),t.j41(3,"h3",6),t.EFF(4,"Catering"),t.k0s(),t.j41(5,"div",7)(6,"p"),t.EFF(7,"View Report"),t.k0s(),t.j41(8,"app-icon",8),t.EFF(9,"chevron_right"),t.k0s()()()),2&s&&t.Y8G("routerLink",t.lJ4(1,xe))}function yt(s,i){1&s&&(t.j41(0,"a",4)(1,"app-icon",5),t.EFF(2,"connect_without_contact"),t.k0s(),t.j41(3,"h3",6),t.EFF(4,"Contact Tracing"),t.k0s(),t.j41(5,"div",7)(6,"p"),t.EFF(7,"View Report"),t.k0s(),t.j41(8,"app-icon",8),t.EFF(9,"chevron_right"),t.k0s()()()),2&s&&t.Y8G("routerLink",t.lJ4(1,ke))}function Ht(s,i){if(1&s&&(t.j41(0,"a",4)(1,"app-icon",5),t.EFF(2),t.k0s(),t.j41(3,"h3",6),t.EFF(4),t.k0s(),t.j41(5,"div",7)(6,"p"),t.EFF(7,"View Report"),t.k0s(),t.j41(8,"app-icon",8),t.EFF(9,"chevron_right"),t.k0s()()()),2&s){const n=i.$implicit;t.Y8G("routerLink",t.eq3(3,we,n.id)),t.R7$(2),t.JRh(n.icon),t.R7$(2),t.JRh(n.name)}}const Wt=["desks","spaces","catering","contact-tracing"];let Mt=(()=>{class s{get custom_reports(){return this._settings.get("app.custom_reports")||[]}get features(){return this._settings.get("app.reports.features")||Wt}constructor(n){this._settings=n}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(_.h$))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["reports-menu"],["","reports-menu",""]],decls:7,vars:5,consts:[[1,"absolute","inset-0","flex","items-center","justify-center","bg-base-200","overflow-auto"],[1,"grid","w-full","justify-items-center"],["matRipple","","class","h-64 w-64 p-4 flex flex-col items-center justify-center bg-base-100 rounded shadow hover:opacity-80 border border-base-200",3,"routerLink",4,"ngIf"],["matRipple","","class","h-64 w-64 p-4 flex flex-col items-center justify-center bg-base-100 rounded shadow hover:opacity-80 border border-base-200",3,"routerLink",4,"ngFor","ngForOf"],["matRipple","",1,"h-64","w-64","p-4","flex","flex-col","items-center","justify-center","bg-base-100","rounded","shadow","hover:opacity-80","border","border-base-200",3,"routerLink"],[1,"text-8xl"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center"],[1,"ml-2"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,Re,10,2,"a",2)(3,Ce,10,2,"a",2)(4,vt,10,2,"a",2)(5,yt,10,2,"a",2)(6,Ht,10,5,"a",3),t.k0s()()),2&e&&(t.R7$(2),t.Y8G("ngIf",o.features.includes("desks")),t.R7$(),t.Y8G("ngIf",o.features.includes("spaces")),t.R7$(),t.Y8G("ngIf",o.features.includes("catering")),t.R7$(),t.Y8G("ngIf",o.features.includes("contact-tracing")),t.R7$(),t.Y8G("ngForOf",o.custom_reports))},dependencies:[v.Sq,v.bT,j.r6,O.R,F.Wk],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row!important;align-items:center;justify-content:center;background:inherit}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(16rem,1fr));gap:1rem}\n\n/*# sourceMappingURL=reports-menu.component.ts-angular-inline--138.css.map*/"]})}return s})();const Qt=["app-reports",""];function Kt(s,i){1&s&&t.nrm(0,"div",3)}let Zt=(()=>{class s{get path(){const n=this._router.url.split("/");return n[n.length-1]}constructor(n){this._router=n}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(F.Ix))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["","app-reports",""]],attrs:Qt,decls:4,vars:1,consts:[[1,"h-full","screen-only"],[1,"relative","overflow-hidden","flex","flex-col","flex-1","w-1/2","h-full","bg-base-200"],["reports-menu","","class","absolute inset-0 screen-only",4,"ngIf"],["reports-menu","",1,"absolute","inset-0","screen-only"]],template:function(e,o){1&e&&(t.nrm(0,"sidebar",0),t.j41(1,"main",1),t.nrm(2,"router-outlet"),t.DNE(3,Kt,1,0,"div",2),t.k0s()),2&e&&(t.R7$(3),t.Y8G("ngIf","reports"===o.path))},dependencies:[v.bT,Jt.k,F.n3,Mt],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}main[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(router-outlet){display:flex;flex-direction:column;width:100%;height:100%}\n\n/*# sourceMappingURL=reports.component.ts-angular-inline--134.css.map*/"]})}return s})();var It=f(22168),pt=f(68390),E=f(89204),y=f(35443),rt=f(57871),K=f(12185),$=f(42175),Y=f(33240),U=f(56441),qe=f(24950),tn=f(25175),Ot=f(80640),dt=f(41134),Ee=f(5472),en=f(56062);function nn(s,i){if(1&s&&(t.j41(0,"div",16),t.EFF(1),t.nI1(2,"building"),t.j41(3,"span",17),t.EFF(4," - "),t.k0s()()),2&s){let n;const e=t.XpG().$implicit;t.R7$(),t.SpI(" ",null==(n=t.bMT(2,1,e.parent_id))?null:n.display_name," ")}}function sn(s,i){if(1&s&&(t.j41(0,"mat-option",13)(1,"div",14),t.DNE(2,nn,5,3,"div",15),t.j41(3,"div"),t.EFF(4),t.k0s()()()),2&s){const n=i.$implicit,e=t.XpG();t.Y8G("value",n.id),t.R7$(2),t.Y8G("ngIf",e.use_region),t.R7$(2),t.JRh(n.display_name||n.name)}}function on(s,i){1&s&&t.nrm(0,"mat-spinner",18),2&s&&t.Y8G("diameter",32)}function rn(s,i){1&s&&(t.j41(0,"p"),t.EFF(1,"Generate Report"),t.k0s())}let ut=(()=>{class s extends _.Tv{get use_region(){return!!this._settings.get("app.use_region")}constructor(n,e,o,r){super(),this._org=n,this._settings=e,this._route=o,this._router=r,this.loading=!1,this.has_data=!1,this.printing=new t.bkB,this.generate=new t.bkB,this.download=new t.bkB,this.zones=[],this.start=(0,Y.o)(Date.now()).getTime(),this.end=(0,U.D)(Date.now()).getTime(),this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(a=>`${a.id}`),this.levels=(0,$.zV)([this._org.active_building,this._org.active_region]).pipe((0,y.T)(([a,l])=>this._settings.get("app.use_region")?this._org.levelsForRegion(l):this._org.levelsForBuilding(a))),this.page="",this.setStartDate=a=>{a instanceof Date&&(a=a.valueOf()),this._router.navigate([],{relativeTo:this._route,queryParams:{start:a},queryParamsHandling:"merge"})},this.setEndDate=a=>{a instanceof Date&&(a=a.valueOf()),this._router.navigate([],{relativeTo:this._route,queryParams:{end:(0,U.D)(a).valueOf()},queryParamsHandling:"merge"})},this.setZones=a=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:a.join(",")},queryParamsHandling:"merge"})}}ngOnInit(){var n=this;return(0,E.A)(function*(){yield n._org.initialised.pipe((0,rt.$)(e=>e)).toPromise(),n.page=n._router.url,n.subscription("routing",n._router.events.subscribe(()=>{n.page=n._router.url})),n.subscription("route.query",n._route.queryParamMap.subscribe(e=>{if(e.has("zone_ids")){const o=e.get("zone_ids").split(",");if(o.length){const r=n._org.levelWithID(o);if(!r)return;n._org.building=n._org.buildings.find(a=>a.id===r.parent_id),n.zones=o}}e.has("start")&&(n.start=+e.get("start")),e.has("end")&&(n.end=+e.get("end"))}))})()}print(){this.printing.emit(!0),setTimeout(()=>{window.print(),this.printing.emit(!1)},300)}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(K.yb),t.rXU(_.h$),t.rXU(F.nX),t.rXU(F.Ix))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["reports-options"]],inputs:{loading:"loading",has_data:"has_data"},outputs:{printing:"printing",generate:"generate",download:"download"},features:[t.Vt3],decls:20,vars:11,consts:[["startDate",""],["endDate",""],[1,"bg-base-100","h-20","w-full","flex","items-center","space-x-2","p-4","z-20","border-b","border-base-200","print:hidden"],["appearance","outline",1,"w-60","no-subscript"],["placeholder","All Levels","multiple","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"ngModelChange","ngModel"],["btn","","matRipple","",3,"click","disabled"],[3,"diameter",4,"ngIf"],[4,"ngIf"],[1,"flex-1"],["icon","","matRipple","","matTooltip","Download Report Data",1,"h-12","w-12","rounded","bg-secondary","text-secondary-content",3,"click","disabled"],["icon","","matRipple","","matTooltip","Print Report",1,"h-12","w-12","rounded","bg-secondary","text-secondary-content",3,"click","disabled"],[3,"value"],[1,"flex","flex-col-reverse"],["class","text-xs opacity-30",4,"ngIf"],[1,"text-xs","opacity-30"],[1,"opacity-0"],[3,"diameter"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"div",2)(1,"mat-form-field",3)(2,"mat-select",4),t.mxI("ngModelChange",function(l){return t.eBV(r),t.DH7(o.zones,l)||(o.zones=l),t.Njj(l)}),t.bIt("ngModelChange",function(l){return t.eBV(r),t.Njj(o.setZones(l))}),t.DNE(3,sn,5,3,"mat-option",5),t.nI1(4,"async"),t.k0s()(),t.j41(5,"date-range-field")(6,"input",6,0),t.bIt("ngModelChange",function(l){return t.eBV(r),t.Njj(l?o.setStartDate(l):"")}),t.k0s(),t.j41(8,"input",6,1),t.bIt("ngModelChange",function(l){return t.eBV(r),t.Njj(l?o.setEndDate(l):"")}),t.k0s()(),t.j41(10,"button",7),t.bIt("click",function(){return t.eBV(r),t.Njj(o.generate.emit())}),t.DNE(11,on,1,1,"mat-spinner",8)(12,rn,2,0,"p",9),t.k0s(),t.nrm(13,"div",10),t.j41(14,"button",11),t.bIt("click",function(){return t.eBV(r),t.Njj(o.download.emit())}),t.j41(15,"app-icon"),t.EFF(16,"download"),t.k0s()(),t.j41(17,"button",12),t.bIt("click",function(){return t.eBV(r),t.Njj(o.print())}),t.j41(18,"app-icon"),t.EFF(19,"print"),t.k0s()()()}2&e&&(t.R7$(2),t.R50("ngModel",o.zones),t.R7$(),t.Y8G("ngForOf",t.bMT(4,9,o.levels)),t.R7$(3),t.Y8G("ngModel",o.start),t.R7$(2),t.Y8G("ngModel",o.end),t.R7$(2),t.Y8G("disabled",!!o.loading),t.R7$(),t.Y8G("ngIf",o.loading),t.R7$(),t.Y8G("ngIf",!o.loading),t.R7$(2),t.Y8G("disabled",!o.has_data),t.R7$(3),t.Y8G("disabled",!o.has_data))},dependencies:[v.Sq,v.bT,q.me,q.BC,q.vS,qe.rl,tn.VO,j.wT,Ot.oV,dt.LG,j.r6,Ee.T,O.R,v.Jj,en.b],styles:["button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}button[icon][disabled][_ngcontent-%COMP%]{background-color:var(--n)!important}mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:5.5em;white-space:initial;line-height:1.2em}\n\n/*# sourceMappingURL=reports-options.component.ts-angular-inline--135.css.map*/"]})}return s})();var Te=f(3998),qt=f(57915),Dt=f(68113),D=f(10764),an=f(7729),mt=f(28797),nt=f(99908),je=f(55882),ln=f(33119),W=f(90521),st=f(71536),cn=f(68757),at=f(19803),X=f(71963),Nt=f(29314),N=f(7841),un=f(22011);const te={0:"sunday",1:"monday",2:"tuesday",3:"wednesday",4:"thurday",5:"friday",6:"saturday"};let Q=(()=>{class s{get _ignore_days(){return(this._settings.get("app.reports.ignore_days")||[])?.map(e=>"string"==typeof e?e?.toLowerCase():(0,D.GP)((0,an.l)(new Date,e),"eeee")?.toLowerCase()).filter(e=>!!e)}get duration(){const n=this._options.getValue();let e=(0,Y.o)(n.start);const o=(0,U.D)(n.end).valueOf();let r=1;for(;e.valueOf()<o;)this._ignore_days.includes(te[e.getDay()])||r++,e=(0,mt.f)(e,1);return Math.max(1,r)}constructor(n,e){var o=this;this._org=n,this._settings=e,this._space_pipe=new un.J(this._org),this._generate=new ln.B7,this._loading=new W.t(""),this._active_bookings=new W.t([]),this._options=new W.t({start:new Date,end:new Date,zones:[]}),this._bookings_list=this._generate.pipe((0,at.B)(500),(0,X.n)(r=>{const a=this._options.getValue();if(this._loading.next("Loading report details..."),!a?.type&&!a?.zones?.length)return(0,st.of)([]);const l=(0,Y.o)(a.start||Date.now()),c=(0,U.D)(a.end||l),p=a?.zones?a.zones.filter(g=>"All"!==g).join(","):"",d={period_start:(0,nt._)(l),period_end:(0,nt._)(c)};return"desks"===a.type?(0,qt.u3)({...d,zones:p,type:"desk",limit:1e3}):(0,Dt.dP)({...d,zone_ids:p,limit:1e3}).pipe((0,X.n)(function(){var g=(0,E.A)(function*(u){return Promise.all(u.map(function(){var h=(0,E.A)(function*(m){return new Dt.LR({...m,resources:(yield Promise.all(m.resources.map(x=>o._space_pipe.transform(x.id||x.email)))).filter(x=>a.zones?.find(b=>x.zones.includes(b)))})});return function(m){return h.apply(this,arguments)}}()))});return function(u){return g.apply(this,arguments)}}()),(0,Nt.W)(g=>(0,st.of)([])))}),(0,y.T)(r=>(this._loading.next(""),r?.length||(0,_.UG)("No bookings for the selected levels and period"),r=r.filter(a=>!this._ignore_days.includes(te[new Date(a.date).getDay()])),this._active_bookings.next(r||[]),r)),(0,N.t)(1)),this.loading=this._loading.asObservable(),this.options=this._options.asObservable(),this.bookings=this._active_bookings.asObservable(),this.spaces=this._options.pipe((0,X.n)(({zones:r})=>{const a=this._settings.get("app.use_region");return r?.length||(r=[(a?this._org.building?.parent_id:this._org.building?.id)||this._org.building?.id]),(0,cn.p)(r.map(l=>(0,It.Ot)(l).pipe((0,Nt.W)(()=>(0,st.of)([])))))}),(0,y.T)(r=>(0,_.Bq)(r)),(0,N.t)(1)),this.counts=this._options.pipe((0,at.B)(500),(0,X.n)(r=>{let a=(r.zones||[]).filter(l=>-1!==l&&"All"!==l);return a.length||(a=this._settings.get("app.use_region")?this._org.levelsForRegion().map(l=>l.id):this._org.levelsForBuilding().map(l=>l.id)),"events"===r.type?this.spaces.pipe((0,y.T)(l=>a.map(c=>[c,l.filter(p=>p.zones.includes(c)).length]))):Promise.all(a.map(l=>(0,Te.bpY)(l,"desks").pipe((0,Nt.W)(()=>(0,st.of)({details:[]})),(0,y.T)(c=>[l,c.details.length])).toPromise()))}),(0,y.T)(r=>{console.log("Counts:",r);const a={};return this._active_bookings.next([]),r.forEach(([l,c])=>a[l]=c),a}),(0,N.t)(1)),this.stats=(0,$.zV)([this.counts,this.bookings]).pipe((0,X.n)(function(){var r=(0,E.A)(function*([a,l]){return console.log("Details:",a,l),l[0]instanceof Dt.LR?function dn(s,i=8,n={}){i=Math.max(1,i);const e=s.reduce((c,p)=>c+p.attendees.length,0),o=s.reduce((c,p)=>c+Math.max(1,p.system?.capacity),0),r=Math.floor(s.reduce((c,p)=>c+p.duration,0)/(60*i)*100)/100,a=Math.floor(e/o*100)/100,l=Object.keys(n).reduce((c,p)=>c+(n[p]||0),0);return{count:s.length,avg_length:Math.floor(s.reduce((c,p)=>c+p.duration,0)/s.length*100)/100,efficiency:Math.floor((r+a)/2*100)/100,total:l,total_users:e,total_capacity:o,occupancy:a,utilisation:r,events:s}}(l,8*o.duration,a):function pn(s,i=1,n={}){i=Math.max(1,i);let e=Object.keys(n).reduce((r,a)=>r+(n[a]||0),0);e=Math.max(1,e);const o=Math.floor(s.length/e/i*1e4)/1e4;return{total:e,count:s.length,utilisation:o,events:s}}(l||[],o.duration,a)});return function(a){return r.apply(this,arguments)}}())),this.day_list=(0,$.zV)([this.options,this.stats]).pipe((0,y.T)(([r,a])=>{const{start:l}=r;let c=(0,Y.o)(l);const p=(0,U.D)(r.end||c),d=[];for(;(0,je.Y)(c,p);){if(this._ignore_days.includes(te[c.getDay()])){c=(0,mt.f)(c,1);continue}const g=(0,Y.o)(c).valueOf(),u=(0,U.D)(g).valueOf(),h=a.events?.filter(x=>(0,_.dH)(g,u,x.date,x.date+60*x.duration*1e3))||[],m="desks"===r.type?(0,_.Am)(h,"system_id").length:(0,_.Am)(h,"asset_id").length;d.push({date:g,total:a.total,usage:m,free:a.total-h.length,approved:h.reduce((x,b)=>x+(b.approved||"approved"===b.status?1:0),0),count:h.length,utilisation:(h.length/Math.max(h.length||1,a.total)*100).toFixed(1)}),c=(0,mt.f)(c,1)}return d}),(0,N.t)(1)),this._bookings_list.subscribe(r=>r)}generateReport(){this._generate.next((new Date).valueOf())}setOptions(n){n.zones?.includes("All")?n.zones=["All",...this._org.levelsForBuilding(this._org.building).map(e=>e.id)]:n.zones&&this._options.getValue()?.zones?.includes("All")&&(n.zones=[]),n.start?.valueOf()!==this._options.getValue().start?.valueOf()&&n.end?.valueOf()!==this._options.getValue().end?.valueOf()&&this._options.next({...this._options.getValue(),...n})}downloadReport(){const n=this._options.getValue(),e=this._active_bookings.getValue();(0,_.PE)(`report+${n.type}+${(0,D.GP)(n.start,"yyyy-MM-dd")}+${(0,D.GP)(n.end,"yyyy-MM-dd")}.tsv`,(0,_.SL)(e.map(o=>{const r=o.toJSON();return delete r.zones,delete r.server_names,delete r.extension_data,r}),"\t"))}static#t=this.\u0275fac=function(e){return new(e||s)(t.KVO(K.yb),t.KVO(_.h$))};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var mn=f(56248),Vt=f(31257),Fe=f(13967),ee=f(58700);function hn(s){const i=(0,ee.a)(s).getDay();return 0===i||6===i}function ne(s,i){const n=(0,ee.a)(s);let e=(0,ee.a)(i);if(!(0,Fe.f)(n)||!(0,Fe.f)(e))return NaN;const o=(0,mn.m)(n,e),r=o<0?-1:1,a=Math.trunc(o/7);let l=5*a;for(e=(0,mt.f)(e,7*a);!(0,Vt.r)(n,e);)l+=hn(e)?0:r,e=(0,mt.f)(e,r);return 0===l?0:l}var se=f(99134);function gn(s,i){if(1&s&&(t.j41(0,"div",3)(1,"div",4)(2,"h3"),t.EFF(3,"No show count"),t.k0s(),t.j41(4,"p"),t.EFF(5),t.nI1(6,"async"),t.k0s()(),t.j41(7,"div",4)(8,"h3"),t.EFF(9,"% of No show Bookings"),t.k0s(),t.j41(10,"p"),t.EFF(11),t.nI1(12,"async"),t.k0s()(),t.j41(13,"div",4)(14,"h3"),t.EFF(15,"Total in-room attendance"),t.k0s(),t.j41(16,"p"),t.EFF(17),t.nI1(18,"async"),t.k0s()()()),2&s){const n=t.XpG();t.R7$(5),t.JRh(t.bMT(6,3,n.no_shows)||0),t.R7$(6),t.SpI("",t.bMT(12,5,n.no_show_percent)||0,"%"),t.R7$(6),t.JRh(t.bMT(18,7,n.attendance)||0)}}let fn=(()=>{class s{constructor(n){this._state=n,this.business_days=this._state.options.pipe((0,y.T)(({start:e,end:o})=>ne((0,U.D)(o||Date.now()).valueOf()+2,(0,Y.o)(e||Date.now()))||1)),this.total_count=this._state.stats.pipe((0,y.T)(e=>e.count||0)),this.avg_length=this._state.stats.pipe((0,y.T)(e=>(0,se.a)({minutes:Math.floor(e.avg_length||0)}))),this.attendance=this._state.stats.pipe((0,y.T)(({events:e})=>e.reduce((o,{extension_data:r})=>o+(+r?.people_count?.max||0),0))),this.no_shows=this._state.stats.pipe((0,y.T)(({events:e})=>e.reduce((o,{extension_data:r})=>o+ +r?.people_count?.max?1:0,0))),this.no_show_percent=this._state.stats.pipe((0,y.T)(({events:e})=>Math.floor(e.reduce((o,{extension_data:r})=>o+ +r?.people_count?.max?1:0,0)/e.length*1e4)/100)),this.has_attendance=this._state.stats.pipe((0,y.T)(({events:e})=>!!e.find(({extension_data:o})=>!!o?.people_count)))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["report-spaces-overall"]],decls:21,vars:12,consts:[[1,"m-4","p-4","rounded","bg-base-100","border","border-base-200","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],["class","m-4 p-4 rounded bg-base-100 flex justify-center items-center space-x-2",4,"ngIf"],[1,"m-4","p-4","rounded","bg-base-100","flex","justify-center","items-center","space-x-2"],[1,"flex-1","flex","flex-col","items-center","justify-center"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"h3"),t.EFF(3,"Business Days"),t.k0s(),t.j41(4,"p"),t.EFF(5),t.nI1(6,"async"),t.k0s()(),t.j41(7,"div",1)(8,"h3"),t.EFF(9,"Total Bookings"),t.k0s(),t.j41(10,"p"),t.EFF(11),t.nI1(12,"async"),t.k0s()(),t.j41(13,"div",1)(14,"h3"),t.EFF(15,"Average Booking Length"),t.k0s(),t.j41(16,"p"),t.EFF(17),t.nI1(18,"async"),t.k0s()()(),t.DNE(19,gn,19,9,"div",2),t.nI1(20,"async")),2&e&&(t.R7$(5),t.JRh(t.bMT(6,4,o.business_days)||0),t.R7$(6),t.JRh(t.bMT(12,6,o.total_count)||0),t.R7$(6),t.JRh(t.bMT(18,8,o.avg_length)||"None"),t.R7$(2),t.Y8G("ngIf",t.bMT(20,10,o.has_attendance)))},dependencies:[v.bT,v.Jj],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}\n\n/*# sourceMappingURL=report-spaces-overall.component.ts-angular-inline--139.css.map*/"]})}return s})();var T=f(33602),L=f(88328);const _n=s=>({key:"date",name:"Date",content:s}),vn=()=>({key:"approved",name:"Approved Bookings"}),yn=()=>({key:"count",name:"Total Requests"}),bn=s=>({key:"utilisation",name:"Utilisation",content:s}),xn=(s,i,n,e)=>[s,i,n,e];function kn(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}function wn(s,i){if(1&s&&(t.j41(0,"div",9),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&s){const n=i.data;t.R7$(),t.JRh(t.i5U(2,1,n,"mediumDate"))}}function Rn(s,i){if(1&s&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&s){const n=i.data;t.R7$(),t.SpI("",n||"0","%")}}let Cn=(()=>{class s{constructor(n){var e=this;this._state=n,this.print=!1,this.day_list=this._state.day_list,this.download=(0,E.A)(function*(){let o=yield e.day_list.pipe((0,T.s)(1)).toPromise();o=o.map(r=>({...r,date:(0,D.GP)(r.date,"MMMM d, y(EEE)")})),(0,_.PE)("spaces-usage.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["report-spaces-overall-list"]],inputs:{print:"print"},decls:11,vars:16,consts:[["date_template",""],["percent_template",""],[1,"w-full"],[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"],[1,"p-4"]],template:function(e,o){if(1&e&&(t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"h3",5),t.EFF(4,"Daily Utilisation"),t.k0s(),t.DNE(5,kn,3,0,"button",6),t.k0s(),t.nrm(6,"simple-table",7),t.DNE(7,wn,3,4,"ng-template",null,0,t.C5r)(9,Rn,2,1,"ng-template",null,1,t.C5r),t.k0s()()),2&e){const r=t.sdS(8),a=t.sdS(10);t.R7$(5),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.day_list)("columns",t.ziG(11,xn,t.eq3(5,_n,r),t.lJ4(7,vn),t.lJ4(8,yn),t.eq3(9,bn,a)))("sortable",!0)("page_size",o.print?0:10)}},dependencies:[v.bT,j.r6,O.R,L.O,v.vh],encapsulation:2})}return s})();var Me=f(71246);const En=()=>({key:"name",name:"Name"}),Tn=s=>({key:"capacity",name:"Capacity",content:s}),jn=()=>({key:"booking_count",name:"Bookings"}),Fn=()=>({key:"utilisation",name:"Utilisation"}),Mn=()=>({key:"avg_attendees",name:"Avg. Invitees per Booking"}),In=s=>({key:"no_shows",name:"No Shows",show:s}),On=s=>({key:"min_attendance",name:"Min. In-Room Attendance",show:s}),Dn=s=>({key:"max_attendance",name:"Max. In-Room Attendance",show:s}),Nn=()=>({key:"occupancy",name:"Occupancy %"}),Vn=(s,i,n,e,o,r,a,l,c)=>[s,i,n,e,o,r,a,l,c];function Sn(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",6),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}function Gn(s,i){1&s&&(t.j41(0,"span",9),t.EFF(1,"Not set"),t.k0s())}function $n(s,i){if(1&s&&(t.j41(0,"div",7),t.EFF(1),t.DNE(2,Gn,2,0,"span",8),t.k0s()),2&s){const n=i.data;t.R7$(),t.SpI(" ",n<1?"":n," "),t.R7$(),t.Y8G("ngIf",n<1)}}let An=(()=>{class s{constructor(n){var e=this;this._reports=n,this.print=!1,this.space_list=(0,$.zV)([this._reports.stats,this._reports.options]).pipe((0,at.B)(300),(0,y.T)(([o,{start:r,end:a}])=>{let l=[],c=!1;for(const d of o.events){const g=(0,_.Am)(d.resources,"email")||[d.system];for(const u of g){let h=l.find(m=>m.id===u.id||m.id?.toLowerCase()===u.email.toLowerCase());if(!h){if(h={id:u.id||u.email,name:u.display_name||u.name,capacity:u.capacity,booking_count:0,attendance:0,avg_attendance:0,min_attendance:99,max_attendance:0,attendees:0,avg_attendees:0,usage:0,no_shows:0,utilisation:0,occupancy:0},!h.id||!h.name)continue;l.push(h)}0===d.extension_data?.people_count?.max&&(h.no_shows+=1),h.booking_count+=1,h.attendance+=d.extension_data?.people_count?.max??0,h.avg_attendance+=d.extension_data?.people_count?.avg??0,h.min_attendance=Math.min(h.max_attendance,d.extension_data?.people_count?.max??99),h.max_attendance=Math.max(h.max_attendance,d.extension_data?.people_count?.max??0),h.usage+=d.duration,h.attendees+=d.attendees.length,c=c||!!d.extension_data.people_count}}const p=Math.max(1,(0,Me.c)(a,r)+1);for(const d of l)d.avg_attendees=Math.floor(d.attendees/d.booking_count*100)/100,d.avg_attendance=Math.floor(d.attendance/d.booking_count*100)/100,d.utilisation=`${Math.floor(d.usage/60/8/p*100)}%`,d.min_attendance=99===d.min_attendance?"?":d.min_attendance,d.occupancy=Math.floor(d.avg_attendees/Math.max(1,d.capacity)*1e3)/10+"%",(d.attendance<0||!c)&&(d.attendance="?",d.avg_attendance="?");return l})),this.has_attendance=this.space_list.pipe((0,y.T)(o=>!!o.find(({attendance:r})=>"?"!==r))),this.download=(0,E.A)(function*(){const o=yield e.space_list.pipe((0,T.s)(1)).toPromise();for(const r of o)delete r.attendance,delete r.avg_attendance,delete r.no_shows,delete r.min_attendance,delete r.max_attendance;(0,_.PE)("report-spaces-usage.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["report-spaces-space-listing"]],inputs:{print:"print"},decls:11,vars:34,consts:[["capacity_template",""],[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"],[1,"p-4"],["class","opacity-30",4,"ngIf"],[1,"opacity-30"]],template:function(e,o){if(1&e&&(t.j41(0,"div",1)(1,"div",2)(2,"h3",3),t.EFF(3,"Room Utilisation"),t.k0s(),t.DNE(4,Sn,3,0,"button",4),t.k0s(),t.nrm(5,"simple-table",5),t.nI1(6,"async"),t.nI1(7,"async"),t.nI1(8,"async"),t.DNE(9,$n,3,2,"ng-template",null,0,t.C5r),t.k0s()),2&e){const r=t.sdS(10);t.R7$(4),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.space_list)("columns",t.zJS(24,Vn,[t.lJ4(11,En),t.eq3(12,Tn,r),t.lJ4(14,jn),t.lJ4(15,Fn),t.lJ4(16,Mn),t.eq3(17,In,t.bMT(6,5,o.has_attendance)),t.eq3(19,On,t.bMT(7,7,o.has_attendance)),t.eq3(21,Dn,t.bMT(8,9,o.has_attendance)),t.lJ4(23,Nn)]))("sortable",!0)("page_size",o.print?0:10)}},dependencies:[v.bT,j.r6,O.R,L.O,v.Jj]})}return s})();const Bn=()=>({key:"name",name:"Name"}),Un=()=>({key:"booking_count",name:"Bookings"}),Ln=()=>({key:"avg_attendees",name:"Avg. Invitees per Booking"}),zn=()=>({key:"total_time",name:"Total Booked Time"}),Pn=()=>({key:"no_shows",name:"No Shows"}),Yn=(s,i,n,e,o)=>[s,i,n,e,o];function Xn(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",5),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}let Jn=(()=>{class s{constructor(n){var e=this;this._reports=n,this.print=!1,this.user_list=(0,$.zV)([this._reports.stats]).pipe((0,at.B)(300),(0,y.T)(([o])=>{let r=[];for(const a of o.events){const l=a.attendees?.find(d=>d.email===a.extension_data?.host_override||d.email===a.host);if(!l)continue;const c=Math.max(a.resources.reduce((d,g)=>d+g.capacity,0)||1,1);let p=r.find(d=>d.id?.toLowerCase()===l.email.toLowerCase());p||(p={id:l.email,name:l.name,capacity:c,booking_count:0,attendees:0,avg_attendees:0,no_shows:0,occupancy:0,total_time:0},r.push(p)),0===a.extension_data?.people_count?.max&&(p.no_shows+=1),p.booking_count+=1,p.attendees+=a.attendees.length,p.total_time+=a.duration||15}for(const a of r)a.avg_attendees=Math.floor(a.attendees/a.booking_count*100)/100,a.occupancy=Math.floor(a.avg_attendees/a.capacity*100)/100,a.total_time=(0,se.a)({hours:Math.floor(a.total_time/60),minutes:a.total_time%60});return r}),(0,N.t)(1)),this.download=(0,E.A)(function*(){const o=yield e.user_list.pipe((0,T.s)(1)).toPromise();for(const r of o)delete r.attendance,delete r.avg_attendance,delete r.min_attendance,delete r.max_attendance,delete r.occupancy;(0,_.PE)("report-space-attendee-usage.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["report-spaces-user-listing"]],inputs:{print:"print"},decls:6,vars:16,consts:[[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"h3",2),t.EFF(3,"Meeting Organisers"),t.k0s(),t.DNE(4,Xn,3,0,"button",3),t.k0s(),t.nrm(5,"simple-table",4),t.k0s()),2&e&&(t.R7$(4),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.user_list)("columns",t.s1E(10,Yn,t.lJ4(5,Bn),t.lJ4(6,Un),t.lJ4(7,Ln),t.lJ4(8,zn),t.lJ4(9,Pn)))("sortable",!0)("page_size",o.print?0:10))},dependencies:[v.bT,j.r6,O.R,L.O]})}return s})();const Hn=["report-spaces",""];function Wn(s,i){if(1&s&&(t.qex(0),t.nrm(1,"report-spaces-overall")(2,"report-spaces-overall-list",10)(3,"report-spaces-space-listing",10)(4,"report-spaces-user-listing",10),t.bVm()),2&s){const n=t.XpG(2);t.R7$(2),t.Y8G("print",n.printing),t.R7$(),t.Y8G("print",n.printing),t.R7$(),t.Y8G("print",n.printing)}}function Qn(s,i){if(1&s&&(t.qex(0),t.DNE(1,Wn,5,3,"ng-container",9),t.nI1(2,"async"),t.bVm()),2&s){const n=t.XpG(),e=t.sdS(15);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,n.total_count))("ngIfElse",e)}}function Kn(s,i){1&s&&(t.j41(0,"div",11),t.nrm(1,"mat-spinner",12),t.j41(2,"p",13),t.EFF(3,"Loading report data..."),t.k0s()()),2&s&&(t.R7$(),t.Y8G("diameter",32))}function Zn(s,i){1&s&&(t.j41(0,"div",14)(1,"p",13),t.EFF(2," Select levels and time period to generate a report. "),t.k0s()())}let qn=(()=>{class s extends _.Tv{get logo(){return this._settings.get("app.logo_light")||{}}constructor(n,e,o){super(),this._state=n,this._settings=e,this._route=o,this.printing=!1,this.total_count=this._state.stats.pipe((0,y.T)(r=>r.count||0)),this.loading=this._state.loading,this.downloadReport=()=>this._state.downloadReport(),this.generateReport=()=>this._state.generateReport()}ngOnInit(){this._state.setOptions({type:"events"}),this.subscription("route.query",this._route.queryParamMap.subscribe(n=>{if(n.has("start")&&this._state.setOptions({start:+n.get("start")}),n.has("end")&&this._state.setOptions({end:+n.get("end")}),n.has("zones")){const e=n.get("zones").split(",");e.length&&this._state.setOptions({zones:e})}}))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q),t.rXU(_.h$),t.rXU(F.nX))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["","report-spaces",""]],features:[t.Vt3],attrs:Hn,decls:16,vars:11,consts:[["load_state",""],["empty_state",""],[3,"printing","download","generate","loading","has_data"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto","print:overflow-visible","print:h-auto"],[1,"w-full"],[1,"flex","items-center","m-4","p-4","rounded","bg-base-200"],[1,"h-12",3,"src"],[1,"flex-1"],[1,"text-2xl","font-medium","px-2"],[4,"ngIf","ngIfElse"],[3,"print"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],[1,"opacity-30"],[1,"h-full","w-full","flex","flex-col","items-center","p-8","screen-only"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"reports-options",2),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("printing",function(l){return t.eBV(r),t.Njj(o.printing=l)})("download",function(){return t.eBV(r),t.Njj(o.downloadReport())})("generate",function(){return t.eBV(r),t.Njj(o.generateReport())}),t.k0s(),t.j41(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"img",6)(7,"div",7),t.j41(8,"h2",8),t.EFF(9,"Rooms Report"),t.k0s()()(),t.DNE(10,Qn,3,4,"ng-container",9),t.nI1(11,"async"),t.k0s(),t.DNE(12,Kn,4,1,"ng-template",null,0,t.C5r)(14,Zn,3,0,"ng-template",null,1,t.C5r)}if(2&e){const r=t.sdS(13);t.Y8G("loading",t.bMT(1,5,o.loading))("has_data",t.bMT(2,7,o.total_count)),t.R7$(6),t.Y8G("src",o.logo.src,t.B4B),t.R7$(4),t.Y8G("ngIf",!t.bMT(11,9,o.loading))("ngIfElse",r)}},dependencies:[v.bT,dt.LG,ut,fn,Cn,An,Jn,v.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}\n\n/*# sourceMappingURL=report-spaces.component.ts-angular-inline--136.css.map*/"]})}return s})();const ts=s=>({key:"date",name:"Date",content:s}),es=()=>({key:"approved",name:"Approved Bookings"}),ns=()=>({key:"count",name:"Total Requests"}),ss=s=>({key:"utilisation",name:"Utilisation",content:s}),os=(s,i,n,e)=>[s,i,n,e];function is(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",8),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}function rs(s,i){if(1&s&&(t.j41(0,"div",9),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&s){const n=i.data;t.R7$(),t.JRh(t.i5U(2,1,n,"mediumDate"))}}function as(s,i){if(1&s&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&s){const n=i.data;t.R7$(),t.SpI("",n||"0","%")}}let ls=(()=>{class s{constructor(n){var e=this;this._state=n,this.print=!1,this.day_list=this._state.day_list,this.download=(0,E.A)(function*(){let o=yield e.day_list.pipe((0,T.s)(1)).toPromise();o=o.map(r=>({...r,date:(0,D.GP)(r.date,"MMMM d, y(EEE)")})),(0,_.PE)("desks-usage.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["report-desks-overall-list"]],inputs:{print:"print"},decls:11,vars:16,consts:[["date_template",""],["percent_template",""],[1,"pb-2","w-full"],[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],[1,"w-full","block","text-sm",3,"data","columns","page_size","sortable"],["icon","","matRipple","",3,"click"],[1,"p-4"]],template:function(e,o){if(1&e&&(t.j41(0,"div",2)(1,"div",3)(2,"div",4)(3,"h3",5),t.EFF(4,"Daily Utilisation"),t.k0s(),t.DNE(5,is,3,0,"button",6),t.k0s(),t.nrm(6,"simple-table",7),t.DNE(7,rs,3,4,"ng-template",null,0,t.C5r)(9,as,2,1,"ng-template",null,1,t.C5r),t.k0s()()),2&e){const r=t.sdS(8),a=t.sdS(10);t.R7$(5),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.day_list)("columns",t.ziG(11,os,t.eq3(5,ts,r),t.lJ4(7,es),t.lJ4(8,ns),t.eq3(9,ss,a)))("page_size",o.print?0:10)("sortable",!0)}},dependencies:[v.bT,j.r6,O.R,L.O,v.vh],encapsulation:2})}return s})();const cs=()=>({key:"name",name:"Level"}),ps=()=>({key:"avg_usage",name:"Avg. Used Desks"}),ds=()=>({key:"approved",name:"Approved Bookings"}),us=()=>({key:"count",name:"Total Requests"}),ms=s=>({key:"utilisation",name:"Utilisation",content:s}),hs=(s,i,n,e,o)=>[s,i,n,e,o];function gs(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}function fs(s,i){if(1&s&&(t.j41(0,"div",8),t.EFF(1),t.k0s()),2&s){const n=i.data;t.R7$(),t.SpI("",n||"0","%")}}let _s=(()=>{class s{constructor(n,e,o){var r=this;this._state=n,this._org=e,this._settings=o,this.print=!1,this.level_list=(0,$.zV)([this._state.options,this._state.stats,this._state.counts]).pipe((0,y.T)(([a,l,c])=>{let{start:p,end:d,zones:g}=a;const u=(0,Me.c)(d,p)||1;g.length||(g=this._settings.get("app.use_region")?this._org.levelsForRegion().map(m=>m.id):this._org.levelsForBuilding().map(m=>m.id));const h=[];for(const m of g){if("All"===m)continue;const x=this._org.levelWithID([m]),b=c[m]||0,B=l.events.filter(G=>G.zones.includes(m));let z=(b*u-B.length)/u;z%1!=0&&(z=z.toFixed(2)),h.push({name:x?.display_name||x?.name,free:z,approved:B.filter(G=>G.approved).length||0,avg_usage:(B.length/u||0).toFixed(2),total:b,count:B.length,utilisation:(B.length/((b||1)*u)*100||0).toFixed(2)})}return h}),(0,N.t)(1)),this.download=(0,E.A)(function*(){let a=yield r.level_list.pipe((0,T.s)(1)).toPromise();(0,_.PE)("desks-levels-usage.csv",(0,_.SL)(a))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q),t.rXU(K.yb),t.rXU(_.h$))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["report-desks-levels-list"]],inputs:{print:"print"},decls:9,vars:17,consts:[["percent_view",""],[1,"px-4","pb-2","w-full"],[1,"rounded","bg-base-100","border","border-base-200","overflow-hidden","w-full"],[1,"border-b","border-base-200","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],[1,"w-full","block","text-sm",3,"data","columns","page_size","sortable"],["icon","","matRipple","",3,"click"],[1,"p-4"]],template:function(e,o){if(1&e&&(t.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"h3",4),t.EFF(4,"Level Utilisation"),t.k0s(),t.DNE(5,gs,3,0,"button",5),t.k0s(),t.nrm(6,"simple-table",6),t.DNE(7,fs,2,1,"ng-template",null,0,t.C5r),t.k0s()()),2&e){const r=t.sdS(8);t.R7$(5),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.level_list)("columns",t.s1E(11,hs,t.lJ4(5,cs),t.lJ4(6,ps),t.lJ4(7,ds),t.lJ4(8,us),t.eq3(9,ms,r)))("page_size",o.print?0:10)("sortable",!0)}},dependencies:[v.bT,j.r6,O.R,L.O],encapsulation:2})}return s})();const bt={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",ct:"http://gionkunz.github.com/chartist-js/ct"},vs=8,St={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function Ie(s,i){return"number"==typeof s?s+i:s}function Gt(s){if("string"==typeof s){const i=/^(\d+)\s*(.*)$/g.exec(s);return{value:i?+i[1]:0,unit:i?.[2]||void 0}}return{value:Number(s)}}function oe(s){return String.fromCharCode(97+s%26)}const ie=2221e-19;function xt(s,i,n){return i/n.range*s}function bs(s,i){const n=Math.pow(10,i||vs);return Math.round(s*n)/n}function re(s,i,n,e){const o=(e-90)*Math.PI/180;return{x:s+n*Math.cos(o),y:i+n*Math.sin(o)}}function lt(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var i=arguments.length,n=new Array(i>1?i-1:0),e=1;e<i;e++)n[e-1]=arguments[e];for(let o=0;o<n.length;o++){const r=n[o];for(const a in r){const l=r[a];s[a]="object"!=typeof l||null===l||l instanceof Array?l:lt(s[a],l)}}return s}const kt=s=>s;function $t(s,i){return Array.from({length:s},i?(n,e)=>i(e):()=>{})}const ws=(s,i)=>s+(i||0);function R(s,i){return null!==s&&"object"==typeof s&&Reflect.has(s,i)}function wt(s){return null!==s&&isFinite(s)}function Oe(s){return!s&&0!==s}function ht(s){return wt(s)?Number(s):void 0}function Ne(s,i){const n=Array.isArray(s)?s[i]:R(s,"data")?s.data[i]:null;return R(n,"meta")?n.meta:void 0}function Ve(s){return null==s||"number"==typeof s&&isNaN(s)}function At(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";return function Ts(s){return"object"==typeof s&&null!==s&&(Reflect.has(s,"x")||Reflect.has(s,"y"))}(s)&&R(s,i)?ht(s[i]):ht(s)}function ae(s){let o,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,e=arguments.length>3?arguments[3]:void 0;const r={labels:(s.labels||[]).slice(),series:Ms(s.series,n,e)},a=r.labels.length;return function Cs(s){return!!Array.isArray(s)&&s.every(Array.isArray)}(r.series)?(o=Math.max(a,...r.series.map(l=>l.length)),r.series.forEach(l=>{l.push(...$t(Math.max(0,o-l.length)))})):o=r.series.length,r.labels.push(...$t(Math.max(0,o-a),()=>"")),i&&function js(s){var i;null===(i=s.labels)||void 0===i||i.reverse(),s.series.reverse();for(const n of s.series)R(n,"data")?n.data.reverse():Array.isArray(n)&&n.reverse()}(r),r}function Se(s,i){if(!Ve(s))return i?function Fs(s,i){let n,e;if("object"!=typeof s){const o=ht(s);"x"===i?n=o:e=o}else R(s,"x")&&(n=ht(s.x)),R(s,"y")&&(e=ht(s.y));if(void 0!==n||void 0!==e)return{x:n,y:e}}(s,i):ht(s)}function le(s,i){return Array.isArray(s)?s.map(n=>R(n,"value")?Se(n.value,i):Se(n,i)):le(s.data,i)}function Ms(s,i,n){if(function Es(s){return Array.isArray(s)&&s.every(i=>Array.isArray(i)||R(i,"data"))}(s))return s.map(o=>le(o,i));const e=le(s,i);return n?e.map(o=>[o]):e}function Rt(s){let i="";return null==s?s:(i="number"==typeof s?""+s:"object"==typeof s?JSON.stringify({data:s}):String(s),Object.keys(St).reduce((n,e)=>n.replaceAll(e,St[e]),i))}class Is{call(i,n){return this.svgElements.forEach(e=>Reflect.apply(e[i],e,n)),this}attr(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("attr",n)}elem(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("elem",n)}root(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("root",n)}getNode(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("getNode",n)}foreignObject(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("foreignObject",n)}text(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("text",n)}empty(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("empty",n)}remove(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("remove",n)}addClass(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("addClass",n)}removeClass(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("removeClass",n)}removeAllClasses(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("removeAllClasses",n)}animate(){for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];return this.call("animate",n)}constructor(i){this.svgElements=[];for(let n=0;n<i.length;n++)this.svgElements.push(new Be(i[n]))}}const $e={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]};function Ae(s,i,n){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=arguments.length>4?arguments[4]:void 0;const{easing:r,...a}=n,l={};let c,p;r&&(c=Array.isArray(r)?r:$e[r]),a.begin=Ie(a.begin,"ms"),a.dur=Ie(a.dur,"ms"),c&&(a.calcMode="spline",a.keySplines=c.join(" "),a.keyTimes="0;1"),e&&(a.fill="freeze",l[i]=a.from,s.attr(l),p=Gt(a.begin||0).value,a.begin="indefinite");const d=s.elem("animate",{attributeName:i,...a});e&&setTimeout(()=>{try{d._node.beginElement()}catch{l[i]=a.to,s.attr(l),d.remove()}},p);const g=d.getNode();o&&g.addEventListener("beginEvent",()=>o.emit("animationBegin",{element:s,animate:g,params:n})),g.addEventListener("endEvent",()=>{o&&o.emit("animationEnd",{element:s,animate:g,params:n}),e&&(l[i]=a.to,s.attr(l),d.remove())})}let Be=(()=>{class s{attr(n,e){return"string"==typeof n?e?this._node.getAttributeNS(e,n):this._node.getAttribute(n):(Object.keys(n).forEach(o=>{if(void 0!==n[o])if(-1!==o.indexOf(":")){const r=o.split(":");this._node.setAttributeNS(bt[r[0]],o,String(n[o]))}else this._node.setAttribute(o,String(n[o]))}),this)}elem(n,e,o){return new s(n,e,o,this,arguments.length>3&&void 0!==arguments[3]&&arguments[3])}parent(){return this._node.parentNode instanceof SVGElement?new s(this._node.parentNode):null}root(){let n=this._node;for(;"svg"!==n.nodeName&&n.parentElement;)n=n.parentElement;return new s(n)}querySelector(n){const e=this._node.querySelector(n);return e?new s(e):null}querySelectorAll(n){const e=this._node.querySelectorAll(n);return new Is(e)}getNode(){return this._node}foreignObject(n,e,o){let a,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"==typeof n){const c=document.createElement("div");c.innerHTML=n,a=c.firstChild}else a=n;a instanceof Element&&a.setAttribute("xmlns",bt.xmlns);const l=this.elem("foreignObject",e,o,r);return l._node.appendChild(a),l}text(n){return this._node.appendChild(document.createTextNode(n)),this}empty(){for(;this._node.firstChild;)this._node.removeChild(this._node.firstChild);return this}remove(){var n;return null===(n=this._node.parentNode)||void 0===n||n.removeChild(this._node),this.parent()}replace(n){var e;return null===(e=this._node.parentNode)||void 0===e||e.replaceChild(n._node,this._node),n}append(n){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this._node.firstChild?this._node.insertBefore(n._node,this._node.firstChild):this._node.appendChild(n._node),this}classes(){const n=this._node.getAttribute("class");return n?n.trim().split(/\s+/):[]}addClass(n){return this._node.setAttribute("class",this.classes().concat(n.trim().split(/\s+/)).filter(function(e,o,r){return r.indexOf(e)===o}).join(" ")),this}removeClass(n){const e=n.trim().split(/\s+/);return this._node.setAttribute("class",this.classes().filter(o=>-1===e.indexOf(o)).join(" ")),this}removeAllClasses(){return this._node.setAttribute("class",""),this}height(){return this._node.getBoundingClientRect().height}width(){return this._node.getBoundingClientRect().width}animate(n){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=arguments.length>2?arguments[2]:void 0;return Object.keys(n).forEach(r=>{const a=n[r];Array.isArray(a)?a.forEach(l=>Ae(this,r,l,!1,o)):Ae(this,r,a,e,o)}),this}constructor(n,e,o,r,a=!1){n instanceof Element?this._node=n:(this._node=document.createElementNS(bt.svg,n),"svg"===n&&this.attr({"xmlns:ct":bt.ct})),e&&this.attr(e),o&&this.addClass(o),r&&(a&&r._node.firstChild?r._node.insertBefore(this._node,r._node.firstChild):r._node.appendChild(this._node))}}return s.Easing=$e,s})();function ce(s){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"100%",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"100%",e=arguments.length>3?arguments[3]:void 0;Array.from(s.querySelectorAll("svg")).filter(r=>r.getAttributeNS(bt.xmlns,"ct")).forEach(r=>s.removeChild(r));const o=new Be("svg").attr({width:i,height:n}).attr({style:"width: ".concat(i,"; height: ").concat(n,";")});return e&&o.addClass(e),s.appendChild(o.getNode()),o}function pe(s,i){var n,e,o,r;const a=!(!i.axisX&&!i.axisY),l=(null===(n=i.axisY)||void 0===n?void 0:n.offset)||0,c=(null===(e=i.axisX)||void 0===e?void 0:e.offset)||0,p=null===(o=i.axisY)||void 0===o?void 0:o.position,d=null===(r=i.axisX)||void 0===r?void 0:r.position;let g=s.width()||Gt(i.width).value||0,u=s.height()||Gt(i.height).value||0;const h=function Os(s){return"number"==typeof s?{top:s,right:s,bottom:s,left:s}:void 0===s?{top:0,right:0,bottom:0,left:0}:{top:"number"==typeof s.top?s.top:0,right:"number"==typeof s.right?s.right:0,bottom:"number"==typeof s.bottom?s.bottom:0,left:"number"==typeof s.left?s.left:0}}(i.chartPadding);g=Math.max(g,l+h.left+h.right),u=Math.max(u,c+h.top+h.bottom);const m={x1:0,x2:0,y1:0,y2:0,padding:h,width(){return this.x2-this.x1},height(){return this.y1-this.y2}};return a?("start"===d?(m.y2=h.top+c,m.y1=Math.max(u-h.bottom,m.y2+1)):(m.y2=h.top,m.y1=Math.max(u-h.bottom-c,m.y2+1)),"start"===p?(m.x1=h.left+l,m.x2=Math.max(g-h.right,m.x1+1)):(m.x1=h.left,m.x2=Math.max(g-h.right-l,m.x1+1))):(m.x1=h.left,m.x2=Math.max(g-h.right,m.x1+1),m.y2=h.top,m.y1=Math.max(u-h.bottom,m.y2+1)),m}function Le(s,i,n){let e;const o=[];function r(l){const c=e;e=lt({},s),i&&i.forEach(p=>{window.matchMedia(p[0]).matches&&(e=lt(e,p[1]))}),n&&l&&n.emit("optionsChanged",{previousOptions:c,currentOptions:e})}if(!window.matchMedia)throw new Error("window.matchMedia not found! Make sure you're using a polyfill.");return i&&i.forEach(l=>{const c=window.matchMedia(l[0]);c.addEventListener("change",r),o.push(c)}),r(),{removeMediaQueryListeners:function a(){o.forEach(l=>l.removeEventListener("change",r))},getCurrentOptions:()=>e}}const de={m:["x","y"],l:["x","y"],c:["x1","y1","x2","y2","x","y"],a:["rx","ry","xAr","lAf","sf","x","y"]},Vs={accuracy:3};function Ut(s,i,n,e,o,r){const a={command:o?s.toLowerCase():s.toUpperCase(),...i,...r?{data:r}:{}};n.splice(e,0,a)}function ue(s,i){s.forEach((n,e)=>{de[n.command.toLowerCase()].forEach((o,r)=>{i(n,o,e,r,s)})})}class J{static join(i){const o=new J(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2?arguments[2]:void 0);for(let r=0;r<i.length;r++){const a=i[r];for(let l=0;l<a.pathElements.length;l++)o.pathElements.push(a.pathElements[l])}return o}position(i){return void 0!==i?(this.pos=Math.max(0,Math.min(this.pathElements.length,i)),this):this.pos}remove(i){return this.pathElements.splice(this.pos,i),this}move(i,n){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;return Ut("M",{x:+i,y:+n},this.pathElements,this.pos++,e,o),this}line(i,n){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;return Ut("L",{x:+i,y:+n},this.pathElements,this.pos++,e,o),this}curve(i,n,e,o,r,a){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7?arguments[7]:void 0;return Ut("C",{x1:+i,y1:+n,x2:+e,y2:+o,x:+r,y:+a},this.pathElements,this.pos++,l,c),this}arc(i,n,e,o,r,a,l){let c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],p=arguments.length>8?arguments[8]:void 0;return Ut("A",{rx:i,ry:n,xAr:e,lAf:o,sf:r,x:a,y:l},this.pathElements,this.pos++,c,p),this}parse(i){const n=i.replace(/([A-Za-z])(-?[0-9])/g,"$1 $2").replace(/([0-9])([A-Za-z])/g,"$1 $2").split(/[\s,]+/).reduce((o,r)=>(r.match(/[A-Za-z]/)&&o.push([]),o[o.length-1].push(r),o),[]);"Z"===n[n.length-1][0].toUpperCase()&&n.pop();const e=n.map(o=>{const r=o.shift(),a=de[r.toLowerCase()];return{command:r,...a.reduce((l,c,p)=>(l[c]=+o[p],l),{})}});return this.pathElements.splice(this.pos,0,...e),this.pos+=e.length,this}stringify(){const i=Math.pow(10,this.options.accuracy);return this.pathElements.reduce((n,e)=>{const o=de[e.command.toLowerCase()].map(r=>{const a=e[r];return this.options.accuracy?Math.round(a*i)/i:a});return n+e.command+o.join(",")},"")+(this.close?"Z":"")}scale(i,n){return ue(this.pathElements,(e,o)=>{e[o]*="x"===o[0]?i:n}),this}translate(i,n){return ue(this.pathElements,(e,o)=>{e[o]+="x"===o[0]?i:n}),this}transform(i){return ue(this.pathElements,(n,e,o,r,a)=>{const l=i(n,e,o,r,a);(l||0===l)&&(n[e]=l)}),this}clone(){const n=new J(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.close);return n.pos=this.pos,n.pathElements=this.pathElements.slice().map(e=>({...e})),n.options={...this.options},n}splitByCommand(i){const n=[new J];return this.pathElements.forEach(e=>{e.command===i.toUpperCase()&&0!==n[n.length-1].pathElements.length&&n.push(new J),n[n.length-1].pathElements.push(e)}),n}constructor(i=!1,n){this.close=i,this.pathElements=[],this.pos=0,this.options={...Vs,...n}}}function gt(s){const i={fillHoles:!1,...s};return function(e,o){const r=new J;let a=!0;for(let l=0;l<e.length;l+=2){const c=e[l],p=e[l+1],d=o[l/2];void 0!==At(d.value)?(a?r.move(c,p,!1,d):r.line(c,p,!1,d),a=!1):i.fillHoles||(a=!0)}return r}}function ze(s){const i={fillHoles:!1,...s};return function n(e,o){const r=function Ge(s,i,n){const e={increasingX:!1,fillHoles:!1,...n},o=[];let r=!0;for(let a=0;a<s.length;a+=2)void 0===At(i[a/2].value)?e.fillHoles||(r=!0):(e.increasingX&&a>=2&&s[a]<=s[a-2]&&(r=!0),r&&(o.push({pathCoordinates:[],valueData:[]}),r=!1),o[o.length-1].pathCoordinates.push(s[a],s[a+1]),o[o.length-1].valueData.push(i[a/2]));return o}(e,o,{fillHoles:i.fillHoles,increasingX:!0});if(r.length){if(r.length>1)return J.join(r.map(a=>n(a.pathCoordinates,a.valueData)));{if(o=r[0].valueData,(e=r[0].pathCoordinates).length<=4)return gt()(e,o);const a=[],l=[],c=e.length/2,p=[],d=[],g=[],u=[];for(let m=0;m<c;m++)a[m]=e[2*m],l[m]=e[2*m+1];for(let m=0;m<c-1;m++)g[m]=l[m+1]-l[m],u[m]=a[m+1]-a[m],d[m]=g[m]/u[m];p[0]=d[0],p[c-1]=d[c-2];for(let m=1;m<c-1;m++)0===d[m]||0===d[m-1]||d[m-1]>0!=d[m]>0?p[m]=0:(p[m]=3*(u[m-1]+u[m])/((2*u[m]+u[m-1])/d[m-1]+(u[m]+2*u[m-1])/d[m]),isFinite(p[m])||(p[m]=0));const h=(new J).move(a[0],l[0],!1,o[0]);for(let m=0;m<c-1;m++)h.curve(a[m]+u[m]/3,l[m]+p[m]*u[m]/3,a[m+1]-u[m]/3,l[m+1]-p[m+1]*u[m]/3,a[m+1],l[m+1],!1,o[m+1]);return h}}return gt()([],[])}}class As{on(i,n){const{allListeners:e,listeners:o}=this;"*"===i?e.add(n):(o.has(i)||o.set(i,new Set),o.get(i).add(n))}off(i,n){const{allListeners:e,listeners:o}=this;if("*"===i)n?e.delete(n):e.clear();else if(o.has(i)){const r=o.get(i);n?r.delete(n):r.clear(),r.size||o.delete(i)}}emit(i,n){const{allListeners:e,listeners:o}=this;o.has(i)&&o.get(i).forEach(r=>r(n)),e.forEach(r=>r(i,n))}constructor(){this.listeners=new Map,this.allListeners=new Set}}const me=new WeakMap;class he{update(i,n){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var o;return i&&(this.data=i||{},this.data.labels=this.data.labels||[],this.data.series=this.data.series||[],this.eventEmitter.emit("data",{type:"update",data:this.data})),n&&(this.options=lt({},e?this.options:this.defaultOptions,n),!this.initializeTimeoutId)&&(null===(o=this.optionsProvider)||void 0===o||o.removeMediaQueryListeners(),this.optionsProvider=Le(this.options,this.responsiveOptions,this.eventEmitter)),!this.initializeTimeoutId&&this.optionsProvider&&this.createChart(this.optionsProvider.getCurrentOptions()),this}detach(){var i;return this.initializeTimeoutId?window.clearTimeout(this.initializeTimeoutId):(window.removeEventListener("resize",this.resizeListener),null===(i=this.optionsProvider)||void 0===i||i.removeMediaQueryListeners()),me.delete(this.container),this}on(i,n){return this.eventEmitter.on(i,n),this}off(i,n){return this.eventEmitter.off(i,n),this}initialize(){window.addEventListener("resize",this.resizeListener),this.optionsProvider=Le(this.options,this.responsiveOptions,this.eventEmitter),this.eventEmitter.on("optionsChanged",()=>this.update()),this.options.plugins&&this.options.plugins.forEach(i=>{Array.isArray(i)?i[0](this,i[1]):i(this)}),this.eventEmitter.emit("data",{type:"initial",data:this.data}),this.createChart(this.optionsProvider.getCurrentOptions()),this.initializeTimeoutId=null}constructor(i,n,e,o,r){this.data=n,this.defaultOptions=e,this.options=o,this.responsiveOptions=r,this.eventEmitter=new As,this.resizeListener=()=>this.update(),this.initializeTimeoutId=setTimeout(()=>this.initialize(),0);const a="string"==typeof i?document.querySelector(i):i;if(!a)throw new Error("Target element is not found");this.container=a;const l=me.get(a);l&&l.detach(),me.set(a,this)}}const A={x:{pos:"x",len:"width",dir:"horizontal",rectStart:"x1",rectEnd:"x2",rectOffset:"y2"},y:{pos:"y",len:"height",dir:"vertical",rectStart:"y2",rectEnd:"y1",rectOffset:"x1"}};class ge{createGridAndLabels(i,n,e,o){const r="x"===this.units.pos?e.axisX:e.axisY,a=this.ticks.map((c,p)=>this.projectValue(c,p)),l=this.ticks.map(r.labelInterpolationFnc);a.forEach((c,p)=>{const d=l[p],g={x:0,y:0};let u;u=a[p+1]?a[p+1]-c:Math.max(this.axisLength-c,this.axisLength/this.ticks.length),(""===d||!Oe(d))&&("x"===this.units.pos?(c=this.chartRect.x1+c,g.x=e.axisX.labelOffset.x,g.y="start"===e.axisX.position?this.chartRect.padding.top+e.axisX.labelOffset.y+5:this.chartRect.y1+e.axisX.labelOffset.y+5):(c=this.chartRect.y1-c,g.y=e.axisY.labelOffset.y-u,g.x="start"===e.axisY.position?this.chartRect.padding.left+e.axisY.labelOffset.x:this.chartRect.x2+e.axisY.labelOffset.x+10),r.showGrid&&function Ds(s,i,n,e,o,r,a,l){const c={["".concat(n.units.pos,"1")]:s,["".concat(n.units.pos,"2")]:s,["".concat(n.counterUnits.pos,"1")]:e,["".concat(n.counterUnits.pos,"2")]:e+o},p=r.elem("line",c,a.join(" "));l.emit("draw",{type:"grid",axis:n,index:i,group:r,element:p,...c})}(c,p,this,this.gridOffset,this.chartRect[this.counterUnits.len](),i,[e.classNames.grid,e.classNames[this.units.dir]],o),r.showLabel&&function Ns(s,i,n,e,o,r,a,l,c,p){const d={[o.units.pos]:s+a[o.units.pos],[o.counterUnits.pos]:a[o.counterUnits.pos],[o.units.len]:i,[o.counterUnits.len]:Math.max(0,r-10)},g=Math.round(d[o.units.len]),u=Math.round(d[o.counterUnits.len]),h=document.createElement("span");h.className=c.join(" "),h.style[o.units.len]=g+"px",h.style[o.counterUnits.len]=u+"px",h.textContent=String(e);const m=l.foreignObject(h,{style:"overflow: visible;",...d});p.emit("draw",{type:"label",axis:o,index:n,group:l,element:m,text:e,...d})}(c,u,p,d,this,r.offset,g,n,[e.classNames.label,e.classNames[this.units.dir],"start"===r.position?e.classNames[r.position]:e.classNames.end],o))})}constructor(i,n,e){this.units=i,this.chartRect=n,this.ticks=e,this.counterUnits=i===A.x?A.y:A.x,this.axisLength=n[this.units.rectEnd]-n[this.units.rectStart],this.gridOffset=n[this.units.rectOffset]}}class fe extends ge{projectValue(i){const n=Number(At(i,this.units.pos));return this.axisLength*(n-this.bounds.min)/this.bounds.range}constructor(i,n,e,o){const r=o.highLow||function Bt(s,i,n){const e={high:void 0===(i={...i,...n?"x"===n?i.axisX:i.axisY:{}}).high?-Number.MAX_VALUE:+i.high,low:void 0===i.low?Number.MAX_VALUE:+i.low},o=void 0===i.high,r=void 0===i.low;return(o||r)&&function a(l){if(!Ve(l))if(Array.isArray(l))for(let c=0;c<l.length;c++)a(l[c]);else{const c=Number(n&&R(l,n)?l[n]:l);o&&c>e.high&&(e.high=c),r&&c<e.low&&(e.low=c)}}(s),(i.referenceValue||0===i.referenceValue)&&(e.high=Math.max(i.referenceValue,e.high),e.low=Math.min(i.referenceValue,e.low)),e.high<=e.low&&(0===e.low?e.high=1:e.low<0?e.high=0:(e.high>0||(e.high=1),e.low=0)),e}(n,o,i.pos),a=function ks(s,i,n){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const o={high:i.high,low:i.low,valueRange:0,oom:0,step:0,min:0,max:0,range:0,numberOfSteps:0,values:[]};o.valueRange=o.high-o.low,o.oom=function ys(s){return Math.floor(Math.log(Math.abs(s))/Math.LN10)}(o.valueRange),o.step=Math.pow(10,o.oom),o.min=Math.floor(o.low/o.step)*o.step,o.max=Math.ceil(o.high/o.step)*o.step,o.range=o.max-o.min,o.numberOfSteps=Math.round(o.range/o.step);const a=xt(s,o.step,o)<n,l=e?function xs(s){if(1===s)return s;function i(a,l){return a%l==0?l:i(l,a%l)}function n(a){return a*a+1}let r,e=2,o=2;if(s%2==0)return 2;do{e=n(e)%s,o=n(n(o))%s,r=i(Math.abs(e-o),s)}while(1===r);return r}(o.range):0;if(e&&xt(s,1,o)>=n)o.step=1;else if(e&&l<o.step&&xt(s,l,o)>=n)o.step=l;else{let u=0;for(;;){if(a&&xt(s,o.step,o)<=n)o.step*=2;else{if(a||!(xt(s,o.step/2,o)>=n))break;if(o.step/=2,e&&o.step%1!=0){o.step*=2;break}}if(u++>1e3)throw new Error("Exceeded maximum number of iterations while optimizing scale step!")}}function c(u,h){return u===(u+=h)&&(u*=1+(h>0?ie:-ie)),u}o.step=Math.max(o.step,ie);let p=o.min,d=o.max;for(;p+o.step<=o.low;)p=c(p,o.step);for(;d-o.step>=o.high;)d=c(d,-o.step);o.min=p,o.max=d,o.range=o.max-o.min;const g=[];for(let u=o.min;u<=o.max;u=c(u,o.step)){const h=bs(u);h!==g[g.length-1]&&g.push(h)}return o.values=g,o}(e[i.rectEnd]-e[i.rectStart],r,o.scaleMinSpace||20,o.onlyInteger),l={min:a.min,max:a.max};super(i,e,a.values),this.bounds=a,this.range=l}}class Lt extends ge{projectValue(i,n){return this.stepLength*n}constructor(i,n,e,o){const r=o.ticks||[];super(i,e,r);const a=Math.max(1,r.length-(o.stretch?1:0));this.stepLength=this.axisLength/a,this.stretch=!!o.stretch}}function Ct(s,i,n){var e;if(R(s,"name")&&s.name&&null!==(e=i.series)&&void 0!==e&&e[s.name]){const r=(i?.series[s.name])[n];return void 0===r?i[n]:r}return i[n]}const Pe={axisX:{offset:30,position:"end",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:kt,type:void 0},axisY:{offset:40,position:"start",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:kt,type:void 0,scaleMinSpace:20,onlyInteger:!1},width:void 0,height:void 0,showLine:!0,showPoint:!0,showArea:!1,areaBase:0,lineSmooth:!0,showGridBackground:!1,low:void 0,high:void 0,chartPadding:{top:15,right:15,bottom:5,left:10},fullWidth:!1,reverseData:!1,classNames:{chart:"ct-chart-line",label:"ct-label",labelGroup:"ct-labels",series:"ct-series",line:"ct-line",point:"ct-point",area:"ct-area",grid:"ct-grid",gridGroup:"ct-grids",gridBackground:"ct-grid-background",vertical:"ct-vertical",horizontal:"ct-horizontal",start:"ct-start",end:"ct-end"}};class Bs extends he{createChart(i){const{data:n}=this,e=ae(n,i.reverseData,!0),o=ce(this.container,i.width,i.height,i.classNames.chart);this.svg=o;const r=o.elem("g").addClass(i.classNames.gridGroup),a=o.elem("g"),l=o.elem("g").addClass(i.classNames.labelGroup),c=pe(o,i);let p,d;p=void 0===i.axisX.type?new Lt(A.x,e.series,c,{...i.axisX,ticks:e.labels,stretch:i.fullWidth}):new i.axisX.type(A.x,e.series,c,i.axisX),d=void 0===i.axisY.type?new fe(A.y,e.series,c,{...i.axisY,high:wt(i.high)?i.high:i.axisY.high,low:wt(i.low)?i.low:i.axisY.low}):new i.axisY.type(A.y,e.series,c,i.axisY),p.createGridAndLabels(r,l,i,this.eventEmitter),d.createGridAndLabels(r,l,i,this.eventEmitter),i.showGridBackground&&function Ue(s,i,n,e){const o=s.elem("rect",{x:i.x1,y:i.y2,width:i.width(),height:i.height()},n,!0);e.emit("draw",{type:"gridBackground",group:s,element:o})}(r,c,i.classNames.gridBackground,this.eventEmitter),function De(s,i){let e=0;s[arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"reduceRight":"reduce"]((o,r,a)=>i(r,e++,a),void 0)}(n.series,(g,u)=>{const h=a.elem("g"),m=R(g,"name")&&g.name,x=R(g,"className")&&g.className,b=R(g,"meta")?g.meta:void 0;m&&h.attr({"ct:series-name":m}),b&&h.attr({"ct:meta":Rt(b)}),h.addClass([i.classNames.series,x||"".concat(i.classNames.series,"-").concat(oe(u))].join(" "));const B=[],z=[];e.series[u].forEach((k,w)=>{const C={x:c.x1+p.projectValue(k,w,e.series[u]),y:c.y1-d.projectValue(k,w,e.series[u])};B.push(C.x,C.y),z.push({value:k,valueIndex:w,meta:Ne(g,w)})});const G={lineSmooth:Ct(g,i,"lineSmooth"),showPoint:Ct(g,i,"showPoint"),showLine:Ct(g,i,"showLine"),showArea:Ct(g,i,"showArea"),areaBase:Ct(g,i,"areaBase")};let tt;tt="function"==typeof G.lineSmooth?G.lineSmooth:G.lineSmooth?ze():gt();const V=tt(B,z);if(G.showPoint&&V.pathElements.forEach(k=>{const{data:w}=k,C=h.elem("line",{x1:k.x,y1:k.y,x2:k.x+.01,y2:k.y},i.classNames.point);if(w){let S,Z;R(w.value,"x")&&(S=w.value.x),R(w.value,"y")&&(Z=w.value.y),C.attr({"ct:value":[S,Z].filter(wt).join(","),"ct:meta":Rt(w.meta)})}this.eventEmitter.emit("draw",{type:"point",value:w?.value,index:w?.valueIndex||0,meta:w?.meta,series:g,seriesIndex:u,axisX:p,axisY:d,group:h,element:C,x:k.x,y:k.y,chartRect:c})}),G.showLine){const k=h.elem("path",{d:V.stringify()},i.classNames.line,!0);this.eventEmitter.emit("draw",{type:"line",values:e.series[u],path:V.clone(),chartRect:c,index:u,series:g,seriesIndex:u,meta:b,axisX:p,axisY:d,group:h,element:k})}if(G.showArea&&d.range){const k=Math.max(Math.min(G.areaBase,d.range.max),d.range.min),w=c.y1-d.projectValue(k);V.splitByCommand("M").filter(C=>C.pathElements.length>1).map(C=>{const S=C.pathElements[0],Z=C.pathElements[C.pathElements.length-1];return C.clone(!0).position(0).remove(1).move(S.x,w).line(S.x,S.y).position(C.pathElements.length+1).line(Z.x,w)}).forEach(C=>{const S=h.elem("path",{d:C.stringify()},i.classNames.area,!0);this.eventEmitter.emit("draw",{type:"area",values:e.series[u],path:C.clone(),series:g,seriesIndex:u,axisX:p,axisY:d,chartRect:c,index:u,group:h,element:S,meta:b})})}},i.reverseData),this.eventEmitter.emit("created",{chartRect:c,axisX:p,axisY:d,svg:o,options:i})}constructor(i,n,e,o){super(i,n,Pe,lt({},Pe,e),o),this.data=n}}const Xe={width:void 0,height:void 0,chartPadding:5,classNames:{chartPie:"ct-chart-pie",chartDonut:"ct-chart-donut",series:"ct-series",slicePie:"ct-slice-pie",sliceDonut:"ct-slice-donut",label:"ct-label"},startAngle:0,total:void 0,donut:!1,donutWidth:60,showLabel:!0,labelOffset:0,labelPosition:"inside",labelInterpolationFnc:kt,labelDirection:"neutral",ignoreEmptyValues:!1};function Ls(s,i,n){const e=i.x>s.x;return e&&"explode"===n||!e&&"implode"===n?"start":e&&"implode"===n||!e&&"explode"===n?"end":"middle"}class zs extends he{createChart(i){const{data:n}=this,e=ae(n),o=[];let r,a,l=i.startAngle;const c=ce(this.container,i.width,i.height,i.donut?i.classNames.chartDonut:i.classNames.chartPie);this.svg=c;const p=pe(c,i);let d=Math.min(p.width()/2,p.height()/2);const g=i.total||e.series.reduce(ws,0),u=Gt(i.donutWidth);"%"===u.unit&&(u.value*=d/100),d-=i.donut?u.value/2:0,a="outside"===i.labelPosition||i.donut?d:"center"===i.labelPosition?0:d/2,i.labelOffset&&(a+=i.labelOffset);const h={x:p.x1+p.width()/2,y:p.y2+p.height()/2},m=1===n.series.filter(x=>R(x,"value")?0!==x.value:0!==x).length;n.series.forEach((x,b)=>o[b]=c.elem("g")),i.showLabel&&(r=c.elem("g")),n.series.forEach((x,b)=>{var B,z;if(0===e.series[b]&&i.ignoreEmptyValues)return;const G=R(x,"name")&&x.name,tt=R(x,"className")&&x.className,V=R(x,"meta")?x.meta:void 0;G&&o[b].attr({"ct:series-name":G}),o[b].addClass([null===(B=i.classNames)||void 0===B?void 0:B.series,tt||"".concat(null===(z=i.classNames)||void 0===z?void 0:z.series,"-").concat(oe(b))].join(" "));let k=g>0?l+e.series[b]/g*360:0;const w=Math.max(0,l-(0===b||m?0:.2));k-w>=359.99&&(k=w+359.99);const C=re(h.x,h.y,d,w),S=re(h.x,h.y,d,k),Z=new J(!i.donut).move(S.x,S.y).arc(d,d,0,+(k-l>180),0,C.x,C.y);i.donut||Z.line(h.x,h.y);const Tt=o[b].elem("path",{d:Z.stringify()},i.donut?i.classNames.sliceDonut:i.classNames.slicePie);if(Tt.attr({"ct:value":e.series[b],"ct:meta":Rt(V)}),i.donut&&Tt.attr({style:"stroke-width: "+u.value+"px"}),this.eventEmitter.emit("draw",{type:"slice",value:e.series[b],totalDataSum:g,index:b,meta:V,series:x,group:o[b],element:Tt,path:Z.clone(),center:h,radius:d,startAngle:l,endAngle:k,chartRect:p}),i.showLabel){let ot,et;ot=1===n.series.length?{x:h.x,y:h.y}:re(h.x,h.y,a,l+(k-l)/2),et=e.labels&&!Oe(e.labels[b])?e.labels[b]:e.series[b];const H=i.labelInterpolationFnc(et,b);if(H||0===H){const _t=r.elem("text",{dx:ot.x,dy:ot.y,"text-anchor":Ls(h,ot,i.labelDirection)},i.classNames.label).text(String(H));this.eventEmitter.emit("draw",{type:"label",index:b,group:r,element:_t,text:""+H,chartRect:p,series:x,meta:V,...ot})}}l=k}),this.eventEmitter.emit("created",{chartRect:p,svg:c,options:i})}constructor(i,n,e,o){super(i,n,Xe,lt({},Xe,e),o),this.data=n}}let Ps=(()=>{class s extends _.Tv{constructor(n,e,o){super(),this._state=n,this._org=e,this._settings=o,this.print=!1,this.day_list=this._state.day_list,this.stats=(0,$.zV)([this._state.options,this._state.counts])}ngOnInit(){this.subscription("charts",(0,$.zV)([this.day_list,this.stats]).subscribe(()=>this.updateCharts()))}ngOnChanges(n){n.print&&n.print.currentValue!==n.print.previousValue&&this.updateCharts()}updateCharts(){var n=this;this.timeout("update_charts",(0,E.A)(function*(){const e=yield n.day_list.pipe((0,T.s)(1)).toPromise();n.updateDailyChart(e);const[o,r]=yield n.stats.pipe((0,T.s)(1)).toPromise();n.updateLevelChart(o,r),n.timeout("update_charts",()=>n.updateDailyChart(e),500)}),50)}updateDailyChart(n){const e={labels:n.map(o=>(0,D.GP)(o.date,"dd MMM")),series:[n.map(o=>+o.utilisation)]};this._day_chart=new Bs("#daily-chart",e)}updateLevelChart(n,e){let{zones:o}=n||{zones:[]};o.length||(o=this._settings.get("app.use_region")?this._org.levelsForRegion().map(l=>l.id):this._org.levelsForBuilding().map(l=>l.id));const r=(o||[]).filter(l=>(e[l]||0)>0),a={labels:r.map(l=>{const c=this._org.levelWithID([l]);return c?.display_name||c.name||""}),series:r.map(l=>e[l]||0)};this._level_chart=new zs("#level-chart",a)}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q),t.rXU(K.yb),t.rXU(_.h$))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["report-desks-charts"]],inputs:{print:"print"},features:[t.Vt3,t.OA$],decls:9,vars:2,consts:[[1,"flex","items-center","space-x-4","w-full","px-4",3,"resize"],[1,"bg-base-100","border","border-base-200","rounded","flex-1","h-[18rem]"],[1,"border-b","border-base-200","p-4","text-xl","font-bold"],["id","daily-chart",1,"ct-chart","ct-octave","max-w-full","w-full","h-56","mx-auto"],["id","level-chart",1,"ct-chart","ct-octave","max-w-full","w-[24rem]","h-56","mx-auto"]],template:function(e,o){1&e&&(t.j41(0,"div",0),t.bIt("resize",function(){return o.updateCharts()},!1,t.tSv),t.j41(1,"div",1)(2,"div",2),t.EFF(3," Daily Utilisation "),t.k0s(),t.nrm(4,"div",3),t.k0s(),t.j41(5,"div",1)(6,"div",2),t.EFF(7," Level Utilisation "),t.k0s(),t.nrm(8,"div",4),t.k0s()()),2&e&&t.AVh("is-print",o.print)},styles:["[_nghost-%COMP%]{display:block}.is-print[_ngcontent-%COMP%]   .ct-chart[_ngcontent-%COMP%]{width:8cm!important}\n\n/*# sourceMappingURL=report-desks-charts.component.ts-angular-inline--142.css.map*/"]})}return s})();const Ys=["report-desks",""];function Xs(s,i){if(1&s&&(t.qex(0),t.j41(1,"div",10)(2,"div",11)(3,"h3"),t.EFF(4,"Total Bookings"),t.k0s(),t.j41(5,"p"),t.EFF(6),t.nI1(7,"async"),t.k0s()(),t.j41(8,"div",11)(9,"h3"),t.EFF(10,"Utilisation"),t.k0s(),t.j41(11,"p"),t.EFF(12),t.nI1(13,"async"),t.k0s()()(),t.nrm(14,"report-desks-charts",12)(15,"report-desks-overall-list",12)(16,"report-desks-levels-list",12),t.bVm()),2&s){const n=t.XpG(2);t.R7$(6),t.JRh(t.bMT(7,5,n.total_count)||0),t.R7$(6),t.SpI("",t.bMT(13,7,n.utilisation)||0,"%"),t.R7$(2),t.Y8G("print",n.printing),t.R7$(),t.Y8G("print",n.printing),t.R7$(),t.Y8G("print",n.printing)}}function Js(s,i){if(1&s&&(t.qex(0),t.DNE(1,Xs,17,9,"ng-container",9),t.nI1(2,"async"),t.bVm()),2&s){const n=t.XpG(),e=t.sdS(15);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,n.total_count))("ngIfElse",e)}}function Hs(s,i){1&s&&(t.j41(0,"div",13),t.nrm(1,"mat-spinner",14),t.j41(2,"p",15),t.EFF(3,"Loading report data..."),t.k0s()()),2&s&&(t.R7$(),t.Y8G("diameter",32))}function Ws(s,i){1&s&&(t.j41(0,"div",16)(1,"p",15),t.EFF(2," Select levels and time period to generate a report. "),t.k0s()())}let Qs=(()=>{class s extends _.Tv{get logo(){return this._settings.get("app.logo_light")||{}}constructor(n,e,o){super(),this._state=n,this._settings=e,this._route=o,this.printing=!1,this.total_count=this._state.stats.pipe((0,y.T)(r=>r.count||0)),this.utilisation=this._state.stats.pipe((0,y.T)(r=>(100*(r.utilisation||0)).toFixed(1))),this.loading=this._state.loading,this.downloadReport=()=>this._state.downloadReport(),this.generateReport=()=>this._state.generateReport()}print(){this.printing=!0,setTimeout(()=>{window.print(),this.printing=!1},300)}ngOnInit(){this._state.setOptions({type:"desks"}),this.subscription("route.query",this._route.queryParamMap.subscribe(n=>{if(n.has("start")&&this._state.setOptions({start:+n.get("start")}),n.has("end")&&this._state.setOptions({end:+n.get("end")}),n.has("zones")){const e=n.get("zones").split(",");e.length&&this._state.setOptions({zones:e})}}))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q),t.rXU(_.h$),t.rXU(F.nX))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["","report-desks",""]],features:[t.Vt3],attrs:Ys,decls:16,vars:11,consts:[["load_state",""],["empty_state",""],[3,"printing","download","generate","loading","has_data"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto","print:overflow-visible","print:h-auto"],[1,"w-full"],[1,"flex","items-center","m-4","p-4","rounded","bg-base-200"],[1,"h-12",3,"src"],[1,"flex-1"],[1,"text-2xl","font-medium","px-2"],[4,"ngIf","ngIfElse"],[1,"m-4","p-4","rounded","bg-base-100","border","border-base-200","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[3,"print"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],[1,"opacity-30"],[1,"h-full","w-full","flex","flex-col","items-center","p-8","screen-only"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"reports-options",2),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("printing",function(l){return t.eBV(r),t.Njj(o.printing=l)})("download",function(){return t.eBV(r),t.Njj(o.downloadReport())})("generate",function(){return t.eBV(r),t.Njj(o.generateReport())}),t.k0s(),t.j41(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"img",6)(7,"div",7),t.j41(8,"h2",8),t.EFF(9,"Desks Report"),t.k0s()()(),t.DNE(10,Js,3,4,"ng-container",9),t.nI1(11,"async"),t.DNE(12,Hs,4,1,"ng-template",null,0,t.C5r)(14,Ws,3,0,"ng-template",null,1,t.C5r),t.k0s()}if(2&e){const r=t.sdS(13);t.Y8G("loading",t.bMT(1,5,o.loading))("has_data",t.bMT(2,7,o.total_count)),t.R7$(6),t.Y8G("src",o.logo.src,t.B4B),t.R7$(4),t.Y8G("ngIf",!t.bMT(11,9,o.loading))("ngIfElse",r)}},dependencies:[v.bT,dt.LG,ut,ls,_s,Ps,v.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}h3[_ngcontent-%COMP%]{font-weight:500}\n\n/*# sourceMappingURL=report-desks.component.ts-angular-inline--137.css.map*/"]})}return s})();var Ks=f(75566);let _e=(()=>{class s{constructor(n){this._reports=n,this.catering_orders=(0,$.zV)([this._reports.options,this._reports.bookings]).pipe((0,y.T)(([{start:e,end:o},r])=>{const a=(0,Y.o)(e).valueOf(),l=(0,U.D)(o).valueOf();return(0,_.Bq)(r.map(d=>d.valid_catering||[])).filter(d=>d.deliver_at_time>=a&&d.deliver_at_time<l&&"cancelled"!==d.status).sort((d,g)=>d.event?.date-g.event?.date)}),(0,N.t)(1)),this.catering_items=this.catering_orders.pipe((0,y.T)(e=>{const o=[];for(const r of e)for(const a of r?.items||[]){const l=o.findIndex(c=>a.options_string===c.options_string);l>=0?a[l]=new Ks.TI({...a,quantity:a?.quantity+a[l]?.quantity}):o.push(a)}return o.sort((r,a)=>a.quantity-r.quantity)})),this.stats=(0,$.zV)([this.catering_orders,this.catering_items]).pipe((0,y.T)(([e,o])=>{const r=e.reduce((a,l)=>a+l.total_cost,0);return{order_count:e.length,unique_items:o.length,item_count:e.reduce((a,l)=>a+l.item_count,0),total_cost:r,avg_cost:r/e.length}}))}downloadOrders(){var n=this;return(0,E.A)(function*(){const e=yield n.catering_orders.pipe((0,T.s)(1)).toPromise(),o=(0,_.SL)(e);return(0,_.PE)("catering-orders.csv",o)})()}static#t=this.\u0275fac=function(e){return new(e||s)(t.KVO(Q))};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),Zs=(()=>{class s{get code(){return this._org.currency_code}constructor(n,e){this._report=n,this._org=e,this.stats=this._report.stats}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(_e),t.rXU(K.yb))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["catering-report-overall"]],decls:32,vars:21,consts:[["item","",1,"flex","flex-col","flex-1","items-center","justify-center"],["count","",1,"text-3xl"],[1,"print:text-sm"],["unique","",1,"text-3xl"],["items","",1,"text-3xl"],["total","",1,"text-3xl"],["average","",1,"text-3xl"]],template:function(e,o){if(1&e&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2),t.nI1(3,"async"),t.k0s(),t.j41(4,"div",2),t.EFF(5,"Orders"),t.k0s()(),t.j41(6,"div",0)(7,"div",3),t.EFF(8),t.nI1(9,"async"),t.k0s(),t.j41(10,"div",2),t.EFF(11,"Unique Items"),t.k0s()(),t.j41(12,"div",0)(13,"div",4),t.EFF(14),t.nI1(15,"async"),t.k0s(),t.j41(16,"div",2),t.EFF(17,"Ordered Items"),t.k0s()(),t.j41(18,"div",0)(19,"div",5),t.EFF(20),t.nI1(21,"async"),t.nI1(22,"currency"),t.k0s(),t.j41(23,"div",2),t.EFF(24,"Total"),t.k0s()(),t.j41(25,"div",0)(26,"div",6),t.EFF(27),t.nI1(28,"async"),t.nI1(29,"currency"),t.k0s(),t.j41(30,"div",2),t.EFF(31,"Order Average"),t.k0s()()),2&e){let r,a,l,c,p;t.R7$(2),t.SpI(" ",(null==(r=t.bMT(3,5,o.stats))?null:r.order_count)||"0"," "),t.R7$(6),t.SpI(" ",(null==(a=t.bMT(9,7,o.stats))?null:a.unique_items)||"0"," "),t.R7$(6),t.SpI(" ",(null==(l=t.bMT(15,9,o.stats))?null:l.item_count)||"0"," "),t.R7$(6),t.SpI(" ",t.i5U(22,13,(null==(c=t.bMT(21,11,o.stats))?null:c.total_cost)/100||0,o.code)," "),t.R7$(7),t.SpI(" ",t.i5U(29,18,(null==(p=t.bMT(28,16,o.stats))?null:p.avg_cost)/100||0,o.code)," ")}},dependencies:[v.Jj,v.oe],styles:["[_nghost-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;padding:.5rem;max-width:64rem;margin:0 auto}[item][_ngcontent-%COMP%]{border:1px solid var(--b2);border-radius:.5rem;padding:1rem;margin:.5rem;height:6rem;width:12rem;min-width:7rem}\n\n/*# sourceMappingURL=catering-report-overall.component.ts-angular-inline--141.css.map*/"]})}return s})();const qs=s=>({key:"deliver_at",name:"Deliver At",content:s}),to=()=>({key:"item_count",name:"Items"}),eo=s=>({key:"total_cost",name:"Total Cost",content:s}),no=(s,i,n)=>[s,i,n];function so(s,i){if(1&s&&(t.j41(0,"div",7),t.EFF(1),t.nI1(2,"date"),t.nI1(3,"date"),t.k0s()),2&s){const n=i.data,e=t.XpG();t.R7$(),t.Lme(" ",t.bMT(2,2,n)," at ",t.i5U(3,4,n,e.time_format)," ")}}function oo(s,i){if(1&s&&(t.j41(0,"div",7),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&s){const n=i.data,e=t.XpG();t.R7$(),t.SpI(" ",t.i5U(2,1,n/100,e.code)," ")}}let io=(()=>{class s{get code(){return this._org.currency_code}get time_format(){return this._settings.time_format}constructor(n,e,o){this._report=n,this._org=e,this._settings=o,this.print=!1,this.orders=this._report.catering_orders,this.download=()=>this._report.downloadOrders()}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(_e),t.rXU(K.yb),t.rXU(_.h$))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["catering-report-orders"]],inputs:{print:"print"},decls:12,vars:13,consts:[["date_template",""],["cost_template",""],[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-base-100","border","border-base-200","mx-auto","my-2"],[1,"border-b","border-base-200","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["matRipple-icon","","matTooltip","Download list",1,"print:hidden",3,"click"],["empty_message","No orders for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],[1,"p-4"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"h2",4),t.EFF(3,"Orders"),t.k0s(),t.j41(4,"button",5),t.bIt("click",function(){return t.eBV(r),t.Njj(o.download())}),t.j41(5,"app-icon"),t.EFF(6,"download"),t.k0s()()(),t.nrm(7,"simple-table",6),t.DNE(8,so,4,7,"ng-template",null,0,t.C5r)(10,oo,3,4,"ng-template",null,1,t.C5r),t.k0s()}if(2&e){const r=t.sdS(9),a=t.sdS(11);t.R7$(7),t.Y8G("data",o.orders)("columns",t.sMw(9,no,t.eq3(4,qs,r),t.lJ4(6,to),t.eq3(7,eo,a)))("sortable",!0)("page_size",o.print?0:10)}},dependencies:[Ot.oV,O.R,L.O,v.oe,v.vh]})}return s})();const ro=()=>({key:"name",name:"Name"}),ao=s=>({key:"options",name:"Options",content:s}),lo=()=>({key:"quantity",name:"Quantity"}),co=s=>({key:"unit_price",name:"Unit Price",content:s}),po=s=>({key:"total_cost",name:"Total Cost",content:s}),uo=(s,i,n,e,o)=>[s,i,n,e,o];function mo(s,i){if(1&s&&(t.j41(0,"span",8),t.EFF(1),t.k0s()),2&s){const n=t.XpG().data,e=t.XpG();t.Y8G("matTooltip",e.options(n)),t.R7$(),t.SpI(" ",n.length," option(s) ")}}function ho(s,i){if(1&s&&(t.j41(0,"div",6),t.DNE(1,mo,2,2,"span",7),t.k0s()),2&s){const n=i.data;t.R7$(),t.Y8G("ngIf",n.length)}}function go(s,i){if(1&s&&(t.j41(0,"div",6),t.EFF(1),t.nI1(2,"currency"),t.k0s()),2&s){const n=i.data,e=t.XpG();t.R7$(),t.JRh(t.i5U(2,1,(n||0)/100,e.code))}}let fo=(()=>{class s{get code(){return this._org.currency_code}constructor(n,e){this._report=n,this._org=e,this.print=!1,this.items=this._report.catering_items}options(n){return n.map(e=>e.name).join("\n")}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(_e),t.rXU(K.yb))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["catering-report-items"]],inputs:{print:"print"},decls:9,vars:18,consts:[["option_template",""],["cost_template",""],[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-base-100","border","border-base-200","mx-auto","my-2"],[1,"border-b","border-base-200","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty_message","No orders for selected period",1,"w-full","block","text-sm",3,"data","columns","page_size","sortable"],[1,"p-4"],["class","text-xs px-2 py-1 rounded bg-base-200",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-base-200",3,"matTooltip"]],template:function(e,o){if(1&e&&(t.j41(0,"div",2)(1,"div",3)(2,"h2",4),t.EFF(3,"Ordered Items"),t.k0s()(),t.nrm(4,"simple-table",5),t.DNE(5,ho,2,1,"ng-template",null,0,t.C5r)(7,go,3,4,"ng-template",null,1,t.C5r),t.k0s()),2&e){const r=t.sdS(6),a=t.sdS(8);t.R7$(4),t.Y8G("data",o.items)("columns",t.s1E(12,uo,t.lJ4(4,ro),t.eq3(5,ao,r),t.lJ4(7,lo),t.eq3(8,co,a),t.eq3(10,po,a)))("page_size",o.print?0:10)("sortable",!0)}},dependencies:[v.bT,Ot.oV,L.O,v.oe]})}return s})();function _o(s,i){if(1&s&&(t.qex(0),t.nrm(1,"catering-report-overall")(2,"catering-report-orders",10)(3,"catering-report-items",10),t.bVm()),2&s){const n=t.XpG(2);t.R7$(2),t.Y8G("print",n.printing),t.R7$(),t.Y8G("print",n.printing)}}function vo(s,i){if(1&s&&(t.qex(0),t.DNE(1,_o,4,2,"ng-container",9),t.nI1(2,"async"),t.bVm()),2&s){const n=t.XpG(),e=t.sdS(15);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,n.total_count))("ngIfElse",e)}}function yo(s,i){1&s&&(t.j41(0,"div",11),t.nrm(1,"mat-spinner",12),t.j41(2,"p",13),t.EFF(3,"Loading report data..."),t.k0s()()),2&s&&(t.R7$(),t.Y8G("diameter",32))}function bo(s,i){1&s&&(t.j41(0,"div",14)(1,"p",13),t.EFF(2," Select levels and time period to generate a report. "),t.k0s()())}let xo=(()=>{class s extends _.Tv{get logo(){return this._settings.get("app.logo_light")||{}}constructor(n,e,o){super(),this._state=n,this._settings=e,this._route=o,this.printing=!1,this.total_count=this._state.stats.pipe((0,y.T)(r=>r.count||0)),this.loading=this._state.loading,this.downloadReport=()=>this._state.downloadReport(),this.generateReport=()=>this._state.generateReport()}ngOnInit(){this._state.setOptions({type:"events"}),this.subscription("route.query",this._route.queryParamMap.subscribe(n=>{if(n.has("start")&&this._state.setOptions({start:+n.get("start")}),n.has("end")&&this._state.setOptions({end:+n.get("end")}),n.has("zones")){const e=n.get("zones").split(",");e.length&&this._state.setOptions({zones:e})}}))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Q),t.rXU(_.h$),t.rXU(F.nX))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["catering-report"]],features:[t.Vt3],decls:16,vars:11,consts:[["load_state",""],["empty_state",""],[3,"printing","download","generate","loading","has_data"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto","print:overflow-visible","print:h-auto"],[1,"w-full"],[1,"flex","items-center","m-4","p-4","rounded","bg-base-200","overflow-hidden"],[1,"h-12",3,"src"],[1,"flex-1"],[1,"text-2xl","font-medium","px-2"],[4,"ngIf","ngIfElse"],[3,"print"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],[1,"opacity-30"],[1,"h-full","w-full","flex","flex-col","items-center","p-8","screen-only"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"reports-options",2),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("printing",function(l){return t.eBV(r),t.Njj(o.printing=l)})("download",function(){return t.eBV(r),t.Njj(o.downloadReport())})("generate",function(){return t.eBV(r),t.Njj(o.generateReport())}),t.k0s(),t.j41(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"img",6)(7,"div",7),t.j41(8,"h2",8),t.EFF(9,"Catering Report"),t.k0s()()(),t.DNE(10,vo,3,4,"ng-container",9),t.nI1(11,"async"),t.DNE(12,yo,4,1,"ng-template",null,0,t.C5r)(14,bo,3,0,"ng-template",null,1,t.C5r),t.k0s()}if(2&e){const r=t.sdS(13);t.Y8G("loading",t.bMT(1,5,o.loading))("has_data",t.bMT(2,7,o.total_count)),t.R7$(6),t.Y8G("src",o.logo.src,t.B4B),t.R7$(4),t.Y8G("ngIf",!t.bMT(11,9,o.loading))("ngIfElse",r)}},dependencies:[v.bT,dt.LG,ut,Zs,io,fo,v.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}\n\n/*# sourceMappingURL=catering-report.component.ts-angular-inline--140.css.map*/"]})}return s})();var ko=f(6109),zt=f(8627),Et=f(66e3),Je=f(89273);const Pt={};let ve=(()=>{class s{transform(n){return n?(Pt[n]||(Pt[n]=(0,pt.N8)(n).pipe((0,y.T)(e=>e[0]||new pt.Gp({id:n,name:n})),(0,Nt.W)(e=>(0,st.of)(new pt.Gp({id:n,name:n}))),(0,N.t)(1))),Pt[n]):(0,st.of)(null)}static addUser(n){Pt[n.id]=(0,st.of)(n).pipe((0,N.t)(1))}static#t=this.\u0275fac=function(e){return new(e||s)};static#e=this.\u0275pipe=t.EJ8({name:"user",type:s,pure:!0})}return s})(),He=(()=>{class s{get system_id(){return this._org.binding("contact_tracing")}get time_format(){return this._settings.time_format}constructor(n,e,o){this._org=n,this._reports=e,this._settings=o,this._loading=new W.t(""),this._generate=new W.t(0),this._options=new W.t({start:(0,Y.o)(Date.now()),end:(0,U.D)(Date.now())}),this.events=(0,$.zV)([this._options,this._generate]).pipe((0,ko.F)((r,a)=>r[1]===a[1]),(0,zt.p)(([r,a])=>!!a),(0,X.n)(([{start:r,end:a,user:l}])=>{if(!l)return(0,st.of)([]);this._loading.next("Loading contact events...");const c=(0,Te.f_4)(this.system_id,"ContactTracing");return l=l||(0,_.Ny)(),ve.addUser(l),this.system_id&&c?c.execute("close_contacts",[l.email,l.username,(0,nt._)(r),(0,nt._)(a)]).catch(p=>((0,_.UG)(`${p?.msg||JSON.stringify(p)}`),[])):(0,st.of)([])}),(0,y.T)(r=>{const a=this._options.getValue().user||(0,_.Ny)();return r.map(l=>({mac_address:l.mac_address,date:1e3*l.contact_time,duration:Math.floor(l.duration/60)||0,user_id:a.id,user:a.name,contact_id:l.username,distance:1}))}),(0,Et.M)(r=>this._loading.next("")),(0,Je.Z)([]),(0,N.t)(1)),this.options=this._options.asObservable(),this.loading=this._loading.asObservable()}setOptions(n){this._options.next({...this._options.getValue(),...n})}generateReport(){this._generate.next(Date.now())}downloadReport(){var n=this;return(0,E.A)(function*(){const{start:e,end:o}=yield n._reports.options.pipe((0,T.s)(1)).toPromise(),r=yield n.events.pipe((0,T.s)(1)).toPromise(),a=new ve,l=yield Promise.all(r.map(function(){var c=(0,E.A)(function*(p){return{"MAC Address":p.mac_address,Date:(0,D.GP)(p.date,"dd MMM yyyy, "+n.time_format),"User Name":p.user,"Contact Name":(yield a.transform(p.contact_id).toPromise())?.name||("null"!==p.contact_id?p.contact_id:null)||p.mac_address,Duration:`${Math.floor(p.duration/60)?Math.floor(p.duration/60)+"h ":""}${Math.floor(p.duration%60)+"m"}`,Distance:p.distance}});return function(p){return c.apply(this,arguments)}}()));if(!l?.length)return(0,_.WS)("No events to download.");(0,_.PE)(`report+contact-tracing+${(0,D.GP)(e,"yyyy-MM-dd")}+${(0,D.GP)(o,"yyyy-MM-dd")}.csv`,(0,_.SL)(l))})()}static#t=this.\u0275fac=function(e){return new(e||s)(t.KVO(K.yb),t.KVO(Q),t.KVO(_.h$))};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var wo=f(18e3);let Ro=(()=>{class s{constructor(n){this._state=n,this.printing=new t.bkB,this.download=new t.bkB,this.options=this._state.options,this.setOptions=e=>this._state.setOptions(e),this.generate=()=>this._state.generateReport()}print(){this.printing.emit(!0),setTimeout(()=>{window.print(),this.printing.emit(!1)},300)}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(He))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["contact-tracing-options"]],outputs:{printing:"printing",download:"download"},decls:19,vars:15,consts:[["startDate",""],["endDate",""],[1,"flex","items-center","space-x-2","w-full","p-4","bg-base-100","shadow"],[3,"ngModelChange","ngModel"],["placeholder","Search for user to trace...",1,"w-64",3,"ngModelChange","ngModel"],[1,"flex-1"],["icon","","matRipple","","matTooltip","Download Report",1,"h-12","w-12","rounded","bg-secondary","text-secondary-content",3,"click","disabled"],["icon","","matRipple","","matTooltip","Print Report",1,"h-12","w-12","rounded","bg-secondary","text-secondary-content",3,"click","disabled"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"div",2)(1,"date-range-field")(2,"input",3,0),t.nI1(4,"async"),t.bIt("ngModelChange",function(l){return t.eBV(r),t.Njj(l?o.setOptions({start:l,user:null}):"")}),t.k0s(),t.j41(5,"input",3,1),t.nI1(7,"async"),t.bIt("ngModelChange",function(l){return t.eBV(r),t.Njj(l?o.setOptions({end:l,user:null}):"")}),t.k0s()(),t.j41(8,"a-user-search-field",4),t.nI1(9,"async"),t.bIt("ngModelChange",function(l){return t.eBV(r),t.Njj(o.setOptions({user:l}))}),t.k0s(),t.nrm(10,"div",5),t.j41(11,"button",6),t.nI1(12,"async"),t.bIt("click",function(){return t.eBV(r),t.Njj(o.download.emit())}),t.j41(13,"app-icon"),t.EFF(14,"download"),t.k0s()(),t.j41(15,"button",7),t.nI1(16,"async"),t.bIt("click",function(){return t.eBV(r),t.Njj(o.print())}),t.j41(17,"app-icon"),t.EFF(18,"print"),t.k0s()()()}if(2&e){let r,a,l,c,p;t.R7$(2),t.Y8G("ngModel",null==(r=t.bMT(4,5,o.options))?null:r.start),t.R7$(3),t.Y8G("ngModel",null==(a=t.bMT(7,7,o.options))?null:a.end),t.R7$(3),t.Y8G("ngModel",null==(l=t.bMT(9,9,o.options))?null:l.user),t.R7$(3),t.Y8G("disabled",!(null!=(c=t.bMT(12,11,o.options))&&c.user)),t.R7$(4),t.Y8G("disabled",!(null!=(p=t.bMT(16,13,o.options))&&p.user))}},dependencies:[q.me,q.BC,q.vS,Ot.oV,j.r6,Ee.T,wo.$,O.R,v.Jj],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25rem}button[icon][disabled][_ngcontent-%COMP%]{background-color:var(--n)!important}\n\n/*# sourceMappingURL=contact-tracing-options.component.ts-angular-inline--144.css.map*/"]})}return s})();const Co=s=>({key:"date",name:"Time of Contact",content:s}),Eo=s=>({key:"user_id",name:"Person",content:s}),To=s=>({key:"contact_id",name:"Close Contact",content:s}),jo=s=>({key:"duration",name:"Duration",content:s}),Fo=(s,i,n,e)=>[s,i,n,e];function Mo(s,i){if(1&s&&(t.j41(0,"div",17),t.EFF(1),t.nI1(2,"user"),t.nI1(3,"async"),t.k0s()),2&s){let n;const e=i.data,o=i.row;t.R7$(),t.SpI(" ",(null==(n=t.bMT(3,3,t.bMT(2,1,e)))?null:n.name)||o.mac_address," ")}}function Io(s,i){if(1&s&&(t.j41(0,"div",17),t.EFF(1),t.nI1(2,"date"),t.nI1(3,"date"),t.k0s()),2&s){const n=i.data,e=t.XpG(3);t.R7$(),t.Lme(" ",t.i5U(2,2,n,"mediumDate"),", ",t.i5U(3,5,n,e.time_format)," ")}}function Oo(s,i){if(1&s&&(t.j41(0,"div",17),t.EFF(1),t.k0s()),2&s){const n=i.data,e=t.XpG(3);t.R7$(),t.SpI(" ",e.formatDuration(n||0)||"Less than a minute"," ")}}function Do(s,i){if(1&s&&(t.qex(0),t.j41(1,"div",13)(2,"div",14)(3,"h2",15),t.EFF(4," Contact Events "),t.k0s()(),t.nrm(5,"simple-table",16),t.DNE(6,Mo,4,5,"ng-template",null,2,t.C5r)(8,Io,4,8,"ng-template",null,3,t.C5r)(10,Oo,2,1,"ng-template",null,4,t.C5r),t.k0s(),t.bVm()),2&s){const n=t.sdS(7),e=t.sdS(9),o=t.sdS(11),r=t.XpG(2);t.R7$(5),t.Y8G("data",r.tracing_events)("columns",t.ziG(12,Fo,t.eq3(4,Co,e),t.eq3(6,Eo,n),t.eq3(8,To,n),t.eq3(10,jo,o)))("sortable",!0)("page_size",r.print?0:30)}}function No(s,i){if(1&s&&(t.qex(0),t.DNE(1,Do,12,17,"ng-container",12),t.nI1(2,"async"),t.bVm()),2&s){let n;const e=t.XpG(),o=t.sdS(13);t.R7$(),t.Y8G("ngIf",null==(n=t.bMT(2,2,e.options))?null:n.user)("ngIfElse",o)}}function Vo(s,i){if(1&s&&(t.j41(0,"div",18),t.nrm(1,"map-spinner",19),t.j41(2,"p",20),t.EFF(3),t.nI1(4,"async"),t.k0s()()),2&s){const n=t.XpG();t.R7$(3),t.JRh(t.bMT(4,1,n.loading))}}function So(s,i){1&s&&(t.j41(0,"div",21)(1,"p",20),t.EFF(2,"Select a user from the topbar to begin"),t.k0s()())}let Go=(()=>{class s{get time_format(){return this._settings.time_format}get logo(){return this._settings.get("app.logo_light")||{}}constructor(n,e){this._state=n,this._settings=e,this.printing=!1,this.loading=this._state.loading,this.options=this._state.options,this.tracing_events=this._state.events,this.setOptions=o=>this._state.setOptions(o),this.downloadReport=()=>this._state.downloadReport(),this.formatDuration=o=>(0,se.a)({hours:Math.floor(o/60),minutes:o%60})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(He),t.rXU(_.h$))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["app-contact-tracing-report"]],decls:14,vars:5,consts:[["load_state",""],["empty_state",""],["user_template",""],["date_template",""],["duration_template",""],[1,"print:hidden",3,"printing","download"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto","print:overflow-visible","print:h-auto"],[1,"w-full"],[1,"flex","items-center","m-4","p-4","rounded","bg-base-200","overflow-hidden"],[1,"h-12",3,"src"],[1,"flex-1"],[1,"text-2xl","font-medium","px-2"],[4,"ngIf","ngIfElse"],[1,"w-[64rem]","max-w-[calc(100%-2rem)]","mx-auto","my-2","rounded-lg","border","border-base-200"],[1,"border-b","border-base-200","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty_message","No contact tracing events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],[1,"p-4"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"],[1,"opacity-30"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2","screen-only"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"contact-tracing-options",5),t.bIt("printing",function(l){return t.eBV(r),t.Njj(o.printing=l)})("download",function(){return t.eBV(r),t.Njj(o.downloadReport())}),t.k0s(),t.j41(1,"div",6)(2,"div",7)(3,"div",8),t.nrm(4,"img",9)(5,"div",10),t.j41(6,"h2",11),t.EFF(7," Contact Tracing Report "),t.k0s()()(),t.DNE(8,No,3,4,"ng-container",12),t.nI1(9,"async"),t.k0s(),t.DNE(10,Vo,5,3,"ng-template",null,0,t.C5r)(12,So,3,0,"ng-template",null,1,t.C5r)}if(2&e){const r=t.sdS(11);t.R7$(4),t.Y8G("src",o.logo.src,t.B4B),t.R7$(4),t.Y8G("ngIf",!t.bMT(9,3,o.loading))("ngIfElse",r)}},dependencies:[v.bT,L.O,Ro,v.Jj,v.vh,ve],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}\n\n/*# sourceMappingURL=contact-tracing-report.component.ts-angular-inline--143.css.map*/"]})}return s})();var $o=f(26781);function Ao(s,i){if(1&s&&(t.nrm(0,"iframe",1),t.nI1(1,"safe")),2&s){const n=t.XpG();t.Y8G("src",t.i5U(1,1,n.report_url,"resource"),t.f$h)}}const Bo={};let Uo=(()=>{class s extends _.Tv{get report_url(){let n=(this._settings.get("app.custom_reports")||[]).find(o=>o.id===this.id)||Bo;return n.url?n.url+(n.url.includes("?")?"&":"?")+"kiosk=tv"+(n.api_key?`&key=${encodeURIComponent(n.api_key)}`:""):""}constructor(n,e){super(),this._settings=n,this._route=e,this.id=""}ngOnInit(){this.subscription("route.params",this._route.paramMap.subscribe(n=>this.id=n.get("id")||""))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(_.h$),t.rXU(F.nX))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["custom-report"]],features:[t.Vt3],decls:1,vars:1,consts:[["class","w-full h-full",3,"src",4,"ngIf"],[1,"w-full","h-full",3,"src"]],template:function(e,o){1&e&&t.DNE(0,Ao,2,4,"iframe",0),2&e&&t.Y8G("ngIf",o.id)},dependencies:[v.bT,$o.m],styles:["[_nghost-%COMP%]{height:100%;width:100%}\n\n/*# sourceMappingURL=custom-report.component.ts-angular-inline--145.css.map*/"]})}return s})();var Lo=f(45189),zo=f(96843);const Po=["app-new-reports",""];function Yo(s,i){1&s&&t.nrm(0,"div",4)}let Xo=(()=>{class s{get path(){const n=this._router.url.split("/");return n[n.length-1]}constructor(n){this._router=n}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(F.Ix))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["","app-new-reports",""]],attrs:Po,decls:6,vars:1,consts:[[1,"screen-only"],[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full","relative"],["reports-menu","","class","absolute inset-0 screen-only",4,"ngIf"],["reports-menu","",1,"absolute","inset-0","screen-only"]],template:function(e,o){1&e&&(t.nrm(0,"app-topbar",0),t.j41(1,"div",1),t.nrm(2,"app-sidebar",0),t.j41(3,"main",2),t.nrm(4,"router-outlet"),t.DNE(5,Yo,1,0,"div",3),t.k0s()()),2&e&&(t.R7$(5),t.Y8G("ngIf","reports"===o.path))},dependencies:[v.bT,Lo.S,zo.c,F.n3,Mt],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}main[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(router-outlet){display:flex;flex-direction:column;width:100%;height:100%}\n\n/*# sourceMappingURL=new-reports.component.ts-angular-inline--146.css.map*/"]})}return s})();var We=f(97236);let ft=(()=>{class s{_processBookingStats(n,e){const o=n.map(a=>a.asset_ids?.length||[a.asset_id]).flat(),r=(0,_.Am)(n.map(a=>a.linked_event||a.linked_bookings[0]).filter(a=>a),"id").map(a=>new Dt.LR(a));return{events:r,bookings:n,products:e,booking_count:n.length,event_count:r.length,total_booked_items:n.reduce((a,l)=>a+l.asset_ids.length,0),unique_items:e.filter(a=>a.assets.find(l=>o.includes(l.id))).length,products_booked:e.filter(a=>a.assets.find(l=>o.includes(l.id))).map(a=>({name:a.name,count:a.assets.filter(l=>o.includes(l.id)).length}))}}constructor(n,e){this._org=n,this._settings=e,this._loading=new W.t(!1),this._options=new W.t({}),this._generate=new W.t(0),this.loading$=this._loading.asObservable(),this.options$=this._options.asObservable(),this.products$=this._generate.pipe((0,zt.p)(o=>o>0),(0,X.n)(()=>this._options.pipe((0,T.s)(1))),(0,at.B)(300),(0,X.n)(o=>(this._loading.next(!0),(0,We.iO)({zones:(this._settings.get("app.use_region")?this._org.region?.id:"")||this._org.building?.id}))),(0,Et.M)(()=>this._loading.next(!1)),(0,N.t)(1)),this.bookings$=this._generate.pipe((0,zt.p)(o=>o>0),(0,X.n)(()=>this._options.pipe((0,T.s)(1))),(0,at.B)(300),(0,X.n)(o=>{this._loading.next(!0);const{start:r,end:a,zones:l}=o;return(0,qt.tj)({period_start:(0,nt._)((0,Y.o)(r||Date.now())),period_end:(0,nt._)((0,U.D)(a||r||Date.now())),type:"asset-request",zones:(l||[])?.join(",")||(this._settings.get("app.use_region")?this._org.region?.id:"")||this._org.building?.id})}),(0,Et.M)(o=>{o.length||(0,_.UG)("No bookings for the selected levels and period"),this._loading.next(!1)}),(0,N.t)(1)),this.stats$=(0,$.zV)([this.products$,this.bookings$]).pipe((0,y.T)(([o,r])=>this._processBookingStats(r,o)),(0,N.t)(1)),this.daily_stats$=(0,$.zV)([this._options,this.products$,this.bookings$]).pipe((0,y.T)(([o,r,a])=>{const l={};let c=0,p=(0,Y.o)(o.start);const d=(0,U.D)(o.end);for(;(0,je.Y)(p,d)&&c<365;)l[(0,D.GP)(p,"yyyy-MM-dd")]=this._processBookingStats(a.filter(u=>(0,Vt.r)(u.date,p)),r),p=(0,mt.f)(p,1),c++;return l}),(0,N.t)(1)),this.expired_items$=this._generate.pipe((0,X.n)(()=>(this._loading.next(!0),(0,$.zV)([(0,We.fc)({}),this._options]))),(0,y.T)(([o,r])=>o.filter(a=>{(0,nt._)(r.start||Date.now())})),(0,Et.M)(()=>this._loading.next(!1)),(0,N.t)(1))}generateReport(){this._generate.next(Date.now())}downloadReport(){var n=this;return(0,E.A)(function*(){const e=n._options.getValue(),o=yield n.bookings$.pipe((0,T.s)(1)).toPromise();if(!o?.length)return;const a=(0,Vt.r)(e.start,e.end)?(0,D.GP)(e.start,"yyyy-MM-dd"):`${(0,D.GP)(e.start,"yyyy-MM-dd")}-${(0,D.GP)(e.end,"yyyy-MM-dd")}`;(0,_.PE)(`report+assets+${a}.tsv`,(0,_.SL)(o.map(l=>{const c=l.toJSON();return delete c.zones,delete c.server_names,delete c.extension_data,c}),"\t"))})()}setOptions(n){this._options.next({...this._options.getValue(),...n})}static#t=this.\u0275fac=function(e){return new(e||s)(t.KVO(K.yb),t.KVO(_.h$))};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),Jo=(()=>{class s{constructor(n){this._state=n,this.total_count=this._state.stats$.pipe((0,y.T)(e=>e.booking_count)),this.business_days=this._state.options$.pipe((0,y.T)(({start:e,end:o})=>ne((0,U.D)(o||Date.now()).valueOf()+1,(0,Y.o)(e||Date.now()))||1)),this.avg_length=this._state.stats$.pipe((0,y.T)(({events:e})=>e.reduce((o,r)=>o+r.duration,0)/e.length))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(ft))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["asset-report-overall"]],decls:19,vars:9,consts:[[1,"m-4","p-4","rounded","bg-base-100","border","border-base-200","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"text-sm"],[1,"text-2xl"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"h3",2),t.EFF(3,"Business Days"),t.k0s(),t.j41(4,"p",3),t.EFF(5),t.nI1(6,"async"),t.k0s()(),t.j41(7,"div",1)(8,"h3",2),t.EFF(9,"Total Bookings"),t.k0s(),t.j41(10,"p",3),t.EFF(11),t.nI1(12,"async"),t.k0s()(),t.j41(13,"div",1)(14,"h3",2),t.EFF(15,"Average Booking Length"),t.k0s(),t.j41(16,"p",3),t.EFF(17),t.nI1(18,"async"),t.k0s()()()),2&e&&(t.R7$(5),t.JRh(t.bMT(6,3,o.business_days)||0),t.R7$(6),t.JRh(t.bMT(12,5,o.total_count)||0),t.R7$(6),t.SpI("",t.bMT(18,7,o.avg_length)||"0"," mins"))},dependencies:[v.Jj]})}return s})();const Ho=()=>({key:"name",name:"Name"}),Wo=s=>({key:"date",name:"Date",content:s}),Qo=()=>({key:"booking_count",name:"Bookings Count"}),Ko=()=>({key:"booked_count",name:"Number Booked"}),Zo=()=>({key:"asset_count",name:"Assets Available"}),qo=(s,i,n,e,o)=>[s,i,n,e,o];function ti(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",6),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}function ei(s,i){if(1&s&&(t.j41(0,"div",7),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&s){const n=i.row;t.R7$(),t.SpI(" ",t.i5U(2,1,n.date,"mediumDate")," ")}}let ni=(()=>{class s{constructor(n){var e=this;this._state=n,this.print=!1,this.daily_products=this._state.daily_stats$.pipe((0,y.T)(o=>{let r=[];for(const a in o){const{bookings:c,products:p}=o[a],d=(p||[]).map(g=>{const u=c.filter(h=>g.assets.find(({id:m})=>h.asset_ids.includes(m)));return{name:g.name,date:a,booking_count:u.length,booked_count:u.reduce((h,m)=>h+m.asset_ids.filter(x=>g.assets.find(({id:b})=>x===b)).length,0),asset_count:g.assets.length}});r=r.concat(d.filter(g=>g.booking_count>0))}return r})),this.download=(0,E.A)(function*(){const o=yield e.daily_products.pipe((0,T.s)(1)).toPromise();(0,_.PE)("report-assets-daily-usage.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(ft))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["asset-report-daily-usage"]],inputs:{print:"print"},decls:8,vars:17,consts:[["date_template",""],[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"],[1,"p-4"]],template:function(e,o){if(1&e&&(t.j41(0,"div",1)(1,"div",2)(2,"h3",3),t.EFF(3,"Daily Asset Usage"),t.k0s(),t.DNE(4,ti,3,0,"button",4),t.k0s(),t.nrm(5,"simple-table",5),t.DNE(6,ei,3,4,"ng-template",null,0,t.C5r),t.k0s()),2&e){const r=t.sdS(7);t.R7$(4),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.daily_products)("columns",t.s1E(11,qo,t.lJ4(5,Ho),t.eq3(6,Wo,r),t.lJ4(8,Qo),t.lJ4(9,Ko),t.lJ4(10,Zo)))("sortable",!0)("page_size",o.print?0:10)}},dependencies:[v.bT,j.r6,O.R,L.O,v.vh]})}return s})();const si=()=>({key:"name",name:"Name"}),oi=()=>({key:"booking_count",name:"Bookings with Product"}),ii=()=>({key:"booked_count",name:"Number Booked"}),ri=()=>({key:"asset_count",name:"Assets Available"}),ai=(s,i,n,e)=>[s,i,n,e];function li(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",5),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}let ci=(()=>{class s{constructor(n){var e=this;this._state=n,this.print=!1,this.products=this._state.stats$.pipe((0,y.T)(({bookings:r,products:a})=>a.map(l=>{const c=r.filter(p=>l.assets.find(({id:d})=>p.asset_ids.includes(d)));return{name:l.name,booking_count:c.length,booked_count:c.reduce((p,d)=>p+d.asset_ids.filter(g=>l.assets.find(({id:u})=>g===u)).length,0),asset_count:l.assets.length}}).filter(l=>l.booking_count>0))),this.download=(0,E.A)(function*(){const o=yield e.products.pipe((0,T.s)(1)).toPromise();(0,_.PE)("report-assets-product-usage.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(ft))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["asset-report-product-usage"]],inputs:{print:"print"},decls:6,vars:14,consts:[[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"h3",2),t.EFF(3,"Asset Products Usage"),t.k0s(),t.DNE(4,li,3,0,"button",3),t.k0s(),t.nrm(5,"simple-table",4),t.k0s()),2&e&&(t.R7$(4),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.products)("columns",t.ziG(9,ai,t.lJ4(5,si),t.lJ4(6,oi),t.lJ4(7,ii),t.lJ4(8,ri)))("sortable",!0)("page_size",o.print?0:10))},dependencies:[v.bT,j.r6,O.R,L.O]})}return s})();const pi=()=>({key:"name",name:"Name"}),di=()=>({key:"booking_count",name:"Bookings"}),ui=()=>({key:"asset_count",name:"Assets Booked"}),mi=()=>({key:"asset_types",name:"Asset Types"}),hi=(s,i,n,e)=>[s,i,n,e];function gi(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",5),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}let fi=(()=>{class s{constructor(n){var e=this;this._state=n,this.print=!1,this.users=this._state.stats$.pipe((0,y.T)(({events:o,bookings:r,products:a})=>(0,_.Am)(o,"host").map(c=>{const p=r.filter(u=>u.booked_by_email===c.host),d=(0,_.Am)(p.map(u=>u.asset_ids).flat()),g=(0,_.Am)(d.map(u=>a.find(h=>h.assets.find(m=>m.id===u))?.name));return{name:c.organiser?.name||c.organiser?.email||c.host,booking_count:o.filter(u=>u.host===c.host).length,asset_count:d.length,asset_types:g.length||0}}))),this.download=(0,E.A)(function*(){const o=yield e.users.pipe((0,T.s)(1)).toPromise();(0,_.PE)("report-assets-users.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(ft))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["asset-report-users"]],inputs:{print:"print"},decls:6,vars:14,consts:[[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"h3",2),t.EFF(3,"Asset Requestees"),t.k0s(),t.DNE(4,gi,3,0,"button",3),t.k0s(),t.nrm(5,"simple-table",4),t.k0s()),2&e&&(t.R7$(4),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.users)("columns",t.ziG(9,hi,t.lJ4(5,pi),t.lJ4(6,di),t.lJ4(7,ui),t.lJ4(8,mi)))("sortable",!0)("page_size",o.print?0:10))},dependencies:[v.bT,j.r6,O.R,L.O]})}return s})();const _i=()=>({key:"purchase_order_number",name:"PO Number"}),vi=()=>({key:"invoice_number",name:"Invoice Number"}),yi=s=>({key:"purchase_date",name:"Purchase Date",content:s}),bi=s=>({key:"expected_service_start_date",name:"Service Start",content:s}),xi=s=>({key:"expected_service_end_date",name:"Service End",content:s}),ki=(s,i,n,e,o)=>[s,i,n,e,o];function wi(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",6),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}function Ri(s,i){1&s&&(t.j41(0,"span",9),t.EFF(1,"No Date"),t.k0s())}function Ci(s,i){if(1&s&&(t.j41(0,"div",7),t.DNE(1,Ri,2,0,"span",8),t.EFF(2),t.nI1(3,"date"),t.k0s()),2&s){const n=i.data;t.R7$(),t.Y8G("ngIf",!n),t.R7$(),t.SpI(" ",n?t.i5U(3,2,1e3*n,"mediumDate"):""," ")}}let Ei=(()=>{class s{constructor(n){var e=this;this._state=n,this.print=!1,this.expired_items=this._state.expired_items$,this.download=(0,E.A)(function*(){const o=yield e.expired_items.pipe((0,T.s)(1)).toPromise();(0,_.PE)("report-assets-expired-items.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(ft))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["asset-report-expired-items"]],inputs:{print:"print"},decls:8,vars:19,consts:[["date_template",""],[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No purchase orders expired for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"],[1,"p-4"],["class","opacity-30",4,"ngIf"],[1,"opacity-30"]],template:function(e,o){if(1&e&&(t.j41(0,"div",1)(1,"div",2)(2,"h3",3),t.EFF(3," Expired Assets Purchase Orders "),t.k0s(),t.DNE(4,wi,3,0,"button",4),t.k0s(),t.nrm(5,"simple-table",5),t.DNE(6,Ci,4,5,"ng-template",null,0,t.C5r),t.k0s()),2&e){const r=t.sdS(7);t.R7$(4),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.expired_items)("columns",t.s1E(13,ki,t.lJ4(5,_i),t.lJ4(6,vi),t.eq3(7,yi,r),t.eq3(9,bi,r),t.eq3(11,xi,r)))("sortable",!0)("page_size",o.print?0:10)}},dependencies:[v.bT,j.r6,O.R,L.O,v.vh]})}return s})();const Ti=["report-assets",""];function ji(s,i){if(1&s&&(t.qex(0),t.nrm(1,"asset-report-overall")(2,"asset-report-daily-usage",10)(3,"asset-report-product-usage",10)(4,"asset-report-users",10)(5,"asset-report-expired-items",10),t.bVm()),2&s){const n=t.XpG(2);t.R7$(2),t.Y8G("print",n.printing),t.R7$(),t.Y8G("print",n.printing),t.R7$(),t.Y8G("print",n.printing),t.R7$(),t.Y8G("print",n.printing)}}function Fi(s,i){if(1&s&&(t.qex(0),t.DNE(1,ji,6,4,"ng-container",9),t.nI1(2,"async"),t.bVm()),2&s){const n=t.XpG(),e=t.sdS(15);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,n.total_count))("ngIfElse",e)}}function Mi(s,i){1&s&&(t.j41(0,"div",11),t.nrm(1,"mat-spinner",12),t.j41(2,"p",13),t.EFF(3,"Loading report data..."),t.k0s()()),2&s&&(t.R7$(),t.Y8G("diameter",32))}function Ii(s,i){1&s&&(t.j41(0,"div",14)(1,"p",13),t.EFF(2," Select levels and time period to generate a report. "),t.k0s()())}let Oi=(()=>{class s extends _.Tv{get logo(){return this._settings.get("app.logo_light")||{}}constructor(n,e,o){super(),this._state=n,this._settings=e,this._route=o,this.printing=!1,this.total_count=this._state.stats$.pipe((0,y.T)(r=>r.total_booked_items||0)),this.loading=this._state.loading$,this.downloadReport=()=>this._state.downloadReport(),this.generateReport=()=>this._state.generateReport()}ngOnInit(){this.subscription("route.query",this._route.queryParamMap.subscribe(n=>{if(n.has("start")&&this._state.setOptions({start:+n.get("start")}),n.has("end")&&this._state.setOptions({end:+n.get("end")}),n.has("zones")||n.has("zone_ids")){const e=(n.get("zones")||n.get("zone_ids")).split(",");e.length&&this._state.setOptions({zones:e})}}))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(ft),t.rXU(_.h$),t.rXU(F.nX))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["","report-assets",""]],features:[t.Vt3],attrs:Ti,decls:16,vars:11,consts:[["load_state",""],["empty_state",""],[3,"printing","download","generate","loading","has_data"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto","print:overflow-visible","print:h-auto"],[1,"w-full"],[1,"flex","items-center","m-4","p-4","rounded","bg-base-200"],[1,"h-12",3,"src"],[1,"flex-1"],[1,"text-2xl","font-medium","px-2"],[4,"ngIf","ngIfElse"],[3,"print"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],[1,"opacity-30"],[1,"h-full","w-full","flex","flex-col","items-center","p-8","screen-only"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"reports-options",2),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("printing",function(l){return t.eBV(r),t.Njj(o.printing=l)})("download",function(){return t.eBV(r),t.Njj(o.downloadReport())})("generate",function(){return t.eBV(r),t.Njj(o.generateReport())}),t.k0s(),t.j41(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"img",6)(7,"div",7),t.j41(8,"h2",8),t.EFF(9,"Assets Report"),t.k0s()()(),t.DNE(10,Fi,3,4,"ng-container",9),t.nI1(11,"async"),t.k0s(),t.DNE(12,Mi,4,1,"ng-template",null,0,t.C5r)(14,Ii,3,0,"ng-template",null,1,t.C5r)}if(2&e){const r=t.sdS(13);t.Y8G("loading",t.bMT(1,5,o.loading))("has_data",t.bMT(2,7,o.total_count)),t.R7$(6),t.Y8G("src",o.logo.src,t.B4B),t.R7$(4),t.Y8G("ngIf",!t.bMT(11,9,o.loading))("ngIfElse",r)}},dependencies:[v.bT,dt.LG,ut,Jo,ni,ci,fi,Ei,v.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}\n\n/*# sourceMappingURL=assets-report.component.ts-angular-inline--147.css.map*/"]})}return s})(),Yt=(()=>{class s{constructor(n,e){this._settings=n,this._org=e,this._loading=new W.t(!1),this._options=new W.t({}),this._generate=new W.t(0),this.loading$=this._loading.asObservable(),this.options$=this._options.asObservable(),this.bookings$=this._generate.pipe((0,zt.p)(o=>o>0),(0,X.n)(()=>this._options.pipe((0,T.s)(1))),(0,at.B)(300),(0,X.n)(o=>{this._loading.next(!0);const{start:r,end:a,zones:l}=o;return(0,qt.tj)({period_start:(0,nt._)((0,Y.o)(r||Date.now())),period_end:(0,nt._)((0,U.D)(a||r||Date.now())),type:"visitor",zones:(l||[])?.join(",")||(this._settings.get("app.use_region")?this._org.region?.id:"")||this._org.building?.id})}),(0,Et.M)(o=>{o.length||(0,_.UG)("No bookings for the selected levels and period"),this._loading.next(!1)}),(0,Je.Z)([]),(0,N.t)(1)),this.daily_stats$=(0,$.zV)([this.bookings$,this._options]).pipe((0,y.T)(([o,r])=>{const a={};for(const l of o){const c=(0,D.GP)(l.date,"yyyy-MM-dd");a[c]||(a[c]={date:l.date,bookings:[]}),a[c].bookings.push(l)}return a}),(0,N.t)(1))}setOptions(n){this._options.next({...this._options.getValue(),...n})}generateReport(){this._generate.next(Date.now())}downloadReport(){var n=this;return(0,E.A)(function*(){const e=n._options.getValue(),o=yield n.bookings$.pipe((0,T.s)(1)).toPromise();if(!o?.length)return;const a=(0,Vt.r)(e.start,e.end)?(0,D.GP)(e.start,"yyyy-MM-dd"):`${(0,D.GP)(e.start,"yyyy-MM-dd")}-${(0,D.GP)(e.end,"yyyy-MM-dd")}`;(0,_.PE)(`report+assets+${a}.tsv`,(0,_.SL)(o.map(l=>{const c=l.toJSON();return delete c.zones,delete c.server_names,delete c.extension_data,c}),"\t"))})()}static#t=this.\u0275fac=function(e){return new(e||s)(t.KVO(_.h$),t.KVO(K.yb))};static#e=this.\u0275prov=t.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})(),Di=(()=>{class s{constructor(n){this._state=n,this.total_count=this._state.bookings$.pipe((0,y.T)(e=>e.length||0)),this.business_days=this._state.options$.pipe((0,y.T)(({start:e,end:o})=>ne((0,U.D)(o||Date.now()).valueOf()+1,(0,Y.o)(e||Date.now()))||1)),this.avg_length=this._state.bookings$.pipe((0,y.T)(e=>Math.floor(e.reduce((o,r)=>o+r.duration,0)/e.length)))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Yt))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["visitor-report-overall"]],decls:19,vars:9,consts:[[1,"m-4","p-4","rounded","bg-base-100","border","border-base-200","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"text-sm"],[1,"text-2xl"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"h3",2),t.EFF(3,"Business Days"),t.k0s(),t.j41(4,"p",3),t.EFF(5),t.nI1(6,"async"),t.k0s()(),t.j41(7,"div",1)(8,"h3",2),t.EFF(9,"Total Visits"),t.k0s(),t.j41(10,"p",3),t.EFF(11),t.nI1(12,"async"),t.k0s()(),t.j41(13,"div",1)(14,"h3",2),t.EFF(15,"Avg. Booking Length"),t.k0s(),t.j41(16,"p",3),t.EFF(17),t.nI1(18,"async"),t.k0s()()()),2&e&&(t.R7$(5),t.JRh(t.bMT(6,3,o.business_days)||0),t.R7$(6),t.JRh(t.bMT(12,5,o.total_count)||0),t.R7$(6),t.SpI("",t.bMT(18,7,o.avg_length)||"0"," mins"))},dependencies:[v.Jj]})}return s})();const Ni=s=>({key:"date",name:"Date",content:s}),Vi=()=>({key:"booking_count",name:"Unique Visitors"}),Si=()=>({key:"host_count",name:"Host Count"}),Gi=()=>({key:"booked_count",name:"Booking Count"}),$i=(s,i,n,e)=>[s,i,n,e];function Ai(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",6),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}function Bi(s,i){if(1&s&&(t.j41(0,"div",7),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&s){const n=i.row;t.R7$(),t.SpI(" ",t.i5U(2,1,n.date,"mediumDate")," ")}}let Ui=(()=>{class s{constructor(n){var e=this;this._state=n,this.print=!1,this.daily_stats=this._state.daily_stats$.pipe((0,y.T)(o=>{let r=[];for(const a in o)r.push({date:a,booking_count:(0,_.Am)(o[a].bookings,"asset_id").length,host_count:(0,_.Am)(o[a].bookings,"user_email").length,booked_count:o[a].bookings.length});return r})),this.download=(0,E.A)(function*(){const o=yield e.daily_stats.pipe((0,T.s)(1)).toPromise();(0,_.PE)("report-visitors-daily-usage.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Yt))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["visitor-report-daily-usage"]],inputs:{print:"print"},decls:8,vars:15,consts:[["date_template",""],[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"],[1,"p-4"]],template:function(e,o){if(1&e&&(t.j41(0,"div",1)(1,"div",2)(2,"h3",3),t.EFF(3,"Daily Visitor Details"),t.k0s(),t.DNE(4,Ai,3,0,"button",4),t.k0s(),t.nrm(5,"simple-table",5),t.DNE(6,Bi,3,4,"ng-template",null,0,t.C5r),t.k0s()),2&e){const r=t.sdS(7);t.R7$(4),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.daily_stats)("columns",t.ziG(10,$i,t.eq3(5,Ni,r),t.lJ4(7,Vi),t.lJ4(8,Si),t.lJ4(9,Gi)))("sortable",!0)("page_size",o.print?0:10)}},dependencies:[v.bT,j.r6,O.R,L.O,v.vh]})}return s})();const Li=()=>({key:"visitor_name",name:"Visitor Name"}),zi=s=>({key:"date",name:"Date",content:s}),Pi=()=>({key:"host",name:"Host"}),Yi=()=>({key:"checked_in",name:"Checked In"}),Xi=()=>({key:"self_registered",name:"Self Registered"}),Ji=(s,i,n,e,o)=>[s,i,n,e,o];function Hi(s,i){if(1&s){const n=t.RV6();t.j41(0,"button",6),t.bIt("click",function(){t.eBV(n);const o=t.XpG();return t.Njj(o.download())}),t.j41(1,"app-icon"),t.EFF(2,"download"),t.k0s()()}}function Wi(s,i){if(1&s&&(t.j41(0,"div",7),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&s){const n=i.row;t.R7$(),t.SpI(" ",t.i5U(2,1,n.date,"mediumDate")," ")}}let Qi=(()=>{class s{constructor(n){var e=this;this._state=n,this.print=!1,this.visitor_bookings=this._state.bookings$.pipe((0,y.T)(o=>{let r=[];for(const a of o)r.push({visitor_name:a.asset_name||a.extension_data?.asset_name||a.description||a.asset_id,date:a.date,host:a.user_name||a.user_email,checked_in:a.checked_in?"Yes":"No",self_registered:a.extension_data?.self_registered?"Yes":"No"});return r})),this.download=(0,E.A)(function*(){const o=yield e.visitor_bookings.pipe((0,T.s)(1)).toPromise();(0,_.PE)("report-assets-daily-usage.csv",(0,_.SL)(o))})}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Yt))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["visitor-report-list"]],inputs:{print:"print"},decls:8,vars:17,consts:[["date_template",""],[1,"m-4","rounded","bg-base-100","border","border-base-200","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","","matRipple","",3,"click",4,"ngIf"],["empty_message","No events for selected period",1,"w-full","block","text-sm",3,"data","columns","sortable","page_size"],["icon","","matRipple","",3,"click"],[1,"p-4"]],template:function(e,o){if(1&e&&(t.j41(0,"div",1)(1,"div",2)(2,"h3",3),t.EFF(3,"Visitor List"),t.k0s(),t.DNE(4,Hi,3,0,"button",4),t.k0s(),t.nrm(5,"simple-table",5),t.DNE(6,Wi,3,4,"ng-template",null,0,t.C5r),t.k0s()),2&e){const r=t.sdS(7);t.R7$(4),t.Y8G("ngIf",!o.print),t.R7$(),t.Y8G("data",o.visitor_bookings)("columns",t.s1E(11,Ji,t.lJ4(5,Li),t.eq3(6,zi,r),t.lJ4(8,Pi),t.lJ4(9,Yi),t.lJ4(10,Xi)))("sortable",!0)("page_size",o.print?0:10)}},dependencies:[v.bT,j.r6,O.R,L.O,v.vh]})}return s})();const Ki=["visitors-report",""];function Zi(s,i){if(1&s&&(t.qex(0),t.nrm(1,"visitor-report-overall")(2,"visitor-report-daily-usage",10)(3,"visitor-report-list"),t.bVm()),2&s){const n=t.XpG(2);t.R7$(2),t.Y8G("print",n.printing)}}function qi(s,i){if(1&s&&(t.qex(0),t.DNE(1,Zi,4,1,"ng-container",9),t.nI1(2,"async"),t.bVm()),2&s){const n=t.XpG(),e=t.sdS(15);t.R7$(),t.Y8G("ngIf",t.bMT(2,2,n.total_count))("ngIfElse",e)}}function tr(s,i){1&s&&(t.j41(0,"div",11),t.nrm(1,"mat-spinner",12),t.j41(2,"p",13),t.EFF(3,"Loading report data..."),t.k0s()()),2&s&&(t.R7$(),t.Y8G("diameter",32))}function er(s,i){1&s&&(t.j41(0,"div",14)(1,"p",13),t.EFF(2," Select levels and time period to generate a report. "),t.k0s()())}const Qe=[{path:"",component:ut},{path:"bookings",component:qn},{path:"desks",component:Qs},{path:"catering",component:xo},{path:"contact-tracing",component:Go},{path:"assets",component:Oi},{path:"visitors",component:(()=>{class s extends _.Tv{get logo(){return this._settings.get("app.logo_light")||{}}constructor(n,e,o){super(),this._state=n,this._settings=e,this._route=o,this.printing=!1,this.total_count=this._state.bookings$.pipe((0,y.T)(r=>r.length||0)),this.loading=this._state.loading$,this.downloadReport=()=>this._state.downloadReport(),this.generateReport=()=>this._state.generateReport()}ngOnInit(){this.subscription("route.query",this._route.queryParamMap.subscribe(n=>{if(n.has("start")&&this._state.setOptions({start:+n.get("start")}),n.has("end")&&this._state.setOptions({end:+n.get("end")}),n.has("zones")||n.has("zone_ids")){const e=(n.get("zones")||n.get("zone_ids")).split(",");e.length&&this._state.setOptions({zones:e})}}))}static#t=this.\u0275fac=function(e){return new(e||s)(t.rXU(Yt),t.rXU(_.h$),t.rXU(F.nX))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["","visitors-report",""]],features:[t.Vt3],attrs:Ki,decls:16,vars:11,consts:[["load_state",""],["empty_state",""],[3,"printing","download","generate","loading","has_data"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto","print:overflow-visible","print:h-auto"],[1,"w-full"],[1,"flex","items-center","m-4","p-4","rounded","bg-base-200"],[1,"h-12",3,"src"],[1,"flex-1"],[1,"text-2xl","font-medium","px-2"],[4,"ngIf","ngIfElse"],[3,"print"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],[1,"opacity-30"],[1,"h-full","w-full","flex","flex-col","items-center","p-8","screen-only"]],template:function(e,o){if(1&e){const r=t.RV6();t.j41(0,"reports-options",2),t.nI1(1,"async"),t.nI1(2,"async"),t.bIt("printing",function(l){return t.eBV(r),t.Njj(o.printing=l)})("download",function(){return t.eBV(r),t.Njj(o.downloadReport())})("generate",function(){return t.eBV(r),t.Njj(o.generateReport())}),t.k0s(),t.j41(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"img",6)(7,"div",7),t.j41(8,"h2",8),t.EFF(9,"Visitors Report"),t.k0s()()(),t.DNE(10,qi,3,4,"ng-container",9),t.nI1(11,"async"),t.k0s(),t.DNE(12,tr,4,1,"ng-template",null,0,t.C5r)(14,er,3,0,"ng-template",null,1,t.C5r)}if(2&e){const r=t.sdS(13);t.Y8G("loading",t.bMT(1,5,o.loading))("has_data",t.bMT(2,7,o.total_count)),t.R7$(6),t.Y8G("src",o.logo.src,t.B4B),t.R7$(4),t.Y8G("ngIf",!t.bMT(11,9,o.loading))("ngIfElse",r)}},dependencies:[v.bT,dt.LG,ut,Di,Ui,Qi,v.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}\n\n/*# sourceMappingURL=visitors-report.component.ts-angular-inline--148.css.map*/"]})}return s})()},{path:":id",component:Uo},{path:"**",redirectTo:"desks",pathMatch:"full"}],nr=[{path:"new",component:Xo,children:Qe},{path:"",component:Zt,children:Qe}];let sr=(()=>{class s{static#t=this.\u0275fac=function(e){return new(e||s)};static#e=this.\u0275mod=t.$C({type:s});static#n=this.\u0275inj=t.G2t({imports:[v.MD,q.YN,Ft.r,It.lx,pt.kR,M.Ou,F.iI.forChild(nr)]})}return s})()},57915:(ye,ct,f)=>{f.d(ct,{Qr:()=>F.Qr,nx:()=>q.n,WS:()=>F.WS,SG:()=>v.S,DD:()=>M.DD,wk:()=>M.wk,Z$:()=>M.Z$,eW:()=>M.eW,u3:()=>M.u3,tj:()=>M.tj,WE:()=>M.WE,vB:()=>M.vB,U:()=>M.U,UN:()=>M.UN,X0:()=>M.X0,DO:()=>M.DO,vq:()=>M.vq,MV:()=>M.MV});var v=f(49478),q=f(18379),F=f(53857),M=(f(17141),f(18026));f(77375),f(45762),f(3367),f(67254),f(98796),f(1781),f(27547),f(67642),f(1593)},68390:(ye,ct,f)=>{f.d(ct,{g8:()=>M,kR:()=>v.k,Gp:()=>t.Gp,KJ:()=>t.KJ,N8:()=>j.N8,SZ:()=>j.SZ});var v=f(73850),Ft=(f(11543),f(44621),f(99908));class M{constructor(I={}){this.type=I.type||I.location||"other",this.position=I.position||I.map_id||I.asset_id||{x:I.x/I.map_width||0,y:I.y/I.map_height||0},this.variance=I.variance||0,this.last_seen=I.last_seen||(0,Ft._)(new Date),this.level=I.level,this.building=I.building,this.at_location=!!I.at_location,this.coordinates_from=I.coordinates_from||"top-left"}}var t=f(93693),j=(f(24129),f(86039),f(2372))}}]);
//# sourceMappingURL=apps_concierge_src_app_reports_reports_module_ts.js.map