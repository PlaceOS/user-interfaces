"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_reports_reports_module_ts"],{8993:(_n,yt,c)=>{c.r(yt),c.d(yt,{ReportsModule:()=>Y});var m=c(4666),M=c(2508),I=c(9885),Mt=c(3045),Ot=c(6060),t=c(2560),Rt=c(4945),g=c(3770),Q=c(207),O=c(5306);const bt=function(){return["/reports","desks"]};function kt(o,e){1&o&&(t.TgZ(0,"a",1)(1,"app-icon",2),t._uU(2,"room"),t.qZA(),t.TgZ(3,"h3",3),t._uU(4,"Desks"),t.qZA(),t.TgZ(5,"div",4)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",5),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,bt))}const Lt=function(){return["/reports","spaces"]};function Dt(o,e){1&o&&(t.TgZ(0,"a",1)(1,"app-icon",2),t._uU(2,"meeting_room"),t.qZA(),t.TgZ(3,"h3",3),t._uU(4,"Rooms"),t.qZA(),t.TgZ(5,"div",4)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",5),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,Lt))}const St=function(){return["/reports","catering"]};function It(o,e){1&o&&(t.TgZ(0,"a",1)(1,"app-icon",2),t._uU(2,"room_service"),t.qZA(),t.TgZ(3,"h3",3),t._uU(4,"Catering"),t.qZA(),t.TgZ(5,"div",4)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",5),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,St))}const qt=function(){return["/reports","contact-tracing"]};function Nt(o,e){1&o&&(t.TgZ(0,"a",1)(1,"app-icon",2),t._uU(2,"connect_without_contact"),t.qZA(),t.TgZ(3,"h3",3),t._uU(4,"Contact Tracing"),t.qZA(),t.TgZ(5,"div",4)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",5),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,qt))}const Jt=["desks","spaces","catering","contact-tracing"];class z{constructor(e){this._settings=e}get features(){return this._settings.get("app.reports.features")||Jt}}function Qt(o,e){1&o&&t._UZ(0,"div",3)}z.\u0275fac=function(e){return new(e||z)(t.Y36(g.gb))},z.\u0275cmp=t.Xpm({type:z,selectors:[["reports-menu"],["","reports-menu",""]],decls:4,vars:4,consts:[["matRipple","","class","h-64 w-64 m-4 p-4 flex flex-col items-center justify-center bg-white dark:bg-neutral-700 rounded shadow hover:opacity-80",3,"routerLink",4,"ngIf"],["matRipple","",1,"h-64","w-64","m-4","p-4","flex","flex-col","items-center","justify-center","bg-white","dark:bg-neutral-700","rounded","shadow","hover:opacity-80",3,"routerLink"],[1,"text-8xl"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center"],[1,"ml-2"]],template:function(e,n){1&e&&(t.YNc(0,kt,10,2,"a",0),t.YNc(1,Dt,10,2,"a",0),t.YNc(2,It,10,2,"a",0),t.YNc(3,Nt,10,2,"a",0)),2&e&&(t.Q6J("ngIf",n.features.includes("desks")),t.xp6(1),t.Q6J("ngIf",n.features.includes("spaces")),t.xp6(1),t.Q6J("ngIf",n.features.includes("catering")),t.xp6(1),t.Q6J("ngIf",n.features.includes("contact-tracing")))},dependencies:[m.O5,Q.wG,O.o,I.rH],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row!important;align-items:center;justify-content:center;background:inherit}\n/*# sourceMappingURL=reports-menu.component.ts-angular-inline--100.css.map*/"]});class j{constructor(e){this._router=e}get path(){const e=this._router.url.split("/");return e[e.length-1]}}j.\u0275fac=function(e){return new(e||j)(t.Y36(I.F0))},j.\u0275cmp=t.Xpm({type:j,selectors:[["","app-reports",""]],attrs:["app-reports",""],decls:4,vars:1,consts:[[1,"h-full"],[1,"relative","overflow-hidden","flex","flex-col","flex-1","w-1/2","h-full","bg-gray-300","dark:bg-neutral-600"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(e,n){1&e&&(t._UZ(0,"sidebar",0),t.TgZ(1,"main",1),t._UZ(2,"router-outlet"),t.YNc(3,Qt,1,0,"div",2),t.qZA()),2&e&&(t.xp6(3),t.Q6J("ngIf","reports"===n.path))},dependencies:[m.O5,Rt.k,I.lC,z],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}main[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(router-outlet){display:flex;flex-direction:column;width:100%;height:100%}\n/*# sourceMappingURL=reports.component.ts-angular-inline--96.css.map*/"]});var zt=c(2886),at=c(711),Z=c(3918),jt=c(5670),C=c(6221),xt=c(532),Ft=c(9232),ut=c(9830),q=c(9377),N=c(3200),Pt=c(475),mt=c(312),_t=c(8210),Et=c(2317),R=c(3861),Bt=c(2218),J=c(4505),b=c(4139),A=c(7716),it=c(823),F=c(9095),rt=c(7418),_=c(6942),T=c(9128),Vt=c(6198);class f{constructor(e){var n=this;this._org=e,this._space_pipe=new Vt.X(this._org),this._generate=new Bt.xQ,this._loading=new J.X(""),this._active_bookings=new J.X([]),this._options=new J.X({start:new Date,end:new Date}),this._bookings_list=this._generate.pipe((0,it.b)(500),(0,F.w)(s=>{const a=this._options.getValue();if(this._loading.next("Loading report details..."),!a?.type&&!a?.zones?.length)return(0,b.of)([]);const i=(0,q.Z)(a?.start?new Date(a.start):new Date).valueOf(),r=(0,N.Z)(a?.end?new Date(a.end):i).valueOf(),p=a?.zones?a.zones.filter(l=>"All"!==l).join(","):"",d={period_start:Math.floor(i/1e3),period_end:Math.floor(r/1e3)};return"desks"===a.type?(0,Ft.F2)({...d,zones:p,type:"desk"}):(0,ut.u$)({...d,zone_ids:p}).pipe((0,F.w)(function(){var l=(0,Z.Z)(function*(v){return Promise.all(v.map(function(){var h=(0,Z.Z)(function*(u){return new ut.ym({...u,resources:yield Promise.all(u.resources.map(x=>n._space_pipe.transform(x.id||x.email)))})});return function(u){return h.apply(this,arguments)}}()))});return function(v){return l.apply(this,arguments)}}()))}),(0,rt.K)(s=>[]),(0,_.U)(s=>(this._loading.next(""),s?.length||(0,g.cB)("No bookings for the selected levels and period"),this._active_bookings.next(s||[]),s)),(0,T.d)()),this.loading=this._loading.asObservable(),this.options=this._options.asObservable(),this.bookings=this._active_bookings.asObservable(),this.counts=this._options.pipe((0,it.b)(500),(0,F.w)(s=>{const a=(s.zones||[]).filter(i=>-1!==i&&"All"!==i);return Promise.all(a.map(i=>(0,xt.rlq)(i,"desks").pipe((0,_.U)(r=>[i,r.details.length])).toPromise()))}),(0,rt.K)(s=>[]),(0,_.U)(s=>{const a={};return this._active_bookings.next([]),s.forEach(([i,r])=>a[i]=r),a}),(0,T.d)()),this.stats=(0,A.aj)([this.counts,this.bookings]).pipe((0,F.w)(function(){var s=(0,Z.Z)(function*([a,i]){return i[0]instanceof ut.ym?function Xt(o,e=8){e=Math.max(1,e);const n=o.reduce((r,p)=>r+p.attendees.length,0),s=o.reduce((r,p)=>r+p.system?.capacity,0),a=Math.floor(o.reduce((r,p)=>r+p.duration,0)/(60*e)*100)/100,i=Math.floor(n/s*100)/100;return{count:o.length,avg_length:Math.floor(o.reduce((r,p)=>r+p.duration,0)/o.length*100)/100,efficiency:Math.floor((a+i)/2*100)/100,total_users:n,total_capacity:s,occupancy:i,utilisation:a,events:o}}(i,8*n.duration):function Wt(o,e=1,n={}){e=Math.max(1,e);const s=Object.keys(n).reduce((i,r)=>i+(n[r]||0),0),a=Math.floor(o.length/s/e*1e4)/1e4;return{total:s,count:o.length,utilisation:a,events:o}}(i||[],n.duration,a)});return function(a){return s.apply(this,arguments)}}())),this.day_list=(0,A.aj)([this.options,this.stats]).pipe((0,_.U)(([s,a])=>{const{start:i}=s;let r=(0,q.Z)(i);const p=(0,N.Z)(s.end||r),d=[];for(;(0,Pt.Z)(r,p);){const l=(0,q.Z)(r).valueOf(),v=(0,N.Z)(l).valueOf(),h=a.events.filter(u=>(0,g.MZ)(l,v,u.date,u.date+60*u.duration*1e3));d.push({date:l,total:a.total,free:a.total-h.length,approved:h.reduce((u,x)=>u+(x.approved?1:0),0),count:h.length,utilisation:(h.length/a.total*100).toFixed(1)}),r=(0,mt.Z)(r,1)}return d}),(0,T.d)(1)),this._bookings_list.subscribe(s=>s)}get duration(){const e=this._options.getValue();return Math.max(1,Math.abs((0,_t.Z)((0,q.Z)(e.start),(0,Et.Z)((0,N.Z)(e.end),1))))}generateReport(){this._generate.next((new Date).valueOf())}setOptions(e){e.zones?.includes("All")?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(n=>n.id)]:e.zones&&this._options.getValue()?.zones?.includes("All")&&(e.zones=[]),e.start?.valueOf()!==this._options.getValue().start?.valueOf()&&e.end?.valueOf()!==this._options.getValue().end?.valueOf()&&this._options.next({...this._options.getValue(),...e})}downloadReport(){const e=this._options.getValue(),n=this._active_bookings.getValue();(0,g.Sv)(`report+${e.type}+${(0,R.Z)(e.start,"yyyy-MM-dd")}+${(0,R.Z)(e.end,"yyyy-MM-dd")}.csv`,(0,g.o3)(n.map(s=>{const a=s.toJSON();return delete a.zones,delete a.server_names,delete a.extension_data,a})))}}f.\u0275fac=function(e){return new(e||f)(t.LFG(C.w7))},f.\u0275prov=t.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"});var ct=c(5074),Gt=c(7371),y=c(2298),lt=c(1708);function $t(o,e){if(1&o&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&o){const n=e.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij(" ",n.display_name||n.name," ")}}function Kt(o,e){1&o&&t._UZ(0,"mat-spinner",15),2&o&&t.Q6J("diameter",32)}function Ht(o,e){1&o&&(t.TgZ(0,"p"),t._uU(1,"Generate Report"),t.qZA())}class w extends g.KG{constructor(e,n,s,a){super(),this._state=e,this._org=n,this._route=s,this._router=a,this.zones=[],this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(i=>`${i.id}`),this.levels=this._org.active_levels,this.loading=this._state.loading,this.bookings=this._state.bookings,this.options=this._state.options,this.page="",this.generateReport=()=>this._state.generateReport(),this.downloadReport=()=>this._state.downloadReport(),this.setStartDate=i=>this._state.setOptions({start:new Date(i)}),this.setEndDate=i=>this._state.setOptions({end:new Date(i)}),this.setZones=i=>this._state.setOptions({zones:i})}ngOnInit(){var e=this;return(0,Z.Z)(function*(){yield e._org.initialised.pipe((0,jt.P)(n=>n)).toPromise(),e.page=e._router.url,e.subscription("routing",e._router.events.subscribe(()=>{e.page=e._router.url})),e.subscription("route.query",e._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const s=n.get("zone_ids").split(",");if(s.length){const a=e._org.levelWithID(s);if(!a)return;e._org.building=e._org.buildings.find(i=>i.id===a.parent_id),e.setZones(s)}}}))})()}}w.\u0275fac=function(e){return new(e||w)(t.Y36(f),t.Y36(C.w7),t.Y36(I.gz),t.Y36(I.F0))},w.\u0275cmp=t.Xpm({type:w,selectors:[["reports-options"]],features:[t.qOj],decls:28,vars:28,consts:[[1,"bg-white","dark:bg-neutral-700","h-20","w-full","flex","items-center","px-2","shadow","z-20","border-b","border-gray-200"],["appearance","outline",1,"w-48"],["multiple","","placeholder","Select Levels...",3,"ngModel","ngModelChange"],["value","All"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-64"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["btn","","matRipple","",1,"ml-4",3,"disabled","click"],[3,"diameter",4,"ngIf"],[4,"ngIf"],[3,"value"],[3,"diameter"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(a){return n.setZones(a)}),t.ALo(3,"async"),t.TgZ(4,"mat-option",3),t._uU(5,"All Levels"),t.qZA(),t.YNc(6,$t,2,2,"mat-option",4),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"mat-form-field",5)(9,"mat-date-range-input",6)(10,"input",7),t.NdJ("ngModelChange",function(a){return a?n.setStartDate(a):""}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"input",8),t.NdJ("ngModelChange",function(a){return a?n.setEndDate(a):""}),t.ALo(13,"async"),t.qZA()(),t._UZ(14,"mat-datepicker-toggle",9)(15,"mat-date-range-picker",null,10),t.qZA(),t.TgZ(17,"button",11),t.NdJ("click",function(){return n.generateReport()}),t.ALo(18,"async"),t.ALo(19,"async"),t.YNc(20,Kt,1,1,"mat-spinner",12),t.ALo(21,"async"),t.YNc(22,Ht,2,0,"p",13),t.ALo(23,"async"),t.qZA(),t.TgZ(24,"button",11),t.NdJ("click",function(){return n.downloadReport()}),t.ALo(25,"async"),t.TgZ(26,"p"),t._uU(27,"Download Report"),t.qZA()()()),2&e){const s=t.MAs(16);let a,i,r,p,d;t.xp6(2),t.Q6J("ngModel",null==(a=t.lcZ(3,10,n.options))?null:a.zones),t.xp6(4),t.Q6J("ngForOf",t.lcZ(7,12,n.levels)),t.xp6(3),t.Q6J("rangePicker",s),t.xp6(1),t.Q6J("ngModel",null==(i=t.lcZ(11,14,n.options))?null:i.start),t.xp6(2),t.Q6J("ngModel",null==(r=t.lcZ(13,16,n.options))?null:r.end),t.xp6(2),t.Q6J("for",s),t.xp6(3),t.Q6J("disabled",!!t.lcZ(18,18,n.loading)||!(null!=(p=t.lcZ(19,20,n.options))&&null!=p.zones&&p.zones.length)),t.xp6(3),t.Q6J("ngIf",t.lcZ(21,22,n.loading)),t.xp6(2),t.Q6J("ngIf",!t.lcZ(23,24,n.loading)),t.xp6(2),t.Q6J("disabled",!(null!=(d=t.lcZ(25,26,n.bookings))&&d.length))}},dependencies:[m.sg,m.O5,M.Fj,M.JJ,M.On,ct.KE,ct.R9,Gt.gD,Q.ey,y.nW,y.wx,y.zY,y.By,y._g,lt.Ou,Q.wG,m.Ov],styles:["button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;margin-left:1em}mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:5.5em;white-space:initial;line-height:1.2em}\n/*# sourceMappingURL=reports-options.component.ts-angular-inline--97.css.map*/"]});var te=c(6323),ee=c(5845),Tt=c(7684),gt=c(8325),Ct=c(1170);function ne(o){(0,Ct.Z)(1,arguments);var e=(0,gt.Z)(o),n=e.getDay();return 0===n||6===n}var oe=c(7367),ft=c(1799);function ae(o,e){if(1&o&&(t.TgZ(0,"div",0)(1,"div",3)(2,"h3"),t._uU(3,"No show count"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"div",3)(8,"h3"),t._uU(9,"% of No show Bookings"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",3)(14,"h3"),t._uU(15,"Total in-room attendance"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"async"),t.qZA()()()),2&o){const n=t.oxw();t.xp6(5),t.Oqu(t.lcZ(6,3,n.no_shows)||0),t.xp6(6),t.hij("",t.lcZ(12,5,n.no_show_percent)||0,"%"),t.xp6(6),t.Oqu(t.lcZ(18,7,n.attendance)||0)}}class P{constructor(e){this._state=e,this.business_days=this._state.options.pipe((0,_.U)(({start:n,end:s})=>function se(o,e){(0,Ct.Z)(2,arguments);var n=(0,gt.Z)(o),s=(0,gt.Z)(e);if(!(0,Tt.Z)(n)||!(0,Tt.Z)(s))return NaN;var a=(0,te.Z)(n,s),i=a<0?-1:1,r=(0,oe.Z)(a/7),p=5*r;for(s=(0,mt.Z)(s,7*r);!(0,ee.Z)(n,s);)p+=ne(s)?0:i,s=(0,mt.Z)(s,i);return 0===p?0:p}((0,q.Z)(s||Date.now()),(0,N.Z)(n||Date.now()))||1)),this.total_count=this._state.stats.pipe((0,_.U)(n=>n.count||0)),this.avg_length=this._state.stats.pipe((0,_.U)(n=>(0,ft.Z)({minutes:Math.floor(n.avg_length||0)}))),this.attendance=this._state.stats.pipe((0,_.U)(({events:n})=>n.reduce((s,{extension_data:a})=>s+(+a?.people_count?.max||0),0))),this.no_shows=this._state.stats.pipe((0,_.U)(({events:n})=>n.reduce((s,{extension_data:a})=>s+ +a?.people_count?.max?1:0,0))),this.no_show_percent=this._state.stats.pipe((0,_.U)(({events:n})=>Math.floor(n.reduce((s,{extension_data:a})=>s+ +a?.people_count?.max?1:0,0)/n.length*1e4)/100)),this.has_attendance=this._state.stats.pipe((0,_.U)(({events:n})=>!!n.find(({extension_data:s})=>!!s?.people_count)))}}P.\u0275fac=function(e){return new(e||P)(t.Y36(f))},P.\u0275cmp=t.Xpm({type:P,selectors:[["report-spaces-overall"]],decls:21,vars:12,consts:[[1,"m-4","p-4","rounded","bg-white","dark:bg-neutral-700","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],["class","m-4 p-4 rounded bg-white dark:bg-neutral-700 shadow flex justify-center items-center space-x-2",4,"ngIf"],[1,"flex-1","flex","flex-col","items-center","justify-center"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3"),t._uU(3,"Business Days"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"div",1)(8,"h3"),t._uU(9,"Total Bookings"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",1)(14,"h3"),t._uU(15,"Average Booking Length"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"async"),t.qZA()()(),t.YNc(19,ae,19,9,"div",2),t.ALo(20,"async")),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,4,n.business_days)||0),t.xp6(6),t.Oqu(t.lcZ(12,6,n.total_count)||0),t.xp6(6),t.Oqu(t.lcZ(18,8,n.avg_length)||"None"),t.xp6(2),t.Q6J("ngIf",t.lcZ(20,10,n.has_attendance)))},dependencies:[m.O5,m.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}\n/*# sourceMappingURL=report-spaces-overall.component.ts-angular-inline--101.css.map*/"]});var k=c(3910),L=c(1110);const ie=function(){return["flex"]};class E{constructor(e){var n=this;this._reports=e,this.space_list=(0,A.aj)([this._reports.stats,this._reports.options]).pipe((0,it.b)(300),(0,_.U)(([s,{start:a,end:i}])=>{let r=[],p=!1;for(const l of s.events){const v=(0,g.Tw)(l.resources,"email")||[l.system];for(const h of v){let u=r.find(x=>x.id===h.id||x.id?.toLowerCase()===h.email.toLowerCase());if(!u){if(u={id:h.id||h.email,name:h.display_name||h.name,capacity:h.capacity||1,count:0,attendance:0,avg_attendance:0,min_attendance:99,max_attendance:0,attendees:0,avg_attendees:0,usage:0,no_shows:0,utilisation:0,occupancy:0},!u.id||!u.name)continue;r.push(u)}0===l.extension_data?.people_count?.max&&(u.no_shows+=1),u.count+=1,u.attendance+=l.extension_data?.people_count?.max??0,u.avg_attendance+=l.extension_data?.people_count?.avg??0,u.min_attendance=Math.min(u.max_attendance,l.extension_data?.people_count?.max??99),u.max_attendance=Math.max(u.max_attendance,l.extension_data?.people_count?.max??0),u.usage+=l.duration,u.attendees+=l.attendees.length,p=p||!!l.extension_data.people_count}}const d=Math.max(1,(0,_t.Z)(i,a)+1);for(const l of r)l.avg_attendees=Math.floor(l.attendees/l.count*100)/100,l.avg_attendance=Math.floor(l.attendance/l.count*100)/100,l.utilisation=`${Math.floor(l.usage/60/8/d*100)}%`,l.min_attendance=99===l.min_attendance?"?":l.min_attendance,l.occupancy=Math.floor(l.avg_attendees/l.capacity*1e3)/10+"%",(l.attendance<0||!p)&&(l.attendance="?",l.avg_attendance="?");return r})),this.has_attendance=this.space_list.pipe((0,_.U)(s=>!!s.find(({attendance:a})=>"?"!==a))),this.column_list=this.has_attendance.pipe((0,_.U)(s=>s?["name","capacity","count","utilisation","avg_attendees","attendance","avg_attendance","no_shows","min_attendance","max_attendance"]:["name","capacity","count","utilisation","avg_attendees"])),this.column_name_list=this.has_attendance.pipe((0,_.U)(s=>s?["Name","Room Capacity","Bookings","% Time booked during office hrs","Avg. invitees per booking","Total In-room Attendance","Avg. In-room Attendance","No Shows","Min. In-room Attendance","Max. In-room Attendance"]:["Name","Room Capacity","Bookings","% Time booked during office hrs","Avg. invitees per booking"])),this.download=(0,Z.Z)(function*(){const s=yield n.space_list.pipe((0,k.q)(1)).toPromise();(0,g.Sv)("report-spaces-usage.csv",(0,g.o3)(s))})}}E.\u0275fac=function(e){return new(e||E)(t.Y36(f))},E.\u0275cmp=t.Xpm({type:E,selectors:[["report-spaces-space-listing"]],decls:10,vars:10,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Room Utilisation"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.ALo(8,"async"),t.ALo(9,"async"),t.qZA()),2&e&&(t.xp6(7),t.Q6J("dataSource",n.space_list)("pagination",!0)("columns",t.lcZ(8,5,n.column_list))("display_column",t.lcZ(9,7,n.column_name_list))("column_size",t.DdM(9,ie)))},dependencies:[O.o,L.C,m.Ov]});const re=function(){return["name","count","avg_attendees","total_time","no_shows"]},ce=function(){return["Name","Bookings","Avg. Invitees per Booking","Total Booked Time","No Shows"]},le=function(){return["flex"]};class B{constructor(e){var n=this;this._reports=e,this.user_list=(0,A.aj)([this._reports.stats]).pipe((0,it.b)(300),(0,_.U)(([s])=>{let a=[];for(const i of s.events){const r=i.attendees?.find(l=>l.email===i.host);if(!r)continue;const p=Math.max(i.resources.reduce((l,v)=>l+v.capacity,0)||1,1);let d=a.find(l=>l.id?.toLowerCase()===r.email.toLowerCase());d||(d={id:r.email,name:r.name,capacity:p,count:0,attendees:0,avg_attendees:0,no_shows:0,occupancy:0,total_time:0},a.push(d)),0===i.extension_data?.people_count?.max&&(d.no_shows+=1),d.count+=1,d.attendees+=i.attendees.length,d.total_time+=i.duration||15}for(const i of a)i.avg_attendees=Math.floor(i.attendees/i.count*100)/100,i.occupancy=Math.floor(i.avg_attendees/i.capacity*100)/100,i.total_time=(0,ft.Z)({hours:Math.floor(i.total_time/60),minutes:i.total_time%60});return a}),(0,T.d)(1)),this.download=(0,Z.Z)(function*(){const s=yield n.user_list.pipe((0,k.q)(1)).toPromise();(0,g.Sv)("report-space-attendee-usage.csv",(0,g.o3)(s))})}}function de(o,e){1&o&&(t.ynx(0),t._UZ(1,"report-spaces-overall")(2,"report-spaces-space-listing")(3,"report-spaces-user-listing"),t.BQk())}function ue(o,e){if(1&o&&(t.ynx(0),t.YNc(1,de,4,0,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&o){const n=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",s)}}function me(o,e){1&o&&(t.TgZ(0,"div",4),t._UZ(1,"mat-spinner",5),t.TgZ(2,"p",6),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function _e(o,e){1&o&&(t.TgZ(0,"div",4)(1,"p",6),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}B.\u0275fac=function(e){return new(e||B)(t.Y36(f))},B.\u0275cmp=t.Xpm({type:B,selectors:[["report-spaces-user-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Meeting Organisers"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.qZA()),2&e&&(t.xp6(7),t.Q6J("dataSource",n.user_list)("pagination",!0)("columns",t.DdM(5,re))("display_column",t.DdM(6,ce))("column_size",t.DdM(7,le)))},dependencies:[O.o,L.C]});class W{constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,_.U)(n=>n.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}function ge(o,e){1&o&&(t._uU(0),t.ALo(1,"date")),2&o&&t.hij(" ",t.xi3(1,1,e.data,"mediumDate")," ")}function fe(o,e){1&o&&t._uU(0),2&o&&t.hij(" ",e.data||"0","% ")}W.\u0275fac=function(e){return new(e||W)(t.Y36(f))},W.\u0275cmp=t.Xpm({type:W,selectors:[["","report-spaces",""]],attrs:["report-spaces",""],decls:8,vars:4,consts:[[1,"relative","flex-1","h-1/2","w-full","overflow-auto","z-0"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,n){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,ue,3,4,"ng-container",1),t.ALo(3,"async"),t.qZA(),t.YNc(4,me,4,1,"ng-template",null,2,t.W1O),t.YNc(6,_e,3,0,"ng-template",null,3,t.W1O)),2&e){const s=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,n.loading))("ngIfElse",s)}},dependencies:[m.O5,lt.Ou,w,P,E,B,m.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}\n/*# sourceMappingURL=report-spaces.component.ts-angular-inline--98.css.map*/"]});const he=function(){return["date","usage","approved","count","utilisation"]},ve=function(){return["Date","Used Desks","Approved Bookings","Total Requests","Utilisation"]},Ze=function(){return["flex"]},ye=function(o,e,n){return{date:o,usage:e,utilisation:n}};class X{constructor(e){var n=this;this._state=e,this.day_list=this._state.day_list,this.download=(0,Z.Z)(function*(){let s=yield n.day_list.pipe((0,k.q)(1)).toPromise();s=s.map(a=>({...a,date:(0,R.Z)(a.date,"MMMM d, y(EEE)")})),(0,g.Sv)("desks-usage.csv",(0,g.o3)(s))})}}function xe(o,e){1&o&&t._uU(0),2&o&&t.hij(" ",e.data||"0","% ")}X.\u0275fac=function(e){return new(e||X)(t.Y36(f))},X.\u0275cmp=t.Xpm({type:X,selectors:[["report-desks-overall-list"]],decls:12,vars:13,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size","template"],["date_view",""],["percent_view",""]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Daily Utilisation"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.YNc(8,ge,2,4,"ng-template",null,5,t.W1O),t.YNc(10,fe,1,1,"ng-template",null,6,t.W1O),t.qZA()),2&e){const s=t.MAs(9),a=t.MAs(11);t.xp6(7),t.Q6J("dataSource",n.day_list)("pagination",!0)("columns",t.DdM(6,he))("display_column",t.DdM(7,ve))("column_size",t.DdM(8,Ze))("template",t.kEZ(9,ye,s,a,a))}},dependencies:[O.o,L.C,m.uU],encapsulation:2});const Te=function(){return["name","avg_usage","approved","count","utilisation"]},Ce=function(){return["Level","Avg. Used Desks","Approved Bookings","Total Requests","Utilisation"]},Ae=function(){return["flex"]},we=function(o){return{utilisation:o}};class V{constructor(e,n){var s=this;this._state=e,this._org=n,this.level_list=(0,A.aj)([this._state.options,this._state.stats,this._state.counts]).pipe((0,_.U)(([a,i,r])=>{const{start:p,end:d,zones:l}=a,v=(0,_t.Z)(d,p)||1,h=[];for(const u of l){if("All"===u)continue;const x=this._org.levelWithID([u]),vt=r[u]||0,st=i.events.filter(Zt=>Zt.zones.includes(u));let dt=(vt*v-st.length)/v;dt%1!=0&&(dt=dt.toFixed(2)),h.push({name:x?.display_name||x?.name,free:dt,approved:st.filter(Zt=>Zt.approved).length||0,avg_usage:st.length/v,total:vt,count:st.length,utilisation:(st.length/((vt||1)*v)*100||0).toFixed(2)})}return h}),(0,T.d)(1)),this.download=(0,Z.Z)(function*(){let a=yield s.level_list.pipe((0,k.q)(1)).toPromise();(0,g.Sv)("desks-levels-usage.csv",(0,g.o3)(a))})}}V.\u0275fac=function(e){return new(e||V)(t.Y36(f),t.Y36(C.w7))},V.\u0275cmp=t.Xpm({type:V,selectors:[["report-desks-levels-list"]],decls:11,vars:11,consts:[[1,"px-4","mb-4","w-full"],[1,"rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden","w-full"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size","template"],["percent_view",""]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),t._uU(4,"Level Utilisation"),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return n.download()}),t.TgZ(6,"app-icon"),t._uU(7,"download"),t.qZA()()(),t._UZ(8,"custom-table",5),t.YNc(9,xe,1,1,"ng-template",null,6,t.W1O),t.qZA()()),2&e){const s=t.MAs(10);t.xp6(8),t.Q6J("dataSource",n.level_list)("pagination",!0)("columns",t.DdM(6,Te))("display_column",t.DdM(7,Ce))("column_size",t.DdM(8,Ae))("template",t.VKq(9,we,s))}},dependencies:[O.o,L.C],encapsulation:2});var At=c(3070);class G extends g.KG{constructor(e,n){super(),this._state=e,this._org=n,this.day_list=this._state.day_list,this.stats=(0,A.aj)([this._state.options,this._state.counts])}ngOnInit(){this.subscription("day_list",this.day_list.subscribe(e=>this.updateDailyChart(e))),this.subscription("stats",this.stats.subscribe(([e,n])=>this.updateLevelChart(e,n)))}updateDailyChart(e){const n={labels:e.map(s=>(0,R.Z)(s.date,"dd MMM")),series:[e.map(s=>s.utilisation)]};this._day_chart=new At.wW("#day-chart",n)}updateLevelChart(e,n){let{zones:s}=e||{};s.includes("All")&&(s=this._org.levels.filter(i=>i.parent_id===this._org.building.id).map(i=>i.id));const a={labels:(s||[]).map(i=>{const r=this._org.levelWithID([i]);return r?.display_name||r.name||""}),series:(s||[]).map(i=>n[i])};this._level_chart=new At.uc("#level-chart",a)}}function Me(o,e){if(1&o&&(t.ynx(0),t.TgZ(1,"div",4)(2,"div",5)(3,"h3"),t._uU(4,"Total Bookings"),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"div",5)(9,"h3"),t._uU(10,"Utilisation"),t.qZA(),t.TgZ(11,"p"),t._uU(12),t.ALo(13,"async"),t.qZA()()(),t._UZ(14,"report-desks-charts")(15,"report-desks-overall-list")(16,"report-desks-levels-list"),t.BQk()),2&o){const n=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,2,n.total_count)||0),t.xp6(6),t.hij("",t.lcZ(13,4,n.utilisation)||0,"%")}}function Oe(o,e){if(1&o&&(t.ynx(0),t.YNc(1,Me,17,6,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&o){const n=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",s)}}function Re(o,e){1&o&&(t.TgZ(0,"div",6),t._UZ(1,"mat-spinner",7),t.TgZ(2,"p",8),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function be(o,e){1&o&&(t.TgZ(0,"div",6)(1,"p",8),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}G.\u0275fac=function(e){return new(e||G)(t.Y36(f),t.Y36(C.w7))},G.\u0275cmp=t.Xpm({type:G,selectors:[["report-desks-charts"]],features:[t.qOj],decls:11,vars:0,consts:[[1,"flex","items-center","space-x-4","w-full","px-4"],[1,"bg-white","dark:bg-neutral-700","rounded","shadow","flex-1"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","text-xl","font-bold"],["id","day-chart",1,"ct-chart","ct-octave"],["util_chart",""],["id","level-chart",1,"ct-chart","ct-octave"],["level_chart",""]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3," Daily Utilisation "),t.qZA(),t._UZ(4,"div",3,4),t.qZA(),t.TgZ(6,"div",1)(7,"div",2),t._uU(8," Level Utilisation "),t.qZA(),t._UZ(9,"div",5,6),t.qZA()())},styles:["[_nghost-%COMP%]{display:block}\n/*# sourceMappingURL=report-desks-charts.component.ts-angular-inline--115.css.map*/"]});class ${constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,_.U)(n=>n.count||0)),this.utilisation=this._state.stats.pipe((0,_.U)(n=>(100*(n.utilisation||0)).toFixed(1))),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"desks"})}}$.\u0275fac=function(e){return new(e||$)(t.Y36(f))},$.\u0275cmp=t.Xpm({type:$,selectors:[["","report-desks",""]],attrs:["report-desks",""],decls:8,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,n){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,Oe,3,4,"ng-container",1),t.ALo(3,"async"),t.YNc(4,Re,4,1,"ng-template",null,2,t.W1O),t.YNc(6,be,3,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const s=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,n.loading))("ngIfElse",s)}},dependencies:[m.O5,lt.Ou,w,X,V,G,m.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}\n/*# sourceMappingURL=report-desks.component.ts-angular-inline--99.css.map*/"]});var wt=c(1950);class U{constructor(e){this._reports=e,this.catering_orders=this._reports.bookings.pipe((0,_.U)(n=>(0,g.xH)(n.filter(a=>a.extension_data?.catering?.length).map(a=>a.extension_data?.catering.map(i=>new wt.GX({...i,deliver_at:a.date,event:a})))).filter(a=>a).sort((a,i)=>a.event?.date-i.event?.date)),(0,T.d)(1)),this.catering_items=this.catering_orders.pipe((0,_.U)(n=>{const s=[];for(const a of n)for(const i of a?.items||[]){const r=s.findIndex(p=>i.options_string===p.options_string);r>=0?i[r]=new wt.Ud({...i,quantity:i?.quantity+i[r]?.quantity}):s.push(i)}return s.sort((a,i)=>i.quantity-a.quantity)})),this.stats=(0,A.aj)([this.catering_orders,this.catering_items]).pipe((0,_.U)(([n,s])=>{const a=n.reduce((i,r)=>i+r.total_cost,0);return{order_count:n.length,unique_items:s.length,item_count:n.reduce((i,r)=>i+r.item_count,0),total_cost:a,avg_cost:a/n.length}}))}downloadOrders(){var e=this;return(0,Z.Z)(function*(){const n=yield e.catering_orders.pipe((0,k.q)(1)).toPromise(),s=(0,g.o3)(n);return(0,g.Sv)("catering-orders.csv",s)})()}}U.\u0275fac=function(e){return new(e||U)(t.LFG(f))},U.\u0275prov=t.Yz7({token:U,factory:U.\u0275fac,providedIn:"root"});class K{constructor(e,n){this._report=e,this._org=n,this.stats=this._report.stats}get code(){return this._org.currency_code}}K.\u0275fac=function(e){return new(e||K)(t.Y36(U),t.Y36(C.w7))},K.\u0275cmp=t.Xpm({type:K,selectors:[["catering-report-overall"]],decls:32,vars:21,consts:[[1,"bg-white","dark:bg-neutral-700","shadow","rounded","m-2","px-8","w-48","h-24","flex","flex-col","items-center","justify-center"],["count","",1,"text-3xl"],[1,""],["unique","",1,"text-3xl"],["items","",1,"text-3xl"],["total","",1,"text-3xl"],["average","",1,"text-3xl"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"div",2),t._uU(5,"Orders"),t.qZA()(),t.TgZ(6,"div",0)(7,"div",3),t._uU(8),t.ALo(9,"async"),t.qZA(),t.TgZ(10,"div",2),t._uU(11,"Unique Items"),t.qZA()(),t.TgZ(12,"div",0)(13,"div",4),t._uU(14),t.ALo(15,"async"),t.qZA(),t.TgZ(16,"div",2),t._uU(17,"Ordered Items"),t.qZA()(),t.TgZ(18,"div",0)(19,"div",5),t._uU(20),t.ALo(21,"currency"),t.ALo(22,"async"),t.qZA(),t.TgZ(23,"div",2),t._uU(24,"Total"),t.qZA()(),t.TgZ(25,"div",0)(26,"div",6),t._uU(27),t.ALo(28,"currency"),t.ALo(29,"async"),t.qZA(),t.TgZ(30,"div",2),t._uU(31,"Order Average"),t.qZA()()),2&e){let s,a,i,r,p;t.xp6(2),t.hij(" ",(null==(s=t.lcZ(3,5,n.stats))?null:s.order_count)||"0"," "),t.xp6(6),t.hij(" ",(null==(a=t.lcZ(9,7,n.stats))?null:a.unique_items)||"0"," "),t.xp6(6),t.Oqu((null==(i=t.lcZ(15,9,n.stats))?null:i.item_count)||"0"),t.xp6(6),t.hij(" ",t.xi3(21,11,(null==(r=t.lcZ(22,14,n.stats))?null:r.total_cost)/100||0,n.code)," "),t.xp6(7),t.hij(" ",t.xi3(28,16,(null==(p=t.lcZ(29,19,n.stats))?null:p.avg_cost)/100||0,n.code)," ")}},dependencies:[m.Ov,m.H9],styles:["[_nghost-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;padding:.5rem}\n/*# sourceMappingURL=catering-report-overall.component.ts-angular-inline--114.css.map*/"]});var ht=c(6896);function ke(o,e){if(1&o&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&o){const n=e.data;t.AsE(" ",t.lcZ(1,2,n)," at ",t.xi3(2,4,n,"shortTime")," ")}}function Le(o,e){if(1&o&&(t._uU(0),t.ALo(1,"currency")),2&o){const n=e.data,s=t.oxw();t.hij(" ",t.xi3(1,1,n/100,s.code)," ")}}const De=function(){return["deliver_at","item_count","total_cost"]},Se=function(){return["Date","Items","Total Cost"]},Ie=function(){return["flex"]},qe=function(o,e){return{deliver_at:o,total_cost:e}};class H{constructor(e,n){this._report=e,this._org=n,this.orders=this._report.catering_orders,this.download=()=>this._report.downloadOrders()}get code(){return this._org.currency_code}}function Ne(o,e){if(1&o&&(t.TgZ(0,"span",7),t._uU(1),t.qZA()),2&o){const n=t.oxw().data,s=t.oxw();t.Q6J("matTooltip",s.options(n)),t.xp6(1),t.hij(" ",n.length," option(s) ")}}function Je(o,e){1&o&&t.YNc(0,Ne,2,2,"span",6),2&o&&t.Q6J("ngIf",e.data.length)}function Ye(o,e){if(1&o&&(t._uU(0),t.ALo(1,"currency")),2&o){const n=e.data,s=t.oxw();t.hij(" ",t.xi3(1,1,(n||0)/100,s.code)," ")}}H.\u0275fac=function(e){return new(e||H)(t.Y36(U),t.Y36(C.w7))},H.\u0275cmp=t.Xpm({type:H,selectors:[["catering-report-orders"]],decls:12,vars:12,consts:[[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["matRipple-icon","","matTooltip","Download list",3,"click"],["empty","No orders for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination"],["date_state",""],["cost_state",""]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),t._uU(3,"Orders"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return n.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.YNc(8,ke,3,7,"ng-template",null,5,t.W1O),t.YNc(10,Le,2,4,"ng-template",null,6,t.W1O),t.qZA()),2&e){const s=t.MAs(9),a=t.MAs(11);t.xp6(7),t.Q6J("dataSource",n.orders)("columns",t.DdM(6,De))("display_column",t.DdM(7,Se))("column_size",t.DdM(8,Ie))("template",t.WLB(9,qe,s,a))("pagination",!0)}},dependencies:[ht.gM,O.o,L.C,m.H9,m.uU]});const Qe=function(){return["name","options","quantity","unit_price","total_cost"]},ze=function(){return["Name","Options","Quantity","Unit Price","Total Cost"]},je=function(){return["flex"]},Fe=function(o,e,n){return{options:o,unit_price:e,total_cost:n}};class tt{constructor(e,n){this._report=e,this._org=n,this.items=this._report.catering_items}get code(){return this._org.currency_code}options(e){return e.map(n=>n.name).join("\n")}}function Pe(o,e){1&o&&(t.TgZ(0,"div",5),t._UZ(1,"catering-report-overall")(2,"catering-report-orders")(3,"catering-report-items"),t.qZA())}function Ee(o,e){if(1&o&&(t.ynx(0),t.YNc(1,Pe,4,0,"div",4),t.ALo(2,"async"),t.BQk()),2&o){const n=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",s)}}function Be(o,e){1&o&&(t.TgZ(0,"div",6),t._UZ(1,"mat-spinner",7),t.TgZ(2,"p",8),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function We(o,e){1&o&&(t.TgZ(0,"div",6)(1,"p",8),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}tt.\u0275fac=function(e){return new(e||tt)(t.Y36(U),t.Y36(C.w7))},tt.\u0275cmp=t.Xpm({type:tt,selectors:[["catering-report-items"]],decls:9,vars:13,consts:[[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty","No orders for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination"],["option_state",""],["cost_state",""],["class","text-xs px-2 py-1 rounded bg-gray-300",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-gray-300",3,"matTooltip"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),t._uU(3,"Ordered Items"),t.qZA()(),t._UZ(4,"custom-table",3),t.YNc(5,Je,1,1,"ng-template",null,4,t.W1O),t.YNc(7,Ye,2,4,"ng-template",null,5,t.W1O),t.qZA()),2&e){const s=t.MAs(6),a=t.MAs(8);t.xp6(4),t.Q6J("dataSource",n.items)("columns",t.DdM(6,Qe))("display_column",t.DdM(7,ze))("column_size",t.DdM(8,je))("template",t.kEZ(9,Fe,s,a,a))("pagination",!0)}},dependencies:[m.O5,ht.gM,L.C,m.H9]});class et{constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,_.U)(n=>n.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}et.\u0275fac=function(e){return new(e||et)(t.Y36(f))},et.\u0275cmp=t.Xpm({type:et,selectors:[["catering-report"]],decls:8,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["class","h-full w-full",4,"ngIf","ngIfElse"],[1,"h-full","w-full"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,n){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,Ee,3,4,"ng-container",1),t.ALo(3,"async"),t.YNc(4,Be,4,1,"ng-template",null,2,t.W1O),t.YNc(6,We,3,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const s=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,n.loading))("ngIfElse",s)}},dependencies:[m.O5,lt.Ou,w,K,H,tt,m.Ov]});var Ut=c(1810),Xe=c(3298),Ve=c(9151),Ge=c(8759);const pt={};class D{transform(e){return e?(pt[e]||(pt[e]=(0,at.VE)(e).pipe((0,_.U)(n=>n[0]||new at.mO({id:e,name:e})),(0,rt.K)(n=>(0,b.of)(new at.mO({id:e,name:e}))),(0,T.d)(1))),pt[e]):(0,b.of)(null)}static addUser(e){pt[e.id]=(0,b.of)(e).pipe((0,T.d)(1))}}D.\u0275fac=function(e){return new(e||D)},D.\u0275pipe=t.Yjl({name:"user",type:D,pure:!0});class S{constructor(e,n){this._org=e,this._reports=n,this._loading=new J.X(""),this._generate=new J.X(0),this._options=new J.X({start:(0,q.Z)(Date.now()),end:(0,N.Z)(Date.now())}),this.events=(0,A.aj)([this._options,this._generate]).pipe((0,Xe.x)((s,a)=>s[1]===a[1]),(0,Ve.h)(([s,a])=>!!a),(0,F.w)(([{start:s,end:a,user:i}])=>{if(!i)return(0,b.of)([]);this._loading.next("Loading contact events...");const r=(0,xt.rTZ)(this.system_id,"ContactTracing");return i=i||(0,g.ar)(),D.addUser(i),this.system_id&&r?r.execute("close_contacts",[i.email,i.username,(0,Ut.Z)(s),(0,Ut.Z)(a)]).catch(p=>((0,g.cB)(`${p?.msg||JSON.stringify(p)}`),[])):(0,b.of)([])}),(0,_.U)(s=>{const a=this._options.getValue().user||(0,g.ar)();return s.map(i=>({mac_address:i.mac_address,date:1e3*i.contact_time,duration:Math.floor(i.duration/60)||0,user_id:a.id,user:a.name,contact_id:i.username,distance:1}))}),(0,rt.K)(s=>((0,g.cB)(`${s?.msg||JSON.stringify(s)}`),(0,b.of)([]))),(0,Ge.b)(s=>this._loading.next("")),(0,T.d)(1)),this.options=this._options.asObservable(),this.loading=this._loading.asObservable()}get system_id(){return this._org.binding("contact_tracing")}setOptions(e){this._options.next({...this._options.getValue(),...e})}generateReport(){this._generate.next(Date.now())}downloadReport(){var e=this;return(0,Z.Z)(function*(){const{start:n,end:s}=yield e._reports.options.pipe((0,k.q)(1)).toPromise(),a=yield e.events.pipe((0,k.q)(1)).toPromise(),i=new D,r=yield Promise.all(a.map(function(){var p=(0,Z.Z)(function*(d){return{"MAC Address":d.mac_address,Date:(0,R.Z)(d.date,"dd MMM yyyy, h:mm a"),"User Name":d.user,"Contact Name":(yield i.transform(d.contact_id).toPromise())?.name||("null"!==d.contact_id?d.contact_id:null)||d.mac_address,Duration:`${Math.floor(d.duration/60)?Math.floor(d.duration/60)+"h ":""}${Math.floor(d.duration%60)+"m"}`,Distance:d.distance}});return function(d){return p.apply(this,arguments)}}()));(0,g.Sv)(`report+contact-tracing+${(0,R.Z)(n,"yyyy-MM-dd")}+${(0,R.Z)(s,"yyyy-MM-dd")}.csv`,(0,g.o3)(r))})()}}S.\u0275fac=function(e){return new(e||S)(t.LFG(C.w7),t.LFG(f))},S.\u0275prov=t.Yz7({token:S,factory:S.\u0275fac,providedIn:"root"});var $e=c(9697);class nt{constructor(e){this._state=e,this.options=this._state.options,this.setOptions=n=>this._state.setOptions(n),this.generate=()=>this._state.generateReport()}}function Ke(o,e){if(1&o&&(t.TgZ(0,"span",16),t._uU(1),t.qZA()),2&o){const n=t.oxw().data,s=t.oxw(3);t.Q6J("matTooltip",s.options(n)),t.xp6(1),t.hij(" ",n.length," option(s) ")}}function He(o,e){1&o&&t.YNc(0,Ke,2,2,"span",15),2&o&&t.Q6J("ngIf",e.data.length)}function tn(o,e){if(1&o&&(t._uU(0),t.ALo(1,"async"),t.ALo(2,"user")),2&o){const s=e.row;let a;t.Oqu((null==(a=t.lcZ(1,1,t.lcZ(2,3,e.data)))?null:a.name)||s.mac_address)}}function en(o,e){if(1&o&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&o){const n=e.data;t.AsE(" ",t.xi3(1,2,n,"mediumDate"),", ",t.xi3(2,5,n,"shortTime")," ")}}function nn(o,e){if(1&o&&t._uU(0),2&o){const n=e.data,s=t.oxw(3);t.hij(" ",s.formatDuration(n||0)||"Less than a minute"," ")}}function on(o,e){1&o&&t._uU(0),2&o&&t.hij(" ",e.data,"m ")}nt.\u0275fac=function(e){return new(e||nt)(t.Y36(S))},nt.\u0275cmp=t.Xpm({type:nt,selectors:[["contact-tracing-options"]],decls:15,vars:14,consts:[[1,"flex","items-center","space-x-2","w-full","p-2","bg-white","dark:bg-neutral-700","shadow"],["appearance","outline",1,"w-[18rem]"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["placeholder","Search for user to trace...",1,"w-64","h-12","mb-2","mt-1",3,"ngModel","ngModelChange"],["matRipple","",3,"disabled","click"]],template:function(e,n){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-date-range-input",2)(3,"input",3),t.NdJ("ngModelChange",function(a){return a?n.setOptions({start:a,user:null}):""}),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(a){return a?n.setOptions({end:a,user:null}):""}),t.ALo(6,"async"),t.qZA()(),t._UZ(7,"mat-datepicker-toggle",5)(8,"mat-date-range-picker",null,6),t.qZA(),t.TgZ(10,"a-user-search-field",7),t.NdJ("ngModelChange",function(a){return n.setOptions({user:a})}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"button",8),t.NdJ("click",function(){return n.generate()}),t.ALo(13,"async"),t._uU(14," Generate Report "),t.qZA()()),2&e){const s=t.MAs(9);let a,i,r,p;t.xp6(2),t.Q6J("rangePicker",s),t.xp6(1),t.Q6J("ngModel",null==(a=t.lcZ(4,6,n.options))?null:a.start),t.xp6(2),t.Q6J("ngModel",null==(i=t.lcZ(6,8,n.options))?null:i.end),t.xp6(2),t.Q6J("for",s),t.xp6(3),t.Q6J("ngModel",null==(r=t.lcZ(11,10,n.options))?null:r.user),t.xp6(2),t.Q6J("disabled",!(null!=(p=t.lcZ(13,12,n.options))&&p.user))}},dependencies:[M.Fj,M.JJ,M.On,ct.KE,ct.R9,y.nW,y.wx,y.zY,y.By,y._g,Q.wG,$e.d,m.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25rem}\n/*# sourceMappingURL=contact-tracing-options.component.ts-angular-inline--117.css.map*/"]});const sn=function(){return["date","user_id","contact_id","duration"]},an=function(){return["Time of Contact","Person","Close Contact","Duration"]},rn=function(){return["12r","14r","flex","10r"]},cn=function(o,e,n,s,a,i){return{options:o,date:e,distance:n,user_id:s,contact_id:a,duration:i}};function ln(o,e){if(1&o&&(t.TgZ(0,"div",6)(1,"div",7)(2,"h2",8),t._uU(3,"Contact Events"),t.qZA()(),t._UZ(4,"custom-table",9),t.YNc(5,He,1,1,"ng-template",null,10,t.W1O),t.YNc(7,tn,3,5,"ng-template",null,11,t.W1O),t.YNc(9,en,3,8,"ng-template",null,12,t.W1O),t.YNc(11,nn,1,1,"ng-template",null,13,t.W1O),t.YNc(13,on,1,1,"ng-template",null,14,t.W1O),t.qZA()),2&o){const n=t.MAs(6),s=t.MAs(8),a=t.MAs(10),i=t.MAs(12),r=t.MAs(14),p=t.oxw(2);t.xp6(4),t.Q6J("dataSource",p.tracing_events)("columns",t.DdM(7,sn))("display_column",t.DdM(8,an))("column_size",t.DdM(9,rn))("template",t.HTZ(10,cn,n,a,r,s,s,i))("pagination",!0)("page_size",30)}}function pn(o,e){if(1&o&&(t.ynx(0),t.YNc(1,ln,15,17,"div",5),t.ALo(2,"async"),t.BQk()),2&o){const n=t.oxw(),s=t.MAs(10);let a;t.xp6(1),t.Q6J("ngIf",null==(a=t.lcZ(2,2,n.options))?null:a.user)("ngIfElse",s)}}function dn(o,e){if(1&o&&(t.TgZ(0,"div",17),t._UZ(1,"map-spinner",18),t.TgZ(2,"p"),t._uU(3),t.ALo(4,"async"),t.qZA()()),2&o){const n=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,1,n.loading))}}function un(o,e){1&o&&(t.TgZ(0,"div",17)(1,"p",19),t._uU(2,"Select a user from the topbar to begin"),t.qZA()())}class ot{constructor(e){this._state=e,this.loading=this._state.loading,this.options=this._state.options,this.tracing_events=this._state.events,this.setOptions=n=>this._state.setOptions(n),this.downloadReport=()=>this._state.downloadReport(),this.formatDuration=n=>(0,ft.Z)({hours:Math.floor(n/60),minutes:n%60})}}ot.\u0275fac=function(e){return new(e||ot)(t.Y36(S))},ot.\u0275cmp=t.Xpm({type:ot,selectors:[["app-contact-tracing-report"]],decls:11,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["icon","","matRipple","","matTooltip","Download Report",1,"bg-white","dark:bg-neutral-700","absolute","bottom-2","left-2","shadow",3,"click"],["load_state",""],["empty_state",""],["class","w-[64rem] max-w-[calc(100%-2rem)] rounded overflow-hidden bg-white dark:bg-neutral-700 shadow mx-auto my-2",4,"ngIf","ngIfElse"],[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty","No contact records for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination","page_size"],["option_state",""],["user_state",""],["date_state",""],["duration_state",""],["distance_state",""],["class","text-xs px-2 py-1 rounded bg-gray-300 dark:bg-neutral-600",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-gray-300","dark:bg-neutral-600",3,"matTooltip"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"],[1,"opacity-60"]],template:function(e,n){if(1&e&&(t._UZ(0,"contact-tracing-options"),t.TgZ(1,"div",0),t.YNc(2,pn,3,4,"ng-container",1),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"button",2),t.NdJ("click",function(){return n.downloadReport()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()(),t.YNc(7,dn,5,3,"ng-template",null,3,t.W1O),t.YNc(9,un,3,0,"ng-template",null,4,t.W1O)),2&e){const s=t.MAs(8);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,n.loading))("ngIfElse",s)}},dependencies:[m.O5,ht.gM,Q.wG,O.o,L.C,nt,m.Ov,m.uU,D],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}\n/*# sourceMappingURL=contact-tracing-report.component.ts-angular-inline--116.css.map*/"]});const mn=[{path:"",component:j,children:[{path:"",component:w},{path:"spaces",component:W},{path:"desks",component:$},{path:"catering",component:et},{path:"contact-tracing",component:ot},{path:"**",redirectTo:"desks",pathMatch:"full"}]}];class Y{}Y.\u0275fac=function(e){return new(e||Y)},Y.\u0275mod=t.oAB({type:Y}),Y.\u0275inj=t.cJS({imports:[m.ez,M.u5,Mt.v,zt.YR,at.PP,Ot.TU,I.Bz.forChild(mn)]})}}]);
//# sourceMappingURL=apps_concierge_src_app_reports_reports_module_ts.js.map