"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_reports_reports_module_ts"],{4393:(mi,Ht,f)=>{f.r(Ht),f.d(Ht,{ReportsModule:()=>pi});var w=f(6575),X=f(8849),B=f(2649),Ce=f(7910),Me=f(9687),t=f(9039),Te=f(2349),x=f(7109),ot=f(257),V=f(4888);const Oe=()=>["/reports","desks"];function Ue(i,s){1&i&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2,"room"),t.qZA(),t.TgZ(3,"h3",6),t._uU(4,"Desks"),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&i&&t.Q6J("routerLink",t.DdM(1,Oe))}const Le=()=>["/reports","bookings"];function Re(i,s){1&i&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2,"meeting_room"),t.qZA(),t.TgZ(3,"h3",6),t._uU(4,"Rooms"),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&i&&t.Q6J("routerLink",t.DdM(1,Le))}const Ne=()=>["/reports","catering"];function Ee(i,s){1&i&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2,"room_service"),t.qZA(),t.TgZ(3,"h3",6),t._uU(4,"Catering"),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&i&&t.Q6J("routerLink",t.DdM(1,Ne))}const Se=()=>["/reports","contact-tracing"];function De(i,s){1&i&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2,"connect_without_contact"),t.qZA(),t.TgZ(3,"h3",6),t._uU(4,"Contact Tracing"),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&i&&t.Q6J("routerLink",t.DdM(1,Se))}const ze=i=>["/reports",i];function Ie(i,s){if(1&i&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2),t.qZA(),t.TgZ(3,"h3",6),t._uU(4),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&i){const n=s.$implicit;t.Q6J("routerLink",t.VKq(3,ze,n.id)),t.xp6(2),t.Oqu(n.icon),t.xp6(2),t.Oqu(n.name)}}const ke=["desks","spaces","catering","contact-tracing"];let $t=(()=>{class i{get custom_reports(){return this._settings.get("app.custom_reports")||[]}get features(){return this._settings.get("app.reports.features")||ke}constructor(n){this._settings=n}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(x.gb))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["reports-menu"],["","reports-menu",""]],decls:7,vars:5,consts:[[1,"absolute","inset-0","flex","items-center","justify-center","bg-base-200","overflow-auto"],[1,"grid","w-full","justify-items-center"],["matRipple","","class","h-64 w-64 p-4 flex flex-col items-center justify-center bg-base-100 rounded shadow hover:opacity-80 border border-base-200",3,"routerLink",4,"ngIf"],["matRipple","","class","h-64 w-64 p-4 flex flex-col items-center justify-center bg-base-100 rounded shadow hover:opacity-80 border border-base-200",3,"routerLink",4,"ngFor","ngForOf"],["matRipple","",1,"h-64","w-64","p-4","flex","flex-col","items-center","justify-center","bg-base-100","rounded","shadow","hover:opacity-80","border","border-base-200",3,"routerLink"],[1,"text-8xl"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center"],[1,"ml-2"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,Ue,10,2,"a",2)(3,Re,10,2,"a",2)(4,Ee,10,2,"a",2)(5,De,10,2,"a",2)(6,Ie,10,5,"a",3),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngIf",a.features.includes("desks")),t.xp6(1),t.Q6J("ngIf",a.features.includes("spaces")),t.xp6(1),t.Q6J("ngIf",a.features.includes("catering")),t.xp6(1),t.Q6J("ngIf",a.features.includes("contact-tracing")),t.xp6(1),t.Q6J("ngForOf",a.custom_reports))},dependencies:[w.sg,w.O5,ot.wG,V.o,B.rH],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row!important;align-items:center;justify-content:center;background:inherit}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(16rem,1fr));gap:1rem}\n\n/*# sourceMappingURL=reports-menu.component.ts-angular-inline--133.css.map*/"]})}return i})();const Ye=["app-reports",""];function je(i,s){1&i&&t._UZ(0,"div",3)}let Be=(()=>{class i{get path(){const n=this._router.url.split("/");return n[n.length-1]}constructor(n){this._router=n}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(B.F0))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["","app-reports",""]],attrs:Ye,decls:4,vars:1,consts:[[1,"h-full"],[1,"relative","overflow-hidden","flex","flex-col","flex-1","w-1/2","h-full","bg-base-200"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(e,a){1&e&&(t._UZ(0,"sidebar",0),t.TgZ(1,"main",1),t._UZ(2,"router-outlet"),t.YNc(3,je,1,0,"div",2),t.qZA()),2&e&&(t.xp6(3),t.Q6J("ngIf","reports"===a.path))},dependencies:[w.O5,Te.k,B.lC,$t],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}main[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(router-outlet){display:flex;flex-direction:column;width:100%;height:100%}\n\n/*# sourceMappingURL=reports.component.ts-angular-inline--129.css.map*/"]})}return i})();var qe=f(7049),ft=f(8377),z=f(1670),Pe=f(7627),J=f(3121),Kt=f(7298),Je=f(8466),Nt=f(9916),Et=f(9520),tt=f(7016),Qe=f(8415),et=f(4512),_t=f(7343),Fe=f(7508),St=f(5822),G=f(4884),Xe=f(2484),nt=f(462),W=f(9681),Q=f(8159),vt=f(5933),rt=f(6520),xt=f(8175),Z=f(7422),q=f(680),We=f(942);const He={0:"sunday",1:"monday",2:"tuesday",3:"wednesday",4:"thurday",5:"friday",6:"saturday"};let S=(()=>{class i{get duration(){const n=this._options.getValue();return Math.max(1,Math.abs((0,Et.Z)((0,tt.Z)(n.start),(0,Qe.Z)((0,et.Z)(n.end),1))))}constructor(n,e){var a=this;this._org=n,this._settings=e,this._space_pipe=new We.X(this._org),this._generate=new Xe.xQ,this._loading=new nt.X(""),this._active_bookings=new nt.X([]),this._options=new nt.X({start:new Date,end:new Date}),this._bookings_list=this._generate.pipe((0,vt.b)(500),(0,rt.w)(o=>{const r=this._options.getValue();if(this._loading.next("Loading report details..."),!r?.type&&!r?.zones?.length)return(0,W.of)([]);const l=(0,tt.Z)(r.start||Date.now()),d=(0,et.Z)(r.end||l),c=r?.zones?r.zones.filter(g=>"All"!==g).join(","):"",u={period_start:(0,_t.Z)(l),period_end:(0,_t.Z)(d)};return"desks"===r.type?(0,Je.NP)({...u,zones:c,type:"desk",limit:1e3}):(0,Nt.CA)({...u,zone_ids:c,limit:1e3}).pipe((0,rt.w)(function(){var g=(0,z.Z)(function*(p){return Promise.all(p.map(function(){var h=(0,z.Z)(function*(m){return new Nt.ym({...m,resources:yield Promise.all(m.resources.map(y=>a._space_pipe.transform(y.id||y.email)))})});return function(m){return h.apply(this,arguments)}}()))});return function(p){return g.apply(this,arguments)}}()))}),(0,xt.K)(o=>[]),(0,Z.U)(o=>(this._loading.next(""),o?.length||(0,x.cB)("No bookings for the selected levels and period"),this._active_bookings.next(o||[]),o)),(0,q.d)()),this.loading=this._loading.asObservable(),this.options=this._options.asObservable(),this.bookings=this._active_bookings.asObservable(),this.counts=this._options.pipe((0,vt.b)(500),(0,rt.w)(o=>{const r=(o.zones||[]).filter(l=>-1!==l&&"All"!==l);return Promise.all(r.map(l=>(0,Kt.rlq)(l,"desks").pipe((0,Z.U)(d=>[l,d.details.length])).toPromise()))}),(0,xt.K)(o=>[]),(0,Z.U)(o=>{const r={};return this._active_bookings.next([]),o.forEach(([l,d])=>r[l]=d),r}),(0,q.d)()),this.stats=(0,Q.aj)([this.counts,this.bookings]).pipe((0,rt.w)(function(){var o=(0,z.Z)(function*([r,l]){return l[0]instanceof Nt.ym?function Ge(i,s=8){s=Math.max(1,s);const n=i.reduce((r,l)=>r+l.attendees.length,0),e=i.reduce((r,l)=>r+l.system?.capacity,0),a=Math.floor(i.reduce((r,l)=>r+l.duration,0)/(60*s)*100)/100,o=Math.floor(n/e*100)/100;return{count:i.length,avg_length:Math.floor(i.reduce((r,l)=>r+l.duration,0)/i.length*100)/100,efficiency:Math.floor((a+o)/2*100)/100,total_users:n,total_capacity:e,occupancy:o,utilisation:a,events:i}}(l,8*a.duration):function Ve(i,s=1,n={}){s=Math.max(1,s);const e=Object.keys(n).reduce((o,r)=>o+(n[r]||0),0),a=Math.floor(i.length/e/s*1e4)/1e4;return{total:e,count:i.length,utilisation:a,events:i}}(l||[],a.duration,r)});return function(r){return o.apply(this,arguments)}}())),this.day_list=(0,Q.aj)([this.options,this.stats]).pipe((0,Z.U)(([o,r])=>{const{start:l}=o,d=this._settings.get("app.reports.ignore_days")?.map(p=>p.toLowerCase())||[];let c=(0,tt.Z)(l);const u=(0,et.Z)(o.end||c),g=[];for(;(0,Fe.Z)(c,u);){const p=(0,tt.Z)(c).valueOf(),h=(0,et.Z)(p).valueOf();if(!d.includes(He[c.getDay()])){const m=r.events.filter(y=>(0,x.MZ)(p,h,y.date,y.date+60*y.duration*1e3));g.push({date:p,total:r.total,usage:(0,x.Tw)(m,"asset_id").length,free:r.total-m.length,approved:m.reduce((y,v)=>y+(v.approved?1:0),0),count:m.length,utilisation:(m.length/r.total*100).toFixed(1)})}c=(0,St.Z)(c,1)}return g}),(0,q.d)(1)),this._bookings_list.subscribe(o=>o)}generateReport(){this._generate.next((new Date).valueOf())}setOptions(n){n.zones?.includes("All")?n.zones=["All",...this._org.levelsForBuilding(this._org.building).map(e=>e.id)]:n.zones&&this._options.getValue()?.zones?.includes("All")&&(n.zones=[]),n.start?.valueOf()!==this._options.getValue().start?.valueOf()&&n.end?.valueOf()!==this._options.getValue().end?.valueOf()&&this._options.next({...this._options.getValue(),...n})}downloadReport(){const n=this._options.getValue(),e=this._active_bookings.getValue();(0,x.Sv)(`report+${n.type}+${(0,G.Z)(n.start,"yyyy-MM-dd")}+${(0,G.Z)(n.end,"yyyy-MM-dd")}.csv`,(0,x.o3)(e.map(a=>{const o=a.toJSON();return delete o.zones,delete o.server_names,delete o.extension_data,o})))}static#t=this.\u0275fac=function(e){return new(e||i)(t.LFG(J.w7),t.LFG(x.gb))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var yt=f(1268),$e=f(162),k=f(2226),wt=f(3910);function Ke(i,s){if(1&i&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&i){const n=s.$implicit;t.Q6J("value",n.id),t.xp6(1),t.hij(" ",n.display_name||n.name," ")}}function tn(i,s){1&i&&t._UZ(0,"mat-spinner",15),2&i&&t.Q6J("diameter",32)}function en(i,s){1&i&&(t.TgZ(0,"p"),t._uU(1,"Generate Report"),t.qZA())}let bt=(()=>{class i extends x.cx{constructor(n,e,a,o){super(),this._state=n,this._org=e,this._route=a,this._router=o,this.zones=[],this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(r=>`${r.id}`),this.levels=this._org.active_levels,this.loading=this._state.loading,this.bookings=this._state.bookings,this.options=this._state.options,this.page="",this.generateReport=()=>this._state.generateReport(),this.downloadReport=()=>this._state.downloadReport(),this.setStartDate=r=>this._state.setOptions({start:new Date(r)}),this.setEndDate=r=>this._state.setOptions({end:new Date(r)}),this.setZones=r=>this._state.setOptions({zones:r})}ngOnInit(){var n=this;return(0,z.Z)(function*(){yield n._org.initialised.pipe((0,Pe.P)(e=>e)).toPromise(),n.page=n._router.url,n.subscription("routing",n._router.events.subscribe(()=>{n.page=n._router.url})),n.subscription("route.query",n._route.queryParamMap.subscribe(e=>{if(e.has("zone_ids")){const a=e.get("zone_ids").split(",");if(a.length){const o=n._org.levelWithID(a);if(!o)return;n._org.building=n._org.buildings.find(r=>r.id===o.parent_id),n.setZones(a)}}}))})()}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S),t.Y36(J.w7),t.Y36(B.gz),t.Y36(B.F0))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["reports-options"]],features:[t.qOj],decls:28,vars:28,consts:[[1,"bg-base-100","h-20","w-full","flex","items-center","px-2","shadow","z-20","border-b","border-base-200"],["appearance","outline",1,"w-48"],["multiple","","placeholder","Select Levels...",3,"ngModel","ngModelChange"],["value","All"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-64"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["btn","","matRipple","",1,"ml-4",3,"disabled","click"],[3,"diameter",4,"ngIf"],[4,"ngIf"],[3,"value"],[3,"diameter"]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(r){return a.setZones(r)}),t.ALo(3,"async"),t.TgZ(4,"mat-option",3),t._uU(5,"All Levels"),t.qZA(),t.YNc(6,Ke,2,2,"mat-option",4),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"mat-form-field",5)(9,"mat-date-range-input",6)(10,"input",7),t.NdJ("ngModelChange",function(r){return r?a.setStartDate(r):""}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"input",8),t.NdJ("ngModelChange",function(r){return r?a.setEndDate(r):""}),t.ALo(13,"async"),t.qZA()(),t._UZ(14,"mat-datepicker-toggle",9)(15,"mat-date-range-picker",null,10),t.qZA(),t.TgZ(17,"button",11),t.NdJ("click",function(){return a.generateReport()}),t.ALo(18,"async"),t.ALo(19,"async"),t.YNc(20,tn,1,1,"mat-spinner",12),t.ALo(21,"async"),t.YNc(22,en,2,0,"p",13),t.ALo(23,"async"),t.qZA(),t.TgZ(24,"button",11),t.NdJ("click",function(){return a.downloadReport()}),t.ALo(25,"async"),t.TgZ(26,"p"),t._uU(27,"Download Report"),t.qZA()()()),2&e){const o=t.MAs(16);let r,l,d,c,u;t.xp6(2),t.Q6J("ngModel",null==(r=t.lcZ(3,10,a.options))?null:r.zones),t.xp6(4),t.Q6J("ngForOf",t.lcZ(7,12,a.levels)),t.xp6(3),t.Q6J("rangePicker",o),t.xp6(1),t.Q6J("ngModel",null==(l=t.lcZ(11,14,a.options))?null:l.start),t.xp6(2),t.Q6J("ngModel",null==(d=t.lcZ(13,16,a.options))?null:d.end),t.xp6(2),t.Q6J("for",o),t.xp6(3),t.Q6J("disabled",!!t.lcZ(18,18,a.loading)||!(null!=(c=t.lcZ(19,20,a.options))&&null!=c.zones&&c.zones.length)),t.xp6(3),t.Q6J("ngIf",t.lcZ(21,22,a.loading)),t.xp6(2),t.Q6J("ngIf",!t.lcZ(23,24,a.loading)),t.xp6(2),t.Q6J("disabled",!(null!=(u=t.lcZ(25,26,a.bookings))&&u.length))}},dependencies:[w.sg,w.O5,X.Fj,X.JJ,X.On,yt.KE,yt.R9,$e.gD,ot.ey,k.nW,k.wx,k.zY,k.By,k._g,wt.Ou,ot.wG,w.Ov],styles:["button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;margin-left:1em}mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:5.5em;white-space:initial;line-height:1.2em}\n\n/*# sourceMappingURL=reports-options.component.ts-angular-inline--130.css.map*/"]})}return i})();var nn=f(7746),sn=f(8139),te=f(3142),Dt=f(7120),ee=f(7265);function an(i){(0,ee.Z)(1,arguments);var n=(0,Dt.Z)(i).getDay();return 0===n||6===n}var on=f(1578),zt=f(6324);function ln(i,s){if(1&i&&(t.TgZ(0,"div",0)(1,"div",3)(2,"h3"),t._uU(3,"No show count"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"div",3)(8,"h3"),t._uU(9,"% of No show Bookings"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",3)(14,"h3"),t._uU(15,"Total in-room attendance"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"async"),t.qZA()()()),2&i){const n=t.oxw();t.xp6(5),t.Oqu(t.lcZ(6,3,n.no_shows)||0),t.xp6(6),t.hij("",t.lcZ(12,5,n.no_show_percent)||0,"%"),t.xp6(6),t.Oqu(t.lcZ(18,7,n.attendance)||0)}}let cn=(()=>{class i{constructor(n){this._state=n,this.business_days=this._state.options.pipe((0,Z.U)(({start:e,end:a})=>function rn(i,s){(0,ee.Z)(2,arguments);var n=(0,Dt.Z)(i),e=(0,Dt.Z)(s);if(!(0,te.Z)(n)||!(0,te.Z)(e))return NaN;var a=(0,nn.Z)(n,e),o=a<0?-1:1,r=(0,on.Z)(a/7),l=5*r;for(e=(0,St.Z)(e,7*r);!(0,sn.Z)(n,e);)l+=an(e)?0:o,e=(0,St.Z)(e,o);return 0===l?0:l}((0,tt.Z)(a||Date.now()),(0,et.Z)(e||Date.now()))||1)),this.total_count=this._state.stats.pipe((0,Z.U)(e=>e.count||0)),this.avg_length=this._state.stats.pipe((0,Z.U)(e=>(0,zt.Z)({minutes:Math.floor(e.avg_length||0)}))),this.attendance=this._state.stats.pipe((0,Z.U)(({events:e})=>e.reduce((a,{extension_data:o})=>a+(+o?.people_count?.max||0),0))),this.no_shows=this._state.stats.pipe((0,Z.U)(({events:e})=>e.reduce((a,{extension_data:o})=>a+ +o?.people_count?.max?1:0,0))),this.no_show_percent=this._state.stats.pipe((0,Z.U)(({events:e})=>Math.floor(e.reduce((a,{extension_data:o})=>a+ +o?.people_count?.max?1:0,0)/e.length*1e4)/100)),this.has_attendance=this._state.stats.pipe((0,Z.U)(({events:e})=>!!e.find(({extension_data:a})=>!!a?.people_count)))}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["report-spaces-overall"]],decls:21,vars:12,consts:[[1,"m-4","p-4","rounded","bg-base-100","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],["class","m-4 p-4 rounded bg-base-100 shadow flex justify-center items-center space-x-2",4,"ngIf"],[1,"flex-1","flex","flex-col","items-center","justify-center"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3"),t._uU(3,"Business Days"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"div",1)(8,"h3"),t._uU(9,"Total Bookings"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",1)(14,"h3"),t._uU(15,"Average Booking Length"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"async"),t.qZA()()(),t.YNc(19,ln,19,9,"div",2),t.ALo(20,"async")),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,4,a.business_days)||0),t.xp6(6),t.Oqu(t.lcZ(12,6,a.total_count)||0),t.xp6(6),t.Oqu(t.lcZ(18,8,a.avg_length)||"None"),t.xp6(2),t.Q6J("ngIf",t.lcZ(20,10,a.has_attendance)))},dependencies:[w.O5,w.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}\n\n/*# sourceMappingURL=report-spaces-overall.component.ts-angular-inline--134.css.map*/"]})}return i})();var H=f(6939),$=f(7442);const un=()=>["flex"];let pn=(()=>{class i{constructor(n){var e=this;this._reports=n,this.space_list=(0,Q.aj)([this._reports.stats,this._reports.options]).pipe((0,vt.b)(300),(0,Z.U)(([a,{start:o,end:r}])=>{let l=[],d=!1;for(const u of a.events){const g=(0,x.Tw)(u.resources,"email")||[u.system];for(const p of g){let h=l.find(m=>m.id===p.id||m.id?.toLowerCase()===p.email.toLowerCase());if(!h){if(h={id:p.id||p.email,name:p.display_name||p.name,capacity:p.capacity||1,count:0,attendance:0,avg_attendance:0,min_attendance:99,max_attendance:0,attendees:0,avg_attendees:0,usage:0,no_shows:0,utilisation:0,occupancy:0},!h.id||!h.name)continue;l.push(h)}0===u.extension_data?.people_count?.max&&(h.no_shows+=1),h.count+=1,h.attendance+=u.extension_data?.people_count?.max??0,h.avg_attendance+=u.extension_data?.people_count?.avg??0,h.min_attendance=Math.min(h.max_attendance,u.extension_data?.people_count?.max??99),h.max_attendance=Math.max(h.max_attendance,u.extension_data?.people_count?.max??0),h.usage+=u.duration,h.attendees+=u.attendees.length,d=d||!!u.extension_data.people_count}}const c=Math.max(1,(0,Et.Z)(r,o)+1);for(const u of l)u.avg_attendees=Math.floor(u.attendees/u.count*100)/100,u.avg_attendance=Math.floor(u.attendance/u.count*100)/100,u.utilisation=`${Math.floor(u.usage/60/8/c*100)}%`,u.min_attendance=99===u.min_attendance?"?":u.min_attendance,u.occupancy=Math.floor(u.avg_attendees/u.capacity*1e3)/10+"%",(u.attendance<0||!d)&&(u.attendance="?",u.avg_attendance="?");return l})),this.has_attendance=this.space_list.pipe((0,Z.U)(a=>!!a.find(({attendance:o})=>"?"!==o))),this.column_list=this.has_attendance.pipe((0,Z.U)(a=>a?["name","capacity","count","utilisation","avg_attendees","attendance","avg_attendance","no_shows","min_attendance","max_attendance"]:["name","capacity","count","utilisation","avg_attendees"])),this.column_name_list=this.has_attendance.pipe((0,Z.U)(a=>a?["Name","Room Capacity","Bookings","% Time booked during office hrs","Avg. invitees per booking","Total In-room Attendance","Avg. In-room Attendance","No Shows","Min. In-room Attendance","Max. In-room Attendance"]:["Name","Room Capacity","Bookings","% Time booked during office hrs","Avg. invitees per booking"])),this.download=(0,z.Z)(function*(){const a=yield e.space_list.pipe((0,H.q)(1)).toPromise();(0,x.Sv)("report-spaces-usage.csv",(0,x.o3)(a))})}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["report-spaces-space-listing"]],decls:10,vars:10,consts:[[1,"m-4","rounded","bg-base-100","shadow","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Room Utilisation"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return a.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.ALo(8,"async"),t.ALo(9,"async"),t.qZA()),2&e&&(t.xp6(7),t.Q6J("dataSource",a.space_list)("pagination",!0)("columns",t.lcZ(8,5,a.column_list))("display_column",t.lcZ(9,7,a.column_name_list))("column_size",t.DdM(9,un)))},dependencies:[V.o,$.C,w.Ov]})}return i})();const dn=()=>["name","count","avg_attendees","total_time","no_shows"],mn=()=>["Name","Bookings","Avg. Invitees per Booking","Total Booked Time","No Shows"],hn=()=>["flex"];let gn=(()=>{class i{constructor(n){var e=this;this._reports=n,this.user_list=(0,Q.aj)([this._reports.stats]).pipe((0,vt.b)(300),(0,Z.U)(([a])=>{let o=[];for(const r of a.events){const l=r.attendees?.find(u=>u.email===r.extension_data?.host_override||u.email===r.host);if(!l)continue;const d=Math.max(r.resources.reduce((u,g)=>u+g.capacity,0)||1,1);let c=o.find(u=>u.id?.toLowerCase()===l.email.toLowerCase());c||(c={id:l.email,name:l.name,capacity:d,count:0,attendees:0,avg_attendees:0,no_shows:0,occupancy:0,total_time:0},o.push(c)),0===r.extension_data?.people_count?.max&&(c.no_shows+=1),c.count+=1,c.attendees+=r.attendees.length,c.total_time+=r.duration||15}for(const r of o)r.avg_attendees=Math.floor(r.attendees/r.count*100)/100,r.occupancy=Math.floor(r.avg_attendees/r.capacity*100)/100,r.total_time=(0,zt.Z)({hours:Math.floor(r.total_time/60),minutes:r.total_time%60});return o}),(0,q.d)(1)),this.download=(0,z.Z)(function*(){const a=yield e.user_list.pipe((0,H.q)(1)).toPromise();(0,x.Sv)("report-space-attendee-usage.csv",(0,x.o3)(a))})}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["report-spaces-user-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-base-100","shadow","overflow-hidden"],[1,"border-b","border-base-200","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Meeting Organisers"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return a.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.qZA()),2&e&&(t.xp6(7),t.Q6J("dataSource",a.user_list)("pagination",!0)("columns",t.DdM(5,dn))("display_column",t.DdM(6,mn))("column_size",t.DdM(7,hn)))},dependencies:[V.o,$.C]})}return i})();const fn=["report-spaces",""];function _n(i,s){1&i&&(t.ynx(0),t._UZ(1,"report-spaces-overall")(2,"report-spaces-space-listing")(3,"report-spaces-user-listing"),t.BQk())}function vn(i,s){if(1&i&&(t.ynx(0),t.YNc(1,_n,4,0,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&i){const n=t.oxw(),e=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",e)}}function xn(i,s){1&i&&(t.TgZ(0,"div",4),t._UZ(1,"mat-spinner",5),t.TgZ(2,"p",6),t._uU(3,"Loading report data..."),t.qZA()()),2&i&&(t.xp6(1),t.Q6J("diameter",32))}function yn(i,s){1&i&&(t.TgZ(0,"div",4)(1,"p",6),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}let wn=(()=>{class i{constructor(n){this._state=n,this.total_count=this._state.stats.pipe((0,Z.U)(e=>e.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["","report-spaces",""]],attrs:fn,decls:8,vars:4,consts:[[1,"relative","flex-1","h-1/2","w-full","overflow-auto","z-0"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,a){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,vn,3,4,"ng-container",1),t.ALo(3,"async"),t.qZA(),t.YNc(4,xn,4,1,"ng-template",null,2,t.W1O)(6,yn,3,0,"ng-template",null,3,t.W1O)),2&e){const o=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,a.loading))("ngIfElse",o)}},dependencies:[w.O5,wt.Ou,bt,cn,pn,gn,w.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}\n\n/*# sourceMappingURL=report-spaces.component.ts-angular-inline--131.css.map*/"]})}return i})();function bn(i,s){1&i&&(t._uU(0),t.ALo(1,"date")),2&i&&t.hij(" ",t.xi3(1,1,s.data,"mediumDate")," ")}function Zn(i,s){1&i&&t._uU(0),2&i&&t.hij(" ",s.data||"0","% ")}const An=()=>["date","approved","count","utilisation"],Cn=()=>["Date","Approved Bookings","Total Requests","Utilisation"],Mn=()=>["flex"],Tn=(i,s,n)=>({date:i,usage:s,utilisation:n});let On=(()=>{class i{constructor(n){var e=this;this._state=n,this.day_list=this._state.day_list,this.download=(0,z.Z)(function*(){let a=yield e.day_list.pipe((0,H.q)(1)).toPromise();a=a.map(o=>({...o,date:(0,G.Z)(o.date,"MMMM d, y(EEE)")})),(0,x.Sv)("desks-usage.csv",(0,x.o3)(a))})}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["report-desks-overall-list"]],decls:12,vars:13,consts:[[1,"m-4","rounded","bg-base-100","shadow","overflow-hidden"],[1,"border-b","border-base-200","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size","template"],["date_view",""],["percent_view",""]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Daily Utilisation"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return a.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.YNc(8,bn,2,4,"ng-template",null,5,t.W1O)(10,Zn,1,1,"ng-template",null,6,t.W1O),t.qZA()),2&e){const o=t.MAs(9),r=t.MAs(11);t.xp6(7),t.Q6J("dataSource",a.day_list)("pagination",!0)("columns",t.DdM(6,An))("display_column",t.DdM(7,Cn))("column_size",t.DdM(8,Mn))("template",t.kEZ(9,Tn,o,r,r))}},dependencies:[V.o,$.C,w.uU],encapsulation:2})}return i})();function Un(i,s){1&i&&t._uU(0),2&i&&t.hij(" ",s.data||"0","% ")}const Ln=()=>["name","avg_usage","approved","count","utilisation"],Rn=()=>["Level","Avg. Used Desks","Approved Bookings","Total Requests","Utilisation"],Nn=()=>["flex"],En=i=>({utilisation:i});let Sn=(()=>{class i{constructor(n,e){var a=this;this._state=n,this._org=e,this.level_list=(0,Q.aj)([this._state.options,this._state.stats,this._state.counts]).pipe((0,Z.U)(([o,r,l])=>{const{start:d,end:c,zones:u}=o,g=(0,Et.Z)(c,d)||1,p=[];for(const h of u){if("All"===h)continue;const m=this._org.levelWithID([h]),y=l[h]||0,v=r.events.filter(N=>N.zones.includes(h));let U=(y*g-v.length)/g;U%1!=0&&(U=U.toFixed(2)),p.push({name:m?.display_name||m?.name,free:U,approved:v.filter(N=>N.approved).length||0,avg_usage:(v.length/g||0).toFixed(2),total:y,count:v.length,utilisation:(v.length/((y||1)*g)*100||0).toFixed(2)})}return p}),(0,q.d)(1)),this.download=(0,z.Z)(function*(){let o=yield a.level_list.pipe((0,H.q)(1)).toPromise();(0,x.Sv)("desks-levels-usage.csv",(0,x.o3)(o))})}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S),t.Y36(J.w7))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["report-desks-levels-list"]],decls:11,vars:11,consts:[[1,"px-4","mb-4","w-full"],[1,"rounded","bg-base-100","shadow","overflow-hidden","w-full"],[1,"border-b","border-base-200","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size","template"],["percent_view",""]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),t._uU(4,"Level Utilisation"),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return a.download()}),t.TgZ(6,"app-icon"),t._uU(7,"download"),t.qZA()()(),t._UZ(8,"custom-table",5),t.YNc(9,Un,1,1,"ng-template",null,6,t.W1O),t.qZA()()),2&e){const o=t.MAs(10);t.xp6(8),t.Q6J("dataSource",a.level_list)("pagination",!0)("columns",t.DdM(6,Ln))("display_column",t.DdM(7,Rn))("column_size",t.DdM(8,Nn))("template",t.VKq(9,En,o))}},dependencies:[V.o,$.C],encapsulation:2})}return i})();const lt={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",ct:"http://gionkunz.github.com/chartist-js/ct"},Dn=8,Zt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function ne(i,s){return"number"==typeof i?i+s:i}function At(i){if("string"==typeof i){const s=/^(\d+)\s*(.*)$/g.exec(i);return{value:s?+s[1]:0,unit:s?.[2]||void 0}}return{value:Number(i)}}function It(i){return String.fromCharCode(97+i%26)}const kt=2221e-19;function ct(i,s,n){return s/n.range*i}function In(i,s){const n=Math.pow(10,s||Dn);return Math.round(i*n)/n}function Yt(i,s,n,e){const a=(e-90)*Math.PI/180;return{x:i+n*Math.cos(a),y:s+n*Math.sin(a)}}function K(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var s=arguments.length,n=new Array(s>1?s-1:0),e=1;e<s;e++)n[e-1]=arguments[e];for(let a=0;a<n.length;a++){const o=n[a];for(const r in o){const l=o[r];i[r]="object"!=typeof l||null===l||l instanceof Array?l:K(i[r],l)}}return i}const ut=i=>i;function Ct(i,s){return Array.from({length:i},s?(n,e)=>s(e):()=>{})}const jn=(i,s)=>i+(s||0);function A(i,s){return null!==i&&"object"==typeof i&&Reflect.has(i,s)}function pt(i){return null!==i&&isFinite(i)}function se(i){return!i&&0!==i}function st(i){return pt(i)?Number(i):void 0}function ae(i,s){const n=Array.isArray(i)?i[s]:A(i,"data")?i.data[s]:null;return A(n,"meta")?n.meta:void 0}function oe(i){return null==i||"number"==typeof i&&isNaN(i)}function Mt(i){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";return function Jn(i){return"object"==typeof i&&null!==i&&(Reflect.has(i,"x")||Reflect.has(i,"y"))}(i)&&A(i,s)?st(i[s]):st(i)}function jt(i){let a,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,e=arguments.length>3?arguments[3]:void 0;const o={labels:(i.labels||[]).slice(),series:Xn(i.series,n,e)},r=o.labels.length;return function qn(i){return!!Array.isArray(i)&&i.every(Array.isArray)}(o.series)?(a=Math.max(r,...o.series.map(l=>l.length)),o.series.forEach(l=>{l.push(...Ct(Math.max(0,a-l.length)))})):a=o.series.length,o.labels.push(...Ct(Math.max(0,a-r),()=>"")),s&&function Qn(i){var s;null===(s=i.labels)||void 0===s||s.reverse(),i.series.reverse();for(const n of i.series)A(n,"data")?n.data.reverse():Array.isArray(n)&&n.reverse()}(o),o}function re(i,s){if(!oe(i))return s?function Fn(i,s){let n,e;if("object"!=typeof i){const a=st(i);"x"===s?n=a:e=a}else A(i,"x")&&(n=st(i.x)),A(i,"y")&&(e=st(i.y));if(void 0!==n||void 0!==e)return{x:n,y:e}}(i,s):st(i)}function Bt(i,s){return Array.isArray(i)?i.map(n=>A(n,"value")?re(n.value,s):re(n,s)):Bt(i.data,s)}function Xn(i,s,n){if(function Pn(i){return Array.isArray(i)&&i.every(s=>Array.isArray(s)||A(s,"data"))}(i))return i.map(a=>Bt(a,s));const e=Bt(i,s);return n?e.map(a=>[a]):e}function dt(i){let s="";return null==i?i:(s="number"==typeof i?""+i:"object"==typeof i?JSON.stringify({data:i}):String(i),Object.keys(Zt).reduce((n,e)=>n.replaceAll(e,Zt[e]),s))}class Vn{call(s,n){return this.svgElements.forEach(e=>Reflect.apply(e[s],e,n)),this}attr(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("attr",n)}elem(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("elem",n)}root(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("root",n)}getNode(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("getNode",n)}foreignObject(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("foreignObject",n)}text(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("text",n)}empty(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("empty",n)}remove(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("remove",n)}addClass(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("addClass",n)}removeClass(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("removeClass",n)}removeAllClasses(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("removeAllClasses",n)}animate(){for(var s=arguments.length,n=new Array(s),e=0;e<s;e++)n[e]=arguments[e];return this.call("animate",n)}constructor(s){this.svgElements=[];for(let n=0;n<s.length;n++)this.svgElements.push(new pe(s[n]))}}const ce={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]};function ue(i,s,n){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;const{easing:o,...r}=n,l={};let d,c;o&&(d=Array.isArray(o)?o:ce[o]),r.begin=ne(r.begin,"ms"),r.dur=ne(r.dur,"ms"),d&&(r.calcMode="spline",r.keySplines=d.join(" "),r.keyTimes="0;1"),e&&(r.fill="freeze",l[s]=r.from,i.attr(l),c=At(r.begin||0).value,r.begin="indefinite");const u=i.elem("animate",{attributeName:s,...r});e&&setTimeout(()=>{try{u._node.beginElement()}catch{l[s]=r.to,i.attr(l),u.remove()}},c);const g=u.getNode();a&&g.addEventListener("beginEvent",()=>a.emit("animationBegin",{element:i,animate:g,params:n})),g.addEventListener("endEvent",()=>{a&&a.emit("animationEnd",{element:i,animate:g,params:n}),e&&(l[s]=r.to,i.attr(l),u.remove())})}let pe=(()=>{class i{attr(n,e){return"string"==typeof n?e?this._node.getAttributeNS(e,n):this._node.getAttribute(n):(Object.keys(n).forEach(a=>{if(void 0!==n[a])if(-1!==a.indexOf(":")){const o=a.split(":");this._node.setAttributeNS(lt[o[0]],a,String(n[a]))}else this._node.setAttribute(a,String(n[a]))}),this)}elem(n,e,a){return new i(n,e,a,this,arguments.length>3&&void 0!==arguments[3]&&arguments[3])}parent(){return this._node.parentNode instanceof SVGElement?new i(this._node.parentNode):null}root(){let n=this._node;for(;"svg"!==n.nodeName&&n.parentElement;)n=n.parentElement;return new i(n)}querySelector(n){const e=this._node.querySelector(n);return e?new i(e):null}querySelectorAll(n){const e=this._node.querySelectorAll(n);return new Vn(e)}getNode(){return this._node}foreignObject(n,e,a){let r,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"==typeof n){const d=document.createElement("div");d.innerHTML=n,r=d.firstChild}else r=n;r instanceof Element&&r.setAttribute("xmlns",lt.xmlns);const l=this.elem("foreignObject",e,a,o);return l._node.appendChild(r),l}text(n){return this._node.appendChild(document.createTextNode(n)),this}empty(){for(;this._node.firstChild;)this._node.removeChild(this._node.firstChild);return this}remove(){var n;return null===(n=this._node.parentNode)||void 0===n||n.removeChild(this._node),this.parent()}replace(n){var e;return null===(e=this._node.parentNode)||void 0===e||e.replaceChild(n._node,this._node),n}append(n){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this._node.firstChild?this._node.insertBefore(n._node,this._node.firstChild):this._node.appendChild(n._node),this}classes(){const n=this._node.getAttribute("class");return n?n.trim().split(/\s+/):[]}addClass(n){return this._node.setAttribute("class",this.classes().concat(n.trim().split(/\s+/)).filter(function(e,a,o){return o.indexOf(e)===a}).join(" ")),this}removeClass(n){const e=n.trim().split(/\s+/);return this._node.setAttribute("class",this.classes().filter(a=>-1===e.indexOf(a)).join(" ")),this}removeAllClasses(){return this._node.setAttribute("class",""),this}height(){return this._node.getBoundingClientRect().height}width(){return this._node.getBoundingClientRect().width}animate(n){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2?arguments[2]:void 0;return Object.keys(n).forEach(o=>{const r=n[o];Array.isArray(r)?r.forEach(l=>ue(this,o,l,!1,a)):ue(this,o,r,e,a)}),this}constructor(n,e,a,o,r=!1){n instanceof Element?this._node=n:(this._node=document.createElementNS(lt.svg,n),"svg"===n&&this.attr({"xmlns:ct":lt.ct})),e&&this.attr(e),a&&this.addClass(a),o&&(r&&o._node.firstChild?o._node.insertBefore(this._node,o._node.firstChild):o._node.appendChild(this._node))}}return i.Easing=ce,i})();function qt(i){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"100%",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"100%",e=arguments.length>3?arguments[3]:void 0;Array.from(i.querySelectorAll("svg")).filter(o=>o.getAttributeNS(lt.xmlns,"ct")).forEach(o=>i.removeChild(o));const a=new pe("svg").attr({width:s,height:n}).attr({style:"width: ".concat(s,"; height: ").concat(n,";")});return e&&a.addClass(e),i.appendChild(a.getNode()),a}function Pt(i,s){var n,e,a,o;const r=!(!s.axisX&&!s.axisY),l=(null===(n=s.axisY)||void 0===n?void 0:n.offset)||0,d=(null===(e=s.axisX)||void 0===e?void 0:e.offset)||0,c=null===(a=s.axisY)||void 0===a?void 0:a.position,u=null===(o=s.axisX)||void 0===o?void 0:o.position;let g=i.width()||At(s.width).value||0,p=i.height()||At(s.height).value||0;const h=function Gn(i){return"number"==typeof i?{top:i,right:i,bottom:i,left:i}:void 0===i?{top:0,right:0,bottom:0,left:0}:{top:"number"==typeof i.top?i.top:0,right:"number"==typeof i.right?i.right:0,bottom:"number"==typeof i.bottom?i.bottom:0,left:"number"==typeof i.left?i.left:0}}(s.chartPadding);g=Math.max(g,l+h.left+h.right),p=Math.max(p,d+h.top+h.bottom);const m={x1:0,x2:0,y1:0,y2:0,padding:h,width(){return this.x2-this.x1},height(){return this.y1-this.y2}};return r?("start"===u?(m.y2=h.top+d,m.y1=Math.max(p-h.bottom,m.y2+1)):(m.y2=h.top,m.y1=Math.max(p-h.bottom-d,m.y2+1)),"start"===c?(m.x1=h.left+l,m.x2=Math.max(g-h.right,m.x1+1)):(m.x1=h.left,m.x2=Math.max(g-h.right-l,m.x1+1))):(m.x1=h.left,m.x2=Math.max(g-h.right,m.x1+1),m.y2=h.top,m.y1=Math.max(p-h.bottom,m.y2+1)),m}function me(i,s,n){let e;const a=[];function o(l){const d=e;e=K({},i),s&&s.forEach(c=>{window.matchMedia(c[0]).matches&&(e=K(e,c[1]))}),n&&l&&n.emit("optionsChanged",{previousOptions:d,currentOptions:e})}if(!window.matchMedia)throw new Error("window.matchMedia not found! Make sure you're using a polyfill.");return s&&s.forEach(l=>{const d=window.matchMedia(l[0]);d.addEventListener("change",o),a.push(d)}),o(),{removeMediaQueryListeners:function r(){a.forEach(l=>l.removeEventListener("change",o))},getCurrentOptions:()=>e}}const Jt={m:["x","y"],l:["x","y"],c:["x1","y1","x2","y2","x","y"],a:["rx","ry","xAr","lAf","sf","x","y"]},$n={accuracy:3};function Ot(i,s,n,e,a,o){const r={command:a?i.toLowerCase():i.toUpperCase(),...s,...o?{data:o}:{}};n.splice(e,0,r)}function Qt(i,s){i.forEach((n,e)=>{Jt[n.command.toLowerCase()].forEach((a,o)=>{s(n,a,e,o,i)})})}class R{static join(s){const a=new R(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2?arguments[2]:void 0);for(let o=0;o<s.length;o++){const r=s[o];for(let l=0;l<r.pathElements.length;l++)a.pathElements.push(r.pathElements[l])}return a}position(s){return void 0!==s?(this.pos=Math.max(0,Math.min(this.pathElements.length,s)),this):this.pos}remove(s){return this.pathElements.splice(this.pos,s),this}move(s,n){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;return Ot("M",{x:+s,y:+n},this.pathElements,this.pos++,e,a),this}line(s,n){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;return Ot("L",{x:+s,y:+n},this.pathElements,this.pos++,e,a),this}curve(s,n,e,a,o,r){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0;return Ot("C",{x1:+s,y1:+n,x2:+e,y2:+a,x:+o,y:+r},this.pathElements,this.pos++,l,d),this}arc(s,n,e,a,o,r,l){let d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8?arguments[8]:void 0;return Ot("A",{rx:s,ry:n,xAr:e,lAf:a,sf:o,x:r,y:l},this.pathElements,this.pos++,d,c),this}parse(s){const n=s.replace(/([A-Za-z])(-?[0-9])/g,"$1 $2").replace(/([0-9])([A-Za-z])/g,"$1 $2").split(/[\s,]+/).reduce((a,o)=>(o.match(/[A-Za-z]/)&&a.push([]),a[a.length-1].push(o),a),[]);"Z"===n[n.length-1][0].toUpperCase()&&n.pop();const e=n.map(a=>{const o=a.shift(),r=Jt[o.toLowerCase()];return{command:o,...r.reduce((l,d,c)=>(l[d]=+a[c],l),{})}});return this.pathElements.splice(this.pos,0,...e),this.pos+=e.length,this}stringify(){const s=Math.pow(10,this.options.accuracy);return this.pathElements.reduce((n,e)=>{const a=Jt[e.command.toLowerCase()].map(o=>{const r=e[o];return this.options.accuracy?Math.round(r*s)/s:r});return n+e.command+a.join(",")},"")+(this.close?"Z":"")}scale(s,n){return Qt(this.pathElements,(e,a)=>{e[a]*="x"===a[0]?s:n}),this}translate(s,n){return Qt(this.pathElements,(e,a)=>{e[a]+="x"===a[0]?s:n}),this}transform(s){return Qt(this.pathElements,(n,e,a,o,r)=>{const l=s(n,e,a,o,r);(l||0===l)&&(n[e]=l)}),this}clone(){const n=new R(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.close);return n.pos=this.pos,n.pathElements=this.pathElements.slice().map(e=>({...e})),n.options={...this.options},n}splitByCommand(s){const n=[new R];return this.pathElements.forEach(e=>{e.command===s.toUpperCase()&&0!==n[n.length-1].pathElements.length&&n.push(new R),n[n.length-1].pathElements.push(e)}),n}constructor(s=!1,n){this.close=s,this.pathElements=[],this.pos=0,this.options={...$n,...n}}}function it(i){const s={fillHoles:!1,...i};return function(e,a){const o=new R;let r=!0;for(let l=0;l<e.length;l+=2){const d=e[l],c=e[l+1],u=a[l/2];void 0!==Mt(u.value)?(r?o.move(d,c,!1,u):o.line(d,c,!1,u),r=!1):s.fillHoles||(r=!0)}return o}}function he(i){const s={fillHoles:!1,...i};return function n(e,a){const o=function le(i,s,n){const e={increasingX:!1,fillHoles:!1,...n},a=[];let o=!0;for(let r=0;r<i.length;r+=2)void 0===Mt(s[r/2].value)?e.fillHoles||(o=!0):(e.increasingX&&r>=2&&i[r]<=i[r-2]&&(o=!0),o&&(a.push({pathCoordinates:[],valueData:[]}),o=!1),a[a.length-1].pathCoordinates.push(i[r],i[r+1]),a[a.length-1].valueData.push(s[r/2]));return a}(e,a,{fillHoles:s.fillHoles,increasingX:!0});if(o.length){if(o.length>1)return R.join(o.map(r=>n(r.pathCoordinates,r.valueData)));{if(a=o[0].valueData,(e=o[0].pathCoordinates).length<=4)return it()(e,a);const r=[],l=[],d=e.length/2,c=[],u=[],g=[],p=[];for(let m=0;m<d;m++)r[m]=e[2*m],l[m]=e[2*m+1];for(let m=0;m<d-1;m++)g[m]=l[m+1]-l[m],p[m]=r[m+1]-r[m],u[m]=g[m]/p[m];c[0]=u[0],c[d-1]=u[d-2];for(let m=1;m<d-1;m++)0===u[m]||0===u[m-1]||u[m-1]>0!=u[m]>0?c[m]=0:(c[m]=3*(p[m-1]+p[m])/((2*p[m]+p[m-1])/u[m-1]+(p[m]+2*p[m-1])/u[m]),isFinite(c[m])||(c[m]=0));const h=(new R).move(r[0],l[0],!1,a[0]);for(let m=0;m<d-1;m++)h.curve(r[m]+p[m]/3,l[m]+c[m]*p[m]/3,r[m+1]-p[m]/3,l[m+1]-c[m+1]*p[m]/3,r[m+1],l[m+1],!1,a[m+1]);return h}}return it()([],[])}}class ns{on(s,n){const{allListeners:e,listeners:a}=this;"*"===s?e.add(n):(a.has(s)||a.set(s,new Set),a.get(s).add(n))}off(s,n){const{allListeners:e,listeners:a}=this;if("*"===s)n?e.delete(n):e.clear();else if(a.has(s)){const o=a.get(s);n?o.delete(n):o.clear(),o.size||a.delete(s)}}emit(s,n){const{allListeners:e,listeners:a}=this;a.has(s)&&a.get(s).forEach(o=>o(n)),e.forEach(o=>o(s,n))}constructor(){this.listeners=new Map,this.allListeners=new Set}}const Ft=new WeakMap;class ge{update(s,n){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var a;return s&&(this.data=s||{},this.data.labels=this.data.labels||[],this.data.series=this.data.series||[],this.eventEmitter.emit("data",{type:"update",data:this.data})),n&&(this.options=K({},e?this.options:this.defaultOptions,n),!this.initializeTimeoutId)&&(null===(a=this.optionsProvider)||void 0===a||a.removeMediaQueryListeners(),this.optionsProvider=me(this.options,this.responsiveOptions,this.eventEmitter)),!this.initializeTimeoutId&&this.optionsProvider&&this.createChart(this.optionsProvider.getCurrentOptions()),this}detach(){var s;return this.initializeTimeoutId?window.clearTimeout(this.initializeTimeoutId):(window.removeEventListener("resize",this.resizeListener),null===(s=this.optionsProvider)||void 0===s||s.removeMediaQueryListeners()),Ft.delete(this.container),this}on(s,n){return this.eventEmitter.on(s,n),this}off(s,n){return this.eventEmitter.off(s,n),this}initialize(){window.addEventListener("resize",this.resizeListener),this.optionsProvider=me(this.options,this.responsiveOptions,this.eventEmitter),this.eventEmitter.on("optionsChanged",()=>this.update()),this.options.plugins&&this.options.plugins.forEach(s=>{Array.isArray(s)?s[0](this,s[1]):s(this)}),this.eventEmitter.emit("data",{type:"initial",data:this.data}),this.createChart(this.optionsProvider.getCurrentOptions()),this.initializeTimeoutId=null}constructor(s,n,e,a,o){this.data=n,this.defaultOptions=e,this.options=a,this.responsiveOptions=o,this.eventEmitter=new ns,this.resizeListener=()=>this.update(),this.initializeTimeoutId=setTimeout(()=>this.initialize(),0);const r="string"==typeof s?document.querySelector(s):s;if(!r)throw new Error("Target element is not found");this.container=r;const l=Ft.get(r);l&&l.detach(),Ft.set(r,this)}}const O={x:{pos:"x",len:"width",dir:"horizontal",rectStart:"x1",rectEnd:"x2",rectOffset:"y2"},y:{pos:"y",len:"height",dir:"vertical",rectStart:"y2",rectEnd:"y1",rectOffset:"x1"}};class fe{createGridAndLabels(s,n,e,a){const o="x"===this.units.pos?e.axisX:e.axisY,r=this.ticks.map((d,c)=>this.projectValue(d,c)),l=this.ticks.map(o.labelInterpolationFnc);r.forEach((d,c)=>{const u=l[c],g={x:0,y:0};let p;p=r[c+1]?r[c+1]-d:Math.max(this.axisLength-d,this.axisLength/this.ticks.length),(""===u||!se(u))&&("x"===this.units.pos?(d=this.chartRect.x1+d,g.x=e.axisX.labelOffset.x,g.y="start"===e.axisX.position?this.chartRect.padding.top+e.axisX.labelOffset.y+5:this.chartRect.y1+e.axisX.labelOffset.y+5):(d=this.chartRect.y1-d,g.y=e.axisY.labelOffset.y-p,g.x="start"===e.axisY.position?this.chartRect.padding.left+e.axisY.labelOffset.x:this.chartRect.x2+e.axisY.labelOffset.x+10),o.showGrid&&function Wn(i,s,n,e,a,o,r,l){const d={["".concat(n.units.pos,"1")]:i,["".concat(n.units.pos,"2")]:i,["".concat(n.counterUnits.pos,"1")]:e,["".concat(n.counterUnits.pos,"2")]:e+a},c=o.elem("line",d,r.join(" "));l.emit("draw",{type:"grid",axis:n,index:s,group:o,element:c,...d})}(d,c,this,this.gridOffset,this.chartRect[this.counterUnits.len](),s,[e.classNames.grid,e.classNames[this.units.dir]],a),o.showLabel&&function Hn(i,s,n,e,a,o,r,l,d,c){const u={[a.units.pos]:i+r[a.units.pos],[a.counterUnits.pos]:r[a.counterUnits.pos],[a.units.len]:s,[a.counterUnits.len]:Math.max(0,o-10)},g=Math.round(u[a.units.len]),p=Math.round(u[a.counterUnits.len]),h=document.createElement("span");h.className=d.join(" "),h.style[a.units.len]=g+"px",h.style[a.counterUnits.len]=p+"px",h.textContent=String(e);const m=l.foreignObject(h,{style:"overflow: visible;",...u});c.emit("draw",{type:"label",axis:a,index:n,group:l,element:m,text:e,...u})}(d,p,c,u,this,o.offset,g,n,[e.classNames.label,e.classNames[this.units.dir],"start"===o.position?e.classNames[o.position]:e.classNames.end],a))})}constructor(s,n,e){this.units=s,this.chartRect=n,this.ticks=e,this.counterUnits=s===O.x?O.y:O.x,this.axisLength=n[this.units.rectEnd]-n[this.units.rectStart],this.gridOffset=n[this.units.rectOffset]}}class Xt extends fe{projectValue(s){const n=Number(Mt(s,this.units.pos));return this.axisLength*(n-this.bounds.min)/this.bounds.range}constructor(s,n,e,a){const o=a.highLow||function Tt(i,s,n){const e={high:void 0===(s={...s,...n?"x"===n?s.axisX:s.axisY:{}}).high?-Number.MAX_VALUE:+s.high,low:void 0===s.low?Number.MAX_VALUE:+s.low},a=void 0===s.high,o=void 0===s.low;return(a||o)&&function r(l){if(!oe(l))if(Array.isArray(l))for(let d=0;d<l.length;d++)r(l[d]);else{const d=Number(n&&A(l,n)?l[n]:l);a&&d>e.high&&(e.high=d),o&&d<e.low&&(e.low=d)}}(i),(s.referenceValue||0===s.referenceValue)&&(e.high=Math.max(s.referenceValue,e.high),e.low=Math.min(s.referenceValue,e.low)),e.high<=e.low&&(0===e.low?e.high=1:e.low<0?e.high=0:(e.high>0||(e.high=1),e.low=0)),e}(n,a,s.pos),r=function Yn(i,s,n){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const a={high:s.high,low:s.low,valueRange:0,oom:0,step:0,min:0,max:0,range:0,numberOfSteps:0,values:[]};a.valueRange=a.high-a.low,a.oom=function zn(i){return Math.floor(Math.log(Math.abs(i))/Math.LN10)}(a.valueRange),a.step=Math.pow(10,a.oom),a.min=Math.floor(a.low/a.step)*a.step,a.max=Math.ceil(a.high/a.step)*a.step,a.range=a.max-a.min,a.numberOfSteps=Math.round(a.range/a.step);const r=ct(i,a.step,a)<n,l=e?function kn(i){if(1===i)return i;function s(r,l){return r%l==0?l:s(l,r%l)}function n(r){return r*r+1}let o,e=2,a=2;if(i%2==0)return 2;do{e=n(e)%i,a=n(n(a))%i,o=s(Math.abs(e-a),i)}while(1===o);return o}(a.range):0;if(e&&ct(i,1,a)>=n)a.step=1;else if(e&&l<a.step&&ct(i,l,a)>=n)a.step=l;else{let p=0;for(;;){if(r&&ct(i,a.step,a)<=n)a.step*=2;else{if(r||!(ct(i,a.step/2,a)>=n))break;if(a.step/=2,e&&a.step%1!=0){a.step*=2;break}}if(p++>1e3)throw new Error("Exceeded maximum number of iterations while optimizing scale step!")}}function d(p,h){return p===(p+=h)&&(p*=1+(h>0?kt:-kt)),p}a.step=Math.max(a.step,kt);let c=a.min,u=a.max;for(;c+a.step<=a.low;)c=d(c,a.step);for(;u-a.step>=a.high;)u=d(u,-a.step);a.min=c,a.max=u,a.range=a.max-a.min;const g=[];for(let p=a.min;p<=a.max;p=d(p,a.step)){const h=In(p);h!==g[g.length-1]&&g.push(h)}return a.values=g,a}(e[s.rectEnd]-e[s.rectStart],o,a.scaleMinSpace||20,a.onlyInteger),l={min:r.min,max:r.max};super(s,e,r.values),this.bounds=r,this.range=l}}class Ut extends fe{projectValue(s,n){return this.stepLength*n}constructor(s,n,e,a){const o=a.ticks||[];super(s,e,o);const r=Math.max(1,o.length-(a.stretch?1:0));this.stepLength=this.axisLength/r,this.stretch=!!a.stretch}}function mt(i,s,n){var e;if(A(i,"name")&&i.name&&null!==(e=s.series)&&void 0!==e&&e[i.name]){const o=(s?.series[i.name])[n];return void 0===o?s[n]:o}return s[n]}const _e={axisX:{offset:30,position:"end",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:ut,type:void 0},axisY:{offset:40,position:"start",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:ut,type:void 0,scaleMinSpace:20,onlyInteger:!1},width:void 0,height:void 0,showLine:!0,showPoint:!0,showArea:!1,areaBase:0,lineSmooth:!0,showGridBackground:!1,low:void 0,high:void 0,chartPadding:{top:15,right:15,bottom:5,left:10},fullWidth:!1,reverseData:!1,classNames:{chart:"ct-chart-line",label:"ct-label",labelGroup:"ct-labels",series:"ct-series",line:"ct-line",point:"ct-point",area:"ct-area",grid:"ct-grid",gridGroup:"ct-grids",gridBackground:"ct-grid-background",vertical:"ct-vertical",horizontal:"ct-horizontal",start:"ct-start",end:"ct-end"}};class ss extends ge{createChart(s){const{data:n}=this,e=jt(n,s.reverseData,!0),a=qt(this.container,s.width,s.height,s.classNames.chart);this.svg=a;const o=a.elem("g").addClass(s.classNames.gridGroup),r=a.elem("g"),l=a.elem("g").addClass(s.classNames.labelGroup),d=Pt(a,s);let c,u;c=void 0===s.axisX.type?new Ut(O.x,e.series,d,{...s.axisX,ticks:e.labels,stretch:s.fullWidth}):new s.axisX.type(O.x,e.series,d,s.axisX),u=void 0===s.axisY.type?new Xt(O.y,e.series,d,{...s.axisY,high:pt(s.high)?s.high:s.axisY.high,low:pt(s.low)?s.low:s.axisY.low}):new s.axisY.type(O.y,e.series,d,s.axisY),c.createGridAndLabels(o,l,s,this.eventEmitter),u.createGridAndLabels(o,l,s,this.eventEmitter),s.showGridBackground&&function de(i,s,n,e){const a=i.elem("rect",{x:s.x1,y:s.y2,width:s.width(),height:s.height()},n,!0);e.emit("draw",{type:"gridBackground",group:i,element:a})}(o,d,s.classNames.gridBackground,this.eventEmitter),function ie(i,s){let e=0;i[arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"reduceRight":"reduce"]((a,o,r)=>s(o,e++,r),void 0)}(n.series,(g,p)=>{const h=r.elem("g"),m=A(g,"name")&&g.name,y=A(g,"className")&&g.className,v=A(g,"meta")?g.meta:void 0;m&&h.attr({"ct:series-name":m}),v&&h.attr({"ct:meta":dt(v)}),h.addClass([s.classNames.series,y||"".concat(s.classNames.series,"-").concat(It(p))].join(" "));const U=[],N=[];e.series[p].forEach((_,b)=>{const C={x:d.x1+c.projectValue(_,b,e.series[p]),y:d.y1-u.projectValue(_,b,e.series[p])};U.push(C.x,C.y),N.push({value:_,valueIndex:b,meta:ae(g,b)})});const D={lineSmooth:mt(g,s,"lineSmooth"),showPoint:mt(g,s,"showPoint"),showLine:mt(g,s,"showLine"),showArea:mt(g,s,"showArea"),areaBase:mt(g,s,"areaBase")};let Y;Y="function"==typeof D.lineSmooth?D.lineSmooth:D.lineSmooth?he():it();const M=Y(U,N);if(D.showPoint&&M.pathElements.forEach(_=>{const{data:b}=_,C=h.elem("line",{x1:_.x,y1:_.y,x2:_.x+.01,y2:_.y},s.classNames.point);if(b){let T,I;A(b.value,"x")&&(T=b.value.x),A(b.value,"y")&&(I=b.value.y),C.attr({"ct:value":[T,I].filter(pt).join(","),"ct:meta":dt(b.meta)})}this.eventEmitter.emit("draw",{type:"point",value:b?.value,index:b?.valueIndex||0,meta:b?.meta,series:g,seriesIndex:p,axisX:c,axisY:u,group:h,element:C,x:_.x,y:_.y,chartRect:d})}),D.showLine){const _=h.elem("path",{d:M.stringify()},s.classNames.line,!0);this.eventEmitter.emit("draw",{type:"line",values:e.series[p],path:M.clone(),chartRect:d,index:p,series:g,seriesIndex:p,meta:v,axisX:c,axisY:u,group:h,element:_})}if(D.showArea&&u.range){const _=Math.max(Math.min(D.areaBase,u.range.max),u.range.min),b=d.y1-u.projectValue(_);M.splitByCommand("M").filter(C=>C.pathElements.length>1).map(C=>{const T=C.pathElements[0],I=C.pathElements[C.pathElements.length-1];return C.clone(!0).position(0).remove(1).move(T.x,b).line(T.x,T.y).position(C.pathElements.length+1).line(I.x,b)}).forEach(C=>{const T=h.elem("path",{d:C.stringify()},s.classNames.area,!0);this.eventEmitter.emit("draw",{type:"area",values:e.series[p],path:C.clone(),series:g,seriesIndex:p,axisX:c,axisY:u,chartRect:d,index:p,group:h,element:T,meta:v})})}},s.reverseData),this.eventEmitter.emit("created",{chartRect:d,axisX:c,axisY:u,svg:a,options:s})}constructor(s,n,e,a){super(s,n,_e,K({},_e,e),a),this.data=n}}const xe={width:void 0,height:void 0,chartPadding:5,classNames:{chartPie:"ct-chart-pie",chartDonut:"ct-chart-donut",series:"ct-series",slicePie:"ct-slice-pie",sliceDonut:"ct-slice-donut",label:"ct-label"},startAngle:0,total:void 0,donut:!1,donutWidth:60,showLabel:!0,labelOffset:0,labelPosition:"inside",labelInterpolationFnc:ut,labelDirection:"neutral",ignoreEmptyValues:!1};function as(i,s,n){const e=s.x>i.x;return e&&"explode"===n||!e&&"implode"===n?"start":e&&"implode"===n||!e&&"explode"===n?"end":"middle"}class os extends ge{createChart(s){const{data:n}=this,e=jt(n),a=[];let o,r,l=s.startAngle;const d=qt(this.container,s.width,s.height,s.donut?s.classNames.chartDonut:s.classNames.chartPie);this.svg=d;const c=Pt(d,s);let u=Math.min(c.width()/2,c.height()/2);const g=s.total||e.series.reduce(jn,0),p=At(s.donutWidth);"%"===p.unit&&(p.value*=u/100),u-=s.donut?p.value/2:0,r="outside"===s.labelPosition||s.donut?u:"center"===s.labelPosition?0:u/2,s.labelOffset&&(r+=s.labelOffset);const h={x:c.x1+c.width()/2,y:c.y2+c.height()/2},m=1===n.series.filter(y=>A(y,"value")?0!==y.value:0!==y).length;n.series.forEach((y,v)=>a[v]=d.elem("g")),s.showLabel&&(o=d.elem("g")),n.series.forEach((y,v)=>{var U,N;if(0===e.series[v]&&s.ignoreEmptyValues)return;const D=A(y,"name")&&y.name,Y=A(y,"className")&&y.className,M=A(y,"meta")?y.meta:void 0;D&&a[v].attr({"ct:series-name":D}),a[v].addClass([null===(U=s.classNames)||void 0===U?void 0:U.series,Y||"".concat(null===(N=s.classNames)||void 0===N?void 0:N.series,"-").concat(It(v))].join(" "));let _=g>0?l+e.series[v]/g*360:0;const b=Math.max(0,l-(0===v||m?0:.2));_-b>=359.99&&(_=b+359.99);const C=Yt(h.x,h.y,u,b),T=Yt(h.x,h.y,u,_),I=new R(!s.donut).move(T.x,T.y).arc(u,u,0,+(_-l>180),0,C.x,C.y);s.donut||I.line(h.x,h.y);const ht=a[v].elem("path",{d:I.stringify()},s.donut?s.classNames.sliceDonut:s.classNames.slicePie);if(ht.attr({"ct:value":e.series[v],"ct:meta":dt(M)}),s.donut&&ht.attr({style:"stroke-width: "+p.value+"px"}),this.eventEmitter.emit("draw",{type:"slice",value:e.series[v],totalDataSum:g,index:v,meta:M,series:y,group:a[v],element:ht,path:I.clone(),center:h,radius:u,startAngle:l,endAngle:_,chartRect:c}),s.showLabel){let P,j;P=1===n.series.length?{x:h.x,y:h.y}:Yt(h.x,h.y,r,l+(_-l)/2),j=e.labels&&!se(e.labels[v])?e.labels[v]:e.series[v];const E=s.labelInterpolationFnc(j,v);if(E||0===E){const at=o.elem("text",{dx:P.x,dy:P.y,"text-anchor":as(h,P,s.labelDirection)},s.classNames.label).text(String(E));this.eventEmitter.emit("draw",{type:"label",index:v,group:o,element:at,text:""+E,chartRect:c,series:y,meta:M,...P})}}l=_}),this.eventEmitter.emit("created",{chartRect:c,svg:d,options:s})}constructor(s,n,e,a){super(s,n,xe,K({},xe,e),a),this.data=n}}let rs=(()=>{class i extends x.cx{constructor(n,e){super(),this._state=n,this._org=e,this.day_list=this._state.day_list,this.stats=(0,Q.aj)([this._state.options,this._state.counts])}ngOnInit(){this.subscription("day_list",this.day_list.subscribe(n=>this.updateDailyChart(n))),this.subscription("stats",this.stats.subscribe(([n,e])=>this.updateLevelChart(n,e)))}updateDailyChart(n){const e={labels:n.map(a=>(0,G.Z)(a.date,"dd MMM")),series:[n.map(a=>a.utilisation)]};this._day_chart=new ss("#day-chart",e)}updateLevelChart(n,e){let{zones:a}=n||{};a.includes("All")&&(a=this._org.levels.filter(r=>r.parent_id===this._org.building.id).map(r=>r.id));const o={labels:(a||[]).map(r=>{const l=this._org.levelWithID([r]);return l?.display_name||l.name||""}),series:(a||[]).map(r=>e[r])};this._level_chart=new os("#level-chart",o)}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S),t.Y36(J.w7))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["report-desks-charts"]],features:[t.qOj],decls:11,vars:0,consts:[[1,"flex","items-center","space-x-4","w-full","px-4"],[1,"bg-base-100","rounded","shadow","flex-1"],[1,"border-b","border-base-200","p-4","text-xl","font-bold"],["id","day-chart",1,"ct-chart","ct-octave"],["util_chart",""],["id","level-chart",1,"ct-chart","ct-octave"],["level_chart",""]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3," Daily Utilisation "),t.qZA(),t._UZ(4,"div",3,4),t.qZA(),t.TgZ(6,"div",1)(7,"div",2),t._uU(8," Level Utilisation "),t.qZA(),t._UZ(9,"div",5,6),t.qZA()())},styles:["[_nghost-%COMP%]{display:block}\n\n/*# sourceMappingURL=report-desks-charts.component.ts-angular-inline--137.css.map*/"]})}return i})();const ls=["report-desks",""];function cs(i,s){if(1&i&&(t.ynx(0),t.TgZ(1,"div",4)(2,"div",5)(3,"h3"),t._uU(4,"Total Bookings"),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"div",5)(9,"h3"),t._uU(10,"Utilisation"),t.qZA(),t.TgZ(11,"p"),t._uU(12),t.ALo(13,"async"),t.qZA()()(),t._UZ(14,"report-desks-charts")(15,"report-desks-overall-list")(16,"report-desks-levels-list"),t.BQk()),2&i){const n=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,2,n.total_count)||0),t.xp6(6),t.hij("",t.lcZ(13,4,n.utilisation)||0,"%")}}function us(i,s){if(1&i&&(t.ynx(0),t.YNc(1,cs,17,6,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&i){const n=t.oxw(),e=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",e)}}function ps(i,s){1&i&&(t.TgZ(0,"div",6),t._UZ(1,"mat-spinner",7),t.TgZ(2,"p",8),t._uU(3,"Loading report data..."),t.qZA()()),2&i&&(t.xp6(1),t.Q6J("diameter",32))}function ds(i,s){1&i&&(t.TgZ(0,"div",6)(1,"p",8),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}let ms=(()=>{class i{constructor(n){this._state=n,this.total_count=this._state.stats.pipe((0,Z.U)(e=>e.count||0)),this.utilisation=this._state.stats.pipe((0,Z.U)(e=>(100*(e.utilisation||0)).toFixed(1))),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"desks"})}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["","report-desks",""]],attrs:ls,decls:8,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"m-4","p-4","rounded","bg-base-100","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,a){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,us,3,4,"ng-container",1),t.ALo(3,"async"),t.YNc(4,ps,4,1,"ng-template",null,2,t.W1O)(6,ds,3,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const o=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,a.loading))("ngIfElse",o)}},dependencies:[w.O5,wt.Ou,bt,On,Sn,rs,w.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}\n\n/*# sourceMappingURL=report-desks.component.ts-angular-inline--132.css.map*/"]})}return i})();var ye=f(1311);let Vt=(()=>{class i{constructor(n){this._reports=n,this.catering_orders=this._reports.bookings.pipe((0,Z.U)(e=>(0,x.xH)(e.filter(o=>o.extension_data?.catering?.length).map(o=>o.extension_data?.catering.map(r=>new ye.GX({...r,deliver_at:o.date,event:o})))).filter(o=>o).sort((o,r)=>o.event?.date-r.event?.date)),(0,q.d)(1)),this.catering_items=this.catering_orders.pipe((0,Z.U)(e=>{const a=[];for(const o of e)for(const r of o?.items||[]){const l=a.findIndex(d=>r.options_string===d.options_string);l>=0?r[l]=new ye.Ud({...r,quantity:r?.quantity+r[l]?.quantity}):a.push(r)}return a.sort((o,r)=>r.quantity-o.quantity)})),this.stats=(0,Q.aj)([this.catering_orders,this.catering_items]).pipe((0,Z.U)(([e,a])=>{const o=e.reduce((r,l)=>r+l.total_cost,0);return{order_count:e.length,unique_items:a.length,item_count:e.reduce((r,l)=>r+l.item_count,0),total_cost:o,avg_cost:o/e.length}}))}downloadOrders(){var n=this;return(0,z.Z)(function*(){const e=yield n.catering_orders.pipe((0,H.q)(1)).toPromise(),a=(0,x.o3)(e);return(0,x.Sv)("catering-orders.csv",a)})()}static#t=this.\u0275fac=function(e){return new(e||i)(t.LFG(S))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})(),hs=(()=>{class i{get code(){return this._org.currency_code}constructor(n,e){this._report=n,this._org=e,this.stats=this._report.stats}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(Vt),t.Y36(J.w7))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["catering-report-overall"]],decls:32,vars:21,consts:[[1,"bg-base-100","shadow","rounded","m-2","px-8","w-48","h-24","flex","flex-col","items-center","justify-center"],["count","",1,"text-3xl"],[1,""],["unique","",1,"text-3xl"],["items","",1,"text-3xl"],["total","",1,"text-3xl"],["average","",1,"text-3xl"]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"div",2),t._uU(5,"Orders"),t.qZA()(),t.TgZ(6,"div",0)(7,"div",3),t._uU(8),t.ALo(9,"async"),t.qZA(),t.TgZ(10,"div",2),t._uU(11,"Unique Items"),t.qZA()(),t.TgZ(12,"div",0)(13,"div",4),t._uU(14),t.ALo(15,"async"),t.qZA(),t.TgZ(16,"div",2),t._uU(17,"Ordered Items"),t.qZA()(),t.TgZ(18,"div",0)(19,"div",5),t._uU(20),t.ALo(21,"currency"),t.ALo(22,"async"),t.qZA(),t.TgZ(23,"div",2),t._uU(24,"Total"),t.qZA()(),t.TgZ(25,"div",0)(26,"div",6),t._uU(27),t.ALo(28,"currency"),t.ALo(29,"async"),t.qZA(),t.TgZ(30,"div",2),t._uU(31,"Order Average"),t.qZA()()),2&e){let o,r,l,d,c;t.xp6(2),t.hij(" ",(null==(o=t.lcZ(3,5,a.stats))?null:o.order_count)||"0"," "),t.xp6(6),t.hij(" ",(null==(r=t.lcZ(9,7,a.stats))?null:r.unique_items)||"0"," "),t.xp6(6),t.hij(" ",(null==(l=t.lcZ(15,9,a.stats))?null:l.item_count)||"0"," "),t.xp6(6),t.hij(" ",t.xi3(21,11,(null==(d=t.lcZ(22,14,a.stats))?null:d.total_cost)/100||0,a.code)," "),t.xp6(7),t.hij(" ",t.xi3(28,16,(null==(c=t.lcZ(29,19,a.stats))?null:c.avg_cost)/100||0,a.code)," ")}},dependencies:[w.Ov,w.H9],styles:["[_nghost-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;padding:.5rem}\n\n/*# sourceMappingURL=catering-report-overall.component.ts-angular-inline--136.css.map*/"]})}return i})();var Gt=f(702);function gs(i,s){if(1&i&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&i){const n=s.data,e=t.oxw();t.AsE(" ",t.lcZ(1,2,n)," at ",t.xi3(2,4,n,e.time_format)," ")}}function fs(i,s){if(1&i&&(t._uU(0),t.ALo(1,"currency")),2&i){const n=s.data,e=t.oxw();t.hij(" ",t.xi3(1,1,n/100,e.code)," ")}}const _s=()=>["deliver_at","item_count","total_cost"],vs=()=>["Date","Items","Total Cost"],xs=()=>["flex"],ys=(i,s)=>({deliver_at:i,total_cost:s});let ws=(()=>{class i{get code(){return this._org.currency_code}get time_format(){return this._settings.time_format}constructor(n,e,a){this._report=n,this._org=e,this._settings=a,this.orders=this._report.catering_orders,this.download=()=>this._report.downloadOrders()}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(Vt),t.Y36(J.w7),t.Y36(x.gb))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["catering-report-orders"]],decls:12,vars:12,consts:[[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-base-100","shadow","mx-auto","my-2"],[1,"border-b","border-base-200","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["matRipple-icon","","matTooltip","Download list",3,"click"],["empty","No orders for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination"],["date_state",""],["cost_state",""]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),t._uU(3,"Orders"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return a.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.YNc(8,gs,3,7,"ng-template",null,5,t.W1O)(10,fs,2,4,"ng-template",null,6,t.W1O),t.qZA()),2&e){const o=t.MAs(9),r=t.MAs(11);t.xp6(7),t.Q6J("dataSource",a.orders)("columns",t.DdM(6,_s))("display_column",t.DdM(7,vs))("column_size",t.DdM(8,xs))("template",t.WLB(9,ys,o,r))("pagination",!0)}},dependencies:[Gt.gM,V.o,$.C,w.H9,w.uU]})}return i})();function bs(i,s){if(1&i&&(t.TgZ(0,"span",7),t._uU(1),t.qZA()),2&i){const n=t.oxw().data,e=t.oxw();t.Q6J("matTooltip",e.options(n)),t.xp6(1),t.hij(" ",n.length," option(s) ")}}function Zs(i,s){1&i&&t.YNc(0,bs,2,2,"span",6),2&i&&t.Q6J("ngIf",s.data.length)}function As(i,s){if(1&i&&(t._uU(0),t.ALo(1,"currency")),2&i){const n=s.data,e=t.oxw();t.hij(" ",t.xi3(1,1,(n||0)/100,e.code)," ")}}const Cs=()=>["name","options","quantity","unit_price","total_cost"],Ms=()=>["Name","Options","Quantity","Unit Price","Total Cost"],Ts=()=>["flex"],Os=(i,s,n)=>({options:i,unit_price:s,total_cost:n});let Us=(()=>{class i{get code(){return this._org.currency_code}constructor(n,e){this._report=n,this._org=e,this.items=this._report.catering_items}options(n){return n.map(e=>e.name).join("\n")}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(Vt),t.Y36(J.w7))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["catering-report-items"]],decls:9,vars:13,consts:[[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-base-100","shadow","mx-auto","my-2"],[1,"border-b","border-base-200","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty","No orders for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination"],["option_state",""],["cost_state",""],["class","text-xs px-2 py-1 rounded bg-base-200",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-base-200",3,"matTooltip"]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),t._uU(3,"Ordered Items"),t.qZA()(),t._UZ(4,"custom-table",3),t.YNc(5,Zs,1,1,"ng-template",null,4,t.W1O)(7,As,2,4,"ng-template",null,5,t.W1O),t.qZA()),2&e){const o=t.MAs(6),r=t.MAs(8);t.xp6(4),t.Q6J("dataSource",a.items)("columns",t.DdM(6,Cs))("display_column",t.DdM(7,Ms))("column_size",t.DdM(8,Ts))("template",t.kEZ(9,Os,o,r,r))("pagination",!0)}},dependencies:[w.O5,Gt.gM,$.C,w.H9]})}return i})();function Ls(i,s){1&i&&(t.TgZ(0,"div",5),t._UZ(1,"catering-report-overall")(2,"catering-report-orders")(3,"catering-report-items"),t.qZA())}function Rs(i,s){if(1&i&&(t.ynx(0),t.YNc(1,Ls,4,0,"div",4),t.ALo(2,"async"),t.BQk()),2&i){const n=t.oxw(),e=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n.total_count))("ngIfElse",e)}}function Ns(i,s){1&i&&(t.TgZ(0,"div",6),t._UZ(1,"mat-spinner",7),t.TgZ(2,"p",8),t._uU(3,"Loading report data..."),t.qZA()()),2&i&&(t.xp6(1),t.Q6J("diameter",32))}function Es(i,s){1&i&&(t.TgZ(0,"div",6)(1,"p",8),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}let Ss=(()=>{class i{constructor(n){this._state=n,this.total_count=this._state.stats.pipe((0,Z.U)(e=>e.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(S))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["catering-report"]],decls:8,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["class","h-full w-full",4,"ngIf","ngIfElse"],[1,"h-full","w-full"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,a){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,Rs,3,4,"ng-container",1),t.ALo(3,"async"),t.YNc(4,Ns,4,1,"ng-template",null,2,t.W1O)(6,Es,3,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const o=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,a.loading))("ngIfElse",o)}},dependencies:[w.O5,wt.Ou,bt,hs,ws,Us,w.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}\n\n/*# sourceMappingURL=catering-report.component.ts-angular-inline--135.css.map*/"]})}return i})();var Ds=f(5083),zs=f(5046),Is=f(5746);const Lt={};let Wt=(()=>{class i{transform(n){return n?(Lt[n]||(Lt[n]=(0,ft.VE)(n).pipe((0,Z.U)(e=>e[0]||new ft.mO({id:n,name:n})),(0,xt.K)(e=>(0,W.of)(new ft.mO({id:n,name:n}))),(0,q.d)(1))),Lt[n]):(0,W.of)(null)}static addUser(n){Lt[n.id]=(0,W.of)(n).pipe((0,q.d)(1))}static#t=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275pipe=t.Yjl({name:"user",type:i,pure:!0})}return i})(),we=(()=>{class i{get system_id(){return this._org.binding("contact_tracing")}get time_format(){return this._settings.time_format}constructor(n,e,a){this._org=n,this._reports=e,this._settings=a,this._loading=new nt.X(""),this._generate=new nt.X(0),this._options=new nt.X({start:(0,tt.Z)(Date.now()),end:(0,et.Z)(Date.now())}),this.events=(0,Q.aj)([this._options,this._generate]).pipe((0,Ds.x)((o,r)=>o[1]===r[1]),(0,zs.h)(([o,r])=>!!r),(0,rt.w)(([{start:o,end:r,user:l}])=>{if(!l)return(0,W.of)([]);this._loading.next("Loading contact events...");const d=(0,Kt.rTZ)(this.system_id,"ContactTracing");return l=l||(0,x.ar)(),Wt.addUser(l),this.system_id&&d?d.execute("close_contacts",[l.email,l.username,(0,_t.Z)(o),(0,_t.Z)(r)]).catch(c=>((0,x.cB)(`${c?.msg||JSON.stringify(c)}`),[])):(0,W.of)([])}),(0,Z.U)(o=>{const r=this._options.getValue().user||(0,x.ar)();return o.map(l=>({mac_address:l.mac_address,date:1e3*l.contact_time,duration:Math.floor(l.duration/60)||0,user_id:r.id,user:r.name,contact_id:l.username,distance:1}))}),(0,xt.K)(o=>((0,x.cB)(`${o?.msg||JSON.stringify(o)}`),(0,W.of)([]))),(0,Is.b)(o=>this._loading.next("")),(0,q.d)(1)),this.options=this._options.asObservable(),this.loading=this._loading.asObservable()}setOptions(n){this._options.next({...this._options.getValue(),...n})}generateReport(){this._generate.next(Date.now())}downloadReport(){var n=this;return(0,z.Z)(function*(){const{start:e,end:a}=yield n._reports.options.pipe((0,H.q)(1)).toPromise(),o=yield n.events.pipe((0,H.q)(1)).toPromise(),r=new Wt,l=yield Promise.all(o.map(function(){var d=(0,z.Z)(function*(c){return{"MAC Address":c.mac_address,Date:(0,G.Z)(c.date,"dd MMM yyyy, "+n.time_format),"User Name":c.user,"Contact Name":(yield r.transform(c.contact_id).toPromise())?.name||("null"!==c.contact_id?c.contact_id:null)||c.mac_address,Duration:`${Math.floor(c.duration/60)?Math.floor(c.duration/60)+"h ":""}${Math.floor(c.duration%60)+"m"}`,Distance:c.distance}});return function(c){return d.apply(this,arguments)}}()));(0,x.Sv)(`report+contact-tracing+${(0,G.Z)(e,"yyyy-MM-dd")}+${(0,G.Z)(a,"yyyy-MM-dd")}.csv`,(0,x.o3)(l))})()}static#t=this.\u0275fac=function(e){return new(e||i)(t.LFG(J.w7),t.LFG(S),t.LFG(x.gb))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var ks=f(576);let Ys=(()=>{class i{constructor(n){this._state=n,this.options=this._state.options,this.setOptions=e=>this._state.setOptions(e),this.generate=()=>this._state.generateReport()}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(we))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["contact-tracing-options"]],decls:15,vars:14,consts:[[1,"flex","items-center","space-x-2","w-full","p-2","bg-base-100","shadow"],["appearance","outline",1,"w-[18rem]"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["placeholder","Search for user to trace...",1,"w-64","h-12","mb-2","mt-1",3,"ngModel","ngModelChange"],["btn","","matRipple","",3,"disabled","click"]],template:function(e,a){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-date-range-input",2)(3,"input",3),t.NdJ("ngModelChange",function(r){return r?a.setOptions({start:r,user:null}):""}),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(r){return r?a.setOptions({end:r,user:null}):""}),t.ALo(6,"async"),t.qZA()(),t._UZ(7,"mat-datepicker-toggle",5)(8,"mat-date-range-picker",null,6),t.qZA(),t.TgZ(10,"a-user-search-field",7),t.NdJ("ngModelChange",function(r){return a.setOptions({user:r})}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"button",8),t.NdJ("click",function(){return a.generate()}),t.ALo(13,"async"),t._uU(14," Generate Report "),t.qZA()()),2&e){const o=t.MAs(9);let r,l,d,c;t.xp6(2),t.Q6J("rangePicker",o),t.xp6(1),t.Q6J("ngModel",null==(r=t.lcZ(4,6,a.options))?null:r.start),t.xp6(2),t.Q6J("ngModel",null==(l=t.lcZ(6,8,a.options))?null:l.end),t.xp6(2),t.Q6J("for",o),t.xp6(3),t.Q6J("ngModel",null==(d=t.lcZ(11,10,a.options))?null:d.user),t.xp6(2),t.Q6J("disabled",!(null!=(c=t.lcZ(13,12,a.options))&&c.user))}},dependencies:[X.Fj,X.JJ,X.On,yt.KE,yt.R9,k.nW,k.wx,k.zY,k.By,k._g,ot.wG,ks.d,w.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25rem}\n\n/*# sourceMappingURL=contact-tracing-options.component.ts-angular-inline--139.css.map*/"]})}return i})();function js(i,s){if(1&i&&(t.TgZ(0,"span",16),t._uU(1),t.qZA()),2&i){const n=t.oxw().data,e=t.oxw(3);t.Q6J("matTooltip",e.options(n)),t.xp6(1),t.hij(" ",n.length," option(s) ")}}function Bs(i,s){1&i&&t.YNc(0,js,2,2,"span",15),2&i&&t.Q6J("ngIf",s.data.length)}function qs(i,s){if(1&i&&(t._uU(0),t.ALo(1,"async"),t.ALo(2,"user")),2&i){const e=s.row;let a;t.Oqu((null==(a=t.lcZ(1,1,t.lcZ(2,3,s.data)))?null:a.name)||e.mac_address)}}function Ps(i,s){if(1&i&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&i){const n=s.data,e=t.oxw(3);t.AsE(" ",t.xi3(1,2,n,"mediumDate"),", ",t.xi3(2,5,n,e.time_format)," ")}}function Js(i,s){if(1&i&&t._uU(0),2&i){const n=s.data,e=t.oxw(3);t.hij(" ",e.formatDuration(n||0)||"Less than a minute"," ")}}function Qs(i,s){1&i&&t._uU(0),2&i&&t.hij(" ",s.data,"m ")}const Fs=()=>["date","user_id","contact_id","duration"],Xs=()=>["Time of Contact","Person","Close Contact","Duration"],Vs=()=>["12r","14r","flex","10r"],Gs=(i,s,n,e,a,o)=>({options:i,date:s,distance:n,user_id:e,contact_id:a,duration:o});function Ws(i,s){if(1&i&&(t.TgZ(0,"div",6)(1,"div",7)(2,"h2",8),t._uU(3,"Contact Events"),t.qZA()(),t._UZ(4,"custom-table",9),t.YNc(5,Bs,1,1,"ng-template",null,10,t.W1O)(7,qs,3,5,"ng-template",null,11,t.W1O)(9,Ps,3,8,"ng-template",null,12,t.W1O)(11,Js,1,1,"ng-template",null,13,t.W1O)(13,Qs,1,1,"ng-template",null,14,t.W1O),t.qZA()),2&i){const n=t.MAs(6),e=t.MAs(8),a=t.MAs(10),o=t.MAs(12),r=t.MAs(14),l=t.oxw(2);t.xp6(4),t.Q6J("dataSource",l.tracing_events)("columns",t.DdM(7,Fs))("display_column",t.DdM(8,Xs))("column_size",t.DdM(9,Vs))("template",t.HTZ(10,Gs,n,a,r,e,e,o))("pagination",!0)("page_size",30)}}function Hs(i,s){if(1&i&&(t.ynx(0),t.YNc(1,Ws,15,17,"div",5),t.ALo(2,"async"),t.BQk()),2&i){const n=t.oxw(),e=t.MAs(10);let a;t.xp6(1),t.Q6J("ngIf",null==(a=t.lcZ(2,2,n.options))?null:a.user)("ngIfElse",e)}}function $s(i,s){if(1&i&&(t.TgZ(0,"div",17),t._UZ(1,"map-spinner",18),t.TgZ(2,"p"),t._uU(3),t.ALo(4,"async"),t.qZA()()),2&i){const n=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,1,n.loading))}}function Ks(i,s){1&i&&(t.TgZ(0,"div",17)(1,"p",19),t._uU(2,"Select a user from the topbar to begin"),t.qZA()())}let ti=(()=>{class i{get time_format(){return this._settings.time_format}constructor(n,e){this._state=n,this._settings=e,this.loading=this._state.loading,this.options=this._state.options,this.tracing_events=this._state.events,this.setOptions=a=>this._state.setOptions(a),this.downloadReport=()=>this._state.downloadReport(),this.formatDuration=a=>(0,zt.Z)({hours:Math.floor(a/60),minutes:a%60})}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(we),t.Y36(x.gb))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["app-contact-tracing-report"]],decls:11,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["icon","","matRipple","","matTooltip","Download Report",1,"bg-base-100","absolute","bottom-2","left-2","shadow",3,"click"],["load_state",""],["empty_state",""],["class","w-[64rem] max-w-[calc(100%-2rem)] rounded overflow-hidden bg-base-100 shadow mx-auto my-2",4,"ngIf","ngIfElse"],[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-base-100","shadow","mx-auto","my-2"],[1,"border-b","border-base-200","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty","No contact records for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination","page_size"],["option_state",""],["user_state",""],["date_state",""],["duration_state",""],["distance_state",""],["class","text-xs px-2 py-1 rounded bg-base-200",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-base-200",3,"matTooltip"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"],[1,"opacity-60"]],template:function(e,a){if(1&e&&(t._UZ(0,"contact-tracing-options"),t.TgZ(1,"div",0),t.YNc(2,Hs,3,4,"ng-container",1),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"button",2),t.NdJ("click",function(){return a.downloadReport()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()(),t.YNc(7,$s,5,3,"ng-template",null,3,t.W1O)(9,Ks,3,0,"ng-template",null,4,t.W1O)),2&e){const o=t.MAs(8);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,a.loading))("ngIfElse",o)}},dependencies:[w.O5,Gt.gM,ot.wG,V.o,$.C,Ys,w.Ov,w.uU,Wt],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}\n\n/*# sourceMappingURL=contact-tracing-report.component.ts-angular-inline--138.css.map*/"]})}return i})();var ei=f(6318);function ni(i,s){if(1&i&&(t._UZ(0,"iframe",1),t.ALo(1,"safe")),2&i){const n=t.oxw();t.Q6J("src",t.xi3(1,1,n.report_url,"resource"),t.uOi)}}const si={};let ii=(()=>{class i extends x.cx{get report_url(){let n=(this._settings.get("app.custom_reports")||[]).find(a=>a.id===this.id)||si;return n.url?n.url+(n.url.includes("?")?"&":"?")+"kiosk=tv"+(n.api_key?`&key=${encodeURIComponent(n.api_key)}`:""):""}constructor(n,e){super(),this._settings=n,this._route=e,this.id=""}ngOnInit(){this.subscription("route.params",this._route.paramMap.subscribe(n=>this.id=n.get("id")||""))}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(x.gb),t.Y36(B.gz))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["custom-report"]],features:[t.qOj],decls:1,vars:1,consts:[["class","w-full h-full",3,"src",4,"ngIf"],[1,"w-full","h-full",3,"src"]],template:function(e,a){1&e&&t.YNc(0,ni,2,4,"iframe",0),2&e&&t.Q6J("ngIf",a.id)},dependencies:[w.O5,ei.y],styles:["[_nghost-%COMP%]{height:100%;width:100%}\n\n/*# sourceMappingURL=custom-report.component.ts-angular-inline--140.css.map*/"]})}return i})();var ai=f(3005),oi=f(9842);const ri=["app-new-reports",""];function li(i,s){1&i&&t._UZ(0,"div",3)}const be=[{path:"",component:bt},{path:"bookings",component:wn},{path:"desks",component:ms},{path:"catering",component:Ss},{path:"contact-tracing",component:ti},{path:":id",component:ii},{path:"**",redirectTo:"desks",pathMatch:"full"}],ui=[{path:"new",component:(()=>{class i{get path(){const n=this._router.url.split("/");return n[n.length-1]}constructor(n){this._router=n}static#t=this.\u0275fac=function(e){return new(e||i)(t.Y36(B.F0))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["","app-new-reports",""]],attrs:ri,decls:6,vars:1,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full","relative"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(e,a){1&e&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1),t._UZ(4,"router-outlet"),t.YNc(5,li,1,0,"div",2),t.qZA()()),2&e&&(t.xp6(5),t.Q6J("ngIf","reports"===a.path))},dependencies:[w.O5,ai.O,oi.u,B.lC,$t],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}main[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(router-outlet){display:flex;flex-direction:column;width:100%;height:100%}\n\n/*# sourceMappingURL=new-reports.component.ts-angular-inline--141.css.map*/"]})}return i})(),children:be},{path:"",component:Be,children:be}];let pi=(()=>{class i{static#t=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275mod=t.oAB({type:i});static#n=this.\u0275inj=t.cJS({imports:[w.ez,X.u5,Ce.v,qe.YR,ft.PP,Me.TU,B.Bz.forChild(ui)]})}return i})()}}]);
//# sourceMappingURL=apps_concierge_src_app_reports_reports_module_ts.js.map