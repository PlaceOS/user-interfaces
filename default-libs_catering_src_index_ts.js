"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["default-libs_catering_src_index_ts"],{5566:(J,W,o)=>{o.d(W,{TI:()=>Q.T,QB:()=>q.Q,_I:()=>l._,sp:()=>u,bR:()=>w});var e=o(316),t=o(4456),M=o(9771),N=o(7024),n=o(2587),F=o(1034),A=o(8223),k=o(3804),B=o(640),K=o(4950),R=o(3046),j=o(3258),v=(o(807),o(8519),o(7053),o(3872),o(1623),o(2912),o(7707),o(6095),o(1732),o(2499),o(699),o(6386),o(1601),o(9204)),L=o(2333),f=o(3602),l=o(2201),a=o(8559),p=o(9434),s=o(5060),d=o(7984),r=o(1134);function c(S,H){if(1&S){const b=a.RV6();a.j41(0,"div",6)(1,"mat-form-field",7)(2,"input",8),a.mxI("ngModelChange",function(X){const z=a.eBV(b).index,Z=a.XpG(2);return a.DH7(Z.charge_codes[z],X)||(Z.charge_codes[z]=X),a.Njj(X)}),a.k0s()(),a.j41(3,"button",9),a.bIt("click",function(){const X=a.eBV(b).index,z=a.XpG(2);return a.Njj(z.removeCode(X))}),a.j41(4,"app-icon"),a.EFF(5,"delete"),a.k0s()()()}if(2&S){const b=H.index,V=a.XpG(2);a.R7$(2),a.R50("ngModel",V.charge_codes[b])}}function i(S,H){if(1&S&&(a.j41(0,"main",4),a.DNE(1,c,6,1,"div",5),a.k0s()),2&S){const b=a.XpG();a.R7$(),a.Y8G("ngForOf",b.charge_codes)("ngForTrackBy",b.trackByFn)}}function _(S,H){if(1&S){const b=a.RV6();a.j41(0,"footer",10)(1,"button",11),a.EFF(2," Import Codes "),a.j41(3,"input",12),a.bIt("change",function(X){a.eBV(b);const z=a.XpG();return a.Njj(z.addCodesFromFile(X))}),a.k0s()(),a.j41(4,"button",13),a.bIt("click",function(){a.eBV(b);const X=a.XpG();return a.Njj(X.newCode())}),a.EFF(5," Add Code "),a.k0s(),a.j41(6,"button",13),a.bIt("click",function(){a.eBV(b);const X=a.XpG();return a.Njj(X.saveChargeCodes())}),a.EFF(7," Save Changes "),a.k0s()()}}function m(S,H){1&S&&(a.j41(0,"main",14),a.nrm(1,"mat-spinner",15),a.j41(2,"p"),a.EFF(3,"Saving changes to charge codes..."),a.k0s()())}let u=(()=>{class S{constructor(b,V){this._state=b,this._dialog_ref=V,this.charge_codes=[],this.loading=!1}ngOnInit(){var b=this;return(0,v.A)(function*(){b.charge_codes=(yield b._state.charge_codes.pipe((0,f.s)(1)).toPromise())||[]})()}newCode(){this.charge_codes.push("")}removeCode(b){this.charge_codes.splice(b,1)}addCodesFromFile(b){if(b.target){const V=b.target.files[0];if(V){const X=new FileReader;X.readAsText(V,"UTF-8"),X.addEventListener("load",z=>{const Z=(0,L.a6)(z.srcElement.result)||[];for(const{code:nt}of Z)this.charge_codes.push(nt);this.charge_codes=(0,L.Am)(this.charge_codes),b.target.value=""}),X.addEventListener("error",z=>(0,L.UG)("Error reading file."))}}}saveChargeCodes(){var b=this;return(0,v.A)(function*(){b.loading=!0;const V=b.charge_codes.filter(X=>X&&X.trim());yield b._state.saveSettings({charge_codes:V}),b._dialog_ref.close()})()}trackByFn(b,V){return b}static#t=this.\u0275fac=function(V){return new(V||S)(a.rXU(l._),a.rXU(n.CP))};static#e=this.\u0275cmp=a.VBU({type:S,selectors:[["charge-code-list-modal"]],decls:10,vars:3,consts:[["load_state",""],["icon","","mat-dialog-close",""],["class","overflow-auto max-h-[65vh] min-h-[20rem] flex flex-col",4,"ngIf","ngIfElse"],["class","flex items-center p-2 space-x-2 border-t border-base-200",4,"ngIf"],[1,"overflow-auto","max-h-[65vh]","min-h-[20rem]","flex","flex-col"],["class","flex items-center space-x-2 w-full hover:bg-neutral px-2",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-center","space-x-2","w-full","hover:bg-neutral","px-2"],["appearance","outline",1,"h-14","flex-1"],["matInput","","placeholder","Charge Code",3,"ngModelChange","ngModel"],["icon","",3,"click"],[1,"flex","items-center","p-2","space-x-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-48","inverse","relative"],["type","file",1,"opacity-0","absolute","inset-0",3,"change"],["btn","","matRipple","",1,"w-48",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-20","space-y-2"],["diameter","32"]],template:function(V,X){if(1&V&&(a.j41(0,"header")(1,"h2"),a.EFF(2,"Edit Charge Codes"),a.k0s(),a.j41(3,"button",1)(4,"app-icon"),a.EFF(5,"close"),a.k0s()()(),a.DNE(6,i,2,2,"main",2)(7,_,8,0,"footer",3)(8,m,4,0,"ng-template",null,0,a.C5r)),2&V){const z=a.sdS(9);a.R7$(6),a.Y8G("ngIf",!X.loading)("ngIfElse",z),a.R7$(),a.Y8G("ngIf",!X.loading)}},dependencies:[e.Sq,e.bT,n.tx,t.me,t.BC,t.vS,p.R,K.rl,s.r6,d.fg,r.LG]})}return S})();o(9505);let w=(()=>{class S{static#t=this.\u0275fac=function(V){return new(V||S)};static#e=this.\u0275mod=a.$C({type:S});static#n=this.\u0275inj=a.G2t({imports:[e.MD,F.Cn,A.RI,M.jL,n.hM,N.g7,k.Wk,B.uc,t.YN,t.X1,j.h,K.RG,R.cQ,r.D6]})}return S})();var Q=o(5892),q=(o(5555),o(8197));o(1074)},6095:(J,W,o)=>{o.d(W,{k:()=>j});var e=o(8559),t=o(2333),M=o(5892),N=o(316),n=o(2587),F=o(9434),A=o(5060),k=o(1134);function B(C,D){1&C&&(e.j41(0,"button",4)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function K(C,D){if(1&C){const P=e.RV6();e.j41(0,"main")(1,"div",5)(2,"app-icon",6),e.EFF(3,"upload"),e.k0s(),e.j41(4,"p"),e.EFF(5,"Click to select file or Drag and drop files"),e.k0s(),e.j41(6,"input",7),e.bIt("change",function($){e.eBV(P);const E=e.XpG();return e.Njj(E.handleFileEvent($))}),e.k0s()(),e.j41(7,"div",8)(8,"button",9),e.bIt("click",function(){e.eBV(P);const $=e.XpG();return e.Njj($.downloadTemplate())}),e.EFF(9," Download Template "),e.k0s()()()}}function R(C,D){if(1&C&&(e.j41(0,"main",10),e.nrm(1,"mat-spinner",11),e.j41(2,"p"),e.EFF(3),e.k0s()()),2&C){const P=e.XpG();e.R7$(3),e.JRh(P.loading)}}let j=(()=>{class C{constructor(){this.event=new e.bkB}handleFileEvent(P){this.loading="Processing menu data...";const U=P.target;if(!U?.files)return this.loading="";const $=U.files;if(!$.length)return this.loading="";const E=$[0],y=new FileReader;y.addEventListener("loadend",h=>{const T=(0,t.a6)(h.target.result);this.loading="",this.event.emit({reason:"done",metadata:T.filter(G=>"item"===(G.type||"").toLowerCase()).map(G=>new M.T({...G,options:T.filter(g=>"option"===(g.type||"").toLowerCase()&&g.tags===G.id).map(g=>({id:g.id,name:g.name,group:g.category,multiple:g.multiple,unit_price:g.unit_price}))}))})}),y.readAsText(E)}downloadTemplate(){(0,t.PE)("import-menu-template.csv","ID,Type,Name,Unit Price,Category,Description,Tags,Multiple\nitem-1,item,Coffee,200,Drink,Wake Up,,\noption-1,option,1 Sugar,20,Sugars,,item-1,false")}static#t=this.\u0275fac=function(U){return new(U||C)};static#e=this.\u0275cmp=e.VBU({type:C,selectors:[["catering-import-menu-modal"]],outputs:{event:"event"},decls:7,vars:3,consts:[["load_state",""],[1,"h-12","bg-primary","flex","items-center","justify-between","px-4"],["icon","","mat-dialog-close","",4,"ngIf"],[4,"ngIf","ngIfElse"],["icon","","mat-dialog-close",""],[1,"relative","flex","flex-col","items-center","justify-center","space-y-2","h-[24rem]","w-[24rem]","border-4","border-base-200","border-dashed","rounded-xl","hover:bg-base-200","m-4","p-4","cursor-pointer"],[1,"text-4xl"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"],[1,"flex","items-center","justify-center","px-4","pb-4"],["matRipple","",1,"clear","underline","w-48",3,"click"],[1,"flex","flex-col","items-center","justify-center","space-y-2","p-8","h-[24rem]","w-[24rem]"],["diameter","32"]],template:function(U,$){if(1&U&&(e.j41(0,"header",1)(1,"h2"),e.EFF(2,"Import Catering Menu"),e.k0s(),e.DNE(3,B,3,0,"button",2),e.k0s(),e.DNE(4,K,10,0,"main",3)(5,R,4,1,"ng-template",null,0,e.C5r)),2&U){const E=e.sdS(6);e.R7$(3),e.Y8G("ngIf",!$.loading),e.R7$(),e.Y8G("ngIf",!$.loading)("ngIfElse",E)}},dependencies:[N.bT,n.tx,F.R,A.r6,k.LG]})}return C})()},807:(J,W,o)=>{o.d(W,{d:()=>p});var e=o(4879),t=o(8559),M=o(4456),N=o(2587),n=o(2333),F=o(5892),A=o(316),k=o(9771),B=o(5060),K=o(7024),R=o(9434),j=o(4950),C=o(7984),D=o(1134),P=o(2772),U=o(5507),$=o(6864);const E=()=>({standalone:!0});function y(s,d){1&s&&(t.j41(0,"button",9)(1,"app-icon"),t.EFF(2,"close"),t.k0s()())}function h(s,d){if(1&s&&(t.j41(0,"div",20)(1,"label",21),t.EFF(2," Name"),t.j41(3,"span"),t.EFF(4,"*"),t.k0s(),t.EFF(5,": "),t.k0s(),t.j41(6,"mat-form-field",22),t.nrm(7,"input",23),t.j41(8,"mat-error"),t.EFF(9,"Name is required"),t.k0s()()()),2&s){const r=t.XpG(2);t.R7$(),t.AVh("error",r.form.controls.name.invalid&&r.form.controls.name.touched)}}function x(s,d){if(1&s&&(t.j41(0,"div",20)(1,"label",24),t.EFF(2," Category"),t.j41(3,"span"),t.EFF(4,"*"),t.k0s(),t.EFF(5,": "),t.k0s(),t.j41(6,"mat-form-field",22),t.nrm(7,"input",25),t.j41(8,"mat-error"),t.EFF(9,"Category is required"),t.k0s()()()),2&s){const r=t.XpG(2),c=t.sdS(9);t.R7$(),t.AVh("error",r.form.controls.category.invalid&&r.form.controls.category.touched),t.R7$(6),t.Y8G("matAutocomplete",c)}}function T(s,d){if(1&s){const r=t.RV6();t.j41(0,"mat-chip-row",30),t.bIt("removed",function(){const i=t.eBV(r).$implicit,_=t.XpG(3);return t.Njj(_.removeTag(i))}),t.EFF(1),t.j41(2,"button",31)(3,"app-icon"),t.EFF(4,"cancel"),t.k0s()()()}if(2&s){const r=d.$implicit;t.R7$(),t.SpI(" ",r," "),t.R7$(),t.BMQ("aria-label","Remove "+r)}}function G(s,d){if(1&s){const r=t.RV6();t.j41(0,"div",20)(1,"label",26),t.pXf(2,3),t.k0s(),t.j41(3,"mat-form-field",22)(4,"mat-chip-grid",27,2),t.DNE(6,T,5,2,"mat-chip-row",28),t.k0s(),t.j41(7,"input",29),t.bIt("matChipInputTokenEnd",function(i){t.eBV(r);const _=t.XpG(2);return t.Njj(_.addTag(i))}),t.k0s()()()}if(2&s){const r=t.sdS(5),c=t.XpG(2);t.R7$(),t.AVh("error",c.form.controls.tags.invalid&&c.form.controls.tags.touched),t.R7$(5),t.Y8G("ngForOf",c.tag_list),t.R7$(),t.Y8G("matChipInputFor",r)("matChipInputSeparatorKeyCodes",c.separators)("matChipInputAddOnBlur",!0)}}function g(s,d){1&s&&(t.j41(0,"div",20)(1,"label",32),t.EFF(2,"Description:"),t.k0s(),t.j41(3,"mat-form-field",22),t.nrm(4,"textarea",33),t.k0s()())}function I(s,d){if(1&s&&(t.j41(0,"div",20)(1,"label",21),t.EFF(2," Unit Price"),t.j41(3,"span"),t.EFF(4,"*"),t.k0s(),t.EFF(5,": "),t.k0s(),t.j41(6,"mat-form-field",22),t.nrm(7,"input",34),t.j41(8,"mat-error"),t.EFF(9,"Unit Price is required"),t.k0s()()()),2&s){const r=t.XpG(2);t.R7$(),t.AVh("error",r.form.controls.unit_price.invalid&&r.form.controls.unit_price.touched)}}function v(s,d){1&s&&(t.j41(0,"div",20)(1,"label",35),t.pXf(2,4),t.k0s(),t.nrm(3,"image-list-field",36),t.k0s())}function L(s,d){if(1&s){const r=t.RV6();t.j41(0,"form",10)(1,"div",11),t.DNE(2,h,10,2,"div",12)(3,x,10,3,"div",12),t.k0s(),t.DNE(4,G,8,6,"div",12)(5,g,5,0,"div",12)(6,I,10,2,"div",12),t.j41(7,"div",13)(8,"label",14),t.EFF(9,"Accept Points?"),t.k0s(),t.j41(10,"mat-checkbox",15),t.EFF(11),t.k0s()(),t.j41(12,"div",16)(13,"mat-checkbox",17),t.bIt("ngModelChange",function(i){t.eBV(r);const _=t.XpG();return t.Njj(i?_.addTag({value:"Gluten Free"}):_.removeTag("Gluten Free"))}),t.EFF(14," Gluten Free (GF) "),t.k0s(),t.j41(15,"mat-checkbox",17),t.bIt("ngModelChange",function(i){t.eBV(r);const _=t.XpG();return t.Njj(i?_.addTag({value:"Vegan"}):_.removeTag("Vegan"))}),t.EFF(16," Vegan (VG) "),t.k0s(),t.j41(17,"mat-checkbox",17),t.bIt("ngModelChange",function(i){t.eBV(r);const _=t.XpG();return t.Njj(i?_.addTag({value:"Vegetarian"}):_.removeTag("Vegetarian"))}),t.EFF(18," Vegetarian (V) "),t.k0s(),t.j41(19,"mat-checkbox",17),t.bIt("ngModelChange",function(i){t.eBV(r);const _=t.XpG();return t.Njj(i?_.addTag({value:"Contains Dairy"}):_.removeTag("Contains Dairy"))}),t.EFF(20," Contains Dairy (D) "),t.k0s(),t.j41(21,"mat-checkbox",17),t.bIt("ngModelChange",function(i){t.eBV(r);const _=t.XpG();return t.Njj(i?_.addTag({value:"Contains Nuts"}):_.removeTag("Contains Nuts"))}),t.EFF(22," Contains Nuts (N) "),t.k0s()(),t.j41(23,"div",13)(24,"label",18),t.EFF(25,"Discount Cap"),t.k0s(),t.nrm(26,"a-counter",19),t.k0s(),t.DNE(27,v,4,0,"div",12),t.k0s()}if(2&s){let r;const c=t.XpG();t.Y8G("formGroup",c.form),t.R7$(2),t.Y8G("ngIf",c.form.controls.name),t.R7$(),t.Y8G("ngIf",c.form.controls.category),t.R7$(),t.Y8G("ngIf",c.form.controls.tags),t.R7$(),t.Y8G("ngIf",c.form.controls.description),t.R7$(),t.Y8G("ngIf",c.form.controls.unit_price),t.R7$(5),t.JRh(null!=(r=c.form.get("accept_points"))&&r.value?"No":"Yes"),t.R7$(2),t.Y8G("ngModel",c.hasTag("Gluten Free"))("ngModelOptions",t.lJ4(22,E)),t.R7$(2),t.Y8G("ngModel",c.hasTag("Vegan"))("ngModelOptions",t.lJ4(23,E)),t.R7$(2),t.Y8G("ngModel",c.hasTag("Vegetarian"))("ngModelOptions",t.lJ4(24,E)),t.R7$(2),t.Y8G("ngModel",c.hasTag("Contains Dairy"))("ngModelOptions",t.lJ4(25,E)),t.R7$(2),t.Y8G("ngModel",c.hasTag("Contains Nuts"))("ngModelOptions",t.lJ4(26,E)),t.R7$(5),t.Y8G("min",0)("max",100)("step",5)("render_fn",c.renderPercent),t.R7$(),t.Y8G("ngIf",c.form.controls.images)}}function f(s,d){if(1&s){const r=t.RV6();t.j41(0,"footer",37)(1,"button",38),t.bIt("click",function(){t.eBV(r);const i=t.XpG();return t.Njj(i.saveChanges())}),t.EFF(2," Save "),t.k0s()()}if(2&s){const r=t.XpG();t.R7$(),t.Y8G("disabled",!r.form.dirty)}}function l(s,d){1&s&&(t.j41(0,"div",39),t.nrm(1,"mat-spinner",40),t.j41(2,"p"),t.EFF(3,"Saving catering item..."),t.k0s()())}function a(s,d){if(1&s&&(t.j41(0,"mat-option",41),t.EFF(1),t.k0s()),2&s){const r=d.$implicit;t.Y8G("value",r),t.R7$(),t.SpI(" ",r," ")}}let p=(()=>{class s{get item(){return this._data.item||new F.T}get categories(){return this._data.categories||[]}get tag_list(){return this.form.controls.tags.value}renderPercent(r=0){return`${r}%`}hasTag(r){return this.tag_list.includes(r)}constructor(r){this._data=r,this.event=new t.bkB,this.form=new M.gE({name:new M.MJ(this.item.name||"",[M.k0.required]),description:new M.MJ(this.item.description||""),category:new M.MJ(this.item.category||"",[M.k0.required]),unit_price:new M.MJ(this.item.unit_price,[M.k0.required]),tags:new M.MJ(this.item.tags||[]),accept_points:new M.MJ(this.item.accept_points||!1),discount_cap:new M.MJ(this.item.discount_cap||0),images:new M.MJ(this.item.images||[])}),this.loading=!1,this.separators=[e.Fm,e.KE,e.t6]}addTag(r){if(!this.form||!this.form.controls.tags)return;this.form.controls.tags.markAsDirty();const c=r.input,i=r.value,_=this.tag_list;(i||"").trim()&&(_.push(i),this.form.controls.tags.setValue(_)),c&&(c.value="")}removeTag(r){if(!this.form||!this.form.controls.tags)return;const c=this.tag_list;this.form.controls.tags.markAsDirty();const i=c.indexOf(r);i>=0&&(c.splice(i,1),this.form.controls.tags.setValue(c))}saveChanges(){this.loading=!0,this.event.emit({reason:"done",metadata:{item:new F.T({...this.item,id:this.item.id||`item-${(0,n.HO)(99999999)}`,...this.form.value})}})}static#t=this.\u0275fac=function(c){return new(c||s)(t.rXU(N.Vh))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["catering-item-modal"]],outputs:{event:"event"},decls:11,vars:6,consts:()=>{let r,c,i;return r=$localize`:@@zoneTagsPlaceholder␟c133beffffe3288bbdbf8572a32910c33ce14991␟2194594490376201833:Item tags e.g. Gluten Free, Vegan etc.`,c=$localize`:@@tagsLabel␟800ffadd463cfe152c5af3fa9f13803ab2e77b93␟4746186018558508280: Tags: `,i=$localize`:@@imagesLabel␟e5d9e00faa06714d7671b164cad364b26f4c585b␟5137125764814732349:Images:`,[["load_state",""],["auto","matAutocomplete"],["chipList",""],c,i,["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 overflow-auto max-h-[65vh]",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex p-2 items-center justify-center border-t border-solid border-base-200",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","overflow-auto","max-h-[65vh]",3,"formGroup"],[1,"flex","items-center","space-x-2"],["class","flex flex-col",4,"ngIf"],[1,"flex","items-center"],[1,"flex-none","w-28","min-w-0"],["formControlName","accept_points"],["list","",1,"flex","items-center","flex-wrap","max-w-lg"],[3,"ngModelChange","ngModel","ngModelOptions"],[1,"flex-1","w-24","min-w-0"],["formControlName","discount_cap",1,"border","border-base-200","rounded",3,"min","max","step","render_fn"],[1,"flex","flex-col"],["for","title"],["appearance","outline"],["matInput","","name","name","placeholder","Item name","formControlName","name"],["for","category"],["matInput","","name","category","placeholder","Category","formControlName","category",3,"matAutocomplete"],["for","tags"],["aria-label","Item Tags"],[3,"removed",4,"ngFor","ngForOf"],["name","tags","placeholder",r,3,"matChipInputTokenEnd","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur"],[3,"removed"],["matChipRemove",""],["for","description"],["matInput","","name","description","placeholder","Item Description","formControlName","description"],["matInput","","name","unit-price","type","number","placeholder","Unit Price","formControlName","unit_price"],["for","images"],["name","images","formControlName","images"],[1,"flex","p-2","items-center","justify-center","border-t","border-solid","border-base-200"],["btn","","matRipple","",3,"click","disabled"],[1,"flex","flex-col","items-center","p-8","space-y-2","w-64"],["diameter","32"],[3,"value"]]},template:function(c,i){if(1&c&&(t.j41(0,"header")(1,"h3"),t.EFF(2),t.k0s(),t.DNE(3,y,3,0,"button",5),t.k0s(),t.DNE(4,L,28,27,"form",6)(5,f,3,1,"footer",7)(6,l,4,0,"ng-template",null,0,t.C5r),t.j41(8,"mat-autocomplete",null,1),t.DNE(10,a,2,2,"mat-option",8),t.k0s()),2&c){const _=t.sdS(7);t.R7$(2),t.SpI("",i.item.id?"Edit":"Add"," Item"),t.R7$(),t.Y8G("ngIf",!i.loading),t.R7$(),t.Y8G("ngIf",i.form&&!i.loading)("ngIfElse",_),t.R7$(),t.Y8G("ngIf",!i.loading),t.R7$(5),t.Y8G("ngForOf",i.categories)}},dependencies:[A.Sq,A.bT,k.$3,B.wT,k.pN,N.tx,K.So,M.qT,M.me,M.Q0,M.BC,M.cb,M.vS,M.j4,M.JD,R.R,j.rl,j.TL,B.r6,C.fg,D.LG,P.HW,P.D7,P.Zv,P.jH,U.s,$.$],styles:["[list][_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin:.5rem}\n\n/*# sourceMappingURL=catering-item-modal.component.ts-angular-inline--53.css.map*/"]})}return s})()},8519:(J,W,o)=>{o.d(W,{o:()=>L});var e=o(2201),t=o(5892),M=o(2333),N=o(8197),n=o(8559),F=o(316),A=o(1034),k=o(7024),B=o(640),K=o(4456),R=o(9434),j=o(8328),C=o(5060);const D=f=>({key:"active",name:" ",content:f,size:"3.5rem",sortable:!1}),P=()=>({key:"name",name:"Name"}),U=()=>({key:"category",name:"Category"}),$=f=>({key:"unit_price",name:"Price",content:f,size:"6rem"}),E=f=>({key:"actions",name:" ",content:f,size:"6.5rem",sortable:!1}),y=(f,l,a,p,s)=>[f,l,a,p,s];function h(f,l){if(1&f){const a=n.RV6();n.j41(0,"mat-checkbox",6),n.bIt("ngModelChange",function(s){const d=n.eBV(a).row,r=n.XpG();return n.Njj(r.setEnabled(d,s))}),n.k0s()}if(2&f){const a=l.row,p=n.XpG();n.Y8G("ngModel",p.isEnabled(a))}}function x(f,l){if(1&f&&(n.j41(0,"div",7),n.EFF(1),n.nI1(2,"async"),n.nI1(3,"currency"),n.k0s()),2&f){const a=l.data,p=n.XpG();n.R7$(),n.SpI(" ",n.i5U(3,3,a/100,n.bMT(2,1,p.symbol))," ")}}function T(f,l){if(1&f){const a=n.RV6();n.j41(0,"div",8)(1,"button",9)(2,"app-icon"),n.EFF(3,"more_vert"),n.k0s()(),n.j41(4,"mat-menu",null,4)(6,"button",10),n.bIt("click",function(){const s=n.eBV(a).row,d=n.XpG();return n.Njj(d.addOption(s))}),n.j41(7,"div",11)(8,"app-icon"),n.EFF(9,"add"),n.k0s(),n.j41(10,"div"),n.EFF(11,"Add Option"),n.k0s()()(),n.j41(12,"button",10),n.bIt("click",function(){const s=n.eBV(a).row,d=n.XpG();return n.Njj(d.editItem(s))}),n.j41(13,"div",11)(14,"app-icon"),n.EFF(15,"edit"),n.k0s(),n.j41(16,"div"),n.EFF(17,"Edit Item"),n.k0s()()(),n.j41(18,"button",10),n.bIt("click",function(){const s=n.eBV(a).row,d=n.XpG();return n.Njj(d.removeItem(s))}),n.j41(19,"div",11)(20,"app-icon",12),n.EFF(21,"delete"),n.k0s(),n.j41(22,"div"),n.EFF(23,"Remove Item"),n.k0s()()()(),n.j41(24,"button",13),n.bIt("click",function(){const s=n.eBV(a).row,d=n.XpG();return n.Njj(d.show_children[s.id]=!d.show_children[s.id])}),n.j41(25,"app-icon"),n.EFF(26),n.k0s()()()}if(2&f){const a=l.row,p=n.sdS(5),s=n.XpG();n.R7$(),n.AVh("opacity-0",!s.can_edit),n.Y8G("disabled",!s.can_edit)("matMenuTriggerFor",p),n.R7$(23),n.Y8G("disabled",!(null!=a.options&&a.options.length))("matTooltip",null!=a.options&&a.options.length?(s.show_children[a.id]?"Hide":"Show")+" Menu Item Options":""),n.R7$(2),n.SpI(" ",s.show_children[a.id]?"keyboard_arrow_down":"chevron_right"," ")}}function G(f,l){if(1&f){const a=n.RV6();n.j41(0,"button",22),n.bIt("click",function(){n.eBV(a);const s=n.XpG().$implicit,d=n.XpG().row,r=n.XpG();return n.Njj(r.editOption(d,s))}),n.j41(1,"app-icon"),n.EFF(2,"edit"),n.k0s()()}}function g(f,l){if(1&f){const a=n.RV6();n.j41(0,"button",23),n.bIt("click",function(){n.eBV(a);const s=n.XpG().$implicit,d=n.XpG().row,r=n.XpG();return n.Njj(r.removeOption(d,s))}),n.j41(1,"app-icon",12),n.EFF(2,"delete"),n.k0s()()}}function I(f,l){if(1&f&&(n.j41(0,"div",15),n.nrm(1,"div",16),n.j41(2,"div",17)(3,"div",18),n.EFF(4),n.k0s(),n.j41(5,"div",19),n.EFF(6),n.k0s()(),n.DNE(7,G,3,0,"button",20)(8,g,3,0,"button",21),n.k0s()),2&f){const a=l.$implicit,p=n.XpG(2);n.R7$(4),n.JRh(a.name),n.R7$(2),n.SpI(" ",a.group," "),n.R7$(),n.Y8G("ngIf",p.can_edit),n.R7$(),n.Y8G("ngIf",p.can_edit)}}function v(f,l){1&f&&n.DNE(0,I,9,4,"div",14),2&f&&n.Y8G("ngForOf",l.row.options)}let L=(()=>{class f{get filters(){return this._orders.filters}get can_edit(){return this._catering.is_editable}get categories(){return this._catering.categories}constructor(a,p){this._catering=a,this._orders=p,this.show_children={},this.menu=this._catering.menu,this.addOption=s=>this._catering.addOption(s),this.editOption=(s,d)=>this._catering.addOption(s,d),this.removeOption=(s,d)=>this._catering.deleteOption(s,d),this.editItem=s=>this._catering.addItem(s),this.removeItem=s=>this._catering.deleteItem(s)}isEnabled(a){return!a.hide_for_zones.includes(this._catering.zone)}setEnabled(a,p){let s=a.hide_for_zones;s=p?s.filter(d=>d!==this._catering.zone):(0,M.Am)([...s,this._catering.zone]),this._catering.updateItem(new t.T({...a,hide_for_zones:s}))}static#t=this.\u0275fac=function(p){return new(p||f)(n.rXU(e._),n.rXU(N.Q))};static#e=this.\u0275cmp=n.VBU({type:f,selectors:[["catering-menu"]],decls:9,vars:20,consts:[["active_template",""],["price_template",""],["actions_template",""],["child_template",""],["menu","matMenu"],["empty_message","No Items in Menu",1,"w-full","min-w-[32rem]","block","text-sm",3,"data","columns","filter","show_children","child_template","sortable"],["matTooltip","Allow Ordering Item for this zone","matTooltipPosition","right",1,"mx-auto",3,"ngModelChange","ngModel"],[1,"px-2","py-1","font-mono","text-xs","flex","items-center","mx-auto","bg-secondary","text-secondary-content","rounded"],[1,"p-2","flex","items-center","mx-auto","space-x-2"],["icon","","matRipple","",3,"disabled","matMenuTriggerFor"],["mat-menu-item","",1,"flex","items-center",3,"click"],[1,"flex","items-center","space-x-2","pr-2"],[1,"text-error"],["icon","","matRipple","",3,"click","disabled","matTooltip"],["class","flex p-2 items-center border-b border-solid border-base-200 relative space-x-2",4,"ngFor","ngForOf"],[1,"flex","p-2","items-center","border-b","border-solid","border-base-200","relative","space-x-2"],[1,"absolute","inset-y-0","left-0","w-2","bg-black","opacity-10"],[1,"flex-1","pl-4","pr-2"],[1,"text"],[1,"text-xs","opacity-60"],["icon","","matRipple","","matTooltip","Edit Menu Item Option",3,"click",4,"ngIf"],["icon","","matRipple","","class","!mr-1","matTooltip","Remove Menu Item Option",3,"click",4,"ngIf"],["icon","","matRipple","","matTooltip","Edit Menu Item Option",3,"click"],["icon","","matRipple","","matTooltip","Remove Menu Item Option",1,"!mr-1",3,"click"]],template:function(p,s){if(1&p&&(n.nrm(0,"simple-table",5),n.DNE(1,h,1,1,"ng-template",null,0,n.C5r)(3,x,4,6,"ng-template",null,1,n.C5r)(5,T,27,7,"ng-template",null,2,n.C5r)(7,v,1,1,"ng-template",null,3,n.C5r)),2&p){const d=n.sdS(2),r=n.sdS(4),c=n.sdS(6),i=n.sdS(8);n.Y8G("data",s.menu)("columns",n.s1E(14,y,n.eq3(6,D,d),n.lJ4(8,P),n.lJ4(9,U),n.eq3(10,$,r),n.eq3(12,E,c)))("filter",null==s.filters?null:s.filters.search)("show_children",s.show_children)("child_template",i)("sortable",!0)}},dependencies:[F.Sq,F.bT,A.kk,A.fb,A.Cp,k.So,B.oV,K.BC,K.vS,R.R,j.O,C.r6,F.Jj,F.oe],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:90%;width:100%}\n\n/*# sourceMappingURL=catering-menu.component.ts-angular-inline--68.css.map*/"]})}return f})()},7053:(J,W,o)=>{o.d(W,{e:()=>G});var e=o(8559),t=o(4456),M=o(2587),N=o(4217),n=o(5892),F=o(316),A=o(9771),k=o(5060),B=o(7024),K=o(9434),R=o(4950),j=o(7984),C=o(1134);function D(g,I){1&g&&(e.j41(0,"button",6)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function P(g,I){if(1&g&&(e.j41(0,"div",9)(1,"label",10),e.EFF(2," Name"),e.j41(3,"span"),e.EFF(4,"*"),e.k0s(),e.EFF(5,": "),e.k0s(),e.j41(6,"mat-form-field",11),e.nrm(7,"input",12),e.j41(8,"mat-error"),e.EFF(9,"Name is required"),e.k0s()()()),2&g){const v=e.XpG(2);e.R7$(),e.AVh("error",v.form.controls.name.invalid&&v.form.controls.name.touched)}}function U(g,I){if(1&g&&(e.j41(0,"div",9)(1,"label",13),e.EFF(2," Type"),e.j41(3,"span"),e.EFF(4,"*"),e.k0s(),e.EFF(5,": "),e.k0s(),e.j41(6,"mat-form-field",11),e.nrm(7,"input",14),e.j41(8,"mat-error"),e.EFF(9,"Type is required"),e.k0s()()()),2&g){const v=e.XpG(2),L=e.sdS(9);e.R7$(),e.AVh("error",v.form.controls.group.invalid&&v.form.controls.group.touched),e.R7$(6),e.Y8G("matAutocomplete",L)}}function $(g,I){1&g&&(e.j41(0,"div",9)(1,"label",10),e.EFF(2,"Unit Price:"),e.k0s(),e.j41(3,"mat-form-field",11),e.nrm(4,"input",15),e.k0s()())}function E(g,I){1&g&&(e.j41(0,"div",9)(1,"mat-checkbox",16),e.EFF(2," Can select multiple of type "),e.k0s()())}function y(g,I){if(1&g&&(e.j41(0,"form",7),e.DNE(1,P,10,2,"div",8)(2,U,10,3,"div",8)(3,$,5,0,"div",8)(4,E,3,0,"div",8),e.k0s()),2&g){const v=e.XpG();e.Y8G("formGroup",v.form),e.R7$(),e.Y8G("ngIf",v.form.controls.name),e.R7$(),e.Y8G("ngIf",v.form.controls.group),e.R7$(),e.Y8G("ngIf",v.form.controls.unit_price),e.R7$(),e.Y8G("ngIf",v.form.controls.multiple)}}function h(g,I){if(1&g){const v=e.RV6();e.j41(0,"footer",17)(1,"button",18),e.bIt("click",function(){e.eBV(v);const f=e.XpG();return e.Njj(f.saveChanges())}),e.EFF(2," Save "),e.k0s()()}if(2&g){const v=e.XpG();e.R7$(),e.Y8G("disabled",!v.form.dirty)}}function x(g,I){1&g&&(e.j41(0,"div",19),e.nrm(1,"mat-spinner",20),e.j41(2,"p"),e.EFF(3,"Saving catering item option..."),e.k0s()())}function T(g,I){if(1&g&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&g){const v=I.$implicit;e.Y8G("value",v),e.R7$(),e.SpI(" ",v," ")}}let G=(()=>{class g{get option(){return this._data.option}get types(){return this._data.types||[]}constructor(v){this._data=v,this.event=new e.bkB,this.form=new t.gE({name:new t.MJ(this.option.name||"",[t.k0.required]),group:new t.MJ(this.option.group||"",[t.k0.required]),unit_price:new t.MJ(this.option.unit_price),multiple:new t.MJ(!!this.option.multiple,[])}),this.loading=!1}saveChanges(){this.loading=!0;const v={...this.option,id:this.option.id||`option-${(0,N.HO)(99999999)}`,...this.form.value};this.event.emit({reason:"done",metadata:{item:new n.T({...this._data.parent,options:this._data.parent.options.filter(L=>L.id!==v.id).concat([v])})}})}static#t=this.\u0275fac=function(L){return new(L||g)(e.rXU(M.Vh))};static#e=this.\u0275cmp=e.VBU({type:g,selectors:[["catering-option-modal"]],outputs:{event:"event"},decls:11,vars:6,consts:[["load_state",""],["auto","matAutocomplete"],["icon","","mat-dialog-close","",4,"ngIf"],["class","p-4 overflow-auto max-h-[65vh]",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex p-2 items-center justify-center border-t border-solid border-base-200",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["icon","","mat-dialog-close",""],[1,"p-4","overflow-auto","max-h-[65vh]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","title"],["appearance","outline"],["matInput","","name","name","placeholder","Item name","formControlName","name"],["for","group"],["matInput","","name","group","placeholder","Type of option e.g. Number of sugars","formControlName","group",3,"matAutocomplete"],["matInput","","name","unit-price","type","number","placeholder","Unit Price","formControlName","unit_price"],["name","multiple","formControlName","multiple"],[1,"flex","p-2","items-center","justify-center","border-t","border-solid","border-base-200"],["btn","","matRipple","",3,"click","disabled"],["loading","",1,"flex","flex-col","items-center","p-8","space-y-2","w-64"],["diameter","32"],[3,"value"]],template:function(L,f){if(1&L&&(e.j41(0,"header")(1,"h3"),e.EFF(2),e.k0s(),e.DNE(3,D,3,0,"button",2),e.k0s(),e.DNE(4,y,5,5,"form",3)(5,h,3,1,"footer",4)(6,x,4,0,"ng-template",null,0,e.C5r),e.j41(8,"mat-autocomplete",null,1),e.DNE(10,T,2,2,"mat-option",5),e.k0s()),2&L){const l=e.sdS(7);e.R7$(2),e.SpI("",f.option.id?"Edit":"Add"," Item Option"),e.R7$(),e.Y8G("ngIf",!f.loading),e.R7$(),e.Y8G("ngIf",f.form&&!f.loading)("ngIfElse",l),e.R7$(),e.Y8G("ngIf",!f.loading),e.R7$(5),e.Y8G("ngForOf",f.types)}},dependencies:[F.Sq,F.bT,A.$3,k.wT,A.pN,M.tx,B.So,t.qT,t.me,t.Q0,t.BC,t.cb,t.j4,t.JD,K.R,R.rl,R.TL,k.r6,j.fg,C.LG]})}return g})()},3872:(J,W,o)=>{o.d(W,{Q:()=>K});var e=o(8559),t=o(316),M=o(9434),N=o(5060);const n=["catering-order-item",""];function F(R,j){if(1&R&&(e.j41(0,"div",12),e.EFF(1),e.k0s()),2&R){const C=e.XpG().$implicit;e.R7$(),e.SpI(" ",C.name," ")}}function A(R,j){if(1&R&&(e.qex(0),e.DNE(1,F,2,1,"div",11),e.bVm()),2&R){const C=j.$implicit;e.R7$(),e.Y8G("ngIf",C)}}function k(R,j){if(1&R){const C=e.RV6();e.qex(0),e.j41(1,"div",1),e.nrm(2,"div",2),e.k0s(),e.j41(3,"div",3)(4,"button",4),e.bIt("click",function(){e.eBV(C);const P=e.XpG();return e.Njj(P.toggle())}),e.j41(5,"app-icon"),e.EFF(6),e.k0s()()(),e.j41(7,"div",5)(8,"div",6)(9,"div",7),e.EFF(10),e.k0s()(),e.j41(11,"div",8),e.EFF(12),e.k0s(),e.j41(13,"div",9),e.DNE(14,A,2,1,"ng-container",10),e.k0s()(),e.bVm()}if(2&R){const C=e.XpG();e.R7$(4),e.AVh("bg-success",C.active)("text-white",C.active)("border-solid",C.active),e.R7$(2),e.JRh(C.active?"done":"local_pizza"),e.R7$(4),e.SpI(" ",(null==C.item?null:C.item.amount)||(null==C.item?null:C.item.quantity)||1,"\xd7 "),e.R7$(2),e.JRh(null==C.item?null:C.item.name),e.R7$(2),e.Y8G("ngForOf",C.item.option_list)}}const B=new Set;let K=(()=>{class R{constructor(){this.active=!1}get item_key(){return`${this.order_id}|${this.item?.id}`}ngOnInit(){this.active=B.has(this.item_key)}toggle(){B.has(this.item_key)?(B.delete(this.item_key),this.active=!1):(B.add(this.item_key),this.active=!0)}static#t=this.\u0275fac=function(D){return new(D||R)};static#e=this.\u0275cmp=e.VBU({type:R,selectors:[["","catering-order-item",""]],inputs:{order_id:"order_id",item:"item"},attrs:n,decls:1,vars:1,consts:[[4,"ngIf"],[1,"w-16","text-right","h-14","relative"],["arm","",1,"border-b-2","border-l-2","border-base-200","w-4","h-16","absolute","top-1/2","left-1/2","-translate-y-full","-translate-x-px"],[1,"w-12","mr-4"],["action","","icon","","matRipple","",1,"border-2","border-base-200","border-dashed","text-xl","text-dark-fade","p-2",3,"click"],[1,"flex","flex-1","items-center","border-b","border-base-200","border-solid","py-4","space-x-4"],[1,""],[1,"p-1","rounded-full","bg-base-300","w-10","h-10","flex","items-center","justify-center","font-mono","text-sm"],[1,"flex-1"],[1,"flex","space-x-2","mr-2","px-4"],[4,"ngFor","ngForOf"],["class","text-xs py-1 px-2 bg-warning text-warning-content rounded-2xl shadow",4,"ngIf"],[1,"text-xs","py-1","px-2","bg-warning","text-warning-content","rounded-2xl","shadow"]],template:function(D,P){1&D&&e.DNE(0,k,15,10,"ng-container",0),2&D&&e.Y8G("ngIf",P.item)},dependencies:[t.Sq,t.bT,M.R,N.r6],styles:["[_nghost-%COMP%]:last-child > div[_ngcontent-%COMP%]{border:none!important}\n\n/*# sourceMappingURL=catering-order-item.component.ts-angular-inline--69.css.map*/"]})}return R})()},1623:(J,W,o)=>{o.d(W,{r:()=>c});var e=o(9204),t=o(8197),M=o(2333),N=o(1074),n=o(8559),F=o(316),A=o(1034),k=o(9434),B=o(2238),K=o(8328),R=o(5060),j=o(3872);const C=i=>({key:"state",name:" ",size:"4rem",sortable:!1,content:i}),D=i=>({key:"deliver_at",name:"Time",content:i}),P=i=>({key:"event",name:"Location",content:i,sortable:!1}),U=i=>({key:"event",name:"Host",content:i,sortable:!1}),$=()=>({key:"charge_code",name:"Charge Code"}),E=()=>({key:"invoice_number",name:"Invoice No.",empty:"No Invoice"}),y=i=>({key:"status",name:"Status",content:i,size:"11rem"}),h=i=>({key:"actions",name:" ",size:"6.5rem",content:i,sortable:!1}),x=(i,_,m,u,O,Y,w,Q)=>[i,_,m,u,O,Y,w,Q];function T(i,_){1&i&&(n.j41(0,"div",11)(1,"div",12)(2,"app-icon"),n.EFF(3,"room_service"),n.k0s()()())}function G(i,_){if(1&i&&(n.j41(0,"div",13)(1,"div"),n.EFF(2),n.nI1(3,"date"),n.k0s(),n.j41(4,"div",14),n.EFF(5),n.nI1(6,"date"),n.nI1(7,"date"),n.nI1(8,"date"),n.nI1(9,"date"),n.k0s()()),2&i){const m=_.data,u=_.row,O=n.XpG();n.R7$(2),n.SpI("Deliver at ",n.i5U(3,5,m,O.time_format),""),n.R7$(3),n.LHq(" ",n.i5U(6,8,null==u||null==u.event?null:u.event.date,"MMM d"),", ",n.i5U(7,11,null==u||null==u.event?null:u.event.date,O.time_format)," - ",n.i5U(8,14,null==u||null==u.event?null:u.event.date_end,"MMM d"),", ",n.i5U(9,17,null==u||null==u.event?null:u.event.date_end,O.time_format)," ")}}function g(i,_){1&i&&(n.j41(0,"span",17),n.EFF(1," No Location "),n.k0s())}function I(i,_){if(1&i&&(n.j41(0,"div",15),n.EFF(1),n.DNE(2,g,2,0,"span",16),n.k0s()),2&i){const m=_.data;n.R7$(),n.SpI(" ",(null==m||null==m.space?null:m.space.display_name)||(null==m||null==m.space?null:m.space.name)||""," "),n.R7$(),n.Y8G("ngIf",!(null!=m&&null!=m.space&&m.space.display_name||null!=m&&null!=m.space&&m.space.name))}}function v(i,_){1&i&&(n.j41(0,"span",17),n.EFF(1," Unknown Host "),n.k0s())}function L(i,_){if(1&i&&(n.j41(0,"div",15)(1,"div"),n.EFF(2),n.DNE(3,v,2,0,"span",16),n.k0s(),n.j41(4,"div",14),n.EFF(5),n.k0s()()),2&i){const m=_.data;n.R7$(2),n.SpI(" ",(null==m||null==m.organiser?null:m.organiser.name)||(null==m?null:m.host)||""," "),n.R7$(),n.Y8G("ngIf",!(null!=m&&null!=m.organiser&&m.organiser.name||null!=m&&m.host)),n.R7$(2),n.SpI(" ",(null==m||null==m.organiser?null:m.organiser.email)||(null==m?null:m.host)," ")}}function f(i,_){if(1&i){const m=n.RV6();n.j41(0,"button",22),n.bIt("click",function(){const O=n.eBV(m).$implicit,Y=n.XpG().row,w=n.XpG();return n.Njj(w.updateStatus(Y,O.id))}),n.j41(1,"div",23),n.nrm(2,"div",24),n.j41(3,"span",25),n.EFF(4),n.k0s()()()}if(2&i){const m=_.$implicit;n.R7$(2),n.xc7("background-color",m.colour),n.R7$(2),n.JRh(m.name)}}function l(i,_){if(1&i&&(n.j41(0,"div",15)(1,"button",18)(2,"div",19),n.EFF(3),n.k0s(),n.j41(4,"app-icon",20),n.EFF(5,"arrow_drop_down"),n.k0s()()(),n.j41(6,"mat-menu",null,7),n.DNE(8,f,5,3,"button",21),n.k0s()),2&i){let m,u;const O=_.data,Y=n.sdS(7),w=n.XpG();n.R7$(),n.xc7("background",null==(m=w.status(O))?null:m.colour),n.Y8G("matMenuTriggerFor",Y),n.R7$(2),n.SpI(" ",null==(u=w.status(O))?null:u.name," "),n.R7$(5),n.Y8G("ngForOf",w.statuses)}}function a(i,_){if(1&i&&(n.j41(0,"div",29)(1,"div",30),n.EFF(2,"Notes"),n.k0s(),n.j41(3,"p",31),n.EFF(4),n.k0s()()),2&i){const m=n.XpG().row;n.R7$(4),n.SpI(" ",m.notes," ")}}function p(i,_){if(1&i){const m=n.RV6();n.j41(0,"div",26)(1,"button",27)(2,"app-icon"),n.EFF(3,"description"),n.k0s()(),n.DNE(4,a,5,1,"ng-template",null,8,n.C5r),n.j41(6,"button",28),n.bIt("click",function(){const O=n.eBV(m).row,Y=n.XpG();return n.Njj(Y.show_children[O.id]=!Y.show_children[O.id])}),n.j41(7,"app-icon"),n.EFF(8),n.k0s()()()}if(2&i){const m=_.row,u=n.sdS(5),O=n.XpG();n.R7$(),n.Y8G("hover",!0)("content",u)("disabled",!m.notes),n.R7$(7),n.SpI(" ",O.show_children[m.id]?"keyboard_arrow_down":"chevron_right"," ")}}function s(i,_){if(1&i&&n.nrm(0,"li",35),2&i){const m=_.$implicit,u=n.XpG(2).row;n.Y8G("order_id",null==u?null:u.id)("item",m)}}function d(i,_){if(1&i&&(n.j41(0,"ul",33),n.DNE(1,s,1,2,"li",34),n.k0s()),2&i){const m=n.XpG().row;n.R7$(),n.Y8G("ngForOf",m.items)}}function r(i,_){if(1&i&&n.DNE(0,d,2,1,"ul",32),2&i){const m=_.row;n.Y8G("ngIf",null==m?null:m.items.length)}}let c=(()=>{class i extends M.Tv{get time_format(){return this._settings.time_format}status(m){return N.T.find(u=>u.id===m)}constructor(m,u){var O;super(),O=this,this._orders=m,this._settings=u,this.order_list=this._orders.filtered,this.loading=this._orders.loading,this.statuses=N.T,this.show_children={},this.updateStatus=function(){var Y=(0,e.A)(function*(w,Q){yield O._orders.updateStatus(w,Q),O.timeout("status-change",()=>w.status=Q)});return function(w,Q){return Y.apply(this,arguments)}}()}ngOnInit(){this._orders.startPolling()}ngOnDestroy(){this._orders.stopPolling()}trackByFn(m,u){return u?u.id:void 0}static#t=this.\u0275fac=function(u){return new(u||i)(n.rXU(t.Q),n.rXU(M.h$))};static#e=this.\u0275cmp=n.VBU({type:i,selectors:[["catering-order-list"]],features:[n.Vt3],decls:16,vars:28,consts:[["state_template",""],["time_template",""],["location_template",""],["host_template",""],["status_template",""],["actions_template",""],["child_template",""],["menu","matMenu"],["notes_template",""],[1,"flex","flex-col","h-full","w-full","overflow-auto"],["empty_message","No Catering Orders",1,"min-w-[72rem]","w-full","block","text-sm",3,"data","columns","sortable","show_children","child_template"],[1,"p-2"],[1,"rounded-full","bg-base-200","p-2","text-2xl","flex","items-center","justify-center"],[1,"p-4"],[1,"text-xs","opacity-30"],[1,"px-4","py-2"],["class","opacity-30",4,"ngIf"],[1,"opacity-30"],["status","","matRipple","",1,"rounded-3xl","text-base","border-none","h-10","px-4","flex","items-center","text-white","w-36",3,"matMenuTriggerFor"],[1,"flex","text-center","capitalize","mx-2"],[1,"pl-2"],["mat-menu-item","","class","flex items-center",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"flex","items-center",3,"click"],[1,"flex","items-center","space-x-2"],[1,"rounded-full","h-4","w-4","mr-2"],[1,"mr-2","w-20"],[1,"flex","items-center","space-x-2","p-2","mx-auto"],["icon","","matRipple","","customTooltip","","xPosition","end","yPosition","top",3,"hover","content","disabled"],["icon","","matRipple","",3,"click"],[1,"p-2","rounded-lg","bg-base-100","text-base-content","max-w-[32rem]","min-w-[8rem]","shadow","border","border-base-200"],[1,"mb-2"],[1,"text-sm","px-4","py-2","bg-base-200","rounded"],["class","list-none p-0 m-0 w-full relative z-0",4,"ngIf"],[1,"list-none","p-0","m-0","w-full","relative","z-0"],["catering-order-item","","class","flex items-center",3,"order_id","item",4,"ngFor","ngForOf"],["catering-order-item","",1,"flex","items-center",3,"order_id","item"]],template:function(u,O){if(1&u&&(n.j41(0,"div",9),n.nrm(1,"simple-table",10),n.DNE(2,T,4,0,"ng-template",null,0,n.C5r)(4,G,10,20,"ng-template",null,1,n.C5r)(6,I,3,2,"ng-template",null,2,n.C5r)(8,L,6,3,"ng-template",null,3,n.C5r)(10,l,9,5,"ng-template",null,4,n.C5r)(12,p,9,4,"ng-template",null,5,n.C5r)(14,r,1,1,"ng-template",null,6,n.C5r),n.k0s()),2&u){const Y=n.sdS(3),w=n.sdS(5),Q=n.sdS(7),tt=n.sdS(9),q=n.sdS(11),et=n.sdS(13),S=n.sdS(15);n.R7$(),n.Y8G("data",O.order_list)("columns",n.lV(19,x,n.eq3(5,C,Y),n.eq3(7,D,w),n.eq3(9,P,Q),n.eq3(11,U,tt),n.lJ4(13,$),n.lJ4(14,E),n.eq3(15,y,q),n.eq3(17,h,et)))("sortable",!0)("show_children",O.show_children)("child_template",S)}},dependencies:[F.Sq,F.bT,A.kk,A.fb,A.Cp,k.R,B.I,K.O,R.r6,j.Q,F.vh],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}\n\n/*# sourceMappingURL=catering-order-list.component.ts-angular-inline--70.css.map*/"]})}return i})()},2912:(J,W,o)=>{o.d(W,{g:()=>d});var e=o(9204),t=o(8559),M=o(2587),N=o(2333),n=o(5892),F=o(5555),A=o(2185),k=o(285),B=o(316),K=o(8223),R=o(640),j=o(4456),C=o(9434),D=o(5060),P=o(1134),U=o(5507);const $=()=>({});function E(r,c){1&r&&(t.j41(0,"div",18),t.EFF(1," Options Available "),t.k0s())}function y(r,c){if(1&r){const i=t.RV6();t.j41(0,"a-counter",19),t.bIt("ngModelChange",function(m){t.eBV(i);const u=t.XpG().$implicit,O=t.XpG(5);return t.Njj(O.updateItemQuantity(u,m))}),t.k0s()}if(2&r){const i=t.XpG().$implicit;t.Y8G("ngModel",i.quantity)}}function h(r,c){if(1&r){const i=t.RV6();t.j41(0,"div",20)(1,"div",21)(2,"button",22)(3,"app-icon"),t.EFF(4,"remove"),t.k0s()()(),t.j41(5,"div",23),t.EFF(6),t.k0s(),t.j41(7,"button",24),t.bIt("click",function(){t.eBV(i);const m=t.XpG().$implicit,u=t.XpG(5);return t.Njj(u.addItem(m))}),t.j41(8,"app-icon"),t.EFF(9,"add"),t.k0s()()()}if(2&r){const i=t.XpG().$implicit;t.R7$(),t.Y8G("matTooltip",i.quantity?"Items with options must be removed from order confirmation page":""),t.R7$(),t.Y8G("disabled",!0),t.R7$(4),t.SpI(" ",i.quantity," ")}}function x(r,c){if(1&r&&(t.j41(0,"div",12)(1,"div",13)(2,"div",13),t.EFF(3),t.k0s(),t.DNE(4,E,2,0,"div",14),t.k0s(),t.j41(5,"div",15),t.EFF(6),t.nI1(7,"currency"),t.k0s(),t.DNE(8,y,1,1,"a-counter",16)(9,h,10,3,"div",17),t.k0s()),2&r){const i=c.$implicit,_=t.XpG(5);t.R7$(3),t.SpI(" ",i.name," "),t.R7$(),t.Y8G("ngIf",i.options.length),t.R7$(2),t.SpI(" ",t.i5U(7,5,i.unit_price/100,_.code)," "),t.R7$(2),t.Y8G("ngIf",!i.options.length),t.R7$(),t.Y8G("ngIf",i.options.length)}}function T(r,c){if(1&r&&(t.j41(0,"mat-tab",9)(1,"div",10),t.DNE(2,x,10,8,"div",11),t.k0s()()),2&r){const i=t.XpG().$implicit,_=t.XpG(3);t.Y8G("label",i),t.R7$(2),t.Y8G("ngForOf",(_.menu_items||t.lJ4(2,$))[i])}}function G(r,c){if(1&r&&(t.qex(0),t.DNE(1,T,3,3,"mat-tab",8),t.bVm()),2&r){const i=c.$implicit,_=t.XpG(3);t.R7$(),t.Y8G("ngIf",(_.menu_items||t.lJ4(1,$))[i].length)}}function g(r,c){if(1&r&&(t.qex(0),t.j41(1,"mat-tab-group"),t.DNE(2,G,2,2,"ng-container",7),t.k0s(),t.bVm()),2&r){const i=t.XpG(2);t.R7$(2),t.Y8G("ngForOf",i.categories)}}function I(r,c){if(1&r&&(t.j41(0,"div",5),t.DNE(1,g,3,1,"ng-container",6),t.k0s()),2&r){const i=t.XpG(),_=t.sdS(5);t.R7$(),t.Y8G("ngIf",!i.show_order_details)("ngIfElse",_)}}function v(r,c){if(1&r){const i=t.RV6();t.qex(0),t.j41(1,"button",26),t.EFF(2," Cancel "),t.k0s(),t.j41(3,"button",27),t.bIt("click",function(){t.eBV(i);const m=t.XpG(2);return t.Njj(m.show_order_details=!0)}),t.EFF(4," Confirm "),t.k0s(),t.bVm()}if(2&r){const i=t.XpG(2);t.R7$(3),t.Y8G("disabled",!i.order.item_count)("matBadge",i.order.item_count)("matBadgeHidden",!i.order.item_count)}}function L(r,c){if(1&r){const i=t.RV6();t.j41(0,"button",28),t.bIt("click",function(){t.eBV(i);const m=t.XpG(2);return t.Njj(m.show_order_details=!1)}),t.EFF(1," Back "),t.k0s(),t.j41(2,"button",29),t.bIt("click",function(){t.eBV(i);const m=t.XpG(2);return t.Njj(m.saveOrder())}),t.EFF(3," Save Order "),t.k0s()}}function f(r,c){if(1&r&&(t.j41(0,"footer",25),t.DNE(1,v,5,3,"ng-container",6)(2,L,4,0,"ng-template",null,2,t.C5r),t.k0s()),2&r){const i=t.sdS(3),_=t.XpG();t.R7$(),t.Y8G("ngIf",!_.show_order_details)("ngIfElse",i)}}function l(r,c){if(1&r&&(t.j41(0,"div",30),t.nrm(1,"mat-spinner",31),t.j41(2,"p"),t.EFF(3),t.k0s()()),2&r){const i=t.XpG();t.R7$(3),t.JRh(i.loading)}}function a(r,c){if(1&r&&(t.j41(0,"div",35),t.EFF(1),t.k0s()),2&r){const i=t.XpG().$implicit,_=t.XpG(2);t.Y8G("matTooltip",_.optionsFor(i)),t.R7$(),t.Lme(" ",i.options.length," option",1===i.options.length?"":"s"," selected ")}}function p(r,c){if(1&r){const i=t.RV6();t.j41(0,"div",12)(1,"div",13)(2,"div",13),t.EFF(3),t.k0s(),t.DNE(4,a,2,3,"div",33),t.k0s(),t.j41(5,"div",15),t.EFF(6),t.nI1(7,"currency"),t.k0s(),t.j41(8,"a-counter",34),t.bIt("ngModelChange",function(m){const u=t.eBV(i).$implicit,O=t.XpG(2);return t.Njj(O.updateItemQuantity(u,m))}),t.k0s()()}if(2&r){const i=c.$implicit,_=t.XpG(2);t.R7$(3),t.JRh(i.name),t.R7$(),t.Y8G("ngIf",i.options.length),t.R7$(2),t.SpI(" ",t.i5U(7,4,i.total_cost/100,_.code)," "),t.R7$(2),t.Y8G("ngModel",i.quantity)}}function s(r,c){if(1&r&&(t.j41(0,"header",32)(1,"h3"),t.EFF(2,"Confirm Order"),t.k0s()(),t.j41(3,"div",10),t.DNE(4,p,9,7,"div",11),t.k0s()),2&r){const i=t.XpG();t.R7$(4),t.Y8G("ngForOf",i.order.items)}}let d=(()=>{class r extends N.Tv{get code(){return this._org.currency_code}constructor(i,_){super(),this._org=i,this._data=_,this.event=new t.bkB,this.loading="",this.menu_items={},this.categories=[],this.loading="Loading menu..."}ngOnInit(){var i=this;return(0,e.A)(function*(){i.loading="Loading menu...",i.order=new F.M(i._data.order),i.rules=yield i._data.getCateringConfig(i.order.event?.space?.level?.parent_id),i._data.menu.subscribe(_=>{i.loading="Loading menu...";const m=(0,N.Am)(_.map(O=>O.category)),u={};for(const O of m)u[O]=_.filter(Y=>Y.category===O&&(0,k.c)(Y,i.rules,i.order.event));i.categories=m,i.menu_items=u,i.updateMenuQuantities(),i.timeout("clear_loading",()=>i.loading="",1e3)})})()}addItem(i,_=!0){const m=this.order.items.find(u=>u.id===i.id&&u.options.length===u.options.reduce((O,Y)=>O+(i.options.find(w=>Y.id===w.id)?1:0),0));_&&i.options?.length?this._data.selectOptions(i.options).then(u=>{const O=new n.T({...i,options:u});this.addItem(O,!1)}):this.order=new F.M(m?{...this.order,items:this.order.items.filter(u=>!(u.id===i.id&&u.options_string===i.options_string)).concat([new n.T({...i,quantity:m.quantity+1})])}:{...this.order,items:this.order.items.concat([new n.T({...i,quantity:1})])}),this.updateMenuQuantities()}removeItem(i){this.order=new F.M({...this.order,items:this.order.items.filter(_=>_.id!==i.id&&_.options_string===i.options_string)}),this.updateMenuQuantities()}updateItemQuantity(i,_){const m=this.order.items.find(O=>O.id===i.id&&O.options_string===i.options_string);let u=[...this.order.items];u=m?this.order.items.filter(O=>!(O.id===i.id&&O.options_string===i.options_string)).concat([new n.T({...i,quantity:_})]):this.order.items.concat([new n.T({...i,quantity:_})]),u.sort((O,Y)=>O.name.localeCompare(Y.name)),this.order=new F.M({...this.order,items:u}),this.updateMenuQuantities()}updateMenuQuantities(){for(const i in this.menu_items)for(const _ of this.menu_items[i])_.quantity=this.order.items.reduce((m,u)=>u.id===_.id?m+u.quantity:m,0)}optionsFor(i){return i.options.map(_=>_.name).join("\n")}saveOrder(){this.event.emit({reason:"done",metadata:{order:this.order}})}confirmOrder(){this.show_order_details=!0}static#t=this.\u0275fac=function(_){return new(_||r)(t.rXU(A.yb),t.rXU(M.Vh))};static#e=this.\u0275cmp=t.VBU({type:r,selectors:[["app-catering-order-modal"]],outputs:{event:"event"},features:[t.Vt3],decls:6,vars:3,consts:[["load_state",""],["order_details",""],["order_actions",""],["class","main min-w-[20rem]",4,"ngIf","ngIfElse"],["class","flex items-center justify-center space-x-2 p-2 border-t border-base-200",4,"ngIf"],[1,"main","min-w-[20rem]"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[1,"list"],["item","","class","flex items-center p-2 border-b border-base-200",4,"ngFor","ngForOf"],["item","",1,"flex","items-center","p-2","border-b","border-base-200"],[1,"flex-1","w-1/2"],["class","text-xs no-underline",4,"ngIf"],[1,"bg-primary","text-xs","rounded","px-4","py-2","mx-2","text-white","font-medium"],["ngDefaultControl","",3,"ngModel","ngModelChange",4,"ngIf"],["class","flex items-center",4,"ngIf"],[1,"text-xs","no-underline"],["ngDefaultControl","",3,"ngModelChange","ngModel"],[1,"flex","items-center"],[3,"matTooltip"],["icon","","matRipple","",3,"disabled"],[1,"count","h-12","w-12","flex","items-center","justify-center"],["icon","","matRipple","",3,"click"],[1,"flex","items-center","justify-center","space-x-2","p-2","border-t","border-base-200"],["btn","","matRipple","","mat-dialog-close","",1,"inverse"],["confirm","","btn","","matRipple","","matBadgeColor","warn",3,"click","disabled","matBadge","matBadgeHidden"],["matRipple","",1,"inverse",3,"click"],["save","","btn","","matRipple","",3,"click"],[1,"flex","flex-col","w-64","p-8","items-center","space-y-2"],["diameter","32"],[1,"h-[3.25rem]"],["class","text-xs underline",3,"matTooltip",4,"ngIf"],[3,"ngModelChange","ngModel"],[1,"text-xs","underline",3,"matTooltip"]],template:function(_,m){if(1&_&&t.DNE(0,I,2,2,"div",3)(1,f,4,2,"footer",4)(2,l,4,1,"ng-template",null,0,t.C5r)(4,s,5,1,"ng-template",null,1,t.C5r),2&_){const u=t.sdS(3);t.Y8G("ngIf",!m.loading)("ngIfElse",u),t.R7$(),t.Y8G("ngIf",!m.loading)}},dependencies:[B.Sq,B.bT,K.mq,K.T8,M.tx,R.oV,j.me,j.BC,j.vS,C.R,D.r6,P.LG,U.s,B.oe],styles:[".list[_ngcontent-%COMP%]{height:24em;min-width:32em;max-width:calc(100vw - 1em)}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:12em}input[_ngcontent-%COMP%]{position:relative;width:100%;padding:1em;border:none;border-radius:0!important;border-top:1px solid #ccc;border-bottom:1px solid #ccc;outline:none;font-size:1em}input[_ngcontent-%COMP%]:focus{border:none;border-top:2px solid var(--s);border-bottom:2px solid var(--s);box-shadow:none}input.error[_ngcontent-%COMP%]::placeholder{color:rgba(var(--error),.45)}\n\n/*# sourceMappingURL=catering-order-modal.component.ts-angular-inline--54.css.map*/"]})}return r})()},7707:(J,W,o)=>{o.d(W,{C:()=>$});var e=o(8559),t=o(2587),M=o(4217),N=o(316),n=o(7024),F=o(3804),A=o(4456),k=o(9434),B=o(5060);function K(E,y){if(1&E&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"currency"),e.k0s()),2&E){const h=e.XpG().$implicit,x=e.XpG(3);e.R7$(),e.SpI(" +",e.i5U(2,1,h.unit_price/100,x.code)," ")}}function R(E,y){if(1&E&&(e.j41(0,"mat-radio-button",14)(1,"div",15)(2,"div",16),e.EFF(3),e.k0s(),e.DNE(4,K,3,4,"div",17),e.k0s()()),2&E){const h=y.$implicit;e.Y8G("value",h.id),e.R7$(3),e.SpI(" ",h.name," "),e.R7$(),e.Y8G("ngIf",h.unit_price)}}function j(E,y){if(1&E){const h=e.RV6();e.qex(0),e.j41(1,"mat-radio-group",10),e.bIt("ngModelChange",function(T){e.eBV(h);const G=e.XpG().$implicit,g=e.XpG();return e.Njj(g.updateGroupOption(G,T))}),e.j41(2,"mat-radio-button",11)(3,"span",12),e.EFF(4,"None"),e.k0s()(),e.DNE(5,R,5,3,"mat-radio-button",13),e.k0s(),e.bVm()}if(2&E){const h=e.XpG().$implicit;e.R7$(5),e.Y8G("ngForOf",null==h?null:h.options)}}function C(E,y){if(1&E&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"currency"),e.k0s()),2&E){const h=e.XpG().$implicit,x=e.XpG(3);e.R7$(),e.SpI(" +",e.i5U(2,1,h.unit_price/100,x.code)," ")}}function D(E,y){if(1&E){const h=e.RV6();e.j41(0,"mat-checkbox",20),e.mxI("ngModelChange",function(T){const G=e.eBV(h).$implicit,g=e.XpG(3);return e.DH7(g.option_state[G.id],T)||(g.option_state[G.id]=T),e.Njj(T)}),e.j41(1,"div",15)(2,"div",16),e.EFF(3),e.k0s(),e.DNE(4,C,3,4,"div",17),e.k0s()()}if(2&E){const h=y.$implicit,x=e.XpG(3);e.R50("ngModel",x.option_state[h.id]),e.R7$(3),e.SpI(" ",h.name," "),e.R7$(),e.Y8G("ngIf",h.unit_price)}}function P(E,y){if(1&E&&e.DNE(0,D,5,3,"mat-checkbox",19),2&E){const h=e.XpG().$implicit;e.Y8G("ngForOf",null==h?null:h.options)}}function U(E,y){if(1&E&&(e.j41(0,"div",6)(1,"div",7),e.EFF(2),e.k0s(),e.j41(3,"div",8),e.DNE(4,j,6,1,"ng-container",9)(5,P,1,1,"ng-template",null,0,e.C5r),e.k0s()()),2&E){const h=y.$implicit,x=e.sdS(6);e.BMQ("group",h.name),e.R7$(2),e.JRh(h.name),e.R7$(2),e.Y8G("ngIf",!h.multiple)("ngIfElse",x)}}let $=(()=>{class E{constructor(h){this._data=h,this.event=new e.bkB,this.option_state={},this.code=this._data.code;const x=(0,M.Am)(this._data.options.map(G=>G.group||"Other")),T=[];for(const G of x){const g=this._data.options.filter(I=>I.group===G);T.push({name:G,multiple:!!g.find(I=>I.multiple),options:g})}this.groups=T}updateGroupOption(h,x){for(const T of h.options)this.option_state[T.id]=T.id===x}saveOptions(){const h=this._data.options.filter(x=>this.option_state[x.id]);this.event.emit({reason:"done",metadata:{options:h}})}static#t=this.\u0275fac=function(x){return new(x||E)(e.rXU(t.Vh))};static#e=this.\u0275cmp=e.VBU({type:E,selectors:[["app-catering-options-modal"]],outputs:{event:"event"},decls:11,vars:1,consts:[["multi_options",""],["icon","","mat-dialog-close",""],[1,"overflow-auto"],["class","pt-1 pb-2 border-b border-base-200",4,"ngFor","ngForOf"],[1,"p-2"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"pt-1","pb-2","border-b","border-base-200"],[1,"font-medium","p-2","capitalize"],[1,"flex","flex-col","pl-6"],[4,"ngIf","ngIfElse"],["aria-label","Select an option","ngModel","",1,"flex","flex-col",3,"ngModelChange"],["value","",1,"my-1","mx-0"],[1,"font-medium","p-2"],["class","my-1 mx-0",3,"value",4,"ngFor","ngForOf"],[1,"my-1","mx-0",3,"value"],[1,"flex","items-center","justify-center"],[1,"font-medium","p-2","flex-1","w-1/2"],["class","opacity-60 text-xs",4,"ngIf"],[1,"opacity-60","text-xs"],[3,"ngModel","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModelChange","ngModel"]],template:function(x,T){1&x&&(e.j41(0,"header")(1,"h3"),e.EFF(2,"Select options"),e.k0s(),e.j41(3,"button",1)(4,"app-icon"),e.EFF(5,"close"),e.k0s()()(),e.j41(6,"main",2),e.DNE(7,U,7,4,"div",3),e.k0s(),e.j41(8,"footer",4)(9,"button",5),e.bIt("click",function(){return T.saveOptions()}),e.EFF(10," Save "),e.k0s()()),2&x&&(e.R7$(7),e.Y8G("ngForOf",T.groups))},dependencies:[N.Sq,N.bT,t.tx,n.So,F.VT,F._g,A.BC,A.vS,k.R,B.r6,N.oe],styles:["main[_ngcontent-%COMP%]{min-height:24em;width:24rem;max-width:calc(100vw - 2rem)}\n\n/*# sourceMappingURL=catering-order-options-modal.component.ts-angular-inline--55.css.map*/"]})}return E})()},8197:(J,W,o)=>{o.d(W,{Q:()=>x});var e=o(9204),t=o(521),M=o(2175),N=o(1536),n=o(9803),F=o(1963),A=o(9314),k=o(5443),B=o(6e3),K=o(7841),R=o(9908),j=o(3240),C=o(6441),D=o(6671),P=o(2333),U=o(1416),$=o(6727),E=o(5555),y=o(8559);let x=(()=>{class T extends P.Tv{get filters(){return this._filters.getValue()}set filters(g){this._filters.next(g)}constructor(){super(),this._poll=new t.t(0),this._loading=new t.t(!1),this._filters=new t.t({}),this.orders=(0,M.zV)([this._filters,this._poll]).pipe((0,n.B)(1e3),(0,F.n)(([{date:g,zones:I}])=>{this._loading.next(!0);const v=(0,R._)((0,j.o)(g||Date.now())),L=(0,R._)((0,C.D)(g||Date.now()));return(0,U.UU)({zone_ids:(I||[]).join(","),period_start:v,period_end:L}).pipe((0,A.W)(()=>(0,N.of)([])),(0,k.T)(f=>(0,P.Bq)(f.map(l=>l.valid_catering.map(a=>new E.M({...a,event:l}))))),(0,k.T)(f=>f.filter(l=>(0,D.GP)(l.deliver_at,"yyyy-MM-dd")===(0,D.GP)(1e3*v,"yyyy-MM-dd"))))}),(0,B.M)(()=>this._loading.next(!1)),(0,K.t)(1)),this.loading=this._loading.asObservable(),this.filtered=this.orders.pipe((0,k.T)(g=>g.filter(I=>function h(T,G){const g=(G.search||"").toLowerCase();return!!T.items.find(I=>I.name.toLowerCase().includes(g)||!!I.options.find(v=>v.name.toLowerCase().includes(g)))}(I,this._filters.getValue())).sort((I,v)=>I.deliver_at-v.deliver_at))),this.subscription("changes",this.orders.subscribe())}startPolling(g=15e3){this.interval("polling",()=>this._poll.next((new Date).valueOf()),g)}stopPolling(){this.clearInterval("polling")}updateStatus(g,I){var v=this;return(0,e.A)(function*(){g.status=I;const L=new E.M({...g,status:I,event:null}),f=[...(g.event.extension_data.catering||[]).filter(s=>s.id!==g.id),L].map(s=>new E.M({...s})),l=new $.L({...g.event,catering:f}),a=l?.resources[0]?.id||l?.system?.id,p=yield(0,U.zZ)(l.id,a,l.extension_data).toPromise();return v.timeout("refresh-list",()=>v._poll.next(Date.now()),1e3),g.status=I,p})()}static#t=this.\u0275fac=function(I){return new(I||T)};static#e=this.\u0275prov=y.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()},2201:(J,W,o)=>{o.d(W,{_:()=>v});var e=o(9204),t=o(3998),M=o(521),N=o(2175),n=o(1536),F=o(8627),A=o(1963),k=o(9314),B=o(5443),K=o(6e3),R=o(7841),j=o(7871),C=o(3602),D=o(2333),P=o(2185),U=o(807),$=o(7053),E=o(6815),y=o(5892),h=o(5555),x=o(2912),T=o(7707),G=o(6095),g=o(8559),I=o(2587);let v=(()=>{class L extends D.Tv{get is_editable(){return!this.zone||this.zone===this._org.building?.id}get categories(){const l=this._menu.getValue();return(0,D.Am)(l.map(a=>a.category))}constructor(l,a,p){var s;super(),s=this,this._org=l,this._dialog=a,this._settings=p,this._updated=new M.t(0),this._menu=new M.t([]),this._loading=new M.t(!1),this._currency=new M.t("USD"),this._change=new M.t(0),this.menu=this._menu.asObservable(),this.loading=this._loading.asObservable(),this.currency=this._currency.asObservable(),this.settings=(0,N.zV)([this._org.active_building,this._change]).pipe((0,F.p)(([d])=>!!d),(0,A.n)(([d])=>(0,t.bpY)(d.id,"catering-settings").pipe((0,k.W)(r=>(0,n.of)({})))),(0,B.T)(d=>d.details||{}),(0,K.M)(d=>this._settings.post("require_catering_notes",!!d?.require_notes)),(0,R.t)(1)),this.charge_codes=this.settings.pipe((0,B.T)(d=>d.charge_codes||[])),this.availability=this.settings.pipe((0,B.T)(d=>d.disabled_rooms||[])),this.zone="",this.subscription("building",this._org.active_building.subscribe(function(){var d=(0,e.A)(function*(r){if(r){const c=(yield s.getCateringForZone(r.id)).map(i=>new y.T(i));s._currency.next(s._settings.get("app.currency")||r.currency||"USD"),s._menu.next(c)}});return function(r){return d.apply(this,arguments)}}()))}manageCateringOrder(l){var a=this;return(0,e.A)(function*(){const p=a._dialog.open(x.g,{data:{code:a._currency.getValue(),order:l,menu:a.menu,loading:a.loading,getCateringConfig:d=>a.getCateringConfig(d),selectOptions:d=>a.selectOptions(d)}}),s=yield Promise.race([p.componentInstance.event.pipe((0,j.$)(d=>"done"===d.reason)).toPromise(),p.afterClosed().toPromise()]);return p.close(),s?.metadata?.order||l})()}addItem(l=new y.T){var a=this;return(0,e.A)(function*(){const p=a._dialog.open(U.d,{data:{item:l,categories:a.categories}}),s=yield Promise.race([p.componentInstance.event.pipe((0,j.$)(c=>"done"===c.reason)).toPromise(),p.afterClosed().toPromise()]);if("done"!==s?.reason)return;const d=a._menu.getValue(),r=d.findIndex(c=>c.id===l.id);r>=0?d.splice(r,1,s.metadata.item):d.push(s.metadata.item),a.updateMenu(a._org.building.id,d).then(()=>{a._menu.next([...d]),p.close()},()=>p.componentInstance.loading=!1)})()}updateItem(l){const a=this._menu.getValue(),p=a.findIndex(s=>s.id===l.id);p>=0?a.splice(p,1,l):a.push(l),this.updateMenu(this._org.building.id,a).then(()=>this._menu.next([...a]))}addOption(l,a={}){var p=this;return(0,e.A)(function*(){const s=(0,D.Am)(l.options.map(_=>_.group)),d=p._dialog.open($.e,{data:{parent:l,option:a,types:s}}),r=yield Promise.race([d.componentInstance.event.pipe((0,j.$)(_=>"done"===_.reason)).toPromise(),d.afterClosed().toPromise()]);if("done"!==r?.reason)return;const c=p._menu.getValue(),i=c.findIndex(_=>_.id===l.id);i>=0?c.splice(i,1,r.metadata.item):c.push(r.metadata.item),p.updateMenu(p._org.building.id,c).then(()=>{p._menu.next([...c]),d.close()},()=>d.componentInstance.loading=!1)})()}selectOptions(l){var a=this;return(0,e.A)(function*(){const p=a._dialog.open(T.C,{data:{code:a._currency.getValue(),options:l}}),s=yield Promise.race([p.componentInstance.event.pipe((0,j.$)(d=>"done"===d.reason)).toPromise(),p.afterClosed().toPromise()]);return"done"!==s?.reason?[]:(p.close(),s.metadata.options)})()}deleteItem(l){var a=this;return(0,e.A)(function*(){const p=yield(0,D.GE)({title:"Delete Catering Item",content:`Are you sure you wish to remove the catering item ${l.name} from the menu?`,icon:{type:"icon",class:"material-icons",content:"delete"}},a._dialog);if("done"!==p.reason)return;p.loading("Removing catering item...");const s=a._menu.getValue().filter(d=>l.id!==d.id);a.updateMenu(a._org.building.id,s).then(()=>{a._menu.next([...s]),p.close()},()=>p.loading(""))})()}deleteOption(l,a){var p=this;return(0,e.A)(function*(){const s=yield(0,D.GE)({title:"Delete Catering Item Option",content:`Are you sure you wish to remove the catering option "${a.name}" from "${l.name}"?`,icon:{type:"icon",class:"material-icons",content:"delete"}},p._dialog);if("done"!==s.reason)return;s.loading("Removing catering item option...");const d=p._menu.getValue();d.splice(d.findIndex(r=>r.id===l.id),1,new y.T({...l,options:l.options.filter(r=>r.id!==a.id)})),p.updateMenu(p._org.building.id,d).then(()=>{p._menu.next([...d]),s.close()},()=>s.loading(""))})()}editConfig(){var l=this;return(0,e.A)(function*(){const a=yield l.getCateringConfig(l._org.building.id),{require_notes:p}=yield l.settings.pipe((0,C.s)(1)).toPromise(),s=l._menu.getValue(),d=(0,D.Am)((0,D.Bq)(s.map(i=>[i.category,...i.tags]))),r=l._dialog.open(E.Rt,{data:{config:a,types:d,require_notes:p,saveNotes:i=>l.saveSettings({require_notes:i})}}),c=yield Promise.race([r.componentInstance.event.pipe((0,j.$)(i=>"done"===i.reason)).toPromise(),r.afterClosed().toPromise()]);"done"===c?.reason&&l.updateConfig(l._org.building.id,c.metadata).then(()=>r.close(),()=>r.componentInstance.loading=!1)})()}importMenu(){var l=this;return(0,e.A)(function*(){const a=l._dialog.open(G.k),p=yield Promise.race([a.componentInstance.event.pipe((0,j.$)(c=>"done"===c.reason)).toPromise(),a.afterClosed().toPromise()]);if("done"!==p?.reason)return;a.componentInstance.loading="Updating menu...";const s=l._menu.getValue(),d=l._org.building,r=(0,D.Am)(p.metadata.concat(s),"id");yield l.updateMenu(d.id,r).catch(c=>{throw(0,D.UG)("Error importing catering menu"),a.close(),c}),(0,D.VX)(`Successfully imported catering menu. ${p.metadata.length} item(s) added.`),a.close()})()}updateMenu(l,a){return(0,t.D58)(l,{id:l,name:"catering",details:a,description:`Catering menu for ${l}`}).toPromise()}saveSettings(l){var a=this;return(0,e.A)(function*(){const p=yield a.settings.pipe((0,C.s)(1)).toPromise(),s=yield(0,t.D58)(a._org.building.id,{id:a._org.building.id,name:"catering-settings",details:{...p,...l},description:`Catering settings for ${a._org.building.id}`}).toPromise();return a._change.next(Date.now()),s})()}getCateringForZone(l){return(0,e.A)(function*(){const a=(yield(0,t.bpY)(l,"catering").toPromise()).details;return a instanceof Array?a:[]})()}getCateringConfig(l=this._org.building.id){return(0,e.A)(function*(){const a=(yield(0,t.bpY)(l,"catering_config").toPromise()).details;return a instanceof Array?a:[]})()}updateConfig(l,a){return(0,t.D58)(l,{id:l,name:"catering_config",details:a,description:`Catering menu config for ${l}`}).toPromise()}addItemToOrder(l,a){let p=l.items;const s=p.find(r=>r.id===a.id&&a.options?.length===r.options?.reduce((c,i)=>c+(a.options.find(_=>i.id===_.id)?1:0),0));return s?s.quantity+=1:p=p.concat([new y.T({...a,quantity:1})]),new h.M({...l,items:p,event:null})}static#t=this.\u0275fac=function(a){return new(a||L)(g.KVO(P.yb),g.KVO(I.bZ),g.KVO(D.h$))};static#e=this.\u0275prov=g.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}return L})()},1074:(J,W,o)=>{o.d(W,{T:()=>e});const e=[{id:"pending",name:"Pending",icon:{class:"custom-pending"},colour:"#ccc"},{id:"accepted",name:"Accepted",icon:{class:"custom-accepted"},colour:"#3996B6"},{id:"preparing",name:"Preparing",icon:{class:"custom-preparing"},colour:"#E7536B"},{id:"ready",name:"Ready",icon:{class:"custom-ready"},colour:"#FFD028"},{id:"delivered",name:"Delivered",icon:{class:"custom-delivered"},colour:"#75BB43"},{id:"cancelled",name:"Cancelled",icon:{class:"custom-cancelled"},colour:"#747474"}]}}]);
//# sourceMappingURL=default-libs_catering_src_index_ts.js.map