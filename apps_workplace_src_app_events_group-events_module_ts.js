"use strict";(self.webpackChunkworkplace=self.webpackChunkworkplace||[]).push([["apps_workplace_src_app_events_group-events_module_ts"],{71261:(dt,T,r)=>{r.r(T),r.d(T,{GroupEventsModule:()=>lt});var d=r(26575),v=r(28849),F=r(99794),U=r(39304),M=r(78466),f=r(82767),G=r(93121),C=r(67343),O=r(57016),u=r(4512),g=r(70462),h=r(28159),L=r(85046),J=r(36520),p=r(47422),P=r(15746),A=r(680),t=r(29039);let x=(()=>{class o{constructor(s,n){this._org=s,this._settings=n,this._options=new g.X({date:Date.now()}),this._filters=new g.X({categories:[],tags:[]}),this._tag_list=new g.X([]),this.filters=this._filters.asObservable(),this.tags=this._tag_list.asObservable(),this.events=(0,h.aj)([this._org.active_building,this._options]).pipe((0,L.h)(([e])=>!!e),(0,J.w)(([e,i])=>(0,M.F2)({period_start:(0,C.Z)((0,O.Z)(Math.max(Date.now(),i.date))),period_end:(0,C.Z)((0,u.Z)(i.end||i.date)),type:"group-event",zones:this._settings.get("app.use_region")?e.parent_id:e.id})),(0,p.U)(e=>e.filter(i=>"PRIVATE"!==i.permission).sort((i,a)=>i.date-a.date)),(0,P.b)(e=>{const i=this._tag_list.getValue(),a=e.map(c=>c.tags).flat();this._tag_list.next((0,f.Tw)([...i,...a]))}),(0,A.d)(1)),this.filtered_events=(0,h.aj)([this.events,this._filters]).pipe((0,p.U)(([e,{tags:i}])=>{const a=i.map(c=>c.toLowerCase());return e.filter(c=>{const ct=c.tags.map(y=>y.toLowerCase());return a.every(y=>ct.includes(y))&&c.date_end>Date.now()})}),(0,A.d)(1)),this.options=this._options.asObservable()}setOptions(s){this._options.next({...this._options.value,...s})}setFilters(s){this._filters.next({...this._filters.value,...s})}static#t=this.\u0275fac=function(n){return new(n||o)(t.LFG(G.w7),t.LFG(f.gb))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var D=r(23299),S=r(89252),N=r(32522),b=r(71670),m=r(65822),Q=r(2848),j=r(97929),Z=r(30873),E=r(81435),w=r(46939),_=r(10257),Y=r(71268),I=r(96355),$=r(56658),R=r(47871);function X(o,l){if(1&o&&(t.TgZ(0,"mat-option",12),t._uU(1),t.qZA()),2&o){const s=l.$implicit;t.Q6J("value",s.id),t.xp6(),t.hij(" ",s.display," ")}}function k(o,l){if(1&o){const s=t.EpF();t.TgZ(0,"button",15),t.NdJ("click",function(){const i=t.CHM(s).$implicit,a=t.oxw(2);return t.KtG(a.toggleTag(i))}),t.TgZ(1,"mat-checkbox",16),t.ALo(2,"async"),t._uU(3),t.qZA()()}if(2&o){const s=l.$implicit,n=t.oxw(2);let e;t.xp6(),t.Q6J("ngModel",null==(e=t.lcZ(2,2,n.filters))||null==e.tags?null:e.tags.includes(s)),t.xp6(2),t.hij(" ",s," ")}}function z(o,l){if(1&o&&(t.TgZ(0,"div",13)(1,"h3"),t._uU(2,"Tags"),t.qZA(),t.YNc(3,k,4,4,"button",14),t.ALo(4,"async"),t.qZA()),2&o){const s=t.oxw();t.xp6(3),t.Q6J("ngForOf",t.lcZ(4,1,s.tags))}}let W=(()=>{class o extends f.cx{constructor(s,n){super(),this._settings=s,this._state=n,this.period=new g.X("week"),this.period_list=[],this.options=this._state.options,this.filters=this._state.filters,this.tags=this._state.tags}ngOnInit(){this.subscription("period",this.period.subscribe(()=>{this._generatePeriods(),this.period_list.length&&(this.setPeriod(this.period_list[0].id),this.selected_range=this.period_list[0].id)})),this._generatePeriods(),this.period_list.length&&(this.setPeriod(this.period_list[0].id),this.selected_range=this.period_list[0].id)}toggleTag(s){var n=this;return(0,b.Z)(function*(){const e=(yield n.filters.pipe((0,w.q)(1)).toPromise())?.tags||[];e.includes(s)?n._state.setFilters({tags:e.filter(i=>i!==s)}):n._state.setFilters({tags:[...e,s]})})()}setPeriodFromDate(s){for(const n of this.period_list)if(s>=n.start&&s<=n.end)return this.selected_range=n.id,void this.setPeriod(n.id)}setPeriod(s){const{start:n,end:e}=this.period_list.find(i=>i.id===s);this._state.setOptions({date:n,end:e})}_generatePeriods(){const s=[],n=this.period.value;let e=Date.now();const i=(0,m.Z)(e,360).valueOf(),a=this._settings.get("app.week_start")||0;for("month"===n?e=(0,Q.Z)(e).valueOf():"week"===n&&(e=(0,j.Z)(e,{weekStartsOn:a}).valueOf());e<i;)if("week"===n){const c=(0,u.Z)((0,m.Z)(e,6)).valueOf();s.push({id:e,start:e,end:c,display:`${(0,Z.Z)(Math.max(Date.now(),e),"EEE, do MMM")} \u2013 ${(0,Z.Z)(c,"do MMM")}`}),e=(0,m.Z)(e,7).valueOf()}else{if("month"!==n)break;{const c=(0,u.Z)((0,m.Z)((0,E.Z)(e,1),-1)).valueOf();s.push({id:e,start:e,end:c,display:`${(0,Z.Z)(e,"MMMM yyyy")}`}),e=(0,E.Z)(e,1).valueOf()}}this.period_list=s}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(f.gb),t.Y36(x))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["group-events-sidebar"]],features:[t.qOj],decls:21,vars:16,consts:[[1,"flex","flex-col","bg-base-100","w-[18rem]","h-full"],[1,"flex","items-center","space-x-2","p-2"],["btn","","matRipple","",1,"flex-1","rounded-3xl",3,"click"],[1,"flex","flex-col","items-center","space-y-2","pb-2","px-2"],["appearance","outline",1,"w-full","no-subscript"],["placeholder","Select Period",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"border-base-200","w-[calc(100%-1rem)]","mx-auto"],[3,"ngModel","ngModelChange"],[1,"flex","flex-col","flex-1","overflow-auto"],[1,"text-lg","font-medium","p-4"],["class","flex flex-col space-y-2 px-4",4,"ngIf"],[3,"value"],[1,"flex","flex-col","space-y-2","px-4"],["matRipple","","class","flex items-center rounded w-full text-left",3,"click",4,"ngFor","ngForOf"],["matRipple","",1,"flex","items-center","rounded","w-full","text-left",3,"click"],[3,"ngModel"]],template:function(n,e){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"button",2),t.NdJ("click",function(){return e.period.next("week")}),t.ALo(3,"async"),t._uU(4," Week "),t.qZA(),t.TgZ(5,"button",2),t.NdJ("click",function(){return e.period.next("month")}),t.ALo(6,"async"),t._uU(7," Month "),t.qZA()(),t.TgZ(8,"div",3)(9,"mat-form-field",4)(10,"mat-select",5),t.NdJ("ngModelChange",function(a){return e.selected_range=a})("ngModelChange",function(a){return e.setPeriod(a)}),t.YNc(11,X,2,2,"mat-option",6),t.qZA()()(),t._UZ(12,"hr",7),t.TgZ(13,"date-calendar",8),t.NdJ("ngModelChange",function(a){return e.setPeriodFromDate(a)}),t.ALo(14,"async"),t.qZA(),t._UZ(15,"hr",7),t.TgZ(16,"div",9)(17,"h2",10),t._uU(18,"Filters"),t.qZA(),t.YNc(19,z,5,3,"div",11),t.ALo(20,"async"),t.qZA()()),2&n){let i;t.xp6(2),t.ekj("inverse","week"!==t.lcZ(3,8,e.period)),t.xp6(3),t.ekj("inverse","month"!==t.lcZ(6,10,e.period)),t.xp6(5),t.Q6J("ngModel",e.selected_range),t.xp6(),t.Q6J("ngForOf",e.period_list),t.xp6(2),t.Q6J("ngModel",t.lcZ(14,12,e.options).date),t.xp6(6),t.Q6J("ngIf",null==(i=t.lcZ(20,14,e.tags))?null:i.length)}},dependencies:[d.sg,d.O5,v.JJ,v.On,_.ey,Y.KE,I.gD,_.wG,$.oG,R.O,d.Ov]})}return o})();var B=r(93009),K=r(94888);function H(o,l){if(1&o){const s=t.EpF();t.TgZ(0,"div",5)(1,"div",6),t._uU(2),t.qZA(),t.TgZ(3,"button",7),t.NdJ("click",function(){const i=t.CHM(s).$implicit,a=t.oxw();return t.KtG(a.removeTag(i))}),t.TgZ(4,"app-icon"),t._uU(5,"close"),t.qZA()()()}if(2&o){const s=l.$implicit;t.xp6(2),t.Oqu(s)}}const V=()=>[];let q=(()=>{class o{constructor(s){this._state=s,this.options=this._state.options,this.filters=this._state.filters,this.this_period=this._state.options.pipe((0,p.U)(({date:n,end:e})=>Date.now()>=(0,O.Z)(n).valueOf()&&Date.now()<(0,u.Z)(e||n).valueOf())),this.period=this._state.options.pipe((0,p.U)(({date:n,end:e})=>Math.abs((0,B.Z)(n,e||Date.now()))>7?"month":"week"))}removeTag(s){var n=this;return(0,b.Z)(function*(){const e=(yield n.filters.pipe((0,w.q)(1)).toPromise())?.tags||[];n._state.setFilters({tags:e.filter(i=>i!==s)})})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(x))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["group-events-filters-list"]],decls:15,vars:22,consts:[[1,"my-2","w-[63rem]","max-w-full","mx-auto","border","border-base-300","p-4","bg-base-100","rounded"],[1,"flex","items-center","justify-between","space-x-2","mb-4"],[1,"flex","flex-wrap"],[1,"flex","items-center","px-4","py-3","rounded-3xl","border","border-base-400","m-1","text-sm"],["class","flex items-center pl-4 pr-1 rounded-3xl border border-base-400 m-1",4,"ngFor","ngForOf"],[1,"flex","items-center","pl-4","pr-1","rounded-3xl","border","border-base-400","m-1"],[1,"mr-2","flex-1","text-sm"],["icon","","matRipple","",3,"click"]],template:function(n,e){if(1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div"),t._uU(3),t.ALo(4,"async"),t.ALo(5,"async"),t.qZA()(),t.TgZ(6,"div",2)(7,"div",3),t._uU(8),t.ALo(9,"date"),t.ALo(10,"async"),t.ALo(11,"date"),t.ALo(12,"async"),t.qZA(),t.YNc(13,H,6,1,"div",4),t.ALo(14,"async"),t.qZA()()),2&n){let i,a;t.xp6(3),t.AsE(" ",t.lcZ(4,5,e.this_period)?"This":"Upcoming"," ","week"===t.lcZ(5,7,e.period)?"Week":"Month"," "),t.xp6(5),t.AsE(" ",t.xi3(9,9,null==(i=t.lcZ(10,12,e.options))?null:i.date,"MMM d, y")," \u2013 ",t.xi3(11,14,null==(i=t.lcZ(12,17,e.options))?null:i.end,"MMM d, y")," "),t.xp6(5),t.Q6J("ngForOf",(null==(a=t.lcZ(14,19,e.filters))?null:a.tags)||t.DdM(21,V))}},dependencies:[d.sg,K.o,_.wG,d.Ov,d.uU]})}return o})();const tt=["group-events",""];function et(o,l){if(1&o&&(t._UZ(0,"group-event-card",5),t.ALo(1,"async")),2&o){const s=t.oxw();t.Q6J("event",t.lcZ(1,2,s.featured))("featured",!0)}}function st(o,l){1&o&&t._UZ(0,"group-event-card",8),2&o&&t.Q6J("event",l.$implicit)}function nt(o,l){if(1&o&&(t.ynx(0),t.TgZ(1,"div",6),t.YNc(2,st,1,1,"group-event-card",7),t.ALo(3,"async"),t.qZA(),t.BQk()),2&o){const s=t.oxw();t.xp6(2),t.Q6J("ngForOf",t.lcZ(3,1,s.events_without_featured))}}function ot(o,l){1&o&&(t.TgZ(0,"div",9),t._UZ(1,"img",10),t.TgZ(2,"div",11),t._uU(3," No events for the selected time period "),t.qZA(),t.TgZ(4,"div",12),t._uU(5," Expand you search or try again "),t.qZA()())}let it=(()=>{class o extends f.cx{constructor(s){super(),this._state=s,this.event_list=this._state.filtered_events,this.featured=this.event_list.pipe((0,p.U)(n=>n.find(e=>e.extension_data?.featured||e.featured))),this.events_without_featured=(0,h.aj)([this.event_list,this.featured]).pipe((0,p.U)(([n,e])=>n.filter(i=>i.id!==e?.id)))}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(x))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","group-events",""]],features:[t.qOj],attrs:tt,decls:12,vars:7,consts:[[1,"flex","flex-1","h-1/2","bg-base-200"],[1,"w-1/2","flex-1","h-full","overflow-auto","p-4"],["class","my-2 mx-auto w-[64rem] max-w-full",3,"event","featured",4,"ngIf"],[4,"ngIf","ngIfElse"],["no_events",""],[1,"my-2","mx-auto","w-[64rem]","max-w-full",3,"event","featured"],[1,"flex","flex-wrap","mt-2","w-[64rem]","max-w-full","mx-auto"],["class","m-2",3,"event",4,"ngFor","ngForOf"],[1,"m-2",3,"event"],[1,"flex","flex-col","items-center","justify-center","w-full","h-full","space-y-2"],["src","assets/icons/no-results.svg",1,"w-32"],[1,"font-medium"],[1,"opacity-30"]],template:function(n,e){if(1&n&&(t._UZ(0,"topbar"),t.TgZ(1,"main",0),t._UZ(2,"group-events-sidebar"),t.TgZ(3,"div",1),t._UZ(4,"group-events-filters-list"),t.YNc(5,et,2,4,"group-event-card",2),t.ALo(6,"async"),t.YNc(7,nt,4,3,"ng-container",3),t.ALo(8,"async"),t.YNc(9,ot,6,0,"ng-template",null,4,t.W1O),t.qZA()(),t._UZ(11,"footer-menu")),2&n){const i=t.MAs(10);let a;t.xp6(5),t.Q6J("ngIf",t.lcZ(6,3,e.featured)),t.xp6(2),t.Q6J("ngIf",null==(a=t.lcZ(8,5,e.event_list))?null:a.length)("ngIfElse",i)}},dependencies:[d.sg,d.O5,D.o,S.i,N.z,W,q,d.Ov],styles:["[_nghost-%COMP%]{position:absolute;inset:0;overflow:hidden;display:flex;flex-direction:column}main[_ngcontent-%COMP%]{min-height:50%}.top[_ngcontent-%COMP%]{background-color:#007ac8}\n\n/*# sourceMappingURL=group-events.component.ts-angular-inline--136.css.map*/"]})}return o})();var rt=r(11894);const at=[{path:"",component:it}];let lt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#s=this.\u0275inj=t.cJS({imports:[d.ez,v.u5,rt.v,M.EP,U.W9,F.Bz.forChild(at)]})}return o})()}}]);
//# sourceMappingURL=apps_workplace_src_app_events_group-events_module_ts.js.map