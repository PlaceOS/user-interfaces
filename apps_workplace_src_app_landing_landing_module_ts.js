(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([["apps_workplace_src_app_landing_landing_module_ts"],{7105:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AppLandingModule:()=>H});var i=n(1511),s=n(6898),o=n(1781),a=n(4762),c=n(2619),r=n(6817),l=n(8512),u=n(878),p=n(7701),d=n(4689),g=n(7727),m=n(8303),h=n(3530),_=n(3835),v=n(9996),f=n(8125),Z=n(3730),b=n(4266),x=n(4587),y=n(3743),w=n(1496);let A=(()=>{class e extends Z.KG{constructor(e,t){super(),this._calendar=e,this._org=t,this._options=new l.X({}),this._free_spaces=new l.X([]),this._upcoming_events=new l.X([]),this._contacts=new l.X([]),this._level_occupancy=new l.X([]),this.free_spaces=this._free_spaces.asObservable(),this.upcoming_events=this._upcoming_events.asObservable(),this.contacts=this._contacts.asObservable(),this.options=this._options.asObservable(),this.search_results=this._options.pipe((0,p.b)(500),(0,d.w)(({search:e})=>e?(0,x.VE)(e):(0,u.of)([])),(0,g.K)(e=>[]),(0,m.d)(1)),this.level_occupancy=this._level_occupancy.asObservable(),this.init()}init(){return(0,a.mG)(this,void 0,void 0,function*(){if(yield this._org.initialised.pipe((0,h.P)(e=>e)).toPromise(),this.subscription("building",this._org.active_building.pipe((0,_.h)(e=>!!e)).subscribe(()=>this.updateBuildingMetadata())),!this._org.organisation.bindings.area_management)return;const e=(0,r.rTZ)(this._org.organisation.bindings.area_management,"AreaManagement").binding("overview");e.listen().subscribe(e=>this.updateOccupancy(e||{})),e.bind()})}setOptions(e){this._options.next(Object.assign(Object.assign({},this._options.getValue()),e))}pollFreeSpaces(e=1e4){this.updateFreeSpaces(),this.interval("free_spaces",()=>this.updateFreeSpaces(),e)}stopPollingFreeSpaces(){this.clearInterval("free_spaces")}pollUpcomingEvents(e=1e4){this.updateUpcomingEvents(),this.interval("upcoming_events",()=>this.updateUpcomingEvents(),e)}stopPollingUpcomingEvents(){this.clearInterval("upcoming_events")}updateContacts(){return(0,a.mG)(this,void 0,void 0,function*(){const e=yield(0,r.rlq)((0,Z.ar)().id,"contacts").toPromise();this._contacts.next((e.details instanceof Array?e.details:[]).map(e=>new x.n5(e)))})}addContact(e){return(0,a.mG)(this,void 0,void 0,function*(){let t=[...this._contacts.getValue()];t.push(e),t=(0,Z.Tw)(t,"email");const n=yield(0,r.Ymr)((0,Z.ar)().id,{name:"contacts",description:"Contacts for the User",details:t}).toPromise();this._contacts.next((n.details instanceof Array?n.details:[]).map(e=>new x.n5(e)))})}removeContact(e){return(0,a.mG)(this,void 0,void 0,function*(){let t=[...this._contacts.getValue()];t=t.filter(t=>t.email!==e.email);const n=yield(0,r.Ymr)((0,Z.ar)().id,{name:"contacts",description:"Contacts for the User",details:t}).toPromise();this._contacts.next((n.details instanceof Array?n.details:[]).map(e=>new x.n5(e)))})}updateOccupancy(e){return(0,a.mG)(this,void 0,void 0,function*(){const t=[...this._org.levels];t.sort((t,n)=>{var i,s;return(null===(i=e[t.id])||void 0===i?void 0:i.recommendation)-(null===(s=e[n.id])||void 0===s?void 0:s.recommendation)}),this._level_occupancy.next(t)})}updateFreeSpaces(){return(0,a.mG)(this,void 0,void 0,function*(){if(!this._org.building)return;const e=Math.floor((new Date).valueOf()/1e3),t=Math.floor((0,f.Z)(new Date).valueOf()/1e3),n=yield this._calendar.freeBusy({period_start:e,period_end:t,zone_ids:this._org.building.id}).pipe((0,v.U)(e=>e.filter(e=>!e.availability.length||e.availability.find(e=>"busy"!==e.status)))).toPromise();n.sort((e,t)=>e.capacity-t.capacity),this._free_spaces.next(n)})}updateUpcomingEvents(){return(0,a.mG)(this,void 0,void 0,function*(){const e=Math.floor((new Date).valueOf()/1e3),t=Math.floor((0,f.Z)(new Date).valueOf()/1e3),n=yield(0,b.u$)({period_start:e,period_end:t,calendars:(0,Z.ar)().email}).toPromise();this._upcoming_events.next(n)})}updateBuildingMetadata(){return(0,a.mG)(this,void 0,void 0,function*(){const e=this._org.building,t=yield(0,r.rlq)(e.id,"bindings").toPromise();if(!t.details.occupancy)return;const n=t.details.occupancy,i=(0,r.rTZ)(n.sys,n.module,n.index);i&&(this._occupancy_binding&&this._occupancy_binding.unbind(),this._occupancy_binding=i.binding("occupancy"),this._occupancy_binding.bind(),this.subscription("occupancy_binding",this._occupancy_binding.listen().subscribe(e=>{const t=Object.keys(e).map(t=>Object.assign({id:t},e[t]));t.sort((e,t)=>e.recommendation_factor-t.recommendation_factor),this._level_occupancy.next(t.map(e=>this._org.levelWithID([e.id])))})))})}}return e.\u0275fac=function(t){return new(t||e)(c.LFG(y.ot),c.LFG(w.w7))},e.\u0275prov=c.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var q=n(1522),U=n(1548);const T=function(){return["/explore"]},O=function(e){return{level:e}};function k(e,t){if(1&e&&(c.TgZ(0,"button",7),c._UZ(1,"div",8),c.TgZ(2,"div",9),c.TgZ(3,"div",10),c._uU(4),c.qZA(),c.TgZ(5,"div",11),c.TgZ(6,"app-icon",12),c._uU(7,"place"),c.qZA(),c.TgZ(8,"span"),c._uU(9,"Unknown Building"),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e){const e=t.$implicit;c.Q6J("routerLink",c.DdM(3,T))("queryParams",c.VKq(4,O,e.id)),c.xp6(4),c.hij(" ",e.display_name||e.name," ")}}function F(e,t){1&e&&(c.TgZ(0,"span",13),c._uU(1," No free spaces "),c.qZA())}const L=function(e){return{space:e}};function Q(e,t){if(1&e&&(c.TgZ(0,"button",7),c._UZ(1,"div",8),c.TgZ(2,"div",9),c.TgZ(3,"div",10),c._uU(4),c.qZA(),c.TgZ(5,"div",11),c.TgZ(6,"app-icon",12),c._uU(7,"place"),c.qZA(),c.TgZ(8,"span"),c._uU(9),c.qZA(),c.qZA(),c.qZA(),c.qZA()),2&e){const e=t.$implicit;c.Q6J("routerLink",c.DdM(4,T))("queryParams",c.VKq(5,L,e.email)),c.xp6(4),c.hij(" ",e.display_name||e.name," "),c.xp6(5),c.Oqu(e.level.display_name||e.level.name)}}function C(e,t){1&e&&(c.TgZ(0,"span",13),c._uU(1," No free rooms "),c.qZA())}let P=(()=>{class e{constructor(e){this._state=e,this.space_list=this._state.free_spaces,this.levels_free=this._state.level_occupancy}ngOnInit(){return(0,a.mG)(this,void 0,void 0,function*(){this._state.pollFreeSpaces()})}ngOnDestroy(){this._state.stopPollingFreeSpaces()}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(A))},e.\u0275cmp=c.Xpm({type:e,selectors:[["landing-availability"]],decls:17,vars:12,consts:[[1,"py-2"],[1,"sm:text-lg","font-medium","mb-2","sm:mb-4","px-4"],[1,"text-sm","sm:text-base","px-4"],[1,"w-full","overflow-auto","flex","items-center","space-x-4","px-4","py-2"],["matRipple","","class","flex items-center h-24 min-w-[12.5rem] rounded-lg bg-white shadow p-4 space-x-2",3,"routerLink","queryParams",4,"ngFor","ngForOf"],["class","text-dark-fade text-sm mb-2",4,"ngIf"],[1,"text-sm","sm:text-base","my-2","px-4"],["matRipple","",1,"flex","items-center","h-24","min-w-[12.5rem]","rounded-lg","bg-white","shadow","p-4","space-x-2",3,"routerLink","queryParams"],[1,"min-w-[4.5rem]","h-[4.5rem]","rounded","bg-gray-200"],[1,"text-left"],[1,"max-w-full","truncate","px-1.5"],[1,"max-w-full","truncate","text-sm","opacity-60","flex","items-center"],[1,"text-blue-500","text-lg"],[1,"text-dark-fade","text-sm","mb-2"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c._uU(2,"Available Now"),c.qZA(),c.TgZ(3,"div",2),c._uU(4,"Spaces"),c.qZA(),c.TgZ(5,"div",3),c.YNc(6,k,10,6,"button",4),c.ALo(7,"async"),c.YNc(8,F,2,0,"span",5),c.ALo(9,"async"),c.qZA(),c.TgZ(10,"div",6),c._uU(11,"Rooms"),c.qZA(),c.TgZ(12,"div",3),c.YNc(13,Q,10,7,"button",4),c.ALo(14,"async"),c.YNc(15,C,2,0,"span",5),c.ALo(16,"async"),c.qZA(),c.qZA()),2&e&&(c.xp6(6),c.Q6J("ngForOf",c.lcZ(7,4,t.levels_free)),c.xp6(2),c.Q6J("ngIf",!c.lcZ(9,6,t.levels_free).length),c.xp6(5),c.Q6J("ngForOf",c.lcZ(14,8,t.space_list)),c.xp6(2),c.Q6J("ngIf",!c.lcZ(16,10,t.space_list).length))},directives:[i.sg,i.O5,q.wG,s.rH,U.o],pipes:[i.Ov],styles:["*[_ngcontent-%COMP%]{flex-shrink:0}"]}),e})();var J=n(5980),S=n(5969);function Y(e,t){if(1&e&&(c.TgZ(0,"div",6),c.TgZ(1,"div",7),c._UZ(2,"a-user-avatar",8),c._UZ(3,"div",9),c.qZA(),c.TgZ(4,"div",10),c.TgZ(5,"div",11),c._uU(6),c.qZA(),c.TgZ(7,"div",12),c._uU(8),c.qZA(),c.TgZ(9,"div",13),c._uU(10),c.qZA(),c.qZA(),c.qZA()),2&e){const e=t.$implicit;c.xp6(2),c.Q6J("user",e),c.xp6(1),c.ekj("bg-error",!e.location)("bg-success",e.location),c.xp6(3),c.Oqu(e.name),c.xp6(2),c.hij(" ",e.organisation," "),c.xp6(2),c.hij(" ",e.location," ")}}let j=(()=>{class e{constructor(e){this._state=e,this.contacts=this._state.contacts,this.search_results=this._state.search_results,this.addUser=e=>this._state.addContact(e),this.removeUser=e=>this._state.removeContact(e),this.updateSearch=e=>this._state.setOptions({search:e})}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(A))},e.\u0275cmp=c.Xpm({type:e,selectors:[["landing-colleagues"]],decls:9,vars:3,consts:[[1,"flex","flex-col","w-[18rem]","h-full","overflow-hidden","bg-white","border-r","border-gray-200"],[1,"flex","items-center","justify-between","px-4","py-2"],[1,"font-medium"],["mat-button","",1,"inverse"],[1,"flex-1","h-1/2","w-full","space-y-4","overflow-auto","pt-4"],["class","flex items-center px-4 space-x-4",4,"ngFor","ngForOf"],[1,"flex","items-center","px-4","space-x-4"],[1,"text-xl","relative"],[3,"user"],[1,"rounded-full","h-3","w-3","border","border-white","absolute","bottom-1","right-1"],[1,"leading-tight"],[1,"truncate"],[1,"text-sm","truncate"],[1,"text-xs","opacity-60","truncate"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h2",2),c._uU(3,"Colleagues"),c.qZA(),c.TgZ(4,"button",3),c._uU(5,"Add"),c.qZA(),c.qZA(),c.TgZ(6,"div",4),c.YNc(7,Y,11,8,"div",5),c.ALo(8,"async"),c.qZA(),c.qZA()),2&e&&(c.xp6(7),c.Q6J("ngForOf",c.lcZ(8,1,t.contacts)))},directives:[J.lW,i.sg,S.k],pipes:[i.Ov],encapsulation:2}),e})();var M=n(1663),E=n(3577),D=n(5033);function N(e,t){if(1&e&&c._UZ(0,"event-card",12),2&e){const e=c.oxw().$implicit;c.Q6J("event",e)("show_day",!0)}}function G(e,t){if(1&e&&c._UZ(0,"booking-card",13),2&e){const e=c.oxw(3);c.Q6J("booking",e.booking)("show_day",!0)}}function I(e,t){if(1&e&&(c.ynx(0),c.ynx(1,9),c.YNc(2,N,1,2,"event-card",10),c.YNc(3,G,1,2,"booking-card",11),c.BQk(),c.BQk()),2&e){const e=t.$implicit,n=c.oxw(2);c.xp6(1),c.Q6J("ngSwitch",n.type(e)),c.xp6(1),c.Q6J("ngSwitchCase","event"),c.xp6(1),c.Q6J("ngSwitchCase","booking")}}function B(e,t){if(1&e&&(c.ynx(0),c.YNc(1,I,4,3,"ng-container",8),c.ALo(2,"slice"),c.ALo(3,"async"),c.BQk()),2&e){const e=c.oxw();c.xp6(1),c.Q6J("ngForOf",c.Dn7(2,1,c.lcZ(3,5,e.upcoming_events),0,3))}}function X(e,t){1&e&&(c.TgZ(0,"div",14),c._UZ(1,"img",15),c.TgZ(2,"p",16),c._uU(3,"You have no upcoming bookings"),c.qZA(),c.qZA())}const V=function(){return["/your-bookings"]};let $=(()=>{class e{constructor(e){this._state=e,this.upcoming_events=this._state.upcoming_events}type(e){return e instanceof M.$N?"booking":"event"}ngOnInit(){this._state.pollUpcomingEvents()}ngOnDestroy(){this._state.stopPollingUpcomingEvents()}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(A))},e.\u0275cmp=c.Xpm({type:e,selectors:[["landing-upcoming"]],decls:13,vars:8,consts:[[1,"py-2"],[1,"flex","items-center","justify-between","mb-2","sm:mb-4","px-4"],[1,"sm:text-lg","font-medium"],["button","","mat-button","",1,"inverse","hidden","sm:block",3,"routerLink"],[1,"inverse","block","sm:hidden","text-blue-500","underline","relative","top-8",3,"routerLink"],[1,"space-y-4","px-4"],[4,"ngIf","ngIfElse"],["empty_state",""],[4,"ngFor","ngForOf"],[3,"ngSwitch"],[3,"event","show_day",4,"ngSwitchCase"],[3,"booking","show_day",4,"ngSwitchCase"],[3,"event","show_day"],[3,"booking","show_day"],[1,"w-full","p-8","flex","flex-col","items-center","justify-center","space-y-4"],["src","assets/img/no-events.svg",1,"mr-4"],[1,"opacity-30"]],template:function(e,t){if(1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"div",2),c._uU(3,"Your Bookings"),c.qZA(),c.TgZ(4,"a",3),c._uU(5," View All "),c.qZA(),c.TgZ(6,"a",4),c._uU(7," View All "),c.qZA(),c.qZA(),c.TgZ(8,"div",5),c.YNc(9,B,4,7,"ng-container",6),c.ALo(10,"async"),c.qZA(),c.qZA(),c.YNc(11,X,4,0,"ng-template",null,7,c.W1O)),2&e){const e=c.MAs(12);let n;c.xp6(4),c.Q6J("routerLink",c.DdM(6,V)),c.xp6(2),c.Q6J("routerLink",c.DdM(7,V)),c.xp6(3),c.Q6J("ngIf",null==(n=c.lcZ(10,4,t.upcoming_events))?null:n.length)("ngIfElse",e)}},directives:[J.zs,s.yS,i.O5,i.sg,i.RF,i.n9,E.j,D.E],pipes:[i.Ov,i.OU],styles:[""]}),e})();var z=n(778),K=n(4892),R=n(9676);const W=[{path:"",component:(()=>{class e{get date(){return(0,z.Z)(this.time||Date.now())}get user(){return(0,Z.ar)()}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-dashboard"]],decls:19,vars:5,consts:[[1,"flex","flex-1","h-1/2","bg-[#E5E5E5]"],[1,"h-full","hidden","sm:block"],[1,"flex-1","h-full","w-1/2","sm:px-4","overflow-auto"],[1,"sticky","top-0","z-50","bg-[#ECF0F3]","px-4","rounded-b","flex","items-center","justify-between","overflow-hidden"],[1,""],[1,"sm:text-xl","font-medium"],[1,"text-sm","sm:text-base"],[1,"h-32","pt-4"],["src","assets/img/landing.svg"],[1,"mx-4","w-[calc(100%-2rem)]","h-px","bg-gray-300","mb-2"]],template:function(e,t){1&e&&(c._UZ(0,"topbar"),c.TgZ(1,"div",0),c._UZ(2,"landing-colleagues",1),c.TgZ(3,"div",2),c.TgZ(4,"header",3),c.TgZ(5,"div",4),c.TgZ(6,"div",5),c._uU(7),c.qZA(),c.TgZ(8,"div",6),c._uU(9),c.ALo(10,"date"),c.qZA(),c.TgZ(11,"div",6),c._uU(12,"Sydney Australia"),c.qZA(),c.qZA(),c.TgZ(13,"div",7),c._UZ(14,"img",8),c.qZA(),c.qZA(),c._UZ(15,"landing-availability"),c._UZ(16,"div",9),c._UZ(17,"landing-upcoming"),c.qZA(),c.qZA(),c._UZ(18,"footer-menu")),2&e&&(c.xp6(7),c.hij("Hello ",null==t.user?null:t.user.name,","),c.xp6(2),c.Oqu(c.xi3(10,2,t.date,"fullDate")))},directives:[K.o,j,P,$,R.i],pipes:[i.uU],styles:["[_nghost-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;display:flex;flex-direction:column}main[_ngcontent-%COMP%]{min-height:50%}"]}),e})()}];let H=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[i.ez,o.v,s.Bz.forChild(W)]]}),e})()}}]);
//# sourceMappingURL=apps_workplace_src_app_landing_landing_module_ts.js.map