(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{EA6B:function(e,t,s){"use strict";s.d(t,"b",(function(){return _})),s.d(t,"a",(function(){return v}));var n=s("C05f"),a=s("TLy2"),o=s("wqq/"),i=s("jOdJ"),l=s("WPBw"),r=s("SQLt"),c=s("D8Xy"),u=s("KuCG"),f=s("20lr"),h=s("eZII"),b=s("mjT4"),d=s("EM62"),p=s("7JBE"),m=s("dJst"),g=s("OZ4H");function _(){sessionStorage.removeItem("PLACEOS.event"),sessionStorage.removeItem("PLACEOS.event_form"),localStorage.removeItem("PLACEOS.event_filters")}let v=(()=>{class e extends f.b{constructor(e,t,s){super(),this._calendar=e,this._org=t,this._dialog=s,this._event=new n.a(null),this._form=new n.a(null),this._filters=new n.a({}),this._loading_spaces=new n.a(!1),this._loading_event=new n.a(!1),this.event=this._event.asObservable(),this.form=this._form.asObservable(),this.filters=this._filters.asObservable(),this.loading_spaces=this._loading_spaces.asObservable(),this.loading_event=this._loading_event.asObservable(),this.spaces=this._filters.pipe(Object(a.a)(e=>{var t,s;this._loading_spaces.next(!0);const n=this._form.getValue().value,a=Math.floor(new Date(n.date).valueOf()/1e3),o=Math.floor(Object(l.a)(new Date(n.date),n.duration||60).valueOf()/1e3),i=(null===(t=null==e?void 0:e.zones)||void 0===t?void 0:t.length)?e.zones:[null===(s=this._org.building)||void 0===s?void 0:s.id];return this._calendar.freeBusy({zone_ids:i.join(","),period_start:a,period_end:o}).toPromise().then(t=>(this._loading_spaces.next(!1),t.filter(t=>!e.capacity||e.capacity>=t.capacity)))}),Object(o.a)()),this.clearState=()=>_(),this.setEvent(new h.a({date:Object(r.a)(Object(l.a)(new Date,2),{nearestTo:5}).valueOf()}))}get event_form(){return this._form.getValue()}get event_filters(){return this._filters.getValue()}get is_future_date(){var e,t;const s=(null===(t=null===(e=this._form.getValue())||void 0===e?void 0:e.controls)||void 0===t?void 0:t.date.value)||(new Date).valueOf();return Object(c.a)(new Date(s),Object(u.a)(new Date))}setEvent(e){this._event.next(e);const t=Object(h.b)(e);this._form.next(t),this.subscription("form_change",()=>this.storeState())}setValue(e,t){const s=this._form.getValue();s&&s.controls[e]&&s.controls[e].setValue(t)}newAttendee(){const e=this._dialog.open(b.b,{width:"auto",height:"auto",data:{}}),t=this._form.getValue();e.componentInstance.event.pipe(Object(i.a)(e=>"done"===e.reason)).subscribe(s=>{const n=t.controls.attendees.value||[];n.push(s.metadata),t.controls.attendees.setValue(Object(f.y)(n,"email")),e.close()})}clearForm(){this.setEvent(this._event.getValue()),this._filters.next({})}updateFilters(e){this._filters.next(e)}storeState(){const e=this._form.getValue();sessionStorage.setItem("PLACEOS.event",JSON.stringify(this._event.getValue().toJSON())),sessionStorage.setItem("PLACEOS.event_form",JSON.stringify(e.value)),localStorage.setItem("PLACEOS.event_filters",JSON.stringify(this._filters.getValue()))}loadState(){const e=sessionStorage.getItem("PLACEOS.event")||"{}";e&&this._event.next(new h.a(JSON.parse(e)));const t=sessionStorage.getItem("PLACEOS.event_form");if(t){const e=Object(h.b)(this._event.getValue());e.patchValue(JSON.parse(t)),this._form.next(e)}const s=localStorage.getItem("PLACEOS.event_filters");s&&this._filters.next(JSON.parse(s))}save(){const e=this._form.getValue();if(e.markAllAsTouched(),e.controls.organiser.value&&e.controls.host.value||e.patchValue({organiser:Object(f.h)(),host:Object(f.h)().email}),e.controls.title.value||e.patchValue({title:Object(f.h)().email}),!e.valid){const t=[];for(const s in e.controls)e.controls[s].invalid&&t.push(s);return Promise.reject(Object(f.m)(`Some form fields are not valid: [${t.join(", ")}]`))}this._loading_event.next(!0);const t=new h.a(Object.assign(Object.assign({},this._event.getValue()),this._form.getValue().value));return Object(h.e)(t).toPromise().then(()=>this._loading_event.next(!1),()=>this._loading_event.next(!1))}}return e.\u0275fac=function(t){return new(t||e)(d.cc(p.a),d.cc(m.c),d.cc(g.b))},e.\u0275prov=d.Lb({token:e,factory:e.\u0275fac}),e})()},dgxB:function(e,t,s){"use strict";s.r(t),s.d(t,"ControlModule",(function(){return P}));var n=s("2kYt"),a=s("sEIs"),o=s("20lr"),i=s("EA6B"),l=s("EM62"),r=s("e81E"),c=s("jOdJ"),u=s("6CBO"),f=s("dJst"),h=s("e4ff"),b=s("0/Ep"),d=s("PBFl"),p=s("81Qw");const m=function(){return["/explore"]},g=function(e){return{space:e}};function _(e,t){if(1&e&&(l.Vb(0,"div",1),l.Vb(1,"div",2),l.Vb(2,"div",3),l.Nc(3),l.Ub(),l.Vb(4,"div",4),l.Vb(5,"div",5),l.Nc(6),l.Ub(),l.Vb(7,"div",6),l.Vb(8,"app-icon"),l.Nc(9,"account_circle"),l.Ub(),l.Nc(10),l.Ub(),l.Ub(),l.Ub(),l.Vb(11,"div",7),l.Vb(12,"a",8),l.kc(13,"safe"),l.Nc(14," Control "),l.Ub(),l.Vb(15,"a",9),l.Nc(16," Find "),l.Ub(),l.Ub(),l.Ub()),2&e){const e=l.jc();l.Hb("with-image",e.show_image),l.Db(3),l.Oc(e.space.name),l.Db(3),l.Oc(e.location),l.Db(4),l.Pc(" ",e.space.capacity||"0"," "),l.Db(2),l.qc("href",l.mc(13,8,e.space.support_url,"url"),l.Cc),l.Db(3),l.qc("routerLink",l.tc(11,m))("queryParams",l.uc(12,g,e.space.id))}}let v=(()=>{class e{constructor(e,t){this._settings=e,this._org=t}get show_image(){return this._settings.get("app.space_display.show_images")}get location(){if(!this.space)return"Unable to determine location";const e=this.space.level,t=this._org.buildings.find(t=>t.id===e.parent_id);return`${t?(t.display_name||t.name)+", ":""}${e.display_name||e.name}`}}return e.\u0275fac=function(t){return new(t||e)(l.Pb(o.e),l.Pb(f.c))},e.\u0275cmp=l.Jb({type:e,selectors:[["a-control-space-list-item"]],inputs:{space:"space"},decls:1,vars:1,consts:[["class","flex flex-wrap items-center sm:space-x-4 bg-white hover:bg-gray-100 overflow-hidden p-2 pl-4 mb-2",3,"with-image",4,"ngIf"],[1,"flex","flex-wrap","items-center","sm:space-x-4","bg-white","hover:bg-gray-100","overflow-hidden","p-2","pl-4","mb-2"],[1,"flex","flex-col","flex-1"],[1,"text-xl"],[1,"flex","items-center","w-full","text-sm"],[1,"flex-1"],[1,"flex","items-center","text-lg"],[1,"flex","w-full","sm:w-auto","sm:flex-col","items-center","space-x-2","sm:space-x-0","sm:space-y-2","mt-4","sm:mt-0"],["mat-button","","button","",1,"w-32","flex-1","sm:flex-none",3,"href"],["mat-button","","button","",1,"w-32","flex-1","sm:flex-none","inverse",3,"routerLink","queryParams"]],template:function(e,t){1&e&&l.Lc(0,_,17,14,"div",0),2&e&&l.qc("ngIf",t.space)},directives:[n.o,b.a,d.a,a.f],pipes:[p.b],styles:[""]}),e})();function w(e,t){1&e&&l.Qb(0,"a-control-space-list-item",6),2&e&&l.qc("space",t.$implicit)}function O(e,t){if(1&e&&(l.Vb(0,"div",4),l.Lc(1,w,1,1,"a-control-space-list-item",5),l.Ub()),2&e){const e=l.jc();l.Db(1),l.qc("ngForOf",e.filtered_list)}}function x(e,t){if(1&e&&(l.Vb(0,"div",7),l.Vb(1,"app-icon"),l.Nc(2,"close"),l.Ub(),l.Vb(3,"p"),l.Nc(4),l.Ub(),l.Ub()),2&e){const e=l.jc();l.Db(4),l.Pc(" ",e.search_str?' No matches for "'+e.search_str+'"':"No controllable spaces"," ")}}let C=(()=>{class e extends o.b{constructor(e,t){super(),this._spaces=e,this._org=t,this.space_list=[]}ngOnInit(){this._spaces.initialised.pipe(Object(c.a)(e=>e)).subscribe(()=>{this.space_list=this._spaces.filter(e=>!!e.support_url),this.space_list.sort((e,t)=>{const s=this._org.buildings.find(t=>t.id===e.level.parent_id),n=(e.name||"").toLowerCase(),a=((e.level?e.level.name:"")||"").toLowerCase(),o=((s?s.name:"")||"").toLowerCase(),i=this._org.buildings.find(e=>e.id===t.level.parent_id),l=(t.name||"").toLowerCase(),r=((t.level?t.level.name:"")||"").toLowerCase(),c=((i?i.name:"")||"").toLowerCase();return o.localeCompare(c)||a.localeCompare(r)||n.localeCompare(l)})})}get filtered_list(){const e=(this.search_str||"").toLowerCase();return(this.space_list||[]).filter(t=>{const s=this._org.buildings.find(e=>e.id===t.level.parent_id),n=(t.name||"").toLowerCase(),a=((t.level?t.level.name:"")||"").toLowerCase(),o=((s?s.name:"")||"").toLowerCase();return n.indexOf(e)>=0||a&&a.indexOf(e)>=0||o&&o.indexOf(e)>=0})}}return e.\u0275fac=function(t){return new(t||e)(l.Pb(u.d),l.Pb(f.c))},e.\u0275cmp=l.Jb({type:e,selectors:[["a-control-space-list"]],features:[l.Ab],decls:5,vars:5,consts:[[1,"w-full","flex","items-center","justify-center","p-2"],[3,"value","loading","autofocus","valueChange"],["class","flex flex-col flex-1 overflow-auto w-full",4,"ngIf","ngIfElse"],["empty_state",""],[1,"flex","flex-col","flex-1","overflow-auto","w-full"],[3,"space",4,"ngFor","ngForOf"],[3,"space"],[1,"flex","flex-col","items-center","p-8"]],template:function(e,t){if(1&e&&(l.Vb(0,"div",0),l.Vb(1,"a-searchbar",1),l.fc("valueChange",(function(e){return t.search_str=e})),l.Ub(),l.Ub(),l.Lc(2,O,2,1,"div",2),l.Lc(3,x,5,1,"ng-template",null,3,l.Mc)),2&e){const e=l.xc(4);l.Db(1),l.qc("value",t.search_str)("loading",t.loading)("autofocus",!0),l.Db(1),l.qc("ngIf",t.filtered_list.length)("ngIfElse",e)}},directives:[h.a,n.o,n.n,v,b.a],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n            }"]}),e})();var V=s("C9Ki"),y=s("d4mj");let j=(()=>{class e extends o.b{constructor(e){super(),this._settings=e}ngOnInit(){this._settings.title="Control",Object(i.b)()}}return e.\u0275fac=function(t){return new(t||e)(l.Pb(o.e))},e.\u0275cmp=l.Jb({type:e,selectors:[["app-control"]],features:[l.Ab],decls:5,vars:2,consts:[[1,"w-full",3,"menu","menuChange"],[1,"flex-1","h-1/2","w-full"],[1,"w-full",3,"show","showChange"]],template:function(e,t){1&e&&(l.Vb(0,"a-topbar-header",0),l.fc("menuChange",(function(e){return t.show_menu=e})),l.Ub(),l.Vb(1,"main",1),l.Qb(2,"a-control-space-list"),l.Ub(),l.Qb(3,"a-footer-menu"),l.Vb(4,"a-overlay-menu",2),l.fc("showChange",(function(e){return t.show_menu=e})),l.Ub()),2&e&&(l.qc("menu",t.show_menu),l.Db(4),l.qc("show",t.show_menu))},directives:[r.a,C,V.a,y.a],styles:["[_nghost-%COMP%] {\n            display: flex;\n            flex-direction: column;\n            height: 100%;\n            width: 100%;\n        }"]}),e})();var S=s("R3Ii");const L=[{path:"",component:j}];let P=(()=>{class e{}return e.\u0275mod=l.Nb({type:e}),e.\u0275inj=l.Mb({factory:function(t){return new(t||e)},imports:[[n.c,a.g.forChild(L),S.a]]}),e})()}}]);
//# sourceMappingURL=control-control-module.08fb3139486ea02cda2c.js.map