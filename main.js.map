{"version":3,"file":"main.js","mappings":"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","names":["r","s","n","o","t","i","y","l","c","u","routes","path","component","components_1","not_found_component_1","canActivate","canLoad","children","room_booking_component_1","booking_confirmed_component_1","meeting_booking_component_1","meeting_success_component_1","desk_booking_component_1","desk_success_component_1","find_space_component_1","upcoming_bookings_component_1","pathMatch","redirectTo","AppRoutingModule","exports","router_1","forRoot","useHash","e","AppComponent","common_1","constructor","_settings","_org","_cache","_snackbar","super","this","ngOnInit","console","info","window","history","replaceState","data","unused","MOCKS","C","initialised","pipe","_","toPromise","Office","onReady","_initialiseAuth","_finishInitialise","timeout","tkn","get_token","auth","getAccessToken","Promise","resolve","clearTimeout","sessionStorage","setItem","JSON","stringify","context","ui","_authenticateWithOffice","local","get","settings","local_login","storage","mock","location","origin","includes","catch","error","onInitError","email","split","pathname","displayDialogAsync","height","width","result","dialog","value","addEventHandler","EventType","DialogMessageReceived","token","close","href","getItem","messageParent","is_logged_in","reload","i0","selectors","S","p","d","x","g","v","AppModule","bootstrap","app_component_1","space_pipe_1","imports","platform_browser_1","animations_1","app_routing_module_1","book_module_1","shared_module_1","http_1","forms_1","core_1","snack_bar_1","payments_1","assets_1","form_fields_1","catering_1","service_worker_1","register","enabled","environment_1","production","NotFoundComponent","router","f","h","b","E","I","F","O","SharedComponentModule","bookings_1","events_1","button_1","datepicker_1","dialog_1","form_field_1","icon_1","input_1","progress_spinner_1","progress_bar_1","autocomplete_1","select_1","chips_1","core_2","menu_1","checkbox_1","expansion_1","tabs_1","badge_1","tooltip_1","radio_1","slider_1","DeskBookingComponent","_service","_router","clearForm","form","makeBooking","confirmPost","navigate","ctx","DeskBookingFormComponent","allow_assets","setOptions","type","subscription","valueChanges","subscribe","list","length","setBookingAsset","desk","patchValue","asset_id","id","asset_name","name","map_id","description","booking_type","zones","zone","parent_id","booking_asset","DeskBookingSuccessComponent","last_success","MeetingBookingComponent","_bottom_sheet","host","valid","join","sheet_ref","open","meeting_flow_confirm_component_1","instance","show_close","afterDismissed","setView","MeetingBookingFormComponent","_dialog","has_catering","hide_notes","hide_attendees","max_duration","can_book_for_others","allow_all_day","findAvailableTime","attendees","organiser","date","duration","ref","users_1","users","afterClosed","componentInstance","MeetingBookingSuccessComponent","ROUTES","BookModule","forChild","bottom_sheet_1","button_toggle_1","BookingConfirmedComponent","_state","start_time$","Date","toLocaleTimeString","hour","minute","hour12","end_time$","newBooking","FeaturesFilterService","available_spaces","rxjs_1","_selected_features","asObservable","_features","next","room_features","selected_features","getValue","features","feature","getSelectedFeatures","selected_features$","features$","arr","filter","item","applyFilter","requested_features","sortSelectedFeatures","updated_spaces$","spaces$","spaces","space","_sort_and_join","feature_list","updated_spaces_emitter","array","sort","features_array","map","clearFilter","OnDestroy","features_sub","unsubscribe","factory","FilterSpaceComponent","_bottomsheetRef","_featuresFilterService","building_list","active_building","building","applyFilters","dismiss","closeModal","FindSpaceItemComponent","selectedChange","emit","selected","FindSpaceComponent","_bottomSheet","_spaces","_mapService","_roomConfirmService","options","bld","levelsForBuilding","loading","W","space_view","setTimeChips","setBuilding","book_space","locateSpaces","locatable_spaces$","maps_list$","maps","selected_level","features_loaded$","applyMapDecorations","_map_features","map_features","map_features$","map_actions$","handleBookEvent","book","show_room_details$","updateSelectedSpace","openFilter","bottomSheetRef","filter_space_component_1","buildings","openRoomDetails","openRoomDetail","selected_space","resetSpace","controls","duration_minutes","updateSelectedLevel","processFeature","processStyles","map_styles$","style_map","MapService","_map_loaded","_features_loaded","selected_space$","_locatable_spaces","_maps_list","locatable_spaces","maps_list","level","loadMap","action","callback","openRoomTile","mapsList","Map","values","focus","content","z_index","zoom","styles","display","room_tile_component_1","panelClass","RoomBookingComponent","_document","newForm","findSpace","markAllAsTouched","storeForm","downloadTemplate","RoomConfirmService","_space_pipe","_selected_space","forEach","space_list","room_details_ref","room_details_component_1","selectedSpace","openRoomConfirm","room_confirm_component_1","bookRoom","id_list","Object","keys","all","transform","resources","system","postForm","err","RoomConfirmComponent","_bottomSheetRef","unix_time","start_time","durationMinutes","end_time","title","confirmBooking","show_submit_button","RoomDetailsComponent","selectRoom","room_added","back","RoomTileComponent","cancel","UpcomingBookingsComponent","_schedule","filtered_bookings","toggleType","startPolling","isEvent","trackByFn","__NgCli_bootstrap_1","bootstrapModule","app_module_1","MeetingFlowConfirmComponent","_event_form","_sheet_ref","A","cancelPostForm","event","find","address","display_name","$localize","ScheduleStateService","shown_types","now","_date","_poll","_loading","_update","query","period_start","period_end","events","visitors","desks","parking","a","bookings","_filters","bkns","filters","delay","interval","stopPolling","clearInterval","setDate","removeItem","clear","tslib_1","AssetDetailsComponent","images","url","AssetFiltersDisplayComponent","AssetFiltersComponent","AssetListComponent","_asset_state","filtered_assets","isFavourite","favorites","selectAsset","asset","onSelect","EMPTY_FAVS","AssetSelectModalComponent","_items","selected_ids","count","reduce","amount","isSelected","setSelected","state","push","toggleFavourite","fav_list","saveUserSetting","AssetStateService","_search","replace","_options","asset_list","asset_bookings","category","localeCompare","available_assets","search","assets","toLowerCase","setSearch","Asset","_data","barcode","brand","size","specifications","purchase_details","consumables","general_details","invoices","locations","asset_class_1","required","purchase_date","expiry_date","ASSET_ENDPOINT","q","updateAsset","createAsset","AssetsModule","asset_select_modal_component_1","asset_details_component_1","asset_filters_component_1","asset_filters_display_component_1","asset_list_component_1","BookingCardComponent","base_class_1","_route","queryParamMap","params","has","booking","viewDetails","day","is_today","levelWithID","period","start","end","dur","hours","Math","floor","minutes","booking_details_modal_component_1","edit","remove","BookingDetailsModalComponent","_booking","toggleCheckedIn","checking_in","checked_in","BOOKING_URLS","BookingFormService","_payments","booking_class_1","parse","metadata","details","Array","_form","_1","getRawValue","zone_id","bookable","every","bkn","status","groups","members","group","pop","view","_view","setFeature","enable","splice","findIndex","resetForm","extension_data","loadForm","openBookingLinkModal","force","booking_link_modal_component_1","checkQuestions","icon","reason","postFormForGroup","ignore_check","checkResourceAvailable","all_day","valueOf","payment_module","receipt","makePayment","resource_name","success","invoice","invoice_id","approved","extra_members","active_asset","_getNearbyResources","group_members","idx","user_email","user","desk_questions_modal_component_1","race","key","allowed_bookings","j","current","map_url","nearby_assets","BookingLinkModalComponent","_event","IGNORE_EXT_KEYS","Booking","booking_start","nearestTo","booking_end","abs","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","user_id","user_name","rejected","deleted","booked_by_id","booked_by_name","booked_by_email","approver_id","approver_email","approver_name","access","event_id","toJSON","is_done","centered_at","desk_ids","element","document","createElement","style","position","top","body","appendChild","viewer","point","mappings","dist","closest","sqrt","removeChild","validators_1","company","booked_by","secondary_resource","other_asset_type","booker","emitEvent","disable","findNearbyFeature","BOOKINGS_ENDPOINT","method","ts_client_1","encodeURIComponent","updateBooking","createBooking","response_type","user_class_1","asset_id_list","ignore","queryBookings","T","SharedBookingsModule","form_fields_module_1","components_module_1","DeskConfirmModalComponent","can_set_date","desk_list","hide_reason","can_set_host","confirm","DeskListFieldComponent","fn","_onChange","_onTouch","disabled","desk_select_modal_component_1","changeResources","items","capacity","room_size","setValue","removeResource","new_value","writeValue","provide","useExisting","multi","decls","DeskQuestionsModalComponent","travelled","unwell","contact","submit","failure","DeskDetailsComponent","ngOnChanges","changes","updateFeature","map_pin_component_1","DeskFiltersDisplayComponent","_bsheet","desk_filters_component_1","DeskFiltersComponent","_bsheet_ref","active_levels","can_close","allow_time_changes","book_until","DeskListComponent","show_fav","desk_id","selectDesk","DeskMapComponent","levels","setZoom","new_zoom","max","min","resetMap","center","DeskSelectModalComponent","_dialog_ref","DesksService","bookDesk","error_on_host","desk_confirm_modal_component_1","makeDeskBooking","for_user","booking_data","InviteVisitorFormComponent","R","sent","setValidators","filterVisitors","setVisitor","filtered_visitors","onDone","done","sendInvite","visitor_details","old_visitors","organisation","ParkingSpaceDetailsComponent","_updateFeature","ParkingSpaceFiltersDisplayComponent","parking_filters_component_1","zone_ids","_updateLocation","removeFeature","feat","ParkingSpaceFiltersComponent","level_list","lvl","toggleFeature","B","new_list","ParkingSpaceListComponent","space_id","selectSpace","ParkingSpaceLocationPinComponent","ParkingSpaceSelectMapComponent","parking_location_pin_component_1","_seletedSpace","ParkingSpaceSelectModalComponent","ParkingSpaceListFieldComponent","parking_select_modal_component_1","Calendar","primary","summary","can_edit","resource","space_class_1","availability","starts_at","ends_at","hidden","CALENDAR_ENDPOINT","calendar_class_1","calendarsToSpaces","org","cal","queryCalendarAvailability","$event","set_r2","CateringConfigModalComponent","catering_interfaces_1","rulesets","config","set","rules","new_id","random","saveChanges","CateringImportMenuModalComponent","handleFileEvent","target","files","file","fileReader","FileReader","addEventListener","catering_item_class_1","tags","multiple","unit_price","readAsText","CateringItemModalComponent","accept_points","discount_cap","keycodes_1","categories","tag_list","renderPercent","addTag","markAsDirty","input","trim","removeTag","existing_tag","index","indexOf","CateringItem","quantity","option_list","active","unit_price_with_options","total_cost","options_string","CateringListFieldComponent","updated_list","addItems","new_catering_order_modal_component_1","cateringitem","CateringMenuItemComponent","_catering","addOption","option","deleteOption","addItem","deleteItem","symbol","currency","CateringMenuComponent","menu","menu_map","CateringItemOptionModalComponent","types","new_option","parent","concat","CateringOrderItemComponent","CateringOrderListComponent","_orders","filtered","ngOnDestroy","order","undefined","is_available","rule","matches","condition","ext","CateringOrderModalComponent","code","currency_code","L","catering_order_class_1","getCateringConfig","cat","cateringItemAvailable","menu_items","updateMenuQuantities","choose_options","old_item","itm","opt","selectOptions","then","new_item","G","updateItemQuantity","optionsFor","saveOrder","confirmOrder","show_order_details","CateringItemDetailsComponent","updateGroupOption","group_list","ICONS","coffee","drinks","snacks","meals","CateringItemFiltersComponent","setFilters","toggleTag","tag","CateringItemListComponent","filtered_menu","item_id","selectItem","CateringOrderStateService","available_menu","opts","NewCateringOrderModalComponent","CateringOrderOptionsModalComponent","option_state","saveOptions","CateringOrder","system_id","item_count","charge_code","invoice_number","deliver_at","getTime","CateringOrderComponent","catering_vars_1","updateStatus","statuses","CateringOrdersService","orders","checkOrder","updated_order","event_class_1","catering","CateringStateService","_menu","_currency","getCateringForZone","manageCateringOrder","M","catering_order_modal_component_1","catering_item_modal_component_1","updateMenu","catering_option_modal_component_1","catering_order_options_modal_component_1","class","editConfig","catering_config_modal_component_1","updateConfig","importMenu","catering_import_menu_modal_component_1","updated_menu","addItemToOrder","match","V","SharedCateringModule","colour","opacity","str","_timer","cache","isEnabled","checkForUpdate","activateUpdate","setInterval","BaseClass","_initialised","is_initialised","destroy","_timers","_intervals","_subscriptions","unsub","Function","Error","setTimeout","unsubWith","contains","subs","k","utc_date","chunks","formatCalFileText","meeting_url","toISOString","fmt","formatAllDay","formatUTC","text","trp","dates","emails","add","rru","startdt","enddt","subject","allday","PLACEOS_APP_ACCESS","FeatureAvailableGuard","checkFeature","can_activate","pattern","charAt","toUpperCase","slice","_app_name","ceil","confirm_modal_component_1","msg","args","stream","app_name","jest","debug","colors","getItemWithKeys","el","pos","chars","randomInt","openConfirmModal","csv","delimiter","objPattern","RegExp","arrMatches","arrData","exec","headers","row","reject","reader","evt","srcElement","json","valid_keys","filename","contents","setAttribute","click","base64","base64Url","jsonPayload","decodeURIComponent","atob","charCodeAt","toString","an_array","stack","res","isArray","reverse","start1","end1","start2","end2","rand","sfc32","imul","xmur3","seed","localeString","querySelector","getAttribute","navigator","language","is24HourTime","prefix","invalid","getInvalidFields","obj","word","substring","GoogleAnalyticsService","m","ga","GoogleAnalyticsObject","arguments","getElementsByTagName","async","src","parentNode","insertBefore","log","service","load","tracking_id","setUser","label","app_prefix","screen","appName","screenName","page","route","last_route","timing","variable","timers","INVALID_STANDALONE_KEYS","HotkeysService","mapKey","last_down","keydown_states","keydown_observers","counter","combo_end","preventDefault","listen","combo","combination","validCombination","registered_combos","last_key","updateCombinationEndList","presses","total","non_meta","message","on_action","warn","snackbar_ref","onAction","snackbar","notify","protocol","domain","hostname","port","use_domain","localStorage","auth_type","scope","auth_uri","token_uri","redirect_uri","handle_login","use_iframe","setupPlace","rootObject","functionToHook","hookingFunction","previousFunction","call","RemoteLoggingService","_events","_system_id","_bindTo","_event_history","execute","_patchConsoleMethods","_logging_bindings","setSystem","hookMethod","_handleEvent","event_type","subtype","timestamp","startsWith","mod","module","binding","bind","buildingConfigs","roomConfigs","output","roomConfigBuilder","SettingsService","_title","time","version_1","built","semver","hash","init","overrides","_overrides","_applyCssVariables","_observables","_subjects","post","getTitle","setTitle","_setDarkMode","application","_user_settings","_applyUserSettings","__1","_setFontSize","_pending_settings","settings_1","override_settings","override","_savePendingChanges","variable_map","css_string","getElementById","head","innerText","parentElement","fontSize","classList","composer","app","short_name","logo_light","logo_dark","can_deliver","general","banner","copyright","help","tiles","link","background","columns","multiple_spaces","desk_start","breakdown","space_display","show_images","directory","show_avatars","min_search_length","explore","can_select_building","show_legend_group_names","legend","Spaces","allow_groups","auto_allocation","analytics","hide_contacts","schedule","color","departments","spectator","detectChanges","fixture","whenStable","whenChangesStable","tz","offset_diff","EMPTY_USER","_current_user","dirty","raw","distance","suffix","semverString","version","VorlonService","injectVorlonScript","removeVorlonScript","_script","ActionIconComponent","AuthorisedAdminGuard","checkUser","segments","AuthorisedUserGuard","_access","BindingDirective","_element","_renderer","bindVariable","sys","model","previousValue","on_event","nativeElement","_binding","modelChange","P","H","Q","MAT_MODULES","clipboard_1","paginator_1","table_1","portal_1","sort_1","scrolling_1","ComponentsModule","useValue","interactive_map_component_1","map_locate_modal_component_1","icon_component_1","debug_console_component_1","custom_tooltip_component_1","sanitise_pipe_1","maxHeight","maxWidth","ConfirmModalComponent","confirm_text","cancel_text","disableClose","onConfirm","CustomTableComponent","ngAfterViewInit","data_source","_sort","paginator","pagination","_paginator","filterPredicate","dataSource","display_column","column_size","CustomTooltipData","CustomTooltipComponent","_overlay","_injector","hover","_updateInjector","_overlay_ref","x_pos","y_pos","_updateType","_portal","getBoundingClientRect","default_x","clientWidth","default_y","clientHeight","create","hasBackdrop","backdrop","positionStrategy","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","attach","backdropClick","dispose","injector","providers","COLOR_MAP","network","dom","URL_STARTS","DebugConsoleComponent","_logs","_hotkey","json_display_component_1","logs","show","DurationPipe","shorten","pure","FixedPipe","places","toFixed","GlobalBannerComponent","has_viewed","GlobalLoadingComponent","online","IconComponent","ImageCarouselComponent","InteractiveMapComponent","ratio$","_on_changes","ratio","svg_ratio$","svg_ratio","zoom$","onResize","updateDisplay","createView","updateInjectors","focusOn","labels","actions","updateView","updateFeatureList","desired_zoom","desired_center","_outlet_el","rect","w","track_id","_feature_list","toArray","old_injectors","injectors","_extra_data","JsonDisplayComponent","_updateFormatting","formatted_json","LoginComponent","username","password","logo","toPassword","pwd_field","login","setErrors","MapLocateModalComponent","MapPinComponent","_details","fill","stroke","show_message","MapPolygonComponent","_cdr","scale","zoom_value","data$","processPoints","points","diff","x_min","x_max","y_min","y_max","range","point_list","MapRadiusComponent","_el","radius","last_seen","last_seen_at","updateRadius","box","MisconfiguredComponent","ctx_r3","PopoutMenuComponent","RedirectComponent","SafePipe","sanitizer","bypassSecurityTrustResourceUrl","bypassSecurityTrustUrl","bypassSecurityTrustScript","bypassSecurityTrustStyle","bypassSecurityTrustHtml","SecurityContext","SanitizePipe","sanitize","RESOURCE_URL","URL","SCRIPT","STYLE","HTML","StatusOverlayComponent","UnauthorisedComponent","UserAvatarComponent","initials","parts","DEFAULT_KEYS","VirtualKeyboardComponent","focusInput","blur","global","bottom","centerHorizontally","handleKeyPress","cursor_pos","selectionStart","substr","dispatchEvent","InputEvent","updateKeyState","selectionEnd","keyset","AttendeeListComponent","EventCardComponent","event_details_modal_component_1","EventDetailsModalComponent","level_class_1","building_class_1","response_status","_load","allow_edit","N","EventFormService","limit_map","limited_zones","zone_limit","favorite_spaces","filtered_spaces","has_calendar","system_ids","some","reset","openEventLinkModal","event_link_modal_component_1","creator","checkSelectedSpacesAreAvailable","is_owner","calendar","_makeBooking","exclude","space_ids","exclude_range","EventLinkModalComponent","_default_user","CalendarEvent","event_start","event_end","private","online_meeting_url","meeting_id","online_meeting_id","meeting_provider","online_meeting_provider","recurring","recurring_master_id","from_bookings","master","recurrence","range_start","range_end","days_of_week","old_system","attachments","is_external","guests","can_check_in","EVENTS_ENDPOINT","updateEvent","createEvent","guest_id","SharedEventsModule","attendee_list_component_1","event_card_component_1","min_size","slots","bkn_start","bkn_end","getFreeTimeSlots","block","DURATION_MAP","month","months","week","weeks","days","DEFAULT_RULES","auto_approve","stringToMinutes","rulemap","ruleset","checkRulesMatch","conditions","is_before","addToDate","is_after","min_length","max_length","rulesForSpace","BOOKING_DATE","visitor_type","needs_space","needs_parking","requestable","next_free_slot","currently_free","time_until_next_block","free_tomorrow","available_until","new_bookings","filter_options","from","to","filtered_list","organizer","from_booking","control","is_future","ActionFieldComponent","performAction","show_tooltip","AssetListFieldComponent","removeAsset","addAssets","CounterComponent","ctrl_key","step","shift_key","registerOnChange","registerOnTouched","FieldDateAdapter","format","displayFormat","DateFieldComponent","_from","until","_to","date_string","old_date","new_date","getHours","getMinutes","setDisabledState","useClass","dateInput","monthYearLabel","dateA11yLabel","monthYearA11yLabel","DurationFieldComponent","duration_options","generateDurationOptions","_updateOption","blocks","dayjs","custom_options","FormFieldsModule","user_search_field_component_1","HostSelectFieldComponent","item_list","ItemListFieldComponent","addChipItem","removeChipItem","RichTextInputComponent","_editor","root","innerHTML","_initialiseEditor","delta","clipboard","convert","setContents","Quill","_editor_el","bounds","_container_el","placeholder","readOnly","readonly","theme","on","_updateFn","off","SpaceListFieldComponent","changeSpaces","new_space_select_modal_component_1","removeSpace","TimeFieldComponent","show_select","_time_options","generateAvailableTimes","no_past_times","time_options","showSelect","select_field","openedChange","datestamp","show_past","UploadFileFieldComponent","onFileEvent","_uploadFile","on_change","blob","blobUtil","arrayBufferToBlob","upload","upload_list","file_name","upload_details","progress","created_at","access_url","readAsArrayBuffer","UploadListFieldComponent","removeFile","ctx_r20","re","test","UserListFieldComponent","search$","staff","visitors_list","validateEmail","openNewUserModal","search_valid_email","updateSearch","addUserFromEmail","addUser","_search_el","active_list","visit_expected","removeUser","a_user","addUsersFromFile","processCsvData","staff_id","first_name","last_name","user_utilities_1","internal_emails","endsWith","phone","downloadCSVTemplate","custom_template","displayFn","new_user_modal_component_1","ctx_r7","ctx_r11","UserSearchFieldComponent","query_fn","search_str","_input_el","search_results$","user_list","resetSearchString","active_user","assets_data_1","route_params","request","new_event","req","registerMocks","EVENT_TIME","seconds","milliseconds","nextEventTime","save","TYPES","TRACKING","users_data_1","zone_data_1","lvls","lvl_spaces","spaces_data_1","approver","asset_count","plate_number","tracking","bookings_data_1","query_params","user2","user3","handleSpaceAvailability","systems","events_data_1","mx","startOf","unix","event_status","randomStatus","rnd","PEOPLE","unshift","setup","event_spaces","Bookings","$poll_bookings","randomSpaceFeatures","numFeatures","PREDEF_USERS","common_mock_1","vaccination_proof","id_data","person","generateLocation","LOCATION_TYPES","level_spaces","meeting","subtract","geo","lat","lon","updated_at","triggers","num","mockLevel","MOCK_METADATA","contacts","bindings","area_management","location_services","contact_tracing","catering_data_1","generateMockDeskMetadata","assignee","assigned_to","assigned_name","generateParkingSpaces","map_regions","areas","properties","label_location","geometry","coordinates","DESK_FEATURES","CameraTilt","CameraPan","CameraModule","presets","$pan","dir","$tilt","tilt","$recall","$save_preset","createCameraModule","CaptureModule","remaining","$start","$pause","$resume","$stop","createCaptureModule","CONTACT_EVENTS","filterFn","contact_time","ContactTracingModule","$close_contacts","beginning","ending","mac_address","createContactTracingModule","RoomModule","inputs","connected","input_list","output_list","env_sources","outputs","source","$power","$share","$route","$updateState","following","$unroute","$connect","$disconnect","$link","$merge","$split","$notify","$preset","$volume","volume","$mute","mute","$unmute","$environment","$lock","locked","$unlock","Mic1","Mic2","Mic3","PC1","PC2","PC3","PC4","HDMI","VGA","Camera1","Camera2","Camera3","Camera4","TV1","VC1","Display1","Display2","Display3","Display4","Display5","states","createSystemModule","MockAreaManagementModule","$locate_user","$update","updateLocations","MAC_LOOKUP","no","len","area","fixed","usr","at_location","mac","ts_md5_1","hashStr","coordinates_from","s2_cell_id","variance","map_width","map_height","MockLocationServicesModule","$check_ownership_of","priority","overview","desk_count","desk_usage","device_capacity","device_count","estimated_people","percentage_use","recommendation","number","padZero","area_id","DisplayModule","createDisplayModule","MockBookingModule","_space","$start_meeting","last_booking_started","$end_meeting","$book_now","current_booking","next_booking","pending","pending_before","pending_period","updateBookings","MeetingPushModule","$econtrol","createMeetingPushModule","MicrophoneModule","createMicrophoneModule","PaymentsModule","$list_payment_methods","$add_payment_method","$get_product_prices","$create_payment_intent","$confirm_payment_intent","$cancel_payment_intent","$create_customer","createPaymentsModule","VideoConferenceModule","Status","$show_camera_pip","visible","selfview","$mic_mute","mic_mute","$presentation_mode","presentation_mode","$hangup","$call_place_on_hold","calls","$call_resume","$video_layout","layout","video_layout","$dtmf_send","digit","$dial","dial_number","createVideoConferenceModule","System","ContactTracing","AreaManagement","LocationServices","desks_1","Camera","Display","Microphone","Capture","MeetingPush","VidConf","Payment","ZONE_MOCKS","USER_MOCKS","SYSTEM_MOCKS","EVENT_MOCKS","CALENDAR_MOCKS","BOOKING_MOCKS","ASSET_MOCKS","Building","raw_data","disc_info","discovery_info","extras","extra_id","extra_name","loan_items","building_id","_roles","roles","_lockers","lockers","locker_structure","_systems","_phone_numbers","phone_numbers","room_configurations","attributes","searchables","neighbourhoods","lvl_features","level_id","catering_hours","visitor_space","holding_bay","orientations","booking_details","booking_rules","catering_restricted_from","role","role_names","featuresForLevel","BLD_COUNT","LVL_COUNT","level_name","generateMockLevel","nested","level2","Desk","qr_code","BuildingLevel","Organisation","setting","OrganisationService","_buildings","_levels","_active_building","buildingSettings","building_settings","_building_settings","bld_id","_organisation","tries","orgs","loadOrganisation","loadBuildings","loadLevels","loadSettings","org_list","org_zone","organisation_class_1","limit","available_room_configs","prev","curr","app_settings","global_settings","_initialiseActiveBuilding","saveBuilding","use_location","geolocation","getCurrentPosition","latitude","longitude","coords","closest_bld","c_lat","c_long","b_lat","b_long","pow","_setDefaultBuilding","ORG_COUNT","BLANK_CARD","card_number","cardholder","cvv","DATE_PIPE","CardInputFieldComponent","common_2","exp_month","exp_year","minLength","maxLength","is_amex","card_type","card_display","card_focused","_index","activeElement","onInput","_focusChange","PaymentModalComponent","processPayment","card_details","_validCardDetails","payment_modal_component_1","card_input_field_component_1","STRIPE_MODULE","PaymentsService","_active_card","cost","_getCostOfProduct","customer_id","_newCustomerID","_processPayment","rate","_addPaymentMethod","card","payment_method","SpaceSelectItemComponent","SpaceSelectModalComponent","space_map","spaceSelected","NewSpaceSelectModalComponent","SpaceDetailsComponent","SpaceFiltersDisplayComponent","space_filters_component_1","SpaceFiltersComponent","SpaceListComponent","SpaceLocationPinComponent","SpaceSelectMapComponent","space_location_pin_component_1","Space","support_url","configurations","organisation_1","SPACE_LIST","EMPTY_SPACE","SpacePipe","is_email","updateSpaceList","SPACE_COUNT","linked","long_name","searchable","controlable","cost_hour","linked_rooms","image","SharedSpacesModule","space_details_component_1","space_list_component_1","space_filters_display_component_1","space_map_component_1","SPACE_PIPE","SpacesService","_list","_init","loadSpaces","predicate","_compare","loadSpace","valid_spaces","FindAvailabilityModalComponent","today","current_hour","selection_left","selection_width","closeAndUpdate","el_rect","scrollTo","left","updateWidth","updateScroll","container_size","user_list_size","_move_size","offset","scrollLeft","startMovePeriod","stopPropagation","_move_last","MouseEvent","clientX","touches","move_time","_start_time","_onMovePeriod","_onMoveEnd","startMoveDuration","_onMoveDuration","change_px","change_min","UserAvailabilityComponent","_user$","calendars","GUEST_ENDPOINT","MapLocation","NewUserModalComponent","new_user","STAFF_ENDPOINT","UserFormComponent","hasError","touched","User","notes","photo","sys_admin","support","department","assistance_required","GuestUser","preferred_beverage","accepted_terms_conditions","StaffUser","USER_LIST","UserPipe","USER_COUNT","USER_EMAILS","external","delegates","delegate_count","visitor","staff_code","fields","SharedUsersModule","wfh_settings_modal_component_1","find_availability_modal_component_1","user_availability_component_1","WFH_SETTING_KEY","WFHSettingsModalComponent","_initWeekdays","_loadOptionForToday","weekdays","available_weekdays"],"sourceRoot":"webpack:///","sources":["./apps/outlook-addin/src/app/app-routing.module.ts","./apps/outlook-addin/src/app/app.component.ts","./apps/outlook-addin/src/app/app.module.ts","./apps/outlook-addin/src/app/components/not-found/not-found.component.ts","./apps/outlook-addin/src/app/components/shared.module.ts","./apps/outlook-addin/src/app/desks/desk-booking.component.ts","./apps/outlook-addin/src/app/desks/desk-form.component.ts","./apps/outlook-addin/src/app/desks/desk-success.component.ts","./apps/outlook-addin/src/app/meetings/meeting-booking.component.ts","./apps/outlook-addin/src/app/meetings/meeting-form.component.ts","./apps/outlook-addin/src/app/meetings/meeting-success.component.ts","./apps/outlook-addin/src/app/rooms/book.module.ts","./apps/outlook-addin/src/app/rooms/booking-confirmed/booking-confirmed.component.ts","./apps/outlook-addin/src/app/rooms/booking-confirmed/booking-confirmed.component.html","./apps/outlook-addin/src/app/rooms/features-filter.service.ts","./apps/outlook-addin/src/app/rooms/filter-space/filter-space.component.ts","./apps/outlook-addin/src/app/rooms/filter-space/filter-space.component.html","./apps/outlook-addin/src/app/rooms/find-space-item/find-space-item.component.ts","./apps/outlook-addin/src/app/rooms/find-space-item/find-space-item.component.html","./apps/outlook-addin/src/app/rooms/find-space/find-space.component.ts","./apps/outlook-addin/src/app/rooms/find-space/find-space.component.html","./apps/outlook-addin/src/app/rooms/map.service.ts","./apps/outlook-addin/src/app/rooms/room-booking.component.ts","./apps/outlook-addin/src/app/rooms/room-booking.component.html","./apps/outlook-addin/src/app/rooms/room-confirm.service.ts","./apps/outlook-addin/src/app/rooms/room-confirm/room-confirm.component.ts","./apps/outlook-addin/src/app/rooms/room-confirm/room-confirm.component.html","./apps/outlook-addin/src/app/rooms/room-details/room-details.component.ts","./apps/outlook-addin/src/app/rooms/room-details/room-details.component.html","./apps/outlook-addin/src/app/rooms/room-tile/room-tile.component.ts","./apps/outlook-addin/src/app/rooms/room-tile/room-tile.component.html","./apps/outlook-addin/src/app/rooms/upcoming-bookings/upcoming-bookings.component.ts","./apps/outlook-addin/src/environments/environment.prod.ts","./apps/outlook-addin/src/main.ts","./apps/workplace/src/app/book/meeting-flow/meeting-flow-confirm.component.ts","./apps/workplace/src/app/new-schedule/schedule-state.service.ts","./libs/assets/src/index.ts","./libs/assets/src/lib/asset-select-modal/asset-details.component.ts","./libs/assets/src/lib/asset-select-modal/asset-filters-display.component.ts","./libs/assets/src/lib/asset-select-modal/asset-filters.component.ts","./libs/assets/src/lib/asset-select-modal/asset-list.component.ts","./libs/assets/src/lib/asset-select-modal/asset-select-modal.component.ts","./libs/assets/src/lib/asset-state.service.ts","./libs/assets/src/lib/asset.class.ts","./libs/assets/src/lib/asset.utilities.ts","./libs/assets/src/lib/assets.fn.ts","./libs/assets/src/lib/assets.module.ts","./libs/bookings/src/index.ts","./libs/bookings/src/lib/booking-card.component.ts","./libs/bookings/src/lib/booking-details-modal.component.ts","./libs/bookings/src/lib/booking-form.service.ts","./libs/bookings/src/lib/booking-link-modal.component.ts","./libs/bookings/src/lib/booking.class.ts","./libs/bookings/src/lib/booking.utilities.ts","./libs/bookings/src/lib/bookings.fn.ts","./libs/bookings/src/lib/bookings.module.ts","./libs/bookings/src/lib/desk-confirm-modal.component.ts","./libs/bookings/src/lib/desk-list-field.component.ts","./libs/bookings/src/lib/desk-questions-modal.component.ts","./libs/bookings/src/lib/desk-select-modal/desk-details.component.ts","./libs/bookings/src/lib/desk-select-modal/desk-filters-display.component.ts","./libs/bookings/src/lib/desk-select-modal/desk-filters.component.ts","./libs/bookings/src/lib/desk-select-modal/desk-list.component.ts","./libs/bookings/src/lib/desk-select-modal/desk-map.component.ts","./libs/bookings/src/lib/desk-select-modal/desk-select-modal.component.ts","./libs/bookings/src/lib/desk.service.ts","./libs/bookings/src/lib/invite-visitor-form.component.ts","./libs/bookings/src/lib/parking-select-modal/parking-details.component.ts","./libs/bookings/src/lib/parking-select-modal/parking-filters-display.component.ts","./libs/bookings/src/lib/parking-select-modal/parking-filters.component.ts","./libs/bookings/src/lib/parking-select-modal/parking-list.component.ts","./libs/bookings/src/lib/parking-select-modal/parking-location-pin.component.ts","./libs/bookings/src/lib/parking-select-modal/parking-map.component.ts","./libs/bookings/src/lib/parking-select-modal/parking-select-modal.component.ts","./libs/bookings/src/lib/parking-space-list-field.component.ts","./libs/calendar/src/lib/calendar.class.ts","./libs/calendar/src/lib/calendar.fn.ts","./libs/catering/src/index.ts","./libs/catering/src/lib/catering-config-modal.component.ts","./libs/catering/src/lib/catering-import-menu-modal.component.ts","./libs/catering/src/lib/catering-item-modal.component.ts","./libs/catering/src/lib/catering-item.class.ts","./libs/catering/src/lib/catering-list-field.component.ts","./libs/catering/src/lib/catering-menu-item.component.ts","./libs/catering/src/lib/catering-menu.component.ts","./libs/catering/src/lib/catering-option-modal.component.ts","./libs/catering/src/lib/catering-order-item.component.ts","./libs/catering/src/lib/catering-order-list.component.ts","./libs/catering/src/lib/catering-order-modal.component.ts","./libs/catering/src/lib/catering-order-modal/catering-item-details.component.ts","./libs/catering/src/lib/catering-order-modal/catering-item-filters.component.ts","./libs/catering/src/lib/catering-order-modal/catering-item-list.component.ts","./libs/catering/src/lib/catering-order-modal/catering-order-state.service.ts","./libs/catering/src/lib/catering-order-modal/new-catering-order-modal.component.ts","./libs/catering/src/lib/catering-order-options-modal.component.ts","./libs/catering/src/lib/catering-order.class.ts","./libs/catering/src/lib/catering-order.component.ts","./libs/catering/src/lib/catering-orders.service.ts","./libs/catering/src/lib/catering-state.service.ts","./libs/catering/src/lib/catering.interfaces.ts","./libs/catering/src/lib/catering.module.ts","./libs/catering/src/lib/catering.ts","./libs/catering/src/lib/catering.vars.ts","./libs/common/src/index.ts","./libs/common/src/lib/angular-animations.ts","./libs/common/src/lib/api.ts","./libs/common/src/lib/application.ts","./libs/common/src/lib/base.class.ts","./libs/common/src/lib/calendar-links.ts","./libs/common/src/lib/common.ts","./libs/common/src/lib/feature-available.guard.ts","./libs/common/src/lib/formatting.ts","./libs/common/src/lib/general.ts","./libs/common/src/lib/google-analytics.service.ts","./libs/common/src/lib/hotkeys.service.ts","./libs/common/src/lib/notifications.ts","./libs/common/src/lib/placeos.ts","./libs/common/src/lib/remote-logging.service.ts","./libs/common/src/lib/room-configuration.interface.ts","./libs/common/src/lib/settings.service.ts","./apps/outlook-addin/src/environments/settings.ts","./libs/common/src/lib/spec-helpers.ts","./libs/common/src/lib/timezone-helpers.ts","./libs/common/src/lib/user-state.ts","./libs/common/src/lib/version.ts","./libs/common/src/lib/vorlon.service.ts","./libs/components/src/index.ts","./libs/components/src/lib/action-icon.component.ts","./libs/components/src/lib/authorised-admin.guard.ts","./libs/components/src/lib/authorised-user.guard.ts","./libs/components/src/lib/binding.directive.ts","./libs/components/src/lib/components.module.ts","./libs/components/src/lib/confirm-modal.component.ts","./libs/components/src/lib/custom-table.component.ts","./libs/components/src/lib/custom-tooltip.component.ts","./libs/components/src/lib/debug-console.component.ts","./libs/components/src/lib/duration.pipe.ts","./libs/components/src/lib/fixed.pipe.ts","./libs/components/src/lib/global-banner.component.ts","./libs/components/src/lib/global-loading.component.ts","./libs/components/src/lib/icon.component.ts","./libs/components/src/lib/image-carousel.component.ts","./libs/components/src/lib/interactive-map.component.ts","./libs/components/src/lib/json-display.component.ts","./libs/components/src/lib/login.component.ts","./libs/components/src/lib/map-locate-modal.component.ts","./libs/components/src/lib/map-pin.component.ts","./libs/components/src/lib/map-polygon.component.ts","./libs/components/src/lib/map-radius.component.ts","./libs/components/src/lib/misconfigured.component.ts","./libs/components/src/lib/popout-menu.component.ts","./libs/components/src/lib/redirect.component.ts","./libs/components/src/lib/safe.pipe.ts","./libs/components/src/lib/sanitise.pipe.ts","./libs/components/src/lib/status-overlay.component.ts","./libs/components/src/lib/unauthorised.component.ts","./libs/components/src/lib/user-avatar.component.ts","./libs/components/src/lib/virtual-keyboard.component.ts","./libs/events/src/index.ts","./libs/events/src/lib/attendee-list.component.ts","./libs/events/src/lib/event-card.component.ts","./libs/events/src/lib/event-details-modal.component.ts","./libs/events/src/lib/event-form.service.ts","./libs/events/src/lib/event-link-modal.component.ts","./libs/events/src/lib/event.class.ts","./libs/events/src/lib/events.fn.ts","./libs/events/src/lib/events.module.ts","./libs/events/src/lib/events.ts","./libs/events/src/lib/helpers.ts","./libs/events/src/lib/utilities.ts","./libs/events/src/lib/validators.ts","./libs/form-fields/src/index.ts","./libs/form-fields/src/lib/action-field.component.ts","./libs/form-fields/src/lib/asset-list-field.component.ts","./libs/form-fields/src/lib/counter.component.ts","./libs/form-fields/src/lib/date-field.component.ts","./libs/form-fields/src/lib/duration-field.component.ts","./libs/form-fields/src/lib/form-fields.module.ts","./libs/form-fields/src/lib/host-select-field.component.ts","./libs/form-fields/src/lib/item-list-field.component.ts","./libs/form-fields/src/lib/rich-text-input.component.ts","./libs/form-fields/src/lib/space-list-field.component.ts","./libs/form-fields/src/lib/time-field.component.ts","./libs/form-fields/src/lib/upload-file-field.component.ts","./libs/form-fields/src/lib/upload-list-field.component.ts","./libs/form-fields/src/lib/user-list-field.component.ts","./libs/form-fields/src/lib/user-search-field.component.ts","./libs/mocks/src/index.ts","./libs/mocks/src/lib/api/assets.data.ts","./libs/mocks/src/lib/api/assets.mock.ts","./libs/mocks/src/lib/api/bookings.data.ts","./libs/mocks/src/lib/api/bookings.mock.ts","./libs/mocks/src/lib/api/calendars.mock.ts","./libs/mocks/src/lib/api/catering.data.ts","./libs/mocks/src/lib/api/common.mock.ts","./libs/mocks/src/lib/api/events.data.ts","./libs/mocks/src/lib/api/events.mock.ts","./libs/mocks/src/lib/api/spaces.data.ts","./libs/mocks/src/lib/api/systems.mock.ts","./libs/mocks/src/lib/api/users.data.ts","./libs/mocks/src/lib/api/users.mock.ts","./libs/mocks/src/lib/api/zone.data.ts","./libs/mocks/src/lib/api/zones.mock.ts","./libs/mocks/src/lib/realtime/camera.ts","./libs/mocks/src/lib/realtime/capture.ts","./libs/mocks/src/lib/realtime/contact-tracing.ts","./libs/mocks/src/lib/realtime/control.ts","./libs/mocks/src/lib/realtime/desks.ts","./libs/mocks/src/lib/realtime/display.ts","./libs/mocks/src/lib/realtime/events.ts","./libs/mocks/src/lib/realtime/meeting.ts","./libs/mocks/src/lib/realtime/microphone.ts","./libs/mocks/src/lib/realtime/payments.ts","./libs/mocks/src/lib/realtime/video-conference.ts","./libs/mocks/src/lib/systems-bindings.mock.ts","./libs/mocks/src/mocks.ts","./libs/organisation/src/index.ts","./libs/organisation/src/lib/building.class.ts","./libs/organisation/src/lib/building.utilities.ts","./libs/organisation/src/lib/desk.class.ts","./libs/organisation/src/lib/level.class.ts","./libs/organisation/src/lib/organisation.class.ts","./libs/organisation/src/lib/organisation.service.ts","./libs/organisation/src/lib/organisation.utilities.ts","./libs/payments/src/index.ts","./libs/payments/src/lib/card-input-field.component.ts","./libs/payments/src/lib/payment-modal.component.ts","./libs/payments/src/lib/payments.module.ts","./libs/payments/src/lib/payments.service.ts","./libs/spaces/src/index.ts","./libs/spaces/src/lib/space-select-item.component.ts","./libs/spaces/src/lib/space-select-modal.component.ts","./libs/spaces/src/lib/space-select-modal/new-space-select-modal.component.ts","./libs/spaces/src/lib/space-select-modal/space-details.component.ts","./libs/spaces/src/lib/space-select-modal/space-filters-display.component.ts","./libs/spaces/src/lib/space-select-modal/space-filters.component.ts","./libs/spaces/src/lib/space-select-modal/space-list.component.ts","./libs/spaces/src/lib/space-select-modal/space-location-pin.component.ts","./libs/spaces/src/lib/space-select-modal/space-map.component.ts","./libs/spaces/src/lib/space.class.ts","./libs/spaces/src/lib/space.pipe.ts","./libs/spaces/src/lib/space.utilities.ts","./libs/spaces/src/lib/spaces.module.ts","./libs/spaces/src/lib/spaces.service.ts","./libs/spaces/src/lib/spaces.ts","./libs/users/src/index.ts","./libs/users/src/lib/find-availability-modal/find-availability-modal.component.ts","./libs/users/src/lib/find-availability-modal/user-availability.component.ts","./libs/users/src/lib/guests.fn.ts","./libs/users/src/lib/location.class.ts","./libs/users/src/lib/new-user-modal.component.ts","./libs/users/src/lib/staff.fn.ts","./libs/users/src/lib/user-form.component.ts","./libs/users/src/lib/user.class.ts","./libs/users/src/lib/user.pipe.ts","./libs/users/src/lib/user.utilities.ts","./libs/users/src/lib/users.module.ts","./libs/users/src/lib/wfh-settings-modal.component.ts"],"sourcesContent":["import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { FindSpaceComponent } from './rooms/find-space/find-space.component';\nimport { RoomBookingComponent } from './rooms/room-booking.component';\nimport { BookingConfirmedComponent } from './rooms/booking-confirmed/booking-confirmed.component';\nimport { UpcomingBookingsComponent } from './rooms/upcoming-bookings/upcoming-bookings.component';\nimport {\n    AuthorisedUserGuard,\n    UnauthorisedComponent,\n} from '@placeos/components';\nimport { NotFoundComponent } from './components/not-found/not-found.component';\nimport { DeskBookingComponent } from './desks/desk-booking.component';\nimport { DeskBookingSuccessComponent } from './desks/desk-success.component';\nimport { MeetingBookingComponent } from './meetings/meeting-booking.component';\nimport { MeetingBookingSuccessComponent } from './meetings/meeting-success.component';\n\nconst routes: Routes = [\n    { path: 'unauthorised', component: UnauthorisedComponent },\n    { path: '404', component: NotFoundComponent },\n    {\n        path: '',\n        canActivate: [AuthorisedUserGuard],\n        canLoad: [AuthorisedUserGuard],\n        children: [\n            {\n                path: 'ms-auth',\n                component: RoomBookingComponent,\n            },\n            {\n                path: 'book',\n                children: [\n                    { path: 'spaces', component: RoomBookingComponent },\n                    { path: 'spaces/success', component: BookingConfirmedComponent },\n                    { path: 'meeting', component: MeetingBookingComponent },\n                    { path: 'meeting/success', component: MeetingBookingSuccessComponent },\n                    { path: 'desks', component: DeskBookingComponent },\n                    { path: 'desks/success', component: DeskBookingSuccessComponent },\n                ],\n            },\n            {\n                path: 'schedule/view',\n                component: FindSpaceComponent,\n            },\n            {\n                path: 'confirm/success',\n                component: BookingConfirmedComponent,\n            },\n            {\n                path: 'upcoming',\n                component: UpcomingBookingsComponent,\n            },\n            { path: '**', pathMatch: 'full', redirectTo: '/book/meeting' },\n        ],\n    },\n    { path: '**', pathMatch: 'full', redirectTo: '/book/meeting' },\n];\n\n@NgModule({\n    imports: [RouterModule.forRoot(routes, { useHash: true })],\n    exports: [RouterModule],\n})\nexport class AppRoutingModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { SwUpdate } from '@angular/service-worker';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { first } from 'rxjs/operators';\nimport {\n    authority,\n    invalidateToken,\n    isMock,\n    setToken,\n    token,\n} from '@placeos/ts-client';\nimport {\n    BaseClass,\n    current_user,\n    currentUser,\n    setAppName,\n    setNotifyOutlet,\n    SettingsService,\n    setupCache,\n    setupPlace,\n    log,\n    notifyInfo,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { setInternalUserDomain } from 'libs/users/src/lib/user.utilities';\nimport { setDefaultCreator } from 'libs/events/src/lib/event.class';\n\nimport * as MOCKS from '@placeos/mocks';\nimport { loadAuthority } from '@placeos/ts-client/dist/esm/auth/functions';\n\ndeclare let Office: any;\ndeclare let OfficeRuntime: any;\n\n@Component({\n    selector: 'app-root',\n    template: `\n        <router-outlet></router-outlet>\n        <global-loading></global-loading>\n        <debug-console></debug-console>\n    `,\n    styles: [``],\n})\nexport class AppComponent extends BaseClass implements OnInit {\n    title = 'outlook-addin';\n\n    constructor(\n        private _settings: SettingsService,\n        private _org: OrganisationService, // For init\n        private _cache: SwUpdate,\n        private _snackbar: MatSnackBar\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        console.info(`Initialising application...`);\n        window.history.replaceState = (data: null, unused: null) => {};\n\n        log('APP', 'MOCKS:', MOCKS);\n\n        setNotifyOutlet(this._snackbar);\n        console.info(`Waiting for application settings...`);\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        console.info(`Waiting for office library to initialise...`);\n        await Office.onReady();\n        console.info(`Initialising auth...`);\n        await this._initialiseAuth()\n        console.info(`Checking for existing auth...`);\n        if (token()) return this._finishInitialise();\n        console.info(`No existing auth...`);\n        try {\n            console.info(`Checking for office token...`);\n            this.timeout('error', () => {throw 'Unable to get office token...'}, 2000);\n            const get_token = Office?.auth?.getAccessToken();\n            const tkn = await (get_token || Promise.resolve());\n            this.clearTimeout('error');\n            if (!tkn) throw 'Unable to get office token...';\n            console.info(`Loaded office token. ${tkn}`);\n            sessionStorage.setItem('OFFICE.token', tkn);\n            await this._initialiseAuth(false);\n            this._finishInitialise();\n        } catch (e) {\n            console.info(JSON.stringify(e));\n            if (!Office?.context?.ui) {\n                console.info(`Error office API not loaded.`);\n                await this._initialiseAuth(false);\n            } else {\n                await this._authenticateWithOffice();\n            }\n        }\n    }\n\n    private async _initialiseAuth(local = true) {\n        setAppName(this._settings.get('app.short_name'));\n        const settings = this._settings.get('composer') || {};\n        settings.local_login = local;\n        settings.storage = 'local';\n        settings.mock =\n            !!this._settings.get('mock') ||\n            location.origin.includes('demo.place.tech');\n        await setupPlace(settings).catch((_) => console.error(_));\n    }\n\n    private async _finishInitialise() {\n        setupCache(this._cache);\n        if (!this._settings.get('composer.local_login')) {\n            this.timeout('wait_for_user', () => this.onInitError(), 30 * 1000);\n        }\n        await current_user.pipe(first((_) => !!_)).toPromise();\n        this.clearTimeout('wait_for_user');\n        setDefaultCreator(currentUser());\n        setInternalUserDomain(\n            this._settings.get('app.general.internal_user_domain') ||\n                `@${currentUser()?.email?.split('@')[1]}`\n        );\n    }\n\n    private async _authenticateWithOffice() {\n        console.info(`Authenticating with office...`);\n        this.timeout('office_auth', () => {\n            const path = `${location.origin}${location.pathname}#ms-auth=true`;\n            console.info(\n                `Opening office authentication dialog with URL: ${path}`\n            );\n            Office.context.ui.displayDialogAsync(\n                path,\n                { height: 60, width: 30 },\n                (result) => {\n                    console.info(`Authenticated with office from dialog...`);\n                    const dialog = result.value;\n                    dialog.addEventHandler(\n                        Office.EventType.DialogMessageReceived,\n                        (token) => {\n                            if (token) setToken(token);\n                            this._finishInitialise();\n                            dialog.close();\n                        }\n                    );\n                }\n            );\n        });\n        console.info(`URL: ${window.location.href}`);\n        if (\n            window.location.href.includes('ms-auth=true') ||\n            sessionStorage.getItem('ms-auth')\n        ) {\n            sessionStorage.setItem('ms-auth', 'true');\n            console.info(`Authenticating with office from a dialog...`);\n            this.clearTimeout('office_auth');\n            await this._initialiseAuth(false);\n            if (!token()) return;\n            Office.context.ui.messageParent(token() || '');\n        }\n    }\n\n    private onInitError() {\n        if (isMock() || currentUser()?.is_logged_in) return;\n        invalidateToken();\n        location.reload();\n\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { BrowserModule } from '@angular/platform-browser';\nimport { HttpClientModule } from '@angular/common/http';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\n\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatNativeDateModule } from '@angular/material/core';\nimport { ServiceWorkerModule } from '@angular/service-worker';\n\nimport { PaymentsModule } from '@placeos/payments';\nimport { AssetsModule } from '@placeos/assets';\nimport { SharedCateringModule } from '@placeos/catering';\nimport { FormFieldsModule } from '@placeos/form-fields';\n\nimport { environment } from '../environments/environment';\nimport { AppComponent } from './app.component';\nimport { AppRoutingModule } from './app-routing.module';\nimport { BookModule } from './rooms/book.module';\nimport { SharedComponentModule } from './components/shared.module';\nimport { SpacePipe } from 'libs/spaces/src/lib/space.pipe';\nimport { DeskBookingComponent } from './desks/desk-booking.component';\nimport { DeskBookingFormComponent } from './desks/desk-form.component';\nimport { DeskBookingSuccessComponent } from './desks/desk-success.component';\nimport { MeetingBookingComponent } from './meetings/meeting-booking.component';\nimport { MeetingBookingFormComponent } from './meetings/meeting-form.component';\nimport { MeetingBookingSuccessComponent } from './meetings/meeting-success.component';\nimport { MeetingFlowConfirmComponent } from 'apps/workplace/src/app/book/meeting-flow/meeting-flow-confirm.component';\n\n@NgModule({\n    declarations: [\n        AppComponent,\n\n        DeskBookingComponent,\n        DeskBookingFormComponent,\n        DeskBookingSuccessComponent,\n\n        MeetingBookingComponent,\n        MeetingBookingFormComponent,\n        MeetingBookingSuccessComponent,\n        MeetingFlowConfirmComponent\n    ],\n    imports: [\n        BrowserModule,\n        BrowserAnimationsModule,\n        AppRoutingModule,\n        BookModule,\n        SharedComponentModule,\n        BrowserAnimationsModule,\n        HttpClientModule,\n        FormsModule,\n        MatNativeDateModule,\n        MatSnackBarModule,\n        PaymentsModule,\n        AssetsModule,\n        FormFieldsModule,\n        ReactiveFormsModule,\n        SharedCateringModule,\n\n        ServiceWorkerModule.register('ngsw-worker.js', {\n            enabled: environment.production,\n        }),\n    ],\n    providers: [SpacePipe],\n    bootstrap: [AppComponent],\n})\nexport class AppModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\n\n@Component({\n    selector: 'placeos-not-found',\n    styles: [``],\n    template: `<div\n        class=\"flex flex-1 flex-col z-0 bg-gray-50 h-full overflow-y-auto\"\n    >\n        <section\n            class=\"flex flex-col border-b border-gray-300 py-5 h-full items-center justify-center\"\n        >\n            <div class=\"mx-3 flex flex-row\">\n                <img\n                    src=\"assets/not-found.svg\"\n                    alt=\"graphic of magnifying glass\"\n                    width=\"200px\"\n                    class=\"items-center\"\n                />\n            </div>\n            <div class=\"mx-3 flex flex-row\">\n                <div class=\"mb-3\">\n                    <span class=\"text-3xl font-bold mr-auto text-gray-700\">\n                        Page not found</span\n                    >\n                </div>\n            </div>\n            <div class=\"mx-3 flex flex-row\">\n                <span class=\"flex flex-row\">\n                    The page\n                    <span class=\"font-bold mx-1\"> {{ router.url }} </span> was\n                    not found.\n                </span>\n            </div>\n        </section>\n    </div> `,\n})\nexport class NotFoundComponent implements OnInit {\n    constructor(public router: Router) {}\n\n    ngOnInit(): void {}\n}\n","import { NgModule, Type } from '@angular/core';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatRippleModule } from '@angular/material/core';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatProgressBarModule } from '@angular/material/progress-bar';\nimport { MatExpansionModule } from '@angular/material/expansion';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatSliderModule } from '@angular/material/slider';\nimport { MatIconModule } from '@angular/material/icon';\nimport { NotFoundComponent } from './not-found/not-found.component';\nimport { SharedBookingsModule } from '@placeos/bookings';\nimport { SharedEventsModule } from '@placeos/events';\nimport { ComponentsModule } from '@placeos/components';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\n\nconst COMPONENTS: Type<any>[] = [NotFoundComponent];\n\nconst MATERIAL_MODULES: any[] = [\n    MatButtonModule,\n    MatSnackBarModule,\n    MatDatepickerModule,\n    MatDialogModule,\n    MatFormFieldModule,\n    MatIconModule,\n    MatInputModule,\n    MatProgressSpinnerModule,\n    MatProgressBarModule,\n    MatAutocompleteModule,\n    MatSelectModule,\n    MatChipsModule,\n    MatRippleModule,\n    MatMenuModule,\n    MatCheckboxModule,\n    MatExpansionModule,\n    MatTabsModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatRadioModule,\n    MatSliderModule,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        BrowserAnimationsModule,\n        SharedBookingsModule,\n        SharedEventsModule,\n        ComponentsModule,\n    ],\n    exports: [\n        ...COMPONENTS,\n        ...MATERIAL_MODULES,\n        SharedBookingsModule,\n        SharedEventsModule,\n        ComponentsModule,\n    ],\n})\nexport class SharedComponentModule {}\n","import { Component } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { BookingFormService } from '@placeos/bookings';\n\n@Component({\n    selector: 'desk-booking',\n    template: `\n        <div class=\"absolute inset-0 bg-gray-200 dark:bg-neutral-600\">\n            <div class=\"mx-auto w-full max-w-[512px] overflow-auto max-h-screen\">\n                <h3 class=\"text-2xl p-4 font-medium\">Book Desk</h3>\n                <desk-booking-form></desk-booking-form>\n                <div class=\"flex flex-col p-4 space-y-2 border-t border-gray-200 dark:border-neutral-500\">\n                    <button mat-button class=\"w-full\" [disabled]=\"!form.value.asset_id\" (click)=\"makeBooking()\">\n                        Book Desk\n                    </button>\n                    <button mat-button class=\"w-full inverse\" (click)=\"clearForm()\">\n                        Clear Form\n                    </button>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class DeskBookingComponent {\n\n    public readonly clearForm = () => this._service.clearForm();\n\n    public get form() {\n        return this._service.form;\n    }\n\n    constructor(private _service: BookingFormService, private _router: Router) {}\n\n    public async makeBooking() {\n        await this._service.confirmPost();\n        this._router.navigate(['/book', 'desks', 'success'])\n\n    }\n}\n","import { Component } from '@angular/core';\nimport { BookingFormService } from '@placeos/bookings';\nimport { BaseClass, SettingsService } from '@placeos/common';\nimport { Desk } from '@placeos/organisation';\n\n@Component({\n    selector: 'desk-booking-form',\n    template: `\n        <div\n            class=\"divide-y divide-gray-300 dark:divide-neutral-500 space-y-2\"\n            *ngIf=\"form\"\n            [formGroup]=\"form\"\n        >\n            <section class=\"p-4\">\n                <h3 class=\"space-x-2 flex items-center mb-4\">\n                    <div\n                        class=\"border border-black dark:border-neutral-500 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        1\n                    </div>\n                    <div class=\"text-xl\">Details</div>\n                </h3>\n                <div class=\"flex items-center flex-wrap sm:space-x-2\">\n                    <div class=\"flex-1 min-w-[256px]\">\n                        <label for=\"title\">Add Title<span>*</span></label>\n                        <mat-form-field appearance=\"outline\" class=\"w-full\">\n                            <input\n                                matInput\n                                name=\"title\"\n                                formControlName=\"title\"\n                                placeholder=\"e.g. Focus Time\"\n                            />\n                            <mat-error>Booking title is required.</mat-error>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"flex-1 min-w-[256px]\">\n                        <label for=\"date\">Date<span>*</span></label>\n                        <a-date-field name=\"date\" formControlName=\"date\">\n                            Date and time must be in the future\n                        </a-date-field>\n                    </div>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <div class=\"flex-1 w-1/3\">\n                        <label for=\"start-time\">Start Time<span>*</span></label>\n                        <a-time-field\n                            name=\"start-time\"\n                            [ngModel]=\"form.value.date\"\n                            (ngModelChange)=\"form.patchValue({ date: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        ></a-time-field>\n                    </div>\n                    <div class=\"flex-1 w-1/3 relative\">\n                        <label for=\"end-time\">End Time<span>*</span></label>\n                        <a-duration-field\n                            name=\"end-time\"\n                            formControlName=\"duration\"\n                            [time]=\"form.get('date')?.value\"\n                            [max]=\"12 * 60\"\n                            [min]=\"60\"\n                            [step]=\"60\"\n                        >\n                        </a-duration-field>\n                        <mat-checkbox\n                            formControlName=\"all_day\"\n                            *ngIf=\"allow_all_day\"\n                            class=\"absolute top-0 right-0\"\n                        >\n                            All Day\n                        </mat-checkbox>\n                    </div>\n                </div>\n                <div\n                    class=\"flex items-center space-x-2\"\n                    *ngIf=\"can_book_lockers\"\n                >\n                    <div class=\"flex-1 w-1/3\">\n                        <mat-checkbox\n                            [ngModel]=\"!!form.value.secondary_resource\"\n                            (ngModelChange)=\"\n                                form.patchValue({\n                                    secondary_resource: $event ? 'locker' : ''\n                                })\n                            \"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        >\n                            Require locker\n                        </mat-checkbox>\n                    </div>\n                </div>\n            </section>\n\n            <section class=\"p-4\">\n                <h3 class=\"space-x-2 flex items-center mb-4\">\n                    <div\n                        class=\"border border-black dark:border-neutral-500 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        2\n                    </div>\n                    <div class=\"text-xl\">Desk</div>\n                </h3>\n                <desk-list-field formControlName=\"resources\"></desk-list-field>\n            </section>\n            <section class=\"p-4\" *ngIf=\"allow_assets\">\n                <h3 class=\"space-x-2 flex items-center mb-4\">\n                    <div\n                        class=\"border border-black dark:border-neutral-500 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        3\n                    </div>\n                    <div class=\"text-xl\">Request Asset</div>\n                </h3>\n                <asset-list-field formControlName=\"assets\"></asset-list-field>\n            </section>\n        </div>\n    `,\n    styles: [``],\n})\nexport class DeskBookingFormComponent extends BaseClass {\n    public readonly form = this._service.form;\n\n    public get allow_assets() {\n        return this._settings.get('app.bookings.allow_assets');\n    }\n\n    constructor(\n        private _service: BookingFormService,\n        private _settings: SettingsService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this._service.setOptions({ type: 'desk' });\n        this.subscription(\n            'change',\n            this._service.form\n                .get('resources')\n                ?.valueChanges?.subscribe((list) =>\n                    list.length ? this.setBookingAsset(list[0]) : ''\n                )\n        );\n    }\n\n    private setBookingAsset(desk: Desk) {\n        if (!desk) return;\n        this._service.form.patchValue({\n            asset_id: desk?.id,\n            asset_name: desk.name,\n            map_id: desk?.map_id || desk?.id,\n            description: desk.name,\n            booking_type: 'desk',\n            zones: desk.zone ? [desk.zone?.parent_id, desk.zone?.id] : [],\n            booking_asset: desk,\n        });\n    }\n}\n","import { Component } from '@angular/core';\nimport { BookingFormService } from '@placeos/bookings';\n\n@Component({\n    selector: 'desk-booking-success',\n    template: `\n        <div class=\"absolute inset-0 bg-white dark:bg-neutral-600 flex flex-col items-center justify-center space-y-4 p-4 text-center\">\n            <h3 class=\"text-3xl\">Booking Confirmed!</h3>\n            <img src=\"assets/tick_success.svg\" />\n            <p>\n                Your desk booking for\n                <i>{{ last_success?.asset_name || last_success?.asset_id }}</i>\n                has been successfully booked for the\n                {{ last_success?.date | date: 'dd MMMM yyyy' }} at\n                {{ last_success?.date | date: 'shortTime' }} -\n                {{\n                    last_success?.date + last_success?.duration * 60 * 1000\n                        | date: 'shortTime'\n                }}\n            </p>\n            <a button mat-button [routerLink]=\"['/book', 'desks']\" class=\"w-64\">\n                New Booking\n            </a>\n        </div>\n    `,\n    styles: [`\n        :host {\n            height: 100%;\n            width: 100%;\n        }\n    `],\n})\nexport class DeskBookingSuccessComponent {\n    public readonly last_success = this._service.last_success;\n\n    constructor(private _service: BookingFormService) {}\n}\n","import { Component } from '@angular/core';\nimport { MatBottomSheet, MatBottomSheetRef } from '@angular/material/bottom-sheet';\nimport { Router } from '@angular/router';\nimport { currentUser, getInvalidFields, notifyError } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { MeetingFlowConfirmComponent } from 'apps/workplace/src/app/book/meeting-flow/meeting-flow-confirm.component';\n\n@Component({\n    selector: 'meeting-booking',\n    template: `\n        <div class=\"absolute inset-0 bg-gray-200 dark:bg-neutral-600\">\n            <div class=\"mx-auto w-full max-w-[512px] overflow-auto max-h-screen\">\n                <h3 class=\"text-2xl p-4 font-medium\">Book Meeting</h3>\n                <meeting-booking-form></meeting-booking-form>\n                <div class=\"flex flex-col p-4 space-y-2 border-t border-gray-200 dark:border-neutral-500\">\n                    <button mat-button class=\"w-full\" (click)=\"makeBooking()\">\n                        Book Meeting\n                    </button>\n                    <button mat-button class=\"w-full inverse\" (click)=\"clearForm()\">\n                        Clear Form\n                    </button>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class MeetingBookingComponent {\n\n    public sheet_ref: MatBottomSheetRef;\n\n    public readonly clearForm = () => this._service.clearForm();\n\n    public get form() {\n        return this._service.form;\n    }\n\n    constructor(private _service: EventFormService, private _router: Router, private _bottom_sheet: MatBottomSheet) {}\n\n    public makeBooking() {\n        if (!this.form.value.host) this.form.patchValue({ host: currentUser()?.email });\n        if (!this.form.valid)\n            return notifyError(\n                `Some fields are invalid. [${getInvalidFields(this.form).join(\n                    ', '\n                )}]`\n            );\n        this.sheet_ref = this._bottom_sheet.open(MeetingFlowConfirmComponent);\n        this.sheet_ref.instance.show_close = true;\n        this.sheet_ref.afterDismissed().subscribe((value) => {\n            if (value) {\n                this._router.navigate(['/book', 'meeting', 'success']);\n                this._service.setView('success');\n            }\n        });\n    };\n}\n","import { Component } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ANIMATION_SHOW_CONTRACT_EXPAND, BaseClass, currentUser, SettingsService } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { FindAvailabilityModalComponent } from '@placeos/users';\n\n@Component({\n    selector: 'meeting-booking-form',\n    template: `\n        <div\n            class=\"divide-y divide-gray-300 dark:divide-neutral-500 space-y-2\"\n            *ngIf=\"form\"\n            [formGroup]=\"form\"\n        >\n            <section class=\"p-4\">\n                <h3 class=\"space-x-2 flex items-center\">\n                    <div\n                        class=\"bg-black/20 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        1\n                    </div>\n                    <div class=\"text-xl\">Details</div>\n                    <div class=\"flex-1 w-px\"></div>\n                    <button\n                        mat-icon-button\n                        (click)=\"hide_block.details = !hide_block.details\"\n                    >\n                        <app-icon>{{\n                            hide_block.details ? 'expand_more' : 'expand_less'\n                        }}</app-icon>\n                    </button>\n                </h3>\n                <div\n                    class=\"overflow-hidden\"\n                    [@show]=\"hide_block.details ? 'hide' : 'show'\"\n                >\n                    <div class=\"flex items-center flex-wrap sm:space-x-2\">\n                        <div class=\"flex-1 min-w-[256px]\">\n                            <label for=\"title\">Add Title<span>*</span></label>\n                            <mat-form-field appearance=\"outline\" class=\"w-full\">\n                                <input\n                                    matInput\n                                    name=\"title\"\n                                    formControlName=\"title\"\n                                    placeholder=\"e.g. Team Meeting\"\n                                />\n                                <mat-error\n                                    >Meeting title is required.</mat-error\n                                >\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex-1 min-w-[256px]\">\n                            <label for=\"date\">Date<span>*</span></label>\n                            <a-date-field name=\"date\" formControlName=\"date\">\n                                Date and time must be in the future\n                            </a-date-field>\n                        </div>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <div class=\"flex-1 w-1/3\">\n                            <label for=\"start-time\"\n                                >Start Time<span>*</span></label\n                            >\n                            <a-time-field\n                                name=\"start-time\"\n                                [ngModel]=\"form.value.date\"\n                                (ngModelChange)=\"\n                                    form.patchValue({ date: $event })\n                                \"\n                                [ngModelOptions]=\"{ standalone: true }\"\n                            ></a-time-field>\n                        </div>\n                        <div class=\"flex-1 w-1/3 relative\">\n                            <label for=\"end-time\">End Time<span>*</span></label>\n                            <a-duration-field\n                                name=\"end-time\"\n                                formControlName=\"duration\"\n                                [time]=\"form?.value?.date\"\n                                [max]=\"max_duration\"\n                            >\n                            </a-duration-field>\n                            <mat-checkbox\n                                formControlName=\"all_day\"\n                                *ngIf=\"allow_all_day\"\n                                class=\"absolute top-0 right-0\"\n                            >\n                                All Day\n                            </mat-checkbox>\n                        </div>\n                    </div>\n                    <div *ngIf=\"can_book_for_others\" class=\"w-full\">\n                        <label for=\"host\">Host<span>*</span></label>\n                        <host-select-field\n                            name=\"host\"\n                            formControlName=\"organiser\"\n                        ></host-select-field>\n                    </div>\n                </div>\n            </section>\n            <section class=\"p-4\" *ngIf=\"!hide_attendees\">\n                <h3 class=\"space-x-2 flex items-center\">\n                    <div\n                        class=\"bg-black/20 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        2\n                    </div>\n                    <div class=\"text-xl\">Attendees</div>\n                    <div class=\"flex-1 w-px\"></div>\n                    <button\n                        matRipple\n                        class=\"bg-none underline text-xs text-blue-500\"\n                        (click)=\"findAvailableTime()\"\n                    >\n                        Availability\n                    </button>\n                    <button\n                        mat-icon-button\n                        (click)=\"hide_block.attendees = !hide_block.attendees\"\n                    >\n                        <app-icon>{{\n                            hide_block.attendees ? 'expand_more' : 'expand_less'\n                        }}</app-icon>\n                    </button>\n                </h3>\n                <div\n                    class=\"overflow-hidden\"\n                    [@show]=\"hide_block.attendees ? 'hide' : 'show'\"\n                >\n                    <a-user-list-field\n                        class=\"mt-4\"\n                        formControlName=\"attendees\"\n                    ></a-user-list-field>\n                </div>\n            </section>\n            <section class=\"p-4\">\n                <h3 class=\"space-x-2 flex items-center\">\n                    <div\n                        class=\"bg-black/20 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        3\n                    </div>\n                    <div class=\"text-xl\">Room</div>\n                    <div class=\"flex-1 w-px\"></div>\n                    <button\n                        mat-icon-button\n                        (click)=\"hide_block.resources = !hide_block.resources\"\n                    >\n                        <app-icon>{{\n                            hide_block.resources ? 'expand_more' : 'expand_less'\n                        }}</app-icon>\n                    </button>\n                </h3>\n                <div\n                    class=\"overflow-hidden\"\n                    [@show]=\"hide_block.resources ? 'hide' : 'show'\"\n                >\n                    <space-list-field\n                        class=\"mt-4\"\n                        formControlName=\"resources\"\n                    ></space-list-field>\n                </div>\n            </section>\n            <section class=\"p-4\" *ngIf=\"has_catering\">\n                <h3 class=\"space-x-2 flex items-center\">\n                    <div\n                        class=\"bg-black/20 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        4\n                    </div>\n                    <div class=\"text-xl\">Catering</div>\n                    <div class=\"flex-1 w-px\"></div>\n                    <button\n                        mat-icon-button\n                        (click)=\"hide_block.catering = !hide_block.catering\"\n                    >\n                        <app-icon>{{\n                            hide_block.catering ? 'expand_more' : 'expand_less'\n                        }}</app-icon>\n                    </button>\n                </h3>\n                <div\n                    class=\"overflow-hidden\"\n                    [@show]=\"hide_block.catering ? 'hide' : 'show'\"\n                >\n                    <catering-list-field\n                        formControlName=\"catering\"\n                    ></catering-list-field>\n                </div>\n            </section>\n            <section class=\"p-4\">\n                <h3 class=\"space-x-2 flex items-center\">\n                    <div\n                        class=\"bg-black/20 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        {{ !has_catering ? '4' : '5' }}\n                    </div>\n                    <div class=\"text-xl\">Assets</div>\n                    <div class=\"flex-1 w-px\"></div>\n                    <button\n                        mat-icon-button\n                        (click)=\"hide_block.assets = !hide_block.assets\"\n                    >\n                        <app-icon>{{\n                            hide_block.assets ? 'expand_more' : 'expand_less'\n                        }}</app-icon>\n                    </button>\n                </h3>\n                <div\n                    class=\"overflow-hidden\"\n                    [@show]=\"hide_block.assets ? 'hide' : 'show'\"\n                >\n                    <asset-list-field\n                        formControlName=\"assets\"\n                    ></asset-list-field>\n                </div>\n            </section>\n            <section class=\"p-4\" *ngIf=\"!hide_notes\">\n                <h3 class=\"space-x-2 flex items-center mb-4\">\n                    <div\n                        class=\"bg-black/20 rounded-full h-6 w-6 flex items-center justify-center\"\n                    >\n                        {{ !has_catering ? '5' : '6' }}\n                    </div>\n                    <div class=\"text-xl\">Notes</div>\n                </h3>\n                <div class=\"w-full flex flex-col\">\n                    <label for=\"notes\">General information for attendees</label>\n                    <rich-text-input\n                        name=\"notes\"\n                        formControlName=\"body\"\n                        placeholder=\"Notes...\"\n                    ></rich-text-input>\n                </div>\n            </section>\n        </div>\n    `,\n    styles: [``],\n    animations: [ANIMATION_SHOW_CONTRACT_EXPAND]\n})\nexport class MeetingBookingFormComponent extends BaseClass {\n    public readonly form = this._service.form;\n\n    public hide_block: Record<string, boolean> = {}\n\n    public get has_catering() {\n        return (\n            !!this._settings.get('app.events.catering_enabled') ||\n            !!this._settings.get('app.events.has_catering')\n        );\n    }\n\n    public get hide_notes() {\n        return !!this._settings.get('app.events.hide_notes');\n    }\n\n    public get hide_attendees() {\n        return !!this._settings.get('app.events.hide_attendees');\n    }\n\n    public get max_duration() {\n        return this._settings.get('app.events.max_duration') || 480;\n    }\n\n    public get can_book_for_others() {\n        return this._settings.get('app.events.can_book_for_others');\n    }\n\n    public get allow_all_day() {\n        return this._settings.get('app.events.allow_all_day');\n    }\n\n    public get allow_assets() {\n        return this._settings.get('app.events.allow_assets');\n    }\n\n    public findAvailableTime() {\n        const { attendees, organiser, date, duration } = this.form.value;\n        const ref = this._dialog.open(FindAvailabilityModalComponent, {\n            data: {\n                users: attendees,\n                host: organiser || currentUser(),\n                date,\n                duration\n            }\n        });\n        ref.afterClosed().subscribe(d => {\n            if (!d) return;\n            this.form.patchValue({\n                date: ref.componentInstance.date,\n                attendees: ref.componentInstance.users,\n                duration: ref.componentInstance.duration\n            });\n        })\n    }\n\n    constructor(\n        private _service: EventFormService,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {\n        super();\n    }\n}\n","import { Component } from '@angular/core';\nimport { EventFormService } from '@placeos/events';\n\n@Component({\n    selector: 'meeting-booking-success',\n    template: `\n        <div class=\"absolute inset-0 bg-white dark:bg-neutral-600 flex flex-col items-center justify-center space-y-4 p-4 text-center\">\n            <h3 class=\"text-3xl\">Booking Confirmed!</h3>\n            <img src=\"assets/tick_success.svg\" />\n            <p>\n                Your meeting booking for\n                <i>{{ last_success?.location || last_success?.system?.display_name }}</i>\n                has been successfully booked for the\n                {{ last_success?.date | date: 'dd MMMM yyyy' }} at\n                {{ last_success?.date | date: 'shortTime' }} -\n                {{\n                    last_success?.date + last_success?.duration * 60 * 1000\n                        | date: 'shortTime'\n                }}\n            </p>\n            <a button mat-button [routerLink]=\"['/book', 'meeting']\" class=\"w-64\">\n                New Booking\n            </a>\n        </div>\n    `,\n    styles: [`\n        :host {\n            height: 100%;\n            width: 100%;\n        }\n    `],\n})\nexport class MeetingBookingSuccessComponent {\n    public readonly last_success = this._service.last_success;\n\n    constructor(private _service: EventFormService) {}\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { Route, RouterModule } from '@angular/router';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatNativeDateModule, NativeDateModule } from '@angular/material/core';\n\nimport { RoomBookingComponent } from './room-booking.component';\nimport { RoomConfirmComponent } from './room-confirm/room-confirm.component';\nimport { FindSpaceComponent } from './find-space/find-space.component';\nimport { FindSpaceItemComponent } from './find-space-item/find-space-item.component';\nimport { FormFieldsModule } from '@placeos/form-fields';\nimport { SharedComponentModule } from '../components/shared.module';\nimport { ComponentsModule } from '@placeos/components';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\nimport { MatBottomSheetModule } from '@angular/material/bottom-sheet';\nimport { FilterSpaceComponent } from './filter-space/filter-space.component';\nimport { BookingConfirmedComponent } from './booking-confirmed/booking-confirmed.component';\nimport { RoomTileComponent } from './room-tile/room-tile.component';\nimport { RoomDetailsComponent } from './room-details/room-details.component';\nimport { UpcomingBookingsComponent } from './upcoming-bookings/upcoming-bookings.component';\n\nconst ROUTES: Route[] = [\n    {\n        path: 'find',\n        component: FindSpaceComponent,\n    },\n];\n\n@NgModule({\n    declarations: [\n        RoomBookingComponent,\n        RoomConfirmComponent,\n        FindSpaceComponent,\n        FindSpaceItemComponent,\n        FilterSpaceComponent,\n        BookingConfirmedComponent,\n        RoomTileComponent,\n        RoomDetailsComponent,\n        UpcomingBookingsComponent,\n    ],\n    imports: [\n        CommonModule,\n        RouterModule.forChild(ROUTES),\n        SharedComponentModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatNativeDateModule,\n        NativeDateModule,\n        FormFieldsModule,\n        MatBottomSheetModule,\n        MatNativeDateModule,\n        MatSnackBarModule,\n        MatButtonToggleModule,\n        ComponentsModule,\n    ],\n})\nexport class BookModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { EventFormService } from '@placeos/events';\nimport { CalendarEvent } from '@placeos/events';\nimport { of, Observable } from 'rxjs';\n\n@Component({\n    selector: 'booking-confirmed',\n    templateUrl: './booking-confirmed.component.html',\n    styles: [``],\n})\nexport class BookingConfirmedComponent implements OnInit {\n    public get form() {\n        return this._state.form;\n    }\n\n    location: CalendarEvent['location'];\n    date: Observable<CalendarEvent['date']>;\n    start_time$: Observable<string>;\n    end_time$: Observable<string>;\n    duration: CalendarEvent['duration'];\n\n    constructor(private _state: EventFormService, private _router: Router) {}\n\n    ngOnInit() {\n        this.location = this._state.last_success?.location;\n        this.date = of(this._state.last_success?.date);\n        this.start_time$ = of(\n            new Date(this._state.last_success?.date).toLocaleTimeString(\n                'en-US',\n                {\n                    hour: 'numeric',\n                    minute: 'numeric',\n                    hour12: true,\n                }\n            )\n        );\n        this.duration = this._state.last_success?.duration;\n        this.end_time$ = of(\n            new Date(\n                this._state.last_success?.date + this.duration * 60 * 1000\n            ).toLocaleTimeString('en-US', {\n                hour: 'numeric',\n                minute: 'numeric',\n                hour12: true,\n            })\n        );\n    }\n    newBooking() {\n        this._router.navigate(['book/spaces']);\n    }\n}\n","<div class=\"flex flex-1 flex-col z-0 bg-gray-50 h-full overflow-y-auto\">\n    <section\n        class=\"flex border-b border-gray-300 py-5 items-center justify-content h-full\"\n    >\n        <div\n            class=\"flex flex-col items-center mx-auto w-[calc(100%-2rem)] max-w-[375px]\"\n        >\n            <div class=\"mb-3\">\n                <span class=\"text-3xl font-bold mr-auto text-gray-700\">\n                    Booking Confirmed!</span\n                >\n            </div>\n            <div>\n                <img src=\"assets/tick_success.svg\" />\n            </div>\n\n            <div class=\"mx-3 flex items-center justify-center\">\n                <span class=\"flex text-justify\"\n                    >Your room booking for\n                    {{ location }}\n                    has been successfully booked for the\n                    {{ date | async | date: 'dd MMMM yyyy' }} at\n                    {{ start_time$ | async }} -\n                    {{ end_time$ | async }}\n                </span>\n            </div>\n            <div class=\"flex items-center mt-3\">\n                <button\n                    mat-button\n                    (click)=\"newBooking()\"\n                    class=\"text-sm bg-white text-secondary border-secondary my-2\"\n                >\n                    <span class=\"text-sm\">New Booking</span>\n                </button>\n            </div>\n        </div>\n    </section>\n</div>\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { BehaviorSubject, Observable, of, Subscription } from 'rxjs';\nimport { take, map, filter, switchMap } from 'rxjs/operators';\nimport { Space } from '@placeos/spaces';\nimport { EventFormService } from '@placeos/events';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class FeaturesFilterService {\n    public spaces$: Observable<Space[]> = this._state.available_spaces;\n    public updated_spaces$: Observable<Space[]>;\n    public updated_spaces_emitter: BehaviorSubject<boolean> =\n        new BehaviorSubject<boolean>(false);\n    features_sub: Subscription;\n    _selected_features: BehaviorSubject<any> = new BehaviorSubject<any>(null);\n    selected_features$: Observable<any> =\n        this._selected_features.asObservable();\n    get selected_features() {\n        return this._selected_features.getValue();\n    }\n\n    _features: BehaviorSubject<any> = new BehaviorSubject<any>(null);\n    features$: Observable<any> = this._features.asObservable();\n    set features(feature) {\n        this._features.next(feature);\n    }\n    get features() {\n        return this._features.getValue();\n    }\n\n    room_features: any[] = [\n        { name: 'Video Conference (VC)', id: 'VidConf', value: false },\n        { name: 'Conference Phone', id: 'ConfPhone', value: false },\n        { name: 'Wireless Content Sharing', id: 'Wireless', value: false },\n        { name: 'Video Wall', id: 'VidWall', value: false },\n        { name: 'Whiteboard', id: 'Whiteboard', value: false },\n        { name: 'Jamboard', id: 'Jamboard', value: false },\n        { name: 'Projector', id: 'Projector', value: false },\n        { name: 'Views', id: 'Views', value: false },\n    ];\n\n    constructor(private _state: EventFormService) {\n        this._features.next(this.room_features);\n    }\n\n    async getSelectedFeatures() {\n        this.selected_features$ = this.features$.pipe(\n            map((arr) => arr.filter((item) => item.value == true))\n        );\n        await this.selected_features$.pipe(take(1)).toPromise();\n        this.selected_features$?.subscribe(this._selected_features);\n    }\n    async applyFilter() {\n        await this.selected_features$.pipe(take(1)).toPromise();\n\n        const requested_features = await this.sortSelectedFeatures(\n            this.selected_features\n        );\n\n        this.updated_spaces$ = this.spaces$.pipe(\n            map((spaces: Space[]) =>\n                spaces.filter((space: Space) => {\n                    return this._sort_and_join(space.feature_list).includes(\n                        requested_features\n                    );\n                })\n            )\n        );\n        await this.updated_spaces$?.pipe(take(1)).toPromise();\n        this.updated_spaces_emitter.next(true);\n    }\n\n    _sort_and_join(array: string[]): string {\n        return array?.sort().join();\n    }\n\n    async sortSelectedFeatures(array: any[]) {\n        let features_array = await array?.map((item) => item.id);\n        return this._sort_and_join(features_array);\n    }\n\n    clearFilter() {\n        this._selected_features.next(null);\n        this.room_features?.map((feature) => (feature.value = false));\n        this._features.next(this.room_features);\n        this.updated_spaces_emitter.next(false);\n    }\n\n    OnDestroy() {\n        this.features_sub?.unsubscribe();\n    }\n}\n","import { Component, OnInit, Inject } from '@angular/core';\n\nimport {\n    MAT_BOTTOM_SHEET_DATA,\n    MatBottomSheetRef,\n} from '@angular/material/bottom-sheet';\nimport { EventFormService } from '@placeos/events';\nimport { FeaturesFilterService } from '../features-filter.service';\nimport { OrganisationService } from '@placeos/organisation';\nimport { Observable } from 'rxjs';\n\n@Component({\n    selector: '[filter-space]',\n    templateUrl: './filter-space.component.html',\n    styles: [``],\n})\nexport class FilterSpaceComponent implements OnInit {\n    readonly buildings = this._org.building_list;\n    readonly building = this._org.active_building;\n    minDate: Date = new Date();\n    features$: Observable<Array<{}>>;\n    \n    public readonly setBuilding = (b) => this._org.building = b;\n\n    constructor(\n        @Inject(MAT_BOTTOM_SHEET_DATA) public data: { data },\n        private _bottomsheetRef: MatBottomSheetRef<any>,\n        private _featuresFilterService: FeaturesFilterService,\n        private _state: EventFormService,\n        private _org: OrganisationService\n    ) {}\n\n    ngOnInit() {\n        this.features$ = this._featuresFilterService.features$;\n    }\n\n    public get form() {\n        return this._state.form;\n    }\n\n    applyFilters() {\n        this._bottomsheetRef.dismiss(this.form);\n        this._featuresFilterService.applyFilter();\n    }\n\n    getSelectedFeatures() {\n        this._featuresFilterService.getSelectedFeatures();\n    }\n\n    closeModal() {\n        this._bottomsheetRef.dismiss();\n    }\n}\n","<div class=\"flex flex-1 flex-col z-0 m-0 min-h-[800px] overflow-y-auto\">\n    <form *ngIf=\"form\" [formGroup]=\"form\">\n        <section\n            class=\"flex flex-col border-b border-gray-300 py-5 items-center\"\n        >\n            <div\n                class=\"flex flex-col w-[calc(100%-2rem)] max-w-[360px] self-center\"\n            >\n                <div class=\"flex flex-row items-center\">\n                    <button (click)=\"closeModal()\">\n                        <mat-icon\n                            class=\"flex items-center justify-center text-3xl text-gray-700\"\n                            >close</mat-icon\n                        >\n                    </button>\n\n                    <span class=\"flex items-center text-xl font-bold ml-6\">\n                        Space Filters</span\n                    >\n                </div>\n            </div>\n        </section>\n        <section class=\"flex flex-col border-b border-gray-300 items-center\">\n            <div\n                class=\"flex flex-col w-[calc(100%-2rem)] max-w-[360px] self-center\"\n            >\n                <div class=\"my-2 text-lg\">Details</div>\n\n                <div class=\"flex flex-col\">\n                    <label\n                        class=\"text-sm font-bold text-gray-700 mb-1\"\n                        *ngIf=\"(buildings | async)?.length > 1\"\n                    >\n                        Location\n                    </label>\n\n                    <mat-form-field\n                        overlay\n                        buildings\n                        class=\"w-full\"\n                        appearance=\"outline\"\n                        *ngIf=\"(buildings | async)?.length > 1\"\n                    >\n                        <mat-select\n                            placeholder=\"Select Building...\"\n                            [ngModel]=\"building | async\"\n                            (ngModelChange)=\"setBuilding($event)\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        >\n                            <mat-option\n                                *ngFor=\"let bld of buildings | async\"\n                                [value]=\"bld\"\n                            >\n                                {{ bld.display_name || bld.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n\n                    <div class=\"flex flex-col\">\n                        <label class=\"text-sm font-bold text-gray-700 mb-1\">\n                            Date\n                        </label>\n                        <a-date-field\n                            [from]=\"minDate\"\n                            formControlName=\"date\"\n                        ></a-date-field>\n\n                        <div class=\"flex flex-row space-x-2 w-full\">\n                            <div class=\"flex flex-col flex-1 w-1/3\">\n                                <label\n                                    class=\"text-sm font-bold text-gray-700 mb-1\"\n                                >\n                                    Start Time*\n                                </label>\n\n                                <a-time-field\n                                    [ngModel]=\"form?.value.date\"\n                                    (ngModelChange)=\"\n                                        form.patchValue({ date: $event })\n                                    \"\n                                    [ngModelOptions]=\"{ standalone: true }\"\n                                ></a-time-field>\n                            </div>\n                            <div class=\"flex flex-col flex-1 w-1/3 ml-auto\">\n                                <label\n                                    class=\"text-sm font-bold text-gray-700 mb-1\"\n                                >\n                                    End Time*\n                                </label>\n                                <a-duration-field\n                                    [time]=\"form?.value.date\"\n                                    [max]=\"12 * 60\"\n                                    [min]=\"60\"\n                                    [step]=\"60\"\n                                    formControlName=\"duration\"\n                                ></a-duration-field>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <section class=\"flex flex-col border-b border-gray-300 items-center\">\n            <div\n                class=\"flex flex-col w-[calc(100%-2rem)] max-w-[360px] self-center\"\n            >\n                <div class=\"my-2 text-lg\">Favourites</div>\n                <div class=\"flex flex-row mb-2\">\n                    <span>Only show favourite rooms</span>\n                    <mat-checkbox class=\"ml-auto\"></mat-checkbox>\n                </div>\n            </div>\n        </section>\n\n        <section class=\"flex flex-col border-gray-300\">\n            <div class=\"w-[calc(100%-2rem)] max-w-[360px] mx-auto\">\n                <div class=\"my-2 text-lg\">Facilities</div>\n\n                <div *ngFor=\"let feature of features$ | async\">\n                    <div class=\"flex flex-row mb-1\">\n                        <span> {{ feature.name }}</span>\n                        <mat-checkbox\n                            [(ngModel)]=\"feature.value\"\n                            class=\"ml-auto checkbox\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                            (change)=\"getSelectedFeatures()\"\n                        ></mat-checkbox>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <section\n            class=\"flex flex-col py-3 mt-5 border-t border-gray-300 top-box-shadow items-center justify-center\"\n        >\n            <button\n                mat-button\n                type=\"submit\"\n                (click)=\"applyFilters()\"\n                class=\"filter-button text-sm bg-secondary border-secondary min-w-[300px] max-w-[calc(100% - 2rem)] mx-auto text-center\"\n            >\n                <span class=\"\">Apply Filters</span>\n            </button>\n        </section>\n    </form>\n</div>\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { Space } from '@placeos/spaces';\n\n@Component({\n    selector: 'find-space-item',\n    templateUrl: './find-space-item.component.html',\n    styles: [``],\n})\nexport class FindSpaceItemComponent {\n    @Input() public space: Space;\n    @Input() public selected: boolean = false;\n    @Output() public selectedChange = new EventEmitter<boolean>();\n\n    readonly toggleSelected = () => this.selectedChange.emit(!this.selected);\n}\n","<button\n    mat-ripple\n    class=\"flex flex-col bg-white p-4 my-2 shadow w-[375px] max-w-[calc(100%-2rem)] mx-auto rounded space-y-4\"\n    [class.bg-primary]=\"selected\"\n    [class.text-white]=\"selected\"\n    (click)=\"toggleSelected()\"\n>\n    <div class=\"flex flex-row w-full items-center space-x-2\">\n        <app-icon class=\"text-lg\">meeting_room</app-icon>\n        <div\n            >{{ space?.level?.display_name || space?.level?.name }},\n            {{ space?.display_name || space?.name }}</div\n        >\n    </div>\n    <div class=\"flex flex-row w-full items-center space-x-2\">\n        <app-icon class=\"text-lg\">group</app-icon>\n        <div>{{ space?.capacity || 0 }} People</div>\n    </div>\n</button>\n","import { Component, OnInit } from '@angular/core';\nimport { MatBottomSheet } from '@angular/material/bottom-sheet';\nimport { EventFormService } from '@placeos/events';\nimport { Space, SpacesService } from '@placeos/spaces';\nimport { OrganisationService } from '@placeos/organisation';\nimport { HashMap } from '@placeos/common';\nimport { Observable, combineLatest, of, BehaviorSubject } from 'rxjs';\nimport { first, take, filter, map, tap } from 'rxjs/operators';\nimport { FilterSpaceComponent } from '../filter-space/filter-space.component';\nimport { FeaturesFilterService } from '../features-filter.service';\nimport { MapService, Locatable } from '../map.service';\nimport { ViewerFeature, ViewAction, ViewerStyles } from '@placeos/svg-viewer';\nimport { RoomConfirmService } from '../room-confirm.service';\nimport { BaseClass } from '@placeos/common';\nimport { MapsList } from '../map.service';\nimport { Router } from '@angular/router';\n\n@Component({\n    selector: 'find-space',\n    templateUrl: './find-space.component.html',\n    styles: [\n        `\n            .mat-button-toggle-appearance-standard {\n                height: 2.25rem;\n            }\n            .mat-button-toggle-appearance-standard\n                .mat-button-toggle-label-content {\n                line-height: 2.25rem;\n                font-size: 0.875rem;\n            }\n            .mat-button-toggle-label-content {\n                font-size: 0.875rem;\n            }\n            .mat-button-toggle-checked {\n                border: 1px solid var(--primary);\n                border-radius: 5px;\n                box-shadow: none;\n            }\n            .mat-focus-indicator {\n                border: none;\n            }\n        `,\n    ],\n})\nexport class FindSpaceComponent extends BaseClass implements OnInit {\n    start_time$: Observable<any>;\n    duration_minutes: number;\n    end_time$: Observable<any>;\n    selected_features$: Observable<any>;\n    filtered_spaces: Space[] = [];\n    show_room_details$: Observable<boolean> = of(false);\n    selected_space: Space;\n    space_view?: string;\n    locatable_spaces$: Observable<Locatable[]>;\n    maps_list$: Observable<MapsList[]>;\n    map_features$: Observable<ViewerFeature[]>;\n    _map_features: BehaviorSubject<ViewerFeature[]> = new BehaviorSubject<\n        ViewerFeature[]\n    >(null);\n    map_actions$: Observable<ViewAction[]> = null;\n    map_styles$: Observable<ViewerStyles[]> = null;\n    bottomSheetRef: any;\n\n    public selected_level: any;\n\n    public get form() {\n        return this._state.form;\n    }\n\n    public book_space: HashMap<boolean> = {};\n    public space_list: Space[] = [];\n    public quick_capacities = [\n        { name: 'Any Capacity', value: 0 },\n        { name: 'Small (1 - 4)', value: 1 },\n        { name: 'Medium (5 - 12)', value: 5 },\n        { name: 'Large (13 - 32)', value: 13 },\n        { name: 'Huge (32+)', value: 33 },\n    ];\n\n    public readonly buildings = this._org.building_list;\n    public readonly building = this._org.active_building;\n\n    public readonly levels = combineLatest([\n        this.building,\n        this._state.options,\n    ]).pipe(\n        filter(([_]) => !!_),\n        map(([bld]) => [\n            {\n                id: this._org.building.id,\n                name: 'All Levels',\n            },\n            ...this._org.levelsForBuilding(bld),\n        ])\n    );\n\n    public readonly loading = this._state.loading;\n    public readonly options = this._state.options;\n\n    public readonly spaces$: Observable<Space[]> = this._state.available_spaces;\n    public readonly features = this._spaces.features;\n\n    public readonly setBuilding = (b) => this._org.building = b;\n    public readonly setOptions = (o) => this._state.setOptions(o);\n\n    constructor(\n        private _bottomSheet: MatBottomSheet,\n        private _org: OrganisationService,\n        private _spaces: SpacesService,\n        private _state: EventFormService,\n        private _featuresFilterService: FeaturesFilterService,\n        private _mapService: MapService,\n        private _roomConfirmService: RoomConfirmService,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this.space_view = 'listView';\n\n        this.selected_features$ =\n            this._featuresFilterService.selected_features$;\n        this._state.setView('find');\n        this.setTimeChips();\n\n        await this._org.initialised.pipe(first((_) => !!_)).toPromise();\n        await this._spaces.initialised.pipe(first((_) => !!_)).toPromise();\n        await this._state.available_spaces.pipe(take(1)).toPromise();\n\n        this.setBuilding(this._org.building);\n        this.book_space = {};\n        this.subscription('features', this.selected_features$?.subscribe((v) => this.setOptions({ features: v || [] })));\n\n        await this._mapService.locateSpaces(this.spaces$);\n\n        this.locatable_spaces$ = this._mapService.locatable_spaces$;\n\n        this.maps_list$ = this._mapService.maps_list$?.pipe(\n            tap((maps) => (this.selected_level = maps))\n        );\n\n        await this._mapService.features_loaded$\n            .pipe(first((_) => !!_))\n            .toPromise();\n\n        this.applyMapDecorations();\n\n        this._map_features.next(this._mapService.map_features);\n        this.map_features$ = this._map_features.asObservable();\n        this.map_actions$ = this._mapService.map_actions$;\n    }\n\n    public handleBookEvent(space: Space, book: boolean = true) {\n        this.book_space[space.id] = book;\n        this._roomConfirmService.book_space = this.book_space;\n        this._roomConfirmService.handleBookEvent(space, book);\n        this.show_room_details$ = of(true);\n        this._roomConfirmService.updateSelectedSpace(space);\n    }\n\n    openFilter() {\n        this.bottomSheetRef = this._bottomSheet.open(FilterSpaceComponent, {\n            data: this.buildings as OrganisationService['building_list'],\n        });\n    }\n\n    openRoomDetails() {\n        this._roomConfirmService.openRoomDetail(this.selected_space);\n    }\n\n    resetSpace() {\n        this.show_room_details$ = of(false);\n    }\n\n    setTimeChips() {\n        this.start_time$ = of(\n            new Date(this.form?.controls?.date?.value).toLocaleTimeString(\n                'en-US',\n                { hour: 'numeric', minute: 'numeric', hour12: true }\n            )\n        );\n        this.duration_minutes = this.form?.controls?.duration?.value;\n        const end =\n            this.form?.controls?.date?.value +\n            this.duration_minutes * 60 * 1000;\n        this.end_time$ = of(\n            new Date(end).toLocaleTimeString('en-US', {\n                hour: 'numeric',\n                minute: 'numeric',\n                hour12: true,\n            })\n        );\n    }\n\n    updateSelectedLevel(e) {\n        this.selected_level = e;\n        if (!this.selected_level?.length) {\n            this.applyMapDecorations();\n        }\n    }\n\n    applyMapDecorations() {\n        this.timeout(\n            'init',\n            () => {\n                this.processFeature();\n                this.processStyles();\n            },\n            1500\n        );\n    }\n\n    processFeature() {\n        this.map_features$ = this._mapService.map_features$;\n    }\n\n    processStyles() {\n        this.map_styles$ = of([this._mapService.style_map]);\n    }\n\n    closeModal() {\n        this._router.navigate(['/book/spaces']);\n        this._featuresFilterService.clearFilter();\n    }\n}\n","<div class=\"w-full h-full flex flex-1 flex-col z-0 bg-gray-50 overflow-auto\">\n    <section class=\"flex flex-col py-5\">\n        <div class=\"w-[calc(100%-2rem)] max-w-[375px] mx-auto\">\n            <div class=\"flex flex-row items-center\">\n                <button (click)=\"closeModal()\">\n                    <mat-icon\n                        class=\"flex items-center justify-center text-3xl text-gray-700\"\n                        >close</mat-icon\n                    >\n                </button>\n\n                <span class=\"flex items-center text-lg font-bold ml-6\">\n                    Find Space</span\n                >\n            </div>\n\n            <div class=\"flex flex-row justify-between mt-3 align-middle\">\n                <div class=\"flex w-7/12 justify-center\">\n                    <button\n                        mat-flat-button\n                        (click)=\"openFilter()\"\n                        class=\"bg-gray-300 w-full h-9 text-sm filter-button\"\n                    >\n                        <span>Filter</span>\n\n                        <span *ngIf=\"(selected_features$ | async)?.length\">\n                            ({{ (selected_features$ | async).length }}\n                            applied)\n                        </span>\n                    </button>\n                </div>\n\n                <div class=\"flex w-4/12\">\n                    <mat-button-toggle-group\n                        aria-label=\"Map or list view\"\n                        [(ngModel)]=\"space_view\"\n                        (change)=\"resetSpace()\"\n                        class=\"flex w-full ml-auto mr-0 border-none\"\n                    >\n                        <mat-button-toggle\n                            value=\"mapView\"\n                            class=\"flex bg-gray-300 w-1/2 rounded justify-center items-center\"\n                            ><span class=\"flex leading-9 text-[0.875rem]\"\n                                >Map</span\n                            ></mat-button-toggle\n                        >\n                        <mat-button-toggle\n                            value=\"listView\"\n                            class=\"flex bg-gray-300 w-1/2 rounded text-sm justify-center items-center\"\n                            ><span class=\"flex leading-9 text-[0.875rem]\"\n                                >List</span\n                            ></mat-button-toggle\n                        >\n                    </mat-button-toggle-group>\n                </div>\n            </div>\n\n            <section class=\"flex flex-row\">\n                <mat-chip-list class=\"mt-2\">\n                    <mat-chip class=\"text-gray-700 text-xs\">\n                        {{ form?.controls?.date?.value | date: 'dd MMMM yyyy' }}\n                    </mat-chip>\n\n                    <div *ngIf=\"form?.controls.attendees.value.length > 0\">\n                        <mat-chip class=\"text-gray-700 text-xs\">\n                            {{ form?.controls?.attendees?.value.length }}\n                            People\n                        </mat-chip>\n                    </div>\n\n                    <mat-chip class=\"text-gray-700 text-xs\">\n                        <span>{{ start_time$ | async }}</span>\n                        -\n                        <span> {{ end_time$ | async }}</span>\n                    </mat-chip>\n                </mat-chip-list>\n            </section>\n\n            <section class=\"flex flex-row my-2 border-t\">\n                <div class=\"flex flex-col\">\n                    <span class=\"text-lg font-bold mt-3\"> Results</span>\n                    <span class=\"text-xs text-gray-500 mt-1\">\n                        {{ (spaces$ | async)?.length || 0 }} results found</span\n                    >\n                </div>\n            </section>\n\n            <div class=\"flex-1 w-full bg-gray-100\">\n                <ng-container *ngIf=\"!(loading | async); else load_state\">\n                    <ng-container\n                        *ngIf=\"(spaces$ | async)?.length > 0; else empty_state\"\n                    >\n                        <div *ngIf=\"space_view == 'listView'\">\n                            <find-space-item\n                                *ngFor=\"let space of spaces$ | async\"\n                                [space]=\"space\"\n                                [selected]=\"book_space[space.id]\"\n                                (selectedChange)=\"\n                                    handleBookEvent(space, $event)\n                                \"\n                                class=\"text-sm\"\n                            >\n                            </find-space-item>\n                        </div>\n                        <div\n                            *ngIf=\"\n                                space_view == 'mapView' &&\n                                (map_features$ | async)?.length > 0\n                            \"\n                            class=\"text-center h-full\"\n                        >\n                            <div *ngIf=\"(maps_list$ | async)?.length > 1\">\n                                <mat-form-field\n                                    appearance=\"outline\"\n                                    class=\"flex ml-auto m-3 text-sm\"\n                                >\n                                    <mat-select\n                                        [(ngModel)]=\"selected_level\"\n                                        (ngModelChange)=\"\n                                            updateSelectedLevel($event)\n                                        \"\n                                    >\n                                        <mat-option [value]=\"maps_list$ | async\"\n                                            >All Levels</mat-option\n                                        >\n                                        <mat-option\n                                            *ngFor=\"\n                                                let map of maps_list$ | async\n                                            \"\n                                            [value]=\"map\"\n                                            >{{ map.level }}</mat-option\n                                        >\n                                    </mat-select>\n                                </mat-form-field>\n                            </div>\n\n                            <div\n                                *ngIf=\"selected_level\"\n                                class=\"m-6 max-w-screen relative\"\n                            >\n                                <!-- If 'All Levels' option is selected -->\n                                <div *ngIf=\"selected_level?.length\">\n                                    <div\n                                        *ngFor=\"let map of selected_level\"\n                                        class=\"m-3 h-[12rem] max-w-screen relative\"\n                                    >\n                                        <i-map\n                                            [src]=\"map?.map_id\"\n                                            [styles]=\"map_styles$ | async\"\n                                            [features]=\"map_features$ | async\"\n                                            [actions]=\"map_actions$ | async\"\n                                            class=\"m-1 p-1 max-w-screen\"\n                                        >\n                                        </i-map>\n                                    </div>\n                                </div>\n\n                                <!-- If an individual level is selected -->\n                                <div\n                                    *ngIf=\"!selected_level?.length\"\n                                    class=\"m-3 h-[24rem] max-w-screen relative\"\n                                >\n                                    <i-map\n                                        [src]=\"selected_level?.map_id\"\n                                        [styles]=\"map_styles$ | async\"\n                                        [features]=\"map_features$ | async\"\n                                        [actions]=\"map_actions$ | async\"\n                                        class=\"m-1 p-1 max-w-screen\"\n                                    >\n                                    </i-map>\n                                </div>\n                            </div>\n                        </div>\n\n                        <p class=\"p-2 text-sm text-center opacity-60\">\n                            End of available spaces list\n                        </p>\n                    </ng-container>\n                </ng-container>\n\n                <ng-template #load_state>\n                    <div\n                        class=\"h-full w-full flex flex-col items-center justify-center space-y-4 my-3\"\n                    >\n                        <mat-spinner [diameter]=\"32\"></mat-spinner>\n                        <p>Retrieving available spaces...</p>\n                    </div>\n                </ng-template>\n                <ng-template #empty_state>\n                    <div\n                        class=\"h-full w-full flex flex-col items-center justify-center space-y-2 p-2 text-center my-6\"\n                    >\n                        <p>\n                            No available spaces for selected time, capacity or\n                            level(s)\n                        </p>\n                    </div>\n                </ng-template>\n            </div>\n        </div>\n        <section\n            class=\"flex flex-col py-1 border-t border-gray-300 top-box-shadow items-center justify-center\"\n        >\n            <div *ngIf=\"show_room_details$ | async\">\n                <button\n                    mat-button\n                    type=\"submit\"\n                    (click)=\"openRoomDetails()\"\n                    class=\"open-details-button bg-secondary border-secondary w-[300px] my-1\"\n                >\n                    <span class=\"\">View Room</span>\n                </button>\n            </div>\n        </section>\n    </section>\n</div>","import { Injectable } from '@angular/core';\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { map, take, first } from 'rxjs/operators';\nimport { BuildingLevel } from '@placeos/organisation';\nimport { ViewerFeature, ViewerStyles, ViewAction } from '@placeos/svg-viewer';\nimport { MapPinComponent } from '@placeos/components';\nimport { Space } from '@placeos/spaces';\nimport { BaseClass } from '@placeos/common';\nimport { MatBottomSheet } from '@angular/material/bottom-sheet';\nimport { RoomTileComponent } from './room-tile/room-tile.component';\nimport { RoomConfirmService } from './room-confirm.service';\n\nexport interface Locatable {\n    id: string;\n    name: string;\n    map_id: string;\n    level: BuildingLevel;\n    zones?: string[];\n}\n\nexport interface MapsList {\n    map_id: string;\n    level: string;\n}\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class MapService extends BaseClass {\n    public level: BuildingLevel;\n    public style_map: ViewerStyles = {};\n    public item: Locatable;\n\n    private _map_features: BehaviorSubject<ViewerFeature[]> =\n        new BehaviorSubject<ViewerFeature[]>([]);\n    public map_features$: Observable<ViewerFeature[]> =\n        this._map_features.asObservable();\n\n    get map_features() {\n        return this._map_features.getValue();\n    }\n\n    set map_features(features: ViewerFeature[]) {\n        this._map_features.next(features);\n    }\n\n    public map_actions$: Observable<ViewAction[]>;\n\n    private _map_loaded: BehaviorSubject<boolean> =\n        new BehaviorSubject<boolean>(false);\n    readonly map_loaded$: Observable<boolean> = this._map_loaded.asObservable();\n\n    private _features_loaded: BehaviorSubject<boolean> =\n        new BehaviorSubject<boolean>(false);\n    readonly features_loaded$: Observable<boolean> =\n        this._features_loaded.asObservable();\n\n    selected_space$: Observable<Space> =\n        this._roomConfirmService.selected_space$;\n\n    //Store of Locatable Spaces\n    private _locatable_spaces: BehaviorSubject<Locatable[]> =\n        new BehaviorSubject<Locatable[]>([]);\n\n    locatable_spaces$: Observable<Locatable[]> =\n        this._locatable_spaces.asObservable();\n\n    set locatable_spaces(space: Locatable[]) {\n        this._locatable_spaces.next(space);\n    }\n\n    get locatable_spaces() {\n        return this._locatable_spaces.getValue();\n    }\n\n    //Store of map_id urls & level names for available_spaces\n    private _maps_list: BehaviorSubject<MapsList[]> = new BehaviorSubject<any>(\n        []\n    );\n\n    maps_list$: Observable<any> = this._maps_list.asObservable();\n\n    set maps_list(map: MapsList[]) {\n        this._maps_list.next(map);\n    }\n\n    get maps_list() {\n        return this._maps_list.getValue();\n    }\n\n    constructor(\n        private _bottomSheet: MatBottomSheet,\n        private _roomConfirmService: RoomConfirmService\n    ) {\n        super();\n    }\n\n    async locateSpaces(available_spaces: Observable<Space[]>) {\n        await available_spaces?.pipe(take(1)).toPromise();\n\n        available_spaces?.subscribe(\n            (spaces) =>\n                (this.locatable_spaces = spaces?.map((space) => ({\n                    id: space.id,\n                    name: space.name,\n                    map_id: space.map_id,\n                    level: space.level,\n                })))\n        );\n        await this.locatable_spaces$?.pipe(first((_) => !!_)).toPromise();\n        await this.loadMap();\n        await this.timeout(\n            'init',\n            () => {\n                this.processFeature();\n            },\n            1000\n        );\n\n        await this.processStyles();\n\n        this.map_actions$ = available_spaces?.pipe(\n            map((spaces: Space[]) =>\n                spaces.map(\n                    (space: Space) =>\n                        ({\n                            id: space.map_id,\n                            action: 'click',\n                            callback: () => {\n                                this.openRoomTile(space);\n                            },\n                        } as ViewAction)\n                )\n            )\n        );\n    }\n\n    async loadMap() {\n        this._map_loaded.next(false);\n        this.maps_list$ = this.locatable_spaces$?.pipe(\n            map((spaces: Locatable[]) =>\n                spaces.map((space: Locatable) => ({\n                    map_id: space.level.map_id,\n                    level: space.level.name,\n                }))\n            )\n        );\n\n        this.maps_list$ = this.maps_list$?.pipe(\n            map((mapsList: MapsList[]) => [\n                ...new Map(mapsList.map((v) => [v.map_id, v])).values(),\n            ])\n        );\n\n        this._map_loaded.next(true);\n    }\n\n    public processFeature(): void {\n        this._features_loaded.next(false);\n        let focus: any;\n        this.locatable_spaces$.subscribe((spaces) =>\n            spaces\n                ? (focus = spaces?.map((space) => ({\n                      location: space.map_id,\n                      content: MapPinComponent,\n                      data: { name: space.name },\n                      z_index: 99,\n                      zoom: 100,\n                  })))\n                : []\n        );\n        this.map_features = focus;\n        this._features_loaded.next(true);\n    }\n\n    public processStyles(): void {\n        const styles: ViewerStyles = {};\n        styles[`#zones`] = { display: 'none' };\n        styles[`#Zones`] = { display: 'none' };\n        this.style_map = styles;\n    }\n    openRoomTile(space: Space) {\n        const bottomSheetRef = this._bottomSheet.open(RoomTileComponent, {\n            panelClass: 'bottom-sheet-transparent',\n            data: space,\n        });\n\n        this._roomConfirmService.handleBookEvent(space, true);\n    }\n}\n","import { Component, OnInit, Inject } from '@angular/core';\nimport { DOCUMENT } from '@angular/common';\nimport { Router } from '@angular/router';\nimport { EventFormService } from '@placeos/events';\nimport { FeaturesFilterService } from './features-filter.service';\nimport { currentUser } from '@placeos/common';\n\n@Component({\n    selector: 'room-booking',\n    templateUrl: './room-booking.component.html',\n    styles: [\n        `\n            .button-text {\n                color: var(--secondary);\n            }\n        `,\n    ],\n})\nexport class RoomBookingComponent implements OnInit {\n    public show_spaces = false;\n    public show_people = false;\n\n    min_date: Date = new Date();\n\n    public get form() {\n        return this._state.form;\n    }\n\n    public readonly clearForm = () => {\n        this._state.clearForm();\n    };\n\n    constructor(\n        @Inject(DOCUMENT) private _document: Document,\n        private router: Router,\n        private _state: EventFormService,\n        private _featuresFilterService: FeaturesFilterService\n    ) {}\n\n    ngOnInit(): void {\n        this._state.newForm();\n        this._featuresFilterService.clearFilter();\n    }\n\n    async findSpace() {\n        this.form.markAllAsTouched();\n        if (!this.form.value.host) this.form.patchValue({ host: currentUser()?.email });\n        if (!this.form.valid) return;\n        await this._state.storeForm();\n        this.router.navigate(['/schedule/view']);\n    }\n\n    downloadTemplate() {\n        window.open('assets/template.csv');\n    }\n}\n","<div class=\"flex flex-1 flex-col z-0 m-0 bg-gray-50 dark:bg-neutral-600 h-full overflow-y-auto\">\n    <form *ngIf=\"form\" [formGroup]=\"form\">\n        <section class=\"flex flex-col border-b border-gray-300 dark:border-neutral-500 py-5 items-center\">\n            <div\n                class=\"flex flex-col w-[calc(100%-2rem)] max-w-[360px] self-center\"\n            >\n                <span class=\"flex text-xl font-bold mb-2\"> Book Room</span>\n\n                <div class=\"flex flex-row\">\n                    <div\n                        class=\"border border-black dark:border-neutral-500 rounded-full w-7 h-7 text-center\"\n                    >\n                        <span>1</span>\n                    </div>\n                    <div class=\"ml-2 mb-4 text-base\">Details</div>\n                </div>\n\n                <div class=\"flex flex-col\">\n                    <label class=\"text-sm font-bold mb-1\"\n                        >Add Title*</label\n                    >\n                    <mat-form-field appearance=\"outline\">\n                        <input\n                            matInput\n                            placeholder=\"e.g Team meeting\"\n                            formControlName=\"title\"\n                            class=\"text-sm max-w-[360px]\"\n                        />\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label class=\"text-sm font-bold mb-1\"\n                        >Date*</label\n                    >\n                    <a-date-field\n                        [from]=\"min_date\"\n                        formControlName=\"date\"\n                        class=\"text-sm max-w-[360px]\"\n                    ></a-date-field>\n                </div>\n                <div class=\"flex flex-row -mb-5 space-x-2\">\n                    <div class=\"flex flex-col w-1/2\">\n                        <label class=\"text-sm font-bold mb-1\">\n                            Start Time*\n                        </label>\n                        <a-time-field\n                            [ngModel]=\"form.value.date\"\n                            (ngModelChange)=\"form.patchValue({ date: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                            class=\"text-sm max-w-[175px]\"\n                        ></a-time-field>\n                    </div>\n                    <div class=\"flex flex-col w-1/2 ml-auto\">\n                        <label class=\"text-sm font-bold mb-1\">\n                            End Time*\n                        </label>\n                        <a-duration-field\n                            [time]=\"form.get('date')?.value\"\n                            [max]=\"12 * 60\"\n                            [min]=\"60\"\n                            [step]=\"60\"\n                            formControlName=\"duration\"\n                            class=\"text-sm max-w-[175px]\"\n                        ></a-duration-field>\n                    </div>\n                </div>\n            </div>\n        </section>\n\n        <section\n            class=\"flex flex-col py-3 border-b border-gray-300 dark:border-neutral-500 items-center\"\n        >\n            <div\n                class=\"flex flex-col w-[calc(100%-2rem)] max-w-[360px] self-center\"\n            >\n                <div class=\"flex flex-row\">\n                    <div\n                        class=\"border border-black dark:border-neutral-500 rounded-full w-7 h-7 text-center\"\n                    >\n                        <span>2</span>\n                    </div>\n                    <div class=\"ml-2 mb-4 text-base\">Attendees</div>\n                </div>\n\n                <div class=\"flex flex-col\">\n                    <label class=\"text-sm font-bold mb-1\">\n                        Add Attendees\n                    </label>\n\n                    <a-user-list-field\n                        formControlName=\"attendees\"\n                        class=\"text-sm max-w-[360px]\"\n                        [custom_template]=\"true\"\n                        (download)=\"downloadTemplate()\"\n                    ></a-user-list-field>\n                </div>\n            </div>\n        </section>\n\n        <section\n            class=\"flex flex-col py-3 items-center justify-center\"\n        >\n            <button\n                mat-button\n                type=\"submit\"\n                (click)=\"findSpace()\"\n                class=\"text-sm bg-secondary border-secondary min-w-[300px] max-w-[calc(100% - 2rem)] mx-auto\"\n            >\n                <span class=\"text-sm\">Find room</span>\n            </button>\n            <button\n                mat-button\n                (click)=\"clearForm()\"\n                class=\"text-sm bg-transparent text-secondary border-secondary my-2 min-w-[300px] max-w-[calc(100% - 2rem)] mx-auto\"\n            >\n                <span class=\"text-sm\">Clear form</span>\n            </button>\n        </section>\n    </form>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MatBottomSheet } from '@angular/material/bottom-sheet';\nimport { Observable, BehaviorSubject } from 'rxjs';\nimport { Router } from '@angular/router';\nimport { Space, SpacesService } from '@placeos/spaces';\nimport { EventFormService } from '@placeos/events';\nimport { HashMap } from '@placeos/common';\nimport { RoomDetailsComponent } from './room-details/room-details.component';\nimport { RoomConfirmComponent } from './room-confirm/room-confirm.component';\nimport { SpacePipe } from 'libs/spaces/src/lib/space.pipe';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class RoomConfirmService {\n    space: Space;\n    public book_space: HashMap<boolean> = {};\n    public space_list: Space[] = [];\n\n    _selected_space: BehaviorSubject<Space> = new BehaviorSubject<Space>(null);\n    selected_space$: Observable<Space> = this._selected_space.asObservable();\n\n    get selected_space() {\n        return this._selected_space.getValue();\n    }\n\n    set selected_space(space) {\n        this._selected_space.next(space);\n    }\n\n    public get form() {\n        return this._state.form;\n    }\n\n    constructor(\n        private _bottomSheet: MatBottomSheet,\n        private router: Router,\n        private _state: EventFormService,\n        private _spaces: SpacesService,\n        private _space_pipe: SpacePipe\n    ) {\n        this.book_space = {};\n        const resources = this._state.form?.get('resources')?.value || [];\n        resources.forEach((_) => (this.book_space[_.id] = true));\n        this.space_list = this._spaces.filter((s) => this.book_space[s.id]);\n    }\n\n    async openRoomDetail(space = this.selected_space) {\n        const room_details_ref = this._bottomSheet.open(RoomDetailsComponent, {\n            data: space,\n        });\n\n        await room_details_ref\n            .afterDismissed()\n            .subscribe((selectedSpace) =>\n                selectedSpace ? this.openRoomConfirm(selectedSpace) : null\n            );\n    }\n\n    openRoomConfirm(space?) {\n        if (space) {\n            const confirm_ref = this._bottomSheet.open(RoomConfirmComponent, {\n                data: space,\n            });\n        }\n    }\n\n    updateSelectedSpace(space?) {\n        if (space) this.selected_space = space;\n    }\n\n    handleBookEvent(space: Space, book: boolean = true) {\n        this.book_space = {};\n        this.book_space[space.id] = book;\n    }\n\n    async bookRoom(space?) {\n        const id_list = Object.keys(this.book_space).filter(id => this.book_space[id]);\n        const spaces = await Promise.all(id_list.map(id => this._space_pipe.transform(id)));\n        this.form.patchValue({ resources: spaces, system: spaces[0] });\n        this.space_list = this._spaces.filter((s) => this.book_space[s.id]);\n        this.postForm();\n    }\n\n    async postForm() {\n        await this._state.postForm().catch((err) => console.error(err));\n        if (this._state.last_success)\n            this.router.navigate(['/confirm/success']);\n    }\n}\n","import { Component, Inject, OnInit } from '@angular/core';\nimport {\n    MatBottomSheetRef,\n    MAT_BOTTOM_SHEET_DATA,\n} from '@angular/material/bottom-sheet';\nimport { Space } from '@placeos/spaces';\nimport { EventFormService } from '@placeos/events';\nimport { RoomConfirmService } from '../room-confirm.service';\nimport { CalendarEvent } from '@placeos/events';\nimport { User } from '@placeos/users';\n\n@Component({\n    selector: 'room-confirm',\n    templateUrl: './room-confirm.component.html',\n    styles: [``],\n})\nexport class RoomConfirmComponent implements OnInit {\n    unix_time: number;\n    start_time: string;\n    end_time: string;\n    attendees: User[];\n    space: Space;\n    title: CalendarEvent['title'];\n    show_submit_button: boolean = true;\n\n    public get form() {\n        return this._state.form;\n    }\n    public loading = this._state.loading;\n\n    constructor(\n        @Inject(MAT_BOTTOM_SHEET_DATA) public data: any,\n        private _bottomSheetRef: MatBottomSheetRef<RoomConfirmComponent>,\n        private _state: EventFormService,\n        private _roomConfirmService: RoomConfirmService\n    ) {}\n\n    async ngOnInit() {\n        this.unix_time = this.form?.controls?.date.value;\n        this.start_time = new Date(this.unix_time).toLocaleTimeString('en-US', {\n            hour: 'numeric',\n            minute: 'numeric',\n            hour12: true,\n        });\n        const durationMinutes: number = this.form?.controls?.duration.value;\n        const end = this.unix_time + durationMinutes * 60 * 1000;\n        this.end_time = new Date(end).toLocaleTimeString('en-US', {\n            hour: 'numeric',\n            minute: 'numeric',\n            hour12: true,\n        });\n        this.attendees = this.form?.controls?.attendees.value as User[];\n        this.space = this.data;\n        this.title = this.form?.controls?.title.value;\n    }\n\n    closeModal() {\n        this._bottomSheetRef.dismiss('cancel');\n    }\n\n    confirmBooking() {\n        this.show_submit_button = false;\n        this._roomConfirmService.bookRoom(this.space);\n    }\n}\n","<div\n    class=\"w-full min-h-[800px] mx-auto w-[calc(100%-2rem)] flex flex-1 flex-col z-0 overflow-y-auto\"\n>\n    <section class=\"flex flex-col border-b border-gray-300 py-2\">\n        <div class=\"flex flex-row items-center justify-content space-x-4\">\n            <button (click)=\"closeModal()\">\n                <mat-icon\n                    class=\"flex items-center justify-center text-3xl text-gray-700\"\n                    >close</mat-icon\n                >\n            </button>\n            <span class=\"text-lg font-bold mr-auto\"> Confirm Room Booking</span>\n        </div>\n    </section>\n\n    <section class=\"flex flex-row border-b border-gray-300 mt-4 pb-4 space-x-4\">\n        <div class=\"flex flex-col\">\n            <span class=\"text-base\"><img src=\"assets/tick.svg\" /> </span>\n        </div>\n        <div class=\"flex flex-col\">\n            <span class=\"flex text-base font-bold text-gray-700\"\n                >{{ title }}\n            </span>\n\n            <div class=\"flex mt-2 text-sm items-center text-gray-700\">\n                <mat-icon class=\"flex items-center material-icons-outlined\"\n                    >calendar_today</mat-icon\n                >\n                <span class=\"flex\">\n                    {{ unix_time | date: 'dd MMMM yyyy' }}\n                </span>\n            </div>\n            <div class=\"flex mt-2 text-sm items-center text-gray-700\">\n                <mat-icon class=\"flex items-center material-icons-outlined\"\n                    >schedule</mat-icon\n                >\n                <span class=\"flex\">{{ start_time }} -{{ end_time }}</span>\n            </div>\n        </div>\n    </section>\n\n    <section class=\"flex flex-row border-b border-gray-300 mt-4 pb-4 space-x-4\">\n        <div class=\"flex flex-col\">\n            <span class=\"text-base\"><img src=\"assets/tick.svg\" /> </span>\n        </div>\n\n        <div class=\"flex flex-col\">\n            <span class=\"flex text-base font-bold text-gray-700\"\n                >Attendees\n            </span>\n\n            <div\n                class=\"flex flex-row mt-2 text-sm items-center text-gray-700\"\n                *ngFor=\"let attendee of attendees\"\n            >\n                <div class=\"flex flex-col\">\n                    <mat-icon class=\"flex items-center material-icons-outlined\"\n                        >people</mat-icon\n                    >\n                </div>\n                <div class=\"flex flex-col\">\n                    <span class=\"w-full\">{{ attendee?.email }}</span>\n                </div>\n            </div>\n\n            <div class=\"flex flex-row mt-2 text-sm items-center text-gray-700\">\n                <div class=\"flex flex-col\">\n                    <mat-icon class=\"flex items-center material-icons-outlined\"\n                        >people</mat-icon\n                    >\n                </div>\n                <div class=\"flex flex-col\">\n                    <span>{{ form?.controls?.creator?.value }}</span>\n                </div>\n            </div>\n        </div>\n    </section>\n\n    <section class=\"flex flex-row mt-4 pb-4 space-x-4\">\n        <div class=\"flex flex-col\">\n            <span class=\"text-base\"><img src=\"assets/tick.svg\" /> </span>\n        </div>\n        <div class=\"flex flex-col\">\n            <span class=\"flex text-base font-bold text-gray-700\">Rooms </span>\n\n            <div class=\"flex mt-2 text-sm items-center text-gray-700\">\n                <mat-icon class=\"flex items-center material-icons-outlined\"\n                    >meeting_room</mat-icon\n                >\n                <span class=\"flex\">\n                    {{ space?.name }}\n                </span>\n            </div>\n            <div class=\"flex mt-2 text-sm items-center text-gray-700\">\n                <mat-icon class=\"flex items-center material-icons-outlined\"\n                    >room</mat-icon\n                >\n                <span class=\"flex\"> {{ space?.level?.name }}</span>\n            </div>\n        </div>\n    </section>\n\n    <div\n        class=\"flex flex-col border-t border-gray-300 top-box-shadow p-3 mt-5 mb-10 -mx-4 items-center\"\n    >\n        <button\n            mat-button\n            (click)=\"confirmBooking()\"\n            [disabled]=\"!show_submit_button\"\n            class=\"bg-secondary border-secondary w-[300px] ml-2 mx-4\"\n        >\n            <span class=\"\">Confirm</span>\n        </button>\n    </div>\n</div>\n","import { Component, OnInit, Inject } from '@angular/core';\nimport {\n    MatBottomSheetRef,\n    MAT_BOTTOM_SHEET_DATA,\n} from '@angular/material/bottom-sheet';\nimport { Observable, of } from 'rxjs';\nimport { Space } from '@placeos/spaces';\nimport { scan } from 'rxjs/operators';\n\n@Component({\n    selector: 'placeos-room-details',\n    templateUrl: './room-details.component.html',\n    styles: [``],\n})\nexport class RoomDetailsComponent implements OnInit {\n    space: Space | any;\n    room_added: Boolean = false;\n\n    constructor(\n        @Inject(MAT_BOTTOM_SHEET_DATA) public data: any,\n        private _bottomSheetRef: MatBottomSheetRef<RoomDetailsComponent>\n    ) {}\n\n    ngOnInit() {\n        this.space = this.data;\n    }\n\n    selectRoom() {\n        this.room_added = !this.room_added;\n    }\n\n    back() {\n        if (this.room_added) {\n            this._bottomSheetRef.dismiss(this.space);\n        } else {\n            this._bottomSheetRef.dismiss(null);\n        }\n    }\n}\n","<div class=\"w-full min-h-[800px] flex flex-1 flex-col z-0 overflow-hidden\">\n    <section\n        class=\"flex bg-gray-300 min-h-[300px] justify-center items-center text-gray-500\"\n        *ngIf=\"space?.images?.length > 0\"\n    >\n        <img\n            [src]=\"space.images[0]\"\n            [alt]=\"'Image of ' + (space.display_name || space.name)\"\n            width=\"100%\"\n            height=\"100%\"\n            class=\"flex z-20 rounded-lg\"\n        />\n    </section>\n    <section\n        class=\"flex flex-col mx-auto w-[calc(100%-2rem)] border-b border-gray-300\"\n    >\n        <span class=\"text-lg font-bold mt-3\"> {{ space?.name }}</span>\n\n        <div (click)=\"selectRoom()\" class=\"w-max-[375px]\">\n            <button\n                *ngIf=\"room_added == false\"\n                mat-button\n                class=\"bg-secondary border-secondary w-full mx-auto m-3\"\n            >\n                <span class=\"text-white\">+ Add this room</span>\n            </button>\n\n            <button\n                *ngIf=\"room_added == true\"\n                mat-button\n                class=\"bg-gray-300 border-gray-300 w-full mx-auto m-3\"\n            >\n                <span class=\"text-black\">- Remove this room</span>\n            </button>\n        </div>\n    </section>\n    <section\n        class=\"flex flex-col mx-auto w-[calc(100%-2rem)] border-b border-gray-300 p-3 pl-0\"\n    >\n        <span class=\"text-base font-bold\">Details</span>\n        <div class=\"flex flex-row items-center text-sm mt-3\">\n            <mat-icon class=\"material-icons-outlined blue-icon\"\n                >people</mat-icon\n            >\n            <span class=\"text-gray-500 text-sm\">\n                {{ space?.capacity }} People</span\n            >\n        </div>\n        <div class=\"flex flex-row items-center text-sm mt-1\">\n            <mat-icon class=\"material-icons-outlined blue-icon\">room</mat-icon>\n            <span class=\"text-gray-500\">\n                {{ space?.level?.name }}, {{ space?.level?.parent_id }}</span\n            >\n        </div>\n    </section>\n    <section\n        class=\"flex flex-col py-3 mx-auto w-[calc(100%-2rem)]\"\n        *ngIf=\"space?.feature_list.length > 0\"\n    >\n        <span class=\"text-base font-bold mb-3\">Room Facilities</span>\n\n        <div\n            *ngFor=\"let facility of space?.feature_list\"\n            class=\"flex flex-row w-full mb-1\"\n        >\n            <div [ngSwitch]=\"facility\">\n                <div *ngSwitchCase=\"'Views'\">\n                    <mat-icon class=\"material-symbols-outlined blue-icon\"\n                        >panorama</mat-icon\n                    >\n                </div>\n                <div *ngSwitchCase=\"'Projector'\">\n                    <mat-icon class=\"material-symbols-outlined blue-icon\"\n                        >video_camera_front</mat-icon\n                    >\n                </div>\n                <div *ngSwitchCase=\"'VidConf'\">\n                    <mat-icon class=\"material-symbols-outlined blue-icon\"\n                        >contact_phone</mat-icon\n                    >\n                </div>\n                <div *ngSwitchCase=\"'Whiteboard'\">\n                    <mat-icon class=\"material-symbols-outlined blue-icon\"\n                        >drive_file_rename_outline</mat-icon\n                    >\n                </div>\n                <div *ngSwitchCase=\"'Jamboard'\">\n                    <mat-icon class=\"material-symbols-outlined blue-icon\"\n                        >draw</mat-icon\n                    >\n                </div>\n                <div *ngSwitchCase=\"'Wifi'\">\n                    <mat-icon class=\"material-symbols-outlined blue-icon\"\n                        >nest_remote_comfort_sensor</mat-icon\n                    >\n                </div>\n            </div>\n\n            <span class=\"text-sm text-gray-500\">\n                {{ facility }}\n            </span>\n        </div>\n    </section>\n    <div\n        class=\"flex flex-col bg-white border-t border-gray-300 top-box-shadow p-3\"\n    >\n        <button\n            *ngIf=\"!room_added\"\n            mat-button\n            class=\"bg-white border-secondary w-full mx-auto\"\n            (click)=\"back()\"\n        >\n            <span class=\"text-secondary\">Back</span>\n        </button>\n        <button\n            *ngIf=\"room_added\"\n            mat-button\n            class=\"bg-secondary border-secondary w-full mx-auto\"\n            (click)=\"back()\"\n        >\n            <span class=\"text-white\">Confirm</span>\n        </button>\n    </div>\n</div>\n","import { Component, OnInit, Inject } from '@angular/core';\nimport {\n    MatBottomSheetRef,\n    MAT_BOTTOM_SHEET_DATA,\n} from '@angular/material/bottom-sheet';\nimport { Space } from '@placeos/spaces';\nimport { RoomConfirmService } from '../room-confirm.service';\n\n@Component({\n    selector: 'placeos-room-tile',\n    templateUrl: './room-tile.component.html',\n    styles: [``],\n})\nexport class RoomTileComponent implements OnInit {\n    space: Space;\n    constructor(\n        @Inject(MAT_BOTTOM_SHEET_DATA) public data: any,\n        private _bottomSheetRef: MatBottomSheetRef<RoomTileComponent>,\n        private _roomConfirmService: RoomConfirmService\n    ) {}\n\n    ngOnInit() {\n        this.space = this.data;\n    }\n\n    openRoomDetail() {\n        this._roomConfirmService.openRoomDetail(this.space);\n    }\n\n    cancel() {\n        this._bottomSheetRef.dismiss(null);\n    }\n}\n","<div\n    class=\"w-full min-h-min min-w-[400px] flex flex-1 flex-col z-0 overflow-hidden\"\n>\n    <div\n        class=\"flex w-[calc(100%-2rem)] max-w-[375px] mx-auto items-center justify-content\"\n        (click)=\"openRoomDetail()\"\n    >\n        <div\n            class=\"flex flex-col bg-white h-full w-full border rounded-lg mx-4\"\n        >\n            <div\n                class=\"flex items-center justify-center h-44 bg-gray-200 rounded-lg m-3 text-gray-500\"\n            >\n                <img\n                    *ngIf=\"space?.images?.length > 0\"\n                    src=\" space.images \"\n                    alt=\"image of building \"\n                    width=\"100%\"\n                    height=\"100%\"\n                    class=\"flex z-20 rounded-lg\"\n                />\n\n                <div *ngIf=\"space?.images?.length == 0\">\n                    <mat-icon\n                        class=\"flex items-center justify-center material-icons-outlined text-[8rem]\"\n                        >image</mat-icon\n                    >\n                </div>\n            </div>\n            <div class=\"mb-4 flex flex-col\">\n                <span class=\"text-xl font-bold mt-1 mx-3\">\n                    {{ space?.name }}</span\n                >\n\n                <div class=\"flex flex-row items-center text-base mt-1 mx-3\">\n                    <mat-icon\n                        class=\"flex items-center material-icons-outlined blue-icon\"\n                        >room</mat-icon\n                    >\n                    <span class=\"text-gray-500\">\n                        {{ space?.level?.name }},\n                        {{ space?.level?.parent_id }}</span\n                    >\n                </div>\n\n                <div class=\"flex flex-row items-center text-base mt-1 mx-3\">\n                    <mat-icon\n                        class=\"flex items-center material-icons-outlined blue-icon\"\n                        >people</mat-icon\n                    >\n                    <span class=\"text-gray-500\"> {{ space?.capacity }}</span>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div\n    class=\"flex flex-col bg-white h-full border-t border-gray-300 top-box-shadow p-3 mt-5 mb-10 -mx-4 items-center\"\n>\n    <button\n        mat-button\n        (click)=\"cancel()\"\n        class=\"bg-white border-secondary w-[460px] ml-2 mx-4\"\n    >\n        <span class=\"text-secondary\">Back</span>\n    </button>\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport { BaseClass, currentUser } from '@placeos/common';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { ScheduleStateService } from 'apps/workplace/src/app/new-schedule/schedule-state.service';\n\n@Component({\n    selector: 'placeos-upcoming-bookings',\n    template: `\n        <div class=\"w-full h-full flex flex-1 flex-col z-0 bg-gray-50\">\n            <h3 class=\"flex items-center text-xl font-bold p-4 pl-6\">\n                Your Bookings\n            </h3>\n            <div\n                class=\"px-4 pb-4 flex-1 h-1/2 overflow-auto space-y-4\"\n                *ngIf=\"!(loading$ | async); else load_state\"\n            >\n                <ng-container\n                    *ngIf=\"(events$ | async)?.length; else empty_state\"\n                >\n                    <ng-container\n                        *ngFor=\"let item of events$ | async; trackBy: trackByFn\"\n                    >\n                        <event-card\n                            *ngIf=\"isEvent(item); else booking_card\"\n                            [event]=\"item\"\n                        ></event-card>\n                        <ng-template #booking_card>\n                            <booking-card [booking]=\"item\"></booking-card>\n                        </ng-template>\n                    </ng-container>\n                </ng-container>\n            </div>\n        </div>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"h-3/4 w-full flex-1 flex flex-col items-center justify-center space-y-4 my-6\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>Retrieving bookings...</p>\n            </div>\n        </ng-template>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"h-3/4 w-full flex-1 flex flex-col items-center justify-center space-y-2 p-8 text-center my-6\"\n            >\n                <p>No bookings found</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class UpcomingBookingsComponent extends BaseClass implements OnInit {\n    public user = currentUser();\n    public readonly loading$ = this._schedule.loading;\n    public readonly events$ = this._schedule.filtered_bookings;\n\n    constructor(private _schedule: ScheduleStateService) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this._schedule.toggleType('desk', true);\n        this._schedule.toggleType('parking', true);\n        this.subscription('poll', this._schedule.startPolling());\n    }\n\n    public isEvent(item: any) {\n        return item instanceof CalendarEvent;\n    }\n\n    public trackByFn(_: number, item: any) {\n        return item?.id;\n    }\n}\n","export const environment = {\n    production: false,\n};\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n    enableProdMode();\n}\n\nplatformBrowserDynamic()\n    .bootstrapModule(AppModule)\n    .catch((err) => console.error(err));\n","import { Component, Input, Optional } from '@angular/core';\nimport { MatBottomSheetRef } from '@angular/material/bottom-sheet';\nimport { BaseClass, notifyError } from '@placeos/common';\nimport { CalendarEvent, EventFormService } from '@placeos/events';\nimport { OrganisationService } from '@placeos/organisation';\n\n@Component({\n    selector: 'meeting-flow-confirm',\n    template: `\n        <button mat-icon-button *ngIf=\"show_close\" (click)=\"dismiss()\">\n            <app-icon>close</app-icon>\n        </button>\n        <header class=\"flex items-center justify-between px-2\">\n            <h2>Confirm Meeting booking</h2>\n            <mat-spinner diameter=\"32\" *ngIf=\"loading | async\"></mat-spinner>\n        </header>\n        <section period class=\"flex space-x-1 px-2\">\n            <app-icon class=\"text-success mt-1\">done</app-icon>\n            <div details class=\"leading-6\">\n                <h3>{{ event.title || '~Untitled~' }}</h3>\n                <div class=\"flex items-center space-x-2\">\n                    <app-icon>calendar_today</app-icon>\n                    <div date>{{ event.date | date: 'fullDate' }}</div>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <app-icon>schedule</app-icon>\n                    <div time>\n                        {{\n                            event.all_day\n                                ? 'All Day'\n                                : (event.date | date: 'shortTime') +\n                                  ' - ' +\n                                  (event.date + event.duration * 60 * 1000\n                                      | date: 'h:mm a (z)')\n                        }}\n                    </div>\n                </div>\n            </div>\n        </section>\n        <section\n            attendees\n            class=\"flex space-x-1 px-2\"\n            *ngIf=\"event.attendees.length\"\n        >\n            <app-icon class=\"text-success mt-1\">done</app-icon>\n            <div details class=\"leading-6\">\n                <h3>\n                    {{ event.attendees.length }} { event.attendees.length,\n                    plural, =1 { attendee } other { attendees } }\n                </h3>\n                <div attendee-list>\n                    <mat-chip-list #chipList aria-label=\"User selection\">\n                        <mat-chip *ngFor=\"let user of event.attendees\">\n                            <app-icon class=\"mr-2\">business</app-icon>\n                            {{ user.name || user.email }}\n                        </mat-chip>\n                    </mat-chip-list>\n                </div>\n            </div>\n        </section>\n        <section spaces class=\"flex space-x-1 px-2\" *ngIf=\"space?.id\">\n            <app-icon class=\"text-success mt-1\">done</app-icon>\n            <div details class=\"leading-6\">\n                <h3>Booked Room</h3>\n                <ng-container *ngFor=\"let s of event.resources\">\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>meeting_room</app-icon>\n                        <div>\n                            {{ s.level?.display_name || s.level?.name }},\n                            {{ s.display_name || s.name }}\n                        </div>\n                    </div>\n                </ng-container>\n                <div class=\"flex items-center space-x-2\">\n                    <app-icon>place</app-icon>\n                    <div>{{ location }}</div>\n                </div>\n            </div>\n        </section>\n        <footer class=\"p-2 w-full border-t border-gray-200 mt-4\">\n            <button\n                mat-button\n                class=\"w-full\"\n                *ngIf=\"!(loading | async)\"\n                (click)=\"postForm()\"\n            >\n                Confirm\n            </button>\n            <button\n                mat-button\n                class=\"inverse w-full\"\n                *ngIf=\"loading | async\"\n                (click)=\"cancelPost()\"\n            >\n                Undo\n            </button>\n        </footer>\n    `,\n    styles: [\n        `\n            section > app-icon {\n                font-size: 1.5rem;\n            }\n\n            h2 {\n                font-size: 1.5rem;\n                font-weight: medium;\n                margin-bottom: 0.5rem;\n            }\n\n            h3 {\n                font-size: 1.25rem;\n                font-weight: medium;\n                margin: 0.5rem 0;\n            }\n        `,\n    ],\n})\nexport class MeetingFlowConfirmComponent extends BaseClass {\n    @Input() public show_close: boolean = false;\n\n    public readonly loading = this._event_form.loading;\n\n    public readonly postForm = async () => {\n        await this._event_form.postForm().catch(_ => {\n            notifyError(_);\n            throw _;\n        });\n        this.dismiss(true);\n    };\n    public readonly cancelPost = () => this._event_form.cancelPostForm();\n    public readonly dismiss = (e?) => this._sheet_ref?.dismiss(e)\n\n    public get event(): CalendarEvent {\n        return this._event_form.form.value as any;\n    }\n\n    public get space() {\n        return this.event.resources[0];\n    }\n\n    public get location() {\n        const building = this._org.buildings.find(\n            (_) => _.id === this.space?.level?.parent_id\n        );\n        return (\n            building?.address || building?.display_name || building?.name || '~Unspecified Location~'\n        );\n    }\n\n    constructor(\n        private _event_form: EventFormService,\n        private _org: OrganisationService,\n        @Optional() private _sheet_ref: MatBottomSheetRef\n    ) {\n        super();\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { Booking, queryBookings } from '@placeos/bookings';\nimport { BaseClass, SettingsService } from '@placeos/common';\nimport {\n    CalendarEvent,\n    newCalendarEventFromBooking,\n    queryEvents,\n} from '@placeos/events';\nimport { endOfDay, getUnixTime, startOfDay } from 'date-fns';\nimport { BehaviorSubject, combineLatest, Observable } from 'rxjs';\nimport { catchError, map, shareReplay, switchMap, tap } from 'rxjs/operators';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class ScheduleStateService extends BaseClass {\n    private _poll = new BehaviorSubject(0);\n    private _loading = new BehaviorSubject(false);\n    private _filters = new BehaviorSubject({\n        shown_types: ['event', 'desk', 'parking', 'visitor'],\n    });\n    private _date = new BehaviorSubject(Date.now());\n    private _update = combineLatest([this._date, this._poll]).pipe(\n        tap((_) => this._loading.next(true))\n    );\n    /** List of calendar events for the selected date */\n    public readonly events: Observable<CalendarEvent[]> = this._update.pipe(\n        switchMap(([date]) => {\n            const query = {\n                period_start: getUnixTime(startOfDay(date)),\n                period_end: getUnixTime(endOfDay(date)),\n            };\n            return this._settings.get('app.no_user_calendar')\n                ? queryBookings({ ...query, type: 'room' }).pipe(\n                      map((_) => _.map((i) => newCalendarEventFromBooking(i))),\n                      catchError((_) => [])\n                  )\n                : queryEvents({ ...query }).pipe(catchError((_) => []));\n        }),\n        tap(() => this.timeout('end_loading', () => this._loading.next(false))),\n        shareReplay(1)\n    );\n    /** List of desk bookings for the selected date */\n    public readonly visitors: Observable<Booking[]> = this._update.pipe(\n        switchMap(([date]) =>\n            queryBookings({\n                period_start: getUnixTime(startOfDay(date)),\n                period_end: getUnixTime(endOfDay(date)),\n                type: 'visitor',\n            }).pipe(catchError((_) => {\n                console.error(_);\n                return [];\n            }))\n        ),\n        tap(() => this.timeout('end_loading', () => this._loading.next(false))),\n        shareReplay(1)\n    );\n    /** List of desk bookings for the selected date */\n    public readonly desks: Observable<Booking[]> = this._update.pipe(\n        switchMap(([date]) =>\n            queryBookings({\n                period_start: getUnixTime(startOfDay(date)),\n                period_end: getUnixTime(endOfDay(date)),\n                type: 'desk',\n            }).pipe(catchError((_) => {\n                console.error(_);\n                return [];\n            }))\n        ),\n        tap(() => this.timeout('end_loading', () => this._loading.next(false))),\n        shareReplay(1)\n    );\n    /** List of parking bookings for the selected date */\n    public readonly parking: Observable<Booking[]> = this._update.pipe(\n        switchMap(([date]) =>\n            queryBookings({\n                period_start: getUnixTime(startOfDay(date)),\n                period_end: getUnixTime(endOfDay(date)),\n                type: 'parking',\n            }).pipe(catchError((_) => []))\n        ),\n        tap(() => this.timeout('end_loading', () => this._loading.next(false))),\n        shareReplay(1)\n    );\n\n    /** List of events and bookings for the selected date */\n    public readonly bookings = combineLatest([\n        this.events,\n        this.visitors,\n        this.desks,\n        this.parking,\n    ]).pipe(\n        map(([e, v, d, p]) => [...e, ...v, ...d, ...p].sort((a, b) => a.date - b.date))\n    );\n    /** Filtered list of events and bookings for the selected date */\n    public readonly filtered_bookings = combineLatest([\n        this.bookings,\n        this._filters,\n    ]).pipe(\n        map(([bkns, filters]) =>\n            bkns.filter(\n                (_) =>\n                    (_ instanceof CalendarEvent &&\n                        filters?.shown_types?.includes('event')) ||\n                    filters?.shown_types?.includes((_ as any).booking_type)\n            )\n        )\n    );\n    /** Currently selected date */\n    public readonly filters = this._filters.asObservable();\n    /** Currently selected date */\n    public readonly date = this._date.asObservable();\n    /** Whether events and bookings are loading */\n    public readonly loading = this._loading.asObservable();\n\n    constructor(private _settings: SettingsService) {\n        super();\n    }\n\n    public startPolling(delay = 15 * 1000) {\n        this.interval('poll', () => this._poll.next(Date.now()), delay);\n        return () => this.stopPolling();\n    }\n\n    public stopPolling() {\n        this.clearInterval('poll');\n    }\n\n    public setDate(date: number) {\n        this._date.next(date);\n    }\n\n    public removeItem(item) {\n        this._poll.next(Date.now());\n    }\n\n    public async toggleType(name: string, clear: boolean = false) {\n        const filters = this._filters.getValue() || { shown_types: [] };\n        const { shown_types } = filters;\n        if (shown_types && (shown_types.includes(name) || clear)) {\n            this._filters.next({\n                ...filters,\n                shown_types: shown_types.filter((_) => _ !== name),\n            });\n        } else {\n            this._filters.next({\n                ...filters,\n                shown_types: [...shown_types, name],\n            });\n        }\n    }\n}\n","export * from './lib/assets.module';\nexport * from './lib/asset.class';\nexport * from './lib/asset.utilities';\nexport * from './lib/assets.fn';","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Asset } from '../asset.class';\n\n@Component({\n    selector: 'asset-details',\n    template: `\n        <ng-container *ngIf=\"item; else empty_state\">\n            <section image class=\"relative w-full h-64 sm:h-40 bg-black/20\">\n                <image-carousel\n                    [images]=\"images\"\n                    class=\"absolute inset-0\"\n                ></image-carousel>\n                <button\n                    mat-icon-button\n                    close\n                    (click)=\"close.emit()\"\n                    class=\"absolute top-2 left-2 bg-black/40 sm:hidden text-white\"\n                >\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <button\n                    mat-icon-button\n                    fav\n                    [class.text-white]=\"!fav\"\n                    [class.text-blue-400]=\"fav\"\n                    (click)=\"toggleFav.emit()\"\n                    class=\"absolute top-2 right-2 bg-black/40\"\n                >\n                    <app-icon>{{\n                        fav ? 'favorite' : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </section>\n            <div class=\"p-2 space-y-2 flex-1 h-1/2 overflow-auto\">\n                <section actions class=\"z-0 flex items-center justify-between\">\n                    <div>\n                        <h2 class=\"text-xl font-medium mb-2 mt-4\">\n                            {{ item.name }}\n                        </h2>\n                        <p>{{ item.count }} Available</p>\n                    </div>\n                    <a-counter\n                        [(ngModel)]=\"item.amount\"\n                        [min]=\"1\"\n                        [max]=\"item.count || 2\"\n                    ></a-counter>\n                </section>\n                <hr />\n                <section details class=\"space-y-2\">\n                    <h2 class=\"text-xl font-medium\">Details</h2>\n                    <div class=\"flex items-center space-x-2\">\n                        <p>{{ item.description || 'No description' }}</p>\n                    </div>\n                </section>\n            </div>\n            <div class=\"p-2 border-t border-gray-200 shadow sm:hidden\">\n                <button\n                    mat-button\n                    select\n                    [class.inverse]=\"active\"\n                    class=\"w-full\"\n                    (click)=\"active = !active; activeChange.emit(active)\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <app-icon class=\"text-2xl\">{{\n                            active ? 'remove' : 'add'\n                        }}</app-icon>\n                        <p>\n                            {{\n                                active ? 'Remove this asset' : 'Add this asset'\n                            }}\n                        </p>\n                    </div>\n                </button>\n            </div>\n        </ng-container>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    Select an asset to view it's details\n                </p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 30%;\n                min-width: 20rem;\n                height: 100%;\n                min-height: 65vh;\n            }\n        `,\n    ],\n})\nexport class AssetDetailsComponent {\n    @Input() public item?: Asset;\n    @Input() public active: boolean = false;\n    @Input() public fav: boolean = false;\n\n    @Output() public toggleFav = new EventEmitter<void>();\n    @Output() public activeChange = new EventEmitter<boolean>();\n    @Output() public close = new EventEmitter<void>();\n\n    public get images() {\n        return this.item?.images.map((_) => _.url) || [];\n    }\n}\n","import { Component } from \"@angular/core\";\n\n@Component({\n    selector: 'asset-filters-display',\n    template: ``,\n    styles: [``]\n})\nexport class AssetFiltersDisplayComponent {\n    \n}\n","import { Component } from \"@angular/core\";\n\n@Component({\n    selector: 'asset-filters',\n    template: ``,\n    styles: [``]\n})\nexport class AssetFiltersComponent {\n    \n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { AssetStateService } from '../asset-state.service';\nimport { Asset } from '../asset.class';\n\n@Component({\n    selector: 'asset-list',\n    template: `\n        <div class=\"w-full h-full overflow-auto py-2 bg-black/5 dark:bg-white/10 dark:border-neutral-500\">\n            <h3 class=\"font-bold px-2\">Results</h3>\n            <p count class=\"text-sm opacity-60 mb-4 px-2\">\n                {{ (assets | async)?.length || 0 }} result(s) found\n            </p>\n            <ng-container *ngIf=\"!(loading | async); else load_state\">\n                <ul\n                    class=\"list-style-none space-y-2 p-2\"\n                    *ngIf=\"(assets | async)?.length; else empty_state\"\n                >\n                    <li\n                        asset\n                        *ngFor=\"let asset of assets | async\"\n                        class=\"relative p-2 rounded-lg w-full shadow border bg-white dark:bg-neutral-700 border-gray-200 dark:border-neutral-500\"\n                    >\n                        <button\n                            matRipple\n                            select\n                            class=\"w-full h-full flex items-center pr-10\"\n                            (click)=\"selectAsset(asset)\"\n                        >\n                            <div\n                                class=\"relative w-16 h-16 rounded-xl bg-black/20 mr-4\"\n                            >\n                                <div\n                                    class=\"absolute top-1 left-1 border border-white bg-black/50 rounded-full h-6 w-6 flex items-center justify-center text-white\"\n                                    *ngIf=\"selected.includes(asset.id)\"\n                                >\n                                   <span class=\"text-xs\">{{asset.amount || 1}}</span>\n                                </div>\n                            </div>\n                            <div class=\"space-y-2 text-left flex-1\">\n                                <div class=\"font-medium flex items-center justify-between\">\n                                    <div>{{ asset.name || 'Asset' }}</div>\n                                    <div class=\"opacity-60 text-xs\">{{ asset.category }}</div>\n                                </div>\n                                <div\n                                    class=\"flex items-center text-sm space-x-2\"\n                                >\n                                    <p>\n                                        {{ asset.count < 1 ? 2 : asset.count }}\n                                        Available\n                                    </p>\n                                </div>\n                            </div>\n                        </button>\n                        <button\n                            mat-icon-button\n                            fav\n                            class=\"absolute top-1 right-1\"\n                            [class.text-blue-400]=\"isFavourite(asset.id)\"\n                            (click)=\"toggleFav.emit(asset)\"\n                        >\n                            <app-icon>{{\n                                isFavourite(asset.id)\n                                    ? 'favorite'\n                                    : 'favorite_border'\n                            }}</app-icon>\n                        </button>\n                    </li>\n                </ul>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    No available assets for selected time and/or filters\n                </p>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"opacity-30\">Finding available assets...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [`\n        :host {\n            width: 100%;\n            height: 100%;\n        }\n    `],\n})\nexport class AssetListComponent {\n    @Input() public selected: string = '';\n    @Input() public favorites: string[] = [];\n    @Output() public toggleFav = new EventEmitter<Asset>();\n    @Output() public onSelect = new EventEmitter<Asset>();\n\n    public readonly loading = this._asset_state.loading;\n    public readonly assets = this._asset_state.filtered_assets;\n\n    constructor(private _asset_state: AssetStateService) {}\n\n    public isFavourite(asset_id: string) {\n        return this.favorites.includes(asset_id);\n    }\n\n    public selectAsset(asset: Asset) {\n        this.onSelect.emit(asset);\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from '@placeos/common';\nimport { Asset } from '../asset.class';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: 'asset-select-modal',\n    template: `\n        <div\n            class=\"absolute inset-0 sm:relative sm:inset-none flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <header class=\"flex items-center space-x-4 w-full\">\n                <button mat-icon-button mat-dialog-close class=\"bg-black/20\">\n                    <app-icon>close</app-icon>\n                </button>\n                <h3>Add Assets</h3>\n            </header>\n            <main\n                class=\"flex-1 flex items-center divide-x divide-gray-200 dark:divide-neutral-500 min-h-[65vh] h-[65vh] sm:max-h-[65vh] sm:max-w-[95vw] w-full overflow-hidden\"\n            >\n                <asset-filters class=\"h-full hidden sm:block\"></asset-filters>\n                <div\n                    class=\"flex flex-col items-center flex-1 w-1/2 h-full sm:min-w-[20rem] sm:h-[65vh]\"\n                >\n                    <asset-filters-display\n                        class=\"w-full border-b border-gray-200 dark:border-neutral-500 dark:bg-neutral-700\"\n                    ></asset-filters-display>\n                    <asset-list\n                        [selected]=\"selected_ids\"\n                        [favorites]=\"favorites\"\n                        (toggleFav)=\"toggleFavourite($event)\"\n                        (onSelect)=\"displayed = $event\"\n                        class=\"flex-1 h-1/2 w-full overflow-hidden\"\n                    ></asset-list>\n                </div>\n                <asset-details\n                    [item]=\"displayed!\"\n                    class=\"h-full w-full sm:h-[65vh] absolute sm:relative sm:flex sm:max-w-[20rem] bg-white  dark:bg-neutral-700 z-20\"\n                    [class.hidden]=\"!displayed\"\n                    [class.inset-0]=\"displayed\"\n                    [active]=\"selected_ids.includes(displayed?.id || '')\"\n                    (activeChange)=\"setSelected(displayed!, $event)\"\n                    [fav]=\"\n                        !!displayed &&\n                        this.favorites.includes(displayed?.id || '')\n                    \"\n                    (toggleFav)=\"toggleFavourite(displayed!)\"\n                    (close)=\"displayed = null\"\n                ></asset-details>\n            </main>\n            <footer\n                class=\"flex sm:hidden flex-col-reverse items-center justify-end p-2 border-t border-gray-200 dark:border-neutral-500w-full\"\n            >\n                <button\n                    mat-button\n                    back-btn\n                    class=\"inverse sm:hidden w-full sm:w-auto\"\n                    *ngIf=\"displayed\"\n                    (click)=\"displayed = null\"\n                >\n                    Back\n                </button>\n                <button\n                    mat-button\n                    save\n                    [mat-dialog-close]=\"selected\"\n                    [class.mb-2]=\"displayed\"\n                    class=\"w-full sm:w-auto sm:mb-0\"\n                >\n                    View List\n                </button>\n            </footer>\n            <footer\n                class=\"hidden sm:flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    [mat-dialog-close]=\"selected\"\n                    class=\"clear text-primary\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">arrow_back</app-icon>\n                        <div class=\"mr-1 underline\">Back to form</div>\n                    </div>\n                </button>\n                <p class=\"opacity-60 text-sm\">{{ count }} assets(s) added</p>\n                <button\n                    mat-button\n                    [disabled]=\"!displayed\"\n                    [class.inverse]=\"isSelected(displayed?.id)\"\n                    (click)=\"setSelected(displayed, !isSelected(displayed?.id))\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">{{\n                            isSelected(displayed?.id) ? 'remove' : 'add'\n                        }}</app-icon>\n                        <div class=\"mr-1\">\n                            {{\n                                isSelected(displayed?.id)\n                                    ? 'Remove from Booking'\n                                    : 'Add to booking'\n                            }}\n                        </div>\n                    </div>\n                </button>\n            </footer>\n        </div>\n    `,\n    styles: [``],\n})\nexport class AssetSelectModalComponent {\n    public displayed: Asset | null = null;\n    public selected: Asset[] = [...(this._items || [])];\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_assets') || EMPTY_FAVS;\n    }\n\n    public get selected_ids() {\n        return this.selected.map((_) => _.id).join(',');\n    }\n\n    public get count() {\n        return this.selected.reduce((t, i) => t + i.amount, 0);\n    }\n\n    public isSelected(id: string) {\n        return id && this.selected_ids.includes(id);\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        @Inject(MAT_DIALOG_DATA) private _items: Asset[]\n    ) {}\n\n    public setSelected(asset: Asset, state: boolean) {\n        const list = this.selected.filter((_) => _.id !== asset.id);\n        if (state) list.push(asset);\n        this.selected = list;\n    }\n\n    public toggleFavourite(asset: Asset) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(asset.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_assets', [\n                ...fav_list,\n                asset.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_assets',\n                fav_list.filter((_) => _ !== asset.id)\n            );\n        }\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, combineLatest, of } from 'rxjs';\nimport { debounceTime, map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { queryAssets } from './assets.fn';\nimport { queryBookings } from 'libs/bookings/src/lib/bookings.fn';\nimport { endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\nexport interface AssetOptions {\n    zone?: string;\n    date: number;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class AssetStateService {\n    private _options = new BehaviorSubject<AssetOptions>({ date: Date.now() });\n    private _search = new BehaviorSubject<string>('');\n    private _loading = new BehaviorSubject<string>('');\n\n    public readonly search = this._search.asObservable();\n    public readonly loading = this._loading.asObservable();\n\n    public readonly asset_list = of(0).pipe(\n        switchMap(() => {\n            this._loading.next(this._loading.getValue() + '[Assets]');\n            return queryAssets();\n        }),\n        tap((_) =>\n            this._loading.next(\n                this._loading.getValue().replace(/\\[Assets\\]/g, '')\n            )\n        ),\n        shareReplay(1)\n    );\n\n    public readonly asset_bookings = this._options.pipe(\n        debounceTime(300),\n        switchMap(({ zone, date }) => {\n            this._loading.next(this._loading.getValue() + '[Bookings]');\n            return queryBookings({\n                zones: zone || '',\n                period_start: getUnixTime(startOfDay(date)),\n                period_end: getUnixTime(endOfDay(date)),\n                type: 'asset-request',\n            });\n        }),\n        tap((_) =>\n            this._loading.next(\n                this._loading.getValue().replace(/\\[Bookings\\]/g, '')\n            )\n        ),\n        shareReplay(1)\n    );\n\n    public readonly available_assets = combineLatest([\n        this.asset_list,\n        this.asset_bookings,\n    ]).pipe(\n        map(([list, bookings]) =>\n            list\n                .filter((_) => !bookings.find((b) => b.asset_id === _.id))\n                .sort(\n                    (a, b) =>\n                        a.category.localeCompare(b.category) ||\n                        a.name.localeCompare(b.name)\n                )\n        ),\n        shareReplay(1)\n    );\n\n    public readonly filtered_assets = combineLatest([\n        this._search,\n        this.available_assets,\n    ]).pipe(\n        map(([search, assets]) => {\n            const s = search.toLowerCase();\n            return assets.filter(\n                (_) =>\n                    _.name.toLowerCase().includes(s) ||\n                    _.description.toLowerCase().includes(s)\n            );\n        }),\n        shareReplay(1)\n    );\n\n    public setSearch(value: string) {\n        this._search.next(`${value}`);\n    }\n\n    public setOptions(options: Partial<AssetOptions>) {\n        this._options.next({ ...this._options.value, ...options });\n    }\n}\n","\nexport interface AssetResource {\n    id?: string;\n    name: string,\n    url: string;\n    price?: number;\n}\n\nexport interface AssetDetail {\n    id: string;\n    name: string;\n}\n\nexport interface AssetPurchase {\n    id?: string;\n    name: string;\n    value: string;\n}\n\nexport class Asset {\n    public readonly id: string;\n    public readonly name: string;\n    public readonly category: string;\n    public readonly images: AssetResource[];\n    public readonly barcode: string;\n    public readonly brand: string;\n    public readonly size: 'Small' | 'Medium' | 'Large';\n    public readonly description: string;\n    public readonly specifications: Record<string, string>;\n    public readonly purchase_details: AssetPurchase[];\n    public readonly consumables: AssetDetail[];\n    public readonly general_details: AssetDetail[];\n    public readonly invoices: AssetResource[];\n    public readonly count: number;\n    public readonly locations: [string, string][];\n    public amount = 1;\n\n    constructor(_data: Partial<Asset> = {}) {\n        this.id = _data.id || '';\n        this.name = _data.name || '';\n        this.category = _data.category || '';\n        this.images = _data.images || [];\n        this.barcode = _data.barcode || '';\n        this.brand = _data.brand || '';\n        this.size = _data.size || 'Small';\n        this.description = _data.description || '';\n        this.specifications = _data.specifications || {};\n        this.purchase_details = _data.purchase_details || [];\n        this.consumables = _data.consumables || [];\n        this.general_details = _data.general_details || [];\n        this.invoices = _data.invoices || [];\n        this.count = _data.count ?? 0;\n        this.locations = _data.locations || [];\n        this.amount = _data.amount ?? 1;\n    }\n}","import { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { Asset } from './asset.class';\n\nexport function generateAssetForm(asset: Asset = new Asset()) {\n    return new FormGroup({\n        id: new FormControl(asset.id),\n        name: new FormControl(asset.name, [Validators.required]),\n        category: new FormControl(asset.category, [Validators.required]),\n        count: new FormControl(asset.count),\n        size: new FormControl(asset.size),\n        description: new FormControl(asset.description),\n        barcode: new FormControl(asset.barcode, [Validators.required]),\n        brand: new FormControl(asset.brand, [Validators.required]),\n        specifications: new FormControl(asset.specifications),\n        purchase_date: new FormControl(Date.now(), [Validators.required]),\n        expiry_date: new FormControl(0),\n        invoices: new FormControl(asset.invoices),\n        purchase_details: new FormControl(asset.purchase_details),\n        consumables: new FormControl(asset.consumables),\n        general_details: new FormControl(asset.general_details),\n        images: new FormControl(asset.images),\n    });\n}","import { del, get, post, put } from '@placeos/ts-client';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { catchError, map } from 'rxjs/operators';\nimport { Asset } from './asset.class';\nimport { Observable, of } from 'rxjs';\n\nconst ASSET_ENDPOINT = '/api/engine/v1/assets';\n\n/**\n * Query the list of available assets\n * @param q Filter the list based of the give string\n */\nexport function queryAssets(q?: string): Observable<Asset[]> {\n    const query = toQueryString({ q });\n    return get(`${ASSET_ENDPOINT}${query ? query : ''}`).pipe(\n        map((_: any) => _.map((d: any) => new Asset(d))),\n        catchError((_) => of([]))\n    );\n}\n\n/**\n * Delete asset with the given ID\n * @param id ID of asset to delete\n */\nexport function deleteAsset(id: string) {\n    return del(`${ASSET_ENDPOINT}/${id}`);\n}\n\n/**\n * Add asset to database with given details\n * @param asset Asset details\n */\nexport function createAsset(asset: Asset): Observable<Asset> {\n    return post(`${ASSET_ENDPOINT}`, asset).pipe(map((_) => new Asset(_)));\n}\n\n/**\n * Update asset in database to the new details\n * @param id ID of the asset to update\n * @param asset New details for asset\n */\nexport function updateAsset(id: string, asset: Asset) {\n    return put(`${ASSET_ENDPOINT}/${id}`, asset).pipe(map((_) => new Asset(_)));\n}\n\n/**\n * Save the details for the given asset in the database\n * @param asset Asset details\n */\nexport function saveAsset(asset: Asset) {\n    return asset.id ? updateAsset(asset.id, asset) : createAsset(asset);\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { AssetSelectModalComponent } from './asset-select-modal/asset-select-modal.component';\nimport { ComponentsModule } from '@placeos/components';\nimport { AssetDetailsComponent } from './asset-select-modal/asset-details.component';\nimport { AssetFiltersComponent } from './asset-select-modal/asset-filters.component';\nimport { AssetFiltersDisplayComponent } from './asset-select-modal/asset-filters-display.component';\nimport { AssetListComponent } from './asset-select-modal/asset-list.component';\nimport { FormFieldsModule } from '@placeos/form-fields';\nimport { FormsModule } from '@angular/forms';\n\nexport * from './asset-select-modal/asset-select-modal.component';\n\nconst COMPONENTS = [AssetSelectModalComponent];\n\nconst MODULE_COMPONENTS = [\n    AssetDetailsComponent,\n    AssetFiltersComponent,\n    AssetFiltersDisplayComponent,\n    AssetListComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS, ...MODULE_COMPONENTS],\n    imports: [\n        CommonModule, \n        FormFieldsModule, \n        FormsModule, \n        ComponentsModule\n    ],\n    exports: [...COMPONENTS],\n})\nexport class AssetsModule {}\n","export * from './lib/bookings.module';\nexport * from './lib/booking-form.service';\nexport * from './lib/booking.class';\nexport * from './lib/booking.utilities';\nexport * from './lib/bookings.fn';\nexport * from './lib/bookings.module';\nexport * from './lib/desk.service';\nexport * from './lib/booking-details-modal.component';\nexport * from './lib/booking-card.component';\nexport * from './lib/parking-select-modal/parking-select-modal.component';\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ActivatedRoute } from '@angular/router';\nimport { Booking } from './booking.class';\nimport { BookingDetailsModalComponent } from './booking-details-modal.component';\nimport { BaseClass } from 'libs/common/src/lib/base.class';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { addMinutes, format, formatDuration, isSameDay } from 'date-fns';\n\n@Component({\n    selector: 'booking-card',\n    template: `\n        <h4 class=\"mb-2 flex items-center\" *ngIf=\"booking\">\n            <span *ngIf=\"show_day\" day>{{ day }}, </span>\n            {{ booking?.date | date: 'h:mm a' }}\n            <span class=\"text-xs px-2\">({{ booking?.date | date: 'z' }})</span>\n        </h4>\n        <a\n            matRippleColor\n            details\n            class=\"w-full\"\n            [routerLink]=\"['./']\"\n            [queryParams]=\"{ booking: booking?.id }\"\n            (click)=\"viewDetails()\"\n            *ngIf=\"booking\"\n        >\n            <div\n                class=\"w-full bg-white dark:bg-neutral-700 rounded-xl shadow py-4 relative\"\n            >\n                <h4 class=\"px-4 text-lg\">{{ booking?.title }}</h4>\n                <div class=\"flex mx-4 my-2\">\n                    <div\n                        class=\"flex items-center bg-opacity-30 rounded-2xl p-1 text-base space-x-2 pr-2 font-medium\"\n                        [class.bg-green-600]=\"\n                            !booking.is_done && booking?.status === 'approved'\n                        \"\n                        [class.bg-yellow-500]=\"\n                            !booking.is_done && booking?.status === 'tentative'\n                        \"\n                        [class.bg-red-600]=\"\n                            !booking.is_done && booking?.status === 'declined'\n                        \"\n                        [class.bg-gray-300]=\"booking.is_done\"\n                    >\n                        <div\n                            class=\"rounded-full h-5 w-5 flex items-center justify-center text-white\"\n                            [class.bg-success]=\"\n                                !booking.is_done &&\n                                booking?.status === 'approved'\n                            \"\n                            [class.text-pending]=\"\n                                !booking.is_done &&\n                                booking?.status === 'tentative'\n                            \"\n                            [class.bg-error]=\"\n                                !booking.is_done &&\n                                booking?.status === 'declined'\n                            \"\n                            [class.text-neutral-600]=\"booking.is_done\"\n                        >\n                            <app-icon>\n                                {{\n                                    booking.is_done\n                                        ? 'not_interested'\n                                        : booking?.status === 'approved'\n                                        ? 'done'\n                                        : booking?.status === 'tentative'\n                                        ? 'warning'\n                                        : 'close'\n                                }}\n                            </app-icon>\n                        </div>\n                        <div class=\"pr-1\">{{ period }}</div>\n                    </div>\n                </div>\n                <div\n                    class=\"flex flex-wrap flex-col sm:flex-row sm:divide-x divide-neutral-500 py-2 space-y-2 sm:space-y-0\"\n                >\n                    <div class=\"flex items-center px-4\">\n                        <app-icon *ngIf=\"type !== 'desk'; else desk_icon\">{{\n                            type\n                        }}</app-icon>\n                        <div class=\"mx-2 truncate\">\n                            {{ booking?.description || booking?.asset_id }}\n                        </div>\n                    </div>\n                    <div class=\"flex items-center px-4\" *ngIf=\"location\">\n                        <app-icon>place</app-icon>\n                        <div class=\"mx-2 truncate\">{{ location }}</div>\n                    </div>\n                </div>\n                <app-icon\n                    class=\"absolute top-1/2 right-1 text-4xl -translate-y-1/2\"\n                >\n                    chevron_right\n                </app-icon>\n            </div>\n        </a>\n        <ng-template #desk_icon>\n            <img src=\"assets/icons/desk-outline.svg\" class=\"w-5 h-5\" />\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class BookingCardComponent extends BaseClass {\n    @Input() public booking: Booking;\n    @Input() public show_day: boolean = false;\n    @Output() public edit = new EventEmitter();\n    @Output() public remove = new EventEmitter();\n\n    constructor(\n        private _dialog: MatDialog,\n        private _route: ActivatedRoute,\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) =>\n                params.has('booking') &&\n                this.booking?.id === params.get('event')\n                    ? this.viewDetails()\n                    : ''\n            )\n        );\n    }\n\n    public get type() {\n        if (this.booking?.type === 'desk') return 'desk';\n        if (this.booking?.type === 'parking') return 'drive_eta';\n        return 'book';\n    }\n\n    public get day() {\n        const date = this.booking?.date || Date.now();\n        const is_today = isSameDay(Date.now(), date);\n        return `${is_today ? 'Today' : format(date, 'EEEE')}`;\n    }\n\n    public get location() {\n        const level = this._org.levelWithID(this.booking?.zones || []);\n        return `${level?.display_name || level?.name || ''}`;\n    }\n\n    public get period() {\n        const start = this.booking?.date || Date.now();\n        const duration = this.booking?.duration || 60;\n        const end = addMinutes(start, duration);\n        const dur = formatDuration({\n            hours: Math.floor(duration / 60),\n            minutes: duration % 60,\n        })\n            .replace(' hour', 'hr')\n            .replace(' minute', 'min');\n        return `${format(start, 'h:mm a')} - ${format(end, 'h:mm a')} (${dur})`;\n    }\n\n    public viewDetails() {\n        if (!this.booking) return;\n        this.timeout('open', () =>{\n            const ref = this._dialog.open(BookingDetailsModalComponent, {\n                data: this.booking,\n            })\n            this.subscription('edit', ref.componentInstance.edit.subscribe(() => this.edit.emit()));\n            this.subscription('remove', ref.componentInstance.remove.subscribe(() => this.remove.emit()));\n       } );\n    }\n}\n","import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { notifySuccess } from '@placeos/common';\nimport { MapPinComponent } from '@placeos/components';\nimport { OrganisationService } from '@placeos/organisation';\nimport { addMinutes, format, formatDuration } from 'date-fns';\nimport { Booking } from './booking.class';\nimport { checkinBooking } from './bookings.fn';\n\n@Component({\n    selector: 'booking-details-modal',\n    template: `\n        <div\n            class=\"absolute inset-0 sm:relative sm:inset-auto sm:w-[51rem] sm:max-h-[80vh] bg-white sm:bg-gray-100 sm:dark:bg-neutral-600 dark:bg-neutral-700 sm:rounded overflow-auto space-y-2 pb-2\"\n        >\n            <div\n                class=\"sm:flex flex-col items-center pb-4 max-h-screen sm:max-h-[80vh] sm:px-16 sm:border-b bg-white dark:bg-neutral-700 border-gray-300 dark:border-neutral-500\"\n            >\n                <div\n                    class=\"bg-black/20 dark:bg-white/20 w-full h-64 sm:rounded-b overflow-hidden\"\n                    *ngIf=\"booking?.extension_data?.images?.length\"\n                >\n                    <image-carousel\n                        [images]=\"booking?.extension_data?.images\"\n                        class=\"w-full h-64\"\n                    ></image-carousel>\n                </div>\n                <h3 title class=\"px-3 mt-2 text-xl font-medium w-full\">\n                    {{ booking.title }}\n                </h3>\n                <div class=\"sm:flex items-center justify-between w-full\">\n                    <div class=\"flex m-2\">\n                        <div\n                            class=\"flex items-center bg-opacity-30 rounded-2xl p-1 text-sm space-x-2 pr-2 font-medium\"\n                            [class.bg-green-600]=\"\n                                !booking.is_done &&\n                                booking?.status === 'approved'\n                            \"\n                            [class.bg-yellow-500]=\"\n                                !booking.is_done &&\n                                booking?.status === 'tentative'\n                            \"\n                            [class.bg-red-600]=\"\n                                !booking.is_done &&\n                                booking?.status === 'declined'\n                            \"\n                            [class.bg-gray-300]=\"booking.is_done\"\n                        >\n                            <div\n                                class=\"rounded-full h-5 w-5 flex items-center justify-center text-white\"\n                                [class.bg-success]=\"\n                                    !booking.is_done &&\n                                    booking?.status === 'approved'\n                                \"\n                                [class.text-pending]=\"\n                                    !booking.is_done &&\n                                    booking?.status === 'tentative'\n                                \"\n                                [class.bg-error]=\"\n                                    !booking.is_done &&\n                                    booking?.status === 'declined'\n                                \"\n                                [class.text-neutral-600]=\"booking.is_done\"\n                            >\n                                <app-icon>\n                                    {{\n                                        booking.is_done\n                                            ? 'not_interested'\n                                            : booking?.status === 'approved'\n                                            ? 'done'\n                                            : booking?.status === 'tentative'\n                                            ? 'warning'\n                                            : 'close'\n                                    }}\n                                </app-icon>\n                            </div>\n                            <div class=\"pr-1\">{{ period }}</div>\n                        </div>\n                    </div>\n                    <div\n                        actions\n                        class=\"flex items-center space-x-2 px-2\"\n                        *ngIf=\"!booking.is_done\"\n                    >\n                        <button\n                            mat-button\n                            class=\"flex-1 h-10\"\n                            [class.inverse]=\"booking.checked_in\"\n                            [disabled]=\"checking_in\"\n                            (click)=\"toggleCheckedIn()\"\n                        >\n                            <div\n                                class=\"flex items-center space-x-2 justify-center\"\n                                *ngIf=\"!checking_in; else loading_state\"\n                            >\n                                <app-icon>{{\n                                    booking.checked_in ? 'done' : 'arrow_back'\n                                }}</app-icon>\n                                <div class=\"mr-4\">\n                                    {{\n                                        booking.checked_in\n                                            ? 'Checked in'\n                                            : 'Not checked in'\n                                    }}\n                                </div>\n                            </div>\n                            <ng-template #loading_state>\n                                <mat-spinner\n                                    class=\"mx-auto\"\n                                    [diameter]=\"32\"\n                                ></mat-spinner>\n                            </ng-template>\n                        </button>\n                        <button\n                            mat-icon-button\n                            [matMenuTriggerFor]=\"menu\"\n                            class=\"bg-primary rounded text-white h-10 w-10\"\n                        >\n                            <app-icon>more_horiz</app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class=\"sm:flex flex-wrap sm:px-12\">\n                <div\n                    class=\"sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[4] min-w-1/3 sm:w-[16rem]\"\n                >\n                    <h3 class=\"px-3 mt-2 text-lg font-medium mb-2\">Details</h3>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>event</app-icon>\n                        <div>{{ booking.date | date: 'EEEE, dd LLLL y' }}</div>\n                    </div>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>schedule</app-icon>\n                        <div>{{ period }}</div>\n                    </div>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>map</app-icon>\n                        <div>\n                            {{ level?.display_name || level?.name }},\n                            {{ booking.asset_name || booking.asset_id }}\n                        </div>\n                    </div>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>place</app-icon>\n                        <div>\n                            {{ building?.display_name || building?.name }},\n                            {{ building?.address }}\n                        </div>\n                    </div>\n                </div>\n                <div\n                    map\n                    class=\"mt-4 sm:my-2 h-64 sm:h-48 relative border border-gray-200 dark:border-neutral-500 overflow-hidden rounded sm:bg-white m-2 flex-grow-[3] min-w-1/3 p-2 sm:w-[16rem]\"\n                >\n                    <interactive-map\n                        class=\"pointer-events-none\"\n                        [src]=\"level?.map_id\"\n                        [features]=\"features\"\n                        [options]=\"{ disable_pan: true, disable_zoom: true }\"\n                    ></interactive-map>\n                </div>\n            </div>\n            <button\n                mat-icon-button\n                mat-dialog-close\n                class=\"absolute top-2 left-2 bg-black/30 text-white\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n        <mat-menu #menu=\"matMenu\" xPosition=\"before\">\n            <!-- <button mat-menu-item mat-dialog-close class=\"flex items-center space-x-2 text-base\" (click)=\"edit.emit()\">\n                <app-icon>edit</app-icon>\n                <div>Edit booking</div>\n            </button> -->\n            <button\n                mat-menu-item\n                class=\"flex items-center space-x-2 text-base\"\n                (click)=\"remove.emit()\"\n            >\n                <app-icon>delete</app-icon>\n                <div>Delete booking</div>\n            </button>\n        </mat-menu>\n    `,\n    styles: [``],\n})\nexport class BookingDetailsModalComponent {\n    @Output() public edit = new EventEmitter();\n    @Output() public remove = new EventEmitter();\n    public readonly booking = this._booking;\n    public checking_in = false;\n    public readonly features = [\n        {\n            location: this.booking?.asset_id,\n            content: MapPinComponent,\n        },\n    ];\n\n    public get level() {\n        return this._org.levelWithID(this.booking?.zones || []);\n    }\n\n    public get building() {\n        return this._org.buildings.find((bld) =>\n            (this.booking?.zones || []).includes(bld.id)\n        );\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _booking: Booking,\n        private _org: OrganisationService\n    ) {}\n\n    public get period() {\n        const start = this.booking?.date || Date.now();\n        const duration = this.booking?.duration || 60;\n        const end = addMinutes(start, duration);\n        const dur = formatDuration({\n            hours: Math.floor(duration / 60),\n            minutes: duration % 60,\n        })\n            .replace(' hour', 'hr')\n            .replace(' minute', 'min');\n        return `${format(start, 'h:mm a')} - ${format(end, 'h:mm a')} (${dur})`;\n    }\n\n    public async toggleCheckedIn() {\n        this.checking_in = true;\n        await checkinBooking(this.booking.id, !this.booking.checked_in);\n        (this.booking as any).checked_in = !this.booking.checked_in;\n        notifySuccess(\n            `Successfully ${\n                this.booking.checked_in ? 'checked in' : 'checked out'\n            }`\n        );\n        this.checking_in = false;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Event, NavigationEnd, Router } from '@angular/router';\nimport {\n    BaseClass,\n    currentUser,\n    flatten,\n    getInvalidFields,\n    notifyError,\n    openConfirmModal,\n    SettingsService,\n    unique,\n} from '@placeos/common';\nimport { listChildMetadata, PlaceZone } from '@placeos/ts-client';\nimport { format, getUnixTime, addMinutes, set } from 'date-fns';\nimport { BehaviorSubject, combineLatest, Observable, of } from 'rxjs';\nimport {\n    debounceTime,\n    distinctUntilKeyChanged,\n    filter,\n    first,\n    map,\n    shareReplay,\n    switchMap,\n    take,\n    tap,\n} from 'rxjs/operators';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { User } from 'libs/users/src/lib/user.class';\nimport { Booking, BookingType } from './booking.class';\nimport { generateBookingForm } from './booking.utilities';\nimport { queryBookings, saveBooking } from './bookings.fn';\nimport { DeskQuestionsModalComponent } from './desk-questions-modal.component';\nimport { findNearbyFeature } from './booking.utilities';\nimport { PaymentsService } from 'libs/payments/src/lib/payments.service';\nimport { BookingLinkModalComponent } from './booking-link-modal.component';\n\nexport type BookingFlowView = 'form' | 'map' | 'confirm' | 'success';\n\nconst BOOKING_URLS = [\n    'book/desks',\n    'book/parking',\n    'book/newdesk',\n    'book/new-parking',\n];\n\nexport interface BookingFlowOptions {\n    /** Type of booking being made */\n    type: BookingType;\n    /** Zone to check available */\n    zone_id?: string;\n    /** List of features that the asset should associate */\n    features?: string[];\n    /** Whether booking is for a group */\n    group?: boolean;\n    /** Recurrence Pattern */\n    pattern?: 'none' | 'daily' | 'weekly' | 'monthly';\n    /** Recurrence ending */\n    recurr_end?: number;\n    /** List of group members to book for */\n    members?: User[];\n    /** Whether to only show favourite rooms */\n    show_fav?: boolean;\n}\n\nexport interface BookingAsset {\n    id: string;\n    map_id: string;\n    name: string;\n    bookable: boolean;\n    zone?: PlaceZone;\n    features: string[];\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class BookingFormService extends BaseClass {\n    private _view = new BehaviorSubject<BookingFlowView>('form');\n    private _options = new BehaviorSubject<BookingFlowOptions>({\n        type: 'desk',\n    });\n    private _form = new BehaviorSubject(generateBookingForm());\n    private _booking = new BehaviorSubject<Booking>(null);\n    private _loading = new BehaviorSubject<string>('');\n\n    public last_success: Booking = new Booking(\n        JSON.parse(\n            sessionStorage.getItem('PLACEOS.last_booked_booking') || '{}'\n        )\n    );\n    public readonly loading = this._loading.asObservable();\n    public readonly options = this._options.pipe(shareReplay(1));\n\n    public readonly assets: Observable<BookingAsset[]> = this.options.pipe(\n        distinctUntilKeyChanged('zone_id'),\n        switchMap(({ type }) => {\n            if (!this._org.building) return of([]);\n            switch (type) {\n                case 'desk':\n                    this._loading.next(`Loading desks...`);\n                    return listChildMetadata(this._org.building.id, {\n                        name: 'desks',\n                    }).pipe(\n                        map((data) =>\n                            flatten(\n                                data.map((_) =>\n                                    (_.metadata.desks?.details instanceof Array\n                                        ? _.metadata.desks?.details\n                                        : []\n                                    ).map((d) => ({ ...d, zone: _.zone }))\n                                )\n                            )\n                        )\n                    );\n            }\n            return of([]);\n        }),\n        tap(() => this._loading.next(``)),\n        shareReplay(1)\n    );\n\n    public readonly features: Observable<string[]> = this.assets.pipe(\n        map((assets) => {\n            const list: string[] = [];\n            for (const { features } of assets) {\n                features instanceof Array\n                    ? features.forEach((_) => list.push(_))\n                    : null;\n            }\n            return unique(list).sort((a, b) => a.localeCompare(b));\n        }),\n        shareReplay(1)\n    );\n\n    public readonly available_assets = combineLatest([\n        this.options,\n        this.assets,\n        this._form,\n    ]).pipe(\n        filter(\n            ([_, _1, form]) =>\n                form.getRawValue().date > 0 && form.getRawValue().duration > 0\n        ),\n        debounceTime(500),\n        tap(([{ type }]) =>\n            this._loading.next(`Checking ${type} availability...`)\n        ),\n        switchMap(([options, assets, form]) =>\n            queryBookings({\n                period_start: getUnixTime(form.getRawValue().date),\n                period_end: getUnixTime(\n                    addMinutes(\n                        form.getRawValue().date,\n                        form.getRawValue().duration || 24 * 60\n                    )\n                ),\n                type: options.type,\n                zones: options.zone_id,\n            }).pipe(\n                map((bookings) =>\n                    assets.filter(\n                        (asset) =>\n                            asset.bookable !== false &&\n                            (!options.features ||\n                                options.features?.every((_) =>\n                                    asset.features.includes(_)\n                                )) &&\n                            (!options.zone_id ||\n                                options.zone_id === asset.zone?.id ||\n                                options.zone_id === asset.zone?.parent_id) &&\n                            !bookings.find(\n                                (bkn) =>\n                                    bkn.asset_id === asset.id &&\n                                    bkn.status !== 'declined'\n                            )\n                    )\n                )\n            )\n        ),\n        tap(() => this._loading.next('')),\n        shareReplay(1)\n    );\n\n    public readonly grouped_availability = combineLatest([\n        this.options,\n        this.available_assets,\n    ]).pipe(\n        map(([options, assets]) => {\n            const groups = [];\n            const asset_list = [...assets].sort((a, b) =>\n                a.zone?.id?.localeCompare(b.zone?.id)\n            );\n            const members = options.members?.length\n                ? options.members\n                : [currentUser()];\n            while (asset_list.length) {\n                const group = [];\n                let asset = asset_list.pop();\n                while (group.length < members.length) {\n                    if (\n                        group.length &&\n                        !group.find((_) => _.zone?.id === asset.zone?.id)\n                    ) {\n                        break;\n                    }\n                    group.push(asset);\n                    asset = asset_list.pop();\n                }\n                if (group.length < members.length) continue;\n                groups.push(group);\n            }\n            return groups;\n        })\n    );\n\n    public get view() {\n        return this._view.getValue();\n    }\n\n    public get form() {\n        return this._form.getValue();\n    }\n\n    public get booking() {\n        return this._booking.getValue();\n    }\n\n    public newForm(booking: Booking = new Booking()) {\n        this._form.next(generateBookingForm(booking));\n        this.subscription(\n            'form_change',\n            this._form.getValue().valueChanges.subscribe(() => this.storeForm())\n        );\n        this._booking.next(booking);\n        this._options.next({ type: this._options.getValue().type });\n    }\n\n    constructor(\n        private _router: Router,\n        private _settings: SettingsService,\n        private _org: OrganisationService,\n        private _dialog: MatDialog,\n        private _payments: PaymentsService\n    ) {\n        super();\n        this.subscription(\n            'router.bookings',\n            this._router.events.subscribe((booking: Event) => {\n                if (\n                    booking instanceof NavigationEnd &&\n                    !BOOKING_URLS.find((_) => booking.url.includes(_))\n                ) {\n                    this.clearForm();\n                }\n            })\n        );\n        this._org.initialised\n            .pipe(first((_) => _))\n            .subscribe(() => this.setOptions({}));\n    }\n\n    public setView(value: BookingFlowView) {\n        this._view.next(value);\n    }\n\n    public setOptions(value: Partial<BookingFlowOptions>) {\n        this._options.next({ ...this._options.getValue(), ...value });\n    }\n\n    public setFeature(feature: string, enable: boolean) {\n        if (!feature?.length) return;\n        const features = this._options.getValue()?.features || [];\n        if (enable && !features.includes(feature)) features.push(feature);\n        if (!enable && features.includes(feature))\n            features.splice(\n                features.findIndex((e) => e === feature),\n                1\n            );\n        this.setOptions({ features });\n    }\n\n    public resetForm() {\n        if (!this._form.getValue()) this.newForm();\n        const booking = this._booking.getValue();\n        this._form.getValue().patchValue({\n            ...(booking || {}),\n            ...(booking?.extension_data || {}),\n        });\n        this._options.next({ type: this._options.getValue().type });\n    }\n\n    public clearForm() {\n        sessionStorage.removeItem('PLACEOS.booking_form');\n        sessionStorage.removeItem('PLACEOS.booking_form_options');\n        this.newForm();\n    }\n\n    public storeForm() {\n        sessionStorage.setItem(\n            'PLACEOS.booking_form',\n            JSON.stringify(this._form.getValue()?.getRawValue() || {})\n        );\n        sessionStorage.setItem(\n            'PLACEOS.booking_form_filters',\n            JSON.stringify(this._options.getValue() || {})\n        );\n    }\n\n    public loadForm() {\n        if (!this._form.getValue()) this.newForm();\n        this._form.getValue().patchValue({\n            ...JSON.parse(\n                sessionStorage.getItem('PLACEOS.booking_form') || '{}'\n            ),\n        });\n        this.setOptions({\n            zone_id: this._org.building?.id,\n            ...JSON.parse(\n                sessionStorage.getItem('PLACEOS.booking_form_filters') || '{}'\n            ),\n        });\n    }\n\n    public openBookingLinkModal(force: boolean = false) {\n        const form = this._form.getValue();\n        form.markAllAsTouched();\n        if (!form.valid && !force) return;\n        const event = new Booking({ ...this.booking, ...form.getRawValue() });\n        this._dialog.open(BookingLinkModalComponent, { data: event });\n    }\n\n    public async confirmPost() {\n        await this.checkQuestions();\n        const options = this._options.getValue();\n        const form = this._form.getValue();\n        const value = form.getRawValue();\n        let content = `Would you like to book the ${options.type} ${\n            value.asset_name\n        } for ${format(value.date, 'dd MMM yyyy')}${\n            value.duration < 12 * 60\n                ? ' at ' + format(value.date, 'h:mm a')\n                : ''\n        }`;\n        if (options.group) {\n            content = `${content}.<br>You group members will be assigned desks nearby your selected desk.`;\n        }\n        const details = await openConfirmModal(\n            {\n                title: `Book ${options.type}`,\n                content,\n                icon: { content: 'event_available' },\n            },\n            this._dialog\n        );\n        if (details?.reason !== 'done') throw 'User cancelled';\n        details.loading('Performing booking request...');\n        if (options.group) {\n            await this.postFormForGroup().catch((_) => {\n                notifyError(_);\n                details.close();\n                throw _;\n            });\n        } else\n            await this.postForm().catch((_) => {\n                notifyError(_);\n                details.close();\n                throw _;\n            });\n        details.close();\n    }\n\n    public async postForm(ignore_check = false) {\n        const form = this._form.getValue();\n        if (!form) throw 'No form for booking';\n        if (!form.valid)\n            throw `Some form fields are invalid. [${getInvalidFields(form).join(\n                ', '\n            )}]`;\n        form.patchValue({\n            booking_type:\n                form.getRawValue().booking_type ||\n                this._options.getValue().type,\n        });\n        const value = form.getRawValue();\n        if (!ignore_check) {\n            await this.checkResourceAvailable(\n                value,\n                this._options.getValue().type\n            );\n        }\n        if (value.duration >= 12 * 60 || value.all_day) {\n            form.patchValue({\n                date: set(value.date, { hours: 11, minutes: 59 }).valueOf(),\n                duration: 12 * 60,\n            });\n        }\n        if (this._payments.payment_module) {\n            const receipt = await this._payments.makePayment({\n                type: this._options.getValue().type,\n                resource_name: value.asset_name,\n                date: value.date,\n                duration: value.duration,\n                all_day: value.all_day,\n            });\n            if (!receipt?.success) return;\n            (value as any).extension_data = {\n                invoice: receipt,\n                invoice_id: receipt.invoice_id,\n            };\n        }\n        this._loading.next('Saving booking');\n        const result = await saveBooking(\n            new Booking({\n                ...this._options.getValue(),\n                ...value,\n                approved: !!this._settings.get('app.bookings.no_approval'),\n            })\n        ).toPromise();\n        this._loading.next('');\n        const { booking_type } = value;\n        this.clearForm();\n        form?.patchValue({ booking_type });\n        this.last_success = result;\n        sessionStorage.setItem(\n            'PLACEOS.last_booked_booking',\n            JSON.stringify(result)\n        );\n        this.setView('success');\n        return result;\n    }\n\n    public async postFormForGroup() {\n        const { members, group, type } = this._options.getValue();\n        if (!group) throw 'No group available to book for';\n        const extra_members = members.filter(\n            (_) => _.email !== currentUser().email\n        );\n        if (extra_members.length <= 0)\n            throw 'No members in your group to book for.';\n        const form = this._form.getValue().value;\n        const asset_list = await this.available_assets\n            .pipe(take(1))\n            .toPromise();\n        const active_asset = asset_list.find(\n            (_) => _.id === form.asset_id || _.map_id === form.asset_id\n        );\n        const level = this._org.levelWithID([active_asset.zone?.id]);\n        const assets = [\n            active_asset,\n            ...(await this._getNearbyResources(\n                level.map_id,\n                form.asset_id,\n                asset_list,\n                extra_members.length\n            )),\n        ];\n        const group_members = [currentUser(), ...extra_members];\n        await Promise.all(\n            group_members.map((_, idx) =>\n                this.checkResourceAvailable(\n                    {\n                        ...form,\n                        asset_id: assets[idx].map_id || assets[idx].id,\n                        user_email: _.email,\n                    },\n                    type\n                )\n            )\n        );\n        for (let i = 0; i < group_members.length; i++) {\n            const user = group_members[i];\n            const asset = assets[i];\n            this._form.getValue().patchValue({\n                ...form,\n                user: user as any,\n                asset_id: asset?.id,\n                asset_name: asset.name,\n                map_id: asset?.map_id || asset?.id,\n                description: asset.name,\n                zones: asset.zone\n                    ? [asset.zone?.parent_id, asset.zone?.id]\n                    : [],\n            });\n            this.postForm(true);\n        }\n    }\n\n    private async checkQuestions() {\n        if (this._settings.get('app.desks.ignore_questions') !== false) return;\n        const ref = this._dialog.open(DeskQuestionsModalComponent);\n        const result = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (result?.reason !== 'done') throw 'User cancelled';\n        const form = ref.componentInstance.form.getRawValue();\n        for (const key in form) {\n            if (form[key]) throw 'User failed questionaire';\n        }\n        ref.close();\n    }\n\n    /** Check if the given resource is available for the selected user to book */\n    private async checkResourceAvailable(\n        { asset_id, date, duration, user_email, all_day }: Partial<Booking>,\n        type: BookingType\n    ) {\n        duration = all_day ? 12 * 60 : duration || 60;\n        const bookings = await queryBookings({\n            period_start: getUnixTime(date),\n            period_end: getUnixTime(date + duration * 60 * 1000),\n            type,\n        }).toPromise();\n        if (bookings.find((_) => _.asset_id === asset_id)) {\n            if (asset_id.includes('@')) {\n                throw `${asset_id} already has an invite for the selected time`;\n            } else {\n                throw `${asset_id} is not available at the selected time`;\n            }\n        }\n        const allowed_bookings =\n            this._settings.get(`app.booking.allowed_daily_${type}_count`) ?? 1;\n        if (\n            allowed_bookings > 0 &&\n            bookings.filter(\n                (_) =>\n                    _.user_email === (user_email || currentUser()?.email) &&\n                    _.status !== 'declined'\n            ).length >= allowed_bookings\n        ) {\n            const current = user_email === currentUser()?.email;\n            throw `${current ? 'You' : user_email} already ${\n                current ? 'have' : 'has'\n            } a ${type} booked`;\n        }\n        return true;\n    }\n\n    private async _getNearbyResources(\n        map_url: string,\n        id: string,\n        assets: BookingAsset[],\n        count: number\n    ): Promise<BookingAsset[]> {\n        const nearby_assets = [];\n        let asset_list = assets.filter((_) => _.id !== id && _.map_id !== id);\n        for (let i = 0; i < count; i++) {\n            const item = await findNearbyFeature(\n                map_url,\n                id,\n                asset_list.map((_) => _.map_id || _.id)\n            );\n            if (item) {\n                nearby_assets.push(\n                    assets.find((_) => _.id === item || _.map_id === item)\n                );\n                asset_list = asset_list.filter(\n                    (_) => _.id !== item && _.map_id !== item\n                );\n            }\n        }\n        return nearby_assets;\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport {\n    generateCalendarFileLink,\n    generateGoogleCalendarLink,\n    generateMicrosoftCalendarLink,\n} from 'libs/common/src/lib/calendar-links';\nimport { Booking } from './booking.class';\n\n@Component({\n    selector: 'booking-link-modal',\n    template: `\n        <div class=\"p-4 w-full pb-2\">\n            Add event to your calendar\n        </div>\n        <div class=\"flex flex-col items-center space-y-4 p-4 relative\">\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"outlook_link | sanitize:'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n            >\n                <img src=\"assets/icons/outlook.svg\" class=\"w-6\" />\n                <span>Create in Outlook</span>\n            </a>\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"google_link | sanitize:'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n            >\n                <img src=\"assets/icons/gcal.svg\" class=\"w-6\" />\n                <span>Create in Google Calendar</span>\n            </a>\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"ical_link | safe:'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n            >\n                <app-icon class=\"text-xl\">download</app-icon>\n                <span>Download iCal File</span>\n            </a>\n        </div>\n        <button mat-icon-button mat-dialog-close class=\"absolute top-2 right-0\">\n            <app-icon>close</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n        `,\n    ],\n})\nexport class BookingLinkModalComponent {\n    public readonly outlook_link = generateMicrosoftCalendarLink(\n        this._event as any\n    );\n    public readonly google_link = generateGoogleCalendarLink(\n        this._event as any\n    );\n    public readonly ical_link = generateCalendarFileLink(this._event as any);\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _event: Booking,\n        private _settings: SettingsService\n    ) {}\n}\n","import { capitalizeFirstLetter, removeEmptyFields } from '@placeos/common';\nimport { User } from 'libs/users/src/lib/user.class';\nimport {\n    addHours,\n    addMinutes,\n    differenceInMinutes,\n    getUnixTime,\n    isAfter,\n    isSameDay,\n    roundToNearestMinutes,\n} from 'date-fns';\n\nexport type BookingType = 'desk' | 'parking' | 'locker' | 'room' | 'visitor' | 'asset-request' | 'staff' | 'wfh-setting' | '';\nconst IGNORE_EXT_KEYS = ['user', 'booked_by', 'resources', 'assets']; \n\n/** General purpose booking class */\nexport class Booking {\n    /** Unique Identifier of the object */\n    public readonly id: string;\n    /** Unix epoch for the start time of the booking in seconds */\n    public readonly booking_start: number;\n    /** Unix epoch for the start time of the booking in seconds */\n    public readonly booking_end: number;\n    /** ID of the user who owns the booking */\n    public readonly booked_by_id: string;\n    /** Email of the user who owns the booking */\n    public readonly booked_by_email: string;\n    /** Display name of the user who owns the booking */\n    public readonly booked_by_name: string;\n    /** ID of the user who owns the booking */\n    public readonly user_id: string;\n    /** Email of the user who owns the booking */\n    public readonly user_email: string;\n    /** Display name of the user who owns the booking */\n    public readonly user_name: string;\n    /** ID of an associated calendar event */\n    public readonly event_id?: string;\n    /** Identifier of the physical asset assocated with the booking */\n    public readonly asset_id: string;\n    /** Name of the physical asset assocated with the booking */\n    public readonly asset_name: string;\n    /** Zones associated with the asset ID */\n    public readonly zones: string[];\n    /** Type of booking */\n    public readonly booking_type: BookingType;\n    /** Start time of booking in ms */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** Whether it is an all day booking */\n    public readonly all_day: boolean;\n    /** Timezone of the booking */\n    public readonly timezone: string;\n    /** Title of the booking */\n    public readonly title: string;\n    /** Description */\n    public readonly description: string;\n    /** Whether user checked in */\n    public readonly checked_in: boolean;\n    /** Whether booking is rejected */\n    public readonly rejected: boolean;\n    /** Whether booking is approved */\n    public readonly approved: boolean;\n    /** Id of the approver */\n    public readonly approver_id: string;\n    /** Email of the approver */\n    public readonly approver_email: string;\n    /** Name of the approver */\n    public readonly approver_name: string;\n    /** Extra non-standard metadata associated with the booking */\n    public readonly extension_data: Record<string, any>;\n    /** Default type */\n    public readonly type: string;\n    /** Default type */\n    public readonly access: boolean;\n    /** Status of the booking */\n    public readonly status: 'declined' | 'approved' | 'tentative';\n    /** New deleted field */\n    public readonly deleted: boolean;\n    /** List of attendees for the booking */\n    public readonly attendees: User[];\n\n    constructor(data: Partial<Booking> = {}) {\n        this.id = data.id || '';\n        this.asset_id = data.asset_id || '';\n        this.asset_name = data.asset_name || data.extension_data?.asset_name || data.extension_data?.name || data.description || '';\n        this.zones = data.zones || [];\n        this.booking_start =\n            data.date / 1000 ||\n            data.booking_start ||\n            getUnixTime(\n                roundToNearestMinutes(addMinutes(Date.now(), 5), {\n                    nearestTo: 5,\n                })\n            );\n        this.booking_end =\n            data.date / 1000 + data.duration * 60 ||\n            data.booking_end ||\n            getUnixTime(\n                addMinutes(this.booking_start * 1000, data.duration || 60)\n            );\n        this.booking_type = data.booking_type || '';\n        this.type = data.type || data.booking_type || 'booking';\n        this.date = data.date || this.booking_start * 1000;\n        this.duration =\n            data.duration ||\n            Math.abs(\n                differenceInMinutes(\n                    this.booking_start * 1000,\n                    this.booking_end * 1000\n                )\n            );\n        this.timezone =\n            data.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone;\n        this.user_email = data.user_email || '';\n        this.user_id = data.user_id || '';\n        this.user_name = data.user_name || '';\n        this.title = data.title || this.booking_type ? `${capitalizeFirstLetter(this.booking_type)} Booking` : '';\n        this.description = data.description || '';\n        this.checked_in = !!data.checked_in;\n        this.rejected = !!data.rejected;\n        this.approved = !!data.approved;\n        this.deleted = !!data.deleted;\n        this.booked_by_id = data.booked_by_id || '';\n        this.booked_by_name = data.booked_by_name || '';\n        this.booked_by_email = data.booked_by_email || '';\n        this.approver_id = data.approver_id || '';\n        this.approver_email = data.approver_email || '';\n        this.approver_name = data.approver_name || '';\n        this.extension_data = data.extension_data || {};\n        this.access = !!data.extension_data?.access;\n        this.event_id = data.event_id;\n        this.attendees = data.attendees || [];\n        this.all_day = data.all_day ?? this.duration > 12 * 60;\n        this.status = this.rejected\n            ? 'declined'\n            : this.approved\n            ? 'approved'\n            : 'tentative';\n        for (const key in data) {\n            if (!(key in this) && !IGNORE_EXT_KEYS.includes(key) && data[key]) {\n                this.extension_data[key] =\n                    data[key] || this.extension_data[key];\n            }\n        }\n    }\n\n    public toJSON(this: Booking): Partial<Booking> {\n        const data = { ...this };\n        if (!this.id) delete data.id;\n        delete data.date;\n        delete data.duration;\n        removeEmptyFields(data);\n        return data;\n    }\n\n    public get location(): string {\n        return this.description;\n    }\n\n    /** Whether the booking occurs today */\n    public get is_today(): boolean {\n        return isSameDay(this.date, new Date());\n    }\n\n    /** Whether booking is done */\n    public get is_done(): boolean {\n        const start = new Date();\n        const end = this.all_day\n            ? addHours(this.date, 24)\n            : addMinutes(this.date, this.duration);\n        return isAfter(start, end);\n    }\n}\n","import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { currentUser } from '@placeos/common';\nimport { CalendarEvent } from 'libs/events/src/lib/event.class';\nimport { endInFuture } from 'libs/events/src/lib/validators';\nimport { createViewer, getViewer, Point, removeViewer } from '@placeos/svg-viewer';\nimport { Booking } from './booking.class';\n\nexport function generateBookingForm(booking: Booking = new Booking()) {\n    const form = new FormGroup({\n        id: new FormControl(booking.id || ''),\n        date: new FormControl(booking.date, [Validators.required]),\n        all_day: new FormControl(booking.all_day ?? false),\n        name: new FormControl(booking.extension_data.name || booking.asset_name || ''),\n        duration: new FormControl(booking.duration, [endInFuture]),\n        booking_type: new FormControl(booking.booking_type),\n        zones: new FormControl(booking.zones),\n        title: new FormControl(booking.title),\n        description: new FormControl(booking.description),\n        booking_asset: new FormControl(null),\n        resources: new FormControl([]),\n        company: new FormControl(''),\n        asset_id: new FormControl(booking.asset_id, [Validators.required]),\n        asset_name: new FormControl(booking.description),\n        assets: new FormControl(booking.extension_data?.assets || []),\n        attendees: new FormControl(booking.attendees || []),\n        map_id: new FormControl(booking.extension_data?.map_id),\n        user: new FormControl(currentUser()),\n        user_id: new FormControl(booking.user_id),\n        user_email: new FormControl(booking.user_email),\n        booked_by: new FormControl(currentUser()),\n        booked_by_id: new FormControl(booking.booked_by_id),\n        booked_by_email: new FormControl(booking.booked_by_email),\n        secondary_resource: new FormControl(booking.extension_data?.other_asset_type || booking.extension_data?.secondary_resource),\n    });\n    form.valueChanges.subscribe((v) => {\n        const user = v.user;\n        const booker = v.booked_by;\n        booker || user\n            ? form.patchValue(\n                  {\n                      user_id: user.id || booker.id,\n                      user_email: user.email || booker.id,\n                      booked_by_id: booker.id,\n                      booked_by_email: booker.email,\n                  },\n                  { emitEvent: false }\n              )\n            : '';\n    });\n    form.controls.all_day.valueChanges.subscribe((all_day) => {\n        if (all_day) form.controls.duration.disable();\n        else form.controls.duration.enable();\n    });\n    return form;\n}\n\nexport async function findNearbyFeature(map_url: string, centered_at: Point | string, desk_ids: string[] = []): Promise<string> {\n    const element = document.createElement('div');\n    element.style.position = 'absolute';\n    element.style.top = '-9999px';\n    element.style.width = '1000px';\n    element.style.height = '1000px';\n    document.body.appendChild(element);\n    const id = await createViewer({\n        url: map_url,\n        element\n    });\n    const viewer = getViewer(id);\n    const point = (typeof centered_at === 'string' ? viewer.mappings[centered_at] : centered_at) || { x: .5, y: .5 };\n    let dist = 10;\n    let closest = '';\n    for (const desk of desk_ids) {\n        const { x, y } = viewer.mappings[desk] || { x: 2, y: 2 };\n        const d = Math.sqrt((x - point.x) * (x - point.x) + (y - point.y) * (y - point.y));\n        if (d < dist) {\n            dist = d;\n            closest = desk;\n        }\n    }\n    document.body.removeChild(element);\n    removeViewer(id);\n    return closest;\n}\n\nexport function newBookingFromCalendarEvent(event: CalendarEvent) {\n    return new Booking({\n        id: event.id,\n        user_email: event.host,\n        asset_id: event.system?.id,\n        asset_name: event.system?.display_name || event.system?.name,\n        booking_type: 'room',\n        approved: event.status === 'approved',\n        extension_data: {\n            ...event\n        }\n    });\n}\n","import { del, get, patch, post, put } from '@placeos/ts-client';\nimport { Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { Booking, BookingType } from './booking.class';\nimport { GuestUser } from 'libs/users/src/lib/user.class';\n\nexport interface BookingsQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zones?: string;\n    /** User ID to filter bookings */\n    user?: string;\n    /** Email address to filter bookings */\n    email?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n    /** Category of booking */\n    type: BookingType;\n}\n\nconst BOOKINGS_ENDPOINT = `/api/staff/v1/bookings`;\n\n/**\n * List bookings\n * @param q Parameters to pass to the API request\n */\nexport function queryBookings(q: BookingsQueryParams): Observable<Booking[]> {\n    const query = toQueryString(q);\n    return get(`${BOOKINGS_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new Booking(item))),\n        catchError((_) => of([]))\n    );\n}\n\n/**\n * Get booking details\n * @param id ID of the booking to grab\n * @param q Parameters to pass to the API request\n */\nexport function showBooking(id: string) {\n    return get(`${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new Booking(item))\n    );\n}\n\n/**\n * Create new booking and add it to the database\n * @param data New booking fields\n */\nexport function createBooking(data: Partial<Booking>) {\n    return post(`${BOOKINGS_ENDPOINT}`, data).pipe(\n        map((item) => new Booking(item))\n    );\n}\n\n/**\n * Update an existing booking\n * @param id ID of the booking to update\n * @param data New values for booking fields\n * @param method HTTP verb to use with API request\n */\nexport function updateBooking(\n    id: string,\n    data: Partial<Booking>,\n    method: 'put' | 'patch' = 'patch'\n) {\n    return (method === 'patch' ? patch : put)(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`,\n        data\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Save changes to or create a booking\n * @param data State of the booking\n * @param q Parameters to pass to the API request\n */\nexport const saveBooking = (data: Partial<Booking>) =>\n    data.id ? updateBooking(data.id, data) : createBooking(data);\n\n/**\n * Remove booking from the database\n * @param id ID of the booking to remove\n * @param q Parameters to pass to the API request\n */\nexport function removeBooking(id: string) {\n    return del(`${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`, {\n        response_type: 'void',\n    });\n}\n\n/**\n * Set the approval state of the booking to approved\n * @param id ID of the booking to approve\n * @param system_id Associated system to approve\n */\nexport function approveBooking(id: string) {\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/approve`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the approval state of the booking to rejected\n * @param id ID of the booking to reject\n * @param system_id Associated system to reject\n */\nexport function rejectBooking(id: string) {\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/reject`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the checkin state of a booking\n * @param id ID of the booking to grab\n * @param state New checkin state of the booking\n */\nexport function checkinBooking(id: string, state: boolean) {\n    const query = toQueryString({ state });\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/check_in?${query}`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the checkin state of a booking\n * @param id ID of the booking to grab\n * @param state New checkin state of the booking\n */\nexport function checkinBookingAttendee(id: string, email: string, state: boolean) {\n    const query = toQueryString({ state });\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/guests/${encodeURIComponent(email)}/check_in?${query}`,\n        ''\n    ).pipe(map((item) => new GuestUser(item)));\n}\n\n/**\n * Filter list of resources based of the bookings found in the given query\n * @param asset_id_list List of resource IDs\n * @param query Booking query\n */\nexport function queryResourceAvailability(\n    asset_id_list: string[],\n    query: BookingsQueryParams,\n    ignore?: string\n): Observable<string[]> {\n    return queryBookings(query).pipe(\n        map((_) =>\n            asset_id_list.filter((id) => !_.find((b) => b.asset_id === id && (!ignore || ignore !== b.id)))\n        )\n    );\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\n\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatRadioModule } from '@angular/material/radio';\n\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\nimport { FormFieldsModule } from 'libs/form-fields/src/lib/form-fields.module';\n\nimport { BookingCardComponent } from './booking-card.component';\nimport { BookingDetailsModalComponent } from './booking-details-modal.component';\n\nimport { DeskConfirmModalComponent } from './desk-confirm-modal.component';\nimport { DeskQuestionsModalComponent } from './desk-questions-modal.component';\nimport { DeskDetailsComponent } from './desk-select-modal/desk-details.component';\nimport { DeskFiltersDisplayComponent } from './desk-select-modal/desk-filters-display.component';\nimport { DeskFiltersComponent } from './desk-select-modal/desk-filters.component';\nimport { DeskListComponent } from './desk-select-modal/desk-list.component';\nimport { DeskMapComponent } from './desk-select-modal/desk-map.component';\nimport { DeskSelectModalComponent } from './desk-select-modal/desk-select-modal.component';\nimport { InviteVisitorFormComponent } from './invite-visitor-form.component';\nimport { ParkingSpaceDetailsComponent } from './parking-select-modal/parking-details.component';\nimport { ParkingSpaceFiltersDisplayComponent } from './parking-select-modal/parking-filters-display.component';\nimport { ParkingSpaceFiltersComponent } from './parking-select-modal/parking-filters.component';\nimport { ParkingSpaceListComponent } from './parking-select-modal/parking-list.component';\nimport { ParkingSpaceLocationPinComponent } from './parking-select-modal/parking-location-pin.component';\nimport { ParkingSpaceSelectMapComponent } from './parking-select-modal/parking-map.component';\nimport { ParkingSpaceSelectModalComponent } from './parking-select-modal/parking-select-modal.component';\nimport { ParkingSpaceListFieldComponent } from './parking-space-list-field.component';\nimport { DeskListFieldComponent } from './desk-list-field.component';\nimport { BookingLinkModalComponent } from './booking-link-modal.component';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nconst COMPONENTS = [\n    DeskQuestionsModalComponent,\n    DeskConfirmModalComponent,\n    InviteVisitorFormComponent,\n    BookingDetailsModalComponent,\n    BookingCardComponent,\n    BookingLinkModalComponent,\n\n    ParkingSpaceSelectModalComponent,\n    ParkingSpaceFiltersComponent,\n    ParkingSpaceFiltersDisplayComponent,\n    ParkingSpaceListComponent,\n    ParkingSpaceLocationPinComponent,\n    ParkingSpaceSelectMapComponent,\n    ParkingSpaceDetailsComponent,\n    ParkingSpaceListFieldComponent,\n\n    DeskSelectModalComponent,\n    DeskDetailsComponent,\n    DeskFiltersComponent,\n    DeskFiltersDisplayComponent,\n    DeskListComponent,\n    DeskMapComponent,\n    DeskListFieldComponent\n];\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatRadioModule,\n        MatInputModule,\n        MatFormFieldModule,\n        MatDatepickerModule,\n        MatButtonModule,\n        MatDialogModule,\n        MatProgressSpinnerModule,\n        MatCheckboxModule,\n        MatAutocompleteModule,\n        FormFieldsModule,\n        ComponentsModule\n    ],\n    providers: [ReactiveFormsModule],\n    exports: [...COMPONENTS],\n})\nexport class SharedBookingsModule {}\n","import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { DialogEvent, SettingsService } from '@placeos/common';\nimport { BuildingLevel, Desk } from '@placeos/organisation';\nimport { User } from '@placeos/users';\n\nexport interface DeskConfirmModalData {\n    host: User;\n    desks: Desk[];\n    date: number;\n    reason: string;\n    level: BuildingLevel;\n    can_set_date: boolean;\n}\n\n@Component({\n    selector: 'desk-flow-confirm-modal-component',\n    template: `\n        <header>\n            <h2>Confirm Booking</h2>\n            <div class=\"flex-1\"></div>\n            <button mat-icon-button mat-dialog-close *ngIf=\"!loading\">\n                <i class=\"material-icons\">close</i>\n            </button>\n        </header>\n        <ng-container *ngIf=\"!loading; else load_state\">\n            <main class=\"p-4\">\n                <div host class=\"flex flex-col\" *ngIf=\"can_set_host\">\n                    <label>Host</label>\n                    <a-user-search-field\n                        [(ngModel)]=\"host\"\n                    ></a-user-search-field>\n                </div>\n                <div date class=\"mb-4\">\n                    <label>Date</label>\n                    <div *ngIf=\"!can_set_date\">\n                        {{ date | date: 'mediumDate' }}\n                    </div>\n                    <a-date-field\n                        *ngIf=\"can_set_date\"\n                        [(ngModel)]=\"date\"\n                    ></a-date-field>\n                </div>\n                <div reason class=\"flex flex-col mb-4\" *ngIf=\"!hide_reason\">\n                    <label>Reason</label>\n                    <mat-form-field appearance=\"outline\">\n                        <input\n                            matInput\n                            [(ngModel)]=\"reason\"\n                            placeholder=\"Reason\"\n                        />\n                    </mat-form-field>\n                </div>\n                <p>\n                    Your desk{{ desks.length === 1 ? '' : 's' }} will be\n                    {{ desk_list }} on\n                    {{ level?.display_name || level?.name }}\n                </p>\n            </main>\n            <footer class=\"flex items-center justify-center p-2\">\n                <button mat-button (click)=\"confirm()\">Confirm</button>\n            </footer>\n        </ng-container>\n        <ng-template #load_state>\n            <main load class=\"flex flex-col p-12 items-center justify-center\">\n                <mat-spinner [diameter]=\"48\" class=\"mb-4\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                width: 24rem;\n                max-width: calc(100vw - 4.5rem);\n            }\n        `,\n    ],\n})\nexport class DeskConfirmModalComponent {\n    @Output() public event = new EventEmitter<DialogEvent>();\n\n    public readonly desks = this._data.desks || [];\n\n    public date = this._data.date;\n    public host = this._data.host;\n\n    public readonly can_set_date = this._data.can_set_date;\n\n    public reason = this._data.reason;\n\n    public readonly level = this._data.level;\n\n    public loading: string;\n\n    public get desk_list() {\n        return this.desks.map((_) => _.name).join(', ');\n    }\n\n    public get hide_reason() {\n        return !!this._settings.get('app.desks.hide_reason');\n    }\n\n    public get can_set_host() {\n        return !!this._settings.get('app.desks.can_book_for_others');\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: DeskConfirmModalData,\n        private _settings: SettingsService\n    ) {}\n\n    public confirm() {\n        this.loading = 'Requesting desk booking...';\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import { Component, forwardRef, Input } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport { BookingAsset } from './booking-form.service';\nimport {\n    DeskSelectModalComponent,\n    FAV_DESK_KEY,\n} from './desk-select-modal/desk-select-modal.component';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: `desk-list-field`,\n    template: `\n        <div list class=\"space-y-2\">\n            <div\n                desk\n                class=\"relative p-2 rounded-lg w-full flex items-center shadow border border-gray-200\"\n                *ngFor=\"let space of items\"\n            >\n                <div *ngIf=\"features?.length\" class=\"flex flex-col\">\n                    <label for=\"title\">Type</label>\n                    <div features class=\"flex items-center flex-wrap space-x-2\">\n                        <mat-checkbox\n                            *ngFor=\"let opt of features\"\n                            [ngModel]=\"(selected_features || []).includes(opt)\"\n                            (ngModelChange)=\"setFeature(opt, $event)\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        >\n                            {{ opt }}\n                        </mat-checkbox>\n                    </div>\n                </div>\n                <div\n                    class=\"w-24 h-24 rounded-xl bg-black/20 mr-4 overflow-hidden\"\n                >\n                    <img\n                        *ngIf=\"space.images?.length\"\n                        [src]=\"space.images[0]\"\n                        class=\"min-h-full object-cover\"\n                    />\n                </div>\n                <div class=\"space-y-2 pb-4\">\n                    <div class=\"font-medium\">\n                        {{ space.name || 'Desk' }}\n                    </div>\n                    <div class=\"flex items-center text-sm space-x-2\">\n                        <app-icon class=\"text-blue-500\">place</app-icon>\n                        <p>{{ space.location }}</p>\n                    </div>\n                    <div class=\"flex items-center text-sm space-x-2\">\n                        <app-icon class=\"text-blue-500\">people</app-icon>\n                        <p>\n                            {{ space.capacity < 1 ? 2 : space.capacity }} People\n                        </p>\n                    </div>\n                    <div\n                        class=\"absolute bottom-0 right-0 flex items-center justify-end text-xs\"\n                    >\n                        <button\n                            mat-button\n                            edit-desk\n                            class=\"clear\"\n                            (click)=\"changeResources(space)\"\n                        >\n                            <div class=\"flex items-center space-x-2\">\n                                <app-icon>edit</app-icon>\n                                Change\n                            </div>\n                        </button>\n                        <button\n                            mat-button\n                            remove-desk\n                            class=\"clear\"\n                            (click)=\"removeResource(space)\"\n                        >\n                            <div class=\"flex items-center space-x-2\">\n                                <app-icon>close</app-icon>\n                                Remove\n                            </div>\n                        </button>\n                    </div>\n                </div>\n                <button\n                    mat-icon-button\n                    fav\n                    class=\"absolute top-1 right-1\"\n                    [class.text-blue-400]=\"favorites.includes(asset?.id)\"\n                    (click)=\"toggleFavourite(asset)\"\n                >\n                    <app-icon>{{\n                        favorites.includes(asset?.id)\n                            ? 'favorite'\n                            : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </div>\n        </div>\n        <button\n            mat-button\n            add-desk\n            class=\"w-full inverse mt-2\"\n            (click)=\"changeResources()\"\n        >\n            <div class=\"flex items-center justify-center space-x-2\">\n                <app-icon>search</app-icon>\n                <span>Add Desk</span>\n            </div>\n        </button>\n        <div class=\"flex items-center flex-wrap sm:space-x-2 mb-2\">\n            <div class=\"flex-1 min-w-[256px] space-y-2\"></div>\n        </div>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DeskListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DeskListFieldComponent implements ControlValueAccessor {\n    @Input() public features: string[] = [];\n    public room_size = 3;\n    public items: BookingAsset[] = [];\n    public disabled = false;\n    public selected_features: string[] = [];\n\n    private _onChange: (_: BookingAsset[]) => void;\n    private _onTouch: (_: BookingAsset[]) => void;\n\n    public get favorites() {\n        return this._settings.get<string[]>(FAV_DESK_KEY) || EMPTY_FAVS;\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {}\n\n    /** Add or edit selected items */\n    public changeResources() {\n        const ref = this._dialog.open(DeskSelectModalComponent, {\n            data: {\n                items: this.items,\n                options: { capacity: this.room_size },\n            },\n        });\n        ref.afterClosed().subscribe((items?: BookingAsset[]) => {\n            if (!items) items = ref.componentInstance.selected;\n            this.setValue(items);\n        });\n    }\n\n    /** Remove the selected space from the list */\n    public removeResource(space: BookingAsset) {\n        this.setValue(this.items.filter((_) => _.id !== space.id));\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: BookingAsset[]) {\n        this.items = new_value;\n        if (this._onChange) this._onChange(this.items);\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: BookingAsset[]) {\n        this.items = value || [];\n    }\n\n    /* istanbul ignore next */\n    public readonly registerOnChange = (fn: (_: BookingAsset[]) => void) =>\n        (this._onChange = fn);\n    /* istanbul ignore next */\n    public readonly registerOnTouched = (fn: (_: BookingAsset[]) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n\n    public toggleFavourite(space: BookingAsset) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(space.id);\n        if (new_state) {\n            this._settings.saveUserSetting(FAV_DESK_KEY, [\n                ...fav_list,\n                space.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                FAV_DESK_KEY,\n                fav_list.filter((_) => _ !== space.id)\n            );\n        }\n    }\n}\n","import { Component, EventEmitter, OnInit, Output } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { DialogEvent, notifyError } from '@placeos/common';\n\n@Component({\n    selector: 'desk-question-modal',\n    template: `\n        <div *ngIf=\"!failure; else fail_state\" class=\"relative\">\n            <h2 class=\"p-4 text-xl\">COVID-19 Questionnaire</h2>\n            <main class=\"p-4\" [formGroup]=\"form\">\n                <div class=\"flex flex-col mb-4\">\n                    <label>\n                        Have you travelled overseas within the last 14\n                        days?<span>*</span>\n                    </label>\n                    <mat-radio-group\n                        formControlName=\"travelled\"\n                        class=\"space-x-2\"\n                    >\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n                <div class=\"flex flex-col mb-4\">\n                    <label>\n                        Are you unwell or experiencing any cold or flu-like\n                        symptoms?<span>*</span>\n                    </label>\n                    <mat-radio-group formControlName=\"unwell\" class=\"space-x-2\">\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label>\n                        Have you had contact with anyone with suspected\n                        COVID-19?<span>*</span>\n                    </label>\n                    <mat-radio-group\n                        formControlName=\"contact\"\n                        class=\"space-x-2\"\n                    >\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n            </main>\n            <footer class=\"flex justify-center items-center p-2\">\n                <button mat-button (click)=\"submit()\">Submit</button>\n            </footer>\n            <button close mat-icon-button mat-dialog-close>\n                <i class=\"material-icons\">close</i>\n            </button>\n        </div>\n        <ng-template #fail_state>\n            <main failure class=\"pt-8 relative\">\n                <p class=\"p-4\">\n                    Your request to work from the office has been rejected based\n                    on your response to the compulsory Covid-19 questions.\n                    Please feel free to submit a new request when circumstances\n                    change in a way that changes your answer to the questions.\n                </p>\n                <button close mat-icon-button mat-dialog-close>\n                    <i class=\"material-icons\">close</i>\n                </button>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                width: 24rem;\n                max-width: calc(100vw - 4.5rem);\n            }\n\n            [close] {\n                position: absolute;\n                top: 0.5rem;\n                right: 0.5rem;\n            }\n        `,\n    ],\n})\nexport class DeskQuestionsModalComponent {\n    @Output() public event = new EventEmitter<DialogEvent>();\n\n    public form = new FormGroup({\n        travelled: new FormControl(false),\n        unwell: new FormControl(false),\n        contact: new FormControl(false),\n    });\n    public failure: boolean;\n\n    public submit() {\n        this.form.markAllAsTouched();if (\n            Object.keys(this.form.value).find(\n                (key) =>\n                    this.form.value[key] === true ||\n                    this.form.value[key] === 'true'\n            )\n        ) {\n            this.failure = true;\n            return;\n        }\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { ViewerFeature } from '@placeos/svg-viewer';\n\nimport { MapPinComponent } from 'libs/components/src/lib/map-pin.component';\nimport { BookingAsset } from '../booking-form.service';\n\n@Component({\n    selector: 'desk-details',\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 30%;\n                min-width: 20rem;\n                height: 100%;\n                min-height: 65vh;\n                background: white;\n            }\n        `,\n    ],\n    template: `\n        <ng-container *ngIf=\"desk; else emptyState\">\n            <div image class=\"relative w-full h-64 sm:h-40 bg-black/20\">\n                <image-carousel\n                    [images]=\"desk.images\"\n                    class=\"absolute inset-0\"\n                ></image-carousel>\n                <button\n                    mat-icon-button\n                    close\n                    (click)=\"close.emit()\"\n                    class=\"absolute top-2 left-2 bg-black/40 sm:hidden text-white\"\n                >\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <button\n                    mat-icon-button\n                    fav\n                    [class.text-white]=\"!fav\"\n                    [class.text-blue-400]=\"fav\"\n                    (click)=\"toggleFav.emit()\"\n                    class=\"absolute top-2 right-2 bg-black/40\"\n                >\n                    <app-icon>{{\n                        fav ? 'favorite' : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </div>\n            <div class=\"p-2 space-y-2 flex-1 h-[calc(100%-19.75rem)] overflow-auto\">\n                <section actions class=\"z-0 pb-2 border-b\">\n                    <h2 class=\"text-xl font-medium mb-2 mt-4\">\n                        {{ desk.display_name || desk.name || desk.id }}\n                    </h2>\n                </section>\n                <section details class=\"space-y-2 pb-2 border-b dark:border-neutral-500\">\n                    <h2 class=\"text-xl font-medium\">Details</h2>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>person</app-icon>\n                        <p>Single desk</p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>desk</app-icon>\n                        <p>\n                            {{ desk.display_name || desk.name || desk.id }}\n                        </p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>place</app-icon>\n                        <p>{{ desk.zone?.display_name || desk.zone?.name }}</p>\n                    </div>\n                </section>\n                <section\n                    facilities\n                    *ngIf=\"desk.features?.length\"\n                    class=\"space-y-2 pb-2 border-b dark:border-neutral-500\"\n                >\n                    <h2 class=\"text-xl font-medium\">Facilities</h2>\n                    <div\n                        *ngFor=\"let feat of desk.features || []\"\n                        class=\"flex items-center flex-wrap space-x-2\"\n                    >\n                        <div for=\"feat\" class=\"flex-1 w-1/2\">{{ feat }}</div>\n                    </div>\n                </section>\n                <section\n                    map\n                    class=\"w-full mx-auto h-64 sm:h-48 relative border border-gray-200 dark:border-neutral-500 overflow-hidden rounded\"\n                >\n                    <interactive-map\n                        class=\"pointer-events-none\"\n                        [src]=\"map_url\"\n                        [features]=\"features\"\n                        [options]=\"{ disable_pan: true, disable_zoom: true }\"\n                    ></interactive-map>\n                </section>\n            </div>\n            <div class=\"p-2 border-t border-gray-200 dark:border-neutral-500 shadow sm:hidden\">\n                <button\n                    mat-button\n                    [class.inverse]=\"active\"\n                    class=\"w-full\"\n                    (click)=\"active = !active; activeChange.emit(active);\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <app-icon class=\"text-2xl\">{{\n                            active ? 'remove' : 'add'\n                        }}</app-icon>\n                        <p>\n                            {{\n                                active\n                                    ? 'Remove from booking'\n                                    : 'Add to booking'\n                            }}\n                        </p>\n                    </div>\n                </button>\n            </div>\n        </ng-container>\n        <ng-template #emptyState>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    Select a desk to view it's details\n                </p>\n            </div>\n        </ng-template>\n    `,\n})\nexport class DeskDetailsComponent {\n    @Input() public desk?: BookingAsset;\n    @Input() public fav: boolean = false;\n    @Input() public active: boolean = false;\n\n    @Output() public close = new EventEmitter<void>();\n    @Output() public toggleFav = new EventEmitter<void>();\n    @Output() public activeChange = new EventEmitter<void>();\n\n    public map_url = '';\n    public features: ViewerFeature[] = [];\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.desk && this.desk) {\n            this.updateFeature();\n        }\n    }\n\n    private updateFeature() {\n        this.map_url = this.desk.zone.map_id;\n        this.features = [\n            {\n                location: this.desk.map_id || this.desk.id,\n                content: MapPinComponent,\n            },\n        ];\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatBottomSheet } from '@angular/material/bottom-sheet';\nimport { BaseClass } from '@placeos/common';\n\nimport { DeskFiltersComponent } from './desk-filters.component';\nimport { BookingFormService } from '../booking-form.service';\n\n@Component({\n    selector: 'desk-filters-display',\n    styles: [\n        `\n            [filter-item] {\n                display: flex;\n                align-items: center;\n                padding: 0 1rem;\n                height: 2rem;\n                font-size: 0.875rem;\n                border: 1px solid rgba(0, 0, 0, 0.2);\n                border-radius: 1.25rem;\n                margin-right: 0.5rem;\n                margin-bottom: 0.5rem;\n            }\n\n            [filter-item]:hover {\n                background: rgba(0, 0, 0, 0.1);\n            }\n\n            [filter-item] > * + * {\n                margin-left: 0.5rem;\n            }\n        `,\n    ],\n    template: `\n        <section\n            actions\n            class=\"sm:hidden space-x-2 flex flex-row items-center p-2\"\n        >\n            <button\n                mat-button\n                filters\n                class=\"flex-1 w-1/2\"\n                (click)=\"editFilter()\"\n            >\n                Filters\n            </button>\n            <div class=\"flex items-center\">\n                <button\n                    mat-button\n                    map\n                    class=\"rounded-l rounded-r-none\"\n                    [class.inverse]=\"view !== 'map'\"\n                    (click)=\"view = 'map'; viewChange.emit(view)\"\n                >\n                    Map\n                </button>\n                <button\n                    mat-button\n                    list\n                    class=\"rounded-r rounded-l-none\"\n                    [class.inverse]=\"view !== 'list'\"\n                    (click)=\"view = 'list'; viewChange.emit(view)\"\n                >\n                    List\n                </button>\n            </div>\n        </section>\n        <section filters class=\"flex items-center flex-wrap p-2\">\n            <!-- TODO: filter chips -->\n            <div filter-item date>{{ start | date: 'mediumDate' }}</div>\n            <div filter-item time>\n                {{ start | date: 'shortTime' }} &mdash;\n                {{ end | date: 'shortTime' }}\n            </div>\n            <div\n                filter-item features\n                *ngFor=\"let feat of (options | async)?.features || []\"\n            >\n                <p>{{ feat }}</p>\n                <button\n                    mat-icon-button\n                    class=\"-mr-4\"\n                    (click)=\"setFeature(feat, false)\"\n                >\n                    <app-icon>close</app-icon>\n                </button>\n            </div>\n            <div filter-item *ngIf=\"(options | async)?.show_fav\">\n                <span>Favourites Only</span>\n                <button\n                    mat-icon-button\n                    class=\"-mr-4\"\n                    (click)=\"setOptions({ show_fav: false })\"\n                >\n                    <app-icon>close</app-icon>\n                </button>\n            </div>\n        </section>\n    `,\n})\nexport class DeskFiltersDisplayComponent extends BaseClass {\n    @Input() public view: 'map' | 'list' = 'list';\n    @Output() public viewChange = new EventEmitter<'map' | 'list'>();\n    public readonly options = this._state.options;\n    public readonly setOptions = (o) => this._state.setOptions(o);\n    public readonly setFeature = (f, e) => this._state.setFeature(f, e);\n\n    public get start() {\n        return this._state.form.value.date;\n    }\n\n    public get end() {\n        const { date, duration } = this._state.form.value;\n        return date + duration * 60 * 1000;\n    }\n\n    public readonly editFilter = () => this._bsheet.open(DeskFiltersComponent);\n\n    constructor(\n        private _bsheet: MatBottomSheet,\n        private _state: BookingFormService\n    ) {\n        super();\n    }\n}\n","import { Component, Optional } from '@angular/core';\nimport { MatBottomSheetRef } from '@angular/material/bottom-sheet';\nimport { SettingsService } from '@placeos/common';\nimport { addDays, endOfDay } from 'date-fns';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { BookingFormService } from '../booking-form.service';\n\n@Component({\n    selector: 'desk-filters',\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 100%;\n                max-width: 100vw;\n            }\n        `,\n    ],\n    template: `\n        <div\n            class=\"flex rounded-t-md items-center border-b border-gray-200 dark:border-neutral-500 pb-2 sm:p-4\"\n        >\n            <div class=\"flex-1 pl-2\">\n                <button\n                    mat-icon-button\n                    close\n                    class=\"sm:hidden\"\n                    *ngIf=\"can_close\"\n                    (click)=\"close()\"\n                >\n                    <app-icon>keyboard_arrow_left</app-icon>\n                </button>\n            </div>\n            <h3 class=\"font-medium flex-2 text-center\">Desk Filters</h3>\n            <div class=\"flex-1\"></div>\n        </div>\n        <form\n            class=\"max-h-[65vh] p-2 overflow-y-auto overflow-x-hidden divide-y divide-gray-200 w-full max-w-[100vw]\"\n            [formGroup]=\"form\"\n        >\n            <section details>\n                <h2 class=\"text-lg font-medium\">Details</h2>\n                <!-- Building -->\n                <div\n                    *ngIf=\"(buildings | async)?.length\"\n                    class=\"flex-1 min-w-[256px] flex flex-col\"\n                >\n                    <label>Building</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"building\"\n                            placeholder=\"Select building\"\n                            [(ngModel)]=\"building\"\n                            (ngModelChange)=\"\n                                setOptions({\n                                    zone_id: $event?.id\n                                })\n                            \"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        >\n                            <mat-option\n                                *ngFor=\"let bld of buildings | async\"\n                                [value]=\"bld\"\n                            >\n                                {{ bld.display_name || bld.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <!-- level -->\n                <!-- <div *ngIf=\"(levels | async)?.length > 1\"\n                    class=\"flex-1 min-w-[256px] flex flex-col\">\n                    <label>Level</label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            placeholder=\"Any Level\"\n                            ngModel\n                            [disabled]=\"!building\"\n                            (ngModelChange)=\"\n                                setOptions({\n                                    zone_id: $event || building.id\n                                })\n                            \"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        >\n                            <mat-option\n                                *ngFor=\"let lvl of levels | async\"\n                                [value]=\"lvl.id\"\n                            >\n                                {{ lvl.display_name || lvl.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div> -->\n\n                <!-- Date -->\n                <div class=\"flex-1 min-w-[256px]\">\n                    <label>Date</label>\n                    <a-date-field [to]=\"book_until\" formControlName=\"date\">\n                        Date and time must be in the future\n                    </a-date-field>\n                </div>\n                <!-- Start End -->\n                <div class=\"flex items-center space-x-2\">\n                    <div class=\"flex-1 w-1/3\">\n                        <label>Start Time</label>\n                        <a-time-field\n                            name=\"start-time\"\n                            [ngModel]=\"form.value.date\"\n                            (ngModelChange)=\"form.patchValue({ date: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        ></a-time-field>\n                    </div>\n                    <div class=\"flex-1 w-1/3\">\n                        <label>End Time</label>\n                        <a-duration-field\n                            formControlName=\"duration\"\n                            [time]=\"form.get('date')?.value\"\n                            [max]=\"12 * 60\"\n                            [min]=\"60\"\n                            [step]=\"60\"\n                            [disabled]=\"form.value.all_day\"\n                        >\n                        </a-duration-field>\n                    </div>\n                </div>\n                <!-- All Day -->\n                <div *ngIf=\"allow_all_day\" class=\"flex justify-end -mt-2 mb-2\">\n                    <mat-checkbox formControlName=\"all_day\">\n                        All Day\n                    </mat-checkbox>\n                </div>\n            </section>\n            <section favs class=\"space-y-2 pb-4\">\n                <h2 class=\"text-lg font-medium\">Favourites</h2>\n                <div class=\"flex items-center\">\n                    <div for=\"fav\" class=\"flex-1 w-1/2\">\n                        Only show favourite desks\n                    </div>\n                    <mat-checkbox\n                        name=\"fav\"\n                        [ngModel]=\"(options | async)?.show_fav\"\n                        (ngModelChange)=\"setOptions({ show_fav: $event })\"\n                        [ngModelOptions]=\"{ standalone: true }\"\n                    >\n                    </mat-checkbox>\n                </div>\n            </section>\n            <section\n                class=\"space-y-2\"\n                features\n                *ngIf=\"(features | async)?.length\"\n            >\n                <h2 class=\"text-lg font-medium\">Type</h2>\n                <div\n                    *ngFor=\"let feat of features | async\"\n                    class=\"flex items-center flex-wrap space-x-2\"\n                >\n                    <div for=\"feat\" class=\"flex-1 w-1/2\">{{ feat }}</div>\n                    <mat-checkbox\n                        [ngModel]=\"\n                            ((options | async)?.features || []).includes(feat)\n                        \"\n                        (ngModelChange)=\"setFeature(feat, $event)\"\n                        [ngModelOptions]=\"{ standalone: true }\"\n                    ></mat-checkbox>\n                </div>\n            </section>\n        </form>\n        <div\n            class=\"px-2 py-2 w-full border-t border-gray-200\"\n            *ngIf=\"can_close\"\n        >\n            <button mat-button close class=\"w-full\" (click)=\"close()\">\n                Apply Filters\n            </button>\n        </div>\n    `,\n})\nexport class DeskFiltersComponent {\n    public can_close = false;\n    public readonly options = this._state.options;\n    public readonly features = this._state.features;\n    public readonly buildings = this._org.building_list;\n    public readonly levels = this._org.active_levels;\n    public readonly form = this._state.form;\n\n    public get building() {\n        return this._org.building;\n    }\n    public set building(bld) {\n        this._org.building = bld;\n    }\n\n    public readonly close = () => this._bsheet_ref.dismiss();\n    public readonly setOptions = (o) => this._state.setOptions(o);\n    public readonly setFeature = (f, e) => this._state.setFeature(f, e);\n    public readonly setLevel = (l) => {};\n\n    public get allow_time_changes() {\n        return !!this._settings.get('app.desks.allow_time_changes');\n    }\n    public get allow_all_day() {\n        return (\n            this.allow_time_changes &&\n            !!this._settings.get('app.desks.allow_all_day')\n        );\n    }\n\n    public get book_until() {\n        return endOfDay(\n            addDays(\n                Date.now(),\n                this._settings.get('app.desks.available_period') || 90\n            )\n        );\n    }\n\n    constructor(\n        @Optional()\n        private _bsheet_ref: MatBottomSheetRef<DeskFiltersComponent>,\n        private _state: BookingFormService,\n        private _org: OrganisationService,\n        private _settings: SettingsService\n    ) {\n        this.can_close = !!this._bsheet_ref;\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { BookingFormService, BookingAsset } from '../booking-form.service';\n\n@Component({\n    selector: 'desk-list',\n    styles: [\n        `\n            :host {\n                width: 100%;\n                height: 100%;\n                padding: 0.5rem;\n                background: rgba(0, 0, 0, 0.05);\n                overflow-y: auto;\n            }\n        `,\n    ],\n    template: `\n        <h3 class=\"font-bold\">Results</h3>\n        <p count class=\"text-sm opacity-60 mb-4\">\n            {{ (desks | async)?.length || 0 }} result(s) found\n        </p>\n        <ng-container *ngIf=\"!(loading | async)?.length; else load_state\">\n            <ul\n                class=\"list-style-none space-y-2\"\n                *ngIf=\"(desks | async)?.length; else empty_state\"\n            >\n                <li\n                    desk\n                    *ngFor=\"let desk of desks | async\"\n                    class=\"relative rounded-lg w-full shadow border bg-white dark:bg-neutral-600 border-gray-200 dark:border-neutral-500 overflow-hidden\"\n                >\n                    <button\n                        select\n                        matRipple\n                        class=\"w-full h-full flex p-2\"\n                        (click)=\"selectDesk(desk)\"\n                    >\n                        <div\n                            class=\"relative w-20 h-20 rounded-xl bg-black/20 mr-4\"\n                        >\n                            <div\n                                class=\"absolute top-1 left-1 border border-white bg-black/50 rounded-full h-6 w-6 flex items-center justify-center text-white\"\n                                *ngIf=\"selected.includes(desk.id)\"\n                            >\n                                <app-icon>done</app-icon>\n                            </div>\n                            <img\n                                *ngIf=\"desk.images?.length\"\n                                class=\"object-cover h-full\"\n                                [src]=\"desk.images[0]\"\n                            />\n                        </div>\n                        <div class=\"space-y-2 pt-2 flex-1 text-left\">\n                            <span class=\"font-medium\">\n                                {{ desk.name || desk.id || 'Desk' }}\n                            </span>\n                            <div class=\"flex items-center text-sm space-x-2\">\n                                <app-icon class=\"text-blue-500\">place</app-icon>\n                                <p class=\"text-xs\">\n                                    {{\n                                        desk.zone?.display_name ||\n                                            desk.zone?.name ||\n                                            '&lt;No Level&gt;'\n                                    }}\n                                </p>\n                            </div>\n                        </div>\n                    </button>\n                    <button\n                        mat-icon-button\n                        fav\n                        class=\"absolute top-1 right-1\"\n                        [class.text-blue-400]=\"isFavourite(desk.id)\"\n                        (click)=\"toggleFav.emit(desk)\"\n                    >\n                        <app-icon>{{\n                            isFavourite(desk.id)\n                                ? 'favorite'\n                                : 'favorite_border'\n                        }}</app-icon>\n                    </button>\n                </li>\n            </ul>\n        </ng-container>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"opacity-30\">Finding available desks...</p>\n            </div>\n        </ng-template>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    No available desk for selected time and/or filters\n                </p>\n            </div>\n        </ng-template>\n    `,\n})\nexport class DeskListComponent {\n    @Input() public selected: string = '';\n    @Input() public favorites: string[] = [];\n    @Output() public onSelect = new EventEmitter<BookingAsset>();\n    @Output() public toggleFav = new EventEmitter<BookingAsset>();\n\n    public readonly desks = combineLatest([\n        this._state.options,\n        this._state.available_assets,\n    ]).pipe(\n        map(([{ show_fav }, _]) =>\n            _.filter((i) => !show_fav || this.isFavourite(i.id))\n        )\n    );\n    public readonly loading = this._state.loading;\n\n    constructor(private _state: BookingFormService) {}\n\n    public isFavourite(desk_id: string) {\n        return this.favorites.includes(desk_id);\n    }\n\n    public selectDesk(desk: BookingAsset) {\n        this.onSelect.emit(desk);\n    }\n}\n","import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\nimport { BaseClass, unique } from '@placeos/common';\nimport { distinctUntilChanged, map } from 'rxjs/operators';\n\nimport { BookingAsset, BookingFormService } from '../booking-form.service';\n\n@Component({\n    selector: 'desk-map',\n    styles: [\n        `\n            :host {\n                position: relative;\n                background: rgba(0, 0, 0, 0.05);\n                padding-top: 4rem;\n            }\n\n            button {\n                border-radius: 0;\n            }\n        `,\n    ],\n    template: `\n        <i-map\n            *ngIf=\"!is_displayed\"\n            [src]=\"map_url\"\n            [(zoom)]=\"zoom\"\n            [(center)]=\"center\"\n            [features]=\"features | async\"\n            [actions]=\"actions | async\"\n        ></i-map>\n        <div\n            class=\"absolute inset-x-0 top-0 bg-white p-2 border-b border-gray-200\"\n        >\n            <mat-form-field levels appearance=\"outline\" class=\"w-full h-[3.25rem]\">\n                <mat-select\n                    [(ngModel)]=\"level\"\n                    [ngModelOptions]=\"{ standalone: true }\"\n                >\n                    <mat-option\n                        *ngFor=\"let lvl of levels | async\"\n                        [value]=\"lvl\"\n                    >\n                        {{ lvl.display_name || lvl.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n        </div>\n        <div\n            zoom\n            class=\"absolute bottom-2 right-2 rounded-lg border border-gray-200 bg-white flex flex-col overflow-hidden\"\n        >\n            <button zoom-in mat-icon-button (click)=\"setZoom(zoom * 1.1)\">\n                <app-icon>zoom_in</app-icon>\n            </button>\n            <div class=\"border-t border-gray-200 w-full\"></div>\n            <button\n                zoom-out\n                mat-icon-button\n                (click)=\"setZoom(zoom * (1 / 1.1))\"\n            >\n                <app-icon>zoom_out</app-icon>\n            </button>\n            <div class=\"border-t border-gray-200 w-full\"></div>\n            <button reset mat-icon-button (click)=\"resetMap()\">\n                <app-icon>refresh</app-icon>\n            </button>\n        </div>\n    `,\n})\nexport class DeskMapComponent extends BaseClass implements OnInit {\n    @Input() public is_displayed: boolean = false;\n    @Output() public onSelect = new EventEmitter<BookingAsset>();\n\n    public readonly desks = this._state.available_assets;\n    public readonly loading = this._state.loading;\n\n    public zoom = 1;\n    public center = { x: 0.5, y: 0.5 };\n    public level;\n\n    public readonly setOptions = (o) => this._state.setOptions(o);\n\n    public get map_url() {\n        return this.level?.map_id || '';\n    }\n\n    public readonly levels = this._state.available_assets.pipe(\n        map((desks) => unique(desks.map((desk) => desk.zone)))\n    );\n\n    public readonly actions = this._state.available_assets.pipe(\n        map((desks) =>\n            desks.map((desk) => ({\n                id: desk.map_id || desk.id,\n                action: ['touchend', 'mouseup'],\n                callback: () => this.selectDesk(desk as any),\n            }))\n        )\n    );\n\n    public readonly features = this._state.available_assets.pipe(\n        map((desks) =>\n            desks.map((desk) => ({\n                location: desk.map_id || desk.id,\n                content: `<span class=\"flex h-4 w-4 rounded-full absolute top-1/4 left-1/4 transform -translate-x-1/2 -translate-y-1/2 border-[3px] shadow\" >\n                            <span class=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-green-800 opacity-75\"></span>\n                            <span class=\"relative inline-flex rounded-full h-full w-full bg-green-800\"></span>\n                        </span>`,\n            }))\n        )\n    );\n\n    constructor(private _state: BookingFormService) {\n        super();\n    }\n\n    ngOnInit(): void {\n        this.subscription(\n            'levels_update',\n            this.levels.pipe(distinctUntilChanged()).subscribe((levels) => {\n                this.level = levels[0];\n            })\n        );\n    }\n\n    public selectDesk(desk: BookingAsset) {\n        this.onSelect.emit(desk);\n    }\n\n    public setZoom(new_zoom: number) {\n        this.zoom = Math.max(0.5, Math.min(10, new_zoom));\n    }\n\n    public resetMap() {\n        this.zoom = 1;\n        this.center = { x: 0.5, y: 0.5 };\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from '@placeos/common';\nimport {\n    BookingAsset,\n    BookingFlowOptions,\n    BookingFormService,\n} from '../booking-form.service';\n\nexport const FAV_DESK_KEY = 'favourite_desks'\n\n@Component({\n    selector: 'desk-select-modal',\n    styles: [],\n    template: `\n        <div\n            class=\"absolute inset-0 sm:relative sm:inset-none flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <header class=\"flex items-center space-x-4 w-full\">\n                <button mat-icon-button mat-dialog-close class=\"bg-black/20\">\n                    <app-icon>close</app-icon>\n                </button>\n                <h3>Find Desk</h3>\n            </header>\n            <main\n                class=\"flex-1 flex items-center divide-x divide-gray-200 dark:divide-neutral-500 min-h-[65vh] h-[65vh] sm:max-h-[65vh] sm:max-w-[95vw] w-full overflow-hidden\"\n            >\n                <desk-filters\n                    class=\"h-full hidden sm:flex max-w-[20rem] sm:h-[65vh] sm:max-h-full\"\n                ></desk-filters>\n                <div\n                    class=\"flex flex-col items-center flex-1 w-1/2 h-full sm:h-[65vh]\"\n                >\n                    <desk-filters-display\n                        class=\"w-full border-b border-gray-200 dark:border-neutral-500\"\n                        [(view)]=\"view\"\n                    ></desk-filters-display>\n                    <desk-list\n                        *ngIf=\"view === 'list'; else map_view\"\n                        [active]=\"displayed?.id\"\n                        [selected]=\"selected_ids\"\n                        [favorites]=\"favorites\"\n                        (toggleFav)=\"toggleFavourite($event)\"\n                        (onSelect)=\"displayed = $event\"\n                        class=\"flex-1 h-1/2 bg-black/5 dark:bg-white/10\"\n                    ></desk-list>\n                </div>\n                <desk-details\n                    [desk]=\"displayed\"\n                    class=\"h-full w-full sm:h-[65vh] absolute sm:relative sm:flex sm:max-w-[20rem] z-20 bg-white dark:bg-neutral-600 block\"\n                    [class.hidden]=\"!displayed\"\n                    [class.inset-0]=\"displayed\"\n                    [active]=\"selected_ids.includes(displayed?.id)\"\n                    (activeChange)=\"setSelected(displayed, $event)\"\n                    [fav]=\"displayed && this.favorites.includes(displayed?.id)\"\n                    (toggleFav)=\"toggleFavourite(displayed)\"\n                    (close)=\"displayed = null\"\n                ></desk-details>\n            </main>\n            <footer\n                class=\"flex sm:hidden flex-col-reverse items-center justify-end p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    return\n                    class=\"inverse sm:hidden w-full\"\n                    *ngIf=\"displayed\"\n                    (click)=\"displayed = null\"\n                >\n                    Back\n                </button>\n                <button\n                    mat-button\n                    save\n                    [mat-dialog-close]=\"selected\"\n                    [class.mb-2]=\"displayed\"\n                    class=\"w-full sm:w-32 sm:mb-0\"\n                >\n                    View List\n                </button>\n            </footer>\n            <footer\n                class=\"hidden sm:flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    [mat-dialog-close]=\"selected\"\n                    class=\"clear text-primary\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">arrow_back</app-icon>\n                        <div class=\"mr-1 underline\">Back to form</div>\n                    </div>\n                </button>\n                <p class=\"opacity-60 text-sm\">\n                    {{ selected.length }} desk(s) added\n                </p>\n                <button\n                    mat-button\n                    [disabled]=\"!displayed\"\n                    [class.inverse]=\"isSelected(displayed?.id)\"\n                    (click)=\"setSelected(displayed, !isSelected(displayed?.id))\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">{{\n                            isSelected(displayed?.id) ? 'remove' : 'add'\n                        }}</app-icon>\n                        <div class=\"mr-1\">\n                            {{\n                                isSelected(displayed?.id)\n                                    ? 'Remove from Booking'\n                                    : 'Add to booking'\n                            }}\n                        </div>\n                    </div>\n                </button>\n            </footer>\n        </div>\n        <ng-template #map_view>\n            <desk-map\n                class=\"flex-1 h-1/2 w-full\"\n                [selected]=\"selected_ids\"\n                [is_displayed]=\"!!displayed\"\n                (onSelect)=\"displayed = $event\"\n            >\n            </desk-map>\n        </ng-template>\n    `,\n})\nexport class DeskSelectModalComponent {\n    public displayed?: BookingAsset;\n    public selected: BookingAsset[] = [];\n    public view = 'list';\n\n    public get selected_ids() {\n        return this.selected.map((_) => _.id).join(',');\n    }\n\n    public get favorites() {\n        return this._settings.get<string[]>(FAV_DESK_KEY) || [];\n    }\n\n    constructor(\n        private _dialog_ref: MatDialogRef<DeskSelectModalComponent>,\n        private _settings: SettingsService,\n        private _event_form: BookingFormService,\n        @Inject(MAT_DIALOG_DATA)\n        private _data: { items: BookingAsset[]; options: Partial<BookingFlowOptions> }\n    ) {\n        this.selected = [...(_data.items || [])];\n        this._event_form.setOptions(_data.options);\n    }\n\n    public isSelected(id: string) {\n        return id && this.selected_ids.includes(id);\n    }\n\n    public setSelected(item: BookingAsset, state: boolean) {\n        const list = this.selected.filter((_) => _.id !== item.id);\n        if (state) list.push(item);\n        this.selected = list;\n        if (!this._data.options.group && state) this._dialog_ref.close([item]);\n    }\n\n    public toggleFavourite(item: BookingAsset) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(item.id);\n        if (new_state) {\n            this._settings.saveUserSetting(FAV_DESK_KEY, [\n                ...fav_list,\n                item.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                FAV_DESK_KEY,\n                fav_list.filter((_) => _ !== item.id)\n            );\n        }\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog, MatDialogRef } from '@angular/material/dialog';\nimport {\n    currentUser,\n    DialogEvent,\n    notifyError,\n    notifySuccess,\n} from '@placeos/common';\nimport { Desk, OrganisationService } from '@placeos/organisation';\nimport { StaffUser, User } from '@placeos/users';\nimport { endOfDay, getUnixTime, startOfDay } from 'date-fns';\nimport { first, map } from 'rxjs/operators';\n\nimport { queryBookings, saveBooking } from './bookings.fn';\nimport { DeskConfirmModalComponent } from './desk-confirm-modal.component';\nimport { DeskQuestionsModalComponent } from './desk-questions-modal.component';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class DesksService {\n    public can_set_date = true;\n    public error_on_host = true;\n\n    constructor(\n        private _org: OrganisationService,\n        private _dialog: MatDialog\n    ) {}\n\n    public async bookDesk({\n        desks,\n        host,\n        reason,\n        attendees,\n        date,\n    }: {\n        desks: Desk[];\n        host?: StaffUser;\n        attendees?: User[];\n        reason?: string;\n        date?: Date;\n    }) {\n        if (this.error_on_host && !host) {\n            return notifyError('You need to select a host to book a desk.');\n        } else {\n            host = host || currentUser();\n        }\n        reason = reason || '';\n        const level = this._org.levelWithID(\n            desks[0].zone instanceof Array ? desks[0].zone : [desks[0].zone?.id]\n        );\n        let ref: MatDialogRef<any> = this._dialog.open(\n            DeskQuestionsModalComponent\n        );\n        let success = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_: DialogEvent) => _.reason === 'done'))\n                .toPromise(),\n            ref\n                .afterClosed()\n                .pipe(map((_) => null))\n                .toPromise(),\n        ]);\n        if (!success) return;\n        ref.close();\n        ref = this._dialog.open(DeskConfirmModalComponent, {\n            data: {\n                host,\n                desks,\n                date: date ? new Date(date) : new Date(),\n                reason,\n                level,\n                can_set_date: this.can_set_date,\n            },\n        });\n        success = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_: DialogEvent) => _.reason === 'done'))\n                .toPromise(),\n            ref\n                .afterClosed()\n                .pipe(map((_) => null))\n                .toPromise(),\n        ]);\n        if (!success) return;\n        host = ref.componentInstance.host || host;\n        date = ref.componentInstance.date || date;\n        reason = ref.componentInstance.reason || reason;\n        if (!host) {\n            ref.close();\n            return notifyError('You need to select a host to book a desk. ');\n        }\n        ref.componentInstance.loading =\n            'Checking for existing desk bookings...';\n        const bookings = await queryBookings({\n            type: 'desk',\n            period_start: getUnixTime(startOfDay(date || new Date())),\n            period_end: getUnixTime(endOfDay(date || new Date())),\n        }).toPromise();\n        const desk_list = bookings.filter(\n            (d) => d.user_email.toLowerCase() === host.email.toLowerCase()\n        );\n        if (desk_list?.length) {\n            ref.close();\n            return notifyError(\n                'You currently already have a desk booked for the selected date.'\n            );\n        }\n        ref.componentInstance.loading = 'Booking desk...';\n        const users = [host, ...(attendees || [])];\n        await Promise.all([\n            desks.map((desk, idx) =>\n                this.makeDeskBooking(\n                    desk,\n                    host,\n                    date.valueOf() || new Date().valueOf(),\n                    reason,\n                    users[idx]\n                )\n            ),\n        ]);\n        notifySuccess('Successfully booked desk');\n        ref.close();\n        return true;\n    }\n\n    private async makeDeskBooking(\n        desk: Desk,\n        host: StaffUser,\n        date: number,\n        reason: string,\n        for_user: User = null\n    ) {\n        const location = `${desk.zone?.name}-${desk.id}`;\n        const level = this._org.levelWithID(\n            desk.zone instanceof Array ? desk.zone : [desk.zone?.id]\n        );\n        const zones = desk.zone?.id\n            ? [desk.zone?.id, level?.parent_id]\n            : [level?.parent_id];\n        const booking_data = {\n            booking_start: getUnixTime(startOfDay(date)),\n            user_id: for_user?.id || host.id,\n            user_name: for_user?.name || host.name,\n            user_email: for_user?.email || host.email,\n            booking_end: Math.floor(endOfDay(date).valueOf() / 1000),\n            asset_id: desk.id,\n            asset_name: desk.name,\n            title: reason,\n            description: location,\n            zones,\n            booking_type: 'desk',\n            extension_data: {\n                map_id: desk?.map_id || desk?.id,\n                groups: desk.groups,\n                for_user: for_user?.email,\n            },\n        };\n        return saveBooking(booking_data as any).toPromise();\n    }\n}\n","import { Component, EventEmitter, Output } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { first } from 'rxjs/operators';\n\nimport { notifyError } from 'libs/common/src/lib/notifications';\nimport { getInvalidFields } from 'libs/common/src/lib/general';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { BookingFormService } from './booking-form.service';\nimport { Booking } from './booking.class';\nimport { BaseClass, SettingsService } from '@placeos/common';\nimport { User } from '@placeos/users';\n\n@Component({\n    selector: `invite-visitor-form`,\n    template: `\n        <ng-container *ngIf=\"!sent; else send_state\">\n            <div\n                class=\"relative flex flex-col bg-white dark:bg-neutral-700 overflow-auto\"\n                *ngIf=\"!(loading | async); else load_state\"\n            >\n                <div\n                    class=\"w-full border-b border-gray-200 dark:border-neutral-500 px-4 py-2\"\n                >\n                    <h2 class=\"text-2xl\">Invite Visitor</h2>\n                </div>\n                <form *ngIf=\"form\" [formGroup]=\"form\" class=\"p-4\">\n                    <div class=\"flex flex-col\" *ngIf=\"buildings?.length > 1\">\n                        <label for=\"building\">Building<span>*</span></label>\n                        <mat-form-field appearance=\"outline\">\n                            <mat-select\n                                [ngModel]=\"form.value.zones[0]\"\n                                (ngModelChange)=\"\n                                    form.patchValue({ zones: [$event] })\n                                \"\n                                [ngModelOptions]=\"{ standalone: true }\"\n                                name=\"building\"\n                                placeholder=\"Select building\"\n                            >\n                                <mat-option\n                                    *ngFor=\"let bld of buildings | async\"\n                                    [value]=\"bld.id\"\n                                >\n                                    {{ bld.display_name || bld.name }}\n                                </mat-option>\n                            </mat-select>\n                        </mat-form-field>\n                    </div>\n                    <div class=\"flex flex-col\">\n                        <label for=\"date\">Date<span>*</span></label>\n                        <a-date-field\n                            name=\"date\"\n                            formControlName=\"date\"\n                        ></a-date-field>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <div class=\"flex-1 flex flex-col w-1/3\">\n                            <label for=\"start-time\">\n                                Start Time<span>*</span>\n                            </label>\n                            <a-time-field\n                                name=\"start-time\"\n                                formControlName=\"date\"\n                            ></a-time-field>\n                        </div>\n                        <div class=\"flex-1 flex flex-col w-1/3\">\n                            <label for=\"end-time\">End Time<span>*</span></label>\n                            <a-duration-field\n                                name=\"end-time\"\n                                formControlName=\"duration\"\n                                [time]=\"form.value.date\"\n                            ></a-duration-field>\n                        </div>\n                    </div>\n                    <div class=\"flex flex-col\">\n                        <label for=\"visitor-name\"\n                            >Visitor Name<span>*</span></label\n                        >\n                        <mat-form-field appearance=\"outline\">\n                            <input\n                                matInput\n                                name=\"visitor-name\"\n                                formControlName=\"asset_name\"\n                                placeholder=\"Name of the visitor\"\n                                (focus)=\"filterVisitors(form.value.asset_name)\"\n                                [matAutocomplete]=\"name_auto\"\n                            />\n                        </mat-form-field>\n                        <mat-autocomplete #name_auto=\"matAutocomplete\">\n                            <mat-option\n                                *ngFor=\"let item of filtered_visitors\"\n                                [value]=\"item.name\"\n                                (click)=\"setVisitor(item)\"\n                            >\n                                <div class=\"flex flex-col leading-tight\">\n                                    <div>{{ item.name }}</div>\n                                    <div class=\"text-xs opacity-60\">\n                                        {{ item.email }}\n                                        {{\n                                            item.company\n                                                ? '| ' + item.company\n                                                : ''\n                                        }}\n                                    </div>\n                                </div>\n                            </mat-option>\n                        </mat-autocomplete>\n                    </div>\n                    <div class=\"flex flex-col\">\n                        <label for=\"visitor-email\">\n                            Visitor Email<span>*</span>\n                        </label>\n                        <mat-form-field appearance=\"outline\">\n                            <input\n                                matInput\n                                name=\"visitor-email\"\n                                type=\"email\"\n                                formControlName=\"asset_id\"\n                                placeholder=\"Email of the visitor\"\n                                (focus)=\"filterVisitors(form.value.asset_id)\"\n                                [matAutocomplete]=\"email_auto\"\n                            />\n                            <mat-error>A valid email is required</mat-error>\n                        </mat-form-field>\n                        <mat-autocomplete #email_auto=\"matAutocomplete\">\n                            <mat-option\n                                *ngFor=\"let item of filtered_visitors\"\n                                [value]=\"item.email\"\n                                (click)=\"setVisitor(item)\"\n                            >\n                                <div class=\"flex flex-col leading-tight\">\n                                    <div>{{ item.name }}</div>\n                                    <div class=\"text-xs opacity-60\">\n                                        {{ item.email }}\n                                        {{\n                                            item.company\n                                                ? '| ' + item.company\n                                                : ''\n                                        }}\n                                    </div>\n                                </div>\n                            </mat-option>\n                        </mat-autocomplete>\n                    </div>\n                    <div class=\"flex flex-col\">\n                        <label for=\"visitor-name\">Company</label>\n                        <mat-form-field appearance=\"outline\">\n                            <input\n                                matInput\n                                name=\"company\"\n                                formControlName=\"company\"\n                                placeholder=\"Company of the visitor\"\n                            />\n                        </mat-form-field>\n                    </div>\n                    <div class=\"flex flex-col\">\n                        <label for=\"reason\">Reason for visit</label>\n                        <mat-form-field appearance=\"outline\">\n                            <input\n                                name=\"reason\"\n                                matInput\n                                formControlName=\"description\"\n                                placeholder=\"e.g. Meeting Catchup\"\n                            />\n                        </mat-form-field>\n                    </div>\n                </form>\n                <div\n                    class=\"sticky p-4 border-t border-gray-200 dark:border-neutral-500 bottom-0\"\n                >\n                    <button\n                        mat-button\n                        send\n                        class=\"w-full sm:w-auto\"\n                        (click)=\"sendInvite()\"\n                    >\n                        Send Visitor Invite\n                    </button>\n                </div>\n            </div>\n        </ng-container>\n        <ng-template #send_state>\n            <div\n                sent\n                class=\"absolute inset-0 bg-white dark:bg-neutral-700 flex flex-col items-center justify-center text-center\"\n            >\n                <div class=\"w-full max-w-[512px] flex-1 h-1/2 space-y-2 m-8\">\n                    <h2 class=\"text-3xl\">\n                        Visitor invite sent to\n                        {{ last_success?.asset_name || last_success?.asset_id }}\n                    </h2>\n                    <img class=\"mx-auto\" src=\"assets/icons/sent.svg\" />\n                    <p>\n                        Invite has been sent to\n                        <i>{{\n                            last_success?.asset_name || last_success?.asset_id\n                        }}</i>\n                        to attend\n                        {{ building?.display_name || building?.name }} from\n                        {{ last_success?.date | date: 'mediumDate' }} at\n                        {{ last_success?.date | date: 'shortTime' }}\n                    </p>\n                </div>\n                <div\n                    class=\"w-full p-2 border-t border-gray-200 dark:border-neutral-500\"\n                >\n                    <div\n                        class=\"mx-auto flex items-center space-x-2 w-full max-w-[512px]\"\n                    >\n                        <button mat-button class=\"flex-1\" (click)=\"onDone()\">\n                            Great, thanks\n                        </button>\n                        <button\n                            mat-button\n                            class=\"flex-1\"\n                            (click)=\"sent = false\"\n                        >\n                            Book Another Visitor\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"relative flex flex-col items-center justify-center rounded overflow-hidden w-full h-full min-h-[18rem]\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>Sending invitation...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class InviteVisitorFormComponent extends BaseClass {\n    @Output() public done = new EventEmitter<void>();\n\n    public sent = false;\n    public booking?: Booking;\n    public readonly loading = this._service.loading;\n    public readonly buildings = this._org.building_list;\n    public readonly last_success = this._service.last_success;\n    public visitors = [];\n    public filtered_visitors = [];\n\n    public get building() {\n        return this._org.building;\n    }\n\n    public get form() {\n        return this._service.form;\n    }\n\n    constructor(\n        private _service: BookingFormService,\n        private _settings: SettingsService,\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this.sent = false;\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this._service.setOptions({ type: 'visitor' });\n        this.form.patchValue({ zones: [this._org.building?.id] });\n        this.form\n            .get('asset_id')\n            .setValidators([Validators.required, Validators.email]);\n        const visitors = this._settings.get('visitor-invitees') || [];\n        for (const item of visitors) {\n            const [email, name, company] = item.split('|');\n            this.visitors.push({ email, name, company });\n        }\n        this.filterVisitors('');\n        this.subscription(\n            'email',\n            this.form\n                .get('asset_id')\n                .valueChanges.subscribe((_) => this.filterVisitors(_))\n        );\n        this.subscription(\n            'name',\n            this.form\n                .get('asset_name')\n                .valueChanges.subscribe((_) => this.filterVisitors(_))\n        );\n    }\n\n    public setVisitor(item) {\n        this.form.patchValue({\n            asset_id: item.email,\n            asset_name: item.name,\n            company: item.company,\n        });\n    }\n\n    public filterVisitors(filter: string) {\n        const s = filter.toLowerCase();\n        this.filtered_visitors = this.visitors.filter(\n            ({ email, name, company }) =>\n                email.toLowerCase().includes(s) ||\n                name.toLowerCase().includes(s) ||\n                company.toLowerCase().includes(s)\n        );\n    }\n\n    public onDone() {\n        this.done.emit();\n        this.sent = false;\n    }\n\n    public async sendInvite() {\n        this.form.markAllAsTouched();\n        if (!this.form.valid) {\n            return notifyError(\n                `Some fields are invalid. [${getInvalidFields(this.form)}]`\n            );\n        }\n        const { asset_id, asset_name, company } = this.form.value;\n        const visitor_details = `${asset_id}|${asset_name}|${company}`;\n        const old_visitors = this._settings.get('visitor-invitees') || [];\n        this._settings.saveUserSetting('visitor-invitees', [\n            ...old_visitors.filter((_) => !_.includes(asset_id)),\n            visitor_details,\n        ]);\n        const value = this.form.value;\n        this.form.patchValue({\n            name: value.asset_name,\n            attendees: [\n                new User({\n                    name: value.asset_name,\n                    email: value.asset_id,\n                    organisation: value.company,\n                }),\n            ],\n        });\n        this.booking = await this._service.postForm().catch((e) => {\n            notifyError(e);\n            throw e;\n        });\n        this.sent = true;\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { MapPinComponent } from '@placeos/components';\nimport { OrganisationService } from '@placeos/organisation';\nimport { ViewerFeature } from '@placeos/svg-viewer';\nimport { BookingAsset } from '../booking-form.service';\n\n@Component({\n    selector: `parking-space-details`,\n    template: `\n        <ng-container *ngIf=\"space; else empty_state\">\n            <section image class=\"relative w-full h-64 sm:h-40 bg-black/20\">\n                <image-carousel\n                    [images]=\"space.images\"\n                    class=\"absolute inset-0\"\n                ></image-carousel>\n                <button\n                    mat-icon-button\n                    close\n                    (click)=\"close.emit()\"\n                    class=\"absolute top-2 left-2 bg-black/40 sm:hidden text-white\"\n                >\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <button\n                    mat-icon-button\n                    fav\n                    [class.text-white]=\"!fav\"\n                    [class.text-blue-400]=\"fav\"\n                    (click)=\"toggleFav.emit()\"\n                    class=\"absolute top-2 right-2 bg-black/40\"\n                >\n                    <app-icon>{{\n                        fav ? 'favorite' : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </section>\n            <div class=\"p-2 space-y-2 flex-1 h-1/2 overflow-auto\">\n                <section actions class=\"z-0\">\n                    <h2 class=\"text-xl font-medium mb-2 mt-4\">\n                        {{ space.display_name || space.name }}\n                    </h2>\n                </section>\n                <hr />\n                <section details class=\"space-y-2\">\n                    <h2 class=\"text-xl font-medium\">Details</h2>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>people</app-icon>\n                        <p>{{ space.capacity }} People</p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>meeting_room</app-icon>\n                        <p>\n                            {{ level?.display_name || level?.name }}\n                        </p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>place</app-icon>\n                        <p>\n                            {{\n                                building?.address ||\n                                    building?.display_name ||\n                                    building?.name\n                            }}\n                        </p>\n                    </div>\n                </section>\n                <hr />\n                <section facilities class=\"space-y-2\">\n                    <h2 class=\"text-xl font-medium\">Room Facilities</h2>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>people</app-icon>\n                        <p>WiFi Available</p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>restaurant</app-icon>\n                        <p>Catering Available</p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>edit</app-icon>\n                        <p>Whiteboard</p>\n                    </div>\n                </section>\n                <section\n                    map\n                    class=\"w-full mx-auto h-64 sm:h-48 relative border border-gray-200 overflow-hidden rounded\"\n                >\n                    <interactive-map\n                        class=\"pointer-events-none\"\n                        [src]=\"map_url\"\n                        [features]=\"features\"\n                        [options]=\"{ disable_pan: true, disable_zoom: true }\"\n                    ></interactive-map>\n                </section>\n            </div>\n            <div class=\"p-2 border-t border-gray-200 shadow sm:hidden\">\n                <button\n                    mat-button\n                    [class.inverse]=\"active\"\n                    class=\"w-full\"\n                    (click)=\"active = !active; activeChange.emit(active)\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <app-icon class=\"text-2xl\">{{\n                            active ? 'remove' : 'add'\n                        }}</app-icon>\n                        <p>\n                            {{ active ? 'Remove this room' : 'Add this room' }}\n                        </p>\n                    </div>\n                </button>\n            </div>\n        </ng-container>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    Select a space to view it's details\n                </p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 30%;\n                min-width: 20rem;\n                height: 100%;\n                min-height: 65vh;\n            }\n        `,\n    ],\n})\nexport class ParkingSpaceDetailsComponent {\n    @Input() public space?: BookingAsset;\n    @Input() public fav: boolean = false;\n    @Input() public active: boolean = false;\n\n    @Output() public activeChange = new EventEmitter<boolean>();\n    @Output() public close = new EventEmitter<void>();\n    @Output() public toggleFav = new EventEmitter<void>();\n\n    public map_url = '';\n    public features: ViewerFeature[] = [];\n\n    public get level() {\n        return this._org.levelWithID([this.space?.zone.id]) || this.space?.zone;\n    }\n\n    public get building() {\n        return this._org.buildings.find(\n            (_) =>\n                this.space?.zone.id === _.id ||\n                this.space?.zone.parent_id === _.id\n        );\n    }\n\n    constructor(private _org: OrganisationService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.space && this.space) {\n            this._updateFeature();\n        }\n    }\n\n    private _updateFeature() {\n        this.map_url = this.level?.map_id;\n        this.features = [\n            {\n                location: this.space?.map_id,\n                content: MapPinComponent,\n            },\n        ];\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatBottomSheet } from '@angular/material/bottom-sheet';\nimport { BaseClass } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { OrganisationService } from '@placeos/organisation';\nimport { take } from 'rxjs/operators';\nimport { ParkingSpaceFiltersComponent } from './parking-filters.component';\n\n@Component({\n    selector: `parking-space-filters-display`,\n    template: `\n        <section actions class=\"sm:hidden space-x-2 flex items-center p-2\">\n            <button\n                mat-button\n                filters\n                class=\"flex-1 w-1/2\"\n                (click)=\"editFilters()\"\n            >\n                Filters\n            </button>\n            <div class=\"flex items-center\">\n                <button\n                    mat-button\n                    map\n                    class=\"rounded-l rounded-r-none\"\n                    [class.inverse]=\"view !== 'map'\"\n                    (click)=\"view = 'map'; viewChange.emit(view)\"\n                >\n                    Map\n                </button>\n                <button\n                    mat-button\n                    list\n                    class=\"rounded-r rounded-l-none\"\n                    [class.inverse]=\"view !== 'list'\"\n                    (click)=\"view = 'list'; viewChange.emit(view)\"\n                >\n                    List\n                </button>\n            </div>\n        </section>\n        <section filters class=\"flex items-center flex-wrap p-2\">\n            <div\n                filter-item\n                zone\n                class=\"dark:border-neutral-500\"\n                *ngIf=\"location\"\n            >\n                {{ location }}\n            </div>\n            <div filter-item date class=\"dark:border-neutral-500\">\n                {{ start | date: 'mediumDate' }}\n            </div>\n            <div filter-item time class=\"dark:border-neutral-500\">\n                {{ start | date: 'shortTime' }} &mdash;\n                {{ end | date: 'shortTime' }}\n            </div>\n            <div filter-item count class=\"dark:border-neutral-500\">\n                Min. {{ (options | async)?.capcaity || 2 }} People\n            </div>\n            <div filter-item *ngFor=\"let feat of (options | async)?.features\">\n                <p>{{ feat }}</p>\n                <button\n                    mat-icon-button\n                    class=\"-mr-4 dark:border-neutral-500\"\n                    (click)=\"removeFeature(feat)\"\n                >\n                    <app-icon>close</app-icon>\n                </button>\n            </div>\n        </section>\n    `,\n    styles: [\n        `\n            [filter-item] {\n                display: flex;\n                align-items: center;\n                padding: 0 1rem;\n                height: 2rem;\n                font-size: 0.875rem;\n                border: 1px solid rgba(0, 0, 0, 0.2);\n                border-radius: 1.25rem;\n                margin-right: 0.5rem;\n                margin-bottom: 0.5rem;\n            }\n\n            [filter-item]:hover {\n                background: rgba(0, 0, 0, 0.1);\n            }\n\n            [filter-item] > * + * {\n                margin-left: 0.5rem;\n            }\n        `,\n    ],\n})\nexport class ParkingSpaceFiltersDisplayComponent extends BaseClass {\n    @Input() public view: 'map' | 'list' = 'list';\n    @Output() public viewChange = new EventEmitter<'map' | 'list'>();\n    public readonly options = this._event_form.options;\n    public location: string = '';\n\n    public get start() {\n        return this._event_form.form.value.date;\n    }\n\n    public get end() {\n        const { date, duration } = this._event_form.form.value;\n        return date + duration * 60 * 1000;\n    }\n\n    public readonly editFilters = () =>\n        this._bsheet.open(ParkingSpaceFiltersComponent);\n\n    constructor(\n        private _bsheet: MatBottomSheet,\n        private _event_form: EventFormService,\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'opts',\n            this.options.subscribe(({ zone_ids }) =>\n                this._updateLocation(zone_ids)\n            )\n        );\n    }\n\n    public async removeFeature(feat: string) {\n        const value = await this._event_form.options.pipe(take(1)).toPromise();\n        this._event_form.setOptions({\n            ...value,\n            features: (value.features || []).filter((_) => _ !== feat),\n        });\n    }\n\n    private _updateLocation(zone_ids: string[] = []) {\n        const level = this._org.levelWithID(zone_ids);\n        const item = level || this._org.building;\n        this.location = item?.display_name || item?.name || '';\n    }\n}\n","import { Component, Optional } from '@angular/core';\nimport { MatBottomSheetRef } from '@angular/material/bottom-sheet';\nimport { SettingsService } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { map, take } from 'rxjs/operators';\nimport { BookingFormService } from '../booking-form.service';\n\n@Component({\n    selector: `parking-space-filters`,\n    template: `\n        <div class=\"flex items-center border-b border-gray-200 pb-2 sm:hidden\">\n            <div class=\"flex-1 pl-2\">\n                <button\n                    mat-icon-button\n                    close\n                    *ngIf=\"can_close\"\n                    (click)=\"close()\"\n                >\n                    <app-icon>keyboard_arrow_left</app-icon>\n                </button>\n            </div>\n            <h3 class=\"font-medium flex-2 text-center\">Space Filters</h3>\n            <div class=\"flex-1\"></div>\n        </div>\n        <form\n            class=\"max-h-[65vh] p-2 overflow-y-auto overflow-x-hidden divide-y divide-gray-200 w-full max-w-[100vw]\"\n            [formGroup]=\"form\"\n        >\n            <section details>\n                <h2 class=\"text-lg font-medium\">Details</h2>\n                <div class=\"flex-1 min-w-[256px] flex flex-col\">\n                    <label for=\"location\">Location</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"location\"\n                            [ngModel]=\"(options | async)?.zone_ids\"\n                            (ngModelChange)=\"setOptions({ zone_ids: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                            [placeholder]=\"bld?.display_name || bld?.name\"\n                            [multiple]=\"true\"\n                        >\n                            <mat-option\n                                *ngFor=\"let lvl of levels | async\"\n                                [value]=\"lvl.id\"\n                            >\n                                {{ lvl.bld }},\n                                {{ lvl.display_name || lvl.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex-1 min-w-[256px]\">\n                    <label for=\"date\">Date<span>*</span></label>\n                    <a-date-field name=\"date\" formControlName=\"date\">\n                        Date and time must be in the future\n                    </a-date-field>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <div class=\"flex-1 w-1/3\">\n                        <label for=\"start-time\">Start Time<span>*</span></label>\n                        <a-time-field\n                            name=\"start-time\"\n                            [ngModel]=\"form.value.date\"\n                            (ngModelChange)=\"form.patchValue({ date: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        ></a-time-field>\n                    </div>\n                    <div class=\"flex-1 w-1/3\">\n                        <label for=\"end-time\">End Time<span>*</span></label>\n                        <a-duration-field\n                            name=\"end-time\"\n                            formControlName=\"duration\"\n                            [time]=\"form?.value?.date\"\n                            [max]=\"max_duration\"\n                        >\n                        </a-duration-field>\n                    </div>\n                </div>\n            </section>\n            <section favs class=\"space-y-2 pb-4\">\n                <h2 class=\"text-lg font-medium\">Favourites</h2>\n                <div class=\"flex items-center\">\n                    <div for=\"fav\" class=\"flex-1 w-1/2\">\n                        Only show favourite spaces\n                    </div>\n                    <mat-checkbox\n                        name=\"fav\"\n                        [ngModel]=\"(options | async)?.show_fav\"\n                        (ngModelChange)=\"setOptions({ show_fav: $event })\"\n                        [ngModelOptions]=\"{ standalone: true }\"\n                    >\n                    </mat-checkbox>\n                </div>\n            </section>\n            <section\n                features\n                class=\"space-y-2\"\n                *ngIf=\"(features | async)?.length\"\n            >\n                <h2 class=\"text-lg font-medium\">Facilities</h2>\n                <div\n                    class=\"flex items-center\"\n                    *ngFor=\"let feat of features | async\"\n                >\n                    <div for=\"feat\" class=\"flex-1 w-1/2\">{{ feat }}</div>\n                    <mat-checkbox\n                        name=\"feat\"\n                        [ngModel]=\"(options | async)?.features?.includes(feat)\"\n                        (ngModelChange)=\"toggleFeature(feat, $event)\"\n                        [ngModelOptions]=\"{ standalone: true }\"\n                    ></mat-checkbox>\n                </div>\n            </section>\n        </form>\n        <div\n            class=\"px-2 pt-2 w-full border-t border-gray-200\"\n            *ngIf=\"can_close\"\n        >\n            <button mat-button close class=\"w-full\" (click)=\"close()\">\n                Apply Filters\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 100%;\n                max-width: 100vw;\n            }\n        `,\n    ],\n})\nexport class ParkingSpaceFiltersComponent {\n    public can_close = false;\n    public readonly options = this._form.options;\n\n    public readonly levels = this._org.level_list.pipe(\n        map((l) => {\n            for (const lvl of l) {\n                const bld = this._org.buildings.find(\n                    (_) => _.id === lvl.parent_id\n                );\n                (lvl as any).bld = bld?.display_name || bld?.name || '';\n            }\n            return l;\n        })\n    );\n    public readonly features = this._form.features;\n\n    public readonly close = () => this._bsheet_ref.dismiss();\n    public readonly setOptions = (o) => this._form.setOptions(o);\n\n    public get bld() {\n        return this._org.building;\n    }\n\n    public get form() {\n        return this._form.form;\n    }\n\n    public get max_duration() {\n        return this._settings.get('app.events.max_duration') || 480;\n    }\n\n    constructor(\n        @Optional()\n        private _bsheet_ref: MatBottomSheetRef<ParkingSpaceFiltersComponent>,\n        private _settings: SettingsService,\n        private _form: BookingFormService,\n        private _org: OrganisationService,\n    ) {\n        this.can_close = !!this._bsheet_ref;\n    }\n\n    public async toggleFeature(feat: string, state: boolean) {\n        const { features } = await this.options.pipe(take(1)).toPromise();\n        const new_list = (features || []).filter(_ => feat !== _);\n        if (state) new_list.push(feat);\n        this.setOptions({ features: new_list });\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { EventFormService } from '@placeos/events';\nimport { combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { BookingAsset, BookingFormService } from '../booking-form.service';\n\n@Component({\n    selector: `parking-space-list`,\n    template: `\n        <h3 class=\"font-bold\">Results</h3>\n        <p count class=\"text-sm opacity-60 mb-4\">\n            {{ (assets | async)?.length || 0 }} result(s) found\n        </p>\n        <ng-container *ngIf=\"!(loading | async); else load_state\">\n            <ul\n                class=\"list-style-none space-y-2\"\n                *ngIf=\"(assets | async)?.length; else empty_state\"\n            >\n                <li\n                    space\n                    *ngFor=\"let space of assets | async\"\n                    [class.!border-blue-400]=\"active === space.id\"\n                    class=\"relative p-2 rounded-lg w-full shadow border bg-white dark:bg-neutral-700 border-gray-200 dark:border-neutral-500\"\n                >\n                    <button\n                        matRipple\n                        select\n                        class=\"w-full h-full flex items-center\"\n                        (click)=\"selectSpace(space)\"\n                    >\n                        <div\n                            class=\"relative w-20 h-20 rounded-xl bg-black/20 dark:bg-white/30 mr-4 overflow-hidden\"\n                        >\n                            <div\n                                class=\"absolute top-1 left-1 border border-white bg-black/50 rounded-full h-6 w-6 flex items-center justify-center text-white\"\n                                *ngIf=\"selected.includes(space.id)\"\n                            >\n                                <app-icon>done</app-icon>\n                            </div>\n                            <img\n                                *ngIf=\"space.images?.length\"\n                                class=\"object-cover h-full\"\n                                [src]=\"space.images[0]\"\n                            />\n                        </div>\n                        <div class=\"space-y-2\">\n                            <div class=\"font-medium truncate mr-10\">\n                                {{ space.name || 'Meeting Space' }}\n                            </div>\n                            <div class=\"flex items-center text-sm space-x-2\">\n                                <app-icon class=\"text-blue-500\">place</app-icon>\n                                <p>\n                                    {{\n                                        space.location ||\n                                            space.level?.display_name ||\n                                            space.level?.name\n                                    }}\n                                </p>\n                            </div>\n                            <div class=\"flex items-center text-sm space-x-2\">\n                                <app-icon class=\"text-blue-500\"\n                                    >people</app-icon\n                                >\n                                <p>\n                                    {{\n                                        space.capacity < 1 ? 2 : space.capacity\n                                    }}\n                                    People\n                                </p>\n                            </div>\n                        </div>\n                    </button>\n                    <button\n                        mat-icon-button\n                        fav\n                        class=\"absolute top-1 right-1\"\n                        [class.text-blue-400]=\"isFavourite(space.id)\"\n                        (click)=\"toggleFav.emit(space)\"\n                    >\n                        <app-icon>{{\n                            isFavourite(space.id)\n                                ? 'favorite'\n                                : 'favorite_border'\n                        }}</app-icon>\n                    </button>\n                </li>\n            </ul>\n        </ng-container>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    No available spaces for selected time and/or filters\n                </p>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"opacity-30\">Finding available spaces...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n                height: 100%;\n                padding: 0.5rem;\n                overflow: auto;\n            }\n        `,\n    ],\n})\nexport class ParkingSpaceListComponent {\n    @Input() public active: string = '';\n    @Input() public selected: string = '';\n    @Input() public favorites: string[] = [];\n    @Output() public onSelect = new EventEmitter<BookingAsset>();\n    @Output() public toggleFav = new EventEmitter<BookingAsset>();\n\n    public readonly assets = combineLatest([\n        this._form.options,\n        this._form.available_assets,\n    ]).pipe(\n        map(([{ show_fav }, _]) =>\n            _.filter((i) => !show_fav || this.isFavourite(i.id))\n        )\n    );\n    public readonly loading = this._form.loading;\n\n    constructor(private _form: BookingFormService) {}\n\n    public isFavourite(space_id: string) {\n        return this.favorites.includes(space_id);\n    }\n\n    public selectSpace(space: BookingAsset) {\n        this.onSelect.emit(space);\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAP_FEATURE_DATA } from '@placeos/components';\n\n@Component({\n    selector: 'parking-space-location-pin',\n    template: `\n        <div class=\"absolute bottom-0 left-1/2 -translate-x-1/2\">\n            <svg\n                width=\"66\"\n                height=\"80\"\n                viewBox=\"0 0 66 80\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n            >\n                <g filter=\"url(#filter0_d_1065_10313)\">\n                    <path\n                        d=\"M19.724 53.0408C25.0871 60.3435 30.5582 65.8583 31.0184 66.3178C31.4558 66.755 32.0489 67.0007 32.6674 67.0008H32.6678C33.2863 67.0007 33.8795 66.755 34.3169 66.3178C34.7771 65.8583 40.2481 60.3435 45.6112 53.0408C48.2928 49.3894 50.963 45.2701 52.9663 41.0957C54.9629 36.935 56.3331 32.6459 56.3342 28.6724C56.364 25.5564 55.7725 22.4657 54.5941 19.5809C53.415 16.6946 51.6722 14.0724 49.4675 11.8677C47.2629 9.66308 44.6407 7.92024 41.7544 6.74121C38.8711 5.5634 35.782 4.97184 32.6676 5.00103C29.5533 4.97184 26.4642 5.5634 23.5809 6.74121C20.6946 7.92024 18.0724 9.66308 15.8677 11.8677C13.6631 14.0724 11.9202 16.6946 10.7412 19.5809C9.56278 22.4657 8.97122 25.5565 9.00108 28.6726C9.0022 32.646 10.3724 36.9351 12.369 41.0957C14.3723 45.2701 17.0425 49.3894 19.724 53.0408Z\"\n                        fill=\"#309251\"\n                        stroke=\"#0B421D\"\n                        stroke-width=\"2\"\n                    />\n                </g>\n                <defs>\n                    <filter\n                        id=\"filter0_d_1065_10313\"\n                        x=\"0\"\n                        y=\"0\"\n                        width=\"65.3353\"\n                        height=\"80.001\"\n                        filterUnits=\"userSpaceOnUse\"\n                        color-interpolation-filters=\"sRGB\"\n                    >\n                        <feFlood\n                            flood-opacity=\"0\"\n                            result=\"BackgroundImageFix\"\n                        />\n                        <feColorMatrix\n                            in=\"SourceAlpha\"\n                            type=\"matrix\"\n                            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n                            result=\"hardAlpha\"\n                        />\n                        <feOffset dy=\"4\" />\n                        <feGaussianBlur stdDeviation=\"4\" />\n                        <feComposite in2=\"hardAlpha\" operator=\"out\" />\n                        <feColorMatrix\n                            type=\"matrix\"\n                            values=\"0 0 0 0 0.0196078 0 0 0 0 0.109804 0 0 0 0 0.172549 0 0 0 0.2 0\"\n                        />\n                        <feBlend\n                            mode=\"normal\"\n                            in2=\"BackgroundImageFix\"\n                            result=\"effect1_dropShadow_1065_10313\"\n                        />\n                        <feBlend\n                            mode=\"normal\"\n                            in=\"SourceGraphic\"\n                            in2=\"effect1_dropShadow_1065_10313\"\n                            result=\"shape\"\n                        />\n                    </filter>\n                </defs>\n            </svg>\n            <div\n                class=\"absolute top-0 left-0 w-full h-3/4 flex items-center justify-center\"\n            >\n                <div\n                    class=\"relative z-10 h-4 w-4 rounded-full bg-white border-2 border-[#0B421D]\"\n                    *ngIf=\"!selected\"\n                ></div>\n                <app-icon class=\"relative text-white z-10 text-2xl\" *ngIf=\"selected\">\n                    done\n                </app-icon>\n            </div>\n        </div>\n    `,\n    styles: [],\n})\nexport class ParkingSpaceLocationPinComponent {\n    public get selected() {\n        return this._data.selected === true;\n    }\n    constructor(@Inject(MAP_FEATURE_DATA) private _data: any) {}\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { BaseClass, unique } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { BuildingLevel } from '@placeos/organisation';\nimport { debounceTime, map } from 'rxjs/operators';\nimport { BookingAsset } from '../booking-form.service';\nimport { ParkingSpaceLocationPinComponent } from './parking-location-pin.component';\n\n@Component({\n    selector: `parking-space-map`,\n    template: `\n        <i-map\n            *ngIf=\"!is_displayed\"\n            [src]=\"map_url\"\n            [features]=\"features | async\"\n            [actions]=\"actions | async\"\n            [(zoom)]=\"zoom\"\n            [(center)]=\"center\"\n        ></i-map>\n        <div\n            class=\"absolute inset-x-0 top-0 bg-white p-2 border-b border-gray-200\"\n        >\n            <mat-form-field levels appearance=\"outline\" class=\"w-full h-[3.25rem]\">\n                <mat-select [(ngModel)]=\"level\">\n                    <mat-option\n                        *ngFor=\"let opt of levels | async\"\n                        [value]=\"opt\"\n                    >\n                        {{ opt.display_name || opt.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n        </div>\n        <div\n            zoom\n            class=\"absolute bottom-2 right-2 rounded-lg border border-gray-200 bg-white flex flex-col overflow-hidden\"\n        >\n            <button zoom-in mat-icon-button (click)=\"setZoom(zoom * 1.1)\">\n                <app-icon>zoom_in</app-icon>\n            </button>\n            <div class=\"border-t border-gray-200 w-full\"></div>\n            <button\n                zoom-out\n                mat-icon-button\n                (click)=\"setZoom(zoom * (1 / 1.1))\"\n            >\n                <app-icon>zoom_out</app-icon>\n            </button>\n            <div class=\"border-t border-gray-200 w-full\"></div>\n            <button reset mat-icon-button (click)=\"resetMap()\">\n                <app-icon>refresh</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n                background: rgba(0, 0, 0, 0.05);\n                padding-top: 4rem;\n            }\n\n            button {\n                border-radius: 0;\n            }\n        `,\n    ],\n})\nexport class ParkingSpaceSelectMapComponent extends BaseClass {\n    @Input() public selected: string[] = [];\n    @Input() public is_displayed: boolean = false;\n    @Output() public onSelect = new EventEmitter<BookingAsset>();\n\n    public zoom = 1;\n    public center = { x: 0.5, y: 0.5 };\n\n    private _seletedSpace = (s) => () => this.onSelect.emit(s);\n    public level: BuildingLevel = null;\n\n    public get map_url() {\n        return this.level?.map_id || '';\n    }\n\n    public readonly levels = this._event_form.available_spaces.pipe(\n        map((_) => unique(_.map(({ level }) => level)))\n    );\n\n    public readonly features = this._event_form.available_spaces.pipe(\n        debounceTime(1000),\n        map((l) =>\n            l.map((space) => ({\n                location: space.map_id,\n                content: ParkingSpaceLocationPinComponent,\n                data: {\n                    ...space,\n                    selected: this.selected.includes(space.id),\n                },\n            }))\n        )\n    );\n\n    public readonly actions = this._event_form.available_spaces.pipe(\n        map((l) =>\n            l.map((space) => ({\n                id: space.map_id,\n                action: ['touchend', 'mouseup'],\n                callback: this._seletedSpace(space),\n            }))\n        )\n    );\n\n    constructor(private _event_form: EventFormService) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'spaces',\n            this._event_form.available_spaces.subscribe((_) => {\n                if (!this.level && _.length) this.level = _[0].level;\n            })\n        );\n    }\n\n    public setZoom(new_zoom: number) {\n        this.zoom = Math.max(0.5, Math.min(10, new_zoom));\n    }\n\n    public resetMap() {\n        this.zoom = 1;\n        this.center = { x: 0.5, y: 0.5 };\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from '@placeos/common';\nimport { BookingAsset, BookingFlowOptions, BookingFormService } from '../booking-form.service';\n\nexport const FAV_PARKING_KEY = 'favourite_parking_spaces';\n\n@Component({\n    selector: 'parking-space-select-modal',\n    template: `\n        <div\n            class=\"absolute inset-0 sm:relative sm:inset-none flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <header class=\"flex items-center space-x-4 w-full\">\n                <button mat-icon-button mat-dialog-close class=\"bg-black/20\">\n                    <app-icon>close</app-icon>\n                </button>\n                <h3>Find Parking Space</h3>\n            </header>\n            <main\n                class=\"flex-1 flex items-center divide-x divide-gray-200 dark:divide-neutral-500 min-h-[65vh] h-[65vh] sm:max-h-[65vh] sm:max-w-[95vw] w-full overflow-hidden\"\n            >\n                <parking-space-filters\n                    class=\"h-full hidden sm:flex max-w-[20rem] sm:h-[65vh] sm:max-h-full\"\n                ></parking-space-filters>\n                <div\n                    class=\"flex flex-col items-center flex-1 w-1/2 h-full sm:h-[65vh]\"\n                >\n                    <parking-space-filters-display\n                        class=\"w-full border-b border-gray-200 dark:border-neutral-500\"\n                        [(view)]=\"view\"\n                    ></parking-space-filters-display>\n                    <parking-space-list\n                        *ngIf=\"view === 'list'; else map_view\"\n                        [active]=\"displayed?.id\"\n                        [selected]=\"selected_ids\"\n                        [favorites]=\"favorites\"\n                        (toggleFav)=\"toggleFavourite($event)\"\n                        (onSelect)=\"displayed = $event\"\n                        class=\"flex-1 h-1/2 bg-black/5 dark:bg-white/10\"\n                    ></parking-space-list>\n                </div>\n                <parking-space-details\n                    [space]=\"displayed\"\n                    class=\"h-full w-full sm:h-[65vh] absolute sm:relative sm:flex sm:max-w-[20rem] z-20 bg-white dark:bg-neutral-600 block\"\n                    [class.hidden]=\"!displayed\"\n                    [class.inset-0]=\"displayed\"\n                    [active]=\"selected_ids.includes(displayed?.id)\"\n                    (activeChange)=\"setSelected(displayed, $event)\"\n                    [fav]=\"displayed && this.favorites.includes(displayed?.id)\"\n                    (toggleFav)=\"toggleFavourite(displayed)\"\n                    (close)=\"displayed = null\"\n                ></parking-space-details>\n            </main>\n            <footer\n                class=\"flex sm:hidden flex-col-reverse items-center justify-end p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    return\n                    class=\"inverse sm:hidden w-full\"\n                    *ngIf=\"displayed\"\n                    (click)=\"displayed = null\"\n                >\n                    Back\n                </button>\n                <button\n                    mat-button\n                    save\n                    [mat-dialog-close]=\"selected\"\n                    [class.mb-2]=\"displayed\"\n                    class=\"w-full sm:w-32 sm:mb-0\"\n                >\n                    View List\n                </button>\n            </footer>\n            <footer\n                class=\"hidden sm:flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    [mat-dialog-close]=\"selected\"\n                    class=\"clear text-primary\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">arrow_back</app-icon>\n                        <div class=\"mr-1 underline\">Back to form</div>\n                    </div>\n                </button>\n                <p class=\"opacity-60 text-sm\">\n                    {{ selected.length }} bay(s) added\n                </p>\n                <button\n                    mat-button\n                    [disabled]=\"!displayed\"\n                    [class.inverse]=\"isSelected(displayed?.id)\"\n                    (click)=\"setSelected(displayed, !isSelected(displayed?.id))\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">{{\n                            isSelected(displayed?.id) ? 'remove' : 'add'\n                        }}</app-icon>\n                        <div class=\"mr-1\">\n                            {{\n                                isSelected(displayed?.id)\n                                    ? 'Remove from Booking'\n                                    : 'Add to booking'\n                            }}\n                        </div>\n                    </div>\n                </button>\n            </footer>\n        </div>\n        <ng-template #map_view>\n            <parking-space-map\n                class=\"flex-1 h-1/2 w-full\"\n                [selected]=\"selected_ids\"\n                [is_displayed]=\"!!displayed\"\n                (onSelect)=\"displayed = $event\"\n            >\n            </parking-space-map>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class ParkingSpaceSelectModalComponent {\n    public displayed?: BookingAsset;\n    public selected: BookingAsset[] = [];\n    public view = 'list';\n\n    public get selected_ids() {\n        return this.selected.map((_) => _.id).join(',');\n    }\n\n    public get favorites() {\n        return this._settings.get<string[]>(FAV_PARKING_KEY) || [];\n    }\n\n    constructor(\n        private _dialog_ref: MatDialogRef<ParkingSpaceSelectModalComponent>,\n        private _settings: SettingsService,\n        private _event_form: BookingFormService,\n        @Inject(MAT_DIALOG_DATA)\n        private _data: { spaces: BookingAsset[]; options: Partial<BookingFlowOptions> }\n    ) {\n        this.selected = [...(_data.spaces || [])];\n        this._event_form.setOptions(_data.options);\n    }\n\n    public isSelected(id: string) {\n        return id && this.selected_ids.includes(id);\n    }\n\n    public setSelected(item: BookingAsset, state: boolean) {\n        const list = this.selected.filter((_) => _.id !== item.id);\n        if (state) list.push(item);\n        this.selected = list;\n        if (!this._data.options.group && state) this._dialog_ref.close([item]);\n    }\n\n    public toggleFavourite(item: BookingAsset) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(item.id);\n        if (new_state) {\n            this._settings.saveUserSetting(FAV_PARKING_KEY, [\n                ...fav_list,\n                item.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                FAV_PARKING_KEY,\n                fav_list.filter((_) => _ !== item.id)\n            );\n        }\n    }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport { BookingAsset } from './booking-form.service';\nimport { FAV_PARKING_KEY, ParkingSpaceSelectModalComponent } from './parking-select-modal/parking-select-modal.component';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: `parking-space-list-field`,\n    template: `\n        <div list class=\"space-y-2\">\n            <div\n                space\n                class=\"relative p-2 rounded-lg w-full flex items-center shadow border border-gray-200\"\n                *ngFor=\"let space of spaces\"\n            >\n                <div class=\"w-24 h-24 rounded-xl bg-black/20 mr-4 overflow-hidden\">\n                    <img *ngIf=\"space.images?.length\" [src]=\"space.images[0]\" class=\"min-h-full object-cover\" />\n                </div>\n                <div class=\"space-y-2 pb-4\">\n                    <div class=\"font-medium\">\n                        {{ space.name || 'Meeting Resource' }}\n                    </div>\n                    <div class=\"flex items-center text-sm space-x-2\">\n                        <app-icon class=\"text-blue-500\">place</app-icon>\n                        <p>{{ space.location }}</p>\n                    </div>\n                    <div class=\"flex items-center text-sm space-x-2\">\n                        <app-icon class=\"text-blue-500\">people</app-icon>\n                        <p>\n                            {{ space.capacity < 1 ? 2 : space.capacity }} People\n                        </p>\n                    </div>\n                    <div\n                        class=\"absolute bottom-0 right-0 flex items-center justify-end text-xs\"\n                    >\n                        <button\n                            mat-button\n                            edit-space\n                            class=\"clear\"\n                            (click)=\"changeResources(space)\"\n                        >\n                            <div class=\"flex items-center space-x-2\">\n                                <app-icon>edit</app-icon>\n                                Change\n                            </div>\n                        </button>\n                        <button\n                            mat-button\n                            remove-space\n                            class=\"clear\"\n                            (click)=\"removeResource(space)\"\n                        >\n                            <div class=\"flex items-center space-x-2\">\n                                <app-icon>close</app-icon>\n                                Remove\n                            </div>\n                        </button>\n                    </div>\n                </div>\n                <button\n                    mat-icon-button\n                    fav\n                    class=\"absolute top-1 right-1\"\n                    [class.text-blue-400]=\"favorites.includes(asset?.id)\"\n                    (click)=\"toggleFavourite(asset)\"\n                >\n                    <app-icon>{{\n                        favorites.includes(asset?.id)\n                            ? 'favorite'\n                            : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </div>\n        </div>\n        <button\n            mat-button\n            add-space\n            class=\"w-full inverse mt-2\"\n            (click)=\"changeResources()\"\n        >\n            <div class=\"flex items-center justify-center space-x-2\">\n                <app-icon>search</app-icon>\n                <span>Add Parking Resource</span>\n            </div>\n        </button>\n        <div class=\"flex items-center flex-wrap sm:space-x-2 mb-2\">\n            <div class=\"flex-1 min-w-[256px] space-y-2\">\n                \n            </div>\n        </div>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => ParkingSpaceListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class ParkingSpaceListFieldComponent implements ControlValueAccessor {\n    public room_size = 3;\n    public spaces: BookingAsset[] = [];\n    public disabled = false;\n\n    private _onChange: (_: BookingAsset[]) => void;\n    private _onTouch: (_: BookingAsset[]) => void;\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_spaces') || EMPTY_FAVS;\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {}\n\n    /** Add or edit selected spaces */\n    public changeResources() {\n        const ref = this._dialog.open(ParkingSpaceSelectModalComponent, {\n            data: { spaces: this.spaces, options: { capacity: this.room_size } },\n        });\n        ref.afterClosed().subscribe((spaces?: BookingAsset[]) => {\n            if (!spaces) return;\n            this.setValue(spaces);\n        });\n    }\n\n    /** Remove the selected space from the list */\n    public removeResource(space: BookingAsset) {\n        this.setValue(this.spaces.filter((_) => _.id !== space.id));\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: BookingAsset[]) {\n        this.spaces = new_value;\n        if (this._onChange) this._onChange(this.spaces);\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: BookingAsset[]) {\n        this.spaces = value || [];\n    }\n\n    /* istanbul ignore next */\n    public readonly registerOnChange = (fn: (_: BookingAsset[]) => void) =>\n        (this._onChange = fn);\n    /* istanbul ignore next */\n    public readonly registerOnTouched = (fn: (_: BookingAsset[]) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n\n    public toggleFavourite(space: BookingAsset) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(space.id);\n        if (new_state) {\n            this._settings.saveUserSetting(FAV_PARKING_KEY, [\n                ...fav_list,\n                space.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                FAV_PARKING_KEY,\n                fav_list.filter((_) => _ !== space.id)\n            );\n        }\n    }\n}\n","import { differenceInMinutes } from 'date-fns';\n\nimport { Space } from 'libs/spaces/src/lib/space.class';\n\nimport { CalendarAvailability } from './calendar.interfaces';\n\nexport class Calendar {\n    /** ID of the calendar */\n    public readonly id: string;\n    /** Name of the calendar */\n    public readonly name: string;\n    /** System associated with the calendar */\n    public readonly resource: Space;\n    /** Primary calendar of the user */\n    public readonly primary: boolean;\n    /** Summary */\n    public readonly summary: string;\n    /** Whether the user can edit events associated to this calendar */\n    public readonly can_edit: boolean;\n    /** Availability */\n    public readonly availability: CalendarAvailability[];\n    /** Whether calendar should be hidden from the user */\n    public readonly hidden: boolean;\n\n    constructor(data: Partial<Calendar> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.primary = !!data.primary;\n        this.summary = data.summary || '';\n        this.can_edit = !!data.can_edit;\n        this.resource = new Space(data.resource || (data as any).system);\n        this.availability = (data.availability || []).map(\n            ({ starts_at, ends_at, date, duration, status }: any) => {\n                return {\n                    date: new Date(date, starts_at).valueOf(),\n                    duration:\n                        duration || differenceInMinutes(ends_at, starts_at),\n                    status: status,\n                };\n            }\n        );\n        this.hidden = !!data.hidden;\n    }\n}\n","import { get } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { Calendar } from './calendar.class';\nimport { CalendarAvailabilityQueryParams } from './calendar.interfaces';\n\nconst CALENDAR_ENDPOINT = '/api/staff/v1/calendars';\n\n/** List calendars associated with the logged in user */\nexport function queryCalendars(): Observable<Calendar[]> {\n    return get(CALENDAR_ENDPOINT).pipe(\n        map((i) => i.map((c) => new Calendar(c)))\n    );\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function queryCalendarAvailability(\n    q: CalendarAvailabilityQueryParams\n): Observable<Calendar[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/availability${query ? '?' + query : ''}`\n    ).pipe(map((i) => i.map((c) => new Calendar(c))));\n}\n\nconst calendarsToSpaces = (org?) =>\n    map((list: Calendar[]) =>\n        list\n            .filter((cal) => !!cal.resource)\n            .map(\n                (cal) =>\n                    new Space({\n                        ...cal.resource,\n                        level: org?.levelWithID(cal.resource.zones),\n                        availability: cal.availability,\n                    })\n            )\n            .filter((space) => space.bookable)\n    );\n\n/** List available spaces based on the given query */\nexport function querySpaceAvailability(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    return queryCalendarAvailability(q).pipe(calendarsToSpaces(org));\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function querySpaceFreeBusy(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/free_busy${query ? '?' + query : ''}`\n    ).pipe(\n        map((i) => i.map((c) => new Calendar(c))),\n        calendarsToSpaces(org)\n    );\n}\n","export * from './lib/catering.module';\nexport * from './lib/catering';\n","import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { DialogEvent, Identity } from 'libs/common/src/lib/types';\n\nimport { CateringRuleset, RULE_TYPES } from './catering.interfaces';\n\nexport interface CateringConfigModalData {\n    /** List of catering rules */\n    config: CateringRuleset[];\n    /** List of available categories and tags */\n    types?: string[];\n}\n\n@Component({\n    selector: 'catering-config-modal',\n    template: `\n        <header>\n            <h3>Edit Catering Configuration</h3>\n            <button mat-icon-button mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main class=\"overflow-auto text-center\">\n            <button\n                mat-button\n                (click)=\"rulesets.push({ id: new_id, rules: [] })\"\n            >\n                New Ruleset\n            </button>\n            <div *ngFor=\"let set of rulesets; let i = index\" class=\"ruleset\">\n                <div class=\"flex\">\n                    <mat-form-field class=\"flex-1\" appearance=\"outline\">\n                        <input\n                            matInput\n                            name=\"name\"\n                            placeholder=\"Zone ID, Category or Tag\"\n                            [(ngModel)]=\"set.name\"\n                            required\n                        />\n                        <mat-error>Ruleset name is required</mat-error>\n                    </mat-form-field>\n                    <button\n                        mat-icon-button\n                        class=\"mb-6\"\n                        (click)=\"set.rules.push(['', '']); show_rules = set.id\"\n                    >\n                        <app-icon>add</app-icon>\n                    </button>\n                    <button\n                        mat-icon-button\n                        class=\"mb-6\"\n                        [disabled]=\"!set.rules.length\"\n                        (click)=\"\n                            show_rules = show_rules !== set.id ? set.id : ''\n                        \"\n                    >\n                        <app-icon>{{\n                            show_rules === set.id\n                                ? 'expand_less'\n                                : 'expand_more'\n                        }}</app-icon>\n                    </button>\n                    <button mat-icon-button class=\"mb-6\" (click)=\"rulesets.splice(i, 1)\">\n                        <app-icon>delete</app-icon>\n                    </button>\n                </div>\n                <div\n                    name=\"rules\"\n                    class=\"bg-gray-100 rounded overflow-hidden\"\n                    [style.height]=\"\n                        (show_rules === set.id ? 5 * set.rules.length : 0) +\n                        'em'\n                    \"\n                >\n                    <div\n                        class=\"flex items-center px-2 h-20 space-x-2\"\n                        *ngFor=\"let rule of set.rules; let i = index\"\n                    >\n                        <mat-form-field class=\"flex-1\" appearance=\"outline\">\n                            <mat-select\n                                name=\"booking-type\"\n                                [(ngModel)]=\"rule[0]\"\n                                placeholder=\"Select Rule\"\n                            >\n                                <mat-option\n                                    *ngFor=\"let type of rule_types\"\n                                    [value]=\"type.id\"\n                                >\n                                    {{ type.name }}\n                                </mat-option>\n                            </mat-select>\n                        </mat-form-field>\n                        <mat-form-field class=\"flex-1\" appearance=\"outline\">\n                            <input\n                                matInput\n                                name=\"value\"\n                                placeholder=\"Rule value\"\n                                [(ngModel)]=\"rule[1]\"\n                                required\n                            />\n                            <mat-error>Rule value is required</mat-error>\n                        </mat-form-field>\n                        <button mat-icon-button class=\"mb-6\" (click)=\"set.rules.splice(i, 1)\">\n                            <app-icon>delete</app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </main>\n        <footer\n            class=\"flex p-2 items-center justify-center border-none border-t border-solid border-gray-300\"\n        >\n            <button mat-button (click)=\"saveChanges()\">Save Changes</button>\n        </footer>\n    `,\n    styles: [\n        `\n            [name='rules'] {\n                transition: height 200ms;\n            }\n\n            main {\n                width: 32em;\n                padding: 0.5em 1em 1em;\n            }\n\n            main button.mat-button {\n                margin: 0 auto 0.5em;\n                min-width: 12em;\n            }\n        `,\n    ],\n})\nexport class CateringConfigModalComponent {\n    /** Emitter for events on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Whether changes are being saved */\n    public loading = false;\n    /** Whether to show rules for a ruleset */\n    public show_rules: string;\n\n    public readonly rulesets: CateringRuleset[];\n\n    public readonly rule_types: readonly Identity[] = RULE_TYPES;\n\n    public get new_id() {\n        return 'ruleset-' + Math.floor(Math.random() * 9999_9999);\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: CateringConfigModalData\n    ) {\n        this.rulesets = (_data.config || []).map((set) => {\n            set.rules = set.rules.map((i) => [\n                i[0],\n                JSON.stringify(i[1]),\n            ]) as any;\n            return set;\n        });\n    }\n\n    public saveChanges() {\n        this.loading = true;\n        const rulesets = this.rulesets.map((set) => {\n            return {\n                ...set,\n                rules: set.rules.map((i) => {\n                    let value = i[1];\n                    try {\n                        value = JSON.parse(i[1] as any);\n                    } catch (e) {}\n                    return [i[0], value];\n                }) as any,\n            };\n        });\n        this.event.emit({ reason: 'done', metadata: rulesets });\n    }\n}\n","import { Component, EventEmitter, Output } from '@angular/core';\nimport { csvToJson, DialogEvent, downloadFile } from '@placeos/common';\nimport { CateringItem } from './catering-item.class';\n\n@Component({\n    selector: 'catering-import-menu-modal',\n    template: `\n        <header class=\"h-12 bg-primary flex items-center justify-between px-4\">\n            <h2>Import Catering Menu</h2>\n            <button mat-icon-button mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main *ngIf=\"!loading; else load_state\">\n            <div\n                class=\"relative flex flex-col items-center justify-center space-y-2 h-[24rem] w-[24rem] border-4 border-gray-200 border-dashed rounded-xl hover:bg-gray-100 m-4 p-4 cursor-pointer\"\n            >\n                <app-icon class=\"text-4xl\">upload</app-icon>\n                <p>Click to select file or Drag and drop files</p>\n                <input\n                    type=\"file\"\n                    class=\"absolute inset-0 opacity-0\"\n                    (change)=\"handleFileEvent($event)\"\n                />\n            </div>\n            <div class=\"flex items-center justify-center px-4 pb-4\">\n                <button\n                    mat-button\n                    class=\"clear underline w-48\"\n                    (click)=\"downloadTemplate()\"\n                >\n                    Download Template\n                </button>\n            </div>\n        </main>\n        <ng-template #load_state>\n            <main\n                class=\"flex flex-col items-center justify-center space-y-2 p-8 h-[24rem] w-[24rem]\"\n            >\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class CateringImportMenuModalComponent {\n    @Output() public event = new EventEmitter<DialogEvent>();\n    public loading: string;\n\n    /** Upload the image to the cloud */\n    public handleFileEvent(event: DragEvent) {\n        this.loading = 'Processing menu data...';\n        const element: HTMLInputElement = event.target as any;\n        if (!element?.files) return (this.loading = '');\n        const files: FileList = element.files;\n        if (!files.length) return (this.loading = '');\n        const file = files[0];\n        const fileReader = new FileReader();\n        fileReader.addEventListener('loadend', (e: any) => {\n            const contents = e.target.result;\n            const data = csvToJson(contents);\n            this.loading = '';\n            this.event.emit({\n                reason: 'done',\n                metadata: data\n                    .filter((_) => (_.type || '').toLowerCase() === 'item')\n                    .map(\n                        (i) =>\n                            new CateringItem({\n                                ...i,\n                                options: data\n                                    .filter(\n                                        (_) =>\n                                            (_.type || '').toLowerCase() ===\n                                                'option' && _.tags === i.id\n                                    )\n                                    .map((_) => ({\n                                        id: _.id,\n                                        name: _.name,\n                                        group: _.category,\n                                        multiple: _.multiple,\n                                        unit_price: _.unit_price,\n                                    })),\n                            })\n                    ),\n            });\n        });\n        fileReader.readAsText(file);\n    }\n\n    public downloadTemplate() {\n        const template = `ID,Type,Name,Unit Price,Category,Description,Tags,Multiple\nitem-1,item,Coffee,200,Drink,Wake Up,,\noption-1,option,1 Sugar,20,Sugars,,item-1,false`;\n        downloadFile('import-menu-template.csv', template);\n    }\n}\n","import { COMMA, ENTER, SPACE } from '@angular/cdk/keycodes';\nimport { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { MatChipInputEvent } from '@angular/material/chips';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { DialogEvent, randomInt } from '@placeos/common';\nimport { CateringItem } from './catering-item.class';\n\nexport interface CateringItemModalData {\n    item: CateringItem;\n    categories?: string[];\n}\n\n@Component({\n    selector: 'catering-item-modal',\n    template: `\n        <header>\n            <h3 mat-dialog-title>{{ item.id ? 'Edit' : 'Add' }} Item</h3>\n            <button mat-icon-button mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <form\n            class=\"p-4 overflow-auto\"\n            *ngIf=\"form && !loading; else load_state\"\n            [formGroup]=\"form\"\n        >\n            <div class=\"field\" *ngIf=\"form.controls.name\">\n                <label\n                    for=\"title\"\n                    [class.error]=\"\n                        form.controls.name.invalid && form.controls.name.touched\n                    \"\n                >\n                    Name<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        placeholder=\"Item name\"\n                        formControlName=\"name\"\n                    />\n                    <mat-error>Name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.category\">\n                <label\n                    for=\"category\"\n                    [class.error]=\"\n                        form.controls.category.invalid &&\n                        form.controls.category.touched\n                    \"\n                >\n                    Category<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"category\"\n                        placeholder=\"Category\"\n                        formControlName=\"category\"\n                        [matAutocomplete]=\"auto\"\n                    />\n                    <mat-error>Category is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.tags\">\n                <label\n                    for=\"tags\"\n                    [class.error]=\"\n                        form.controls.tags.invalid && form.controls.tags.touched\n                    \"\n                    i18n=\"@@tagsLabel\"\n                >\n                    Tags:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <mat-chip-list #chipList aria-label=\"Item Tags\">\n                        <mat-chip\n                            *ngFor=\"let tag of tag_list\"\n                            [selectable]=\"true\"\n                            [removable]=\"true\"\n                            (removed)=\"removeTag(tag)\"\n                        >\n                            {{ tag }}\n                            <app-icon\n                                matChipRemove\n                                [icon]=\"{\n                                    class: 'material-icons',\n                                    content: 'close'\n                                }\"\n                            ></app-icon>\n                        </mat-chip>\n                        <input\n                            name=\"tags\"\n                            placeholder=\"Zone tags...\"\n                            i18n-placeholder=\"@@zoneTagsPlaceholder\"\n                            [matChipInputFor]=\"chipList\"\n                            [matChipInputSeparatorKeyCodes]=\"separators\"\n                            [matChipInputAddOnBlur]=\"true\"\n                            (matChipInputTokenEnd)=\"addTag($event)\"\n                        />\n                    </mat-chip-list>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.description\">\n                <label for=\"description\">Description:</label>\n                <mat-form-field appearance=\"outline\">\n                    <textarea\n                        matInput\n                        name=\"description\"\n                        placeholder=\"Item Description\"\n                        formControlName=\"description\"\n                    ></textarea>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.unit_price\">\n                <label\n                    for=\"title\"\n                    [class.error]=\"\n                        form.controls.unit_price.invalid &&\n                        form.controls.unit_price.touched\n                    \"\n                >\n                    Unit Price<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"unit-price\"\n                        type=\"number\"\n                        placeholder=\"Unit Price\"\n                        formControlName=\"unit_price\"\n                    />\n                    <mat-error>Unit Price is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"flex items-center\">\n                <label class=\"flex-none w-28 min-w-0\">Accept Points?</label>\n                <mat-checkbox formControlName=\"accept_points\">{{\n                    form.get('accept_points')?.value ? 'No' : 'Yes'\n                }}</mat-checkbox>\n            </div>\n            <div class=\"flex items-center\">\n                <label class=\"flex-1 w-24 min-w-0\">Discount Cap</label>\n                <a-counter\n                    class=\"border border-gray-200 rounded\"\n                    formControlName=\"discount_cap\"\n                    [min]=\"0\"\n                    [max]=\"100\"\n                    [step]=\"5\"\n                    [render_fn]=\"renderPercent\"\n                ></a-counter>\n            </div>\n        </form>\n        <footer\n            *ngIf=\"!loading\"\n            class=\"flex p-2 items-center justify-center border-t border-solid border-gray-300\"\n        >\n            <button mat-button [disabled]=\"!form.dirty\" (click)=\"saveChanges()\">\n                Save\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <div class=\"flex flex-col items-center p-8 space-y-2 w-64\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving catering item...</p>\n            </div>\n        </ng-template>\n        <mat-autocomplete #auto=\"matAutocomplete\">\n            <mat-option *ngFor=\"let option of categories\" [value]=\"option\">\n                {{ option }}\n            </mat-option>\n        </mat-autocomplete>\n    `,\n    styles: [\n        `\n            .field {\n                display: flex;\n                flex-wrap: wrap;\n            }\n        `,\n    ],\n})\nexport class CateringItemModalComponent {\n    /** Emitter for events on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Form fields for item */\n    public form = new FormGroup({\n        name: new FormControl(this.item.name || '', [Validators.required]),\n        description: new FormControl(this.item.description || ''),\n        category: new FormControl(this.item.category || '', [\n            Validators.required,\n        ]),\n        unit_price: new FormControl(this.item.unit_price, [\n            Validators.required,\n        ]),\n        tags: new FormControl(this.item.tags || []),\n        accept_points: new FormControl(this.item.accept_points || false),\n        discount_cap: new FormControl(this.item.discount_cap || 0),\n    });\n    /** Whether changes are being saved */\n    public loading = false;\n    /** List of separator characters for tags */\n    public readonly separators: number[] = [ENTER, COMMA, SPACE];\n\n    /** Current item details */\n    public get item(): CateringItem {\n        return this._data.item || new CateringItem();\n    }\n\n    /** List of available categories */\n    public get categories(): string[] {\n        return this._data.categories || [];\n    }\n\n    public get tag_list(): string[] {\n        return this.form.controls.tags.value;\n    }\n\n    public renderPercent(value: number = 0) {\n        return `${value}%`;\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: CateringItemModalData\n    ) {}\n\n    /**\n     * Add a tag to the list of tags for the item\n     * @param event Input event\n     */\n    public addTag(event: MatChipInputEvent): void {\n        if (!this.form || !this.form.controls.tags) return;\n        this.form.controls.tags.markAsDirty();\n        const input = event.input;\n        const value = event.value;\n        const tag_list = this.tag_list;\n        if ((value || '').trim()) {\n            tag_list.push(value);\n            this.form.controls.tags.setValue(tag_list);\n        }\n\n        // Reset the input value\n        if (input) {\n            input.value = '';\n        }\n    }\n\n    /**\n     * Remove tag from the list\n     * @param existing_tag Tag to remove\n     */\n    public removeTag(existing_tag: string): void {\n        if (!this.form || !this.form.controls.tags) return;\n        const tag_list = this.tag_list;\n        this.form.controls.tags.markAsDirty();\n        const index = tag_list.indexOf(existing_tag);\n\n        if (index >= 0) {\n            tag_list.splice(index, 1);\n            this.form.controls.tags.setValue(tag_list);\n        }\n    }\n\n    public saveChanges() {\n        this.loading = true;\n        this.event.emit({\n            reason: 'done',\n            metadata: {\n                item: new CateringItem({\n                    ...this.item,\n                    id: this.item.id || `item-${randomInt(9999_9999)}`,\n                    ...this.form.value,\n                }),\n            },\n        });\n    }\n}\n","import { CateringOption } from './catering.interfaces';\n\nexport class CateringItem {\n    /** ID of the catering item */\n    public readonly id: string;\n    /** Display name for the catering item */\n    public readonly name: string;\n    /** Category that this item is associated */\n    public readonly category: string;\n    /** Description of the contents of the catering item */\n    public readonly description: string;\n    /** Unit price in cents for the catering item */\n    public readonly unit_price: number;\n    /** Number of item in the associated order */\n    public readonly quantity: number;\n    /** List of options for the catering item */\n    public readonly options: CateringOption[];\n    /** List of attributes assoicated with the catering item */\n    public readonly tags: string[];\n    /** Whether catering items can be purchased using points */\n    public readonly accept_points: boolean;\n    /** Max percentage of the cost that can be covered using points */\n    public readonly discount_cap: number;\n    /** Total cost for the item */\n    public readonly total_cost: number;\n    /** String list of available options */\n    public readonly options_string: string;\n    /** List of images for the catering item */\n    public readonly images: string[];\n    /** List of active options for the  */\n    public readonly option_list: CateringOption[];\n    /**  */\n    public readonly unit_price_with_options: number;\n\n    constructor(data: Partial<CateringItem> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || data.id || '';\n        this.category = data.category || '';\n        this.unit_price = data.unit_price || 0;\n        this.description = data.description || '';\n        this.quantity = data.quantity || 0;\n        this.discount_cap = data.discount_cap || 0;\n        this.accept_points = !!data.accept_points;\n        this.options = data.options || [];\n        this.tags = data.tags || [];\n        this.images = data.images || [];\n        this.option_list = this.options.filter((_) => _.active);\n        this.unit_price_with_options =\n            this.unit_price +\n            this.option_list\n                .map((i) => i.unit_price || 0)\n                .reduce((c, a) => c + a, 0);\n        this.total_cost = this.unit_price_with_options * this.quantity;\n        this.options_string =\n            this.options\n                ?.map((_) => _.id || '')\n                .sort((a, b) => a.localeCompare(b))\n                .join(',') || '';\n    }\n}\n","import { Component, forwardRef } from \"@angular/core\";\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from \"@angular/forms\";\nimport { MatDialog } from \"@angular/material/dialog\";\nimport { SettingsService } from \"@placeos/common\";\n\nimport { CateringItem } from \"libs/catering/src/lib/catering-item.class\";\nimport { NewCateringOrderModalComponent } from 'libs/catering/src/lib/catering-order-modal/new-catering-order-modal.component';\n\nconst EMPTY_FAVS = [];\n\n@Component({\n    selector: `catering-list-field`,\n    template: `\n    <div list class=\"space-y-2\">\n        <div\n            space\n            class=\"relative p-2 rounded-lg w-full flex items-center shadow border border-gray-200\"\n            *ngFor=\"let item of items\"\n        >\n            <div class=\"w-16 h-16 rounded-xl bg-black/20 mr-4\"></div>\n            <div class=\"pb-4\">\n                <div class=\"font-medium\">\n                    {{ item.name || 'Item' }}\n                </div>\n                <div>{{ item.quantity }} requested</div>\n                <div\n                    class=\"absolute bottom-0 right-0 flex items-center justify-end text-xs\"\n                >\n                    <button\n                        mat-button\n                        edit-space\n                        class=\"clear\"\n                        (click)=\"addItems(item)\"\n                    >\n                        <div class=\"flex items-center space-x-2\">\n                            <app-icon>edit</app-icon>\n                            Change\n                        </div>\n                    </button>\n                    <button\n                        mat-button\n                        remove-space\n                        class=\"clear\"\n                        (click)=\"removeItem(item)\"\n                    >\n                        <div class=\"flex items-center space-x-2\">\n                            <app-icon>close</app-icon>\n                            Remove\n                        </div>\n                    </button>\n                </div>\n            </div>\n            <button\n                mat-icon-button\n                fav\n                class=\"absolute top-1 right-1\"\n                [class.text-blue-400]=\"favorites.includes(item.id)\"\n                (click)=\"toggleFavourite(item)\"\n            >\n                <app-icon>{{\n                    favorites.includes(item.id)\n                        ? 'favorite'\n                        : 'favorite_border'\n                }}</app-icon>\n            </button>\n        </div>\n    </div>\n    <button\n        mat-button\n        add-space\n        class=\"w-full inverse mt-2\"\n        [disabled]=\"disabled\"\n        (click)=\"addItems()\"\n    >\n        <div class=\"flex items-center justify-center space-x-2\">\n            <app-icon>search</app-icon>\n            <span>Add Item</span>\n        </div>\n    </button>`,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => CateringListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class CateringListFieldComponent implements ControlValueAccessor {\n    public items: CateringItem[] = [];\n    public disabled = false;\n\n    private _onChange: (_: CateringItem[]) => void;\n    private _onTouch: (_: CateringItem[]) => void;\n    public selected: CateringItem[] = [];\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_menu_items') || EMPTY_FAVS;\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {}\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: CateringItem[]) {\n        this.items = new_value;\n        if (this._onChange) this._onChange(this.items);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: CateringItem[]) {\n        this.items = value || [];\n    }\n\n    public readonly registerOnChange = (fn: (_: CateringItem[]) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: CateringItem[]) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n\n    public removeItem(item: CateringItem) {\n        const updated_list = this.items.filter((_) => _.id !== item.id);\n        this.setValue(updated_list);\n    }\n\n    public addItems(item?: CateringItem) {\n        const ref = this._dialog.open(NewCateringOrderModalComponent, {\n            data: this.items,\n        });\n        ref.afterClosed().subscribe((items?: CateringItem[]) => {\n            if (!items) return;\n            this.setValue(items);\n        });\n    }\n\n    public toggleFavourite(cateringitem: CateringItem) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(cateringitem.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_menu_items', [\n                ...fav_list,\n                cateringitem.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_menu_items',\n                fav_list.filter((_) => _ !== cateringitem.id)\n            );\n        }\n    }\n}","import { Component, Input } from '@angular/core';\n\nimport { CateringItem } from './catering-item.class';\nimport { CateringStateService } from './catering-state.service';\nimport { CateringOption } from './catering.interfaces';\n\n@Component({\n    selector: '[catering-menu-item]',\n    template: `\n        <div\n            class=\"w-full h-full bg-white dark:bg-neutral-700 border border-gray-300 dark:border-neutral-500 overflow-hidden rounded\"\n        >\n            <div item class=\"flex items-center px-2\" *ngIf=\"item\">\n                <div class=\"flex items-center p-2 flex-1\">\n                    <div class=\"flex-1\">\n                        <div>{{ item.name }}</div>\n                        <div class=\"text-xs opacity-60\">\n                            {{ item.category }}\n                        </div>\n                    </div>\n                    <div\n                        class=\"p-2 m-2 text-xs font-bold text-white rounded bg-primary\"\n                    >\n                        {{ item.unit_price / 100 | currency: (symbol | async) }}\n                    </div>\n                </div>\n                <button mat-icon-button [matMenuTriggerFor]=\"menu\">\n                    <app-icon>more_vert</app-icon>\n                </button>\n                <button\n                    mat-icon-button\n                    [disabled]=\"!item.options.length\"\n                    (click)=\"show_options = !show_options\"\n                >\n                    <app-icon>expand_more</app-icon>\n                </button>\n            </div>\n            <div\n                options\n                *ngIf=\"item\"\n                class=\"bg-gray-100 dark:bg-neutral-700 overflow-hidden\"\n                [style.height]=\"\n                    show_options ? item.options.length * 3.5 + 'rem' : '0'\n                \"\n            >\n                <div\n                    class=\"flex p-2 items-center border-t border-solid border-gray-300 dark:border-neutral-500 relative\"\n                    *ngFor=\"let option of item.options\"\n                >   \n                    <div class=\"absolute inset-y-0 left-0 w-2 bg-gray-400 dark:bg-neutral-600\"></div>\n                    <div class=\"flex-1 pl-4 pr-2\">\n                        <div class=\"text\">{{ option.name }}</div>\n                        <div class=\"text-xs opacity-60\">\n                            {{ option.group }}\n                        </div>\n                    </div>\n                    <button\n                        edit\n                        mat-icon-button\n                        class=\"mx-2\"\n                        (click)=\"editOption(option)\"\n                    >\n                        <app-icon>edit</app-icon>\n                    </button>\n                    <button\n                        remove\n                        mat-icon-button\n                        class=\"mx-2\"\n                        (click)=\"removeOption(option)\"\n                    >\n                        <app-icon>delete</app-icon>\n                    </button>\n                </div>\n            </div>\n            <mat-menu #menu=\"matMenu\">\n                <button\n                    mat-menu-item\n                    class=\"flex items-center\"\n                    (click)=\"addOption()\"\n                >\n                    <app-icon>add</app-icon>\n                    <div class=\"ml-2\">Add Option</div>\n                </button>\n                <button\n                    mat-menu-item\n                    class=\"flex items-center\"\n                    (click)=\"editItem()\"\n                >\n                    <app-icon>edit</app-icon>\n                    <div class=\"ml-2\">Edit Item</div>\n                </button>\n                <button\n                    mat-menu-item\n                    class=\"flex items-center\"\n                    (click)=\"removeItem()\"\n                >\n                    <app-icon>delete</app-icon>\n                    <div class=\"ml-2\">Remove Item</div>\n                </button>\n            </mat-menu>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                overflow: hidden;\n                width: 768px;\n                margin: 0.5rem auto;\n                max-width: calc(100vw - 1rem);\n            }\n\n            button[mat-menu-item] {\n                display: flex;\n            }\n\n            [options] {\n                transition: height 200ms;\n            }\n        `,\n    ],\n})\nexport class CateringMenuItemComponent {\n    /** Item to display */\n    @Input() public item: CateringItem;\n    /** Whether to show item options */\n    public show_options = false;\n\n    public readonly addOption = () => this._catering.addOption(this.item);\n\n    public readonly editOption = (option: CateringOption) =>\n        this._catering.addOption(this.item, option);\n\n    public readonly removeOption = (option: CateringOption) =>\n        this._catering.deleteOption(this.item, option);\n\n    public readonly editItem = () => this._catering.addItem(this.item);\n\n    public readonly removeItem = () => this._catering.deleteItem(this.item);\n\n    /** Currency symbol for active menu */\n    public get symbol() {\n        return this._catering.currency;\n    }\n\n    constructor(private _catering: CateringStateService) {}\n}\n","import { Component } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { CateringStateService } from './catering-state.service';\n\n@Component({\n    selector: 'catering-menu',\n    template: `\n        <mat-tab-group\n            class=\"h-full\"\n            (selectedIndexChange)=\"\n                shown_tab.next($event === 0 ? '' : categories[$event - 1])\n            \"\n        >\n            <mat-tab label=\"All Items\">\n                <ng-container *ngIf=\"(menu | async)?.length; else empty_state\">\n                    <ng-container *ngFor=\"let item of menu | async\">\n                        <div catering-menu-item [item]=\"item\"></div>\n                    </ng-container>\n                </ng-container>\n            </mat-tab>\n            <mat-tab *ngFor=\"let group of categories\" [label]=\"group\">\n                <ng-container *ngFor=\"let item of (tab_menu | async)[group]\">\n                    <div catering-menu-item [item]=\"item\"></div>\n                </ng-container>\n            </mat-tab>\n        </mat-tab-group>\n        <ng-template #empty_state>\n            <div class=\"flex flex-col items-center p-8 space-y-2\">\n                <app-icon>close</app-icon>\n                <p>No items in menu</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 90%;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class CateringMenuComponent {\n    /** Observable for the currently active menu */\n    public readonly menu = this._catering.menu;\n    /** Store for the currently selected tab */\n    public readonly shown_tab = new BehaviorSubject<string>('');\n    /** Observable for the menu list for the selected tab */\n    public readonly tab_menu = this.menu.pipe(\n        map((menu) => {\n            const menu_map = {};\n            for (const group of this.categories) {\n                menu_map[group] = menu.filter(\n                    (item) => item.category === group\n                );\n            }\n            return menu_map;\n        })\n    );\n\n    public get categories() {\n        return this._catering.categories;\n    }\n\n    constructor(private _catering: CateringStateService) {}\n}\n","import { Component, EventEmitter, Inject, OnInit, Output } from '@angular/core';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { DialogEvent } from 'libs/common/src/lib/types';\nimport { randomInt } from 'libs/common/src/lib/general';\n\nimport { CateringItem } from './catering-item.class';\nimport { CateringOption } from './catering.interfaces';\n\nexport interface CateringItemOptionModalData {\n    parent: CateringItem;\n    option: CateringOption;\n    types: string[];\n}\n\n@Component({\n    selector: 'catering-option-modal',\n    template: `\n        <header>\n            <h3 mat-dialog-title>\n                {{ option.id ? 'Edit' : 'Add' }} Item Option\n            </h3>\n            <button mat-icon-button mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <form\n            class=\"p-4 overflow-auto\"\n            *ngIf=\"form && !loading; else load_state\"\n            [formGroup]=\"form\"\n        >\n            <div class=\"field\" *ngIf=\"form.controls.name\">\n                <label\n                    for=\"title\"\n                    [class.error]=\"\n                        form.controls.name.invalid && form.controls.name.touched\n                    \"\n                >\n                    Name<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        placeholder=\"Item name\"\n                        formControlName=\"name\"\n                    />\n                    <mat-error>Name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.group\">\n                <label\n                    for=\"group\"\n                    [class.error]=\"\n                        form.controls.group.invalid &&\n                        form.controls.group.touched\n                    \"\n                >\n                    Type<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"group\"\n                        placeholder=\"Type of option e.g. Number of sugars\"\n                        formControlName=\"group\"\n                        [matAutocomplete]=\"auto\"\n                    />\n                    <mat-error>Type is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.unit_price\">\n                <label for=\"title\">Unit Price:</label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"unit-price\"\n                        type=\"number\"\n                        placeholder=\"Unit Price\"\n                        formControlName=\"unit_price\"\n                    />\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.multiple\">\n                <mat-checkbox name=\"multiple\" formControlName=\"multiple\">\n                    Can select multiple of type\n                </mat-checkbox>\n            </div>\n        </form>\n        <footer\n            *ngIf=\"!loading\"\n            class=\"flex p-2 items-center justify-center border-t border-solid border-gray-300\"\n        >\n            <button mat-button [disabled]=\"!form.dirty\" (click)=\"saveChanges()\">\n                Save\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <div loading class=\"flex flex-col items-center p-8 space-y-2 w-64\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving catering item option...</p>\n            </div>\n        </ng-template>\n        <mat-autocomplete #auto=\"matAutocomplete\">\n            <mat-option *ngFor=\"let option of types\" [value]=\"option\">\n                {{ option }}\n            </mat-option>\n        </mat-autocomplete>\n    `,\n    styles: [\n        `\n            .field {\n                display: flex;\n                flex-wrap: wrap;\n            }\n        `,\n    ],\n})\nexport class CateringItemOptionModalComponent {\n    /** Emitter for events on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Form fields for item */\n    public form = new FormGroup({\n        name: new FormControl(this.option.name || '', [Validators.required]),\n        group: new FormControl(this.option.group || '', [Validators.required]),\n        unit_price: new FormControl(this.option.unit_price),\n        multiple: new FormControl(!!this.option.multiple, []),\n    });\n    /** Whether changes are being saved */\n    public loading = false;\n\n    /** Current item details */\n    public get option(): CateringOption {\n        return this._data.option;\n    }\n\n    /** List of available categories */\n    public get types(): string[] {\n        return this._data.types || [];\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: CateringItemOptionModalData\n    ) {}\n\n    public saveChanges() {\n        this.loading = true;\n        const new_option = {\n            ...this.option,\n            id: this.option.id || `option-${randomInt(9999_9999)}`,\n            ...this.form.value,\n        } as CateringOption;\n        this.event.emit({\n            reason: 'done',\n            metadata: {\n                item: new CateringItem({\n                    ...this._data.parent,\n                    options: this._data.parent.options\n                        .filter((i) => i.id !== new_option.id)\n                        .concat([new_option]),\n                }),\n            },\n        });\n    }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { CateringItem } from './catering-item.class';\n\n@Component({\n    selector: '[catering-order-item]',\n    template: `\n        <ng-container *ngIf=\"item\">\n            <div class=\"w-20 text-right h-14 relative\">\n                <div class=\"border-b-2 border-l-2 border-gray-400 dark:border-neutral-500 w-4 h-16 absolute top-1/2 left-1/2 -translate-y-full\"></div>\n            </div>\n            <div class=\"w-12 mr-4\">\n                <button\n                    action\n                    mat-icon-button\n                    class=\"border border-gray-300 dark:border-neutral-500 border-dashed text-xl text-dark-fade p-2\"\n                    [class.bg-success]=\"active\"\n                    [class.text-white]=\"active\"\n                    [class.border-solid]=\"active\"\n                    (click)=\"active = !active\"\n                >\n                    <app-icon>{{ active ? 'done' : 'local_pizza' }}</app-icon>\n                </button>\n            </div>\n            <div class=\"flex flex-1 border-b border-gray-300 dark:border-neutral-500 border-solid py-4\">\n                <div class=\"flex-1\">{{ item?.name }}</div>\n                <div class=\"flex space-x-2 mr-2\">\n                    <ng-container *ngFor=\"let opt of item.options\">\n                        <div class=\"text-xs py-1 px-2 bg-yellow-300 text-black rounded-2xl shadow\" *ngIf=\"opt\">{{ opt.name }}</div>\n                    </ng-container>\n                </div>\n            </div>\n        </ng-container>\n    `,\n    styles: [\n        `\n            :host:last-child > div {\n                border: none !important;\n            }\n        `,\n    ],\n})\nexport class CateringOrderItemComponent {\n    @Input() public item: CateringItem;\n\n    public active = false;\n}\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { CateringOrder } from './catering-order.class';\n\nimport { CateringOrdersService } from './catering-orders.service';\n\n@Component({\n    selector: 'catering-order-list',\n    template: `\n        <div\n            class=\"sticky top-0 w-full text-sm font-medium flex items-center py-4 border-solid border-b border-gray-300 bg-white dark:bg-neutral-800 dark:border-neutral-500\"\n        >\n            <div class=\"w-20\"></div>\n            <div class=\"w-24\">Time</div>\n            <div class=\"flex-1\">Location</div>\n            <div class=\"w-56\">Host</div>\n            <div class=\"w-24\">Charge Code</div>\n            <div class=\"w-28\">Invoice No.</div>\n            <div class=\"w-36\">Status</div>\n            <div class=\"w-12\"></div>\n        </div>\n        <ul class=\"list-none p-0 m-0 w-full flex-1 overflow-auto\">\n            <li\n                class=\"border-solid border-b border-gray-300 dark:border-neutral-500\"\n                *ngFor=\"let order of order_list | async; trackBy: trackByFn\"\n            >\n                <catering-order [order]=\"order\"></catering-order>\n            </li>\n            <div\n                empty\n                class=\"info-block opacity-60\"\n                *ngIf=\"!(order_list | async)?.length\"\n            >\n                <p>No Catering Orders</p>\n            </div>\n        </ul>\n        <mat-progress-bar\n            *ngIf=\"loading | async\"\n            class=\"w-full\"\n            mode=\"indeterminate\"\n        ></mat-progress-bar>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class CateringOrderListComponent implements OnInit, OnDestroy {\n    /** List of filtered orders */\n    public readonly order_list = this._orders.filtered;\n    /** Whether order list is loading */\n    public readonly loading = this._orders.loading;\n\n    constructor(private _orders: CateringOrdersService) {}\n\n    public ngOnInit() {\n        this._orders.startPolling();\n    }\n\n    public ngOnDestroy() {\n        this._orders.stopPolling();\n    }\n\n    /* istanbul ignore next */\n    public trackByFn(index: number, order: CateringOrder) {\n        return order ? order.id : undefined;\n    }\n}\n","import { Component, Inject, Output, EventEmitter, OnInit } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { isAfter, setHours, isBefore } from 'date-fns';\nimport { Observable } from 'rxjs';\n\nimport { BaseClass, DialogEvent, HashMap, unique } from '@placeos/common';\nimport { CalendarEvent } from 'libs/events/src/lib/event.class';\nimport { stringToMinutes } from 'libs/events/src/lib/helpers';\n\nimport { CateringItem } from './catering-item.class';\nimport { CateringOrder } from './catering-order.class';\nimport { CateringOption, CateringRuleset } from './catering.interfaces';\nimport { OrganisationService } from '@placeos/organisation';\n\nexport interface CateringOrderModalData {\n    order: CateringOrder;\n    code: string;\n    menu: Observable<CateringItem[]>;\n    loading: Observable<boolean>;\n    getCateringConfig: (_: string) => Promise<CateringRuleset[]>;\n    selectOptions: (_: CateringOption[]) => Promise<CateringOption[]>;\n}\n\nexport function cateringItemAvailable(\n    item: CateringItem,\n    rules: CateringRuleset[],\n    event: CalendarEvent\n) {\n    let is_available = true;\n    for (const rule of rules) {\n        if (\n            item.category === rule.name ||\n            item.tags.includes(rule.name) ||\n            event.space?.zones.includes(rule.name) ||\n            rule.name === '*'\n        ) {\n            let matches = 0;\n            for (const condition of rule.rules) {\n                const date = new Date(event.date);\n                switch (condition[0]) {\n                    case 'after_hour':\n                        matches += isAfter(date, setHours(date, condition[1]))\n                            ? 1\n                            : 0;\n                        break;\n                    case 'before_hour':\n                        matches += isBefore(date, setHours(date, condition[1]))\n                            ? 1\n                            : 0;\n                        break;\n                    case 'min_length':\n                        matches +=\n                            event.duration >= stringToMinutes(condition[1])\n                                ? 1\n                                : 0;\n                        break;\n                    case 'max_length':\n                        matches +=\n                            event.duration <= stringToMinutes(condition[1])\n                                ? 1\n                                : 0;\n                        break;\n                    case 'visitor_type':\n                        matches +=\n                            event.ext('visitor_type') === condition[1] ? 1 : 0;\n                        break;\n                    default:\n                        matches++;\n                }\n            }\n            is_available = matches >= rule.rules.length;\n        }\n    }\n    return is_available;\n}\n\n// TODO: Split template into 2 children components. Order menu and Order Confirm;\n\n@Component({\n    selector: 'app-catering-order-modal',\n    template: `\n        <div class=\"main min-w-[20rem]\" *ngIf=\"!loading; else load_state\">\n            <ng-container *ngIf=\"!show_order_details; else order_details\">\n                <mat-tab-group>\n                    <ng-container *ngFor=\"let cat of categories\">\n                        <mat-tab\n                            *ngIf=\"(menu_items || {})[cat].length\"\n                            [label]=\"cat\"\n                        >\n                            <div class=\"list\">\n                                <div\n                                    item\n                                    class=\"flex items-center p-2 border-b border-gray-200\"\n                                    *ngFor=\"let item of (menu_items || {})[cat]\"\n                                >\n                                    <div class=\"flex-1 w-1/2\">\n                                        <div class=\"flex-1 w-1/2\">\n                                            {{ item.name }}\n                                        </div>\n                                        <div\n                                            class=\"text-xs no-underline\"\n                                            *ngIf=\"item.options.length\"\n                                        >\n                                            Options Available\n                                        </div>\n                                    </div>\n                                    <div\n                                        class=\"bg-primary text-xs rounded px-4 py-2 mx-2 text-white font-medium\"\n                                    >\n                                        {{ item.unit_price / 100 | currency:code }}\n                                    </div>\n                                    <a-counter\n                                        ngDefaultControl\n                                        [ngModel]=\"item.quantity\"\n                                        (ngModelChange)=\"\n                                            updateItemQuantity(item, $event)\n                                        \"\n                                        *ngIf=\"!item.options.length\"\n                                    ></a-counter>\n                                    <div\n                                        class=\"flex items-center\"\n                                        *ngIf=\"item.options.length\"\n                                    >\n                                        <div\n                                            [matTooltip]=\"\n                                                item.quantity\n                                                    ? 'Items with options must be removed from order confirmation page'\n                                                    : ''\n                                            \"\n                                        >\n                                            <button\n                                                mat-icon-button\n                                                [disabled]=\"true\"\n                                            >\n                                                <app-icon>remove</app-icon>\n                                            </button>\n                                        </div>\n                                        <div\n                                            class=\"count h-12 w-12 flex items-center justify-center\"\n                                        >\n                                            {{ item.quantity }}\n                                        </div>\n                                        <button\n                                            mat-icon-button\n                                            (click)=\"addItem(item)\"\n                                        >\n                                            <app-icon>add</app-icon>\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </mat-tab>\n                    </ng-container>\n                </mat-tab-group>\n            </ng-container>\n        </div>\n        <footer\n            *ngIf=\"!loading\"\n            class=\"flex items-center justify-center space-x-2 p-2 border-t border-gray-200\"\n        >\n            <ng-container *ngIf=\"!show_order_details; else order_actions\">\n                <button mat-button class=\"inverse\" mat-dialog-close>\n                    Cancel\n                </button>\n                <button\n                    confirm\n                    mat-button\n                    [disabled]=\"!order.item_count\"\n                    [matBadge]=\"order.item_count\"\n                    [matBadgeHidden]=\"!order.item_count\"\n                    matBadgeColor=\"warn\"\n                    (click)=\"show_order_details = true\"\n                >\n                    Confirm\n                </button>\n            </ng-container>\n            <ng-template #order_actions>\n                <button\n                    mat-button\n                    class=\"inverse\"\n                    (click)=\"show_order_details = false\"\n                >\n                    Back\n                </button>\n                <button save mat-button (click)=\"saveOrder()\">\n                    Save Order\n                </button>\n            </ng-template>\n        </footer>\n        <ng-template #load_state>\n            <div class=\"flex flex-col w-64 p-8 items-center space-y-2\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </div>\n        </ng-template>\n        <ng-template #order_details>\n            <header class=\"h-[3.25rem]\">\n                <h3>Confirm Order</h3>\n            </header>\n            <div class=\"list\">\n                <div\n                    item\n                    class=\"flex items-center p-2 border-b border-gray-50\"\n                    *ngFor=\"let item of order.items\"\n                >\n                    <div class=\"flex-1 w-1/2\">\n                        <div class=\"flex-1 w-1/2\">{{ item.name }}</div>\n                        <div\n                            class=\"text-xs underline\"\n                            *ngIf=\"item.options.length\"\n                            [matTooltip]=\"optionsFor(item)\"\n                        >\n                            {{ item.options.length }} option{{\n                                item.options.length === 1 ? '' : 's'\n                            }}\n                            selected\n                        </div>\n                    </div>\n                    <div\n                        class=\"bg-primary text-xs rounded px-4 py-2 mx-2 text-white font-medium\"\n                    >\n                        {{ item.total_cost / 100 | currency:code }}\n                    </div>\n                    <a-counter\n                        [ngModel]=\"item.quantity\"\n                        (ngModelChange)=\"updateItemQuantity(item, $event)\"\n                    ></a-counter>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            .list {\n                height: 24em;\n                min-width: 32em;\n                max-width: calc(100vw - 1em);\n            }\n\n            footer button {\n                min-width: 12em;\n            }\n\n            input {\n                position: relative;\n                width: 100%;\n                padding: 1em;\n                border: none;\n                border-radius: 0 !important;\n                border-top: 1px solid #ccc;\n                border-bottom: 1px solid #ccc;\n                outline: none;\n                font-size: 1em;\n            }\n\n            input:focus {\n                border: none;\n                border-top: 2px solid var(--primary);\n                border-bottom: 2px solid var(--primary);\n                box-shadow: none;\n            }\n\n            input.error::placeholder {\n                color: rgba(var(--error), 0.45);\n            }\n        `,\n    ],\n})\nexport class CateringOrderModalComponent extends BaseClass implements OnInit {\n    /** Emitter for events on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Whether changes are being saved */\n    public loading = '';\n    /** Current order */\n    public order: CateringOrder;\n    /** Name of the active category */\n    public category: string;\n    /** Whether order details should be shown */\n    public show_order_details: boolean;\n    /** Catering rules for selected space */\n    public rules: readonly CateringRuleset[];\n    /** List of menu items to show */\n    public menu_items: HashMap<CateringItem[]> = {};\n    /** List of categories for the active menu */\n    public categories: string[] = [];\n    \n    public get code() {\n        return this._org.currency_code;\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        @Inject(MAT_DIALOG_DATA) private _data: CateringOrderModalData\n    ) {\n        super();\n        this.loading = 'Loading menu...';\n    }\n\n    public async ngOnInit() {\n        this.loading = 'Loading menu...';\n        this.order = new CateringOrder(this._data.order);\n        this.rules = await this._data.getCateringConfig(\n            this.order.event?.space?.level?.parent_id\n        );\n        this._data.menu.subscribe((list) => {\n            this.loading = 'Loading menu...';\n            const categories = unique(list.map((item) => item.category));\n            const map = {};\n            for (const cat of categories) {\n                map[cat] = list.filter((item) => {\n                    return (\n                        item.category === cat &&\n                        cateringItemAvailable(\n                            item,\n                            this.rules as any,\n                            this.order.event\n                        )\n                    );\n                });\n            }\n            this.categories = categories;\n            this.menu_items = map;\n            this.updateMenuQuantities();\n            this.timeout('clear_loading', () => (this.loading = ''), 1000);\n        });\n    }\n\n    public addItem(item: CateringItem, choose_options: boolean = true) {\n        const old_item = this.order.items.find(\n            (itm) =>\n                itm.id === item.id &&\n                itm.options.length ===\n                    itm.options.reduce(\n                        (c, o) =>\n                            c +\n                            (item.options.find((opt) => o.id === opt.id)\n                                ? 1\n                                : 0),\n                        0\n                    )\n        );\n        if (choose_options && item.options?.length) {\n            this._data.selectOptions(item.options).then((options) => {\n                const new_item = new CateringItem({ ...item, options });\n                this.addItem(new_item, false);\n            });\n        } else if (old_item) {\n            this.order = new CateringOrder({\n                ...this.order,\n                items: this.order.items\n                    .filter(\n                        (i) =>\n                            !(\n                                i.id === item.id &&\n                                i.options_string === item.options_string\n                            )\n                    )\n                    .concat([\n                        new CateringItem({\n                            ...item,\n                            quantity: old_item.quantity + 1,\n                        }),\n                    ]),\n            });\n        } else {\n            this.order = new CateringOrder({\n                ...this.order,\n                items: this.order.items.concat([\n                    new CateringItem({ ...item, quantity: 1 }),\n                ]),\n            });\n        }\n        this.updateMenuQuantities();\n    }\n\n    public removeItem(item: CateringItem) {\n        this.order = new CateringOrder({\n            ...this.order,\n            items: this.order.items.filter(\n                (_) =>\n                    _.id !== item.id && _.options_string === item.options_string\n            ),\n        });\n        this.updateMenuQuantities();\n    }\n\n    public updateItemQuantity(item: CateringItem, amount: number) {\n        const old_item = this.order.items.find(\n            (itm) =>\n                itm.id === item.id && itm.options_string === item.options_string\n        );\n        let items = [...this.order.items];\n        if (old_item) {\n            items = this.order.items\n                .filter(\n                    (i) =>\n                        !(\n                            i.id === item.id &&\n                            i.options_string === item.options_string\n                        )\n                )\n                .concat([new CateringItem({ ...item, quantity: amount })]);\n        } else {\n            items = this.order.items.concat([\n                new CateringItem({ ...item, quantity: amount }),\n            ]);\n        }\n        items.sort((a, b) => a.name.localeCompare(b.name));\n        this.order = new CateringOrder({\n            ...this.order,\n            items,\n        });\n        this.updateMenuQuantities();\n    }\n\n    public updateMenuQuantities() {\n        for (const cat in this.menu_items) {\n            for (const item of this.menu_items[cat]) {\n                (item as any).quantity = this.order.items.reduce(\n                    (c, i) => (i.id === item.id ? c + i.quantity : c),\n                    0\n                );\n            }\n        }\n    }\n\n    public optionsFor(item: CateringItem) {\n        return item.options.map((i) => i.name).join('\\n');\n    }\n\n    public saveOrder() {\n        this.event.emit({\n            reason: 'done',\n            metadata: { order: this.order },\n        });\n    }\n\n    public confirmOrder() {\n        this.show_order_details = true;\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { unique } from '@placeos/common';\nimport { CateringItem } from '../catering-item.class';\nimport { CateringOption } from '../catering.interfaces';\n\ninterface CateringOptionGroup {\n    name: string;\n    multiple: boolean;\n    options: CateringOption[];\n}\n\n@Component({\n    selector: 'catering-item-details',\n    template: `\n        <ng-container *ngIf=\"item; else empty_state\">\n            <section image class=\"relative w-full h-64 sm:h-40 bg-black/20\">\n                <image-carousel\n                    [images]=\"item.images\"\n                    class=\"absolute inset-0\"\n                ></image-carousel>\n                <button\n                    mat-icon-button\n                    close\n                    (click)=\"close.emit()\"\n                    class=\"absolute top-2 left-2 bg-black/40 sm:hidden text-white\"\n                >\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <button\n                    mat-icon-button\n                    fav\n                    [class.text-white]=\"!fav\"\n                    [class.text-blue-400]=\"fav\"\n                    (click)=\"toggleFav.emit()\"\n                    class=\"absolute top-2 right-2 bg-black/40\"\n                >\n                    <app-icon>{{\n                        fav ? 'favorite' : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </section>\n            <div class=\"p-2 space-y-2 flex-1 h-1/2 overflow-auto\">\n                <section actions class=\"z-0 flex items-center justify-between\">\n                    <div>\n                        <h2 class=\"text-xl font-medium mb-2 mt-4\">\n                            {{ item.name }}\n                        </h2>\n                        <p *ngIf=\"item.unit_price\">\n                            {{ item.unit_price / 100 | currency:code }}\n                        </p>\n                    </div>\n                    <a-counter\n                        [(ngModel)]=\"item.quantity\"\n                        [min]=\"1\"\n                        [max]=\"item.count || 10\"\n                    ></a-counter>\n                </section>\n                <hr />\n                <section details class=\"space-y-2\">\n                    <div class=\"flex flex-col flex-wrap\">\n                        <div\n                            class=\"min-w-1/2 flex-1\"\n                            *ngFor=\"let group of groups\"\n                            [attr.group]=\"group.name\"\n                        >\n                            <div class=\"font-medium p-2 capitalize\">\n                                {{ group.name }}\n                            </div>\n                            <div class=\"flex flex-col pl-4\">\n                                <ng-container\n                                    *ngIf=\"!group.multiple; else multi_options\"\n                                >\n                                    <mat-radio-group\n                                        class=\"flex flex-col\"\n                                        aria-label=\"Select an option\"\n                                        ngModel\n                                        (ngModelChange)=\"\n                                            updateGroupOption(group, $event)\n                                        \"\n                                    >\n                                        <mat-radio-button class=\"m-0\" value=\"\">\n                                            <span class=\"font-medium p-2\"\n                                                >None</span\n                                            >\n                                        </mat-radio-button>\n                                        <mat-radio-button\n                                            class=\"m-0\"\n                                            *ngFor=\"let opt of group?.options\"\n                                            [value]=\"opt.id\"\n                                        >\n                                            <div\n                                                class=\"flex items-center justify-center\"\n                                            >\n                                                <div\n                                                    class=\"font-medium p-2 flex-1 w-1/2\"\n                                                >\n                                                    {{ opt.name }}\n                                                </div>\n                                                <div\n                                                    class=\"opacity-60 text-xs\"\n                                                    *ngIf=\"opt.unit_price\"\n                                                >\n                                                    +{{\n                                                        opt.unit_price / 100\n                                                            | currency:code\n                                                    }}\n                                                </div>\n                                            </div>\n                                        </mat-radio-button>\n                                    </mat-radio-group>\n                                </ng-container>\n                                <ng-template #multi_options>\n                                    <mat-checkbox\n                                        *ngFor=\"let opt of group?.options\"\n                                        [(ngModel)]=\"option_state[opt.id]\"\n                                    >\n                                        <div\n                                            class=\"flex items-center justify-center\"\n                                        >\n                                            <div\n                                                class=\"font-medium p-2 flex-1 w-1/2\"\n                                            >\n                                                {{ opt.name }}\n                                            </div>\n                                            <div\n                                                class=\"opacity-60 text-xs\"\n                                                *ngIf=\"opt.unit_price\"\n                                            >\n                                                +{{\n                                                    opt.unit_price / 100\n                                                        | currency:code\n                                                }}\n                                            </div>\n                                        </div>\n                                    </mat-checkbox>\n                                </ng-template>\n                            </div>\n                        </div>\n                    </div>\n                </section>\n            </div>\n            <div class=\"p-2 border-t border-gray-200 shadow sm:hidden\">\n                <button\n                    mat-button\n                    select\n                    [class.inverse]=\"active\"\n                    class=\"w-full\"\n                    (click)=\"active = !active; activeChange.emit(active)\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <app-icon class=\"text-2xl\">{{\n                            active ? 'remove' : 'add'\n                        }}</app-icon>\n                        <p>\n                            {{ active ? 'Remove this item' : 'Add this item' }}\n                        </p>\n                    </div>\n                </button>\n            </div>\n        </ng-container>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    Select an item to view it's details\n                </p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 30%;\n                min-width: 20rem;\n                height: 100%;\n                min-height: 65vh;\n            }\n        `,\n    ],\n})\nexport class CateringItemDetailsComponent {\n    @Input() public item?: CateringItem;\n    @Input() public active: boolean = false;\n    @Input() public fav: boolean = false;\n    @Input() public code: string = 'USD';\n\n    @Output() public toggleFav = new EventEmitter<void>();\n    @Output() public activeChange = new EventEmitter<boolean>();\n    @Output() public close = new EventEmitter<void>();\n\n    public option_state: Record<string, boolean> = {};\n    public groups: CateringOptionGroup[];\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item && this.item) {\n            this._update();\n        }\n    }\n\n    public updateGroupOption(group: CateringOptionGroup, id: string) {\n        for (const option of group.options) {\n            option.active = option.id === id;\n        }\n    }\n\n    private _update() {\n        if (!this.item.quantity) {\n            (this.item as any).quantity = 1;\n        }\n        const groups = unique(this.item.options.map((i) => i.group || 'Other'));\n        const group_list = [];\n        for (const group of groups) {\n            const options = this.item.options.filter((i) => i.group === group);\n            group_list.push({\n                name: group,\n                multiple: !!options.find((i) => i.multiple),\n                options,\n            });\n        }\n        this.groups = group_list;\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { take } from 'rxjs/operators';\nimport { CateringOrderStateService } from './catering-order-state.service';\n\nconst ICONS = {\n    coffee: `<svg width=\"40\" height=\"40\" viewBox=\"0 0 40 40\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <g clip-path=\"url(#clip0_605_8664)\">\n    <path d=\"M38.388 21.2474C37.8243 20.7996 37.1598 20.4847 36.4474 20.3278C35.735 20.1708 34.9944 20.1762 34.2846 20.3434C34.2476 19.7774 34.2049 19.2037 34.1483 18.6155C34.1243 18.3664 34.0043 18.1349 33.8119 17.9668C33.6195 17.7986 33.3687 17.706 33.1088 17.707H1.26151C1.00166 17.706 0.750839 17.7986 0.558442 17.9668C0.366045 18.1349 0.246035 18.3664 0.222073 18.6155C-0.42931 25.3581 0.106585 30.5307 4.80024 35.4799C8.88062 39.7819 15.7271 39.9998 17.0599 39.9998H17.3047C18.6375 39.9998 25.4863 39.7774 29.5643 35.4799C30.5412 34.4597 31.3937 33.3353 32.1052 32.1286C32.2481 32.1199 32.3875 32.0819 32.514 32.0174C34.0959 31.2139 35.6169 30.3039 37.0656 29.2943C38.3815 28.4227 39.3664 27.1618 39.871 25.7028C40.0702 24.9006 40.0372 24.0612 39.7758 23.2757C39.5144 22.4902 39.0344 21.7887 38.388 21.2474ZM28.0329 34.13C24.4699 37.8905 18.0323 37.9984 17.3093 37.9984H17.0645C16.3426 37.9984 9.90389 37.8872 6.34092 34.13C2.37257 29.9436 1.75351 25.466 2.21549 19.7085H32.1583C32.6214 25.4649 32.0024 29.9425 28.0329 34.13ZM37.8498 25.2091C37.4485 26.2369 36.7212 27.117 35.771 27.7243C35.024 28.2636 34.2434 28.7582 33.4334 29.2053C34.1268 27.0036 34.4428 24.7078 34.3689 22.4082C34.3839 22.4027 34.3989 22.4082 34.4139 22.3982C34.8447 22.2182 35.3192 22.1579 35.7837 22.2242C36.2482 22.2905 36.6841 22.4808 37.0421 22.7733C37.4001 23.0659 37.6658 23.4491 37.8092 23.8796C37.9525 24.3101 37.9678 24.7707 37.8533 25.2091H37.8498Z\" fill=\"currentcolor\"/>\n    <path d=\"M9.43243 8.16274C9.85735 8.48322 10.2069 8.88673 10.4582 9.34669C10.7094 9.80666 10.8565 10.3126 10.89 10.8313C10.7939 11.9569 10.2754 13.0103 9.43128 13.7946C9.32937 13.883 9.24664 13.9899 9.18786 14.1092C9.12907 14.2286 9.0954 14.3579 9.08878 14.4898C9.08216 14.6217 9.10275 14.7536 9.14931 14.8778C9.19588 15.002 9.26753 15.1161 9.36012 15.2136C9.45271 15.311 9.56442 15.3898 9.6888 15.4455C9.81319 15.5012 9.9478 15.5326 10.0849 15.538C10.2219 15.5433 10.3587 15.5225 10.4874 15.4767C10.6161 15.4309 10.734 15.3611 10.8345 15.2712C12.1048 14.1093 12.8679 12.5254 12.9688 10.8413C12.9432 10.042 12.7392 9.25727 12.3708 8.5405C12.0023 7.82373 11.478 7.19166 10.8334 6.68722C10.4067 6.38353 10.055 5.99283 9.80341 5.54303C9.55184 5.09323 9.40662 4.59547 9.37815 4.08534C9.51392 3.18283 10.0073 2.36595 10.7548 1.80591C10.9718 1.64618 11.1147 1.41065 11.1528 1.15024C11.1908 0.889843 11.1208 0.625512 10.958 0.414392C10.7951 0.203272 10.5525 0.062327 10.2826 0.0220596C10.0127 -0.0182078 9.73715 0.0454338 9.51559 0.199206C8.90219 0.651996 8.39004 1.21933 8.0098 1.86721C7.62956 2.5151 7.38907 3.2302 7.30273 3.9697C7.30292 4.77855 7.49485 5.5767 7.86392 6.30333C8.23298 7.02996 8.76944 7.66592 9.43243 8.16274Z\" fill=\"currentcolor\"/>\n    <path d=\"M23.0984 8.16274C23.5234 8.48322 23.8729 8.88673 24.1242 9.34669C24.3754 9.80666 24.5225 10.3126 24.556 10.8313C24.4599 11.9569 23.9414 13.0103 23.0973 13.7946C22.9954 13.883 22.9126 13.9899 22.8539 14.1092C22.7951 14.2286 22.7614 14.3579 22.7548 14.4898C22.7482 14.6217 22.7687 14.7536 22.8153 14.8778C22.8619 15.002 22.9335 15.1161 23.0261 15.2136C23.1187 15.311 23.2304 15.3898 23.3548 15.4455C23.4792 15.5012 23.6138 15.5326 23.7509 15.538C23.8879 15.5433 24.0247 15.5225 24.1534 15.4767C24.2821 15.4309 24.4 15.3611 24.5005 15.2712C25.7708 14.1093 26.5339 12.5254 26.6348 10.8413C26.6092 10.042 26.4052 9.25727 26.0368 8.5405C25.6683 7.82373 25.144 7.19166 24.4994 6.68722C24.0727 6.38353 23.721 5.99283 23.4694 5.54303C23.2178 5.09323 23.0726 4.59547 23.0442 4.08534C23.1799 3.18283 23.6733 2.36595 24.4208 1.80591C24.6378 1.64618 24.7807 1.41065 24.8188 1.15024C24.8568 0.889843 24.7868 0.625512 24.624 0.414392C24.4611 0.203272 24.2185 0.062327 23.9486 0.0220596C23.6787 -0.0182078 23.4032 0.0454338 23.1816 0.199206C22.5682 0.651996 22.0561 1.21933 21.6758 1.86721C21.2956 2.5151 21.0551 3.2302 20.9688 3.9697C20.9689 4.77855 21.1609 5.5767 21.5299 6.30333C21.899 7.02996 22.4355 7.66592 23.0984 8.16274Z\" fill=\"currentcolor\"/>\n    <path d=\"M16.2645 8.16274C16.6894 8.48322 17.039 8.88673 17.2902 9.34669C17.5414 9.80666 17.6886 10.3126 17.722 10.8313C17.626 11.9569 17.1074 13.0103 16.2633 13.7946C16.1614 13.883 16.0787 13.9899 16.0199 14.1092C15.9611 14.2286 15.9274 14.3579 15.9208 14.4898C15.9142 14.6217 15.9348 14.7536 15.9813 14.8778C16.0279 15.002 16.0996 15.1161 16.1922 15.2136C16.2847 15.311 16.3964 15.3898 16.5208 15.4455C16.6452 15.5012 16.7798 15.5326 16.9169 15.538C17.054 15.5433 17.1908 15.5225 17.3194 15.4767C17.4481 15.4309 17.5661 15.3611 17.6666 15.2712C18.9368 14.1093 19.6999 12.5254 19.8009 10.8413C19.7752 10.042 19.5713 9.25727 19.2028 8.5405C18.8343 7.82373 18.31 7.19166 17.6654 6.68722C17.2387 6.38353 16.887 5.99283 16.6354 5.54303C16.3839 5.09323 16.2386 4.59547 16.2102 4.08534C16.346 3.18283 16.8393 2.36595 17.5869 1.80591C17.8038 1.64618 17.9468 1.41065 17.9848 1.15024C18.0228 0.889843 17.9528 0.625512 17.79 0.414392C17.6271 0.203272 17.3845 0.062327 17.1146 0.0220596C16.8447 -0.0182078 16.5692 0.0454338 16.3476 0.199206C15.7342 0.651996 15.2221 1.21933 14.8418 1.86721C14.4616 2.5151 14.2211 3.2302 14.1348 3.9697C14.1349 4.77855 14.3269 5.5767 14.6959 6.30333C15.065 7.02996 15.6015 7.66592 16.2645 8.16274Z\" fill=\"currentcolor\"/>\n    <path d=\"M7.16328 29.7138C5.86597 27.7051 5.17938 25.3866 5.18141 23.0212C5.18141 22.7558 5.07191 22.5013 4.87697 22.3136C4.68204 22.1259 4.41765 22.0205 4.14198 22.0205C3.8663 22.0205 3.60191 22.1259 3.40698 22.3136C3.21204 22.5013 3.10254 22.7558 3.10254 23.0212C3.10081 25.7653 3.89738 28.4551 5.40201 30.7857C5.55001 31.0072 5.78275 31.1637 6.04976 31.2211C6.31677 31.2784 6.59652 31.2322 6.82832 31.0923C7.06012 30.9524 7.22529 30.7301 7.288 30.4737C7.35071 30.2174 7.30588 29.9475 7.16328 29.7227V29.7138Z\" fill=\"currentcolor\"/>\n    <path d=\"M9.06498 32.7103C8.94112 32.6482 8.84235 32.548 8.78434 32.4257C8.73082 32.3026 8.65227 32.1911 8.55334 32.0977C8.45441 32.0043 8.33708 31.9309 8.20825 31.8818C8.07942 31.8327 7.9417 31.8089 7.80317 31.8118C7.66464 31.8146 7.5281 31.8441 7.40159 31.8986C7.27508 31.953 7.16115 32.0312 7.06649 32.1286C6.97184 32.226 6.89837 32.3407 6.8504 32.4658C6.80244 32.591 6.78094 32.7241 6.78719 32.8574C6.79344 32.9906 6.8273 33.1213 6.88678 33.2418C7.13536 33.7758 7.56332 34.2136 8.10177 34.4849C8.34682 34.6079 8.63256 34.6321 8.89616 34.5523C9.15975 34.4724 9.37959 34.295 9.50732 34.0591C9.63505 33.8232 9.6602 33.5481 9.57725 33.2943C9.49429 33.0405 9.31003 32.8289 9.06498 32.7059V32.7103Z\" fill=\"currentcolor\"/>\n    </g>\n    <defs>\n    <clipPath id=\"clip0_605_8664\">\n    <rect width=\"40\" height=\"40\" fill=\"white\"/>\n    </clipPath>\n    </defs>\n    </svg>\n    `,\n    drinks: `<svg width=\"28\" height=\"39\" viewBox=\"0 0 28 39\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <g clip-path=\"url(#clip0_598_8203)\">\n    <path d=\"M0 0L0.662157 8.11078C0.662157 8.12619 0.653028 8.1394 0.653028 8.15481C0.658117 8.18851 0.664982 8.22193 0.673584 8.25496L3.1852 39H25.1048L28.0034 0H0ZM25.7932 1.98093L25.4085 7.16985C25.3982 7.16985 25.3902 7.16985 25.3799 7.16985H2.64519L2.22279 1.98642L25.7932 1.98093ZM23.1948 37.0191H5.08147L2.80846 9.14527H25.2612L23.1948 37.0191Z\" fill=\"currentcolor\"/>\n    <path d=\"M6.24983 23.3122C6.28864 23.3122 6.32861 23.3122 6.364 23.3122C6.49825 23.2972 6.6281 23.2567 6.74613 23.1933C6.86415 23.1298 6.96804 23.0445 7.05181 22.9423C7.13559 22.8401 7.19762 22.7229 7.23436 22.5975C7.2711 22.4722 7.28181 22.341 7.26589 22.2117C7.0661 20.5444 6.86517 18.8155 6.66538 17.0855C6.4576 15.2861 6.24869 13.4846 6.03862 11.7502C5.99894 11.4962 5.85848 11.267 5.64686 11.111C5.43525 10.955 5.16904 10.8843 4.90438 10.9138C4.63973 10.9434 4.39731 11.0708 4.22831 11.2694C4.0593 11.4679 3.9769 11.722 3.9985 11.978C4.20628 13.7091 4.41522 15.5084 4.623 17.3056C4.82392 19.0378 5.02485 20.77 5.22578 22.4395C5.25574 22.6807 5.37661 22.9029 5.56542 23.0638C5.75424 23.2247 5.99781 23.3131 6.24983 23.3122Z\" fill=\"currentcolor\"/>\n    <path d=\"M6.05485 24.414C5.9204 24.4288 5.79029 24.469 5.67201 24.5323C5.55372 24.5957 5.44958 24.6809 5.36557 24.7832C5.28156 24.8854 5.21933 25.0027 5.18245 25.1282C5.14557 25.2537 5.13477 25.385 5.15067 25.5145L5.31392 26.8857C5.34197 27.1276 5.46141 27.351 5.64945 27.5134C5.83748 27.6758 6.08096 27.7658 6.33341 27.7662C6.37223 27.7662 6.41105 27.7662 6.44759 27.7607C6.5817 27.7462 6.71152 27.7063 6.82966 27.6434C6.9478 27.5806 7.05194 27.4959 7.13612 27.3942C7.22029 27.2925 7.28287 27.1758 7.32027 27.0508C7.35766 26.9258 7.36913 26.7949 7.35404 26.6656L7.1908 25.2889C7.15839 25.0286 7.02114 24.791 6.80864 24.6273C6.59614 24.4636 6.32541 24.387 6.05485 24.414Z\" fill=\"currentcolor\"/>\n    </g>\n    <defs>\n    <clipPath id=\"clip0_598_8203\">\n    <rect width=\"28\" height=\"39\" fill=\"white\"/>\n    </clipPath>\n    </defs>\n    </svg>\n    `,\n    snacks: `<svg width=\"44\" height=\"30\" viewBox=\"0 0 44 30\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M39.9739 12.3839H39.9673C39.8416 11.3068 39.529 10.2613 39.0441 9.29623C38.2937 7.89066 37.2396 6.67826 35.9616 5.75118C34.6837 4.82411 33.2156 4.20677 31.669 3.94605C31.658 3.94605 31.6471 3.94605 31.635 3.94605C29.7116 1.41671 26.4577 0.0219894 22.162 0.00292969C17.7851 0.0287164 14.3819 1.44362 12.4015 3.94605C12.3773 3.94605 12.3553 3.94605 12.3312 3.94605C10.7845 4.20721 9.31631 4.82484 8.03823 5.75207C6.76016 6.6793 5.70574 7.89174 4.95505 9.29734C4.47112 10.2623 4.15888 11.3074 4.03289 12.3839H4.02631C2.34137 14.0479 1.12087 16.1402 0.490328 18.4457C-0.140217 20.7512 -0.15805 23.1866 0.438675 25.5015C1.16762 28.1328 2.30494 29.6228 3.81991 29.9323C4.02143 29.975 4.22667 29.9968 4.43249 29.9973C5.03503 29.925 5.61546 29.722 6.13483 29.4017C6.6542 29.0815 7.1005 28.6516 7.44377 28.1407C8.13563 27.3077 8.96125 26.601 9.88529 26.0508C10.6588 25.658 11.4715 25.3513 12.3092 25.136C12.7407 25.007 13.2105 24.8624 13.7122 24.6875C14.2182 24.7717 14.7299 24.8148 15.2426 24.8164C16.5191 24.8132 17.7827 24.5561 18.963 24.0597C19.2243 24.1678 19.4915 24.2603 19.7633 24.3366C20.4624 24.5255 21.1737 24.6634 21.892 24.7492C21.9649 24.7584 22.0386 24.7584 22.1115 24.7492C22.8298 24.6634 23.5411 24.5255 24.2402 24.3366C24.5121 24.2602 24.7794 24.1674 25.0405 24.0585C26.6985 24.7663 28.5179 24.9843 30.2913 24.6875C30.7941 24.8568 31.2639 25.0014 31.6954 25.136C32.5326 25.3518 33.3449 25.6585 34.1182 26.0508C35.0422 26.6006 35.8675 27.3074 36.5586 28.1407C36.9021 28.6516 37.3486 29.0816 37.8682 29.4018C38.3877 29.722 38.9683 29.925 39.571 29.9973C39.7765 29.9968 39.9813 29.975 40.1825 29.9323C41.6986 29.6228 42.8359 28.1317 43.5648 25.5015C44.1604 23.1863 44.1418 20.7509 43.5107 18.4455C42.8796 16.1401 41.6588 14.0479 39.9739 12.3839ZM8.94886 24.276C7.83296 24.927 6.83512 25.7694 5.99906 26.7661C5.09447 27.7561 4.76074 28.07 4.20854 27.9568C3.49936 27.8111 2.83628 26.7459 2.34227 24.9543C1.92223 23.3112 1.86627 21.5932 2.17848 19.9252C2.4907 18.2572 3.16322 16.6814 4.14706 15.3124C4.29059 16.0686 4.52165 16.8048 4.83539 17.5054C6.01506 20.1182 8.00316 22.2624 10.4935 23.6078C9.96108 23.7857 9.44437 24.0092 8.94886 24.276ZM14.1514 22.7266C13.9962 22.6555 13.8256 22.6265 13.6562 22.6425C12.1235 22.2411 10.6976 21.4958 9.48221 20.461C8.26685 19.4261 7.2926 18.1277 6.63029 16.66C6.16216 15.6502 5.92631 14.5445 5.94077 13.4274C5.95523 12.3102 6.21962 11.2112 6.71373 10.2145C7.64306 8.45293 9.17618 7.10357 11.0193 6.42493C9.99726 9.36013 10.6472 13.6553 12.7165 17.6365C13.6785 19.5654 15.0132 21.2752 16.6401 22.6627C15.8195 22.8232 14.9787 22.8448 14.1514 22.7266ZM23.7451 22.3903C23.1716 22.5448 22.5889 22.6613 22.0007 22.7389C21.4117 22.6614 20.8283 22.5449 20.254 22.3903C18.2033 21.8521 16.0374 19.7219 14.462 16.6925C12.6704 13.2438 12.0469 9.47672 12.8834 7.09538C14.473 2.55356 19.9093 2.03223 22.1653 2.01765C25.4445 2.03783 29.66 2.93475 31.1157 7.09538C31.9501 9.4756 31.3353 13.2427 29.5393 16.6903C27.9628 19.7197 25.798 21.851 23.7451 22.3891V22.3903ZM27.3579 22.6649C28.9873 21.2782 30.3233 19.5673 31.2848 17.6365C33.353 13.6542 34.0019 9.36013 32.9798 6.42493C34.8231 7.1032 36.3564 8.45266 37.2854 10.2145C37.7798 11.2111 38.0446 12.31 38.0594 13.4271C38.0743 14.5442 37.8388 15.6501 37.371 16.66C36.7089 18.1267 35.7356 19.4246 34.5215 20.4595C33.3074 21.4945 31.883 22.2405 30.3517 22.6436C30.1773 22.6248 30.0013 22.6546 29.8423 22.73C29.0162 22.8474 28.1769 22.825 27.3579 22.6638V22.6649ZM41.6601 24.9555C41.165 26.7493 40.5009 27.8122 39.7939 27.9579C39.2516 28.07 38.9156 27.7595 38.0033 26.7673C37.1671 25.7707 36.1693 24.9284 35.0536 24.2772C34.5589 24.0089 34.0429 23.7839 33.5111 23.6045C36.0014 22.2591 37.9895 20.1148 39.1692 17.502C39.4825 16.8016 39.7135 16.0659 39.8575 15.3101C40.8408 16.6799 41.5127 18.2562 41.8245 19.9245C42.1364 21.5927 42.0802 23.311 41.6601 24.9543V24.9555Z\" fill=\"currentColor\"/>\n    <path d=\"M17.3428 15.7782C16.1626 13.048 15.7674 10.0313 16.2032 7.08028C16.2231 6.94931 16.2174 6.81565 16.1867 6.68691C16.1559 6.55816 16.1006 6.43686 16.024 6.32994C15.9473 6.22302 15.8508 6.13257 15.7399 6.06375C15.629 5.99493 15.5059 5.94908 15.3777 5.92884C15.2495 5.90859 15.1186 5.91434 14.9925 5.94576C14.8665 5.97717 14.7477 6.03365 14.643 6.11194C14.5383 6.19023 14.4497 6.2888 14.3824 6.40205C14.315 6.5153 14.2701 6.641 14.2503 6.77197C13.7579 10.1061 14.2045 13.5144 15.538 16.5989C15.5889 16.7227 15.6636 16.8349 15.7575 16.9289C15.8515 17.0229 15.9628 17.0967 16.0851 17.1462C16.2074 17.1956 16.3381 17.2197 16.4695 17.2168C16.601 17.214 16.7306 17.1844 16.8507 17.1298C16.9709 17.0752 17.0791 16.9966 17.1691 16.8987C17.2591 16.8008 17.3291 16.6855 17.3749 16.5597C17.4208 16.4338 17.4415 16.2998 17.436 16.1656C17.4305 16.0315 17.3988 15.8997 17.3428 15.7782Z\" fill=\"currentColor\"/>\n    <path d=\"M19.696 19.2067C19.2865 18.9533 18.9569 18.5852 18.7464 18.146C18.6921 18.023 18.6143 17.9124 18.5174 17.8206C18.4206 17.7288 18.3067 17.6578 18.1825 17.6118C18.0583 17.5658 17.9263 17.5456 17.7944 17.5526C17.6625 17.5596 17.5333 17.5935 17.4144 17.6524C17.2955 17.7112 17.1894 17.7939 17.1023 17.8953C17.0153 17.9968 16.949 18.1151 16.9075 18.2432C16.866 18.3712 16.85 18.5065 16.8606 18.641C16.8712 18.7755 16.908 18.9065 16.969 19.0262C17.3477 19.8156 17.9407 20.4772 18.6772 20.9321C18.7884 21.0004 18.9117 21.0457 19.0401 21.0654C19.1684 21.085 19.2993 21.0786 19.4253 21.0466C19.5512 21.0146 19.6698 20.9576 19.7741 20.8788C19.8785 20.8 19.9666 20.701 20.0335 20.5874C20.1004 20.4738 20.1448 20.3478 20.164 20.2168C20.1832 20.0857 20.177 19.952 20.1456 19.8234C20.1143 19.6947 20.0585 19.5737 19.9813 19.4671C19.9041 19.3605 19.8072 19.2705 19.696 19.2022V19.2067Z\" fill=\"currentColor\"/>\n    </svg>\n    `,\n    meals: `<svg width=\"44\" height=\"47\" viewBox=\"0 0 44 47\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <g clip-path=\"url(#clip0_598_8219)\">\n    <path d=\"M42.941 2.11595C42.7415 1.9851 42.4981 1.93888 42.2644 1.98745C42.0307 2.03602 41.8259 2.1754 41.695 2.37496L34.006 14.102C33.3796 13.6496 32.7178 13.2483 32.027 12.902C32.0551 12.8557 32.0786 12.8068 32.097 12.756L35.4431 1.14795C35.5094 0.91841 35.4818 0.671927 35.3663 0.46273C35.2509 0.253533 35.0571 0.098759 34.8275 0.0324549C34.598 -0.0338492 34.3515 -0.0062506 34.1423 0.109178C33.9331 0.224607 33.7783 0.41841 33.712 0.647954L30.382 12.202C28.8498 11.6558 27.2357 11.3751 25.609 11.372C23.5868 11.3208 21.5789 11.7248 19.7337 12.5541C17.8886 13.3834 16.2534 14.6167 14.949 16.163C13.472 15.5617 11.8698 15.3326 10.2834 15.4959C8.69704 15.6593 7.17511 16.21 5.85156 17.0996C4.528 17.9893 3.44339 19.1906 2.69314 20.5978C1.94289 22.0051 1.54999 23.5752 1.54904 25.17H0.900049C0.781014 25.1699 0.663159 25.1936 0.553309 25.2394C0.443459 25.2853 0.343801 25.3524 0.260096 25.4371C0.176391 25.5217 0.110305 25.6221 0.0656684 25.7325C0.0210317 25.8428 -0.00126705 25.9609 5.5571e-05 26.08C0.0892682 29.5951 1.16582 33.0142 3.10662 35.9464C5.04743 38.8786 7.77413 41.2054 10.975 42.661V45.147C10.975 45.3856 11.0699 45.6146 11.2386 45.7834C11.4074 45.9521 11.6364 46.047 11.8751 46.047H29.692C29.9307 46.047 30.1596 45.9521 30.3284 45.7834C30.4972 45.6146 30.592 45.3856 30.592 45.147V42.665C33.7927 41.2092 36.5191 38.8822 38.4597 35.9501C40.4004 33.018 41.4768 29.599 41.566 26.084C41.5674 25.9649 41.5451 25.8468 41.5004 25.7365C41.4558 25.6261 41.3897 25.5257 41.306 25.4411C41.2223 25.3565 41.1226 25.2893 41.0128 25.2434C40.9029 25.1976 40.7851 25.1739 40.666 25.174H39.976C39.82 21.3924 38.1759 17.8258 35.402 15.251L43.197 3.36196C43.3282 3.16274 43.3749 2.91961 43.3269 2.68598C43.2789 2.45235 43.1401 2.24733 42.941 2.11595ZM11.292 17.249C13.3949 17.2513 15.4113 18.0864 16.9 19.5716C18.3887 21.0568 19.2286 23.0711 19.236 25.174H18.476C18.4537 23.2835 17.6871 21.4779 16.3423 20.149C14.9976 18.82 13.1832 18.0747 11.2925 18.0747C9.4019 18.0747 7.58747 18.82 6.24273 20.149C4.89799 21.4779 4.13134 23.2835 4.10903 25.174H3.34905C3.35619 23.0712 4.1959 21.0569 5.68447 19.5717C7.17304 18.0865 9.18928 17.2513 11.292 17.249ZM30.46 25.174C30.3295 24.0738 29.829 23.0506 29.0406 22.2723C28.2521 21.494 27.2226 21.0067 26.1208 20.8904C25.019 20.7742 23.9104 21.0358 22.9769 21.6324C22.0433 22.2291 21.3403 23.1252 20.983 24.174C20.8976 23.3879 20.7156 22.6154 20.441 21.874C21.2275 20.8287 22.312 20.0461 23.5519 19.6292C24.7917 19.2124 26.1287 19.1807 27.3869 19.5384C28.6451 19.8962 29.7655 20.6265 30.6005 21.6334C31.4356 22.6402 31.9461 23.8763 32.065 25.179L30.46 25.174ZM28.66 25.174H22.555C22.6942 24.4666 23.0746 23.8296 23.6314 23.3717C24.1882 22.9138 24.8867 22.6634 25.6075 22.6634C26.3284 22.6634 27.0269 22.9138 27.5837 23.3717C28.1404 23.8296 28.5209 24.4666 28.66 25.174ZM33.8661 25.174C33.7524 23.5697 33.1734 22.0335 32.1999 20.7533C31.2265 19.4731 29.9008 18.5046 28.3853 17.9663C26.8698 17.428 25.2303 17.3434 23.6674 17.7227C22.1045 18.102 20.6862 18.9288 19.5861 20.102C19.3425 19.7013 19.0704 19.3187 18.772 18.957C19.6483 18.0285 20.7095 17.2942 21.8871 16.8014C23.0648 16.3086 24.3327 16.0683 25.609 16.096C28.0701 16.1 30.4374 17.0409 32.2298 18.7275C34.0222 20.414 35.1053 22.7196 35.259 25.176L33.8661 25.174ZM15.376 25.174C15.376 24.0911 14.9459 23.0525 14.1802 22.2868C13.4145 21.5211 12.3759 21.091 11.2931 21.091C10.2102 21.091 9.17165 21.5211 8.40594 22.2868C7.64023 23.0525 7.21005 24.0911 7.21005 25.174H5.91003C5.92931 23.7594 6.5048 22.4093 7.51193 21.4158C8.51906 20.4223 9.87684 19.8653 11.2915 19.8653C12.7062 19.8653 14.064 20.4223 15.0712 21.4158C16.0783 22.4093 16.6537 23.7594 16.673 25.174H15.376ZM13.576 25.174H9.01205C9.02455 24.5769 9.27051 24.0085 9.6972 23.5906C10.1239 23.1728 10.6973 22.9387 11.2945 22.9387C11.8918 22.9387 12.4652 23.1728 12.8919 23.5906C13.3186 24.0085 13.5646 24.5769 13.5771 25.174H13.576ZM12.7761 44.251V43.132H28.792V44.251H12.7761ZM29.136 41.332H12.436C9.52258 40.1406 6.99281 38.1712 5.12332 35.6389C3.25383 33.1066 2.11663 30.109 1.83605 26.974H39.7281C39.4482 30.1081 38.3122 33.1051 36.4441 35.6373C34.5761 38.1695 32.048 40.1395 29.136 41.332ZM38.178 25.174H37.0601C36.9048 22.2401 35.6312 19.4773 33.5013 17.4538C31.3713 15.4303 28.547 14.2998 25.609 14.295C24.0957 14.2643 22.5927 14.55 21.1962 15.1338C19.7996 15.7176 18.5404 16.5865 17.499 17.685C17.2087 17.4481 16.9052 17.2277 16.5901 17.025C17.7218 15.7645 19.1155 14.7668 20.6734 14.1017C22.2314 13.4367 23.9159 13.1204 25.609 13.175C28.8438 13.1792 31.9531 14.4275 34.2929 16.6611C36.6327 18.8948 38.0237 21.9428 38.178 25.174Z\" fill=\"currentColor\"/>\n    <path d=\"M3.39209 30.1722C4.045 32.6025 5.31628 34.8222 7.08209 36.6152C7.16443 36.7021 7.26327 36.7717 7.37286 36.8199C7.48244 36.8682 7.60056 36.8941 7.72027 36.8961C7.83999 36.8981 7.95888 36.8762 8.07003 36.8317C8.18118 36.7872 8.28235 36.7209 8.36758 36.6368C8.45281 36.5528 8.52038 36.4525 8.56637 36.342C8.61237 36.2314 8.63585 36.1128 8.63543 35.9931C8.63501 35.8733 8.6107 35.7549 8.56393 35.6447C8.51716 35.5344 8.44888 35.4347 8.36306 35.3512C6.81633 33.7796 5.70257 31.8346 5.13006 29.7052C5.1013 29.589 5.04966 29.4797 4.97815 29.3837C4.90663 29.2878 4.81669 29.207 4.71359 29.1462C4.61049 29.0854 4.49631 29.0458 4.37771 29.0297C4.25912 29.0136 4.1385 29.0213 4.02291 29.0523C3.90733 29.0834 3.7991 29.1372 3.70456 29.2106C3.61001 29.284 3.53106 29.3755 3.47232 29.4798C3.41357 29.584 3.3762 29.699 3.36242 29.8179C3.34865 29.9368 3.35875 30.0572 3.39209 30.1722Z\" fill=\"#323232\"/>\n    <path d=\"M10.5356 39.5502C10.7282 39.6767 10.962 39.7245 11.1889 39.6838C11.4157 39.643 11.6182 39.5168 11.7547 39.3312C11.8913 39.1456 11.9514 38.9146 11.9227 38.6859C11.8941 38.4573 11.7788 38.2483 11.6006 38.1022L10.3336 37.1752C10.1407 37.0392 9.90209 36.9844 9.66918 37.0226C9.43627 37.0609 9.2277 37.1891 9.08843 37.3797C8.94915 37.5702 8.89031 37.8079 8.92458 38.0414C8.95884 38.2749 9.08345 38.4857 9.27159 38.6282L10.5356 39.5502Z\" fill=\"#323232\"/>\n    </g>\n    <defs>\n    <clipPath id=\"clip0_598_8219\">\n    <rect width=\"43.348\" height=\"46.051\" fill=\"white\"/>\n    </clipPath>\n    </defs>\n    </svg>`,\n};\n\n@Component({\n    selector: 'catering-item-filters',\n    template: `\n        <div class=\"px-4 mt-3 mb-2\" [class.sm:hidden]=\"!search\">\n            <mat-form-field appearance=\"outline\" class=\"w-full h-14\">\n                <app-icon matPrefix class=\"text-xl\">search</app-icon>\n                <input\n                    matInput\n                    [ngModel]=\"(filters | async)?.search\"\n                    (ngModelChange)=\"setFilters({ search: $event })\"\n                    placeholder=\"Search menu...\"\n                />\n            </mat-form-field>\n        </div>\n        <h3 class=\"hidden sm:block font-medium px-2 mt-2\" *ngIf=\"!search\">\n            Catergories\n        </h3>\n        <div\n            class=\"flex flex-wrap items-center pb-2 px-1\"\n            [class.sm:hidden]=\"search\"\n            [class.sm:pt-1]=\"!search\"\n        >\n            <div class=\"flex flex-col items-center m-1\">\n                <button\n                    matRipple\n                    coffee\n                    [class.!bg-primary]=\"\n                        (filters | async)?.tags?.includes('coffee')\n                    \"\n                    [class.text-white]=\"\n                        (filters | async)?.tags?.includes('coffee')\n                    \"\n                    class=\"flex items-center justify-center w-20 h-20 rounded bg-gray-300 dark:bg-neutral-600\"\n                    (click)=\"toggleTag('coffee')\"\n                    [innerHTML]=\"icons.coffee | safe\"\n                ></button>\n                <p>Coffee</p>\n            </div>\n            <div class=\"flex flex-col items-center m-1\">\n                <button\n                    matRipple\n                    drinks\n                    [class.!bg-primary]=\"\n                        (filters | async)?.tags?.includes('drinks')\n                    \"\n                    [class.text-white]=\"\n                        (filters | async)?.tags?.includes('drinks')\n                    \"\n                    class=\"flex items-center justify-center w-20 h-20 rounded bg-gray-300 dark:bg-neutral-600\"\n                    (click)=\"toggleTag('drinks')\"\n                    [innerHTML]=\"icons.drinks | safe\"\n                ></button>\n                <p>Drinks</p>\n            </div>\n            <div class=\"flex flex-col items-center m-1\">\n                <button\n                    matRipple\n                    snacks\n                    [class.!bg-primary]=\"\n                        (filters | async)?.tags?.includes('snacks')\n                    \"\n                    [class.text-white]=\"\n                        (filters | async)?.tags?.includes('snacks')\n                    \"\n                    class=\"flex items-center justify-center w-20 h-20 rounded bg-gray-300 dark:bg-neutral-600\"\n                    (click)=\"toggleTag('snacks')\"\n                    [innerHTML]=\"icons.snacks | safe\"\n                ></button>\n                <p>Snacks</p>\n            </div>\n            <div class=\"flex flex-col items-center m-1\">\n                <button\n                    matRipple\n                    meals\n                    [class.!bg-primary]=\"\n                        (filters | async)?.tags?.includes('meals')\n                    \"\n                    [class.text-white]=\"\n                        (filters | async)?.tags?.includes('meals')\n                    \"\n                    class=\"flex items-center justify-center w-20 h-20 rounded bg-gray-300 dark:bg-neutral-600\"\n                    (click)=\"toggleTag('meals')\"\n                    [innerHTML]=\"icons.meals | safe\"\n                ></button>\n                <p>Meals</p>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class CateringItemFiltersComponent {\n    @Input() public search = false;\n\n    public readonly icons = ICONS;\n\n    public readonly filters = this._state.filters;\n\n    public readonly setFilters = (f) => this._state.setFilters(f);\n\n    constructor(private _state: CateringOrderStateService) {}\n\n    public async toggleTag(tag: string) {\n        const { tags } = await this.filters.pipe(take(1)).toPromise();\n        if (tags.includes(tag))\n            this.setFilters({ tags: tags.filter((_) => _ !== tag) });\n        else this.setFilters({ tags: [...tags, tag] });\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { CateringItem } from '../catering-item.class';\nimport { CateringStateService } from '../catering-state.service';\nimport { CateringOrderStateService } from './catering-order-state.service';\n\n@Component({\n    selector: 'catering-item-list',\n    template: `\n    <div class=\"w-full h-full overflow-auto py-2\">\n        <h3 class=\"font-bold px-2\">Results</h3>\n        <p count class=\"text-sm opacity-60 mb-4 px-2\">\n            {{ (item_list | async)?.length || 0 }} result(s) found\n        </p>\n        <ng-container *ngIf=\"!(loading | async); else load_state\">\n            <ul\n                class=\"list-style-none space-y-2 p-2\"\n                *ngIf=\"(item_list | async)?.length; else empty_state\"\n            >\n                <li\n                    item\n                    *ngFor=\"let item of item_list | async\"\n                    [class.!border-black]=\"active === item.id\"\n                    class=\"relative p-2 rounded-lg w-full shadow border bg-white dark:bg-neutral-600 border-gray-200 dark:border-neutral-500\"\n                >\n                    <button\n                        matRipple\n                        select\n                        class=\"w-full h-full flex items-center pr-10\"\n                        (click)=\"selectItem(item)\"\n                    >\n                        <div\n                            class=\"relative w-16 h-16 rounded-xl bg-black/20 mr-4\"\n                        >\n                            <div\n                                class=\"absolute top-1 left-1 border border-white bg-black/50 rounded-full h-6 w-6 flex items-center justify-center text-white text-xs\"\n                                *ngIf=\"selected.includes(item.id)\"\n                            >\n                                {{ item.quantity || '1' }}\n                            </div>\n                        </div>\n                        <div class=\"space-y-2 text-left flex-1\">\n                            <div class=\"font-medium flex items-center justify-between\">\n                                <div>{{ item.name || 'Item' }}</div>\n                                <div class=\"opacity-60 text-xs\">{{ item.category }}</div>\n                            </div>\n                            <div\n                                class=\"flex items-center text-sm space-x-2\"\n                            >\n                                <p *ngIf=\"item.unit_price\">\n                                    {{ item.unit_price / 100 | currency:code }}\n                                </p>\n                            </div>\n                        </div>\n                    </button>\n                    <button\n                        mat-icon-button\n                        fav\n                        class=\"absolute top-1 right-1\"\n                        [class.text-blue-400]=\"isFavourite(item.id)\"\n                        (click)=\"toggleFav.emit(item)\"\n                    >\n                        <app-icon>{{\n                            isFavourite(item.id)\n                                ? 'favorite'\n                                : 'favorite_border'\n                        }}</app-icon>\n                    </button>\n                </li>\n            </ul>\n        </ng-container>\n    </div>\n    <ng-template #empty_state>\n        <div\n            empty\n            class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n        >\n            <p class=\"opacity-30 text-center\">\n                No available items for selected time and/or filters\n            </p>\n        </div>\n    </ng-template>\n    <ng-template #load_state>\n        <div\n            loading\n            class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n        >\n            <mat-spinner [diameter]=\"32\"></mat-spinner>\n            <p class=\"opacity-30\">Finding available items...</p>\n        </div>\n    </ng-template>\n    `,\n    styles: [``],\n})\nexport class CateringItemListComponent {\n    @Input() public active: string = '';\n    @Input() public selected: string = '';\n    @Input() public favorites: string[] = [];\n    @Output() public toggleFav = new EventEmitter<CateringItem>();\n    @Output() public onSelect = new EventEmitter<CateringItem>();\n\n    public readonly loading = this._state.loading;\n    public readonly item_list = this._state.filtered_menu;\n\n    public get code() {\n        return this._state.currency_code;\n    }\n\n    constructor(private _state: CateringOrderStateService) {}\n\n    public isFavourite(item_id: string) {\n        return this.favorites.includes(item_id);\n    }\n\n    public selectItem(item: CateringItem) {\n        this.onSelect.emit(item);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { OrganisationService } from '@placeos/organisation';\nimport { showMetadata } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest, Observable, of } from 'rxjs';\nimport { catchError, map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { CateringItem } from '../catering-item.class';\n\nexport interface CateringOrderOptions { // Affects backend requests\n    zone?: string;\n}\n\nexport interface CateringOrderFilters { // Affects frontend filtering\n    search: string;\n    tags: string[];\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class CateringOrderStateService {\n    private _options = new BehaviorSubject<CateringOrderOptions>({});\n    private _filters = new BehaviorSubject<CateringOrderFilters>({\n        search: '',\n        tags: [],\n    });\n    private _loading = new BehaviorSubject('');\n\n    public readonly loading = this._loading.asObservable();\n    public readonly filters = this._filters.asObservable();\n\n    public readonly available_menu: Observable<CateringItem[]> = this._options.pipe(\n        switchMap(({ zone }) =>{\n            this._loading.next('[Menu]');\n            return showMetadata(zone || this._org.building?.id, 'catering').pipe(\n                map((d) => d.details.map((_) => new CateringItem(_))),\n                catchError((_) => [])\n            )}\n        ),\n        tap(_ => this._loading.next('')),\n        shareReplay(1)\n    );\n\n    public readonly filtered_menu = combineLatest([\n        this._filters,\n        this.available_menu,\n    ]).pipe(\n        map(([{ search, tags }, l]) => {\n            search = search.toLowerCase();\n            const ol = l.filter((_) => {\n                return _.name.toLowerCase().includes(search) &&\n                    (!tags?.length || tags.every((t) => _.tags.includes(t)));\n            });\n            return ol;\n        }),\n        shareReplay(1)\n    );\n\n    public get currency_code() {\n        return this._org.currency_code;\n    }\n\n    constructor(\n        private _dialog: MatDialog,\n        private _org: OrganisationService\n    ) {}\n\n    public setOptions(opts: Partial<CateringOrderOptions>) {\n        this._options.next({ ...this._options.getValue(), ...opts });\n    }\n\n    public setFilters(opts: Partial<CateringOrderFilters>) {\n        this._filters.next({ ...this._filters.getValue(), ...opts });\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { CateringItem } from '../catering-item.class';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: 'new-catering-order-modal',\n    template: `\n        <div\n            class=\"absolute inset-0 sm:relative sm:inset-none flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <header class=\"flex items-center space-x-4 w-full\">\n                <button mat-icon-button mat-dialog-close class=\"bg-black/20\">\n                    <app-icon>close</app-icon>\n                </button>\n                <h3>Add Catering</h3>\n            </header>\n            <main\n                class=\"flex-1 flex items-center divide-x divide-gray-200 dark:divide-neutral-500 min-h-[65vh] h-[65vh] sm:max-h-[65vh] sm:max-w-[95vw] w-full overflow-hidden\"\n            >\n                <catering-item-filters\n                    class=\"h-full hidden sm:block sm:max-w-[12rem] sm:h-[65vh] sm:max-h-full\"\n                ></catering-item-filters>\n                <div\n                    class=\"flex flex-col items-center flex-1 w-1/2 h-full sm:h-[65vh]\"\n                >\n                    <catering-item-filters\n                        class=\"w-full border-b border-gray-200 dark:border-neutral-500\"\n                        [search]=\"true\"\n                    ></catering-item-filters>\n                    <catering-item-list\n                        [active]=\"displayed?.id\"\n                        [selected]=\"selected_ids\"\n                        [favorites]=\"favorites\"\n                        (toggleFav)=\"toggleFavourite($event)\"\n                        (onSelect)=\"displayed = $event\"\n                        class=\"flex-1 h-1/2 w-full overflow-hidden\"\n                    ></catering-item-list>\n                </div>\n                <catering-item-details\n                    [item]=\"displayed!\"\n                    class=\"h-full w-full sm:h-[65vh] absolute sm:relative sm:flex sm:max-w-[16rem] z-20 bg-white dark:bg-neutral-700\"\n                    [class.hidden]=\"!displayed\"\n                    [class.inset-0]=\"displayed\"\n                    [active]=\"selected_ids.includes(displayed?.id || '')\"\n                    (activeChange)=\"setSelected(displayed!, $event)\"\n                    [code]=\"code\"\n                    [fav]=\"\n                        !!displayed &&\n                        this.favorites.includes(displayed?.id || '')\n                    \"\n                    (toggleFav)=\"toggleFavourite(displayed!)\"\n                    (close)=\"displayed = null\"\n                ></catering-item-details>\n            </main>\n            <footer\n                class=\"flex sm:hidden flex-col-reverse items-center justify-end p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    back-btn\n                    class=\"inverse sm:hidden w-full sm:w-auto\"\n                    *ngIf=\"displayed\"\n                    (click)=\"displayed = null\"\n                >\n                    Back\n                </button>\n                <button\n                    mat-button\n                    save\n                    [mat-dialog-close]=\"selected\"\n                    [class.mb-2]=\"displayed\"\n                    class=\"w-full sm:w-auto sm:mb-0\"\n                >\n                    View List\n                </button>\n            </footer>\n            <footer\n                class=\"hidden sm:flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    [mat-dialog-close]=\"selected\"\n                    class=\"clear text-primary\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">arrow_back</app-icon>\n                        <div class=\"mr-1 underline\">Back to form</div>\n                    </div>\n                </button>\n                <p class=\"opacity-60 text-sm\">{{ count }} items(s) added</p>\n                <button\n                    mat-button\n                    [disabled]=\"!displayed\"\n                    [class.inverse]=\"isSelected(displayed?.id)\"\n                    (click)=\"setSelected(displayed, !isSelected(displayed?.id))\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">{{\n                            isSelected(displayed?.id) ? 'remove' : 'add'\n                        }}</app-icon>\n                        <div class=\"mr-1\">\n                            {{\n                                isSelected(displayed?.id)\n                                    ? 'Remove from Booking'\n                                    : 'Add to booking'\n                            }}\n                        </div>\n                    </div>\n                </button>\n            </footer>\n        </div>\n    `,\n    styles: [``],\n})\nexport class NewCateringOrderModalComponent {\n    public displayed: CateringItem | null = null;\n    public selected: CateringItem[] = [...(this._items || [])];\n\n    public get favorites() {\n        return (\n            this._settings.get<string[]>('favourite_menu_items') || EMPTY_FAVS\n        );\n    }\n\n    public get selected_ids() {\n        return this.selected.map((_) => _.id).join(',');\n    }\n\n    public get count() {\n        return this.selected.reduce((t, i) => t + i.quantity, 0);\n    }\n\n    public get code() {\n        return this._org.currency_code;\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _org: OrganisationService,\n        @Inject(MAT_DIALOG_DATA) private _items: CateringItem[]\n    ) {}\n\n    public isSelected(id: string) {\n        return id && this.selected_ids.includes(id);\n    }\n\n    public setSelected(item: CateringItem, state: boolean) {\n        const list = this.selected.filter((_) => _.id !== item.id);\n        if (state) list.push(item);\n        this.selected = list;\n    }\n\n    public toggleFavourite(item: CateringItem) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(item.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_menu_items', [\n                ...fav_list,\n                item.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_menu_items',\n                fav_list.filter((_) => _ !== item.id)\n            );\n        }\n    }\n}\n","import { Component, Inject, Output, EventEmitter } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { DialogEvent, HashMap } from 'libs/common/src/lib/types';\nimport { unique } from 'libs/common/src/lib/general';\n\nimport { CateringOption, CateringOptionGroup } from './catering.interfaces';\n\nexport interface CateringOrderOptionsModalData {\n    code: string;\n    options: CateringOption[];\n}\n\n@Component({\n    selector: 'app-catering-options-modal',\n    template: `\n        <header>\n            <h3>Select options</h3>\n            <button mat-icon-button mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main class=\"overflow-auto\">\n            <div\n                class=\"pt-1 pb-2 border-b border-gray-200\"\n                *ngFor=\"let group of groups\"\n                [attr.group]=\"group.name\"\n            >\n                <div class=\"font-medium p-2 capitalize\">{{ group.name }}</div>\n                <div class=\"flex flex-col pl-6\">\n                    <ng-container *ngIf=\"!group.multiple; else multi_options\">\n                        <mat-radio-group\n                            class=\"flex flex-col\"\n                            aria-label=\"Select an option\"\n                            ngModel\n                            (ngModelChange)=\"updateGroupOption(group, $event)\"\n                        >\n                            <mat-radio-button class=\"my-1 mx-0\" value=\"\">\n                                <span class=\"font-medium p-2\">None</span>\n                            </mat-radio-button>\n                            <mat-radio-button\n                                class=\"my-1 mx-0\"\n                                *ngFor=\"let opt of group?.options\"\n                                [value]=\"opt.id\"\n                            >\n                                <div class=\"flex items-center justify-center\">\n                                    <div class=\"font-medium p-2 flex-1 w-1/2\">\n                                        {{ opt.name }}\n                                    </div>\n                                    <div\n                                        class=\"opacity-60 text-xs\"\n                                        *ngIf=\"opt.unit_price\"\n                                    >\n                                        +{{ opt.unit_price / 100 | currency:code }}\n                                    </div>\n                                </div>\n                            </mat-radio-button>\n                        </mat-radio-group>\n                    </ng-container>\n                    <ng-template #multi_options>\n                        <mat-checkbox\n                            *ngFor=\"let opt of group?.options\"\n                            [(ngModel)]=\"option_state[opt.id]\"\n                        >\n                            <div class=\"flex items-center justify-center\">\n                                <div class=\"font-medium p-2 flex-1 w-1/2\">\n                                    {{ opt.name }}\n                                </div>\n                                <div\n                                    class=\"opacity-60 text-xs\"\n                                    *ngIf=\"opt.unit_price\"\n                                >\n                                    +{{ opt.unit_price / 100 | currency:code }}\n                                </div>\n                            </div>\n                        </mat-checkbox>\n                    </ng-template>\n                </div>\n            </div>\n        </main>\n        <footer class=\"p-2\">\n            <button mat-button class=\"w-32\" (click)=\"saveOptions()\">\n                Save\n            </button>\n        </footer>\n    `,\n    styles: [\n        `\n            main {\n                min-height: 24em;\n                width: 24rem;\n                max-width: calc(100vw - 2rem);\n            }\n        `,\n    ],\n})\nexport class CateringOrderOptionsModalComponent {\n    /** Emitter for events on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** List of option groups */\n    public readonly groups: CateringOptionGroup[];\n    /** Mapping of options to their active state */\n    public option_state: HashMap<boolean> = {};\n    public readonly code = this._data.code;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: CateringOrderOptionsModalData\n    ) {\n        const groups = unique(\n            this._data.options.map((i) => i.group || 'Other')\n        );\n        const group_list = [];\n        for (const group of groups) {\n            const options = this._data.options.filter((i) => i.group === group);\n            group_list.push({\n                name: group,\n                multiple: !!options.find((i) => i.multiple),\n                options,\n            });\n        }\n        this.groups = group_list;\n    }\n\n    public updateGroupOption(group: CateringOptionGroup, id: string) {\n        for (const option of group.options) {\n            this.option_state[option.id] = option.id === id;\n        }\n    }\n\n    public saveOptions() {\n        const options = this._data.options.filter(\n            (opt) => this.option_state[opt.id]\n        );\n        this.event.emit({ reason: 'done', metadata: { options } });\n    }\n}\n","import { randomInt } from '@placeos/common';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { CateringItem } from './catering-item.class';\nimport { CateringOrderStatus } from './catering.interfaces';\n\nexport class CateringOrder {\n    /** ID of the order */\n    public readonly id: string;\n    /** ID of the space the order is associated */\n    public readonly system_id: string;\n    /** ID of the event the order is associated */\n    public readonly event_id: string;\n    /** List of items associated with the order */\n    public readonly items: readonly CateringItem[];\n    /** Number of items in the order */\n    public readonly item_count: number;\n    /** Total cost of order */\n    public readonly total_cost: number;\n    /** Invoice number associated with the order */\n    public readonly invoice_number: string;\n    /** Charge code for the order */\n    public readonly charge_code: string;\n    /** Unix epoch in seconds of order delivery time */\n    public readonly deliver_at: number;\n    /** Current status of the order */\n    public readonly status: CateringOrderStatus;\n    /** Event associated with the order */\n    public readonly event: CalendarEvent | null;\n\n    constructor(data: Partial<CateringOrder> = {}) {\n        this.id = data.id || `order-${randomInt(9_999_999, 1_000_000)}`;\n        this.system_id = data.system_id || '';\n        this.event_id = data.event_id || data.event?.id || '';\n        this.items = (data.items || []).map((i) => new CateringItem(i));\n        this.item_count = this.items.reduce(\n            (amount, item) => amount + item.quantity,\n            0\n        );\n        this.total_cost = this.items.reduce(\n            (amount, item) => amount + (item.total_cost || 0),\n            0\n        );\n        this.charge_code = data.charge_code || '';\n        this.status = data.status || 'accepted';\n        this.invoice_number = data.invoice_number || '';\n        this.event = data.event || null;\n        this.deliver_at =\n            data.deliver_at ||\n            (data as any).date ||\n            this.event?.date ||\n            new Date().getTime();\n    }\n}\n","import { Component, Input } from '@angular/core';\n\nimport { ANIMATION_SHOW_CONTRACT_EXPAND } from '@placeos/common';\n\nimport { CateringOrdersService } from './catering-orders.service';\nimport { CateringOrder } from './catering-order.class';\nimport { CATERING_STATUSES } from './catering.vars';\n\n@Component({\n    selector: 'catering-order',\n    template: `\n        <div\n            class=\"w-full flex items-center py-2 dark:bg-neutral-700\"\n            [class.bg-gray-100]=\"!show_items\"\n            [class.bg-gray-200]=\"show_items\"\n            *ngIf=\"order\"\n        >\n            <div\n                class=\"w-20 flex items-center justify-center z-20 h-full\"\n                [class.bg-gray-200]=\"show_items\"\n                [class.dark:bg-neutral-700]=\"show_items\"\n            >\n                <div\n                    class=\"rounded-full bg-gray-400 dark:bg-neutral-800 p-2 text-2xl text-black dark:text-white opacity-60 flex items-center justify-center\"\n                >\n                    <app-icon>room_service</app-icon>\n                </div>\n            </div>\n            <div time class=\"w-24\">\n                {{ order.deliver_at | date: 'shortTime' }}\n            </div>\n            <div class=\"flex-1\">\n                {{\n                    order.event?.space.display_name ||\n                        order.event?.space.name ||\n                        '~ No Location ~'\n                }}\n            </div>\n            <div class=\"w-56\">\n                {{\n                    order.event?.organiser?.name ||\n                        order.event?.host ||\n                        '~ Unknown Host ~'\n                }}\n            </div>\n            <div class=\"w-24\">{{ order.charge_code || '~ No Code ~' }}</div>\n            <div class=\"w-28\">\n                {{ order.invoice_number || '~ No Invoice ~' }}\n            </div>\n            <div class=\"w-36\">\n                <button\n                    name=\"status\"\n                    class=\"text-base border-none h-10 px-4 flex items-center text-white w-36\"\n                    matRipple\n                    [style.background]=\"status?.colour\"\n                    [matMenuTriggerFor]=\"menu\"\n                >\n                    <div class=\"flex text-center capitalize mx-2\">\n                        {{ status?.name }}\n                    </div>\n                    <app-icon class=\"pl-2\">arrow_drop_down</app-icon>\n                </button>\n            </div>\n            <div class=\"w-12\">\n                <button mat-icon-button (click)=\"show_items = !show_items\">\n                    <app-icon>{{\n                        show_items\n                            ? 'keyboard_arrow_down'\n                            : 'keyboard_arrow_right'\n                    }}</app-icon>\n                </button>\n            </div>\n        </div>\n        <ul\n            *ngIf=\"order?.items.length\"\n            class=\"list-none p-0 m-0 w-full relative z-0\"\n            [class.shown]=\"show_items\"\n            [@show]=\"show_items ? 'show' : 'hide'\"\n        >\n            <li\n                catering-order-item\n                class=\"flex items-center\"\n                *ngFor=\"let item of order.items; let i = index\"\n                [item]=\"item\"\n            ></li>\n        </ul>\n        <mat-menu #menu=\"matMenu\">\n            <button\n                mat-menu-item\n                *ngFor=\"let status of statuses\"\n                class=\"flex items-center\"\n                (click)=\"updateStatus(status.id)\"\n            >\n                <div\n                    class=\"rounded-full h-4 w-4 mr-2\"\n                    [style.background-color]=\"status.colour\"\n                ></div>\n                <span class=\"mr-2 w-20\">{{ status.name }}</span>\n            </button>\n        </mat-menu>\n    `,\n    styles: [\n        `\n            [name='status'] {\n                border-radius: 1.55rem;\n            }\n\n            button[mat-menu-item] {\n                display: flex;\n            }\n\n            [name='bar'] {\n                width: 2px;\n                top: -0.5rem;\n                left: calc(2.5rem - 1px);\n            }\n        `,\n    ],\n    animations: [ANIMATION_SHOW_CONTRACT_EXPAND],\n})\nexport class CateringOrderComponent {\n    @Input() public order: CateringOrder;\n    /** Whether to show the items in the catering order */\n    public show_items = false;\n    /** List of status available to select */\n    public readonly statuses = CATERING_STATUSES;\n\n    public readonly updateStatus = (s) =>\n        this._orders.updateStatus(this.order, s);\n\n    public get status() {\n        return this.statuses.find((i) => i.id === this.order.status);\n    }\n\n    constructor(private _orders: CateringOrdersService) {}\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, combineLatest, Observable } from 'rxjs';\nimport { map, switchMap, debounceTime, tap, shareReplay } from 'rxjs/operators';\nimport { startOfDay, endOfDay, getUnixTime } from 'date-fns';\n\nimport { BaseClass, flatten } from '@placeos/common';\nimport { queryEvents, saveEvent } from 'libs/events/src/lib/events.fn';\nimport { CalendarEvent } from 'libs/events/src/lib/event.class';\n\nimport { CateringOrder } from './catering-order.class';\nimport { CateringOrderStatus } from './catering.interfaces';\n\nexport interface CateringOrderFilters {\n    /** UTC epoch of the date to get catering orders for */\n    date?: number;\n    /** List of zones to filter catering order bookings */\n    zones?: string[];\n    /** Search string to filter orders on */\n    search?: string;\n}\n\nfunction checkOrder(\n    order: CateringOrder,\n    filters: CateringOrderFilters\n): boolean {\n    const s = (filters.search || '').toLowerCase();\n    return !!order.items.find(\n        (item) =>\n            item.name.toLowerCase().includes(s) ||\n            !!item.options.find((option) =>\n                option.name.toLowerCase().includes(s)\n            )\n    );\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class CateringOrdersService extends BaseClass {\n    private _poll = new BehaviorSubject<number>(0);\n    private _loading = new BehaviorSubject<boolean>(false);\n    private _filters = new BehaviorSubject<CateringOrderFilters>({});\n\n    /** Observable for list of orders */\n    public readonly orders: Observable<CateringOrder[]> = combineLatest([\n        this._filters,\n        this._poll,\n    ]).pipe(\n        debounceTime(500),\n        switchMap(([filters]) => {\n            this._loading.next(true);\n            const start = getUnixTime(startOfDay(filters.date || Date.now()));\n            const end = getUnixTime(endOfDay(filters.date || Date.now()));\n            return queryEvents({\n                zone_ids: (filters.zones || []).join(','),\n                period_start: start,\n                period_end: end,\n            });\n        }),\n        map((events) => flatten(events.map((event) => event.ext('catering')))),\n        tap(() => this._loading.next(false)),\n        shareReplay(1)\n    );\n    /** Observable for loading status of orders */\n    public readonly loading = this._loading.asObservable();\n    /** Order filters */\n    public get filters() {\n        return this._filters.getValue();\n    }\n    /** Order filters */\n    public set filters(filters: CateringOrderFilters) {\n        this._filters.next(filters);\n    }\n    /** Filtered list of catering orders */\n    public readonly filtered = this.orders.pipe(\n        map((list) =>\n            list.filter((order) => checkOrder(order, this._filters.getValue()))\n        )\n    );\n\n    constructor() {\n        super();\n        this.subscription('changes', this.orders.subscribe());\n    }\n\n    /** Start polling for catering orders */\n    public startPolling(delay: number = 15 * 1000) {\n        this.interval(\n            'polling',\n            () => this._poll.next(new Date().valueOf()),\n            delay\n        );\n    }\n\n    /** Stop polling for new catering orders */\n    public stopPolling() {\n        this.clearInterval('polling');\n    }\n\n    /**\n     * Update the status of the order\n     * @param order Order to update\n     * @param status New order status\n     */\n    public updateStatus(order: CateringOrder, status: CateringOrderStatus) {\n        const updated_order = new CateringOrder({ ...order, status });\n        const event = new CalendarEvent({\n            ...order.event,\n            catering: [\n                ...order.event.ext('catering').filter((o) => o.id !== order.id),\n                updated_order,\n            ].map((i) => new CateringOrder({ ...i })),\n        });\n        return saveEvent(event);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { updateMetadata, showMetadata } from '@placeos/ts-client';\nimport { BehaviorSubject } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\nimport {\n    BaseClass,\n    flatten,\n    notifyError,\n    notifySuccess,\n    openConfirmModal,\n    SettingsService,\n    unique,\n} from '@placeos/common';\nimport { Building, OrganisationService } from '@placeos/organisation';\n\nimport {\n    CateringItemModalComponent,\n    CateringItemModalData,\n} from './catering-item-modal.component';\nimport {\n    CateringItemOptionModalComponent,\n    CateringItemOptionModalData,\n} from './catering-option-modal.component';\nimport {\n    CateringConfigModalComponent,\n    CateringConfigModalData,\n} from './catering-config-modal.component';\nimport { CateringItem } from './catering-item.class';\nimport { CateringOrder } from './catering-order.class';\nimport {\n    CateringOrderModalComponent,\n    CateringOrderModalData,\n} from './catering-order-modal.component';\nimport { CateringOption, CateringRuleset } from './catering.interfaces';\nimport {\n    CateringOrderOptionsModalComponent,\n    CateringOrderOptionsModalData,\n} from './catering-order-options-modal.component';\nimport { CateringImportMenuModalComponent } from './catering-import-menu-modal.component';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class CateringStateService extends BaseClass {\n    /** Active menu */\n    private _menu = new BehaviorSubject<CateringItem[]>([]);\n    /** Whether the menu for the active building is loading */\n    private _loading = new BehaviorSubject<boolean>(false);\n    /** Currency code for the active building */\n    private _currency = new BehaviorSubject<string>('USD');\n    /** Observable for the active menu */\n    public readonly menu = this._menu.asObservable();\n    /** Observable for whether the menu for the active building is loadingg */\n    public readonly loading = this._loading.asObservable();\n    /** Observable for the currency code of the active building */\n    public readonly currency = this._currency.asObservable();\n\n    public get categories() {\n        const menu = this._menu.getValue();\n        return unique(menu.map((i) => i.category));\n    }\n\n    constructor(private _org: OrganisationService, private _dialog: MatDialog, private _settings: SettingsService) {\n        super();\n        this.subscription(\n            'building',\n            this._org.active_building.subscribe(async (bld: Building) => {\n                if (bld) {\n                    const menu = (await this.getCateringForZone(bld.id)).map(\n                        (i) => new CateringItem(i)\n                    );\n                    this._currency.next(this._settings.get('app.currency') || bld.currency || 'USD');\n                    this._menu.next(menu);\n                }\n            })\n        );\n    }\n\n    /**\n     * Create/Edit catering order\n     * @param order Order to manipulate\n     */\n    public async manageCateringOrder(order: CateringOrder) {\n        const ref = this._dialog.open<\n            CateringOrderModalComponent,\n            CateringOrderModalData\n        >(CateringOrderModalComponent, {\n            data: {\n                code: this._currency.getValue(),\n                order,\n                menu: this.menu,\n                loading: this.loading,\n                getCateringConfig: (_) => this.getCateringConfig(_),\n                selectOptions: (_) => this.selectOptions(_),\n            },\n        });\n        const details = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        ref.close();\n        return details?.metadata?.order || order;\n    }\n\n    public async addItem(item: CateringItem = new CateringItem()) {\n        const ref = this._dialog.open<\n            CateringItemModalComponent,\n            CateringItemModalData\n        >(CateringItemModalComponent, {\n            data: {\n                item,\n                categories: this.categories,\n            },\n        });\n        const details = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (details?.reason !== 'done') return;\n        const menu = this._menu.getValue();\n        const index = menu.findIndex((itm) => itm.id === item.id);\n        if (index >= 0) {\n            menu.splice(index, 1, details.metadata.item);\n        } else {\n            menu.push(details.metadata.item);\n        }\n        this.updateMenu(this._org.building.id, menu).then(\n            () => {\n                this._menu.next([...menu]);\n                ref.close();\n            },\n            () => (ref.componentInstance.loading = false)\n        );\n    }\n\n    public async addOption(\n        item: CateringItem,\n        option: CateringOption = {} as any\n    ) {\n        const types = unique(item.options.map((i) => i.group));\n        const ref = this._dialog.open<\n            CateringItemOptionModalComponent,\n            CateringItemOptionModalData\n        >(CateringItemOptionModalComponent, {\n            data: {\n                parent: item,\n                option,\n                types,\n            },\n        });\n        const details = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (details?.reason !== 'done') return;\n        const menu = this._menu.getValue();\n        const index = menu.findIndex((itm) => itm.id === item.id);\n        if (index >= 0) {\n            menu.splice(index, 1, details.metadata.item);\n        } else {\n            menu.push(details.metadata.item);\n        }\n        this.updateMenu(this._org.building.id, menu).then(\n            () => {\n                this._menu.next([...menu]);\n                ref.close();\n            },\n            () => (ref.componentInstance.loading = false)\n        );\n    }\n\n    public async selectOptions(options: CateringOption[]) {\n        const ref = this._dialog.open<\n            CateringOrderOptionsModalComponent,\n            CateringOrderOptionsModalData\n        >(CateringOrderOptionsModalComponent, {\n            data: {\n                code: this._currency.getValue(),\n                options,\n            },\n        });\n        const details = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (details?.reason !== 'done') return [];\n        ref.close();\n        return details.metadata.options;\n    }\n\n    public async deleteItem(item: CateringItem) {\n        const details = await openConfirmModal(\n            {\n                title: 'Delete Catering Item',\n                content: `Are you sure you wish to remove the catering item ${item.name} from the menu?`,\n                icon: {\n                    type: 'icon',\n                    class: 'material-icons',\n                    content: 'delete',\n                },\n            },\n            this._dialog\n        );\n        if (details.reason !== 'done') return;\n        details.loading('Removing catering item...');\n        const menu = this._menu.getValue().filter((itm) => item.id !== itm.id);\n        this.updateMenu(this._org.building.id, menu).then(\n            () => {\n                this._menu.next([...menu]);\n                details.close();\n            },\n            () => details.loading('')\n        );\n    }\n\n    public async deleteOption(item: CateringItem, option: CateringOption) {\n        const details = await openConfirmModal(\n            {\n                title: 'Delete Catering Item Option',\n                content: `Are you sure you wish to remove the catering option \"${option.name}\" from \"${item.name}\"?`,\n                icon: {\n                    type: 'icon',\n                    class: 'material-icons',\n                    content: 'delete',\n                },\n            },\n            this._dialog\n        );\n        if (details.reason !== 'done') return;\n        details.loading('Removing catering item option...');\n        const menu = this._menu.getValue();\n        menu.splice(\n            menu.findIndex((itm) => itm.id === item.id),\n            1,\n            new CateringItem({\n                ...item,\n                options: item.options.filter((opt) => opt.id !== option.id),\n            })\n        );\n        this.updateMenu(this._org.building.id, menu).then(\n            () => {\n                this._menu.next([...menu]);\n                details.close();\n            },\n            () => details.loading('')\n        );\n    }\n\n    public async editConfig() {\n        const config = await this.getCateringConfig(this._org.building.id);\n        const menu = this._menu.getValue();\n        const types = unique(flatten(menu.map((i) => [i.category, ...i.tags])));\n        const ref = this._dialog.open<\n            CateringConfigModalComponent,\n            CateringConfigModalData\n        >(CateringConfigModalComponent, {\n            data: {\n                config,\n                types,\n            },\n        });\n        const details = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (details?.reason !== 'done') return;\n        this.updateConfig(this._org.building.id, details.metadata).then(\n            () => ref.close(),\n            () => (ref.componentInstance.loading = false)\n        );\n    }\n\n    public async importMenu() {\n        const ref = this._dialog.open(CateringImportMenuModalComponent);\n        const details = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (details?.reason !== 'done') return;\n        ref.componentInstance.loading = 'Updating menu...';\n        const menu = this._menu.getValue();\n        const bld = this._org.building;\n        const updated_menu = unique(details.metadata.concat(menu), 'id');\n        await this.updateMenu(bld.id, updated_menu).catch((_) => {\n            notifyError('Error importing catering menu');\n            ref.close();\n            throw _;\n        });\n        notifySuccess(\n            `Successfully imported catering menu. ${details.metadata.length} item(s) added.`\n        );\n        ref.close();\n    }\n\n    private updateMenu(zone_id: string, menu: CateringItem[]) {\n        return updateMetadata(zone_id, {\n            id: zone_id,\n            name: 'catering',\n            details: menu,\n            description: `Catering menu for ${zone_id}`,\n        }).toPromise();\n    }\n\n    private async getCateringForZone(zone_id: string): Promise<CateringItem[]> {\n        const menu = (\n            await showMetadata(zone_id, 'catering').toPromise()\n        ).details;\n        return menu instanceof Array ? menu : [];\n    }\n\n    public async getCateringConfig(\n        zone_id: string = this._org.building.id\n    ): Promise<CateringRuleset[]> {\n        const rules = (\n            await showMetadata(zone_id, 'catering_config').toPromise()\n        ).details;\n        return rules instanceof Array ? (rules as any) : [];\n    }\n\n    private updateConfig(zone_id: string, config: CateringRuleset[]) {\n        return updateMetadata(zone_id, {\n            id: zone_id,\n            name: 'catering_config',\n            details: config,\n            description: `Catering menu config for ${zone_id}`,\n        }).toPromise();\n    }\n\n    public addItemToOrder(order: CateringOrder, new_item: CateringItem) {\n        let items = order.items;\n        const match = items.find(\n            (item) =>\n                item.id === new_item.id &&\n                new_item.options?.length ===\n                    item.options?.reduce(\n                        (c, o) =>\n                            c +\n                            (new_item.options.find((opt) => o.id === opt.id)\n                                ? 1\n                                : 0),\n                        0\n                    )\n        );\n        match\n            ? ((match as any).quantity += 1)\n            : (items = items.concat([\n                  new CateringItem({ ...new_item, quantity: 1 }),\n              ]));\n        const new_order = new CateringOrder({\n            ...order,\n            items,\n            event: null,\n        });\n        return new_order;\n    }\n}\n","import { Identity } from '@placeos/common';\n\n// Event catering order interfaces\nexport type CateringOrderStatus = 'accepted' | 'preparing' | 'ready' | 'delivered' | 'cancelled';\n\nexport interface CateringOptionGroup {\n    name: string;\n    multiple: boolean;\n    options: CateringOption[];\n}\n\nexport interface CateringOption {\n    /** Unique Identifier of the catering option */\n    readonly id: string;\n    /** Display name for the catering option */\n    readonly name: string;\n    /** Name of the group associated with the option */\n    readonly group: string;\n    /** Whether multiple items in the group can be selected */\n    readonly multiple: boolean;\n    /** Cost of adding the option to the item */\n    readonly unit_price: number;\n    /** Whether the catering option is active for the item */\n    active?: boolean;\n}\n\nexport type CateringRule =\n    | ['after_hour' | 'before_hour', number]\n    | ['min_length' | 'max_length' | 'is_before' | 'is_after' | 'visitor_type', string]\n    | ['groups', string[]];\n\nexport interface CateringRuleset {\n    /** ID of the ruleset. Zone ID, category or tag */\n    id: string;\n    /** Descriptive name of the ruleset */\n    name: string;\n    /** List of rules for the id */\n    rules: CateringRule[];\n}\n\nexport const RULE_TYPES: Identity[] = [\n    { id: 'after_hour', name: 'After Hour' },\n    { id: 'before_hour', name: 'Before Hour' },\n    { id: 'min_length', name: 'Min. Meeting Length' },\n    { id: 'max_length', name: 'Max. Meeting Length' },\n    { id: 'is_before', name: 'Is Before Time' },\n    { id: 'is_after', name: 'Is After Time' },\n    { id: 'visitor_type', name: 'Visitor Type' },\n    { id: 'groups', name: 'User in Groups' },\n]\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\n\nimport { CateringConfigModalComponent } from './catering-config-modal.component';\nimport { CateringItemModalComponent } from './catering-item-modal.component';\nimport { CateringMenuItemComponent } from './catering-menu-item.component';\nimport { CateringMenuComponent } from './catering-menu.component';\nimport { CateringItemOptionModalComponent } from './catering-option-modal.component';\nimport { CateringOrderItemComponent } from './catering-order-item.component';\nimport { CateringOrderListComponent } from './catering-order-list.component';\nimport { CateringOrderModalComponent } from './catering-order-modal.component';\nimport { CateringOrderOptionsModalComponent } from './catering-order-options-modal.component';\nimport { CateringOrderComponent } from './catering-order.component';\nimport { CateringImportMenuModalComponent } from './catering-import-menu-modal.component';\n\nimport { NewCateringOrderModalComponent } from './catering-order-modal/new-catering-order-modal.component';\nimport { CateringItemListComponent } from './catering-order-modal/catering-item-list.component';\nimport { CateringItemDetailsComponent } from './catering-order-modal/catering-item-details.component';\nimport { CateringItemFiltersComponent } from './catering-order-modal/catering-item-filters.component';\nimport { CateringListFieldComponent } from './catering-list-field.component';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { FormFieldsModule } from '@placeos/form-fields';\n\nconst COMPONENTS: Type<any>[] = [\n    CateringOrderOptionsModalComponent,\n    CateringOrderModalComponent,\n    CateringConfigModalComponent,\n    CateringItemModalComponent,\n    CateringMenuComponent,\n    CateringMenuItemComponent,\n    CateringItemOptionModalComponent,\n    CateringOrderListComponent,\n    CateringOrderComponent,\n    CateringOrderItemComponent,\n    CateringImportMenuModalComponent,\n\n    CateringListFieldComponent,\n    NewCateringOrderModalComponent,\n    CateringItemListComponent,\n    CateringItemDetailsComponent,\n    CateringItemFiltersComponent\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        MatMenuModule,\n        MatTabsModule,\n        MatAutocompleteModule,\n        MatDialogModule,\n        MatCheckboxModule,\n        MatRadioModule,\n        MatTooltipModule,\n        FormsModule,\n        ReactiveFormsModule,\n        ComponentsModule,\n        MatFormFieldModule,\n        FormFieldsModule\n    ],\n    providers: [],\n    exports: [...COMPONENTS],\n})\nexport class SharedCateringModule {}\n","export * from './catering-order-options-modal.component';\nexport * from './catering-order-modal.component';\nexport * from './catering-config-modal.component';\nexport * from './catering-item-modal.component';\nexport * from './catering-item.class';\nexport * from './catering-menu-item.component';\nexport * from './catering-menu.component';\nexport * from './catering-option-modal.component';\nexport * from './catering-order-item.component';\nexport * from './catering-order.component';\nexport * from './catering-order-list.component';\nexport * from './catering-order.class';\nexport * from './catering-orders.service';\nexport * from './catering-state.service';\nexport * from './catering.interfaces';\nexport * from './catering.module';\nexport * from './catering.vars';\nexport * from './catering-order-modal/new-catering-order-modal.component';\n","import { Identity } from '@placeos/common';\n\nexport const CATERING_STATUSES: Identity[] = [\n    { id: 'pending', name: 'Pending', icon: { class: 'custom-pending' }, colour: '#ccc' },\n    { id: 'accepted', name: 'Accepted', icon: { class: 'custom-accepted' }, colour: '#3996B6' },\n    {\n        id: 'preparing',\n        name: 'Preparing',\n        icon: { class: 'custom-preparing' },\n        colour: '#E7536B',\n    },\n    { id: 'ready', name: 'Ready', icon: { class: 'custom-ready' }, colour: '#FFD028' },\n    {\n        id: 'delivered',\n        name: 'Delivered',\n        icon: { class: 'custom-delivered' },\n        colour: '#75BB43',\n    },\n    {\n        id: 'cancelled',\n        name: 'Cancelled',\n        icon: { class: 'custom-cancelled' },\n        colour: '#747474',\n    },\n];\n","export * from './lib/common';\nexport * from './lib/feature-available.guard';\nexport * from './lib/remote-logging.service';\nexport * from './lib/timezone-helpers';","import { trigger, transition, style, animate, state } from '@angular/animations';\n\nexport const ANIMATION_SHOW_ENTER_LEAVE = trigger('show', [\n    transition(':enter', [\n        style({ opacity: 0, height: 0 }),\n        animate(300, style({ opacity: 1, height: '*' }))\n    ]),\n    transition(':leave', [\n        style({ opacity: 1, height: '*' }),\n        animate(300, style({ opacity: 0, height: 0 }))\n    ])\n]);\n\nexport const ANIMATION_SHOW_CONTRACT_EXPAND = trigger('show', [\n    state('show', style({ opacity: 1, height: '*' })),\n    state('hide', style({ opacity: 0, height: 0, 'pointer-events': 'none' })),\n    transition('show <=> hide', animate('200ms ease-in'))\n]);\n","import { HashMap } from \"./types\";\n\n/**\n * Convert map into a query string\n * @param map Key value pairs to convert\n */\nexport function toQueryString(map: HashMap) {\n    let str = '';\n    if (map) {\n        for (const key in map) {\n            if (key in map && map[key] !== undefined && map[key] !== null) {\n                str += `${(str ? '&' : '')}${key}=${encodeURIComponent(map[key])}`;\n            }\n        }\n    }\n    return str;\n}\n","import { SwUpdate } from '@angular/service-worker';\n\nimport { log } from './general';\nimport { notifyInfo } from './notifications';\n\nlet _timer: number;\n\n/**\n * Setup handler for cache change events\n * @param cache Angular Service worker service\n * @param notify Function to call on changes to the cache\n * @param interval Time interval to check the cache for changes\n */\nexport function setupCache(\n    cache: SwUpdate,\n    interval: number = 5 * 60 * 1000\n) {\n    if (cache.isEnabled) {\n        if (_timer) clearInterval(_timer);\n        _timer = <any>setInterval(() => {\n            log('CACHE', `Checking for updates...`);\n            activateUpdate(cache);\n        }, interval);\n    }\n}\n\nexport function clearCacheCheck() {\n    if (_timer) clearInterval(_timer);\n}\n\n/**\n * Update the cache and reload the page\n *\n */\nasync function activateUpdate(cache: SwUpdate) {\n    if (cache.isEnabled && await cache.checkForUpdate()) {\n        log('CACHE', `Activating changes to the cache...`);\n        if (!await cache.activateUpdate()) return;\n        notifyInfo('Newer version of the application is available', 'Refresh', () =>\n            location.reload()\n        );\n    }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\ntype VoidFn = () => void;\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class BaseClass implements OnDestroy {\n    /** Store for named timers */\n    protected _timers: { [name: string]: number } = {};\n    /** Store for named intervals */\n    protected _intervals: { [name: string]: number } = {};\n    /** Store for named subscription unsub callbacks */\n    protected _subscriptions: {\n        [name: string]: Subscription | VoidFn;\n    } = {};\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n\n    /** Whether the object has been initialised */\n    public get is_initialised(): boolean {\n        return this._initialised.getValue();\n    }\n\n    public ngOnDestroy(): void {\n        this.destroy();\n    }\n\n    protected destroy() {\n        for (const key in this._timers) {\n            if (key in this._timers) {\n                this.clearTimeout(key);\n            }\n        }\n        for (const key in this._intervals) {\n            if (key in this._intervals) {\n                this.clearInterval(key);\n            }\n        }\n        for (const key in this._subscriptions) {\n            if (key in this._subscriptions) {\n                this.unsub(key);\n            }\n        }\n    }\n\n    /**\n     * Creates a named timer\n     * @param name Name of the timer\n     * @param fn Callback function for the timer\n     * @param delay Callback delay\n     */\n    protected timeout(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearTimeout(name);\n            this._timers[name] = <any>setTimeout(() => {\n                fn();\n                delete this._timers[name];\n            }, delay);\n        } else {\n            throw new Error(\n                name\n                    ? 'Cannot create named timeout without a name'\n                    : 'Cannot create a timeout without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named timer\n     * @param name Timer name\n     */\n    protected clearTimeout(name: string) {\n        if (this._timers[name]) {\n            clearTimeout(this._timers[name]);\n            delete this._timers[name];\n        }\n    }\n\n    /**\n     * Creates a named interval\n     * @param name Name of the interval\n     * @param fn Callback function for the interval\n     * @param delay Callback delay\n     */\n    protected interval(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearInterval(name);\n            this._intervals[name] = <any>setInterval(() => fn(), delay);\n        } else {\n            throw new Error(\n                name\n                    ? 'Cannot create named interval without a name'\n                    : 'Cannot create a interval without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named interval\n     * @param name Timer name\n     */\n    protected clearInterval(name: string) {\n        if (this._intervals[name]) {\n            clearInterval(this._intervals[name]);\n            delete this._intervals[name];\n        }\n    }\n\n    /**\n     * Store named subscription\n     * @param name Name of the subscription\n     * @param unsub Unsubscribe callback or Subscription object\n     */\n    protected subscription(name: string, unsub: Subscription | VoidFn) {\n        this.unsub(name);\n        this._subscriptions[name] = unsub;\n    }\n\n    /**\n     * Call unsubscribe callback with the given name\n     * @param name\n     */\n    protected unsub(name: string) {\n        if (name in this._subscriptions) {\n            if (this._subscriptions[name] instanceof Subscription) {\n                (this._subscriptions[name] as any).unsubscribe();\n            } else if (this._subscriptions[name]) {\n                (this._subscriptions[name] as any)();\n            }\n            delete this._subscriptions[name];\n        }\n    }\n\n    /** Unsubscribe to the items with names containing the given string */\n    protected unsubWith(contains: string) {\n        const subs = Object.keys(this._subscriptions).filter((k) =>\n            k.includes(contains)\n        );\n        for (const key of subs) {\n            this.unsub(key);\n        }\n    }\n}\n","import { User } from 'libs/users/src/lib/user.class';\nimport { addMinutes, format } from 'date-fns';\nimport { toQueryString } from './api';\nimport { localToTimezone } from './timezone-helpers';\nimport { unique } from './general';\nimport { PlaceSystem } from '@placeos/ts-client';\n\nexport interface CalEvent {\n    title: string;\n    date: number;\n    duration: number;\n    all_day: boolean;\n    body: string;\n    location: string;\n    host: string;\n    organiser: User;\n    user_name?: string;\n    user_email?: string;\n    attendees: string[];\n    resources?: string[];\n    meeting_url?: string;\n    system?: PlaceSystem;\n}\n\nfunction formatUTC(date: Date | number) {\n    const utc_date = localToTimezone(date, 'UTC');\n    return `${format(utc_date, 'yyyyMMdd')}T${format(utc_date, 'HHmmss')}Z`;\n}\n\nfunction formatAllDay(date: Date | number) {\n    return `${format(date, 'yyyyMMdd')}`;\n}\n\nexport function generateCalendarFileLink(event: CalEvent): string {\n    const chunks: [string, any][] = [];\n    const description = formatCalFileText(`${event.body}`);\n    const location = formatCalFileText(`${event.location}`);\n    chunks.push(['BEGIN', 'VCALENDAR']);\n    chunks.push(['VERSION', '2.0']);\n    chunks.push(['BEGIN', 'VEVENT']);\n    chunks.push(['URL', `${event.meeting_url}`]);\n    chunks.push(['DTSTART', `${new Date(event.date).toISOString()}`]);\n    chunks.push([\n        'DTEND',\n        `${addMinutes(event.date, event.duration ?? 60).toISOString()}`,\n    ]);\n    chunks.push(['SUMMARY', `${event.title}`]);\n    chunks.push(['DESCRIPTION', description]);\n    chunks.push(['LOCATION', location]);\n    const host =\n        event.organiser?.name ||\n        event.host?.split('@') ||\n        event.user_name ||\n        'User';\n    chunks.push([\n        'ORGANIZER',\n        `CN=${host}:MAILTO:${event.host || event.user_email}`,\n    ]);\n    const url_data = chunks\n        .map(([key, value]) => `${key}:${encodeURIComponent(value)}`)\n        .join('\\n');\n    return `data:text/calendar;charset=utf8,${url_data}`;\n}\n\nexport function generateGoogleCalendarLink(event: CalEvent): string {\n    const fmt = event.all_day ? formatAllDay : formatUTC;\n    const details: any = {\n        action: 'TEMPLATE',\n        text: event.title,\n        details: event.body,\n        location: event.location,\n        trp: false,\n        dates: `${fmt(event.date)}/${fmt(\n            addMinutes(event.date, event.duration ?? 60)\n        )}`,\n    };\n    const emails = (event.attendees || []).map((_: any) => _.email || _);\n    const resources = ((event.resources?.length ? event.resources : null) || [event.system]).map((_: any) => _?.email || _)\n    if (emails.length || resources.length) details.add = unique([...emails, ...resources]).join();\n    return `https://calendar.google.com/calendar/render?${toQueryString(\n        details\n    )}`;\n}\n\nexport function generateMicrosoftCalendarLink(\n    event: CalEvent,\n    type: 'outlook' | 'office' = 'outlook'\n): string {\n    if (!event.date) event.date = Date.now();\n    const data = {\n        path: '/calendar/action/compose',\n        rru: 'addevent',\n        startdt: new Date(event.date).toISOString(),\n        enddt: addMinutes(event.date, event.duration ?? 60).toISOString(),\n        subject: event.title,\n        body: event.body,\n        location: event.location,\n        allday: event.all_day ?? false,\n    };\n    return type === 'office'\n        ? `https://outlook.office.com/calendar/0/deeplink/compose?${toQueryString(\n              data\n          )}`\n        : `https://outlook.live.com/calendar/0/deeplink/compose?${toQueryString(\n              data\n          )}`;\n}\n\nfunction formatCalFileText(str: string) {\n    return str\n        .replace(/,/gm, ',')\n        .replace(/;/gm, ';')\n        .replace(/\\r\\n/gm, '\\n')\n        .replace(/\\n/gm, '\\\\n')\n        .replace(/(\\\\n)[\\s\\t]+/gm, '\\\\n');\n}\n","export { BaseClass } from './base.class';\nexport { GoogleAnalyticsService } from './google-analytics.service';\nexport { HotkeysService } from './hotkeys.service';\nexport { SettingsService } from './settings.service';\nexport { VorlonService } from './vorlon.service';\nexport { VERSION } from './version';\n\nexport * from './angular-animations';\nexport * from './api';\nexport * from './application';\nexport * from './formatting';\nexport * from './general';\nexport * from './notifications';\nexport * from './placeos';\nexport * from './room-configuration.interface';\nexport * from './settings';\nexport * from './types';\nexport * from './user-state';\nexport * from './spec-helpers';\n","import { Injectable } from '@angular/core';\nimport { CanActivate, CanLoad, UrlTree, Router } from '@angular/router';\nimport { first } from 'rxjs/operators';\n\nimport { SettingsService } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nexport abstract class PLACEOS_APP_ACCESS {\n    public readonly group: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class FeatureAvailableGuard implements CanActivate, CanLoad {\n    constructor(\n        private _router: Router,\n        private _settings: SettingsService,\n        private _org: OrganisationService\n    ) {}\n\n    public async canActivate(): Promise<boolean | UrlTree> {\n        return this.checkFeature();\n    }\n\n    public async canLoad(): Promise<boolean> {\n        return this.checkFeature();\n    }\n\n    private async checkFeature() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        const features = this._settings.get('app.disabled_features') || [];\n        const can_activate = !features.find((_) =>\n            this._router.url.includes(_)\n        );\n        if (!can_activate) {\n            this._router.navigate(['/']);\n        }\n        return !!can_activate;\n    }\n}\n","\nimport { format } from 'date-fns';\n\nimport { RecurrenceDetails } from '@placeos/events';\n\nexport function formatRecurrence(details: RecurrenceDetails): string {\n    let pattern: string = details.pattern || '';\n    pattern = pattern.charAt(0).toUpperCase() + pattern.slice(1);\n    return pattern ? `${pattern} until ${format(new Date(details.end), 'do MMM yyyy')}` : '<No Recurrence>';\n}\n","import { FormGroup } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\nimport { first } from 'rxjs/operators';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA,\n} from '../../../components/src/lib/confirm-modal.component';\nimport { HashMap } from './types';\n\n/** Available console output streams. */\nexport type ConsoleStream = 'debug' | 'warn' | 'log' | 'error';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n        jest: any;\n    }\n}\n\nlet _app_name = 'APP';\n\nexport function setAppName(name: string) {\n    _app_name = name;\n}\n\n/**\n * Log data to the browser console\n * @param type Type of message\n * @param msg Message body\n * @param args array of argments to log to the console\n * @param stream Stream to emit the console on. 'debug', 'log', 'warn' or 'error'\n * @param force Whether to force message to be emitted when debug is disabled\n */\nexport function log(\n    type: string,\n    msg: string,\n    args?: any,\n    stream: ConsoleStream = 'debug',\n    force: boolean = false,\n    app_name: string = _app_name\n) {\n    if (window.jest) return;\n    if (window.debug || force) {\n        const colors: string[] = [\n            'color: #E91E63',\n            'color: #3F51B5',\n            'color: default',\n        ];\n        if (args) {\n            console[stream](\n                `%c[${app_name}]%c[${type}] %c${msg}`,\n                ...colors,\n                args\n            );\n        } else {\n            console[stream](`%c[${app_name}]%c[${type}] %c${msg}`, ...colors);\n        }\n    }\n}\n\n/**\n * Get item from the nested object\n * @param keys List of sub-keys to search for\n * @param map Object to search\n */\nexport function getItemWithKeys(keys: string[], map: HashMap) {\n    const key = keys[0];\n    if (map && key in map) {\n        return keys.length > 1\n            ? getItemWithKeys(keys.slice(1), map[key] || {})\n            : map[key];\n    }\n    return null;\n}\n\n/**\n * Remove duplicates from the given array\n * @param array List of items to remove duplicates from\n * @param key Key on array objects to compare for uniqueness\n */\nexport function unique<T = any>(array: T[] = [], key: string = ''): T[] {\n    return array.filter(\n        (el, pos, arr) =>\n            arr.indexOf(\n                key\n                    ? arr.find((i) => i[key] === el[key])\n                    : arr.find((i) => i === el)\n            ) === pos\n    );\n}\n\n/**\n * Generate a random number\n * @param ceil Biggest value to generate not inclusive\n * @param floor Smallest value to generate. Defaults to 0\n */\nexport function randomInt(ceil: number, floor: number = 0) {\n    return Math.floor(Math.random() * (ceil - floor)) + floor;\n}\n\n/**\n * Pad string to the given length\n * @param str Base string\n * @param length Length to pad the string\n */\nexport function padString(str: string | number, length: number = 5) {\n    str = `${str}`;\n    while (str.length < length) str = `0${str}`;\n    return str;\n}\n\n/**\n * Generate a random string\n * @param length Length of the string\n * @param chars Available characters to use in the string\n */\nexport function randomString(\n    length: number,\n    chars: string = 'abcdefghijklmnopqrstwvxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n) {\n    let str = '';\n    for (let i = 0; i < length; i++) {\n        str += chars[randomInt(chars.length)];\n    }\n    return str;\n}\n\nexport interface ConfirmRepsonse {\n    reason: 'done' | '' | null;\n    loading: (_: string) => void;\n    close: () => void;\n}\n\nexport async function openConfirmModal(\n    data: ConfirmModalData,\n    dialog: MatDialog\n): Promise<ConfirmRepsonse> {\n    const ref = dialog.open<ConfirmModalComponent, ConfirmModalData>(\n        ConfirmModalComponent,\n        {\n            ...CONFIRM_METADATA,\n            data,\n        }\n    );\n    return {\n        ...(await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ])),\n        loading: (s) => (ref.componentInstance.loading = s),\n        close: () => ref.close(),\n    };\n}\n\n/**\n * Parse raw CSV data into a JSON object\n * @param csv CSV data to parse\n */\nexport function csvToJson(csv: string, delimiter: string = ','): HashMap[] {\n    const objPattern = new RegExp(\n        '(\\\\,|\\\\r?\\\\n|\\\\r|^)(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|([^\\\\,\\\\r\\\\n]*))',\n        'gi'\n    );\n    let arrMatches = null;\n    const arrData = [[]];\n    while ((arrMatches = objPattern.exec(csv))) {\n        if (arrMatches[1].length && arrMatches[1] !== ',') arrData.push([]);\n        arrData[arrData.length - 1].push(\n            arrMatches[2]\n                ? arrMatches[2].replace(new RegExp('\"\"', 'g'), '\"')\n                : arrMatches[3]\n        );\n    }\n    const headers: string[] = arrData.splice(0, 1)[0];\n    const elements = arrData.map((row) => {\n        const element = {};\n        for (let i = 0; i < row.length; i++) {\n            const key = (headers[i] || '').split(' ').join('_').toLowerCase();\n            try {\n                element[key] = JSON.parse(row[i]);\n            } catch (e) {\n                element[key] = row[i] || '';\n            }\n            if (element[key] === 'TRUE' || element[key] === 'FALSE') \n                element[key] = element[key] === 'TRUE';\n        }\n        return element;\n    });\n    return elements;\n}\n\nexport function loadTextFileFromInputEvent(event: InputEvent) {\n    return new Promise<string>((resolve, reject) => {\n        /* istanbul ignore else */\n        if (event.target) {\n            const element = event.target as HTMLInputElement;\n            const file = element.files[0];\n            /* istanbul ignore else */\n            if (file) {\n                const reader = new FileReader();\n                reader.readAsText(file, 'UTF-8');\n                reader.addEventListener('load', (evt) => {\n                    resolve((evt.srcElement as any).result);\n                    element.value = '';\n                });\n                reader.addEventListener('error', (_) => {\n                    this.loading = '';\n                    reject(['Error loading file', _]);\n                });\n            }\n        }\n    });\n}\n\n/**\n * Convert javascript array to CSV string\n * @param json Javascript array to convert\n */\nexport function jsonToCsv(json: HashMap[]) {\n    if (json instanceof Array && json.length > 0) {\n        const keys = Object.keys(json[0]);\n        const valid_keys = keys.filter((key) => key in json[0]);\n        return `${valid_keys.join(',')}\\n${json\n            .map((item) =>\n                valid_keys.map((key) => JSON.stringify(item[key])).join(',')\n            )\n            .join('\\n')}`;\n    }\n    return '';\n}\n\n/**\n * Downloads a file to the users computer with the given filename and contents\n * @param filename Name of the file to download\n * @param contents Contents of the file to download\n */\nexport function downloadFile(filename: string, contents: string) {\n    const element = document.createElement('a');\n    element.setAttribute(\n        'href',\n        'data:text/plain;charset=utf-8,' + encodeURIComponent(contents)\n    );\n    element.setAttribute('download', filename);\n\n    element.style.display = 'none';\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n}\n\nexport function parseJWT(token: string) {\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(\n        atob(base64)\n            .split('')\n            .map((c) => {\n                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n            })\n            .join('')\n    );\n    return JSON.parse(jsonPayload);\n}\n\n/* istanbul ignore next */\n/**\n * Flatten nested array\n * @param an_array Array to flatten\n */\nexport function flatten<T = any>(an_array: T[]) {\n    const stack = [...an_array];\n    const res = [];\n    while (stack.length) {\n        // pop value from stack\n        const next = stack.pop();\n        if (Array.isArray(next)) {\n            // push back array items, won't modify the original input\n            stack.push(...next);\n        } else {\n            res.push(next);\n        }\n    }\n    // reverse to restore input order\n    return res.reverse();\n}\n\n/**\n * Check whether two time periods intersect with each other\n * @param start1 Unix epoch in ms of the first period's start time\n * @param end1 Unix epoch in ms of the first period's end time\n * @param start2 Unix epoch in ms of the second period's start time\n * @param end2 Unix epoch in ms of the second period's end time\n */\nexport function timePeriodsIntersect(start1, end1, start2, end2) {\n    return (\n        (start1 >= start2 && start1 < end2) ||\n        (end1 > start2 && end1 < end2) ||\n        (start2 >= start1 && start2 < end1) ||\n        (end2 > start1 && end2 <= end1)\n    );\n}\n\nconst seed = xmur3('PlaceOS');\nconst rand = sfc32(0x9e3779b9, 0x243f6a88, 0xb7e15162, seed());\n\nexport function predictableRandomInt(ceil: number = 100, floor: number = 0) {\n    return Math.floor(rand() * (ceil - floor)) + floor;\n}\n\n// https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript\nfunction xmur3(str) {\n    let h = 1779033703 ^ str.length;\n    for (let i = 0; i < str.length; i++)\n        (h = Math.imul(h ^ str.charCodeAt(i), 3432918353)),\n            (h = (h << 13) | (h >>> 19));\n    return function () {\n        h = Math.imul(h ^ (h >>> 16), 2246822507);\n        h = Math.imul(h ^ (h >>> 13), 3266489909);\n        return (h ^= h >>> 16) >>> 0;\n    };\n}\n\nfunction sfc32(a, b, c, d) {\n    return function () {\n        a >>>= 0;\n        b >>>= 0;\n        c >>>= 0;\n        d >>>= 0;\n        let t = (a + b) | 0;\n        a = b ^ (b >>> 9);\n        b = (c + (c << 3)) | 0;\n        c = (c << 21) | (c >>> 11);\n        d = (d + 1) | 0;\n        t = (t + d) | 0;\n        c = (c + t) | 0;\n        return (t >>> 0) / 4294967296;\n    };\n}\n\n/** Get time format string for locale */\nexport function timeFormatString(): string {\n    return is24HourTime() ? 'HH:mm' : 'h:mm a';\n}\n\n/** Whether locale string is displayed in 24 hour time */\nexport function is24HourTime(): boolean {\n    const date = new Date();\n    const localeString = date\n        .toLocaleTimeString(\n            document.querySelector('html').getAttribute('lang') ||\n                navigator.language\n        )\n        .toLowerCase();\n    return localeString.indexOf('am') < 0 && localeString.indexOf('pm') < 0;\n}\n\nexport function getInvalidFields(form: FormGroup, prefix: string = '') {\n    let invalid = [];\n    for (const key in form.controls) {\n        if (form.controls[key] instanceof FormGroup) {\n            invalid = [\n                ...invalid,\n                ...getInvalidFields(form.controls[key] as FormGroup, `${key}.`),\n            ];\n        } else if (!form.controls[key].valid) {\n            invalid.push(`${prefix}${key}`);\n        }\n    }\n    return invalid;\n}\n\nexport function removeEmptyFields(obj: Record<string, any>) {\n    for (const key in obj) {\n        if (obj[key] === undefined || obj[key] === null || obj[key] === \"\") {\n            delete obj[key];\n        }\n    }\n}\n\nexport function capitalizeFirstLetter(word: string): string {\n    return `${word[0].toUpperCase()}${word.substring(1)}`;\n}\n","import { Injectable } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\n\ndeclare global {\n    interface Window {\n        ga: any;\n        debug: boolean;\n    }\n}\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class GoogleAnalyticsService {\n    /** Google Analytics API object */\n    private service: any;\n    /** Application prefix to add to event categories */\n    public app_prefix: string;\n    /** Whether posting analytics events is enabled */\n    public enabled = true;\n    /** Name of the application */\n    public app_name = 'GA_APP';\n\n    /** Last route posted to the API */\n    private last_route: string;\n    /** Store for timer ids */\n    private timers: { [name: string]: number } = {};\n\n    constructor(private title: Title) {\n        if (!window.ga) {\n            (function(i, s, o, g, r, a, m) {\n                i['GoogleAnalyticsObject'] = r;\n                (i[r] =\n                    i[r] ||\n                    function() { (i[r].q = i[r].q || []).push(arguments); }), (i[r].l = 1 * (new Date() as any));\n                (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);\n                a.async = 1;\n                a.src = g;\n                m.parentNode.insertBefore(a, m);\n            })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');\n            console.log('Service', 'Injected Google Analytics into page');\n        }\n        this.service = window.ga;\n    }\n\n    /**\n     * Initialise Google Analytics\n     * @param tracking_id GA Tracking ID\n     */\n    public load(tracking_id: string) {\n        if (!this.enabled) { throw new Error('Google Analytics needs to be enabled before being initialised') }\n        if (!this.service) { throw new Error('Google Analytics hasn\\'t been installed on this page'); }\n        console.log('Service', `Setup with tracking ID: ${tracking_id}`);\n        this.service('create', tracking_id, 'auto');\n        this.service('send', 'pageview');\n    }\n    /**\n     * Set User ID for the Google Analytics session\n     * @param id Identifier of the User\n     */\n    public setUser(id: string) {\n        if (!this.service) { throw new Error('Google Analytics hasn\\'t been installed on this page'); }\n        if (this.enabled) {\n            this.timeout(`user|${id}`, () => {\n                console.log('Service', `Set user ID: ${id}`);\n                this.service('set', 'userId', id);\n                this.event('authentication', 'user-id available');\n            }, 100);\n        }\n    }\n\n    /**\n     * Post event to Google Analytics API\n     * @param category Event Category\n     * @param action Event Action\n     * @param label Event Label\n     * @param value Event Value\n     */\n    public event(category: string, action: string, label?: string, value?: string) {\n        if (!this.service) { throw new Error('Google Analytics hasn\\'t been installed on this page'); }\n        if (this.enabled) {\n            this.timeout(`event|${category}|${action}|${label}|${value}`, () => {\n                const l = label ? ', ' + label : '';\n                console.log('Service', `Event: ${category}, ${action}${l}${value ? ', ' + value : ''}`);\n                const prefix = this.app_prefix ? this.app_prefix + '_' : ''\n                this.service('send', 'event', `${prefix}${category}`, action, label, value);\n            }, 100);\n        }\n    }\n\n    /**\n     * Post screen change event to Google Analytics API\n     * @param name\n     * @param app_name\n     */\n    public screen(name: string, app_name?: string) {\n        if (!this.service) { throw new Error('Google Analytics hasn\\'t been installed on this page'); }\n        if (name && this.enabled) {\n            this.timeout(`event|${name}|${app_name || this.app_name}`, () => {\n                console.log('Service', `Screen: ${name}${app_name ? ', ' + app_name : ''}`);\n                this.service('send', 'screenview', {\n                    appName: app_name || this.app_name,\n                    screenName: name\n                });\n            }, 100);\n        }\n    }\n\n    /**\n     * Post routing event to Google Analytics API\n     * @param route Activated route\n     * @param origin Add origin to routh path\n     */\n    public page(route: string, origin: boolean = false) {\n        if (!this.service) { throw new Error('Google Analytics hasn\\'t been installed on this page'); }\n        if (this.enabled) {\n            this.last_route = route || '/';\n            this.timeout(`page|${route}`, () => {\n                console.log('Service', `Page: ${route}`);\n                this.service('send', 'pageview', `${origin ? location.origin : ''}${route}`);\n            }, 100);\n        }\n    }\n\n    /**\n     * Post timing event to Google Analytics API\n     * @param category\n     * @param variable\n     * @param value\n     * @param label\n     */\n    public timing(category: string, variable: string, value: string, label?: string) {\n        if (!this.service) { throw new Error('Google Analytics hasn\\'t been installed on this page'); }\n        if (this.enabled) {\n            this.timeout(`page|${category}|${variable}|${value}|${label}`, () => {\n                console.log('Service', `Timing: ${category}, ${variable}, ${value}${label ? ', ' + label : ''}`);\n                this.service('send', 'timing', category, variable, value, label);\n            }, 100);\n        }\n    }\n\n    /**\n     * Creates a timeout for the given name used for preventing duplicate events in quick succession\n     * @param name Name of timer\n     * @param fn Timer callback\n     * @param delay Timer delay\n     */\n    private timeout(name: string, fn: () => void, delay: number = 300) {\n        if (this.timers[name]) {\n            clearTimeout(this.timers[name]);\n            delete this.timers[name];\n        }\n        this.timers[name] = <any>setTimeout(() => {\n            if (fn instanceof Function) { fn(); }\n            delete this.timers[name];\n        }, delay);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport { HashMap } from './types';\nimport { unique } from './general';\n\n/** List of keys that cannot be in a combination by themselves or with each other */\nconst INVALID_STANDALONE_KEYS: string[] = ['control', 'shift', 'alt', 'meta', 'os'];\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class HotkeysService {\n    /** Map of subjects which store press states of keys */\n    private keydown_states: HashMap<BehaviorSubject<number>> = {};\n    /** Map of obserers for key state subjects */\n    private keydown_observers: HashMap<Observable<number>> = {};\n    /** List of keys at the end of a combination */\n    private combo_end: string[] = [];\n    /** List of registered hotkey combinations */\n    private registered_combos: string[][] = [];\n    /** Counter for the number of keydown events. Used for checking order of key presses */\n    private counter: number = 0;\n    /** Last key code to be pressed */\n    private last_down: string;\n\n    constructor() {\n        window.addEventListener('keydown', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            if (this.last_down !== code) {\n                if (!this.keydown_states[code]) {\n                    this.keydown_states[code] = new BehaviorSubject(null);\n                    this.keydown_observers[code] = this.keydown_states[code].asObservable();\n                }\n                this.keydown_states[code].next(++this.counter);\n                if (this.combo_end.indexOf(code) >= 0) {\n                    event.preventDefault();\n                }\n                this.last_down = code;\n            }\n        });\n\n        window.addEventListener('keyup', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            this.keydown_states[code].next(null);\n            if (this.last_down === code) {\n                this.last_down = null;\n            }\n        });\n    }\n\n    /**\n     * Listen to the given key combination\n     * @param combo Array of key codes to listen to or a hotkey string e.g. `Alt+Shift+KeyK`\n     * @param next Callback for combination presses\n     */\n    public listen(combo: string | string[], next: () => void): Subscription {\n        combo = (combo instanceof Array ? combo : combo.split('+'));\n        const combination: string[] = combo.map(i => this.mapKey(i.toLowerCase()));\n        if (combination.length > 0 && this.validCombination(combination)) {\n            this.registered_combos.push(combination);\n            const last_key = combination[combination.length - 1];\n            if (!this.keydown_states[last_key]) {\n                this.keydown_states[last_key] = new BehaviorSubject(null);\n                this.keydown_observers[last_key] = this.keydown_states[last_key].asObservable();\n            }\n            this.updateCombinationEndList();\n            return this.keydown_observers[last_key].subscribe((count) => {\n                if (count) {\n                    const presses: number[] = [];\n                    if (combination.length > 0) {\n                        // Check that keys are pressed\n                        for (const key of combination) {\n                            const state = this.keydown_states[key];\n                            presses.push(state ? state.getValue() || -1 : -1);\n                        }\n                        // Check that keys are pressed in the correct order\n                        for (let i = 0; i < combination.length - 1; i++) {\n                            if (presses[i] > presses[i + 1]) { return; }\n                        }\n                    }\n                    const total = presses.reduce((a, v) => a + (v > 0 ? 1 : -1), 0);\n                    if (total >= combination.length) {\n                        next();\n                    }\n                }\n            });\n        }\n        return null;\n    }\n\n    /**\n     * Map key codes with multiple versions to simple form\n     * @param code Code to transform\n     */\n    private mapKey(code: string): string {\n        if (code.indexOf('alt') >= 0 || code.indexOf('shift') >= 0 || code.indexOf('control') >= 0) {\n            return code.replace('left', '').replace('right', '');\n        }\n        return code;\n    }\n\n    /**\n     * Update the list of the last keys in combinations to allow for prevent default actions on pre-existing hotkeys\n     */\n    private updateCombinationEndList(): void {\n        const key_list = [];\n        for (const combo of this.registered_combos) {\n            this.combo_end.push(combo[combo.length - 1]);\n        }\n        this.combo_end = unique(key_list);\n    }\n\n    /**\n     * Checks if the given hotkey combination is allowed and valid\n     * @param combo Array of key codes\n     */\n    private validCombination(combo: string[]): boolean {\n        let non_meta = 0;\n        for (const key of combo) {\n            if (INVALID_STANDALONE_KEYS.indexOf(key) < 0) {\n                non_meta++;\n            }\n        }\n        return non_meta > 0;\n    }\n}\n","import { MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';\n\nlet _service: MatSnackBar;\n\nexport function setNotifyOutlet(snackbar: MatSnackBar) {\n    _service = snackbar;\n}\n\n/**\n * Create notification popup\n * @param type CSS Class to add to the notification\n * @param message Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notify(\n    type: string,\n    message: string,\n    action: string = 'OK',\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    if (!_service) {\n        return console.warn(\"Snackbar service hasn't been initialised\");\n    }\n    const snackbar_ref = _service.open(message, action, {\n        panelClass: [type],\n        duration: 5000,\n        ...config,\n    });\n    if (action) {\n        on_action = on_action || (() => snackbar_ref.dismiss());\n        snackbar_ref.onAction().subscribe(() => on_action());\n    }\n}\n\n/**\n * Create success notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifySuccess(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.debug(msg);\n    notify('success', msg, action, on_action, config);\n}\n\n/**\n * Create error notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyError(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.error(msg);\n    notify('error', msg, action, on_action, config);\n}\n\n/**\n * Create warning notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyWarn(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.warn(msg);\n    notify('warn', msg, action, on_action, config);\n}\n\n/**\n * Create info notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyInfo(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.info(msg);\n    notify('info', msg, action, on_action, config);\n}\n","import { PlaceAuthOptions, setup } from '@placeos/ts-client';\nimport { notifyInfo } from './notifications';\n\nexport interface PlaceSettings {\n    /** Protocol used by the application server */\n    protocol: 'http:' | 'https:';\n    /** Domain that the API server lies  */\n    domain: string;\n    /** Port number of the API server */\n    port: number;\n    /** Route on domain application rests */\n    route: string;\n    /** Whether to use the settings domain for auth */\n    use_domain: boolean;\n    /** Whether login is handled locally by the application */\n    local_login: boolean;\n    /** Whether application should mock out API requests */\n    mock: boolean;\n\n    storage?: 'session' | 'local';\n}\n\n/**\n * Initialise the PlaceOS API library\n */\nexport async function setupPlace(settings: PlaceSettings): Promise<void> {\n    const protocol = settings.protocol || location.protocol;\n    const host = settings.domain || location.hostname;\n    const port = settings.port || location.port;\n    const url = settings.use_domain\n        ? `${protocol}//${host}:${port}`\n        : location.origin;\n    const route = (location.pathname + '/').replace('//', '/');\n    const mock =\n        settings.mock ||\n        location.href.includes('mock=true') ||\n        localStorage.getItem('mock') === 'true';\n    // Generate configuration object\n    const config: PlaceAuthOptions = {\n        auth_type: 'auth_code',\n        scope: 'public',\n        host: `${host}${port ? ':' + port : ''}`,\n        auth_uri: `${url}/auth/oauth/authorize`,\n        token_uri: `${url}/auth/oauth/token`,\n        redirect_uri: `${location.origin}${route}oauth-resp.html`,\n        handle_login: !settings.local_login,\n        use_iframe: true,\n        mock,\n    };\n    if (localStorage) {\n        localStorage.setItem(\n            'mock',\n            `${!!mock && !location.href.includes('mock=false')}`\n        );\n    }\n    if (mock) {\n        notifyInfo('Application in mock mode.');\n    }\n    return setup(config);\n}\n","import { Injectable } from '@angular/core';\nimport { getModule } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest, of, Subject } from 'rxjs';\nimport { filter, map, shareReplay, switchMap } from 'rxjs/operators';\n\nimport { BaseClass } from './base.class';\nimport { randomInt } from './general';\n\nexport interface ClientEvent {\n    id: string;\n    type: 'network' | 'console' | 'dom';\n    subtype: string;\n    timestamp: number;\n    data: any;\n}\n\nfunction hookMethod<T, K extends keyof T>(\n    rootObject: T,\n    functionToHook: K,\n    hookingFunction: (...args: any[]) => void\n): T[K] {\n    var previousFunction = rootObject[functionToHook];\n    (rootObject as any)[functionToHook] = (...args: any[]) => {\n        hookingFunction(args);\n        (previousFunction as any).call(rootObject, ...args);\n    };\n    return previousFunction;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class RemoteLoggingService extends BaseClass {\n    private _system_id = new BehaviorSubject<string>('');\n    private _events = new Subject<ClientEvent>();\n\n    private _event_history = this._events.pipe(shareReplay(1000));\n\n    private _logging_bindings = this._system_id.pipe(\n        filter((_) => !!_),\n        switchMap((id) => combineLatest([of(id), this._bindTo(id, 'enabled')])),\n        filter(([_, enabled]) => !!enabled),\n        map(([id]) =>\n            this.subscription(\n                'post_events',\n                this._event_history.subscribe((d) =>\n                    getModule(id, 'Logger').execute('post_event', [d])\n                )\n            )\n        )\n    );\n\n    public readonly history = this._event_history;\n\n    constructor() {\n        super();\n        this._patchConsoleMethods();\n        this._logging_bindings.subscribe();\n    }\n\n    public setSystem(id: string) {\n        this._system_id.next(id);\n    }\n\n    private _patchConsoleMethods() {\n        const types: (keyof Console)[] = [\n            'log',\n            'debug',\n            'info',\n            'warn',\n            'error',\n        ];\n        for (const key of types) {\n            hookMethod(console, key, (args) =>\n                this._handleEvent(key, args)\n            );\n        }\n    }\n\n    private _handleEvent(type: string, data: any, event_type: any = 'console') {\n        data[0] = typeof data[0] === 'string' ? data[0].replace(/%c/g, '') : data[0];\n        this._events.next({\n            id: `${event_type}-${randomInt(99999_99999)}`,\n            type: event_type,\n            subtype: type,\n            timestamp: Date.now(),\n            data: data.filter(_ => typeof _ !== 'string' || !_.startsWith('color:')),\n        });\n    }\n\n    /** List to binding */\n    private _bindTo(id: string, name: string, mod: string = 'Logger') {\n        const module = getModule(id, mod).binding(name);\n        this.subscription(`bind:${name}`, module.bind());\n        return module.listen();\n    }\n}\n","export interface RoomConfiguration {\n    id: string;\n    name?: string;\n    description?: string;\n    capacity?: number;\n}\n\nexport const mergeRoomConfig = (a: RoomConfiguration, b: RoomConfiguration): RoomConfiguration => {\n    const c: RoomConfiguration = { ...a, ...b };\n    return c;\n};\n\nexport const roomConfigBuilder = (\n    buildingConfigs: RoomConfiguration[] = [],\n    roomConfigs: RoomConfiguration[] = []\n): RoomConfiguration[] => {\n    const map = {};\n    buildingConfigs.forEach((f) => (map[f.id] = f));\n    const output: RoomConfiguration[] = [];\n    roomConfigs.forEach((r) => {\n        if (!!map[r.id]) {\n            output.push(mergeRoomConfig(map[r.id], r));\n        }\n    });\n    return output;\n};\n","import { Injectable } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { showMetadata, updateMetadata } from '@placeos/ts-client';\nimport { format, isSameDay } from 'date-fns';\nimport { first } from 'rxjs/operators';\n\nimport { log, getItemWithKeys, setAppName } from './general';\nimport { DEFAULT_SETTINGS } from './settings';\nimport { HashMap } from './types';\nimport { BaseClass } from './base.class';\n\nimport { VERSION } from './version';\nimport { currentUser } from './user-state';\nimport { current_user } from '..';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n        application: HashMap;\n    }\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SettingsService extends BaseClass {\n    /** Name of the application */\n    private _app_name = 'PlaceOS';\n    /** List of override settings in order of priority */\n    private _overrides = new BehaviorSubject<HashMap[]>([]);\n    /** User's personal settings */\n    private _user_settings = new BehaviorSubject<HashMap>({});\n    /** Mapping of behaviour subjects */\n    private _subjects: HashMap<BehaviorSubject<any>> = {};\n    /** Mapping of observables */\n    private _observables: HashMap<Observable<any>> = {};\n    /** Mapping of pending settings */\n    private _pending_settings: HashMap = {};\n\n    /**\n     * @hidden\n     */\n    public set overrides(value: HashMap[]) {\n        this._overrides.next(value);\n        this._applyCssVariables();\n    }\n\n    /** Get observable for key */\n    public listen<T = any>(name: string): Observable<T> {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        return this._observables[name];\n    }\n\n    /** Update observable value for key */\n    public post<T>(name: string, value: T): void {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        this._subjects[name].next(value);\n    }\n\n    public value<T = any>(name: string): T {\n        return !this._observables[name]\n            ? null\n            : this._subjects[name].getValue();\n    }\n\n    /** Page title */\n    public get title() {\n        return this._title.getTitle();\n    }\n    public set title(value: string) {\n        this._title.setTitle(\n            `${value} | ${this.get('app.name') || this._app_name}`\n        );\n    }\n\n    constructor(private _title: Title) {\n        super();\n        const now = new Date();\n        const time = new Date(VERSION.time);\n        const built = isSameDay(now, time)\n            ? `Today at ${format(time, 'h:mma')}`\n            : format(time, 'do MMM yyyy, h:mma');\n        log('CORE', `${VERSION.semver}`, null, 'debug', true);\n        log('APP', `${VERSION.hash} | Built: ${built}`, null, 'debug', true);\n        this.init();\n    }\n\n    /**\n     * Initialise the settings\n     */\n    public async init() {\n        this._setDarkMode();\n        if (this.get('debug')) window.debug = true;\n        if (this.get('app')?.name) {\n            this._app_name = this.get('app').name;\n        }\n        this._app_name =\n            location.pathname.replace(/[\\\\\\/]/g, '').trim() || this._app_name;\n        setAppName(this._app_name.split('-').join('_').toUpperCase());\n        log('Settings', 'Successfully loaded settings');\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.settings = this;\n        }\n        this.subscription(\n            'user_settings',\n            this._user_settings.subscribe((_) => this._applyUserSettings(_))\n        );\n        const user = await current_user.pipe(first((_) => !!_)).toPromise();\n        const data = await showMetadata(user.id, 'settings').toPromise();\n        this._user_settings.next(data.details || {});\n        this._setDarkMode();\n        this._setFontSize();\n    }\n\n    /** Whether settings service has initialised */\n    public get app_name() {\n        return this._app_name;\n    }\n\n    /**\n     * Get a setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public get<T = any>(key: string): T {\n        const keys = key.split('.');\n        if (keys[0] !== 'app') {\n            return (\n                getItemWithKeys(keys, this._pending_settings) ??\n                getItemWithKeys(keys, this._user_settings.getValue()) ??\n                getItemWithKeys(keys, DEFAULT_SETTINGS)\n            );\n        }\n        const override_settings = [...this._overrides.getValue()];\n        for (const override of override_settings) {\n            const value = getItemWithKeys(keys.slice(1), override);\n            if (value != null) {\n                return value;\n            }\n        }\n        return getItemWithKeys(keys, DEFAULT_SETTINGS);\n    }\n\n    public saveUserSetting<T>(name: string, value: T) {\n        this._pending_settings[name] = value;\n        if (name === 'dark_mode') this._setDarkMode();\n        if (name === 'font_size') this._setFontSize();\n        this.timeout('save_settings', () => this._savePendingChanges(), 5000);\n    }\n\n    private _applyCssVariables() {\n        const variable_map = this.get('app.css_variables') || {};\n        let css_string = 'body { ';\n        for (const key in variable_map) {\n            css_string += `--${key}: ${variable_map[key]}; `;\n        }\n        css_string += '}';\n        let element = document.getElementById('css-var-overrides');\n        if (!element) {\n            element = document.createElement('style');\n            element.id = 'css-var-overrides';\n            document.head.appendChild(element);\n        }\n        element.innerText = css_string;\n    }\n\n    private async _savePendingChanges() {\n        const user = currentUser();\n        if (!user?.id || !Object.keys(this._pending_settings).length) return;\n        await updateMetadata(user.id, {\n            name: 'settings',\n            description: '',\n            details: {\n                ...this._user_settings.getValue(),\n                ...this._pending_settings,\n            },\n        }).toPromise();\n        this._user_settings.next({ ...this._user_settings.getValue(), ...this._pending_settings });\n        this._pending_settings = {};\n    }\n\n    private async _applyUserSettings(settings: HashMap) {\n        \n        if (settings.font_size) {\n        }\n    }\n\n    private _setFontSize() {\n        if (this.get('font_size')) {\n            document.body.parentElement.style.fontSize = `${this.get('font_size')}px`;\n            document.body.style.fontSize = `${this.get('font_size')}px`;\n        }\n    }\n\n    private _setDarkMode() {\n        const os_dark = false; // window?.matchMedia ? window?.matchMedia('(prefers-color-scheme: dark)')?.matches : false;\n        if (this.get('dark_mode') ?? os_dark) {\n            document.body.classList.add('dark');\n        } else {\n            document.body.classList.remove('dark');\n        }\n    }\n}\n","/**\n * GENERAL APPLICATION SETTINGS\n */\nconst general: any = {\n    banner: {\n        id: '2',\n        type: 'info',\n        content: ``,\n    },\n    copyright: 'PlaceOS',\n    position: 'right',\n};\n/**\n * HELP/SUPPORT SETTINGS\n */\nconst help: any = {\n    tiles: [\n        {\n            name: 'About PlaceOS',\n            link: 'https://place.technology/resources',\n            icon: {\n                type: 'icon',\n                class: 'material-icons',\n                content: 'dns',\n            },\n            background:\n                'https://static1.squarespace.com/static/52142586e4b0c09536a144ad/5c8ed203a4222fa1927bbab3/5cb7cba66e9a7f63584b4d39/1555549341622/too-many-buttons.jpg?format=2500w',\n        },\n        {\n            name: 'General Enquiries',\n            link: 'mailto:equiries@place.technology?subject=Staff%20App%20Demo',\n            icon: {\n                type: 'icon',\n                class: 'material-icons',\n                content: 'mail',\n            },\n            background: 'assets/img/it-banner.jpg',\n        },\n        {\n            name: 'Contact PlaceOS',\n            link: 'https://place.technology/contact-1',\n            icon: {\n                type: 'icon',\n                class: 'material-icons',\n                content: 'call',\n            },\n            background:\n                'https://images.squarespace-cdn.com/content/v1/52142586e4b0c09536a144ad/1569984759306-M6ZOKD64OG009U68MYUL/ke17ZwdGBToddI8pDm48kCX-V5vw-8h9IBXN10-_8XN7gQa3H78H3Y0txjaiv_0fDoOvxcdMmMKkDsyUqMSsMWxHk725yiiHCCLfrh8O1z4YTzHvnKhyp6Da-NYroOW3ZGjoBKy3azqku80C789l0p4Wyba38KfG317vYluk45_zZdtnDCZTLKcP2mivxmYi50xvY5saIGKMgOza9mH4XA/image-asset.jpeg?format=2500w',\n        },\n        {\n            name: 'About Us',\n            link: 'https://place.technology/',\n            icon: {\n                type: 'icon',\n                class: 'material-icons',\n                content: 'business',\n            },\n            background:\n                'https://images.squarespace-cdn.com/content/v1/52142586e4b0c09536a144ad/1569985184499-QF839PTJ2EV30KIZF59X/ke17ZwdGBToddI8pDm48kLkXF2pIyv_F2eUT9F60jBl7gQa3H78H3Y0txjaiv_0fDoOvxcdMmMKkDsyUqMSsMWxHk725yiiHCCLfrh8O1z4YTzHvnKhyp6Da-NYroOW3ZGjoBKy3azqku80C789l0iyqMbMesKd95J-X4EagrgU9L3Sa3U8cogeb0tjXbfawd0urKshkc5MgdBeJmALQKw/image-asset.jpeg?format=2500w',\n        },\n    ],\n    columns: 2,\n};\n/**\n * BOOKING FLOW SETTINGS\n */\nconst events: any = {\n    multiple_spaces: false,\n    desk_start: 9,\n    breakdown: 15,\n    can_book_for_others: false,\n    has_catering: true,\n};\n/*===========================*\\\n||  SPACE LISTING SETTINGS   ||\n\\*===========================*/\nconst space_display: any = {\n    show_images: false,\n};\n/*===========================*\\\n||  USER DIRECTORY SETTINGS  ||\n\\*===========================*/\nconst directory: any = {\n    show_avatars: true,\n    min_search_length: 3,\n};\n/*===========================*\\\n||    SCHEULDE SETTINGS   ||\n\\*===========================*/\nconst schedule = {\n    legend: [\n        { name: 'Accepted', color: '#21A453' },\n        { name: 'Pending', color: '#ffbf1f' },\n        { name: 'Rejected', color: '#f44336' },\n    ],\n};\n/*===========================*\\\n||    EXPLORE MAP SETTINGS   ||\n\\*===========================*/\nconst explore: any = {\n    colors: {\n        'space-free': '#43a047',\n        'space-pending': '#ffb300',\n        'space-busy': '#e53935',\n        'space-not-bookable': '#ccc',\n        'space-unknown': '#000',\n        // 'desk-available': '#43a047',\n        // 'desk-available-stroke': '#1b5e20',\n        // 'desk-unavailable': '#e53935',\n        // 'desk-unavailable-stroke': '#b71c1c',\n        // 'desk-reserved': '#ffb300',\n        // 'desk-reserved-stroke': '#ff6f00',\n        // 'desk-not-bookable': '#fff',\n        // 'desk-not-bookable-stroke': '#ccc',\n        'zone-low': '#43a047',\n        'zone-medium': '#ffb300',\n        'zone-high': '#e53935',\n    },\n    can_select_building: true,\n    show_legend_group_names: true,\n    legend: {\n        Spaces: [\n            { key: 'space-free', name: 'Space Available' },\n            { key: 'space-pending', name: 'Space Pending' },\n            { key: 'space-busy', name: 'Space in Use' },\n            { key: 'space-not-bookable', name: 'Space not Bookable' },\n            { key: 'space-unknown', name: 'Unknown' },\n        ],\n    },\n};\n/**\n * ROOT APPLICATION SETTINGS\n */\nconst app: any = {\n    name: 'Workplace',\n    title: 'Workplace Application',\n    description: 'PlaceOS Workplace UI written with Angular Framework',\n    short_name: 'STAFF',\n    logo_light: {\n        type: 'img',\n        src: 'assets/logo-light.svg',\n    },\n    logo_dark: {\n        type: 'img',\n        src: 'assets/logo-dark.svg',\n    },\n    features: ['spaces', 'desks', 'explore', 'parking', 'help', 'schedule'],\n    can_deliver: true,\n    general,\n    help,\n    events,\n    space_display,\n    directory,\n    explore,\n    desks: {\n        can_book_for_others: true,\n        allow_groups: true,\n        auto_allocation: false,\n    },\n    analytics: {\n        enabled: true,\n        tracking_id: '',\n    },\n    hide_contacts: false,\n    schedule,\n    departments: {\n        user: { level: 'bld-01_lvl-10', centered_at: 'table-10.008' },\n    },\n};\n\n/**\n * ROOT SETTIGNS\n */\nexport const DEFAULT_SETTINGS: any = {\n    debug: true,\n    composer: {\n        domain: '',\n        route: '/staff',\n        protocol: '',\n        port: '',\n        use_domain: false,\n        local_login: false,\n    },\n    app,\n};\n","import { Type } from '@angular/core';\nimport { Spectator } from '@ngneat/spectator/jest';\n\nexport async function whenChangesStable<T = Type<any>>(spectator: Spectator<T>) {\n    spectator.detectChanges();\n    await spectator.fixture.whenStable()\n    spectator.detectChanges();\n}\n","import { addMilliseconds } from 'date-fns';\nimport { getTimezoneOffset } from 'date-fns-tz';\n\n\nexport const LOCAL_TIMEZONE = Intl?.DateTimeFormat()?.resolvedOptions()?.timeZone || 'Australia/Sydney';\n\nexport function localToTimezone(date: Date | number, tz: string = LOCAL_TIMEZONE) {\n    const offset_diff = getTimezoneOffset(tz) - getTimezoneOffset(LOCAL_TIMEZONE);\n    return addMilliseconds(date, offset_diff).valueOf();\n}\n\nexport function timezoneToLocal(date: Date | number, tz: string = LOCAL_TIMEZONE) {\n    const offset_diff = getTimezoneOffset(LOCAL_TIMEZONE) - getTimezoneOffset(tz);\n    return addMilliseconds(date, offset_diff).valueOf();\n}\n","import { showUser } from '@placeos/ts-client';\nimport { BehaviorSubject } from 'rxjs';\nimport { delay, map, retry } from 'rxjs/operators';\n\nimport { StaffUser } from '../../../users/src/lib/user.class';\n\nconst EMPTY_USER = new StaffUser();\n\nconst _current_user = new BehaviorSubject<StaffUser>(null);\n\nexport const current_user = _current_user.asObservable();\n\ndeclare let jest;\n\nsetTimeout(() => {\n    try {\n        if (jest) return;\n    } catch {}\n    showUser('current')\n        .pipe(\n            delay(1000),\n            retry(10),\n            map((i) => new StaffUser(i))\n        )\n        .subscribe((user) => _current_user.next(user));\n}, 300);\n\n/** Get the current user details */\nexport function currentUser() {\n    return _current_user.getValue() || EMPTY_USER;\n}\n","// IMPORTANT: THIS FILE IS AUTO GENERATED! DO NOT MANUALLY EDIT OR CHECKIN!\n/* tslint:disable */\nexport const VERSION = {\n    \"dirty\": false,\n    \"raw\": \"9e69d26\",\n    \"hash\": \"9e69d26\",\n    \"distance\": null,\n    \"tag\": null,\n    \"semver\": null,\n    \"suffix\": \"9e69d26\",\n    \"semverString\": null,\n    \"version\": \"1.12.0\",\n    \"time\": 1667961704437\n};\n/* tslint:enable */\n","import { Injectable } from '@angular/core';\nimport { getModule } from '@placeos/ts-client';\n\nimport { BaseClass } from './base.class';\nimport { SettingsService } from './settings.service';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class VorlonService extends BaseClass {\n    /** DOM Element containing the Vorlon Script */\n    private _script: HTMLScriptElement;\n\n    constructor(private _settings: SettingsService) {\n        super();\n        this.load();\n    }\n\n    private async load() {\n        const system = this._settings.get('app.vorlon.system');\n        if (system) {\n            const module = getModule(system, 'Vorlon');\n            if (module) {\n                const binding = module.binding('enabled');\n                this.subscription('binding', binding.bind());\n                this.subscription(\n                    'binding_value',\n                    binding.listen().subscribe((state) => {\n                        state\n                            ? this.injectVorlonScript()\n                            : this.removeVorlonScript();\n                    })\n                );\n            }\n        }\n    }\n\n    private injectVorlonScript() {\n        this.removeVorlonScript();\n        this._script = document.createElement('script');\n        const url = this._settings.get('app.vorlon.url');\n        this._script.src = url || `./assets/vorlon.js`;\n        document.head.appendChild(this._script);\n    }\n\n    private removeVorlonScript() {\n        if (this._script) {\n            this._script.parentNode.removeChild(this._script);\n            delete this._script;\n            this._script = null;\n        }\n    }\n}\n","export * from './lib/components.module';\n\nexport * from './lib/action-icon.component';\nexport * from './lib/binding.directive';\nexport * from './lib/confirm-modal.component';\nexport * from './lib/icon.component';\nexport * from './lib/login.component';\nexport * from './lib/popout-menu.component';\nexport * from './lib/unauthorised.component';\nexport * from './lib/user-avatar.component';\nexport * from './lib/interactive-map.component';\nexport * from './lib/map-pin.component';\nexport * from './lib/map-radius.component';\nexport * from './lib/misconfigured.component';\nexport * from './lib/status-overlay.component';\nexport * from './lib/custom-table.component';\nexport * from './lib/custom-tooltip.component';\nexport * from './lib/fixed.pipe';\nexport * from './lib/safe.pipe';\nexport * from './lib/sanitise.pipe';\nexport * from './lib/virtual-keyboard.component';\nexport * from './lib/global-loading.component';\nexport * from './lib/map-locate-modal.component';\nexport * from './lib/image-carousel.component';\nexport * from './lib/redirect.component';\n\nexport * from './lib/authorised-admin.guard';\nexport * from './lib/authorised-user.guard';","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from 'libs/common/src/lib/types';\n\n@Component({\n    selector: 'action-icon',\n    template: `\n        <button\n            mat-icon-button\n            class=\"relative flex items-center justify-center h-8 w-8\"\n            [class.success]=\"state === 'success'\"\n            [disabled]=\"loading || disabled\"\n            title=\"\"\n        >\n            <app-icon root [className]=\"className\" [icon]=\"icon\">\n                {{ content }}\n                <ng-content></ng-content>\n            </app-icon>\n            <div [class]=\"'state center ' + state\" *ngIf=\"!loading && state\">\n                <app-icon>\n                    {{ state === 'success' ? 'done' : 'close' }}\n                </app-icon>\n            </div>\n            <div class=\"loader center\" *ngIf=\"loading\">\n                <mat-spinner [diameter]=\"16\"></mat-spinner>\n            </div>\n        </button>\n    `,\n    styles: [\n        `\n            .action-icon.fade > app-icon {\n                opacity: 0.35;\n            }\n\n            [center] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n\n            .success {\n                pointer-events: none;\n            }\n\n            .success app-icon[root] {\n                opacity: 0.2;\n            }\n\n            .state.success {\n                color: #388e3c;\n            }\n\n            .state.error {\n                color: #e53935;\n            }\n        `,\n    ],\n})\nexport class ActionIconComponent {\n    /** Icon to display */\n    @Input() public icon: ApplicationIcon;\n    /** Icon to display */\n    @Input() public className: string = 'material-icons';\n    /** Icon to display */\n    @Input() public content: string;\n    /** Whether action is being processed */\n    @Input() public loading: boolean;\n    /** Whether action is being processed */\n    @Input() public disabled: boolean;\n    /** State of the action */\n    @Input() public state: 'success' | 'error' | '' = '';\n}\n","import { Injectable } from '@angular/core';\nimport {\n    CanActivate,\n    CanLoad,\n    Route,\n    UrlSegment,\n    ActivatedRouteSnapshot,\n    RouterStateSnapshot,\n    UrlTree,\n    Router,\n} from '@angular/router';\nimport { onlineState } from '@placeos/ts-client';\nimport { current_user } from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class AuthorisedAdminGuard implements CanActivate, CanLoad {\n    constructor(private _router: Router) {}\n\n    public async canActivate(\n        next?: ActivatedRouteSnapshot,\n        state?: RouterStateSnapshot\n    ): Promise<boolean | UrlTree> {\n        return this.checkUser();\n    }\n\n    public async canLoad(\n        route?: Route,\n        segments?: UrlSegment[]\n    ): Promise<boolean> {\n        return this.checkUser();\n    }\n\n    private async checkUser() {\n        await onlineState()\n            .pipe(first((_) => _))\n            .toPromise();\n        const user = await current_user.pipe(first((_) => !!_)).toPromise();\n        const can_activate = user && user.groups.includes('placeos_admin');\n        if (!can_activate) {\n            this._router.navigate(['/unauthorised']);\n        }\n        return can_activate;\n    }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport {\n    CanActivate,\n    CanLoad,\n    Route,\n    UrlSegment,\n    ActivatedRouteSnapshot,\n    RouterStateSnapshot,\n    UrlTree,\n    Router,\n} from '@angular/router';\nimport { onlineState } from '@placeos/ts-client';\nimport { current_user } from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\nimport { StaffUser } from '../../../users/src/lib/user.class';\n\nexport abstract class PLACEOS_APP_ACCESS {\n    public readonly group: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class AuthorisedUserGuard implements CanActivate, CanLoad {\n    constructor(\n        private _router: Router,\n        @Optional() private _access: PLACEOS_APP_ACCESS\n    ) {}\n\n    public async canActivate(\n        next?: ActivatedRouteSnapshot,\n        state?: RouterStateSnapshot\n    ): Promise<boolean | UrlTree> {\n        return this.checkUser();\n    }\n\n    public async canLoad(\n        route?: Route,\n        segments?: UrlSegment[]\n    ): Promise<boolean> {\n        return this.checkUser();\n    }\n\n    private async checkUser() {\n        await onlineState()\n            .pipe(first((_) => _))\n            .toPromise();\n        const user: StaffUser = await current_user\n            .pipe(first((_) => !!_))\n            .toPromise();\n        const can_activate = !!(\n            user &&\n            (!this._access?.group || user.groups.includes(this._access.group))\n        );\n        if (!can_activate) {\n            this._router.navigate(['/unauthorised']);\n        }\n        return !!can_activate;\n    }\n}\n","import {\n    Directive,\n    Input,\n    SimpleChanges,\n    OnInit,\n    OnChanges,\n    OnDestroy,\n    ElementRef,\n    Renderer2,\n    EventEmitter,\n    Output,\n} from '@angular/core';\nimport { onlineState, authority, getModule } from '@placeos/ts-client';\n\nimport { BaseClass } from '@placeos/common';\nimport { filter, first } from 'rxjs/operators';\n\n@Directive({\n    selector: 'i[bind], [binding], co-bind',\n})\nexport class BindingDirective<T = any>\n    extends BaseClass\n    implements OnInit, OnChanges, OnDestroy {\n    /** ID of the system to bind */\n    @Input() public sys: string = '';\n    /** Class name of the module to bind */\n    @Input() public mod: string = '';\n    /** Index of the system to bind */\n    @Input() public index = 1;\n    /** Status variable to bind to */\n    @Input() public bind: string = '';\n    /** Method to execute */\n    @Input() public exec: string = '';\n    /** Event to listen for on the parent */\n    @Input('onEvent') public on_event: string = '';\n    /** ID of the system to bind to */\n    @Input() public params: any[] = [];\n    /** Current value of the binding */\n    @Input() public model: T | null = null;\n    /** Emitter for changes to the value of the binding */\n    @Output() public modelChange = new EventEmitter<T | null>();\n\n    private _binding = false;\n\n    constructor(\n        private _element: ElementRef<HTMLElement>,\n        private _renderer: Renderer2\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        onlineState()\n            ?.pipe(first((_) => _))\n            .subscribe((_) => this.bindVariable());\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.sys || changes.mod || changes.bind) {\n            this.bindVariable();\n        }\n        if (\n            changes.model &&\n            changes.model.previousValue !== this.model &&\n            this.model != null\n        ) {\n            this.execute();\n        }\n        if (changes.on_event && this.on_event) {\n            this.subscription(\n                'on_event',\n                this._renderer.listen(\n                    this._element.nativeElement,\n                    this.on_event,\n                    () => this.execute()\n                )\n            );\n        }\n    }\n\n    /** Bind to set status variable */\n    private bindVariable() {\n        if (\n            authority() &&\n            this.bind &&\n            this.sys &&\n            this.mod &&\n            !this._binding\n        ) {\n            this.timeout(\n                'bind',\n                () => {\n                    const module = getModule(this.sys, this.mod, this.index);\n                    const binding = module.binding(this.bind);\n                    this._binding = true;\n                    this.subscription('binding', binding.bind());\n                    this.subscription(\n                        'on_changes',\n                        binding\n                            .listen()\n                            .pipe(filter((_) => _ != null))\n                            .subscribe((value) => {\n                                setTimeout(() => {\n                                    this._binding = false;\n                                    this.clearTimeout('bound');\n                                    this.model = value;\n                                    this.modelChange.emit(this.model);\n                                }, 10);\n                            })\n                    );\n                    this.timeout('bound', () => (this._binding = false), 200);\n                },\n                20\n            );\n        }\n    }\n\n    /** Excute the set method on the module */\n    private execute() {\n        if (authority() && this.exec && this.sys && this.mod) {\n            const module = getModule(this.sys, this.mod, this.index);\n            if (this.bind) this.params = this.params || [this.model];\n            module.execute(this.exec, this.params).then((result) => {\n                // Emit exec result if not bound to status variable\n                if (!this.bind) {\n                    this.model = result;\n                    this.modelChange.emit(this.model);\n                }\n            });\n        }\n    }\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: T) {\n        this.model = value;\n        this.modelChange.emit(this.model);\n        this.execute();\n    }\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { ClipboardModule } from '@angular/cdk/clipboard';\nimport { MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { PortalModule } from '@angular/cdk/portal';\n\nimport { BindingDirective } from './binding.directive';\nimport { ActionIconComponent } from './action-icon.component';\nimport { IconComponent } from './icon.component';\nimport { PopoutMenuComponent } from './popout-menu.component';\nimport { UserAvatarComponent } from './user-avatar.component';\n\nimport { ConfirmModalComponent } from './confirm-modal.component';\nimport {\n    InteractiveMapComponent,\n    MAP_FEATURE_DATA,\n} from './interactive-map.component';\nimport { MapPinComponent } from './map-pin.component';\nimport { MapRadiusComponent } from './map-radius.component';\nimport { StatusOverlayComponent } from './status-overlay.component';\nimport { FixedPipe } from './fixed.pipe';\nimport { SafePipe } from './safe.pipe';\nimport { SanitizePipe } from './sanitise.pipe';\nimport { CustomTableComponent } from './custom-table.component';\nimport { CustomTooltipComponent } from './custom-tooltip.component';\nimport { VirtualKeyboardComponent } from './virtual-keyboard.component';\nimport { GlobalLoadingComponent } from './global-loading.component';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MapPolygonComponent } from './map-polygon.component';\nimport { GlobalBannerComponent } from './global-banner.component';\nimport { MapLocateModalComponent } from './map-locate-modal.component';\nimport { ImageCarouselComponent } from './image-carousel.component';\nimport { DurationPipe } from './duration.pipe';\nimport { RedirectComponent } from './redirect.component';\nimport { DebugConsoleComponent } from './debug-console.component';\nimport { ScrollingModule } from '@angular/cdk/scrolling';\nimport { JsonDisplayComponent } from './json-display.component';\n\nconst MAT_MODULES: any[] = [\n    MatAutocompleteModule,\n    MatMenuModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatButtonModule,\n    MatAutocompleteModule,\n    MatSelectModule,\n    MatDialogModule,\n    MatDatepickerModule,\n    MatInputModule,\n    ClipboardModule,\n    MatProgressSpinnerModule,\n    MatChipsModule,\n    MatPaginatorModule,\n    CdkTableModule,\n    PortalModule,\n    MatSortModule,\n    ScrollingModule\n];\n\nconst COMPONENTS: Type<any>[] = [\n    ActionIconComponent,\n    IconComponent,\n    PopoutMenuComponent,\n    UserAvatarComponent,\n\n    ConfirmModalComponent,\n    InteractiveMapComponent,\n    MapPinComponent,\n    MapRadiusComponent,\n    MapPolygonComponent,\n    StatusOverlayComponent,\n    CustomTableComponent,\n    CustomTooltipComponent,\n    VirtualKeyboardComponent,\n    GlobalLoadingComponent,\n    GlobalBannerComponent,\n    MapLocateModalComponent,\n    ImageCarouselComponent,\n    RedirectComponent,\n    DebugConsoleComponent,\n    JsonDisplayComponent,\n\n    FixedPipe,\n    SafePipe,\n    SanitizePipe,\n    DurationPipe,\n];\n\nconst DIRECTIVES: Type<any>[] = [BindingDirective];\n\n@NgModule({\n    declarations: [...COMPONENTS, ...DIRECTIVES],\n    imports: [CommonModule, FormsModule, ReactiveFormsModule, ...MAT_MODULES],\n    providers: [\n        { provide: MAT_DATE_LOCALE, useValue: 'en-GB' },\n        { provide: MAP_FEATURE_DATA, useValue: {} },\n    ],\n    exports: [...COMPONENTS, ...DIRECTIVES, ...MAT_MODULES],\n})\nexport class ComponentsModule {}\n","import { Component, Output, EventEmitter, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { ApplicationIcon, DialogEvent } from 'libs/common/src/lib/types';\n\nexport interface ConfirmModalData {\n    /** Title of the modal */\n    title: string;\n    /** Contents of the modal */\n    content: string;\n    /** Text displaed on the confirmation button */\n    confirm_text?: string;\n    /** Text displaed on the confirmation button */\n    cancel_text?: string;\n    /** Icon to display on the modal */\n    icon: ApplicationIcon;\n}\n\nexport const CONFIRM_METADATA = {\n    height: 'auto',\n    width: '24em',\n    maxHeight: 'calc(100vh - 2em)',\n    maxWidth: 'calc(100vw - 2em)',\n};\n\n@Component({\n    selector: 'confirm-modal',\n    template: `\n        <header>\n            <h3 mat-dialog-title>{{ title }}</h3>\n        </header>\n        <main\n            *ngIf=\"!loading; else load_state\"\n            class=\"flex flex-col items-center space-y-2 p-4\"\n        >\n            <app-icon [icon]=\"icon\" class=\"text-5xl\"></app-icon>\n            <p\n                content\n                class=\"text-center text-sm w-[22rem]\"\n                [innerHTML]=\"content\"\n            ></p>\n        </main>\n        <footer\n            class=\"flex items-center justify-center p-2 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button mat-button class=\"inverse w-32\" mat-dialog-close>\n                {{ cancel_text }}\n            </button>\n            <button mat-button name=\"accept\" class=\"w-32\" (click)=\"onConfirm()\">\n                {{ confirm_text }}\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main loading>\n                <div\n                    class=\"w-full h-48 flex flex-col items-center justify-center space-y-2\"\n                >\n                    <mat-spinner diameter=\"32\"></mat-spinner>\n                    <p>{{ loading }}</p>\n                </div>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class ConfirmModalComponent {\n    /** Loading state */\n    public loading: string;\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Title of the confirm modal */\n    public readonly title: string = this._data.title || 'Confirm';\n    /** Body of the confirm modal */\n    public readonly content: string = this._data.content || 'Are you sure?';\n    /** Display text on the confirm button */\n    public readonly confirm_text: string = this._data.confirm_text || 'Accept';\n    /** Display text on the cancel button */\n    public readonly cancel_text: string = this._data.cancel_text || 'Cancel';\n    /** Display icon properties */\n    public readonly icon: ApplicationIcon = this._data.icon || {\n        class: 'material-icons',\n        content: 'done',\n    };\n    /** Prevent user from closing the modal */\n    public readonly disableClose = () => (this._dialog_ref.disableClose = true);\n    /** Allow the user to close the modal */\n    public readonly enableClose = () => (this._dialog_ref.disableClose = false);\n\n    constructor(\n        private _dialog_ref: MatDialogRef<ConfirmModalComponent>,\n        @Inject(MAT_DIALOG_DATA) private _data: ConfirmModalData\n    ) {}\n\n    /** User confirmation of the content of the modal */\n    public onConfirm() {\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import {\n    AfterViewInit,\n    Component,\n    EventEmitter,\n    Input,\n    OnChanges,\n    Output,\n    SimpleChanges,\n    TemplateRef,\n    ViewChild,\n} from '@angular/core';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatSort } from '@angular/material/sort';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { BaseClass } from '@placeos/common';\nimport { Observable } from 'rxjs';\n\n@Component({\n    selector: 'custom-table',\n    template: `\n        <cdk-table [dataSource]=\"data_source\" matSort>\n            <ng-container *ngFor=\"let column of columns; let i = index\">\n                <ng-container [cdkColumnDef]=\"column\">\n                    <div\n                        cdk-header-cell\n                        class=\"capitalize p-2\"\n                        [style.width]=\"(column_size[i] || '8') + 'em'\"\n                        [style.flex]=\"column_size[i] === 'flex' ? '1' : ''\"\n                        *cdkHeaderCellDef\n                        mat-sort-header\n                    >\n                        {{ display_column[i] || column }}\n                    </div>\n                    <div\n                        cdk-cell\n                        class=\"p-2 truncate flex items-center\"\n                        [style.width]=\"(column_size[i] || '8') + 'em'\"\n                        [style.flex]=\"column_size[i] === 'flex' ? '1' : ''\"\n                        *cdkCellDef=\"let row\"\n                        [title]=\"row[column]\"\n                    >\n                        <ng-container\n                            *ngIf=\"!template[column]; else cell_outlet\"\n                            >{{ row[column] }}</ng-container\n                        >\n                        <ng-template #cell_outlet>\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    template[column];\n                                    context: {\n                                        data: row[column],\n                                        row: row,\n                                        key: column\n                                    }\n                                \"\n                            ></ng-container>\n                        </ng-template>\n                    </div>\n                </ng-container>\n            </ng-container>\n\n            <cdk-header-row\n                class=\"sticky flex items-center bg-white dark:bg-neutral-700 top-0 z-10 border-b border-gray-300 dark:border-neutral-400\"\n                *cdkHeaderRowDef=\"columns\"\n            ></cdk-header-row>\n            <cdk-row\n                row\n                class=\"flex z-0 relative hover:bg-black/5 dark:hover:bg-white/5 border-b border-gray-200 dark:border-neutral-500\"\n                (click)=\"row_clicked.emit(row)\"\n                *cdkRowDef=\"let row; columns: columns\"\n            ></cdk-row>\n            <ng-template cdkNoDataRow>\n                <p class=\"w-full p-4 text-center opacity-30\">\n                    {{ empty || 'No data to display' }}\n                </p>\n            </ng-template>\n        </cdk-table>\n        <div footer [hidden]=\"!pagination\">\n            <mat-paginator\n                [pageSize]=\"page_size\"\n                [hidePageSize]=\"true\"\n                [showFirstLastButtons]=\"true\"\n            >\n            </mat-paginator>\n        </div>\n    `,\n    styles: [\n        `\n            cdk-header-row {\n                font-weight: 500;\n                text-transform: capitalize;\n                min-height: 3rem;\n            }\n        `,\n    ],\n})\nexport class CustomTableComponent<T extends {} = any>\n    extends BaseClass\n    implements AfterViewInit, OnChanges {\n    /** Data source to render in the table */\n    @Input() public dataSource: T[] | Observable<T[]>;\n    /** Whether table should use pagination */\n    @Input() public pagination = false;\n    /** Number of items to display on pagination pages */\n    @Input() public page_size = 7;\n    /** Filter string to apply to table listings */\n    @Input() public filter: string;\n    /** Values to display for column headers */\n    @Input() public display_column: string[];\n    /** List of columns to display in the table */\n    @Input() public columns: string[];\n    /** Size of the columns in em or flex for a flexible size */\n    @Input() public column_size: string[] = [];\n    /** Displayed value when the table is empty */\n    @Input() public empty: string;\n    /** Displayed value when the table is empty */\n    @Input() public template: Record<string, TemplateRef<any>> = {};\n\n    @Output() public row_clicked = new EventEmitter<T>();\n\n    public readonly data_source: MatTableDataSource<T> = new MatTableDataSource(\n        []\n    );\n\n    @ViewChild(MatPaginator) private _paginator: MatPaginator;\n    @ViewChild(MatSort) private _sort: MatSort;\n\n    public ngAfterViewInit() {\n        this.data_source.sort = this._sort;\n        this.data_source.paginator = this.pagination ? this._paginator : null;\n        this.data_source.filterPredicate = (i: any, s) => {\n            for (const key in i) {\n                if (\n                    typeof i[key] === 'string' &&\n                    i[key].toLowerCase().includes(s.toLowerCase())\n                ) {\n                    return true;\n                } else if (i[key] === s) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.dataSource && this.dataSource) {\n            if (this.dataSource instanceof Observable) {\n                this.subscription(\n                    'data',\n                    this.dataSource.subscribe(\n                        (data) => (this.data_source.data = data)\n                    )\n                );\n            } else {\n                this.data_source.data = this.dataSource;\n            }\n        }\n        if (changes.pagination) {\n            this.data_source.paginator = this.pagination\n                ? this._paginator\n                : null;\n        }\n        if (changes.filter) {\n            this.data_source.filter = (this.filter || '').trim().toLowerCase();\n        }\n        if (changes.columns && this.columns) {\n            this.display_column = this.columns.map(\n                (_, idx) => (this.display_column || [])[idx] || _.split('_').join(' ')\n            );\n        }\n        if (!this.column_size) {\n            this.column_size = [];\n        }\n    }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Injectable,\n    Injector,\n    Input,\n    OnChanges,\n    OnDestroy,\n    SimpleChanges,\n    TemplateRef,\n    Type,\n    ViewChild,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\n@Injectable()\nexport class CustomTooltipData<T = any> {\n    data: T;\n    close: () => void;\n    constructor(d) {\n        this.data = d.data;\n        this.close = d.close || (() => null);\n    }\n}\n\n@Component({\n    selector: '[customTooltip]',\n    template: `\n        <ng-content></ng-content>\n\n        <ng-template cdk-portal>\n            <div custom-tooltip class=\"relative\" [ngSwitch]=\"type\">\n                <ng-container *ngSwitchCase=\"'component'\">\n                    <ng-container\n                        *ngComponentOutlet=\"content; injector: injector\"\n                    ></ng-container>\n                </ng-container>\n                <ng-container *ngSwitchCase=\"'html'\">\n                    <div [innerHTML]=\"content | sanitize\"></div>\n                </ng-container>\n                <ng-container *ngSwitchDefault>\n                    <ng-container\n                        *ngTemplateOutlet=\"content; context: data\"\n                    ></ng-container>\n                </ng-container>\n            </div>\n        </ng-template>\n    `,\n})\nexport class CustomTooltipComponent<T = any>\n    extends BaseClass\n    implements OnChanges, OnDestroy {\n    /** Horizontal position of the rendered overlay */\n    @Input('xPosition') public x_pos: 'start' | 'center' | 'end';\n    /** Vertical position of the rendered overlay */\n    @Input('yPosition') public y_pos: 'top' | 'center' | 'bottom';\n    /** Content to render in the tooltip */\n    @Input() public content: TemplateRef<any> | Type<any> | string;\n    /** Data associated with the tooltip content */\n    @Input() public data: T;\n    /** Whether tooltip has a backdrop */\n    @Input() public backdrop = true;\n    /** Whether tooltip has a backdrop */\n    @Input() public hover = false;\n    /** Type of content to render */\n    public type: 'template' | 'component' | 'html' = 'template';\n\n    public injector: Injector;\n\n    private _overlay_ref: OverlayRef = null;\n\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n\n    @HostListener('click') public readonly onClick = () => this.open();\n    @HostListener('touchend') public readonly onTouch = () => this.open();\n    @HostListener('mouseenter') public readonly onEnter = () =>\n        this.hover ? this.open() : '';\n    @HostListener('mouseleave') public readonly onLeave = () =>\n        this.hover ? this.close() : '';\n\n    constructor(\n        private _element: ElementRef<HTMLElement>,\n        private _overlay: Overlay,\n        private _injector: Injector\n    ) {\n        super();\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        this._updateInjector();\n        if (\n            this._overlay_ref &&\n            (changes.x_pos || changes.y_pos || changes.content)\n        ) {\n            this.open();\n        }\n    }\n\n    public ngOnDestroy() {\n        super.ngOnDestroy();\n        this.close();\n    }\n\n    public open() {\n        if (!this.content) return;\n        this.timeout('open', () => {\n            this._updateType();\n            if (this._overlay_ref) this.close();\n            if (!this._portal) return;\n            const pos = this._element.nativeElement.getBoundingClientRect();\n            const default_x = pos.x > document.body.clientWidth / 2 ? 'start' : 'end';\n            const default_y = pos.y > document.body.clientHeight / 2 ? 'top' : 'bottom';\n            this._overlay_ref = this._overlay.create({\n                hasBackdrop: !!this.backdrop,\n                positionStrategy: this._overlay\n                    .position()\n                    .flexibleConnectedTo(this._element)\n                    .withPositions([\n                        {\n                            originX: this.x_pos || default_x,\n                            originY:\n                                (this.y_pos === 'top'\n                                    ? 'bottom'\n                                    : this.y_pos == 'bottom'\n                                    ? 'top'\n                                    : this.y_pos) || default_y,\n                            overlayX: this.x_pos || default_x,\n                            overlayY: this.y_pos || default_y,\n                        },\n                    ]),\n            });\n            this._overlay_ref.attach(this._portal);\n            if (this.backdrop) {\n                this.subscription(\n                    'backdrop',\n                    this._overlay_ref.backdropClick().subscribe(() => this.close())\n                );\n            }\n        }, 50);\n    }\n\n    public close() {\n        this.clearTimeout('open');\n        if (this._overlay_ref) {\n            this._overlay_ref.dispose();\n            this._overlay_ref = null;\n        }\n    }\n\n    private _updateType() {\n        this.type =\n            typeof this.content === 'string'\n                ? 'html'\n                : this.content instanceof TemplateRef\n                ? 'template'\n                : 'component';\n    }\n\n    private _updateInjector() {\n        this.injector = Injector.create({\n            providers: [\n                {\n                    provide: CustomTooltipData,\n                    useValue: { data: this.data, close: () => this.close() },\n                },\n            ],\n            parent: this._injector,\n        });\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { HotkeysService } from 'libs/common/src/lib/hotkeys.service';\nimport { BaseClass } from 'libs/common/src/lib/base.class';\nimport {\n    ClientEvent,\n    RemoteLoggingService,\n} from 'libs/common/src/lib/remote-logging.service';\nimport { JsonDisplayComponent } from './json-display.component';\n\nconst COLOR_MAP = {\n    console: 'bg-purple-600/30',\n    network: 'bg-green-600/30',\n    dom: 'bg-indigo-600/30',\n\n    log: `bg-cyan-600/50`,\n    info: `bg-blue-600/50`,\n    warn: `bg-orange-600/50`,\n    debug: `bg-gray-600/50`,\n    error: `bg-red-600/50`,\n};\n\nconst URL_STARTS = [\n    'tel:',\n    'mailto:',\n    'http:',\n    'https:',\n    'ftp:',\n    'ws:',\n    'wss:',\n];\n\n@Component({\n    selector: `debug-console`,\n    template: `\n        <div\n            class=\"absolute bottom-2 inset-x-2 bg-black/80 text-white shadow rounded overflow-hidden h-[32rem] max-h-65vh flex flex-col z-[998]\"\n            *ngIf=\"show\"\n        >\n            <cdk-virtual-scroll-viewport\n                itemSize=\"32\"\n                class=\"flex-1 h-[30rem] max-h-full w-full\"\n            >\n                <div\n                    class=\"font-mono h-8 truncate p-2 text-sm flex items-center max-w-full hover:bg-white/10 space-x-1\"\n                    *cdkVirtualFor=\"\n                        let log of filtered_logs | async;\n                        trackBy: trackByFn\n                    \"\n                >\n                    <div\n                        class=\"uppercase text-xs p-1 bg-white/10 rounded font-mono\"\n                    >\n                        {{ log.timestamp | date: 'MMM d HH:mm:ss' }}\n                    </div>\n                    <div\n                        [class]=\"\n                            'uppercase text-xs p-1 ' +\n                            colors[log.type] +\n                            ' rounded font-mono'\n                        \"\n                    >\n                        {{ log.type }}\n                    </div>\n                    <div\n                        [class]=\"\n                            'capitalize text-xs p-1 ' +\n                            colors[log.subtype] +\n                            ' rounded font-mono w-16 text-center'\n                        \"\n                    >\n                        {{ log.subtype }}\n                    </div>\n                    <div\n                        class=\"font-mono\"\n                        *ngFor=\"let obj of log.data\"\n                        [attr.data-type]=\"type(obj)\"\n                    >\n                        <ng-container [ngSwitch]=\"type(obj)\">\n                            <ng-container *ngSwitchCase=\"'link'\">\n                                <a\n                                    class=\"font-mono\"\n                                    [href]=\"obj | sanitize\"\n                                    target=\"_blank\"\n                                    rel=\"noopener noreferer\"\n                                    >{{ obj }}</a\n                                >\n                            </ng-container>\n                            <ng-container *ngSwitchCase=\"'object'\">\n                                [<span\n                                    class=\"underline font-mono hover:text-blue-500\"\n                                    customTooltip\n                                    xPosition=\"center\"\n                                    yPosition=\"bottom\"\n                                    [content]=\"json_tooltip\"\n                                    [data]=\"obj\"\n                                    [hover]=\"true\"\n                                    [backdrop]=\"false\"\n                                    >Object</span\n                                >]\n                            </ng-container>\n                            <ng-container *ngSwitchDefault>{{\n                                obj\n                            }}</ng-container>\n                        </ng-container>\n                    </div>\n                </div>\n            </cdk-virtual-scroll-viewport>\n            <div\n                class=\"absolute bottom-0 right-2 rounded-t-lg bg-black/90 p-2 flex items-center space-x-2 w-[20rem]\"\n            >\n                <input\n                    #search_input\n                    name=\"log-filter\"\n                    [ngModel]=\"filter | async\"\n                    (ngModelChange)=\"filter.next($event)\"\n                    placeholder=\"Filter logs...\"\n                    class=\"border-none bg-white/10 flex-1 text-sm px-2 py-1 font-mono rounded\"\n                />\n                <div class=\"font-mono text-xs px-2 text-center\">\n                    <span class=\"font-mono\" *ngIf=\"(filter | async)?.length\">\n                        {{ (filtered_logs | async)?.length || '0' }} of\n                    </span>\n                    {{ (logs | async)?.length }}\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class DebugConsoleComponent extends BaseClass {\n    @Input() public show = false;\n    public readonly colors = COLOR_MAP;\n    public readonly json_tooltip = JsonDisplayComponent;\n    public readonly filter = new BehaviorSubject<string>('');\n    public readonly logs = new BehaviorSubject<ClientEvent[]>([]);\n    public readonly filtered_logs = combineLatest([\n        this.filter,\n        this.logs,\n    ]).pipe(\n        map(([s, logs]) =>\n            logs.filter(\n                (_) =>\n                    _.type.toLowerCase().includes(s.toLowerCase()) ||\n                    _.subtype.toLowerCase().includes(s.toLowerCase()) ||\n                    `${_.data}`.toLowerCase().includes(s.toLowerCase())\n            )\n        )\n    );\n\n    constructor(\n        private _logs: RemoteLoggingService,\n        private _hotkey: HotkeysService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'logs',\n            this._logs.history.subscribe((event) =>\n                this.logs.next([...this.logs.getValue(), event])\n            )\n        );\n        this.subscription(\n            'toggle',\n            this._hotkey.listen(\n                ['Control', 'Backquote'],\n                () => (this.show = !this.show)\n            )\n        );\n    }\n\n    public type(item: any) {\n        if (\n            typeof item === 'string' &&\n            URL_STARTS.find((start) => item.startsWith(start))\n        ) {\n            return 'link';\n        } else if (item instanceof Object) {\n            return 'object';\n        }\n        return 'string';\n    }\n\n    public trackByFn(_: number, item: ClientEvent) {\n        return item?.timestamp;\n    }\n}\n","import { Pipe } from \"@angular/core\";\nimport { formatDuration } from \"date-fns\";\n\n@Pipe({\n    name: 'duration'\n})\nexport class DurationPipe {\n\n    /**\n     * Format the duration value\n     * @param length Duration to format in minutes\n     * @param shorten Whether to shorten the period names e.g. `hours` as `h`\n     */\n    public transform(length: number, shorten: boolean = false): string {\n        let duration = formatDuration({ hours: Math.floor(length / 60), minutes: length % 60 });\n        if (shorten) {\n            duration = duration.replace('hour', 'h').replace('minute', 'm').replace(/s/gi, '');\n        }\n        return duration;\n    }\n}","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n    name: 'toFixed',\n})\nexport class FixedPipe implements PipeTransform {\n\n    /**\n     * Fixed a number to x decimal places\n     * @param value number to convert\n     * @param places Number of decimal places to convert\n     */\n    public transform(value: number, places: number = 2): string {\n        return value.toFixed(places);\n    }\n}\n","import { Component } from '@angular/core';\nimport { SettingsService } from '@placeos/common';\n\nexport interface BannerDetails {\n    id: string;\n    type?: 'info' | 'warn' | 'error';\n    content: string;\n}\n\n@Component({\n    selector: 'global-banner',\n    template: `\n        <div\n            class=\"flex items-center w-full text-white p-4 space-x-4\"\n            [class.bg-blue-600]=\"banner.type === 'info' || !banner.type\"\n            [class.bg-pending]=\"banner.type === 'warn'\"\n            [class.bg-error]=\"banner.type === 'error'\"\n            *ngIf=\"!has_viewed\"\n        >\n            <div class=\"flex-1\">{{ banner?.content }}</div>\n            <button mat-icon-button (click)=\"close()\">\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class GlobalBannerComponent {\n    public get has_viewed() {\n        return (\n            !this.banner?.content ||\n            localStorage.getItem('PLACE.last_banner') === this.banner.id\n        );\n    }\n\n    public get banner(): BannerDetails {\n        return this._settings.get('app.general.banner');\n    }\n\n    constructor(private _settings: SettingsService) {}\n\n    public close() {\n        localStorage.setItem('PLACE.last_banner', this.banner?.id || '');\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { first } from 'rxjs/operators';\nimport { isOnline, token } from '@placeos/ts-client';\nimport { BaseClass, SettingsService } from '@placeos/common';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\n\n@Component({\n    selector: 'global-loading',\n    template: `\n        <div\n            *ngIf=\"!online\"\n            class=\"fixed bottom-2 left-1/2 -translate-x-1/2 shadow rounded-3xl px-4 py-2 bg-error text-white text-xs\"\n        >\n            Unable to reach server... Some features may not work.\n        </div>\n        <div\n            *ngIf=\"loading\"\n            loader\n            class=\"fixed inset-0 flex items-center justify-center pointer-events-auto bg-white dark:bg-neutral-600\"\n        >\n            <mat-spinner [diameter]=\"64\"></mat-spinner>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                pointer-events: none;\n            }\n\n            :host > [loader] {\n                z-index: 997;\n                background-image: url(\"data:image/svg+xml,%3Csvg width='36' height='36' viewBox='0 0 36 36' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M36 0H0v36h36V0zM15.126 2H2v13.126c.367.094.714.24 1.032.428L15.554 3.032c-.188-.318-.334-.665-.428-1.032zM18 4.874V18H4.874c-.094-.367-.24-.714-.428-1.032L16.968 4.446c.318.188.665.334 1.032.428zM22.874 2h11.712L20 16.586V4.874c1.406-.362 2.512-1.468 2.874-2.874zm10.252 18H20v13.126c.367.094.714.24 1.032.428l12.522-12.522c-.188-.318-.334-.665-.428-1.032zM36 22.874V36H22.874c-.094-.367-.24-.714-.428-1.032l12.522-12.522c.318.188.665.334 1.032.428zm0-7.748V3.414L21.414 18h11.712c.362-1.406 1.468-2.512 2.874-2.874zm-18 18V21.414L3.414 36h11.712c.362-1.406 1.468-2.512 2.874-2.874zM4.874 20h11.712L2 34.586V22.874c1.406-.362 2.512-1.468 2.874-2.874z' fill='%23000000' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E\");\n            }\n        `,\n    ],\n})\nexport class GlobalLoadingComponent extends BaseClass implements OnInit {\n    public loading: boolean;\n\n    public get online() {\n        return isOnline();\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this.loading = true;\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        this.interval('has_token', () => {\n            if (token()) {\n                this.loading = false;\n                this.clearInterval('has_token');\n            }\n        }, 1000);\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from 'libs/common/src/lib/types';\n\n@Component({\n    selector: 'app-icon,icon',\n    template: `\n        <div class=\"flex items-center justify-center h-[1.25em] w-[1.25em]\">\n            <i\n                *ngIf=\"!icon || icon.type !== 'img'\"\n                [class]=\"icon?.class || className\"\n            >\n                {{ icon?.content }}\n                <ng-content></ng-content>\n            </i>\n            <img\n                class=\"h-[1em] w-[1em]\"\n                *ngIf=\"icon && icon.type === 'img'\"\n                [src]=\"icon.src | safe: 'resource'\"\n            />\n        </div>\n    `,\n    styles: [\n        `\n            i {\n                font-size: 1em;\n            }\n        `,\n    ],\n})\nexport class IconComponent {\n    @Input() public className: string = 'material-icons';\n    /** Icon details */\n    @Input() public icon: ApplicationIcon;\n}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n    selector: 'image-carousel',\n    template: `\n        <div class=\"h-full w-full relative overflow-hidden flex\">\n            <div\n                image\n                class=\"h-full min-w-full relative flex items-center justify-center overflow-hidden\"\n                *ngFor=\"let image of images\"\n                [style.transform]=\"'translateX(-' + offset * 100 + '%)'\"\n            >\n                <img\n                    class=\"h-full object-contain\"\n                    *ngIf=\"image\"\n                    [src]=\"image.url || image\"\n                />\n            </div>\n            <div\n                class=\"h-full w-full relative flex flex-col items-center justify-center opacity-30 space-y-2\"\n                *ngIf=\"!images?.length\"\n            >\n                <app-icon class=\"text-5xl\">image_not_supported</app-icon>\n                <p>No images</p>\n            </div>\n            <button\n                matRipple\n                *ngIf=\"images?.length\"\n                class=\"opacity-0 hover:opacity-30 flex items-center justify-center absolute left-0 inset-y-0 w-1/3 bg-black/60 text-white\"\n                [disabled]=\"offset === 0\"\n                (click)=\"offset = offset - 1\"\n            >\n                <app-icon class=\"text-4xl\">chevron_left</app-icon>\n            </button>\n            <button\n                matRipple\n                *ngIf=\"images?.length\"\n                class=\"opacity-0 hover:opacity-30 flex items-center justify-center absolute right-0 inset-y-0 w-1/3 bg-black/60 text-white\"\n                [disabled]=\"offset >= images?.length - 1\"\n                (click)=\"offset = offset + 1\"\n            >\n                <app-icon class=\"text-4xl\">chevron_right</app-icon>\n            </button>\n            <div\n                class=\"absolute bottom-1 left-1/2 -translate-x-1/2 text-sm opacity-30 space-x-2\"\n                *ngIf=\"images?.length\"\n            >\n                <button\n                    matRipple\n                    [class.!bg-white]=\"offset === i\"\n                    *ngFor=\"let img of images; let i = index\"\n                    class=\"h-4 w-4 rounded-full bg-gray-400 shadow\"\n                ></button>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                height: 100%;\n                width: 100%;\n            }\n\n            [image] {\n                transition: transform 300ms;\n            }\n        `,\n    ],\n})\nexport class ImageCarouselComponent {\n    @Input() public images: string[] = [];\n\n    public offset = 0;\n}\n","import {\n    AfterViewInit,\n    Component,\n    ElementRef,\n    HostListener,\n    InjectionToken,\n    Injector,\n    Input,\n    OnChanges,\n    OnDestroy,\n    OnInit,\n    QueryList,\n    SimpleChanges,\n    TemplateRef,\n    Type,\n    ViewChild,\n    ViewChildren,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nimport {\n    applyGlobalStyles,\n    createViewer,\n    getViewer,\n    Point,\n    Viewer,\n    removeViewer,\n    updateViewer,\n    ViewAction,\n    ViewerFeature,\n    ViewerLabel,\n    ViewerStyles,\n    listenToViewerChanges,\n} from '@placeos/svg-viewer';\nimport { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport const MAP_FEATURE_DATA = new InjectionToken<any>(\n    'Data for Map Features'\n);\n\n@Component({\n    selector: `i-map,interactive-map`,\n    template: `\n        <div #outlet tabindex=\"0\" role=\"map\" class=\"absolute inset-0\"></div>\n        <ng-container *ngIf=\"src; else empty_state\">\n        <mat-spinner\n            *ngIf=\"!viewer || loading\"\n            class=\"absolute\"\n            [diameter]=\"48\"\n        ></mat-spinner>\n        </ng-container>\n        <div hidden *ngIf=\"injectors?.length\">\n            <ng-container\n                *ngFor=\"\n                    let element of features;\n                    let i = index;\n                    trackBy: trackByFn\n                \"\n            >\n                <div *ngIf=\"element\">\n                    <div\n                        #feature\n                        class=\"pointer-events-none\"\n                        [attr.no-scale]=\"element.no_scale\"\n                        [attr.el-id]=\"element.location\"\n                        [attr.track-id]=\"element.track_id\"\n                        [attr.view-id]=\"viewer\"\n                        [ngSwitch]=\"type(element.content)\"\n                    >\n                        <ng-container *ngSwitchCase=\"'component'\">\n                            <ng-container\n                                *ngComponentOutlet=\"\n                                    element.content;\n                                    injector: injectors[i]\n                                \"\n                            ></ng-container>\n                        </ng-container>\n                        <ng-container *ngSwitchCase=\"'html'\">\n                            <div [innerHTML]=\"element.content | sanitize\"></div>\n                        </ng-container>\n                        <ng-container *ngSwitchDefault>\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    element.content;\n                                    context: element.data\n                                \"\n                            ></ng-container>\n                        </ng-container>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"absolute inset-0 flex items-center justify-center\">\n                <div class=\"opacity-30\">No map</div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n\n            mat-spinner {\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n        `,\n    ],\n})\nexport class InteractiveMapComponent\n    extends BaseClass\n    implements AfterViewInit, OnChanges, OnInit, OnDestroy\n{\n    /** URL to the SVG file */\n    @Input() public src: string;\n    /** Custom CSS styles to apply to the SVG file */\n    @Input() public styles: ViewerStyles;\n    /** Zoom level to apply to the SVG */\n    @Input() public zoom = 1;\n    /** Zoom level to apply to the SVG */\n    @Input() public center: Point = { x: 0.5, y: 0.5 };\n    /** List of features to renderer over the SVG */\n    @Input() public features: ViewerFeature[];\n    /** List of labels to renderer over the SVG */\n    @Input() public labels: ViewerLabel[];\n    /** List of available user actions for the SVG */\n    @Input() public actions: ViewAction[];\n\n    @Input() public options: any;\n\n    @Input() public focus: string;\n\n    public loading: boolean;\n\n    public injectors: Injector[] = [];\n\n    public feature_list: ViewerFeature[] = [];\n\n    /** ID of the active SVG Viewer */\n    public viewer: string;\n    /** Observable for changes on the SVG viewer */\n    private _on_changes: BehaviorSubject<Viewer> = new BehaviorSubject(null);\n\n    private _extra_data = {\n        ratio$: this._on_changes.pipe(map((_) => _.ratio)),\n        svg_ratio$: this._on_changes.pipe(map((_) => _.svg_ratio)),\n        zoom$: this._on_changes.pipe(map((_) => _.zoom)),\n        position: this._on_changes.pipe(map((_) => _.center)),\n    };\n\n    @ViewChild('outlet') private _outlet_el: ElementRef<HTMLDivElement>;\n    @ViewChildren('feature') private _feature_list: QueryList<\n        ElementRef<HTMLDivElement>\n    >;\n\n    @HostListener('window:resize') public onResize() {\n        this.zoom = 1;\n        this.center = { x: 0.5, y: 0.5 };\n        this.updateDisplay();\n    }\n\n    public type(\n        content: string | TemplateRef<any> | Type<any>\n    ): 'html' | 'template' | 'component' {\n        return typeof content === 'string'\n            ? 'html'\n            : content instanceof TemplateRef\n            ? 'template'\n            : 'component';\n    }\n\n    constructor(private _injector: Injector) {\n        super();\n    }\n\n    public ngOnInit() {\n        applyGlobalStyles();\n    }\n\n    public ngOnDestroy(): void {\n        if (this.viewer) {\n            removeViewer(this.viewer);\n        }\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.src && this.src) {\n            this.createView();\n        }\n        if (changes.features) {\n            this.updateInjectors();\n        }\n        if (this.viewer) {\n            if (changes.focus && this.focus) {\n                this.focusOn(this.focus);\n            } else if (changes.zoom || changes.center) {\n                this.updateDisplay();\n            }\n            if (\n                changes.styles ||\n                changes.features ||\n                changes.labels ||\n                changes.actions\n            ) {\n                this.timeout('update_view', () => this.updateView());\n            }\n        }\n    }\n\n    public ngAfterViewInit() {\n        this.createView();\n    }\n\n    /** Update overlays, styles and actions of viewer */\n    private updateView() {\n        try {\n            if (!getViewer(this.viewer) || this.loading) {\n                return this.timeout('update_view', () => this.updateView());\n            }\n            this.updateFeatureList();\n            updateViewer(this.viewer, {\n                styles: this.styles,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n                options: this.options,\n            });\n        } catch (e) {}\n    }\n\n    /** Update zoom and center position of viewer */\n    private updateDisplay() {\n        try {\n            updateViewer(this.viewer, {\n                zoom: this.zoom,\n                desired_zoom: this.zoom,\n                center: this.center,\n                desired_center: this.center,\n                options: this.options,\n            });\n        } catch (e) {}\n    }\n\n    private async createView() {\n        if (this.src && this._outlet_el?.nativeElement && !this.loading) {\n            this.loading = true;\n            if (this.viewer) {\n                updateViewer(this.viewer, {\n                    styles: this.styles,\n                    features: [],\n                    labels: this.labels,\n                    actions: this.actions,\n                    options: this.options,\n                });\n                removeViewer(this.viewer);\n            }\n            this.updateFeatureList();\n            this.viewer = await createViewer({\n                element: this._outlet_el?.nativeElement,\n                url: this.src,\n                styles: this.styles,\n                zoom: this.zoom,\n                desired_zoom: this.zoom,\n                center: this.center,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n                options: this.options,\n            });\n            this.loading = false;\n            this.subscription(\n                'view_changes',\n                listenToViewerChanges(this.viewer)?.subscribe((v) => {\n                    const box =\n                        this._outlet_el.nativeElement.getBoundingClientRect();\n                    this._on_changes.next({ ...v } as any);\n                })\n            );\n            if (this.focus) this.focusOn(this.focus);\n        } else if (\n            (this.src && !this._outlet_el?.nativeElement) ||\n            this.loading\n        ) {\n            this.timeout('create_view', () => this.createView());\n        }\n    }\n\n    private focusOn(id: string) {\n        if (!id || !this.viewer) return;\n        const viewer: Viewer = getViewer(this.viewer);\n        if (!viewer) return;\n        const rect = viewer.mappings[id];\n        if (!rect) return;\n        this.center = {\n            x: 1 - (rect.x + rect.w / 2),\n            y: 1 - (rect.y + rect.h / 4),\n        };\n        this.updateDisplay();\n    }\n\n    /* istanbul ignore next */\n    public trackByFn(index: number, feature: ViewerFeature) {\n        return feature?.track_id || JSON.stringify({ ...feature });\n    }\n\n    private updateFeatureList() {\n        this.feature_list = (this.features || [])\n            .map((f, idx) => ({\n                ...f,\n                content: this._feature_list.toArray()[idx]?.nativeElement,\n            }))\n            .filter((f) => f.content);\n    }\n\n    private updateInjectors() {\n        const old_injectors = this.injectors || [];\n        this.injectors = (this.features || []).map(\n            (f: any) =>\n                old_injectors.find(\n                    (_) => _.get(MAP_FEATURE_DATA)?.track_id && _.get(MAP_FEATURE_DATA)?.track_id === f.track_id\n                ) ||\n                Injector.create({\n                    providers: [\n                        {\n                            provide: MAP_FEATURE_DATA,\n                            useValue: {\n                                track_id: f.track_id,\n                                ...f.data,\n                                ...this._extra_data,\n                            },\n                        },\n                    ],\n                    parent: this._injector,\n                })\n        );\n    }\n}\n","import { Component, Input, Optional, SimpleChanges } from \"@angular/core\";\nimport { CustomTooltipData } from \"./custom-tooltip.component\";\n\n@Component({\n    selector: 'json-display',\n    template: `\n        <div class=\"bg-white dark:bg-neutral-600 shadow rounded overflow-auto max-w-[80vw] max-h-[80vh] p-2\">\n            <pre class=\"font-mono text-sm bg-black/10 p-2\">{{ formatted_json }}</pre>\n        </div>\n    `\n})\nexport class JsonDisplayComponent {\n    @Input() public json: Object;\n\n    public formatted_json: string;\n\n    constructor(@Optional() _data: CustomTooltipData) {\n        this.json = _data?.data || '';\n        this._updateFormatting();\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.json) {\n            this._updateFormatting();\n        }\n    }\n\n    private _updateFormatting() {\n        this.formatted_json = JSON.stringify(this.json, undefined, 4);\n    }\n}\n","import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport {\n    ApplicationIcon,\n    SettingsService,\n} from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\n@Component({\n    selector: 'app-login',\n    template: `\n        <div class=\"fixed inset-0 overflow-auto\">\n            <form\n                class=\"flex flex-col items-center overflow-hidden mx-auto my-4 bg-white rounded shadow p-4\"\n            >\n                <div\n                    class=\"flex items-center justify-center\"\n                    [style.background-color]=\"logo?.background\"\n                >\n                    <i *ngIf=\"logo?.type === 'icon'\" [class]=\"logo.class\">\n                        {{ logo.content }}\n                    </i>\n                    <img\n                        *ngIf=\"logo?.type === 'img'\"\n                        [src]=\"logo.src | safe: 'resource'\"\n                    />\n                </div>\n                <div class=\"w-full relative h-1/3 flex-1\">\n                    <ng-container *ngIf=\"!loading; else loading_state\">\n                        <div class=\"flex flex-col\">\n                            <label\n                                for=\"username\"\n                                [class.focused]=\"\n                                    username || focus === 'username'\n                                \"\n                                [class.in-focus]=\"focus === 'username'\"\n                            >\n                                Username\n                            </label>\n                            <mat-form-field appearance=\"outline\">\n                                <input\n                                    #username\n                                    formControlName=\"username\"\n                                    (keyup.enter)=\"toPassword()\"\n                                />\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex flex-col\">\n                            <label for=\"password\">Password</label>\n                            <mat-form-field appearance=\"outline\">\n                                <input\n                                    #pass_field\n                                    formControlName=\"password\"\n                                    (keyup.enter)=\"login()\"\n                                />\n                                <mat-error>Invalid username or password</mat-error>\n                            </mat-form-field>\n                        </div>\n                    </ng-container>\n                </div>\n                <div class=\"flex items-center justify-center w-full\" *ngIf=\"!loading\">\n                    <button mat-button color=\"primary\" (click)=\"login()\">\n                        Login\n                    </button>\n                </div>\n            </form>\n        </div>\n        <ng-template #loading_state>\n            <div\n                class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner diameter=\"64\"></mat-spinner>\n                <p>Checking user credentials...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                background-color: #f0f0f0;\n                background-image: url(\"data:image/svg+xml,%3Csvg width='64' height='64' viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 16c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zm33.414-6l5.95-5.95L45.95.636 40 6.586 34.05.636 32.636 2.05 38.586 8l-5.95 5.95 1.414 1.414L40 9.414l5.95 5.95 1.414-1.414L41.414 8zM40 48c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zM9.414 40l5.95-5.95-1.414-1.414L8 38.586l-5.95-5.95L.636 34.05 6.586 40l-5.95 5.95 1.414 1.414L8 41.414l5.95 5.95 1.414-1.414L9.414 40z' fill='%23ad1457' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E\");\n            }\n\n            form {\n                width: 20rem;\n                max-width: calc(100vw - 2rem);\n            }\n\n            img {\n                max-height: 3.75rem;\n                max-width: 15rem;\n            }\n        `,\n    ],\n})\nexport class LoginComponent implements OnInit {\n    /** Whether the user credentials are being checked */\n    public loading: boolean;\n\n    public readonly form = new FormGroup({\n        username: new FormControl('', [Validators.required]),\n        password: new FormControl('', [Validators.required]),\n    });\n\n    /** Password field element */\n    @ViewChild('pass_field', { static: true })\n    private pwd_field: ElementRef<HTMLInputElement>;\n\n    /** Logo of the application organisation */\n    public get logo(): ApplicationIcon {\n        return this._settings.get('app.logo_dark') || { type: 'icon' };\n    }\n\n    constructor(private _settings: SettingsService) {}\n\n    public async ngOnInit() {\n        this.loading = true;\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        this.loading = false;\n    }\n\n    /** Focus on the password field */\n    public toPassword() {\n        if (this.pwd_field && this.pwd_field.nativeElement) {\n            this.pwd_field.nativeElement.focus();\n        }\n    }\n\n    /** Perform user login */\n    public login() {\n        this.loading = true;\n        // this._users.login({\n        //     username: this.username,\n        //     password: this.password\n        // }, { form: true }).then(() => {\n        //     this.loading = false;\n        // }, () => {\n        //     this.loading = false;\n        //     this.error = true;\n        // });\n        this.form.setErrors({ password: 'Invalid username or password' });\n    }\n}\n","import { Component, OnInit, Output, EventEmitter, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { ViewerFeature, ViewerStyles } from '@placeos/svg-viewer';\n\nimport { BaseClass } from '@placeos/common';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { BuildingLevel } from 'libs/organisation/src/lib/level.class';\nimport { MapPinComponent } from './map-pin.component';\n\nexport interface Locatable {\n    id: string;\n    name: string;\n    map_id: string;\n    level: BuildingLevel;\n    zones?: string[];\n}\n\n@Component({\n    selector: 'map-locate-modal',\n    template: `\n        <header class=\"h-12 px-2\">\n            <app-icon>place</app-icon>\n            <h1 class=\"ml-2\">{{ item.name }}</h1>\n        </header>\n        <div\n            body\n            class=\"relative overflow-hidden pointer-events-none\"\n            *ngIf=\"level\"\n        >\n            <i-map\n                [src]=\"level.map_id\"\n                [styles]=\"style_map\"\n                [features]=\"features\"\n            >\n                <mat-spinner diameter=\"64\"></mat-spinner>\n            </i-map>\n            <div\n                class=\"absolute top-2 right-2 py-2 px-4 bg-white rounded-3xl shadow\"\n            >\n                {{ level?.name }}\n            </div>\n        </div>\n        <footer\n            class=\"w-full border-t border-gray-200 flex items-center justify-center p-2\"\n        >\n            <button mat-button class=\"inverse w-32\" mat-dialog-close>\n                Close\n            </button>\n        </footer>\n    `,\n    styles: [\n        `\n            [body] {\n                min-width: 80vw !important;\n                width: 80vw;\n                height: 65vh;\n            }\n        `,\n    ],\n})\nexport class MapLocateModalComponent extends BaseClass implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter();\n    /** Space to show the location of on the map */\n    public item: Locatable = this._data.item;\n    /** Features of the map */\n    public features: ViewerFeature[];\n    /** Mapping of elements to CSS styles */\n    public style_map: ViewerStyles = {};\n\n    public get level(): BuildingLevel {\n        return this.item.level || this._org.levelWithID(this.item.zones || []);\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: { item: Locatable },\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.timeout('init', () => {\n            this.processFeature();\n            this.processStyles();\n        }, 1000);\n    }\n\n    public processStyles(): void {\n        const styles: ViewerStyles = {};\n        if (this.item?.map_id) {\n            styles[`#zones`] = { display: 'none' };\n            styles[`#Zones`] = { display: 'none' };\n        }\n        this.style_map = styles;\n    }\n\n    /** Point on map to focus on */\n    public processFeature(): void {\n        if (!this.item) return null;\n        const focus = {\n            location: this.item.map_id,\n            track_id: `focus_item`,\n            content: MapPinComponent,\n            data: {\n                name: this.item.name,\n            },\n            z_index: 99,\n            zoom: 100,\n        };\n        this.features = [focus];\n    }\n}\n","import { Component, Inject, OnInit } from '@angular/core';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapPinData {\n    message: string;\n    fill: string;\n    stroke: string;\n    action?: () => void;\n}\n\n@Component({\n    selector: '[map-pin]',\n    template: `\n        <div\n            name=\"message\"\n            *ngIf=\"message && show_message\"\n            class=\"p-2 m-2 rounded bg-white text-gray-700 shadow\"\n        >\n            {{ message }}\n        </div>\n        <svg\n            *ngIf=\"show\"\n            name=\"pin\"\n            viewBox=\"0 0 380 560\"\n            [class.action]=\"action\"\n            (click)=\"action()\"\n        >\n            <g>\n                <path\n                    [style.fill]=\"fill\"\n                    [style.stroke]=\"stroke\"\n                    stroke-width=\"25\"\n                    d=\"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n            C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n            c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z\"\n                />\n            </g>\n        </svg>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                bottom: 0;\n                left: 50%;\n                width: 24rem;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                transform: translateX(-50%);\n                z-index: -1;\n            }\n\n            div {\n                animation: fade-in-top 1s;\n            }\n\n            .action {\n                pointer-events: auto;\n            }\n\n            svg {\n                width: 2rem;\n                animation: fade-in-top 1s;\n            }\n\n            @keyframes fade-in-top {\n                0% {\n                    opacity: 0;\n                    transform: translateY(-100%);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translateY(0%);\n                }\n            }\n        `,\n    ],\n})\nexport class MapPinComponent implements OnInit {\n    /** Message to display above the pin */\n    public readonly message = this._details.message;\n    /** Fill colour for the pin SVG */\n    public readonly fill = this._details.fill || '#e53935';\n    /** Stroke colour for the pin SVG */\n    public readonly stroke = this._details.stroke || '#fff';\n    /** Action to perform when clicking pin */\n    public readonly action = this._details.action || null;\n\n    public show: boolean;\n    public show_message: boolean;\n\n    constructor(@Inject(MAP_FEATURE_DATA) private _details: MapPinData) {}\n\n    public ngOnInit() {\n        setTimeout(() => (this.show = true), 300);\n        setTimeout(() => (this.show_message = true), 1000);\n    }\n}\n","import { ChangeDetectorRef, Component, Inject, OnInit } from '@angular/core';\nimport { BaseClass } from '@placeos/common';\nimport { Observable } from 'rxjs';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapPolygonData {\n    /** Name of the region */\n    name: string;\n    /** Color to display region in on overlay */\n    color: string;\n    /** Array of points that define the shape of the region */\n    points: [number, number][];\n    /**  */\n    ratio?: number;\n    svg_ratio?: number;\n    zoom_value?: number;\n    ratio$?: Observable<number>;\n    svg_ratio$?: Observable<number>;\n    zoom$?: Observable<number>;\n    data$?: Observable<MapPolygonData>;\n}\n\n@Component({\n    selector: '[map-polygon]',\n    template: `\n        <div\n            polygon\n            class=\"absolute w-full h-full transform -translate-x-1/2 -translate-y-1/2 -top-1 -left-1\"\n            [style.transform]=\"'scale(' + scale * zoom + ')'\"\n        >\n            <div\n                class=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2\"\n                [style.width]=\"width + '%'\"\n                [style.height]=\"height + '%'\"\n            >\n                <svg\n                    [attr.viewBox]=\"\n                        '0 0 ' +\n                        (this.width / 20 || 1) +\n                        ' ' +\n                        (this.height / 20 || 1)\n                    \"\n                    preserveAspectRatio=\"none\"\n                    class=\"relative w-full h-full\"\n                >\n                    <polygon\n                        [attr.points]=\"points\"\n                        [style.fill]=\"fill\"\n                        [style.stroke]=\"stroke\"\n                    />\n                    <!-- <circle\n                        *ngFor=\"let point of point_list\"\n                        [attr.cx]=\"point[0] || 0\"\n                        [attr.cy]=\"point[1] || 0\"\n                        [attr.r]=\"4\"\n                        [style.stroke]=\"'#000'\"\n                        [style.fill]=\"'#fffd'\"\n                    /> -->\n                </svg>\n            </div>\n        </div>\n        <div\n            text\n            class=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-shadow text-white text-xl text-center whitespace-pre-line\"\n        >\n            {{ name }}\n        </div>\n    `,\n    styles: [\n        `\n            [polygon] {\n                will-change: transform;\n            }\n\n            polygon {\n                stroke-width: 2;\n            }\n            circle {\n                stroke-width: 2;\n            }\n\n            [text] {\n                width: 32rem;\n                max-width: 65vw;\n            }\n        `,\n    ],\n})\nexport class MapPolygonComponent extends BaseClass implements OnInit {\n    /** Message to display above the pin */\n    public name = this._details.name;\n    /** Fill colour for the pin SVG */\n    public fill = `${this._details.color || '#e53935'}88`;\n    /** Stroke colour for the pin SVG */\n    public stroke = this._details.color || '#e53935';\n    public padding = 32;\n    public width = 1;\n    public height = 1;\n    public readonly svg_scale = 20;\n\n    public get scale() {\n        return this._details.svg_ratio || 1;\n    }\n\n    public get zoom() {\n        return this._details.zoom_value || 1;\n    }\n\n    /** List of points for drawing the polygon */\n    public points = `0,0 0,${this.height} ${this.width},${this.height} ${this.width},0`;\n\n    public point_list: [number, number][] = [];\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: MapPolygonData,\n        private _cdr: ChangeDetectorRef\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        if (this._details.data$) {\n            this.subscription(\n                'data',\n                this._details.data$.subscribe((_) => {\n                    this.name = _.name;\n                    this.fill = `${_.color || '#e53935'}88`;\n                    this.stroke = _.color || '#e53935';\n                    this.processPoints(_.points);\n                })\n            );\n        }\n        this.subscription(\n            'ratio',\n            this._details.ratio$?.subscribe((_) => {\n                this._details.ratio = _;\n                this.processPoints(this._details.points);\n            })\n        );\n        this.subscription(\n            'zoom',\n            this._details.zoom$?.subscribe(\n                (_) => (this._details.zoom_value = _)\n            )\n        );\n        this.subscription(\n            'svg_ratio',\n            this._details.svg_ratio$?.subscribe(\n                (_) => (this._details.svg_ratio = _)\n            )\n        );\n        this.processPoints(this._details.points);\n    }\n\n    public processPoints(points: [number, number][]) {\n        const diff: Record<string, number> = points.reduce(\n            (m, [x, y]) => ({\n                x_min: x < m.x_min ? x : m.x_min,\n                x_max: x > m.x_max ? x : m.x_max,\n                y_min: y < m.y_min ? y : m.y_min,\n                y_max: y > m.y_max ? y : m.y_max,\n            }),\n            {\n                x_min: 100,\n                x_max: -100,\n                y_min: 100,\n                y_max: -100,\n            }\n        );\n        const range = {\n            x: diff.x_max - diff.x_min,\n            y: diff.y_max - diff.y_min,\n        };\n        const { ratio } = this._details;\n        this.width = range.x * 100;\n        this.height = range.y * 100 * (ratio || 1);\n        this.width = Math.floor(this.width * 100);\n        this.height = Math.floor(this.height * 100);\n        this.points = points\n            .reduce(\n                (s, [x, y]) =>\n                    `${s}${s ? ' ' : ''}${\n                        (((x - diff.x_min) / range.x) * this.width) / 20\n                    },${(((y - diff.y_min) / range.y) * this.height) / 20}`,\n                ''\n            )\n            .replace(/NaN/g, '0');\n        this.point_list = points.map(([x, y]) => [\n            (((x - diff.x_min) / range.x) * this.width) / 20,\n            (((y - diff.y_min) / range.y) * this.height) / 20,\n        ]);\n        this._cdr.detectChanges();\n    }\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\nimport { formatDistanceToNow } from 'date-fns';\nimport { Observable } from 'rxjs';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapRadiusData {\n    message: string;\n    radius: number;\n    fill: string;\n    stroke: string;\n    last_seen?: number;\n    zoom$: Observable<number>;\n}\n\n@Component({\n    selector: '[map-radius]',\n    template: `\n        <ng-container *ngIf=\"show && radius\" (window:resize)=\"updateRadius()\">\n            <div\n                radius\n                class=\"center border-4 rounded-full border-dashed\"\n                [style.border-color]=\"stroke\"\n                [style.background-color]=\"fill + '40'\"\n                [style.width]=\"radius * zoom + 'px'\"\n                [style.height]=\"radius * zoom + 'px'\"\n            ></div>\n            <div\n                *ngIf=\"message && show_message\"\n                message\n                [style.top]=\"'-' + (radius / 2) * zoom + 'px'\"\n                class=\"p-2 m-2 rounded bg-white text-gray-700 shadow absolute top-0 whitespace-no-wrap flex flex-col w-64\"\n            >\n                {{ message }}\n                <span *ngIf=\"last_seen\" class=\"text-xs\">\n                    Last updated: {{ last_seen_at }}\n                </span>\n            </div>\n        </ng-container>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                height: 100%;\n                width: 100%;\n            }\n\n            [message] {\n                transform: translate(-50%, -120%);\n                animation: fade-in-top 1s;\n            }\n\n            @keyframes fade-in-top {\n                0% {\n                    opacity: 0;\n                    transform: translate(-50%, -220%);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translate(-50%, -120%);\n                }\n            }\n        `,\n    ],\n})\nexport class MapRadiusComponent implements OnInit {\n    public zoom = 1;\n    /** Size of the area marked by this component */\n    public radius = this._details.radius || 10;\n    /** Message to display above the pin */\n    public readonly message = this._details.message;\n    /** Fill colour for the pin SVG */\n    public readonly fill = this._details.fill || '#e53935';\n    /** Stroke colour for the pin SVG */\n    public readonly stroke = this._details.stroke || '#e53935';\n\n    public readonly last_seen: number = this._details.last_seen || 0;\n\n    public get last_seen_at() {\n        return formatDistanceToNow(this.last_seen * 1000) + ' ago';\n    }\n\n    public show: boolean;\n    public show_message: boolean;\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: MapRadiusData,\n        private _el: ElementRef<HTMLElement>\n    ) {\n        this._details.zoom$?.subscribe((v) =>\n            Math.max(0.5, (this.zoom = v || 1))\n        );\n    }\n\n    public ngOnInit() {\n        setTimeout(() => (this.show = true), 300);\n        setTimeout(() => (this.show_message = true), 1000);\n    }\n\n    public ngAfterViewInit() {\n        this.updateRadius();\n    }\n\n    public updateRadius() {\n        const box = this._el.nativeElement.getBoundingClientRect();\n        if (!box.width) return setTimeout(() => this.updateRadius(), 300);\n        this.radius = Math.max(\n            64,\n            (this._details.radius || 10) * (box.width || 10)\n        );\n    }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'app-misconfigured',\n    template: `\n        <div\n            content\n            class=\"rounded m-4 text-center bg-white text-black border border-gray-400 p-4 shadow\"\n        >\n            <h3 class=\"text-2xl\" i18n=\"@@forbiddenLabel\">\n                Application Misconfigured.\n            </h3>\n            <p class=\"py-4\" i18n=\"@@invalidPermissionLabel\">\n                This application requires a zone of type org, building and level\n                to operate.\n            </p>\n            <p i18n=\"@@contactAdminLabel\">\n                If this issue persists please contact your administrator.\n            </p>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            [content] {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                [content] {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }\n        `,\n    ],\n})\nexport class MisconfiguredComponent {}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { ApplicationIcon, BaseClass } from '@placeos/common';\n\nexport interface PopoutAction extends ApplicationIcon {\n    /** ID of the action */\n    id: string;\n}\n\n@Component({\n    selector: 'a-popout-menu',\n    template: `\n        <button\n            mat-icon-button\n            class=\"small absolute text-base center shadow\"\n            *ngFor=\"let item of actions; let i = index\"\n            [style.top]=\"show ? -110 * i - 60 + '%' : ''\"\n            (click)=\"action.emit(item.id); show = false\"\n        >\n            <app-icon [icon]=\"item\"></app-icon>\n        </button>\n        <button\n            name=\"root\"\n            mat-icon-button\n            [class.show]=\"show\"\n            (click)=\"show = !show\"\n            (window:click)=\"show ? close() : ''\"\n        >\n            <app-icon>{{ show ? 'add' : 'more_vert' }}</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n\n            app-icon {\n                transition: transform 200ms;\n            }\n\n            button {\n                background-color: #fff;\n                color: rgba(#000, 0.85);\n                font-size: 1.25rem;\n                height: 2.5em;\n                width: 2.5em;\n            }\n\n            button.show app-icon {\n                transform: rotate(45deg);\n            }\n\n            button.small {\n                transition: top 200ms, left 200ms;\n            }\n        `,\n    ],\n})\nexport class PopoutMenuComponent extends BaseClass {\n    /** List of available actions */\n    @Input() public actions: PopoutAction[] = [];\n    /** Emitter for user actions */\n    @Output() public action = new EventEmitter<string>();\n    /** Whether actions should show */\n    public show: boolean;\n\n    public close() {\n        this.timeout('close', () => (this.show = false));\n    }\n}\n","import { Component, OnInit } from \"@angular/core\";\nimport { Router } from \"@angular/router\";\nimport { first } from \"rxjs/operators\";\n\nimport { SettingsService } from \"@placeos/common\";\nimport { OrganisationService } from \"libs/organisation/src/lib/organisation.service\";\n\n@Component({\n    selector: 'page-redirect',\n    template: ``,\n    styles: [``]\n})\nexport class RedirectComponent implements OnInit {\n    constructor(private _settings: SettingsService, private _org: OrganisationService, private _router: Router) {}\n\n    public async ngOnInit() {\n        await this._settings.initialised.pipe(first(_ => _)).toPromise();\n        await this._org.initialised.pipe(first(_ => _)).toPromise();\n        if (!this._settings.get('app.default_route')) return;\n        this._router.navigate(this._settings.get('app.default_route').split('/'));\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\n@Pipe({\n    name: 'safe'\n})\nexport class SafePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    /**\n     * Sanitizes the string allowing it to be injected into a template\n     * @param value String to sanitize\n     * @param type Type of value to sanitise. `resource`, `url`, `script`, `style` or `html`\n     */\n    public transform(\n        value: string,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n            case 'url':\n                return this.sanitizer.bypassSecurityTrustUrl(value);\n            case 'script':\n                return this.sanitizer.bypassSecurityTrustScript(value);\n            case 'style':\n                return this.sanitizer.bypassSecurityTrustStyle(value);\n            default:\n                return this.sanitizer.bypassSecurityTrustHtml(value);\n        }\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\nenum SecurityContext {\n    NONE = 0,\n    HTML = 1,\n    STYLE = 2,\n    SCRIPT = 3,\n    URL = 4,\n    RESOURCE_URL = 5\n}\n\n@Pipe({\n    name: 'sanitize'\n})\nexport class SanitizePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    transform(\n        value: any,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.sanitize(SecurityContext.RESOURCE_URL, value);\n            case 'url':\n                return this.sanitizer.sanitize(SecurityContext.URL, value);\n            case 'script':\n                return this.sanitizer.sanitize(SecurityContext.SCRIPT, value);\n            case 'style':\n                return this.sanitizer.sanitize(SecurityContext.STYLE, value);\n            default:\n                return this.sanitizer.sanitize(SecurityContext.HTML, value);\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationLink } from '@placeos/common';\n\n@Component({\n    selector: 'status-overlay',\n    template: `\n        <div\n            status-overlay\n            class=\"fixed inset-0 flex flex-col bg-secondary items-center justify-center z-50 text-white\"\n        >\n            <ng-container *ngIf=\"!loading; else load_state\">\n                <div\n                    class=\"text-4xl rounded-full bg-white mb-4\"\n                    [class.text-success]=\"!error\"\n                    [class.text-error]=\"error\"\n                >\n                    <app-icon>{{ error ? 'close' : 'done' }}</app-icon>\n                </div>\n                <div class=\"text-center text-lg mb-4\">\n                    <ng-container *ngIf=\"!error; else error_msg\">\n                        <ng-content></ng-content>\n                    </ng-container>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <a\n                        button\n                        mat-button\n                        class=\"w-32\"\n                        *ngFor=\"let link of links\"\n                        [routerLink]=\"[link.route]\"\n                    >\n                        {{ link.name }}\n                    </a>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #error_msg\n            ><p error>{{ error }}</p></ng-template\n        >\n        <ng-template #load_state>\n            <mat-spinner [diameter]=\"32\" class=\"mb-4\"></mat-spinner>\n            <p loading class=\"text-center text-lg\">{{ loading }}</p>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class StatusOverlayComponent {\n    /** Whether overlay is loading */\n    @Input() public loading: string = '';\n    /** Details about any errors that have occurred */\n    @Input() public error: string = '';\n    /** Links to display on success */\n    @Input() public links: ApplicationLink[] = [];\n}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'app-unauthorised',\n    template: `\n        <div\n            class=\"unauthorised rounded m-4 text-center bg-white text-black border border-gray-400 p-4 shadow\"\n        >\n            <h1 class=\"text-4xl\">403</h1>\n            <h3 class=\"text-2xl\" i18n=\"@@forbiddenLabel\">Access forbidden.</h3>\n            <p class=\"py-4\" i18n=\"@@invalidPermissionLabel\">\n                You do not have permission to view this page and your access\n                attempt has been recorded.\n            </p>\n            <p i18n=\"@@contactAdminLabel\">\n                Contact your Administrator if you feel that you should have\n                access.\n            </p>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .unauthorised {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                .unauthorised {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }\n        `,\n    ],\n})\nexport class UnauthorisedComponent {}\n","import { Component, Input } from '@angular/core';\nimport { User } from 'libs/users/src/lib/user.class';\n\n@Component({\n    selector: 'a-user-avatar',\n    template: `\n        <div\n            class=\"flex items-center justify-center rounded-full overflow-hidden border-2 border-white\"\n            *ngIf=\"user\"\n            [attr.user-id]=\"user.id\"\n        >\n            <div\n                initials\n                class=\"text-white text-opacity-80 uppercase\"\n                *ngIf=\"!user.photo; else image_state\"\n            >\n                {{ initials }}\n            </div>\n        </div>\n        <ng-template #image_state>\n            <img class=\"h-full w-full\" [src]=\"user.photo | safe: 'resource'\" />\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                height: 2.5em;\n                width: 2.5em;\n                background-color: var(--secondary);\n                overflow: hidden;\n                border: 2px solid white;\n            }\n\n            .initials {\n                font-size: 1em;\n            }\n        `,\n    ],\n})\nexport class UserAvatarComponent {\n    /** User to display avatar for */\n    @Input() public user: User;\n\n    public get initials(): string {\n        if (!this.user) return 'NA';\n        const name = this.user.name || '';\n        const parts = name.replace(/[()[\\]\\-+=\\\\/]+/gi, '').split(' ');\n        return parts.length > 1\n            ? `${parts[0][0]}${parts[parts.length - 1][0]}`\n            : name.slice(0, 2);\n    }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Input,\n    OnDestroy,\n    ViewChild,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nconst DEFAULT_KEYS = [\n    '0123456789'.split(''),\n    'qwertyuiop'.split(''),\n    'asdfghjkl'.split(''),\n    'zxcvbnm'.split(''),\n    ['{caps}', '{space}', '{backspace}'],\n];\n\n@Component({\n    selector: 'input[keyboard],textarea[keyboard]',\n    template: `\n        <ng-content></ng-content>\n        <ng-template cdk-portal>\n            <div\n                keyboard-view\n                class=\"w-screen flex flex-col space-y-4 bg-gray-200 p-2 border-t border-gray-400\"\n            >\n                <div\n                    row\n                    class=\"flex items-center justify-center space-x-2\"\n                    *ngFor=\"let row of keyset\"\n                >\n                    <ng-container *ngFor=\"let key of row\">\n                        <div\n                            [attr.key]=\"key\"\n                            tabindex=\"0\"\n                            class=\"rounded-xl p-2 border border-gray-300 relative cursor-pointer bg-white\"\n                            [class.special]=\"key[0] === '{' && key.length > 1\"\n                            [class.space]=\"key === '{space}'\"\n                            (focus)=\"focusInput()\"\n                            (click)=\"handleKeyPress(key)\"\n                        >\n                            {{\n                                key === '{space}'\n                                    ? 'Space'\n                                    : key === '{caps}'\n                                    ? 'Caps Lock'\n                                    : key === '{backspace}'\n                                    ? 'Backspace'\n                                    : key\n                            }}\n                            <div\n                                *ngIf=\"key === '{caps}'\"\n                                dot\n                                class=\"absolute top-2 right-2 h-2 w-2 rounded-full bg-gray-300\"\n                                [class.bg-success]=\"state === 'shift'\"\n                            ></div>\n                        </div>\n                    </ng-container>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            [key] {\n                height: 3.5rem;\n                width: 4rem;\n                transition: box-shadow 200ms, top 200ms;\n                box-shadow: 0 4px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key].special {\n                width: 10rem;\n            }\n\n            [key].space {\n                flex: 1;\n                min-width: 10rem;\n                max-width: 25rem;\n            }\n\n            [key]:hover {\n                top: 2px;\n                box-shadow: 0 2px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key]:active {\n                top: 4px;\n                box-shadow: 0 0 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n        `,\n    ],\n})\nexport class VirtualKeyboardComponent extends BaseClass implements OnDestroy {\n    /** Whether virtual keyboard should activate */\n    public static enabled: boolean;\n    /** List of rows of keys to display on the keyboard */\n    @Input() public keyset = DEFAULT_KEYS;\n    /** Current state of the displayed keyset */\n    public state: 'normal' | 'caps' | 'shift' = 'normal';\n    /** References to the overlay containing the keyboard */\n    private _overlay_ref: OverlayRef = null;\n    /** Portal with the keyboard contents */\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n\n    @HostListener('focus') public onFocus = () => {\n        if (!VirtualKeyboardComponent.enabled) return;\n        this.open();\n        this.clearTimeout('blur');\n    };\n    @HostListener('blur') public onBlur = () =>\n        this.timeout('blur', () => this.close());\n\n    constructor(\n        private _element: ElementRef<HTMLInputElement | HTMLTextAreaElement>,\n        private _overlay: Overlay\n    ) {\n        super();\n    }\n\n    public ngOnDestroy() {\n        super.ngOnDestroy();\n        this.close();\n    }\n\n    public focusInput() {\n        this._element?.nativeElement?.blur();\n        this._element?.nativeElement?.focus();\n    }\n\n    public open() {\n        if (this._overlay_ref) return;\n        if (!this._portal) return;\n        this._overlay_ref = this._overlay.create({\n            positionStrategy: this._overlay\n                .position()\n                .global()\n                .bottom()\n                .centerHorizontally(),\n        });\n        this._overlay_ref.attach(this._portal);\n    }\n\n    public close() {\n        if (this._overlay_ref) {\n            this._overlay_ref.dispose();\n            this._overlay_ref = null;\n        }\n    }\n\n    public handleKeyPress(key: string) {\n        let cursor_pos = this._element.nativeElement.selectionStart;\n        const str = this._element.nativeElement.value || '';\n        switch (key.toLowerCase()) {\n            case '{caps}':\n            case '{shift}':\n                this.state = 'shift';\n                break;\n            case '{backspace}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos - 1\n                )}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos = Math.max(0, cursor_pos - 1);\n                break;\n            case '{space}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${' '}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n                break;\n            default:\n                if (this.state === 'shift') this.state = 'normal';\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${key}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n        }\n        this._element.nativeElement.dispatchEvent(new InputEvent('input'));\n        this.updateKeyState();\n        this.timeout(\n            'focus',\n            () => {\n                this.focusInput();\n                this._element.nativeElement.selectionStart = cursor_pos;\n                this._element.nativeElement.selectionEnd = cursor_pos;\n            },\n            50\n        );\n    }\n\n    public updateKeyState() {\n        this.keyset = this.keyset.map((_) =>\n            _.map((k) =>\n                k.length > 1\n                    ? k\n                    : k[\n                          this.state !== 'normal'\n                              ? 'toUpperCase'\n                              : 'toLowerCase'\n                      ]()\n            )\n        );\n    }\n}\n","export * from './lib/events';\nexport * from './lib/events.module';\nexport * from './lib/event-details-modal.component';\nexport * from './lib/event-card.component';","import { Component, EventEmitter, Input, Output } from '@angular/core';\n\n@Component({\n    selector: 'attendee-list',\n    template: `\n        <div\n            class=\"w-full h-full overflow-hidden flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <div\n                class=\"flex items-center border-b border-gray-200 dark:border-neutral-500 p-2\"\n            >\n                <button close mat-icon-button (click)=\"close.emit()\">\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <div class=\"flex-1 text-center pr-12 font-medium\">\n                    {{ list.length }} Attendee(s)\n                </div>\n            </div>\n            <div class=\"flex-1 w-full overflow-auto\">\n                <div\n                    attendee\n                    class=\"flex items-center p-2 space-x-2\"\n                    *ngFor=\"let user of list\"\n                >\n                    <a-user-avatar [user]=\"user\"></a-user-avatar>\n                    <div class=\"\">\n                        <div>{{ user.name }}</div>\n                        <div class=\"opacity-60\">\n                            <span *ngIf=\"host === user.email\">Host</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class AttendeeListComponent {\n    @Input() public host: string = '';\n    @Input() public list: any[] = [];\n    @Output() public close = new EventEmitter();\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { addMinutes, format, formatDuration, isSameDay } from 'date-fns';\nimport { BaseClass } from '@placeos/common';\n\nimport { CalendarEvent } from './event.class';\nimport { EventDetailsModalComponent } from './event-details-modal.component'\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\n\n@Component({\n    selector: 'event-card',\n    template: `\n        <h4 class=\"mb-2 flex items-center\" *ngIf=\"event\" date>\n            <span *ngIf=\"show_day\" day>{{ day }}, </span>\n            {{ event?.date | date: 'h:mm a' }}\n            <span class=\"text-xs px-2\">({{ event?.date | date: 'z' }})</span>\n        </h4>\n        <a\n            matRippleColor\n            details\n            class=\"w-full\"\n            [routerLink]=\"['./']\"\n            [queryParams]=\"{ event: event?.id }\"\n            (click)=\"viewDetails()\"\n            *ngIf=\"event\"\n        >\n            <div\n                class=\"w-full bg-white dark:bg-neutral-700 rounded-xl shadow py-4 relative\"\n            >\n                <h4 class=\"px-4 text-lg\">{{ event?.title }}</h4>\n                <div class=\"flex mx-4 my-2\">\n                    <div\n                        class=\"flex items-center bg-opacity-30 rounded-2xl p-1 text-base space-x-2 pr-2 font-medium\"\n                        [class.bg-green-600]=\"\n                            event.state !== 'done' &&\n                            event?.status === 'approved'\n                        \"\n                        [class.bg-yellow-500]=\"\n                            event.state !== 'done' &&\n                            event?.status === 'tentative'\n                        \"\n                        [class.bg-red-600]=\"\n                            event.state !== 'done' &&\n                            event?.status === 'declined'\n                        \"\n                        [class.bg-gray-300]=\"event.state === 'done'\"\n                    >\n                        <div\n                            class=\"rounded-full h-5 w-5 flex items-center justify-center text-white\"\n                            [class.bg-success]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'approved'\n                            \"\n                            [class.text-pending]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'tentative'\n                            \"\n                            [class.bg-error]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'declined'\n                            \"\n                            [class.text-neutral-600]=\"event.state === 'done'\"\n                        >\n                            <app-icon>\n                                {{\n                                    event.state === 'done'\n                                        ? 'not_interested'\n                                        : event?.status === 'approved'\n                                        ? 'done'\n                                        : event?.status === 'tentative'\n                                        ? 'warning'\n                                        : 'close'\n                                }}\n                            </app-icon>\n                        </div>\n                        <div class=\"pr-1\">{{ period }}</div>\n                    </div>\n                </div>\n                <div\n                    class=\"flex flex-wrap flex-col sm:flex-row sm:divide-x divide-neutral-500 py-2 space-y-2 sm:space-y-0\"\n                >\n                    <div class=\"flex items-center px-4\">\n                        <app-icon>meeting_room</app-icon>\n                        <div class=\"mx-2 truncate\">\n                            {{ location }}\n                        </div>\n                    </div>\n                    <div class=\"flex items-center px-4\">\n                        <app-icon>person_outline</app-icon>\n                        <div class=\"mx-2\">\n                            {{\n                                event?.organiser?.name ||\n                                    event?.organiser?.email\n                            }}\n                        </div>\n                    </div>\n                    <div\n                        class=\"flex items-center px-4\"\n                        *ngIf=\"event?.ext('catering')?.length\"\n                    >\n                        <app-icon>restaurant</app-icon>\n                        <div class=\"mx-2\">Catered</div>\n                    </div>\n                    <div class=\"flex items-center px-4\">\n                        <app-icon>people</app-icon>\n                        <div class=\"mx-2\">\n                            {{ event?.attendees?.length }}\n                            {{\n                                event?.attendees?.length === 1\n                                    ? 'Person'\n                                    : 'People'\n                            }}\n                        </div>\n                    </div>\n                </div>\n                <app-icon\n                    class=\"absolute top-1/2 right-1 text-4xl -translate-y-1/2\"\n                >\n                    chevron_right\n                </app-icon>\n                <div\n                    class=\"absolute bottom-2 right-2 sm:bottom-auto sm:top-2 text-sm sm:text-base flex items-center pr-4\"\n                    *ngIf=\"event?.attendees?.length\"\n                >\n                    <div\n                        class=\"h-10 w-6\"\n                        *ngFor=\"\n                            let user of event?.attendees\n                                | slice\n                                    : 0\n                                    : (event?.attendees?.length === 6 ? 6 : 5)\n                        \"\n                    >\n                        <a-user-avatar [user]=\"user\"></a-user-avatar>\n                    </div>\n                    <div class=\"h-10 w-6\" *ngIf=\"event?.attendees?.length > 6\">\n                        <div\n                            class=\"bg-secondary rounded-full h-10 w-10 border-2 border-white flex items-center justify-center text-white\"\n                        >\n                            +{{ event?.attendees?.length - 5 }}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </a>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class EventCardComponent extends BaseClass {\n    @Input() public event: CalendarEvent;\n    @Input() public show_day: boolean = false;\n    @Output() public edit = new EventEmitter();\n    @Output() public remove = new EventEmitter();\n\n    constructor(\n        private _dialog: MatDialog,\n        private _route: ActivatedRoute,\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) =>\n                params.has('event') && this.event?.id === params.get('event')\n                    ? this.viewDetails()\n                    : ''\n            )\n        );\n    }\n\n    public get day() {\n        const date = this.event?.date || Date.now();\n        const is_today = isSameDay(Date.now(), date);\n        return `${is_today ? 'Today' : format(date, 'EEEE')}`;\n    }\n\n    public get location() {\n        const zone =\n            this._org.levelWithID(this.event.space?.zones) ||\n            this._org.buildings.find((_) =>\n                this.event.space?.zones.includes(_.id)\n            );\n        return `${zone ? (zone.display_name || zone.name) + ', ' : ''} ${\n            this.event.space?.display_name || this.event.space?.name\n        }`;\n    }\n\n    public get period() {\n        const start = this.event?.date || Date.now();\n        const duration = this.event?.duration || 60;\n        const end = addMinutes(start, duration);\n        const dur = formatDuration({\n            hours: Math.floor(duration / 60),\n            minutes: duration % 60,\n        })\n            .replace(' hour', 'hr')\n            .replace(' minute', 'min');\n        return `${format(start, 'h:mm a')} - ${format(end, 'h:mm a')} (${dur})`;\n    }\n\n    public viewDetails() {\n        if (!this.event) return;\n        this.timeout('open', () =>{\n            const ref = this._dialog.open(EventDetailsModalComponent, { data: this.event });\n            this.subscription('edit', ref.componentInstance.edit.subscribe(() => this.edit.emit()));\n            this.subscription('remove', ref.componentInstance.remove.subscribe(() => this.remove.emit()));\n        });\n    }\n}\n","import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { addMinutes, format, formatDuration } from 'date-fns';\n\nimport { CalendarEvent } from './event.class';\nimport { MapPinComponent } from 'libs/components/src/lib/map-pin.component';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { SpacePipe } from 'libs/spaces/src/lib/space.pipe';\nimport { Building } from 'libs/organisation/src/lib/building.class';\nimport { BuildingLevel } from 'libs/organisation/src/lib/level.class';\nimport { SettingsService } from '@placeos/common';\nimport { Space } from 'libs/spaces/src/lib/space.class';\n\n@Component({\n    selector: 'event-details-modal',\n    template: `\n        <div\n            class=\"absolute inset-0 sm:relative sm:inset-auto sm:w-[51rem] sm:max-h-[80vh] bg-white sm:bg-gray-100 sm:dark:bg-neutral-600 dark:bg-neutral-700 sm:rounded overflow-auto space-y-2 pb-2\"\n        >\n            <div\n                class=\"sm:flex flex-col items-center pb-4 max-h-screen sm:max-h-[80vh] sm:px-16 sm:border-b bg-white dark:bg-neutral-700 border-gray-300 dark:border-neutral-500\"\n            >\n                <div\n                    class=\"bg-black/20 dark:bg-white/20 w-full h-64 sm:rounded-b overflow-hidden\"\n                >\n                    <image-carousel\n                        [images]=\"event?.system?.images\"\n                        class=\"w-full h-64\"\n                    ></image-carousel>\n                </div>\n                <h3 title class=\"px-3 mt-2 text-xl font-medium w-full\">\n                    {{ event.title }}\n                </h3>\n                <div class=\"sm:flex items-center justify-between w-full\">\n                    <div class=\"flex m-2\">\n                        <div\n                            class=\"flex items-center bg-opacity-30 rounded-2xl p-1 text-sm space-x-2 pr-2 font-medium\"\n                            [class.bg-green-600]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'approved'\n                            \"\n                            [class.bg-yellow-500]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'tentative'\n                            \"\n                            [class.bg-red-600]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'declined'\n                            \"\n                            [class.bg-gray-300]=\"event.state === 'done'\"\n                        >\n                            <div\n                                class=\"rounded-full h-5 w-5 flex items-center justify-center text-white\"\n                                [class.bg-success]=\"\n                                    event.state !== 'done' &&\n                                    event?.status === 'approved'\n                                \"\n                                [class.text-pending]=\"\n                                    event.state !== 'done' &&\n                                    event?.status === 'tentative'\n                                \"\n                                [class.bg-error]=\"\n                                    event.state !== 'done' &&\n                                    event?.status === 'declined'\n                                \"\n                                [class.text-neutral-600]=\"\n                                    event.state === 'done'\n                                \"\n                            >\n                                <app-icon>\n                                    {{\n                                        event.state === 'done'\n                                            ? 'not_interested'\n                                            : event?.status === 'approved'\n                                            ? 'done'\n                                            : event?.status === 'tentative'\n                                            ? 'warning'\n                                            : 'close'\n                                    }}\n                                </app-icon>\n                            </div>\n                            <div class=\"pr-1\">{{ period }}</div>\n                        </div>\n                    </div>\n                    <div\n                        actions\n                        class=\"flex items-center space-x-2 px-2\"\n                        *ngIf=\"event.state !== 'done'\"\n                    >\n                        <button\n                            mat-button\n                            class=\"flex-1 h-10\"\n                            *ngIf=\"event.can_check_in\"\n                        >\n                            <div\n                                class=\"flex items-center space-x-2 justify-center\"\n                            >\n                                <app-icon>arrow_back</app-icon>\n                                <div class=\"mr-4\">Checked in</div>\n                            </div>\n                        </button>\n                        <button\n                            mat-icon-button\n                            [matMenuTriggerFor]=\"menu\"\n                            class=\"bg-primary rounded text-white h-10 w-10\"\n                            *ngIf=\"allow_edit\"\n                        >\n                            <app-icon>more_horiz</app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class=\"sm:flex flex-wrap sm:px-12\">\n                <div\n                    class=\"sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[3] min-w-1/3 sm:w-[16rem] space-y-2\"\n                >\n                    <h3 class=\"px-3 mt-2 text-lg font-medium mb-2\">Details</h3>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>event</app-icon>\n                        <div>{{ event.date | date: 'EEEE, dd LLLL y' }}</div>\n                    </div>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>schedule</app-icon>\n                        <div>{{ period }}</div>\n                    </div>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>map</app-icon>\n                        <div>\n                            {{ level?.display_name || level?.name }},\n                            {{\n                                event?.system?.display_name ||\n                                    event?.system?.name\n                            }}\n                        </div>\n                    </div>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>place</app-icon>\n                        <div>\n                            {{ building?.display_name || building?.name }},\n                            {{ building?.address }}\n                        </div>\n                    </div>\n                </div>\n                <div\n                    class=\"mt-4 sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[3] min-w-1/3 sm:w-[16rem]\"\n                >\n                    <div\n                        class=\"mx-3 border-t border-gray-300 sm:border-none dark:border-neutral-500 flex items-center justify-between\"\n                    >\n                        <h3 class=\"text-lg font-medium\">Attendees</h3>\n                        <button\n                            mat-button\n                            show-attendees\n                            class=\"clear text-xs underline\"\n                            (click)=\"show_attendees = true\"\n                        >\n                            See All\n                        </button>\n                    </div>\n                    <div class=\"flex items-center p-1\">\n                        <div\n                            class=\"flex flex-col flex-1 items-center justify-center space-y-1\"\n                        >\n                            <div class=\"text-lg\">{{ accept_count || 0 }}</div>\n                            <div class=\"text-sm uppercase\">Yes</div>\n                        </div>\n                        <div\n                            class=\"flex flex-col flex-1 items-center justify-center space-y-1\"\n                        >\n                            <div class=\"text-lg\">{{ declined_count || 0 }}</div>\n                            <div class=\"text-sm uppercase\">No</div>\n                        </div>\n                        <div\n                            class=\"flex flex-col flex-1 items-center justify-center space-y-1\"\n                        >\n                            <div class=\"text-lg\">{{ pending_count || 0 }}</div>\n                            <div class=\"text-sm uppercase\">Pending</div>\n                        </div>\n                    </div>\n                    <h3\n                        class=\"mx-3 mt-2 pt-2 text-lg font-medium border-t border-gray-300 dark:border-neutral-500\"\n                    >\n                        Host\n                    </h3>\n                    <div class=\"px-2 flex items-center space-x-2\" host>\n                        <a-user-avatar [user]=\"event.organiser\"></a-user-avatar>\n                        <div class=\"text-sm\">\n                            <div>{{ event.organiser?.name }}</div>\n                            <div class=\"opacity-60\">{{ event.host }}</div>\n                        </div>\n                    </div>\n                </div>\n                <ng-container *ngIf=\"has_catering\">\n                    <div\n                        class=\"mt-4 sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[3] min-w-1/3 sm:w-[16rem]\"\n                    >\n                        <h3\n                            class=\"mx-3 mt-2 pt-2 text-lg font-medium border-t border-gray-300 dark:border-neutral-500\"\n                        >\n                            Catering\n                        </h3>\n                        <div class=\"flex flex-col px-4 space-y-2\">\n                            <div\n                                catering-item\n                                class=\"flex space-x-2\"\n                                *ngFor=\"\n                                    let item of event.ext('catering')[0].items\n                                \"\n                            >\n                                <div\n                                    count\n                                    class=\"flex items-center justify-center h-6 w-6 rounded-full bg-gray-200 text-sm font-medium\"\n                                >\n                                    {{ item.quantity }}\n                                </div>\n                                <div details class=\"pt-0.5\">\n                                    <div class=\"text-sm\">{{ item.name }}</div>\n                                    <div\n                                        class=\"text-xs opacity-40\"\n                                        *ngFor=\"let opt of item.options\"\n                                    >\n                                        {{ opt.name }}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </ng-container>\n                <div\n                    map\n                    class=\"mt-4 sm:mt-2 h-64 sm:h-48 relative border border-gray-200 dark:border-neutral-500 overflow-hidden rounded sm:bg-white sm:dark:bg-neutral-700 m-2 flex-grow-[3] min-w-1/3 p-2 sm:w-[16rem]\"\n                >\n                    <interactive-map\n                        class=\"pointer-events-none\"\n                        [src]=\"level?.map_id\"\n                        [features]=\"features\"\n                        [options]=\"{ disable_pan: true, disable_zoom: true }\"\n                    ></interactive-map>\n                </div>\n                <div\n                    class=\"mt-4 sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[3] min-w-1/3 sm:w-[16rem]\"\n                >\n                    <h3\n                        class=\"mx-3 text-lg font-medium border-t sm:border-none border-gray-300 dark:border-neutral-500\"\n                        *ngIf=\"event.body\"\n                    >\n                        Notes\n                    </h3>\n                    <div\n                        notes\n                        class=\"mx-4 overflow-hidden max-w-full\"\n                        *ngIf=\"event.body\"\n                        [innerHTML]=\"event.body | sanitize\"\n                    ></div>\n                </div>\n                <button\n                    mat-icon-button\n                    mat-dialog-close\n                    class=\"absolute top-2 left-2 bg-black/30 text-white\"\n                >\n                    <app-icon>close</app-icon>\n                </button>\n                <div class=\"absolute inset-0 z-50\" *ngIf=\"show_attendees\">\n                    <attendee-list\n                        [list]=\"event.attendees\"\n                        [host]=\"event.host\"\n                        (click)=\"show_attendees = false\"\n                    ></attendee-list>\n                </div>\n            </div>\n            <mat-menu #menu=\"matMenu\" xPosition=\"before\">\n                <button\n                    mat-menu-item\n                    mat-dialog-close\n                    class=\"flex items-center space-x-2 text-base\"\n                    (click)=\"edit.emit(space)\"\n                >\n                    <app-icon>edit</app-icon>\n                    <div>Edit event</div>\n                </button>\n                <button\n                    mat-menu-item\n                    class=\"flex items-center space-x-2 text-base\"\n                    (click)=\"remove.emit()\"\n                >\n                    <app-icon>delete</app-icon>\n                    <div>Delete event</div>\n                </button>\n            </mat-menu>\n        </div>\n    `,\n    styles: [``],\n    providers: [SpacePipe],\n})\nexport class EventDetailsModalComponent {\n    @Output() public edit = new EventEmitter();\n    @Output() public remove = new EventEmitter();\n    public show_attendees: boolean = false;\n    public readonly event = this._event;\n    public features = [\n        {\n            location: this.event?.system?.map_id,\n            content: MapPinComponent,\n        },\n    ];\n\n    public readonly has_catering = this.event?.ext('catering')?.length > 0;\n\n    public level: BuildingLevel = new BuildingLevel();\n    public building: Building = new Building();\n    public space: Space = new Space();\n\n    public accept_count = this._event.attendees.reduce(\n        (c, i) => (c += i.response_status === 'accepted' ? 1 : 0),\n        0\n    );\n    public declined_count = this._event.attendees.reduce(\n        (c, i) => (c += i.response_status === 'declined' ? 1 : 0),\n        0\n    );\n    public pending_count = this._event.attendees.reduce(\n        (c, i) =>\n            (c +=\n                i.response_status === 'tentative' ||\n                i.response_status === 'needsAction'\n                    ? 1\n                    : 0),\n        0\n    );\n\n    public get allow_edit() {\n        return !this._settings.get('app.events.booking_unavailable');\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _event: CalendarEvent,\n        private _org: OrganisationService,\n        private _space_pipe: SpacePipe,\n        private _settings: SettingsService\n    ) {\n        this._load().then();\n    }\n\n    public get period() {\n        const start = this.event?.date || Date.now();\n        const duration = this.event?.duration || 60;\n        const end = addMinutes(start, duration);\n        const dur = formatDuration({\n            hours: Math.floor(duration / 60),\n            minutes: duration % 60,\n        })\n            .replace(' hour', 'hr')\n            .replace(' minute', 'min');\n        return `${format(start, 'h:mm a')} - ${format(end, 'h:mm a')} (${dur})`;\n    }\n\n    private async _load() {\n        this.space = await this._space_pipe.transform(\n            this._event.system?.id || this._event.system?.email\n        );\n        this.level = this._org.levelWithID(this.space.zones);\n        this.building = this._org.buildings.find((bld) =>\n            this.space.zones.includes(bld.id)\n        );\n        this.features = [\n            {\n                location: this.space.map_id,\n                content: MapPinComponent,\n            },\n        ];\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { Event, NavigationEnd, Router } from '@angular/router';\nimport { querySystems } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest, forkJoin, Observable, of } from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    distinctUntilKeyChanged,\n    filter,\n    map,\n    shareReplay,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\nimport { getUnixTime, startOfDay } from 'date-fns';\nimport {\n    BaseClass,\n    currentUser,\n    flatten,\n    getInvalidFields,\n    SettingsService,\n    unique,\n} from '@placeos/common';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport {\n    queryResourceAvailability,\n    saveBooking,\n} from 'libs/bookings/src/lib/bookings.fn';\nimport { querySpaceAvailability } from 'libs/calendar/src/lib/calendar.fn';\nimport { CalendarEvent } from './event.class';\nimport { saveEvent } from './events.fn';\nimport { generateEventForm, newCalendarEventFromBooking } from './utilities';\nimport { newBookingFromCalendarEvent } from 'libs/bookings/src/lib/booking.utilities';\nimport { PaymentsService } from 'libs/payments/src/lib/payments.service';\nimport { CateringOrder } from 'libs/catering/src/lib/catering-order.class';\nimport { MatDialog } from '@angular/material/dialog';\nimport { EventLinkModalComponent } from './event-link-modal.component';\n\nconst BOOKING_URLS = [\n    'book/spaces',\n    'book/meeting',\n    'schedule/view',\n    'confirm/success',\n    'upcoming',\n];\n\nconst MINUTES = 60 * 1000;\n\nexport type EventFlowView =\n    | 'form'\n    | 'find'\n    | 'catering'\n    | 'confirm'\n    | 'success';\n\nexport interface EventFlowOptions {\n    /** Calendar to associate event with */\n    calendar_id?: string;\n    /** List of features to filter spaces on */\n    features: string[];\n    /** List of zones to filter spaces on */\n    zone_ids?: string[];\n    /** Minimum number of attendees to filter space on */\n    capacity?: number;\n    /** Whether to only show favourite rooms */\n    show_fav?: boolean;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class EventFormService extends BaseClass {\n    private _view = new BehaviorSubject<EventFlowView>('form');\n    private _options = new BehaviorSubject<EventFlowOptions>({\n        zone_ids: [],\n        features: [],\n    });\n    private _form = generateEventForm();\n    private _event = new BehaviorSubject<CalendarEvent>(null);\n    private _loading = new BehaviorSubject<string>('');\n\n    public last_success: CalendarEvent = new CalendarEvent(\n        JSON.parse(sessionStorage.getItem('PLACEOS.last_booked_event') || '{}')\n    );\n    public readonly loading = this._loading.asObservable();\n    public readonly options = this._options.asObservable();\n\n    public readonly spaces = combineLatest([\n        this._options.pipe(distinctUntilKeyChanged('zone_ids')),\n        this._org.active_building.pipe(\n            filter((_) => !!_),\n            distinctUntilKeyChanged('id')\n        ),\n    ]).pipe(\n        debounceTime(300),\n        switchMap(([{ zone_ids }]) => {\n            this._loading.next('Loading space list for location...');\n            if (!zone_ids?.length) zone_ids = [this._org.building?.id];\n            return forkJoin(\n                zone_ids.map(\n                    (_) =>\n                        querySystems({ zone_id: _ }).pipe(map((_) => _.data)),\n                    catchError((_) => of([]))\n                )\n            );\n        }),\n        map((l) => flatten(l).map((_) => new Space(_ as any))),\n        tap((_) => this._loading.next('')),\n        shareReplay(1)\n    );\n\n    public readonly features = this.spaces.pipe(\n        map((l) => unique(flatten(l.map((_) => _.features))))\n    );\n\n    public readonly filtered_spaces = combineLatest([\n        this.spaces,\n        this.options,\n    ]).pipe(\n        map(([spaces, { show_fav, features, capacity }]) =>\n            spaces.filter((s) => {\n                const domain = (currentUser()?.email || '@').split('@')[1];\n                const zone = (this._settings.get(\n                    'app.events.restrict_spaces'\n                ) || {})[domain];\n                const limit_map = (this._settings.get(\n                    'app.events.limit_spaces'\n                ) || {});\n                const limited_zones = Object.keys(limit_map);\n                const zone_limit = s.zones.find(_ => limited_zones.includes(_)) \n                return (!zone || s.zones.includes(zone)) &&\n                    (!zone_limit || limit_map[zone_limit] === domain) &&\n                    (!show_fav || this.favorite_spaces.includes(s.id)) &&\n                    features.every((f) => s.features.includes(f)) &&\n                    s.capacity >= Math.max(0, capacity || 0);\n            })\n        ),\n        shareReplay(1)\n    );\n\n    public readonly available_spaces: Observable<Space[]> = combineLatest([\n        this.filtered_spaces,\n        this._form.valueChanges,\n    ]).pipe(\n        filter(() => !this._loading.getValue()),\n        debounceTime(300),\n        switchMap(([spaces]) => {\n            if (!spaces.length) return of([]);\n            this._loading.next('Retrieving available spaces...');\n            const { date, duration } = this._form.getRawValue();\n            const query = {\n                period_start: getUnixTime(date),\n                period_end: getUnixTime(date + duration * MINUTES),\n            };\n            return (\n                !this.has_calendar\n                    ? queryResourceAvailability(\n                          spaces.map(({ id }) => id),\n                          { ...query, type: 'room' }\n                      ).pipe(\n                          map((_) =>\n                              _.map((id) => spaces.find((s) => id === s.id))\n                          )\n                      )\n                    : querySpaceAvailability(\n                          {\n                              ...query,\n                              system_ids: spaces.map(({ id }) => id).join(','),\n                          },\n                          this._org\n                      )\n            ).pipe(catchError((_) => []));\n        }),\n        map((_) =>\n            _.filter(\n                (space) =>\n                    !space.availability?.length ||\n                    space.availability?.find((_) => _.status !== 'busy')\n            )\n        ),\n        tap((_) => this._loading.next('')),\n        shareReplay(1)\n    );\n\n    public get view() {\n        return this._view.getValue();\n    }\n    public get form() {\n        return this._form;\n    }\n    public get event() {\n        return this._event.getValue();\n    }\n\n    public get favorite_spaces() {\n        return this._settings.get<string[]>('favourite_spaces') || [];\n    }\n\n    public get has_calendar() {\n        return this._settings.get('app.no_user_calendar') !== true;\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _router: Router,\n        private _payments: PaymentsService,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this.available_spaces.subscribe();\n        this.subscription(\n            'router.events',\n            this._router.events.subscribe((event: Event) => {\n                if (\n                    event instanceof NavigationEnd &&\n                    !BOOKING_URLS.some((_) => event.url.includes(_))\n                ) {\n                    this.clearForm();\n                }\n            })\n        );\n        this.subscription(\n            'form_change',\n            this._form.valueChanges.subscribe(() => this.storeForm())\n        );\n    }\n\n    public setView(value: EventFlowView) {\n        this._view.next(value);\n    }\n\n    public setOptions(value: Partial<EventFlowOptions>) {\n        this._options.next({ ...this._options.getValue(), ...value });\n    }\n\n    public newForm(event: CalendarEvent = new CalendarEvent()) {\n        this._event.next(event);\n        this.resetForm();\n    }\n\n    public resetForm() {\n        this._form.reset();\n        const event = this._event.getValue();\n        this._form.patchValue({\n            ...(event || {}),\n            ...(event?.extension_data || {}),\n            host: event?.host || currentUser().email,\n        });\n        this._options.next({ features: [] });\n        this.storeForm();\n    }\n\n    public clearForm() {\n        sessionStorage.removeItem('PLACEOS.event_form');\n        this.newForm();\n    }\n\n    public storeForm() {\n        sessionStorage.setItem(\n            'PLACEOS.event_form',\n            JSON.stringify(this._form.getRawValue() || {})\n        );\n    }\n\n    public loadForm() {\n        if (!this._form) this.newForm();\n        this._form.patchValue({\n            ...JSON.parse(sessionStorage.getItem('PLACEOS.event_form') || '{}'),\n        });\n    }\n\n    public readonly cancelPostForm = () => this.unsub('post-event-form');\n\n    public openEventLinkModal(force: boolean = false) {\n        const form = this._form;\n        form.markAllAsTouched();\n        if (!form.valid && !force) return;\n        const event = new CalendarEvent({ ...form.getRawValue() });\n        const ref = this._dialog.open(EventLinkModalComponent, { data: event });\n        ref.afterClosed().subscribe((d) => d ? this._router.navigate(['/']) : '');\n    }\n\n    public postForm(force: boolean = false) {\n        return new Promise<CalendarEvent>(async (resolve, reject) => {\n            this._loading.next('Creating event...');\n            const form = this._form;\n            form.markAllAsTouched();\n            const event = this.event || new CalendarEvent();\n            if (!form.valid && !force) {\n                this._loading.next('');\n                return reject(\n                    `Some form fields are invalid. [${getInvalidFields(\n                        form\n                    ).join(', ')}]`\n                );\n            }\n            const { id, host, date, duration, creator, all_day } =\n                form.getRawValue();\n            const spaces = form.get('resources')?.value || [];\n            let catering = form.get('catering')?.value || [];\n            if (\n                (!id || date !== event.date || duration !== event.duration) &&\n                spaces.length\n            ) {\n                const start = getUnixTime(event.date);\n                await this.checkSelectedSpacesAreAvailable(\n                    spaces,\n                    date,\n                    duration,\n                    id\n                        ? { start, end: start + event.duration * 60 }\n                        : undefined,\n                    id || ''\n                ).catch((_) => {\n                    this._loading.next('');\n                    reject(_);\n                    throw _;\n                });\n            }\n            const is_owner =\n                host === currentUser()?.email ||\n                creator === currentUser()?.email;\n            const space_id = spaces[0]?.id;\n            const query = id\n                ? is_owner\n                    ? { calendar: host || creator }\n                    : { system_id: space_id }\n                : {};\n            const value = this._form.getRawValue();\n            console.log('Payments:', this._payments.payment_module, spaces.length);\n            if (this._payments.payment_module && spaces.length) {\n                console.log('Make Payment...');\n                const receipt = await this._payments.makePayment({\n                    type: 'space',\n                    resource_name: spaces[0].display_name || spaces[0].name,\n                    date,\n                    duration,\n                    all_day,\n                });\n                if (!receipt?.success) return this._loading.next('');\n                (value as any).extension_data = {\n                    invoice: receipt,\n                    invoice_id: receipt.invoice_id,\n                };\n                console.log('Payment success.', receipt);\n            }\n            const d = value.all_day ? startOfDay(value.date).valueOf() : value.date;\n            if (catering.length && !('items' in catering[0])) {\n                catering = [new CateringOrder({ items: catering as any })];\n            }\n            const result = await this._makeBooking(\n                new CalendarEvent({\n                    ...value,\n                    date: d,\n                    catering,\n                }),\n                query\n            ).catch((e) => {\n                reject(e);\n                this._loading.next('');\n                throw e;\n            });\n            this.clearForm();\n            this.last_success = result;\n            sessionStorage.setItem(\n                'PLACEOS.last_booked_event',\n                JSON.stringify(result)\n            );\n            this.setView('success');\n            resolve(result);\n            this._loading.next('');\n        });\n    }\n\n    private async _makeBooking(\n        event: CalendarEvent,\n        query: Record<string, any>\n    ) {\n        return (\n            !this.has_calendar\n                ? saveBooking(\n                      newBookingFromCalendarEvent({\n                          ...event.toJSON(),\n                          status: this._settings.get('app.bookings.no_approval')\n                              ? 'approved'\n                              : 'tentative',\n                      } as any)\n                  ).pipe(map((_) => newCalendarEventFromBooking(_)))\n                : saveEvent(event.toJSON(), query)\n        ).toPromise();\n    }\n\n    private async checkSelectedSpacesAreAvailable(\n        spaces: Space[],\n        date: number,\n        duration: number,\n        exclude?: { start: number; end: number },\n        ignore?: string\n    ) {\n        const space_ids = spaces.map((s) => s.id);\n        const query: any = {\n            period_start: getUnixTime(date),\n            period_end: getUnixTime(date + duration * 60 * 1000),\n        };\n        if (exclude) query.exclude_range = `${exclude.start}...${exclude.end}`;\n        const space_list: any[] = spaces.length\n            ? await (!this.has_calendar\n                  ? (queryResourceAvailability(space_ids, {\n                        ...query,\n                        type: 'room',\n                        ignore,\n                    }) as any)\n                  : querySpaceAvailability({\n                        ...query,\n                        system_ids: space_ids.join(','),\n                    })\n              ).toPromise()\n            : [];\n        if (space_list.length !== spaces.length)\n            throw `${\n                spaces.length - space_list.length\n            } space(s) are not available at the selected time`;\n        return true;\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport {\n    generateCalendarFileLink,\n    generateGoogleCalendarLink,\n    generateMicrosoftCalendarLink,\n} from 'libs/common/src/lib/calendar-links';\nimport { CalendarEvent } from './event.class';\n\n@Component({\n    selector: 'event-link-modal',\n    template: `\n        <div class=\"p-4 w-full pb-2\">\n            Add event to your calendar\n        </div>\n        <div class=\"flex flex-col items-center space-y-4 p-4 relative\">\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"outlook_link | sanitize:'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n            >\n                <img src=\"assets/icons/outlook.svg\" class=\"w-6\" />\n                <span>Create in Outlook</span>\n            </a>\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"google_link | sanitize:'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n            >\n                <img src=\"assets/icons/gcal.svg\" class=\"w-6\" />\n                <span>Create in Google Calendar</span>\n            </a>\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"ical_link | safe:'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n            >\n                <app-icon class=\"text-xl\">download</app-icon>\n                <span>Download iCal File</span>\n            </a>\n            <button class=\"w-64\" mat-button [mat-dialog-close]=\"true\">\n                Done\n            </button>\n        </div>\n        <button mat-icon-button mat-dialog-close class=\"absolute top-2 right-0\">\n            <app-icon>close</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n        `,\n    ],\n})\nexport class EventLinkModalComponent {\n    public readonly outlook_link = generateMicrosoftCalendarLink(\n        this._event as any\n    );\n    public readonly google_link = generateGoogleCalendarLink(\n        this._event as any\n    );\n    public readonly ical_link = generateCalendarFileLink(this._event as any);\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _event: CalendarEvent,\n        private _settings: SettingsService\n    ) {}\n}\n","import { Identity, removeEmptyFields, unique } from '@placeos/common';\nimport { PlaceSystem } from '@placeos/ts-client';\nimport {\n    add,\n    addMinutes,\n    differenceInMinutes,\n    getUnixTime,\n    isAfter,\n    isBefore,\n    isSameDay,\n    roundToNearestMinutes,\n    set,\n} from 'date-fns';\nimport { CateringOrder } from 'libs/catering/src/lib/catering-order.class';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { GuestUser, User } from 'libs/users/src/lib/user.class';\nimport {\n    EventExtensionData,\n    FileDetails,\n    RecurrenceDetails,\n} from './event.interfaces';\nimport { eventStatus } from './helpers';\n\nlet _default_user: Identity = { id: 'default', name: 'Default User' };\n\nexport function setDefaultCreator(user: Identity) {\n    if (user) _default_user = user;\n}\n\ntype CalendarEventExtended = CalendarEvent & EventExtensionData;\n\n/** User's calendar event/booking */\nexport class CalendarEvent {\n    /** ID of the calendar event */\n    public readonly id: string;\n    /** Status of the event */\n    public readonly status: 'approved' | 'tentative' | 'declined' | 'none';\n    /** Email address of the host */\n    public readonly host: string;\n    /** ID of the calendar associated with the event */\n    public readonly calendar: string;\n    /** Email address of the event creator */\n    public readonly creator: string;\n    /** List of attendees of the event */\n    public readonly attendees: User[];\n    /** List of attendees of the event */\n    public readonly resources: Space[];\n    /** Summary of the event details */\n    public readonly title: string;\n    /** Extended details of the event */\n    public readonly body: string;\n    /** Unix epoch in seconds of the start time of the event */\n    public readonly event_start: number;\n    /** Unix epoch in seconds of the end time of the event */\n    public readonly event_end: number;\n    /** Whether event occurs over the full day */\n    public readonly all_day: boolean;\n    /** Unix epoch of the start time of the event */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** IANA timezone string for the event location */\n    public readonly timezone: string;\n    /** Location details for the event */\n    public readonly location: string;\n    /** URL of the associated meeting */\n    public readonly meeting_url: string;\n    /** URL of the associated meeting */\n    public readonly meeting_id: string;\n    /** URL of the associated meeting */\n    public readonly meeting_provider: string;\n    /** Whether this event is recurring */\n    public readonly recurring: boolean;\n    /** Details about the event's recurrence */\n    public readonly recurrence: RecurrenceDetails;\n    /** ID of the parent recurring event */\n    public readonly recurring_master_id: string;\n    /** Whether event details should be private */\n    public readonly private: boolean;\n    /** File attachements for the event */\n    public readonly attachments: FileDetails[];\n    /** Extra data associated with the event */\n    public readonly extension_data: Partial<EventExtensionData>;\n    /** System associated with the event */\n    public readonly system: PlaceSystem;\n    /** Previous system associated with the event */\n    public readonly old_system: PlaceSystem;\n    /** Host user details of the event */\n    public readonly organiser: User;\n    /** Type of event */\n    public readonly type: 'cancelled' | 'external' | 'internal';\n    /** Whether this event was from a PlaceOS booking instead of a user calendar */\n    public readonly from_bookings: boolean;\n    /** Master event */\n    public master?: CalendarEvent;\n\n    /** Get field from extension data */\n    public ext<K extends keyof EventExtensionData>(key: K) {\n        return this.extension_data[key];\n    }\n\n    constructor(data: Partial<CalendarEventExtended> = {}) {\n        this.id = data.id || '';\n        this.event_start =\n            data.event_start ||\n            getUnixTime(\n                data.date ||\n                    roundToNearestMinutes(addMinutes(new Date(), 3), {\n                        nearestTo: 5,\n                    })\n            );\n        this.event_end =\n            data.event_end ||\n            getUnixTime(\n                addMinutes(this.event_start * 1000, data.duration || 30)\n            );\n        this.calendar = data.calendar || '';\n        this.creator =\n            (data.creator || _default_user.email)?.toLowerCase() || '';\n        this.host = (\n            data.host ||\n            this.creator ||\n            _default_user.email ||\n            ''\n        ).toLowerCase();\n        const attendees = data.attendees || [];\n        this.attendees = attendees\n            .filter((user: any) => !user.resource)\n            .map((u) => new User(u));\n        this.resources =\n            unique(\n                data.resources ||\n                    attendees\n                        .filter((user) => (user as any).resource)\n                        .map((s) => new Space(s as any)),\n                'email'\n            ) || [];\n        this.title = data.title || 'Space Booking';\n        this.body = data.body || '';\n        this.private = !!data.private;\n        this.all_day = !!data.all_day;\n        this.date = this.event_start * 1000 || this.date;\n        this.duration = this.all_day\n            ? 24 * 60\n            : data.duration ||\n              differenceInMinutes(data.event_end * 1000, this.date) ||\n              30;\n        this.timezone = data.timezone || '';\n        this.meeting_url = data.meeting_url || data.online_meeting_url || '';\n        this.meeting_id = data.meeting_id || data.online_meeting_id || '';\n        this.meeting_provider =\n            data.meeting_provider || data.online_meeting_provider || '';\n        this.recurring = !!data.recurring;\n        this.recurring_master_id = data.recurring_master_id || '';\n        this.organiser = this.attendees.find(\n            (user) => user.email === this.host\n        );\n        this.from_bookings = data.from_bookings ?? false;\n        this.master = data.master ? new CalendarEvent(data.master) : null;\n        if (data.recurring) {\n            this.recurrence = {\n                start:\n                    this.event_start * 1000 ||\n                    new Date(\n                        (data.recurrence as any).range_start * 1000\n                    ).valueOf(),\n                end:\n                    data.recurrence.end ||\n                    new Date(\n                        (data.recurrence as any).range_end * 1000\n                    ).valueOf(),\n                interval: data.recurrence.interval,\n                pattern: data.recurrence.pattern,\n                days_of_week: data.recurrence.days_of_week,\n            };\n        } else {\n            this.recurrence = {} as any;\n        }\n        const system = data.system;\n        if (\n            system?.email &&\n            !this.resources.find((_) => _.email === system.email)\n        ) {\n            this.resources.push(new Space(system as any));\n        }\n        this.system = system || (this.resources[0] as any) || null;\n        this.old_system = data.old_system || data.system;\n        this.attachments = data.attachments || [];\n        this.extension_data = data.extension_data || {};\n        this.status = eventStatus({ ...data, ...this }) || 'none';\n        this.location = data.location || this.space?.display_name || this.space?.name || '';\n        this.type =\n            this.status === 'declined'\n                ? 'cancelled'\n                : this.attendees.find((_) => _.is_external)\n                ? 'external'\n                : 'internal';\n        for (const key in data) {\n            if (!(key in this)) {\n                this.extension_data[key] =\n                    data[key] || this.extension_data[key];\n            }\n        }\n        this.extension_data.catering = (this.extension_data.catering || []).map(\n            (i) => new CateringOrder({ ...i, event: this })\n        );\n    }\n\n    /** List of external attendees associated with the event */\n    public get guests() {\n        return this.attendees.filter((f) => !!f.is_external) as GuestUser[];\n    }\n    /** Primary space associated with the booking */\n    public get space() {\n        return this.resources[0] || null;\n    }\n    public get is_today(): boolean {\n        return isSameDay(new Date(this.date), new Date());\n    }\n\n    /**\n     * Convert class data to simple JSON object\n     */\n    public toJSON(): Record<string, any> {\n        const obj: Record<string, any> = { ...this };\n        const end = getUnixTime(addMinutes(this.date, this.duration));\n        const date = this.all_day ? set(this.date, { hours: 12 }) : this.date;\n        obj.event_start = getUnixTime(date);\n        obj.event_end = end;\n        const attendees = this.attendees;\n        if (this.recurring) {\n            obj.recurrence = {\n                ...this.recurrence,\n                range_start: obj.event_start,\n                range_end: getUnixTime(this.recurrence.end),\n            };\n        }\n        obj.recurrence = obj.recurrence\n            ? Object.keys(obj.recurrence).length\n                ? obj.recurrence\n                : null\n            : null;\n        obj.attendees = unique([...attendees, ...this.resources.map(_ => ({ ..._, resource: true }))], 'email');\n        if (!this.all_day) {\n            obj.extension_data.breakdown = 15;\n        }\n        obj.extension_data.catering = obj.extension_data.catering.map(\n            (i) => new CateringOrder({ ...i, event: null })\n        );\n        obj.system_id = this.system?.id;\n        delete obj.catering;\n        delete obj.date;\n        delete obj.duration;\n        delete obj.status;\n        removeEmptyFields(obj);\n        return obj;\n    }\n\n    /** Status of the booking */\n    public get state():\n        | 'future'\n        | 'upcoming'\n        | 'done'\n        | 'started'\n        | 'in_progress' {\n        const now = new Date();\n        const date = this.date;\n        if (isBefore(now, add(date, { minutes: -15 }))) return 'future';\n        if (isBefore(now, date)) return 'upcoming';\n        if (isBefore(now, add(date, { minutes: 15 }))) return 'started';\n        if (isBefore(now, add(date, { minutes: this.duration })))\n            return 'in_progress';\n        return 'done';\n    }\n\n    public get can_check_in(): boolean {\n        const now = new Date();\n        return (\n            this.is_today ||\n            (isAfter(now, this.date) &&\n                isBefore(now, addMinutes(this.date, this.duration)))\n        );\n    }\n}\n","import { del, get, patch, post, put } from '@placeos/ts-client';\nimport { Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { GuestUser } from 'libs/users/src/lib/user.class';\n\nimport { CalendarEvent } from './event.class';\n\nexport interface CalendarEventQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zone_ids?: string;\n    /** Comma seperated list of system(space) ids to check availability */\n    system_ids?: string;\n    /** Comma seperated list of calendar ids to check availability */\n    calendars?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n    /** Whether to include cancelled events in the returned list */\n    include_cancelled?: boolean;\n}\n\nexport interface CalendarEventShowParams {\n    /** ID of the personal calendar to grab the events details from */\n    calendar?: string;\n    /** ID of the system/space to get the associated calendar ID */\n    system_id?: string;\n}\n\nconst EVENTS_ENDPOINT = `/api/staff/v1/events`;\n\n/**\n * List events\n * @param q Parameters to pass to the API request\n */\nexport function queryEvents(\n    q: CalendarEventQueryParams\n): Observable<CalendarEvent[]> {\n    const query = toQueryString(q);\n    return get(`${EVENTS_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((e) => new CalendarEvent(e))),\n        catchError(_ => of([]))\n    );\n}\n\n/**\n * Get event details\n * @param id ID of the event to grab\n * @param q Parameters to pass to the API request\n */\nexport function showEvent(id: string, q: CalendarEventShowParams = {}) {\n    const query = toQueryString(q);\n    return get(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Create new calendar event and add it to the database\n * @param data New calendar event fields\n */\nexport function createEvent(data: Partial<CalendarEvent>) {\n    return post(`${EVENTS_ENDPOINT}`, new CalendarEvent(data).toJSON()).pipe(\n        map((item) => new CalendarEvent(item))\n    );\n}\n\n/**\n * Update an existing calendar event\n * @param id ID of the event to update\n * @param data New values for event fields\n * @param q Parameters to pass to the API request\n * @param method HTTP verb to use with API request\n */\nexport function updateEvent(\n    id: string,\n    data: Partial<CalendarEvent>,\n    q: CalendarEventShowParams = {},\n    method: 'put' | 'patch' = 'patch'\n) {\n    const query = toQueryString(q);\n    return (method === 'patch' ? patch : put)(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`,\n        method === 'patch' ? data : new CalendarEvent(data).toJSON()\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Save changes to or create a calendar event\n * @param data State of the calendar event\n * @param q Parameters to pass to the API request\n */\nexport const saveEvent = (\n    data: Partial<CalendarEvent>,\n    q?: CalendarEventShowParams\n) => {\n    delete (data as any)?.status;\n    return data.id ? updateEvent(data.id, data, q) : createEvent(data);\n};\n\n/**\n * Remove calendar event from the database\n * @param id ID of the event to remove\n * @param q Parameters to pass to the API request\n */\nexport function removeEvent(id: string, q: CalendarEventShowParams = {}) {\n    const query = toQueryString(q);\n    return del(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`,\n        {\n            response_type: 'void',\n        }\n    );\n}\n\n/**\n * Set the approval state of the event to approved\n * @param id ID of the event to approve\n * @param system_id Associated system to approve\n */\nexport function approveEvent(id: string, system_id: string) {\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/approve?system_id=${encodeURIComponent(system_id)}`,\n        ''\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Set the approval state of the event to rejected\n * @param id ID of the event to reject\n * @param system_id Associated system to reject\n */\nexport function rejectEvent(id: string, system_id: string) {\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/reject?system_id=${encodeURIComponent(system_id)}`,\n        ''\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * List guests for event\n * @param id ID of the event to grab\n * @param q Parameters to pass to the API request\n */\nexport function queryEventGuests(\n    id: string,\n    q: CalendarEventShowParams = {}\n): Observable<GuestUser[]> {\n    const query = toQueryString(q);\n    return get(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}/guests${\n            query ? '?' + query : ''\n        }`\n    ).pipe(map((list) => list.map((item) => new GuestUser(item))));\n}\n\n/**\n * Set the checkin state of an event guest\n * @param id ID of the event to grab\n * @param guest_id ID of the guest to update\n * @param state New checkin state of the guest\n * @param q Parameters to pass to the API request\n */\nexport function checkinEventGuest(\n    id: string,\n    guest_id: string,\n    state: boolean,\n    q: CalendarEventShowParams = {}\n) {\n    const query = toQueryString({ ...q, state });\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/guests/${guest_id}/checkin${query ? '?' + query : ''}`,\n        ''\n    ).pipe(map((item) => new GuestUser(item)));\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatRadioModule } from '@angular/material/radio';\n\nimport { FormFieldsModule } from 'libs/form-fields/src/lib/form-fields.module';\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\n\nimport { AttendeeListComponent } from './attendee-list.component';\nimport { EventCardComponent } from './event-card.component';\nimport { EventDetailsModalComponent } from './event-details-modal.component';\nimport { EventLinkModalComponent } from './event-link-modal.component';\n\nconst COMPONENTS = [\n    EventDetailsModalComponent,\n    AttendeeListComponent,\n    EventCardComponent,\n    EventLinkModalComponent\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatRadioModule,\n        MatInputModule,\n        MatFormFieldModule,\n        MatDatepickerModule,\n        MatButtonModule,\n        MatDialogModule,\n        MatProgressSpinnerModule,\n        FormFieldsModule,\n        ComponentsModule\n    ],\n    providers: [ReactiveFormsModule],\n    exports: [...COMPONENTS],\n})\nexport class SharedEventsModule {}\n","export * from './event-form.service';\nexport * from './event.class';\nexport * from './event.interfaces';\nexport * from './events.fn';\nexport * from './helpers';\nexport * from './utilities';\nexport * from './validators';\n","import { HashMap } from '@placeos/common';\nimport {\n    addMinutes, addSeconds,\n\n    differenceInMinutes,\n    format,\n    isAfter,\n    isBefore,\n    isSameMinute,\n    startOfMinute\n} from 'date-fns';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport {\n    BookingRuleDetails,\n    BookingRules,\n    BookingRuleset,\n    BookingRulesmap,\n    RecurrenceDetails,\n    TimeBlock,\n    TimePeriod\n} from './event.interfaces';\n\nexport function eventStatus(\n    details: HashMap\n): 'approved' | 'tentative' | 'declined' {\n    if (details.resources?.length) {\n        if (details.resources.every((i) => i.response_status === 'accepted' || details.approved)) {\n            return 'approved';\n        } else if (\n            details.resources.some(\n                (i) =>\n                    i.response_status === 'tentative' ||\n                    i.response_status === 'needsAction'\n            )\n        ) {\n            return 'tentative';\n        }\n        return 'declined';\n    }\n    return 'approved';\n}\n\nexport function formatRecurrence({\n    interval,\n    pattern,\n    end,\n}: RecurrenceDetails) {\n    let details = '';\n    if (interval) {\n        switch (pattern) {\n            case 'daily':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} days` : 'Daily'\n                );\n                break;\n            case 'weekly':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} weeks` : 'Weekly'\n                );\n                break;\n            case 'monthly':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} months` : 'Monthly'\n                );\n                break;\n        }\n        details = details.concat(`, until ${format(end, 'MMM do, yyyy')}`);\n    }\n    return details;\n}\n\n/**\n * Generate a list of free time slots between the given bookings\n * @param list List of bookings to find slots between\n * @param min_size Minimum length of a free slot in minutes\n */\nexport function getFreeTimeSlots(\n    list: TimePeriod[],\n    min_size: number = 30\n): TimeBlock[] {\n    let start = new Date(0);\n    const slots: TimeBlock[] = [];\n    list.sort((a, b) => a.date - b.date);\n    for (const booking of list) {\n        const bkn_start = new Date(booking.date);\n        const bkn_end = addMinutes(booking.date, booking.duration);\n        if (isAfter(booking.date, start)) {\n            const diff = Math.abs(differenceInMinutes(bkn_start, start));\n            if (diff >= min_size) {\n                slots.push({\n                    start: start.valueOf(),\n                    end: booking.date,\n                });\n            }\n            start = bkn_end;\n        } else if (isSameMinute(start, booking.date)) {\n            start = bkn_end;\n        }\n    }\n    slots.push({\n        start: start.valueOf(),\n        end: start.valueOf() * 10,\n    });\n    return slots;\n}\n\n/**\n * Get the next free time slot from the given bookings\n * @param list List of bookings to find the next slot\n * @param date Date to find next slot after in ms since UTC epoch\n * @param min_size Minimum length of the free slot in minutes\n */\nexport function getNextFreeTimeSlot(\n    list: TimePeriod[],\n    date: number = new Date().valueOf(),\n    min_size: number = 30\n): TimeBlock {\n    const slots = getFreeTimeSlots(list, min_size);\n    const time = addSeconds(startOfMinute(date), 1);\n    for (const block of slots) {\n        if (isAfter(block.start, time)) {\n            return block;\n        } else if (isBefore(time, block.end)) {\n            const duration = differenceInMinutes(block.end, time);\n            if (duration >= min_size) return block;\n        }\n    }\n    return slots[slots.length - 1];\n}\n\nconst MINUTE = 1;\nconst HOUR = 60;\nconst DAY = 24 * HOUR;\nconst WEEK = 7 * DAY;\nconst MONTH = 30 * DAY;\n\nconst DURATION_MAP: { [duration: string]: number } = {\n    month: MONTH,\n    months: MONTH,\n    week: WEEK,\n    weeks: WEEK,\n    day: DAY,\n    days: DAY,\n    hour: HOUR,\n    hours: HOUR,\n    minute: MINUTE,\n    minutes: MINUTE,\n};\n\nconst DEFAULT_RULES: BookingRules = {\n    auto_approve: true,\n    hidden: false,\n};\n\n/**\n * Conver time string into minutes\n * @param str timestring e.g. `'1 day'`, `'15 minutes'`, `'2 weeks'`\n */\nexport function stringToMinutes(str: string): number {\n    const parts = (str || '').split(' ');\n    return parts.length > 1 ? +parts[0] * DURATION_MAP[parts[1]] : 0;\n}\n\nexport function addToDate(add: string, date: Date | number = new Date()) {\n    return addMinutes(date, stringToMinutes(add));\n}\n\nexport function filterSpacesFromRules(\n    spaces: Space[],\n    details: BookingRuleDetails,\n    rulemap: BookingRulesmap\n) {\n    return spaces.filter(\n        (_) => !rulesForSpace({ ...details, space: _ }, rulemap)?.hidden\n    );\n}\n\nexport function rulesForSpace(\n    details: BookingRuleDetails,\n    rulemap: BookingRulesmap\n): BookingRules {\n    const { space } = details;\n    for (const zone of space.zones) {\n        if (rulemap[zone]?.length) {\n            for (const ruleset of rulemap[zone]) {\n                if (ruleset && checkRulesMatch(details, ruleset))\n                    return { ...DEFAULT_RULES, ...ruleset.rules };\n            }\n        }\n    }\n    return DEFAULT_RULES;\n}\n\nexport function checkRulesMatch(\n    { date, duration, host }: BookingRuleDetails,\n    ruleset: BookingRuleset\n): boolean {\n    let matches = 0;\n    const { conditions } = ruleset;\n    if (!conditions) return true;\n    if (\n        conditions.groups instanceof Array &&\n        conditions.groups.every((_) => host?.groups?.includes(_))\n    )\n        matches += 1;\n    if (\n        conditions.is_before &&\n        isBefore(addMinutes(date, duration), addToDate(conditions.is_before))\n    )\n        matches += 1;\n    if (conditions.is_after && isAfter(date, addToDate(conditions.is_after)))\n        matches += 1;\n    if (\n        conditions.min_length &&\n        stringToMinutes(conditions.min_length) <= duration\n    )\n        matches += 1;\n    if (\n        conditions.max_length &&\n        stringToMinutes(conditions.max_length) >= duration\n    )\n        matches += 1;\n    return matches >= Object.keys(conditions).length;\n}\n","import { FormGroup, FormControl, Validators } from '@angular/forms';\nimport {\n    add,\n    formatDuration,\n    differenceInMinutes,\n    getTime,\n    isSameDay,\n    format,\n    startOfMinute,\n    setHours,\n    setMinutes,\n    addMinutes,\n} from 'date-fns';\nimport { currentUser, timePeriodsIntersect, unique } from '@placeos/common';\n\nimport { CalendarEvent } from './event.class';\nimport { endInFuture } from './validators';\nimport { getNextFreeTimeSlot } from './helpers';\nimport { User } from 'libs/users/src/lib/user.class';\nimport { Booking } from 'libs/bookings/src/lib/booking.class';\n\nlet BOOKING_DATE = add(setMinutes(setHours(new Date(), 6), 0), { days: -1 });\n\nexport function generateEventForm(event: CalendarEvent = new CalendarEvent()) {\n    if (!event) event = new CalendarEvent();\n    const form = new FormGroup({\n        id: new FormControl(event.id),\n        host: new FormControl(\n            event.host || event.organiser?.email || currentUser()?.email || '',\n            [Validators.required]\n        ),\n        organiser: new FormControl(\n            event.organiser || new User({ email: event.host || '' })\n        ),\n        creator: new FormControl(event.creator, [Validators.required]),\n        calendar: new FormControl(event.calendar),\n        attendees: new FormControl(event.attendees || []),\n        resources: new FormControl(event.resources || []),\n        title: new FormControl(event.title, [Validators.required]),\n        body: new FormControl(event.body),\n        private: new FormControl(event.private),\n        date: new FormControl(event.date, [Validators.required]),\n        duration: new FormControl(event.duration, [endInFuture]),\n        all_day: new FormControl(event.all_day),\n        recurring: new FormControl(event.recurring),\n        recurrence: new FormControl(event.recurrence),\n        recurring_master_id: new FormControl(event.recurring_master_id),\n        master: new FormControl(event.master),\n        attachments: new FormControl(event.attachments),\n        catering: new FormControl(event.extension_data?.catering || []),\n        assets: new FormControl(event.extension_data?.assets || []),\n        // has_catering: new FormControl(event.has_catering || false),\n        visitor_type: new FormControl(event.extension_data?.visitor_type),\n        location: new FormControl(event.location),\n        needs_space: new FormControl(true),\n        needs_parking: new FormControl(\n            event.extension_data?.needs_parking || false\n        ),\n        system: new FormControl<any>(event.system),\n    });\n    form.get('organiser').valueChanges.subscribe((o) =>\n        form.controls.host.setValue(o?.email)\n    );\n    form.get('resources').valueChanges.subscribe((l) =>\n        form.controls.system.setValue(l?.length ? (l[0] as any) : null)\n    );\n    form.controls.all_day.valueChanges.subscribe((all_day) => {\n        if (all_day) form.controls.duration.disable();\n        else form.controls.duration.enable();\n    });\n    if (event.id) {\n        form.get('host').disable();\n        form.get('organiser').disable();\n    }\n    if (event.state === 'started') form.get('date').disable();\n    return form;\n}\n\n/**\n * Set the initial time used for generating mock bookings\n * @param time New initial time as ms from UTC epoch\n */\nexport function setMockBookingStartDatetime(time: number) {\n    BOOKING_DATE = startOfMinute(new Date(time));\n}\n\n/**\n * Get current status within bookings\n * @param bookings List of bookings\n * @param host Host of the new event\n * @param date Datetime of the new event\n */\nexport function statusFromBookings(\n    bookings: CalendarEvent[],\n    bookable: boolean,\n    requestable: boolean,\n    date: number = getTime(new Date())\n) {\n    const now = new Date(date);\n    const next_free_slot = getNextFreeTimeSlot(bookings, date, 5);\n    const start = new Date(next_free_slot.start);\n    const end = new Date(next_free_slot.end);\n    const currently_free = timePeriodsIntersect(\n        date,\n        date,\n        next_free_slot.start,\n        next_free_slot.end\n    );\n    const time_until_next_block = formatDuration({\n        minutes: currently_free\n            ? differenceInMinutes(end, now)\n            : differenceInMinutes(start, now),\n    });\n    const free_tomorrow = !currently_free && !isSameDay(start, now);\n    const free_today = currently_free && !isSameDay(end, now);\n    return {\n        status: !bookable\n            ? 'Not Bookable'\n            : currently_free\n            ? requestable\n                ? 'Available by Request'\n                : 'Available'\n            : 'Meeting in Progress',\n        available_until: free_today\n            ? 'No meetings today'\n            : currently_free\n            ? `Free until ${format(end, 'h:mm B')}(${time_until_next_block})`\n            : free_tomorrow\n            ? 'Unavailable today'\n            : `Free at ${format(start, 'h:mm B')}(${time_until_next_block})`,\n    };\n}\n\nexport function replaceBookings(\n    list: CalendarEvent[],\n    new_bookings: CalendarEvent[],\n    filter_options: { space: string; from: number; to: number }\n) {\n    const from = filter_options.from;\n    const to = filter_options.to;\n    const filtered_list = list.filter((booking) => {\n        const start = new Date(booking.date);\n        const end = addMinutes(start, booking.duration);\n        return (\n            !booking.resources.find(\n                (space) => space.email === filter_options.space\n            ) || !timePeriodsIntersect(from, to, start.valueOf(), end.valueOf())\n        );\n    });\n    const updated_list = filtered_list.concat(new_bookings);\n    updated_list.sort((a, b) => a.date - b.date);\n    return unique(updated_list, 'id');\n}\n\nexport function newCalendarEventFromBooking(booking: Booking) {\n    let attendees = [{ id: booking.user_id, name: booking.user_name, email: booking.user_email, organizer: true }];\n    if (booking.booking_type === 'visitor') {\n        attendees.push(new User({ name: booking.asset_name || booking.description, email: booking.asset_id }));\n    }\n    attendees = attendees.concat(booking.attendees);\n    return new CalendarEvent({\n        ...booking,\n        ...booking.extension_data,\n        attendees,\n        id: booking.id || booking.extension_data.id,\n        host: booking.user_email,\n        from_booking: true\n    } as any);\n}\n","import { AbstractControl } from '@angular/forms';\nimport { addMinutes, isAfter, isBefore } from 'date-fns';\n\nexport const endInFuture = (control: AbstractControl) => {\n    if (\n        control.parent?.get('date') &&\n        isAfter(\n            new Date(),\n            addMinutes(control.parent.get('date').value, control.value)\n        )\n    ) {\n        return { duration: true };\n    }\n    return null;\n};\n\n/** Check that date in unix ms is in the future */\nexport function isFuture(\n    control: AbstractControl\n): { [key: string]: boolean } | null {\n    return control.value && isBefore(control.value, new Date())\n        ? { is_future: true }\n        : null;\n}\n","export * from './lib/form-fields.module';\n\nexport * from './lib/action-field.component';\nexport * from './lib/counter.component';\nexport * from './lib/date-field.component';\nexport * from './lib/duration-field.component';\nexport * from './lib/time-field.component';\nexport * from './lib/user-list-field.component';\nexport * from './lib/user-search-field.component';","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n    selector: 'an-action-field',\n    template: `\n        <div\n            class=\"flex items-center rounded p-2 border border-gray-300 hover:border-black\"\n            role=\"button\"\n            [attr.disabled]=\"disabled\"\n            [attr.name]=\"name\"\n            form-field\n            tabindex=\"0\"\n            (keydown.enter)=\"performAction()\"\n        >\n            <div\n                placeholder\n                class=\"flex-1 w-0 truncate\"\n                (click)=\"performAction()\"\n            >\n                <ng-content></ng-content>\n            </div>\n            <app-icon class=\"text-xl\" (click)=\"performAction()\">\n                arrow_drop_{{ show_tooltip ? 'up' : 'down' }}\n            </app-icon>\n        </div>\n    `,\n    styles: [\n        `\n            :host > div:hover {\n                box-shadow: inset 0 0 0 1px #000;\n            }\n        `,\n    ],\n})\nexport class ActionFieldComponent {\n    /** Name of the field */\n    @Input() public name: string;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Emitter for user interaction events */\n    @Output('onAction') public on_action = new EventEmitter();\n    /** Whether to show tooltip */\n    public show_tooltip = false;\n\n    /**\n     * Emit that the user has performed an action on the field\n     */\n    public performAction() {\n        this.show_tooltip = !this.show_tooltip;\n        this.on_action.emit();\n    }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\n\nimport { AssetSelectModalComponent } from 'libs/assets/src/lib/asset-select-modal/asset-select-modal.component';\nimport { Asset } from 'libs/assets/src/lib/asset.class';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: `asset-list-field`,\n    template: `\n        <div list class=\"space-y-2\">\n            <div\n                space\n                class=\"relative p-2 rounded-lg w-full flex items-center shadow border border-gray-200\"\n                *ngFor=\"let asset of items\"\n            >\n                <div class=\"w-16 h-16 rounded-xl bg-black/20 mr-4\"></div>\n                <div class=\"pb-4\">\n                    <div class=\"font-medium\">\n                        {{ asset.name || 'Asset' }}\n                    </div>\n                    <div>{{ asset.amount }} requested</div>\n                    <div\n                        class=\"absolute bottom-0 right-0 flex items-center justify-end text-xs\"\n                    >\n                        <button\n                            mat-button\n                            edit-space\n                            class=\"clear\"\n                            (click)=\"addAssets(asset)\"\n                        >\n                            <div class=\"flex items-center space-x-2\">\n                                <app-icon>edit</app-icon>\n                                Change\n                            </div>\n                        </button>\n                        <button\n                            mat-button\n                            remove-space\n                            class=\"clear\"\n                            (click)=\"removeAsset(asset)\"\n                        >\n                            <div class=\"flex items-center space-x-2\">\n                                <app-icon>close</app-icon>\n                                Remove\n                            </div>\n                        </button>\n                    </div>\n                </div>\n                <button\n                    mat-icon-button\n                    fav\n                    class=\"absolute top-1 right-1\"\n                    [class.text-blue-400]=\"favorites.includes(asset.id)\"\n                    (click)=\"toggleFavourite(asset)\"\n                >\n                    <app-icon>{{\n                        favorites.includes(asset.id)\n                            ? 'favorite'\n                            : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </div>\n        </div>\n        <button\n            mat-button\n            add-space\n            class=\"w-full inverse mt-2\"\n            (click)=\"addAssets()\"\n        >\n            <div class=\"flex items-center justify-center space-x-2\">\n                <app-icon>search</app-icon>\n                <span>Add Asset</span>\n            </div>\n        </button>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => AssetListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class AssetListFieldComponent implements ControlValueAccessor {\n    public items: Asset[] = [];\n    public disabled = false;\n\n    private _onChange: (_: Asset[]) => void;\n    private _onTouch: (_: Asset[]) => void;\n    public selected: Asset[] = [];\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_assets') || EMPTY_FAVS;\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {}\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: Asset[]) {\n        this.items = new_value;\n        if (this._onChange) this._onChange(this.items);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: Asset[]) {\n        this.items = value || [];\n    }\n\n    public readonly registerOnChange = (fn: (_: Asset[]) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: Asset[]) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n\n    public removeAsset(asset: Asset) {\n        const updated_list = this.items.filter((_) => _.id !== asset.id);\n        this.setValue(updated_list);\n    }\n\n    public addAssets(asset?: Asset) {\n        const ref = this._dialog.open(AssetSelectModalComponent, {\n            data: this.items,\n        });\n        ref.afterClosed().subscribe((assets?: Asset[]) => {\n            if (!assets) return;\n            this.setValue(assets);\n        });\n    }\n\n    public toggleFavourite(asset: Asset) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(asset.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_assets', [\n                ...fav_list,\n                asset.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_assets',\n                fav_list.filter((_) => _ !== asset.id)\n            );\n        }\n    }\n}\n","import { Component, forwardRef, Input } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\n\n@Component({\n    selector: 'a-counter',\n    template: `\n        <div\n            counter\n            class=\"flex items-center text-base\"\n            (window:keydown.shift)=\"shift_key = true\"\n            (window:keydown.control)=\"ctrl_key = true\"\n            (window:keydown.meta)=\"ctrl_key = true\"\n            (window:keyup.shift)=\"shift_key = false\"\n            (window:keyup.control)=\"ctrl_key = false\"\n            (window:keyup.meta)=\"ctrl_key = false\"\n        >\n            <button\n                mat-icon-button\n                name=\"remove\"\n                type=\"button\"\n                [disabled]=\"!value || value === min\"\n                (click)=\"remove()\"\n            >\n                <app-icon>remove</app-icon>\n            </button>\n            <div value class=\"p-1 text-center\">{{ (render_fn ? render_fn(value) : value) || '0' }}</div>\n            <button\n                mat-icon-button\n                name=\"add\"\n                type=\"button\"\n                [disabled]=\"value === max\"\n                (click)=\"add()\"\n            >\n                <app-icon>add</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            [value] {\n                min-width: 3em;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => CounterComponent),\n            multi: true,\n        },\n    ],\n})\nexport class CounterComponent implements ControlValueAccessor {\n    /** Size of a single step */\n    @Input() public step = 1;\n    /** Maximum amount for the counter */\n    @Input() public max = 10;\n    /** Minimum amount for the counter */\n    @Input() public min = 0;\n    /** Custom function for rendering the counter value */\n    @Input() public render_fn: (v: number) => string;\n    /** Current value of the counter */\n    public value: number;\n    /** Whether shift key is being held by the user */\n    public shift_key: boolean;\n    /** Whether control key is being held by the user */\n    public ctrl_key: boolean;\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /**\n     * Add the `step` to the current value\n     */\n    public add() {\n        if (!this.value) {\n            this.value = this.min || 0;\n        }\n        const step = this.ctrl_key ? 100 * this.step : this.shift_key ? 10 * this.step : this.step || 1;\n        this.value += step;\n        if (this.value > this.max) {\n            this.value = this.max || 10;\n        }\n        this.setValue(this.value);\n    }\n\n    /** Remove the `step` from the current value */\n    public remove() {\n        if (!this.value) {\n            this.value = this.min || 0;\n        }\n        const step = this.ctrl_key ? 100 * this.step : this.shift_key ? 10 * this.step : this.step || 1;\n        this.value -= step;\n        if (this.value < this.min) {\n            this.value = this.min || 0;\n        }\n        this.setValue(this.value);\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number): void {\n        this.value = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.value = value;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n}\n","import {\n    Component,\n    forwardRef,\n    Injectable,\n    Input,\n    OnInit,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport {\n    DateAdapter,\n    MatDateFormats,\n    MAT_DATE_FORMATS,\n    NativeDateAdapter,\n} from '@angular/material/core';\nimport {\n    addYears,\n    endOfDay,\n    format,\n    formatISO,\n    set,\n    startOfDay,\n} from 'date-fns';\nimport { BaseClass } from 'libs/common/src/lib/base.class';\nimport { HashMap } from 'libs/common/src/lib/types';\n\n@Injectable()\nclass FieldDateAdapter extends NativeDateAdapter {\n    format(date: Date, displayFormat: HashMap | string): string {\n        if (displayFormat === 'input') {\n            return format(date, 'MMMM d, yyyy');\n        }\n        return format(date, 'MMM yyyy');\n    }\n}\nconst FIELD_DATE_FORMATS: MatDateFormats = {\n    parse: {\n        dateInput: 'LL',\n    },\n    display: {\n        dateInput: 'input',\n        monthYearLabel: 'MMM YYYY',\n        dateA11yLabel: 'LL',\n        monthYearA11yLabel: 'MMMM YYYY',\n    },\n};\n\n@Component({\n    selector: 'a-date-field',\n    template: `\n        <mat-form-field appearance=\"outline\" (click)=\"picker.open()\">\n            <input\n                matInput\n                [ngModel]=\"date\"\n                [disabled]=\"disabled\"\n                [min]=\"from\"\n                [max]=\"until\"\n                (ngModelChange)=\"setValue($event)\"\n                [matDatepicker]=\"picker\"\n            />\n            <mat-datepicker-toggle\n                matSuffix\n                [for]=\"picker\"\n            ></mat-datepicker-toggle>\n            <mat-datepicker #picker></mat-datepicker>\n            <mat-error><ng-content></ng-content></mat-error>\n        </mat-form-field>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        { provide: DateAdapter, useClass: FieldDateAdapter },\n        { provide: MAT_DATE_FORMATS, useValue: FIELD_DATE_FORMATS },\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DateFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DateFieldComponent\n    extends BaseClass\n    implements OnInit, ControlValueAccessor\n{\n    /** Earliest date available the user is allowed to pick */\n    @Input('from') public _from: number = new Date().valueOf();\n    /** Latest date available the user is allowed to pick */\n    @Input('to') public _to: number;\n    /** Position of the tooltip */\n    @Input() public position: 'right' | 'left' = 'right';\n    /** Offset of the tooltip */\n    @Input() public offset: 'top' | 'bottom' = 'bottom';\n    /** Whether form control is disabled */\n    @Input() public disabled: boolean;\n    /** Whether to show the calendar tooltip */\n    public show_tooltip: boolean;\n    /** Currently selected date */\n    public date: string;\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /** First allowed date on the calendar */\n    public get from(): Date {\n        return new Date(this._from) || startOfDay(new Date());\n    }\n    /** Current date value */\n    public get until(): Date {\n        return new Date(this._to) || addYears(endOfDay(new Date()), 1);\n    }\n    /** Display value for the current date */\n    public get date_string(): string {\n        return format(new Date(this.date), 'DD MMM YYYY');\n    }\n\n    public ngOnInit() {\n        this.date = new Date().toISOString();\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number) {\n        // Keep hours and minutes of the old date\n        const old_date = new Date(this.date);\n        let new_date = set(new_value, {\n            hours: old_date.getHours(),\n            minutes: old_date.getMinutes(),\n        }).valueOf();\n        // Check that new date is before from\n        if (new_date < this.from.valueOf()) {\n            new_date = this.from.valueOf();\n        }\n        this.date = formatISO(new_date || new Date());\n        if (this._onChange) {\n            this._onChange(new_date);\n        }\n        this.show_tooltip = false;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.date = formatISO(value || new Date());\n        this.show_tooltip = false;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n}\n","import { Component, forwardRef, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { formatDuration } from 'date-fns';\n\nimport * as dayjs from 'dayjs';\n\n\n\n@Component({\n    selector: 'a-duration-field',\n    template: `\n        <div class=\"duration-field\" [attr.disabled]=\"disabled\">\n            <mat-form-field appearance=\"outline\">\n                <mat-select\n                    #select\n                    [value]=\"duration\"\n                    [disabled]=\"disabled\"\n                    [placeholder]=\"duration + ' minutes'\"\n                    (valueChange)=\"setValue($event)\"\n                >\n                    <mat-option *ngFor=\"let option of duration_options\" [value]=\"option.id\">\n                        {{ option.name }}\n                    </mat-option>\n                </mat-select>\n                <mat-error><ng-content></ng-content></mat-error>\n            </mat-form-field>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DurationFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DurationFieldComponent implements OnInit, OnChanges, ControlValueAccessor {\n    /** Maximum duration option available */\n    @Input() public max = 240;\n    /** Minimum duration option available */\n    @Input() public min = 30;\n    /** Step value between options */\n    @Input() public step = 15;\n    /** Reference time for displaying next to durations */\n    @Input() public time: number;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Special case prepopulation i.e. out of step options */\n    @Input() public custom_options: number[] = [];\n\n    public duration = 60;\n    /** List of available duration options */\n    public duration_options: { id: number, name: string }[];\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    public ngOnInit(): void {\n        this.duration_options = this.generateDurationOptions(this.max, this.min, this.step);\n        this._updateOption();\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        /* istanbul ignore else */\n        if (changes.max || changes.min || changes.step || changes.time) {\n            this.duration_options = this.generateDurationOptions(this.max, this.min, this.step);\n            this._updateOption();\n        }\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number): void {\n        this.duration = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(+new_value);\n        }\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.duration = value;\n        this._updateOption();\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    private generateDurationOptions(max: number, min: number, step: number) {\n        const blocks: { id: number, name: string }[] = [];\n        let time = min;\n        const date = this.time ? dayjs(this.time) : null;\n\n        // Add special cases\n        for (const option of this.custom_options) {\n            blocks.push({\n                id: option,\n                name: date\n                    ? `${date.add(option, 'm').format('h:mm A')} (${formatDuration({\n                          hours: Math.floor(option / 60),\n                          minutes: option % 60,\n                      })})`\n                    : `${formatDuration({ hours: Math.floor(option / 60), minutes: option % 60 })}`,\n            });\n        }\n\n        while (time <= max) {\n            blocks.push({\n                id: time,\n                name: date\n                    ? `${date.add(time, 'm').format('h:mm A')} (${formatDuration({\n                          hours: Math.floor(time / 60),\n                          minutes: time % 60,\n                      })})`\n                    : `${formatDuration({ hours: Math.floor(time / 60), minutes: time % 60 })}`,\n            });\n            time += step;\n        }\n        return blocks;\n    }\n\n    private _updateOption() {\n        if (!this.duration_options?.length) return;\n        const idx = this.duration_options.findIndex((_) => _.id === this.duration);\n        if (idx < 0) this.setValue(this.min);\n    }\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatRadioModule } from '@angular/material/radio';\n\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\n\nimport { ActionFieldComponent } from './action-field.component';\nimport { CounterComponent } from './counter.component';\nimport { DateFieldComponent } from './date-field.component';\nimport { DurationFieldComponent } from './duration-field.component';\nimport { TimeFieldComponent } from './time-field.component';\nimport { UserListFieldComponent } from './user-list-field.component';\nimport { UserSearchFieldComponent } from './user-search-field.component';\nimport { ItemListFieldComponent } from './item-list-field.component';\nimport { UploadListFieldComponent } from './upload-list-field.component';\nimport { UploadFileFieldComponent } from './upload-file-field.component';\nimport { AssetListFieldComponent } from './asset-list-field.component';\nimport { SpaceListFieldComponent } from './space-list-field.component';\nimport { RichTextInputComponent } from './rich-text-input.component';\nimport { HostSelectFieldComponent } from './host-select-field.component';\n\nconst COMPONENTS: Type<any>[] = [\n    ActionFieldComponent,\n    CounterComponent,\n    DateFieldComponent,\n    DurationFieldComponent,\n    TimeFieldComponent,\n    UserListFieldComponent,\n    UserSearchFieldComponent,\n    ItemListFieldComponent,\n    UploadListFieldComponent,\n    UploadFileFieldComponent,\n    AssetListFieldComponent,\n    SpaceListFieldComponent,\n    RichTextInputComponent,\n    HostSelectFieldComponent\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        MatAutocompleteModule,\n        MatTooltipModule,\n        MatCheckboxModule,\n        MatRadioModule,\n        ComponentsModule,\n    ],\n    exports: [...COMPONENTS],\n})\nexport class FormFieldsModule {}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { currentUser, unique } from '@placeos/common';\nimport { showStaff } from 'libs/users/src/lib/staff.fn';\nimport { User } from 'libs/users/src/lib/user.class';\nimport { Calendar } from 'libs/calendar/src/lib/calendar.class';\nimport { queryCalendars } from 'libs/calendar/src/lib/calendar.fn';\nimport { of, zip } from 'rxjs';\nimport { catchError, map, shareReplay, switchMap, tap } from 'rxjs/operators';\n\n@Component({\n    selector: 'host-select-field',\n    template: `\n        <mat-form-field appearance=\"outline\" class=\"w-full\">\n            <mat-select\n                [ngModel]=\"this.item\"\n                (ngModelChange)=\"setValue($event)\"\n                [disabled]=\"disabled\"\n                placeholder=\"Select host\"\n            >\n                <mat-option\n                    *ngFor=\"let user of users | async\"\n                    [value]=\"user\"\n                    class=\"leading-tight\"\n                >\n                    <div class=\"flex flex-col\">\n                        <div>{{ user.name }}</div>\n                        <span class=\"hidden\">&nbsp;|&nbsp;</span>\n                        <div class=\"text-xs opacity-60\">{{ user.email }}</div>\n                    </div>\n                </mat-option>\n            </mat-select>\n            <mat-error>Host is required</mat-error>\n        </mat-form-field>\n        <ng-container *ngIf=\"users | async\"></ng-container>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => HostSelectFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class HostSelectFieldComponent implements ControlValueAccessor {\n    public item?: User;\n    public readonly users = of(1).pipe(\n        switchMap(() =>\n            queryCalendars().pipe(catchError((_) => of([] as Calendar[])))\n        ),\n        switchMap((list) =>\n            zip(\n                ...list.map((_) =>\n                    showStaff(_.id).pipe(catchError((_) => of(null)))\n                )\n            )\n        ),\n        map((_) => unique([currentUser(), ..._], 'email')),\n        shareReplay(1)\n    );\n    public disabled = false;\n\n    private _onChange: (_: User) => void;\n    private _onTouch: (_: User) => void;\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User) {\n        this.item = new_value;\n        if (this._onChange) this._onChange(this.item);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User) {\n        this.item = value;\n        if (!value?.email) {\n            this.item = currentUser();\n        }\n    }\n\n    public readonly registerOnChange = (fn: (_: User) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: User) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n}\n","import { Component, forwardRef, Input } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { FormControl } from '@angular/forms';\nimport { MatChipInputEvent } from '@angular/material/chips';\nimport { COMMA, ENTER, SPACE } from '@angular/cdk/keycodes';\n\n/**\n * Add a tag to the list of tags for the item\n * @param event Input event\n */\nexport function addChipItem<T = string>(\n    control: FormControl<T[]>,\n    event: MatChipInputEvent\n): void {\n    if (!control) return;\n    const input = event.input;\n    const value = event.value as any;\n    const item_list = control.value;\n    if ((value || '').trim()) {\n        item_list.push(value);\n        control.setValue(item_list);\n    }\n\n    // Reset the input value\n    if (input) {\n        input.value = '';\n    }\n}\n\n/**\n * Remove tag from the list\n * @param existing_tag Tag to remove\n */\nexport function removeChipItem<T = string>(\n    control: FormControl<T[]>,\n    item: T\n): void {\n    if (!control) {\n        return;\n    }\n    const item_list = control.value;\n    const index = item_list.indexOf(item);\n\n    if (index >= 0) {\n        item_list.splice(index, 1);\n        control.setValue(item_list);\n    }\n}\n\n@Component({\n    selector: 'item-list-field',\n    template: `\n        <mat-form-field appearance=\"outline\" class=\"w-full\">\n            <mat-chip-list #chipList aria-label=\"Zone Tags\">\n                <mat-chip\n                    *ngFor=\"let item of value\"\n                    [selectable]=\"true\"\n                    [removable]=\"true\"\n                    (removed)=\"remove(item)\"\n                >\n                    {{ item }}\n                    <app-icon matChipRemove>close</app-icon>\n                </mat-chip>\n                <input\n                    [placeholder]=\"placeholder || 'User groups...'\"\n                    i18n-placeholder=\"@@userGroupsPlaceholder\"\n                    [matChipInputFor]=\"chipList\"\n                    [matChipInputSeparatorKeyCodes]=\"separators\"\n                    [matChipInputAddOnBlur]=\"true\"\n                    (matChipInputTokenEnd)=\"add($event)\"\n                />\n            </mat-chip-list>\n        </mat-form-field>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => ItemListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class ItemListFieldComponent<T = any> implements ControlValueAccessor {\n    @Input() public separators: number[] = [ENTER, COMMA, SPACE];\n\n    @Input() public placeholder = '';\n    /** List of items stored */\n    public value: T[] = [];\n\n    /** Form control on change handler */\n    private _onChange: (_: T[]) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: T[]) => void;\n\n    /**\n     * Add the `step` to the current value\n     */\n    public readonly add = (e: MatChipInputEvent) =>\n        addChipItem(\n            { value: this.value, setValue: (i) => this.setValue(i) } as any,\n            e\n        );\n\n    /** Remove the `step` from the current value */\n    public readonly remove = (item: T) =>\n        removeChipItem(\n            { value: this.value, setValue: (i) => this.setValue(i) } as any,\n            item\n        );\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: T[]): void {\n        this.value = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: T[]) {\n        this.value = value;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: T[]) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: T[]) => void): void {\n        this._onTouch = fn;\n    }\n}\n","import { AfterViewInit, Component, ElementRef, forwardRef, Input, OnChanges, SimpleChanges, ViewChild } from \"@angular/core\";\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from \"@angular/forms\";\nimport { BaseClass } from \"@placeos/common\";\nimport * as Quill from 'quill';\n\n@Component({\n    selector: 'rich-text-input',\n    template: `\n        <div #container>\n            <div #editor></div>\n        </div>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => RichTextInputComponent),\n            multi: true,\n        },\n    ],\n})\nexport class RichTextInputComponent extends BaseClass implements ControlValueAccessor, OnChanges, AfterViewInit {\n    @Input() public placeholder = '';\n    @Input() public readonly = false;\n\n    @ViewChild('container') private _container_el: ElementRef<HTMLDivElement>;\n    @ViewChild('editor') private _editor_el: ElementRef<HTMLDivElement>;\n\n    private _editor: any;\n    private _updateFn = () => this.setValue(this._editor.root.innerHTML);\n\n\n    private _onChange: (_: string) => void; /** Form control on change handler */\n    private _onTouch: (_: string) => void; /** Form control on touched handler */\n    \n    public readonly registerOnChange = (fn: (_: string) => void) => this._onChange = fn;\n    public readonly registerOnTouched = (fn: (_: string) => void) => this._onTouch = fn;\n\n    public ngOnChanges(changes: SimpleChanges) {\n\n    }\n\n    public ngAfterViewInit() {\n        this._initialiseEditor();\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: string): void {\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: string) {\n        if (this._editor) {\n            const delta = this._editor.clipboard.convert(value);\n            this._editor.setContents(delta, 'silent');\n        } else {\n            this.timeout('write', () => this.writeValue(value));\n        }\n    }\n\n    private _initialiseEditor() {\n        this._editor = new Quill(this._editor_el.nativeElement, {\n            bounds: this._container_el.nativeElement,\n            placeholder: this.placeholder,\n            readOnly: this.readonly,\n            theme: 'snow'\n        });\n        this._editor.on('text-change', this._updateFn);\n        this.subscription('changes', () => this._editor.off('text-change', this._updateFn));\n    }\n    \n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { NewSpaceSelectModalComponent } from 'libs/spaces/src/lib/space-select-modal/new-space-select-modal.component';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: `space-list-field`,\n    template: `\n        <div>\n            <div class=\"flex items-center flex-wrap sm:space-x-2 mb-2\">\n                <div class=\"flex-1 min-w-[256px] space-y-2\">\n                    <label>Select Room Size<span>*</span></label>\n                    <div class=\"flex items-center\">\n                        <mat-radio-group\n                            aria-label=\"Select Room Size\"\n                            class=\"space-x-4\"\n                            [(ngModel)]=\"room_size\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        >\n                            <mat-radio-button [value]=\"1\">\n                                1-2 People\n                            </mat-radio-button>\n                            <mat-radio-button [value]=\"3\">\n                                3-9 People\n                            </mat-radio-button>\n                            <mat-radio-button [value]=\"10\">\n                                10+ People\n                            </mat-radio-button>\n                        </mat-radio-group>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div list class=\"space-y-2\">\n            <div\n                space\n                class=\"relative p-2 rounded-lg w-full flex items-center shadow border border-gray-200\"\n                *ngFor=\"let space of spaces\"\n            >\n                <div class=\"w-24 h-24 rounded-xl bg-black/20 mr-4 overflow-hidden\">\n                    <img *ngIf=\"space.images?.length\" [src]=\"space.images[0]\" class=\"min-h-full object-cover\" />\n                </div>\n                <div class=\"space-y-2 pb-4\">\n                    <div class=\"font-medium\">\n                        {{ space.display_name || space.name || 'Meeting Space' }}\n                    </div>\n                    <div class=\"flex items-center text-sm space-x-2\">\n                        <app-icon class=\"text-blue-500\">place</app-icon>\n                        <p>{{ space.location }}</p>\n                    </div>\n                    <div class=\"flex items-center text-sm space-x-2\">\n                        <app-icon class=\"text-blue-500\">people</app-icon>\n                        <p>\n                            {{ space.capacity < 1 ? 2 : space.capacity }} People\n                        </p>\n                    </div>\n                    <div\n                        class=\"absolute bottom-0 right-0 flex items-center justify-end text-xs\"\n                    >\n                        <button\n                            mat-button\n                            edit-space\n                            class=\"clear\"\n                            (click)=\"changeSpaces(space)\"\n                        >\n                            <div class=\"flex items-center space-x-2\">\n                                <app-icon>edit</app-icon>\n                                Change\n                            </div>\n                        </button>\n                        <button\n                            mat-button\n                            remove-space\n                            class=\"clear\"\n                            (click)=\"removeSpace(space)\"\n                        >\n                            <div class=\"flex items-center space-x-2\">\n                                <app-icon>close</app-icon>\n                                Remove\n                            </div>\n                        </button>\n                    </div>\n                </div>\n                <button\n                    mat-icon-button\n                    fav\n                    class=\"absolute top-1 right-1\"\n                    [class.text-blue-400]=\"favorites.includes(asset?.id)\"\n                    (click)=\"toggleFavourite(asset)\"\n                >\n                    <app-icon>{{\n                        favorites.includes(asset?.id)\n                            ? 'favorite'\n                            : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </div>\n        </div>\n        <button\n            mat-button\n            add-space\n            class=\"w-full inverse mt-2\"\n            (click)=\"changeSpaces()\"\n        >\n            <div class=\"flex items-center justify-center space-x-2\">\n                <app-icon>search</app-icon>\n                <span>Add Space</span>\n            </div>\n        </button>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => SpaceListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class SpaceListFieldComponent implements ControlValueAccessor {\n    public room_size = 3;\n    public spaces: Space[] = [];\n    public disabled = false;\n\n    private _onChange: (_: Space[]) => void;\n    private _onTouch: (_: Space[]) => void;\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_spaces') || EMPTY_FAVS;\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {}\n\n    /** Add or edit selected spaces */\n    public changeSpaces() {\n        const ref = this._dialog.open(NewSpaceSelectModalComponent, {\n            data: { spaces: this.spaces, options: { capacity: this.room_size } },\n        });\n        ref.afterClosed().subscribe((spaces?: Space[]) => {\n            if (!spaces) spaces = ref.componentInstance.selected;\n            this.setValue(spaces);\n        });\n    }\n\n    /** Remove the selected space from the list */\n    public removeSpace(space: Space) {\n        this.setValue(this.spaces.filter((_) => _.id !== space.id));\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: Space[]) {\n        this.spaces = new_value;\n        if (this._onChange) this._onChange(this.spaces);\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: Space[]) {\n        this.spaces = value || [];\n    }\n\n    /* istanbul ignore next */\n    public readonly registerOnChange = (fn: (_: Space[]) => void) =>\n        (this._onChange = fn);\n    /* istanbul ignore next */\n    public readonly registerOnTouched = (fn: (_: Space[]) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n\n    public toggleFavourite(space: Space) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(space.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_spaces', [\n                ...fav_list,\n                space.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_spaces',\n                fav_list.filter((_) => _ !== space.id)\n            );\n        }\n    }\n}\n","import {\n    Component,\n    forwardRef,\n    Input,\n    OnChanges,\n    OnInit,\n    SimpleChanges,\n    ViewChild\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatSelect } from '@angular/material/select';\nimport { BaseClass, Identity, timeFormatString } from '@placeos/common';\nimport {\n    addMinutes,\n    endOfDay,\n    format,\n    isAfter,\n    isSameDay,\n    roundToNearestMinutes,\n    set,\n    startOfDay,\n    startOfMinute\n} from 'date-fns';\n\n@Component({\n    selector: 'a-time-field',\n    template: `\n        <mat-form-field\n            appearance=\"outline\"\n            [style.display]=\"show_select ? 'none' : ''\"\n            (keydown.enter)=\"showSelect()\"\n        >\n            <input\n                matInput\n                type=\"time\"\n                [disabled]=\"disabled\"\n                [ngModel]=\"time\"\n                (ngModelChange)=\"setValue($event)\"\n            />\n            <button mat-icon-button matSuffix class=\"relative top-1 -right-1\" (click)=\"showSelect()\">\n                <app-icon class=\"text-2xl text-black text-opacity-50\">\n                    arrow_drop_down\n                </app-icon>\n            </button>\n            <mat-error><ng-content></ng-content></mat-error>\n        </mat-form-field>\n        <mat-form-field appearance=\"outline\" *ngIf=\"show_select\">\n            <mat-select\n                #select\n                [value]=\"time\"\n                [disabled]=\"disabled\"\n                (valueChange)=\"setValue($event)\"\n            >\n                <mat-option\n                    *ngFor=\"let option of time_options\"\n                    [value]=\"option.id\"\n                >\n                    {{ option.name }}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => TimeFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class TimeFieldComponent\n    extends BaseClass\n    implements OnInit, OnChanges, ControlValueAccessor {\n    /** Time step between each allowed time option */\n    @Input() public step = 15;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Whether past times are allowed */\n    @Input() public no_past_times = true;\n    /** String representing the currently set time */\n    public date: number = new Date().valueOf();\n    /** String representing the currently set time */\n    public time: string = format(new Date(), 'HH:mm');\n    /** Available time blocks for the selected date */\n    public _time_options: Identity[];\n    /** Whether select field should be shown */\n    public show_select: boolean;\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /** Select field for selecting the time */\n    @ViewChild('select') private select_field: MatSelect;\n\n    public ngOnInit(): void {\n        this.show_select = true;\n        this._time_options = this.generateAvailableTimes(\n            this.date,\n            !this.no_past_times,\n            this.step\n        );\n        this.timeout('hide', () => (this.show_select = false));\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.no_past_times || changes.step) {\n            this._time_options = this.generateAvailableTimes(\n                this.date,\n                !this.no_past_times,\n                this.step\n            );\n        }\n    }\n\n    /** Available time blocks for the selected date */\n    public get time_options() {\n        const time = (this.time || '00:00').split(':');\n        const date = set(this.date, { hours: +time[0], minutes: +time[1] });\n        if (\n            date.getMinutes() % 15 !== 0 &&\n            !this._time_options.find(\n                (time) => time.id === format(date, 'HH:mm')\n            )\n        ) {\n            this._time_options.push({\n                name: `${format(date, timeFormatString())}`,\n                id: format(date, 'HH:mm'),\n            });\n            this._time_options.sort((a, b) =>\n                `${a.id}`.localeCompare(`${b.id}`)\n            );\n        }\n        return this._time_options;\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: string): void {\n        this.time = new_value;\n        if (this._onChange) {\n            const time = (this.time || '00:00').split(':');\n            const date = startOfMinute(\n                set(this.date, { hours: +time[0], minutes: +time[1] })\n            );\n            this._onChange(date.valueOf());\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.date = value || this.date;\n        let date = startOfMinute(this.date);\n        date = roundToNearestMinutes(date, { nearestTo: 5 });\n        this.time = format(date, 'HH:mm');\n        this._time_options = this.generateAvailableTimes(\n            this.date,\n            !this.no_past_times,\n            this.step\n        );\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    /**\n     * Show select field for time options\n     */\n    public showSelect() {\n        this.show_select = true;\n        this.timeout('on_shown', () => {\n            if (this.select_field) {\n                this.select_field.focus();\n                this.select_field.open();\n                this.subscription(\n                    'listen_close',\n                    this.select_field.openedChange.subscribe((state) => {\n                        if (!state) {\n                            this.show_select = false;\n                        }\n                    })\n                );\n            }\n        });\n    }\n\n    /**\n     * Generate a list of time options for the given date\n     * @param datestamp Date to generate options for\n     * @param show_past Whether past times should be options\n     */\n    private generateAvailableTimes(\n        datestamp: number,\n        show_past: boolean,\n        step: number = 15\n    ): Identity[] {\n        const now = new Date();\n        let date = new Date(datestamp);\n        const blocks = [];\n        if (show_past || (!isSameDay(date, now) && isAfter(date, now))) {\n            date = startOfDay(date);\n        } else if (isAfter(date, now)) {\n            date = now;\n        }\n        date = roundToNearestMinutes(date, { nearestTo: step });\n        const end = endOfDay(date);\n        // Add options for the rest of the day\n        while (isAfter(end, date)) {\n            blocks.push({\n                name: `${format(date, timeFormatString())}`,\n                id: format(date, 'HH:mm'),\n            });\n            date = addMinutes(date, step);\n        }\n        return blocks;\n    }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { randomInt } from '@placeos/common';\nimport { Attachment } from '@placeos/users';\nimport { takeWhile } from 'rxjs/operators';\n\nimport * as blobUtil from 'blob-util';\nimport { uploadFiles } from '@placeos/cloud-uploads';\n\n@Component({\n    selector: 'upload-file',\n    template: `\n        <div class=\"bg-gray-50 hover:bg-gray-100 cursor-pointer p-2 rounded border border-gray-200 w-full relative\">\n            <input\n                type=\"file\"\n                class=\"absolute inset-0 opacity-0 max-w-full z-10\"\n                (change)=\"onFileEvent($event)\"\n            />\n            <div\n                item\n                *ngIf=\"item; else empty_state\"\n                class=\"w-full flex items-center border border-gray-200 rounded bg-white hover:bg-gray-100 relative z-50\"\n                [class.!bg-red-600]=\"item.progress < 1\"\n                [class.!bg-opacity-20]=\"item.progress < 1\"\n            >\n                <div class=\"flex-1 w-px font-mono truncate px-2 text-sm\">\n                    {{ item.name }}\n                </div>\n                <ng-container *ngIf=\"item.progress >= 0 && item.progress < 100\">\n                    <div class=\"relative mx-1\">\n                        <mat-progress-spinner\n                            [diameter]=\"32\"\n                            mode=\"determinate\"\n                            [value]=\"item.progress\"\n                        ></mat-progress-spinner>\n\n                        <div\n                            class=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-sm font-bold\"\n                        >\n                            {{ item.progress }}\n                        </div>\n                    </div>\n                </ng-container>\n                <a\n                    [href]=\"item.url\"\n                    mat-icon-button\n                    *ngIf=\"item.progress >= 100\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                >\n                    <app-icon>link</app-icon>\n                </a>\n                <button mat-icon-button (click)=\"writeValue(null)\">\n                    <app-icon>close</app-icon>\n                </button>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div\n                class=\"h-full w-full flex flex-col justify-center items-center z-0\"\n            >\n                <p class=\"opacity-30\">Drop file or click to upload file</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UploadFileFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UploadFileFieldComponent implements ControlValueAccessor {\n    public item: Attachment;\n    /** Form control on change handler */\n    private _onChange: (_: Attachment) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: Attachment) => void;\n\n    public readonly registerOnChange = (fn) => (this._onChange = fn);\n    public readonly registerOnTouched = (fn) => (this._onTouch = fn);\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: Attachment): void {\n        this.item = new_value;\n        if (this._onChange) this._onChange(this.item);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: Attachment) {\n        this.item = value;\n    }\n\n    public onFileEvent(event) {\n        const element: HTMLInputElement = event.target as any;\n        /* istanbul ignore else */\n        if (!element?.files?.length) return;\n        const files: FileList = element.files;\n        const on_change = (item) => {\n            this.item = item;\n            this.setValue(this.item);\n        };\n        this._uploadFile(files[0], on_change);\n    }\n\n    private _uploadFile(file: File, on_change: (item: Attachment) => void) {\n        const fileReader = new FileReader();\n        fileReader.addEventListener('loadend', (e: any) => {\n            const arrayBuffer = e.target.result;\n            const blob = blobUtil.arrayBufferToBlob(arrayBuffer, file.type);\n            const upload_list = uploadFiles([blob], { file_name: file.name });\n            const upload = upload_list[0];\n            const upload_details: Attachment = {\n                id: `${randomInt(9999_9999_9999)}`,\n                name: file.name,\n                progress: 0,\n                size: file.size,\n                created_at: Date.now(),\n                url: '',\n            };\n            upload.status\n                .pipe(takeWhile((_) => _.status !== 'complete', true))\n                .subscribe((state) => {\n                    if (upload.access_url)\n                        upload_details.url = upload.access_url;\n                    upload_details.progress = state.progress;\n                    if (state.status === 'error') upload_details.progress = -1;\n                    on_change(upload_details);\n                });\n            on_change(upload_details);\n        });\n        fileReader.readAsArrayBuffer(file);\n    }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { randomInt } from '@placeos/common';\nimport { Attachment } from '@placeos/users';\nimport { takeWhile } from 'rxjs/operators';\n\nimport * as blobUtil from 'blob-util';\nimport { uploadFiles } from '@placeos/cloud-uploads';\n\n@Component({\n    selector: 'upload-list',\n    template: `\n        <div class=\"flex items-center space-x-2\">\n            <div\n                class=\"w-52 h-48 relative border-2 border-dashed border-gray-300 flex flex-col items-center justify-center rounded hover:bg-black/5 cursor-pointer\"\n            >\n                <app-icon class=\"text-3xl mb-2\">upload_file</app-icon>\n                <p class=\"text-center\">Drop files</p>\n                <p class=\"text-center text-xs my-1\">or</p>\n                <button mat-button class=\"w-28\">Browse</button>\n                <input\n                    multiple=\"true\"\n                    type=\"file\"\n                    class=\"absolute inset-0 opacity-0 max-w-full\"\n                    (change)=\"onFileEvent($event)\"\n                />\n            </div>\n            <div class=\"w-1/2 h-48 flex-1 flex flex-col items-center\">\n                <div\n                    list\n                    class=\"space-y-2 w-full h-full overflow-auto\"\n                    *ngIf=\"list?.length; else empty_state\"\n                >\n                    <div\n                        item\n                        *ngFor=\"let item of list\"\n                        class=\"w-full flex items-center border border-gray-200 rounded bg-white hover:bg-gray-100\"\n                        [class.!bg-red-600]=\"item.progress < 1\"\n                        [class.!bg-opacity-20]=\"item.progress < 1\"\n                    >\n                        <div\n                            class=\"flex-1 w-px font-mono truncate px-2 text-sm\"\n                        >\n                            {{ item.name }}\n                        </div>\n                        <ng-container\n                            *ngIf=\"item.progress >= 0 && item.progress < 100\"\n                        >\n                            <div class=\"relative mx-1\">\n                                <mat-progress-spinner\n                                    [diameter]=\"32\"\n                                    mode=\"determinate\"\n                                    [value]=\"item.progress\"\n                                ></mat-progress-spinner>\n\n                                <div\n                                    class=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-sm font-bold\"\n                                >\n                                    {{ item.progress }}\n                                </div>\n                            </div>\n                        </ng-container>\n                        <a\n                            [href]=\"item.url\"\n                            mat-icon-button\n                            *ngIf=\"item.progress >= 100\"\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                        >\n                            <app-icon>link</app-icon>\n                        </a>\n                        <button mat-icon-button (click)=\"removeFile(item)\">\n                            <app-icon>close</app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div\n                class=\"h-full w-full flex flex-col justify-center items-center\"\n            >\n                <p class=\"opacity-30\">No uploaded files</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UploadListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UploadListFieldComponent implements ControlValueAccessor {\n    public list: Attachment[] = [];\n    /** Form control on change handler */\n    private _onChange: (_: Attachment[]) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: Attachment[]) => void;\n\n    public readonly registerOnChange = (fn) => (this._onChange = fn);\n    public readonly registerOnTouched = (fn) => (this._onTouch = fn);\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: Attachment[]): void {\n        this.list = new_value.filter((_) => _.url && _.progress >= 100);\n        if (this._onChange) this._onChange(this.list);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: Attachment[]) {\n        this.list = value.map(_ => ({ id: `file-${randomInt(999_999_999)}` , ..._ }));\n    }\n\n    public removeFile(item: Attachment) {\n        this.list = this.list.filter(_ => _.id !== item.id);\n    }\n\n    public onFileEvent(event) {\n        const element: HTMLInputElement = event.target as any;\n        /* istanbul ignore else */\n        if (!element?.files?.length) return;\n        const files: FileList = element.files;\n        const on_change = (item) => {\n            this.list = [\n                ...(this.list || []).filter((_) => _.id !== item.id),\n            ].sort((a, b) => a.created_at - b.created_at);\n            this.setValue(this.list);\n        };\n        for (let i = 0; i < files.length; i++) {\n            this._uploadFile(files[i], on_change);\n        }\n    }\n\n    private _uploadFile(file: File, on_change: (item: Attachment) => void) {\n        const fileReader = new FileReader();\n        fileReader.addEventListener('loadend', (e: any) => {\n            const arrayBuffer = e.target.result;\n            const blob = blobUtil.arrayBufferToBlob(arrayBuffer, file.type);\n            const upload_list = uploadFiles([blob], { file_name: file.name });\n            const upload = upload_list[0];\n            const upload_details: Attachment = {\n                id: `${randomInt(9999_9999_9999)}`,\n                name: file.name,\n                progress: 0,\n                size: file.size,\n                created_at: Date.now(),\n                url: '',\n            };\n            upload.status\n                .pipe(takeWhile((_) => _.status !== 'complete', true))\n                .subscribe((state) => {\n                    if (upload.access_url)\n                        upload_details.url = upload.access_url;\n                    upload_details.progress = state.progress;\n                    if (state.status === 'error') upload_details.progress = -1;\n                    on_change(upload_details);\n                });\n            on_change(upload_details);\n        });\n        fileReader.readAsArrayBuffer(file);\n    }\n}\n","import {\n    Component,\n    forwardRef,\n    Output,\n    EventEmitter,\n    Input,\n    ViewChild,\n    ElementRef,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport {\n    BaseClass,\n    csvToJson,\n    currentUser,\n    downloadFile,\n    notifyError,\n    SettingsService,\n    unique,\n} from '@placeos/common';\nimport {\n    catchError,\n    debounceTime,\n    first,\n    map,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\nimport { MatDialog } from '@angular/material/dialog';\nimport { COMMA, ENTER } from '@angular/cdk/keycodes';\nimport { BehaviorSubject, combineLatest, of, zip } from 'rxjs';\n\nimport { NewUserModalComponent } from 'libs/users/src/lib/new-user-modal.component';\nimport { searchGuests } from 'libs/users/src/lib/guests.fn';\nimport { searchStaff } from 'libs/users/src/lib/staff.fn';\nimport { User } from 'libs/users/src/lib/user.class';\nimport { USER_DOMAIN } from 'libs/users/src/lib/user.utilities';\n\nfunction validateEmail(email) {\n    const re =\n        /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(email);\n}\n\n@Component({\n    selector: 'a-user-list-field',\n    template: `\n        <div\n            class=\"mb-4bg-white text-black\"\n            form-field\n            [attr.disabled]=\"disabled\"\n        >\n            <div search>\n                <mat-form-field\n                    class=\"w-full\"\n                    appearance=\"outline\"\n                    matAutocompleteOrigin\n                    #origin=\"matAutocompleteOrigin\"\n                >\n                    <mat-chip-list #chipList aria-label=\"User selection\">\n                        <mat-chip\n                            user\n                            *ngFor=\"let user of active_list\"\n                            (removed)=\"removeUser(user)\"\n                        >\n                            <app-icon class=\"mr-2\">business</app-icon>\n                            {{ user.name || user.email }}\n                            <button remove matChipRemove>\n                                <app-icon>cancel</app-icon>\n                            </button>\n                        </mat-chip>\n                        <input\n                            #search_field\n                            placeholder=\"Type a name or email\"\n                            name=\"user_email\"\n                            [ngModel]=\"search$ | async\"\n                            (ngModelChange)=\"updateSearch($event)\"\n                            [matAutocomplete]=\"auto\"\n                            [matChipInputFor]=\"chipList\"\n                            [matChipInputSeparatorKeyCodes]=\"separatorKeysCodes\"\n                            (matChipInputTokenEnd)=\"\n                                addUserFromEmail($event.value)\n                            \"\n                        />\n                        <mat-spinner\n                            *ngIf=\"loading\"\n                            diameter=\"24\"\n                            matSuffix\n                        ></mat-spinner>\n                    </mat-chip-list>\n                </mat-form-field>\n                <mat-autocomplete #auto=\"matAutocomplete\">\n                    <mat-option\n                        *ngIf=\"search_valid_email\"\n                        (click)=\"addUserFromEmail()\"\n                    >\n                        Add external user with email \"{{ search$.getValue() }}\"\n                    </mat-option>\n                    <mat-option\n                        *ngFor=\"let user of user_list$ | async\"\n                        (click)=\"addUser(user)\"\n                        class=\"leading-tight\"\n                    >\n                        {{ user.name }}<br />\n                        <span class=\"text-xs\">{{ user.email }}</span>\n                    </mat-option>\n                </mat-autocomplete>\n            </div>\n            <div\n                class=\"flex items-center space-x-2 -mt-4\"\n                actions\n                *ngIf=\"!hide_actions\"\n            >\n                <button\n                    mat-button\n                    type=\"button\"\n                    name=\"new-contact\"\n                    class=\"inverse flex-1 sm:flex-none\"\n                    (click)=\"openNewUserModal()\"\n                    i18n=\"Add new external attendee\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        Add&nbsp;<span class=\"hidden sm:inline\">External</span>\n                    </div>\n                </button>\n                <button\n                    mat-button\n                    type=\"button\"\n                    name=\"upload-csv\"\n                    class=\"inverse flex-1 sm:flex-none\"\n                    i18n=\"Upload attendee list from CSV file\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        Upload&nbsp;<span class=\"hidden sm:inline\">CSV</span>\n                    </div>\n                    <input\n                        class=\"opacity-0 absolute inset-0\"\n                        type=\"file\"\n                        (change)=\"addUsersFromFile($event)\"\n                    />\n                </button>\n                <button\n                    mat-button\n                    type=\"button\"\n                    name=\"download-template\"\n                    class=\"inverse flex-1 sm:flex-none\"\n                    (click)=\"downloadCSVTemplate(); download.emit()\"\n                    i18n=\"Download template CSV file\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <span class=\"hidden sm:inline\">CSV</span>&nbsp;Template\n                    </div>\n                </button>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            [search] {\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UserListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UserListFieldComponent\n    extends BaseClass\n    implements ControlValueAccessor\n{\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Number of characters needed before a search will start */\n    @Input() public limit = 3;\n    /** Whether guests should also show when searching for users */\n    @Input() public guests = false;\n    /** Whether optional actions should be shown */\n    @Input('hideActions') public hide_actions = false;\n    /** Whether as custom template will be provided outside the component */\n    @Input() public custom_template = false;\n    /** Function for filtering the results of the user list */\n    @Input() public filter: (_: any) => boolean;\n    /** Emitter for action to make a new user */\n    @Output() public new_user = new EventEmitter<void>();\n    /** Whether user should download the CSV template */\n    @Output() public download = new EventEmitter<void>();\n\n    readonly separatorKeysCodes = [ENTER, COMMA] as const;\n\n    /** Whether user list is loading */\n    public loading = false;\n    public readonly search$ = new BehaviorSubject('');\n\n    @ViewChild('search_field') private _search_el: ElementRef<HTMLInputElement>;\n\n    /** User list to display */\n    public user_list$ = this.search$.pipe(\n        debounceTime(300),\n        switchMap((_) => {\n            this.loading = true;\n            console.log('Search:', _);\n            return (\n                _\n                    ? this.guests\n                        ? combineLatest([searchStaff(_), searchGuests(_)]).pipe(\n                                map(([staff, guests]) => {\n                                    console.log('Users:', staff, guests);\n                                    const visitors_list = [];\n                                    const visitors =\n                                        this._settings.get('visitor-invitees') ||\n                                        [];\n                                    for (const item of visitors) {\n                                        const [email, name, company] =\n                                            item.split('|');\n                                        visitors_list.push({\n                                            email,\n                                            name,\n                                            company,\n                                        });\n                                    }\n                                    console.log(\n                                        'Users:',\n                                        staff,\n                                        guests,\n                                        visitors_list\n                                    );\n                                    return unique(\n                                        (staff as any)\n                                            .concat(guests)\n                                            .concat(visitors_list),\n                                        'email'\n                                    );\n                                })\n                            )\n                        : searchStaff(_)\n                    : of([])\n            ).pipe(\n                catchError((_) => {\n                    console.log(_);\n                    return of([]);\n                })\n            );\n        }),\n        tap((_) => (this.loading = false))\n    );\n    /** List of active selected users on the list */\n    public active_list: User[] = [];\n\n    /** Form control on change handler */\n    private _onChange: (_: User[]) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: User[]) => void;\n\n    public readonly validFn = (s) => validateEmail(s);\n    public readonly emptyClick = () => this.openNewUserModal(new User());\n\n    public get search_valid_email() {\n        return validateEmail(this.search$.getValue());\n    }\n\n    constructor(\n        private _dialog: MatDialog,\n        private _settings: SettingsService\n    ) {\n        super();\n    }\n\n    public updateSearch(new_value: string = '') {\n        this.timeout('search', () => this.search$.next(new_value));\n    }\n\n    public addUserFromEmail(email: string = '') {\n        if (!email) email = this.search$.getValue();\n        if (!validateEmail(email)) return;\n        const user = new User({ id: email, email, name: email.split('@')[0] });\n        this.addUser(user);\n        const { name, organisation } = user;\n        const visitor_details = `${email}|${name}|${organisation}`;\n        const old_visitors = this._settings.get('visitor-invitees') || [];\n        this._settings.saveUserSetting('visitor-invitees', [\n            ...old_visitors.filter((_) => !_.includes(email)),\n            visitor_details,\n        ]);\n        this.timeout(\n            'clear_search',\n            () => {\n                this.search$.next('');\n                this._search_el.nativeElement.value = '';\n            },\n            100\n        );\n    }\n\n    /**\n     * Add user to the user list\n     * @param user\n     */\n    public addUser(user: User) {\n        const list = this.active_list.filter((_) => _.email !== user.email);\n        this.setValue([\n            ...list,\n            new User({\n                ...user,\n                id: user.id || user.email,\n                visit_expected:\n                    (!user.id && user.is_external !== true\n                        ? user.visit_expected\n                        : null) ?? true,\n            }),\n        ]);\n        this.timeout(\n            'clear_search',\n            () => {\n                this.search$.next('');\n                this._search_el.nativeElement.value = '';\n            },\n            100\n        );\n    }\n\n    /**\n     * Remove user from the user list\n     * @param user\n     */\n    public removeUser(user: User) {\n        const list = this.active_list.filter(\n            (a_user) => a_user.email !== user.email\n        );\n        this.setValue(list);\n    }\n\n    /**\n     * Load CSV file and populate the user list with the contents\n     * @param event File input field event\n     */\n    public addUsersFromFile(event) {\n        /* istanbul ignore else */\n        if (event.target) {\n            const file = event.target.files[0];\n            /* istanbul ignore else */\n            if (file) {\n                const reader = new FileReader();\n                reader.readAsText(file, 'UTF-8');\n                reader.addEventListener('load', (evt) => {\n                    this.processCsvData((evt.srcElement as any).result);\n                    event.target.value = '';\n                });\n                reader.addEventListener('error', (_) =>\n                    notifyError('Error reading file.')\n                );\n            }\n        }\n    }\n\n    /**\n     * Process raw CSV data and save user data to attendee list\n     * @param data CSV data\n     */\n    private processCsvData(data: string) {\n        const list = csvToJson(data) || [];\n        const id = currentUser()?.staff_id || 'unknown';\n        for (const el of list) {\n            el.name = el.name || `${el.first_name} ${el.last_name}`;\n            const display = (\n                el.name || `${Math.floor(Math.random() * 9999_9999)}`\n            )\n                .split(' ')\n                .join('_')\n                .toLowerCase();\n            /* istanbul ignore else */\n            if (!el.email) {\n                el.email = `${display}+${id}@guest.${USER_DOMAIN}`;\n            }\n            const internal_emails = this._settings.get(\n                'app.booking.internal_emails'\n            ) || ['place.tech'];\n            el.visit_expected =\n                el.visit_expected ??\n                !internal_emails.find((_) => el.email.endsWith(_));\n\n            /** Convert phone to string. PWCME-544 */\n            el.phone = '' + el.phone;\n\n            this.addUser(new User(el));\n        }\n    }\n\n    /* istanbul ignore next */\n    /** Download template CSV file */\n    public downloadCSVTemplate() {\n        if (this.custom_template) return;\n        const template = `Organisation,First Name,Last Name,Email,Phone,Assistance Required,Visit Expected\\nFake Org,John,Smith,john.smith@example.com,01234567898,false,true`;\n        downloadFile('template.csv', template);\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User[]): void {\n        this.active_list = new_value;\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User[]) {\n        this.active_list = value;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: User[]) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: User[]) => void): void {\n        this._onTouch = fn;\n    }\n\n    public displayFn(item): string {\n        return item?.name || '';\n    }\n\n    /**\n     * Open modal to add or update user details\n     */\n    public openNewUserModal(user: User = new User()) {\n        const ref = this._dialog.open<NewUserModalComponent>(\n            NewUserModalComponent,\n            {\n                width: 'auto',\n                height: 'auto',\n                data: { user },\n            }\n        );\n        ref.componentInstance?.event\n            .pipe(first((_) => _.reason === 'done'))\n            .subscribe((event) => {\n                this.addUser(event.metadata);\n                ref.close();\n            });\n    }\n}\n","/* eslint-disable @typescript-eslint/member-ordering */\nimport {\n    Component,\n    OnInit,\n    forwardRef,\n    Input,\n    ViewChild,\n    ElementRef,\n} from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\nimport { Subject, Observable, of, forkJoin } from 'rxjs';\nimport {\n    switchMap,\n    debounceTime,\n    distinctUntilChanged,\n    map,\n    catchError,\n} from 'rxjs/operators';\n\nimport { BaseClass, flatten } from '@placeos/common';\nimport { searchGuests } from 'libs/users/src/lib/guests.fn';\nimport { searchStaff } from 'libs/users/src/lib/staff.fn';\nimport { User } from 'libs/users/src/lib/user.class';\n\n@Component({\n    selector: 'a-user-search-field',\n    template: `\n        <div class=\"user-search-field\" form-field>\n            <mat-form-field appearance=\"outline\">\n                <input\n                    #input\n                    matInput\n                    keyboard\n                    name=\"user-search\"\n                    [(ngModel)]=\"search_str\"\n                    (ngModelChange)=\"search$.next($event || '')\"\n                    [disabled]=\"disabled\"\n                    [placeholder]=\"placeholder || 'Search for user...'\"\n                    [matAutocomplete]=\"auto\"\n                    (keyup.enter)=\"\n                        validate && validate(search_str)\n                            ? setValue(search_str)\n                            : ''\n                    \"\n                    (blur)=\"resetSearchString()\"\n                    (focus)=\"cancelReset()\"\n                />\n                <app-icon matPrefix class=\"text-2xl relative\">search</app-icon>\n                <mat-spinner\n                    *ngIf=\"loading\"\n                    matSuffix\n                    diameter=\"16\"\n                ></mat-spinner>\n            </mat-form-field>\n            <mat-autocomplete\n                #auto=\"matAutocomplete\"\n                (optionSelected)=\"setValue($event.option.value)\"\n            >\n                <mat-option\n                    *ngFor=\"let option of user_list\"\n                    (click)=\"setValue(option); blurInput()\"\n                >\n                    <div class=\"leading-tight\">{{ option.name }}</div>\n                    <div class=\"text-xs opacity-60\">\n                        {{ option.email }}\n                    </div>\n                </mat-option>\n                <mat-option\n                    *ngIf=\"search_str && validate && validate(search_str)\"\n                    class=\"relative pointer-events-none\"\n                >\n                    <div\n                        class=\"absolute inset-0 px-4 pointer-events-auto\"\n                        (mousedown)=\"\n                            $event.stopPropagation(); $event.preventDefault()\n                        \"\n                        (touchstart)=\"\n                            $event.stopPropagation(); $event.preventDefault()\n                        \"\n                        (click)=\"\n                            setValue(search_str);\n                            $event.stopPropagation();\n                            $event.preventDefault()\n                        \"\n                    >\n                        <div class=\"pointer-events-none\">\n                            Add external attendee \"{{ search_str }}\"\n                        </div>\n                    </div>\n                </mat-option>\n                <mat-option\n                    *ngIf=\"!user_list?.length && (search_str || error)\"\n                    [disabled]=\"!empty_fn\"\n                    (click)=\"empty_fn()\"\n                >\n                    {{ search_str ? 'No users found.' : '' }} {{ error }}\n                </mat-option>\n            </mat-autocomplete>\n        </div>\n    `,\n    styles: [\n        `\n            :host,\n            mat-form-field {\n                width: 100%;\n            }\n\n            app-icon {\n                top: 0.15em;\n                left: -0.15em;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UserSearchFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UserSearchFieldComponent\n    extends BaseClass\n    implements OnInit, ControlValueAccessor {\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Placeholder text to display */\n    @Input() public placeholder: string;\n    /** Limit available options to these */\n    @Input() public options: User[];\n    /** Whether guests should also show when searching for users */\n    @Input() public guests: boolean;\n    /** Message to display when no user matches have been found */\n    @Input() public error = '';\n    /** Function to validate the search string */\n    @Input() public validate: (s: string) => boolean;\n    /** Function to call when empty list option is clicked */\n    @Input() public empty_fn: () => void;\n    /** Function for filtering the results of the user list */\n    @Input() public filter: (_: any, s?: string) => boolean;\n\n    @Input() public query_fn: (_: string) => Observable<User[]> = (q) =>\n        searchStaff(q);\n    /** Currently selected user */\n    public active_user: User;\n    /** User list to display */\n    public user_list: User[];\n    /** Whether user list is loading */\n    public loading: boolean;\n    /** Current display value of the search input field  */\n    public search_str: string;\n    /** Subject holding the value of the search */\n    public search$ = new Subject<string>();\n    /** List of users from an API search */\n    public search_results$: Observable<User[]> = this.search$.pipe(\n        debounceTime(400),\n        distinctUntilChanged(),\n        switchMap((query) => {\n            this.loading = true;\n            return this.options && this.options.length > 0\n                ? of(this.options)\n                : query.length >= 3\n                ? !this.guests\n                    ? this.query_fn(query)\n                    : forkJoin([searchStaff(query), searchGuests(query)])\n                : of([]);\n        }),\n        catchError((_) => of([])),\n        map((list: User[]) => {\n            this.loading = false;\n            list = flatten(list);\n            const search = (this.search_str || '').toLowerCase();\n            return list.filter(\n                (item) => !this.filter || this.filter(item, search)\n            );\n        })\n    );\n\n    /** Form control on change handler */\n    private _onChange: (_: User) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: User) => void;\n\n    @ViewChild('input', { read: ElementRef })\n    private _input_el: ElementRef<HTMLInputElement>;\n\n    public cancelReset = () => this.clearTimeout('reset');\n\n    public blurInput = () => {\n        this.timeout('blur', () => this._input_el?.nativeElement?.blur());\n    };\n\n    public ngOnInit(): void {\n        // Process API results\n        this.subscription(\n            'search_results',\n            this.search_results$.subscribe((list) => (this.user_list = list))\n        );\n    }\n\n    /**\n     * Reset the search string back to the name of the active user\n     */\n    public resetSearchString() {\n        this.timeout(\n            'reset',\n            () => (this.search_str = this.active_user?.name || ''),\n            100\n        );\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User | string, email?: string): void {\n        if (\n            typeof new_value === 'string' &&\n            (new_value as any) === this.search_str\n        ) {\n            new_value = new User({\n                name: (this.search_str || email || '').split('@')[0],\n                email: this.search_str || email || '',\n            });\n        }\n        if (!(new_value instanceof User)) return;\n        this.active_user = new_value;\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n        this.resetSearchString();\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User) {\n        this.active_user = value;\n        this.resetSearchString();\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: User) => void): void {\n        this._onChange = fn;\n    }\n\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: User) => void): void {\n        this._onTouch = fn;\n    }\n}\n","\nexport * as MOCKS from './mocks';\n","\nexport const MOCK_ASSETS = [\n    {\n        id: '1',\n        name: 'iPad',\n        category: 'Technology',\n        images: [\n            { name: 'chrome.svg', url: 'assets/support/chrome-logo.svg' },\n            { name: 'firefox.svg', url: 'assets/support/firefox-logo.svg' },\n            { name: 'safari.svg', url: 'assets/support/safari-logo.svg' },\n        ],\n    },\n    { id: '2', name: 'iPhone', category: 'Technology' },\n    { id: '3', name: 'iWatch', category: 'Technology' },\n    { id: '4', name: 'Chair', category: 'Furniture' },\n    { id: '5', name: 'Lounge', category: 'Furniture' },\n    { id: '6', name: 'Table', category: 'Furniture' },\n    { id: '7', name: 'Couch', category: 'Furniture' },\n    { id: '8', name: 'Something', category: 'Other' },\n];\n","import { predictableRandomInt } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_ASSETS } from './assets.data';\n\nexport const ASSET_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/engine/v1/assets',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const events = MOCK_ASSETS;\n            return events;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v1/assets/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const event = MOCK_ASSETS.find((e) => e.id === _.route_params.id);\n            if (!event)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${_.route_params.id}`,\n                };\n            return event;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v1/assets',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const new_event = {\n                ...request.body,\n                id: `-asset-${predictableRandomInt(999)}`,\n            };\n            MOCK_ASSETS.push(new_event);\n            return new_event;\n        },\n    });\n\n    const updateAsset = (id, data) => {\n        const index = MOCK_ASSETS.findIndex((e) => e.id === id);\n        if (index < 0)\n            throw {\n                status: 404,\n                message: `Unable to find booking with ID ${id}`,\n            };\n        const new_event = { ...data };\n        MOCK_ASSETS.splice(index, 1, new_event);\n        return new_event;\n    };\n\n    registerMockEndpoint({\n        path: '/api/engine/v1/assets/:id',\n        metadata: {},\n        method: 'PUT',\n        callback: (req) => updateAsset(req.route_params.id, { ...req.body }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v1/assets/:id',\n        metadata: {},\n        method: 'DELETE',\n        callback: (req) => {\n            const index = MOCK_ASSETS.findIndex(\n                (e) => e.id === req.route_params.id\n            );\n            if (index < 0)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${req.route_params.id}`,\n                };\n            MOCK_ASSETS.splice(index, 1);\n            return;\n        },\n    });\n}\n","import { padString, predictableRandomInt, randomString } from '@placeos/common';\nimport { addMinutes, getUnixTime, set, subDays } from 'date-fns';\nimport { MOCK_ASSETS } from './assets.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport { MOCK_STAFF } from './users.data';\nimport { MOCK_BUILDINGS, MOCK_LEVELS } from './zone.data';\nimport { PARKING_SPACES } from './zones.mock';\n\nlet EVENT_TIME = set(subDays(Date.now(), 3), {\n    hours: 7,\n    minutes: 0,\n    seconds: 0,\n    milliseconds: 0,\n});\n\nconst nextEventTime = (save = false): number => {\n    const next = addMinutes(EVENT_TIME, (predictableRandomInt(8) + 1) * 15);\n    if (save) EVENT_TIME = next;\n    return getUnixTime(next);\n};\n\nconst TYPES = ['desk', 'parking', 'asset-request'];\nconst TRACKING = ['in_storage', 'in_transit', 'at_location']\n\nexport const MOCK_BOOKINGS = new Array(200).fill(0).map((_, index) => {\n    const throw_away = predictableRandomInt(999999) % 3 === 0;\n    const user = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)] || {} as any;\n    const type = TYPES[predictableRandomInt(TYPES.length)];\n    const bld = MOCK_BUILDINGS[predictableRandomInt(MOCK_BUILDINGS.length)];\n    const lvls = MOCK_LEVELS.filter((_) => _.parent_id === bld?.id);\n    const lvl = lvls[predictableRandomInt(lvls.length)];\n    const lvl_spaces = MOCK_SPACES.filter(_ => _.zones.includes(lvl?.id)) || [];\n    const approved = predictableRandomInt(999999) % 4;\n    const approver = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n    const asset_count = predictableRandomInt(3, 1);\n    const position = padString(\n        (index % 18) + 1 + Math.floor(index / 18) * 100,\n        3\n    );\n    return {\n        id: `booking-${index}`,\n        booking_start: nextEventTime(true),\n        booking_end: nextEventTime(),\n        user_id: user.id,\n        user_name: user.name,\n        user_email: user.email,\n        booked_by_name: user.name,\n        booked_by_email: user.email,\n        asset_id: type === 'parking' ? `park-${position}` : `desk-${lvl?.id}-${index}`,\n        asset_name: type === 'parking' ? position : `${lvl?.id}-${index}`,\n        description: type === 'parking' ? position : `Desk ${index}`,\n        title: `${type} Booking ${index}`,\n        type,\n        booking_type: type,\n        checked_in: predictableRandomInt(999999) % 3 === 0,\n        access: predictableRandomInt(999999) % 3 === 0,\n        approved: approved === 0,\n        rejected: approved === 1,\n        approver_id: approved === 0 ? approver.id : '',\n        approver_name: approved === 0 ? approver.name : '',\n        approver_email: approved === 0 ? approver.email : '',\n        zones: [bld?.id, lvl?.id],\n        extension_data: {\n            map_id: `table-10.00${index}`,\n            plate_number: randomString(8, 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'),\n            assets: new Array(asset_count).fill(0).map(_ => ({ ...MOCK_ASSETS[predictableRandomInt(asset_count)], amount: predictableRandomInt(5, 1)})),\n            tracking: approved === 0 ? TRACKING[predictableRandomInt(TRACKING.length)] : 'in_storage',\n            space_id: lvl_spaces[predictableRandomInt(lvl_spaces.length)]?.id\n        },\n    };\n});\n","import { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_BOOKINGS } from './bookings.data';\n\nexport const BOOKING_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const events = MOCK_BOOKINGS.filter(\n                (event) =>\n                    timePeriodsIntersect(\n                        _.query_params.period_start,\n                        _.query_params.period_end,\n                        event.booking_start,\n                        event.booking_end\n                    ) && (event.type === _.query_params.type || event.booking_type === _.query_params.type)\n            );\n            return events;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const event = MOCK_BOOKINGS.find((e) => e.id === _.route_params.id);\n            if (!event)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${_.route_params.id}`,\n                };\n            return event;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const new_event = {\n                ...request.body,\n                id: `-booking-${predictableRandomInt(999)}`,\n            };\n            MOCK_BOOKINGS.push(new_event);\n            return new_event;\n        },\n    });\n\n    const updateBooking = (id, data) => {\n        const index = MOCK_BOOKINGS.findIndex((e) => e.id === id);\n        if (index < 0)\n            throw {\n                status: 404,\n                message: `Unable to find booking with ID ${id}`,\n            };\n        const new_event = { ...data };\n        const removed = MOCK_BOOKINGS.splice(index, 1, new_event);\n        return new_event;\n    };\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'PUT',\n        callback: (req) => updateBooking(req.route_params.id, { ...req.body }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'PATCH',\n        callback: (req) => updateBooking(req.route_params.id, { ...req.body }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/approve',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                approved: true,\n                rejected: false,\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/reject',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                approved: false,\n                rejected: true,\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/check_in',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                checked_in: req.query_params.state === 'true',\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'DELETE',\n        callback: (req) => {\n            const index = MOCK_BOOKINGS.findIndex(\n                (e) => e.id === req.route_params.id\n            );\n            if (index < 0)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${req.route_params.id}`,\n                };\n            MOCK_BOOKINGS.splice(index, 1);\n            return;\n        },\n    });\n}\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_EVENTS } from './events.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { ACTIVE_USER, MOCK_STAFF } from './users.data';\n\nexport const CALENDAR_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const user = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n            const user2 = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n            const user3 = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n            return [\n                {\n                    id: ACTIVE_USER.email,\n                    summary: ACTIVE_USER.name,\n                    primary: true,\n                    can_edit: true,\n                    hidden: false,\n                },\n                {\n                    id: user.email,\n                    summary: user.name,\n                    primary: false,\n                    can_edit: true,\n                    hidden: false,\n                },\n                {\n                    id: user2.email,\n                    summary: user2.name,\n                    primary: false,\n                    can_edit: false,\n                    hidden: false,\n                },\n                {\n                    id: user3.email,\n                    summary: user3.name,\n                    primary: false,\n                    can_edit: false,\n                    hidden: true,\n                },\n            ];\n        },\n    });\n\n    const handleSpaceAvailability = (request) => {\n        const start = +request.query_params.period_start;\n        const end = +request.query_params.period_end;\n        const zones = (request.query_params.zone_ids || '')\n            .split(',')\n            .filter((i) => !!i);\n        const systems = (request.query_params.system_ids || '')\n            .split(',')\n            .filter((i) => !!i);\n\n        const spaces = MOCK_SPACES.filter((space) =>\n            zones.length\n                ? zones.reduce(\n                      (has, zone) => has && space.zones.includes(zone),\n                      true\n                  )\n                : systems.length\n                ? systems.includes(space.id)\n                : true\n        ).filter((space) => {\n            const bookings = MOCK_EVENTS.filter((event) =>\n                event.attendees.find((user) => user.id === space.id)\n            );\n            for (const event of bookings) {\n                if (\n                    timePeriodsIntersect(\n                        start,\n                        end,\n                        event.event_start,\n                        event.event_end\n                    )\n                )\n                    return false;\n            }\n            return true;\n        });\n        return spaces;\n    };\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars/availability',\n        metadata: {},\n        method: 'GET',\n        callback: (request) =>\n            handleSpaceAvailability(request).map((_) => ({\n                resource: _,\n            })),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars/free_busy',\n        metadata: {},\n        method: 'GET',\n        callback: (request) =>\n            handleSpaceAvailability(request).map((_) => ({\n                resource: _,\n            })),\n    });\n}\n","import { HashMap, predictableRandomInt } from '@placeos/common';\nimport { addMinutes, differenceInMinutes } from 'date-fns';\n\nexport const MOCK_MENU = [\n    {\n        id: 'item-1',\n        name: 'Coffee',\n        unit_price: 200,\n        category: 'Drinks',\n        tags: ['drink'],\n        options: [\n            { id: 'opt-1', name: 'Cappacino', group: 'type' },\n            { id: 'opt-2', name: 'Latte', group: 'type' },\n            { id: 'opt-3', name: '1 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-4', name: '2 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-5', name: '3 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-6', name: '4 Sugar', group: 'sugars', unit_price: 20 },\n        ],\n    },\n    {\n        id: 'item-2',\n        name: 'Soda',\n        unit_price: 160,\n        category: 'Drinks',\n        tags: ['drink'],\n        options: [\n            { id: 'opt-1', name: 'Pepsi', group: 'type' },\n            { id: 'opt-2', name: 'Sunkist', group: 'type' },\n            { id: 'opt-3', name: 'Solo', group: 'type' },\n            { id: 'opt-4', name: 'Dr Pepper', group: 'type' },\n        ],\n    },\n    { id: 'item-3', name: 'Water', unit_price: 100, category: 'Drinks' },\n    {\n        id: 'item-4',\n        name: 'Muffin',\n        unit_price: 160,\n        category: 'Snacks',\n        options: [\n            { id: 'opt-1', name: 'Choc Chip', group: 'type' },\n            { id: 'opt-2', name: 'Banana', group: 'type' },\n            { id: 'opt-3', name: 'Blueberry', group: 'type' },\n        ],\n    },\n    {\n        id: 'item-5',\n        name: 'Cookies',\n        unit_price: 400,\n        category: 'Snacks',\n        options: [\n            { id: 'opt-1', name: 'Choc Chip', group: 'type' },\n            { id: 'opt-2', name: 'Macadamia', group: 'type' },\n            { id: 'opt-3', name: 'Dark Choc', group: 'type' },\n        ],\n    },\n    {\n        id: 'item-6',\n        name: 'Fish & Chips',\n        unit_price: 250,\n        category: 'Simple Meals',\n        options: [\n            {\n                id: 'opt-1',\n                name: 'Tomato Sauce',\n                group: 'sauce',\n                unit_price: 30,\n            },\n            { id: 'opt-2', name: 'BBQ Sauce', group: 'sauce', unit_price: 35 },\n            {\n                id: 'opt-3',\n                name: 'Tartare Sause',\n                group: 'sauce',\n                unit_price: 40,\n            },\n            {\n                id: 'opt-4',\n                name: 'Garlic Aoili Sauce',\n                group: 'sauce',\n                unit_price: 50,\n            },\n        ],\n    },\n    {\n        id: 'item-7',\n        name: 'Sandwich',\n        unit_price: 300,\n        category: 'Simple Meals',\n        options: [\n            { id: 'opt-1', name: 'Ham & Cheese', group: 'type' },\n            { id: 'opt-2', name: 'Chicken', group: 'type' },\n            { id: 'opt-3', name: 'Fairy Bread', group: 'type' },\n        ],\n    },\n];\n\nexport function generateCateringOrder(event: HashMap) {\n    const duration = differenceInMinutes(event.event_start, event.event_end);\n    const mx = predictableRandomInt(MOCK_MENU.length);\n    return {\n        id: `order-${predictableRandomInt(999_999)}`,\n        event_id: event.id,\n        invoice_number: `I${predictableRandomInt(999_999)}`,\n        charge_code: `C${predictableRandomInt(9_999)}`,\n        deliver_at: addMinutes(\n            event.event_start * 1000,\n            predictableRandomInt(Math.floor(duration / 5)) * 5\n        ),\n        items: new Array(3).fill(0).map((_, idx) => ({\n            ...MOCK_MENU[(mx * idx) % MOCK_MENU.length],\n            options: [],\n            quantity: predictableRandomInt(10, 1),\n        })),\n    };\n}\n","/** Domain of the organisation */\nexport const DOMAIN = 'place.tech';\n/** Endpoint where the staff API is located */\nexport const API = '/api/staff/v1';\n","import { predictableRandomInt, unique } from '@placeos/common';\nimport * as dayjs from 'dayjs';\nimport { generateCateringOrder } from './catering.data';\nimport { MOCK_SPACES } from './spaces.data';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\n\nlet EVENT_TIME = dayjs().startOf('d').hour(7);\n\nconst nextEventTime = (save = false): number => {\n    const next = EVENT_TIME.add((predictableRandomInt(8) + 1) * 15, 'm');\n    if (save) {\n        EVENT_TIME = next;\n    }\n    return next.unix();\n};\n\nconst event_status = ['tentative', 'confirmed', 'cancelled'];\nconst randomStatus = (): string => {\n    const rnd = predictableRandomInt(10);\n    return rnd < 2\n        ? event_status[2]\n        : rnd < 5\n        ? event_status[0]\n        : event_status[1];\n};\n\nexport const MOCK_EVENTS = new Array(200).fill(0).map((_, index) => {\n    const PEOPLE = MOCK_STAFF.concat(MOCK_GUESTS);\n    let attendees: any[] = new Array(predictableRandomInt(8, 1))\n        .fill(0)\n        .map(() => PEOPLE[predictableRandomInt(PEOPLE.length)]);\n    attendees.sort(\n        (a, b) => (a.visit_expected ? 0 : -1) - (b.visit_expected ? 0 : -1)\n    );\n    const space = MOCK_SPACES[predictableRandomInt(MOCK_SPACES.length)];\n    attendees = attendees.concat({ ...space, resource: true });\n    if (predictableRandomInt(9999) % 2 === 0) attendees.unshift(ACTIVE_USER);\n    else attendees.unshift(MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)]);\n    attendees = unique(attendees, 'email') || [{}];\n    const event_start = nextEventTime(true);\n    const event_end = nextEventTime();\n    const meeting_url =\n        predictableRandomInt(9999) % 3 === 0 ? 'https://meet.place.tech' : '';\n    return {\n        id: `cal-event-${index}`,\n        status: randomStatus(),\n        host: attendees[0].email,\n        calendar: 'calendar_id',\n        creator: 'optional@fake.com',\n        attendees: (unique(attendees, 'email') || []).map((_, idx) => ({\n            ..._,\n            organizer: idx === 0,\n            checked_in: predictableRandomInt(99999) % 2 === 0,\n            response_status:\n                predictableRandomInt(99999) % 2 === 0\n                    ? 'accepted'\n                    : predictableRandomInt(99999) % 6 === 0\n                    ? 'declined'\n                    : 'tentative',\n        })),\n        title: `Some Meeting ${index}`,\n        body: `A Description`,\n        private: false,\n        event_start,\n        event_end,\n        timezone: 'Australia/Sydney',\n        all_day: false,\n        location: `${space?.name}`,\n        recurring: false,\n        recurrence: {},\n        attachments: {},\n        system: space,\n        meeting_url,\n        meeting_id: meeting_url ? `m${predictableRandomInt(9999)}` : '',\n        meeting_provider: meeting_url ? 'PlaceOS' : '',\n        extension_data: {\n            catering:\n                predictableRandomInt(99999) % 4 === 0\n                    ? [\n                          generateCateringOrder({\n                              id: `cal-event-${index}`,\n                              event_start,\n                              event_end,\n                          }),\n                      ]\n                    : [],\n            setup: predictableRandomInt(4) * 5,\n            breakdown: predictableRandomInt(4) * 5,\n        },\n    };\n});\n\nconst event_spaces = {};\nMOCK_EVENTS.forEach((event) => {\n    if (!event_spaces[event.system?.id]) {\n        event_spaces[event.system?.id] = [];\n    }\n    event_spaces[event.system?.id].push(event);\n});\n","import { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { mockSystem, registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_EVENTS } from './events.data';\nimport { ACTIVE_USER, MOCK_STAFF } from './users.data';\n\nexport const EVENT_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/events',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            let events = MOCK_EVENTS;\n            if (!_.query_params.zone_ids) {\n                events = events.filter(\n                    (event) =>\n                        !!event.attendees.find(\n                            (user) => user.email === ACTIVE_USER.email\n                        )\n                );\n            }\n            if (_.query_params.period_start) {\n                events = events.filter((e) =>\n                    timePeriodsIntersect(\n                        _.query_params.period_start,\n                        _.query_params.period_end,\n                        e.event_start,\n                        e.event_end\n                    )\n                );\n            }\n            return events;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const new_event = {\n                ...request.body,\n                id: `-cal-event-${predictableRandomInt(999)}`,\n            };\n            new_event.attendees = [\n                MOCK_STAFF.find((_) => _.email === new_event.host),\n                ...(new_event.attendees || []),\n            ];\n            new_event.attendees.forEach((user) => {\n                if (user.zones) user.resource = true;\n            });\n\n            if (new_event.system) {\n                new_event.attendees = [\n                    ...(new_event.attendees || []),\n                    { ...new_event.system, resource: true },\n                ];\n            }\n            MOCK_EVENTS.push(new_event);\n\n            const system = mockSystem(new_event.system?.id);\n            system?.Bookings[0]?.$poll_bookings();\n            return new_event;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const item = MOCK_EVENTS.find(\n                (event) => event.id === request.route_params.id\n            );\n            if (item) {\n                return item;\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'DELETE',\n        callback: (request) => {\n            const index = MOCK_EVENTS.findIndex(\n                (event) => event.id === request.route_params.id\n            );\n            if (index > 0) {\n                if (MOCK_EVENTS[index].host === ACTIVE_USER.email) {\n                    MOCK_EVENTS.splice(index, 1);\n                } else {\n                    const user = MOCK_EVENTS[index].attendees.find(\n                        (_) => _.email === ACTIVE_USER.email\n                    );\n                    user.response_status = 'declined';\n                }\n                return;\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'PATCH',\n        callback: (request) => {\n            const index = MOCK_EVENTS.findIndex(\n                (event) => event.id === request.route_params.id\n            );\n            if (index >= 0) {\n                return MOCK_EVENTS.splice(index, 1, request.body);\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id/guests/:email/checkin',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const event = MOCK_EVENTS.find(\n                (event) => event.id === request.route_params.id\n            );\n            if (event) {\n                const checked_in =\n                    (event.extension_data as any).checked_in || [];\n                (event.extension_data as any).checked_in = checked_in.concat([\n                    request.route_params.email,\n                ]);\n                return event;\n            }\n            throw { status: 404, message: 'Guest not found' };\n        },\n    });\n}\n","import { predictableRandomInt } from '@placeos/common';\nimport { generateMockSpace } from '@placeos/spaces';\n\nconst randomSpaceFeatures = () => {\n    const f = ['Whiteboard', 'VidConf', 'Projector', 'Views'];\n    const numFeatures = predictableRandomInt(f.length + 1);\n    const res = [];\n    for (let i = 0; i < numFeatures; i++) {\n        res.push(f[predictableRandomInt(f.length)]);\n    }\n    return res.filter((el, i, r) => r.indexOf(el) === i);\n};\n\nexport const MOCK_SPACES = [\n    {\n        name: '1.01 Operations Room',\n        map_id: 'area-1.01-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: '1.03 Sydney Boardroom',\n        map_id: 'area-1.03-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: '1.04 The Studio',\n        map_id: 'area-1.04-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: 'Jam Board',\n        map_id: 'area-1.02-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: 'G.01 Cisco Room',\n        map_id: 'area-G.01-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: 'G.02 The Lab',\n        map_id: 'area-G.02-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: 'Conference Room 2.01',\n        map_id: 'area-2.01-status',\n        zones: ['bld-02', 'bld-02_lvl-2'],\n    },\n    {\n        name: 'Conference Room 2.02',\n        map_id: 'area-2.02-status',\n        zones: ['bld-02', 'bld-02_lvl-2'],\n    },\n    {\n        name: 'Conference Room 3.01',\n        map_id: 'area-3.01-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n    {\n        name: 'Conference Room 3.02',\n        map_id: 'area-3.02-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n    {\n        name: 'Conference Room 3.03',\n        map_id: 'area-3.03-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n].map((d) => generateMockSpace({ ...d, features: randomSpaceFeatures(), images: ['https://webcdn.executivecentre.com/wp-content/uploads/sites/39/2020/10/img-meetingroomrental_hire.jpg'] }));\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { createSystem } from '../systems-bindings.mock';\nimport { MOCK_SPACES } from './spaces.data';\n\nexport const SYSTEM_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    MOCK_SPACES.forEach((space: any, index) => createSystem(space));\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/systems',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            return request.query_params?.zone_id\n                ? MOCK_SPACES.filter((_) =>\n                      _.zones.includes(request.query_params.zone_id)\n                  )\n                : MOCK_SPACES;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/systems/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const space = MOCK_SPACES.find(_ => _.id === request.route_params.id);\n            if (!space) throw { status: 404 };\n            return space;\n        },\n    });\n}\n","import { predictableRandomInt } from '@placeos/common';\nimport { DOMAIN } from './common.mock';\n\nconst PREDEF_USERS = [\n    'Jonathan McFarlane',\n    'Alex Sorafumo',\n    'Jim Doe',\n    'Cristina Boston',\n    'Jeremy West',\n    'Viv Briffa',\n    'Candy Russo',\n    'Jeff Wiz',\n    'Sravani Kotha',\n    'Kim Burgess',\n    'Caspian Baska',\n    'Stephen Von Takach',\n    'Cameron Reeves',\n    'Shane Boseley',\n];\n\nexport const ACTIVE_USER = {\n    id: 'current',\n    name: 'PlaceOS - Mock User',\n    email: 'dev@place.tech',\n    groups: ['deals', 'user'],\n};\n\nexport const MOCK_STAFF = PREDEF_USERS.map((name, i) => ({\n    id: `user-${i + 1}`,\n    name: `${name} (PlaceOS)`,\n    email: `${name.split(' ').join('.').toLowerCase()}@${DOMAIN}`,\n})).concat([ACTIVE_USER]);\n\nexport const MOCK_GUESTS = PREDEF_USERS.map((name, i) => ({\n    id: `guest-${i + 1}`,\n    name: `${name} (External)`,\n    email: `${name.split(' ').join('.').toLowerCase()}@guest.${DOMAIN}`,\n    visit_expected: predictableRandomInt(99999) % 2 === 0,\n    extension_data: predictableRandomInt(99999) % 3 === 0 ? {\n        vaccination_proof: { url: 'https://fonts.gstatic.com/s/i/materialicons/verified/v11/24px.svg' },\n        id_data: { url: 'https://fonts.gstatic.com/s/i/materialicons/fingerprint/v12/24px.svg' } \n    } : {}\n}));\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\nimport { MOCK_LEVELS } from './zone.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport * as dayjs from 'dayjs';\nimport { MOCK_EVENTS } from './events.data';\n\nexport const USER_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/engine/v2/users/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.route_params.id === 'current') {\n                return ACTIVE_USER;\n            }\n            const person = MOCK_STAFF.find(\n                (user) => user.email === request.route_params.id\n            );\n            if (person) {\n                return person;\n            }\n            throw { status: 404, message: 'User not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/people',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.q) {\n                const search = request.query_params.q.toLowerCase();\n                return MOCK_STAFF.filter(\n                    (user) =>\n                        user.name.toLowerCase().includes(search) ||\n                        user.email.toLowerCase().includes(search)\n                );\n            }\n            return MOCK_STAFF;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/people/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const id = decodeURIComponent(request.route_params.id);\n            const person = MOCK_STAFF.find((user) => user.email === id);\n            if (person) {\n                return {\n                    ...person,\n                    location: generateLocation(),\n                };\n            }\n            throw { status: 404, message: 'User not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.q) {\n                const search = request.query_params.q.toLowerCase();\n                return MOCK_GUESTS.filter(\n                    (user) =>\n                        user.name.toLowerCase().includes(search) ||\n                        user.email.toLowerCase().includes(search)\n                );\n            }\n            return MOCK_STAFF;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests/:email',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const email = decodeURIComponent(request.route_params.email);\n            const person = MOCK_GUESTS.find((user) => user.email === email);\n            if (person) {\n                return person;\n            }\n            throw { status: 404, message: 'Guest not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests/:email/meetings',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.route_params.email) {\n                const email = request.route_params.email.toLowerCase();\n                const events = MOCK_EVENTS.filter((event) =>\n                    event.attendees.find(\n                        (user) => user.email.toLowerCase() === email\n                    )\n                );\n                return events;\n            }\n            throw {\n                status: 404,\n                message: `Unable to find meetings with guest with email ${request.route_params.email}`,\n            };\n        },\n    });\n\n    const LOCATION_TYPES = [\n        'meeting',\n        'desk_id',\n        'laptop',\n        'mobile',\n        'geo',\n        'none',\n    ];\n\n    function generateLocation() {\n        const type =\n            LOCATION_TYPES[predictableRandomInt(LOCATION_TYPES.length)];\n        const level = MOCK_LEVELS[predictableRandomInt(MOCK_LEVELS.length)];\n        const level_spaces = MOCK_SPACES.filter((s) =>\n            s.zones.includes(level.id)\n        );\n        const space =\n            level_spaces[predictableRandomInt(level_spaces.length)] || {};\n        const location: HashMap = {};\n        switch (type) {\n            case 'meeting':\n                location.meeting = {\n                    building: level.parent_id,\n                    level: level.id,\n                    system: space.id,\n                    map_id: space.map_id,\n                    event_id: '',\n                };\n                break;\n            case 'desk_id':\n                location.meeting = {\n                    building: level.parent_id,\n                    level: level.id,\n                    map_id: space.map_id,\n                    checked_in: dayjs().unix(),\n                };\n                break;\n            case 'laptop':\n            case 'mobile':\n                location[type] = {\n                    building: level.parent_id,\n                    level: level.id,\n                    x: +predictableRandomInt(10000),\n                    y: +predictableRandomInt(5000),\n                    last_seen: dayjs()\n                        .subtract(predictableRandomInt(60), 'm')\n                        .unix(),\n                };\n                break;\n            case 'geo':\n                location.geo = {\n                    lat: predictableRandomInt(180) - 90,\n                    lon: predictableRandomInt(360) - 180,\n                    last_seen: dayjs()\n                        .subtract(predictableRandomInt(60), 'm')\n                        .unix(),\n                };\n                break;\n        }\n        return location;\n    }\n}\n","export const MOCK_ORGS = [\n    {\n        created_at: 1587057070,\n        updated_at: 1587692680,\n        name: 'PlaceOS',\n        description: '',\n        tags: 'org',\n        count: 0,\n        capacity: 0,\n        parent_id: '',\n        triggers: [],\n        id: 'zone-EmWFTjuYExK',\n    },\n];\n\nexport const MOCK_BUILDINGS = [\n    {\n        name: 'Sydney',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-01',\n        levels: ['lvl-G', 'lvl-1'],\n    },\n    {\n        name: 'Brisbane',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-02',\n        levels: ['lvl-2', 'lvl-3'],\n    },\n];\n\nconst mockLevel = (\n    id: string,\n    idx: number,\n    building: any,\n    num: string = '10'\n): any => {\n    let map_id = id.substr(4);\n    map_id = `assets/maps/level_${num}.svg`;\n    return {\n        id: `${building.id}_${id}`,\n        name: `Level ${id.endsWith('00') ? 'G' : id.split('-')[1]}`,\n        parent_id: building.id,\n        description: '',\n        tags: 'level',\n        map_id,\n        code: 'level code 12',\n        type: 'staff floor',\n        count: 5,\n        capacity: 30,\n        location: 'optional lat,long',\n        display_name: '',\n    };\n};\n\nexport const MOCK_LEVELS = MOCK_BUILDINGS.map((bld) =>\n    bld.levels.map((level, idx) =>\n        mockLevel(level, idx, bld, level.split('-')[1])\n    )\n).reduce((p, c) => p.concat(c), [\n    // {\n    //     id: 'test',\n    //     parent_id: 'bld-01',\n    //     name: 'Test',\n    //     map_id: 'assets/maps/test.svg',\n    // },\n    {\n        id: 'level-p1',\n        parent_id: 'bld-01',\n        name: 'Level P1',\n        tags: ['level', 'parking'],\n        map_id: 'assets/maps/level_P1.svg',\n    },\n]);\n","import { padString, predictableRandomInt } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_MENU } from './catering.data';\nimport { MOCK_STAFF } from './users.data';\nimport { MOCK_ORGS, MOCK_LEVELS, MOCK_BUILDINGS } from './zone.data';\n\nconst MOCK_METADATA = {\n    current: {\n        contacts: {\n            name: 'contacts',\n            description: '',\n            details: [\n                {\n                    id: 'user-1',\n                    name: 'Jonathan McFarlane (PlaceOS)',\n                    email: 'jon@place.tech',\n                    first_name: 'Jonathan',\n                    last_name: 'McFarlane',\n                },\n                {\n                    id: 'user-1',\n                    name: 'Alex Sorafumo (PlaceOS)',\n                    email: 'alex@place.tech',\n                    first_name: 'Alex',\n                    last_name: 'Sorafumo',\n                },\n            ],\n        },\n    },\n};\n\nexport const PARKING_SPACES = {};\n\nexport const ZONE_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/engine/v2/zones',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.tags === 'org') {\n                return MOCK_ORGS;\n            } else if (request.query_params.tags === 'building') {\n                return MOCK_BUILDINGS;\n            } else if (request.query_params.tags === 'level') {\n                return MOCK_LEVELS;\n            }\n            throw { status: 404, message: 'Zones not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.name === 'bindings') {\n                return {\n                    bindings: {\n                        details: {\n                            area_management: 'space-0',\n                            location_services: 'space-0',\n                            contact_tracing: 'space-0',\n                            // payments: 'space-0',\n                        },\n                    },\n                };\n            }\n            if (request.query_params.name === 'catering') {\n                return {\n                    catering: {\n                        details: MOCK_MENU,\n                    },\n                };\n            }\n            if (request.query_params.name === 'desks') {\n                const parts = request.route_params.id.split('-');\n                const id = parts[parts.length - 1];\n                return generateMockDeskMetadata(id);\n            }\n            if (request.query_params.name === 'parking-spaces') {\n                const parts = request.route_params.id.split('-');\n                const id = parts[parts.length - 1];\n                return generateParkingSpaces(id);\n            }\n            if (request.query_params.name === 'map_regions') {\n                return {\n                    map_regions: {\n                        details: {\n                            areas: [\n                                {\n                                    id: 'zone-10.A',\n                                    properties: {\n                                        capacity: 100,\n                                        label_location: { x: 0.36, y: 0.33 },\n                                        // draw_polygon: true\n                                    },\n                                    geometry: {\n                                        coordinates: [\n                                            [0.0,0.0],\n                                            [0.0,0.5],\n                                            [0.5,0.5],\n                                            [0.5,0.0]\n                                        ]\n                                    }\n                                },\n                                {\n                                    id: 'zone-10.B',\n                                    properties: {\n                                        capacity: 100,\n                                        label_location: { x: 0.76, y: 0.33 },\n                                    },\n                                },\n                                {\n                                    id: 'zone-10.C',\n                                    properties: {\n                                        capacity: 100,\n                                        label_location: { x: 0.63, y: 0.77 },\n                                    },\n                                },\n                            ],\n                        },\n                    },\n                };\n            }\n            if (\n                MOCK_METADATA[request.route_params.id] &&\n                MOCK_METADATA[request.route_params.id][\n                    request.query_params.name\n                ]\n            ) {\n                return MOCK_METADATA[request.route_params.id];\n            } else if (\n                MOCK_METADATA[request.route_params.id] &&\n                !request.query_params.name\n            ) {\n                return MOCK_METADATA[request.route_params.id] || {};\n            }\n            return {};\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id',\n        metadata: {},\n        method: 'PATCH',\n        callback: (request) => {\n            if (!MOCK_METADATA[request.route_params.id])\n                MOCK_METADATA[request.route_params.id] = {};\n            MOCK_METADATA[request.route_params.id][request.body.name] =\n                request.body;\n        },\n    });\n\n    const DESK_FEATURES = ['sit_to_stand', 'single_monitor', 'dual_monitor'];\n\n    function generateMockDeskMetadata(id: string) {\n        return {\n            desks: {\n                details: new Array(30).fill(0).map((_, idx) => ({\n                    id: `table-${padString(id, 2)}.${padString(idx + 1, 3)}`,\n                    name: `Desk ${id}.${padString(idx + 1, 3)}`,\n                    bookable: predictableRandomInt(9999) % 4 !== 0,\n                    group: '',\n                    features: DESK_FEATURES.filter(\n                        (_) => predictableRandomInt(99999) % 3 === 0\n                    ),\n                })),\n            },\n        };\n    }\n\n    function generateParkingSpaces(id: string) {\n        if (!PARKING_SPACES[id]) {\n            PARKING_SPACES[id] = {\n                'parking-spaces': {\n                    details: new Array(18 * 6).fill(0).map((_, idx) => {\n                        const position = padString(\n                            (idx % 18) + Math.floor(idx / 18) * 100,\n                            3\n                        );\n                        const assignee =\n                            predictableRandomInt(9999) % 4 === 0\n                                ? MOCK_STAFF[\n                                      predictableRandomInt(MOCK_STAFF.length)\n                                  ]\n                                : ({} as any);\n                        return {\n                            id: `park-${position}`,\n                            map_id: `park-${position}`,\n                            name: `${position}`,\n                            bookable: predictableRandomInt(9999) % 4 !== 0,\n                            assigned_to: assignee.email || '',\n                            assigned_name: assignee.name || '',\n                        };\n                    }),\n                },\n            };\n        }\n        return PARKING_SPACES[id];\n    }\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id/children',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const zone = MOCK_BUILDINGS.find(\n                (_) => _.id === request.route_params.id\n            );\n            if (!zone)\n                throw {\n                    status: 404,\n                    message: `Unable to find zone with id \"${request.route_params.id}\"`,\n                };\n            return MOCK_LEVELS.filter((_) => _.parent_id === zone.id).map(\n                (lvl) => {\n                    const parts = lvl.id.split('-');\n                    const id = parts[parts.length - 1];\n                    return {\n                        zone: lvl,\n                        metadata: generateMockDeskMetadata(id),\n                    };\n                }\n            );\n        },\n    });\n}\n","import { HashMap } from '@placeos/common';\n\nexport enum CameraTilt {\n    Down,\n    Up,\n    Stop,\n}\n\nexport enum CameraPan {\n    Left,\n    Right,\n    Stop,\n}\n\nclass CameraModule {\n    pan: number;\n    tilt: number;\n    zoom: number;\n\n    pan_speed: number;\n    tilt_speed: number;\n    zoom_speed: number;\n\n    presets: string[];\n\n    constructor(_) {\n        this.presets = ['Preset One', 'Preset 2', 'Preset Three'];\n    }\n\n    $pan(dir: CameraPan) {}\n\n    $tilt(tilt: CameraTilt) {}\n\n    $recall(name: string) {}\n\n    $save_preset(name: string) {}\n}\n\nexport const createCameraModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CameraModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from \"@placeos/common\";\n\nlet interval;\n\nexport class CaptureModule {\n\n    status: 'playing' | 'stopped' | 'paused' = 'stopped';\n    title: string;\n    live: boolean = false;\n    remaining: number;\n    current: number;\n    next: number;\n\n    constructor(_) {\n        this.remaining = randomInt(24 * 60 * 60);\n    }\n\n    $start() {\n        this.status = 'playing';\n        interval = setInterval(() => {\n            if (this.remaining < 1) clearInterval(interval);\n            this.remaining = this.remaining - 1;\n            this.current = this.current + 1;\n        }, 3000);\n    }\n\n    $pause() {\n        this.status = 'paused';\n        clearInterval(interval);\n    }\n\n    $resume() {\n        this.$start();\n    }\n\n    $stop() {\n        this.status = 'stopped';\n        this.current = 0;\n        clearInterval(interval);\n    }\n\n}\n\nexport const createCaptureModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CaptureModule({ ...space, ...overrides });\n","import {\n    HashMap,\n    randomInt,\n    randomString,\n    timePeriodsIntersect,\n} from '@placeos/common';\nimport { addDays, getUnixTime, isBefore, setHours } from 'date-fns';\nimport { MOCK_STAFF } from '../api/users.data';\n\nconst CONTACT_EVENTS = {};\n\nconst filterFn = (start, end) => (itm) => {\n    return timePeriodsIntersect(start, end, itm.contact_time, itm.contact_time);\n};\n\nclass ContactTracingModule {\n    constructor(_) {}\n\n    $close_contacts(email: string, user: string, start: number, end: number) {\n        if (!CONTACT_EVENTS[email]) CONTACT_EVENTS[email] = [];\n        if (CONTACT_EVENTS[email].length)\n            return CONTACT_EVENTS[email].filter(filterFn(start, end));\n        const events = [];\n        const beginning = addDays(start * 1000, -10);\n        const ending = addDays(end * 1000, 10);\n        let date = new Date(beginning);\n        while (isBefore(date, ending)) {\n            new Array(randomInt(4))\n                .fill(0)\n                .map((_) => ({\n                    mac_address: randomString(10),\n                    contact_time: getUnixTime(\n                        setHours(date, randomInt(11) + 7)\n                    ),\n                    duration: randomInt(60) * 60,\n                    username: MOCK_STAFF[randomInt(MOCK_STAFF.length)].email,\n                }))\n                .forEach((e) => events.push(e));\n            date = addDays(date, 1);\n        }\n        CONTACT_EVENTS[email] = events;\n        return CONTACT_EVENTS[email].filter(filterFn(start, end));\n    }\n}\n\nexport const createContactTracingModule = (\n    space: HashMap,\n    overrides: HashMap = {}\n) => new ContactTracingModule({ ...space, ...overrides });\n","import { HashMap, unique } from '@placeos/common';\n\nexport interface EnvironmentSource {\n    id?: string;\n    name: string;\n    type?: 'lights' | 'blinds' | 'screen';\n    state: string | number;\n    states: string[];\n}\n\nexport interface RoomInput {\n    id?: string;\n    ref: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    locked: boolean;\n    routes: string[];\n    outputs: string[];\n}\n\nexport interface RoomOutput {\n    id?: string;\n    ref: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    locked: boolean;\n    source: string;\n    inputs: string[];\n    following: string;\n}\n\nclass RoomModule {\n    public readonly name: string;\n    public readonly connected: boolean;\n    public active: boolean;\n\n    public readonly input_list: HashMap<RoomInput>;\n    public readonly output_list: HashMap<RoomOutput>;\n    public readonly env_sources: EnvironmentSource[];\n\n    public readonly inputs;\n    public readonly outputs;\n    public readonly environment;\n\n    public readonly help = {\n        'help': {\n            title: 'Help',\n            content: `\n# Using the asset browser\n\n## Activating the menu\nThe 5 finger touch can be actvated by placing 4 fingers and your thumb on the screen, or quickly double-tapping the screen. Activation through double tap will leave the menu on-screen. To close tap the X.\n\n## Selecting a menu item\nLeaving at least one finger on the screen, drag your finger to the icon to select.\n\n## Home Menu\nThe home menu allows you to access files and navigate to content and presentations via the Launcher.\n\n## Connect and stream your laptop or access the CMS to add files\nPlug your laptop into the HDMI to stream it to the screen, or access the CMS to add your own content and create custom presentations.\n\n<video></video>\n\n1. Test1\n2. Test2\n3. Test3\n            `\n        },\n        'laptop-help': {\n            icon: 'web_asset',\n            title: 'Asset Browser',\n            content: `# Test 2`\n        }\n    }\n\n    public tabs =[\n        {\n           icon: \"laptop\",\n           name: \"Laptop\",\n           type: 'Display',\n           inputs: ['Display_1'],\n           help: \"laptop-help\"\n         },\n        {\n           icon: \"call\",\n           name: \"VC\",\n           inputs: [\"VidConf_1\"],\n           help: \"vidconf-help\",\n           controls: \"vidconf-controls\"\n         },\n      ]\n\n    public volume = 0;\n\n    constructor(_data: Partial<RoomModule>) {\n        this.name = _data.name || 'Test Module';\n        this.connected = _data.connected ?? true;\n        this.active = _data.active || false;\n        this.input_list = _data.input_list;\n        this.output_list = _data.output_list;\n        this.env_sources = _data.env_sources || [];\n        this.inputs = Object.keys(this.input_list || {}) || [];\n        this.outputs = Object.keys(this.output_list || {}) || [];\n        const types = unique(this.env_sources.map((_) => _.type)) || [];\n        types.forEach(\n            (t) =>\n                (this[`${t}`] = this.env_sources\n                    .filter((_) => _.type === t)\n                    .map((_) => _.id))\n        );\n        this.env_sources.forEach(\n            (source) => (this[`${source.type}/${source.id}`] = source)\n        );\n        this.inputs.forEach(\n            (key) => (this[`input/${key}`] = this.input_list[key])\n        );\n        this.outputs.forEach(\n            (key) => (this[`output/${key}`] = this.output_list[key])\n        );\n    }\n\n    $power(state = true) {\n        this.active = state;\n    }\n    /** Shares a signal source with the room and any connected remote participants. */\n    $share() {}\n    /**\n     * Connect a signal source to a signal output, or set of outputs. Any intermediate\n     * device interactions are handled internally. For example, on a system using a small\n     * presentation switcher and a display, routing a laptop input will select the\n     * appropriate input on the switcher, and select the appropriate input on the display.\n     *\n     * This includes all routable signal types - in addition to the above example, this may\n     * be interacting with an audio DSP to add a microphone feed to an output zone, or\n     * connecting a USB HID input device with a specific output.\n     **/\n    $route(input: string, output: string) {\n        if (this.inputs.includes(input) && this.outputs.includes(output)) {\n            this.$updateState(input, {\n                routes: unique([\n                    ...(this.input_list[input].routes || []),\n                    output,\n                ]),\n            });\n            this.$updateState(output, {\n                source: input,\n                following: input,\n            });\n        }\n    }\n    /**\n     * Remove a signal source from a signal output.\n     * Predominantly intended for outputs that support more than one simultaneous input source\n     * (mixed audio zone, or display capable of compositing multiple video sources).\n     **/\n    $unroute() {}\n    /**\n     * Establish a call (either phone or video) with a remote participant.\n     * This may be a peer-to-peer connection or a wider group via an external bridging service.\n     **/\n    $connect() {}\n    /** End a call with a remote participant. */\n    $disconnect() {}\n    /**\n     * Bind the current system to another PlaceOS controlled space, relinquishing local control.\n     * This may be used for an education pod that pairs with a wider classroom or a room being\n     * used as an overflow from a primary event space.\n     **/\n    $link() {}\n    /**\n     * Join the current system with another PlaceOS controlled space, sharing control and signal IO.\n     * Examples of usage would be a set of rooms with moveable walls. N-way merges supported.\n     **/\n    $merge() {}\n    /** Separate from a linked or merged system. */\n    $split() {}\n    /**\n     * Display an alert visible to participants in the space. This may occur as a screen overlay,\n     * on a control interface, a bot post in a chat space associated with the current meeting or\n     * other modalities depending on hardware capability.\n     **/\n    $notify() {}\n    /**\n     * Place the room into a predefined operation mode. This may include executing an arbitrary\n     * set of device interactions, changing metadata associated with the system itself (changing\n     * available input or output nodes), or other configurable actions designed to transition\n     * the space to a specific state.\n     **/\n    $preset() {}\n    /**\n     * Set the volume for a signal node in the space. This can include outputs as well as inputs\n     * where supported (e.g. microphone). If unspecified, default is to interact with a primary\n     * output node.\n     **/\n    $volume(value: number, source: string = 'all') {\n        if (source === 'all') {\n            this.volume = value;\n        }\n    }\n    /** Interact with audio muting on supporting signal nodes within the space. */\n    $mute(state: boolean = true, source: string = 'all') {\n        this.$updateState(source, { mute: state });\n    }\n    /**\n     * Activates or deactivates a signal mute for the associated IO. If this is not possible,\n     * (e.g. unsupported by the device) an error is returned.\n     **/\n    $unmute(source: string = 'all') {\n        this.$mute(false, source);\n    }\n    /**\n     * Wrapper for an arbitrary set of control points defined in system configuration.\n     * Each of these may map to control options available on a sibling module and take one of two forms:\n     *  - Continuous value within a range (temperature set point 16.0...28.0 degrees, lighting level 0...100)\n     *  - Set of possible states (lighting high/med/low, blind up/down, electrochromic glass clear/opaque)\n     *\n     * System state provides the ability to introspect configured points for both control limits and current value.\n     **/\n    $environment(id: string, state: string | number) {\n        const source = this.env_sources.find((_) => _.id === id);\n        if (source) {\n            this[`${source.type}/${source.id}`] = { ...source, state };\n        }\n    }\n    /** Locks an IO node. Prevents any route changes that include this until unlocked. */\n    $lock(source: string) {\n        this.$updateState(source, { locked: true });\n    }\n    /** Unlocks an IO node. */\n    $unlock(source: string) {\n        this.$updateState(source, { locked: false });\n    }\n\n    $updateState(source: string, data: HashMap) {\n        if (this[`input/${source}`]) {\n            this[`input/${source}`] = { ...this[`input/${source}`], ...data };\n            this.input_list[source] = { ...this[`input/${source}`], ...data };\n        } else if (this[`output/${source}`]) {\n            this[`output/${source}`] = { ...this[`output/${source}`], ...data };\n            this.output_list[source] = { ...this[`output/${source}`], ...data };\n        }\n    }\n}\n\nconst input_list: HashMap = {\n    Mic1: {\n        name: 'Lectern Mic',\n        type: 'Microphone',\n        mod: 'Microphone_1',\n    },\n    Mic2: {\n        name: 'Lapel Mic',\n        type: 'Microphone',\n        mod: 'Microphone_2',\n    },\n    Mic3: {\n        name: 'Handheld Mic',\n        type: 'Microphone',\n        mod: 'Microphone_3',\n    },\n    PC1: {\n        name: 'PC-1',\n        type: 'PC',\n    },\n    PC2: {\n        name: 'PC-2',\n        type: 'PC',\n    },\n    PC3: {\n        name: 'PC-3',\n        type: 'PC',\n    },\n    PC4: {\n        name: 'PC-4',\n        type: 'PC',\n    },\n    HDMI: {\n        name: 'Laptop HDMI',\n        type: 'Laptop',\n    },\n    VGA: {\n        name: 'Laptop VGA',\n        type: 'Laptop',\n    },\n    Camera1: {\n        name: 'Camera Rear',\n        type: 'Camera',\n        mod: 'Camera_1',\n    },\n    Camera2: {\n        name: 'Camera Front',\n        type: 'Camera',\n        mod: 'Camera_2',\n    },\n    Camera3: {\n        name: 'Camera Rear 2',\n        type: 'Camera',\n        mod: 'Camera_3',\n    },\n    Camera4: {\n        name: 'Camera Front 2',\n        type: 'Camera',\n        mod: 'Camera_4',\n    },\n    TV1: {\n        name: 'IPTV 1',\n        type: 'TV',\n        mod: 'IPTV_1',\n    },\n    VC1: {\n        name: 'Video Conference 1',\n        type: 'VC',\n        mod: 'VidConf_1',\n    },\n};\n\nconst output_list: HashMap = {\n    Display1: {\n        name: 'Display 1',\n        type: 'Display',\n        source: 'PC1',\n        mod: 'Display_1',\n    },\n    Display2: {\n        name: 'Display 2',\n        type: 'Display',\n        mod: 'Display_2',\n    },\n    Display3: {\n        name: 'Display 3',\n        type: 'Display',\n        source: 'PC2',\n        mod: 'Display_3',\n    },\n    Display4: {\n        name: 'Display 4',\n        type: 'Display',\n        mod: 'Display_4',\n    },\n    Display5: {\n        name: 'Display 5',\n        type: 'Display',\n        mod: 'Display_5',\n        source: 'TV1',\n    },\n};\n\nconst env_sources: any[] = [\n    {\n        id: 'light1',\n        name: 'Lighting',\n        type: 'lights',\n        states: ['Off', 'Presentation', 'Meeting', 'Full'],\n        state: 'Off',\n    },\n    {\n        id: 'blind1',\n        name: 'Blinds',\n        type: 'blinds',\n        states: ['Off', 'Presentation', 'Meeting'],\n        state: 'Off',\n    },\n    {\n        id: 'screen1',\n        name: 'Screen',\n        type: 'screen',\n        states: ['Up', 'Down'],\n        state: 'Down',\n    },\n];\n\nexport const createSystemModule = (space: HashMap, overrides: HashMap = {}) =>\n    new RoomModule({\n        ...space,\n        input_list,\n        output_list,\n        env_sources,\n        ...overrides,\n    });\n","import { Md5 } from 'ts-md5';\nimport { HashMap, predictableRandomInt, randomInt } from '@placeos/common';\nimport { MOCK_LEVELS } from '../api/zone.data';\nimport { MOCK_STAFF } from '../api/users.data';\n\nexport interface ZoneOverview {\n    /** Desk count based on `desks` metadata in the zone\n     falls back to the zone.count field otherwise */\n    desk_count: number;\n\n    desk_usage: number;\n    /** Capacity of the space, set in zone.capacity field */\n    device_capacity: number;\n    /** Raw device count */\n    device_count: number;\n    /** This is the adjusted count based on the duplication factor */\n    estimated_people: number;\n\n    percentage_use: number;\n    /** The higher the recommendation number the better for recommending */\n    recommendation: number;\n}\n\nexport class MockAreaManagementModule implements HashMap {\n    /** Overview of the zones */\n    overview: HashMap<ZoneOverview> = {};\n\n    emergency_contacts = {\n        'First Aid': MOCK_STAFF.filter(\n            (_) => predictableRandomInt(9999) % 5 === 0\n        ),\n        'Fire Warden': MOCK_STAFF.filter(\n            (_) => predictableRandomInt(9999) % 5 === 0\n        ),\n    };\n\n    $locate_user(email: string, username: string) {}\n\n    $update() {\n        updateLocations(this, MOCK_LEVELS);\n    }\n}\n\nconst MAC_LOOKUP = {};\n\nexport class MockLocationServicesModule implements HashMap {\n    $check_ownership_of(mac_address: string) {\n        if (!MAC_LOOKUP[mac_address]) {\n            const staff =\n                randomInt(999_999) % 3 === 0\n                    ? MOCK_STAFF[randomInt(MOCK_STAFF.length)]\n                    : { name: '' };\n            MAC_LOOKUP[mac_address] = { assigned_to: staff.name };\n        }\n        return MAC_LOOKUP[mac_address];\n    }\n\n    $locate_user(email: string, username: string) {\n        return [{\n            type: 'wireless',\n            position: { x: 0.5, y: 0.5 },\n            level: MOCK_LEVELS[randomInt(MOCK_LEVELS.length)].id,\n            priority: 0\n        }]\n    }\n}\n\nfunction padZero(no: number, len: number = 3) {\n    let str = `${no}`;\n    while (str.length < len) {\n        str = '0' + str;\n    }\n    return str;\n}\n\nexport function createAreaManagementModule(\n    space: HashMap,\n    overrides: HashMap = {}\n) {\n    const mod = new MockAreaManagementModule();\n    for (const lvl of MOCK_LEVELS) {\n        mod.overview[lvl.id] = {\n            desk_count: 100,\n            desk_usage: 0,\n            device_capacity: 100,\n            device_count: 0,\n            estimated_people: 0,\n            percentage_use: 0,\n            recommendation: 10000,\n        };\n        mod[`${lvl.id}:desk_ids`] = new Array(mod.overview[lvl.id].desk_count)\n            .fill(0)\n            .map((_, idx) => `table-${lvl.number}.${padZero(idx)}`);\n        mod[`${lvl.id}`] = { value: [] };\n        mod[`${lvl.id}:areas`] = {\n            value: [\n                {\n                    area_id: 'zone-10.B',\n                    count: randomInt(100),\n                    name: '.L1 IFS IT',\n                },\n                {\n                    area_id: 'zone-10.A',\n                    count: randomInt(100),\n                    name: '.L1 IFS IT',\n                },\n                {\n                    area_id: 'zone-10.C',\n                    count: randomInt(50),\n                    name: '.L1 IFS IT',\n                },\n                {\n                    area_id: 'zone-02.D',\n                    count: randomInt(100),\n                    name: 'Quite Work',\n                },\n                {\n                    area_id: 'zone-02.B',\n                    count: randomInt(100),\n                    name: 'Meeting Area A',\n                },\n                {\n                    area_id: 'zone-02.A',\n                    count: randomInt(100),\n                    name: 'Meeting Area B',\n                },\n                {\n                    area_id: 'zone-02.C',\n                    count: randomInt(50),\n                    name: 'Casual Work',\n                },\n            ],\n        };\n    }\n    return mod;\n}\n\nexport function updateLocations(\n    mod: MockAreaManagementModule,\n    levels: HashMap[]\n) {\n    for (const lvl of levels) {\n        mod[lvl.id] = {\n            value: new Array(predictableRandomInt(20))\n                .fill(0)\n                .map(() => generateLocation(lvl, mod[`${lvl.id}:desk_ids`])),\n        };\n        for (const area of mod[`${lvl.id}:areas`].value) {\n            area.count = randomInt(100);\n        }\n        mod[`${lvl.id}:areas`] = { ...mod[`${lvl.id}:areas`] };\n    }\n}\n\nexport function generateLocation(\n    lvl: HashMap,\n    desks: string[],\n    users = MOCK_STAFF\n) {\n    const fixed = predictableRandomInt(9999) % 3 === 0;\n    const usr = (users || [])[predictableRandomInt((users || [])?.length)]?.email;\n    return fixed\n        ? {\n              location: 'desk',\n              at_location: predictableRandomInt(9999) % 2 !== 0,\n              map_id: desks[predictableRandomInt(desks.length)],\n              mac: Md5?.hashStr(usr || ''),\n              level: lvl.id,\n              building: lvl.parent_id,\n          }\n        : {\n              location: 'wireless',\n              coordinates_from: 'bottom-left',\n              x: predictableRandomInt(1000) / 10,\n              y: predictableRandomInt(1000) / 10,\n              lon: 55.27476066828535,\n              lat: 25.20106100633537,\n              s2_cell_id: '3e5f4281459c',\n              mac: Md5?.hashStr(usr || ''),\n              variance: 9.62534032222287,\n              last_seen: Math.floor(new Date().valueOf() / 1000),\n              map_width: 100,\n              map_height: 100,\n          };\n}\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass DisplayModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createDisplayModule = (space: HashMap, overrides: HashMap = {}) =>\n    new DisplayModule({ ...space, ...overrides });\n","import { addSeconds, format, isBefore, subSeconds } from 'date-fns';\n\nimport { HashMap, timePeriodsIntersect } from '@placeos/common';\nimport { MOCK_EVENTS } from '../api/events.data';\n\nexport class MockBookingModule {\n    /** Timezone the associated space resided */\n    time_zone = 'Australia/Sydney';\n    /** Whether booking is disabled */\n    disable_book_now = false;\n    /** Whether ending current meeting is disabled */\n    disable_end_meeting = false;\n    /** List of current and upcoming bookings for space */\n    bookings: HashMap[] = [];\n    pending_period = 0;\n    pending_before = 0;\n    /** Control UI associated with the space */\n    control_ui = '';\n    /** Catering UI associated with the space */\n    catering_ui = '';\n    /** Time of the last booking started by a user */\n    last_booking_started = 0;\n    current_booking = null;\n    next_booking = null;\n    /** Current status of the space */\n    room_image = 'assets/boardroom.jpg'\n    status = 'free';\n    _space = null;\n\n    constructor(space, _data: Partial<MockBookingModule>) { this._space = space }\n\n    /** Start the meeting at the given time */\n    $start_meeting(t: number) {\n        this.last_booking_started = t;\n    }\n    /** End the meeting at the given time */\n    $end_meeting(t: number) {}\n    /** Book meeting for the current time */\n    $book_now(len: number, t?: string, o?: string) {}\n\n    $poll_bookings() {\n        updateBookings(this._space, this);\n    }\n}\n\nexport const createBookingsModule = (\n    space: HashMap,\n    overrides: Partial<MockBookingModule> = {}\n) => new MockBookingModule(space, overrides);\n\nfunction updateBookings(space: HashMap, mod: HashMap) {\n    const bookings =\n        MOCK_EVENTS.filter((event) =>\n            event.attendees?.find(\n                (u) =>\n                    u.email === space.email ||\n                    u.id === space.id ||\n                    event.system?.id === space.id\n            )\n        ) || [];\n    bookings.sort((a, b) => a.event_start - b.event_start);\n    mod.bookings = bookings;\n    mod.current_booking = bookings.find((_) =>\n        timePeriodsIntersect(\n            Date.now(),\n            Date.now(),\n            _.event_start * 1000,\n            _.event_end * 1000\n        )\n    );\n    mod.next_booking = bookings.find((_) => _.event_start * 1000 > Date.now());\n    const date = new Date();\n    const { current_booking, next_booking } = mod;\n    const start = new Date((current_booking || next_booking)?.event_start);\n    const pending = timePeriodsIntersect(\n        date,\n        date,\n        subSeconds(start, mod.pending_before),\n        addSeconds(start, mod.pending_period)\n    );\n    mod.status = space?.bookable\n        ? current_booking\n            ? 'busy'\n            : pending\n            ? 'pending'\n            : 'free'\n        : 'not-bookable';\n}\n","import { HashMap } from '@placeos/common';\n\nclass MeetingPushModule {\n    public supported_meeting_url = 'https://meet.';\n\n    constructor(data: any) {}\n\n    $econtrol(...args: any[]) {}\n}\n\nexport const createMeetingPushModule = (\n    details?: HashMap,\n    overrides: HashMap = {}\n) =>\n    new MeetingPushModule({\n        ...details,\n        ...overrides,\n    });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass MicrophoneModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createMicrophoneModule = (\n    space: HashMap,\n    overrides: HashMap = {}\n) => new MicrophoneModule({ ...space, ...overrides });\n","import { HashMap, randomInt, randomString } from '@placeos/common';\n\nclass PaymentsModule {\n    \n    $list_payment_methods(type: string) {\n        \n    }\n\n    $add_payment_method(type: string, details: any) {\n\n    }\n\n    $get_product_prices(id: string, period) {\n        return [12000, 60];\n    }\n\n    $create_payment_intent(amount: number, source: string) {\n        return randomString(12);\n    }\n\n    $confirm_payment_intent(id: string) {\n\n    }\n\n    $cancel_payment_intent(id: string) {\n    }\n\n    $create_customer(...args: any) {\n        return `stripe-${randomInt(9_999_999, 1_000_000)}`;\n    }\n\n    constructor(_) {}\n}\n\nexport const createPaymentsModule = (space: HashMap, overrides: HashMap = {}) =>\n    new PaymentsModule({ ...space, ...overrides });\n","import { HashMap } from '@placeos/common';\n\nexport type VideoLayout = 'Auto' | 'Equal' | 'Overlay' | 'Prominent' | 'Single';\nexport type CallStatus =\n    | 'Idle'\n    | 'Dialling'\n    | 'Ringing'\n    | 'Connecting'\n    | 'Connected'\n    | 'Disconnecting'\n    | 'OnHold'\n    | 'EarlyMedia'\n    | 'Preserved'\n    | 'RemotePreserved';\n\nexport interface VideoCallDetails {\n    AnswerState: string;\n    CallType: string;\n    CallbackNumber: string;\n    DeviceType: string;\n    Direction: string;\n    DisplayName: number;\n    Duration: number;\n    'Encryption/Type': string;\n    FacilityServiceId: number;\n    HoldReason: string;\n    PlacedOnHold: boolean;\n    Protocol: string;\n    ReceiveCallRate: number;\n    RemoteNumber: string;\n    Status: CallStatus;\n    TransmitCallRate: number;\n    Ice: string;\n}\n\nclass VideoConferenceModule {\n    mic_mute: boolean = false;\n    selfview: boolean = false;\n    video_layout: VideoLayout = 'Auto';\n    presentation_mode: 'None' | 'Local' | 'Remote' = 'None';\n    presentation: false | 'Sending';\n    calls: Record<string, VideoCallDetails> = {\n        test: {\n            Status: 'Connected',\n        },\n    } as any;\n\n    $show_camera_pip(visible: boolean) {\n        this.selfview = visible;\n    }\n\n    $mic_mute(visible: boolean) {\n        this.mic_mute = visible;\n    }\n    $presentation_mode(state: 'None' | 'Local' | 'Remote') {\n        this.presentation_mode = state;\n    }\n    $hangup() {}\n    $call_place_on_hold() {\n        for (const key in this.calls) {\n            if (this.calls[key].Status) {\n                this.calls[key].Status = 'OnHold';\n                this.calls = { ...this.calls };\n                return;\n            }\n        }\n    }\n    $call_resume() {\n        for (const key in this.calls) {\n            if (this.calls[key].Status) {\n                this.calls[key].Status = 'Idle';\n                this.calls = { ...this.calls };\n                return;\n            }\n        }\n    }\n    $video_layout(layout: VideoLayout) {\n        this.video_layout = layout;\n    }\n    $dtmf_send(digit: string) {}\n    $dial(dial_number: string) {\n        return new Promise<void>((r) => setTimeout(() => r(), 1000));\n    }\n\n    constructor(_) {}\n}\n\nexport const createVideoConferenceModule = (\n    space: HashMap = {},\n    overrides: HashMap = {}\n) => new VideoConferenceModule({ ...space, ...overrides });\n","import { mockSystem, registerSystem } from '@placeos/ts-client';\nimport { HashMap } from '@placeos/common';\n\nimport { createSystemModule } from './realtime/control';\nimport { createBookingsModule } from './realtime/events';\nimport { createAreaManagementModule, MockLocationServicesModule } from './realtime/desks';\nimport { createCameraModule } from './realtime/camera';\nimport { createDisplayModule } from './realtime/display';\nimport { createMicrophoneModule } from './realtime/microphone';\nimport { createCaptureModule } from './realtime/capture';\nimport { createMeetingPushModule } from './realtime/meeting';\nimport { createVideoConferenceModule } from './realtime/video-conference';\nimport { createContactTracingModule } from './realtime/contact-tracing';\nimport { createPaymentsModule } from './realtime/payments';\n\nexport function createSystem(space: HashMap) {\n    registerSystem(space.id, {\n        System: [createSystemModule(space)],\n        Bookings: [createBookingsModule(space)],\n        ContactTracing: [createContactTracingModule(space)],\n        AreaManagement: [createAreaManagementModule(space)],\n        LocationServices: [new MockLocationServicesModule()],\n        Camera: new Array(10).fill(0).map((_) => createCameraModule(space)),\n        Display: new Array(10).fill(0).map((_) => createDisplayModule(space)),\n        Microphone: new Array(10)\n            .fill(0)\n            .map((_) => createMicrophoneModule(space)),\n        Capture: [createCaptureModule(space)],\n        MeetingPush: [createMeetingPushModule()],\n        VidConf: [createVideoConferenceModule()],\n        Payment: [createPaymentsModule(space)]\n    });\n\n    const system = mockSystem(space.id);\n\n    system.Bookings[0].$poll_bookings();\n    setInterval(() => system.Bookings[0].$poll_bookings(), 30 * 1000);\n\n    system.AreaManagement[0].$update();\n    setInterval(() => system.AreaManagement[0].$update(), 30 * 1000);\n}\n","\nimport { log } from '@placeos/common';\n\nimport { ZONE_MOCKS } from './lib/api/zones.mock';\nimport { USER_MOCKS } from './lib/api/users.mock';\nimport { SYSTEM_MOCKS } from './lib/api/systems.mock';\nimport { EVENT_MOCKS } from './lib/api/events.mock';\nimport { CALENDAR_MOCKS } from './lib/api/calendars.mock';\nimport { BOOKING_MOCKS } from './lib/api/bookings.mock';\nimport { ASSET_MOCKS } from './lib/api/assets.mock';\n\nexport default {\n    ZONE_MOCKS,\n    USER_MOCKS,\n    SYSTEM_MOCKS,\n    EVENT_MOCKS,\n    CALENDAR_MOCKS,\n    BOOKING_MOCKS,\n    ASSET_MOCKS\n};\n\nlog('MOCKS', 'Mocks included with application.');\n","export * from './lib/building.class';\nexport * from './lib/building.utilities';\nexport * from './lib/level.class';\nexport * from './lib/organisation.class';\nexport * from './lib/organisation.service';\nexport * from './lib/organisation.utilities';\nexport * from './lib/desk.class';\n","import { BookingRulesmap } from 'libs/events/src/lib/event.interfaces';\n\nimport { BuildingLevel } from './level.class';\n\ninterface Identity {\n    id: string;\n    name: string;\n}\ninterface RoomConfiguration {\n    id: string;\n    name?: string;\n    description?: string;\n    capacity?: number;\n}\n\nexport interface IBuildingRoleUser {\n    name: string;\n    email: string;\n    phone: string;\n}\n\nexport interface LockerMap {\n    [zone: string]: {\n        [area: string]: {\n            [type: string]: (string | boolean)[][];\n        };\n    };\n}\n\nexport interface ICoordinates {\n    longitude: number;\n    latitude: number;\n}\n\nexport interface LevelFeature {\n    id: string;\n    level_id: string;\n    name: string;\n}\n\nexport interface BookingRuleDetails {\n    /** List of booking rules details for the building */\n    readonly rules: readonly string[];\n    /** Custom booking rules for the map */\n    readonly map_rules?: readonly string[];\n    /** Contact email address for the building */\n    readonly contact?: string;\n    /** Information string to display before the rule listings */\n    readonly info?: string;\n}\n\nexport interface BuildingComplete extends Building {\n    settings: Record<string, any>;\n    locker_structure: Record<string, any>;\n    roles: Record<string, any>;\n    zone: string;\n    location: string;\n    neighbourhoods: Record<string, any>;\n}\n\nexport class Building {\n    /** PlaceOS zone id of the building */\n    public readonly id: string;\n    /** Name of the building zone */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Engine Zone ID for the building */\n    public readonly zone_id: string;\n    /** Organisation Code for the building */\n    public readonly code: string;\n    /** Geographical address of the building */\n    public readonly address: string;\n    /** IANA timezone string for building */\n    public readonly timezone: string;\n    /** ID of space that temporarily holds new meetings */\n    public readonly holding_bay: string;\n    /** ID of the space for assigning new visitor bookings to */\n    public readonly visitor_space: string;\n    /** Details about the booking rules for the building */\n    public readonly booking_details: BookingRuleDetails;\n    /** Details about the booking rules for the building */\n    public readonly booking_rules: BookingRulesmap;\n    /** Number of hour before a booking catering is restricted */\n    public readonly catering_restricted_from: number;\n    /** Currency code for the country assoicated with the building */\n    public readonly currency: string;\n    /** List of available extras for the building */\n    public readonly extras: readonly Identity[];\n    /** List of available extra equipment for loan at the building */\n    public readonly loan_items: readonly Identity[];\n    /** List of available levels for the building */\n    public readonly levels: readonly BuildingLevel[];\n    /** List of zones associated with the building */\n    public readonly zones: readonly string[];\n    /** Searchable map features */\n    public readonly searchables: readonly LevelFeature[];\n    /** List of available room configurations for the building */\n    public readonly room_configurations: readonly RoomConfiguration[];\n    /** Start and end hours catering can be delivered */\n    public readonly catering_hours: { start: number; end: number };\n    /** PlaceOS bindings for applications */\n    public readonly bindings: Record<string, string>;\n\n    public readonly orientations: Record<string, number>;\n    public readonly attributes: readonly Identity[];\n    /** Globe coordiates for the build */\n    public location: string;\n    /** Map of roles and list of the associated users */\n    private _roles: Record<string, IBuildingRoleUser[]>;\n    /** Map of the locker ID arrays */\n    private _lockers: LockerMap;\n    /** Map of important system ids for the building */\n    private _systems: Record<string, string>;\n    /** Map of important phone numbers for the building */\n    private _phone_numbers: Record<string, string>;\n\n    constructor(raw_data: Partial<BuildingComplete> = {}) {\n        this.id = raw_data.id || '';\n        this.name = raw_data.name || '';\n        const settings = raw_data.settings || {};\n        this.display_name = raw_data.display_name;\n        const disc_info = settings.discovery_info || settings;\n        this.zone_id = raw_data.zone_id || raw_data.zone;\n        this.extras = (raw_data.extras || disc_info.extras || []).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.loan_items = (\n            raw_data.loan_items ||\n            disc_info.loan_items ||\n            []\n        ).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.levels = (raw_data.levels || disc_info.levels || []).map(\n            (i) => new BuildingLevel({ ...i, building_id: this.id })\n        );\n        this._roles = raw_data.roles || disc_info.roles || {};\n        this._lockers =\n            raw_data.lockers ||\n            raw_data.locker_structure ||\n            disc_info.locker_structure ||\n            {};\n        this._systems = raw_data.systems || disc_info.systems || {};\n        this._phone_numbers =\n            raw_data.phone_numbers || disc_info.phone_numbers || {};\n        this.location = raw_data.location || disc_info.location || '0,0';\n        this.room_configurations =\n            raw_data.room_configurations || disc_info.room_configurations || [];\n        this.attributes = raw_data.attributes || disc_info.attributes || [];\n        const searchables = [];\n        if (raw_data.neighbourhoods) {\n            for (const lvl in raw_data.neighbourhoods) {\n                if (lvl in raw_data.neighbourhoods) {\n                    const lvl_features = raw_data.neighbourhoods[lvl] || {};\n                    for (const feature in lvl_features) {\n                        if (feature in lvl_features) {\n                            searchables.push({\n                                id: lvl_features[feature],\n                                name: feature,\n                                level_id: lvl,\n                            });\n                        }\n                    }\n                }\n            }\n        }\n        this.bindings = raw_data.bindings || {};\n        this.searchables = searchables;\n        this.timezone =\n            raw_data.timezone || disc_info.timezone || settings.timezone || '';\n        this.catering_hours = raw_data.catering_hours ||\n            disc_info.catering_hours ||\n            settings.catering_hours || { start: 7, end: 20 };\n        this.visitor_space =\n            raw_data.visitor_space ||\n            disc_info.visitor_space ||\n            settings.visitor_space ||\n            '';\n        this.holding_bay =\n            raw_data.holding_bay ||\n            disc_info.holding_bay ||\n            settings.holding_bay ||\n            '';\n        this.code = raw_data.code || disc_info.code || settings.code || '';\n        this.address =\n            raw_data.address || disc_info.address || settings.address || '';\n        this.orientations =\n            raw_data.orientations ||\n            disc_info.orientations ||\n            settings.orientations ||\n            {};\n        this.booking_details =\n            raw_data.booking_details ||\n            disc_info.booking_details ||\n            settings.booking_details ||\n            null;\n        this.booking_rules =\n            raw_data.booking_rules ||\n            disc_info.booking_rules ||\n            settings.booking_rules ||\n            {};\n        this.catering_restricted_from =\n            raw_data.catering_restricted_from ||\n            disc_info.catering_restricted_from ||\n            settings.catering_restricted_from ||\n            -1440;\n        this.currency =\n            raw_data.currency ||\n            disc_info.currency ||\n            settings.currency ||\n            'USD';\n    }\n\n    /**\n     * Get list of users with the associated role\n     * @param name Role to find users for\n     */\n    public role(name: string): IBuildingRoleUser[] {\n        return [...(this._roles[name] || [])];\n    }\n    /**\n     * Get list of the names of available user role lists\n     */\n    public get role_names(): string[] {\n        return Object.keys(this._roles).filter((i) => i in this._roles);\n    }\n    /** Map of the locker ID arrays */\n    public get lockers(): LockerMap {\n        return { ...(this._lockers || {}) };\n    }\n    /** Map of important system ids for the building */\n    public get systems(): Record<string, string> {\n        return { ...(this._systems || {}) };\n    }\n    /** Map of important phone numbers for the building */\n    public get phone_numbers(): Record<string, string> {\n        return { ...(this._phone_numbers || {}) };\n    }\n\n    /**\n     * Get search map feature for the given level ID\n     * @param level_id ID of level to grab features for\n     */\n    public featuresForLevel(level_id: string): LevelFeature[] {\n        return (this.searchables || []).filter((i) => i.level_id === level_id);\n    }\n}\n","\nlet BLD_COUNT = 0;\nlet LVL_COUNT = 0;\n\n/* istanbul ignore next */\n/**\n * Generate raw mock data for creating a building\n * @param id Forced ID for the mock\n */\nexport function generateMockBuilding(id?: string): Record<string, any> {\n    if (!id) {\n        id = `zone_bld-${BLD_COUNT++}`;\n    }\n    const levels = Array(10)\n        .fill(0)\n        .map((i) => generateMockLevel());\n    const features: any = {};\n    for (const lvl of levels) {\n        const count = Math.floor(Math.random() * 3 + 2);\n        features[lvl.level_id] = {};\n        for (let i = 0; i < count; i++) {\n            features[lvl.level_id][`A Feature ${i + 1}`] = `feature-${i + 1}`;\n        }\n    }\n    return {\n        id,\n        zone_id: id,\n        extras: Array(10)\n            .fill(0)\n            .map((_, idx) => {\n                const name = `Property ${idx + 1}`;\n                return {\n                    extra_id: name.split(' ').join('-').toLowerCase(),\n                    extra_name: name,\n                };\n            }),\n        loan_items: Array(10)\n            .fill(0)\n            .map((_, idx) => {\n                const name = `Property ${idx + 1}`;\n                return {\n                    extra_id: name.split(' ').join('-').toLowerCase(),\n                    extra_name: name,\n                };\n            }),\n        levels,\n        roles: {\n            'first-aiders': Array(10)\n                .fill(0)\n                .map((i) => ({ name: 'Test' })),\n        },\n        neighbourhoods: features,\n        settings: {\n            test: {\n                nested: {\n                    level2: true,\n                    org: false,\n                },\n            },\n        },\n        room_configurations: [\n            {\n                id: 'boardroom',\n                name: 'Boardroom',\n                description: 'A boardroom setting',\n            },\n            {\n                id: 'cocktail',\n                name: 'Cocktail',\n                description: 'A cocktail setting',\n            },\n        ],\n    };\n}\n\n/* istanbul ignore next */\n/**\n * Generate raw mock data for a building level\n * @param id Forced ID for the mock\n * @param map_url Map URL for the level\n */\nexport function generateMockLevel(id?: string, map_url?: string): Record<string, any> {\n    if (!id) {\n        id = `zone_lvl-${LVL_COUNT++}`;\n    }\n    return {\n        level_id: id,\n        level_name: `Level ${LVL_COUNT}`,\n        map_url,\n    };\n}\n","import { PlaceZone } from '@placeos/ts-client';\n\nexport class Desk {\n    /** ID of the desk also map_id */\n    public readonly id: string;\n    /** ID of the desk on the associated map */\n    public readonly map_id: string;\n    /** Name of the desk */\n    public readonly name: string;\n    /** Whether desk is available / bookable */\n    public readonly bookable: boolean;\n    /** Zone/Level of the desk */\n    public readonly zone: PlaceZone;\n    /** Group/Department allocated to the desk */\n    public readonly groups: string[];\n    /** QR code image data */\n    public readonly qr_code: string;\n    /** List of features associated with the desk */\n    public readonly features: string[];\n\n    constructor(data: Partial<Desk> = {}) {\n        this.id = data.id || '';\n        this.map_id = data.map_id || data.id || '';\n        this.name = data.name || '';\n        this.bookable = data.bookable ?? false;\n        this.zone = data.zone || new PlaceZone();\n        this.groups = data.groups || [];\n        this.qr_code = data.qr_code || '';\n        this.features = data.features || [];\n    }\n\n    public format() {\n        const { id, name, bookable, groups, features } = this;\n        return {\n            id,\n            name,\n            bookable,\n            groups,\n            features\n        };\n    }\n\n    public readonly toJSON = () => this.format();\n}\n","\n/** Building Level data */\nexport class BuildingLevel {\n    /** ID of the building level zone */\n    public readonly id: string;\n    /** ID of the building zone associated with the level */\n    public readonly parent_id: string;\n    /** Name of the level */\n    public readonly name: string;\n    /** Display name */\n    public readonly display_name: string;\n    /** Capacity for the level */\n    public readonly capacity: number;\n    /** Number or letter representing the level */\n    public readonly number: string;\n    /** URL of the map associated with the level */\n    public readonly map_id: string;\n    /** URL of the map associated with the level */\n    public readonly tags: string[];\n    /** Settings overrides associated with the level */\n    public readonly settings: Record<string, any> = {};\n    /** List of points of interest for the level */\n    public readonly locations: readonly { id: string, name: string }[];\n\n    constructor(_data: Partial<BuildingLevel> = {}) {\n        this.id = _data.id || '';\n        this.parent_id = _data.parent_id || '';\n        this.name = _data.name || '';\n        this.display_name = _data.display_name || '';\n        this.map_id = _data.map_id || '';\n        this.capacity = _data.capacity || 0;\n        this.locations = _data.locations || [];\n        this.tags = _data.tags || [];\n        const parts = this.display_name.split(' ');\n        this.number =\n            (parts.length >= 2\n                ? parts[parts.length - 1]\n                : this.display_name[0]\n            )?.toUpperCase() || '';\n    }\n}\n","import { getItemWithKeys } from 'libs/common/src/lib/general';\n\nexport interface OrganisationComplete extends Organisation {\n    settings?: Record<string, any>;\n}\n\nexport class Organisation {\n    /** PlaceOS zone id of the building */\n    public readonly id: string;\n    /** Name of the building zone */\n    public readonly name: string;\n    /** Description for the Organisation */\n    public readonly description: string;\n    /** Tags for the Organisation */\n    public readonly tags: string[];\n    /** Count for the Organisation */\n    public readonly count: number;\n    /** Capacity for the Organisation */\n    public readonly capacity: number;\n    /** PlaceOS bindings for applications */\n    public readonly bindings: Record<string, string>;\n    /** Map of custom settings for the building */\n    private _settings: Record<string, any>;\n\n    constructor(raw_data: Partial<OrganisationComplete> = {}) {\n        this.id = raw_data.id || '';\n        this.name = raw_data.name || '';\n        this.description = raw_data.description || '';\n        this.tags = raw_data.tags || [];\n        this.count = raw_data.count || 0;\n        this.capacity = raw_data.capacity || 0;\n        this.bindings = raw_data.bindings || {};\n        this._settings = raw_data.settings || {};\n    }\n\n    /**\n     * Get a custom organisation setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public setting(key: string): any {\n        const keys = key.split('.');\n        const value = getItemWithKeys(keys, this._settings);\n        return value;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport {\n    authority,\n    isMock,\n    onlineState,\n    queryZones,\n    showMetadata,\n} from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { first, map } from 'rxjs/operators';\n\nimport { notifyError } from 'libs/common/src/lib/notifications';\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport { RoomConfiguration } from 'libs/common/src/lib/room-configuration.interface';\n\nimport { Building } from './building.class';\nimport { BuildingLevel } from './level.class';\nimport { Organisation } from './organisation.class';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class OrganisationService {\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    private readonly _buildings = new BehaviorSubject<Building[]>([]);\n    private readonly _active_building = new BehaviorSubject<Building>(null);\n    private readonly _levels = new BehaviorSubject<BuildingLevel[]>([]);\n\n    /** Observable for the list of buildings */\n    public readonly building_list = this._buildings.asObservable();\n    /** Observable for the list of levels */\n    public readonly level_list = this._levels.asObservable();\n    /** Observable for the currently active building */\n    public readonly active_building = this._active_building.asObservable();\n    /** Observable for the levels associated with the currently active building */\n    public readonly active_levels = combineLatest([\n        this._levels,\n        this._active_building,\n    ]).pipe(map(([_, bld]) => (bld ? this.levelsForBuilding(bld) : [])));\n    /** Organisation data for the application */\n    private _organisation: Organisation;\n    /** Mapping of organisation settings overrides */\n    private _settings: Record<string, any>[] = [];\n    /** Mapping of buildings to settings overrides */\n    private _building_settings: Record<string, Record<string, any>> = {};\n\n    /** Mapping of organisation settings overrides */\n    public get settings() {\n        return this._settings;\n    }\n\n    /** Mapping of builgins to settings overrides */\n    public get building_settings() {\n        return this._building_settings;\n    }\n\n    /** Mapping building settings overrides */\n    public buildingSettings(bld_id: string = ''): Record<string, any> {\n        if (!bld_id && this.building) {\n            bld_id = this.building.id;\n        }\n        return this._building_settings\n            ? this._building_settings[bld_id] || {}\n            : {};\n    }\n\n    /** Organisation data for the application */\n    public get organisation(): Organisation {\n        return this._organisation;\n    }\n\n    /** List of available buildings */\n    public get buildings(): Building[] {\n        return this._buildings.getValue();\n    }\n\n    /** Currently active building */\n    public get building(): Building {\n        return this._active_building.getValue();\n    }\n    public set building(bld: Building) {\n        this._active_building.next(bld);\n        this._service.overrides = [\n            ...this._settings,\n            this.buildingSettings(bld.id).details,\n        ];\n    }\n\n    public get currency_code(): string {\n        return (\n            this._service.get('app.currency') || this.building.currency || 'USD'\n        );\n    }\n\n    /** Get binding value from the building/organisation */\n    public binding(name: string) {\n        return (\n            this.building?.bindings[name] || this._organisation?.bindings[name]\n        );\n    }\n\n    /** Get building by id */\n    public find(id: string) {\n        return this.buildings.find((i) => i.id === id);\n    }\n\n    /** List of available levels */\n    public get levels(): BuildingLevel[] {\n        return this._levels.getValue();\n    }\n\n    constructor(private _service: SettingsService, private _router: Router) {\n        onlineState()\n            .pipe(first((_) => _))\n            .subscribe(() => setTimeout(() => this.init(), 1000));\n        this.active_building.subscribe((bld) => {\n            if (bld) {\n                this._service.overrides = [\n                    ...this._settings,\n                    this.buildingSettings(bld.id),\n                ];\n            }\n        });\n    }\n\n    /**\n     * Get level with a matching ID\n     * @param id_list List of IDs to find a match\n     */\n    public levelWithID(id_list: string[]): BuildingLevel {\n        return this.levels.find((lvl) => id_list?.includes(lvl.id));\n    }\n\n    /**\n     * Get list of levels for the given building\n     * @param bld Building to list levels for\n     */\n    public levelsForBuilding(bld: Building = this.building): BuildingLevel[] {\n        return this.levels.filter((lvl) => lvl.parent_id === bld?.id);\n    }\n\n    private async init(tries: number = 0) {\n        this._initialised.next(false);\n        await this.load().catch((err) => {\n            notifyError('Error loading organisation data. Retrying...');\n            setTimeout(() => this.init(tries), Math.min(10_000, 300 * ++tries));\n            throw err;\n        });\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.orgs = this;\n        }\n    }\n\n    /**\n     * Initialise service data\n     */\n    private async load(): Promise<void> {\n        await this.loadOrganisation();\n        await this.loadBuildings();\n        await this.loadLevels();\n        await this.loadSettings();\n    }\n\n    /**\n     * Load organisation data for application\n     */\n    public async loadOrganisation(): Promise<void> {\n        const org_list = await queryZones({ tags: 'org' })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (org_list.length) {\n            const auth = authority();\n            const org =\n                org_list.find(\n                    (list) => isMock() || list.id === auth?.config?.org_zone\n                ) || org_list[0];\n            const bindings: Record<string, any> = (\n                await showMetadata(org.id, 'bindings').toPromise()\n            )?.details;\n            this._organisation = new Organisation({ ...org, bindings });\n        } else {\n            this._router.navigate(['/misconfigured']);\n        }\n    }\n\n    /**\n     * Load buildings data for the organisation\n     */\n    public async loadBuildings(): Promise<void> {\n        const building_list = await queryZones({\n            tags: 'building',\n            limit: 500,\n        } as any)\n            .pipe(\n                map((i) =>\n                    i.data.filter((_) => _.parent_id === this._organisation?.id)\n                )\n            )\n            .toPromise();\n        if (!building_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const buildings = [];\n        for (const bld of building_list) {\n            const bindings: Record<string, any> = (\n                await showMetadata(bld.id, 'bindings').toPromise()\n            )?.details;\n            buildings.push(new Building({ ...bld, bindings }));\n        }\n        this._buildings.next(buildings);\n    }\n\n    /**\n     * Load levels data for the buildings\n     */\n    public async loadLevels(): Promise<void> {\n        const level_list = await queryZones({\n            tags: 'level',\n            limit: 2500,\n        } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (!level_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const levels = level_list.map((lvl) => new BuildingLevel(lvl));\n        levels.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\n        this._levels.next(levels);\n    }\n\n    public get available_room_configs(): RoomConfiguration[] {\n        return this.buildings\n            .map((m) => [...m.room_configurations])\n            .reduce((prev, curr) => prev.concat(curr), [])\n            .sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    public async loadSettings() {\n        if (!this._organisation) return;\n        const app_name = `${(\n            this._service.app_name || 'workplace'\n        ).toLowerCase()}_app`;\n        const app_settings = await showMetadata(\n            this._organisation.id,\n            app_name\n        ).toPromise();\n        const global_settings = await showMetadata(\n            this._organisation.id,\n            'settings'\n        ).toPromise();\n        this._settings = [global_settings.details, app_settings.details];\n        const buildings = this.buildings;\n        for (const bld of buildings) {\n            this._building_settings[bld.id] = await showMetadata(\n                bld.id,\n                app_name\n            ).toPromise();\n        }\n        this._service.overrides = [...this._settings];\n        await this._initialiseActiveBuilding();\n        this._service.overrides = [\n            ...this._settings,\n            this.buildingSettings(this.building.id).details,\n        ];\n    }\n\n    /** Save building selection */\n    public saveBuilding(id: string) {\n        localStorage.setItem(`PLACEOS.building`, id);\n    }\n\n    private _initialiseActiveBuilding() {\n        return new Promise<void>((resolve) => {\n            const id = localStorage.getItem(`PLACEOS.building`);\n            if (id && this.buildings.find((bld) => bld.id === id)) {\n                this._active_building.next(\n                    this.buildings.find((bld) => bld.id === id)\n                );\n                return;\n            }\n            const use_location = !!this._service.get('app.use_geolocation');\n            console.log(\n                'Use Geolocation:',\n                use_location,\n                'geolocation' in navigator\n            );\n            if (use_location && 'geolocation' in navigator) {\n                navigator.geolocation.getCurrentPosition((position) => {\n                    const { latitude, longitude } = position.coords;\n                    console.log('Location:', +latitude, +longitude);\n                    let closest_bld = null;\n                    for (const bld of this.buildings) {\n                        if (!closest_bld) closest_bld = bld;\n                        else {\n                            const [c_lat, c_long] = (\n                                closest_bld.location || '0,0'\n                            ).split(',');\n                            const [b_lat, b_long] = (\n                                bld.location || '0,0'\n                            ).split(',');\n                            const b_dist = Math.sqrt(\n                                Math.pow(latitude - +b_lat, 2) +\n                                    Math.pow(longitude - +b_long, 2)\n                            );\n                            const c_dist = Math.sqrt(\n                                Math.pow(latitude - +c_lat, 2) +\n                                    Math.pow(longitude - +c_long, 2)\n                            );\n                            if (b_dist < c_dist) closest_bld = bld;\n                            console.log('Building Location:', +b_lat, +b_long);\n                        }\n                    }\n                    if (closest_bld) this.building = closest_bld;\n                    console.log('Closest:', closest_bld);\n                    if (!this.building?.id) this._setDefaultBuilding();\n                    resolve();\n                });\n            } else if (!this.building?.id) {\n                this._setDefaultBuilding();\n                resolve();\n            }\n        });\n    }\n\n    private _setDefaultBuilding() {\n        if (!this.buildings.length) return;\n        const bld_id = this._service.get('app.default_building');\n        this.building =\n            this.buildings.find(({ id }) => id === bld_id) || this.buildings[0];\n    }\n}\n","\nimport { generateMockBuilding } from './building.utilities';\n\nlet ORG_COUNT = 0;\n\nexport function generateMockOrganisation(): Record<string, any> {\n    return {\n        id: `zone_org-${ORG_COUNT++}`,\n        name: `Organisation ${ORG_COUNT}`,\n        buildings: Array(3).fill(0).map(i => generateMockBuilding()),\n        settings: {\n            test: {\n                nested: {\n                    org: true\n                }\n            }\n        }\n    };\n}\n","export * from './lib/payments.module';\nexport * from './lib/payments.service';\nexport * from './lib/card-input-field.component';","import { DatePipe } from '@angular/common';\nimport { Component, ElementRef, forwardRef, ViewChild } from '@angular/core';\nimport {\n    ControlValueAccessor,\n    FormControl,\n    FormGroup,\n    NG_VALUE_ACCESSOR,\n    Validators,\n} from '@angular/forms';\nimport { BaseClass } from '@placeos/common';\nimport { addYears, setMonth } from 'date-fns';\n\nexport interface PaymentCardDetails {\n    card_number: string;\n    cardholder: string;\n    cvv: string;\n    exp_month: string;\n    exp_year: string;\n}\n\nconst BLANK_CARD = { card_number: '                ', cardholder: '', cvv: '' };\nconst DATE_PIPE = new DatePipe('en-us', '');\n\n@Component({\n    selector: 'card-input-field',\n    template: `\n        <form [formGroup]=\"details\" (window:keyup)=\"onInput($event)\">\n            <div class=\"flex flex-col\">\n                <label for=\"card-number\">Card Number</label>\n                <div\n                    tabindex=\"0\"\n                    class=\"border border-gray-200 p-2 h-12 mb-4 focus-within:shadow focus-within:border-black flex items-center font-mono w-full rounded relative\"\n                    (focus)=\"focusInput()\"\n                >\n                    <pre class=\"flex-1\">{{ card_display }}</pre>\n                    <input\n                        #input\n                        class=\"hidden absolute\"\n                        type=\"tel\"\n                        [value]=\"details.value.card_number?.trim()\"\n                        (keydown)=\"(false)\"\n                        maxlength=\"17\"\n                    />\n                    <img\n                        *ngIf=\"card_type\"\n                        [src]=\"'assets/icons/' + card_type + '.svg'\"\n                        class=\"h-8\"\n                    />\n                </div>\n            </div>\n            <div class=\"flex flex-col flex-1\">\n                <label for=\"cardholder\">Name on Card</label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        name=\"cardholder\"\n                        matInput\n                        placeholder=\"Mr John Smith\"\n                        formControlName=\"cardholder\"\n                    />\n                    <mat-error>Cardholder name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"flex items-center space-x-2\">\n                <div class=\"flex flex-col flex-1 w-1/4\">\n                    <label for=\"cardholder\">Expiry Month</label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            placeholder=\"MM\"\n                            formControlName=\"exp_month\"\n                        >\n                            <mat-option\n                                *ngFor=\"let item of months\"\n                                [value]=\"item[0]\"\n                            >\n                                {{ item[1] }} ({{ item[0] }})\n                            </mat-option>\n                        </mat-select>\n                        <mat-error>Expiry month is required</mat-error>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col flex-1 w-1/4\">\n                    <label for=\"cardholder\">Expiry Year</label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            placeholder=\"YYYY\"\n                            formControlName=\"exp_year\"\n                        >\n                            <mat-option\n                                *ngFor=\"let item of years\"\n                                [value]=\"item\"\n                                >{{ item }}</mat-option\n                            >\n                        </mat-select>\n                        <mat-error>Expiry year is required</mat-error>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label for=\"cvv\">CVV</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-20\">\n                        <input\n                            name=\"cvv\"\n                            matInput\n                            formControlName=\"cvv\"\n                            maxlength=\"4\"\n                        />\n                        <mat-error>Invalid security code</mat-error>\n                    </mat-form-field>\n                </div>\n            </div>\n        </form>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.25rem;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => CardInputFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class CardInputFieldComponent\n    extends BaseClass\n    implements ControlValueAccessor\n{\n    public details = new FormGroup({\n        card_number: new FormControl(Array(16).fill('X').join()),\n        cardholder: new FormControl(''),\n        exp_month: new FormControl(''),\n        exp_year: new FormControl(''),\n        cvv: new FormControl('', [\n            Validators.minLength(3),\n            Validators.maxLength(4),\n        ]),\n    });\n    public disabled = false;\n\n    public readonly months = Array(12)\n        .fill(0)\n        .map((_, idx) => [\n            DATE_PIPE.transform(setMonth(Date.now(), idx), 'MM'),\n            DATE_PIPE.transform(setMonth(Date.now(), idx), 'MMM'),\n        ]);\n    public readonly years = Array(12)\n        .fill(0)\n        .map((_, idx) =>\n            DATE_PIPE.transform(addYears(Date.now(), idx), 'yyyy')\n        );\n    public readonly digits = Array(16).fill(0);\n    private _index = 0;\n\n    @ViewChild('input', { static: true })\n    private _input_el!: ElementRef<HTMLInputElement>;\n\n    private _onChange?: (_: PaymentCardDetails) => void;\n    private _onTouch?: (_: PaymentCardDetails) => void;\n\n    public get is_amex() {\n        const no = this.details.value?.card_number || '';\n        return no.startsWith('3');\n    }\n\n    public get card_type() {\n        const no = this.details.value?.card_number || '';\n        if (no.startsWith('3')) return 'amex';\n        if (no.startsWith('4')) return 'visa';\n        if (no.startsWith('5')) return 'mastercard';\n        return '';\n    }\n\n    public get card_display() {\n        let no = this.details.value?.card_number || '';\n        if (this.card_focused)\n            no =\n                no.substring(0, this._index) +\n                '' +\n                no.substring(this._index + 1);\n        return this.is_amex\n            ? `${no.substring(0, 4)}-${no.substring(4, 10)}-${no.substring(10)}`\n            : `${no.substring(0, 4)}-${no.substring(4, 8)}-${no.substring(\n                  8,\n                  12\n              )}-${no.substring(12)}`;\n    }\n\n    public get card_focused() {\n        return (\n            document.activeElement === this._input_el.nativeElement ||\n            document.activeElement ===\n                this._input_el.nativeElement.parentElement\n        );\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'changes',\n            this.details.valueChanges.subscribe((v) =>\n                this.timeout('update', () => this.setValue(this.details.getRawValue()))\n            )\n        );\n    }\n\n    public focusInput() {\n        this._input_el.nativeElement.focus();\n        this._index = this._input_el.nativeElement.selectionStart || 0;\n    }\n\n    public onInput(event: KeyboardEvent) {\n        if (!event || !this.card_focused) return;\n        const idx = this._index;\n        if (idx < 0 || idx > 16) return;\n        let card_number = this.details.value.card_number!;\n        if (\n            (event.code.startsWith('Digit') ||\n                event.code.startsWith('Numpad')) &&\n            idx < (this.is_amex ? 15 : 16)\n        ) {\n            card_number =\n                card_number.substring(0, idx) +\n                event.key +\n                card_number.substring(idx + 1);\n            this.details.patchValue({ card_number });\n            this._focusChange(idx, 1);\n        } else if (event.code === 'Backspace' && idx > 0) {\n            let card_number = this.details.value.card_number!;\n            card_number =\n                card_number.substring(0, idx) +\n                ' ' +\n                card_number.substring(idx + 1);\n            this.details.patchValue({ card_number });\n            this._focusChange(idx, -1);\n        } else if (event.code === 'ArrowLeft') {\n            this._focusChange(idx, -1);\n        } else if (event.code === 'ArrowRight' && card_number[idx] !== ' ') {\n            this._focusChange(idx, 1);\n        }\n    }\n\n    private _focusChange(idx: number, dir: 1 | -1) {\n        this._index = Math.min(16, Math.max(0, idx + dir));\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: PaymentCardDetails) {\n        if (this._onChange) this._onChange(new_value);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value?: PaymentCardDetails) {\n        this.details.patchValue(value || BLANK_CARD);\n    }\n\n    public readonly registerOnChange = (fn: (_: PaymentCardDetails) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: PaymentCardDetails) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n}\n","import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { OrganisationService } from '@placeos/organisation';\nimport { Observable } from 'rxjs';\nimport { PaymentCardDetails } from './card-input-field.component';\n\nexport interface PaymentData {\n    type: string; // Resource Type\n    resource_name: string;\n    date: number;\n    duration: number;\n    all_day: boolean;\n    has_payment_method: boolean;\n    rate: string;\n    amount: number; // Number in cents\n    loading: Observable<string>;\n    makePayment: (_?: PaymentCardDetails) => Promise<void>;\n}\n\n@Component({\n    selector: 'payment-modal',\n    template: `\n        <div\n            class=\"relative max-h-[100vh] overflow-auto\"\n            *ngIf=\"!(loading | async); else load_state\"\n        >\n            <ng-container *ngIf=\"!success; else success_state\">\n                <main\n                    class=\"px-4 pt-8 w-[24rem] space-y-2 flex flex-col items-center relative\"\n                >\n                    <h2 class=\"text-2xl font-medium\">Booking Payment</h2>\n                    <img src=\"assets/icons/cost.svg\" class=\"w-1/2\" />\n                    <p class=\"text-sm text-center pb-2\">\n                        You are requesting a {{ details.type }} booking in\n                        {{ details.resource_name }} for\n                        {{ details.date | date: 'mediumDate' }}\n                        <ng-container *ngIf=\"!details.all_day\">\n                            between {{ details.date | date: 'shortTime' }} and\n                            {{\n                                details.date + details.duration * 60 * 1000\n                                    | date: 'shortTime'\n                            }}\n                        </ng-container>\n                    </p>\n                    <p class=\"text-sm\">You booking will cost:</p>\n                    <p class=\"text-lg font-medium text-center\">\n                        <strong>{{ details.amount / 100 | currency:code }}</strong>\n                    </p>\n                    <card-input-field\n                        class=\"w-full\"\n                        [(ngModel)]=\"card_details\"\n                    ></card-input-field>\n                </main>\n                <footer class=\"p-4\">\n                    <button\n                        mat-button\n                        class=\"w-full\"\n                        (click)=\"processPayment()\"\n                    >\n                        Make Payment\n                    </button>\n                </footer>\n                <button\n                    mat-icon-button\n                    mat-dialog-close\n                    class=\"absolute top-1 left-1\"\n                >\n                    <i class=\"material-icons text-2xl\">close</i>\n                </button>\n            </ng-container>\n        </div>\n        <ng-template #load_state>\n            <div\n                class=\"w-full h-full flex flex-col items-center justify-center p-8\"\n            >\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>{{ loading | async }}</p>\n            </div>\n        </ng-template>\n        <ng-template #success_state>\n            <main\n                class=\"px-8 pt-8 w-[24rem] flex flex-col relative\"\n            >\n                <h2 class=\"text-2xl font-medium\">Payment Successful</h2>\n                <h3 class=\"text-xl font-medium mb-2\">Ref #{{ transaction_id }}</h3>\n                <p>{{ details.amount / 100 | currency:code }} paid.</p>\n                <p>{{ details.resource_name }} booked.</p>\n                <p>{{ details.date | date: 'mediumDate' }}</p>\n                <p>\n                    {{ details.date | date: 'shortTime' }} and\n                    {{\n                        details.date + details.duration * 60 * 1000\n                            | date: 'shortTime'\n                    }}\n                </p>\n            </main>\n            <img src=\"assets/icons/payment-confirmed.svg\" class=\"w-full\" />\n            <footer class=\"p-4 border-t border-gray-200\">\n                <button mat-button mat-dialog-close class=\"w-full\">\n                    Great, thanks.\n                </button>\n            </footer>\n            <ng-template></ng-template\n        ></ng-template>\n    `,\n    styles: [``],\n})\nexport class PaymentModalComponent {\n    @Output() public readonly event = new EventEmitter();\n    public readonly details = this._data;\n    public readonly loading = this._data.loading;\n    public card_details?: PaymentCardDetails;\n    public success = false;\n    public transaction_id = '12345678';\n\n    public get code() {\n        return this._org.currency_code;\n    }\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: PaymentData, private _org: OrganisationService) {}\n\n    public async processPayment() {\n        if (!this.card_details || !this._validCardDetails()) return;\n        this.event.emit(this.card_details);\n        await this._data.makePayment(this.card_details);\n        this.success = true;\n    }\n\n    private _validCardDetails() {\n        return (\n            (this.card_details?.cardholder.length || 0) > 0 &&\n            (this.card_details?.cvv.length || 0) >= 3\n        );\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { PaymentModalComponent } from './payment-modal.component';\nimport { CardInputFieldComponent } from './card-input-field.component';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nconst COMPONENTS = [\n    PaymentModalComponent, \n    CardInputFieldComponent\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatDialogModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatButtonModule,\n        MatSelectModule,\n        MatProgressSpinnerModule\n    ],\n    exports: [...COMPONENTS],\n})\nexport class PaymentsModule {}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { currentUser, SettingsService } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { getModule } from '@placeos/ts-client';\nimport { BehaviorSubject, of } from 'rxjs';\nimport { shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { PaymentCardDetails } from './card-input-field.component';\nimport { PaymentModalComponent } from './payment-modal.component';\n\nexport interface PaymentDetails {\n    type: string; // Resource Type\n    resource_name: string;\n    date: number;\n    duration: number;\n    all_day: boolean;\n}\n\nexport interface PaymentResult {\n    success: boolean;\n    state: 'processing' | 'pending' | 'approved';\n    invoice_id: string;\n    amount: number;\n    created_at: number;\n    updated_at: number;\n}\n\nexport const STRIPE_ID_TOKEN = 'STRIPE+customer_id';\nconst STRIPE_MODULE = 'Payment';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class PaymentsService {\n    private _loading = new BehaviorSubject('');\n    private _active_card = new BehaviorSubject('');\n\n    public readonly loading = this._loading.asObservable();\n\n    public readonly payment_sources = of(1).pipe(\n        switchMap(() => {\n            const mod = getModule(this.payment_module, STRIPE_MODULE);\n            if (!mod) return of([]);\n            return mod.execute('list_payment_methods', ['card']);\n        }),\n        tap((_) => (_[0] ? this._active_card.next(_[0].id) : '')),\n        shareReplay(1)\n    );\n\n    public get payment_module() {\n        return this._org.binding('payments');\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {}\n\n    public async makePayment(\n        details: PaymentDetails\n    ): Promise<PaymentResult | undefined> {\n        if (!this.payment_module) throw 'Payments not enabled';\n        const [cost, period] = await this._getCostOfProduct(\n            details?.type\n        ).catch((_) => [0, 60]);\n        if (cost <= 0) return;\n\n        let customer_id = this._settings.get('STRIPE_Customer_ID');\n        if (!customer_id) customer_id = await this._newCustomerID();\n        this._settings.saveUserSetting('STRIPE_Customer_ID', customer_id);\n        const amount = cost * (details.duration / period);\n        let result = undefined;\n        const makePayment = async (c: any) => {\n            result = await this._processPayment(amount, customer_id, c).catch(\n                (e) => {\n                    this._loading.next('');\n                    throw e;\n                }\n            );\n        };\n        const data = {\n            ...details,\n            rate: `$${(cost / 100).toFixed(2)} per hour`,\n            amount,\n            makePayment,\n            loading: this.loading,\n        };\n        const ref = this._dialog.open(PaymentModalComponent, { data });\n        await ref.afterClosed().toPromise();\n        return result;\n    }\n\n    private async _addPaymentMethod(card: PaymentCardDetails): Promise<string> {\n        const mod = getModule(this.payment_module, STRIPE_MODULE);\n        if (!mod) throw 'Unable to load module';\n        const payment_method = await mod.execute('add_payment_method', [\n            'card',\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            card,\n        ]);\n        return payment_method.id || payment_method;\n    }\n\n    private async _getCostOfProduct(type: string) {\n        let price: [number, number] = [0, 60];\n        const mod = getModule(this.payment_module, STRIPE_MODULE);\n        if (!mod) return price;\n        const product_list = await mod.execute('get_product_prices', [\n            null,\n            null,\n            type,\n        ]);\n        if (!product_list.length) return price;\n\n        return price;\n    }\n\n    private async _processPayment(\n        amount: number,\n        customer_id: string,\n        card_details?: PaymentCardDetails\n    ) {\n        this._loading.next('Checking payment method...');\n        console.log('Getting payment method...');\n        const source = card_details\n            ? await this._addPaymentMethod(card_details)\n            : this._active_card.getValue();\n        if (!source) throw 'No payment source selected';\n        this._loading.next('Processing payment...');\n        console.log('Processing payment...');\n        const mod = getModule(this.payment_module, STRIPE_MODULE);\n        if (!mod) throw 'Unable to load module';\n        const id = await mod.execute<string>('create_payment_intent', [\n            amount,\n            this._org.building.currency || 'USD',\n            null,\n            null,\n            customer_id,\n            null,\n            null,\n            null,\n            currentUser()?.email,\n        ]);\n        if (!id) throw 'Failed to create payment';\n        console.log('Confirming payment...');\n        await mod.execute('confirm_payment_intent', [id, source]);\n        this._loading.next('');\n        return {\n            success: true,\n            state: 'approved',\n            invoice_id: id,\n            amount: amount,\n            created_at: Date.now(),\n            updated_at: Date.now(),\n        };\n    }\n\n    private async _newCustomerID() {\n        const mod = getModule(this.payment_module, STRIPE_MODULE);\n        if (!mod) throw 'Unable to load module';\n        const user = currentUser();\n        const id = await mod.execute<string>('create_customer', [\n            0,\n            null,\n            null,\n            null,\n            `${user.id}|${user.name}|FromPlaceOS`,\n            user.email,\n        ]);\n        return id;\n    }\n}\n","export * from './lib/spaces.module';\nexport * from './lib/spaces';\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Space } from './space.class';\n\n@Component({\n    selector: 'a-space-select-item',\n    template: `\n        <div\n            space\n            class=\"w-full flex items-center p-2 space-x-2 border-b border-gray-100\"\n            *ngIf=\"space\"\n        >\n            <div class=\"flex-1 w-1/2\">\n                <div class=\"text-base truncate\">{{ space.name }}</div>\n                <div class=\"text-xs\">\n                    {{ space.level?.display_name || space.level?.name }}\n                </div>\n            </div>\n            <div class=\"flex items-center\" *ngIf=\"space.capacity !== -1\">\n                <app-icon>account_circle</app-icon>\n                <div>{{ space.capacity }}</div>\n            </div>\n            <button\n                mat-icon-button\n                *ngIf=\"multiple; else single_button\"\n                (click)=\"action.emit()\"\n            >\n                <app-icon>{{\n                    type === 'available' ? 'add' : 'close'\n                }}</app-icon>\n            </button>\n        </div>\n        <ng-template #single_button>\n            <button mat-button class=\"w-32\" [class.request]=\"space.by_request\">\n                {{ space.by_request ? 'Request' : 'Book' }}\n            </button>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SpaceSelectItemComponent {\n    /** Space to display the details */\n    @Input() public space: Space;\n    /** Selected state for the space */\n    @Input() public type: 'available' | 'selected';\n    /** Whether user is allowed to select multiple spaces */\n    @Input() public multiple: boolean;\n    /** Emitter for selection actions */\n    @Output() public action = new EventEmitter();\n}\n","import { Component, Inject, Output, EventEmitter } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { addMinutes, getUnixTime } from 'date-fns';\n\nimport {\n    BaseClass,\n    currentUser,\n    DialogEvent,\n    HashMap,\n    Identity,\n    SettingsService,\n} from '@placeos/common';\nimport { Building, OrganisationService } from '@placeos/organisation';\n\nimport { filterSpacesFromRules } from 'libs/events/src/lib/helpers';\nimport { querySpaceAvailability } from 'libs/calendar/src/lib/calendar.fn';\nimport { Space } from './space.class';\n\nexport interface SpaceSelectModalData {\n    /** List of currently selected spaces */\n    readonly spaces: Space[];\n    /** Selected date to check space availability */\n    readonly date: number;\n    /** Duration of the availability that is desired */\n    readonly duration: number;\n    all_day?: boolean;\n    visitor_type?: string;\n}\n\n@Component({\n    selector: 'a-space-select-modal',\n    template: `\n        <header>\n            <app-icon class=\"text-3xl\">place</app-icon>\n            <div class=\"text-xl font-semibold flex-1\">\n                Select space{{ multiple ? 's' : '' }}\n            </div>\n            <button mat-icon-button mat-dialog-close>\n                <app-icon class=\"text-3xl\">close</app-icon>\n            </button>\n        </header>\n        <main>\n            <mat-form-field\n                appearance=\"outline\"\n                *ngIf=\"buildings && buildings.length > 1\"\n            >\n                <mat-select\n                    name=\"booking-type\"\n                    [ngModel]=\"building.getValue()\"\n                    (ngModelChange)=\"building.next($event)\"\n                    placeholder=\"Select building\"\n                >\n                    <mat-option *ngFor=\"let bld of buildings\" [value]=\"bld\">\n                        {{ bld.display_name || bld.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <mat-form-field\n                appearance=\"outline\"\n                *ngIf=\"space_types && space_types.length > 1\"\n            >\n                <mat-select\n                    name=\"booking-type\"\n                    [(ngModel)]=\"type\"\n                    placeholder=\"Any space type\"\n                >\n                    <mat-option\n                        *ngFor=\"let type of space_types\"\n                        [value]=\"type.id\"\n                    >\n                        {{ type.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <div class=\"body\" style=\"width: 32rem\">\n                <ng-container *ngIf=\"!loading; else load_state\">\n                    <ng-container\n                        *ngIf=\"\n                            (filtered_spaces | async)?.length;\n                            else empty_state\n                        \"\n                    >\n                        <ng-container\n                            *ngFor=\"let space of filtered_spaces | async\"\n                        >\n                            <a-space-select-item\n                                *ngIf=\"!space_map[space.id]\"\n                                [space]=\"space\"\n                                [multiple]=\"multiple\"\n                                type=\"available\"\n                                (click)=\"spaceSelected(space)\"\n                            ></a-space-select-item>\n                        </ng-container>\n                    </ng-container>\n                </ng-container>\n                <div\n                    class=\"space-list\"\n                    *ngIf=\"multiple\"\n                    [class.show]=\"show_selected\"\n                >\n                    <ng-container\n                        *ngIf=\"spaces && spaces.length; else empty_state\"\n                    >\n                        <a-space-select-item\n                            *ngFor=\"let space of spaces\"\n                            [space]=\"space\"\n                            [multiple]=\"multiple\"\n                            type=\"selected\"\n                        ></a-space-select-item>\n                    </ng-container>\n                </div>\n            </div>\n            <footer *ngIf=\"multiple\">\n                <button mat-button (click)=\"save()\">\n                    Save selected spaces({{ spaces.length || '0' }})\n                </button>\n            </footer>\n            <ng-template #empty_state>\n                <div empty class=\"p-16 flex flex-col items-center space-y-2\">\n                    <app-icon class=\"text-3xl\">close</app-icon>\n                    <p>No spaces</p>\n                </div>\n            </ng-template>\n            <ng-template #load_state>\n                <div load class=\"p-16 flex flex-col items-center space-y-2\">\n                    <mat-spinner diameter=\"48\"></mat-spinner>\n                    <p>Finding available spaces...</p>\n                </div>\n            </ng-template>\n        </main>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.5em;\n                width: 100%;\n                padding: 0 0.25em;\n            }\n\n            .body {\n                min-width: 20rem;\n                max-width: calc(100vw - 2rem);\n                max-height: 65vh;\n                overflow: auto;\n            }\n        `,\n    ],\n})\nexport class SpaceSelectModalComponent extends BaseClass {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** List of selected spaces */\n    public spaces: Space[] = [...(this._data.spaces || [])];\n    /** Building to filter available spaces */\n    public building = new BehaviorSubject<Building>(null);\n    /** Whether to show selected spaces */\n    public show_selected: boolean;\n    /** List of available space types */\n    public space_types: Identity[] = [];\n    /** ID of the space type to filter available spaces on */\n    public type: string;\n    /** Whether the available spaces are being loaded */\n    public loading: boolean;\n\n    public readonly available_spaces = combineLatest([this.building]).pipe(\n        switchMap(([bld]) => {\n            this.loading = true;\n            return querySpaceAvailability({\n                zone_ids: bld?.id,\n                period_start: getUnixTime(this._data.date),\n                period_end: getUnixTime(\n                    addMinutes(this._data.date, this._data.duration)\n                ),\n            });\n        }),\n        shareReplay(1)\n    );\n\n    public readonly filtered_spaces = this.available_spaces.pipe(\n        map((list) =>\n            filterSpacesFromRules(\n                list,\n                { ...this._data, host: currentUser() } as any,\n                this._org.building.booking_rules\n            )\n        ),\n        tap(() => (this.loading = false))\n    );\n\n    public get buildings(): Building[] {\n        return this._org.buildings;\n    }\n\n    /** Whether multiple spaces can be selected */\n    public get multiple(): boolean {\n        return !!this._settings.get('app.events.multiple_spaces');\n    }\n\n    /** Mapping of spaces to whether they are selected */\n    public get space_map(): HashMap<boolean> {\n        const spaces = {};\n        this.spaces.forEach((space) => (spaces[space.id] = true));\n        return spaces;\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        @Inject(MAT_DIALOG_DATA) private _data: SpaceSelectModalData\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.building.next(this._org.building || this.buildings[0]);\n        this.subscription(\n            'spaces',\n            this.filtered_spaces.subscribe((_) => _)\n        );\n    }\n\n    public spaceSelected(space: Space) {\n        if (this.multiple) {\n            if (!this.space_map[space.id]) {\n                this.spaces.push(space);\n            }\n        } else {\n            this.spaces = [space];\n            this.save();\n        }\n    }\n\n    public save() {\n        this.event.emit({ reason: 'done', metadata: this.spaces });\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from '@placeos/common';\nimport {\n    EventFlowOptions,\n    EventFormService,\n} from 'libs/events/src/lib/event-form.service';\nimport { Space } from '../space.class';\n\n@Component({\n    selector: 'new-space-select-modal',\n    template: `\n        <div\n            class=\"absolute inset-0 sm:relative sm:inset-none flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <header class=\"flex items-center space-x-4 w-full\">\n                <button mat-icon-button mat-dialog-close class=\"bg-black/20\">\n                    <app-icon>close</app-icon>\n                </button>\n                <h3>Find Space</h3>\n            </header>\n            <main\n                class=\"flex-1 flex items-center divide-x divide-gray-200 dark:divide-neutral-500 min-h-[65vh] h-[65vh] sm:max-h-[65vh] sm:max-w-[95vw] w-full overflow-hidden\"\n            >\n                <space-filters\n                    class=\"h-full hidden sm:flex max-w-[20rem] sm:h-[65vh] sm:max-h-full\"\n                ></space-filters>\n                <div\n                    class=\"flex flex-col items-center flex-1 w-1/2 h-full sm:h-[65vh]\"\n                >\n                    <space-filters-display\n                        class=\"w-full border-b border-gray-200 dark:border-neutral-500\"\n                        [(view)]=\"view\"\n                    ></space-filters-display>\n                    <space-list\n                        *ngIf=\"view === 'list'; else map_view\"\n                        [active]=\"displayed?.id\"\n                        [selected]=\"selected_ids\"\n                        [favorites]=\"favorites\"\n                        (toggleFav)=\"toggleFavourite($event)\"\n                        (onSelect)=\"displayed = $event\"\n                        class=\"flex-1 h-1/2 bg-black/5 dark:bg-white/10\"\n                    ></space-list>\n                </div>\n                <space-details\n                    [space]=\"displayed\"\n                    class=\"h-full w-full sm:h-[65vh] absolute sm:relative sm:flex sm:max-w-[20rem] z-20 bg-white dark:bg-neutral-600 block\"\n                    [class.hidden]=\"!displayed\"\n                    [class.inset-0]=\"displayed\"\n                    [active]=\"selected_ids.includes(displayed?.id)\"\n                    (activeChange)=\"setSelected(displayed, $event)\"\n                    [fav]=\"displayed && this.favorites.includes(displayed?.id)\"\n                    (toggleFav)=\"toggleFavourite(displayed)\"\n                    (close)=\"displayed = null\"\n                ></space-details>\n            </main>\n            <footer\n                class=\"flex sm:hidden flex-col-reverse items-center justify-end p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    return\n                    class=\"inverse sm:hidden w-full\"\n                    *ngIf=\"displayed\"\n                    (click)=\"displayed = null\"\n                >\n                    Back\n                </button>\n                <button\n                    mat-button\n                    save\n                    [mat-dialog-close]=\"selected\"\n                    [class.mb-2]=\"displayed\"\n                    class=\"w-full sm:w-32 sm:mb-0\"\n                >\n                    View List\n                </button>\n            </footer>\n            <footer\n                class=\"hidden sm:flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    mat-button\n                    [mat-dialog-close]=\"selected\"\n                    class=\"clear text-primary\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">arrow_back</app-icon>\n                        <div class=\"mr-1 underline\">Back to form</div>\n                    </div>\n                </button>\n                <p class=\"opacity-60 text-sm\">\n                    {{ selected.length }} room(s) added\n                </p>\n                <button\n                    mat-button\n                    [disabled]=\"!displayed\"\n                    [class.inverse]=\"isSelected(displayed?.id)\"\n                    (click)=\"setSelected(displayed, !isSelected(displayed?.id))\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">{{\n                            isSelected(displayed?.id) ? 'remove' : 'add'\n                        }}</app-icon>\n                        <div class=\"mr-1\">\n                            {{\n                                isSelected(displayed?.id)\n                                    ? 'Remove from Booking'\n                                    : 'Add to booking'\n                            }}\n                        </div>\n                    </div>\n                </button>\n            </footer>\n        </div>\n        <ng-template #map_view>\n            <space-map\n                class=\"flex-1 h-1/2 w-full\"\n                [selected]=\"selected_ids\"\n                [is_displayed]=\"!!displayed\"\n                (onSelect)=\"displayed = $event\"\n            >\n            </space-map>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class NewSpaceSelectModalComponent {\n    public displayed?: Space;\n    public selected: Space[] = [];\n    public view = 'list';\n\n    public get selected_ids() {\n        return this.selected.map((_) => _.id).join(',');\n    }\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_spaces') || [];\n    }\n\n    constructor(\n        private _dialog_ref: MatDialogRef<NewSpaceSelectModalComponent>,\n        private _settings: SettingsService,\n        private _event_form: EventFormService,\n        @Inject(MAT_DIALOG_DATA)\n        _data: { spaces: Space[]; options: Partial<EventFlowOptions> }\n    ) {\n        this.selected = [...(_data.spaces || [])];\n        this._event_form.setOptions(_data.options);\n    }\n\n    public isSelected(id: string) {\n        return id && this.selected_ids.includes(id);\n    }\n\n    public setSelected(item: Space, state: boolean) {\n        const list = this.selected.filter((_) => _.id !== item.id);\n        if (state) list.push(item);\n        this.selected = list;\n        if (!this._settings.get('app.events.allow_multiple_spaces') && state) {\n            this._dialog_ref.close([item]);\n        }\n    }\n\n    public toggleFavourite(item: Space) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(item.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_spaces', [\n                ...fav_list,\n                item.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_spaces',\n                fav_list.filter((_) => _ !== item.id)\n            );\n        }\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { MapPinComponent } from '@placeos/components';\nimport { OrganisationService } from '@placeos/organisation';\nimport { ViewerFeature } from '@placeos/svg-viewer';\nimport { Space } from '../space.class';\n\n@Component({\n    selector: `space-details`,\n    template: `\n        <ng-container *ngIf=\"space; else empty_state\">\n            <section image class=\"relative w-full h-64 sm:h-40 bg-black/20\">\n                <image-carousel\n                    [images]=\"space.images\"\n                    class=\"absolute inset-0\"\n                ></image-carousel>\n                <button\n                    mat-icon-button\n                    close\n                    (click)=\"close.emit()\"\n                    class=\"absolute top-2 left-2 bg-black/40 sm:hidden text-white\"\n                >\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <button\n                    mat-icon-button\n                    fav\n                    [class.text-white]=\"!fav\"\n                    [class.text-blue-400]=\"fav\"\n                    (click)=\"toggleFav.emit()\"\n                    class=\"absolute top-2 right-2 bg-black/40\"\n                >\n                    <app-icon>{{\n                        fav ? 'favorite' : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </section>\n            <div class=\"p-2 space-y-2 flex-1 h-1/2 overflow-auto\">\n                <section actions class=\"z-0\">\n                    <h2 class=\"text-xl font-medium mb-2 mt-4\">\n                        {{ space.display_name || space.name }}\n                    </h2>\n                </section>\n                <hr />\n                <section details class=\"space-y-2\">\n                    <h2 class=\"text-xl font-medium\">Details</h2>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>people</app-icon>\n                        <p>{{ space.capacity }} People</p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>meeting_room</app-icon>\n                        <p>\n                            {{ level?.display_name || level?.name }}\n                        </p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>place</app-icon>\n                        <p>{{ building?.address || building?.display_name || building?.name }}</p>\n                    </div>\n                </section>\n                <hr />\n                <section facilities class=\"space-y-2\">\n                    <h2 class=\"text-xl font-medium\">Room Facilities</h2>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>people</app-icon>\n                        <p>WiFi Available</p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>restaurant</app-icon>\n                        <p>Catering Available</p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>edit</app-icon>\n                        <p>Whiteboard</p>\n                    </div>\n                </section>\n                <section\n                    map\n                    class=\"w-full mx-auto h-64 sm:h-48 relative border border-gray-200 overflow-hidden rounded\"\n                >\n                    <interactive-map\n                        class=\"pointer-events-none\"\n                        [src]=\"map_url\"\n                        [features]=\"features\"\n                        [options]=\"{ disable_pan: true, disable_zoom: true }\"\n                    ></interactive-map>\n                </section>\n            </div>\n            <div class=\"p-2 border-t border-gray-200 shadow sm:hidden\">\n                <button\n                    mat-button\n                    [class.inverse]=\"active\"\n                    class=\"w-full\"\n                    (click)=\"active = !active; activeChange.emit(active)\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <app-icon class=\"text-2xl\">{{ active ? 'remove' : 'add' }}</app-icon>\n                        <p>\n                            {{ active ? 'Remove this room' : 'Add this room' }}\n                        </p>\n                    </div>\n                </button>\n            </div>\n        </ng-container>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    Select a room to view it's details\n                </p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 30%;\n                min-width: 20rem;\n                height: 100%;\n                min-height: 65vh;\n            }\n        `,\n    ],\n})\nexport class SpaceDetailsComponent {\n    @Input() public space?: Space;\n    @Input() public fav: boolean = false;\n    @Input() public active: boolean = false;\n\n    @Output() public activeChange = new EventEmitter<boolean>();\n    @Output() public close = new EventEmitter<void>();\n    @Output() public toggleFav = new EventEmitter<void>();\n\n    public map_url = '';\n    public features: ViewerFeature[] = [];\n\n    public get level() {\n        return this._org.levelWithID(this.space?.zones) || this.space?.level;\n    }\n\n    public get building() {\n        return this._org.buildings.find(_ => this.space?.zones.includes(_.id));\n    }\n\n    constructor(private _org: OrganisationService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.space && this.space) {\n            this._updateFeature();\n        }\n    }\n\n    private _updateFeature() {\n        this.map_url = this.level?.map_id;\n        this.features = [\n            {\n                location: this.space?.map_id,\n                content: MapPinComponent,\n            },\n        ];\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatBottomSheet } from '@angular/material/bottom-sheet';\nimport { BaseClass } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { OrganisationService } from '@placeos/organisation';\nimport { take } from 'rxjs/operators';\nimport { SpaceFiltersComponent } from './space-filters.component';\n\n@Component({\n    selector: `space-filters-display`,\n    template: `\n        <section actions class=\"sm:hidden space-x-2 flex items-center p-2\">\n            <button\n                mat-button\n                filters\n                class=\"flex-1 w-1/2\"\n                (click)=\"editFilters()\"\n            >\n                Filters\n            </button>\n            <div class=\"flex items-center\">\n                <button\n                    mat-button\n                    map\n                    class=\"rounded-l rounded-r-none\"\n                    [class.inverse]=\"view !== 'map'\"\n                    (click)=\"view = 'map'; viewChange.emit(view)\"\n                >\n                    Map\n                </button>\n                <button\n                    mat-button\n                    list\n                    class=\"rounded-r rounded-l-none\"\n                    [class.inverse]=\"view !== 'list'\"\n                    (click)=\"view = 'list'; viewChange.emit(view)\"\n                >\n                    List\n                </button>\n            </div>\n        </section>\n        <section filters class=\"flex items-center flex-wrap p-2\">\n            <div\n                filter-item\n                zone\n                class=\"dark:border-neutral-500\"\n                *ngIf=\"location\"\n            >\n                {{ location }}\n            </div>\n            <div filter-item date class=\"dark:border-neutral-500\">\n                {{ start | date: 'mediumDate' }}\n            </div>\n            <div filter-item time class=\"dark:border-neutral-500\">\n                {{ start | date: 'shortTime' }} &mdash;\n                {{ end | date: 'shortTime' }}\n            </div>\n            <div filter-item count class=\"dark:border-neutral-500\">\n                Min. {{ (options | async)?.capcaity || 2 }} People\n            </div>\n            <div filter-item *ngFor=\"let feat of (options | async)?.features\">\n                <p>{{ feat }}</p>\n                <button\n                    mat-icon-button\n                    class=\"-mr-4 dark:border-neutral-500\"\n                    (click)=\"removeFeature(feat)\"\n                >\n                    <app-icon>close</app-icon>\n                </button>\n            </div>\n        </section>\n    `,\n    styles: [\n        `\n            [filter-item] {\n                display: flex;\n                align-items: center;\n                padding: 0 1rem;\n                height: 2rem;\n                font-size: 0.875rem;\n                border: 1px solid rgba(0, 0, 0, 0.2);\n                border-radius: 1.25rem;\n                margin-right: 0.5rem;\n                margin-bottom: 0.5rem;\n            }\n\n            [filter-item]:hover {\n                background: rgba(0, 0, 0, 0.1);\n            }\n\n            [filter-item] > * + * {\n                margin-left: 0.5rem;\n            }\n        `,\n    ],\n})\nexport class SpaceFiltersDisplayComponent extends BaseClass {\n    @Input() public view: 'map' | 'list' = 'list';\n    @Output() public viewChange = new EventEmitter<'map' | 'list'>();\n    public readonly options = this._event_form.options;\n    public location: string = '';\n\n    public get start() {\n        return this._event_form.form.value.date;\n    }\n\n    public get end() {\n        const { date, duration } = this._event_form.form.value;\n        return date + duration * 60 * 1000;\n    }\n\n    public readonly editFilters = () =>\n        this._bsheet.open(SpaceFiltersComponent);\n\n    constructor(\n        private _bsheet: MatBottomSheet,\n        private _event_form: EventFormService,\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'opts',\n            this.options.subscribe(({ zone_ids }) =>\n                this._updateLocation(zone_ids)\n            )\n        );\n    }\n\n    public async removeFeature(feat: string) {\n        const value = await this._event_form.options.pipe(take(1)).toPromise();\n        this._event_form.setOptions({\n            ...value,\n            features: (value.features || []).filter((_) => _ !== feat),\n        });\n    }\n\n    private _updateLocation(zone_ids: string[] = []) {\n        const level = this._org.levelWithID(zone_ids);\n        const item = level || this._org.building;\n        this.location = item?.display_name || item?.name || '';\n    }\n}\n","import { Component, Optional } from '@angular/core';\nimport { MatBottomSheetRef } from '@angular/material/bottom-sheet';\nimport { flatten, SettingsService, unique } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { OrganisationService } from '@placeos/organisation';\nimport { combineLatest } from 'rxjs';\nimport { map, take } from 'rxjs/operators';\nimport { SpacesService } from '../spaces.service';\n\n@Component({\n    selector: `space-filters`,\n    template: `\n        <div class=\"flex items-center border-b border-gray-200 pb-2 sm:hidden\">\n            <div class=\"flex-1 pl-2\">\n                <button\n                    mat-icon-button\n                    close\n                    *ngIf=\"can_close\"\n                    (click)=\"close()\"\n                >\n                    <app-icon>keyboard_arrow_left</app-icon>\n                </button>\n            </div>\n            <h3 class=\"font-medium flex-2 text-center\">Space Filters</h3>\n            <div class=\"flex-1\"></div>\n        </div>\n        <form\n            class=\"max-h-[65vh] p-2 overflow-y-auto overflow-x-hidden divide-y divide-gray-200 w-full max-w-[100vw]\"\n            [formGroup]=\"form\"\n        >\n            <section details>\n                <h2 class=\"text-lg font-medium\">Details</h2>\n                <div class=\"flex-1 min-w-[256px] flex flex-col\">\n                    <label for=\"location\">Location</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"location\"\n                            [ngModel]=\"(options | async)?.zone_ids\"\n                            (ngModelChange)=\"setOptions({ zone_ids: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                            [placeholder]=\"bld?.display_name || bld?.name\"\n                            [multiple]=\"true\"\n                        >\n                            <mat-option\n                                *ngFor=\"let lvl of levels | async\"\n                                [value]=\"lvl.id\"\n                            >\n                                {{ lvl.bld }},\n                                {{ lvl.display_name || lvl.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex-1 min-w-[256px]\">\n                    <label for=\"date\">Date<span>*</span></label>\n                    <a-date-field name=\"date\" formControlName=\"date\">\n                        Date and time must be in the future\n                    </a-date-field>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <div class=\"flex-1 w-1/3\">\n                        <label for=\"start-time\">Start Time<span>*</span></label>\n                        <a-time-field\n                            name=\"start-time\"\n                            [ngModel]=\"form.value.date\"\n                            (ngModelChange)=\"form.patchValue({ date: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        ></a-time-field>\n                    </div>\n                    <div class=\"flex-1 w-1/3\">\n                        <label for=\"end-time\">End Time<span>*</span></label>\n                        <a-duration-field\n                            name=\"end-time\"\n                            formControlName=\"duration\"\n                            [time]=\"form?.value?.date\"\n                            [max]=\"max_duration\"\n                        >\n                        </a-duration-field>\n                    </div>\n                </div>\n            </section>\n            <section favs class=\"space-y-2 pb-4\">\n                <h2 class=\"text-lg font-medium\">Favourites</h2>\n                <div class=\"flex items-center\">\n                    <div for=\"fav\" class=\"flex-1 w-1/2\">\n                        Only show favourite rooms\n                    </div>\n                    <mat-checkbox\n                        name=\"fav\"\n                        [ngModel]=\"(options | async)?.show_fav\"\n                        (ngModelChange)=\"setOptions({ show_fav: $event })\"\n                        [ngModelOptions]=\"{ standalone: true }\"\n                    >\n                    </mat-checkbox>\n                </div>\n            </section>\n            <section\n                features\n                class=\"space-y-2\"\n                *ngIf=\"(features | async)?.length\"\n            >\n                <h2 class=\"text-lg font-medium\">Facilities</h2>\n                <div\n                    class=\"flex items-center\"\n                    *ngFor=\"let feat of features | async\"\n                >\n                    <div for=\"feat\" class=\"flex-1 w-1/2\">{{ feat }}</div>\n                    <mat-checkbox\n                        name=\"feat\"\n                        [ngModel]=\"(options | async)?.features?.includes(feat)\"\n                        (ngModelChange)=\"toggleFeature(feat, $event)\"\n                        [ngModelOptions]=\"{ standalone: true }\"\n                    ></mat-checkbox>\n                </div>\n            </section>\n        </form>\n        <div\n            class=\"px-2 pt-2 w-full border-t border-gray-200\"\n            *ngIf=\"can_close\"\n        >\n            <button mat-button close class=\"w-full\" (click)=\"close()\">\n                Apply Filters\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 100%;\n                max-width: 100vw;\n            }\n        `,\n    ],\n})\nexport class SpaceFiltersComponent {\n    public can_close = false;\n    public readonly options = this._event_form.options;\n\n    public readonly levels = this._org.level_list.pipe(\n        map((l) => {\n            for (const lvl of l) {\n                const bld = this._org.buildings.find(\n                    (_) => _.id === lvl.parent_id\n                );\n                (lvl as any).bld = bld?.display_name || bld?.name || '';\n            }\n            return l;\n        })\n    );\n    public readonly features = combineLatest([\n        this._spaces.features,\n        this._event_form.available_spaces,\n    ]).pipe(\n        map(([features, spaces]) =>\n            unique(features.concat(flatten(spaces.map((_) => _.features))))\n        )\n    );\n\n    public readonly close = () => this._bsheet_ref.dismiss();\n    public readonly setOptions = (o) => this._event_form.setOptions(o);\n\n    public get bld() {\n        return this._org.building;\n    }\n\n    public get form() {\n        return this._event_form.form;\n    }\n\n    public get max_duration() {\n        return this._settings.get('app.events.max_duration') || 480;\n    }\n\n    constructor(\n        @Optional()\n        private _bsheet_ref: MatBottomSheetRef<SpaceFiltersComponent>,\n        private _settings: SettingsService,\n        private _event_form: EventFormService,\n        private _org: OrganisationService,\n        private _spaces: SpacesService\n    ) {\n        this.can_close = !!this._bsheet_ref;\n    }\n\n    public async toggleFeature(feat: string, state: boolean) {\n        const { features } = await this.options.pipe(take(1)).toPromise();\n        const new_list = (features || []).filter((_) => feat !== _);\n        if (state) new_list.push(feat);\n        this.setOptions({ features: new_list });\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { EventFormService } from '@placeos/events';\nimport { Space } from '../space.class';\n\n@Component({\n    selector: `space-list`,\n    template: `\n        <h3 class=\"font-bold\">Results</h3>\n        <p count class=\"text-sm opacity-60 mb-4\">\n            {{ (available_spaces | async)?.length || 0 }} result(s) found\n        </p>\n        <ng-container *ngIf=\"!(loading | async); else load_state\">\n            <ul\n                class=\"list-style-none space-y-2\"\n                *ngIf=\"(available_spaces | async)?.length; else empty_state\"\n            >\n                <li\n                    space\n                    *ngFor=\"let space of available_spaces | async\"\n                    [class.!border-blue-400]=\"active === space.id\"\n                    class=\"relative p-2 rounded-lg w-full shadow border bg-white dark:bg-neutral-700 border-gray-200 dark:border-neutral-500\"\n                >\n                    <button\n                        matRipple\n                        select\n                        class=\"w-full h-full flex items-center\"\n                        (click)=\"selectSpace(space)\"\n                    >\n                        <div\n                            class=\"relative w-20 h-20 rounded-xl bg-black/20 dark:bg-white/30 mr-4 overflow-hidden\"\n                        >\n                            <div\n                                class=\"absolute top-1 left-1 border border-white bg-black/50 rounded-full h-6 w-6 flex items-center justify-center text-white\"\n                                *ngIf=\"selected.includes(space.id)\"\n                            >\n                                <app-icon>done</app-icon>\n                            </div>\n                            <img *ngIf=\"space.images?.length\" class=\"object-cover h-full\" [src]=\"space.images[0]\" />\n                        </div>\n                        <div class=\"space-y-2\">\n                            <div class=\"font-medium truncate mr-10\">\n                                {{ space.display_name || space.name || 'Meeting Space' }}\n                            </div>\n                            <div class=\"flex items-center text-sm space-x-2\">\n                                <app-icon class=\"text-blue-500\">place</app-icon>\n                                <p>{{ space.location || space.level?.display_name || space.level?.name }}</p>\n                            </div>\n                            <div class=\"flex items-center text-sm space-x-2\">\n                                <app-icon class=\"text-blue-500\"\n                                    >people</app-icon\n                                >\n                                <p>\n                                    {{\n                                        space.capacity < 1 ? 2 : space.capacity\n                                    }}\n                                    People\n                                </p>\n                            </div>\n                        </div>\n                    </button>\n                    <button\n                        mat-icon-button\n                        fav\n                        class=\"absolute top-1 right-1\"\n                        [class.text-blue-400]=\"isFavourite(space.id)\"\n                        (click)=\"toggleFav.emit(space)\"\n                    >\n                        <app-icon>{{ isFavourite(space.id) ? 'favorite' : 'favorite_border' }}</app-icon>\n                    </button>\n                </li>\n            </ul>\n        </ng-container>\n        <ng-template #empty_state>\n            <div empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    No available spaces for selected time and/or filters\n                </p>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div loading\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"opacity-30\">Finding available spaces...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n                height: 100%;\n                padding: 0.5rem;\n                overflow: auto;\n            }\n        `,\n    ],\n})\nexport class SpaceListComponent {\n    @Input() public active: string = '';\n    @Input() public selected: string = '';\n    @Input() public favorites: string[] = [];\n    @Output() public onSelect = new EventEmitter<Space>();\n    @Output() public toggleFav = new EventEmitter<Space>();\n\n    public readonly available_spaces = this._event_form.available_spaces;\n    public readonly loading = this._event_form.loading;\n\n    constructor(\n        private _event_form: EventFormService\n    ) {}\n\n    public ngOnInit() {\n        this._event_form.setView('find');\n    }\n\n    public isFavourite(space_id: string) {\n        return this.favorites.includes(space_id);\n    }\n\n    public selectSpace(space: Space) {\n        this.onSelect.emit(space);\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAP_FEATURE_DATA } from '@placeos/components';\n\n@Component({\n    selector: 'space-location-pin',\n    template: `\n        <div class=\"absolute bottom-0 left-1/2 -translate-x-1/2\">\n            <svg\n                width=\"66\"\n                height=\"80\"\n                viewBox=\"0 0 66 80\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n            >\n                <g filter=\"url(#filter0_d_1065_10313)\">\n                    <path\n                        d=\"M19.724 53.0408C25.0871 60.3435 30.5582 65.8583 31.0184 66.3178C31.4558 66.755 32.0489 67.0007 32.6674 67.0008H32.6678C33.2863 67.0007 33.8795 66.755 34.3169 66.3178C34.7771 65.8583 40.2481 60.3435 45.6112 53.0408C48.2928 49.3894 50.963 45.2701 52.9663 41.0957C54.9629 36.935 56.3331 32.6459 56.3342 28.6724C56.364 25.5564 55.7725 22.4657 54.5941 19.5809C53.415 16.6946 51.6722 14.0724 49.4675 11.8677C47.2629 9.66308 44.6407 7.92024 41.7544 6.74121C38.8711 5.5634 35.782 4.97184 32.6676 5.00103C29.5533 4.97184 26.4642 5.5634 23.5809 6.74121C20.6946 7.92024 18.0724 9.66308 15.8677 11.8677C13.6631 14.0724 11.9202 16.6946 10.7412 19.5809C9.56278 22.4657 8.97122 25.5565 9.00108 28.6726C9.0022 32.646 10.3724 36.9351 12.369 41.0957C14.3723 45.2701 17.0425 49.3894 19.724 53.0408Z\"\n                        fill=\"#309251\"\n                        stroke=\"#0B421D\"\n                        stroke-width=\"2\"\n                    />\n                </g>\n                <defs>\n                    <filter\n                        id=\"filter0_d_1065_10313\"\n                        x=\"0\"\n                        y=\"0\"\n                        width=\"65.3353\"\n                        height=\"80.001\"\n                        filterUnits=\"userSpaceOnUse\"\n                        color-interpolation-filters=\"sRGB\"\n                    >\n                        <feFlood\n                            flood-opacity=\"0\"\n                            result=\"BackgroundImageFix\"\n                        />\n                        <feColorMatrix\n                            in=\"SourceAlpha\"\n                            type=\"matrix\"\n                            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n                            result=\"hardAlpha\"\n                        />\n                        <feOffset dy=\"4\" />\n                        <feGaussianBlur stdDeviation=\"4\" />\n                        <feComposite in2=\"hardAlpha\" operator=\"out\" />\n                        <feColorMatrix\n                            type=\"matrix\"\n                            values=\"0 0 0 0 0.0196078 0 0 0 0 0.109804 0 0 0 0 0.172549 0 0 0 0.2 0\"\n                        />\n                        <feBlend\n                            mode=\"normal\"\n                            in2=\"BackgroundImageFix\"\n                            result=\"effect1_dropShadow_1065_10313\"\n                        />\n                        <feBlend\n                            mode=\"normal\"\n                            in=\"SourceGraphic\"\n                            in2=\"effect1_dropShadow_1065_10313\"\n                            result=\"shape\"\n                        />\n                    </filter>\n                </defs>\n            </svg>\n            <div\n                class=\"absolute top-0 left-0 w-full h-3/4 flex items-center justify-center\"\n            >\n                <div\n                    class=\"relative z-10 h-4 w-4 rounded-full bg-white border-2 border-[#0B421D]\"\n                    *ngIf=\"!selected\"\n                ></div>\n                <app-icon class=\"relative text-white z-10 text-2xl\" *ngIf=\"selected\">\n                    done\n                </app-icon>\n            </div>\n        </div>\n    `,\n    styles: [],\n})\nexport class SpaceLocationPinComponent {\n    public get selected() {\n        return this._data.selected === true;\n    }\n    constructor(@Inject(MAP_FEATURE_DATA) private _data: any) {}\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { BaseClass, unique } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { BuildingLevel } from '@placeos/organisation';\nimport { debounceTime, map } from 'rxjs/operators';\nimport { Space } from '../space.class';\nimport { SpaceLocationPinComponent } from './space-location-pin.component';\n\n@Component({\n    selector: `space-map`,\n    template: `\n        <i-map\n            *ngIf=\"!is_displayed\"\n            [src]=\"map_url\"\n            [features]=\"features | async\"\n            [actions]=\"actions | async\"\n            [(zoom)]=\"zoom\"\n            [(center)]=\"center\"\n        ></i-map>\n        <div\n            class=\"absolute inset-x-0 top-0 bg-white p-2 border-b border-gray-200\"\n        >\n            <mat-form-field levels appearance=\"outline\" class=\"w-full h-[3.25rem]\">\n                <mat-select [(ngModel)]=\"level\">\n                    <mat-option\n                        *ngFor=\"let opt of levels | async\"\n                        [value]=\"opt\"\n                    >\n                        {{ opt.display_name || opt.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n        </div>\n        <div\n            zoom\n            class=\"absolute bottom-2 right-2 rounded-lg border border-gray-200 bg-white flex flex-col overflow-hidden\"\n        >\n            <button zoom-in mat-icon-button (click)=\"setZoom(zoom * 1.1)\">\n                <app-icon>zoom_in</app-icon>\n            </button>\n            <div class=\"border-t border-gray-200 w-full\"></div>\n            <button\n                zoom-out\n                mat-icon-button\n                (click)=\"setZoom(zoom * (1 / 1.1))\"\n            >\n                <app-icon>zoom_out</app-icon>\n            </button>\n            <div class=\"border-t border-gray-200 w-full\"></div>\n            <button reset mat-icon-button (click)=\"resetMap()\">\n                <app-icon>refresh</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n                background: rgba(0, 0, 0, 0.05);\n                padding-top: 4rem;\n            }\n\n            button {\n                border-radius: 0;\n            }\n        `,\n    ],\n})\nexport class SpaceSelectMapComponent extends BaseClass {\n    @Input() public selected: string[] = [];\n    @Input() public is_displayed: boolean = false;\n    @Output() public onSelect = new EventEmitter<Space>();\n\n    public zoom = 1;\n    public center = { x: 0.5, y: 0.5 };\n\n    private _seletedSpace = (s) => () => this.onSelect.emit(s);\n    public level: BuildingLevel = null;\n\n    public get map_url() {\n        return this.level?.map_id || '';\n    }\n\n    public readonly levels = this._event_form.available_spaces.pipe(\n        map((_) => unique(_.map(({ level }) => level)))\n    );\n\n    public readonly features = this._event_form.available_spaces.pipe(\n        debounceTime(1000),\n        map((l) =>\n            l.map((space) => ({\n                location: space.map_id,\n                content: SpaceLocationPinComponent,\n                data: {\n                    ...space,\n                    selected: this.selected.includes(space.id),\n                },\n            }))\n        )\n    );\n\n    public readonly actions = this._event_form.available_spaces.pipe(\n        map((l) =>\n            l.map((space) => ({\n                id: space.map_id,\n                action: ['touchend', 'mouseup'],\n                callback: this._seletedSpace(space),\n            }))\n        )\n    );\n\n    constructor(private _event_form: EventFormService) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'spaces',\n            this._event_form.available_spaces.subscribe((_) => {\n                if (!this.level && _.length) this.level = _[0].level;\n            })\n        );\n    }\n\n    public setZoom(new_zoom: number) {\n        this.zoom = Math.max(0.5, Math.min(10, new_zoom));\n    }\n\n    public resetMap() {\n        this.zoom = 1;\n        this.center = { x: 0.5, y: 0.5 };\n    }\n}\n","import { RoomConfiguration } from '@placeos/common';\nimport { BuildingLevel } from '@placeos/organisation';\n\nimport { CalendarAvailability } from 'libs/calendar/src/lib/calendar.interfaces';\n\nexport type ResourceResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted';\n\nexport class Space {\n    /** ID of the space resource */\n    public readonly id: string;\n    /** Display name of the space resource */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Email address of the resource associated with space */\n    public readonly email: string;\n    /** Capacity of the space resource */\n    public readonly capacity: number;\n    /** List of features available at the space resource  */\n    public readonly feature_list: string[];\n    /** URL to a supporting site for space */\n    public readonly support_url: string;\n    /** ID of the space on the associated map */\n    public readonly map_id: string;\n    /** Whether resource is bookable */\n    public readonly bookable: boolean;\n    /** List of zones the spaces is associated with */\n    public readonly zones: string[];\n    /** List of available room configurations for this room */\n    public readonly configurations: readonly RoomConfiguration[];\n    /** Image url */\n    public readonly images: string[];\n    /** Status of the resource */\n    public readonly response_status: ResourceResponseStatus;\n    /** Level Assoicated with the space */\n    public readonly level: BuildingLevel;\n    /** List of features associated with the space */\n    public readonly features: string[];\n\n    public readonly availability: CalendarAvailability[];\n\n    constructor(data: Partial<Space> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.display_name = data.display_name || '';\n        this.email = (data.email || '').toLowerCase();\n        this.capacity = data.capacity || -1;\n        this.feature_list = data.feature_list || (data.features as any) || [];\n        this.bookable = !!data.bookable;\n        this.zones = data.zones || [];\n        this.support_url = data.support_url || '';\n        this.map_id = data.map_id || '';\n        this.images = data.images || [];\n        this.configurations = data.configurations || [];\n        this.features = data.features || [];\n        this.response_status = data.response_status;\n        this.level = data.level || new BuildingLevel();\n        this.availability = data.availability || [];\n    }\n}\n","import { Pipe } from '@angular/core';\nimport { querySystems, showSystem } from '@placeos/ts-client';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { Space } from './space.class';\n\nconst SPACE_LIST: Space[] = [];\n\nconst EMPTY_SPACE = new Space();\n\n@Pipe({\n    name: 'space',\n})\nexport class SpacePipe {\n    constructor(private _org: OrganisationService) {}\n    /**\n     * Get details of the space with the given ID\n     * @param space_id ID or Email of the space\n     */\n    public async transform(space_id: string): Promise<Space> {\n        const is_email = space_id?.includes('@');\n        if (!space_id) return EMPTY_SPACE;\n        let space = SPACE_LIST.find(\n            ({ id, email }) => id === space_id || email === space_id\n        );\n        if (space) return space;\n        if (!is_email) {\n            const system = await showSystem(space_id)\n                .toPromise()\n                .catch((_) => null);\n            if (system) {\n                space = new Space({\n                    ...(system as any),\n                    level: this._org.levelWithID([...system.zones]),\n                });\n                SPACE_LIST.push(space);\n                return space;\n            }\n        }\n        const systems = (await querySystems({ q: space_id }).toPromise()).data;\n        if (systems.length === 1) {\n            space = new Space({\n                ...(systems[0] as any),\n                level: this._org.levelWithID([...systems[0].zones]),\n            });\n            SPACE_LIST.push(space);\n            return space;\n        }\n        return EMPTY_SPACE;\n    }\n\n    public updateSpaceList(space_list: Space[]) {\n        for (const space of space_list) {\n            if (!SPACE_LIST.find(({ id }) => id === space.id)) {\n                SPACE_LIST.push(space);\n            }\n        }\n    }\n}\n","import { HashMap, predictableRandomInt } from '@placeos/common';\nimport { USER_DOMAIN } from '../../../users/src/lib/user.utilities';\n\nlet SPACE_COUNT: number = 0;\n/* istanbul ignore next */\nexport function generateMockSpace(overrides: HashMap = {}): HashMap {\n    const id = `space-${SPACE_COUNT++}`;\n    const name = `Test Space ${SPACE_COUNT}`;\n    const linked = predictableRandomInt(99999) % 2 === 0 && SPACE_COUNT > 1;\n    const space = {\n        id,\n        name,\n        long_name: `${name} with an long name`,\n        map_id: `${SPACE_COUNT}`,\n        capacity: predictableRandomInt(21, 1) * 2,\n        email: `${name.toLowerCase().split(' ').join('.')}@${USER_DOMAIN}`,\n        type: '',\n        searchable: predictableRandomInt(99999) % 2 === 0,\n        controlable: predictableRandomInt(99999) % 2 === 0,\n        bookable: predictableRandomInt(99999) % 2 === 0,\n        cost_hour: predictableRandomInt(300) * 100,\n        setup: predictableRandomInt(6) * 5,\n        breakdown: predictableRandomInt(6) * 5,\n        zones: ['zone_lvl-0'],\n        support_url: `/control/#/panel/${id}`,\n        bookings: [], //Array(10).fill(0).map(i => generateMockBooking()),\n        linked_rooms: linked\n            ? [`space-${predictableRandomInt(SPACE_COUNT - 1)}`]\n            : [],\n        image: '',\n        ...overrides,\n    };\n    if (space['configurations'] && space['configurations'].length > 0) {\n        space['configurations'].forEach(\n            (config) =>\n                (config.capacity = predictableRandomInt(space.capacity) + 1)\n        );\n        space['configurations'][0].capacity = space.capacity;\n    }\n    return space;\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatBottomSheetModule } from '@angular/material/bottom-sheet';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\n\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\nimport { FormFieldsModule } from 'libs/form-fields/src/lib/form-fields.module';\nimport { NewSpaceSelectModalComponent } from './space-select-modal/new-space-select-modal.component';\n\nimport { SpaceSelectItemComponent } from './space-select-item.component';\nimport { SpaceSelectModalComponent } from './space-select-modal.component';\nimport { SpaceDetailsComponent } from './space-select-modal/space-details.component';\nimport { SpaceListComponent } from './space-select-modal/space-list.component';\nimport { SpaceFiltersComponent } from './space-select-modal/space-filters.component';\nimport { SpaceFiltersDisplayComponent } from './space-select-modal/space-filters-display.component';\nimport { SpaceSelectMapComponent } from './space-select-modal/space-map.component';\n\nimport { SpaceLocationPinComponent } from './space-select-modal/space-location-pin.component';\nimport { SpacePipe } from './space.pipe';\n\nconst COMPONENTS: Type<any>[] = [\n    SpaceSelectModalComponent,\n    SpaceSelectItemComponent,\n    NewSpaceSelectModalComponent,\n\n    SpaceDetailsComponent,\n    SpaceListComponent,\n    SpaceFiltersComponent,\n    SpaceFiltersDisplayComponent,\n    SpaceSelectMapComponent,\n    SpaceLocationPinComponent,\n\n    SpacePipe\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        MatDialogModule,\n        ComponentsModule,\n        FormFieldsModule,\n        MatBottomSheetModule,\n        MatCheckboxModule,\n        FormsModule,\n        ReactiveFormsModule\n    ],\n    providers: [],\n    exports: [...COMPONENTS],\n})\nexport class SharedSpacesModule {}\n","import { Injectable } from '@angular/core';\nimport { querySystems, showSystem } from '@placeos/ts-client';\nimport { first, map } from 'rxjs/operators';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { Space } from './space.class';\nimport { flatten, SettingsService, unique } from '@placeos/common';\nimport { SpacePipe } from './space.pipe';\n\nlet SPACE_PIPE: SpacePipe;\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SpacesService {\n    /** Subject to store list of spaces */\n    private _list = new BehaviorSubject<Space[]>([]);\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    /** Observable for list of spaces */\n    public readonly list = this._list.asObservable();\n    /** List of available features */\n    public readonly features = this.list.pipe(map(_ => unique(flatten(_.map(i => i.features)))));\n    /** Default predicate for filter method */\n    protected _compare = (space: Space) =>\n        space.zones.includes(this._org.building.id);\n\n    /** List of available spaces */\n    public get space_list(): Space[] {\n        return this._list.getValue();\n    }\n\n    constructor(private _org: OrganisationService, private _settings: SettingsService) {\n        SPACE_PIPE = new SpacePipe(_org);\n        this._init();\n    }\n\n    private async _init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        if (!this._settings.get('app.prevent_space_init')) this.loadSpaces();\n        else this._initialised.next(true);\n    }\n\n    /**\n     * Get a filtered list of the available spaces\n     * @param predicate Predicate for filtering spaces\n     */\n    public filter(predicate: (_: Space) => boolean = this._compare) {\n        return this._list.getValue().filter((_) => predicate(_));\n    }\n\n    public async loadSpace(space_id: string) {\n        const system = await showSystem(space_id).toPromise();\n        const space = new Space({\n            ...system as any,\n            level: this._org.levelWithID([...system.zones]),\n        })\n        SPACE_PIPE.updateSpaceList([space]);\n    }\n\n    /**\n     * Find space with given id/email\n     * @param space_id ID/Email address associated with the space\n     */\n    public find(space_id: string) {\n        return this._list.getValue().find(({ id }) => space_id === id);\n    }\n\n    private async loadSpaces(): Promise<void> {\n        const systems = await querySystems({\n            zone_id: this._org.organisation.id,\n            limit: 5000,\n        })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        const space_list = systems.map(\n            (sys) =>\n                new Space({\n                    ...(sys as any),\n                    level: this._org.levelWithID([...sys.zones]),\n                })\n        );\n        // Remove spaces without a map ID\n        const valid_spaces = space_list.filter((space) => space.map_id);\n        this._list.next(valid_spaces);\n        SPACE_PIPE.updateSpaceList(valid_spaces);\n        this._initialised.next(true);\n    }\n}\n","export * from './space-select-item.component';\nexport * from './space-select-modal.component';\nexport * from './space.class';\nexport * from './space.utilities';\nexport * from './spaces.module';\nexport * from './spaces.service';\nexport * from './space-select-modal/new-space-select-modal.component';\n","export * from './lib/users.module';\nexport * from './lib/new-user-modal.component';\nexport * from './lib/find-availability-modal/find-availability-modal.component';\nexport * from './lib/user-form.component';\nexport * from './lib/location.class';\nexport * from './lib/user.class';\nexport * from './lib/user.utilities';\nexport * from './lib/users.module';\nexport * from './lib/guests.fn';\nexport * from './lib/staff.fn';\n","import {\n    Component,\n    ElementRef,\n    Inject,\n    Renderer2,\n    ViewChild,\n} from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BaseClass } from '@placeos/common';\nimport { addMinutes, isSameDay } from 'date-fns';\nimport { User } from '../user.class';\n\nexport interface FindAvailabilityData {\n    host: User;\n    users: User[];\n    date: number;\n    duration: number;\n}\n\n@Component({\n    selector: 'find-availability-modal',\n    template: `\n        <header class=\"relative flex items-center justify-center p-4\">\n            <h2 class=\"text-center\">Find Availability</h2>\n            <button\n                mat-icon-button\n                mat-dialog-close\n                class=\"absolute top-1/2 left-1 -translate-y-1/2\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"flex flex-col h-[calc(100vh-7rem)] sm:h-[65vh]\"\n            (window:resize)=\"updateWidth()\"\n        >\n            <div class=\"w-full flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 p-2\">\n                <a-date-field\n                    [(ngModel)]=\"date\"\n                    class=\"max-h-[3.25rem] flex-1\"\n                ></a-date-field>\n                <a-user-search-field\n                    [(ngModel)]=\"user\"\n                    (ngModelChange)=\"addUser($event)\"\n                    class=\"max-h-[3.25rem] flex-1\"\n                ></a-user-search-field>\n            </div>\n            <div\n                #container\n                class=\"flex flex-1 h-1/2 w-full border-t border-gray-300 dark:border-neutral-500 relative overflow-auto divide-x divide-gray-300 dark:divide-neutral-500 max-w-[100vw] sm:max-w-[80vw]\"\n                (scroll)=\"updateScroll()\"\n            >\n                <div\n                    users\n                    class=\"sticky left-0 min-h-full bg-white dark:bg-neutral-700 border-r border-gray-300 dark:border-neutral-500 z-30\"\n                >\n                    <div\n                        header\n                        class=\"h-10 w-[6rem] border-b border-gray-300 dark:border-neutral-500\"\n                    ></div>\n                    <div\n                        host\n                        class=\"flex flex-col items-center justify-center h-32 w-[6rem] relative border-b border-gray-300 dark:border-neutral-500 py-2\"\n                    >\n                        <a-user-avatar\n                            class=\"text-2xl\"\n                            [user]=\"host\"\n                        ></a-user-avatar>\n                        <div\n                            class=\"text-xs break-words overflow-hidden max-w-full px-2 text-center\"\n                        >\n                            {{ host.name || host.email }}\n                        </div>\n                        <user-availability-list\n                            class=\"absolute top-0 -bottom-px left-full pointer-events-none\"\n                            [user]=\"host\"\n                            [date]=\"date\"\n                            [offset]=\"offset\"\n                            [width]=\"width\"\n                        ></user-availability-list>\n                    </div>\n                    <div\n                        person\n                        class=\"flex flex-col items-center justify-center h-32 w-[6rem] relative border-b border-gray-300 dark:border-neutral-500 py-2\"\n                        *ngFor=\"let user of users\"\n                    >\n                        <a-user-avatar\n                            class=\"text-2xl\"\n                            [user]=\"host\"\n                        ></a-user-avatar>\n                        <div\n                            class=\"text-xs break-words max-w-full px-2 text-center\"\n                        >\n                            {{ user.name || host.email }}\n                        </div>\n                        <button mat-icon-button class=\"absolute -top-1 -left-1\">\n                            <app-icon>close</app-icon>\n                        </button>\n                        <user-availability-list\n                            class=\"absolute top-0 -bottom-px left-full pointer-events-none\"\n                            [user]=\"user\"\n                            [date]=\"date\"\n                            [offset]=\"offset\"\n                            [width]=\"width\"\n                        ></user-availability-list>\n                    </div>\n                </div>\n                <div\n                    [attr.hour]=\"i\"\n                    class=\"min-w-[5rem] bg-gray-50 dark:bg-neutral-600 min-h-full pointer-events-none\"\n                    [attr.disabled]=\"today && i < current_hour\"\n                    *ngFor=\"let h of hours; let i = index\"\n                >\n                    <div header class=\"h-10 border-b border-gray-300 dark:border-neutral-500 p-2\">\n                        {{ i % 12 ? i % 12 : '12' }}{{ i >= 12 ? 'pm' : 'am' }}\n                    </div>\n                </div>\n                <div\n                    selection\n                    class=\"absolute top-10 bottom-0 !border-x-2 !border-blue-500 bg-blue-500/30 z-20 cursor-grab active:cursor-grabbing\"\n                    [style.left]=\"selection_left + 'rem'\"\n                    [style.width]=\"selection_width + 'rem'\"\n                    (mousedown)=\"startMovePeriod($event)\"\n                    (touchstart)=\"startMovePeriod($event)\"\n                >\n                    <div\n                        handle\n                        class=\"absolute top-1/2 -left-px -translate-x-1/2 -translate-y-1/2 h-3 w-3 rounded-full bg-blue-500\"\n                    ></div>\n                    <div\n                        handle\n                        class=\"absolute top-1/2 -right-px translate-x-1/2 -translate-y-1/2 h-3 w-3 rounded-full bg-blue-500 hover:h-4 hover:w-4 active:bg-primary\"\n                        (mousedown)=\"startMoveDuration($event)\"\n                        (touchstart)=\"startMoveDuration($event)\"\n                    ></div>\n                    <div\n                        class=\"bg-white dark:bg-neutral-600 border border-gray-300 dark:border-neutral-500 p-2 absolute top-2 left-1/2 -translate-x-1/2 shadow text-xs whitespace-nowrap rounded\"\n                    >\n                        {{ duration | duration }}\n                    </div>\n                    <div\n                        *ngIf=\"move_time\"\n                        class=\"bg-white dark:bg-neutral-600 border border-gray-300 dark:border-neutral-500 p-2 absolute top-12 left-1/2 -translate-x-1/2 shadow text-xs whitespace-nowrap rounded\"\n                    >\n                        {{ date | date: 'shortTime' }}\n                    </div>\n                </div>\n            </div>\n        </main>\n        <footer\n            class=\"flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n        >\n            <button\n                mat-button\n                [mat-dialog-close]=\"true\"\n                class=\"clear text-primary\"\n            >\n                <div class=\"flex items-center\">\n                    <app-icon class=\"text-xl\">arrow_back</app-icon>\n                    <div class=\"mr-1 underline\">Back to form</div>\n                </div>\n            </button>\n        </footer>\n    `,\n    styles: [\n        `\n            [disabled='true'] {\n                background: rgba(0, 0, 0, 0.05) !important;\n                pointer-events: none;\n            }\n            [disabled='true'] > * {\n                color: rgba(0, 0, 0, 0.3);\n            }\n        `,\n    ],\n})\nexport class FindAvailabilityModalComponent extends BaseClass {\n    public search = '';\n    public date = this._data.date || Date.now();\n    public duration = this._data.duration || 60;\n    public users = [...this._data.users];\n    public user?: User;\n    public offset = 0;\n    public width = 0;\n\n    public readonly host = this._data.host;\n    public readonly hours = new Array(24).fill(0);\n\n    @ViewChild('container', { static: true })\n    private _container_el!: ElementRef<HTMLDivElement>;\n\n    public get today() {\n        return isSameDay(this.date, Date.now());\n    }\n\n    public get current_hour() {\n        return new Date().getHours();\n    }\n\n    public get selection_left() {\n        const date = new Date(this.date);\n        return (date.getHours() + date.getMinutes() / 60) * 5 + 6;\n    }\n\n    public get selection_width() {\n        return (this.duration / 60) * 5;\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: FindAvailabilityData,\n        private _renderer: Renderer2,\n        private _dialog_ref: MatDialogRef<FindAvailabilityModalComponent>\n    ) {\n        super();\n    }\n\n    public addUser(user: User) {\n        this.users = [...this.users.filter(u => u.email !== user.email), user];\n        this.user = null;\n    }\n\n    public closeAndUpdate() {\n        this._dialog_ref.close(true);\n    }\n\n    public ngAfterViewInit() {\n        const date = new Date(this.date);\n        this.timeout(\n            'init',\n            () => {\n                const el = this._container_el.nativeElement.querySelector(\n                    `[hour=\"${date.getHours()}\"]`\n                );\n                if (el) {\n                    const rect =\n                        this._container_el.nativeElement.getBoundingClientRect();\n                    const el_rect = el.getBoundingClientRect();\n                    this._container_el.nativeElement.scrollTo(\n                        el_rect.left - 128 - rect.left,\n                        0\n                    );\n                }\n                this.updateWidth();\n                this.updateScroll();\n            },\n            300\n        );\n    }\n\n    public updateWidth() {\n        const container_size =\n            this._container_el.nativeElement.getBoundingClientRect().width;\n        const user_list_size = this._container_el.nativeElement\n            .querySelector('[users]')\n            .getBoundingClientRect().width;\n        this.width = Math.floor(container_size - user_list_size);\n        this._move_size =\n            this._container_el.nativeElement\n                .querySelector('[hour]')\n                .getBoundingClientRect().width * 24;\n    }\n\n    public updateScroll() {\n        this.offset = this._container_el.nativeElement.scrollLeft;\n    }\n\n    public move_time = false;\n    private _start_time = 0;\n    private _move_last = 0;\n    private _move_size = 0;\n\n    public startMovePeriod(event: MouseEvent | TouchEvent) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.updateWidth();\n        this._move_last =\n            event instanceof MouseEvent\n                ? event.clientX\n                : event.touches[0].clientX;\n        this.move_time = true;\n        this._start_time = this.date;\n        event instanceof MouseEvent\n            ? this.subscription(\n                  'on_move',\n                  this._renderer.listen('window', 'mousemove', (e) =>\n                      this._onMovePeriod(e)\n                  )\n              )\n            : this.subscription(\n                  'on_move',\n                  this._renderer.listen('window', 'touchmove', (e) =>\n                      this._onMovePeriod(e)\n                  )\n              );\n        event instanceof MouseEvent\n            ? this.subscription(\n                  'on_move_end',\n                  this._renderer.listen('window', 'mouseup', () =>\n                      this._onMoveEnd()\n                  )\n              )\n            : this.subscription(\n                  'on_move_end',\n                  this._renderer.listen('window', 'touchend', () =>\n                      this._onMoveEnd()\n                  )\n              );\n    }\n\n    public startMoveDuration(event: MouseEvent | TouchEvent) {\n        event.preventDefault();\n        event.stopPropagation();\n        this.updateWidth();\n        this._move_last =\n            event instanceof MouseEvent\n                ? event.clientX\n                : event.touches[0].clientX;\n        this._start_time = this.duration;\n        event instanceof MouseEvent\n            ? this.subscription(\n                  'on_move',\n                  this._renderer.listen('window', 'mousemove', (e) =>\n                      this._onMoveDuration(e)\n                  )\n              )\n            : this.subscription(\n                  'on_move',\n                  this._renderer.listen('window', 'touchmove', (e) =>\n                      this._onMoveDuration(e)\n                  )\n              );\n        event instanceof MouseEvent\n            ? this.subscription(\n                  'on_move_end',\n                  this._renderer.listen('window', 'mouseup', () =>\n                      this._onMoveEnd()\n                  )\n              )\n            : this.subscription(\n                  'on_move_end',\n                  this._renderer.listen('window', 'touchend', () =>\n                      this._onMoveEnd()\n                  )\n              );\n    }\n\n    private _onMovePeriod(event: MouseEvent | TouchEvent) {\n        const change_px =\n            this._move_last -\n            (event instanceof MouseEvent\n                ? event.clientX\n                : event.touches[0].clientX);\n        const dir = change_px > 0 ? -1 : 1;\n        const change_min =\n            dir *\n            Math.floor(Math.abs((change_px / this._move_size) * 24 * 60) / 5) *\n            5;\n        if (change_min) {\n            const old_date = this.date;\n            this.date = addMinutes(this._start_time, change_min).valueOf();\n            if (this.date < Date.now()) this.date = old_date;\n        }\n    }\n\n    private _onMoveDuration(event: MouseEvent | TouchEvent) {\n        const change_px =\n            this._move_last -\n            (event instanceof MouseEvent\n                ? event.clientX\n                : event.touches[0].clientX);\n        const dir = change_px > 0 ? -1 : 1;\n        const change_min =\n            dir *\n            Math.floor(Math.abs((change_px / this._move_size) * 24 * 60) / 5) *\n            5;\n        if (change_min) {\n            this.duration = Math.max(30, this._start_time + change_min);\n        }\n    }\n\n    private _onMoveEnd() {\n        this.unsub('on_move');\n        this.unsub('on_move_end');\n        this._move_last = 0;\n        this.move_time = false;\n    }\n}\n","import { Component, Input, SimpleChanges } from '@angular/core';\nimport { endOfDay, startOfDay } from 'date-fns';\nimport { BehaviorSubject } from 'rxjs';\nimport { filter, map, shareReplay, switchMap } from 'rxjs/operators';\n\nimport { User } from '../user.class';\nimport { queryEvents } from 'libs/events/src/lib/events.fn';\n\n@Component({\n    selector: 'user-availability-list',\n    template: `\n        <div class=\"overflow-hidden relative border-b border-gray-300 dark:border-neutral-500 h-full pointer-events-none\" [style.width]=\"width + 'px'\">\n            <div class=\"w-[120rem] h-px\"></div>\n            <div\n                event\n                *ngFor=\"let event of availability | async\"\n                class=\"absolute inset-y-0 bg-primary rounded-lg text-white\"\n                [style.left]=\"event.start + '%'\"\n                [style.width]=\"event.size + '%'\"\n            >\n                <div>Unavailable</div>\n                <div>\n                    {{ event.date | date:'shortTime' }} - \n                    {{ event.date + event.duration * 60 * 1000 | date:'shortTime' }}\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class UserAvailabilityComponent {\n    @Input() public user: User;\n    @Input() public date: number = Date.now();\n    @Input() public offset = 0;\n    @Input() public width = 0;\n\n    private _user$ = new BehaviorSubject(null);\n\n    public readonly availability = this._user$.pipe(\n        filter((_) => _),\n        switchMap((user) =>\n            queryEvents({\n                calendars: user.email,\n                period_start: startOfDay(this.date).valueOf(),\n                period_end: endOfDay(this.date).valueOf(),\n            })\n        ),\n        map((_) =>\n            _.map((i) => ({\n                date: i.date,\n                duration: i.duration,\n                start:\n                    (new Date(i.date).getHours() +\n                        new Date(i.date).getMinutes() / 60) /\n                    24,\n                size: i.duration / 60 / 24,\n            }))\n        ),\n        shareReplay(1)\n    );\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.user && this.user) {\n            this._user$.next(this.user);\n        }\n    }\n}\n","import { del, get, patch } from '@placeos/ts-client';\nimport { map } from 'rxjs/operators';\n\nimport { CalendarEvent } from '../../../events/src/lib/event.class';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { GuestUser } from './user.class';\nimport { Observable } from 'rxjs';\n\nconst GUEST_ENDPOINT = '/api/staff/v1/guests';\n\nexport interface GuestsQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zone_ids?: string;\n    /** Comma seperated list of system(space) ids to check availability */\n    system_ids?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n}\n\n/**\n * Search guests\n * @param q Search string for filtering guests\n */\nexport function searchGuests(q: string): Observable<GuestUser[]> {\n    const query = toQueryString({ q });\n    return get(`${GUEST_ENDPOINT}${q ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new GuestUser(item)))\n    );\n}\n\n/**\n * List guests\n * @param q Parameters to pass to the API request\n */\nexport function queryGuests(q: GuestsQueryParams): Observable<GuestUser[]> {\n    const query = toQueryString({ ...q });\n    return get(`${GUEST_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new GuestUser(item)))\n    );\n}\n\n/**\n * Get guest details\n * @param id ID of the guest\n */\nexport function showGuest(id: string) {\n    return get(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new GuestUser(item))\n    );\n}\n\n/**\n * Update guest metadata\n * @param id ID of the guest\n * @param data New metadata state\n */\nexport function updateGuest(id: string, data: Partial<GuestUser>) {\n    return patch(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`, data).pipe(\n        map((item) => new GuestUser(item))\n    );\n}\n\n/**\n * Remove a guest\n * @param id ID of the guest to remove\n */\nexport function removeGuest(id: string) {\n    return del(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`, {\n        response_type: 'void',\n    });\n}\n\n/**\n * List upcoming meetings for a guest\n * @param id ID of the guest\n */\nexport function listGuestMeetings(id: string) {\n    return get(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}/meetings`).pipe(\n        map((list) => list.map((item) => new CalendarEvent(item)))\n    );\n}\n","import { HashMap } from '@placeos/common';\nimport { getUnixTime } from 'date-fns';\n\nexport class MapLocation {\n    /** Source that the location was generated */\n    public type: 'desk' | 'wireless' | 'meeting' | 'other';\n    /** Details of the location */\n    public position: string | { x: number, y: number };\n    /** Accuracy of the location data */\n    public variance: number;\n    /** Unix epoch in seconds that the data was last updated */\n    public last_seen: number;\n    /** ID of the level associated with the location */\n    public level: string;\n    /** ID of the building associated with the location */\n    public building: string;\n    /** Whether user is currently at the location if fixed */\n    public at_location: boolean;\n    /**  */\n    public coordinates_from:\n        | 'top-left'\n        | 'top-right'\n        | 'bottom-left'\n        | 'bottom-right';\n\n    constructor(_data: HashMap = {}) {\n        this.type = _data.type || _data.location || 'other';\n        this.position = _data.position ||\n            _data.map_id || _data.asset_id || {\n                x: _data.x / _data.map_width || 0,\n                y: _data.y / _data.map_height || 0,\n            };\n        this.variance = _data.variance || 0;\n        this.last_seen = _data.last_seen || getUnixTime(new Date());\n        this.level = _data.level;\n        this.building = _data.building;\n        this.at_location = !!_data.at_location;\n        this.coordinates_from = _data.coordinates_from || 'top-left';\n    }\n}\n","import { Component, OnInit, Output, EventEmitter, Inject } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BaseClass, DialogEvent } from '@placeos/common';\n\nimport { User } from './user.class';\nimport { generateUserForm } from './user.utilities';\n\n@Component({\n    selector: 'new-user-modal',\n    template: `\n        <header>\n            <div class=\"heading\" mat-dialog-title>\n                {{ user?.id ? 'Edit' : 'Add' }} External Attendee\n            </div>\n            <div class=\"flex-1\"></div>\n            <button mat-icon-button mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"flex flex-col items-center w-full p-2\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <user-form [form]=\"form\"></user-form>\n        </main>\n        <footer\n            class=\"flex items-center justify-center w-full p-2 border-t border-gray-300 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button mat-button class=\"inverse\" mat-dialog-close>Cancel</button>\n            <button mat-button (click)=\"saveChanges()\">Save</button>\n        </footer>\n        <ng-template #load_state>\n            <main class=\"flex flex-col items-center w-full p-2 space-y-2\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving attendee...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                min-height: 20em !important;\n                width: 100%;\n            }\n\n            footer button {\n                min-width: 8em;\n            }\n        `,\n    ],\n})\nexport class NewUserModalComponent extends BaseClass implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Form fields for the new user */\n    public form = generateUserForm(this.user || new User());\n    /** New user data store */\n    public user?: User;\n    /** Whether user details are being saved */\n    public loading = false;\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: any) {\n        super();\n        this.user = this._data.user || {};\n        this.form = generateUserForm(this.user);\n    }\n\n    public ngOnInit(): void {\n    }\n\n    public saveChanges() {\n        if (!this.form) return;\n        this.form.markAllAsTouched();\n        if (this.form.valid) {\n            const new_user = new User({\n                ...this.form.value,\n                is_external: true\n            });\n            this.event.emit({ reason: 'done', metadata: new_user });\n        }\n    }\n}\n","import { HashMap } from '@placeos/common';\nimport { get } from '@placeos/ts-client';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { StaffUser } from './user.class';\n\nconst STAFF_ENDPOINT = '/api/staff/v1/people';\n\n/**\n * Search staff members\n * @param q Search string for filtering staff\n */\nexport function searchStaff(q: string): Observable<StaffUser[]> {\n    const query = toQueryString({ q });\n    return get(`${STAFF_ENDPOINT}${q ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item: HashMap) => new StaffUser(item)))\n    );\n}\n\n/**\n * Get user details\n * @param id User ID or email\n */\nexport function showStaff(id: string) {\n    return get(`${STAFF_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n\n/**\n * Get user with their location details\n * @param email User email\n */\nexport function locateStaff(email: string) {\n    return get(`${STAFF_ENDPOINT}/${email}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n","import { Component, Input } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\n\n@Component({\n    selector: 'user-form',\n    template: `\n        <form user-form *ngIf=\"form\" [formGroup]=\"form\">\n            <div class=\"field\" *ngIf=\"form.controls.name\">\n                <label for=\"name\" [class.error]=\"hasError('name')\">\n                    Name<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        placeholder=\"Name\"\n                        formControlName=\"name\"\n                    />\n                    <mat-error>Name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.email\">\n                <label for=\"email\" [class.error]=\"hasError('email')\">\n                    Email<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"email\"\n                        placeholder=\"Email Address\"\n                        formControlName=\"email\"\n                    />\n                    <mat-error>A valid email is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.organisation\">\n                <label for=\"org\" [class.error]=\"hasError('organisation')\">\n                    Organisation<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"org\"\n                        placeholder=\"Organisation\"\n                        formControlName=\"organisation\"\n                    />\n                    <mat-error>Organisation is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.phone\">\n                <label for=\"phone\" [class.error]=\"hasError('phone')\">\n                    Phone:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"phone\"\n                        type=\"tel\"\n                        placeholder=\"Phone\"\n                        formControlName=\"phone\"\n                    />\n                    <mat-error>Phone format is invalid</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.assistance_required\">\n                <mat-checkbox\n                    name=\"assistance-required\"\n                    color=\"primary\"\n                    formControlName=\"assistance_required\"\n                >\n                    Assistance required\n                </mat-checkbox>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.visit_expected\">\n                <mat-checkbox\n                    name=\"visit-expected\"\n                    color=\"primary\"\n                    formControlName=\"visit_expected\"\n                >\n                    Visit expected\n                </mat-checkbox>\n            </div>\n        </form>\n    `,\n    styles: [\n        `\n            .field {\n                display: flex;\n                flex-wrap: wrap;\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class UserFormComponent {\n    /** Group of form fields used for creating the system */\n    @Input() public form?: FormGroup;\n\n    public hasError(name: string) {\n        const { invalid, touched } = this.form?.controls[name] || {};\n        return invalid && touched;\n    }\n}\n","import { MapLocation } from './location.class';\nimport { USER_DOMAIN } from './user.utilities';\n\nexport interface Attachment {\n    id?: string;\n    name: string;\n    url: string;\n    size?: number;\n    created_at?: number; \n    progress?: number;\n}\n\nexport interface UserComplete extends User {\n    sys_admin?: boolean;\n    support?: boolean;\n    department?: string;\n}\n\nexport type EventResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted'\n    | '';\n\nexport class User {\n    /** ID of the user */\n    public readonly id: string;\n    /** Display name of the user */\n    public readonly name: string;\n    /** Email address of the user */\n    public readonly email: string;\n    /** First name of the user */\n    public readonly first_name: string;\n    /** Last name of the user */\n    public readonly last_name: string;\n    /** Username of the user */\n    public readonly username: string;\n    /** Phone number of the user */\n    public readonly phone: string;\n    /** Organisation associated with the user */\n    public readonly organisation: string;\n    /** Details about the user */\n    public readonly notes: string;\n    /** URL to the user's photo */\n    public readonly photo: string;\n    /** Whether user attendance is required */\n    public readonly required: boolean;\n    /** Whether user is the event organiser */\n    public readonly organizer: boolean;\n    /** Whether the users is expected for an event */\n    public readonly response_status: EventResponseStatus;\n    /** Whether the users is expected for an event */\n    public visit_expected: boolean;\n    /** Whether user has been checked in */\n    public readonly checked_in: boolean;\n    /** Department that the user belongs to in the organisation */\n    public readonly groups: string[];\n    /** Extra metadata associated with the user */\n    public readonly extension_data: Record<string, any>;\n    /** Whether user is external from the organisation */\n    public readonly is_external: boolean;\n    /** Whether user needs assistance when attending an event */\n    public readonly assistance_required: boolean;\n    /** Whether user is a resource */\n    public readonly resource: boolean;\n\n    constructor(data: Partial<UserComplete> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.email = data.email || '';\n        this.first_name = data.first_name || data.name || '';\n        this.last_name = data.last_name || '';\n        this.phone = data.phone || '';\n        this.organisation = data.organisation || '';\n        this.notes = data.notes || '';\n        this.photo = data.photo || '';\n        this.username = data.username || '';\n        this.organizer = !!data.organizer;\n        this.checked_in = !!data.checked_in;\n        this.required = data.required ?? true;\n        this.resource = data.resource ?? false;\n        this.response_status = data.response_status || '';\n        const groups = data.groups || [];\n        if (data.sys_admin) groups.push('placeos_admin');\n        if (data.support) groups.push('placeos_support');\n        if (data.department) groups.push(data.department);\n        this.groups = groups;\n        this.extension_data = data.extension_data || {};\n        this.extension_data.assistance_required =\n            data.assistance_required || this.extension_data.assistance_required;\n        this.is_external = !this.email?.endsWith(`${USER_DOMAIN}`);\n        this.visit_expected = data.visit_expected ?? true;\n        this.assistance_required = !!this.extension_data?.assistance_required;\n        for (const key in data) {\n            if (!(key in this)) this.extension_data[key] = data[key] as any;\n        }\n    }\n}\n\nexport class GuestUser extends User {\n    /** Preferred beverage of the guest */\n    public readonly preferred_beverage: string;\n    /** Whether guest has accepted the terms and conditions */\n    public readonly accepted_terms_conditions: boolean;\n    /** List of links to associated attachments */\n    public readonly attachments: Attachment[];\n    /** Status of the guest attendance */\n    public readonly status: 'pending' | 'approved' | 'declined';\n\n    constructor(data: Partial<GuestUser> = {}) {\n        super(data);\n        this.preferred_beverage = data.preferred_beverage || '';\n        this.accepted_terms_conditions =\n            data.accepted_terms_conditions || false;\n        this.attachments =\n            data.extension_data?.attachments || data.attachments || [];\n        this.status = data.extension_data?.status || data.status || 'pending';\n    }\n}\n\nexport class StaffUser extends User {\n    /** Number associated with the user's access card */\n    public readonly card_number: string;\n    /** ID of the user */\n    public readonly staff_id: string;\n    /** Whether user is logged in */\n    public readonly is_logged_in: boolean;\n    /** Location of the user */\n    public readonly location: Record<string, MapLocation>;\n\n    constructor(data: Partial<StaffUser> = {}) {\n        super(data);\n        this.card_number = data.card_number || '';\n        this.staff_id = data.staff_id || '';\n        this.location = data.location || {};\n        this.is_logged_in = !!data.is_logged_in;\n    }\n}\n","import { Pipe } from \"@angular/core\";\nimport { showGuest } from \"./guests.fn\";\nimport { showStaff } from \"./staff.fn\";\nimport { User } from \"./user.class\";\n\nconst USER_LIST: User[] = [];\n\nconst EMPTY_USER = new User();\n\n@Pipe({\n    name: 'user'\n})\nexport class UserPipe {\n    /**\n     * Get details of the user with the given ID\n     * @param user_id ID or Email of the user\n     */\n    public async transform(user_id: string): Promise<User> {\n        if (!user_id) return EMPTY_USER;\n        let user = USER_LIST.find(({ id, email }) => id === user_id || email === user_id);\n        if (user) return user;\n        user = await showStaff(user_id).toPromise();\n        if (user) {\n            USER_LIST.push(user);\n            return user;\n        }\n        user = await showGuest(user_id).toPromise();\n        if (user) {\n            USER_LIST.push(user);\n            return user;\n        }\n        return EMPTY_USER;\n    }\n}\n","import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { predictableRandomInt, unique } from '../../../common/src/lib/general';\n\nimport { GuestUser, User } from './user.class';\n\nlet USER_COUNT = 0;\n\ntype HashMap<T = any> = Record<string, T>;\n\nexport let USER_DOMAIN = '@place.tech';\n\nexport function setInternalUserDomain(domain: string) {\n    USER_DOMAIN = domain;\n}\n\nconst USER_EMAILS: string[] = [];\n/* istanbul ignore next */\n/**\n * Generate raw mock data for a user\n * @param id Forced ID for the mock\n * @param name Forced name for the user\n * @param external Whether user is external of the organisation\n */\nexport function generateMockUser(\n    id?: string,\n    name?: string,\n    external?: boolean\n): HashMap {\n    if (!id) {\n        id = `user-${USER_COUNT++}`;\n    }\n    if (!name) {\n        name = `User ${USER_COUNT}`;\n    }\n    if (external === undefined) {\n        external = !(predictableRandomInt(99999) % 2);\n    }\n    const organisation = external ? `Fake Co.` : USER_DOMAIN.split('.')[0];\n    let delegates: string[] = [];\n    const delegate_count = Math.min(\n        predictableRandomInt(4) + 1,\n        USER_EMAILS.length\n    );\n    for (let i = 0; i < delegate_count; i++) {\n        delegates.push(USER_EMAILS[predictableRandomInt(USER_EMAILS.length)]);\n    }\n    delegates = unique(delegates);\n    const email = `${name.split(' ').join('.').toLowerCase()}@${\n        external ? 'not-' : ''\n    }${USER_DOMAIN}`;\n    USER_EMAILS.push(email);\n    return {\n        id,\n        name,\n        first_name: name.split(' ')[0],\n        last_name: name.split(' ')[1],\n        email,\n        phone: `(02) 4567 8901`,\n        visitor: external,\n        organisation: {\n            id: organisation.split(' ').join('.').toLowerCase(),\n            name: organisation,\n        },\n        department: `Department ${predictableRandomInt(10)}`,\n        staff_code: predictableRandomInt(999_999),\n        delegates,\n        image: `${id}.png`,\n    };\n}\n\n/**\n * Generate form fields for the given user\n * @param user User to generate form for\n */\nexport function generateUserForm(user?: User) {\n    if (!user) {\n        throw Error('No user passed');\n    }\n\n    const fields = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(\n            user.phone || '',\n            Validators.pattern(/[+\\-()0-9]{1,24}/g)\n        ),\n        assistance_required: new FormControl(user.assistance_required || false),\n        visit_expected: new FormControl(user.visit_expected ?? true),\n    };\n\n    // Generate form group for the user\n    const form = new FormGroup(fields);\n    return form;\n}\n\nexport function generateGuestForm(\n    user: GuestUser = new GuestUser(),\n    host: string = ''\n) {\n    const fields = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(user.phone || ''),\n        host: new FormControl(host || '', [Validators.required]),\n    };\n    // Generate form group for the guest\n    const form = new FormGroup(fields);\n    return form;\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\n\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\nimport { FormFieldsModule } from 'libs/form-fields/src/lib/form-fields.module';\n\nimport { NewUserModalComponent } from './new-user-modal.component';\nimport { UserFormComponent } from './user-form.component';\nimport { UserPipe } from './user.pipe';\nimport { WFHSettingsModalComponent } from './wfh-settings-modal.component';\nimport { FindAvailabilityModalComponent } from './find-availability-modal/find-availability-modal.component';\nimport { UserAvailabilityComponent } from './find-availability-modal/user-availability.component';\n\nconst COMPONENTS = [\n    NewUserModalComponent,\n    UserFormComponent,\n    WFHSettingsModalComponent,\n    UserPipe,\n    FindAvailabilityModalComponent,\n    UserAvailabilityComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatDialogModule,\n        FormFieldsModule,\n        ComponentsModule,\n        MatCheckboxModule,\n        MatProgressSpinnerModule,\n        MatMenuModule,\n    ],\n    exports: [...COMPONENTS],\n})\nexport class SharedUsersModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { MatDialogRef } from '@angular/material/dialog';\nimport { currentUser, SettingsService } from '@placeos/common';\nimport { endOfDay, getUnixTime, setDay, startOfDay } from 'date-fns';\nimport { Booking } from 'libs/bookings/src/lib/booking.class';\nimport { queryBookings, saveBooking } from 'libs/bookings/src/lib/bookings.fn';\n\nconst WFH_SETTING_KEY = 'wfh-days';\n\n@Component({\n    selector: `wfh-settings-modal`,\n    template: `\n        <div\n            class=\"relative flex flex-col rounded overflow-hidden w-[18rem]\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <div\n                class=\"w-full px-4 py-8 flex flex-col items-center border-b border-gray-200\"\n            >\n                <a-user-avatar [user]=\"user\"></a-user-avatar>\n                <div>{{ user.name }}</div>\n                <div class=\"text-xs opacity-30\">{{ user.email }}</div>\n                <div class=\"text-xs opacity-30\">{{ user.phone }}</div>\n            </div>\n            <div class=\"w-full p-4 flex flex-col  border-b border-gray-200\">\n                <h3 class=\"-mt-2 mb-2 text-sm font-medium\">\n                    Today's Working Location\n                </h3>\n                <button\n                    mat-button\n                    today-location\n                    class=\"inverse rounded-3xl w-auto\"\n                    [matMenuTriggerFor]=\"menu\"\n                >\n                    <div class=\"flex items-center justify-between\">\n                        <div class=\"uppercase\">{{ option }}</div>\n                        <app-icon class=\"text-2xl\">arrow_drop_down</app-icon>\n                    </div>\n                </button>\n                <div class=\"flex items-center pt-4 space-x-2\">\n                    <div\n                        class=\"h-8 w-8 rounded-full bg-gray-300 dark:bg-neutral-800 flex items-center justify-center\"\n                    >\n                        <app-icon>home</app-icon>\n                    </div>\n                    <div class=\"flex-1 w-1/2 text-sm\">\n                        Today is a working from home day. Available for online\n                        meetings.\n                    </div>\n                </div>\n            </div>\n            <div class=\"w-full p-4 flex flex-col\">\n                <h3 class=\"-mt-2 mb-2 text-sm font-medium\">\n                    Default Office Days\n                </h3>\n                <div\n                    class=\"border border-gray-200 rounded flex items-center justify-between px-2 pt-2\"\n                >\n                    <div\n                        class=\"flex flex-col items-center\"\n                        *ngFor=\"let day of weekdays; let i = index\"\n                    >\n                        <div class=\"text-sm font-light\">\n                            {{ day | date: 'EEE' }}\n                        </div>\n                        <div\n                            class=\"h-8 w-8 flex items-center justify-center pr-2\"\n                        >\n                            <mat-checkbox\n                                [(ngModel)]=\"settings[available_weekdays[i]]\"\n                                (ngModelChange)=\"changed = true\"\n                            ></mat-checkbox>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"flex items-center justify-end px-4 pb-4\">\n                <button\n                    mat-button\n                    save\n                    [disabled]=\"!changed\"\n                    (click)=\"saveChanges()\"\n                >\n                    Update\n                </button>\n            </div>\n            <button\n                mat-icon-button\n                mat-dialog-close\n                class=\"absolute top-0 left-0\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n        <mat-menu #menu=\"matMenu\">\n            <button\n                mat-menu-item\n                *ngFor=\"let type of options\"\n                [attr.id]=\"type.id\"\n                (click)=\"option = type.id; changed = true\"\n            >\n                {{ type.name }}\n            </button>\n        </mat-menu>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"relative bg-white flex flex-col justify-center items-center rounded overflow-hidden w-[18rem] h-[18rem]\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>Saving changes to work location settings...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class WFHSettingsModalComponent implements OnInit {\n    public readonly options = [\n        { id: 'wfo', name: 'Work from office (WFO)' },\n        { id: 'wfh', name: 'Work from home (WFH)' },\n        { id: 'aol', name: 'Away on Leave (AOL)' },\n    ];\n    public option = this.options[0].id;\n    public settings = [true, true, true, true, true, true, true];\n    public weekdays = [];\n    public changed = false;\n    public loading = false;\n    public readonly available_weekdays = [1, 2, 3, 4, 5];\n\n    private _booking: Booking = new Booking({\n        type: 'wfh-settings',\n        asset_id: this.options[0].id,\n    });\n\n    constructor(\n        private _settings: SettingsService,\n        private _dialog_ref: MatDialogRef<WFHSettingsModalComponent>\n    ) {}\n\n    public ngOnInit() {\n        this.settings = this._settings.get(WFH_SETTING_KEY) || [true, true, true, true, true, true, true];\n        this._initWeekdays();\n        this._loadOptionForToday();\n    }\n\n    public get user() {\n        return currentUser();\n    }\n\n    public async saveChanges() {\n        this.loading = true;\n        this._dialog_ref.disableClose = true;\n        if (this.option !== this.options[0].id && this.option !== this._booking.asset_id) {\n            await saveBooking(\n                new Booking({ ...this._booking, asset_id: this.option })\n            )\n                .toPromise()\n                .catch((e) => {\n                    this._dialog_ref.disableClose = false;\n                    this.loading = false;\n                    throw e;\n                });\n        }\n        this._settings.saveUserSetting(WFH_SETTING_KEY, this.settings);\n        this.loading = false;\n        this._dialog_ref.close();\n    }\n\n    private _initWeekdays() {\n        let day = new Date();\n        this.weekdays = this.available_weekdays.map((_) =>\n            setDay(day, _).valueOf()\n        );\n    }\n\n    private async _loadOptionForToday() {\n        const list = await queryBookings({\n            type: 'wfh-setting',\n            period_start: getUnixTime(startOfDay(Date.now())),\n            period_end: getUnixTime(endOfDay(Date.now())),\n        }).toPromise();\n        if (list.length) {\n            this.option = list[0].asset_id;\n            this._booking = list[0];\n        }\n    }\n}\n"],"x_google_ignoreList":[]}