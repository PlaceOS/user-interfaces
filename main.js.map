{"version":3,"sources":["./libs/mocks/src/lib/api/zone.data.ts","./libs/mocks/src/lib/api/zones.mock.ts","./libs/common/src/lib/base.class.ts","./libs/components/src/lib/confirm-modal.component.ts","./libs/common/src/lib/general.ts","./libs/common/src/lib/hotkeys.service.ts","./apps/booking-panel/src/environments/settings.ts","./libs/common/src/lib/settings.service.ts","./libs/common/src/lib/version.ts","./libs/common/src/lib/api.ts","./libs/common/src/lib/notifications.ts","./libs/common/src/lib/application.ts","./libs/common/src/lib/angular-animations.ts","./libs/common/src/lib/base-api.class.ts","./libs/users/src/lib/user.class.ts","./libs/common/src/lib/user-state.ts","./libs/mocks/src/lib/api/common.mock.ts","./libs/mocks/src/lib/api/users.data.ts","./libs/components/src/lib/binding.directive.ts","./libs/components/src/lib/action-icon.component.ts","./libs/components/src/lib/safe.pipe.ts","./libs/components/src/lib/icon.component.ts","./libs/components/src/lib/popout-menu.component.ts","./libs/components/src/lib/interactive-map.component.ts","./libs/components/src/lib/status-overlay.component.ts","./libs/components/src/lib/virtual-keyboard.component.ts","./libs/components/src/lib/components.module.ts","./libs/spaces/src/lib/space-select-modal/item/item.component.html","./libs/spaces/src/lib/space-select-modal/item/item.component.ts","./libs/catering/src/lib/catering-item.class.ts","./libs/catering/src/lib/catering-order.class.ts","./libs/organisation/src/lib/level.class.ts","./libs/organisation/src/lib/building.class.ts","./libs/organisation/src/lib/organisation.class.ts","./libs/organisation/src/lib/desk.class.ts","./libs/organisation/src/lib/organisation.service.ts","./libs/spaces/src/lib/space.class.ts","./libs/events/src/lib/event.class.ts","./libs/events/src/lib/helpers.ts","./libs/events/src/lib/event.utilities.ts","./libs/bookings/src/lib/booking.utilities.ts","./libs/calendar/src/lib/calendar.class.ts","./libs/calendar/src/lib/calendar.fn.ts","./libs/calendar/src/lib/calendar.service.ts","./libs/spaces/src/lib/space-select-modal/space-select-modal.component.html","./libs/spaces/src/lib/space-select-modal/space-select-modal.component.ts","./libs/spaces/src/lib/spaces.module.ts","./libs/spaces/src/lib/space.utilities.ts","./libs/spaces/src/lib/spaces.service.ts","./libs/mocks/src/lib/api/spaces.data.ts","./libs/mocks/src/lib/api/events.data.ts","./libs/mocks/src/lib/api/users.mock.ts","./libs/mocks/src/lib/realtime/control.ts","./libs/mocks/src/lib/realtime/events.ts","./libs/mocks/src/lib/realtime/desks.ts","./libs/mocks/src/lib/realtime/camera.ts","./libs/mocks/src/lib/realtime/display.ts","./libs/mocks/src/lib/realtime/microphone.ts","./libs/mocks/src/lib/realtime/capture.ts","./libs/mocks/src/lib/api/systems.mock.ts","./libs/mocks/src/lib/systems-bindings.mock.ts","./libs/mocks/src/lib/api/events.mock.ts","./libs/mocks/src/lib/api/calendars.mock.ts","./libs/mocks/src/lib/api/bookings.mock.ts","./apps/booking-panel/src/app/bootstrap.component.ts","./libs/users/src/lib/new-user-modal/new-user-modal.component.html","./libs/users/src/lib/new-user-modal/new-user-modal.component.ts","./libs/users/src/lib/user.utilities.ts","./libs/users/src/lib/user-form/user-form.component.html","./libs/users/src/lib/user-form/user-form.component.ts","./libs/users/src/lib/guests.fn.ts","./libs/users/src/lib/staff.fn.ts","./libs/form-fields/src/lib/user-search-field.component.ts","./libs/users/src/lib/users.module.ts","./libs/form-fields/src/lib/time-field.component.ts","./libs/form-fields/src/lib/duration-field.component.ts","./apps/booking-panel/src/app/overlays/booking-modal.component.ts","./apps/booking-panel/src/app/panel/panel-state.service.ts","./apps/booking-panel/src/app/panel/space-details/space-details.component.html","./apps/booking-panel/src/app/panel/space-details/space-details.component.ts","./apps/booking-panel/src/app/panel/booking-actions/booking-actions.component.html","./apps/booking-panel/src/app/panel/booking-actions/booking-actions.component.ts","./apps/booking-panel/src/app/overlays/embedded-control-modal.component.ts","./apps/booking-panel/src/app/panel/custom-actions/custom-actions.component.html","./apps/booking-panel/src/app/panel/custom-actions/custom-actions.component.ts","./apps/booking-panel/src/app/panel/timeline/timeline.component.html","./apps/booking-panel/src/app/panel/timeline/timeline.component.ts","./apps/booking-panel/src/app/panel/panel.component.html","./apps/booking-panel/src/app/panel/panel.component.ts","./apps/booking-panel/src/app/panel-array/panel-array.component.html","./apps/booking-panel/src/app/panel-select/panel-select.component.html","./apps/booking-panel/src/app/app-routing.module.ts","./apps/booking-panel/src/app/panel-array/panel-array.component.ts","./apps/booking-panel/src/app/panel-select/panel-select.component.ts","./libs/form-fields/src/lib/form-fields.module.ts","./apps/booking-panel/src/app/overlays/overlays.module.ts","./libs/components/src/lib/app.component.ts","./libs/common/src/lib/placeos.ts","./apps/booking-panel/src/app/app.module.ts","./apps/booking-panel/src/environments/environment.prod.ts","./apps/booking-panel/src/main.ts","./$_lazy_route_resource lazy namespace object"],"names":["MOCK_ORGS","created_at","updated_at","name","description","tags","count","capacity","parent_id","triggers","id","MOCK_BUILDINGS","MOCK_LEVELS","map","bld","level","idx","building","map_id","substr","endsWith","code","type","location","display_name","mockLevel","reduce","p","c","concat","path","metadata","method","callback","request","query_params","status","message","details","bookable","group","zone","desks","BaseClass","_timers","_intervals","_subscriptions","_initialised","BehaviorSubject","initialised","this","asObservable","getValue","destroy","key","hasOwnProperty","clearTimeout","clearInterval","unsub","fn","delay","Function","Error","setTimeout","setInterval","Subscription","unsubscribe","CONFIRM_METADATA","height","width","maxHeight","maxWidth","ConfirmModalComponent","_dialog_ref","_data","event","title","content","confirm_text","cancel_text","icon","class","disableClose","enableClose","close","emit","reason","_app_name","log","msg","args","stream","force","app_name","window","debug","colors","console","getItemWithKeys","keys","shift","length","unique","array","filter","el","pos","arr","indexOf","find","i","randomInt","ceil","floor","Math","random","timePeriodsIntersect","start1","end1","start2","end2","seed","str","h","imul","charCodeAt","xmur3","rand","a","b","d","t","predictableRandomInt","timeFormatString","localeString","Date","toLocaleTimeString","document","querySelector","getAttribute","navigator","language","toLowerCase","is24HourTime","INVALID_STANDALONE_KEYS","HotkeysService","keydown_states","keydown_observers","combo_end","registered_combos","counter","addEventListener","mapKey","last_down","next","preventDefault","combo","combination","Array","split","validCombination","push","last_key","updateCombinationEndList","subscribe","presses","state","v","replace","non_meta","DEFAULT_SETTINGS","composer","domain","route","protocol","port","use_domain","local_login","app","short_name","logo","src","logo_dark","general","SettingsService","_title","super","_overrides","_subjects","_observables","now","time","built","isSameDay","format","init","value","getTitle","setTitle","get","application","settings","override_settings","override","slice","toQueryString","_available","_activated","_timer","action","on_action","config","snackbar_ref","open","panelClass","duration","dismiss","onAction","notifySuccess","notifyError","error","notifyInfo","info","opacity","BaseDataClass","raw_data","_server_names","zone_id","email","with_changes","obj","Object","undefined","data","first_name","last_name","phone","organisation","notes","photo","organizer","visit_expected","checked_in","response_status","groups","sys_admin","support","extension_data","assistance_required","is_external","includes","GuestUser","preferred_beverage","accepted_terms_conditions","StaffUser","card_number","staff_id","is_logged_in","_current_user","current_user","currentUser","jest","pipe","retry","user","DOMAIN","PREDEF_USERS","ACTIVE_USER","MOCK_STAFF","join","MOCK_GUESTS","BindingDirective","_element","_renderer","index","params","modelChange","first","_","bindVariable","changes","sys","mod","bind","model","previousValue","execute","on_event","subscription","listen","nativeElement","binding","exec","module","then","result","ActionIconComponent","className","SafePipe","sanitizer","bypassSecurityTrustResourceUrl","bypassSecurityTrustUrl","bypassSecurityTrustScript","bypassSecurityTrustStyle","bypassSecurityTrustHtml","IconComponent","PopoutMenuComponent","actions","timeout","show","MAP_FEATURE_DATA","StatusOverlayComponent","loading","links","MAT_MODULES","ComponentsModule","provide","useValue","SpaceSelectItemComponent","CateringItem","category","unit_price","quantity","options","total_cost","event_id","items","system_id","item_count","amount","item","charge_code","invoice_number","deliver_at","date","getTime","BuildingLevel","locations","parts","number","toUpperCase","disc_info","discovery_info","extras","extra_id","extra_name","loan_items","levels","building_id","_roles","roles","_lockers","lockers","locker_structure","_systems","systems","_phone_numbers","phone_numbers","_location","longitude","latitude","room_configurations","attributes","searchables","neighbourhoods","lvl","lvl_features","feature","level_id","bindings","timezone","catering_hours","start","end","visitor_space","holding_bay","address","orientations","booking_details","booking_rules","catering_restricted_from","currency","_settings","Desk","OrganisationService","_service","_router","buildings_subject","active_building_subject","levels_subject","building_list","level_list","active_building","active_levels","combineLatest","levelsForBuilding","_building_settings","overrides","buildingSettings","bld_id","_organisation","buildings","id_list","load","catch","err","orgs","loadOrganisation","loadBuildings","loadLevels","loadSettings","org_list","toPromise","auth","org","list","org_zone","navigate","limit","localStorage","getItem","sort","localeCompare","m","prev","curr","query","loadMetadata","forEach","desk","setItem","feature_list","features","zones","support_url","image","configurations","_default_user","calendar","creator","host","attendees","resource","u","resources","s","body","private","all_day","event_start","roundToNearestMinutes","setMinutes","getMinutes","nearestTo","startOfDay","valueOf","differenceInMinutes","event_end","recurring","recurring_master_id","meeting_link","organiser","master","recurrence","range_start","range_end","interval","pattern","days_of_week","system","old_system","attachments","catering","needs_parking","remote","visitor_type","can_access_lift","every","some","eventStatus","has_visitors","has_catering","setup","breakdown","attendee_emails","guests","f","space","cleaned","addMinutes","isBefore","add","minutes","setHours","days","customParseFormat","month","months","week","weeks","day","hour","hours","minute","rules","matches","condition","j","check","unit","isAfter","after_time","duration_1","duration_2","subtract","startOf","primary","summary","can_edit","availability","starts_at","dateTime","ends_at","CALENDAR_ENDPOINT","queryCalendars","CalendarService","_org","_calendars","calendar_list","freeBusy","q","cal","levelWithID","calendarsToSpaces","querySpaceFreeBusy","queryCalendarAvailability","calendars","period_start","period_end","system_ids","old_booking","findIndex","block","splice","SpaceSelectModalComponent","_calendar","spaces","available_spaces","filtered_spaces","space_types","loadAvailableSpaces","zone_ids","unix","filterSpaces","building_settings","space_rules_for_user","auto_approve","hide","rule_block","conditions","ruleset","max_length","min_length","room_type","filterSpacesRules","multiple","space_map","save","SPACE_COUNT","SpacesService","_list","_compare","loadSpaces","predicate","valid_spaces","randomSpaceFeatures","numFeatures","res","r","MOCK_SPACES","linked","long_name","searchable","controlable","cost_hour","bookings","linked_rooms","generateMockSpace","EVENT_TIME","nextEventTime","event_status","randomStatus","rnd","MOCK_EVENTS","fill","unshift","has_active_user","event_spaces","route_params","person","search","decodeURIComponent","generateLocation","LOCATION_TYPES","level_spaces","meeting","x","y","last_seen","geo","lat","lon","recording","volume","connected","power","input_list","output_list","env_sources","inputs","outputs","source","input","output","$updateState","routes","following","mute","$mute","locked","Mic1","Mic2","Mic3","PC1","PC2","PC3","PC4","HDMI","VGA","Camera1","Camera2","Camera3","Camera4","TV1","Display1","Display2","Display3","Display4","Display5","states","createSystemModule","MockBookingModule","time_zone","disable_book_now","disable_end_meeting","pending_period","pending_before","control_ui","catering_ui","last_booking_started","createBookingsModule","$start_meeting","$end_meeting","$book_now","len","o","updateBookings","current","bkn","pending","subSeconds","addSeconds","MockLocationServicesModule","overview","username","padZero","no","createLocationServicesModule","desk_count","desk_usage","device_capacity","device_count","estimated_people","percentage_use","recommendation","updateLocations","users","at_location","mac","hashStr","coordinates_from","s2_cell_id","variance","map_width","map_height","CameraModule","presets","dir","tilt","live","remaining","$start","createCaptureModule","System","Bookings","AreaManagement","Camera","createCameraModule","Display","createDisplayModule","Microphone","createMicrophoneModule","Capture","createSystem","new_event","has","BootstrapComponent","_spaces","system_list","filtered_list","selected_system","bootstrap","configure","clearBootstrap","removeItem","space_list","queryParamMap","checkBootstrapped","NewUserModalComponent","form","fields","required","generateUserForm","markAllAsTouched","valid","new_user","UserFormComponent","searchGuests","searchStaff","UserSearchFieldComponent","search$","Subject","search_results$","debounceTime","distinctUntilChanged","switchMap","of","forkJoin","catchError","an_array","stack","pop","isArray","reverse","flatten","search_str","user_list","active_user","new_value","_onChange","resetSearchString","disabled","_onTouch","useExisting","multi","setValue","TimeFieldComponent","step","no_past_times","show_select","_time_options","generateAvailableTimes","set","startOfMinute","select_field","focus","openedChange","datestamp","show_past","blocks","endOfDay","showSelect","DurationFieldComponent","max","min","specialPreprops","duration_options","generateDurationOptions","option","formatDuration","BookingModalComponent","room_ids","currentBooking","PanelStateService","_dialog","_poll","_bookings","_system","pair","booking","is_active","last_active","cancel_timeout","componentInstance","startMeeting","e","endCurrent","booking_list","PanelSpaceDetailsComponent","_state","next_free","min_size","slots","bkn_start","bkn_end","abs","getFreeBookingSlots","seconds","getNextFreeBookingSlot","$event","PanelBookingActionsComponent","no_booking","last_confirm","book","newBooking","confirmEnd","endMeeting","confirmStart","EmbeddedControlModalComponent","control_url","countdown","tick","reset","PanelCustomActionsComponent","callWaiter","PanelTimelineComponent","time_blocks","generateTimelineBlocks","checkBookings","subMinutes","start_offset","block_size","getHours","in_use","block_start","block_end","hide_status","hide_all","block_time","isSameMinute","BookingPanelComponent","_route","show_time","interactive","websocket_connected","paramMap","post","show_title","showTitle","component","BookingPanelArrayComponent","inverse","BookingPanelSelectComponent","system_name","system_icon","system_status","active_system","redirectTo","AppRoutingModule","forRoot","useHash","FormFieldsModule","SharedOverlaysModule","AppComponent","_tracing","_cache","_snackbar","_hotkey","_clipboard","_loading","reload","copy","clipboard","readText","tkn","addHours","mock","hostname","url","origin","pathname","href","auth_type","scope","auth_uri","token_uri","redirect_uri","handle_login","use_iframe","setupPlace","onInitError","cache","notify","isEnabled","available","hash","activateUpdate","activated","checkForUpdate","setupCache","dsn","sample_rate","integrations","BrowserTracing","tracingOrigins","routingInstrumentation","tracesSampleRate","initSentry","AppModule","showDialog","deps","register","enabled","bootstrapModule","webpackEmptyAsyncContext","req","Promise","resolve","exports"],"mappings":"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","file":"main.js","sourcesContent":["export const MOCK_ORGS = [\n    {\n        created_at: 1587057070,\n        updated_at: 1587692680,\n        name: 'PlaceOS',\n        description: '',\n        tags: 'org',\n        count: 0,\n        capacity: 0,\n        parent_id: '',\n        triggers: [],\n        id: 'zone-EmWFTjuYExK',\n    },\n];\n\nexport const MOCK_BUILDINGS = [\n    {\n        name: 'Sydney',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-01',\n    },\n    {\n        name: 'Brisbane',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-02',\n    },\n    {\n        name: 'Melbourne',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-03',\n    },\n];\n\nconst levels = [\n    'lvl-00',\n    'lvl-01',\n    'lvl-02',\n    'lvl-03',\n    'lvl-04',\n    'lvl-05',\n    'lvl-06',\n];\nconst mockLevel = (id: string, idx: number, building: any): any => {\n    let map_id = id.substr(4);\n    map_id = `https://s3-ap-southeast-2.amazonaws.com/os.place.tech/16012682998688307492.svg`;\n    return {\n        id: `${building.id}_${id}`,\n        name: `Level ${id.endsWith('0') ? 'G' : idx}`,\n        parent_id: building.id,\n        description: '',\n        tags: 'level',\n        map_id,\n        code: 'level code 12',\n        type: 'staff floor',\n        count: 5,\n        capacity: 30,\n        location: 'optional lat,long',\n        display_name: '',\n    };\n};\n\nexport const MOCK_LEVELS = MOCK_BUILDINGS.map((bld) =>\n    levels.map((level, idx) => mockLevel(level, idx, bld))\n).reduce((p, c) => p.concat(c), []);\n","import { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_ORGS, MOCK_LEVELS, MOCK_BUILDINGS } from './zone.data';\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/zones',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.query_params.tags === 'org') {\n            return MOCK_ORGS;\n        } else if (request.query_params.tags === 'building') {\n            return MOCK_BUILDINGS;\n        } else if (request.query_params.tags === 'level') {\n            return MOCK_LEVELS;\n        }\n        throw { status: 404, message: 'Zones not found' };\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/metadata/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.query_params.name === 'catering') {\n            return [];\n        }\n        if (request.query_params.name === 'desks') {\n            return {\n                details: [\n                    {\n                        id: 'table-01.001',\n                        name: '1.001',\n                        bookable: true,\n                        group: '',\n                    },\n                    {\n                        id: 'table-01.002',\n                        name: '1.002',\n                        bookable: true,\n                        group: '',\n                    },\n                    {\n                        id: 'table-01.003',\n                        name: '1.003',\n                        bookable: true,\n                        group: '',\n                    },\n                    {\n                        id: 'table-01.004',\n                        name: '1.004',\n                        bookable: true,\n                        group: '',\n                    },\n                    {\n                        id: 'table-01.005',\n                        name: '1.005',\n                        bookable: false,\n                        group: '',\n                    },\n                    {\n                        id: 'table-01.006',\n                        name: '1.006',\n                        bookable: true,\n                        group: '',\n                    },\n                ],\n            };\n        }\n        return {};\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/metadata/:id/children',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        return [\n            {\n                zone: {\n                    id: 'bld-01_lvl-01',\n                    name: 'Level 1'\n                },\n                metadata: {\n                    desks: {\n                        details: [\n                            {\n                                id: 'table-01.001',\n                                name: '1.001',\n                                bookable: true,\n                                group: '',\n                            },\n                            {\n                                id: 'table-01.002',\n                                name: '1.002',\n                                bookable: true,\n                                group: '',\n                            },\n                            {\n                                id: 'table-01.003',\n                                name: '1.003',\n                                bookable: true,\n                                group: '',\n                            },\n                            {\n                                id: 'table-01.004',\n                                name: '1.004',\n                                bookable: true,\n                                group: '',\n                            },\n                            {\n                                id: 'table-01.005',\n                                name: '1.005',\n                                bookable: false,\n                                group: '',\n                            },\n                            {\n                                id: 'table-01.006',\n                                name: '1.006',\n                                bookable: true,\n                                group: '',\n                            },\n                        ],\n                    },\n                },\n            },\n        ];\n    },\n});\n","\nimport { Injectable } from '@angular/core';\nimport { Subscription, BehaviorSubject } from \"rxjs\";\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class BaseClass {\n    /** Store for named timers */\n    protected _timers: { [name: string]: number } = {};\n    /** Store for named intervals */\n    protected _intervals: { [name: string]: number } = {};\n    /** Store for named subscription unsub callbacks */\n    protected _subscriptions: { [name: string]: (Subscription | (() => void)) } = {};\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n\n    /** Whether the object has been initialised */\n    public get is_initialised(): boolean {\n        return this._initialised.getValue();\n    }\n\n    public ngOnDestroy(): void {\n        this.destroy();\n    }\n\n    protected destroy() {\n        for (const key in this._timers) {\n            if (this._timers.hasOwnProperty(key)) {\n                this.clearTimeout(key);\n            }\n        }\n        for (const key in this._intervals) {\n            if (this._intervals.hasOwnProperty(key)) {\n                this.clearInterval(key);\n            }\n        }\n        for (const key in this._subscriptions) {\n            if (this._subscriptions.hasOwnProperty(key)) {\n                this.unsub(key);\n            }\n        }\n    }\n\n    /**\n     * Creates a named timer\n     * @param name Name of the timer\n     * @param fn Callback function for the timer\n     * @param delay Callback delay\n     */\n    protected timeout(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearTimeout(name);\n            this._timers[name] = <any>setTimeout(() => {\n                fn();\n                this._timers[name] = null;\n            }, delay);\n        } else {\n            throw new Error(\n                name ? 'Cannot create named timeout without a name' : 'Cannot create a timeout without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named timer\n     * @param name Timer name\n     */\n    protected clearTimeout(name: string) {\n        if (this._timers[name]) {\n            clearTimeout(this._timers[name]);\n            this._timers[name] = null;\n        }\n    }\n\n    /**\n     * Creates a named interval\n     * @param name Name of the interval\n     * @param fn Callback function for the interval\n     * @param delay Callback delay\n     */\n    protected interval(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearInterval(name);\n            this._intervals[name] = <any>setInterval(() => fn(), delay);\n        } else {\n            throw new Error(\n                name ? 'Cannot create named interval without a name' : 'Cannot create a interval without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named interval\n     * @param name Timer name\n     */\n    protected clearInterval(name: string) {\n        if (this._intervals[name]) {\n            clearInterval(this._intervals[name]);\n            this._intervals[name] = null;\n        }\n    }\n\n    /**\n     * Store named subscription\n     * @param name Name of the subscription\n     * @param unsub Unsubscribe callback or Subscription object\n     */\n    protected subscription(name: string, unsub: Subscription | (() => void)) {\n        this.unsub(name);\n        this._subscriptions[name] = unsub\n    }\n\n    /**\n     * Call unsubscribe callback with the given name\n     * @param name\n     */\n    protected unsub(name: string) {\n        if (this._subscriptions && this._subscriptions[name]) {\n            this._subscriptions[name] instanceof Subscription\n                ? (this._subscriptions[name] as Subscription).unsubscribe()\n                : (this._subscriptions[name] as any)();\n            this._subscriptions[name] = null;\n        }\n    }\n}\n","import { Component, Output, EventEmitter, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { ApplicationIcon, DialogEvent } from '../../../common/src/lib/types';\n\nexport interface ConfirmModalData {\n    /** Title of the modal */\n    title: string;\n    /** Contents of the modal */\n    content: string;\n    /** Text displaed on the confirmation button */\n    confirm_text?: string;\n    /** Text displaed on the confirmation button */\n    cancel_text?: string;\n    /** Icon to display on the modal */\n    icon: ApplicationIcon;\n}\n\nexport const CONFIRM_METADATA = {\n    height: 'auto',\n    width: '24em',\n    maxHeight: 'calc(100vh - 2em)',\n    maxWidth: 'calc(100vw - 2em)',\n};\n\n@Component({\n    selector: 'confirm-modal',\n    template: `\n        <header>\n            <h3 mat-dialog-title>{{ title }}</h3>\n        </header>\n        <main\n            *ngIf=\"!loading; else load_state\"\n            class=\"flex flex-col items-center space-y-2 px-2\"\n        >\n            <app-icon [icon]=\"icon\" class=\"text-5xl\"></app-icon>\n            <p content class=\"text-center text-sm\" [innerHTML]=\"content\"></p>\n        </main>\n        <footer\n            class=\"flex items-center justify-center p-2 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button mat-button class=\"inverse\" mat-dialog-close>\n                {{ cancel_text }}\n            </button>\n            <button mat-button name=\"accept\" (click)=\"onConfirm()\">\n                {{ confirm_text }}\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main loading>\n                <div class=\"h-48 w-64 flex flex-col items-center space-y-2\">\n                    <mat-spinner diameter=\"32\"></mat-spinner>\n                    <p>{{ loading }}</p>\n                </div>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            mat-dialog-actions button {\n                min-width: 8em;\n            }\n        `,\n    ],\n})\nexport class ConfirmModalComponent {\n    /** Loading state */\n    public loading: string;\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Title of the confirm modal */\n    public readonly title: string = this._data.title || 'Confirm';\n    /** Body of the confirm modal */\n    public readonly content: string = this._data.content || 'Are you sure?';\n    /** Display text on the confirm button */\n    public readonly confirm_text: string = this._data.confirm_text || 'Ok';\n    /** Display text on the cancel button */\n    public readonly cancel_text: string = this._data.cancel_text || 'Cancel';\n    /** Display icon properties */\n    public readonly icon: ApplicationIcon = this._data.icon || {\n        class: 'material-icons',\n        content: 'done',\n    };\n    /** Prevent user from closing the modal */\n    public readonly disableClose = () => (this._dialog_ref.disableClose = true);\n    /** Allow the user to close the modal */\n    public readonly enableClose = () => (this._dialog_ref.disableClose = false);\n\n    constructor(\n        private _dialog_ref: MatDialogRef<ConfirmModalComponent>,\n        @Inject(MAT_DIALOG_DATA) private _data: ConfirmModalData\n    ) {}\n\n    /** User confirmation of the content of the modal */\n    public onConfirm() {\n        this._dialog_ref.close('done');\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import { MatDialog } from '@angular/material/dialog';\nimport { first } from 'rxjs/operators';\nimport { HashMap } from './types';\n\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA,\n} from '../../../components/src/lib/confirm-modal.component';\n\n/** Available console output streams. */\nexport type ConsoleStream = 'debug' | 'warn' | 'log' | 'error';\n\nlet _app_name = 'APP';\n\nexport function setAppName(name: string) {\n    _app_name = name;\n}\n\n/**\n * Log data to the browser console\n * @param type Type of message\n * @param msg Message body\n * @param args array of argments to log to the console\n * @param stream Stream to emit the console on. 'debug', 'log', 'warn' or 'error'\n * @param force Whether to force message to be emitted when debug is disabled\n */\nexport function log(\n    type: string,\n    msg: string,\n    args?: any,\n    stream: ConsoleStream = 'debug',\n    force: boolean = false,\n    app_name: string = _app_name\n) {\n    if (window.debug || force) {\n        const colors: string[] = [\n            'color: #E91E63',\n            'color: #3F51B5',\n            'color: default',\n        ];\n        if (args) {\n            console[stream](\n                `%c[${app_name}]%c[${type}] %c${msg}`,\n                ...colors,\n                args\n            );\n        } else {\n            console[stream](`%c[${app_name}]%c[${type}] %c${msg}`, ...colors);\n        }\n    }\n}\n\n/**\n * Get item from the nested object\n * @param keys List of sub-keys to search for\n * @param map Object to search\n */\nexport function getItemWithKeys(keys: string[], map: HashMap) {\n    const key = keys.shift();\n    if (map && map[key] != null) {\n        return keys.length > 0 ? getItemWithKeys(keys, map[key]) : map[key];\n    }\n    return null;\n}\n\n/**\n * Remove duplicates from the given array\n * @param array List of items to remove duplicates from\n * @param key Key on array objects to compare for uniqueness\n */\nexport function unique(array: any[], key: string = '') {\n    return array.filter(\n        (el, pos, arr) =>\n            arr.indexOf(\n                key\n                    ? arr.find((i) => i[key] === el[key])\n                    : arr.find((i) => i === el)\n            ) === pos\n    );\n}\n\n/**\n * Generate a random number\n * @param ceil Biggest value to generate not inclusive\n * @param floor Smallest value to generate. Defaults to 0\n */\nexport function randomInt(ceil: number, floor: number = 0) {\n    return Math.floor(Math.random() * (ceil - floor)) + floor;\n}\n\nexport async function openConfirmModal(\n    data: ConfirmModalData,\n    dialog: MatDialog\n) {\n    const ref = dialog.open<ConfirmModalComponent, ConfirmModalData>(\n        ConfirmModalComponent,\n        {\n            ...CONFIRM_METADATA,\n            data,\n        }\n    );\n    return {\n        ...(await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ])),\n        loading: (s) => (ref.componentInstance.loading = s),\n        close: () => ref.close(),\n    };\n}\n\n/**\n * Parse raw CSV data into a JSON object\n * @param csv CSV data to parse\n */\nexport function csvToJson(csv: string, delimiter: string = ','): HashMap[] {\n    const objPattern = new RegExp(\n        '(\\\\,|\\\\r?\\\\n|\\\\r|^)(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|([^\\\\,\\\\r\\\\n]*))',\n        'gi'\n    );\n    let arrMatches = null,\n        arrData = [[]];\n    while ((arrMatches = objPattern.exec(csv))) {\n        if (arrMatches[1].length && arrMatches[1] !== ',') arrData.push([]);\n        arrData[arrData.length - 1].push(\n            arrMatches[2]\n                ? arrMatches[2].replace(new RegExp('\"\"', 'g'), '\"')\n                : arrMatches[3]\n        );\n    }\n    const headers: string[] = arrData.splice(0, 1)[0];\n    const elements = arrData.map((row) => {\n        const element = {};\n        for (let i = 0; i < row.length; i++) {\n            try {\n                element[headers[i]] = JSON.parse(row[i]);\n            } catch (e) {\n                element[headers[i]] = row[i] || '';\n            }\n        }\n        return element;\n    });\n    return elements;\n}\n\n/**\n * Convert javascript array to CSV string\n * @param json Javascript array to convert\n */\nexport function jsonToCsv(json: HashMap[]) {\n    if (json instanceof Array && json.length > 0) {\n        const keys = Object.keys(json[0]);\n        const valid_keys = keys.filter((key) => json[0].hasOwnProperty(key));\n        return `${valid_keys.join(',')}\\n${json\n            .map((item) =>\n                valid_keys.map((key) => JSON.stringify(item[key])).join(',')\n            )\n            .join('\\n')}`;\n    }\n    return '';\n}\n\n/**\n * Downloads a file to the users computer with the given filename and contents\n * @param filename Name of the file to download\n * @param contents Contents of the file to download\n */\nexport function downloadFile(filename: string, contents: string) {\n    const element = document.createElement('a');\n    element.setAttribute(\n        'href',\n        'data:text/plain;charset=utf-8,' + encodeURIComponent(contents)\n    );\n    element.setAttribute('download', filename);\n\n    element.style.display = 'none';\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n}\n\nexport function parseJWT(token: string) {\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(\n        atob(base64)\n            .split('')\n            .map((c) => {\n                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n            })\n            .join('')\n    );\n    return JSON.parse(jsonPayload);\n}\n\n/* istanbul ignore next */\n/**\n * Flatten nested array\n * @param an_array Array to flatten\n */\nexport function flatten<T = any>(an_array: T[]) {\n    const stack = [...an_array];\n    const res = [];\n    while (stack.length) {\n        // pop value from stack\n        const next = stack.pop();\n        if (Array.isArray(next)) {\n            // push back array items, won't modify the original input\n            stack.push(...next);\n        } else {\n            res.push(next);\n        }\n    }\n    // reverse to restore input order\n    return res.reverse();\n}\n\n/**\n * Check whether two time periods intersect with each other\n * @param start1 Unix epoch in ms of the first period's start time\n * @param end1 Unix epoch in ms of the first period's end time\n * @param start2 Unix epoch in ms of the second period's start time\n * @param end2 Unix epoch in ms of the second period's end time\n */\nexport function timePeriodsIntersect(start1, end1, start2, end2) {\n    return (\n        (start1 >= start2 && start1 < end2) ||\n        (end1 > start2 && end1 < end2) ||\n        (start2 >= start1 && start2 < end1) ||\n        (end2 > start1 && end2 <= end1)\n    );\n}\n\nconst seed = xmur3('PlaceOS');\nconst rand = sfc32(0x9e3779b9, 0x243f6a88, 0xb7e15162, seed());\n\nexport function predictableRandomInt(ceil: number = 100, floor: number = 0) {\n    return Math.floor(rand() * (ceil - floor)) + floor;\n}\n\n// https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript\nfunction xmur3(str) {\n    for (var i = 0, h = 1779033703 ^ str.length; i < str.length; i++)\n        (h = Math.imul(h ^ str.charCodeAt(i), 3432918353)),\n            (h = (h << 13) | (h >>> 19));\n    return function () {\n        h = Math.imul(h ^ (h >>> 16), 2246822507);\n        h = Math.imul(h ^ (h >>> 13), 3266489909);\n        return (h ^= h >>> 16) >>> 0;\n    };\n}\n\nfunction sfc32(a, b, c, d) {\n    return function () {\n        a >>>= 0;\n        b >>>= 0;\n        c >>>= 0;\n        d >>>= 0;\n        var t = (a + b) | 0;\n        a = b ^ (b >>> 9);\n        b = (c + (c << 3)) | 0;\n        c = (c << 21) | (c >>> 11);\n        d = (d + 1) | 0;\n        t = (t + d) | 0;\n        c = (c + t) | 0;\n        return (t >>> 0) / 4294967296;\n    };\n}\n\n/** Get time format string for locale */\nexport function timeFormatString(): string {\n    return is24HourTime() ? 'HH:mm' : 'h:mm a';\n}\n\n/** Whether locale string is displayed in 24 hour time */\nexport function is24HourTime(): boolean {\n    const date = new Date();\n    const localeString = date\n        .toLocaleTimeString(\n            document.querySelector('html').getAttribute('lang') ||\n                navigator.language\n        )\n        .toLowerCase();\n    return localeString.indexOf('am') < 0 && localeString.indexOf('pm') < 0;\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport { HashMap } from './types';\nimport { unique } from './general';\n\n/** List of keys that cannot be in a combination by themselves or with each other */\nconst INVALID_STANDALONE_KEYS: string[] = ['control', 'shift', 'alt', 'meta', 'os'];\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class HotkeysService {\n    /** Map of subjects which store press states of keys */\n    private keydown_states: HashMap<BehaviorSubject<number>> = {};\n    /** Map of obserers for key state subjects */\n    private keydown_observers: HashMap<Observable<number>> = {};\n    /** List of keys at the end of a combination */\n    private combo_end: string[] = [];\n    /** List of registered hotkey combinations */\n    private registered_combos: string[][] = [];\n    /** Counter for the number of keydown events. Used for checking order of key presses */\n    private counter: number = 0;\n    /** Last key code to be pressed */\n    private last_down: string;\n\n    constructor() {\n        window.addEventListener('keydown', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            if (this.last_down !== code) {\n                if (!this.keydown_states[code]) {\n                    this.keydown_states[code] = new BehaviorSubject(null);\n                    this.keydown_observers[code] = this.keydown_states[code].asObservable();\n                }\n                this.keydown_states[code].next(++this.counter);\n                if (this.combo_end.indexOf(code) >= 0) {\n                    event.preventDefault();\n                }\n                this.last_down = code;\n            }\n        });\n\n        window.addEventListener('keyup', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            this.keydown_states[code].next(null);\n            if (this.last_down === code) {\n                this.last_down = null;\n            }\n        });\n    }\n\n    /**\n     * Listen to the given key combination\n     * @param combo Array of key codes to listen to or a hotkey string e.g. `Alt+Shift+KeyK`\n     * @param next Callback for combination presses\n     */\n    public listen(combo: string | string[], next: () => void): Subscription {\n        combo = (combo instanceof Array ? combo : combo.split('+'));\n        const combination: string[] = combo.map(i => this.mapKey(i.toLowerCase()));\n        if (combination.length > 0 && this.validCombination(combination)) {\n            this.registered_combos.push(combination);\n            const last_key = combination[combination.length - 1];\n            if (!this.keydown_states[last_key]) {\n                this.keydown_states[last_key] = new BehaviorSubject(null);\n                this.keydown_observers[last_key] = this.keydown_states[last_key].asObservable();\n            }\n            this.updateCombinationEndList();\n            return this.keydown_observers[last_key].subscribe((count) => {\n                if (count) {\n                    const presses: number[] = [];\n                    if (combination.length > 0) {\n                        // Check that keys are pressed\n                        for (const key of combination) {\n                            const state = this.keydown_states[key];\n                            presses.push(state ? state.getValue() || -1 : -1);\n                        }\n                        // Check that keys are pressed in the correct order\n                        for (let i = 0; i < combination.length - 1; i++) {\n                            if (presses[i] > presses[i + 1]) { return; }\n                        }\n                    }\n                    const total = presses.reduce((a, v) => a + (v > 0 ? 1 : -1), 0);\n                    if (total >= combination.length) {\n                        next();\n                    }\n                }\n            });\n        }\n        return null;\n    }\n\n    /**\n     * Map key codes with multiple versions to simple form\n     * @param code Code to transform\n     */\n    private mapKey(code: string): string {\n        if (code.indexOf('alt') >= 0 || code.indexOf('shift') >= 0 || code.indexOf('control') >= 0) {\n            return code.replace('left', '').replace('right', '');\n        }\n        return code;\n    }\n\n    /**\n     * Update the list of the last keys in combinations to allow for prevent default actions on pre-existing hotkeys\n     */\n    private updateCombinationEndList(): void {\n        const key_list = [];\n        for (const combo of this.registered_combos) {\n            this.combo_end.push(combo[combo.length - 1]);\n        }\n        this.combo_end = unique(key_list);\n    }\n\n    /**\n     * Checks if the given hotkey combination is allowed and valid\n     * @param combo Array of key codes\n     */\n    private validCombination(combo: string[]): boolean {\n        let non_meta = 0;\n        for (const key of combo) {\n            if (INVALID_STANDALONE_KEYS.indexOf(key) < 0) {\n                non_meta++;\n            }\n        }\n        return non_meta > 0;\n    }\n}\n","\nconst general = {\n}\n\n\nconst app = {\n    name: 'Bookings',\n    title: 'PlaceOS',\n    description: 'Bookings UI',\n    short_name: 'PlaceOS',\n    logo: {\n        type: 'img',\n        src: 'assets/logo-light.svg'\n    },\n    logo_dark: {\n        type: 'img',\n        src: 'assets/logo-dark.svg'\n    },\n    general\n}\n\n/**\n * ROOT SETTIGNS\n */\nexport const DEFAULT_SETTINGS = {\n    debug: true,\n    composer: {\n        domain: '',\n        route: '/bookings',\n        protocol: '',\n        port: '',\n        use_domain: false,\n        local_login: false,\n    },\n    app\n};\n","import { Injectable } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { format, isSameDay } from 'date-fns';\n\nimport { log, getItemWithKeys } from './general';\nimport { DEFAULT_SETTINGS } from './settings';\nimport { HashMap } from './types';\nimport { BaseClass } from './base.class';\n\nimport { VERSION } from './version';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n        application: HashMap;\n    }\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SettingsService extends BaseClass {\n    /** Name of the application */\n    private _app_name = 'PlaceOS';\n    /** List of override settings in order of priority */\n    private _overrides = new BehaviorSubject<HashMap[]>([]);\n    /** Mapping of behaviour subjects */\n    private _subjects: HashMap<BehaviorSubject<any>> = {};\n    /** Mapping of observables */\n    private _observables: HashMap<Observable<any>> = {};\n\n    /**\n     * @hidden\n     */\n    public set overrides(value: HashMap[]) {\n        this._overrides.next(value);\n    }\n\n    /** Get observable for key */\n    public listen<T = any>(name: string): Observable<T> {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        return this._observables[name];\n    }\n\n    /** Update observable value for key */\n    public post<T>(name: string, value: T): void {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        this._subjects[name].next(value);\n    }\n\n    public value<T = any>(name: string): T {\n        return !this._observables[name] ? null : this._subjects[name].getValue();\n    }\n\n    /** Page title */\n    public get title() {\n        return this._title.getTitle();\n    }\n    public set title(value: string) {\n        this._title.setTitle(`${value} | ${this.get('app.name') || this._app_name}`);\n    }\n\n    constructor(private _title: Title) {\n        super();\n        const now = new Date();\n        const time = new Date(VERSION.time);\n        const built = isSameDay(now, time)\n            ? `Today at ${format(time, 'h:mma')}`\n            : format(time, 'do MMM yyyy, h:mma');\n        log('CORE', `${VERSION.semver}`, null, 'debug', true);\n        log('APP', `${VERSION.hash} | Built: ${built}`, null, 'debug', true);\n        this.init();\n    }\n\n    /**\n     * Initialise the settings\n     */\n    public async init() {\n        if (this.get('debug')) {\n            window.debug = true;\n        }\n        if (this.get('app')?.name) {\n            this._app_name = this.get('app').name;\n        }\n        log('Settings', 'Successfully loaded settings');\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.settings = this;\n        }\n    }\n\n    /** Whether settings service has initialised */\n    public get app_name() {\n        return this._app_name;\n    }\n\n    /**\n     * Get a setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public get<T = any>(key: string): T {\n        const keys = key.split('.');\n        if (keys[0] !== 'app') {\n            return getItemWithKeys(keys, DEFAULT_SETTINGS);\n        }\n        const override_settings = this._overrides.getValue();\n        for (const override of override_settings) {\n            const value = getItemWithKeys(keys.slice(1), override);\n            if (value != null) { return value; }\n        }\n        return getItemWithKeys(keys, DEFAULT_SETTINGS);\n    }\n}\n","// IMPORTANT: THIS FILE IS AUTO GENERATED! DO NOT MANUALLY EDIT OR CHECKIN!\n/* tslint:disable */\nexport const VERSION = {\n    \"dirty\": false,\n    \"raw\": \"4689a6e\",\n    \"hash\": \"4689a6e\",\n    \"distance\": null,\n    \"tag\": null,\n    \"semver\": null,\n    \"suffix\": \"4689a6e\",\n    \"semverString\": null,\n    \"version\": \"0.0.0\",\n    \"time\": 1618354982272\n};\n/* tslint:enable */\n","import { HashMap } from \"./types\";\n\n/**\n * Convert map into a query string\n * @param map Key value pairs to convert\n */\nexport function toQueryString(map: HashMap) {\n    let str = '';\n    if (map) {\n        for (const key in map) {\n            if (map.hasOwnProperty(key) && map[key] !== undefined && map[key] !== null) {\n                str += `${(str ? '&' : '')}${key}=${map[key]}`;\n            }\n        }\n    }\n    return str;\n}\n","import { MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';\n\nlet _service: MatSnackBar;\n\nexport function setNotifyOutlet(snackbar: MatSnackBar) {\n    _service = snackbar;\n}\n\n/**\n * Create notification popup\n * @param type CSS Class to add to the notification\n * @param message Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notify(\n    type: string,\n    message: string,\n    action: string = 'OK',\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    if (!_service) {\n        throw new Error(\"Snackbar service hasn't been initialised\");\n    }\n    const snackbar_ref = _service.open(message, action, {\n        panelClass: [type],\n        duration: 5000,\n        ...config,\n    });\n    if (action) {\n        on_action = on_action || (() => snackbar_ref.dismiss());\n        snackbar_ref.onAction().subscribe(() => on_action());\n    }\n}\n\n/**\n * Create success notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifySuccess(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.debug(msg);\n    notify('success', msg, action, on_action, config);\n}\n\n/**\n * Create error notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyError(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.error(msg);\n    notify('error', msg, action, on_action, config);\n}\n\n/**\n * Create warning notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyWarn(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.warn(msg);\n    notify('warn', msg, action, on_action, config);\n}\n\n/**\n * Create info notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyInfo(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.info(msg);\n    notify('info', msg, action, on_action, config);\n}\n","import { SwUpdate } from '@angular/service-worker';\n\nimport { log } from './general';\nimport { Subscription } from 'rxjs';\nimport { notifyInfo } from './notifications';\n\nlet _available: Subscription;\nlet _activated: Subscription;\nlet _timer: number;\n\nexport type Notification = (message: string, callback: () => void) => void;\n\n/**\n * Setup handler for cache change events\n * @param cache Angular Service worker service\n * @param notify Function to call on changes to the cache\n * @param interval Time interval to check the cache for changes\n */\nexport function setupCache(\n    cache: SwUpdate,\n    notify: Notification = () => null,\n    interval: number = 5 * 60 * 1000\n) {\n    if (cache.isEnabled) {\n        if (_available) _available.unsubscribe();\n        if (_activated) _activated.unsubscribe();\n        if (_timer) clearInterval(_timer);\n        _available = cache.available.subscribe((event) => {\n            const current = `current version is ${event.current.hash}`;\n            const available = `available version is ${event.available.hash}`;\n            log('CACHE', `Update available: ${current} ${available}`);\n            activateUpdate(cache);\n        });\n        _activated = cache.activated.subscribe(() => {\n            log('CACHE', `Updates activated. Reloading...`);\n            notify('Newer version of the application is available', () =>\n                location.reload(true)\n            );\n        });\n        _timer = <any>setInterval(() => {\n            log('CACHE', `Checking for updates...`);\n            cache.checkForUpdate();\n        }, interval);\n    }\n}\n\n/**\n * Update the cache and reload the page\n *\n */\nfunction activateUpdate(cache: SwUpdate) {\n    if (cache.isEnabled) {\n        log('CACHE', `Activating changes to the cache...`);\n        cache.activateUpdate().then(() => {\n            notifyInfo('Newer version of the application is available', 'Refresh', () =>\n                location.reload(true)\n            );\n        });\n    }\n}\n","import { trigger, transition, style, animate, state } from '@angular/animations';\n\nexport const ANIMATION_SHOW_ENTER_LEAVE = trigger('show', [\n    transition(':enter', [\n        style({ opacity: 0, height: 0 }),\n        animate(300, style({ opacity: 1, height: '*' }))\n    ]),\n    transition(':leave', [\n        style({ opacity: 1, height: '*' }),\n        animate(300, style({ opacity: 0, height: 0 }))\n    ])\n]);\n\nexport const ANIMATION_SHOW_CONTRACT_EXPAND = trigger('show', [\n    state('show', style({ opacity: 1, height: '*' })),\n    state('hide', style({ opacity: 0, height: 0, 'pointer-events': 'none' })),\n    transition('show <=> hide', animate('200ms ease-in'))\n]);\n","\nimport { HashMap } from './types';\n\nexport class BaseDataClass {\n    /** Unique Identifier of the object */\n    public readonly id: string;\n    /** Human readable name of the object */\n    public readonly name: string;\n    /** Email address associated with the object */\n    public readonly email: string;\n    /** Map of local property names to server ones */\n    protected _server_names: HashMap<string> = {};\n\n    constructor(raw_data: HashMap) {\n        this.id = raw_data.id || raw_data.zone_id || raw_data.email || '';\n        this.name = raw_data.name || '';\n        this.email = (raw_data.email || '').toLowerCase();\n    }\n\n    /**\n     * Convert object into plain object\n     */\n    public toJSON(this: BaseDataClass, with_changes: boolean = true): HashMap {\n        const obj: any = { ...this };\n        // Remove local private members\n\n        // Convert remaining members to be public\n        const keys = Object.keys(obj);\n        for (const key of keys) {\n            if (key[0] === '_') {\n                const new_key = this._server_names[key.substr(1)] || key.substr(1);\n                obj[new_key] = obj[key];\n                delete obj[key];\n            } else if (obj[key] === undefined) {\n                delete obj[key];\n            }\n        }\n        return obj;\n    }\n\n    /**\n     * Make a copy of this object\n     */\n    public clone(): BaseDataClass {\n        return new BaseDataClass(this);\n    }\n\n    /**\n     * Make a copy of this object without identification data\n     */\n    public duplicate(): BaseDataClass {\n        return new BaseDataClass({ ...this, id: null, email: null });\n    }\n}\n","import { BaseDataClass } from '../../../common/src/lib/base-api.class';\nimport { USER_DOMAIN } from './user.utilities';\n\nexport type EventResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted'\n    | '';\n\nexport class User extends BaseDataClass {\n    /** First name of the user */\n    public readonly first_name: string;\n    /** Last name of the user */\n    public readonly last_name: string;\n    /** Phone number of the user */\n    public readonly phone: string;\n    /** Organisation associated with the user */\n    public readonly organisation: string;\n    /** Details about the user */\n    public readonly notes: string;\n    /** URL to the user's photo */\n    public readonly photo: string;\n    /** Whether user is the event organiser */\n    public readonly organizer: boolean;\n    /** Whether the users is expected for an event */\n    public readonly response_status: EventResponseStatus;\n    /** Whether the users is expected for an event */\n    public visit_expected: boolean;\n    /** Whether user has been checked in */\n    public readonly checked_in: boolean;\n    /** Department that the user belongs to in the organisation */\n    public readonly groups: string[];\n    /** Extra metadata associated with the user */\n    public readonly extension_data: Record<string, any>;\n    /** Whether user is external from the organisation */\n    public readonly is_external: boolean;\n    /** Whether user needs assistance when attending an event */\n    public readonly assistance_required: boolean;\n\n    constructor(data: Partial<User> = {}) {\n        super(data);\n        this.first_name = data.first_name || data.name || '';\n        this.last_name = data.last_name || '';\n        this.phone = data.phone || '';\n        this.organisation = data.organisation || '';\n        this.notes = data.notes || '';\n        this.photo = data.photo || '';\n        this.organizer = !!data.organizer;\n        this.visit_expected = data.visit_expected;\n        this.checked_in = data.checked_in;\n        this.response_status = data.response_status || '';\n        const groups = (data.groups || []).map((i) => (i || '').toLowerCase());\n        if ((data as any).sys_admin) groups.push('placeos_admin');\n        if ((data as any).support) groups.push('placeos_support');\n        this.groups = groups;\n        this.extension_data = data.extension_data || {};\n        this.extension_data.assistance_required =\n            data.assistance_required || this.extension_data.assistance_required;\n        this.is_external =\n            (!this.email.includes(`@${USER_DOMAIN}`) && !!this.email) ||\n            this.visit_expected;\n        this.assistance_required = !!this.extension_data?.assistance_required;\n    }\n}\n\nexport class GuestUser extends User {\n    /** Preferred beverage of the guest */\n    public readonly preferred_beverage: string;\n    /** Whether guest has accepted the terms and conditions */\n    public readonly accepted_terms_conditions: boolean;\n\n    constructor(data: Partial<GuestUser> = {}) {\n        super(data);\n        this.preferred_beverage = data.preferred_beverage || '';\n        this.accepted_terms_conditions =\n            data.accepted_terms_conditions || false;\n    }\n}\n\nexport class StaffUser extends User {\n    /** Number associated with the user's access card */\n    public readonly card_number: number;\n    /** ID of the user */\n    public readonly staff_id: string;\n    /** Whether user is logged in */\n    public readonly is_logged_in: boolean;\n    /** Location of the user */\n    public readonly location: Record<string, any>;\n\n    constructor(data: Partial<StaffUser> = {}) {\n        super(data);\n        this.card_number = data.card_number || 0;\n        this.staff_id = data.staff_id || '';\n        this.location = data.location || {};\n        this.is_logged_in = !!data.is_logged_in;\n    }\n}\n","import { showUser } from '@placeos/ts-client';\nimport { BehaviorSubject } from 'rxjs';\nimport { delay, map, retry } from 'rxjs/operators';\n\nimport { StaffUser } from '../../../users/src/lib/user.class';\n\nconst _current_user = new BehaviorSubject<StaffUser>(null);\n\nexport const current_user = _current_user.asObservable();\n\ndeclare let jest;\n\nsetTimeout(() => {\n    try {\n        if (jest) return;\n    } catch {}\n    console.log('Loading logged in user details...');\n    showUser('current')\n        .pipe(\n            delay(1000),\n            retry(10),\n            map((i) => new StaffUser(i))\n        )\n        .subscribe((user) => _current_user.next(user));\n}, 300);\n\n/** Get the current user details */\nexport function currentUser() {\n    return _current_user.getValue();\n}\n","/** Domain of the organisation */\nexport const DOMAIN = 'place.tech';\n/** Endpoint where the staff API is located */\nexport const API = '/api/staff/v1';\n","import { DOMAIN } from './common.mock';\n\nconst PREDEF_USERS = [\n    'Jonathan McFarlane',\n    'Alex Sorafumo',\n    'Jim Doe',\n    'Cristina Boston',\n    'Jeremy West',\n    'Alexandre Chuvand',\n    'Viv Briffa',\n    'Candy Russo',\n    'Jeff Wiz',\n    'Sravani Kotha',\n    'Kim Burgess',\n    'Landell Archer',\n    'Caspian Baska',\n    'Stephen Von Takach',\n    'Cameron Reeves',\n    'Shane Boseley'\n];\n\nexport const ACTIVE_USER = {\n    id: 'current',\n    name: 'PlaceOS - Mock User',\n    email: 'dev@place.tech',\n    groups: ['deals', '']\n}\n\nexport const MOCK_STAFF = PREDEF_USERS.map((name, i) => ({\n    id: `user-${i + 1}`,\n    name,\n    email: `${name.split(' ').join('.').toLowerCase()}@${DOMAIN}`\n})).concat([ACTIVE_USER]);\n\nexport const MOCK_GUESTS = PREDEF_USERS.map((name, i) => ({\n    id: `guest-${i + 1}`,\n    name,\n    email: `${name.split(' ').join('.').toLowerCase()}@not-${DOMAIN}`\n}));\n","import {\n    Directive,\n    Input,\n    SimpleChanges,\n    OnInit,\n    OnChanges,\n    OnDestroy,\n    ElementRef,\n    Renderer2,\n    EventEmitter,\n    Output,\n} from '@angular/core';\nimport { onlineState, authority, getModule } from '@placeos/ts-client';\n\nimport { BaseClass } from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\n@Directive({\n    selector: 'i[bind], [binding], co-bind',\n})\nexport class BindingDirective<T = any>\n    extends BaseClass\n    implements OnInit, OnChanges, OnDestroy {\n    /** ID of the system to bind */\n    @Input() public sys: string;\n    /** Class name of the module to bind */\n    @Input() public mod: string;\n    /** Index of the system to bind */\n    @Input() public index = 1;\n    /** Status variable to bind to */\n    @Input() public bind: string;\n    /** Method to execute */\n    @Input() public exec: string;\n    /** Event to listen for on the parent */\n    @Input('onEvent') public on_event: string;\n    /** ID of the system to bind to */\n    @Input() public params: any[] = [];\n    /** Current value of the binding */\n    @Input() public model: T;\n    /** Emitter for changes to the value of the binding */\n    @Output() public modelChange = new EventEmitter<T>();\n\n    constructor(\n        private _element: ElementRef<HTMLElement>,\n        private _renderer: Renderer2\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        onlineState()\n            ?.pipe(first((_) => _))\n            .subscribe((_) => this.bindVariable());\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.sys || changes.mod || changes.bind) {\n            this.bindVariable();\n        }\n        if (\n            changes.model &&\n            changes.model.previousValue !== this.model &&\n            this.model != null\n        ) {\n            this.execute();\n        }\n        if (changes.on_event && this.on_event) {\n            this.subscription(\n                'on_event',\n                this._renderer.listen(\n                    this._element.nativeElement,\n                    this.on_event,\n                    () => this.execute()\n                )\n            );\n        }\n    }\n\n    /** Bind to set status variable */\n    private bindVariable() {\n        if (authority() && this.bind && this.sys && this.mod) {\n            const module = getModule(this.sys, this.mod, this.index);\n            const binding = module.binding(this.bind);\n            this.subscription('binding', binding.bind());\n            this.subscription(\n                'on_changes',\n                binding.listen().subscribe((value) =>\n                    setTimeout(() => {\n                        this.model = value;\n                        this.modelChange.emit(this.model);\n                    }, 10)\n                )\n            );\n        }\n    }\n\n    /** Excute the set method on the module */\n    private execute() {\n        if (authority() && this.exec && this.sys && this.mod) {\n            const module = getModule(this.sys, this.mod, this.index);\n            if (this.bind) this.params = [this.model];\n            module.execute(this.exec, this.params).then((result) => {\n                // Emit exec result if not bound to status variable\n                if (!this.bind) {\n                    this.model = result;\n                    this.modelChange.emit(this.model);\n                }\n            });\n        }\n    }\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: T) {\n        this.model = value;\n        this.modelChange.emit(this.model);\n        this.execute();\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from '@placeos/common';\n\n@Component({\n    selector: 'action-icon',\n    template: `\n        <button\n            mat-icon-button\n            class=\"relative flex items-center justify-center h-8 w-8\"\n            [class.success]=\"state === 'success'\"\n            [disabled]=\"loading || disabled\"\n        >\n            <app-icon root [className]=\"className\" [icon]=\"icon\">\n                {{ content }}\n                <ng-content></ng-content>\n            </app-icon>\n            <div [class]=\"'state center ' + state\" *ngIf=\"!loading && state\">\n                <app-icon>\n                    {{ state === 'success' ? 'done' : 'close' }}\n                </app-icon>\n            </div>\n            <div class=\"loader center\" *ngIf=\"loading\">\n                <mat-spinner [diameter]=\"16\"></mat-spinner>\n            </div>\n        </button>\n    `,\n    styles: [\n        `\n            .action-icon.fade > app-icon {\n                opacity: 0.35;\n            }\n\n            [center] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n\n            .success {\n                pointer-events: none;\n            }\n\n            .success app-icon[root] {\n                opacity: 0.2;\n            }\n\n            .state.success {\n                color: #388e3c;\n            }\n\n            .state.error {\n                color: #e53935;\n            }\n        `,\n    ],\n})\nexport class ActionIconComponent {\n    /** Icon to display */\n    @Input() public icon: ApplicationIcon;\n    /** Icon to display */\n    @Input() public className: string = 'material-icons';\n    /** Icon to display */\n    @Input() public content: string;\n    /** Whether action is being processed */\n    @Input() public loading: boolean;\n    /** Whether action is being processed */\n    @Input() public disabled: boolean;\n    /** State of the action */\n    @Input() public state: 'success' | 'error' | '' = '';\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\n@Pipe({\n    name: 'safe'\n})\nexport class SafePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    /**\n     * Sanitizes the string allowing it to be injected into a template\n     * @param value String to sanitize\n     * @param type Type of value to sanitise. `resource`, `url`, `script`, `style` or `html`\n     */\n    public transform(\n        value: string,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n            case 'url':\n                return this.sanitizer.bypassSecurityTrustUrl(value);\n            case 'script':\n                return this.sanitizer.bypassSecurityTrustScript(value);\n            case 'style':\n                return this.sanitizer.bypassSecurityTrustStyle(value);\n            default:\n                return this.sanitizer.bypassSecurityTrustHtml(value);\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from '@placeos/common';\n\n@Component({\n    selector: 'app-icon',\n    template: `\n        <div class=\"app-icon\">\n            <i *ngIf=\"!icon || icon.type !== 'img'\" [class]=\"icon?.class || className\">\n                {{ icon?.content }}\n                <ng-content></ng-content>\n            </i>\n            <img *ngIf=\"icon && icon.type === 'img'\" [src]=\"icon.src | safe: 'resource'\" />\n        </div>\n    `,\n    styles: [\n        `\n            .app-icon {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 1.25em;\n                width: 1.25em;\n            }\n\n            i {\n                font-size: 1em;\n            }\n\n            img {\n                height: 1em;\n                width: 1em;\n            }\n        `,\n    ],\n})\nexport class IconComponent {\n    @Input() public className: string = 'material-icons';\n    /** Icon details */\n    @Input() public icon: ApplicationIcon;\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { ApplicationIcon, BaseClass } from '@placeos/common';\n\nexport interface PopoutAction extends ApplicationIcon {\n    /** ID of the action */\n    id: string;\n}\n\n@Component({\n    selector: 'a-popout-menu',\n    template: `\n        <button\n            mat-icon-button\n            class=\"small absolute text-base center shadow\"\n            *ngFor=\"let item of actions; let i = index\"\n            [style.top]=\"show ? -110 * i - 60 + '%' : ''\"\n            (click)=\"action.emit(item.id); show = false\"\n        >\n            <app-icon [icon]=\"item\"></app-icon>\n        </button>\n        <button\n            name=\"root\"\n            mat-icon-button\n            [class.show]=\"show\"\n            (click)=\"show = !show\"\n            (window:click)=\"show ? close() : ''\"\n        >\n            <app-icon>{{ show ? 'add' : 'more_vert' }}</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n\n            app-icon {\n                transition: transform 200ms;\n            }\n\n            button {\n                background-color: #fff;\n                color: rgba(#000, 0.85);\n                font-size: 1.25rem;\n                height: 2.5em;\n                width: 2.5em;\n            }\n\n            button.show app-icon {\n                transform: rotate(45deg);\n            }\n\n            button.small {\n                transition: top 200ms, left 200ms;\n            }\n        `,\n    ],\n})\nexport class PopoutMenuComponent extends BaseClass {\n    /** List of available actions */\n    @Input() public actions: PopoutAction[] = [];\n    /** Emitter for user actions */\n    @Output() public action = new EventEmitter<string>();\n    /** Whether actions should show */\n    public show: boolean;\n\n    public close() {\n        this.timeout('close', () => (this.show = false));\n    }\n}\n","import {\n    AfterViewInit,\n    Component,\n    ElementRef,\n    InjectionToken,\n    Injector,\n    Input,\n    QueryList,\n    SimpleChanges,\n    TemplateRef,\n    Type,\n    ViewChild,\n    ViewChildren,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nimport {\n    applyGlobalStyles,\n    createViewer,\n    getViewer,\n    Point,\n    removeViewer,\n    updateViewer,\n    ViewAction,\n    ViewerFeature,\n    ViewerLabel,\n    ViewerStyles,\n} from '@placeos/svg-viewer';\n\nexport const MAP_FEATURE_DATA = new InjectionToken('Data for Map Features');\n\n@Component({\n    selector: `i-map,interactive-map`,\n    template: `\n        <div #outlet tabindex=\"0\" role=\"map\" class=\"absolute inset-0\"></div>\n        <mat-spinner\n            *ngIf=\"!viewer || loading\"\n            class=\"center\"\n            [diameter]=\"48\"\n        ></mat-spinner>\n        <div hidden *ngIf=\"injectors?.length\">\n            <ng-container *ngFor=\"let element of features; let i = index\">\n                <div *ngIf=\"element\">\n                    <div\n                        #feature\n                        class=\"pointer-events-none\"\n                        [attr.el-id]=\"element.location\"\n                        [attr.view-id]=\"viewer\"\n                    >\n                        <ng-container [ngSwitch]=\"featureType(element.content)\">\n                            <ng-container *ngSwitchCase=\"'html'\">\n                                <div [innerHtml]=\"element.content\"></div>\n                            </ng-container>\n                            <ng-container *ngSwitchCase=\"'template'\">\n                                <ng-container\n                                    *ngTemplateOutlet=\"\n                                        element.content;\n                                        context: { data: element.data }\n                                    \"\n                                ></ng-container>\n                            </ng-container>\n                            <ng-container *ngSwitchDefault>\n                                <ng-container\n                                    *ngComponentOutlet=\"\n                                        element.content;\n                                        injector: injectors[i]\n                                    \"\n                                ></ng-container>\n                            </ng-container>\n                        </ng-container>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class InteractiveMapComponent\n    extends BaseClass\n    implements AfterViewInit {\n    /** URL to the SVG file */\n    @Input() public src: string;\n    /** Custom CSS styles to apply to the SVG file */\n    @Input() public styles: ViewerStyles;\n    /** Zoom level to apply to the SVG */\n    @Input() public zoom: number = 1;\n    /** Zoom level to apply to the SVG */\n    @Input() public center: Point = { x: 0.5, y: 0.5 };\n    /** List of features to renderer over the SVG */\n    @Input() public features: ViewerFeature[];\n    /** List of labels to renderer over the SVG */\n    @Input() public labels: ViewerLabel[];\n    /** List of available user actions for the SVG */\n    @Input() public actions: ViewAction[];\n\n    public loading: boolean;\n\n    public injectors: Injector[] = [];\n\n    /** ID of the active SVG Viewer */\n    public viewer: string;\n\n    @ViewChild('outlet') private _outlet_el: ElementRef<HTMLDivElement>;\n    @ViewChildren('feature') private _feature_list: QueryList<\n        ElementRef<HTMLDivElement>\n    >;\n\n    public get feature_list() {\n        return (this.features || [])\n            .map((f, idx) => ({\n                ...f,\n                content: this._feature_list.toArray()[idx]?.nativeElement,\n            }))\n            .filter((f) => f.content);\n    }\n\n    constructor(private _injector: Injector) {\n        super();\n    }\n\n    public ngOnInit() {\n        applyGlobalStyles();\n    }\n\n    public ngOnDestroy(): void {\n        if (this.viewer) {\n            removeViewer(this.viewer);\n        }\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.src && this.src) {\n            this.createView();\n        }\n        if (this.viewer) {\n            if (changes.zoom || changes.center) {\n                this.updateDisplay();\n            }\n            if (\n                changes.styles ||\n                changes.features ||\n                changes.labels ||\n                changes.actions\n            ) {\n                this.injectors = (this.features || []).map((f: any) =>\n                    Injector.create({\n                        providers: [\n                            {\n                                provide: MAP_FEATURE_DATA,\n                                useValue: { ...f.data },\n                            },\n                        ],\n                        parent: this._injector,\n                    })\n                );\n                this.timeout('update_view', () => this.updateView(), 100);\n            }\n        }\n    }\n\n    public ngAfterViewInit() {\n        this.createView();\n    }\n\n    /** Get the type of the given content */\n    public featureType(content: TemplateRef<any> | Type<any> | string) {\n        if (typeof content === 'string') {\n            return 'html';\n        }\n        if (content instanceof TemplateRef) {\n            return 'template';\n        }\n        return 'component';\n    }\n\n    /** Update overlays, styles and actions of viewer */\n    private updateView() {\n        if (!getViewer(this.viewer) || this.loading) {\n            return this.timeout('update_view', () => this.updateView());\n        }\n        try {\n            updateViewer(this.viewer, {\n                styles: this.styles,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n            });\n        } catch (e) {}\n    }\n\n    /** Update zoom and center position of viewer */\n    private updateDisplay() {\n        updateViewer(this.viewer, {\n            zoom: this.zoom,\n            desired_zoom: this.zoom,\n            center: this.center,\n            desired_center: this.center,\n        });\n    }\n\n    private async createView() {\n        if (this.src && this._outlet_el?.nativeElement) {\n            this.loading = true;\n            if (this.viewer) {\n                removeViewer(this.viewer);\n            }\n            this.viewer = await createViewer({\n                element: this._outlet_el?.nativeElement,\n                url: this.src,\n                styles: this.styles,\n                zoom: this.zoom,\n                desired_zoom: this.zoom,\n                center: this.center,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n            });\n            this.timeout(\n                'update_view',\n                () => {\n                    this.updateView();\n                    this.updateDisplay();\n                },\n                100\n            );\n            this.loading = false;\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationLink } from '@placeos/common';\n\n@Component({\n    selector: 'status-overlay',\n    template: `\n        <div\n            status-overlay\n            class=\"fixed inset-0 flex flex-col bg-secondary items-center justify-center z-50 text-white\"\n        >\n            <ng-container *ngIf=\"!loading; else load_state\">\n                <div\n                    class=\"text-4xl rounded-full bg-white mb-4\"\n                    [class.text-success]=\"!error\"\n                    [class.text-error]=\"error\"\n                >\n                    <app-icon>{{ error ? 'close' : 'done' }}</app-icon>\n                </div>\n                <div class=\"text-center text-lg mb-4\">\n                    <ng-container *ngIf=\"!error; else error_msg\">\n                        <ng-content></ng-content>\n                    </ng-container>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <a\n                        button\n                        mat-button\n                        class=\"w-32\"\n                        *ngFor=\"let link of links\"\n                        [routerLink]=\"[link.route]\"\n                    >\n                        {{ link.name }}\n                    </a>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #error_msg\n            ><p error>{{ error }}</p></ng-template\n        >\n        <ng-template #load_state>\n            <mat-spinner [diameter]=\"32\" class=\"mb-4\"></mat-spinner>\n            <p loading class=\"text-center text-lg\">{{ loading }}</p>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class StatusOverlayComponent {\n    /** Whether overlay is loading */\n    @Input() public loading: string = '';\n    /** Details about any errors that have occurred */\n    @Input() public error: string = '';\n    /** Links to display on success */\n    @Input() public links: ApplicationLink[] = [];\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Input,\n    OnDestroy,\n    ViewChild,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nconst DEFAULT_KEYS = [\n    '0123456789'.split(''),\n    'qwertyuiop'.split(''),\n    'asdfghjkl'.split(''),\n    'zxcvbnm'.split(''),\n    ['{caps}', '{space}', '{backspace}'],\n];\n\n@Component({\n    selector: 'input[keyboard],textarea[keyboard]',\n    template: `\n        <ng-content></ng-content>\n        <ng-template cdk-portal>\n            <div\n                keyboard\n                class=\"w-screen flex flex-col space-y-4 bg-gray-200 p-2 border-t border-gray-400\"\n            >\n                <div\n                    row\n                    class=\"flex items-center justify-center space-x-2\"\n                    *ngFor=\"let row of keyset\"\n                >\n                    <ng-container *ngFor=\"let key of row\">\n                        <div\n                            [attr.key]=\"key\"\n                            tabindex=\"0\"\n                            class=\"rounded-xl p-2 border border-gray-300 relative cursor-pointer bg-white\"\n                            [class.special]=\"key[0] === '{' && key.length > 1\"\n                            [class.space]=\"key === '{space}'\"\n                            (focus)=\"focusInput()\"\n                            (click)=\"handleKeyPress(key)\"\n                        >\n                            {{\n                                key === '{space}'\n                                    ? 'Space'\n                                    : key === '{caps}'\n                                    ? 'Caps Lock'\n                                    : key === '{backspace}'\n                                    ? 'Backspace'\n                                    : key\n                            }}\n                            <div\n                                *ngIf=\"key === '{caps}'\"\n                                dot\n                                class=\"absolute top-2 right-2 h-2 w-2 rounded-full bg-gray-300\"\n                                [class.bg-success]=\"state === 'shift'\"\n                            ></div>\n                        </div>\n                    </ng-container>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            [key] {\n                height: 3.5rem;\n                width: 4rem;\n                transition: box-shadow 200ms, top 200ms;\n                box-shadow: 0 4px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key].special {\n                width: 10rem;\n            }\n\n            [key].space {\n                flex: 1;\n                min-width: 10rem;\n                max-width: 25rem;\n            }\n\n            [key]:hover {\n                top: 2px;\n                box-shadow: 0 2px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key]:active {\n                top: 4px;\n                box-shadow: 0 0 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n        `,\n    ],\n})\nexport class VirtualKeyboardComponent extends BaseClass implements OnDestroy {\n    /** Whether virtual keyboard should activate */\n    public static enabled: boolean;\n    /** List of rows of keys to display on the keyboard */\n    @Input() public keyset = DEFAULT_KEYS;\n    /** Current state of the displayed keyset */\n    public state: 'normal' | 'caps' | 'shift' = 'normal';\n    /** References to the overlay containing the keyboard */\n    private _overlay_ref: OverlayRef = null;\n    /** Portal with the keyboard contents */\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n\n    @HostListener('focus') public onFocus = () => {\n        if (!VirtualKeyboardComponent.enabled) return;\n        this.open();\n        this.clearTimeout('blur');\n    };\n    @HostListener('blur') public onBlur = () =>\n        this.timeout('blur', () => this.close());\n\n    constructor(\n        private _element: ElementRef<HTMLInputElement | HTMLTextAreaElement>,\n        private _overlay: Overlay\n    ) {\n        super();\n    }\n\n    public ngOnDestroy() {\n        super.ngOnDestroy();\n        this.close();\n    }\n\n    public focusInput() {\n        this._element?.nativeElement?.blur();\n        this._element?.nativeElement?.focus();\n    }\n\n    public open() {\n        if (this._overlay_ref) return;\n        if (!this._portal) return;\n        this._overlay_ref = this._overlay.create({\n            positionStrategy: this._overlay\n                .position()\n                .global()\n                .bottom()\n                .centerHorizontally(),\n        });\n        this._overlay_ref.attach(this._portal);\n    }\n\n    public close() {\n        if (this._overlay_ref) {\n            this._overlay_ref.dispose();\n            this._overlay_ref = null;\n        }\n    }\n\n    public handleKeyPress(key: string) {\n        let cursor_pos = this._element.nativeElement.selectionStart;\n        const str = this._element.nativeElement.value || '';\n        switch (key.toLowerCase()) {\n            case '{caps}':\n            case '{shift}':\n                this.state = 'shift';\n                break;\n            case '{backspace}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos - 1\n                )}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos = Math.max(0, cursor_pos - 1);\n                break;\n            case '{space}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${' '}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n                break;\n            default:\n                if (this.state === 'shift') this.state = 'normal';\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${key}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n        }\n        this._element.nativeElement.dispatchEvent(new InputEvent('input'));\n        this.updateKeyState();\n        this.timeout(\n            'focus',\n            () => {\n                this.focusInput();\n                this._element.nativeElement.selectionStart = cursor_pos;\n                this._element.nativeElement.selectionEnd = cursor_pos;\n            },\n            50\n        );\n    }\n\n    public updateKeyState() {\n        this.keyset = this.keyset.map((_) =>\n            _.map((k) =>\n                k.length > 1\n                    ? k\n                    : k[\n                          this.state !== 'normal'\n                              ? 'toUpperCase'\n                              : 'toLowerCase'\n                      ]()\n            )\n        );\n    }\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { ClipboardModule } from '@angular/cdk/clipboard';\nimport { MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { PortalModule } from '@angular/cdk/portal';\n\nimport { BindingDirective } from './binding.directive';\nimport { ActionIconComponent } from './action-icon.component';\nimport { IconComponent } from './icon.component';\nimport { PopoutMenuComponent } from './popout-menu.component';\nimport { UserAvatarComponent } from './user-avatar.component';\n\nimport { ConfirmModalComponent } from './confirm-modal.component';\nimport {\n    InteractiveMapComponent,\n    MAP_FEATURE_DATA,\n} from './interactive-map.component';\nimport { MapPinComponent } from './map-pin.component';\nimport { MapRadiusComponent } from './map-radius.component';\nimport { StatusOverlayComponent } from './status-overlay.component';\nimport { FixedPipe } from './fixed.pipe';\nimport { SafePipe } from './safe.pipe';\nimport { SanitizePipe } from './sanitise.pipe';\nimport { CustomTableComponent } from './custom-table.component';\nimport { CustomTooltipComponent } from './custom-tooltip.component';\nimport { VirtualKeyboardComponent } from './virtual-keyboard.component';\n\nexport * from './action-icon.component';\nexport * from './binding.directive';\nexport * from './confirm-modal.component';\nexport * from './icon.component';\nexport * from './login.component';\nexport * from './popout-menu.component';\nexport * from './unauthorised.component';\nexport * from './user-avatar.component';\nexport * from './interactive-map.component';\nexport * from './map-pin.component';\nexport * from './map-radius.component';\nexport * from './misconfigured.component';\nexport * from './status-overlay.component';\nexport * from './custom-table.component';\nexport * from './custom-tooltip.component';\nexport * from './fixed.pipe';\nexport * from './safe.pipe';\nexport * from './sanitise.pipe';\nexport * from './virtual-keyboard.component';\n\nexport * from './authorised-admin.guard';\nexport * from './authorised-user.guard';\n\nconst MAT_MODULES: any[] = [\n    MatAutocompleteModule,\n    MatMenuModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatButtonModule,\n    MatAutocompleteModule,\n    MatSelectModule,\n    MatDialogModule,\n    MatDatepickerModule,\n    MatInputModule,\n    ClipboardModule,\n    MatProgressSpinnerModule,\n    MatChipsModule,\n    MatPaginatorModule,\n    CdkTableModule,\n    PortalModule,\n];\n\nconst COMPONENTS: Type<any>[] = [\n    ActionIconComponent,\n    IconComponent,\n    PopoutMenuComponent,\n    UserAvatarComponent,\n\n    ConfirmModalComponent,\n    InteractiveMapComponent,\n    MapPinComponent,\n    MapRadiusComponent,\n    StatusOverlayComponent,\n    CustomTableComponent,\n    CustomTooltipComponent,\n    VirtualKeyboardComponent,\n\n    FixedPipe,\n    SafePipe,\n    SanitizePipe,\n];\n\nconst DIRECTIVES: Type<any>[] = [BindingDirective];\n\n@NgModule({\n    declarations: [...COMPONENTS, ...DIRECTIVES],\n    imports: [CommonModule, FormsModule, ReactiveFormsModule, ...MAT_MODULES],\n    providers: [\n        { provide: MAT_DATE_LOCALE, useValue: 'en-GB' },\n        { provide: MAP_FEATURE_DATA, useValue: {} },\n    ],\n    exports: [...COMPONENTS, ...DIRECTIVES, ...MAT_MODULES],\n})\nexport class ComponentsModule {}\n","<div class=\"item\" *ngIf=\"space\">\n    <div class=\"details\">\n        <div class=\"name truncate\">{{ space.name }}</div>\n        <div class=\"info\">{{ space.level?.display_name || space.level?.name }}</div>\n    </div>\n    <div class=\"capacity\" *ngIf=\"space.capacity !== -1\">\n        <app-icon [icon]=\"{ class: 'material-icons', content: 'account_circle' }\"></app-icon>\n        <div class=\"text\">{{ space.capacity }}</div>\n    </div>\n    <div class=\"actions\">\n        <button mat-icon-button *ngIf=\"multiple; else single_button\" (click)=\"action.emit()\">\n            <app-icon\n                [icon]=\"{\n                    class: 'material-icons',\n                    content: type === 'available' ? 'add' : 'close'\n                }\"\n            ></app-icon>\n        </button>\n    </div>\n</div>\n<ng-template #single_button>\n    <button mat-button [class.request]=\"space.by_request\">\n        {{ space.by_request ? 'Request' : 'Book' }}\n    </button>\n</ng-template>\n","import { Component, OnInit, Input } from '@angular/core';\nimport { Space } from '../../space.class';\n\n@Component({\n    selector: 'a-space-select-item',\n    templateUrl: './item.component.html',\n    styleUrls: ['./item.component.scss']\n})\nexport class SpaceSelectItemComponent implements OnInit {\n    /** Space to display details for */\n    @Input() public space: Space;\n    /** Type of  */\n    @Input() public type: 'available' | 'selected';\n\n    @Input() public multiple: boolean;\n\n    constructor() {}\n\n    public ngOnInit(): void {}\n}\n","import { CateringOption } from './catering.interfaces';\n\nexport class CateringItem {\n    /** ID of the catering item */\n    public readonly id: string;\n    /** Display name for the catering item */\n    public readonly name: string;\n    /** Category that this item is associated */\n    public readonly category: string;\n    /** Description of the contents of the catering item */\n    public readonly description: string;\n    /** Unit price in cents for the catering item */\n    public readonly unit_price: number;\n    /** Number of item in the associated order */\n    public readonly quantity: number;\n    /** List of options for the catering item */\n    public readonly options: CateringOption[];\n    /** List of attributes assoicated with the catering item */\n    public readonly tags: string[];\n    /** Total cost for the item */\n    public readonly total_cost: number;\n\n    constructor(data: Partial<CateringItem> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || data.id || '';\n        this.category = data.category || '';\n        this.unit_price = data.unit_price || 0;\n        this.description = data.description || '';\n        this.quantity = data.quantity || 0;\n        this.options = data.options || [];\n        this.tags = data.tags || [];\n        this.total_cost =\n            (this.unit_price + this.options.map((i) => i.unit_price || 0).reduce((c, a) => c + a, 0)) *\n            this.quantity;\n    }\n}\n","import { randomInt } from '@placeos/common';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { CateringItem } from './catering-item.class';\nimport { CateringOrderStatus } from './catering.interfaces';\n\nexport class CateringOrder {\n    /** ID of the order */\n    public readonly id: string;\n    /** ID of the space the order is associated */\n    public readonly system_id: string;\n    /** ID of the event the order is associated */\n    public readonly event_id: string;\n    /** List of items associated with the order */\n    public readonly items: readonly CateringItem[];\n    /** Number of items in the order */\n    public readonly item_count: number;\n    /** Total cost of order */\n    public readonly total_cost: number;\n    /** Invoice number associated with the order */\n    public readonly invoice_number: string;\n    /** Charge code for the order */\n    public readonly charge_code: string;\n    /** Unix epoch in seconds of order delivery time */\n    public readonly deliver_at: number;\n    /** Current status of the order */\n    public readonly status: CateringOrderStatus;\n    /** Event associated with the order */\n    public readonly event: CalendarEvent | null;\n\n    constructor(data: Partial<CateringOrder> = {}) {\n        this.id = data.id || `order-${randomInt(9_999_999, 1_000_000)}`;\n        this.event_id = data.event_id || data.event?.id || '';\n        this.items = (data.items || []).map(i => new CateringItem(i));\n        this.system_id = data.system_id;\n        this.item_count = this.items.reduce((amount, item) => amount + item.quantity, 0);\n        this.total_cost = this.items.reduce(\n            (amount, item) => amount + (item.total_cost || 0),\n            0\n        );\n        this.charge_code = data.charge_code || '';\n        this.status = data.status || 'accepted';\n        this.invoice_number = data.invoice_number || '';\n        this.event = data.event || null;\n        this.deliver_at = data.deliver_at || (data as any).date || this.event?.date || new Date().getTime();\n    }\n}\n","import { HashMap, Identity } from '@placeos/common';\n\n/** Building Level data */\nexport class BuildingLevel {\n    /** ID of the building level zone */\n    public readonly id: string;\n    /** ID of the building zone associated with the level */\n    public readonly parent_id: string;\n    /** Name of the level */\n    public readonly name: string;\n    /** Display name */\n    public readonly display_name: string;\n    /** Capacity for the level */\n    public readonly capacity: number;\n    /** Number or letter representing the level */\n    public readonly number: string;\n    /** URL of the map associated with the level */\n    public readonly map_id: string;\n    public readonly settings: HashMap = {};\n    public readonly locations: readonly Identity[];\n\n    constructor(_data: Partial<BuildingLevel> = {}) {\n        this.id = _data.id || '';\n        this.parent_id = _data.parent_id || '';\n        this.name = _data.name || '';\n        this.display_name = _data.display_name || '';\n        this.map_id = _data.map_id || '';\n        this.capacity = _data.capacity || 0;\n        this.locations = _data.locations || [];\n        const parts = this.display_name.split(' ');\n        this.number = (parts.length >= 2\n            ? parts[parts.length - 1]\n            : this.display_name[0]\n        )?.toUpperCase() || '';\n    }\n}\n","import { BaseDataClass, HashMap, Identity, RoomConfiguration } from '@placeos/common';\nimport { BookingRule } from '@placeos/events';\n\nimport { BuildingLevel } from './level.class';\n\nexport interface IBuildingRoleUser {\n    name: string;\n    email: string;\n    phone: string;\n}\n\nexport interface LockerMap {\n    [zone: string]: {\n        [area: string]: {\n            [type: string]: (string | boolean)[][];\n        };\n    };\n}\n\nexport interface ICoordinates {\n    longitude: number;\n    latitude: number;\n}\n\nexport interface LevelFeature {\n    id: string;\n    level_id: string;\n    name: string;\n}\n\nexport interface BookingRuleDetails {\n    /** List of booking rules details for the building */\n    readonly rules: readonly string[];\n    /** Custom booking rules for the map */\n    readonly map_rules?: readonly string[];\n    /** Contact email address for the building */\n    readonly contact?: string;\n    /** Information string to display before the rule listings */\n    readonly info?: string;\n}\n\nexport class Building extends BaseDataClass {\n    /** Name to display */\n    public readonly display_name: string;\n    /** Engine Zone ID for the building */\n    public readonly zone_id: string;\n    /** Organisation Code for the building */\n    public readonly code: string;\n    /** Geographical address of the building */\n    public readonly address: string;\n    /** IANA timezone string for building */\n    public readonly timezone: string;\n    /** ID of space that temporarily holds new meetings */\n    public readonly holding_bay: string;\n    /** ID of the space for assigning new visitor bookings to */\n    public readonly visitor_space: string;\n    /** Details about the booking rules for the building */\n    public readonly booking_details: BookingRuleDetails;\n    /** Details about the booking rules for the building */\n    public readonly booking_rules: HashMap<readonly BookingRule[]>;\n    /** Number of hour before a booking catering is restricted */\n    public readonly catering_restricted_from: number;\n    /** Currency code for the country assoicated with the building */\n    public readonly currency: string;\n    /** List of available extras for the building */\n    public readonly extras: readonly Identity[];\n    /** List of available extra equipment for loan at the building */\n    public readonly loan_items: readonly Identity[];\n    /** List of available levels for the building */\n    public readonly levels: readonly BuildingLevel[];\n    /** List of zones associated with the building */\n    public readonly zones: readonly string[];\n    /** Searchable map features */\n    public readonly searchables: readonly LevelFeature[];\n    /** List of available room configurations for the building */\n    public readonly room_configurations: readonly RoomConfiguration[];\n    /** Start and end hours catering can be delivered */\n    public readonly catering_hours: { start: number, end: number };\n    /** PlaceOS bindings for applications */\n    public readonly bindings: HashMap<string>;\n\n    public readonly orientations: HashMap<number>;\n    public readonly attributes: readonly Identity[];\n    /** Map of roles and list of the associated users */\n    private _roles: HashMap<IBuildingRoleUser[]>;\n    /** Map of the locker ID arrays */\n    private _lockers: LockerMap;\n    /** Map of important system ids for the building */\n    private _systems: HashMap<string>;\n    /** Map of important phone numbers for the building */\n    private _phone_numbers: HashMap<string>;\n    /** Globe coordiates for the build */\n    private _location: ICoordinates;\n\n\n    constructor(raw_data: HashMap = {}) {\n        super(raw_data);\n        const settings = raw_data.settings || {};\n        this.display_name = raw_data.display_name;\n        const disc_info = settings.discovery_info || settings;\n        this.zone_id = raw_data.zone_id || raw_data.zone;\n        this.extras = (raw_data.extras || disc_info.extras || []).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.loan_items = (raw_data.loan_items || disc_info.loan_items || []).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.levels = (raw_data.levels || disc_info.levels || []).map(\n            (i) => new BuildingLevel({ ...i, building_id: this.id })\n        );\n        this._roles = raw_data.roles || disc_info.roles || {};\n        this._lockers =\n            raw_data.lockers || raw_data.locker_structure || disc_info.locker_structure || {};\n        this._systems = raw_data.systems || disc_info.systems || {};\n        this._phone_numbers = raw_data.phone_numbers || disc_info.phone_numbers || {};\n        this._location = raw_data.location ||\n            disc_info.location || { longitude: null, latitude: null };\n        this.room_configurations =\n            raw_data.room_configurations || disc_info.room_configurations || [];\n        this.attributes =\n            raw_data.attributes || disc_info.attributes || [];\n        const searchables = [];\n        if (raw_data.neighbourhoods) {\n            for (const lvl in raw_data.neighbourhoods) {\n                if (raw_data.neighbourhoods.hasOwnProperty(lvl)) {\n                    const lvl_features = raw_data.neighbourhoods[lvl] || {};\n                    for (const feature in lvl_features) {\n                        if (lvl_features.hasOwnProperty(feature)) {\n                            searchables.push({\n                                id: lvl_features[feature],\n                                name: feature,\n                                level_id: lvl,\n                            });\n                        }\n                    }\n                }\n            }\n        }\n        this.bindings = raw_data.bindings || {};\n        this.searchables = searchables;\n        this.timezone = raw_data.timezone || disc_info.timezone || settings.timezone || '';\n        this.catering_hours = raw_data.catering_hours || disc_info.catering_hours || settings.catering_hours || { start: 7, end: 20 };\n        this.visitor_space = raw_data.visitor_space || disc_info.visitor_space || settings.visitor_space || '';\n        this.holding_bay = raw_data.holding_bay || disc_info.holding_bay || settings.holding_bay || '';\n        this.code = raw_data.code || disc_info.code || settings.code || '';\n        this.address = raw_data.address || disc_info.address || settings.address || '';\n        this.orientations = raw_data.orientations || disc_info.orientations || settings.orientations || {};\n        this.booking_details =\n            raw_data.booking_details ||\n            disc_info.booking_details ||\n            settings.booking_details ||\n            null;\n        this.booking_rules =\n            raw_data.booking_rules || disc_info.booking_rules || settings.booking_rules || {};\n        this.catering_restricted_from =\n            raw_data.catering_restricted_from ||\n            disc_info.catering_restricted_from ||\n            settings.catering_restricted_from ||\n            -1440;\n        this.currency = raw_data.currency || disc_info.currency || settings.currency || 'USD';\n    }\n\n    /**\n     * Get list of users with the associated role\n     * @param name Role to find users for\n     */\n    public role(name: string): IBuildingRoleUser[] {\n        return [...(this._roles[name] || [])];\n    }\n    /**\n     * Get list of the names of available user role lists\n     */\n    public get role_names(): string[] {\n        return Object.keys(this._roles).filter((i) => this._roles.hasOwnProperty(i));\n    }\n    /** Map of the locker ID arrays */\n    public get lockers(): LockerMap {\n        return { ...(this._lockers || {}) };\n    }\n    /** Map of important system ids for the building */\n    public get systems(): HashMap<string> {\n        return { ...(this._systems || {}) };\n    }\n    /** Map of important phone numbers for the building */\n    public get phone_numbers(): HashMap<string> {\n        return { ...(this._phone_numbers || {}) };\n    }\n\n    /**\n     * Get search map feature for the given level ID\n     * @param level_id ID of level to grab features for\n     */\n    public featuresForLevel(level_id: string): LevelFeature[] {\n        return (this.searchables || []).filter((i) => i.level_id === level_id);\n    }\n}\n","import { BaseDataClass, getItemWithKeys, HashMap } from '@placeos/common';\n\nexport class Organisation extends BaseDataClass {\n    /** Description for the Organisation */\n    public readonly description: string;\n    /** Tags for the Organisation */\n    public readonly tags: string[];\n    /** Count for the Organisation */\n    public readonly count: number;\n    /** Capacity for the Organisation */\n    public readonly capacity: number;\n    /** Parent ID for the Organisation */\n    public readonly _parent_id: string;\n    /** PlaceOS bindings for applications */\n    public readonly bindings: HashMap<string>;\n    /** Map of custom settings for the building */\n    private _settings: HashMap;\n\n    constructor(raw_data: Partial<Organisation> = {}) {\n        super(raw_data);\n        this.description = raw_data.description || '';\n        this.tags = raw_data.tags || [];\n        this.count = raw_data.count || 0;\n        this.capacity = raw_data.capacity || 0;\n        this.bindings = raw_data.bindings || {};\n        this._settings = (raw_data as any).settings || {};\n    }\n\n    /**\n     * Get a custom organisation setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public setting(key: string): any {\n        const keys = key.split('.');\n        const value = getItemWithKeys(keys, this._settings);\n        return value;\n    }\n}\n","\nexport class Desk {\n    /** ID of the desk also map_id */\n    public readonly id: string;\n    /** Name of the desk */\n    public readonly name: string;\n    /** Whether desk is available / bookable */\n    public readonly bookable: boolean;\n    /** Zone/Level of the desk */\n    public readonly zone: any;\n    /** Group/Department allocated to the desk */\n    public readonly groups: string[];\n\n    constructor(data) {\n        this.id = data.id;\n        this.name = data.name;\n        this.bookable = data.bookable;\n        this.zone = data.zone;\n        this.groups = data.groups || [];\n    }\n\n    public format() {\n        const { id, name, bookable, groups } = this;\n        return {\n            id,\n            name,\n            bookable,\n            groups,\n        };\n    }\n}\n","import { Injectable } from '@angular/core';\nimport {\n    onlineState,\n    queryZones,\n    showMetadata,\n    updateMetadata,\n    listChildMetadata,\n    authority,\n    isMock,\n} from '@placeos/ts-client';\nimport { first, map } from 'rxjs/operators';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\n\nimport { Organisation } from './organisation.class';\nimport { Building } from './building.class';\nimport { BuildingLevel } from './level.class';\nimport { Desk } from './desk.class';\nimport { HashMap, notifyError, RoomConfiguration, SettingsService } from '@placeos/common';\nimport { Router } from '@angular/router';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class OrganisationService {\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    private readonly buildings_subject = new BehaviorSubject<Building[]>([]);\n    private readonly active_building_subject = new BehaviorSubject<Building>(null);\n    private readonly levels_subject = new BehaviorSubject<BuildingLevel[]>([]);\n\n    /** Observable for the list of buildings */\n    public readonly building_list = this.buildings_subject.asObservable();\n    /** Observable for the list of levels */\n    public readonly level_list = this.levels_subject.asObservable();\n    /** Observable for the currently active building */\n    public readonly active_building = this.active_building_subject.asObservable();\n    /** Observable for the levels associated with the currently active building */\n    public readonly active_levels = combineLatest([this.level_list, this.active_building]).pipe(\n        map((details) => (details[1] ? this.levelsForBuilding(details[1]) : []))\n    );\n    /** Organisation data for the application */\n    private _organisation: Organisation;\n    /** Mapping of organisation settings overrides */\n    private _settings: HashMap = {};\n    /** Mapping of buildings to settings overrides */\n    private _building_settings: HashMap<HashMap> = {};\n\n    /** Mapping of organisation settings overrides */\n    public get settings(): HashMap {\n        return this._settings;\n    }\n\n    /** Mapping of builgins to settings overrides */\n    public get building_settings(): HashMap<HashMap> {\n        return this._building_settings;\n    }\n\n    /** Mapping building settings overrides */\n    public buildingSettings(bld_id: string = ''): HashMap {\n        if (!bld_id && this.building) {\n            bld_id = this.building.id;\n        }\n        return this._building_settings ? this._building_settings[bld_id] || {} : {};\n    }\n\n    /** Organisation data for the application */\n    public get organisation(): Organisation {\n        return this._organisation;\n    }\n\n    /** List of available buildings */\n    public get buildings(): Building[] {\n        return this.buildings_subject.getValue();\n    }\n\n    /** Currently active building */\n    public get building(): Building {\n        return this.active_building_subject.getValue();\n    }\n    public set building(bld: Building) {\n        this.active_building_subject.next(bld);\n        this._service.overrides = [\n            this._settings.details,\n            this.buildingSettings(bld.id).details,\n        ];\n\n    }\n\n    /** Get building by id */\n    public find(id: string) {\n        return this.buildings.find((i) => i.id === id || i.email === id);\n    }\n\n    /** List of available levels */\n    public get levels(): BuildingLevel[] {\n        return this.levels_subject.getValue();\n    }\n\n    constructor(private _service: SettingsService, private _router: Router) {\n        onlineState()\n            .pipe(first((_) => _))\n            .subscribe(() => setTimeout(() => this.init(), 1000));\n        this.active_building.subscribe((bld) => {\n            if (bld) {\n                this._service.overrides = [this._settings, this.buildingSettings(bld.id)];\n            }\n        });\n    }\n\n    /**\n     * Get level with a matching ID\n     * @param id_list List of IDs to find a match\n     */\n    public levelWithID(id_list: string[]): BuildingLevel {\n        return this.levels.find((lvl) => id_list?.includes(lvl.id));\n    }\n\n    /**\n     * Get list of levels for the given building\n     * @param bld Building to list levels for\n     */\n    public levelsForBuilding(bld: Building): BuildingLevel[] {\n        return this.levels.filter((lvl) => lvl.parent_id === bld.id);\n    }\n\n    private async init() {\n        this._initialised.next(false);\n        await this.load().catch((err) => {\n            notifyError('Error loading organisation data. Retrying...');\n            setTimeout(() => this.init(), 300);\n            throw err;\n        });\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.orgs = this;\n        }\n    }\n\n    /**\n     * Initialise service data\n     */\n    private async load(): Promise<void> {\n        await this.loadOrganisation();\n        await this.loadBuildings();\n        await this.loadLevels();\n        await this.loadSettings();\n    }\n\n    /**\n     * Load organisation data for application\n     */\n    public async loadOrganisation(): Promise<void> {\n        const org_list = await queryZones({ tags: 'org' } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (org_list.length) {\n            const auth = authority();\n            const org = org_list.find(list => isMock() || list.id === auth?.config?.org_zone) || org_list[0];\n            const bindings = (await showMetadata(org.id, { name: 'bindings' }).toPromise())?.details;\n            this._organisation = new Organisation({ ...org_list[0], bindings } as any);\n        } else {\n            this._router.navigate(['/misconfigured']);\n        }\n    }\n\n    /**\n     * Load buildings data for the organisation\n     */\n    public async loadBuildings(): Promise<void> {\n        const building_list = await queryZones({\n            tags: 'building',\n            limit: 500,\n        } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (!building_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const buildings = []\n        for (const bld of building_list) {\n            const bindings = (await showMetadata(bld.id, { name: 'bindings' }).toPromise())?.details;\n            buildings.push(new Building({ ...bld, bindings }));\n        }\n        this.buildings_subject.next(buildings);\n        const id = localStorage.getItem(`PLACEOS.building`);\n        if (id && this.buildings.find((bld) => bld.id === id)) {\n            this.active_building_subject.next(this.buildings.find((bld) => bld.id === id));\n        }\n        if (!this.building && buildings && buildings.length > 0) {\n            this.building = buildings[0];\n        }\n    }\n\n    /**\n     * Load levels data for the buildings\n     */\n    public async loadLevels(): Promise<void> {\n        const level_list = await queryZones({ tags: 'level', limit: 2500 } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (!level_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const levels = level_list.map((lvl) => new BuildingLevel(lvl));\n        levels.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\n        this.levels_subject.next(levels);\n    }\n\n    public get available_room_configs(): RoomConfiguration[] {\n        return this.buildings\n            .map((m) => [...m.room_configurations])\n            .reduce((prev, curr) => prev.concat(curr), [])\n            .sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    /** Load metadata for the zone id */\n    public loadMetadata(zone_id: string, query?: HashMap) {\n        return showMetadata(zone_id, query);\n    }\n\n    /** Update Desks for zone */\n    public async updateDesks(zone_id: string, data: any) {\n        return updateMetadata(zone_id, {\n            name: 'desks',\n            description: 'desks',\n            details: data,\n        }).toPromise();\n    }\n\n    /** Load Desks zone */\n    public async loadZoneDesks(zone_id: string): Promise<Desk[]> {\n        const metadata: any = await this.loadMetadata(zone_id, { name: 'desks' }).toPromise();\n        const data = metadata.details;\n        if (!data) {\n            return [];\n        }\n        return data.map(\n            (i) =>\n                new Desk({\n                    ...i,\n                    parent_id: data.parent_id,\n                })\n        );\n    }\n\n    /** Load desks metadata for the parent zone_id */\n    public async loadDesks(zone_id): Promise<any[]> {\n        const levels = await listChildMetadata(zone_id, {\n            tags: 'level',\n            name: 'desks',\n        }).toPromise();\n        const desks = [];\n        levels.forEach((level) => {\n            if (level.metadata?.desks?.details) {\n                (level.metadata.desks.details as any).forEach((desk) => {\n                    desks.push(\n                        new Desk({\n                            ...desk,\n                            zone: level.zone,\n                        })\n                    );\n                });\n            }\n        });\n        return desks;\n    }\n\n    public async loadSettings() {\n        if (!this._organisation) return;\n        const app_name = `${(this._service.get('app.name') || 'workplace').toLowerCase()}_app`;\n        this._settings = await showMetadata(this._organisation.id, {\n            name: app_name\n        }).toPromise();\n        const buildings = this.buildings;\n        for (const bld of buildings) {\n            this._building_settings[bld.id] = await showMetadata(bld.id, {\n                name: app_name,\n            }).toPromise();\n        }\n        this._service.overrides = [\n            this._settings.details,\n            this.buildingSettings(this.building.id).details,\n        ];\n    }\n\n    /** Save building selection */\n    public saveBuilding(id: string) {\n        localStorage.setItem(`PLACEOS.building`, id);\n    }\n}\n","import { RoomConfiguration } from '@placeos/common';\nimport { BuildingLevel } from '@placeos/organisation';\n\nexport type ResourceResponseStatus = 'needsAction' | 'declined' | 'tentative' | 'accepted';\n\nexport class Space {\n    /** ID of the space resource */\n    public readonly id: string;\n    /** Display name of the space resource */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Email address of the resource associated with space */\n    public readonly email: string;\n    /** Capacity of the space resource */\n    public readonly capacity: number;\n    /** List of features available at the space resource  */\n    public readonly feature_list: string[];\n    /** URL to a supporting site for space */\n    public readonly support_url: string;\n    /** ID of the space on the associated map */\n    public readonly map_id: string;\n    /** Whether resource is bookable */\n    public readonly bookable: boolean;\n    /** List of zones the spaces is associated with */\n    public readonly zones: string[];\n    /** List of available room configurations for this room */\n    public readonly configurations: readonly RoomConfiguration[];\n    /** Image url */\n    public readonly image: string;\n    /** Status of the resource */\n    public readonly response_status: ResourceResponseStatus;\n    /** Level Assoicated with the space */\n    public readonly level: BuildingLevel;\n    /** List of features associated with the space */\n    public readonly features: string;\n\n    constructor(data: Partial<Space> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.display_name = data.display_name || '';\n        this.email = (data.email || '').toLowerCase();\n        this.capacity = data.capacity || -1;\n        this.feature_list = data.feature_list || (data.features as any) || [];\n        this.bookable = !!data.bookable;\n        this.zones = data.zones || [];\n        this.support_url = data.support_url || '';\n        this.map_id = data.map_id || '';\n        this.image = data.image || '';\n        this.configurations = data.configurations || [];\n        this.features = data.features || '';\n        this.response_status = data.response_status;\n        this.level = data.level || new BuildingLevel();\n    }\n}\n","import { PlaceSystem } from '@placeos/ts-client';\nimport {\n    startOfDay,\n    differenceInMinutes,\n    isSameDay,\n    add,\n    isBefore,\n    roundToNearestMinutes,\n    addMinutes,\n} from 'date-fns';\n\nimport { HashMap, Identity, unique } from '@placeos/common';\nimport { CateringOrder } from '../../../catering/src/lib/catering-order.class';\nimport { User } from '../../../users/src/lib/user.class';\nimport { Space } from '../../../spaces/src/lib/space.class';\n\nimport { EventNote } from './event.interfaces';\nimport { eventStatus } from './helpers';\n\nlet _default_user: Identity = { id: 'default', name: 'Default User' };\n\nexport function setDefaultCreator(user: Identity) {\n    if (user) _default_user = user;\n}\n\nexport interface FileDetails {\n    /** Name of the file */\n    name: string;\n\n    /** Blob contents of the file */\n    blob: Blob;\n}\n\nexport interface ExtDataDetails extends HashMap {\n    /** Setup in minutes */\n    setup?: number;\n    /** Breakdown in minutes */\n    breakdown?: number;\n    /** Whether event is cleaned */\n    cleaned?: boolean;\n    /** Catering */\n    catering?: CateringOrder[];\n    /** Parking */\n    needs_parking?: boolean;\n    /** Configuration */\n    configuration?: any;\n    /** Notes */\n    notes?: EventNote[];\n}\n\nexport interface RecurrenceDetails {\n    /** Start of the recurrence in unix ms */\n    start: number;\n    /** End of the recurrence in unix ms */\n    end: number;\n    /** Days of the week (or month) on which the event should be repeated */\n    days_of_week: number;\n    /** Frequency of the event */\n    pattern: 'daily' | 'weekly' | 'monthly';\n    /** Interval to be used with pattern */\n    interval: number;\n}\n\n/** User's calendar event/booking */\nexport class CalendarEvent {\n    /** ID of the calendar event */\n    public readonly id: string;\n    /** Status of the event */\n    public readonly status: 'confirmed' | 'tentative' | 'cancelled' | 'none';\n    /** Email address of the host */\n    public readonly host: string;\n    /** ID of the calendar associated with the event */\n    public readonly calendar: string;\n    /** Email address of the event creator */\n    public readonly creator: string;\n    /** List of attendees of the event */\n    public readonly attendees: User[];\n    /** List of attendees of the event */\n    public readonly resources: Space[];\n    /** Summary of the event details */\n    public readonly title: string;\n    /** Extended details of the event */\n    public readonly body: string;\n    /** Whether event details should be private */\n    public readonly private: boolean;\n    /** Whether event occurs over the full day */\n    public readonly all_day: boolean;\n    /** Unix epoch of the start time of the event */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** IANA timezone string for the event location */\n    public readonly timezone: string;\n    /** Location details for the event */\n    public readonly location: string;\n    /** Whether this event is recurring */\n    public readonly recurring: boolean;\n    /** URL to a conference call application instance */\n    public readonly meeting_link: string;\n    /** Details about the event's recurrence */\n    public readonly recurrence: RecurrenceDetails;\n    /** ID of the parent recurring event */\n    public readonly recurring_master_id: string;\n    /** File attachements for the event */\n    public readonly attachments: FileDetails[];\n    /** Extra data associated with the event */\n    public readonly extension_data: ExtDataDetails;\n    /** System */\n    public readonly system: PlaceSystem;\n    /** Old System id */\n    public readonly old_system: PlaceSystem;\n    /** Host user details of the event */\n    public readonly organiser: Identity;\n    /** Whether user is allowed to access the lift */\n    public readonly can_access_lift: boolean;\n    /** Whether the host has requested catering for this event */\n    public readonly has_catering: boolean;\n    /** Whether the event has external attendees */\n    public readonly has_visitors: boolean;\n    /** List of catering orders for the event */\n    public readonly catering: CateringOrder[];\n    /** Whether a parking spot is needed for attendees */\n    public readonly needs_parking: boolean;\n    /** Name of the type of external attendees */\n    public readonly visitor_type: string;\n    /** Setup time before event start in minutes */\n    public readonly setup: number;\n    /** Breakdown/Cleanup time after event start in minutes */\n    public readonly breakdown: number;\n    /** List of attendees that are attending remotely */\n    public readonly remote: readonly string[];\n    /** List of email addresses associated with the event attendees */\n    public readonly attendee_emails: readonly string[];\n    /** List of external attendees associated with the event */\n    public readonly guests: readonly Identity[];\n    /** Type of event */\n    public readonly type: 'cancelled' | 'external' | 'internal';\n    /** List of notes associated with the event */\n    public readonly notes: readonly EventNote[];\n    /** First space in the resources list */\n    public readonly space: Identity;\n    /** Whether the time of the booking has been changed */\n    public time_changed: boolean;\n    /** Master event */\n    public master?: CalendarEvent;\n\n    constructor(data: Partial<CalendarEvent> = {}) {\n        this.id = data.id || '';\n        this.calendar = data.calendar || '';\n        this.creator = (data.creator || _default_user.email)?.toLowerCase();\n        this.host = (data.host || this.creator || '').toLowerCase();\n        const attendees = data.attendees || [];\n        this.attendees = attendees\n            .filter((user: any) => !user.resource)\n            .map((u) => new User(u));\n        this.resources =\n            data.resources ||\n            attendees\n                .filter((user: any) => user.resource)\n                .map((s) => new Space(s as any));\n        this.title = data.title || '';\n        this.body = data.body || '';\n        this.private = !!data.private;\n        this.all_day = !!data.all_day;\n        const time = data.event_start * 1000 || data.date;\n        const start = time\n            ? new Date(time)\n            : roundToNearestMinutes(\n                  new Date().setMinutes(new Date().getMinutes() + 3),\n                  {\n                      nearestTo: 5,\n                  }\n              );\n        this.date = this.all_day\n            ? startOfDay(start).valueOf()\n            : start.valueOf();\n        this.duration = this.all_day\n            ? 24 * 60\n            : data.duration ||\n              differenceInMinutes(new Date(data.event_end * 1000), start) ||\n              30;\n        this.timezone = data.timezone;\n        this.location = data.location || '';\n        this.recurring = data.recurring;\n        this.recurring_master_id = data.recurring_master_id;\n        this.meeting_link = data.meeting_link || '';\n        this.organiser = this.attendees.find(\n            (user) => user.email === this.host\n        );\n        this.master = data.master ? new CalendarEvent(data.master) : null;\n        if (data.recurring) {\n            this.recurrence = {\n                start:\n                    start.valueOf() ||\n                    new Date(\n                        (data.recurrence as any).range_start * 1000\n                    ).valueOf(),\n                end:\n                    data.recurrence.end ||\n                    new Date(\n                        (data.recurrence as any).range_end * 1000\n                    ).valueOf(),\n                interval: data.recurrence.interval,\n                pattern: data.recurrence.pattern,\n                days_of_week: data.recurrence.days_of_week,\n            };\n        } else {\n            this.recurrence = {} as any;\n        }\n        this.system = data.system;\n        if (this.system?.email) {\n            this.resources.push(new Space(this.system as any));\n        }\n        this.old_system = data.old_system || data.system;\n        this.attachments = data.attachments || [];\n        this.extension_data = data.extension_data || {};\n        this.extension_data.catering = (\n            data.catering ||\n            this.extension_data.catering ||\n            []\n        ).map((i) => new CateringOrder({ ...i, event: this }));\n        this.extension_data.needs_parking = !!data.needs_parking;\n        this.extension_data.remote =\n            data.remote || this.extension_data.remote || [];\n        this.extension_data.visitor_type =\n            data.visitor_type || this.extension_data.visitor_type || '';\n        this.can_access_lift =\n            data.can_access_lift ||\n            this.extension_data.can_access_lift ||\n            false;\n        this.resources = unique(this.resources, 'email');\n        this.status = eventStatus(this) || 'none';\n        /** Simplified extension properties */\n        this.has_visitors = !!this.attendees.find(\n            (user) => user.visit_expected || user.is_external\n        );\n        this.has_catering =\n            this.extension_data.catering &&\n            !!this.extension_data.catering.length;\n        this.catering = this.extension_data.catering || [];\n        this.remote = this.extension_data.remote || [];\n        this.needs_parking = !!this.extension_data.needs_parking;\n        this.setup = this.extension_data.setup || 0;\n        this.breakdown = this.extension_data.breakdown || 0;\n        this.visitor_type = this.extension_data.visitor_type || '';\n        this.type =\n            this.status === 'cancelled'\n                ? 'cancelled'\n                : this.has_visitors\n                ? 'external'\n                : 'internal';\n        this.attendee_emails = this.attendees.map((u) => u.email);\n        this.guests = this.attendees.filter((f) => !!f.visit_expected) as any;\n        this.notes = this.extension_data.notes || [];\n        this.space = this.resources[0] || null;\n    }\n\n    public get is_today(): boolean {\n        return isSameDay(new Date(this.date), new Date());\n    }\n\n    /** Cleaning status */\n    public get cleaning_status(): 'pending' | 'done' | '' {\n        return this.extension_data.cleaned ? 'done' : '';\n    }\n\n    /**\n     * Convert class data to simple JSON object\n     */\n    public toJSON(): HashMap {\n        const obj: HashMap = { ...this };\n        const end = Math.floor(\n            addMinutes(new Date(this.date), this.duration).valueOf() /\n                1000\n        );\n        obj.event_start = Math.floor(this.date / 1000);\n        obj.event_end = end;\n        const attendees = this.attendees;\n        if (this.recurring) {\n            obj.recurrence = {\n                ...this.recurrence,\n                range_start: obj.event_start,\n                range_end: Math.floor(\n                    new Date(this.recurrence.end).valueOf() / 1000\n                ),\n            };\n        }\n        obj.recurrence = obj.recurrence\n            ? Object.keys(obj.recurrence).length\n                ? obj.recurrence\n                : null\n            : null;\n        obj.attendees = unique(attendees, 'email');\n        if (!this.all_day) {\n            obj.extension_data.breakdown = 15;\n        }\n        obj.extension_data.catering = obj.extension_data.catering.map(\n            (i) => new CateringOrder({ ...i, event: null })\n        );\n        obj.system_id = this.system?.id;\n        delete obj.catering;\n        delete obj.date;\n        delete obj.duration;\n        return obj;\n    }\n\n    /** Status of the booking */\n    public get state():\n        | 'future'\n        | 'upcoming'\n        | 'done'\n        | 'started'\n        | 'in_progress' {\n        const now = new Date();\n        const date = new Date(this.date);\n        if (isBefore(now, add(date, { minutes: -15 }))) {\n            return 'future';\n        } else if (isBefore(now, date)) {\n            return 'upcoming';\n        } else if (isBefore(now, add(date, { minutes: 15 }))) {\n            return 'started';\n        } else if (isBefore(now, add(date, { minutes: this.duration }))) {\n            return 'in_progress';\n        }\n        return 'done';\n    }\n\n    public get event_start(): number {\n        return Math.floor(new Date(this.date).valueOf() / 1000);\n    }\n\n    public get event_end(): number {\n        return Math.floor(\n            addMinutes(new Date(this.date), this.duration).valueOf() / 1000\n        );\n    }\n\n    public get can_check_in(): boolean {\n        return isSameDay(new Date(), new Date(this.date));\n    }\n}\n","import { HashMap } from '@placeos/common';\nimport { format } from 'date-fns';\n\nexport function eventStatus(details: HashMap): 'confirmed' | 'tentative' | 'cancelled' {\n    if (details.resources?.length) {\n        if (details.resources.every((i) => i.response_status === 'accepted')) {\n            return 'confirmed';\n        } else if (\n            details.resources.some(\n                (i) => i.response_status === 'tentative' || i.response_status === 'needsAction'\n            )\n        ) {\n            return 'tentative';\n        }\n        return 'cancelled';\n    }\n    return 'confirmed';\n}\n\nexport function formatRecurrence(recurrence) {\n    let details = '';\n    if (recurrence) {\n        const { interval, pattern, start, end } = recurrence;\n        if (interval && interval > 1) {\n            details = details.concat(`Every ${interval}`);\n        }\n        switch (pattern) {\n            case 'daily':\n                if (interval && interval > 1) {\n                    details = details.concat(' days');\n                } else {\n                    details = details.concat('Daily');\n                }\n                break;\n            case 'weekly':\n                if (interval && interval > 1) {\n                    details = details.concat(' weeks');\n                } else {\n                    details = details.concat('Weekly');\n                }\n                break;\n            case 'monthly':\n                if (interval && interval > 1) {\n                    details = details.concat(' months');\n                } else {\n                    details = details.concat('Monthly');\n                }\n                break;\n        }\n        details = details.concat(`, until ${format(end, 'MMM do, yyyy')}`);\n    }\n    return '';\n}\n\n","import { FormGroup, FormControl, Validators, AbstractControl } from '@angular/forms';\nimport {\n    add,\n    isBefore,\n    isAfter,\n    formatDuration,\n    differenceInMinutes,\n    getTime,\n    isSameDay,\n    format,\n    startOfMinute,\n    setHours,\n    setMinutes,\n    addMinutes,\n} from 'date-fns';\nimport { timePeriodsIntersect, unique } from '@placeos/common';\n\nimport { CalendarEvent } from './event.class';\nimport { SpaceRuleOptions, SpaceRules, SpaceCheckOptions } from './event.interfaces';\n\nconst MINUTE = 1;\nconst HOUR = 60;\nconst DAY = 24 * HOUR;\nconst WEEK = 7 * DAY;\nconst MONTH = 30 * DAY;\n\nconst DURATION_MAP: { [duration: string]: number } = {\n    month: MONTH,\n    months: MONTH,\n    week: WEEK,\n    weeks: WEEK,\n    day: DAY,\n    days: DAY,\n    hour: HOUR,\n    hours: HOUR,\n    minute: MINUTE,\n    minutes: MINUTE,\n};\n\nlet BOOKING_DATE = add(setMinutes(setHours(new Date(), 6), 0), { days: -1 });\n\nexport function generateEventForm(event: CalendarEvent): FormGroup {\n    const form = new FormGroup({\n        id: new FormControl(event.id),\n        host: new FormControl(event.host || '', [Validators.required]),\n        organiser: new FormControl(event.organiser || {}, [\n            Validators.required,\n        ]),\n        creator: new FormControl(event.creator, [Validators.required]),\n        calendar: new FormControl(event.calendar),\n        attendees: new FormControl(event.attendees || []),\n        resources: new FormControl(event.resources || []),\n        title: new FormControl(event.title, [Validators.required]),\n        body: new FormControl(event.body),\n        private: new FormControl(event.private),\n        date: new FormControl(event.date, [Validators.required]),\n        duration: new FormControl(event.duration),\n        all_day: new FormControl(event.all_day),\n        recurring: new FormControl(event.recurring),\n        recurrence: new FormControl(event.recurrence),\n        recurring_master_id: new FormControl(event.recurring_master_id),\n        master: new FormControl(event.master),\n        attachments: new FormControl(event.attachments),\n        catering: new FormControl(event.extension_data.catering || []),\n        // has_catering: new FormControl(event.has_catering || false),\n        visitor_type: new FormControl(event.extension_data.visitor_type),\n        location: new FormControl(event.location),\n        needs_space: new FormControl(true),\n        needs_parking: new FormControl(event.needs_parking || false),\n        system: new FormControl(event.system),\n    });\n    form.controls.duration.setValidators([endInFuture(form)]);\n    form.controls.organiser.valueChanges.subscribe((o) => {\n        form.controls.host.setValue(o?.email);\n    });\n    if (event.id) {\n        form.controls.host.disable();\n        form.controls.organiser.disable();\n    }\n    if (event.state === 'started') {\n        form.controls.date.disable();\n    }\n    return form;\n}\n\nexport const endInFuture = (form: FormGroup) => (control: AbstractControl) => {\n    if (\n        form.controls.date &&\n        isAfter(\n            new Date(),\n            new Date(form.controls.date.value + control.value * 60 * 1000)\n        )\n    ) {\n        return { duration: true };\n    }\n    return null;\n};\n\n/** Array is not empty */\nexport function isNotEmpty(control: AbstractControl): { [key: string]: boolean } | null {\n    if (Array.isArray(control.value) && !control.value.length) {\n        return { isNotEmpty: true };\n    }\n    return null;\n}\n\n/** Check that date in unix ms is in the future */\nexport function isFuture(control: AbstractControl): { [key: string]: boolean } | null {\n    if (control.value !== undefined && isBefore(new Date(control.value), new Date())) {\n        return { isFuture: true };\n    }\n    return null;\n}\n\n/**\n * Set the initial time used for generating mock bookings\n * @param time New initial time as ms from UTC epoch\n */\nexport function setMockBookingStartDatetime(time: number) {\n    BOOKING_DATE = startOfMinute(new Date(time));\n}\n\n/**\n * Get booking rules for the given user and space\n * @param user User to determine applicable rules\n * @param space Space to get rules for\n * @param time Booking start time in ms since UTC epoch\n * @param rules List of booking rules for the building\n */\nexport function rulesForSpace(options: SpaceRuleOptions): SpaceRules {\n    if (!options) {\n        throw Error('Options are needed to check for rule matches');\n    }\n    const space_rules_for_user: SpaceRules = {\n        auto_approve: true,\n        hide: true,\n    };\n    /* istanbul ignore else */\n    if (options.space) {\n        for (const type of Object.keys(options.rules)) {\n            if (\n                options.rules.hasOwnProperty(type) &&\n                options.rules[type] instanceof Array &&\n                options.space.zones.find((zone) => zone === type)\n            ) {\n                for (const rule_block of options.rules[type]) {\n                    /* istanbul ignore else */\n                    if (\n                        checkRules({\n                            user: options.user,\n                            space: options.space,\n                            time: options.time,\n                            recurr_end: options.recurr_end,\n                            duration: options.duration,\n                            rules: rule_block.conditions,\n                        })\n                    ) {\n                        const ruleset = rule_block.rules;\n                        const conditions = rule_block.conditions;\n                        space_rules_for_user.hide = false;\n                        /* istanbul ignore else */\n                        if (conditions.max_length) {\n                            space_rules_for_user.max_length = stringToMinutes(\n                                conditions.max_length as string\n                            );\n                        }\n                        /* istanbul ignore else */\n                        if (conditions.min_length) {\n                            space_rules_for_user.min_length = stringToMinutes(\n                                conditions.min_length as string\n                            );\n                        }\n                        // NOTE: use max_length in conditions instead of book_length in rules\n                        // if (ruleset.book_length) {\n                        //     space_rules_for_user.max_length = stringToMinutes(ruleset.book_length as string);\n                        // }\n                        /* istanbul ignore else */\n                        if (ruleset.auto_approve !== undefined) {\n                            space_rules_for_user.auto_approve = ruleset.auto_approve;\n                        }\n                        break;\n                    }\n                }\n            }\n            /* istanbul ignore else */\n            if (!space_rules_for_user.hide) {\n                break;\n            }\n        }\n    }\n    return space_rules_for_user;\n}\n\n/**\n * Check if user matches the given ruleset\n * @param user User to determine applicable rules\n * @param space Space to get rules for\n * @param time Booking start time in ms since UTC epoch\n * @param rules List of booking rules for the building\n */\nfunction checkRules(options: SpaceCheckOptions): boolean {\n    /* istanbul ignore else */\n    if (options.rules) {\n        const time = new Date(options.time);\n        const recurr = options.recurr_end ? new Date(options.recurr_end) : new Date();\n        const count = Object.keys(options.rules).length;\n        let matches = 0;\n        for (const key of Object.keys(options.rules)) {\n            let counter = 0;\n            const condition: string[] =\n                options.rules[key] instanceof Array\n                    ? (options.rules[key] as [])\n                    : [options.rules[key] as string];\n            switch (key) {\n                // case 'groups':\n                //     /* istanbul ignore else */\n                //     if (options.user && options.user.groups) {\n                //         counter = 0;\n                //         condition.forEach((i) =>\n                //             options.user.groups.find((j) => j === i) ? counter++ : null\n                //         );\n                //         /* istanbul ignore else */\n                //         if (counter > 0) {\n                //             matches++;\n                //         }\n                //     }\n                //     break;\n                // case 'locations':\n                //     /* istanbul ignore else */\n                //     if (options.user && options.user.location) {\n                //         counter = 0;\n                //         condition.forEach((i) =>\n                //             (options.user.last_location.name || '').indexOf(i) >= 0\n                //                 ? counter++\n                //                 : null\n                //         );\n                //         /* istanbul ignore else */\n                //         if (counter >= options.rules[key].length) {\n                //             matches++;\n                //         }\n                //     }\n                //     break;\n                case 'is_before':\n                    /* istanbul ignore else */\n                    if (options.time) {\n                        const duration = stringToMinutes(condition[0]);\n                        const check = add(new Date(), { minutes: duration });\n                        let match = isBefore(time, check);\n                        /* istanbul ignore else */\n                        if (recurr) {\n                            match = match && isBefore(recurr, check);\n                        }\n                        matches += match ? 1 : 0;\n                    }\n                    break;\n                case 'is_after':\n                    /* istanbul ignore else */\n                    if (options.time) {\n                        const duration = stringToMinutes(condition[0]);\n                        const check = add(new Date(), { minutes: duration });\n                        if (isAfter(time, check)) {\n                            matches++;\n                        }\n                    }\n                    break;\n                case 'min_length':\n                    /* istanbul ignore else */\n                    if (\n                        options.duration &&\n                        durationGreaterThanOrEqual(options.duration, condition[0])\n                    ) {\n                        matches++;\n                    }\n                    break;\n                case 'max_length':\n                    /* istanbul ignore else */\n                    if (\n                        options.duration &&\n                        durationGreaterThanOrEqual(condition[0], options.duration)\n                    ) {\n                        matches++;\n                    }\n                    break;\n            }\n        }\n        return matches >= count;\n    }\n    return false;\n}\n\n/**\n * Whether the first input is greater than the last. Converts duration strings into minutes\n * @param duration_1 First input can be a number in minutes or a duration string e.g. `1 hour`\n * @param duration_2 Second input can be a number in minutes or a duration string e.g. `30 minutes`\n */\nexport function durationGreaterThanOrEqual(\n    duration_1: string | number,\n    duration_2: string | number\n) {\n    const first: number = typeof duration_1 === 'string' ? stringToMinutes(duration_1) : duration_1;\n    const second: number =\n        typeof duration_2 === 'string' ? stringToMinutes(duration_2) : duration_2;\n    return first >= second;\n}\n\n/**\n * Conver time string into minutes\n * @param str timestring e.g. `'1 day'`, `'15 minutes'`, `'2 weeks'`\n */\nexport function stringToMinutes(str: string): number {\n    const parts = str.split(' ');\n    return +parts[0] * DURATION_MAP[parts[1]];\n}\n\n/**\n * Get current status within bookings\n * @param bookings List of bookings\n * @param host Host of the new event\n * @param date Datetime of the new event\n */\nexport function statusFromBookings(\n    bookings: CalendarEvent[],\n    bookable: boolean,\n    requestable: boolean,\n    date: number = getTime(new Date())\n) {\n    const free_slots = getFreeBookingSlots(bookings);\n    const now = new Date(date);\n    const next_free_slot = free_slots.find((slot) => {\n        const start = new Date(slot.start);\n        const end = new Date(slot.end);\n        return isAfter(start, now) || timePeriodsIntersect(date, date, slot.start, slot.end);\n    });\n    const start = new Date(next_free_slot.start);\n    const end = new Date(next_free_slot.end);\n    const currently_free = timePeriodsIntersect(\n        date,\n        date,\n        next_free_slot.start,\n        next_free_slot.end\n    );\n    const time_until_next_block = formatDuration({\n        minutes: currently_free ? differenceInMinutes(end, now) : differenceInMinutes(start, now),\n    });\n    const free_tomorrow = !currently_free && !isSameDay(start, now);\n    const free_today = currently_free && !isSameDay(end, now);\n    return {\n        status: !bookable\n            ? 'Not Bookable'\n            : currently_free\n            ? requestable\n                ? 'Available by Request'\n                : 'Available'\n            : 'Meeting in Progress',\n        available_until: free_today\n            ? 'No meetings today'\n            : currently_free\n            ? `Free until ${format(end, 'h:mm B')}(${time_until_next_block})`\n            : free_tomorrow\n            ? 'Unavailable today'\n            : `Free at ${format(start, 'h:mm B')}(${time_until_next_block})`,\n    };\n}\nexport interface IBookingSlot {\n    start: number;\n    end: number;\n}\n\n/**\n * Generate a list of free time slots between the given bookings\n * @param list List of bookings to find slots between\n * @param min_size Minimum length of a free slot in minutes\n */\nexport function getFreeBookingSlots(list: CalendarEvent[], min_size: number = 30): IBookingSlot[] {\n    /* istanbul ignore else */\n    if (!list) {\n        return [\n            {\n                start: 0,\n                end: startOfMinute(new Date()).getTime() * 10,\n            },\n        ];\n    }\n    const slots: IBookingSlot[] = [];\n    let start = new Date(0);\n    list.sort((a, b) => a.date - b.date);\n    for (const booking of list) {\n        const bkn_start = new Date(booking.date);\n        const bkn_end = add(bkn_start, { minutes: booking.duration });\n        if (isAfter(bkn_start, start)) {\n            const diff = Math.abs(differenceInMinutes(bkn_start, start));\n            /* istanbul ignore else */\n            if (diff >= min_size) {\n                slots.push({ start: start.valueOf(), end: bkn_start.valueOf() });\n            }\n            start = bkn_end;\n        } else if (startOfMinute(start).getTime() === startOfMinute(bkn_start).getTime()) {\n            start = bkn_end;\n        }\n    }\n    slots.push({\n        start: start.getTime(),\n        end: startOfMinute(new Date()).getTime() * 10,\n    });\n    return slots;\n}\n\n/**\n * Get the next free time slot from the given bookings\n * @param list List of bookings to find the next slot\n * @param date Date to find next slot after in ms since UTC epoch\n * @param min_size Minimum length of the free slot in minutes\n */\nexport function getNextFreeBookingSlot(\n    list: CalendarEvent[],\n    date: number = new Date().valueOf(),\n    min_size: number = 30\n): IBookingSlot {\n    const slots = getFreeBookingSlots(list, min_size);\n    const time = add(startOfMinute(new Date(date)), { seconds: 1 });\n    for (const block of slots) {\n        const start = startOfMinute(new Date(block.start));\n        const end = startOfMinute(new Date(block.end));\n        if (isAfter(start, time)) {\n            return block;\n        } else if (isBefore(time, end)) {\n            const duration = differenceInMinutes(end, time);\n            /* istanbul ignore else */\n            if (duration >= min_size) {\n                return block;\n            }\n        }\n    }\n    return slots[slots.length - 1];\n}\n\nexport function replaceBookings(\n    list: CalendarEvent[],\n    new_bookings: CalendarEvent[],\n    filter_options: { space: string; from: number; to: number }\n) {\n    const from = filter_options.from;\n    const to = filter_options.to;\n    const filtered_list = list.filter((booking) => {\n        const start = new Date(booking.date);\n        const end = addMinutes(start, booking.duration);\n        return (\n            !booking.resources.find((space) => space.email === filter_options.space) ||\n            !timePeriodsIntersect(from, to, start.valueOf(), end.valueOf())\n        );\n    });\n    const updated_list = filtered_list.concat(new_bookings);\n    updated_list.sort((a, b) => a.date - b.date);\n    return unique(updated_list, 'id');\n}\n","import { FormGroup } from '@angular/forms';\nimport { formatDuration } from 'date-fns';\n\nimport { BookingRule, SpaceCheckOptions, SpaceRules, SpaceRuleOptions } from './booking.interfaces';\n\nimport { CateringItem } from '../../../catering/src/lib/catering-item.class';\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { User } from '../../../users/src/lib/user.class';\nimport { generateMockUser } from '../../../users/src/lib/user.utilities';\nimport { CalendarEvent, getFreeBookingSlots } from '@placeos/events';\nimport { Space } from '../../../spaces/src/lib/space.class';\n\nimport * as dayjs from 'dayjs';\nimport * as customParseFormat from 'dayjs/plugin/customParseFormat';\ndayjs.extend(customParseFormat);\n\nconst MINUTE = 1;\nconst HOUR = 60;\nconst DAY = 24 * HOUR;\nconst WEEK = 7 * DAY;\nconst MONTH = 30 * DAY;\n\nconst DURATION_MAP: { [duration: string]: number } = {\n    month: MONTH,\n    months: MONTH,\n    week: WEEK,\n    weeks: WEEK,\n    day: DAY,\n    days: DAY,\n    hour: HOUR,\n    hours: HOUR,\n    minute: MINUTE,\n    minutes: MINUTE,\n};\n\nlet BOOKING_COUNT = 0;\nlet BOOKING_DATE = dayjs().hour(6).minute(0).subtract(1, 'd').startOf('m');\n\n/**\n * Set the initial time used for generating mock bookings\n * @param time New initial time as ms from UTC epoch\n */\nexport function setMockBookingStartDatetime(time: number) {\n    BOOKING_DATE = dayjs(time).startOf('m');\n}\n\nconst randomQuarterHours = () => predictableRandomInt(5, 2) * 15;\n\n/**\n * Create mock raw API data for a booking\n * @param override Overrides the properties of the generated booking with it's own\n */\nexport function generateMockBooking(override: HashMap = {}, resetDate = false) {\n    const id = `booking-${BOOKING_COUNT++}`;\n    if (!!resetDate) {\n        BOOKING_DATE = dayjs().hour(6).minute(0).startOf('m');\n    }\n    BOOKING_DATE = BOOKING_DATE.add(randomQuarterHours(), 'm');\n    const start = BOOKING_DATE.valueOf();\n    const duration = randomQuarterHours();\n    const cateringItem = new CateringItem({\n        id: 'Cappucino',\n        quantity: 5,\n    });\n    return {\n        id,\n        icaluid: predictableRandomInt(99_999_999),\n        title: `A Meeting ${predictableRandomInt(99)}`,\n        attendees: Array(predictableRandomInt(5) + 2)\n            .fill(0)\n            .map((i) => generateMockUser()),\n        organiser: generateMockUser(),\n        start_epoch: dayjs(start).unix(),\n        end_epoch: dayjs(start).add(duration, 'm').unix(),\n        date: start,\n        duration,\n        description: `A Description`,\n        notes: [{ type: 'other', message: `Some notes` }],\n        location: `Your City`,\n        catering: predictableRandomInt(34567) % 3 === 0,\n        extension_data: {\n            catering_order: [cateringItem],\n            catering_notes:\n                'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Dui faucibus in ornare quam viverra orci. Metus dictum at tempor commodo ullamcorper a lacus.',\n        },\n        link: predictableRandomInt(10) > 5 ? 'https://browser.zoom.fake/j/12' : '',\n        room_ids: [],\n        ...override,\n    };\n}\n\nconst STORED_BOOKING_KEY = 'STAFF.booking_form';\nexport function storeBookingFormData(form: FormGroup) {\n    if (localStorage) {\n        const data = form ? form.value : {};\n        if (form && form.controls && form.controls.extension_data) {\n            data.extension_data = form.controls.extension_data.value;\n        }\n        localStorage.setItem(STORED_BOOKING_KEY, JSON.stringify(data));\n    }\n}\n\nexport function retrieveBookingFormData(): any {\n    let formData = {};\n    if (localStorage) {\n        const form_string = localStorage.getItem(STORED_BOOKING_KEY);\n        if (form_string) {\n            try {\n                formData = JSON.parse(form_string);\n            } catch (e) {}\n        }\n    }\n    return formData;\n}\n\nexport function clearBookingFormData() {\n    if (localStorage && !!retrieveBookingFormData()) {\n        localStorage.removeItem(STORED_BOOKING_KEY);\n    }\n}\n\nconst STORED_DESK_BOOKING_KEY = 'STAFF.desk_form';\nexport function storeDeskBookingFormData(form: FormGroup) {\n    if (localStorage) {\n        const data = form ? form.value : {};\n        if (form && form.controls && form.controls.extension_data) {\n            data.extension_data = form.controls.extension_data.value;\n        }\n        localStorage.setItem(STORED_DESK_BOOKING_KEY, JSON.stringify(data));\n    }\n}\n\nexport function retrieveDeskBookingFormData(): any {\n    let formData = {};\n    if (localStorage) {\n        const form_string = localStorage.getItem(STORED_DESK_BOOKING_KEY);\n        if (form_string) {\n            try {\n                formData = JSON.parse(form_string);\n            } catch (e) {}\n        }\n    }\n    return formData;\n}\n\nexport function clearDeskBookingFormData() {\n    if (localStorage && !!retrieveDeskBookingFormData()) {\n        localStorage.removeItem(STORED_DESK_BOOKING_KEY);\n    }\n}\n\n/** Filter spaces based on booking rules */\nexport function filterSpacesRules(\n    list: Space[] = [],\n    building_settings: HashMap<HashMap>,\n    host: User,\n    options: {\n        date: number;\n        duration: number;\n        all_day?: boolean;\n        visitor_type?: string;\n    }\n): Space[] {\n    return list.filter((space) => {\n        const booking_rules = building_settings[space.level.parent_id].details?.booking_rules;\n        const { date, all_day, duration, visitor_type } = options;\n        const rules = rulesForSpace({\n            space,\n            time: date,\n            duration: all_day ? 24 * 60 : duration,\n            visitor_type,\n            user: host,\n            rules: booking_rules,\n        });\n        if (visitor_type) {\n            return !rules.hide && rules.room_type === visitor_type;\n        } else {\n            return !rules.hide;\n        }\n    });\n}\n\n/**\n * Get booking rules for the given user and space\n * @param user User to determine applicable rules\n * @param space Space to get rules for\n * @param time Booking start time in ms since UTC epoch\n * @param rules List of booking rules for the building\n */\nexport function rulesForSpace(options: SpaceRuleOptions): SpaceRules {\n    if (!options) {\n        throw Error('Options are needed to check for rule matches');\n    }\n    const space_rules_for_user: SpaceRules = {\n        auto_approve: true,\n        hide: false,\n    };\n    if (options.space) {\n        for (const type of Object.keys(options.rules || {})) {\n            if (\n                options.rules.hasOwnProperty(type) &&\n                options.rules[type] instanceof Array &&\n                (options.space.zones || []).find((i) => i === type)\n            ) {\n                space_rules_for_user.hide = true;\n                for (const rule_block of options.rules[type]) {\n                    if (\n                        checkRules({\n                            user: options.user,\n                            space: options.space,\n                            time: options.time,\n                            visitor_type: options.visitor_type,\n                            duration: options.duration,\n                            rules: rule_block.conditions,\n                        })\n                    ) {\n                        const ruleset = rule_block.rules;\n                        const conditions = rule_block.conditions;\n                        space_rules_for_user.hide = false;\n                        if (conditions.max_length) {\n                            space_rules_for_user.max_length = stringToMinutes(\n                                conditions.max_length as string\n                            );\n                        }\n                        if (conditions.min_length) {\n                            space_rules_for_user.min_length = stringToMinutes(\n                                conditions.min_length as string\n                            );\n                        }\n                        // NOTE: use max_length in conditions instead of book_length in rules\n                        // if (ruleset.book_length) {\n                        //     space_rules_for_user.max_length = stringToMinutes(ruleset.book_length as string);\n                        // }\n                        if (ruleset.auto_approve !== undefined) {\n                            space_rules_for_user.auto_approve = ruleset.auto_approve;\n                        }\n                        if (ruleset.room_type !== undefined) {\n                            space_rules_for_user.room_type = ruleset.room_type;\n                        }\n                        break;\n                    }\n                }\n                if (!space_rules_for_user.hide) {\n                    break;\n                }\n            }\n        }\n    }\n    return space_rules_for_user;\n}\n\n/**\n * Check if user matches the given ruleset\n * @param user User to determine applicable rules\n * @param space Space to get rules for\n * @param time Booking start time in ms since UTC epoch\n * @param rules List of booking rules for the building\n */\nfunction checkRules(options: SpaceCheckOptions): boolean {\n    if (options.rules) {\n        const time = dayjs(options.time);\n        const count = Object.keys(options.rules).length;\n        let matches = 0;\n        for (const key of Object.keys(options.rules)) {\n            let counter = 0;\n            const condition: string[] =\n                options.rules[key] instanceof Array\n                    ? (options.rules[key] as [])\n                    : [options.rules[key] as string];\n            switch (key) {\n                case 'group':\n                case 'groups':\n                    if (options.user && options.user.groups) {\n                        counter = 0;\n                        condition.forEach((i) =>\n                            options.user.groups.find((j) => j === i) ? counter++ : null\n                        );\n                        if (counter > 0) {\n                            matches++;\n                        }\n                    }\n                    break;\n                case 'location':\n                case 'locations':\n                    // if (options.user && options.user.location) {\n                    //     counter = 0;\n                    //     condition.forEach(i =>\n                    //         (options.user.last_location.name || '').indexOf(i) >= 0\n                    //             ? counter++\n                    //             : null\n                    //     );\n                    //     if (counter >= options.rules[key].length) {\n                    //         matches++;\n                    //     }\n                    // }\n                    break;\n                case 'is_before':\n                    if (options.time) {\n                        const duration = stringToMinutes(condition[0]);\n                        const check = dayjs().add(duration, 'm');\n                        let match = time.isBefore(check, 'm');\n                        matches += match ? 1 : 0;\n                    }\n                    break;\n                case 'is_after':\n                    if (options.time) {\n                        const [amount, unit] = condition[0].split(' ');\n                        const check = dayjs().add(+amount, unit as dayjs.OpUnitType);\n                        time.isAfter(check, unit as dayjs.OpUnitType) ? matches++ : '';\n                    }\n                    break;\n                case 'from_time':\n                    const after_time = dayjs(condition[0], 'HH:mm');\n                    if (dayjs().isAfter(after_time, 'm')) {\n                        matches++;\n                    }\n                    break;\n                case 'min_length':\n                    if (options.duration) {\n                        durationGreaterThanOrEqual(options.duration, condition[0]) ? matches++ : '';\n                    }\n                    break;\n                case 'max_length':\n                    if (options.duration) {\n                        durationGreaterThanOrEqual(condition[0], options.duration) ? matches++ : '';\n                    }\n                    break;\n                case 'visitor_types':\n                    if (options.visitor_type) {\n                        counter = 0;\n                        condition.forEach((i) => (i === options.visitor_type ? counter++ : null));\n                        if (counter > 0) {\n                            matches++;\n                        }\n                    }\n                    break;\n            }\n        }\n        return matches >= count;\n    }\n    return false;\n}\n\n/**\n * Get minimum duration from ruleset in minutes\n * Default to 5min\n */\nexport function getMinLength(rule_list: any): number {\n    return Object.values(rule_list).reduce((min, block: BookingRule[]) => {\n        const min_block = block.reduce((min_length, el) => {\n            if (el.conditions.min_length && stringToMinutes(el.conditions.min_length) > min) {\n                return stringToMinutes(el.conditions.min_length);\n            } else {\n                return min_length;\n            }\n        }, 5);\n        if (min_block > min) {\n            return min_block;\n        } else {\n            return min;\n        }\n    }, 5) as number;\n}\n\n/**\n * Whether the first input is greater than the last. Converts duration strings into minutes\n * @param duration_1 First input can be a number in minutes or a duration string e.g. `1 hour`\n * @param duration_2 Second input can be a number in minutes or a duration string e.g. `30 minutes`\n */\nexport function durationGreaterThanOrEqual(\n    duration_1: string | number,\n    duration_2: string | number\n) {\n    const first: number = typeof duration_1 === 'string' ? stringToMinutes(duration_1) : duration_1;\n    const second: number =\n        typeof duration_2 === 'string' ? stringToMinutes(duration_2) : duration_2;\n    return first >= second;\n}\n\n/**\n * Conver time string into minutes\n * @param str timestring e.g. `'1 day'`, `'15 minutes'`, `'2 weeks'`\n */\nexport function stringToMinutes(str: string): number {\n    const parts = str.split(' ');\n    return +parts[0] * DURATION_MAP[parts[1]];\n}\n\n/**\n * Get current status within bookings\n * @param bookings List of bookings\n * @param host Host of the new event\n * @param date Datetime of the new event\n */\nexport function statusFromBookings(\n    bookings: CalendarEvent[],\n    bookable: boolean,\n    requestable: boolean,\n    date: number = dayjs().valueOf()\n) {\n    const free_slots = getFreeBookingSlots(bookings);\n    const now = dayjs(date);\n    const next_free_slot = free_slots.find((slot) => {\n        const start = dayjs(slot.start);\n        const end = dayjs(slot.end);\n        return start.isAfter(now) || (now.isAfter(start, 's') && now.isBefore(end, 'm'));\n    });\n    const start = dayjs(next_free_slot.start);\n    const end = dayjs(next_free_slot.end);\n    const currently_free = now.isAfter(start, 's') && now.isBefore(end, 'm');\n    const time_until_next_block = formatDuration({\n        minutes: currently_free ? end.diff(now, 'm') : start.diff(now, 'm'),\n    });\n    const free_tomorrow = !currently_free && !start.isSame(now, 'd');\n    const free_today = currently_free && !end.isSame(now, 'd');\n    return {\n        status: !bookable\n            ? 'Not Bookable'\n            : currently_free\n            ? requestable\n                ? 'Available by Request'\n                : 'Available'\n            : 'Meeting in Progress',\n        available_until: free_today\n            ? 'No meetings today'\n            : currently_free\n            ? `Free until ${end.format('h:mma')}(${time_until_next_block})`\n            : free_tomorrow\n            ? 'Unavailable today'\n            : `Free at ${start.format('h:mma')}(${time_until_next_block})`,\n    };\n}\n","\nimport { differenceInMinutes } from 'date-fns';\n\nimport { BaseDataClass } from '@placeos/common';\nimport { Space } from '../../../spaces/src/lib/space.class';\n\nimport { CalendarAvailability } from './calendar.interfaces';\n\nexport class Calendar extends BaseDataClass {\n    /** ID of the calendar */\n    public readonly id: string;\n    /** Name of the calendar */\n    public readonly name: string;\n    /** System associated with the calendar */\n    public readonly resource: Space;\n    /** Primary calendar of the user */\n    public readonly primary: boolean;\n    /** Summary */\n    public readonly summary: string;\n    /** Can edit */\n    public readonly can_edit: boolean;\n    /** Availability */\n    public readonly availability: CalendarAvailability[];\n\n    constructor(data: Partial<Calendar> = {}) {\n        super(data);\n        this.primary = data.primary;\n        this.summary = data.summary;\n        this.can_edit = data.can_edit;\n        this.resource = new Space(data.resource || (data as any).system);\n        this.availability = (data.availability || []).map((i: any) => {\n            return {\n                date: new Date(i.starts_at.dateTime).valueOf(),\n                duration: differenceInMinutes(\n                    new Date(i.ends_at.dateTime),\n                    new Date(i.starts_at.dateTime)\n                ),\n                status: i.status,\n            };\n        });\n    }\n}\n","import { get } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from '@placeos/common';\n\nimport { Calendar } from './calendar.class';\nimport { Space } from '../../../spaces/src/lib/space.class';\nimport { OrganisationService } from '@placeos/organisation';\nimport { CalendarAvailabilityQueryParams } from './calendar.interfaces';\n\nconst CALENDAR_ENDPOINT = '/api/staff/v1/calendars';\n\n/** List calendars associated with the logged in user */\nexport function queryCalendars(): Observable<Calendar[]> {\n    return get(CALENDAR_ENDPOINT).pipe(\n        map((i) => i.map((c) => new Calendar(i as any)))\n    );\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function queryCalendarAvailability(\n    q: CalendarAvailabilityQueryParams\n): Observable<Calendar[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/availability${query ? '?' + query : ''}`\n    ).pipe(map((i) => i.map((c) => new Calendar(c as any))));\n}\n\nconst calendarsToSpaces = (org?) =>\n    map((list: Calendar[]) =>\n        list\n            .filter((cal) => !!cal.resource)\n            .map(\n                (cal) =>\n                    new Space({\n                        ...cal.resource,\n                        level: org?.levelWithID(cal.resource.zones),\n                    })\n            )\n            .filter((space) => space.bookable)\n    );\n\n/** List available spaces based on the given query */\nexport function querySpaceAvailability(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    return queryCalendarAvailability(q).pipe(calendarsToSpaces(org));\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function querySpaceFreeBusy(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/free_busy${query ? '?' + query : ''}`\n    ).pipe(map((i) => i.map((c) => new Calendar(c as any))), calendarsToSpaces(org));\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport { startOfDay } from 'date-fns';\n\nimport { Calendar } from './calendar.class';\n\nimport { BaseClass, notifyError } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { CalendarEvent } from '../../../events/src/lib/event.class';\nimport { CalendarAvailabilityQueryParams } from './calendar.interfaces';\nimport {\n    queryCalendarAvailability,\n    queryCalendars,\n    querySpaceFreeBusy,\n} from './calendar.fn';\n\nimport * as dayjs from 'dayjs';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class CalendarService extends BaseClass {\n    private readonly _calendars = new BehaviorSubject<Calendar[]>([]);\n\n    /** Observable for the list of calendars */\n    public readonly calendar_list = this._calendars.asObservable();\n\n    public readonly query = () => queryCalendars();\n    public readonly freeBusy = (q: CalendarAvailabilityQueryParams) =>\n        querySpaceFreeBusy(q, this._org);\n    public readonly availability = (q: CalendarAvailabilityQueryParams) =>\n        queryCalendarAvailability(q);\n\n    constructor(private _org: OrganisationService) {\n        super();\n        this._org.initialised\n            .pipe(first((_) => _))\n            .subscribe(() => this.init());\n    }\n\n    public async init() {\n        await this.load().catch((err) => {\n            notifyError('Error loading calendars data');\n        });\n        this._initialised.next(true);\n    }\n\n    public get calendars(): Calendar[] {\n        return this._calendars.getValue();\n    }\n\n    /** Get Free busy for the selected day\n     * @param calendars User calendar\n     * @param date Selected day\n     */\n    public getFreeBusyDate(date: number, calendars: string) {\n        return this.freeBusy({\n            period_start: Math.floor(startOfDay(date).valueOf() / 1000),\n            period_end: Math.floor(startOfDay(date).valueOf() / 1000),\n            calendars,\n        });\n    }\n\n    /** Check rooms availability */\n    public async checkSpacesAvailability(\n        system_ids: string[],\n        period_start: number,\n        period_end: number,\n        old_booking?: CalendarEvent\n    ) {\n        const result = await this.availability({\n            period_start,\n            period_end,\n            system_ids: system_ids.join(','),\n        }).toPromise();\n        const start = dayjs(old_booking?.date).valueOf();\n        const end = dayjs(start).add(old_booking?.duration, 'm').valueOf();\n        const available = result.every((i) => {\n            const availability = i.availability;\n            if (old_booking && i.id === old_booking.system?.email) {\n                const index = availability.findIndex((block) => {\n                    return (\n                        block.date >= start &&\n                        dayjs(block.date).add(block.duration, 'm').valueOf() <=\n                            end\n                    );\n                });\n                if (index !== -1) {\n                    availability.splice(index, 1);\n                }\n            }\n            return !availability.length;\n        });\n        return available ? true : false;\n    }\n\n    public async load(): Promise<void> {\n        this._calendars.next(await queryCalendars().toPromise());\n    }\n}\n","<header>\n    <app-icon [icon]=\"{ type: 'icon', class: 'material-icons', content: 'place' }\"></app-icon>\n    <div class=\"title\">Select space{{ multiple ? 's' : '' }}</div>\n    <div class=\"flex-1 w-0\"></div>\n    <button mat-icon-button mat-dialog-close>\n        <app-icon>close</app-icon>\n    </button>\n</header>\n<mat-dialog-content>\n    <div class=\"heading\">\n        <mat-form-field appearance=\"outline\" *ngIf=\"buildings && buildings.length > 1\">\n            <mat-select\n                name=\"booking-type\"\n                [(value)]=\"building\"\n                (selectionChange)=\"loadAvailableSpaces()\"\n                placeholder=\"Select building\"\n            >\n                <mat-option *ngFor=\"let bld of buildings\" [value]=\"bld\">\n                    {{ bld.display_name || bld.name }}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n        <mat-form-field appearance=\"outline\" *ngIf=\"space_types && space_types.length > 1\">\n            <mat-select\n                name=\"booking-type\"\n                [(ngModel)]=\"type\"\n                (ngModelChange)=\"loadAvailableSpaces()\"\n                placeholder=\"Any space type\"\n            >\n                <mat-option *ngFor=\"let type of space_types\" [value]=\"type.id\">\n                    {{ type.name }}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n    </div>\n    <div class=\"body\" style=\"width: 32rem\">\n        <ng-container *ngIf=\"!loading; else load_state\">\n            <ng-container *ngIf=\"filtered_spaces?.length; else empty_state\">\n                <ng-container *ngFor=\"let space of filtered_spaces\">\n                    <a-space-select-item\n                        *ngIf=\"!space_map[space.id]\"\n                        [space]=\"space\"\n                        [multiple]=\"multiple\"\n                        type=\"available\"\n                        (click)=\"spaceSelected(space)\"\n                    ></a-space-select-item>\n                </ng-container>\n            </ng-container>\n        </ng-container>\n        <div class=\"space-list\" *ngIf=\"multiple\" [class.show]=\"show_selected\">\n            <ng-container *ngIf=\"spaces && spaces.length; else empty_state\">\n                <a-space-select-item\n                    *ngFor=\"let space of spaces\"\n                    [space]=\"space\"\n                    [multiple]=\"multiple\"\n                    type=\"selected\"\n                ></a-space-select-item>\n            </ng-container>\n        </div>\n    </div>\n</mat-dialog-content>\n<mat-dialog-actions *ngIf=\"multiple\">\n    <footer>\n        <button mat-button color=\"primary\" (click)=\"save()\">\n            Save selected spaces({{ spaces.length || '0' }})\n        </button>\n    </footer>\n</mat-dialog-actions>\n<ng-template #empty_state>\n    <div class=\"info-block\">\n        <div class=\"icon\">\n            <app-icon [icon]=\"{ class: 'material-icons', content: 'close' }\"></app-icon>\n        </div>\n        <div class=\"text\">No spaces</div>\n    </div>\n</ng-template>\n<ng-template #load_state>\n    <div class=\"info-block\">\n        <div class=\"icon\">\n            <mat-spinner diameter=\"48\"></mat-spinner>\n        </div>\n        <div class=\"text\">Finding available spaces...</div>\n    </div>\n</ng-template>\n","import { Component, OnInit, Inject, Output, EventEmitter } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { BaseClass, currentUser, DialogEvent, HashMap, Identity, notifyError, SettingsService } from '@placeos/common'\nimport { Building, OrganisationService } from '@placeos/organisation';\nimport { CalendarService } from '../../../../calendar/src/lib/calendar.service';\nimport { filterSpacesRules } from '../../../../bookings/src/lib/booking.utilities';\nimport { Space } from '../space.class';\n\nimport * as dayjs from 'dayjs';\n\nexport interface SpaceSelectModalData {\n    /** List of currently selected spaces */\n    readonly spaces: Space[];\n    /** Selected date to check space availability */\n    readonly date: number;\n    /** Duration of the availability that is desired */\n    readonly duration: number;\n    all_day?: boolean;\n    visitor_type?: string;\n}\n\n@Component({\n    selector: 'a-space-select-modal',\n    templateUrl: './space-select-modal.component.html',\n    styleUrls: ['./space-select-modal.component.scss'],\n})\nexport class SpaceSelectModalComponent extends BaseClass implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** List of selected spaces */\n    public spaces: Space[] = [];\n    /** List of available spaces */\n    public available_spaces: Space[] = [];\n    /** List of filtered spaces */\n    public filtered_spaces: Space[] = [];\n    /** Building to filter available spaces */\n    public building: Building;\n    /** Whether to show selected spaces */\n    public show_selected: boolean;\n    /** List of available space types */\n    public space_types: Identity[] = [];\n    /** ID of the space type to filter available spaces on */\n    public type: string;\n    /** Whether the available spaces are being loaded */\n    public loading: boolean;\n\n    public get buildings(): Building[] {\n        return this._org.buildings;\n    }\n\n    /** Whether multiple spaces can be selected */\n    public get multiple(): boolean {\n        return !!this._settings.get('app.booking.multiple_spaces');\n    }\n\n    /** Mapping of spaces to whether they are selected */\n    public get space_map(): HashMap<boolean> {\n        const spaces = {};\n        this.spaces.forEach((space) => (spaces[space.id] = true));\n        return spaces;\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _calendar: CalendarService,\n        private _settings: SettingsService,\n        @Inject(MAT_DIALOG_DATA) private _data: SpaceSelectModalData\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.building = this._org.building || this.buildings[0];\n        this.spaces = this._data.spaces && this._data.spaces.length ? [...this._data.spaces] : [];\n        this.loadAvailableSpaces();\n    }\n\n    public async loadAvailableSpaces() {\n        this.loading = true;\n        const date = dayjs(this._data.date);\n        this.available_spaces = await this._calendar\n            .freeBusy({\n                zone_ids: this.building.id,\n                period_start: date.unix(),\n                period_end: date.add(this._data.duration, 'm').unix(),\n            })\n            .toPromise()\n            .catch((err) => {\n                notifyError(`Error finding available spaces: ${err.message || err}`);\n                return [];\n            });\n        this.filtered_spaces = this.filterSpaces(this.available_spaces);\n        this.loading = false;\n    }\n\n    /** Check booking rules and filter spaces */\n    public filterSpaces(list: Space[]): Space[] {\n        const settings = this._org.building_settings;\n        const res = filterSpacesRules(list, settings, currentUser(), { ...this._data });\n        return res;\n    }\n\n    public spaceSelected(space: Space) {\n        if (this.multiple) {\n            if (!this.space_map[space.id]) {\n                this.spaces.push(space);\n            }\n        } else {\n            this.spaces = [space];\n            this.save();\n        }\n    }\n\n    public save() {\n        this.event.emit({ reason: 'done', metadata: this.spaces });\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ComponentsModule } from '@placeos/components';\n\nimport { SpaceSelectItemComponent } from './space-select-modal/item/item.component';\nimport { SpaceSelectModalComponent } from './space-select-modal/space-select-modal.component';\n\nconst COMPONENTS: Type<any>[] = [\n    SpaceSelectModalComponent,\n    SpaceSelectItemComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        MatDialogModule,\n        ComponentsModule\n    ],\n    providers: [],\n    exports: [...COMPONENTS]\n})\nexport class SharedSpacesModule {}\n","import { HashMap } from '@placeos/common';\nimport { USER_DOMAIN } from '../../../users/src/lib/user.utilities';\n\nlet SPACE_COUNT: number = 0;\n\nexport function generateMockSpace(overrides: HashMap = {}): HashMap {\n    const id = `space-${SPACE_COUNT++}`;\n    const name = `Test Space ${SPACE_COUNT}`;\n    const linked = Math.floor(Math.random() * 99999) % 2 === 0 && SPACE_COUNT > 1;\n    const space = {\n        id,\n        name,\n        long_name: `${name} with an long name`,\n        map_id: `${SPACE_COUNT}`,\n        capacity: Math.floor(Math.random() * 20 + 1) * 2,\n        email: `${name.toLowerCase().split(' ').join('.')}@${USER_DOMAIN}`,\n        type: '',\n        searchable: Math.floor(Math.random() * 99999) % 2 === 0,\n        controlable: Math.floor(Math.random() * 99999) % 2 === 0,\n        bookable: Math.floor(Math.random() * 99999) % 2 === 0,\n        cost_hour: Math.floor(Math.random() * 300) * 100,\n        setup: Math.floor(Math.random() * 6) * 5,\n        breakdown: Math.floor(Math.random() * 6) * 5,\n        zones: ['zone_lvl-0'],\n        support_url: `/control/#/${id}`,\n        bookings: [], //Array(10).fill(0).map(i => generateMockBooking()),\n        linked_rooms: linked ? [`space-${Math.floor(Math.random() * (SPACE_COUNT - 1))}`] : [],\n        image: '',\n        ...overrides\n    };\n    if (space['configurations'] && space['configurations'].length > 0) {\n        space['configurations'].forEach(config =>\n            config.capacity = Math.floor(Math.random() * space.capacity) + 1\n        );\n        space['configurations'][0].capacity = space.capacity;\n    }\n    return space;\n}\n","import { Injectable } from '@angular/core';\nimport { querySystems } from '@placeos/ts-client';\nimport { first, map } from 'rxjs/operators';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { Space } from './space.class';\nimport { OrganisationService } from '@placeos/organisation';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SpacesService {\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    /** Subject to store list of spaces */\n    private _list = new BehaviorSubject<Space[]>([]);\n    /** Default predicate for filter method */\n    protected _compare = (space: Space) => space.zones.includes(this._org.building.id);\n    /** Observable for list of spaces */\n    public readonly list = this._list.asObservable();\n\n    /** List of available spaces */\n    public get space_list(): Space[] {\n        return this._list.getValue();\n    }\n\n    constructor(private _org: OrganisationService) {\n        this._org.initialised.pipe(first((_) => _)).subscribe(() => this.loadSpaces());\n    }\n\n    /**\n     * Get a filtered list of the available spaces\n     * @param predicate Predicate for filtering spaces\n     */\n    public filter(predicate: (_: Space) => boolean = this._compare) {\n        return this._list.getValue().filter((_) => predicate(_));\n    }\n\n    /**\n     * Find space with given id/email\n     * @param id ID/Email address associated with the space\n     */\n    public find(id: string) {\n        return this._list.getValue().find((space) => space.id === id || space.email === id);\n    }\n\n    private async loadSpaces(): Promise<void> {\n        const systems = await querySystems({\n            zone_id: this._org.organisation.id,\n            limit: 5000,\n        })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        const space_list = systems.map(\n            (sys) => new Space({ ...(sys as any), level: this._org.levelWithID([...sys.zones]) })\n        );\n        // Remove spaces without a map ID\n        const valid_spaces = space_list.filter((space) => space.map_id);\n        this._list.next(valid_spaces);\n        this._initialised.next(true);\n    }\n}\n","import { predictableRandomInt } from '@placeos/common';\nimport { generateMockSpace } from '@placeos/spaces';\n\nconst randomSpaceFeatures = () => {\n    const f = ['Whiteboard', 'VidConf', 'Projector', 'Views'];\n    const numFeatures = predictableRandomInt(f.length + 1);\n    const res = [];\n    for (let i = 0; i < numFeatures; i++) {\n        res.push(f[predictableRandomInt(f.length)]);\n    }\n    return res.filter((el, i, r) => r.indexOf(el) === i).join(' ');\n};\n\nexport const MOCK_SPACES = [\n    { name: 'Meeting Room 1.01', map_id: 'area-1.01-status', zones: ['bld-01_lvl-01'] },\n    { name: 'Meeting Room 1.02', map_id: 'area-1.02-status', zones: ['bld-01_lvl-01'] },\n    { name: 'Meeting Room 1.03', map_id: 'area-1.03-status', zones: ['bld-01_lvl-01'] },\n    { name: 'Meeting Room 1.04', map_id: 'area-1.04-status', zones: ['bld-01_lvl-01'] },\n    { name: 'Meeting Room 1.05', map_id: 'area-1.05-status', zones: ['bld-01_lvl-01'], bookable: false },\n    { name: 'Meeting Room 1.06', map_id: 'area-1.06-status', zones: ['bld-01_lvl-01'] },\n    { name: 'Meeting Room 1.07', map_id: 'area-1.07-status', zones: ['bld-01_lvl-01'] },\n    { name: 'Meeting Room 1.08', map_id: 'area-1.08-status', zones: ['bld-01_lvl-01'] },\n    { name: 'Meeting Room 1.09', map_id: 'area-1.01-status', zones: ['bld-01_lvl-01'] },\n    { name: 'Meeting Room 1.10', map_id: 'area-1.10-status', zones: ['bld-01_lvl-01'] },\n].map(d => generateMockSpace({ ...d, features: randomSpaceFeatures() }));\n","import { predictableRandomInt, unique } from '@placeos/common';\n\nimport { MOCK_SPACES } from './spaces.data';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\n\nimport * as dayjs from 'dayjs';\n\nlet EVENT_TIME = dayjs().startOf('d').hour(7);\n\nconst nextEventTime = (save = false): number => {\n    const next = EVENT_TIME.add((predictableRandomInt(8) + 1) * 15, 'm');\n    if (save) {\n        EVENT_TIME = next;\n    }\n    return next.unix();\n};\n\nconst event_status = ['tentative', 'confirmed', 'cancelled'];\nconst randomStatus = (): string => {\n    const rnd = predictableRandomInt(10);\n    return rnd < 2 ? event_status[2] : rnd < 5 ? event_status[0] : event_status[1];\n};\n\nexport const MOCK_EVENTS = new Array(200).fill(0).map((_, index) => {\n    let attendees: any[] = MOCK_STAFF.concat(MOCK_GUESTS).filter((_) => predictableRandomInt(9999) % 3 === 0);\n        attendees.unshift(MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)]);\n    attendees = unique(attendees, 'email');\n    const space = MOCK_SPACES[predictableRandomInt(MOCK_SPACES.length)];\n    attendees = attendees.concat({\n        ...space,\n        resource: true,\n    });\n    const has_active_user = predictableRandomInt(9999) % 2 === 0;\n    if (has_active_user) {\n        attendees.push(ACTIVE_USER);\n    }\n    return {\n        id: `cal-event-${index}`,\n        status: randomStatus(),\n        host: has_active_user ? ACTIVE_USER.email : attendees[0].email,\n        calendar: 'calendar_id',\n        creator: 'optional@fake.com',\n        attendees: unique(attendees, 'email'),\n        title: `Some Meeting ${index}`,\n        body: `A Description`,\n        private: false,\n        event_start: nextEventTime(true),\n        event_end: nextEventTime(),\n        timezone: 'Sydney',\n        all_day: false,\n        location: 'clear text location',\n        recurring: false,\n        recurrence: {},\n        attachments: {},\n        system: space,\n        extension_data: {},\n    };\n});\n\nconst event_spaces = {};\nMOCK_EVENTS.forEach((event) => {\n    if (!event_spaces[event.system.id]) {\n        event_spaces[event.system.id] = [];\n    }\n    event_spaces[event.system.id].push(event);\n});\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\nimport { MOCK_LEVELS } from './zone.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport * as dayjs from 'dayjs';\nimport { MOCK_EVENTS } from './events.data';\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/users/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.route_params.id === 'current') {\n            return ACTIVE_USER;\n        }\n        const person = MOCK_STAFF.find(user => user.email === request.route_params.id);\n        if (person) {\n            return person;\n        }\n        throw { status: 404, message: 'User not found' };\n    },\n});\n\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/people',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.query_params.q) {\n            const search = request.query_params.q.toLowerCase();\n            return MOCK_STAFF.filter(\n                (user) =>\n                    user.name.toLowerCase().includes(search) ||\n                    user.email.toLowerCase().includes(search)\n            );\n        }\n        return MOCK_STAFF;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/people/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        const id = decodeURIComponent(request.route_params.id);\n        const person = MOCK_STAFF.find(user => user.email === id);\n        if (person) {\n            return {\n                ...person,\n                location: generateLocation()\n            };\n        }\n        throw { status: 404, message: 'User not found' };\n    },\n});\n\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/guests',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.query_params.q) {\n            const search = request.query_params.q.toLowerCase();\n            return MOCK_GUESTS.filter(\n                (user) =>\n                    user.name.toLowerCase().includes(search) ||\n                    user.email.toLowerCase().includes(search)\n            );\n        }\n        return MOCK_STAFF;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/guests/:email',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        const person = MOCK_GUESTS.find(user => user.email === request.route_params.email);\n        if (person) {\n            return person;\n        }\n        throw { status: 404, message: 'Guest not found' };\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/guests/:email/meetings',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.route_params.email) {\n            const email = request.route_params.email.toLowerCase();\n            const events = MOCK_EVENTS.filter(\n                (event) => event.attendees.find(user => user.email.toLowerCase() === email)\n            );\n            return events;\n        }\n        throw { status: 404, message: `Unable to find meetings with guest with email ${request.route_params.email}` };\n    },\n});\n\n\n\nconst LOCATION_TYPES = ['meeting', 'desk_id', 'laptop', 'mobile', 'geo', 'none'];\n\nfunction generateLocation() {\n    const type = LOCATION_TYPES[predictableRandomInt(LOCATION_TYPES.length)];\n    const level = MOCK_LEVELS[predictableRandomInt(MOCK_LEVELS.length)];\n    const level_spaces = MOCK_SPACES.filter(s => s.zones.includes(level.id));\n    const space = level_spaces[predictableRandomInt(level_spaces.length)] || {};\n    const location: HashMap = {};\n    switch (type) {\n        case 'meeting':\n            location.meeting = {\n                building: level.parent_id,\n                level: level.id,\n                system: space.id,\n                map_id: space.map_id,\n                event_id: ''\n            };\n            break;\n        case 'desk_id':\n            location.meeting = {\n                building: level.parent_id,\n                level: level.id,\n                map_id: space.map_id,\n                checked_in: dayjs().unix()\n            };\n            break;\n        case 'laptop':\n        case 'mobile':\n            location[type] = {\n                building: level.parent_id,\n                level: level.id,\n                x: +predictableRandomInt(10000),\n                y: +predictableRandomInt(5000),\n                last_seen: dayjs().subtract(predictableRandomInt(60), 'm').unix()\n            };\n            break;\n        case 'geo':\n            location.geo = {\n                lat: predictableRandomInt(180) - 90,\n                lon: predictableRandomInt(360) - 180,\n                last_seen: dayjs().subtract(predictableRandomInt(60), 'm').unix()\n            };\n            break;\n    }\n    return location;\n}\n","import { HashMap, unique } from '@placeos/common';\n\nexport interface EnvironmentSource {\n    id?: string;\n    name: string;\n    type?: 'lights' | 'blinds' | 'screen';\n    state: string | number;\n    states: string[];\n}\n\nexport interface RoomInput {\n    id?: string;\n    name: string;\n    type: string;\n    module: string;\n    mute: boolean;\n    locked: boolean;\n    routes: string[];\n    outputs: string[];\n}\n\nexport interface RoomOutput {\n    id?: string;\n    name: string;\n    type: string;\n    module: string;\n    mute: boolean;\n    locked: boolean;\n    source: string;\n    inputs: string[];\n    following: string;\n}\n\nclass RoomModule {\n    public readonly name: string;\n    public readonly connected: boolean;\n    public readonly recording = true;\n    public power: boolean;\n\n    public readonly input_list: HashMap<RoomInput>;\n    public readonly output_list: HashMap<RoomOutput>;\n    public readonly env_sources: EnvironmentSource[];\n\n    public readonly inputs;\n    public readonly outputs;\n    public readonly environment;\n\n    public volume = 0;\n\n    constructor(_data: Partial<RoomModule>) {\n        this.name = _data.name || 'Test Module';\n        this.connected = _data.connected ?? true;\n        this.power = _data.power || false;\n        this.input_list = _data.input_list;\n        this.output_list = _data.output_list;\n        this.env_sources = _data.env_sources || [];\n        this.inputs = Object.keys(this.input_list || {}) || [];\n        this.outputs = Object.keys(this.output_list || {}) || [];\n        const types = unique(this.env_sources.map((_) => _.type));\n        types.forEach(\n            (t) =>\n                (this[`${t}`] = this.env_sources\n                    .filter((_) => _.type === t)\n                    .map((_) => _.id))\n        );\n        this.env_sources.forEach(\n            (source) => (this[`${source.type}/${source.id}`] = source)\n        );\n        this.inputs.forEach(\n            (key) => (this[`input/${key}`] = this.input_list[key])\n        );\n        this.outputs.forEach(\n            (key) => (this[`output/${key}`] = this.output_list[key])\n        );\n    }\n\n    $power_on() {\n        console.log('Power On');\n        this.power = true;\n    }\n    /**\n     * Power off the space. End any active calls, disconnect signal routes, place\n     * powerable devices into standby and return environmental configuration to\n     * sensible defaults.\n     **/\n    $shutdown() {\n        this.power = false;\n    }\n    /** Shares a signal source with the room and any connected remote participants. */\n    $share() {}\n    /**\n     * Connect a signal source to a signal output, or set of outputs. Any intermediate\n     * device interactions are handled internally. For example, on a system using a small\n     * presentation switcher and a display, routing a laptop input will select the\n     * appropriate input on the switcher, and select the appropriate input on the display.\n     *\n     * This includes all routable signal types - in addition to the above example, this may\n     * be interacting with an audio DSP to add a microphone feed to an output zone, or\n     * connecting a USB HID input device with a specific output.\n     **/\n    $route(input: string, output: string) {\n        if (this.inputs.includes(input) && this.outputs.includes(output)) {\n            this.$updateState(input, {\n                routes: unique([\n                    ...(this.input_list[input].routes || []),\n                    output,\n                ]),\n            });\n            this.$updateState(output, {\n                source: input,\n                following: input,\n            });\n        }\n    }\n    /**\n     * Remove a signal source from a signal output.\n     * Predominantly intended for outputs that support more than one simultaneous input source\n     * (mixed audio zone, or display capable of compositing multiple video sources).\n     **/\n    $unroute() {}\n    /**\n     * Establish a call (either phone or video) with a remote participant.\n     * This may be a peer-to-peer connection or a wider group via an external bridging service.\n     **/\n    $connect() {}\n    /** End a call with a remote participant. */\n    $disconnect() {}\n    /**\n     * Bind the current system to another PlaceOS controlled space, relinquishing local control.\n     * This may be used for an education pod that pairs with a wider classroom or a room being\n     * used as an overflow from a primary event space.\n     **/\n    $link() {}\n    /**\n     * Join the current system with another PlaceOS controlled space, sharing control and signal IO.\n     * Examples of usage would be a set of rooms with moveable walls. N-way merges supported.\n     **/\n    $merge() {}\n    /** Separate from a linked or merged system. */\n    $split() {}\n    /**\n     * Display an alert visible to participants in the space. This may occur as a screen overlay,\n     * on a control interface, a bot post in a chat space associated with the current meeting or\n     * other modalities depending on hardware capability.\n     **/\n    $notify() {}\n    /**\n     * Place the room into a predefined operation mode. This may include executing an arbitrary\n     * set of device interactions, changing metadata associated with the system itself (changing\n     * available input or output nodes), or other configurable actions designed to transition\n     * the space to a specific state.\n     **/\n    $preset() {}\n    /**\n     * Set the volume for a signal node in the space. This can include outputs as well as inputs\n     * where supported (e.g. microphone). If unspecified, default is to interact with a ‘primary’\n     * output node.\n     **/\n    $volume(source: string, value: number) {\n        if (source === 'all') {\n            this.volume = value;\n        }\n    }\n    /** Interact with audio muting on supporting signal nodes within the space. */\n    $mute(source: string, state: boolean = true) {\n        this.$updateState(source, { mute: state });\n    }\n    /**\n     * Activates or deactivates a signal mute for the associated IO. If this is not possible,\n     * (e.g. unsupported by the device) an error is returned.\n     **/\n    $unmute(source: string) {\n        this.$mute(source, false);\n    }\n    /**\n     * Wrapper for an arbitrary set of control points defined in system configuration.\n     * Each of these may map to control options available on a sibling module and take one of two forms:\n     *  - Continuous value within a range (temperature set point 16.0...28.0 degrees, lighting level 0...100)\n     *  - Set of possible states (lighting high/med/low, blind up/down, electrochromic glass clear/opaque)\n     *\n     * System state provides the ability to introspect configured points for both control limits and current value.\n     **/\n    $environment(id: string, state: string | number) {\n        const source = this.env_sources.find(_ => _.id === id);\n        if (source) {\n            this[`${source.type}/${source.id}`] = { ...source, state };\n        }\n    }\n    /** Locks an IO node. Prevents any route changes that include this until unlocked. */\n    $lock(source: string) {\n        this.$updateState(source, { locked: true });\n    }\n    /** Unlocks an IO node. */\n    $unlock(source: string) {\n        this.$updateState(source, { locked: false });\n    }\n\n    $updateState(source: string, data: HashMap) {\n        if (this[`input/${source}`]) {\n            this[`input/${source}`] = { ...this[`input/${source}`], ...data };\n            this.input_list[source] = { ...this[`input/${source}`], ...data };\n        } else if (this[`output/${source}`]) {\n            this[`output/${source}`] = { ...this[`output/${source}`], ...data };\n            this.output_list[source] = { ...this[`output/${source}`], ...data };\n        }\n    }\n}\n\nconst input_list: HashMap = {\n    Mic1: {\n        name: 'Lectern Mic',\n        type: 'Microphone',\n        module: 'Microphone_1',\n    },\n    Mic2: {\n        name: 'Lapel Mic',\n        type: 'Microphone',\n        module: 'Microphone_2',\n    },\n    Mic3: {\n        name: 'Handheld Mic',\n        type: 'Microphone',\n        module: 'Microphone_3',\n    },\n    PC1: {\n        name: 'PC-1',\n        type: 'PC',\n    },\n    PC2: {\n        name: 'PC-2',\n        type: 'PC',\n    },\n    PC3: {\n        name: 'PC-3',\n        type: 'PC',\n    },\n    PC4: {\n        name: 'PC-4',\n        type: 'PC',\n    },\n    HDMI: {\n        name: 'Laptop HDMI',\n        type: 'Laptop',\n    },\n    VGA: {\n        name: 'Laptop VGA',\n        type: 'Laptop',\n    },\n    Camera1: {\n        name: 'Camera Rear',\n        type: 'Camera',\n        module: 'Camera_1',\n    },\n    Camera2: {\n        name: 'Camera Front',\n        type: 'Camera',\n        module: 'Camera_2',\n    },\n    Camera3: {\n        name: 'Camera Rear 2',\n        type: 'Camera',\n        module: 'Camera_3',\n    },\n    Camera4: {\n        name: 'Camera Front 2',\n        type: 'Camera',\n        module: 'Camera_4',\n    },\n    TV1: {\n        name: 'IPTV 1',\n        type: 'TV',\n        module: 'IPTV_1',\n    },\n};\n\nconst output_list: HashMap = {\n    Display1: {\n        name: 'Display 1',\n        type: 'Display',\n        source: 'PC1',\n        module: 'Display_1',\n    },\n    Display2: {\n        name: 'Display 2',\n        type: 'Display',\n        module: 'Display_2',\n    },\n    Display3: {\n        name: 'Display 3',\n        type: 'Display',\n        source: 'PC2',\n        module: 'Display_3',\n    },\n    Display4: {\n        name: 'Display 4',\n        type: 'Display',\n        module: 'Display_4',\n    },\n    Display5: {\n        name: 'Display 5',\n        type: 'Display',\n        module: 'Display_5',\n        source: 'TV1',\n    },\n};\n\nconst env_sources: any[] = [\n    {\n        id: 'light1',\n        name: 'Lighting',\n        type: 'lights',\n        states: ['Off', 'Presentation', 'Meeting', 'Full'],\n        state: 'Off',\n    },\n    {\n        id: 'blinds',\n        name: 'Blinds',\n        type: 'blinds',\n        states: ['Off', 'Presentation', 'Meeting'],\n        state: 'Off',\n    },\n];\n\nexport const createSystemModule = (space: HashMap, overrides: HashMap = {}) =>\n    new RoomModule({\n        ...space,\n        input_list,\n        output_list,\n        env_sources,\n        ...overrides,\n    });\n","import { addSeconds, isBefore, subSeconds } from 'date-fns';\n\nimport { HashMap, timePeriodsIntersect } from '@placeos/common';\nimport { MOCK_EVENTS } from '../api/events.data';\n\nexport class MockBookingModule {\n    /** Timezone the associated space resided */\n    time_zone = 'Australia/Sydney';\n    /** Whether booking is disabled */\n    disable_book_now = false;\n    /** Whether ending current meeting is disabled */\n    disable_end_meeting = false;\n    /** List of current and upcoming bookings for space */\n    bookings: HashMap[] = [];\n    pending_period = 0;\n    pending_before = 0;\n    /** Control UI associated with the space */\n    control_ui = '';\n    /** Catering UI associated with the space */\n    catering_ui = '';\n    /** Time of the last booking started by a user */\n    last_booking_started = 0;\n    /** Current status of the space */\n    status: 'pending' | 'busy' | 'free' | 'not-bookable' = 'free';\n}\n\nexport function createBookingsModule(space: HashMap, overrides: Partial<MockBookingModule> = {}) {\n    const mod = {\n        ...new MockBookingModule(),\n        ...overrides,\n        /** Start the meeting at the given time */\n        $start_meeting: function (t: number) {\n            this.last_booking_started = t;\n        },\n        /** End the meeting at the given time */\n        $end_meeting: function (t: number) {},\n        /** Book meeting for the current time */\n        $book_now: function (len: number, t?: string, o?: string) {},\n    };\n    updateBookings(space, mod);\n    setInterval(() => updateBookings(space, mod), 1000);\n    return mod;\n}\n\nfunction updateBookings(space: HashMap, mod: HashMap) {\n    const bookings = MOCK_EVENTS.filter((event) =>\n        event.attendees.find((u) => u.email === space.email)\n    );\n    bookings.sort((a, b) => a.event_start - b.event_start);\n    mod.bookings = bookings;\n    if (!space.bookable) {\n        return (mod.status = 'not-bookable');\n    }\n    const date = new Date();\n    const current = bookings.find((bkn) =>\n        timePeriodsIntersect(\n            date.valueOf(),\n            date.valueOf(),\n            bkn.event_start,\n            bkn.event_end\n        )\n    );\n    const next = bookings.find((bkn) =>\n        isBefore(date.valueOf(), bkn.event_start)\n    );\n    const start = new Date((current || next)?.event_start);\n    const pending = timePeriodsIntersect(\n        date,\n        date,\n        subSeconds(start, mod.pending_before),\n        addSeconds(start, mod.pending_period)\n    );\n    mod.status = current\n        ? pending\n            ? 'pending'\n            : 'busy'\n        : next && pending\n        ? 'pending'\n        : 'free';\n}\n","import { Md5 } from 'ts-md5';\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { MOCK_LEVELS } from '../api/zone.data';\nimport { MOCK_STAFF } from '../api/users.data';\n\nexport interface ZoneOverview {\n    /** Desk count based on `desks` metadata in the zone\n     falls back to the zone.count field otherwise */\n    desk_count: number;\n\n    desk_usage: number;\n    /** Capacity of the space, set in zone.capacity field */\n    device_capacity: number;\n    /** Raw device count */\n    device_count: number;\n    /** This is the adjusted count based on the duplication factor */\n    estimated_people: number;\n\n    percentage_use: number;\n    /** The higher the recommendation number the better for recommending */\n    recommendation: number;\n}\n\nexport class MockLocationServicesModule implements HashMap {\n    /** Overview of the zones */\n    overview: HashMap<ZoneOverview> = {};\n\n    $locate_user(email: string, username: string) {}\n}\n\nfunction padZero(no: number, len: number = 3) {\n    let str = `${no}`;\n    while (str.length < len) {\n        str = '0' + str;\n    }\n    return str;\n}\n\nexport function createLocationServicesModule(\n    space: HashMap,\n    overrides: HashMap = {}\n) {\n    const mod = new MockLocationServicesModule();\n    for (const lvl of MOCK_LEVELS) {\n        mod.overview[lvl.id] = {\n            desk_count: 100,\n            desk_usage: 0,\n            device_capacity: 100,\n            device_count: 0,\n            estimated_people: 0,\n            percentage_use: 0,\n            recommendation: 10000,\n        };\n        mod[`${lvl.id}:desk_ids`] = new Array(mod.overview[lvl.id].desk_count)\n            .fill(0)\n            .map((_, idx) => `table-${lvl.number}.${padZero(idx)}`);\n        mod[`${lvl.id}`] = { value: [] };\n    }\n    updateLocations(mod, MOCK_LEVELS);\n    setInterval(() => updateLocations(mod, MOCK_LEVELS), 60 * 1000);\n    return mod;\n}\n\nexport function updateLocations(\n    mod: MockLocationServicesModule,\n    levels: HashMap[]\n) {\n    for (const lvl of levels) {\n        mod[lvl.id] = {\n            value: new Array(predictableRandomInt(20))\n                .fill(0)\n                .map(() => generateLocation(lvl, mod[`${lvl.id}:desk_ids`])),\n        };\n    }\n}\n\nexport function generateLocation(\n    lvl: HashMap,\n    desks: string[],\n    users = MOCK_STAFF\n) {\n    const fixed = predictableRandomInt(9999) % 3 === 0;\n    return fixed\n        ? {\n              location: 'desk',\n              at_location: predictableRandomInt(9999) % 5 !== 0,\n              map_id: desks[predictableRandomInt(desks.length)],\n              mac: Md5.hashStr(\n                  users[predictableRandomInt(users.length)].email\n              ),\n              level: lvl.id,\n              building: lvl.parent_id,\n          }\n        : {\n              location: 'wireless',\n              coordinates_from: 'bottom-left',\n              x: predictableRandomInt(1000) / 10,\n              y: predictableRandomInt(1000) / 10,\n              lon: 55.27476066828535,\n              lat: 25.20106100633537,\n              s2_cell_id: '3e5f4281459c',\n              mac: Md5.hashStr(\n                  users[predictableRandomInt(users.length)].email\n              ),\n              variance: 9.62534032222287,\n              last_seen: Math.floor(new Date().valueOf() / 1000),\n              map_width: 100,\n              map_height: 100,\n          };\n}\n","import { HashMap } from '@placeos/common';\n\nexport enum CameraTilt {\n    Down,\n    Up,\n    Stop,\n}\n\nexport enum CameraPan {\n    Left,\n    Right,\n    Stop,\n}\n\nclass CameraModule {\n    pan: number;\n    tilt: number;\n    zoom: number;\n\n    pan_speed: number;\n    tilt_speed: number;\n    zoom_speed: number;\n\n    presets: string[];\n\n    constructor(_) {\n        this.presets = ['Preset One', 'Preset 2', 'Preset Three'];\n    }\n\n    $pan(dir: CameraPan) {}\n\n    $tilt(tilt: CameraTilt) {}\n\n    $recall(name: string) {}\n\n    $save_preset(name: string) {}\n}\n\nexport const createCameraModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CameraModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass DisplayModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createDisplayModule = (space: HashMap, overrides: HashMap = {}) =>\n    new DisplayModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass MicrophoneModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createMicrophoneModule = (\n    space: HashMap,\n    overrides: HashMap = {}\n) => new MicrophoneModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from \"@placeos/common\";\n\nlet interval;\n\nexport class CaptureModule {\n\n    status: 'playing' | 'stopped' | 'paused' = 'stopped';\n    title: string;\n    live: boolean = false;\n    remaining: number;\n    current: number;\n    next: number;\n\n    constructor(_) {\n        this.remaining = randomInt(24 * 60 * 60);\n    }\n\n    $start() {\n        this.status = 'playing';\n        interval = setInterval(() => {\n            if (this.remaining < 1) clearInterval(interval);\n            this.remaining = this.remaining - 1;\n            this.current = this.current + 1;\n        }, 3000);\n    }\n\n    $pause() {\n        this.status = 'paused';\n        clearInterval(interval);\n    }\n\n    $resume() {\n        this.$start();\n    }\n\n    $stop() {\n        this.status = 'stopped';\n        this.current = 0;\n        clearInterval(interval);\n    }\n\n}\n\nexport const createCaptureModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CaptureModule({ ...space, ...overrides });\n","\nimport { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { createSystem } from '../systems-bindings.mock';\nimport { MOCK_SPACES } from './spaces.data';\n\nMOCK_SPACES.forEach((space: any, index) => createSystem(space));\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/systems',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        return MOCK_SPACES;\n    }\n});\n","import { registerSystem } from '@placeos/ts-client';\nimport { HashMap } from '@placeos/common';\n\nimport { createSystemModule } from './realtime/control';\nimport { createBookingsModule } from './realtime/events';\nimport { createLocationServicesModule } from './realtime/desks';\nimport { createCameraModule } from './realtime/camera';\nimport { createDisplayModule } from './realtime/display';\nimport { createMicrophoneModule } from './realtime/microphone';\nimport { createCaptureModule } from './realtime/capture';\n\nexport function createSystem(space: HashMap) {\n    registerSystem(space.id, {\n        System: [createSystemModule(space)],\n        Bookings: [createBookingsModule(space)],\n        AreaManagement: [createLocationServicesModule(space)],\n        Camera: new Array(10).fill(0).map(_ => createCameraModule(space)),\n        Display: new Array(10).fill(0).map(_ => createDisplayModule(space)),\n        Microphone: new Array(10).fill(0).map(_ => createMicrophoneModule(space)),\n        Capture: [createCaptureModule(space)]\n    });\n}\n","import { registerMockEndpoint } from '@placeos/ts-client';\nimport { predictableRandomInt } from '@placeos/common';\n\nimport { MOCK_EVENTS } from './events.data';\nimport { ACTIVE_USER } from './users.data';\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events',\n    metadata: {},\n    method: 'GET',\n    callback: (_) => {\n        const events = MOCK_EVENTS.filter(\n            (event) => !!event.attendees.find((user) => user.email === ACTIVE_USER.email)\n        );\n        return events;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events',\n    metadata: {},\n    method: 'POST',\n    callback: (request) => {\n        const new_event = { ...request.body, id: `-cal-event-${predictableRandomInt(999)}` };\n        new_event.attendees.forEach(user => {\n            if (user.zones) {\n                user.resource = true;\n            }\n        });\n        MOCK_EVENTS.push(new_event);\n        return new_event;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        const item = MOCK_EVENTS.find((event) => event.id === request.route_params.id);\n        if (item) {\n            return item;\n        }\n        throw { status: 404, message: 'Event not found' };\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events/:id',\n    metadata: {},\n    method: 'PATCH',\n    callback: (request) => {\n        const index = MOCK_EVENTS.findIndex((event) => event.id === request.route_params.id);\n        if (index >= 0) {\n            return MOCK_EVENTS.splice(index, 1, request.body);\n        }\n        throw { status: 404, message: 'Event not found' };\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events/:id/guests/:email/checkin',\n    metadata: {},\n    method: 'POST',\n    callback: (request) => {\n        const event = MOCK_EVENTS.find(event => event.id === request.route_params.id);\n        if (event) {\n            const checked_in = (event.extension_data as any).checked_in || [];\n            (event.extension_data as any).checked_in = checked_in.concat([request.route_params.email]);\n            return event;\n        }\n        throw { status: 404, message: 'Guest not found' };\n    },\n});\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_EVENTS } from './events.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport * as dayjs from 'dayjs';\nregisterMockEndpoint({\n    path: '/api/staff/v1/calendars',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => []\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/calendars/availability',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        const start = dayjs(+request.query_params.period_start * 1000);\n        const end = dayjs(+request.query_params.period_end * 1000);\n        const zones = (request.query_params.zone_ids || '').split(',').filter(i => !!i);\n        const systems = (request.query_params.system_ids || '').split(',').filter(i => !!i);\n\n        const spaces = MOCK_SPACES.filter((space) =>\n            zones.length\n                ? zones.reduce((has, zone) => has && space.zones.includes(zone), true)\n                : systems.length\n                    ? systems.includes(space.id)\n                    : true\n        )\n            .filter((space) => {\n                const bookings = MOCK_EVENTS.filter((event) =>\n                    event.attendees.find((user) => user.id === space.id)\n                );\n                for (const event of bookings) {\n                    const event_start = dayjs(event.event_start * 1000);\n                    const event_end = dayjs(event.event_end * 1000);\n                    if (\n                        (start.isAfter(event_start, 's') && start.isBefore(event_end, 'm')) ||\n                        (end.isAfter(event_start, 'm') && end.isBefore(event_end, 'm')) ||\n                        (event_start.isAfter(start, 'm') && event_start.isBefore(end, 'm'))\n                    ) {\n                        return false;\n                    }\n                }\n                return true;\n            });\n        const output = {};\n        spaces.forEach(space => output[space.email] = space);\n        return output;\n    },\n});\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        return [];\n    },\n});\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { first } from 'rxjs/operators';\n\nimport { BaseClass } from '@placeos/common';\nimport { Space, SpacesService } from '@placeos/spaces';\n\n@Component({\n    selector: '[app-bootstrap]',\n    template: `\n        <div\n            class=\"rounded shadow m-4 bg-white overflow-hidden mx-auto text-center flex flex-col items-center\"\n        >\n            <h2 class=\"bg-primary text-white py-2 px-4 m-0 w-full text-2xl\">Booking Panel Setup</h2>\n            <ng-container *ngIf=\"!loading; else load_state\">\n                <p class=\"description py-4\">Input the PlaceOS <em>System ID</em> to bootstrap</p>\n                <mat-form-field appearance=\"outline\">\n                    <mat-label>System ID</mat-label>\n                    <input\n                        matInput\n                        [(ngModel)]=\"system_id\"\n                        [matAutocomplete]=\"auto\"\n                        placeholder=\"System ID\"\n                        (ngModelChange)=\"filter($event)\"\n                    />\n                </mat-form-field>\n                <mat-autocomplete #auto=\"matAutocomplete\">\n                    <mat-option *ngFor=\"let option of filtered_list\" [value]=\"option.id\">\n                        <div class=\"leading-tight\">\n                            <div class=\"name\">{{ option.name }}</div>\n                            <div class=\"text-xs text-dark-fade\">{{ option.id }}</div>\n                        </div>\n                    </mat-option>\n                </mat-autocomplete>\n                <button mat-button [disabled]=\"!system_id\" (click)=\"bootstrap()\">Submit</button>\n            </ng-container>\n        </div>\n        <ng-template #load_state>\n            <div class=\"my-16 flex flex-col items-center\">\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <div class=\"m-4\">Loading system data...</div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background-color: #f0f0f0;\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%23ddd' fill-opacity='1' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.98-7.5V0h-2v6.35L0 12.69v2.3zm0 18.5L12.98 41v8h-2v-6.85L0 35.81v-2.3zM15 0v7.5L27.99 15H28v-2.31h-.01L17 6.35V0h-2zm0 49v-8l12.99-7.5H28v2.31h-.01L17 42.15V49h-2z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n            }\n\n            :host > div {\n                width: 32rem;\n                max-width: calc(100vw - 2rem);\n            }\n\n            mat-form-field {\n                width: calc(100% - 2rem);\n            }\n\n            button {\n                width: 8rem;\n                margin: 0.5rem;\n                margin-top: 0;\n            }\n        `,\n    ],\n})\nexport class BootstrapComponent extends BaseClass implements OnInit {\n    /** List of available systems */\n    public system_list: Space[] = [];\n    /** List of available systems */\n    public filtered_list: Space[] = [];\n    /** Whether application data is loading */\n    public loading: boolean;\n    /** ID of the system to bootstrap */\n    public system_id: string;\n    /** Selected system to bootstrap */\n    public selected_system: Space = null;\n    /** Whether input field is focused */\n    public input_focus: boolean;\n\n    constructor(\n        private _spaces: SpacesService,\n        private route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this.loading = true;\n        await this._spaces.initialised.pipe(first((_) => _)).toPromise();\n        this.system_list = this._spaces.space_list || [];\n        this.filter('');\n        this.loading = false;\n        this.subscription(\n            'route.query',\n            this.route.queryParamMap.subscribe((params) => {\n                if (params.has('clear') && params.get('clear')) {\n                    this.clearBootstrap();\n                }\n                if (params.has('system_id') || params.has('sys_id')) {\n                    this.system_id = params.get('system_id') || params.get('sys_id');\n                    this.bootstrap();\n                }\n            })\n        );\n        this.checkBootstrapped();\n    }\n\n    /**\n     * Setup the default system for the application to bind to\n     */\n    public readonly bootstrap = () => this.configure(this.system_id);\n\n    /**\n     * Check if the application has previously been bootstrapped\n     */\n    private checkBootstrapped(): void {\n        this.loading = true;\n        if (localStorage) {\n            const system_id = localStorage.getItem('PLACEOS.BOOKINGS.system');\n            if (system_id) {\n                this._router.navigate(['panel', system_id]);\n                return;\n            }\n        }\n        this.loading = false;\n    }\n\n    /**\n     * Save the bootstrapped ID and redirect to the panel for that ID\n     * @param system_id System to bootstrap\n     */\n    private configure(system_id: string): void {\n        this.loading = true;\n        if (localStorage) {\n            localStorage.setItem('PLACEOS.BOOKINGS.system', system_id);\n            localStorage.setItem('trusted', 'true');\n            localStorage.setItem('fixed_device', 'true');\n        }\n        this._router.navigate(['panel', system_id]);\n        this.loading = false;\n    }\n\n    /**\n     * Remove any previously set bootstrapping details\n     */\n    private readonly clearBootstrap = () => localStorage.removeItem('PLACEOS.BOOKINGS.system');\n\n    public filter(search: string) {\n        const s = search.toLowerCase();\n        this.filtered_list = this.system_list\n            .filter((i) => i.name.toLowerCase().includes(s) || i.id.includes(search))\n            .slice(0, 100);\n    }\n}\n","<header>\n    <div class=\"heading\" mat-dialog-title>{{ user?.id ? 'Edit' : 'Add' }} External Attendee</div>\n    <div class=\"flex-1\"></div>\n    <button mat-icon-button mat-dialog-close>\n        <app-icon [icon]=\"{ type: 'icon', class: 'material-icons', content: 'close' }\"></app-icon>\n    </button>\n</header>\n<mat-dialog-content>\n    <div class=\"body\" *ngIf=\"!loading; else load_state\">\n        <user-form [form]=\"form\"></user-form>\n    </div>\n</mat-dialog-content>\n<mat-dialog-actions>\n    <footer *ngIf=\"!loading\">\n        <button mat-button class=\"inverse\" mat-dialog-close>Cancel</button>\n        <button mat-button (click)=\"saveChanges()\">Save</button>\n    </footer>\n</mat-dialog-actions>\n<ng-template #load_state>\n    <div class=\"body\">\n        <div class=\"info-block\">\n            <div class=\"icon\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n            </div>\n            <div class=\"text\">Saving attendee...</div>\n        </div>\n    </div>\n</ng-template>\n","import { Component, OnInit, Output, EventEmitter, Inject } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BaseClass, DialogEvent } from '@placeos/common';\n\nimport { User } from '../user.class';\nimport { generateUserForm } from '../user.utilities';\n\n@Component({\n    selector: 'new-user-modal',\n    templateUrl: './new-user-modal.component.html',\n    styleUrls: ['./new-user-modal.component.scss'],\n})\nexport class NewUserModalComponent extends BaseClass implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Form fields for the new user */\n    public form: FormGroup;\n    /** New user data store */\n    public user: User;\n    /** Whether user details are being saved */\n    public loading: boolean;\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: any) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.user = this._data.user || {};\n        this.form = generateUserForm(this.user);\n    }\n\n    public saveChanges() {\n        this.form.markAllAsTouched();\n        if (this.form.valid) {\n            const new_user = new User({\n                ...this.form.value,\n                type: 'external',\n                visit_expected: !this.form.value.email.endsWith('place.tech'),\n            });\n            this.event.emit({ reason: 'done', metadata: new_user });\n        }\n    }\n}\n","import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { predictableRandomInt, unique } from '../../../common/src/lib/general';\n\nimport { GuestUser, User } from './user.class';\n\nlet USER_COUNT = 0;\n\ntype HashMap<T = any> = Record<string, T>;\n\nexport let USER_DOMAIN = 'place.tech';\n\nconst USER_EMAILS: string[] = [];\n\n/**\n * Generate raw mock data for a user\n * @param id Forced ID for the mock\n * @param name Forced name for the user\n * @param external Whether user is external of the organisation\n */\nexport function generateMockUser(\n    id?: string,\n    name?: string,\n    external?: boolean\n): HashMap {\n    if (!id) {\n        id = `user-${USER_COUNT++}`;\n    }\n    if (!name) {\n        name = `User ${USER_COUNT}`;\n    }\n    if (external === undefined) {\n        external = !(predictableRandomInt(99999) % 2);\n    }\n    const organisation = external ? `Fake Co.` : USER_DOMAIN.split('.')[0];\n    let delegates: string[] = [];\n    const delegate_count = Math.min(\n        predictableRandomInt(4) + 1,\n        USER_EMAILS.length\n    );\n    for (let i = 0; i < delegate_count; i++) {\n        delegates.push(USER_EMAILS[predictableRandomInt(USER_EMAILS.length)]);\n    }\n    delegates = unique(delegates);\n    const email = `${name.split(' ').join('.').toLowerCase()}@${\n        external ? 'not-' : ''\n    }${USER_DOMAIN}`;\n    USER_EMAILS.push(email);\n    return {\n        id,\n        name,\n        first_name: name.split(' ')[0],\n        last_name: name.split(' ')[1],\n        email,\n        phone: `(02) 4567 8901`,\n        visitor: external,\n        organisation: {\n            id: organisation.split(' ').join('.').toLowerCase(),\n            name: organisation,\n        },\n        department: `Department ${predictableRandomInt(10)}`,\n        staff_code: predictableRandomInt(999_999),\n        delegates,\n        image: `${id}.png`,\n    };\n}\n\n/**\n * Generate form fields for the given user\n * @param user User to generate form for\n */\nexport function generateUserForm(user: User): FormGroup {\n    if (!user) {\n        throw Error('No user passed');\n    }\n\n    const fields: HashMap<FormControl> = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(user.phone || ''),\n        assistance_required: new FormControl(user.assistance_required || false),\n        visit_expected: new FormControl(user.visit_expected ?? true),\n    };\n\n    // Generate form group for the user\n    const form = new FormGroup(fields);\n    return form;\n}\n\nexport function generateGuestForm(\n    user: GuestUser,\n    host: string = ''\n): FormGroup {\n    const fields: HashMap<FormControl> = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(user.phone || ''),\n        host: new FormControl(host || '', [Validators.required]),\n    };\n    // Generate form group for the guest\n    const form = new FormGroup(fields);\n    return form;\n}\n","<div class=\"user form\" *ngIf=\"form\">\n    <form [formGroup]=\"form\">\n        <div class=\"field\" *ngIf=\"form.controls.name\">\n            <label\n                for=\"name\"\n                [class.error]=\"form.controls.name.invalid && form.controls.name.touched\"\n                >Name<span>*</span>:</label\n            >\n            <mat-form-field appearance=\"outline\">\n                <input matInput name=\"name\" placeholder=\"Name\" formControlName=\"name\" />\n                <mat-error *ngIf=\"form.controls.name.invalid\">Name is required</mat-error>\n            </mat-form-field>\n        </div>\n        <div class=\"field\" *ngIf=\"form.controls.email\">\n            <label\n                for=\"email\"\n                [class.error]=\"form.controls.email.invalid && form.controls.email.touched\"\n                >Email<span>*</span>:</label\n            >\n            <mat-form-field appearance=\"outline\">\n                <input matInput name=\"email\" placeholder=\"Email Address\" formControlName=\"email\" />\n                <mat-error *ngIf=\"form.controls.email.invalid\">A valid email is required</mat-error>\n            </mat-form-field>\n        </div>\n        <div class=\"field\" *ngIf=\"form.controls.organisation\">\n            <label\n                for=\"organisation\"\n                [class.error]=\"\n                    form.controls.organisation.invalid && form.controls.organisation.touched\n                \"\n                >Organisation<span>*</span>:</label\n            >\n            <mat-form-field appearance=\"outline\">\n                <input\n                    matInput\n                    name=\"organisation\"\n                    placeholder=\"Organisation\"\n                    formControlName=\"organisation\"\n                />\n                <mat-error *ngIf=\"form.controls.organisation.invalid\"\n                    >Organisation is required</mat-error\n                >\n            </mat-form-field>\n        </div>\n        <div class=\"field\" *ngIf=\"form.controls.phone\">\n            <label\n                for=\"phone\"\n                [class.error]=\"form.controls.phone.invalid && form.controls.phone.touched\"\n                >Phone:</label\n            >\n            <mat-form-field appearance=\"outline\">\n                <input matInput name=\"phone\" placeholder=\"Phone\" formControlName=\"phone\" />\n                <mat-error *ngIf=\"form.controls.phone.invalid\">Phone format is invalid</mat-error>\n            </mat-form-field>\n        </div>\n        <div class=\"field\" *ngIf=\"form.controls.assistance_required\">\n            <mat-checkbox color=\"primary\" formControlName=\"assistance_required\"\n                >Assistance required</mat-checkbox\n            >\n        </div>\n        <div class=\"field\" *ngIf=\"form.controls.visit_expected\">\n            <mat-checkbox color=\"primary\" formControlName=\"visit_expected\"\n                >Visit expected</mat-checkbox\n            >\n        </div>\n    </form>\n</div>\n","import { Component, Input } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\n\n@Component({\n  selector: 'user-form',\n  templateUrl: './user-form.component.html',\n  styleUrls: ['./user-form.component.scss']\n})\nexport class UserFormComponent {\n    /** Group of form fields used for creating the system */\n    @Input() public form: FormGroup;\n}\n","import { del, get, patch } from '@placeos/ts-client';\nimport { map } from 'rxjs/operators';\n\nimport { CalendarEvent } from '../../../events/src/lib/event.class';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { GuestUser } from './user.class';\nimport { Observable } from 'rxjs';\n\nconst GUEST_ENDPOINT = '/api/staff/v1/guests';\n\nexport interface GuestsQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zone_ids?: string;\n    /** Comma seperated list of system(space) ids to check availability */\n    system_ids?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n}\n\n/**\n * Search guests\n * @param q Search string for filtering guests\n */\nexport function searchGuests(q: string): Observable<GuestUser[]> {\n    const query = toQueryString({ q });\n    return get(`${GUEST_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new GuestUser(item)))\n    );\n}\n\n/**\n * List guests\n * @param q Parameters to pass to the API request\n */\nexport function queryGuests(q: GuestsQueryParams): Observable<GuestUser[]> {\n    const query = toQueryString({ q });\n    return get(`${GUEST_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new GuestUser(item)))\n    );\n}\n\n/**\n * Get guest details\n * @param id ID of the guest\n */\nexport function showGuest(id: string) {\n    return get(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new GuestUser(item))\n    );\n}\n\n/**\n * Update guest metadata\n * @param id ID of the guest\n * @param data New metadata state\n */\nexport function updateGuest(id: string, data: Partial<GuestUser>) {\n    return patch(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`, data).pipe(\n        map((item) => new GuestUser(item))\n    );\n}\n\n/**\n * Remove a guest\n * @param id ID of the guest to remove\n */\nexport function removeGuest(id: string) {\n    return del(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`, { response_type: 'void' });\n}\n\n/**\n * List upcoming meetings for a guest\n * @param id ID of the guest\n */\nexport function listGuestMeetings(id: string) {\n    return get(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}/meetings`).pipe(\n        map((list) => list.map((item) => new CalendarEvent(item)))\n    );\n}\n","import { get } from \"@placeos/ts-client\";\nimport { toQueryString } from \"libs/common/src/lib/api\";\nimport { Observable } from \"rxjs\";\nimport { map } from \"rxjs/operators\";\nimport { StaffUser } from \"./user.class\";\n\nconst STAFF_ENDPOINT = '/api/staff/v1/people';\n\n/**\n * Search staff members\n * @param q Search string for filtering staff\n */\nexport function searchStaff(q: string): Observable<StaffUser[]> {\n    const query = toQueryString({ q });\n    return get(`${STAFF_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new StaffUser(item)))\n    );\n}\n\n/**\n * Get user details\n * @param id User ID or email\n */\nexport function showStaff(id: string) {\n    return get(`${STAFF_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n\n\n/**\n * Get user with their location details\n * @param email User email\n */\nexport function locateStaff(email: string) {\n    return get(`${STAFF_ENDPOINT}/${email}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n","import { Component, OnInit, forwardRef, Input } from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\nimport { Subject, Observable, of, forkJoin } from 'rxjs';\nimport {\n    switchMap,\n    debounceTime,\n    distinctUntilChanged,\n    map,\n    catchError,\n} from 'rxjs/operators';\n\nimport { BaseClass, flatten } from '@placeos/common';\nimport { searchGuests, searchStaff, User } from '@placeos/users';\n\n@Component({\n    selector: 'a-user-search-field',\n    template: `\n        <div class=\"user-search-field text-black\" form-field>\n            <mat-form-field overlay appearance=\"outline\">\n                <input\n                    matInput\n                    name=\"user-search\"\n                    [(ngModel)]=\"search_str\"\n                    (ngModelChange)=\"search$.next($event)\"\n                    [disabled]=\"disabled\"\n                    [placeholder]=\"placeholder || 'Search for user...'\"\n                    [matAutocomplete]=\"auto\"\n                    (blur)=\"resetSearchString()\"\n                />\n                <app-icon matPrefix class=\"text-2xl relative\">search</app-icon>\n                <mat-spinner\n                    *ngIf=\"loading\"\n                    matSuffix\n                    diameter=\"16\"\n                ></mat-spinner>\n            </mat-form-field>\n            <mat-autocomplete\n                #auto=\"matAutocomplete\"\n                (optionSelected)=\"setValue($event.option.value)\"\n            >\n                <mat-option *ngFor=\"let option of user_list\" [value]=\"option\">\n                    <div class=\"leading-tight\">{{ option.name }}</div>\n                    <div class=\"text-xs text-black opacity-60\">\n                        {{ option.email }}\n                    </div>\n                </mat-option>\n            </mat-autocomplete>\n        </div>\n    `,\n    styles: [\n        `\n            :host,\n            mat-form-field {\n                width: 100%;\n            }\n\n            app-icon {\n                top: 0.15em;\n                left: -0.15em;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UserSearchFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UserSearchFieldComponent\n    extends BaseClass\n    implements OnInit, ControlValueAccessor {\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Placeholder text to display */\n    @Input() public placeholder: string;\n    /** Limit available options to these */\n    @Input() public options: User[];\n    /** Whether guests should also show when searching for users */\n    @Input() public guests: boolean;\n    /** Function for filtering the results of the user list */\n    @Input() public filter: (_: any, s: string) => boolean;\n    /** Currently selected user */\n    public active_user: User;\n    /** User list to display */\n    public user_list: User[];\n    /** Whether user list is loading */\n    public loading: boolean;\n    /** Current display value of the search input field  */\n    public search_str: string;\n    /** Subject holding the value of the search */\n    public search$ = new Subject<string>();\n    /** List of users from an API search */\n    public search_results$: Observable<User[]> = this.search$.pipe(\n        debounceTime(400),\n        distinctUntilChanged(),\n        switchMap((query) => {\n            this.loading = true;\n            return this.options && this.options.length > 0\n                ? of(this.options)\n                : query.length >= 3\n                ? !this.guests\n                    ? searchStaff(query)\n                    : forkJoin([searchStaff(query), searchGuests(query)])\n                : of([]);\n        }),\n        catchError((_) => of([])),\n        map((list: User[]) => {\n            this.loading = false;\n            list = flatten(list);\n            const search = this.search_str.toLowerCase();\n            return list.filter(\n                (item) => !this.filter || this.filter(item, search)\n            );\n        })\n    );\n\n    /** Form control on change handler */\n    private _onChange: (_: User) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: User) => void;\n\n    public ngOnInit(): void {\n        // Process API results\n        this.subscription(\n            'search_results',\n            this.search_results$.subscribe((list) => (this.user_list = list))\n        );\n    }\n\n    /**\n     * Reset the search string back to the name of the active user\n     */\n    public resetSearchString() {\n        this.search_str = this.active_user?.name || '';\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User): void {\n        this.active_user = new_value;\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n        this.resetSearchString();\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User) {\n        this.active_user = value;\n        this.resetSearchString();\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: User) => void): void {\n        this._onChange = fn;\n    }\n\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: User) => void): void {\n        this._onTouch = fn;\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { ComponentsModule } from '@placeos/components';\n\nimport { NewUserModalComponent } from './new-user-modal/new-user-modal.component';\nimport { UserFormComponent } from './user-form/user-form.component';\n\n@NgModule({\n    declarations: [NewUserModalComponent, UserFormComponent],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatDialogModule,\n        ComponentsModule,\n        MatCheckboxModule,\n    ],\n    exports: [NewUserModalComponent],\n})\nexport class SharedUsersModule {}\n","import {\n    Component,\n    forwardRef,\n    Input,\n    ViewChild,\n    OnInit,\n    SimpleChanges,\n    OnChanges,\n} from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\nimport { MatSelect } from '@angular/material/select';\nimport { BaseClass, Identity, timeFormatString } from '@placeos/common';\nimport {\n    addMinutes,\n    endOfDay,\n    format,\n    isAfter,\n    isSameDay,\n    roundToNearestMinutes,\n    set,\n    startOfDay,\n    startOfMinute,\n} from 'date-fns';\n\n@Component({\n    selector: 'a-time-field',\n    template: `\n        <div\n            class=\"relative flex items-center w-full rounded border border-gray-200 hover:border-black px-2 py-1 mt-1\"\n            role=\"button\"\n            [style.display]=\"show_select ? 'none' : ''\"\n            [attr.disabled]=\"disabled\"\n            form-field\n            tabindex=\"0\"\n            (keydown.enter)=\"showSelect()\"\n        >\n            <input\n                matInput\n                type=\"time\"\n                class=\"flex-1 w-1/2\"\n                [disabled]=\"disabled\"\n                [ngModel]=\"time\"\n                (ngModelChange)=\"setValue($event)\"\n            />\n            <app-icon class=\"text-3xl\" matRipple (click)=\"showSelect()\">{{\n                show_select ? 'arrow_drop_up' : 'arrow_drop_down'\n            }}</app-icon>\n        </div>\n        <mat-form-field appearance=\"outline\" *ngIf=\"show_select\">\n            <mat-select\n                #select\n                [value]=\"time\"\n                [disabled]=\"disabled\"\n                (valueChange)=\"setValue($event)\"\n            >\n                <mat-option\n                    *ngFor=\"let option of time_options\"\n                    [value]=\"option.id\"\n                >\n                    {{ option.name }}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n    `,\n    styles: [\n        `\n            :host {\n                margin-bottom: 1em;\n                height: 2.75em;\n                width: 100%;\n            }\n\n            :host > div {\n                width: 100%;\n                height: 2.75em;\n                box-shadow: inset 0 0 0 1px #fff;\n                transition: border 200ms, box-shadow 200ms;\n            }\n\n            :host > div:hover {\n                box-shadow: inset 0 0 0 1px #464646;\n                border-color: #464646;\n            }\n\n            :host > div:focus {\n                box-shadow: inset 0 0 0 1px var(--primary);\n                border-color: var(--primary);\n                outline-color: var(--primary);\n            }\n\n            :host > div[disabled='true'] {\n                pointer-events: none;\n                border-color: #f0f0f0;\n                color: #ccc;\n            }\n\n            mat-form-field {\n                margin-top: -0.25em;\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => TimeFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class TimeFieldComponent\n    extends BaseClass\n    implements OnInit, OnChanges, ControlValueAccessor {\n    /** Time step between each allowed time option */\n    @Input() public step = 15;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Whether past times are allowed */\n    @Input() public no_past_times = true;\n    /** String representing the currently set time */\n    public date: number = new Date().valueOf();\n    /** String representing the currently set time */\n    public time: string = format(new Date(), 'HH:mm');\n    /** Available time blocks for the selected date */\n    public _time_options: Identity[];\n    /** Whether select field should be shown */\n    public show_select: boolean;\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /** Select field for selecting the time */\n    @ViewChild('select') private select_field: MatSelect;\n\n    public ngOnInit(): void {\n        this.show_select = true;\n        this._time_options = this.generateAvailableTimes(\n            this.date,\n            !this.no_past_times,\n            this.step\n        );\n        this.timeout('hide', () => (this.show_select = false));\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.no_past_times || changes.step) {\n            this._time_options = this.generateAvailableTimes(\n                this.date,\n                !this.no_past_times,\n                this.step\n            );\n        }\n    }\n\n    /** Available time blocks for the selected date */\n    public get time_options() {\n        const time = (this.time || '00:00').split(':');\n        const date = set(this.date, { hours: +time[0], minutes: +time[1] });\n        if (\n            date.getMinutes() % 15 !== 0 &&\n            !this._time_options.find(\n                (time) => time.id === format(date, 'HH:mm')\n            )\n        ) {\n            this._time_options.push({\n                name: `${format(date, timeFormatString())}`,\n                id: format(date, 'HH:mm'),\n            });\n            this._time_options.sort((a, b) =>\n                `${a.id}`.localeCompare(`${b.id}`)\n            );\n        }\n        return this._time_options;\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: string): void {\n        console.log('Set Value:', new_value);\n        this.time = new_value;\n        if (this._onChange) {\n            const time = (this.time || '00:00').split(':');\n            const date = startOfMinute(\n                set(this.date, { hours: +time[0], minutes: +time[1] })\n            );\n            this._onChange(date.valueOf());\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.date = value;\n        let date = startOfMinute(this.date);\n        date = roundToNearestMinutes(date, { nearestTo: 5 });\n        this.time = format(date, 'HH:mm');\n        this._time_options = this.generateAvailableTimes(\n            this.date,\n            !this.no_past_times,\n            this.step\n        );\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    /**\n     * Show select field for time options\n     */\n    public showSelect() {\n        this.show_select = true;\n        this.timeout('on_shown', () => {\n            if (this.select_field) {\n                this.select_field.focus();\n                this.select_field.open();\n                this.subscription(\n                    'listen_close',\n                    this.select_field.openedChange.subscribe((state) => {\n                        if (!state) {\n                            this.show_select = false;\n                        }\n                    })\n                );\n            }\n        });\n    }\n\n    /**\n     * Generate a list of time options for the given date\n     * @param datestamp Date to generate options for\n     * @param show_past Whether past times should be options\n     */\n    private generateAvailableTimes(\n        datestamp: number,\n        show_past: boolean,\n        step: number = 15\n    ): Identity[] {\n        const now = new Date();\n        let date = new Date(datestamp);\n        const blocks = [];\n        if (show_past || (!isSameDay(date, now) && isAfter(date, now))) {\n            date = startOfDay(date);\n        } else if (isAfter(date, now)) {\n            date = now;\n        }\n        date = roundToNearestMinutes(date, { nearestTo: step });\n        const end = endOfDay(date);\n        // Add options for the rest of the day\n        while (isAfter(end, date)) {\n            blocks.push({\n                name: `${format(date, timeFormatString())}`,\n                id: format(date, 'HH:mm'),\n            });\n            date = addMinutes(date, step);\n        }\n        return blocks;\n    }\n}\n","import { Component, OnInit, forwardRef, Input, OnChanges, SimpleChanges } from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\nimport { Identity } from '@placeos/common';\nimport { formatDuration } from 'date-fns';\n\nimport * as dayjs from 'dayjs';\n\n@Component({\n    selector: 'a-duration-field',\n    template: `\n        <div class=\"duration-field\" [attr.disabled]=\"disabled\">\n            <mat-form-field appearance=\"outline\">\n                <mat-select\n                    #select\n                    [value]=\"duration\"\n                    [disabled]=\"disabled\"\n                    (valueChange)=\"setValue($event)\"\n                >\n                    <mat-option *ngFor=\"let option of duration_options\" [value]=\"option.id\">\n                        {{ option.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DurationFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DurationFieldComponent implements OnInit, OnChanges, ControlValueAccessor {\n    /** Maximum duration option available */\n    @Input() public max: number = 240;\n    /** Minimum duration option available */\n    @Input() public min: number = 30;\n    /** Step value between options */\n    @Input() public step: number = 15;\n    /** Reference time for displaying next to durations */\n    @Input() public time: number;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Special case prepopulation i.e. out of step options */\n    @Input() public specialPreprops: Array<number> = [];\n\n    public duration: number = 60;\n    /** List of available duration options */\n    public duration_options: Identity[];\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    public ngOnInit(): void {\n        this.duration_options = this.generateDurationOptions(this.max, this.min, this.step);\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        /* istanbul ignore else */\n        if (changes.max || changes.min || changes.step || changes.time) {\n            this.duration_options = this.generateDurationOptions(this.max, this.min, this.step);\n        }\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number): void {\n        this.duration = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(+new_value);\n        }\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.duration = value;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    private generateDurationOptions(max: number, min: number, step: number): Identity[] {\n        const blocks: Identity[] = [];\n        let time = min;\n        let date = this.time ? dayjs(this.time) : null;\n\n        // Add special case for 10min duration/prepropulation\n        for (const option of this.specialPreprops) {\n            blocks.push({\n                id: option,\n                name: date\n                    ? `${date.add(option, 'm').format('h:mm A')} (${formatDuration({\n                          hours: Math.floor(option / 60),\n                          minutes: option % 60,\n                      })})`\n                    : `${formatDuration({ hours: Math.floor(option / 60), minutes: option % 60 })}`,\n            });\n        }\n\n        while (time <= max) {\n            blocks.push({\n                id: time,\n                name: date\n                    ? `${date.add(time, 'm').format('h:mm A')} (${formatDuration({\n                          hours: Math.floor(time / 60),\n                          minutes: time % 60,\n                      })})`\n                    : `${formatDuration({ hours: Math.floor(time / 60), minutes: time % 60 })}`,\n            });\n            time += step;\n        }\n        return blocks;\n    }\n}\n","import { Component, OnInit, EventEmitter, Output, Inject } from '@angular/core';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialog } from '@angular/material/dialog';\n\nimport { CalendarEvent } from '@placeos/events';\nimport { DialogEvent, HashMap, BaseClass } from '@placeos/common';\nimport { Space } from '@placeos/spaces';\n\nexport interface BookingModalData extends HashMap {\n    title?: string;\n    space?: Space;\n    date?: number;\n    min_duration?: number;\n    max_duration?: number;\n}\n\nexport function openBookingModal(data: BookingModalData, dialog: MatDialog) {\n    dialog.open(BookingModalComponent, {\n        data,\n    });\n}\n\n@Component({\n    selector: 'booking-modal',\n    template: `\n        <header class=\"bg-primary p-4\">\n            <h3>New Booking</h3>\n        </header>\n        <form\n            *ngIf=\"form && !loading; else load_state\"\n            [formGroup]=\"form\"\n            class=\"p-2\"\n        >\n            <div class=\"field\" *ngIf=\"form.controls.organiser\">\n                <label for=\"host\">Host<span>*</span>:</label>\n                <a-user-search-field\n                    name=\"host\"\n                    formControlName=\"organiser\"\n                ></a-user-search-field>\n            </div>\n            <div class=\"flex space-x-2\">\n                <div class=\"flex-1\" *ngIf=\"form.controls.date\">\n                    <label for=\"start-time\">Start Time:</label>\n                    <a-time-field\n                        name=\"start-time\"\n                        formControlName=\"date\"\n                    ></a-time-field>\n                </div>\n                <div class=\"flex-1\" *ngIf=\"form.controls.duration\">\n                    <label for=\"duration\">Duration:</label>\n                    <a-duration-field\n                        name=\"duration\"\n                        formControlName=\"duration\"\n                    ></a-duration-field>\n                </div>\n            </div>\n            <div class=\"flex flex-col\" *ngIf=\"form.controls.title\">\n                <label for=\"host\">Title<span>*</span>:</label>\n                <mat-form-field appearance=\"outline\" class=\"w-full\">\n                    <input\n                        matInput\n                        name=\"title\"\n                        placeholder=\"Meeting Title\"\n                        formControlName=\"title\"\n                    />\n                    <mat-error>Title is required</mat-error>\n                </mat-form-field>\n            </div>\n        </form>\n        <footer *ngIf=\"!loading\" class=\"flex items-center justify-center p-2 w-full border-t border-gray-200 space-x-2\">\n            <button mat-button name=\"close\" class=\"inverse w-32\" mat-dialog-close>\n                Cancel\n            </button>\n            <button mat-button name=\"save\" class=\"w-32\" (click)=\"save()\">Save</button>\n        </footer>\n        <ng-template #load_state>\n            <div class=\"flex flex-col items-center p-8\">\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>Processing request...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            form {\n                width: 32rem;\n                max-width: calc(100vw - 2rem);\n            }\n        `,\n    ],\n    animations: [],\n})\nexport class BookingModalComponent extends BaseClass implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Whether modal is closing */\n    public closing: boolean;\n    /** Whether the modal is processing a booking request */\n    public loading: boolean;\n    /** Form */\n    public form: FormGroup;\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: BookingModalData) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.form = new FormGroup({\n            // organiser: new FormControl(null, [Validators.required]),\n            room_ids: new FormControl([this._data.space.email]),\n            date: new FormControl(this._data.date || new Date().valueOf()),\n            duration: new FormControl(30),\n            title: new FormControl(this._data.title || '', [\n                Validators.required,\n            ]),\n        });\n    }\n\n    /**\n     * Post form data\n     */\n    public save() {\n        this.form.markAllAsTouched();\n        if (this.form.valid) {\n            this.loading = true;\n            this.event.emit({\n                reason: 'done',\n                metadata: new CalendarEvent({ ...this.form.value }),\n            });\n        } else {\n            console.log('Invalid form fields. Valid states:', this.form);\n        }\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { listen, getModule } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest, interval, Observable } from 'rxjs';\nimport { map, first } from 'rxjs/operators';\n\nimport { CalendarEvent,  } from '@placeos/events';\nimport { SpacesService } from '@placeos/spaces';\nimport { BaseClass, notifyError, timePeriodsIntersect } from '@placeos/common';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA,\n} from '@placeos/components';\n\nimport { SpaceStatus } from './booking-actions/booking-actions.component';\nimport { openBookingModal } from '../overlays/booking-modal.component';\n\nexport interface PanelSettings {\n    /** Whether booking has a pending state */\n    pending?: boolean;\n    /** Unix epoch in ms of last activated booking */\n    last_active?: number;\n    /** Default title for Ad-hoc bookings */\n    default_title?: string;\n    /** Minimum duration for a booking */\n    min_duration?: number;\n    /** Maximum duration for a booking */\n    max_duration?: number;\n    /** Duration in seconds after the start with which to cancel pending bookings */\n    cancel_timeout?: number;\n}\n\nexport function currentBooking(list: CalendarEvent[], date: number = new Date().valueOf()) {\n    return list.find((bkn) =>\n        timePeriodsIntersect(date, date, bkn.date, bkn.date + bkn.duration * 1000)\n    );\n}\n\n@Injectable()\nexport class PanelStateService extends BaseClass {\n    /** Polling observable */\n    private _poll = interval(1000);\n    /** List of current bookings for active system */\n    private _bookings = new BehaviorSubject<CalendarEvent[]>([]);\n    /** List of current bookings for active system */\n    private _settings = new BehaviorSubject<PanelSettings>({});\n    /** Active system */\n    private _system = new BehaviorSubject<string>('');\n    /** List of current bookings for active system */\n    public readonly bookings = this._bookings.asObservable();\n    /** List of current bookings for active system */\n    public readonly space = this._system.pipe(map((id) => this._spaces.find(id)));\n    /** List of current bookings */\n    public get booking_list() {\n        return this._bookings.getValue();\n    }\n    /** Active system */\n    public get system() {\n        return this._system.getValue();\n    }\n    public set system(value: string) {\n        this._system.next(value);\n    }\n    /** Currently active booking */\n    public readonly current: Observable<CalendarEvent> = combineLatest(\n        this._poll,\n        this._bookings\n    ).pipe(map((details) => currentBooking(details[1])));\n    /** Upcoming booking */\n    public readonly next: Observable<CalendarEvent> = combineLatest(\n        this._poll,\n        this._bookings\n    ).pipe(\n        map((details) => {\n            const date = new Date().valueOf();\n            return details[1].find((bkn) => bkn.date > date);\n        })\n    );\n\n    public readonly status: Observable<SpaceStatus> = combineLatest(\n        this.current,\n        this.next,\n        this._settings\n    ).pipe(\n        map((pair) => {\n            const [current, next, settings] = pair;\n            const booking: CalendarEvent = current || next;\n            const is_active = settings.last_active > booking?.date;\n            switch (booking.state) {\n                case 'future':\n                    return 'available';\n                case 'upcoming':\n                    return settings.pending && !is_active ? 'pending' : 'available';\n                case 'started':\n                    return settings.pending && !is_active ? 'pending' : 'unavailable';\n                case 'in_progress':\n                    return settings.pending && !is_active ? 'pending' : 'unavailable';\n            }\n            return 'available';\n        })\n    );\n\n    constructor(private _spaces: SpacesService, private _dialog: MatDialog) {\n        super();\n        this._system.subscribe((id) =>\n            this.subscription(\n                'bookings',\n                listen({ sys: id, mod: 'Bookings', index: 1, name: 'today' }).subscribe((list) => {\n                    list = (list || []).map((i) => new CalendarEvent(i));\n                    list.sort((a, b) => (a.date = b.date));\n                    this._bookings.next(list);\n                })\n            )\n        );\n    }\n\n    /**\n     * Open modal to create new booking\n     * @param date Start time of the new booking\n     */\n    public newBooking(date: number = new Date().valueOf()) {\n        openBookingModal(\n            {\n                ...this._settings.getValue(),\n                space: this._spaces.find(this.system),\n                date,\n            },\n            this._dialog\n        );\n    }\n\n    /**\n     * Open confirmation modal for starting the meeting\n     */\n    public confirmStart() {\n        const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n            ConfirmModalComponent,\n            {\n                ...CONFIRM_METADATA,\n                data: {\n                    title: 'Do you wish to start your meeting?',\n                    content: `If you don't start your meeting it will be cancelled ${\n                        this._settings.getValue().cancel_timeout / 60\n                    } minutes after the start time.`,\n                    icon: { class: 'material-icons', content: 'play_arrow' },\n                },\n            }\n        );\n        ref.componentInstance.event\n            .pipe(first((_) => _.reason === 'done'))\n            .subscribe(() => this.startMeeting());\n    }\n\n    /**\n     * Execute the logic on the engine driver to start the current or upcoming meeting\n     */\n    public async startMeeting() {\n        if (this.space && (await this.status.toPromise()) === 'pending') {\n            const meeting = (await this.current.toPromise()) || (await this.next.toPromise());\n            const module = getModule(this.system, 'Bookings');\n            if (meeting && module) {\n                const date = new Date(meeting.date);\n                module.execute('start_meeting', [meeting.date]).then(\n                    (_) => {\n                        // this.service.Analytics.event('Checkin', 'checked-in', `${this.space.id} at ${date.format('DD MMM YYYY, h:mm A Z')}`);\n                    },\n                    (e) => {\n                        notifyError(`Error starting meeting. ${e}`);\n                        // this.service.Analytics.event('Checkin', 'checked-in-failed', `${this.space.id} at ${date.format('DD MMM YYYY, h:mm A Z')}`);\n                    }\n                );\n            }\n        }\n    }\n\n    /**\n     * Open confirmation modal for ending the meeting\n     */\n    public confirmEnd() {\n        const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n            ConfirmModalComponent,\n            {\n                ...CONFIRM_METADATA,\n                data: {\n                    title: 'Are you sure want to end your meeting?',\n                    content: 'Ending your meeting early will free up this room for others to use',\n                    icon: { class: 'material-icons', content: 'stop' },\n                },\n            }\n        );\n        ref.componentInstance.event\n            .pipe(first((_) => _.reason === 'done'))\n            .subscribe(() => this.endCurrent());\n    }\n\n    /**\n     * End the current meeting\n     * @param reason Reason for ending the meeting early\n     */\n    public endCurrent(reason: string = 'user_input') {\n        const now = new Date().valueOf();\n        const current = this.booking_list.find((bkn) =>\n            timePeriodsIntersect(now, now, bkn.date, bkn.date + bkn.duration * 1000)\n        );\n        const module = getModule(this.system, 'Bookings');\n        if (current && module) {\n            const date = new Date(current.date);\n            module.execute('cancel_meeting', [current.date, reason]).then(\n                (_) => {},\n                (e) => notifyError(`Error starting meeting. ${e}`)\n            );\n        }\n    }\n}\n","<div class=\"space-booking-details\">\n    <div class=\"details current\" *ngIf=\"current | async\">\n        <div class=\"time\" *ngIf=\"!hide_availability\">\n            Booked until {{ (current | async)?.display.end }}\n        </div>\n        <div class=\"title\" *ngIf=\"!hide_title && !hide_details\">{{ (current | async)?.title }}</div>\n        <div class=\"host\" *ngIf=\"!hide_user && !hide_details\">\n            {{ (current | async)?.organiser?.name }}\n        </div>\n    </div>\n    <div class=\"details next\" *ngIf=\"next | async\">\n        <div class=\"time\" *ngIf=\"!hide_availability\">\n            Next meeting at {{ (next | async).display.time }}\n        </div>\n        <div class=\"title\" *ngIf=\"!hide_title && !hide_details\">{{ (next | async).title }}</div>\n        <div class=\"host\" *ngIf=\"!hide_user && !hide_details\">\n            {{ (next | async).organiser?.name }}\n        </div>\n    </div>\n    <div class=\"details other\" *ngIf=\"(current | async) && (next | async)\">\n        <div class=\"time\" *ngIf=\"!hide_availability\">\n            Free {{ (next_free | async).start ? 'at ' + (next_free | async).start : '' }}\n            {{ (next_free | async).end ? 'until ' + (next_free | async).end : '' }}\n        </div>\n    </div>\n    <div class=\"information\" *ngIf=\"title || description\">\n        <div class=\"title\">{{ title }}</div>\n        <div class=\"block\">\n            <div class=\"icon\" *ngIf=\"icon\">\n                <img [src]=\"icon\" />\n            </div>\n            <div class=\"text\">{{ description }}</div>\n        </div>\n    </div>\n    <div class=\"bindings\" *ngIf=\"system_id\">\n        <i\n            binding\n            [sys]=\"system_id\"\n            mod=\"Bookings\"\n            bind=\"hide_details\"\n            [(model)]=\"hide_details\"\n        ></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"hide_title\" [(model)]=\"hide_title\"></i>\n        <i\n            binding\n            [sys]=\"system_id\"\n            mod=\"Bookings\"\n            bind=\"hide_availability\"\n            [(model)]=\"hide_availability\"\n        ></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"hide_user\" [(model)]=\"hide_user\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"title\" [(model)]=\"title\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"description\" [(model)]=\"description\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"icon\" [(model)]=\"icon\"></i>\n    </div>\n</div>\n","import { Component } from '@angular/core';\nimport { map } from 'rxjs/operators';\nimport { isSameDay, isAfter, format } from 'date-fns';\n\nimport { PanelStateService } from '../panel-state.service';\nimport { getNextFreeBookingSlot } from '@placeos/events';\n\n@Component({\n    selector: 'panel-space-details',\n    templateUrl: './space-details.component.html',\n    styleUrls: ['./space-details.component.scss'],\n})\nexport class PanelSpaceDetailsComponent {\n    /** Secondary title for the space */\n    public title: string;\n    /** Description for the space */\n    public description: string;\n    /** Image that suppliments the description for the space */\n    public icon: { class?: string; value?: string; src?: string };\n\n    /** Whether to hide the booking timing details */\n    public hide_availability: boolean;\n    /** Whether to hide the current booking title */\n    public hide_title: boolean;\n    /** Whether to hide booking details(title and host) */\n    public hide_details: boolean;\n    /** Whether to hide booking host */\n    public hide_user: boolean;\n    /** Observable for the upcoming booking */\n    public readonly next = this._state.next;\n    /** Observable for the current booking */\n    public readonly current = this._state.current;\n\n    public get system_id() {\n        return this._state.system;\n    }\n\n    public readonly next_free = this._state.bookings.pipe(\n        map((list) => {\n            const block = getNextFreeBookingSlot(list, undefined, 15);\n            const now = new Date();\n            const start = new Date(block.start);\n            const end = new Date(block.end);\n            return {\n                start: isSameDay(now, start) && isAfter(start, now) ? format(start, 'h:mm a') : '',\n                end: isSameDay(now, end) && isAfter(end, now) ? format(end, 'h:mm a') : '',\n            };\n        })\n    );\n\n    constructor(private _state: PanelStateService) {}\n}\n","<div class=\"booking-actions\" *ngIf=\"system_id\">\n    <div class=\"actions\">\n        <button\n            mat-icon-button\n            class=\"end large action\"\n            *ngIf=\"status === 'endable'\"\n            (click)=\"confirmEnd()\"\n            (contextmenu)=\"$event.preventDefault()\"\n        >\n            <div class=\"wrapper\">\n                <app-icon [icon]=\"{ class: 'material-icons', content: 'event_busy' }\"></app-icon>\n                <div class=\"text\">End</div>\n            </div>\n        </button>\n        <button\n            mat-icon-button\n            class=\"start large action\"\n            *ngIf=\"status === 'pending'\"\n            (click)=\"startMeeting()\"\n            (contextmenu)=\"$event.preventDefault()\"\n        >\n            <div class=\"wrapper\">\n                <app-icon [icon]=\"{ class: 'material-icons', content: 'event_available' }\"></app-icon>\n                <div class=\"text\">Start</div>\n            </div>\n        </button>\n        <button\n            mat-icon-button\n            class=\"book large action\"\n            *ngIf=\"!no_booking\"\n            (click)=\"book()\"\n            (contextmenu)=\"$event.preventDefault()\"\n        >\n            <div class=\"wrapper\">\n                <app-icon [icon]=\"{ class: 'material-icons', content: 'add' }\"></app-icon>\n                <div class=\"text\">Book</div>\n            </div>\n        </button>\n    </div>\n    <div class=\"bindings\">\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"booking_disabled\" [(model)]=\"no_booking\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"last_meeting_started\" [(model)]=\"last_started\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"is_endable\" [(model)]=\"is_endable\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"timeout\" [(model)]=\"pending_timeout\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"cancel_timeout\" [(model)]=\"cancel_timeout\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"ask_start\" [(model)]=\"ask_start\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"ask_end\" [(model)]=\"ask_end\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"default_title\" [(model)]=\"default_title\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"min_duration\" [(model)]=\"min_duration\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"max_duration\" [(model)]=\"max_duration\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"business_start\" [(model)]=\"business_start\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"business_end\" [(model)]=\"business_end\"></i>\n    </div>\n</div>\n","import { Component, Input } from '@angular/core';\n\nimport { BaseClass } from '@placeos/common';\nimport { PanelStateService } from '../panel-state.service';\n\nexport type SpaceStatus = 'pending' | 'available' | 'unavailable' | 'endable';\n\n@Component({\n    selector: 'panel-booking-actions',\n    templateUrl: './booking-actions.component.html',\n    styleUrls: ['./booking-actions.component.scss'],\n})\nexport class PanelBookingActionsComponent extends BaseClass {\n    /** Whether booking is allowed */\n    public no_booking: boolean = false;\n    /** Whether the current booking is able to be ended */\n    public is_endable: number;\n    /** Number of seconds before a meeting can be started, being truthy enables start/stop and auto-cancellations */\n    public pending_timeout: number;\n    /** Number of seconds after the start of a meeting when it is auto-cancelled, overrides `timeout` value */\n    public cancel_timeout: number;\n    /** Timestamp of the last started meeting as ms since UTC epoch */\n    public last_started: number;\n    /** Whether to ask user to start the meeting */\n    public ask_start: boolean;\n    /** Whether to ask user to end the meeting */\n    public ask_end: boolean;\n    /** Time of the last automatic confirmation of start or end */\n    public last_confirm: number = 0;\n    /** Default title for bookings */\n    public default_title: string;\n    /** Maximum allowed booking duation */\n    public max_duration: number;\n    /** Minimum allowed booking duation */\n    public min_duration: number;\n    /** Start time of the business day with format `HH:mm` */\n    public business_start: string;\n    /** End time of the business day with format `HH:mm` */\n    public business_end: string;\n    /** Open booking modal */\n    public readonly book = () => this._state.newBooking();\n    /** Open confirmation modal for ending meeting */\n    public readonly confirmEnd = () => this._state.confirmEnd();\n    /** End the current meeting */\n    public readonly endMeeting = (r?) => this._state.endCurrent(r);\n    /** Open confirmation modal for starting meeting */\n    public readonly confirmStart = () => this._state.confirmStart();\n    /** Start the current/upcoming meeting */\n    public readonly startMeeting = () => this._state.startMeeting();\n\n    public get system_id() {\n        return this._state.system;\n    }\n\n    constructor(private _state: PanelStateService) {\n        super();\n    }\n}\n","import { Component, OnInit, Inject } from '@angular/core';\nimport { animate, style, transition, trigger } from '@angular/animations';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { BaseClass } from '@placeos/common';\n\nexport interface EmbeddedControlModalData {\n    control_url: string;\n}\n\n@Component({\n    selector: 'embedded-control-modal',\n    template: `\n        <div class=\"absolute inset-0 bg-white\"></div>\n        <div\n            class=\"absolute w-screen overflow-hidden bg-primary\"\n            modal\n            [@show]\n            (window:click)=\"reset()\"\n        >\n            <div class=\"h-full w-full border-none\">\n                <iframe\n                    class=\"h-full w-full border-none\"\n                    [src]=\"control_url | safe: 'resource'\"\n                ></iframe>\n            </div>\n        </div>\n        <div class=\"absolute top-0 left-0 flex items-center h-12\">\n            <div class=\"text-2xl mx-2\">{{ countdown }}</div>\n            <button\n                mat-icon-button\n                class=\"close\"\n                (click)=\"close()\"\n                (contextmenu)=\"$event.preventDefault()\"\n            >\n                <app-icon class=\"text-2xl mx-2\">close</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            [modal] {\n                height: calc(100vh - 3em);\n                box-sizing: content-box;\n                border: 2px solid #fff;\n                border-top: 1px solid #ccc;\n                transform: translate(-50%, calc(-50% + 1.75em));\n            }\n\n            .overlay {\n                position: absolute;\n                top: 0;\n                right: 0;\n                display: flex;\n                align-items: center;\n                height: 3em;\n            }\n        `,\n    ],\n    animations: [\n        trigger('show', [\n            transition(':enter', [\n                style({ opacity: 0 }),\n                animate(500, style({ opacity: 1 })),\n            ]),\n            transition(':leave', [\n                style({ opacity: 1 }),\n                animate(1000, style({ opacity: 0 })),\n            ]),\n        ]),\n    ],\n})\nexport class EmbeddedControlModalComponent extends BaseClass implements OnInit {\n    /** Control URL to embed into the modal */\n    public readonly control_url: string = this._data.control_url;\n    /** Display value for the time remain until the modal automatically closes */\n    public countdown: number;\n\n    constructor(\n        private _dialog_ref: MatDialogRef<EmbeddedControlModalComponent>,\n        @Inject(MAT_DIALOG_DATA) private _data: EmbeddedControlModalData\n    ) {\n        super();\n        this.countdown = 30;\n    }\n\n    public ngOnInit(): void {\n        this.countdown = 30;\n        this.interval('countdown', () => this.tick(), 1000);\n    }\n\n    /**\n     * Close the modal\n     */\n    public close() {\n        this._dialog_ref.close();\n        this.countdown = 30;\n    }\n\n    /**\n     * User confirmation of the content of the modal\n     */\n    public reset() {\n        this.countdown = 30;\n        this.interval('countdown', () => this.tick(), 1000);\n    }\n\n    /**\n     * Decrement countdown and close if 0\n     */\n    public tick() {\n        if (this.countdown <= 0) {\n            this.close();\n        }\n        this.countdown--;\n    }\n}\n","<div class=\"custom-actions\" *ngIf=\"system_id\">\n    <div class=\"actions\">\n        <button\n            mat-icon-button\n            class=\"action control\"\n            *ngIf=\"can_control !== false && control_url\"\n            (click)=\"openControl()\"\n            (contextmenu)=\"$event.preventDefault()\"\n        >\n            <app-icon [icon]=\"{ class: 'material-icons', content: 'dvr' }\"></app-icon>\n        </button>\n        <button\n            mat-icon-button\n            class=\"action service\"\n            *ngIf=\"catering\"\n            (click)=\"confirmWaiterCall()\"\n            (contextmenu)=\"$event.preventDefault()\"\n        >\n            <app-icon [icon]=\"{ class: 'material-icons', content: 'room_service' }\"></app-icon>\n        </button>\n    </div>\n    <div class=\"bindings\">\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"control_url\" [(model)]=\"control_url\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"can_control\" [(model)]=\"can_control\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"has_catering\" [(model)]=\"catering\"></i>\n    </div>\n</div>\n","import { Component } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { getModule } from '@placeos/ts-client';\nimport { first } from 'rxjs/operators';\n\nimport { notifyError } from '@placeos/common';\nimport {\n    ConfirmModalComponent,\n    CONFIRM_METADATA,\n    ConfirmModalData,\n} from '@placeos/components';\nimport { EmbeddedControlModalComponent } from '../../overlays/embedded-control-modal.component';\nimport { PanelStateService } from '../panel-state.service';\n\n@Component({\n    selector: 'panel-custom-actions',\n    templateUrl: './custom-actions.component.html',\n    styleUrls: ['./custom-actions.component.scss'],\n})\nexport class PanelCustomActionsComponent {\n    /** Control URL of the active space */\n    public control_url: string;\n    /** Whether the user is able to open the control URL */\n    public can_control: boolean;\n    /** Whether space has catering */\n    public catering: boolean;\n\n    public get system_id() {\n        return this._state.system;\n    }\n\n    constructor(private _dialog: MatDialog, private _state: PanelStateService) {}\n\n    /**\n     * Open confirmation modal for ending the meeting\n     */\n    public confirmWaiterCall() {\n        const ref = this._dialog.open<ConfirmModalComponent, ConfirmModalData>(\n            ConfirmModalComponent,\n            {\n                ...CONFIRM_METADATA,\n                data: {\n                    title: 'Call a waiter to your room?',\n                    content: 'Call a waiter to your room to order catering',\n                    icon: { class: 'material-icons', content: 'call' },\n                },\n            }\n        );\n        ref.componentInstance.event\n            .pipe(first((_) => _.reason === 'done'))\n            .subscribe(() => this.callWaiter());\n    }\n\n    /**\n     * Execute call waiter logic on engine driver\n     */\n    public callWaiter() {\n        if (this._state.system) {\n            const module = getModule(this._state.system, 'Bookings');\n            if (module) {\n                module.execute('waiter_call', []).then(\n                    (_) => {\n                        // this.service.Analytics.event('Catering', 'waiter-call', (new Date).toISOString());\n                    },\n                    (e) => {\n                        // this.service.Analytics.event('Catering', 'waiter-call-failed', (new Date).toISOString());\n                        notifyError(`Error calling waiter. ${e}`);\n                    }\n                );\n            }\n        }\n    }\n\n    /**\n     * Open modal to show embeded control URL\n     */\n    public openControl() {\n        // this.service.Analytics.event('Control', 'open-view', (new Date).toISOString());\n        this._dialog.open(EmbeddedControlModalComponent, {\n            data: {\n                control_url: this.control_url,\n            },\n        });\n    }\n}\n","<div class=\"timeline\">\n    <div class=\"block-list\" *ngIf=\"time_blocks && time_blocks.length > 0\">\n        <div\n            class=\"block\"\n            *ngFor=\"let item of time_blocks\"\n            [class.show]=\"item.show || item.hour\"\n            [class.in-use]=\"item.in_use\"\n            (click)=\"!item.in_use && !no_booking && !no_timeline_bookings ? book(item) : ''\"\n        >\n            <div class=\"hour\" *ngIf=\"item.hour\">{{ item.hour }}</div>\n            <div class=\"bar\" [class.hour]=\"item.hour\"></div>\n        </div>\n    </div>\n    <div class=\"overlay\">\n        <div class=\"expired\" [style.width]=\"((options?.start_offset || 120) / (options?.duration || 720)) * 100 + '%'\"></div>\n        <div class=\"current-block\" [style.left]=\"((options?.start_offset || 120) / (options?.duration || 720)) * 100 + '%'\">\n            <div class=\"bar\"></div>\n            <div class=\"triangle\"></div>\n            <div class=\"time-display\" *ngIf=\"display_time\">{{ display_time }}</div>\n        </div>\n    </div>\n    <div class=\"bindings\" *ngIf=\"space\">\n        <i binding [sys]=\"space.id\" mod=\"Bookings\" bind=\"hide_availability\" [(model)]=\"hide_status\" (modelChange)=\"checkBookings()\"></i>\n        <i binding [sys]=\"space.id\" mod=\"Bookings\" bind=\"hide_all\" [(model)]=\"hide_all\" (modelChange)=\"checkBookings()\"></i>\n        <i binding [sys]=\"space.id\" mod=\"Bookings\" bind=\"booking_disabled\" [(model)]=\"no_booking\"></i>\n        <i binding [sys]=\"space.id\" mod=\"Bookings\" bind=\"no_timeline_bookings\" [(model)]=\"no_timeline_bookings\"></i>\n        <i binding [sys]=\"space.id\" mod=\"Bookings\" bind=\"default_title\" [(model)]=\"default_title\"></i>\n        <i binding [sys]=\"space.id\" mod=\"Bookings\" bind=\"min_duration\" [(model)]=\"min_duration\"></i>\n        <i binding [sys]=\"space.id\" mod=\"Bookings\" bind=\"max_duration\" [(model)]=\"max_duration\"></i>\n    </div>\n</div>\n","import { Component, OnInit, Input, Output, EventEmitter, OnChanges } from '@angular/core';\nimport {\n    format,\n    startOfMinute,\n    roundToNearestMinutes,\n    addMinutes,\n    subMinutes,\n    isBefore,\n    getMinutes,\n    getHours,\n    isAfter,\n    isSameMinute,\n} from 'date-fns';\n\nimport { BaseClass } from '@placeos/common';\nimport { Space } from '@placeos/spaces';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { PanelStateService } from '../panel-state.service';\n\nexport interface IPanelTimelineOptions {\n    /** Length of time in minutes to display on the timeline after the current time */\n    duration: number;\n    /** Time offset in minutes which is displayed before the current time marker */\n    start_offset: number;\n    /** Size of shown blocks in minutes */\n    block_size: number;\n}\n\ninterface ITimelineBlock {\n    /** Block time as ms since UTC epoch */\n    value: number;\n    /** Whether to show block divider */\n    show: boolean;\n    /** Hour of the day represented by this time block */\n    hour: number;\n    /** Whether block is in use or not */\n    in_use: boolean;\n}\n\n@Component({\n    selector: 'panel-timeline',\n    templateUrl: './timeline.component.html',\n    styleUrls: ['./timeline.component.scss'],\n})\nexport class PanelTimelineComponent extends BaseClass implements OnInit, OnChanges {\n    /** Space with which to display bookings for */\n    @Input() public space: Space;\n    /** Display options for the timeline */\n    @Input() public options: IPanelTimelineOptions;\n    /** Emitter for user events on the timeline */\n    @Output() public event = new EventEmitter();\n\n    /** List of display time block  */\n    public time_blocks: ITimelineBlock[] = [];\n    /** Whether to hide unavailable blocks on the UI */\n    public hide_status: boolean;\n    /** Whether to hide all booking data */\n    public hide_all: boolean;\n    /** Whether user is not allowed to make bookings */\n    public no_booking: boolean;\n    /** Whether user is not allowed to make bookings using the timeline */\n    public no_timeline_bookings: boolean;\n    /** Default title for bookings */\n    public default_title: string;\n    /** Maximum allowed booking duation */\n    public max_duration: number;\n    /** Minimum allowed booking duation */\n    public min_duration: number;\n\n    /** Display string for the current time */\n    public get display_time(): string {\n        return format(new Date(), 'h:mm a');\n    }\n\n    constructor(private _state: PanelStateService) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.generateTimelineBlocks();\n        this.interval('update_blocks', () => this.generateTimelineBlocks(), 60 * 1000);\n        this.subscription(\n            'bookings',\n            this._state.bookings.subscribe((list) => this.checkBookings(list))\n        );\n    }\n\n    public ngOnChanges(_): void {\n        this.generateTimelineBlocks();\n    }\n\n    /**\n     * Generate time blocks to display\n     */\n    private generateTimelineBlocks(): void {\n        let now = startOfMinute(new Date());\n        now = roundToNearestMinutes(addMinutes(now, 2), { nearestTo: 5 });\n        const start = subMinutes(now, (this.options ? this.options.start_offset : null) || 120);\n        const end = addMinutes(now, (this.options ? this.options.duration : null) || 720);\n        let date = new Date(start);\n        delete this.time_blocks;\n        this.time_blocks = [];\n        while (isBefore(date, end)) {\n            this.time_blocks.push({\n                value: date.valueOf(),\n                show:\n                    getMinutes(date) % ((this.options ? this.options.block_size : null) || 30) ===\n                    0,\n                hour:\n                    getMinutes(date) === 0\n                        ? getHours(date) % 12 === 0\n                            ? 12\n                            : getHours(date) % 12\n                        : null,\n                in_use: false,\n            });\n            date = addMinutes(date, 5);\n        }\n        this.checkBookings(this._state.booking_list);\n    }\n\n    /**\n     * Update the statuses of time blocks based off space bookings\n     */\n    public checkBookings(list: CalendarEvent[]): void {\n        if (list && list.length) {\n            const block_start = subMinutes(\n                new Date(),\n                (this.options ? this.options.start_offset : null) || 120\n            );\n            const block_end = addMinutes(\n                new Date(),\n                (this.options ? this.options.duration : null) || 720\n            );\n            // Filter bookings for the shown times\n            const bookings = list.filter((i) => {\n                const start = new Date(i.date);\n                const end = addMinutes(start, i.duration);\n                return isAfter(end, block_start) && isBefore(start, block_end);\n            });\n            this.time_blocks.forEach((i) => (i.in_use = false));\n            if (!this.hide_status && !this.hide_all) {\n                for (const booking of bookings) {\n                    const start = new Date(booking.date);\n                    const end = addMinutes(start, booking.duration);\n                    for (const block of this.time_blocks) {\n                        const block_time = new Date(block.value);\n                        if (\n                            isSameMinute(block_time, start) ||\n                            (isAfter(block_time, start) && isBefore(block_time, end))\n                        ) {\n                            block.in_use = true;\n                        }\n                    }\n                }\n            }\n        }\n    }\n\n    /**\n     * Open modal to make a new booking\n     */\n    public book(block: ITimelineBlock) {\n        this._state.newBooking(block.value);\n    }\n}\n","<div class=\"booking-panel\" [class.disabled]=\"interactive === false\" [class.reverse]=\"reverse || flip_status\" [class.no-time]=\"!show_time\">\n    <div [class]=\"'status' + (status && !hide_all ? ' ' + status : '')\">\n        <div class=\"time-display\" *ngIf=\"show_time\">{{ display_time }}</div>\n    </div>\n    <div class=\"body\">\n        <div class=\"details-display\">\n            <div class=\"content\">\n                <div class=\"title\" (click)=\"showTitle()\" [class.show]=\"show_title\">{{ space_name }}</div>\n                <div [class]=\"'status-text' + (status && !hide_all ? ' ' + status : '')\" *ngIf=\"!hide_status\">\n                    {{ (!hide_all ? status_display : null) || 'Not Bookable' }}\n                </div>\n                <div class=\"details\" *ngIf=\"!hide_all && show_details\">\n                    <panel-space-details></panel-space-details>\n                </div>\n            </div>\n            <div class=\"overlay\" *ngIf=\"!hide_all && show_details\">\n                <panel-booking-actions></panel-booking-actions>\n                <panel-custom-actions></panel-custom-actions>\n            </div>\n            <div class=\"dot\" *ngIf=\"!websocket_connected\"></div>\n        </div>\n        <div class=\"timeline\" *ngIf=\"show_details\">\n            <panel-timeline [space]=\"space\"></panel-timeline>\n        </div>\n    </div>\n    <div class=\"bindings\" *ngIf=\"system_id\">\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"room_name\" [(model)]=\"space_name\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"touch_enabled\" [(model)]=\"interactive\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"timeout\" [(model)]=\"pending_timeout\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"cancel_timeout\" [(model)]=\"cancel_timeout\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"last_meeting_started\" [(model)]=\"last_started\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"hide_all\" [(model)]=\"hide_all\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"flip_status\" [(model)]=\"flip_status\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"can_cancel\" [(model)]=\"can_cancel\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"business_start\" [(model)]=\"business_start\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"business_end\" [(model)]=\"business_end\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"hide_status\" [(model)]=\"hide_status\"></i>\n        <i binding [sys]=\"system_id\" mod=\"Bookings\" bind=\"status_override\" [(model)]=\"status_overrides\"></i>\n    </div>\n</div>\n","import { Component, OnInit, Input, SimpleChanges } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { status } from '@placeos/ts-client';\nimport { format } from 'date-fns';\n\nimport { BaseClass, HashMap, SettingsService } from '@placeos/common';\nimport { Space } from '@placeos/spaces';\n\nimport { PanelStateService } from './panel-state.service';\n\n@Component({\n    selector: 'app-booking-panel',\n    templateUrl: './panel.component.html',\n    styleUrls: ['./panel.component.scss'],\n    providers: [PanelStateService],\n})\nexport class BookingPanelComponent extends BaseClass implements OnInit {\n    /** ID of the active system */\n    @Input() public system_id: string;\n    /** Whether the status is on the right side */\n    @Input() public reverse: boolean;\n    /** Whether to show the time at the bottom of the status */\n    @Input() public show_time = true;\n    /** Name of the connected system */\n    public space_name: string;\n    /** Space with which to display bookings for */\n    public space: Space;\n    /** Number of seconds before a meeting can be started, being truthy enables start/stop and auto-cancellations */\n    public pending_timeout: number;\n    /** Number of seconds after the start of a meeting when it is auto-cancelled, overrides `timeout` value */\n    public cancel_timeout: number;\n    /** Timestamp of the last started meeting as ms since UTC epoch */\n    public last_started: number;\n    /** Whether to hide booking related details */\n    public hide_all: boolean;\n    /** Whether user interaction is enabled for the panel */\n    public interactive = true;\n    /** Whether status display is on the right side of the UI */\n    public flip_status: boolean;\n    /** Whether bookings can be cancelled if they timeout */\n    public can_cancel: boolean;\n    /** Time of the last cancelled meeting in ms since UTC epoch */\n    private last_cancel: number;\n    /** Start time of the business day with format `HH:mm` */\n    public business_start: string;\n    /** End time of the business day with format `HH:mm` */\n    public business_end: string;\n    /** Whether to show full room name when it overflows */\n    public show_title: boolean;\n    /** Whether to show the status display string */\n    public hide_status: boolean;\n    /** Override mapping for status values */\n    public status_overrides: HashMap<string>;\n    /** Status of websocket */\n    public websocket_connected: boolean;\n\n    public readonly status = this._state.status;\n\n    /** Whether booking details should be shown */\n    public get show_details(): boolean {\n        return this.websocket_connected || !!this._settings.get('show_status_when_disconnected');\n    }\n\n    /** Display string for the current time */\n    public get display_time(): string {\n        return format(new Date(), 'h:mm a');\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _route: ActivatedRoute,\n        private _state: PanelStateService\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'route.params',\n            this._route.paramMap.subscribe((params) => {\n                if (params.has('system_id')) {\n                    this.system_id = params.get('system_id');\n                    this._settings.post('system', this.system_id);\n                    this._state.system = this.system_id;\n                }\n            })\n        );\n        this.timeout('websocket', () => {\n            status().subscribe((status) => (this.websocket_connected = status));\n        });\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.system_id && this.system_id) {\n            this._state.system = this.system_id;\n        }\n    }\n\n    /**\n     * Show full room name if overflowing\n     */\n    public showTitle() {\n        this.show_title = true;\n        this.timeout('hide_title', () => (this.show_title = false), 3000);\n    }\n}\n","<div class=\"panel-array\">\n    <ng-container *ngIf=\"systems && systems.length > 0; else none\">\n        <div\n            class=\"panel-outlet\"\n            *ngFor=\"let id of systems | slice: 0:4; let i = index\"\n            [style.height]=\"systems.length >= 2 ? '50%' : '100%'\"\n        >\n            <app-booking-panel *ngIf=\"id; else empty_state\" [system_id]=\"id\" [show_time]=\"false\" [reverse]=\"i % 2 !== 0\"></app-booking-panel>\n        </div>\n    </ng-container>\n    <ng-template #none>\n        <div class=\"info-block\">\n            <div class=\"text\">No systems are set for displaying on the panel array</div>\n        </div>\n    </ng-template>\n</div>\n<ng-template #empty_state>\n    <div class=\"container\">\n        <div class=\"content center\">\n            <div class=\"logo\" *ngIf=\"logo\">\n                <img [src]=\"logo\"/>\n            </div>\n            <div class=\"time\">{{ time }}</div>\n        </div>\n    </div>\n</ng-template>\n\n","<div class=\"panel-select\" (window:mousedown)=\"reset()\" (window:touchstart)=\"reset()\">\n    <div class=\"panel-options\">\n        <ng-container *ngIf=\"systems && systems.length > 0; else none\">\n            <div class=\"item\" *ngFor=\"let id of systems | slice: 0:8; let i = index\" (click)=\"system_name[id] ? showPanel(id) : ''\">\n                <div class=\"bindings\" *ngIf=\"id\">\n                    <i binding [sys]=\"id\" mod=\"Bookings\" bind=\"room_name\" [(model)]=\"system_name[id]\"></i>\n                    <i binding [sys]=\"id\" mod=\"Bookings\" bind=\"icon\" [(model)]=\"system_icon[id]\"></i>\n                    <i binding [sys]=\"id\" mod=\"Bookings\" bind=\"today\" (modelChange)=\"updateStatus(id, $event)\"></i>\n                </div>\n                <div [class]=\"'icon' + (system_status[id] ? ' ' + system_status[id] : '')\">\n                    <img *ngIf=\"system_name[id]\" [src]=\"system_icon[id]\">\n                    <mat-spinner *ngIf=\"!system_name[id]\" [diameter]=\"32\"></mat-spinner>\n                </div>\n                <div class=\"text\">{{ system_name[id] || id + ' connecting...' }}</div>\n            </div>\n        </ng-container>\n    </div>\n    <div class=\"panel-outlet\" *ngIf=\"active_system\">\n        <app-booking-panel [system_id]=\"active_system\"></app-booking-panel>\n        <div class=\"overlay\">\n            <button widget class=\"action close\" (click)=\"close()\" (contextmenu)=\"$event.preventDefault()\">\n                <div class=\"icon\">\n                    <i class=\"material-icons\">close</i>\n                </div>\n            </button>\n            <button widget class=\"action countdown\" (contextmenu)=\"$event.preventDefault()\">{{ countdown }}</button>\n        </div>\n    </div>\n    <ng-template #none>\n        <div class=\"info-block\">\n            <div class=\"text\">No systems are set for displaying on the panel select list</div>\n        </div>\n    </ng-template>\n</div>\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { BootstrapComponent } from './bootstrap.component';\nimport { BookingPanelComponent } from './panel/panel.component';\nimport { BookingPanelArrayComponent } from './panel-array/panel-array.component';\nimport { BookingPanelSelectComponent } from './panel-select/panel-select.component';\n\nconst routes: Routes = [\n    { path: 'bootstrap', component: BootstrapComponent },\n    { path: 'panel/:system_id', component: BookingPanelComponent },\n    { path: 'panel-array', component: BookingPanelArrayComponent },\n    { path: 'panel-select', component: BookingPanelSelectComponent },\n    { path: '**', redirectTo: 'bootstrap' }\n];\n\n@NgModule({\n    imports: [RouterModule.forRoot(routes, { useHash: true })],\n    exports: [RouterModule]\n})\nexport class AppRoutingModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { delay, first } from 'rxjs/operators';\n\nimport { BaseClass, SettingsService } from '@placeos/common';\nimport { format } from 'date-fns';\n\n@Component({\n    selector: 'app-booking-panel-array',\n    templateUrl: './panel-array.component.html',\n    styleUrls: ['./panel-array.component.scss'],\n})\nexport class BookingPanelArrayComponent extends BaseClass implements OnInit {\n    /** List of systems to show panels for */\n    public systems: string[];\n    /** Application logo */\n    public logo: string;\n\n    /** Display value for the current time */\n    public get time(): string {\n        return format(new Date(), 'h:mm:ss a');\n    }\n\n    constructor(private route: ActivatedRoute, private _settings: SettingsService) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._settings.initialised\n            .pipe(\n                first((_) => _),\n                delay(1000)\n            )\n            .toPromise();\n        this.subscription(\n            'route.query',\n            this.route.queryParamMap.subscribe((params) => {\n                if (params.has('system_ids')) {\n                    this.systems = (params.get('system_ids') || '').split(',');\n                }\n            })\n        );\n        const logo = this._settings.get('app.logo');\n        this.logo = (logo ? logo.inverse : null) || '';\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\n\nimport { BaseClass, HashMap } from '@placeos/common';\nimport { CalendarEvent } from '@placeos/events';\nimport { currentBooking } from '../panel/panel-state.service';\n\n@Component({\n    selector: 'app-booking-panel-select',\n    templateUrl: './panel-select.component.html',\n    styleUrls: ['./panel-select.component.scss']\n})\nexport class BookingPanelSelectComponent extends BaseClass implements OnInit {\n    /** List of systems to show panels for */\n    public systems: string[];\n    /** Names for the list of systems */\n    public system_name: HashMap<string> = {};\n    /** Icons for the list of systems */\n    public system_icon: HashMap<string> = {};\n    /** Status for the list of systems */\n    public system_status: HashMap<string> = {};\n    /** Active Panel system */\n    public active_system: string;\n    /** Countdown counter */\n    public countdown: number;\n\n    constructor(private route: ActivatedRoute) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription('route.query', this.route.queryParamMap.subscribe((params) => {\n            if (params.has('system_ids')) {\n                this.systems = (params.get('system_ids') || '').split(',');\n            }\n        }));\n    }\n\n    /**\n     * Show booking panel for the given system ID\n     * @param id ID of the system to show\n     */\n    public showPanel(id: string) {\n        this.active_system = id;\n        this.reset();\n    }\n\n    /**\n     * Update the status value for the given system ID\n     * @param id ID of the system to update\n     * @param bookings List of current bookings for the system\n     */\n    public updateStatus(id: string, bookings: HashMap[]) {\n        const current = currentBooking(bookings.map(i => new CalendarEvent(i)));\n        this.system_status[id] = current ? 'available' : 'unavailable';\n    }\n\n    /**\n     * Close the modal\n     */\n    public close() {\n        this.active_system = null;\n        this.clearInterval('countdown');\n    }\n\n    /**\n     * User confirmation of the content of the modal\n     */\n    public reset() {\n        if (this.active_system) {\n            this.countdown = 30;\n            this.interval('countdown', () => this.tick(), 1000);\n        }\n    }\n\n    /**\n     * Decrement countdown and close if 0\n     */\n    public tick() {\n        if (this.countdown <= 0) {\n            this.close();\n        }\n        this.countdown--;\n    }\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport { ComponentsModule } from '@placeos/components';\n\nimport { ActionFieldComponent } from './action-field.component';\nimport { CounterComponent } from './counter.component';\nimport { DateFieldComponent } from './date-field.component';\nimport { DurationFieldComponent } from './duration-field.component';\nimport { TimeFieldComponent } from './time-field.component';\nimport { UserListFieldComponent } from './user-list-field.component';\nimport { UserSearchFieldComponent } from './user-search-field.component';\nimport { ItemListFieldComponent } from './item-list-field.component';\n\nexport * from './action-field.component';\nexport * from './counter.component';\nexport * from './date-field.component';\nexport * from './duration-field.component';\nexport * from './time-field.component';\nexport * from './user-list-field.component';\nexport * from './user-search-field.component';\n\nconst COMPONENTS: Type<any>[] = [\n    ActionFieldComponent,\n    CounterComponent,\n    DateFieldComponent,\n    DurationFieldComponent,\n    TimeFieldComponent,\n    UserListFieldComponent,\n    UserSearchFieldComponent,\n    ItemListFieldComponent\n];\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        MatAutocompleteModule,\n        ComponentsModule\n    ],\n    exports: [...COMPONENTS],\n})\nexport class FormFieldsModule {}\n","\nimport { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ComponentsModule } from '@placeos/components';\nimport { FormFieldsModule } from '@placeos/form-fields';\nimport { EmbeddedControlModalComponent } from './embedded-control-modal.component';\nimport { BookingModalComponent } from './booking-modal.component';\n\nconst OVERLAYS: Type<any>[] = [\n    EmbeddedControlModalComponent,\n    BookingModalComponent\n];\n\n@NgModule({\n    declarations: [\n        ...OVERLAYS\n    ],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        ComponentsModule,\n        FormFieldsModule,\n        MatDialogModule\n    ],\n    exports: [\n        ...OVERLAYS\n    ]\n})\nexport class SharedOverlaysModule {}\n","import { Component, OnInit, ViewEncapsulation } from '@angular/core';\nimport { SwUpdate } from '@angular/service-worker';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Clipboard } from '@angular/cdk/clipboard';\nimport { BehaviorSubject } from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport {\n    clientId,\n    invalidateToken,\n    isMock,\n    refreshToken,\n    token,\n} from '@placeos/ts-client';\n\nimport {\n    BaseClass,\n    current_user,\n    currentUser,\n    HotkeysService,\n    notifySuccess,\n    setAppName,\n    setNotifyOutlet,\n    SettingsService,\n    setupCache,\n    setupPlace,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { SpacesService } from '../../../spaces/src/lib/spaces.service';\nimport { setDefaultCreator } from '../../../events/src/lib/event.class';\nimport { addHours } from 'date-fns';\n\nimport * as Sentry from '@sentry/angular';\nimport { Integrations } from '@sentry/tracing';\n\nexport function initSentry(dsn: string, sample_rate: number = 0.2) {\n    if (!dsn) return;\n    Sentry.init({\n        dsn,\n        integrations: [\n            new Integrations.BrowserTracing({\n                tracingOrigins: ['localhost', location.origin],\n                routingInstrumentation: Sentry.routingInstrumentation,\n            }),\n        ],\n        tracesSampleRate: sample_rate,\n    });\n}\n\n@Component({\n    selector: 'app-root',\n    template: `\n        <router-outlet></router-outlet>\n        <div *ngIf=\"loading | async\" class=\"loading-block\">\n            <div class=\"info-block center\">\n                <div class=\"icon\">\n                    <mat-spinner [diameter]=\"64\"></mat-spinner>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``]\n})\nexport class AppComponent extends BaseClass implements OnInit {\n    private _loading = new BehaviorSubject<boolean>(false);\n    /** Observable for whether the application is initialising */\n    public readonly loading = this._loading.asObservable();\n\n    constructor(\n        private _tracing: Sentry.TraceService,\n        private _settings: SettingsService,\n        private _org: OrganisationService, // For init\n        private _spaces: SpacesService, // For init\n        private _cache: SwUpdate,\n        private _snackbar: MatSnackBar,\n        private _hotkey: HotkeysService,\n        private _clipboard: Clipboard\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyM'], () => {\n            localStorage.setItem(\n                'mock',\n                `${localStorage.getItem('mock') !== 'true'}`\n            );\n            location.reload();\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyC'], () => {\n            this._clipboard.copy(`${token()}|${refreshToken()}`);\n            notifySuccess('Successfully copied token.');\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyV'], () => {\n            navigator.clipboard?.readText().then((tkn) => {\n                const parts = tkn.split('|');\n                localStorage.setItem(`${clientId()}_access_token`, `${tkn[0]}`);\n                localStorage.setItem(\n                    `${clientId()}_refresh_token`,\n                    `${tkn[1]}`\n                );\n                localStorage.setItem(\n                    `${clientId()}_expires_at`,\n                    `${addHours(new Date(), 6).valueOf()}`\n                );\n                notifySuccess('Successfully pasted token.');\n                setTimeout(() => location.reload(), 2000);\n            });\n        });\n        setNotifyOutlet(this._snackbar);\n        this._loading.next(true);\n        /** Wait for settings to initialise */\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        setAppName(this._settings.get('app.short_name'));\n        const settings = this._settings.get('composer') || {};\n        settings.mock = !!this._settings.get('mock');\n        /** Wait for authentication details to load */\n        await setupPlace(settings).catch(() => this.onInitError());\n        this._loading.next(false);\n        setupCache(this._cache);\n        this.timeout('wait_for_user', () => this.onInitError(), 5 * 1000);\n        await current_user.pipe(first((_) => !!_)).toPromise();\n        this.clearTimeout('wait_for_user');\n        setDefaultCreator(currentUser());\n        initSentry(this._settings.get('app.sentry_dsn'));\n    }\n\n    private onInitError() {\n        if (isMock() || currentUser()?.is_logged_in) {\n            return;\n        }\n        console.error('Error initialising user.');\n        invalidateToken();\n        location.reload();\n    }\n}\n","import { PlaceAuthOptions, setup } from '@placeos/ts-client';\nimport { notifyInfo } from './notifications';\n\nexport interface PlaceSettings {\n    /** Protocol used by the application server */\n    protocol: 'http:' | 'https:';\n    /** Domain that the API server lies  */\n    domain: string;\n    /** Port number of the API server */\n    port: number;\n    /** Route on domain application rests */\n    route: string;\n    /** Whether to use the settings domain for auth */\n    use_domain: boolean;\n    /** Whether login is handled locally by the application */\n    local_login: boolean;\n    /** Whether application should mock out API requests */\n    mock: boolean;\n}\n\n/**\n * Initialise the PlaceOS API library\n */\nexport async function setupPlace(settings: PlaceSettings): Promise<void> {\n    const protocol = settings.protocol || location.protocol;\n    const host = settings.domain || location.hostname;\n    const port = settings.port || location.port;\n    const url = settings.use_domain ? `${protocol}//${host}:${port}` : location.origin;\n    const route = (location.pathname + '/').replace('//', '/');\n    const mock =\n        settings.mock ||\n        location.href.includes('mock=true') ||\n        localStorage.getItem('mock') === 'true';\n    // Generate configuration object\n    const config: PlaceAuthOptions = {\n        auth_type: 'auth_code',\n        scope: 'public',\n        host: `${host}${port ? ':' + port : ''}`,\n        auth_uri: `${url}/auth/oauth/authorize`,\n        token_uri: `${url}/auth/oauth/token`,\n        redirect_uri: `${location.origin}${route}oauth-resp.html`,\n        handle_login: !settings.local_login,\n        use_iframe: true,\n        mock,\n    };\n    if (localStorage) {\n        localStorage.setItem('mock', `${!!mock && !location.href.includes('mock=false')}`);\n    }\n    if (mock) {\n        notifyInfo('Application in mock mode.');\n    }\n    return setup(config);\n}\n","import { BrowserModule } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { ErrorHandler, NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\nimport { FormsModule } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { ServiceWorkerModule } from '@angular/service-worker';\n\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\n\nimport '@placeos/mocks';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { ComponentsModule } from '@placeos/components';\nimport { UnauthorisedComponent } from '@placeos/components';\n\nimport { environment } from '../environments/environment';\nimport { SharedOverlaysModule } from './overlays/overlays.module';\nimport { AppComponent } from '../../../../libs/components/src/lib/app.component';\n\nimport { BootstrapComponent } from './bootstrap.component';\nimport { BookingPanelComponent } from './panel/panel.component';\nimport { PanelTimelineComponent } from './panel/timeline/timeline.component';\nimport { PanelSpaceDetailsComponent } from './panel/space-details/space-details.component';\nimport { PanelBookingActionsComponent } from './panel/booking-actions/booking-actions.component';\nimport { PanelCustomActionsComponent } from './panel/custom-actions/custom-actions.component';\nimport { BookingPanelArrayComponent } from './panel-array/panel-array.component';\nimport { BookingPanelSelectComponent } from './panel-select/panel-select.component';\n\nimport * as Sentry from \"@sentry/angular\";\n\n\nconst MAT_MODULES: any[] = [\n    MatFormFieldModule,\n    MatInputModule,\n    MatAutocompleteModule,\n];\n\n@NgModule({\n    declarations: [\n        AppComponent,\n        UnauthorisedComponent,\n        BootstrapComponent,\n        BookingPanelComponent,\n        PanelTimelineComponent,\n        PanelSpaceDetailsComponent,\n        PanelBookingActionsComponent,\n        PanelCustomActionsComponent,\n        BookingPanelArrayComponent,\n        BookingPanelSelectComponent,\n    ],\n    imports: [\n        BrowserModule,\n        BrowserAnimationsModule,\n        AppRoutingModule,\n        HttpClientModule,\n        FormsModule,\n        MatSnackBarModule,\n        SharedOverlaysModule,\n        ComponentsModule,\n        ...MAT_MODULES,\n        ServiceWorkerModule.register('ngsw-worker.js', {\n            enabled: environment.production,\n        }),\n    ],\n    providers: [\n        {\n            provide: ErrorHandler,\n            useValue: Sentry.createErrorHandler({\n                showDialog: false,\n            }),\n        },\n        {\n            provide: Sentry.TraceService,\n            deps: [Router],\n        },\n    ],\n    bootstrap: [AppComponent],\n})\nexport class AppModule {\n    constructor() {\n        console.log('Production:', !!environment.production);\n    }\n}\n","export const environment = {\n    production: true,\n};\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch((err) => console.error(err));\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"zn8P\";"],"sourceRoot":"webpack:///"}