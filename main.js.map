{"version":3,"file":"main.js","mappings":"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","names":["AsyncHandler","constructor","this","BehaviorSubject","_initialised","asObservable","is_initialised","getValue","ngOnDestroy","destroy","key","_timers","clearTimeout","_intervals","clearInterval","_subscriptions","unsub","timeout","name","fn","delay","Function","Error","setTimeout","interval","setInterval","subscription","hasSubscription","Subscription","unsubscribe","unsubWith","contains","subs","Object","keys","filter","k","includes","factory","SafePipe","sanitizer","transform","value","type","bypassSecurityTrustResourceUrl","bypassSecurityTrustUrl","bypassSecurityTrustScript","bypassSecurityTrustStyle","bypassSecurityTrustHtml","i0","core","pure","IconComponent","selectors","CONFIRM_METADATA","height","width","maxHeight","maxWidth","ConfirmModalComponent","_dialog_ref","_data","EventEmitter","title","content","confirm_text","cancel_text","icon","class","disableClose","onConfirm","event","emit","reason","MAT_DIALOG_DATA","_app_name","setAppName","log","msg","args","stream","force","app_name","window","jest","debug","colors","console","getItemWithKeys","map","length","slice","unique","array","el","id","exists","push","randomInt","ceil","floor","Math","random","padString","str","randomString","chars","i","data","dialog","ref","open","Promise","race","componentInstance","pipe","first","_","toPromise","afterClosed","loading","s","close","apply","flatten","an_array","stack","res","next","pop","Array","isArray","reverse","timePeriodsIntersect","start1","end1","start2","end2","rand","sfc32","a","b","c","d","t","xmur3","h","imul","charCodeAt","seed","predictableRandomInt","getInvalidFields","form","prefix","invalid","controls","FormGroup","valid","removeEmptyFields","obj","capitalizeFirstLetter","word","toUpperCase","substring","GoogleAnalyticsService","init","tracking_id","gtag","dataLayer","w","l","Date","getTime","f","getElementsByTagName","j","createElement","async","src","parentNode","insertBefore","document","service","load","enabled","page","setUser","send","category","action","label","screen","appName","screenName","route","origin","last_route","url","location","timing","variable","timers","INVALID_STANDALONE_KEYS","HotkeysService","addEventListener","code","mapKey","toLowerCase","last_down","keydown_states","keydown_observers","counter","combo_end","indexOf","preventDefault","listen","combo","combination","split","validCombination","registered_combos","last_key","updateCombinationEndList","subscribe","count","presses","state","reduce","v","replace","non_meta","DEFAULT_SETTINGS","composer","domain","protocol","port","use_domain","local_login","app","description","short_name","logo","logo_dark","general","prevent_space_init","VERSION","dirty","raw","hash","distance","tag","semver","suffix","semverString","version","time","USER_DOMAIN","generateUserForm","user","fields","FormControl","Validators","email","organisation","phone","assistance_required","visit_expected","User","first_name","last_name","notes","photo","username","organizer","checked_in","required","resource","response_status","groups","department","sys_admin","support","extension_data","is_external","endsWith","GuestUser","super","preferred_beverage","accepted_terms_conditions","attachments","status","StaffUser","card_number","staff_id","is_logged_in","EMPTY_USER","_current_user","current_user","currentUser","showUser","retry","SettingsService","overrides","_overrides","_applyCssVariables","_observables","_subjects","post","_title","getTitle","setTitle","get","_analytics","now","built","isSameDay","format","_this","_setDarkMode","pathname","trim","join","application","settings","_user_settings","_applyUserSettings","showMetadata","details","_setFontSize","_pending_settings","override_settings","override","saveUserSetting","_savePendingChanges","overrideCssVariable","important","element","getElementById","head","appendChild","innerText","variable_map","css_string","_this2","updateMetadata","VorlonService","_settings","system","module","getModule","binding","bind","injectVorlonScript","removeVorlonScript","_script","removeChild","toQueryString","encodeURIComponent","ANIMATION_SHOW_ENTER_LEAVE","trigger","transition","style","opacity","animate","ANIMATION_SHOW_CONTRACT_EXPAND","_service","_timer","_disable_logging","notify","message","on_action","config","warn","snackbar_ref","panelClass","duration","dismiss","onAction","notifySuccess","notifyError","error","notifyInfo","info","setupCache","cache","isEnabled","activateUpdate","_x","checkForUpdate","reload","host","hostname","mock","href","localStorage","getItem","auth_type","scope","auth_uri","token_uri","redirect_uri","handle_login","use_iframe","setItem","setup","BuildingLevel","parent_id","display_name","map_id","capacity","locations","tags","images","parts","number","Organisation","raw_data","bindings","setting","Building","disc_info","discovery_info","zone_id","zone","extras","extra_id","extra_name","loan_items","levels","building_id","_roles","roles","_lockers","lockers","locker_structure","_systems","systems","_phone_numbers","phone_numbers","room_configurations","attributes","searchables","neighbourhoods","lvl","lvl_features","feature","level_id","timezone","catering_hours","start","end","visitor_space","holding_bay","address","orientations","booking_details","booking_rules","catering_restricted_from","currency","role","role_names","featuresForLevel","OrganisationService","region_settings","_region_settings","building_settings","_building_settings","regionSettings","region","_active_region","buildingSettings","bld_id","building","_organisation","regions","_regions","item","buildingsForRegion","_updateSettingOverrides","buildings","_buildings","_active_building","bld","find","Intl","DateTimeFormat","resolvedOptions","timeZone","currency_code","_levels","_router","combineLatest","levelsForBuilding","onlineState","active_building","levelWithID","id_list","tries","catch","err","min","orgs","loadOrganisation","loadRegions","all","loadBuildings","navigate","loadLevels","loadSettings","org_list","queryZones","auth","authority","org","list","isMock","org_zone","_this3","_this4","limit","catchError","of","building_list","level_list","_this5","sort","localeCompare","available_room_configs","m","prev","curr","concat","_this6","app_settings","global_settings","_initialiseActiveBuilding","saveBuilding","resolve","navigator","geolocation","getCurrentPosition","position","latitude","longitude","coords","closest_bld","c_lat","c_long","b_lat","b_long","sqrt","pow","_setDefaultBuilding","tz_start","startsWith","FeatureAvailableGuard","_org","canActivate","checkFeature","canLoad","initialised","can_activate","hookMethod","rootObject","functionToHook","hookingFunction","previousFunction","call","RemoteLoggingService","Subject","_events","shareReplay","_system_id","switchMap","_bindTo","_event_history","execute","_patchConsoleMethods","_logging_bindings","setSystem","types","_handleEvent","event_type","subtype","timestamp","mod","LOCAL_TIMEZONE","BindingDirective","_element","_renderer","ngOnInit","bindVariable","ngOnChanges","changes","sys","model","_old_model","on_event","nativeElement","_binding","index","ignore","modelChange","exec","params","then","result","ActionIconComponent","ctx_r3","PopoutMenuComponent","show","ctx","UserAvatarComponent","initials","SecurityContext","SanitizePipe","sanitize","RESOURCE_URL","URL","SCRIPT","STYLE","HTML","MAP_FEATURE_DATA","InjectionToken","InteractiveMapComponent","onResize","zoom","center","x","y","updateDisplay","TemplateRef","_injector","ratio$","_on_changes","ratio","svg_ratio$","svg_ratio","zoom$","applyGlobalStyles","viewer","removeViewer","createView","e","features","updateInjectors","focus","focusOn","previousValue","currentValue","isSamePoint","p1","p2","styles","labels","actions","updateView","ngAfterViewInit","getViewer","updateFeatureList","updateViewer","feature_list","options","desired_zoom","desired_center","_outlet_el","createViewer","listenToViewerChanges","getBoundingClientRect","zoomChange","centerChange","rect","mappings","trackByFn","track_id","idx","_feature_list","toArray","old_injectors","injectors","Injector","providers","provide","useValue","_extra_data","parent","MapPinComponent","_details","fill","stroke","show_message","MapRadiusComponent","last_seen_at","formatDistanceToNow","last_seen","_el","radius","max","updateRadius","box","StatusOverlayComponent","FixedPipe","places","toFixed","CustomTableComponent","MatTableDataSource","data_source","_sort","paginator","pagination","_paginator","filterPredicate","dataSource","Observable","columns","display_column","column_size","MatPaginator","MatSort","CustomTooltipData","CustomTooltipComponent","_overlay","hover","_updateInjector","_overlay_ref","x_pos","y_pos","_updateType","_portal","create","hasBackdrop","backdrop","positionStrategy","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","attach","backdropClick","dispose","injector","CdkPortal","DEFAULT_KEYS","VirtualKeyboardComponent","focusInput","blur","global","bottom","centerHorizontally","handleKeyPress","cursor_pos","selectionStart","substr","dispatchEvent","InputEvent","updateKeyState","selectionEnd","keyset","GlobalLoadingComponent","online","isOnline","token","MapPolygonComponent","scale","zoom_value","_cdr","color","data$","processPoints","points","diff","x_min","x_max","y_min","y_max","range","point_list","detectChanges","GlobalBannerComponent","has_viewed","banner","MapLocateModalComponent","level","zones","processFeature","processStyles","display","style_map","z_index","ImageCarouselComponent","DurationPipe","shorten","formatDuration","hours","minutes","RedirectComponent","JsonDisplayComponent","json","_updateFormatting","formatted_json","JSON","stringify","undefined","COLOR_MAP","network","dom","URL_STARTS","DebugConsoleComponent","_logs","_hotkey","logs","history","ChangelogModalComponent","changelog","marked","MAT_MODULES","MatAutocompleteModule","MatMenuModule","MatFormFieldModule","MatSelectModule","MatRippleModule","MatDialogModule","MatDatepickerModule","MatInputModule","ClipboardModule","MatProgressSpinnerModule","MatChipsModule","MatPaginatorModule","CdkTableModule","PortalModule","MatSortModule","ScrollingModule","ComponentsModule","imports","CommonModule","FormsModule","ReactiveFormsModule","HttpClientModule","TranslateModule","ActionFieldComponent","performAction","show_tooltip","CounterComponent","add","ctrl_key","step","shift_key","setValue","remove","new_value","_onChange","writeValue","registerOnChange","registerOnTouched","_onTouch","NG_VALUE_ACCESSOR","useExisting","forwardRef","multi","decls","FieldDateAdapter","NativeDateAdapter","date","displayFormat","DateFieldComponent","valueOf","from","_from","startOfDay","until","_to","addYears","endOfDay","date_string","toISOString","old_date","new_date","set","getHours","getMinutes","formatISO","setDisabledState","disabled","DateAdapter","useClass","MAT_DATE_FORMATS","parse","dateInput","monthYearLabel","dateA11yLabel","monthYearA11yLabel","DurationFieldComponent","duration_options","generateDurationOptions","_updateOption","custom_options","blocks","option","addMinutes","days","findIndex","TimeFieldComponent","show_select","_time_options","generateAvailableTimes","no_past_times","time_options","startOfMinute","roundToNearestMinutes","nearestTo","showSelect","select_field","openedChange","datestamp","show_past","isAfter","UserFormComponent","hasError","touched","NewUserModalComponent","saveChanges","markAllAsTouched","new_user","metadata","CateringItem","custom_id","option_list","unit_price","quantity","discount_cap","accept_points","has_options","some","active","hide_for_zones","unit_price_with_options","total_cost","options_string","CateringOrder","system_id","event_id","items","item_count","amount","charge_code","invoice_number","deliver_at","Space","bookable","support_url","configurations","availability","DURATION_MAP","month","months","week","weeks","day","hour","minute","DEFAULT_RULES","auto_approve","hidden","stringToMinutes","addToDate","checkRulesMatch","ruleset","matches","conditions","every","is_before","isBefore","is_after","min_length","max_length","_default_user","CalendarEvent","ext","event_start","getUnixTime","event_end","calendar","creator","attendees","u","resources","body","private","all_day","differenceInMinutes","meeting_url","online_meeting_url","meeting_id","online_meeting_id","meeting_provider","online_meeting_provider","recurring","recurring_master_id","organiser","from_bookings","master","mailbox","ical_uid","recurrence","range_start","range_end","pattern","days_of_week","old_system","eventStatus","approved","space","catering","guests","is_today","toJSON","breakdown","can_check_in","GUEST_ENDPOINT","searchGuests","q","query","STAFF_ENDPOINT","searchStaff","ctx_r20","validateEmail","test","UserListFieldComponent","queryUsers","authority_id","search_valid_email","search$","_dialog","ENTER","COMMA","debounceTime","staff","guests_only","visitors_list","visitors","company","tap","openNewUserModal","updateSearch","addUserFromEmail","addUser","visitor_details","old_visitors","_search_el","active_list","removeUser","a_user","addUsersFromFile","target","file","files","reader","FileReader","readAsText","evt","processCsvData","srcElement","csvToJson","csv","delimiter","objPattern","RegExp","arrMatches","arrData","headers","splice","row","internal_emails","downloadCSVTemplate","custom_template","downloadFile","filename","contents","setAttribute","click","displayFn","$localize","ctx_r7","$event","ctx_r11","UserSearchFieldComponent","distinctUntilChanged","forkJoin","query_fn","search","search_str","_input_el","search_results$","user_list","resetSearchString","active_user","ElementRef","ItemListFieldComponent","SPACE","addChipItem","control","input","item_list","removeChipItem","UploadListFieldComponent","progress","removeFile","onFileEvent","on_change","created_at","_uploadFile","fileReader","blob","blobUtil","upload","uploadFiles","file_name","upload_details","size","takeWhile","access_url","readAsArrayBuffer","UploadFileFieldComponent","EMPTY_FAVS","AssetSelectModalComponent","favorites","selected_ids","selected","in_use","isSelected","_items","setSelected","asset","toggleFavourite","fav_list","AssetListFieldComponent","removeAsset","updated_list","addAssets","assets","IGNORE_EXT_KEYS","Booking","asset_id","asset_name","booking_start","booking_end","booking_type","abs","user_email","user_id","user_name","rejected","deleted","booked_by_id","booked_by_name","booked_by_email","approver_id","approver_email","approver_name","access","members","checked_out_at","is_done","addHours","checked_out","end_time","BOOKINGS_ENDPOINT","queryBookings","createBooking","queryResourceAvailability","period_start","period_end","EVENTS_ENDPOINT","queryEvents","querySpaceAvailability","system_ids","endInFuture","BOOKING_DATE","setMinutes","setHours","validateCateringField","catering_control","catering_field","ctx_r5","PaymentModalComponent","processPayment","card_details","_validCardDetails","makePayment","success","cardholder","cvv","STRIPE_MODULE","PaymentsService","payment_module","_loading","_active_card","cost","period","_getCostOfProduct","customer_id","_newCustomerID","_processPayment","rate","_addPaymentMethod","card","payment_method","price","product_list","source","invoice_id","updated_at","formatUTC","utc_date","localToTimezone","tz","offset_diff","getTimezoneOffset","addMilliseconds","formatAllDay","formatCalFileText","EventLinkModalComponent","_event","generateMicrosoftCalendarLink","path","rru","startdt","enddt","subject","allday","emails","to","generateGoogleCalendarLink","fmt","text","trp","dates","generateCalendarFileLink","chunks","has_actioned","SPACE_LIST","EMPTY_SPACE","updateSpaceList","space_list","SpacePipe","space_id","is_email","showSystem","querySystems","SPACE_LIST_REQUESTS","SPACE_COUNT","Asset","barcode","brand","specifications","purchase_date","purchase_price","purchase_details","consumables","general_details","invoices","other_data","new_assets","old_assets","filtered","removeBooking","del","response_type","BOOKING_URLS","EventFormService","view","_view","_form","favorite_spaces","has_calendar","_payments","zone_ids","generateEventForm","catering_notes","catering_charge_code","visitor_type","needs_space","needs_parking","valueChanges","o","updateValueAndValidity","disable","enable","setValidators","sessionStorage","_options","distinctUntilKeyChanged","requestSpacesForZone","spaces","show_fav","limit_map","limited_zones","zone_limit","filtered_spaces","s1","s2","obs","_space_bookings","merge","timer","bookings","getRawValue","periodInFreeTimeSlot","min_size","getFreeTimeSlots","slots","booking","bkn_start","bkn_end","isSameMinute","blk","availability_method","_date","differenceInDays","current_available_spaces","future_available_spaces","_space_pipe","events","NavigationEnd","clearForm","storeForm","patchValue","clearValidators","setErrors","listenForStatusChanges","available_spaces","setView","setOptions","newForm","resetForm","reset","removeItem","loadForm","openEventLinkModal","postForm","reject","checkSelectedSpacesAreAvailable","updateAssetRequestsForResource","is_owner","receipt","resource_name","invoice","_makeBooking","host_override","last_success","updateEvent","method","patch","put","createEvent","saveEvent","newBookingFromCalendarEvent","updateBooking","newCalendarEventFromBooking","from_booking","exclude","exclude_range","NewSpaceSelectModalComponent","_event_form","space_r1","SpaceListFieldComponent","changeSpaces","room_size","removeSpace","i18n_11","RichTextInputComponent","_editor","root","innerHTML","_initialiseEditor","delta","clipboard","convert","setContents","Quill","_editor_el","bounds","_container_el","placeholder","modules","toolbar","readOnly","readonly","theme","on","_updateFn","off","Calendar","primary","summary","can_edit","starts_at","ends_at","CALENDAR_ENDPOINT","queryCalendars","queryCalendarAvailability","calendarsToSpaces","cal","querySpaceFreeBusy","HostSelectFieldComponent","zip","showStaff","ImageListFieldComponent","_upload_list","_clipboard","upload_list","upload_ids","ids","_list_el","view_space","addImageUrl","link","copyLink","copy","viewImage","removeImage","addImage","chipInput","inputElement","uploadImages","uploadFile","resolved","update_fn","observer","arrayBuffer","formatted_size","humanReadableByteCount","complete","_updateUploadHistory","done_list","forEach","FormFieldsModule","MatTooltipModule","MatCheckboxModule","MatRadioModule","SpaceSelectItemComponent","SpaceSelectModalComponent","multiple","space_map","querySpaceCalendarAvailability","filterSpacesFromRules","rulemap","rulesForSpace","rules","spaceSelected","save","LoginComponent","password","toPassword","pwd_field","login","UnauthorisedComponent","MisconfiguredComponent","AuthorisedAdminGuard","checkUser","segments","PLACEOS_APP_ACCESS","AuthorisedUserGuard","_access","group","SpaceDetailsComponent","_updateFeature","map_url","AttendeeListComponent","i18n_1","EventDetailsModalComponent","allow_edit","_load","dur","checkin","viewLocation","hide_map","EventCardComponent","_route","queryParamMap","has","viewDetails","zone_list","edit","SharedEventsModule","MatButtonModule","SpaceListComponent","isFavourite","selectSpace","onSelect","SPACE_PIPE","SpacesService","_list","_init","loadSpaces","predicate","_compare","loadSpace","valid_spaces","SpaceFiltersComponent","max_duration","feature_display","hide_features","end_date","addDays","_bsheet_ref","_spaces","active_buildings","active_levels","can_close","setBuilding","toggleFeature","feat","take","new_list","SpaceFiltersDisplayComponent","_bsheet","_updateLocation","removeFeature","removeAllFeatures","SpaceLocationPinComponent","SpaceSelectMapComponent","_change","callback","_seletedSpace","setZoom","new_zoom","resetMap","SharedSpacesModule","MatBottomSheetModule","STORE_KEY","BootstrapComponent","system_id$","configure","clearBootstrap","bootstrap","checkBootstrapped","queryParamsHandling","CalendarService","_calendars","calendars","getFreeBusyDate","checkSpacesAvailability","old_booking","block","SourceSelectModalComponent","output","SelectMeetingModalComponent","setCalendar","openConfirmModal","setEvent","HelpModalComponent","active_item","active_id","ControlStateService","_id","_cal","_system","_input_data","presentable","_output_data","_outputs","_calendar","_lights","_blinds","_screens","_volume","_mute","_active_output","_listenToSystemBinding","join_modes","joined_id","modes","calendar_list","_url","distinct","bindToState","_inputs","bindSources","setID","_execute","powerOn","powerOff","unlink","setOutput","selected_input","setOutputSource","setRoute","set_input","setSelectedInput","unroute","clear","setMute","outputs","updateSourceData","mute","setVolume","volume","_ignore_changes","mod_name","switchSource","selectMeeting","cals","viewHelp","help_items","bindTo","updateProperty","offhook_id","ringing_id","alias_list","alias","list_observer","unbind","RoomAccessoryTooltipComponent","_state","_tooltip","room_accessories","JoystickTilt","JoystickPan","JoystickComponent","thumb_transform","pan","Stop","Left","tilt","Up","startPan","move_event","MouseEvent","end_event","_box","_panning_el","handlePan","tiltChange","panChange","point","eventToPoint","clientX","clientY","touches","angle","atan2","top","left","PI","Down","Right","ctx_r24","ZoomDirection","CameraTooltipComponent","camera_list","selected_camera","cam","active_camera","selectCamera","camera","recallPreset","preset","addPreset","removePreset","moveCamera","startZoom","dir","In","Out","JoinRoomTooltipComponent","mapping","LightingSceneTooltipComponent","lighting_scene","lighting_scenes","setScene","LightingTooltipComponent","lights","ctx_r15","ctx_r27","MicrophoneTooltipComponent","mic_list","microphones","onChange","changing","DialpadComponent","PhoneDiallingTooltipComponent","sys_id","handleInput","char","PowerTooltipComponent","joined","VideoCallStateService","_control","Status","showCameraPIP","muteMicrophone","setVideoLayout","layout","setPresentationMode","hangup","sendDTMF","digit","toggleCallOnHold","_this7","VideoCallDialViewComponent","_call","show_camera_pip","addDigit","dial_number","joinConference","redirect","relativeTo","VideoConferenceTooltipComponent","_vc_state","_ref","item_r3","item_r9","TOOLTIP","TopbarHeaderComponent","is_trusted","isTrusted","blinds","video_conf","lighting","power","mics","lights_list","connected","speaker_track","cams","accessories","has_vc","l_scenes","action_list","PHONE","dial_bindings","offhook","ringing","VC","MEET","LIGHTS","ACCESSORIES","MICS","JOIN","room_ids","CAMERA","HELP","LIGHT_SCENES","SourceSelectComponent","output_id","output_list","input_list","input_types","selectSource","ICON_MAP","Display","PC","Laptop","Camera","TV","OutputDisplayComponent","_input","ControlAdvancedViewComponent","ControlPageViewComponent","padLength","ControlStatusBarComponent","capture_list","ControlMainViewComponent","viewChangelog","fetch","paramMap","CameraControlsComponent","VideoCallPageComponent","mic_mute","video_layout","presentation_mode","presentables$","present_output","_onCallEnded","DeviceOutputListItemComponent","DeviceOutputListComponent","active_output","preview_outputs","TVControlsComponent","setChannel","MarkdownPipe","TabOutletComponent","tabs","active_tab","inputs","tab","help","selected_tab","system$","ControlTabbedViewComponent","ControlVideoCallViewComponent","routes","component","redirectTo","AppRoutingModule","RouterModule","useHash","MOCK_MENU","generateCateringOrder","mx","DOMAIN","PREDEF_USERS","ACTIVE_USER","MOCK_STAFF","MOCK_GUESTS","vaccination_proof","id_data","MOCK_ORGS","triggers","MOCK_BUILDINGS","MOCK_LEVELS","num","mockLevel","p","MOCK_METADATA","current","contacts","PARKING_SPACES","ZONE_MOCKS","registerMocks","registerMockEndpoint","request","query_params","area_management","location_services","contact_tracing","route_params","generateMockDeskMetadata","generateParkingSpaces","assignee","assigned_to","assigned_name","charge_codes","map_regions","areas","properties","label_location","geometry","coordinates","DESK_FEATURES","desks","randomSpaceFeatures","numFeatures","r","MOCK_SPACES","generateMockSpace","linked","long_name","searchable","controlable","cost_hour","linked_rooms","image","EVENT_TIME","dayjs","startOf","nextEventTime","unix","event_status","randomStatus","rnd","MOCK_EVENTS","PEOPLE","unshift","event_spaces","USER_MOCKS","person","decodeURIComponent","generateLocation","LOCATION_TYPES","level_spaces","meeting","subtract","geo","lat","lon","RoomModule","env_sources","available_outputs","$power","$share","$route","$updateState","following","$unroute","$connect","$disconnect","$link","$merge","$split","$notify","$preset","$volume","$mute","$unmute","$environment","$lock","locked","$unlock","Mic1","Mic2","Mic3","PC1","PC2","PC3","PC4","HDMI","VGA","Camera1","Camera2","Camera3","Camera4","TV1","VC1","Display1","Display2","Display3","Display4","Display5","states","createSystemModule","MockBookingModule","_space","$start_meeting","last_booking_started","$end_meeting","$book_now","len","$poll_bookings","updateBookings","current_booking","next_booking","pending","subSeconds","pending_before","addSeconds","pending_period","createBookingsModule","MockAreaManagementModule","$locate_user","$update","updateLocations","area","MAC_LOOKUP","MockLocationServicesModule","$check_ownership_of","mac_address","priority","padZero","no","createAreaManagementModule","overview","desk_count","desk_usage","device_capacity","device_count","estimated_people","percentage_use","recommendation","area_id","users","fixed","usr","at_location","mac","Md5","hashStr","coordinates_from","s2_cell_id","variance","map_width","map_height","CameraModule","presets","$pan","$tilt","$recall","$save_preset","DisplayModule","MicrophoneModule","CaptureModule","remaining","$start","$pause","$resume","$stop","createCaptureModule","MeetingPushModule","$econtrol","createMeetingPushModule","VideoConferenceModule","$show_camera_pip","visible","selfview","$mic_mute","$presentation_mode","$hangup","$call_place_on_hold","calls","$call_resume","$video_layout","$dtmf_send","$dial","createVideoConferenceModule","CONTACT_EVENTS","filterFn","itm","contact_time","ContactTracingModule","$close_contacts","beginning","ending","createContactTracingModule","PaymentsModule","$list_payment_methods","$add_payment_method","$get_product_prices","$create_payment_intent","$confirm_payment_intent","$cancel_payment_intent","$create_customer","createPaymentsModule","SYSTEM_MOCKS","createSystem","registerSystem","System","Bookings","ContactTracing","AreaManagement","LocationServices","createCameraModule","createDisplayModule","Microphone","createMicrophoneModule","Capture","MeetingPush","VidConf","Payment","mockSystem","EVENT_MOCKS","new_event","CALENDAR_MOCKS","user2","user3","handleSpaceAvailability","MOCK_ASSETS","subDays","seconds","milliseconds","TYPES","TRACKING","MOCK_BOOKINGS","lvls","lvl_spaces","approver","guest","asset_count","plate_number","tracking","BOOKING_MOCKS","req","BASE_PATH","mocks","ASSET_MOCKS","updateAsset","StylesManager","AppComponent","_cache","_snackbar","_translate","MOCKS","refreshToken","readText","tkn","clientId","_initLocale","locale","use","setAPI_Key","setNotifyOutlet","snackbar","disable_logging","setupPlace","onInitError","setDefaultCreator","setInternalUserDomain","_initAnalytics","initSentry","dsn","sample_rate","Sentry","tracesSampleRate","initialiseUploadService","auto_start","endpoint","worker_url","Amazon","Azure","Google","OpenStack","invalidateToken","locales","addLangs","languages","lang","HelpTooltipComponent","MatSliderModule","ANGULAR_MODULES","UIModule","BLANK_CARD","DATE_PIPE","DatePipe","CardInputFieldComponent","exp_month","exp_year","setMonth","is_amex","card_type","card_display","card_focused","_index","activeElement","parentElement","onInput","_focusChange","AssetDetailsComponent","AssetFiltersComponent","AssetFiltersDisplayComponent","AssetStateService","_search","queryAssets","asset_list","asset_bookings","available_assets","setSearch","AssetListComponent","_asset_state","filtered_assets","selectAsset","AssetsModule","AppModule","ErrorHandler","showDialog","deps","Router","BrowserModule","BrowserAnimationsModule","MatSnackBarModule","ServiceWorkerModule","environment","enableProdMode","__NgCli_bootstrap_1","bootstrapModule"],"sourceRoot":"webpack:///","sources":["./libs/common/src/lib/async-handler.class.ts","./libs/components/src/lib/safe.pipe.ts","./libs/components/src/lib/icon.component.ts","./libs/components/src/lib/confirm-modal.component.ts","./libs/common/src/lib/general.ts","./libs/common/src/lib/google-analytics.service.ts","./libs/common/src/lib/hotkeys.service.ts","./apps/control/src/environments/settings.ts","./libs/common/src/lib/version.ts","./libs/users/src/lib/user.utilities.ts","./libs/users/src/lib/user.class.ts","./libs/common/src/lib/user-state.ts","./libs/common/src/lib/settings.service.ts","./libs/common/src/lib/vorlon.service.ts","./libs/common/src/lib/api.ts","./libs/common/src/lib/angular-animations.ts","./libs/common/src/lib/notifications.ts","./libs/common/src/lib/application.ts","./libs/common/src/lib/placeos.ts","./libs/organisation/src/lib/level.class.ts","./libs/organisation/src/lib/organisation.class.ts","./libs/organisation/src/lib/building.class.ts","./libs/organisation/src/lib/organisation.service.ts","./libs/common/src/lib/feature-available.guard.ts","./libs/common/src/lib/remote-logging.service.ts","./libs/common/src/lib/timezone-helpers.ts","./libs/components/src/lib/binding.directive.ts","./libs/components/src/lib/action-icon.component.ts","./libs/components/src/lib/popout-menu.component.ts","./libs/components/src/lib/user-avatar.component.ts","./libs/components/src/lib/sanitise.pipe.ts","./libs/components/src/lib/interactive-map.component.ts","./libs/components/src/lib/map-pin.component.ts","./libs/components/src/lib/map-radius.component.ts","./libs/components/src/lib/status-overlay.component.ts","./libs/components/src/lib/fixed.pipe.ts","./libs/components/src/lib/custom-table.component.ts","./libs/components/src/lib/custom-tooltip.component.ts","./libs/components/src/lib/virtual-keyboard.component.ts","./libs/components/src/lib/global-loading.component.ts","./libs/components/src/lib/map-polygon.component.ts","./libs/components/src/lib/global-banner.component.ts","./libs/components/src/lib/map-locate-modal.component.ts","./libs/components/src/lib/image-carousel.component.ts","./libs/components/src/lib/duration.pipe.ts","./libs/components/src/lib/redirect.component.ts","./libs/components/src/lib/json-display.component.ts","./libs/components/src/lib/debug-console.component.ts","./libs/components/src/lib/changelog-modal.component.ts","./libs/components/src/lib/components.module.ts","./libs/form-fields/src/lib/action-field.component.ts","./libs/form-fields/src/lib/counter.component.ts","./libs/form-fields/src/lib/date-field.component.ts","./libs/form-fields/src/lib/duration-field.component.ts","./libs/form-fields/src/lib/time-field.component.ts","./libs/users/src/lib/user-form.component.ts","./libs/users/src/lib/new-user-modal.component.ts","./libs/catering/src/lib/catering-item.class.ts","./libs/catering/src/lib/catering-order.class.ts","./libs/spaces/src/lib/space.class.ts","./libs/events/src/lib/helpers.ts","./libs/events/src/lib/event.class.ts","./libs/users/src/lib/guests.fn.ts","./libs/users/src/lib/staff.fn.ts","./libs/form-fields/src/lib/user-list-field.component.ts","./libs/form-fields/src/lib/user-search-field.component.ts","./libs/form-fields/src/lib/item-list-field.component.ts","./libs/form-fields/src/lib/upload-list-field.component.ts","./libs/form-fields/src/lib/upload-file-field.component.ts","./libs/assets/src/lib/asset-select-modal/asset-select-modal.component.ts","./libs/form-fields/src/lib/asset-list-field.component.ts","./libs/bookings/src/lib/booking.class.ts","./libs/bookings/src/lib/bookings.fn.ts","./libs/events/src/lib/events.fn.ts","./libs/events/src/lib/validators.ts","./libs/events/src/lib/utilities.ts","./libs/payments/src/lib/payment-modal.component.ts","./libs/payments/src/lib/payments.service.ts","./libs/common/src/lib/calendar-links.ts","./libs/events/src/lib/event-link-modal.component.ts","./libs/spaces/src/lib/space.pipe.ts","./libs/spaces/src/lib/space.utilities.ts","./libs/assets/src/lib/asset.class.ts","./libs/assets/src/lib/assets.fn.ts","./libs/events/src/lib/event-form.service.ts","./libs/bookings/src/lib/booking.utilities.ts","./libs/spaces/src/lib/space-select-modal/new-space-select-modal.component.ts","./libs/form-fields/src/lib/space-list-field.component.ts","./libs/form-fields/src/lib/rich-text-input.component.ts","./libs/calendar/src/lib/calendar.class.ts","./libs/calendar/src/lib/calendar.fn.ts","./libs/form-fields/src/lib/host-select-field.component.ts","./libs/form-fields/src/lib/image-list-field.component.ts","./libs/form-fields/src/lib/form-fields.module.ts","./libs/spaces/src/lib/space-select-item.component.ts","./libs/spaces/src/lib/space-select-modal.component.ts","./libs/components/src/lib/login.component.ts","./libs/components/src/lib/unauthorised.component.ts","./libs/components/src/lib/misconfigured.component.ts","./libs/components/src/lib/authorised-admin.guard.ts","./libs/components/src/lib/authorised-user.guard.ts","./libs/spaces/src/lib/space-select-modal/space-details.component.ts","./libs/events/src/lib/attendee-list.component.ts","./libs/events/src/lib/event-details-modal.component.ts","./libs/events/src/lib/event-card.component.ts","./libs/events/src/lib/events.module.ts","./libs/spaces/src/lib/space-select-modal/space-list.component.ts","./libs/spaces/src/lib/spaces.service.ts","./libs/spaces/src/lib/space-select-modal/space-filters.component.ts","./libs/spaces/src/lib/space-select-modal/space-filters-display.component.ts","./libs/spaces/src/lib/space-select-modal/space-location-pin.component.ts","./libs/spaces/src/lib/space-select-modal/space-map.component.ts","./libs/spaces/src/lib/spaces.module.ts","./apps/control/src/app/bootstrap.component.ts","./libs/calendar/src/lib/calendar.service.ts","./apps/control/src/app/ui/source-select-modal.component.ts","./apps/control/src/app/ui/select-meeting-modal.component.ts","./apps/control/src/app/ui/help-modal.component.ts","./apps/control/src/app/control-state.service.ts","./apps/control/src/app/ui/room-accessory-tooltip.component.ts","./apps/control/src/app/ui/joystick.component.ts","./apps/control/src/app/ui/camera-tooltip.component.ts","./apps/control/src/app/ui/join-room-tooltip.component.ts","./apps/control/src/app/ui/lighting-scene-tooltip.component.ts","./apps/control/src/app/ui/lighting-tooltip.component.ts","./apps/control/src/app/ui/microphone-tooltip.component.ts","./apps/control/src/app/ui/dialpad.component.ts","./apps/control/src/app/ui/phone-dialling-tooltip.component.ts","./apps/control/src/app/ui/power-tooltip.component.ts","./apps/control/src/app/video-call/video-call-state.service.ts","./apps/control/src/app/video-call/video-call-dial-view.component.ts","./apps/control/src/app/ui/video-conf-tooltip.component.ts","./apps/control/src/app/topbar-header.component.ts","./apps/control/src/app/ui/source-select.component.ts","./apps/control/src/app/ui/output-display.component.ts","./apps/control/src/app/advanced-view.component.ts","./apps/control/src/app/page-view.component.ts","./apps/control/src/app/ui/duration.pipe.ts","./apps/control/src/app/status-bar.component.ts","./apps/control/src/app/main-view.component.ts","./apps/control/src/app/ui/camera-controls.component.ts","./apps/control/src/app/video-call/video-call-page.component.ts","./apps/control/src/app/tabbed-view/output-list-item.component.ts","./apps/control/src/app/tabbed-view/output-list.component.ts","./apps/control/src/app/tabbed-view/tv-controls.component.ts","./apps/control/src/app/ui/markdown.pipe.ts","./apps/control/src/app/tabbed-view/tab-outlet.component.ts","./apps/control/src/app/tabbed-view/tabbed-view.component.ts","./apps/control/src/app/video-call/video-call-view.component.ts","./apps/control/src/app/app-routing.module.ts","./libs/mocks/src/lib/api/catering.data.ts","./libs/mocks/src/lib/api/common.mock.ts","./libs/mocks/src/lib/api/users.data.ts","./libs/mocks/src/lib/api/zone.data.ts","./libs/mocks/src/lib/api/zones.mock.ts","./libs/mocks/src/lib/api/spaces.data.ts","./libs/mocks/src/lib/api/events.data.ts","./libs/mocks/src/lib/api/users.mock.ts","./libs/mocks/src/lib/realtime/control.ts","./libs/mocks/src/lib/realtime/events.ts","./libs/mocks/src/lib/realtime/desks.ts","./libs/mocks/src/lib/realtime/camera.ts","./libs/mocks/src/lib/realtime/display.ts","./libs/mocks/src/lib/realtime/microphone.ts","./libs/mocks/src/lib/realtime/capture.ts","./libs/mocks/src/lib/realtime/meeting.ts","./libs/mocks/src/lib/realtime/video-conference.ts","./libs/mocks/src/lib/realtime/contact-tracing.ts","./libs/mocks/src/lib/realtime/payments.ts","./libs/mocks/src/lib/api/systems.mock.ts","./libs/mocks/src/lib/systems-bindings.mock.ts","./libs/mocks/src/lib/api/events.mock.ts","./libs/mocks/src/lib/api/calendars.mock.ts","./libs/mocks/src/lib/api/assets.data.ts","./libs/mocks/src/lib/api/bookings.data.ts","./libs/mocks/src/lib/api/bookings.mock.ts","./libs/mocks/src/lib/api/assets.mock.ts","./libs/mocks/src/mocks.ts","./libs/components/src/lib/app.component.ts","./apps/control/src/app/ui/help-tooltip.component.ts","./apps/control/src/app/ui/ui.module.ts","./libs/payments/src/lib/card-input-field.component.ts","./libs/payments/src/lib/payments.module.ts","./libs/assets/src/lib/asset-select-modal/asset-details.component.ts","./libs/assets/src/lib/asset-select-modal/asset-filters.component.ts","./libs/assets/src/lib/asset-select-modal/asset-filters-display.component.ts","./libs/assets/src/lib/asset-state.service.ts","./libs/assets/src/lib/asset-select-modal/asset-list.component.ts","./libs/assets/src/lib/assets.module.ts","./apps/control/src/app/app.module.ts","./apps/control/src/environments/environment.prod.ts","./apps/control/src/main.ts"],"sourcesContent":["import { Injectable, OnDestroy } from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\ntype VoidFn = () => void;\n\n/**\n * Class for handling cleanup of async methods when components are destroyed.\n * Async methods include Subscriptions, Timeouts and Intervals\n */\n@Injectable({\n    providedIn: 'root',\n})\nexport class AsyncHandler implements OnDestroy {\n    /** Store for named timers */\n    protected _timers: { [name: string]: number } = {};\n    /** Store for named intervals */\n    protected _intervals: { [name: string]: number } = {};\n    /** Store for named subscription unsub callbacks */\n    protected _subscriptions: {\n        [name: string]: Subscription | VoidFn;\n    } = {};\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n\n    /** Whether the object has been initialised */\n    public get is_initialised(): boolean {\n        return this._initialised.getValue();\n    }\n\n    public ngOnDestroy(): void {\n        this.destroy();\n    }\n\n    protected destroy() {\n        for (const key in this._timers) {\n            if (key in this._timers) {\n                this.clearTimeout(key);\n            }\n        }\n        for (const key in this._intervals) {\n            if (key in this._intervals) {\n                this.clearInterval(key);\n            }\n        }\n        for (const key in this._subscriptions) {\n            if (key in this._subscriptions) {\n                this.unsub(key);\n            }\n        }\n    }\n\n    /**\n     * Creates a named timer\n     * @param name Name of the timer\n     * @param fn Callback function for the timer\n     * @param delay Callback delay\n     */\n    protected timeout(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearTimeout(name);\n            this._timers[name] = <any>setTimeout(() => {\n                fn();\n                delete this._timers[name];\n            }, delay);\n        } else {\n            throw new Error(\n                name\n                    ? 'Cannot create named timeout without a name'\n                    : 'Cannot create a timeout without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named timer\n     * @param name Timer name\n     */\n    protected clearTimeout(name: string) {\n        if (this._timers[name]) {\n            clearTimeout(this._timers[name]);\n            delete this._timers[name];\n        }\n    }\n\n    /**\n     * Creates a named interval\n     * @param name Name of the interval\n     * @param fn Callback function for the interval\n     * @param delay Callback delay\n     */\n    protected interval(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearInterval(name);\n            this._intervals[name] = <any>setInterval(() => fn(), delay);\n        } else {\n            throw new Error(\n                name\n                    ? 'Cannot create named interval without a name'\n                    : 'Cannot create a interval without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named interval\n     * @param name Timer name\n     */\n    protected clearInterval(name: string) {\n        if (this._intervals[name]) {\n            clearInterval(this._intervals[name]);\n            delete this._intervals[name];\n        }\n    }\n\n    /**\n     * Store named subscription\n     * @param name Name of the subscription\n     * @param unsub Unsubscribe callback or Subscription object\n     */\n    protected subscription(name: string, unsub: Subscription | VoidFn) {\n        this.unsub(name);\n        this._subscriptions[name] = unsub;\n    }\n\n    protected hasSubscription(name: string) {\n        return (\n            this._subscriptions[name] instanceof Subscription ||\n            !!this._subscriptions[name]\n        );\n    }\n\n    /**\n     * Call unsubscribe callback with the given name\n     * @param name\n     */\n    protected unsub(name: string) {\n        if (name in this._subscriptions) {\n            if (this._subscriptions[name] instanceof Subscription) {\n                (this._subscriptions[name] as any).unsubscribe();\n            } else if (this._subscriptions[name]) {\n                (this._subscriptions[name] as any)();\n            }\n            delete this._subscriptions[name];\n        }\n    }\n\n    /** Unsubscribe to the items with names containing the given string */\n    protected unsubWith(contains: string) {\n        const subs = Object.keys(this._subscriptions).filter((k) =>\n            k.includes(contains)\n        );\n        for (const key of subs) {\n            this.unsub(key);\n        }\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\n@Pipe({\n    name: 'safe'\n})\nexport class SafePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    /**\n     * Sanitizes the string allowing it to be injected into a template\n     * @param value String to sanitize\n     * @param type Type of value to sanitise. `resource`, `url`, `script`, `style` or `html`\n     */\n    public transform(\n        value: string,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n            case 'url':\n                return this.sanitizer.bypassSecurityTrustUrl(value);\n            case 'script':\n                return this.sanitizer.bypassSecurityTrustScript(value);\n            case 'style':\n                return this.sanitizer.bypassSecurityTrustStyle(value);\n            default:\n                return this.sanitizer.bypassSecurityTrustHtml(value);\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from 'libs/common/src/lib/types';\n\n@Component({\n    selector: 'app-icon,icon',\n    template: `\n        <div class=\"flex items-center justify-center h-[1.25em] w-[1.25em]\">\n            <i\n                *ngIf=\"!icon || icon.type !== 'img'\"\n                [class]=\"icon?.class || className\"\n            >\n                {{ icon?.content }}\n                <ng-content></ng-content>\n            </i>\n            <img\n                class=\"h-[1em] w-[1em]\"\n                *ngIf=\"icon && icon.type === 'img'\"\n                [src]=\"icon.src | safe: 'resource'\"\n            />\n        </div>\n    `,\n    styles: [\n        `\n            i {\n                font-size: 1em;\n            }\n        `,\n    ],\n})\nexport class IconComponent {\n    @Input() public className: string = 'material-icons';\n    /** Icon details */\n    @Input() public icon: ApplicationIcon;\n}\n","import { Component, Output, EventEmitter, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { ApplicationIcon, DialogEvent } from 'libs/common/src/lib/types';\n\nexport interface ConfirmModalData {\n    /** Title of the modal */\n    title: string;\n    /** Contents of the modal */\n    content: string;\n    /** Text displaed on the confirmation button */\n    confirm_text?: string;\n    /** Text displaed on the confirmation button */\n    cancel_text?: string;\n    /** Icon to display on the modal */\n    icon: ApplicationIcon;\n}\n\nexport const CONFIRM_METADATA = {\n    height: 'auto',\n    width: '24em',\n    maxHeight: 'calc(100vh - 2em)',\n    maxWidth: 'calc(100vw - 2em)',\n};\n\n@Component({\n    selector: 'confirm-modal',\n    template: `\n        <header>\n            <h3>{{ title }}</h3>\n        </header>\n        <main\n            *ngIf=\"!loading; else load_state\"\n            class=\"flex flex-col items-center space-y-2 p-4\"\n        >\n            <app-icon [icon]=\"icon\" class=\"text-5xl\"></app-icon>\n            <p\n                content\n                class=\"text-center text-sm w-[22rem]\"\n                [innerHTML]=\"content\"\n            ></p>\n        </main>\n        <footer\n            class=\"flex items-center justify-center p-2 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button btn matRipple class=\"inverse w-32\" mat-dialog-close>\n                {{ cancel_text }}\n            </button>\n            <button\n                btn\n                matRipple\n                name=\"accept\"\n                class=\"w-32\"\n                (click)=\"onConfirm()\"\n            >\n                {{ confirm_text }}\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main loading>\n                <div\n                    class=\"w-full h-48 flex flex-col items-center justify-center space-y-2\"\n                >\n                    <mat-spinner diameter=\"32\"></mat-spinner>\n                    <p>{{ loading }}</p>\n                </div>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class ConfirmModalComponent {\n    /** Loading state */\n    public loading: string;\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Title of the confirm modal */\n    public readonly title: string = this._data.title || 'Confirm';\n    /** Body of the confirm modal */\n    public readonly content: string = this._data.content || 'Are you sure?';\n    /** Display text on the confirm button */\n    public readonly confirm_text: string = this._data.confirm_text || 'Accept';\n    /** Display text on the cancel button */\n    public readonly cancel_text: string = this._data.cancel_text || 'Cancel';\n    /** Display icon properties */\n    public readonly icon: ApplicationIcon = this._data.icon || {\n        class: 'material-icons',\n        content: 'done',\n    };\n    /** Prevent user from closing the modal */\n    public readonly disableClose = () => (this._dialog_ref.disableClose = true);\n    /** Allow the user to close the modal */\n    public readonly enableClose = () => (this._dialog_ref.disableClose = false);\n\n    constructor(\n        private _dialog_ref: MatDialogRef<ConfirmModalComponent>,\n        @Inject(MAT_DIALOG_DATA) private _data: ConfirmModalData\n    ) {}\n\n    /** User confirmation of the content of the modal */\n    public onConfirm() {\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import { FormGroup } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\nimport { first } from 'rxjs/operators';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA,\n} from '../../../components/src/lib/confirm-modal.component';\nimport { HashMap } from './types';\n\n/** Available console output streams. */\nexport type ConsoleStream = 'debug' | 'warn' | 'log' | 'error';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n        jest: any;\n    }\n}\n\nlet _app_name = 'APP';\n\nexport function setAppName(name: string) {\n    _app_name = name;\n}\n\n/**\n * Log data to the browser console\n * @param type Type of message\n * @param msg Message body\n * @param args array of argments to log to the console\n * @param stream Stream to emit the console on. 'debug', 'log', 'warn' or 'error'\n * @param force Whether to force message to be emitted when debug is disabled\n */\nexport function log(\n    type: string,\n    msg: string,\n    args?: any,\n    stream: ConsoleStream = 'debug',\n    force: boolean = false,\n    app_name: string = _app_name\n) {\n    if (window.jest) return;\n    if (window.debug || force) {\n        const colors: string[] = [\n            'color: #E91E63',\n            'color: #3F51B5',\n            'color: default',\n        ];\n        if (args) {\n            console[stream](\n                `%c[${app_name}]%c[${type}] %c${msg}`,\n                ...colors,\n                args\n            );\n        } else {\n            console[stream](`%c[${app_name}]%c[${type}] %c${msg}`, ...colors);\n        }\n    }\n}\n\n/**\n * Get item from the nested object\n * @param keys List of sub-keys to search for\n * @param map Object to search\n */\nexport function getItemWithKeys(keys: string[], map: HashMap) {\n    const key = keys[0];\n    if (map && key in map) {\n        return keys.length > 1\n            ? getItemWithKeys(keys.slice(1), map[key] || {})\n            : map[key];\n    }\n    return null;\n}\n\n/**\n * Remove duplicates from the given array\n * @param array List of items to remove duplicates from\n * @param key Key on array objects to compare for uniqueness\n */\nexport function unique<T = any>(array: T[] = [], key: string = ''): T[] {\n    const keys = [];\n    return array.filter((el) => {\n        const id = key ? el[key] : el;\n        const exists = keys.includes(id);\n        if (!exists) keys.push(id);\n        return !exists;\n    });\n}\n\n/**\n * Generate a random number\n * @param ceil Biggest value to generate not inclusive\n * @param floor Smallest value to generate. Defaults to 0\n */\nexport function randomInt(ceil: number, floor: number = 0) {\n    return Math.floor(Math.random() * (ceil - floor)) + floor;\n}\n\n/**\n * Pad string to the given length\n * @param str Base string\n * @param length Length to pad the string\n */\nexport function padString(str: string | number, length: number = 5) {\n    str = `${str}`;\n    while (str.length < length) str = `0${str}`;\n    return str;\n}\n\n/**\n * Generate a random string\n * @param length Length of the string\n * @param chars Available characters to use in the string\n */\nexport function randomString(\n    length: number,\n    chars: string = 'abcdefghijklmnopqrstwvxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n) {\n    let str = '';\n    for (let i = 0; i < length; i++) {\n        str += chars[randomInt(chars.length)];\n    }\n    return str;\n}\n\nexport interface ConfirmRepsonse {\n    reason: 'done' | '' | null;\n    loading: (_: string) => void;\n    close: () => void;\n}\n\nexport async function openConfirmModal(\n    data: ConfirmModalData,\n    dialog: MatDialog\n): Promise<ConfirmRepsonse> {\n    const ref = dialog.open<ConfirmModalComponent, ConfirmModalData>(\n        ConfirmModalComponent,\n        {\n            ...CONFIRM_METADATA,\n            data,\n        }\n    );\n    return {\n        ...(await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ])),\n        loading: (s) => (ref.componentInstance.loading = s),\n        close: () => ref.close(),\n    };\n}\n\n/**\n * Parse raw CSV data into a JSON object\n * @param csv CSV data to parse\n */\nexport function csvToJson(csv: string, delimiter: string = ','): HashMap[] {\n    const objPattern = new RegExp(\n        '(\\\\,|\\\\r?\\\\n|\\\\r|^)(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|([^\\\\,\\\\r\\\\n]*))',\n        'gi'\n    );\n    let arrMatches = null;\n    const arrData = [[]];\n    while ((arrMatches = objPattern.exec(csv))) {\n        if (arrMatches[1].length && arrMatches[1] !== ',') arrData.push([]);\n        arrData[arrData.length - 1].push(\n            arrMatches[2]\n                ? arrMatches[2].replace(new RegExp('\"\"', 'g'), '\"')\n                : arrMatches[3]\n        );\n    }\n    const headers: string[] = arrData.splice(0, 1)[0];\n    const elements = arrData.map((row) => {\n        const element = {};\n        for (let i = 0; i < row.length; i++) {\n            const key = (headers[i] || '').split(' ').join('_').toLowerCase();\n            try {\n                element[key] = JSON.parse(row[i]);\n            } catch (e) {\n                element[key] = row[i] || '';\n            }\n            if (element[key] === 'TRUE' || element[key] === 'FALSE')\n                element[key] = element[key] === 'TRUE';\n        }\n        return element;\n    });\n    return elements;\n}\n\nexport function loadTextFileFromInputEvent(event: InputEvent) {\n    return new Promise<string>((resolve, reject) => {\n        /* istanbul ignore else */\n        if (event.target) {\n            const element = event.target as HTMLInputElement;\n            const file = element.files[0];\n            /* istanbul ignore else */\n            if (file) {\n                const reader = new FileReader();\n                reader.readAsText(file, 'UTF-8');\n                reader.addEventListener('load', (evt) => {\n                    resolve((evt.srcElement as any).result);\n                    element.value = '';\n                });\n                reader.addEventListener('error', (_) => {\n                    this.loading = '';\n                    reject(['Error loading file', _]);\n                });\n            }\n        }\n    });\n}\n\n/**\n * Convert javascript array to CSV string\n * @param json Javascript array to convert\n */\nexport function jsonToCsv(json: HashMap[]) {\n    if (json instanceof Array && json.length > 0) {\n        const keys = Object.keys(json[0]);\n        const valid_keys = keys.filter((key) => key in json[0]);\n        return `${valid_keys.join(',')}\\n${json\n            .map((item) =>\n                valid_keys.map((key) => JSON.stringify(item[key])).join(',')\n            )\n            .join('\\n')}`;\n    }\n    return '';\n}\n\n/**\n * Downloads a file to the users computer with the given filename and contents\n * @param filename Name of the file to download\n * @param contents Contents of the file to download\n */\nexport function downloadFile(filename: string, contents: string) {\n    const element = document.createElement('a');\n    element.setAttribute(\n        'href',\n        'data:text/plain;charset=utf-8,' + encodeURIComponent(contents)\n    );\n    element.setAttribute('download', filename);\n\n    element.style.display = 'none';\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n}\n\nexport function parseJWT(token: string) {\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(\n        atob(base64)\n            .split('')\n            .map((c) => {\n                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n            })\n            .join('')\n    );\n    return JSON.parse(jsonPayload);\n}\n\n/* istanbul ignore next */\n/**\n * Flatten nested array\n * @param an_array Array to flatten\n */\nexport function flatten<T = any>(an_array: any[]): T[] {\n    const stack = [...an_array];\n    const res = [];\n    while (stack.length) {\n        // pop value from stack\n        const next = stack.pop();\n        if (Array.isArray(next)) {\n            // push back array items, won't modify the original input\n            stack.push(...next);\n        } else {\n            res.push(next);\n        }\n    }\n    // reverse to restore input order\n    return res.reverse();\n}\n\n/**\n * Check whether two time periods intersect with each other\n * @param start1 Unix epoch in ms of the first period's start time\n * @param end1 Unix epoch in ms of the first period's end time\n * @param start2 Unix epoch in ms of the second period's start time\n * @param end2 Unix epoch in ms of the second period's end time\n */\nexport function timePeriodsIntersect(start1, end1, start2, end2) {\n    return (\n        (start1 >= start2 && start1 < end2) ||\n        (end1 > start2 && end1 < end2) ||\n        (start2 >= start1 && start2 < end1) ||\n        (end2 > start1 && end2 <= end1)\n    );\n}\n\nconst seed = xmur3('PlaceOS');\nconst rand = sfc32(0x9e3779b9, 0x243f6a88, 0xb7e15162, seed());\n\nexport function predictableRandomInt(ceil: number = 100, floor: number = 0) {\n    return Math.floor(rand() * (ceil - floor)) + floor;\n}\n\n// https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript\nfunction xmur3(str) {\n    let h = 1779033703 ^ str.length;\n    for (let i = 0; i < str.length; i++)\n        (h = Math.imul(h ^ str.charCodeAt(i), 3432918353)),\n            (h = (h << 13) | (h >>> 19));\n    return function () {\n        h = Math.imul(h ^ (h >>> 16), 2246822507);\n        h = Math.imul(h ^ (h >>> 13), 3266489909);\n        return (h ^= h >>> 16) >>> 0;\n    };\n}\n\nfunction sfc32(a, b, c, d) {\n    return function () {\n        a >>>= 0;\n        b >>>= 0;\n        c >>>= 0;\n        d >>>= 0;\n        let t = (a + b) | 0;\n        a = b ^ (b >>> 9);\n        b = (c + (c << 3)) | 0;\n        c = (c << 21) | (c >>> 11);\n        d = (d + 1) | 0;\n        t = (t + d) | 0;\n        c = (c + t) | 0;\n        return (t >>> 0) / 4294967296;\n    };\n}\n\n/** Get time format string for locale */\nexport function timeFormatString(): string {\n    return is24HourTime() ? 'HH:mm' : 'h:mm a';\n}\n\n/** Whether locale string is displayed in 24 hour time */\nexport function is24HourTime(): boolean {\n    const date = new Date();\n    const localeString = date\n        .toLocaleTimeString(\n            document.querySelector('html').getAttribute('lang') ||\n                navigator.language\n        )\n        .toLowerCase();\n    return localeString.indexOf('am') < 0 && localeString.indexOf('pm') < 0;\n}\n\nexport function getInvalidFields(form: FormGroup, prefix: string = '') {\n    let invalid = [];\n    for (const key in form.controls) {\n        if (form.controls[key] instanceof FormGroup) {\n            invalid = [\n                ...invalid,\n                ...getInvalidFields(form.controls[key] as FormGroup, `${key}.`),\n            ];\n        } else if (!form.controls[key].valid) {\n            invalid.push(`${prefix}${key}`);\n        }\n    }\n    return invalid;\n}\n\nexport function removeEmptyFields(obj: Record<string, any>) {\n    for (const key in obj) {\n        if (obj[key] === undefined || obj[key] === null || obj[key] === '') {\n            delete obj[key];\n        }\n    }\n}\n\nexport function capitalizeFirstLetter(word: string): string {\n    return `${word[0].toUpperCase()}${word.substring(1)}`;\n}\n\nexport function cleanArray(\n    array: any[],\n    removal_items: any[] = [undefined, null, '']\n) {\n    return array.filter((_) => !removal_items.includes(_));\n}\n","import { Injectable } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\nimport { log } from './general';\n\ndeclare global {\n    interface Window {\n        ga: any;\n        gtag: any;\n        dataLayer: any[];\n        debug: boolean;\n    }\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class GoogleAnalyticsService {\n    /** Google Analytics API object */\n    private service: any;\n    /** Application prefix to add to event categories */\n    public app_prefix: string;\n    /** Whether posting analytics events is enabled */\n    public enabled = true;\n    /** Name of the application */\n    public app_name = 'GA_APP';\n\n    /** Last route posted to the API */\n    private last_route: string;\n    /** Store for timer ids */\n    private timers: { [name: string]: number } = {};\n\n    constructor(private title: Title) {}\n\n    public init(tracking_id: string = '') {\n        if (!window.gtag) {\n            window.dataLayer = window.dataLayer || [];\n            (function (w, d, s, l, i) {\n                w[l] = w[l] || [];\n                w[l].push({\n                    'gtm.start': new Date().getTime(),\n                    event: 'gtm.js',\n                });\n                var f = d.getElementsByTagName(s)[0],\n                    j = d.createElement(s) as any,\n                    dl = l != 'dataLayer' ? '&l=' + l : '';\n                j.async = true;\n                j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;\n                f.parentNode.insertBefore(j, f);\n            })(window, document, 'script', 'dataLayer', tracking_id);\n            log('Analytics', 'Service', 'Injected Google Analytics into page');\n        }\n        this.service = window.gtag;\n    }\n\n    public push(obj: Record<string, any>) {\n        window.dataLayer.push(obj);\n    }\n\n    /**\n     * Initialise Google Analytics\n     * @param tracking_id GA Tracking ID\n     */\n    public load(tracking_id: string) {\n        if (!this.enabled) {\n            throw new Error(\n                'Google Analytics needs to be enabled before being initialised'\n            );\n        }\n        if (!this.service) {\n            throw new Error(\n                \"Google Analytics hasn't been installed on this page\"\n            );\n        }\n        log('Analytics', 'Service', `Setup with tracking ID: ${tracking_id}`);\n        this.page('');\n    }\n    /**\n     * Set User ID for the Google Analytics session\n     * @param id Identifier of the User\n     */\n    public setUser(id: string) {\n        if (!this.service) {\n            throw new Error(\n                \"Google Analytics hasn't been installed on this page\"\n            );\n        }\n        if (this.enabled) {\n            this.timeout(\n                `user|${id}`,\n                () => {\n                    log('Analytics', 'Service', `Set user ID: ${id}`);\n                    this.service('set', 'userId', id);\n                    this.event('authentication', 'user-id available');\n                },\n                100\n            );\n        }\n    }\n\n    public send(type: string, value: Record<string, any>) {\n        if (!this.service) {\n            throw new Error(\n                \"Google Analytics hasn't been installed on this page\"\n            );\n        }\n        if (this.enabled) {\n            this.timeout(`end|${type}`, () => {\n                this.push({\n                    ...value,\n                    event: 'event',\n                });\n            });\n        }\n    }\n\n    /**\n     * Post event to Google Analytics API\n     * @param category Event Category\n     * @param action Event Action\n     * @param label Event Label\n     * @param value Event Value\n     */\n    public event(\n        category: string,\n        action: string,\n        label?: string,\n        value?: string\n    ) {\n        if (!this.service) {\n            throw new Error(\n                \"Google Analytics hasn't been installed on this page\"\n            );\n        }\n        if (this.enabled) {\n            this.timeout(\n                `event|${category}|${action}|${label}|${value}`,\n                () => {\n                    const l = label ? ', ' + label : '';\n                    log(\n                        'Analytics',\n                        'Service',\n                        `Event: ${category}, ${action}${l}${\n                            value ? ', ' + value : ''\n                        }`\n                    );\n                    const prefix = this.app_prefix ? this.app_prefix + '_' : '';\n                    this.push({\n                        event: 'event',\n                        category: category,\n                        action: action,\n                        label: label,\n                    });\n                },\n                100\n            );\n        }\n    }\n\n    /**\n     * Post screen change event to Google Analytics API\n     * @param name\n     * @param app_name\n     */\n    public screen(name: string, app_name?: string) {\n        if (!this.service) {\n            throw new Error(\n                \"Google Analytics hasn't been installed on this page\"\n            );\n        }\n        if (name && this.enabled) {\n            this.timeout(\n                `event|${name}|${app_name || this.app_name}`,\n                () => {\n                    log(\n                        'Analytics',\n                        'Service',\n                        `Screen: ${name}${app_name ? ', ' + app_name : ''}`\n                    );\n                    this.push({\n                        event: 'screenview',\n                        appName: app_name || this.app_name,\n                        screenName: name,\n                    });\n                },\n                100\n            );\n        }\n    }\n\n    /**\n     * Post routing event to Google Analytics API\n     * @param route Activated route\n     * @param origin Add origin to routh path\n     */\n    public page(route: string, origin: boolean = false) {\n        if (!this.service) {\n            throw new Error(\n                \"Google Analytics hasn't been installed on this page\"\n            );\n        }\n        if (this.enabled) {\n            this.last_route = route || '/';\n            this.timeout(\n                `page|${route}`,\n                () => {\n                    log('Analytics', 'Service', `Page: ${route}`);\n                    this.push({\n                        event: 'pageview',\n                        url: `${origin ? location.origin : ''}${route}`,\n                    });\n                },\n                100\n            );\n        }\n    }\n\n    /**\n     * Post timing event to Google Analytics API\n     * @param category\n     * @param variable\n     * @param value\n     * @param label\n     */\n    public timing(\n        category: string,\n        variable: string,\n        value: string,\n        label?: string\n    ) {\n        if (!this.service) {\n            throw new Error(\n                \"Google Analytics hasn't been installed on this page\"\n            );\n        }\n        if (this.enabled) {\n            this.timeout(\n                `page|${category}|${variable}|${value}|${label}`,\n                () => {\n                    log(\n                        'Analytics',\n                        'Service',\n                        `Timing: ${category}, ${variable}, ${value}${\n                            label ? ', ' + label : ''\n                        }`\n                    );\n                    this.push({\n                        event: 'timing',\n                        category,\n                        variable,\n                        value,\n                        label,\n                    });\n                },\n                100\n            );\n        }\n    }\n\n    /**\n     * Creates a timeout for the given name used for preventing duplicate events in quick succession\n     * @param name Name of timer\n     * @param fn Timer callback\n     * @param delay Timer delay\n     */\n    private timeout(name: string, fn: () => void, delay: number = 300) {\n        if (this.timers[name]) {\n            clearTimeout(this.timers[name]);\n            delete this.timers[name];\n        }\n        this.timers[name] = <any>setTimeout(() => {\n            if (fn instanceof Function) {\n                fn();\n            }\n            delete this.timers[name];\n        }, delay);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport { HashMap } from './types';\nimport { unique } from './general';\n\n/** List of keys that cannot be in a combination by themselves or with each other */\nconst INVALID_STANDALONE_KEYS: string[] = ['control', 'shift', 'alt', 'meta', 'os'];\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class HotkeysService {\n    /** Map of subjects which store press states of keys */\n    private keydown_states: HashMap<BehaviorSubject<number>> = {};\n    /** Map of obserers for key state subjects */\n    private keydown_observers: HashMap<Observable<number>> = {};\n    /** List of keys at the end of a combination */\n    private combo_end: string[] = [];\n    /** List of registered hotkey combinations */\n    private registered_combos: string[][] = [];\n    /** Counter for the number of keydown events. Used for checking order of key presses */\n    private counter: number = 0;\n    /** Last key code to be pressed */\n    private last_down: string;\n\n    constructor() {\n        window.addEventListener('keydown', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            if (this.last_down !== code) {\n                if (!this.keydown_states[code]) {\n                    this.keydown_states[code] = new BehaviorSubject(null);\n                    this.keydown_observers[code] = this.keydown_states[code].asObservable();\n                }\n                this.keydown_states[code].next(++this.counter);\n                if (this.combo_end.indexOf(code) >= 0) {\n                    event.preventDefault();\n                }\n                this.last_down = code;\n            }\n        });\n\n        window.addEventListener('keyup', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            this.keydown_states[code].next(null);\n            if (this.last_down === code) {\n                this.last_down = null;\n            }\n        });\n    }\n\n    /**\n     * Listen to the given key combination\n     * @param combo Array of key codes to listen to or a hotkey string e.g. `Alt+Shift+KeyK`\n     * @param next Callback for combination presses\n     */\n    public listen(combo: string | string[], next: () => void): Subscription {\n        combo = (combo instanceof Array ? combo : combo.split('+'));\n        const combination: string[] = combo.map(i => this.mapKey(i.toLowerCase()));\n        if (combination.length > 0 && this.validCombination(combination)) {\n            this.registered_combos.push(combination);\n            const last_key = combination[combination.length - 1];\n            if (!this.keydown_states[last_key]) {\n                this.keydown_states[last_key] = new BehaviorSubject(null);\n                this.keydown_observers[last_key] = this.keydown_states[last_key].asObservable();\n            }\n            this.updateCombinationEndList();\n            return this.keydown_observers[last_key].subscribe((count) => {\n                if (count) {\n                    const presses: number[] = [];\n                    if (combination.length > 0) {\n                        // Check that keys are pressed\n                        for (const key of combination) {\n                            const state = this.keydown_states[key];\n                            presses.push(state ? state.getValue() || -1 : -1);\n                        }\n                        // Check that keys are pressed in the correct order\n                        for (let i = 0; i < combination.length - 1; i++) {\n                            if (presses[i] > presses[i + 1]) { return; }\n                        }\n                    }\n                    const total = presses.reduce((a, v) => a + (v > 0 ? 1 : -1), 0);\n                    if (total >= combination.length) {\n                        next();\n                    }\n                }\n            });\n        }\n        return null;\n    }\n\n    /**\n     * Map key codes with multiple versions to simple form\n     * @param code Code to transform\n     */\n    private mapKey(code: string): string {\n        if (code.indexOf('alt') >= 0 || code.indexOf('shift') >= 0 || code.indexOf('control') >= 0) {\n            return code.replace('left', '').replace('right', '');\n        }\n        return code;\n    }\n\n    /**\n     * Update the list of the last keys in combinations to allow for prevent default actions on pre-existing hotkeys\n     */\n    private updateCombinationEndList(): void {\n        const key_list = [];\n        for (const combo of this.registered_combos) {\n            this.combo_end.push(combo[combo.length - 1]);\n        }\n        this.combo_end = unique(key_list);\n    }\n\n    /**\n     * Checks if the given hotkey combination is allowed and valid\n     * @param combo Array of key codes\n     */\n    private validCombination(combo: string[]): boolean {\n        let non_meta = 0;\n        for (const key of combo) {\n            if (INVALID_STANDALONE_KEYS.indexOf(key) < 0) {\n                non_meta++;\n            }\n        }\n        return non_meta > 0;\n    }\n}\n","\nconst general = {\n}\n\n\nconst app = {\n    name: 'Control',\n    title: 'PlaceOS',\n    description: 'Room Control UI',\n    short_name: 'PlaceOS',\n    logo: {\n        type: 'img',\n        src: 'assets/logo-light.svg'\n    },\n    logo_dark: {\n        type: 'img',\n        src: 'assets/logo-dark.svg'\n    },\n    general,\n    prevent_space_init: true\n}\n\n/**\n * ROOT SETTIGNS\n */\nexport const DEFAULT_SETTINGS = {\n    debug: true,\n    composer: {\n        domain: '',\n        route: '/control',\n        protocol: '',\n        port: '',\n        use_domain: false,\n        local_login: false,\n    },\n    app\n};\n","// IMPORTANT: THIS FILE IS AUTO GENERATED! DO NOT MANUALLY EDIT OR CHECKIN!\n/* tslint:disable */\nexport const VERSION = {\n    \"dirty\": false,\n    \"raw\": \"9c9482e\",\n    \"hash\": \"9c9482e\",\n    \"distance\": null,\n    \"tag\": null,\n    \"semver\": null,\n    \"suffix\": \"9c9482e\",\n    \"semverString\": null,\n    \"version\": \"1.12.0\",\n    \"time\": 1682919564766\n};\n/* tslint:enable */\n","import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { predictableRandomInt, unique } from '../../../common/src/lib/general';\n\nimport { GuestUser, User } from './user.class';\n\nlet USER_COUNT = 0;\n\ntype HashMap<T = any> = Record<string, T>;\n\nexport let USER_DOMAIN = '@place.tech';\n\nexport function setInternalUserDomain(domain: string) {\n    USER_DOMAIN = domain;\n}\n\nconst USER_EMAILS: string[] = [];\n/* istanbul ignore next */\n/**\n * Generate raw mock data for a user\n * @param id Forced ID for the mock\n * @param name Forced name for the user\n * @param external Whether user is external of the organisation\n */\nexport function generateMockUser(\n    id?: string,\n    name?: string,\n    external?: boolean\n): HashMap {\n    if (!id) {\n        id = `user-${USER_COUNT++}`;\n    }\n    if (!name) {\n        name = `User ${USER_COUNT}`;\n    }\n    if (external === undefined) {\n        external = !(predictableRandomInt(99999) % 2);\n    }\n    const organisation = external ? `Fake Co.` : USER_DOMAIN.split('.')[0];\n    let delegates: string[] = [];\n    const delegate_count = Math.min(\n        predictableRandomInt(4) + 1,\n        USER_EMAILS.length\n    );\n    for (let i = 0; i < delegate_count; i++) {\n        delegates.push(USER_EMAILS[predictableRandomInt(USER_EMAILS.length)]);\n    }\n    delegates = unique(delegates);\n    const email = `${name.split(' ').join('.').toLowerCase()}@${\n        external ? 'not-' : ''\n    }${USER_DOMAIN}`;\n    USER_EMAILS.push(email);\n    return {\n        id,\n        name,\n        first_name: name.split(' ')[0],\n        last_name: name.split(' ')[1],\n        email,\n        phone: `(02) 4567 8901`,\n        visitor: external,\n        organisation: {\n            id: organisation.split(' ').join('.').toLowerCase(),\n            name: organisation,\n        },\n        department: `Department ${predictableRandomInt(10)}`,\n        staff_code: predictableRandomInt(999_999),\n        delegates,\n        image: `${id}.png`,\n    };\n}\n\n/**\n * Generate form fields for the given user\n * @param user User to generate form for\n */\nexport function generateUserForm(user?: User) {\n    if (!user) {\n        throw Error('No user passed');\n    }\n\n    const fields = {\n        name: new FormControl(user.name || '', [Validators.required]),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(\n            user.phone || '',\n            Validators.pattern(/[+\\-()0-9]{1,24}/g)\n        ),\n        assistance_required: new FormControl(user.assistance_required || false),\n        visit_expected: new FormControl(user.visit_expected ?? true),\n    };\n\n    // Generate form group for the user\n    const form = new FormGroup(fields);\n    return form;\n}\n\nexport function generateGuestForm(\n    user: GuestUser = new GuestUser(),\n    host: string = ''\n) {\n    const fields = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(user.phone || ''),\n        host: new FormControl(host || '', [Validators.required]),\n    };\n    // Generate form group for the guest\n    const form = new FormGroup(fields);\n    return form;\n}\n","import { randomString } from 'libs/common/src/lib/general';\nimport { MapLocation } from './location.class';\nimport { USER_DOMAIN } from './user.utilities';\n\nexport interface Attachment {\n    id?: string;\n    name: string;\n    url: string;\n    size?: number;\n    created_at?: number;\n    progress?: number;\n}\n\nexport interface UserComplete extends User {\n    sys_admin?: boolean;\n    support?: boolean;\n}\n\nexport type EventResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted'\n    | '';\n\nexport class User {\n    /** ID of the user */\n    public readonly id: string;\n    /** Display name of the user */\n    public readonly name: string;\n    /** Email address of the user */\n    public readonly email: string;\n    /** First name of the user */\n    public readonly first_name: string;\n    /** Last name of the user */\n    public readonly last_name: string;\n    /** Username of the user */\n    public readonly username: string;\n    /** Phone number of the user */\n    public readonly phone: string;\n    /** Organisation associated with the user */\n    public readonly organisation: string;\n    /** Details about the user */\n    public readonly notes: string;\n    /** Organisation department of the user */\n    public readonly department: string;\n    /** URL to the user's photo */\n    public readonly photo: string;\n    /** Whether user attendance is required */\n    public readonly required: boolean;\n    /** Whether user is the event organiser */\n    public readonly organizer: boolean;\n    /** Whether the users is expected for an event */\n    public readonly response_status: EventResponseStatus;\n    /** Whether the users is expected for an event */\n    public visit_expected: boolean;\n    /** Whether user has been checked in */\n    public readonly checked_in: boolean;\n    /** Organisational groups that the user belongs */\n    public readonly groups: string[];\n    /** Extra metadata associated with the user */\n    public readonly extension_data: Record<string, any>;\n    /** Whether user is external from the organisation */\n    public readonly is_external: boolean;\n    /** Whether user needs assistance when attending an event */\n    public readonly assistance_required: boolean;\n    /** Whether user is a resource */\n    public readonly resource: boolean;\n\n    constructor(data: Partial<UserComplete> = {}) {\n        this.id = data.id || data.email || `USER::${randomString(8)}`;\n        this.name = data.name || '';\n        this.email = data.email || '';\n        this.first_name = data.first_name || data.name || '';\n        this.last_name = data.last_name || '';\n        this.phone = data.phone || '';\n        this.organisation = data.organisation || '';\n        this.notes = data.notes || '';\n        this.photo = data.photo || '';\n        this.username = data.username || '';\n        this.organizer = !!data.organizer;\n        this.checked_in = !!data.checked_in;\n        this.required = data.required ?? true;\n        this.resource = data.resource ?? false;\n        this.response_status = data.response_status || '';\n        const groups = data.groups || [];\n        this.department = data.department ?? '';\n        if (data.sys_admin) groups.push('placeos_admin');\n        if (data.support) groups.push('placeos_support');\n        if (data.department) groups.push(data.department);\n        this.groups = groups;\n        this.extension_data = data.extension_data || {};\n        this.extension_data.assistance_required =\n            data.assistance_required || this.extension_data.assistance_required;\n        this.is_external = !this.email?.endsWith(`${USER_DOMAIN}`);\n        this.visit_expected = data.visit_expected ?? true;\n        this.assistance_required = !!this.extension_data?.assistance_required;\n        for (const key in data) {\n            if (!(key in this)) this.extension_data[key] = data[key] as any;\n        }\n    }\n}\n\nexport class GuestUser extends User {\n    /** Preferred beverage of the guest */\n    public readonly preferred_beverage: string;\n    /** Whether guest has accepted the terms and conditions */\n    public readonly accepted_terms_conditions: boolean;\n    /** List of links to associated attachments */\n    public readonly attachments: Attachment[];\n    /** Status of the guest attendance */\n    public readonly status: 'pending' | 'approved' | 'declined';\n\n    constructor(data: Partial<GuestUser> = {}) {\n        super(data);\n        this.preferred_beverage = data.preferred_beverage || '';\n        this.accepted_terms_conditions =\n            data.accepted_terms_conditions || false;\n        this.attachments =\n            data.extension_data?.attachments || data.attachments || [];\n        this.status = data.extension_data?.status || data.status || 'pending';\n    }\n}\n\nexport class StaffUser extends User {\n    /** Number associated with the user's access card */\n    public readonly card_number: string;\n    /** ID of the user */\n    public readonly staff_id: string;\n    /** Whether user is logged in */\n    public readonly is_logged_in: boolean;\n    /** Location of the user */\n    public readonly location: Record<string, MapLocation>;\n\n    constructor(data: Partial<StaffUser> = {}) {\n        super(data);\n        this.card_number = data.card_number || '';\n        this.staff_id = data.staff_id || '';\n        this.location = data.location || {};\n        this.is_logged_in = !!data.is_logged_in;\n    }\n}\n","import { showUser } from '@placeos/ts-client';\nimport { BehaviorSubject } from 'rxjs';\nimport { delay, map, retry } from 'rxjs/operators';\n\nimport { StaffUser } from '../../../users/src/lib/user.class';\n\nconst EMPTY_USER = new StaffUser();\n\nconst _current_user = new BehaviorSubject<StaffUser>(null);\n\nexport const current_user = _current_user.asObservable();\n\ndeclare let jest;\n\nsetTimeout(() => {\n    try {\n        if (jest) return;\n    } catch {}\n    showUser('current')\n        .pipe(\n            delay(1000),\n            retry(10),\n            map((i) => new StaffUser(i))\n        )\n        .subscribe((user) => _current_user.next(user));\n}, 300);\n\n/** Get the current user details */\nexport function currentUser() {\n    return _current_user.getValue() || EMPTY_USER;\n}\n","import { Injectable, Optional } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { showMetadata, updateMetadata } from '@placeos/ts-client';\nimport { format, isSameDay } from 'date-fns';\nimport { first } from 'rxjs/operators';\n\nimport { log, getItemWithKeys, setAppName } from './general';\nimport { DEFAULT_SETTINGS } from './settings';\nimport { HashMap } from './types';\nimport { AsyncHandler } from './async-handler.class';\n\nimport { VERSION } from './version';\nimport { currentUser, current_user } from './user-state';\nimport { GoogleAnalyticsService } from './google-analytics.service';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n        application: HashMap;\n    }\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SettingsService extends AsyncHandler {\n    /** Name of the application */\n    private _app_name = 'PlaceOS';\n    /** List of override settings in order of priority */\n    private _overrides = new BehaviorSubject<HashMap[]>([]);\n    /** User's personal settings */\n    private _user_settings = new BehaviorSubject<HashMap>({});\n    /** Mapping of behaviour subjects */\n    private _subjects: HashMap<BehaviorSubject<any>> = {};\n    /** Mapping of observables */\n    private _observables: HashMap<Observable<any>> = {};\n    /** Mapping of pending settings */\n    private _pending_settings: HashMap = {};\n\n    /**\n     * @hidden\n     */\n    public set overrides(value: HashMap[]) {\n        this._overrides.next(value);\n        this._applyCssVariables();\n    }\n\n    /** Get observable for key */\n    public listen<T = any>(name: string): Observable<T> {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        return this._observables[name];\n    }\n\n    /** Update observable value for key */\n    public post<T>(name: string, value: T): void {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        this._subjects[name].next(value);\n    }\n\n    public value<T = any>(name: string): T {\n        return !this._observables[name]\n            ? null\n            : this._subjects[name].getValue();\n    }\n\n    /** Page title */\n    public get title() {\n        return this._title.getTitle();\n    }\n    public set title(value: string) {\n        this._title.setTitle(\n            `${value} | ${this.get('app.name') || this._app_name}`\n        );\n        const tracking_id = this.get('app.analytics.tracking_id');\n        if (!tracking_id) return;\n        this._analytics?.send('pagename', { title: value });\n    }\n\n    constructor(\n        private _title: Title,\n        @Optional() private _analytics: GoogleAnalyticsService\n    ) {\n        super();\n        const now = new Date();\n        const time = new Date(VERSION.time);\n        const built = isSameDay(now, time)\n            ? `Today at ${format(time, 'h:mma')}`\n            : format(time, 'do MMM yyyy, h:mma');\n        log('CORE', `${VERSION.semver}`, null, 'debug', true);\n        log('APP', `${VERSION.hash} | Built: ${built}`, null, 'debug', true);\n        this.init();\n    }\n\n    /**\n     * Initialise the settings\n     */\n    public async init() {\n        this._setDarkMode();\n        if (this.get('debug')) window.debug = true;\n        if (this.get('app')?.name) {\n            this._app_name = this.get('app').name;\n        }\n        this._app_name =\n            location.pathname.replace(/[\\\\\\/]/g, '').trim() || this._app_name;\n        setAppName(this._app_name.split('-').join('_').toUpperCase());\n        log('Settings', 'Successfully loaded settings');\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.settings = this;\n        }\n        this.subscription(\n            'user_settings',\n            this._user_settings.subscribe((_) => this._applyUserSettings(_))\n        );\n        const user = await current_user.pipe(first((_) => !!_)).toPromise();\n        const data = await showMetadata(user.id, 'settings').toPromise();\n        this._user_settings.next(data.details || {});\n        this._setDarkMode();\n        this._setFontSize();\n    }\n\n    /** Whether settings service has initialised */\n    public get app_name() {\n        return this._app_name;\n    }\n\n    /**\n     * Get a setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public get<T = any>(key: string): T {\n        const keys = key.split('.');\n        if (keys[0] !== 'app') {\n            return (\n                getItemWithKeys(keys, this._pending_settings) ??\n                getItemWithKeys(keys, this._user_settings.getValue()) ??\n                getItemWithKeys(keys, DEFAULT_SETTINGS)\n            );\n        }\n        const override_settings = [...this._overrides.getValue()];\n        for (const override of override_settings) {\n            const value = getItemWithKeys(keys.slice(1), override);\n            if (value != null) {\n                return value;\n            }\n        }\n        return getItemWithKeys(keys, DEFAULT_SETTINGS);\n    }\n\n    public saveUserSetting<T>(name: string, value: T) {\n        this._pending_settings[name] = value;\n        if (name === 'dark_mode') this._setDarkMode();\n        if (name === 'font_size') this._setFontSize();\n        this.timeout('save_settings', () => this._savePendingChanges(), 5000);\n    }\n\n    public overrideCssVariable(\n        key: string,\n        value: string,\n        important: boolean = false\n    ) {\n        let element = document.getElementById(`css-var-overrides+${key}`);\n        if (!element) {\n            element = document.createElement('style');\n            element.id = `css-var-overrides+${key}`;\n            document.head.appendChild(element);\n        }\n        element.innerText = `html, body { --${key}: ${value} ${\n            important ? '!important' : ''\n        }}`;\n    }\n\n    private _applyCssVariables() {\n        const variable_map = this.get('app.css_variables') || {};\n        let css_string = 'body { ';\n        for (const key in variable_map) {\n            css_string += `--${key}: ${variable_map[key]}; `;\n        }\n        css_string += '}';\n        let element = document.getElementById('css-var-overrides');\n        if (!element) {\n            element = document.createElement('style');\n            element.id = 'css-var-overrides';\n            document.head.appendChild(element);\n        }\n        element.innerText = css_string;\n    }\n\n    private async _savePendingChanges() {\n        const user = currentUser();\n        if (!user?.id || !Object.keys(this._pending_settings).length) return;\n        await updateMetadata(user.id, {\n            name: 'settings',\n            description: '',\n            details: {\n                ...this._user_settings.getValue(),\n                ...this._pending_settings,\n            },\n        }).toPromise();\n        this._user_settings.next({\n            ...this._user_settings.getValue(),\n            ...this._pending_settings,\n        });\n        this._pending_settings = {};\n    }\n\n    private async _applyUserSettings(settings: HashMap) {\n        if (settings.font_size) {\n        }\n    }\n\n    private _setFontSize() {\n        if (!this.get('font_size')) return;\n        this.overrideCssVariable('font-size', `${this.get('font_size')}px`);\n    }\n\n    private _setDarkMode() {\n        // const os_dark = false; // window?.matchMedia ? window?.matchMedia('(prefers-color-scheme: dark)')?.matches : false;\n        // if (this.get('dark_mode') ?? os_dark) {\n        //     document.body.classList.add('dark');\n        // } else {\n        //     document.body.classList.remove('dark');\n        // }\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { getModule } from '@placeos/ts-client';\n\nimport { AsyncHandler } from './async-handler.class';\nimport { SettingsService } from './settings.service';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class VorlonService extends AsyncHandler {\n    /** DOM Element containing the Vorlon Script */\n    private _script: HTMLScriptElement;\n\n    constructor(private _settings: SettingsService) {\n        super();\n        this.load();\n    }\n\n    private async load() {\n        const system = this._settings.get('app.vorlon.system');\n        if (system) {\n            const module = getModule(system, 'Vorlon');\n            if (module) {\n                const binding = module.binding('enabled');\n                this.subscription('binding', binding.bind());\n                this.subscription(\n                    'binding_value',\n                    binding.listen().subscribe((state) => {\n                        state\n                            ? this.injectVorlonScript()\n                            : this.removeVorlonScript();\n                    })\n                );\n            }\n        }\n    }\n\n    private injectVorlonScript() {\n        this.removeVorlonScript();\n        this._script = document.createElement('script');\n        const url = this._settings.get('app.vorlon.url');\n        this._script.src = url || `./assets/vorlon.js`;\n        document.head.appendChild(this._script);\n    }\n\n    private removeVorlonScript() {\n        if (this._script) {\n            this._script.parentNode.removeChild(this._script);\n            delete this._script;\n            this._script = null;\n        }\n    }\n}\n","import { HashMap } from \"./types\";\n\n/**\n * Convert map into a query string\n * @param map Key value pairs to convert\n */\nexport function toQueryString(map: HashMap) {\n    let str = '';\n    if (map) {\n        for (const key in map) {\n            if (key in map && map[key] !== undefined && map[key] !== null) {\n                str += `${(str ? '&' : '')}${key}=${encodeURIComponent(map[key])}`;\n            }\n        }\n    }\n    return str;\n}\n","import { trigger, transition, style, animate, state } from '@angular/animations';\n\nexport const ANIMATION_SHOW_ENTER_LEAVE = trigger('show', [\n    transition(':enter', [\n        style({ opacity: 0, height: 0 }),\n        animate(300, style({ opacity: 1, height: '*' }))\n    ]),\n    transition(':leave', [\n        style({ opacity: 1, height: '*' }),\n        animate(300, style({ opacity: 0, height: 0 }))\n    ])\n]);\n\nexport const ANIMATION_SHOW_CONTRACT_EXPAND = trigger('show', [\n    state('show', style({ opacity: 1, height: '*' })),\n    state('hide', style({ opacity: 0, height: 0, 'pointer-events': 'none' })),\n    transition('show <=> hide', animate('200ms ease-in'))\n]);\n","import { MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';\n\nlet _service: MatSnackBar;\nlet _disable_logging = false;\n\ndeclare let jest: any;\n\nexport function setNotifyOutlet(\n    snackbar: MatSnackBar,\n    disable_logging = false\n) {\n    _service = snackbar;\n    _disable_logging = disable_logging;\n}\n\n/**\n * Create notification popup\n * @param type CSS Class to add to the notification\n * @param message Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notify(\n    type: string,\n    message: string,\n    action: string = 'OK',\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    if (!_service) {\n        return (\n            !_disable_logging &&\n            console.warn(\"Snackbar service hasn't been initialised\")\n        );\n    }\n    const snackbar_ref = _service.open(message, action, {\n        panelClass: [type],\n        duration: 5000,\n        ...config,\n    });\n    if (action) {\n        on_action = on_action || (() => snackbar_ref.dismiss());\n        snackbar_ref.onAction().subscribe(() => on_action());\n    }\n}\n\n/**\n * Create success notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifySuccess(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    !_disable_logging && console.debug(msg);\n    if (typeof msg !== 'string') msg = 'Success';\n    notify('success', msg, action, on_action, config);\n}\n\n/**\n * Create error notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyError(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    !_disable_logging && console.error(msg);\n    if (typeof msg !== 'string')\n        msg =\n            (msg as any)?.error || (msg as any)?.message || 'An error occurred';\n    notify('error', msg, action, on_action, config);\n}\n\n/**\n * Create warning notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyWarn(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    !_disable_logging && console.warn(msg);\n    notify('warn', msg, action, on_action, config);\n}\n\n/**\n * Create info notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyInfo(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    !_disable_logging && console.info(msg);\n    notify('info', msg, action, on_action, config);\n}\n","import { SwUpdate } from '@angular/service-worker';\n\nimport { log } from './general';\nimport { notifyInfo } from './notifications';\n\nlet _timer: number;\n\n/**\n * Setup handler for cache change events\n * @param cache Angular Service worker service\n * @param notify Function to call on changes to the cache\n * @param interval Time interval to check the cache for changes\n */\nexport function setupCache(\n    cache: SwUpdate,\n    interval: number = 5 * 60 * 1000\n) {\n    if (cache.isEnabled) {\n        if (_timer) clearInterval(_timer);\n        _timer = <any>setInterval(() => {\n            log('CACHE', `Checking for updates...`);\n            activateUpdate(cache);\n        }, interval);\n    }\n}\n\nexport function clearCacheCheck() {\n    if (_timer) clearInterval(_timer);\n}\n\n/**\n * Update the cache and reload the page\n *\n */\nasync function activateUpdate(cache: SwUpdate) {\n    if (cache.isEnabled && await cache.checkForUpdate()) {\n        log('CACHE', `Activating changes to the cache...`);\n        if (!await cache.activateUpdate()) return;\n        notifyInfo('Newer version of the application is available', 'Refresh', () =>\n            location.reload()\n        );\n    }\n}\n","import { PlaceAuthOptions, setup } from '@placeos/ts-client';\nimport { notifyInfo } from './notifications';\n\nexport interface PlaceSettings {\n    /** Protocol used by the application server */\n    protocol: 'http:' | 'https:';\n    /** Domain that the API server lies  */\n    domain: string;\n    /** Port number of the API server */\n    port: number;\n    /** Route on domain application rests */\n    route: string;\n    /** Whether to use the settings domain for auth */\n    use_domain: boolean;\n    /** Whether login is handled locally by the application */\n    local_login: boolean;\n    /** Whether application should mock out API requests */\n    mock: boolean;\n\n    storage?: 'session' | 'local';\n}\n\n/**\n * Initialise the PlaceOS API library\n */\nexport async function setupPlace(settings: PlaceSettings): Promise<void> {\n    const protocol = settings.protocol || location.protocol;\n    const host = settings.domain || location.hostname;\n    const port = settings.port || location.port;\n    const url = settings.use_domain\n        ? `${protocol}//${host}:${port}`\n        : location.origin;\n    const route = (location.pathname + '/').replace('//', '/');\n    const mock =\n        settings.mock ||\n        location.href.includes('mock=true') ||\n        localStorage.getItem('mock') === 'true';\n    // Generate configuration object\n    const config: PlaceAuthOptions = {\n        auth_type: 'auth_code',\n        scope: 'public',\n        host: `${host}${port ? ':' + port : ''}`,\n        auth_uri: `${url}/auth/oauth/authorize`,\n        token_uri: `${url}/auth/oauth/token`,\n        redirect_uri: `${location.origin}${route}oauth-resp.html`,\n        handle_login: !settings.local_login,\n        use_iframe: true,\n        mock,\n    };\n    if (localStorage) {\n        localStorage.setItem(\n            'mock',\n            `${!!mock && !location.href.includes('mock=false')}`\n        );\n    }\n    if (mock) {\n        notifyInfo('Application in mock mode.');\n    }\n    return setup(config);\n}\n","\n/** Building Level data */\nexport class BuildingLevel {\n    /** ID of the building level zone */\n    public readonly id: string;\n    /** ID of the building zone associated with the level */\n    public readonly parent_id: string;\n    /** Name of the level */\n    public readonly name: string;\n    /** Display name */\n    public readonly display_name: string;\n    /** Capacity for the level */\n    public readonly capacity: number;\n    /** Number or letter representing the level */\n    public readonly number: string;\n    /** URL of the map associated with the level */\n    public readonly map_id: string;\n    /** URL of the map associated with the level */\n    public readonly tags: string[];\n    /** Settings overrides associated with the level */\n    public readonly settings: Record<string, any> = {};\n    /** List of image URLs for the level */\n    public readonly images: string[];\n    /** List of points of interest for the level */\n    public readonly locations: readonly { id: string, name: string }[];\n\n    constructor(_data: Partial<BuildingLevel> = {}) {\n        this.id = _data.id || '';\n        this.parent_id = _data.parent_id || '';\n        this.name = _data.name || '';\n        this.display_name = _data.display_name || '';\n        this.map_id = _data.map_id || '';\n        this.capacity = _data.capacity || 0;\n        this.locations = _data.locations || [];\n        this.tags = _data.tags || [];\n        this.images = _data.images || [];\n        const parts = this.display_name.split(' ');\n        this.number =\n            (parts.length >= 2\n                ? parts[parts.length - 1]\n                : this.display_name[0]\n            )?.toUpperCase() || '';\n    }\n}\n","import { getItemWithKeys } from 'libs/common/src/lib/general';\n\nexport interface OrganisationComplete extends Organisation {\n    settings?: Record<string, any>;\n}\n\nexport class Organisation {\n    /** PlaceOS zone id of the building */\n    public readonly id: string;\n    /** Name of the building zone */\n    public readonly name: string;\n    /** Description for the Organisation */\n    public readonly description: string;\n    /** Tags for the Organisation */\n    public readonly tags: string[];\n    /** Count for the Organisation */\n    public readonly count: number;\n    /** Capacity for the Organisation */\n    public readonly capacity: number;\n    /** PlaceOS bindings for applications */\n    public readonly bindings: Record<string, string>;\n    /** Map of custom settings for the building */\n    private _settings: Record<string, any>;\n\n    constructor(raw_data: Partial<OrganisationComplete> = {}) {\n        this.id = raw_data.id || '';\n        this.name = raw_data.name || '';\n        this.description = raw_data.description || '';\n        this.tags = raw_data.tags || [];\n        this.count = raw_data.count || 0;\n        this.capacity = raw_data.capacity || 0;\n        this.bindings = raw_data.bindings || {};\n        this._settings = raw_data.settings || {};\n    }\n\n    /**\n     * Get a custom organisation setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public setting(key: string): any {\n        const keys = key.split('.');\n        const value = getItemWithKeys(keys, this._settings);\n        return value;\n    }\n}\n","import { BookingRulesmap } from 'libs/events/src/lib/event.interfaces';\n\nimport { BuildingLevel } from './level.class';\n\ninterface Identity {\n    id: string;\n    name: string;\n}\ninterface RoomConfiguration {\n    id: string;\n    name?: string;\n    description?: string;\n    capacity?: number;\n}\n\nexport interface IBuildingRoleUser {\n    name: string;\n    email: string;\n    phone: string;\n}\n\nexport interface LockerMap {\n    [zone: string]: {\n        [area: string]: {\n            [type: string]: (string | boolean)[][];\n        };\n    };\n}\n\nexport interface ICoordinates {\n    longitude: number;\n    latitude: number;\n}\n\nexport interface LevelFeature {\n    id: string;\n    level_id: string;\n    name: string;\n}\n\nexport interface BookingRuleDetails {\n    /** List of booking rules details for the building */\n    readonly rules: readonly string[];\n    /** Custom booking rules for the map */\n    readonly map_rules?: readonly string[];\n    /** Contact email address for the building */\n    readonly contact?: string;\n    /** Information string to display before the rule listings */\n    readonly info?: string;\n}\n\nexport interface BuildingComplete extends Building {\n    settings: Record<string, any>;\n    locker_structure: Record<string, any>;\n    roles: Record<string, any>;\n    zone: string;\n    location: string;\n    neighbourhoods: Record<string, any>;\n}\n\nexport class Building {\n    /** PlaceOS zone id of the building */\n    public readonly id: string;\n    /** PlaceOS zone id of the building */\n    public readonly parent_id: string;\n    /** Name of the building zone */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Engine Zone ID for the building */\n    public readonly zone_id: string;\n    /** Organisation Code for the building */\n    public readonly code: string;\n    /** Geographical address of the building */\n    public readonly address: string;\n    /** IANA timezone string for building */\n    public readonly timezone: string;\n    /** ID of space that temporarily holds new meetings */\n    public readonly holding_bay: string;\n    /** ID of the space for assigning new visitor bookings to */\n    public readonly visitor_space: string;\n    /** Details about the booking rules for the building */\n    public readonly booking_details: BookingRuleDetails;\n    /** Details about the booking rules for the building */\n    public readonly booking_rules: BookingRulesmap;\n    /** Number of hour before a booking catering is restricted */\n    public readonly catering_restricted_from: number;\n    /** Currency code for the country assoicated with the building */\n    public readonly currency: string;\n    /** List of available extras for the building */\n    public readonly extras: readonly Identity[];\n    /** List of available extra equipment for loan at the building */\n    public readonly loan_items: readonly Identity[];\n    /** List of available levels for the building */\n    public readonly levels: readonly BuildingLevel[];\n    /** List of zones associated with the building */\n    public readonly zones: readonly string[];\n    /** Searchable map features */\n    public readonly searchables: readonly LevelFeature[];\n    /** List of available room configurations for the building */\n    public readonly room_configurations: readonly RoomConfiguration[];\n    /** Start and end hours catering can be delivered */\n    public readonly catering_hours: { start: number; end: number };\n    /** PlaceOS bindings for applications */\n    public readonly bindings: Record<string, string>;\n    /** List of image URLs for the building */\n    public readonly images: string[];\n\n    public readonly orientations: Record<string, number>;\n    public readonly attributes: readonly Identity[];\n    /** Globe coordiates for the build */\n    public location: string;\n    /** Map of roles and list of the associated users */\n    private _roles: Record<string, IBuildingRoleUser[]>;\n    /** Map of the locker ID arrays */\n    private _lockers: LockerMap;\n    /** Map of important system ids for the building */\n    private _systems: Record<string, string>;\n    /** Map of important phone numbers for the building */\n    private _phone_numbers: Record<string, string>;\n\n    constructor(raw_data: Partial<BuildingComplete> = {}) {\n        this.id = raw_data.id || '';\n        this.parent_id = raw_data.parent_id || '';\n        this.name = raw_data.name || '';\n        const settings = raw_data.settings || {};\n        this.display_name = raw_data.display_name;\n        this.images = this.images || [];\n        const disc_info = settings.discovery_info || settings;\n        this.zone_id = raw_data.zone_id || raw_data.zone;\n        this.extras = (raw_data.extras || disc_info.extras || []).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.loan_items = (\n            raw_data.loan_items ||\n            disc_info.loan_items ||\n            []\n        ).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.levels = (raw_data.levels || disc_info.levels || []).map(\n            (i) => new BuildingLevel({ ...i, building_id: this.id })\n        );\n        this._roles = raw_data.roles || disc_info.roles || {};\n        this._lockers =\n            raw_data.lockers ||\n            raw_data.locker_structure ||\n            disc_info.locker_structure ||\n            {};\n        this._systems = raw_data.systems || disc_info.systems || {};\n        this._phone_numbers =\n            raw_data.phone_numbers || disc_info.phone_numbers || {};\n        this.location = raw_data.location || disc_info.location || '0,0';\n        this.room_configurations =\n            raw_data.room_configurations || disc_info.room_configurations || [];\n        this.attributes = raw_data.attributes || disc_info.attributes || [];\n        const searchables = [];\n        if (raw_data.neighbourhoods) {\n            for (const lvl in raw_data.neighbourhoods) {\n                if (lvl in raw_data.neighbourhoods) {\n                    const lvl_features = raw_data.neighbourhoods[lvl] || {};\n                    for (const feature in lvl_features) {\n                        if (feature in lvl_features) {\n                            searchables.push({\n                                id: lvl_features[feature],\n                                name: feature,\n                                level_id: lvl,\n                            });\n                        }\n                    }\n                }\n            }\n        }\n        this.bindings = raw_data.bindings || {};\n        this.searchables = searchables;\n        this.timezone =\n            raw_data.timezone || disc_info.timezone || settings.timezone || '';\n        this.catering_hours = raw_data.catering_hours ||\n            disc_info.catering_hours ||\n            settings.catering_hours || { start: 7, end: 20 };\n        this.visitor_space =\n            raw_data.visitor_space ||\n            disc_info.visitor_space ||\n            settings.visitor_space ||\n            '';\n        this.holding_bay =\n            raw_data.holding_bay ||\n            disc_info.holding_bay ||\n            settings.holding_bay ||\n            '';\n        this.code = raw_data.code || disc_info.code || settings.code || '';\n        this.address =\n            raw_data.address || disc_info.address || settings.address || '';\n        this.orientations =\n            raw_data.orientations ||\n            disc_info.orientations ||\n            settings.orientations ||\n            {};\n        this.booking_details =\n            raw_data.booking_details ||\n            disc_info.booking_details ||\n            settings.booking_details ||\n            null;\n        this.booking_rules =\n            raw_data.booking_rules ||\n            disc_info.booking_rules ||\n            settings.booking_rules ||\n            {};\n        this.catering_restricted_from =\n            raw_data.catering_restricted_from ||\n            disc_info.catering_restricted_from ||\n            settings.catering_restricted_from ||\n            -1440;\n        this.currency =\n            raw_data.currency ||\n            disc_info.currency ||\n            settings.currency ||\n            'USD';\n    }\n\n    /**\n     * Get list of users with the associated role\n     * @param name Role to find users for\n     */\n    public role(name: string): IBuildingRoleUser[] {\n        return [...(this._roles[name] || [])];\n    }\n    /**\n     * Get list of the names of available user role lists\n     */\n    public get role_names(): string[] {\n        return Object.keys(this._roles).filter((i) => i in this._roles);\n    }\n    /** Map of the locker ID arrays */\n    public get lockers(): LockerMap {\n        return { ...(this._lockers || {}) };\n    }\n    /** Map of important system ids for the building */\n    public get systems(): Record<string, string> {\n        return { ...(this._systems || {}) };\n    }\n    /** Map of important phone numbers for the building */\n    public get phone_numbers(): Record<string, string> {\n        return { ...(this._phone_numbers || {}) };\n    }\n\n    /**\n     * Get search map feature for the given level ID\n     * @param level_id ID of level to grab features for\n     */\n    public featuresForLevel(level_id: string): LevelFeature[] {\n        return (this.searchables || []).filter((i) => i.level_id === level_id);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport {\n    authority,\n    isMock,\n    onlineState,\n    queryZones,\n    showMetadata,\n} from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest, of } from 'rxjs';\nimport { catchError, first, map } from 'rxjs/operators';\n\nimport { notifyError } from 'libs/common/src/lib/notifications';\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport { RoomConfiguration } from 'libs/common/src/lib/room-configuration.interface';\n\nimport { Building } from './building.class';\nimport { BuildingLevel } from './level.class';\nimport { Organisation } from './organisation.class';\nimport { Region } from './region.class';\nimport { flatten, log } from '@placeos/common';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class OrganisationService {\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    private readonly _regions = new BehaviorSubject<Region[]>([]);\n    private readonly _active_region = new BehaviorSubject<Region>(null);\n    private readonly _buildings = new BehaviorSubject<Building[]>([]);\n    private readonly _active_building = new BehaviorSubject<Building>(null);\n    private readonly _levels = new BehaviorSubject<BuildingLevel[]>([]);\n\n    /** Observable for the list of regions */\n    public readonly region_list = this._regions.asObservable();\n    /** Observable for the list of buildings */\n    public readonly building_list = this._buildings.asObservable();\n    /** Observable for the list of levels */\n    public readonly level_list = this._levels.asObservable();\n    /** Observable for the currently active region */\n    public readonly active_region = this._active_region.asObservable();\n    /** Observable for the currently active building */\n    public readonly active_building = this._active_building.asObservable();\n    /** Observable for the buildings associated with the currently active region */\n    public readonly active_buildings = combineLatest([\n        this._buildings,\n        this._active_region,\n    ]).pipe(\n        map(([_, region]) =>\n            region ? this.buildingsForRegion(region) : this.buildings\n        )\n    );\n    /** Observable for the levels associated with the currently active building */\n    public readonly active_levels = combineLatest([\n        this._levels,\n        this._active_building,\n    ]).pipe(map(([_, bld]) => (bld ? this.levelsForBuilding(bld) : [])));\n    /** Organisation data for the application */\n    private _organisation: Organisation;\n    /** Mapping of organisation settings overrides */\n    private _settings: Record<string, any>[] = [];\n    /** Mapping of regions to settings overrides */\n    private _region_settings: Record<string, Record<string, any>> = {};\n    /** Mapping of buildings to settings overrides */\n    private _building_settings: Record<string, Record<string, any>> = {};\n\n    /** Mapping of organisation settings overrides */\n    public get settings() {\n        return this._settings;\n    }\n\n    /** Mapping of regions to settings overrides */\n    public get region_settings() {\n        return this._region_settings;\n    }\n\n    /** Mapping of buildings to settings overrides */\n    public get building_settings() {\n        return this._building_settings;\n    }\n\n    /** Mapping region settings overrides */\n    public regionSettings(id: string = ''): Record<string, any> {\n        const region = this._active_region.getValue();\n        if (!id && region) id = region?.id;\n        return this._region_settings ? this._region_settings[id] || {} : {};\n    }\n\n    /** Mapping building settings overrides */\n    public buildingSettings(bld_id: string = ''): Record<string, any> {\n        if (!bld_id && this.building) {\n            bld_id = this.building?.id;\n        }\n        return this._building_settings\n            ? this._building_settings[bld_id] || {}\n            : {};\n    }\n\n    /** Organisation data for the application */\n    public get organisation(): Organisation {\n        return this._organisation;\n    }\n\n    /** List of available regions */\n    public get regions(): Region[] {\n        return this._regions.getValue();\n    }\n\n    /** Currently active region */\n    public get region(): Region {\n        return this._active_region.getValue();\n    }\n    public set region(item: Region) {\n        if (!item) return;\n        this._active_region.next(item);\n        if (\n            this.building?.parent_id !== item.id &&\n            this.buildingsForRegion(item).length\n        ) {\n            this.building = this.buildingsForRegion(item)[0];\n        } else this._updateSettingOverrides();\n    }\n\n    /** List of available buildings */\n    public get buildings(): Building[] {\n        return this._buildings.getValue() || [];\n    }\n\n    /** Currently active building */\n    public get building(): Building {\n        return this._active_building.getValue();\n    }\n    public set building(bld: Building) {\n        this._active_building.next(bld);\n        this._updateSettingOverrides();\n        if (this.regions.length && this.region?.id !== bld.parent_id) {\n            this.region = this.regions.find(\n                (_) => _.id === this.building.parent_id\n            );\n        }\n    }\n\n    public get timezone() {\n        return Intl.DateTimeFormat().resolvedOptions().timeZone;\n    }\n\n    public get currency_code(): string {\n        return (\n            this._service.get('app.currency') || this.building.currency || 'USD'\n        );\n    }\n\n    /** Get binding value from the building/organisation */\n    public binding(name: string) {\n        return (\n            this.building?.bindings[name] || this._organisation?.bindings[name]\n        );\n    }\n\n    /** Get building by id */\n    public find(id: string) {\n        return this.buildings.find((i) => i.id === id);\n    }\n\n    /** List of available levels */\n    public get levels(): BuildingLevel[] {\n        return this._levels.getValue();\n    }\n\n    constructor(private _service: SettingsService, private _router: Router) {\n        onlineState()\n            .pipe(first((_) => _))\n            .subscribe(() => setTimeout(() => this.init(), 1000));\n        this.active_building.subscribe((bld) => {\n            if (bld) {\n                this._service.overrides = [\n                    ...this._settings,\n                    this.buildingSettings(bld.id),\n                ];\n            }\n        });\n    }\n\n    /**\n     * Get level with a matching ID\n     * @param id_list List of IDs to find a match\n     */\n    public levelWithID(id_list: string[]): BuildingLevel {\n        return this.levels.find((lvl) => id_list?.includes(lvl.id));\n    }\n\n    /**\n     * Get list of levels for the given building\n     * @param bld Building to list levels for\n     */\n    public levelsForBuilding(bld: Building = this.building): BuildingLevel[] {\n        return this.levels.filter((lvl) => lvl.parent_id === bld?.id);\n    }\n\n    /**\n     * Get list of buildings for the given region\n     * @param region Region to list buildings for\n     */\n    public buildingsForRegion(region: Region = this.region): Building[] {\n        return this.buildings.filter((bld) => bld.parent_id === region?.id);\n    }\n\n    private async init(tries: number = 0) {\n        this._initialised.next(false);\n        await this.load().catch((err) => {\n            notifyError('Error loading organisation data. Retrying...');\n            setTimeout(() => this.init(tries), Math.min(10_000, 300 * ++tries));\n            throw err;\n        });\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.orgs = this;\n        }\n    }\n\n    /**\n     * Initialise service data\n     */\n    private async load(): Promise<void> {\n        await this.loadOrganisation();\n        await this.loadRegions();\n        if (this._regions.getValue().length) {\n            this._buildings.next(\n                flatten(\n                    await Promise.all(\n                        this._regions\n                            .getValue()\n                            .map((_) => this.loadBuildings(_.id))\n                    )\n                )\n            );\n        } else {\n            this._buildings.next(await this.loadBuildings());\n        }\n        if (!this._buildings.getValue()?.length) {\n            log('ORG', 'Unable to find any building zones');\n            this._router.navigate(['/misconfigured']);\n        }\n        await this.loadLevels();\n        await this.loadSettings();\n    }\n\n    /**\n     * Load organisation data for application\n     */\n    public async loadOrganisation(): Promise<void> {\n        const org_list = await queryZones({ tags: 'org' })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (org_list.length) {\n            const auth = authority();\n            const org =\n                org_list.find(\n                    (list) => isMock() || list.id === auth?.config?.org_zone\n                ) || org_list[0];\n            const bindings: Record<string, any> = (\n                await showMetadata(org.id, 'bindings').toPromise()\n            )?.details;\n            this._organisation = new Organisation({ ...org, bindings });\n        } else {\n            log('ORG', 'Unable to find organisation');\n            this._router.navigate(['/misconfigured']);\n        }\n    }\n\n    /**\n     * Load region data for the organisation\n     */\n    public async loadRegions(): Promise<void> {\n        const list = await queryZones({\n            tags: 'region',\n            parent_id: this._organisation?.id || '',\n            limit: 500,\n        } as any)\n            .pipe(\n                map((i) => i.data),\n                catchError(() => of([]))\n            )\n            .toPromise();\n        const regions = [];\n        for (const item of list) {\n            const bindings: Record<string, any> = (\n                await showMetadata(item.id, 'bindings').toPromise()\n            )?.details;\n            regions.push(new Building({ ...item, bindings }));\n        }\n        this._regions.next(regions);\n    }\n\n    /**\n     * Load buildings data for the organisation\n     */\n    public async loadBuildings(\n        parent_id: string = this._organisation?.id\n    ): Promise<Building[]> {\n        const building_list = await queryZones({\n            tags: 'building',\n            parent_id,\n            limit: 500,\n        } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n        const buildings = [];\n        for (const bld of building_list) {\n            const bindings: Record<string, any> = (\n                await showMetadata(bld.id, 'bindings').toPromise()\n            )?.details;\n            buildings.push(new Building({ ...bld, bindings }));\n        }\n        return buildings;\n    }\n\n    /**\n     * Load levels data for the buildings\n     */\n    public async loadLevels(): Promise<void> {\n        const level_list = await queryZones({\n            tags: 'level',\n            limit: 2500,\n        } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n\n        if (!level_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const levels = level_list\n            .filter(\n                (lvl) =>\n                    !!this.buildings.find((bld) => bld.id === lvl.parent_id)\n            )\n            .map((lvl) => new BuildingLevel(lvl));\n        levels.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\n        this._levels.next(levels);\n    }\n\n    public get available_room_configs(): RoomConfiguration[] {\n        return this.buildings\n            .map((m) => [...m.room_configurations])\n            .reduce((prev, curr) => prev.concat(curr), [])\n            .sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    public async loadSettings() {\n        if (!this._organisation) return;\n        const app_name = `${(\n            this._service.app_name || 'workplace'\n        ).toLowerCase()}_app`;\n        const app_settings = (\n            await showMetadata(this._organisation?.id, app_name).toPromise()\n        )?.details;\n        const global_settings = (\n            await showMetadata(this._organisation?.id, 'settings').toPromise()\n        )?.details;\n        this._settings = [global_settings, app_settings];\n        const regions = this.regions;\n        for (const item of regions) {\n            this._region_settings[item.id] = (\n                await showMetadata(item.id, app_name).toPromise()\n            )?.details;\n        }\n        const buildings = this.buildings;\n        for (const bld of buildings) {\n            this._building_settings[bld.id] = (\n                await showMetadata(bld.id, app_name).toPromise()\n            )?.details;\n        }\n        this._service.overrides = [...this._settings];\n        await this._initialiseActiveBuilding();\n        this._updateSettingOverrides();\n    }\n\n    /** Save building selection */\n    public saveBuilding(id: string) {\n        localStorage.setItem(`PLACEOS.building`, id);\n    }\n\n    private _initialiseActiveBuilding() {\n        return new Promise<void>((resolve) => {\n            const id = localStorage.getItem(`PLACEOS.building`);\n            if (id && this.buildings.find((bld) => bld.id === id)) {\n                this._active_building.next(\n                    this.buildings.find((bld) => bld.id === id)\n                );\n                return resolve();\n            }\n            const use_location = !!this._service.get('app.use_geolocation');\n            if (use_location && 'geolocation' in navigator) {\n                navigator.geolocation.getCurrentPosition(\n                    (position) => {\n                        const { latitude, longitude } = position.coords;\n                        let closest_bld = null;\n                        for (const bld of this.buildings) {\n                            if (!bld.location || bld.location === '0,0')\n                                continue;\n                            if (!closest_bld) closest_bld = bld;\n                            else {\n                                const [c_lat, c_long] = (\n                                    closest_bld.location || '0,0'\n                                ).split(',');\n                                const [b_lat, b_long] = (\n                                    bld.location || '0,0'\n                                ).split(',');\n                                const b_dist = Math.sqrt(\n                                    Math.pow(latitude - +b_lat, 2) +\n                                        Math.pow(longitude - +b_long, 2)\n                                );\n                                const c_dist = Math.sqrt(\n                                    Math.pow(latitude - +c_lat, 2) +\n                                        Math.pow(longitude - +c_long, 2)\n                                );\n                                if (b_dist < c_dist) closest_bld = bld;\n                            }\n                        }\n                        if (closest_bld) this.building = closest_bld;\n                        if (!this.building?.id) this._setDefaultBuilding();\n                        resolve();\n                    },\n                    () => {\n                        if (!this.building?.id) this._setDefaultBuilding();\n                        resolve();\n                    }\n                );\n            } else if (!this.building?.id) {\n                this._setDefaultBuilding();\n                resolve();\n            }\n        });\n    }\n\n    private _setDefaultBuilding() {\n        if (!this.buildings.length) return;\n        const bld_id = this._service.get('app.default_building');\n        if (bld_id) {\n            this.building = this.buildings.find(({ id }) => id === bld_id);\n        } else {\n            const timezone = this.timezone;\n            for (const bld of this.buildings) {\n                if (bld.timezone === timezone) {\n                    this.building = bld;\n                    break;\n                }\n            }\n            if (this.building) return;\n            const tz_start = timezone.split('/')[0];\n            for (const bld of this.buildings) {\n                if (bld.timezone.startsWith(tz_start)) {\n                    this.building = bld;\n                    break;\n                }\n            }\n        }\n        if (!this.building) this.building = this.buildings[0];\n    }\n\n    private _updateSettingOverrides() {\n        this._service.overrides = [\n            this.buildingSettings(this.building?.id),\n            this.regionSettings(this.region?.id),\n            ...this._settings,\n        ];\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { CanActivate, CanLoad, UrlTree, Router } from '@angular/router';\nimport { first } from 'rxjs/operators';\n\nimport { SettingsService } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nexport abstract class PLACEOS_APP_ACCESS {\n    public readonly group: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class FeatureAvailableGuard implements CanActivate, CanLoad {\n    constructor(\n        private _router: Router,\n        private _settings: SettingsService,\n        private _org: OrganisationService\n    ) {}\n\n    public async canActivate(): Promise<boolean | UrlTree> {\n        return this.checkFeature();\n    }\n\n    public async canLoad(): Promise<boolean> {\n        return this.checkFeature();\n    }\n\n    private async checkFeature() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        const features = this._settings.get('app.disabled_features') || [];\n        const can_activate = !features.find((_) =>\n            this._router.url.includes(_)\n        );\n        if (!can_activate) {\n            this._router.navigate(['/']);\n        }\n        return !!can_activate;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { getModule } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest, of, Subject } from 'rxjs';\nimport { filter, map, shareReplay, switchMap } from 'rxjs/operators';\n\nimport { AsyncHandler } from './async-handler.class';\nimport { randomInt } from './general';\n\nexport interface ClientEvent {\n    id: string;\n    type: 'network' | 'console' | 'dom';\n    subtype: string;\n    timestamp: number;\n    data: any;\n}\n\nfunction hookMethod<T, K extends keyof T>(\n    rootObject: T,\n    functionToHook: K,\n    hookingFunction: (...args: any[]) => void\n): T[K] {\n    var previousFunction = rootObject[functionToHook];\n    (rootObject as any)[functionToHook] = (...args: any[]) => {\n        hookingFunction(args);\n        (previousFunction as any).call(rootObject, ...args);\n    };\n    return previousFunction;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class RemoteLoggingService extends AsyncHandler {\n    private _system_id = new BehaviorSubject<string>('');\n    private _events = new Subject<ClientEvent>();\n\n    private _event_history = this._events.pipe(shareReplay(1000));\n\n    private _logging_bindings = this._system_id.pipe(\n        filter((_) => !!_),\n        switchMap((id) => combineLatest([of(id), this._bindTo(id, 'enabled')])),\n        filter(([_, enabled]) => !!enabled),\n        map(([id]) =>\n            this.subscription(\n                'post_events',\n                this._event_history.subscribe((d) =>\n                    getModule(id, 'Logger').execute('post_event', [d])\n                )\n            )\n        )\n    );\n\n    public readonly history = this._event_history;\n\n    constructor() {\n        super();\n        this._patchConsoleMethods();\n        this._logging_bindings.subscribe();\n    }\n\n    public setSystem(id: string) {\n        this._system_id.next(id);\n    }\n\n    private _patchConsoleMethods() {\n        const types: (keyof Console)[] = [\n            'log',\n            'debug',\n            'info',\n            'warn',\n            'error',\n        ];\n        for (const key of types) {\n            hookMethod(console, key, (...args) => this._handleEvent(key, args));\n        }\n    }\n\n    private _handleEvent(type: string, data: any, event_type: any = 'console') {\n        data[0] =\n            typeof data[0] === 'string' ? data[0].replace(/%c/g, '') : data[0];\n        this._events.next({\n            id: `${event_type}-${randomInt(99999_99999)}`,\n            type: event_type,\n            subtype: type,\n            timestamp: Date.now(),\n            data: data.filter(\n                (_) => typeof _ !== 'string' || !_.startsWith('color:')\n            ),\n        });\n    }\n\n    /** List to binding */\n    private _bindTo(id: string, name: string, mod: string = 'Logger') {\n        const module = getModule(id, mod).binding(name);\n        this.subscription(`bind:${name}`, module.bind());\n        return module.listen();\n    }\n}\n","import { addMilliseconds } from 'date-fns';\nimport { getTimezoneOffset } from 'date-fns-tz';\n\n\nexport const LOCAL_TIMEZONE = Intl?.DateTimeFormat()?.resolvedOptions()?.timeZone || 'Australia/Sydney';\n\nexport function localToTimezone(date: Date | number, tz: string = LOCAL_TIMEZONE) {\n    const offset_diff = getTimezoneOffset(tz) - getTimezoneOffset(LOCAL_TIMEZONE);\n    return addMilliseconds(date, offset_diff).valueOf();\n}\n\nexport function timezoneToLocal(date: Date | number, tz: string = LOCAL_TIMEZONE) {\n    const offset_diff = getTimezoneOffset(LOCAL_TIMEZONE) - getTimezoneOffset(tz);\n    return addMilliseconds(date, offset_diff).valueOf();\n}\n","import {\n    Directive,\n    Input,\n    SimpleChanges,\n    OnInit,\n    OnChanges,\n    OnDestroy,\n    ElementRef,\n    Renderer2,\n    EventEmitter,\n    Output,\n} from '@angular/core';\nimport { onlineState, authority, getModule } from '@placeos/ts-client';\n\nimport { AsyncHandler } from '@placeos/common';\nimport { filter, first } from 'rxjs/operators';\n\n@Directive({\n    selector: 'i[bind], [binding], co-bind',\n})\nexport class BindingDirective<T = any>\n    extends AsyncHandler\n    implements OnInit, OnChanges, OnDestroy\n{\n    /** ID of the system to bind */\n    @Input() public sys: string = '';\n    /** Class name of the module to bind */\n    @Input() public mod: string = '';\n    /** Index of the system to bind */\n    @Input() public index = 1;\n    /** Status variable to bind to */\n    @Input() public bind: string = '';\n    /** Method to execute */\n    @Input() public exec: string = '';\n    /** Method to execute */\n    @Input() public delay: number = 100;\n    /** Event to listen for on the parent */\n    @Input('onEvent') public on_event: string = '';\n    /** ID of the system to bind to */\n    @Input() public params: any[] = null;\n    @Input() public ignore: boolean = false;\n    /** Current value of the binding */\n    @Input() public model: T | null = null;\n    /** Emitter for changes to the value of the binding */\n    @Output() public modelChange = new EventEmitter<T | null>();\n\n    private _binding = false;\n    private _old_model: T | null = null;\n\n    constructor(\n        private _element: ElementRef<HTMLElement>,\n        private _renderer: Renderer2\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        onlineState()\n            ?.pipe(first((_) => _))\n            .subscribe((_) => this.bindVariable());\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.sys || changes.mod || changes.bind) {\n            this.bindVariable();\n        }\n        if (\n            changes.model &&\n            this._old_model !== this.model &&\n            this.model != null\n        ) {\n            this._old_model = this.model;\n            this.execute();\n        }\n        if (changes.on_event && this.on_event) {\n            this.subscription(\n                'on_event',\n                this._renderer.listen(\n                    this._element.nativeElement,\n                    this.on_event,\n                    () => this.execute()\n                )\n            );\n        }\n    }\n\n    /** Bind to set status variable */\n    private bindVariable() {\n        if (\n            authority() &&\n            this.bind &&\n            this.sys &&\n            this.mod &&\n            !this._binding\n        ) {\n            this.timeout(\n                'bind',\n                () => {\n                    const module = getModule(this.sys, this.mod, this.index);\n                    const binding = module.binding(this.bind);\n                    this._binding = true;\n                    this.subscription('binding', binding.bind());\n                    this.subscription(\n                        'on_changes',\n                        binding\n                            .listen()\n                            .pipe(filter((_) => _ != null))\n                            .subscribe((value) => {\n                                setTimeout(() => {\n                                    this._binding = false;\n                                    this.clearTimeout('bound');\n                                    if (this.ignore) return;\n                                    this.model = value;\n                                    this._old_model = this.model;\n                                    this.modelChange.emit(this.model);\n                                }, 10);\n                            })\n                    );\n                    this.timeout('bound', () => (this._binding = false), 200);\n                },\n                20\n            );\n        }\n    }\n\n    /** Excute the set method on the module */\n    private execute() {\n        if (\n            authority() &&\n            this.exec &&\n            this.sys &&\n            this.mod &&\n            !this._timers['execute']\n        ) {\n            this.timeout(\n                'execute',\n                () => {\n                    const module = getModule(this.sys, this.mod, this.index);\n                    let params = this.params;\n                    if (this.bind) params = this.params || [this.model];\n                    module.execute(this.exec, params || []).then((result) => {\n                        // Emit exec result if not bound to status variable\n                        if (!this.bind) {\n                            this.model = result;\n                            this._old_model = this.model;\n                            this.modelChange.emit(this.model);\n                        }\n                    });\n                },\n                this.delay\n            );\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from 'libs/common/src/lib/types';\n\n@Component({\n    selector: 'action-icon',\n    template: `\n        <button\n            icon\n            matRipple\n            class=\"relative\"\n            [class.success]=\"state === 'success'\"\n            [disabled]=\"loading || disabled\"\n        >\n            <app-icon root [className]=\"className\" [icon]=\"icon\">\n                {{ content }}\n                <ng-content></ng-content>\n            </app-icon>\n            <div [class]=\"'state center ' + state\" *ngIf=\"!loading && state\">\n                <app-icon>\n                    {{ state === 'success' ? 'done' : 'close' }}\n                </app-icon>\n            </div>\n            <div class=\"loader center\" *ngIf=\"loading\">\n                <mat-spinner [diameter]=\"16\"></mat-spinner>\n            </div>\n        </button>\n    `,\n    styles: [\n        `\n            .action-icon.fade > app-icon {\n                opacity: 0.35;\n            }\n\n            .success {\n                pointer-events: none;\n            }\n\n            .success app-icon[root] {\n                opacity: 0.2;\n            }\n\n            .state.success {\n                color: #388e3c;\n            }\n\n            .state.error {\n                color: #e53935;\n            }\n        `,\n    ],\n})\nexport class ActionIconComponent {\n    /** Icon to display */\n    @Input() public icon: ApplicationIcon;\n    /** Icon to display */\n    @Input() public className: string = 'material-icons';\n    /** Icon to display */\n    @Input() public content: string;\n    /** Whether action is being processed */\n    @Input() public loading: boolean;\n    /** Whether action is being processed */\n    @Input() public disabled: boolean;\n    /** State of the action */\n    @Input() public state: 'success' | 'error' | '' = '';\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { ApplicationIcon, AsyncHandler } from '@placeos/common';\n\nexport interface PopoutAction extends ApplicationIcon {\n    /** ID of the action */\n    id: string;\n}\n\n@Component({\n    selector: 'a-popout-menu',\n    template: `\n        <button\n            icon\n            matRipple\n            class=\"small absolute text-base center shadow\"\n            *ngFor=\"let item of actions; let i = index\"\n            [style.top]=\"show ? -110 * i - 60 + '%' : ''\"\n            (click)=\"action.emit(item.id); show = false\"\n        >\n            <app-icon [icon]=\"item\"></app-icon>\n        </button>\n        <button\n            name=\"root\"\n            icon\n            matRipple\n            [class.show]=\"show\"\n            (click)=\"show = !show\"\n            (window:click)=\"show ? close() : ''\"\n        >\n            <app-icon>{{ show ? 'add' : 'more_vert' }}</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n\n            app-icon {\n                transition: transform 200ms;\n            }\n\n            button {\n                background-color: #fff;\n                color: rgba(#000, 0.85);\n                font-size: 1.25rem;\n                height: 2.5em;\n                width: 2.5em;\n            }\n\n            button.show app-icon {\n                transform: rotate(45deg);\n            }\n\n            button.small {\n                transition: top 200ms, left 200ms;\n            }\n        `,\n    ],\n})\nexport class PopoutMenuComponent extends AsyncHandler {\n    /** List of available actions */\n    @Input() public actions: PopoutAction[] = [];\n    /** Emitter for user actions */\n    @Output() public action = new EventEmitter<string>();\n    /** Whether actions should show */\n    public show: boolean;\n\n    public close() {\n        this.timeout('close', () => (this.show = false));\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { User } from 'libs/users/src/lib/user.class';\n\n@Component({\n    selector: 'a-user-avatar',\n    template: `\n        <div\n            class=\"flex items-center justify-center rounded-full overflow-hidden border-2 border-white\"\n            *ngIf=\"user\"\n            [attr.user-id]=\"user.id\"\n        >\n            <div\n                initials\n                class=\"text-white text-opacity-80 uppercase\"\n                *ngIf=\"!user.photo; else image_state\"\n            >\n                {{ initials }}\n            </div>\n        </div>\n        <ng-template #image_state>\n            <img class=\"h-full w-full\" [src]=\"user.photo | safe: 'resource'\" />\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                height: 2.5em;\n                width: 2.5em;\n                background-color: var(--secondary);\n                overflow: hidden;\n                border: 2px solid white;\n            }\n\n            .initials {\n                font-size: 1em;\n            }\n        `,\n    ],\n})\nexport class UserAvatarComponent {\n    /** User to display avatar for */\n    @Input() public user: User;\n\n    public get initials(): string {\n        if (!this.user) return 'NA';\n        const name = this.user.name || '';\n        const parts = name.replace(/[()[\\]\\-+=\\\\/]+/gi, '').split(' ');\n        return parts.length > 1\n            ? `${parts[0][0]}${parts[parts.length - 1][0]}`\n            : name.slice(0, 2);\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\nenum SecurityContext {\n    NONE = 0,\n    HTML = 1,\n    STYLE = 2,\n    SCRIPT = 3,\n    URL = 4,\n    RESOURCE_URL = 5\n}\n\n@Pipe({\n    name: 'sanitize'\n})\nexport class SanitizePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    transform(\n        value: any,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.sanitize(SecurityContext.RESOURCE_URL, value);\n            case 'url':\n                return this.sanitizer.sanitize(SecurityContext.URL, value);\n            case 'script':\n                return this.sanitizer.sanitize(SecurityContext.SCRIPT, value);\n            case 'style':\n                return this.sanitizer.sanitize(SecurityContext.STYLE, value);\n            default:\n                return this.sanitizer.sanitize(SecurityContext.HTML, value);\n        }\n    }\n}\n","import {\n    AfterViewInit,\n    Component,\n    ElementRef,\n    EventEmitter,\n    HostListener,\n    InjectionToken,\n    Injector,\n    Input,\n    OnChanges,\n    OnDestroy,\n    OnInit,\n    Output,\n    QueryList,\n    SimpleChanges,\n    TemplateRef,\n    Type,\n    ViewChild,\n    ViewChildren,\n} from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\n\nimport {\n    applyGlobalStyles,\n    createViewer,\n    getViewer,\n    Point,\n    Viewer,\n    removeViewer,\n    updateViewer,\n    ViewAction,\n    ViewerFeature,\n    ViewerLabel,\n    ViewerStyles,\n    listenToViewerChanges,\n} from '@placeos/svg-viewer';\nimport { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport const MAP_FEATURE_DATA = new InjectionToken<any>(\n    'Data for Map Features'\n);\n\nfunction isSamePoint(p1: Point, p2: Point): boolean {\n    return p1.x === p2.x && p1.y === p2.y;\n}\n\n@Component({\n    selector: `i-map,interactive-map`,\n    template: `\n        <div\n            #outlet\n            tabindex=\"0\"\n            role=\"map\"\n            class=\"absolute inset-0\"\n            [class.hidden]=\"!src\"\n        ></div>\n        <ng-container *ngIf=\"src; else empty_state\">\n            <mat-spinner\n                *ngIf=\"!viewer || loading\"\n                class=\"absolute\"\n                [diameter]=\"48\"\n            ></mat-spinner>\n        </ng-container>\n        <div hidden *ngIf=\"injectors?.length\">\n            <ng-container\n                *ngFor=\"\n                    let element of features;\n                    let i = index;\n                    trackBy: trackByFn\n                \"\n            >\n                <div *ngIf=\"element\">\n                    <div\n                        #feature\n                        class=\"pointer-events-none\"\n                        [attr.no-scale]=\"element.no_scale\"\n                        [attr.el-id]=\"element.location\"\n                        [attr.track-id]=\"element.track_id\"\n                        [attr.view-id]=\"viewer\"\n                        [ngSwitch]=\"type(element.content)\"\n                    >\n                        <ng-container *ngSwitchCase=\"'component'\">\n                            <ng-container\n                                *ngComponentOutlet=\"\n                                    element.content;\n                                    injector: injectors[i]\n                                \"\n                            ></ng-container>\n                        </ng-container>\n                        <ng-container *ngSwitchCase=\"'html'\">\n                            <div [innerHTML]=\"element.content | sanitize\"></div>\n                        </ng-container>\n                        <ng-container *ngSwitchDefault>\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    element.content;\n                                    context: element.data\n                                \"\n                            ></ng-container>\n                        </ng-container>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"absolute inset-0 flex items-center justify-center\">\n                <div class=\"opacity-30\">No map</div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n\n            mat-spinner {\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n        `,\n    ],\n})\nexport class InteractiveMapComponent\n    extends AsyncHandler\n    implements AfterViewInit, OnChanges, OnInit, OnDestroy\n{\n    /** URL to the SVG file */\n    @Input() public src: string;\n    /** Custom CSS styles to apply to the SVG file */\n    @Input() public styles: ViewerStyles;\n    /** Zoom level to apply to the SVG */\n    @Input() public zoom = 1;\n    /** Zoom level to apply to the SVG */\n    @Input() public center: Point = { x: 0.5, y: 0.5 };\n    /** List of features to renderer over the SVG */\n    @Input() public features: ViewerFeature[];\n    /** List of labels to renderer over the SVG */\n    @Input() public labels: ViewerLabel[];\n    /** List of available user actions for the SVG */\n    @Input() public actions: ViewAction[];\n\n    @Input() public options: any;\n\n    @Input() public focus: string;\n\n    @Output() public zoomChange = new EventEmitter<number>();\n\n    @Output() public centerChange = new EventEmitter<Point>();\n\n    public loading: boolean;\n\n    public injectors: Injector[] = [];\n\n    public feature_list: ViewerFeature[] = [];\n\n    /** ID of the active SVG Viewer */\n    public viewer: string;\n    /** Observable for changes on the SVG viewer */\n    private _on_changes: BehaviorSubject<Viewer> = new BehaviorSubject(null);\n\n    private _extra_data = {\n        ratio$: this._on_changes.pipe(map((_) => _.ratio)),\n        svg_ratio$: this._on_changes.pipe(map((_) => _.svg_ratio)),\n        zoom$: this._on_changes.pipe(map((_) => _.zoom)),\n        position: this._on_changes.pipe(map((_) => _.center)),\n    };\n\n    @ViewChild('outlet') private _outlet_el: ElementRef<HTMLDivElement>;\n    @ViewChildren('feature') private _feature_list: QueryList<\n        ElementRef<HTMLDivElement>\n    >;\n\n    @HostListener('window:resize') public onResize() {\n        this.zoom = 1;\n        this.center = { x: 0.5, y: 0.5 };\n        this.updateDisplay();\n    }\n\n    public type(\n        content: string | TemplateRef<any> | Type<any>\n    ): 'html' | 'template' | 'component' {\n        return typeof content === 'string'\n            ? 'html'\n            : content instanceof TemplateRef\n            ? 'template'\n            : 'component';\n    }\n\n    constructor(private _injector: Injector) {\n        super();\n    }\n\n    public ngOnInit() {\n        applyGlobalStyles();\n    }\n\n    public ngOnDestroy(): void {\n        if (this.viewer) {\n            removeViewer(this.viewer);\n        }\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.src && this.src) {\n            this.createView().catch((e) => console.warn(e));\n        }\n        if (changes.features) {\n            this.updateInjectors();\n        }\n        if (this.viewer) {\n            if (changes.focus && this.focus) {\n                this.focusOn(this.focus);\n            } else if (\n                (changes.zoom &&\n                    changes.zoom.previousValue != changes.zoom.currentValue) ||\n                (changes.center &&\n                    !isSamePoint(\n                        changes.center.previousValue,\n                        changes.center.currentValue\n                    ))\n            ) {\n                this.updateDisplay();\n            }\n            if (\n                changes.styles ||\n                changes.features ||\n                changes.labels ||\n                changes.actions\n            ) {\n                this.timeout('update_view', () => this.updateView());\n            }\n        }\n    }\n\n    public ngAfterViewInit() {\n        this.createView().catch((e) => console.warn(e));\n    }\n\n    /** Update overlays, styles and actions of viewer */\n    private updateView() {\n        try {\n            if (!getViewer(this.viewer) || this.loading) {\n                return this.timeout('update_view', () => this.updateView());\n            }\n            this.updateFeatureList();\n            updateViewer(this.viewer, {\n                styles: this.styles,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n                options: this.options,\n            });\n        } catch (e) {}\n    }\n\n    /** Update zoom and center position of viewer */\n    private updateDisplay() {\n        try {\n            updateViewer(this.viewer, {\n                zoom: this.zoom,\n                desired_zoom: this.zoom,\n                center: this.center,\n                desired_center: this.center,\n                options: this.options,\n            });\n        } catch (e) {}\n    }\n\n    private async createView() {\n        if (this.src && this._outlet_el?.nativeElement && !this.loading) {\n            this.loading = true;\n            if (this.viewer) {\n                updateViewer(this.viewer, {\n                    styles: this.styles,\n                    features: [],\n                    labels: this.labels,\n                    actions: this.actions,\n                    options: this.options,\n                });\n                removeViewer(this.viewer);\n            }\n            this.updateFeatureList();\n            this.viewer = await createViewer({\n                element: this._outlet_el?.nativeElement,\n                url: this.src,\n                styles: this.styles,\n                zoom: this.zoom,\n                desired_zoom: this.zoom,\n                center: this.center,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n                options: this.options,\n            });\n            this.loading = false;\n            this.subscription(\n                'view_changes',\n                listenToViewerChanges(this.viewer)?.subscribe((v) => {\n                    const box =\n                        this._outlet_el.nativeElement.getBoundingClientRect();\n                    this._on_changes.next({ ...v } as any);\n                    this.zoomChange.emit(v.zoom);\n                    this.centerChange.emit(v.center);\n                })\n            );\n            if (this.focus) this.focusOn(this.focus);\n        } else if (\n            (this.src && !this._outlet_el?.nativeElement) ||\n            this.loading\n        ) {\n            this.timeout('create_view', () =>\n                this.createView().catch((e) => console.warn(e))\n            );\n        }\n    }\n\n    private focusOn(id: string) {\n        if (!id || !this.viewer) return;\n        const viewer: Viewer = getViewer(this.viewer);\n        if (!viewer) return;\n        const rect = viewer.mappings[id];\n        if (!rect) return;\n        this.center = {\n            x: 1 - (rect.x + rect.w / 2),\n            y: 1 - (rect.y + rect.h / 4),\n        };\n        this.updateDisplay();\n    }\n\n    /* istanbul ignore next */\n    public trackByFn(index: number, feature: ViewerFeature) {\n        return feature?.track_id;\n    }\n\n    private updateFeatureList() {\n        this.feature_list = (this.features || [])\n            .map((f, idx) => ({\n                ...f,\n                content: this._feature_list.toArray()[idx]?.nativeElement,\n            }))\n            .filter((f) => f.content);\n    }\n\n    private updateInjectors() {\n        const old_injectors = this.injectors || [];\n        this.injectors = (this.features || []).map(\n            (f: any) =>\n                old_injectors.find(\n                    (_) =>\n                        _.get(MAP_FEATURE_DATA)?.track_id &&\n                        _.get(MAP_FEATURE_DATA)?.track_id === f.track_id\n                ) ||\n                Injector.create({\n                    providers: [\n                        {\n                            provide: MAP_FEATURE_DATA,\n                            useValue: {\n                                track_id: f.track_id,\n                                ...f.data,\n                                ...this._extra_data,\n                            },\n                        },\n                    ],\n                    parent: this._injector,\n                })\n        );\n    }\n}\n","import { Component, Inject, OnInit } from '@angular/core';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapPinData {\n    message: string;\n    fill: string;\n    stroke: string;\n    action?: () => void;\n}\n\n@Component({\n    selector: '[map-pin]',\n    template: `\n        <div\n            name=\"message\"\n            *ngIf=\"message && show_message\"\n            class=\"p-2 m-2 rounded bg-white text-gray-700 shadow\"\n        >\n            {{ message }}\n        </div>\n        <svg\n            *ngIf=\"show\"\n            name=\"pin\"\n            viewBox=\"0 0 380 560\"\n            [class.action]=\"action\"\n            (click)=\"action()\"\n        >\n            <g>\n                <path\n                    [style.fill]=\"fill\"\n                    [style.stroke]=\"stroke\"\n                    stroke-width=\"25\"\n                    d=\"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n            C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n            c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z\"\n                />\n            </g>\n        </svg>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                bottom: 0;\n                left: 50%;\n                width: 24rem;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                transform: translateX(-50%);\n                z-index: -1;\n            }\n\n            div {\n                animation: fade-in-top 1s;\n            }\n\n            .action {\n                pointer-events: auto;\n            }\n\n            svg {\n                width: 2rem;\n                animation: fade-in-top 1s;\n            }\n\n            @keyframes fade-in-top {\n                0% {\n                    opacity: 0;\n                    transform: translateY(-100%);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translateY(0%);\n                }\n            }\n        `,\n    ],\n})\nexport class MapPinComponent implements OnInit {\n    /** Message to display above the pin */\n    public readonly message = this._details.message;\n    /** Fill colour for the pin SVG */\n    public readonly fill = this._details.fill || '#e53935';\n    /** Stroke colour for the pin SVG */\n    public readonly stroke = this._details.stroke || '#fff';\n    /** Action to perform when clicking pin */\n    public readonly action = this._details.action || null;\n\n    public show: boolean;\n    public show_message: boolean;\n\n    constructor(@Inject(MAP_FEATURE_DATA) private _details: MapPinData) {}\n\n    public ngOnInit() {\n        setTimeout(() => (this.show = true), 300);\n        setTimeout(() => (this.show_message = true), 1000);\n    }\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\nimport { formatDistanceToNow } from 'date-fns';\nimport { Observable } from 'rxjs';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapRadiusData {\n    message: string;\n    radius: number;\n    fill: string;\n    stroke: string;\n    last_seen?: number;\n    zoom$: Observable<number>;\n}\n\n@Component({\n    selector: '[map-radius]',\n    template: `\n        <ng-container *ngIf=\"show && radius\" (window:resize)=\"updateRadius()\">\n            <div\n                radius\n                class=\"center border-4 rounded-full border-dashed\"\n                [style.border-color]=\"stroke\"\n                [style.background-color]=\"fill + '40'\"\n                [style.width]=\"radius * zoom + 'px'\"\n                [style.height]=\"radius * zoom + 'px'\"\n            ></div>\n            <div\n                *ngIf=\"message && show_message\"\n                message\n                [style.top]=\"'-' + (radius / 2) * zoom + 'px'\"\n                class=\"p-2 m-2 rounded bg-white text-gray-700 shadow absolute top-0 whitespace-no-wrap flex flex-col w-64\"\n            >\n                {{ message }}\n                <span *ngIf=\"last_seen\" class=\"text-xs\">\n                    Last updated: {{ last_seen_at }}\n                </span>\n            </div>\n        </ng-container>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                height: 100%;\n                width: 100%;\n            }\n\n            [message] {\n                transform: translate(-50%, -120%);\n                animation: fade-in-top 1s;\n            }\n\n            @keyframes fade-in-top {\n                0% {\n                    opacity: 0;\n                    transform: translate(-50%, -220%);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translate(-50%, -120%);\n                }\n            }\n        `,\n    ],\n})\nexport class MapRadiusComponent implements OnInit {\n    public zoom = 1;\n    /** Size of the area marked by this component */\n    public radius = this._details.radius || 10;\n    /** Message to display above the pin */\n    public readonly message = this._details.message;\n    /** Fill colour for the pin SVG */\n    public readonly fill = this._details.fill || '#e53935';\n    /** Stroke colour for the pin SVG */\n    public readonly stroke = this._details.stroke || '#e53935';\n\n    public readonly last_seen: number = this._details.last_seen || 0;\n\n    public get last_seen_at() {\n        return formatDistanceToNow(this.last_seen * 1000) + ' ago';\n    }\n\n    public show: boolean;\n    public show_message: boolean;\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: MapRadiusData,\n        private _el: ElementRef<HTMLElement>\n    ) {\n        this._details.zoom$?.subscribe((v) =>\n            Math.max(0.5, (this.zoom = v || 1))\n        );\n    }\n\n    public ngOnInit() {\n        setTimeout(() => (this.show = true), 300);\n        setTimeout(() => (this.show_message = true), 1000);\n    }\n\n    public ngAfterViewInit() {\n        this.updateRadius();\n    }\n\n    public updateRadius() {\n        const box = this._el.nativeElement.getBoundingClientRect();\n        if (!box.width) return setTimeout(() => this.updateRadius(), 300);\n        this.radius = Math.max(\n            64,\n            (this._details.radius || 10) * (box.width || 10)\n        );\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationLink } from '@placeos/common';\n\n@Component({\n    selector: 'status-overlay',\n    template: `\n        <div\n            status-overlay\n            class=\"fixed inset-0 flex flex-col bg-secondary items-center justify-center z-50 text-white\"\n        >\n            <ng-container *ngIf=\"!loading; else load_state\">\n                <div\n                    class=\"text-4xl rounded-full bg-white mb-4\"\n                    [class.text-success]=\"!error\"\n                    [class.text-error]=\"error\"\n                >\n                    <app-icon>{{ error ? 'close' : 'done' }}</app-icon>\n                </div>\n                <div class=\"text-center text-lg mb-4\">\n                    <ng-container *ngIf=\"!error; else error_msg\">\n                        <ng-content></ng-content>\n                    </ng-container>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <a\n                        button\n                        btn\n                        matRipple\n                        class=\"w-32\"\n                        *ngFor=\"let link of links\"\n                        [routerLink]=\"[link.route]\"\n                    >\n                        {{ link.name }}\n                    </a>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #error_msg\n            ><p error>{{ error }}</p></ng-template\n        >\n        <ng-template #load_state>\n            <mat-spinner [diameter]=\"32\" class=\"mb-4\"></mat-spinner>\n            <p loading class=\"text-center text-lg\">{{ loading }}</p>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class StatusOverlayComponent {\n    /** Whether overlay is loading */\n    @Input() public loading: string = '';\n    /** Details about any errors that have occurred */\n    @Input() public error: string = '';\n    /** Links to display on success */\n    @Input() public links: ApplicationLink[] = [];\n}\n","import { Pipe, PipeTransform } from '@angular/core';\n\n@Pipe({\n    name: 'toFixed',\n})\nexport class FixedPipe implements PipeTransform {\n\n    /**\n     * Fixed a number to x decimal places\n     * @param value number to convert\n     * @param places Number of decimal places to convert\n     */\n    public transform(value: number, places: number = 2): string {\n        return value.toFixed(places);\n    }\n}\n","import {\n    AfterViewInit,\n    Component,\n    EventEmitter,\n    Input,\n    OnChanges,\n    Output,\n    SimpleChanges,\n    TemplateRef,\n    ViewChild,\n} from '@angular/core';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatSort } from '@angular/material/sort';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { AsyncHandler } from '@placeos/common';\nimport { Observable } from 'rxjs';\n\n@Component({\n    selector: 'custom-table',\n    template: `\n        <cdk-table [dataSource]=\"data_source\" matSort>\n            <ng-container *ngFor=\"let column of columns; let i = index\">\n                <ng-container [cdkColumnDef]=\"column\">\n                    <div\n                        cdk-header-cell\n                        class=\"capitalize p-2\"\n                        [style.width]=\"(column_size[i] || '8') + 'em'\"\n                        [style.flex]=\"column_size[i] === 'flex' ? '1' : ''\"\n                        *cdkHeaderCellDef\n                        mat-sort-header\n                    >\n                        {{ display_column[i] || column }}\n                    </div>\n                    <div\n                        cdk-cell\n                        class=\"p-2 truncate flex items-center\"\n                        [style.width]=\"(column_size[i] || '8') + 'em'\"\n                        [style.flex]=\"column_size[i] === 'flex' ? '1' : ''\"\n                        *cdkCellDef=\"let row\"\n                        [title]=\"row[column]\"\n                    >\n                        <ng-container\n                            *ngIf=\"!template[column]; else cell_outlet\"\n                            >{{ row[column] }}</ng-container\n                        >\n                        <ng-template #cell_outlet>\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    template[column];\n                                    context: {\n                                        data: row[column],\n                                        row: row,\n                                        key: column\n                                    }\n                                \"\n                            ></ng-container>\n                        </ng-template>\n                    </div>\n                </ng-container>\n            </ng-container>\n\n            <cdk-header-row\n                class=\"sticky flex items-center bg-white dark:bg-neutral-700 top-0 z-10 border-b border-gray-300 dark:border-neutral-400\"\n                *cdkHeaderRowDef=\"columns\"\n            ></cdk-header-row>\n            <cdk-row\n                row\n                class=\"flex z-0 relative hover:bg-black/5 dark:hover:bg-white/5 border-b border-gray-200 dark:border-neutral-500\"\n                (click)=\"row_clicked.emit(row)\"\n                *cdkRowDef=\"let row; columns: columns\"\n            ></cdk-row>\n            <ng-template cdkNoDataRow>\n                <p class=\"w-full p-4 text-center opacity-30\">\n                    {{ empty || 'No data to display' }}\n                </p>\n            </ng-template>\n        </cdk-table>\n        <div footer [hidden]=\"!pagination\">\n            <mat-paginator\n                [pageSize]=\"page_size\"\n                [hidePageSize]=\"true\"\n                [showFirstLastButtons]=\"true\"\n            >\n            </mat-paginator>\n        </div>\n    `,\n    styles: [\n        `\n            cdk-header-row {\n                font-weight: 500;\n                text-transform: capitalize;\n                min-height: 3rem;\n            }\n        `,\n    ],\n})\nexport class CustomTableComponent<T extends {} = any>\n    extends AsyncHandler\n    implements AfterViewInit, OnChanges\n{\n    /** Data source to render in the table */\n    @Input() public dataSource: T[] | Observable<T[]>;\n    /** Whether table should use pagination */\n    @Input() public pagination = false;\n    /** Number of items to display on pagination pages */\n    @Input() public page_size = 7;\n    /** Filter string to apply to table listings */\n    @Input() public filter: string;\n    /** Values to display for column headers */\n    @Input() public display_column: string[];\n    /** List of columns to display in the table */\n    @Input() public columns: string[];\n    /** Size of the columns in em or flex for a flexible size */\n    @Input() public column_size: string[] = [];\n    /** Displayed value when the table is empty */\n    @Input() public empty: string;\n    /** Displayed value when the table is empty */\n    @Input() public template: Record<string, TemplateRef<any>> = {};\n\n    @Output() public row_clicked = new EventEmitter<T>();\n\n    public readonly data_source: MatTableDataSource<T> = new MatTableDataSource(\n        []\n    );\n\n    @ViewChild(MatPaginator) private _paginator: MatPaginator;\n    @ViewChild(MatSort) private _sort: MatSort;\n\n    public ngAfterViewInit() {\n        this.data_source.sort = this._sort;\n        this.data_source.paginator = this.pagination ? this._paginator : null;\n        this.data_source.filterPredicate = (i: any, s) => {\n            for (const key in i) {\n                if (\n                    typeof i[key] === 'string' &&\n                    i[key].toLowerCase().includes(s.toLowerCase())\n                ) {\n                    return true;\n                } else if (i[key] === s) {\n                    return true;\n                }\n            }\n            return false;\n        };\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.dataSource && this.dataSource) {\n            if (this.dataSource instanceof Observable) {\n                this.subscription(\n                    'data',\n                    this.dataSource.subscribe(\n                        (data) => (this.data_source.data = data)\n                    )\n                );\n            } else {\n                this.data_source.data = this.dataSource;\n            }\n        }\n        if (changes.pagination) {\n            this.data_source.paginator = this.pagination\n                ? this._paginator\n                : null;\n        }\n        if (changes.filter) {\n            this.data_source.filter = (this.filter || '').trim().toLowerCase();\n        }\n        if (changes.columns && this.columns) {\n            this.display_column = this.columns.map(\n                (_, idx) =>\n                    (this.display_column || [])[idx] || _.split('_').join(' ')\n            );\n        }\n        if (!this.column_size) {\n            this.column_size = [];\n        }\n    }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Injectable,\n    Injector,\n    Input,\n    OnChanges,\n    OnDestroy,\n    SimpleChanges,\n    TemplateRef,\n    Type,\n    ViewChild,\n} from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\n\n@Injectable()\nexport class CustomTooltipData<T = any> {\n    data: T;\n    close: () => void;\n    constructor(d) {\n        this.data = d.data;\n        this.close = d.close || (() => null);\n    }\n}\n\n@Component({\n    selector: '[customTooltip]',\n    template: `\n        <ng-content></ng-content>\n\n        <ng-template cdk-portal>\n            <div custom-tooltip class=\"relative\" [ngSwitch]=\"type\">\n                <ng-container *ngSwitchCase=\"'component'\">\n                    <ng-container\n                        *ngComponentOutlet=\"content; injector: injector\"\n                    ></ng-container>\n                </ng-container>\n                <ng-container *ngSwitchCase=\"'html'\">\n                    <div [innerHTML]=\"content | sanitize\"></div>\n                </ng-container>\n                <ng-container *ngSwitchDefault>\n                    <ng-container\n                        *ngTemplateOutlet=\"content; context: data\"\n                    ></ng-container>\n                </ng-container>\n            </div>\n        </ng-template>\n    `,\n})\nexport class CustomTooltipComponent<T = any>\n    extends AsyncHandler\n    implements OnChanges, OnDestroy\n{\n    /** Horizontal position of the rendered overlay */\n    @Input('xPosition') public x_pos: 'start' | 'center' | 'end';\n    /** Vertical position of the rendered overlay */\n    @Input('yPosition') public y_pos: 'top' | 'center' | 'bottom';\n    /** Content to render in the tooltip */\n    @Input() public content: TemplateRef<any> | Type<any> | string;\n    /** Data associated with the tooltip content */\n    @Input() public data: T;\n    /** Whether tooltip has a backdrop */\n    @Input() public backdrop = true;\n    /** Whether tooltip has a backdrop */\n    @Input() public hover = false;\n    /** Delay time in milliseconds to close after hover */\n    @Input() public delay = 0;\n    /** Type of content to render */\n    public type: 'template' | 'component' | 'html' = 'template';\n\n    public injector: Injector;\n\n    private _overlay_ref: OverlayRef = null;\n\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n\n    @HostListener('click') public readonly onClick = () => this.open();\n    @HostListener('touchend') public readonly onTouch = () => this.open();\n    @HostListener('mouseenter') public readonly onEnter = () =>\n        this.hover ? this.open() : '';\n    @HostListener('mouseleave') public readonly onLeave = () =>\n        this.hover ? this.close() : '';\n\n    constructor(\n        private _element: ElementRef<HTMLElement>,\n        private _overlay: Overlay,\n        private _injector: Injector\n    ) {\n        super();\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        this._updateInjector();\n        if (\n            this._overlay_ref &&\n            (changes.x_pos || changes.y_pos || changes.content)\n        ) {\n            this.open();\n        }\n    }\n\n    public ngOnDestroy() {\n        super.ngOnDestroy();\n        this.close();\n    }\n\n    public open() {\n        if (!this.content) return;\n        this.timeout(\n            'open',\n            () => {\n                if (this.hover && this.delay) {\n                    this.timeout('onclose', () => this.close(), this.delay);\n                }\n                this._updateType();\n                if (this._overlay_ref) this.close();\n                if (!this._portal) return;\n                const pos = this._element.nativeElement.getBoundingClientRect();\n                const default_x = 'end';\n                const default_y = 'top';\n                this._overlay_ref = this._overlay.create({\n                    hasBackdrop: !!this.backdrop,\n                    positionStrategy: this._overlay\n                        .position()\n                        .flexibleConnectedTo(this._element)\n                        .withPositions([\n                            {\n                                originX: this.x_pos || default_x,\n                                originY:\n                                    (this.y_pos === 'top'\n                                        ? 'bottom'\n                                        : this.y_pos == 'bottom'\n                                        ? 'top'\n                                        : this.y_pos) || default_y,\n                                overlayX: this.x_pos || default_x,\n                                overlayY: this.y_pos || default_y,\n                            },\n                        ]),\n                });\n                this._overlay_ref.attach(this._portal);\n                if (this.backdrop) {\n                    this.subscription(\n                        'backdrop',\n                        this._overlay_ref\n                            .backdropClick()\n                            .subscribe(() => this.close())\n                    );\n                }\n            },\n            50\n        );\n    }\n\n    public close() {\n        this.clearTimeout('open');\n        if (this._overlay_ref) {\n            this._overlay_ref.dispose();\n            this._overlay_ref = null;\n        }\n    }\n\n    private _updateType() {\n        this.type =\n            typeof this.content === 'string'\n                ? 'html'\n                : this.content instanceof TemplateRef\n                ? 'template'\n                : 'component';\n    }\n\n    private _updateInjector() {\n        this.injector = Injector.create({\n            providers: [\n                {\n                    provide: CustomTooltipData,\n                    useValue: { data: this.data, close: () => this.close() },\n                },\n            ],\n            parent: this._injector,\n        });\n    }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Input,\n    OnDestroy,\n    ViewChild,\n} from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\n\nconst DEFAULT_KEYS = [\n    '0123456789'.split(''),\n    'qwertyuiop'.split(''),\n    'asdfghjkl'.split(''),\n    'zxcvbnm'.split(''),\n    ['{caps}', '{space}', '{backspace}'],\n];\n\n@Component({\n    selector: 'input[keyboard],textarea[keyboard]',\n    template: `\n        <ng-content></ng-content>\n        <ng-template cdk-portal>\n            <div\n                keyboard-view\n                class=\"w-screen flex flex-col space-y-4 bg-gray-200 p-2 border-t border-gray-400\"\n            >\n                <div\n                    row\n                    class=\"flex items-center justify-center space-x-2\"\n                    *ngFor=\"let row of keyset\"\n                >\n                    <ng-container *ngFor=\"let key of row\">\n                        <div\n                            [attr.key]=\"key\"\n                            tabindex=\"0\"\n                            class=\"rounded-xl p-2 border border-gray-300 relative cursor-pointer bg-white\"\n                            [class.special]=\"key[0] === '{' && key.length > 1\"\n                            [class.space]=\"key === '{space}'\"\n                            (focus)=\"focusInput()\"\n                            (click)=\"handleKeyPress(key)\"\n                        >\n                            {{\n                                key === '{space}'\n                                    ? 'Space'\n                                    : key === '{caps}'\n                                    ? 'Caps Lock'\n                                    : key === '{backspace}'\n                                    ? 'Backspace'\n                                    : key\n                            }}\n                            <div\n                                *ngIf=\"key === '{caps}'\"\n                                dot\n                                class=\"absolute top-2 right-2 h-2 w-2 rounded-full bg-gray-300\"\n                                [class.bg-success]=\"state === 'shift'\"\n                            ></div>\n                        </div>\n                    </ng-container>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            [key] {\n                height: 3.5rem;\n                width: 4rem;\n                transition: box-shadow 200ms, top 200ms;\n                box-shadow: 0 4px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key].special {\n                width: 10rem;\n            }\n\n            [key].space {\n                flex: 1;\n                min-width: 10rem;\n                max-width: 25rem;\n            }\n\n            [key]:hover {\n                top: 2px;\n                box-shadow: 0 2px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key]:active {\n                top: 4px;\n                box-shadow: 0 0 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n        `,\n    ],\n})\nexport class VirtualKeyboardComponent\n    extends AsyncHandler\n    implements OnDestroy\n{\n    /** Whether virtual keyboard should activate */\n    public static enabled: boolean;\n    /** List of rows of keys to display on the keyboard */\n    @Input() public keyset = DEFAULT_KEYS;\n    /** Current state of the displayed keyset */\n    public state: 'normal' | 'caps' | 'shift' = 'normal';\n    /** References to the overlay containing the keyboard */\n    private _overlay_ref: OverlayRef = null;\n    /** Portal with the keyboard contents */\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n\n    @HostListener('focus') public onFocus = () => {\n        if (!VirtualKeyboardComponent.enabled) return;\n        this.open();\n        this.clearTimeout('blur');\n    };\n    @HostListener('blur') public onBlur = () =>\n        this.timeout('blur', () => this.close());\n\n    constructor(\n        private _element: ElementRef<HTMLInputElement | HTMLTextAreaElement>,\n        private _overlay: Overlay\n    ) {\n        super();\n    }\n\n    public ngOnDestroy() {\n        super.ngOnDestroy();\n        this.close();\n    }\n\n    public focusInput() {\n        this._element?.nativeElement?.blur();\n        this._element?.nativeElement?.focus();\n    }\n\n    public open() {\n        if (this._overlay_ref) return;\n        if (!this._portal) return;\n        this._overlay_ref = this._overlay.create({\n            positionStrategy: this._overlay\n                .position()\n                .global()\n                .bottom()\n                .centerHorizontally(),\n        });\n        this._overlay_ref.attach(this._portal);\n    }\n\n    public close() {\n        if (this._overlay_ref) {\n            this._overlay_ref.dispose();\n            this._overlay_ref = null;\n        }\n    }\n\n    public handleKeyPress(key: string) {\n        let cursor_pos = this._element.nativeElement.selectionStart;\n        const str = this._element.nativeElement.value || '';\n        switch (key.toLowerCase()) {\n            case '{caps}':\n            case '{shift}':\n                this.state = 'shift';\n                break;\n            case '{backspace}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos - 1\n                )}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos = Math.max(0, cursor_pos - 1);\n                break;\n            case '{space}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${' '}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n                break;\n            default:\n                if (this.state === 'shift') this.state = 'normal';\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${key}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n        }\n        this._element.nativeElement.dispatchEvent(new InputEvent('input'));\n        this.updateKeyState();\n        this.timeout(\n            'focus',\n            () => {\n                this.focusInput();\n                this._element.nativeElement.selectionStart = cursor_pos;\n                this._element.nativeElement.selectionEnd = cursor_pos;\n            },\n            50\n        );\n    }\n\n    public updateKeyState() {\n        this.keyset = this.keyset.map((_) =>\n            _.map((k) =>\n                k.length > 1\n                    ? k\n                    : k[\n                          this.state !== 'normal'\n                              ? 'toUpperCase'\n                              : 'toLowerCase'\n                      ]()\n            )\n        );\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { first } from 'rxjs/operators';\nimport { isOnline, token } from '@placeos/ts-client';\nimport { AsyncHandler, SettingsService } from '@placeos/common';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\n\n@Component({\n    selector: 'global-loading',\n    template: `\n        <div\n            *ngIf=\"!online\"\n            class=\"fixed bottom-2 left-1/2 -translate-x-1/2 shadow rounded-3xl px-4 py-2 bg-error text-white text-xs\"\n        >\n            Unable to reach server... Some features may not work.\n        </div>\n        <div\n            *ngIf=\"loading\"\n            loader\n            class=\"fixed inset-0 flex items-center justify-center pointer-events-auto bg-white dark:bg-neutral-600\"\n        >\n            <mat-spinner [diameter]=\"64\"></mat-spinner>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                pointer-events: none;\n            }\n\n            :host > [loader] {\n                z-index: 997;\n                background-image: url(\"data:image/svg+xml,%3Csvg width='36' height='36' viewBox='0 0 36 36' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M36 0H0v36h36V0zM15.126 2H2v13.126c.367.094.714.24 1.032.428L15.554 3.032c-.188-.318-.334-.665-.428-1.032zM18 4.874V18H4.874c-.094-.367-.24-.714-.428-1.032L16.968 4.446c.318.188.665.334 1.032.428zM22.874 2h11.712L20 16.586V4.874c1.406-.362 2.512-1.468 2.874-2.874zm10.252 18H20v13.126c.367.094.714.24 1.032.428l12.522-12.522c-.188-.318-.334-.665-.428-1.032zM36 22.874V36H22.874c-.094-.367-.24-.714-.428-1.032l12.522-12.522c.318.188.665.334 1.032.428zm0-7.748V3.414L21.414 18h11.712c.362-1.406 1.468-2.512 2.874-2.874zm-18 18V21.414L3.414 36h11.712c.362-1.406 1.468-2.512 2.874-2.874zM4.874 20h11.712L2 34.586V22.874c1.406-.362 2.512-1.468 2.874-2.874z' fill='%23000000' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E\");\n            }\n        `,\n    ],\n})\nexport class GlobalLoadingComponent extends AsyncHandler implements OnInit {\n    public loading: boolean;\n\n    public get online() {\n        return isOnline();\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this.loading = true;\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        this.interval(\n            'has_token',\n            () => {\n                if (token()) {\n                    this.loading = false;\n                    this.clearInterval('has_token');\n                }\n            },\n            1000\n        );\n    }\n}\n","import { ChangeDetectorRef, Component, Inject, OnInit } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { Observable } from 'rxjs';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapPolygonData {\n    /** Name of the region */\n    name: string;\n    /** Color to display region in on overlay */\n    color: string;\n    /** Array of points that define the shape of the region */\n    points: [number, number][];\n    /**  */\n    ratio?: number;\n    svg_ratio?: number;\n    zoom_value?: number;\n    ratio$?: Observable<number>;\n    svg_ratio$?: Observable<number>;\n    zoom$?: Observable<number>;\n    data$?: Observable<MapPolygonData>;\n}\n\n@Component({\n    selector: '[map-polygon]',\n    template: `\n        <div\n            polygon\n            class=\"absolute w-full h-full transform -translate-x-1/2 -translate-y-1/2 -top-1 -left-1\"\n            [style.transform]=\"'scale(' + scale * zoom + ')'\"\n        >\n            <div\n                class=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2\"\n                [style.width]=\"width + '%'\"\n                [style.height]=\"height + '%'\"\n            >\n                <svg\n                    [attr.viewBox]=\"\n                        '0 0 ' +\n                        (this.width / 20 || 1) +\n                        ' ' +\n                        (this.height / 20 || 1)\n                    \"\n                    preserveAspectRatio=\"none\"\n                    class=\"relative w-full h-full\"\n                >\n                    <polygon\n                        [attr.points]=\"points\"\n                        [style.fill]=\"fill\"\n                        [style.stroke]=\"stroke\"\n                    />\n                    <!-- <circle\n                        *ngFor=\"let point of point_list\"\n                        [attr.cx]=\"point[0] || 0\"\n                        [attr.cy]=\"point[1] || 0\"\n                        [attr.r]=\"4\"\n                        [style.stroke]=\"'#000'\"\n                        [style.fill]=\"'#fffd'\"\n                    /> -->\n                </svg>\n            </div>\n        </div>\n        <div\n            text\n            class=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-shadow text-white text-xl text-center whitespace-pre-line\"\n        >\n            {{ name }}\n        </div>\n    `,\n    styles: [\n        `\n            [polygon] {\n                will-change: transform;\n            }\n\n            polygon {\n                stroke-width: 2;\n            }\n            circle {\n                stroke-width: 2;\n            }\n\n            [text] {\n                width: 32rem;\n                max-width: 65vw;\n            }\n        `,\n    ],\n})\nexport class MapPolygonComponent extends AsyncHandler implements OnInit {\n    /** Message to display above the pin */\n    public name = this._details.name;\n    /** Fill colour for the pin SVG */\n    public fill = `${this._details.color || '#e53935'}88`;\n    /** Stroke colour for the pin SVG */\n    public stroke = this._details.color || '#e53935';\n    public padding = 32;\n    public width = 1;\n    public height = 1;\n    public readonly svg_scale = 20;\n\n    public get scale() {\n        return this._details.svg_ratio || 1;\n    }\n\n    public get zoom() {\n        return this._details.zoom_value || 1;\n    }\n\n    /** List of points for drawing the polygon */\n    public points = `0,0 0,${this.height} ${this.width},${this.height} ${this.width},0`;\n\n    public point_list: [number, number][] = [];\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: MapPolygonData,\n        private _cdr: ChangeDetectorRef\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        if (this._details.data$) {\n            this.subscription(\n                'data',\n                this._details.data$.subscribe((_) => {\n                    this.name = _.name;\n                    this.fill = `${_.color || '#e53935'}88`;\n                    this.stroke = _.color || '#e53935';\n                    this.processPoints(_.points);\n                })\n            );\n        }\n        this.subscription(\n            'ratio',\n            this._details.ratio$?.subscribe((_) => {\n                this._details.ratio = _;\n                this.processPoints(this._details.points);\n            })\n        );\n        this.subscription(\n            'zoom',\n            this._details.zoom$?.subscribe(\n                (_) => (this._details.zoom_value = _)\n            )\n        );\n        this.subscription(\n            'svg_ratio',\n            this._details.svg_ratio$?.subscribe(\n                (_) => (this._details.svg_ratio = _)\n            )\n        );\n        this.processPoints(this._details.points);\n    }\n\n    public processPoints(points: [number, number][]) {\n        const diff: Record<string, number> = points.reduce(\n            (m, [x, y]) => ({\n                x_min: x < m.x_min ? x : m.x_min,\n                x_max: x > m.x_max ? x : m.x_max,\n                y_min: y < m.y_min ? y : m.y_min,\n                y_max: y > m.y_max ? y : m.y_max,\n            }),\n            {\n                x_min: 100,\n                x_max: -100,\n                y_min: 100,\n                y_max: -100,\n            }\n        );\n        const range = {\n            x: diff.x_max - diff.x_min,\n            y: diff.y_max - diff.y_min,\n        };\n        const { ratio } = this._details;\n        this.width = range.x * 100;\n        this.height = range.y * 100 * (ratio || 1);\n        this.width = Math.floor(this.width * 100);\n        this.height = Math.floor(this.height * 100);\n        this.points = points\n            .reduce(\n                (s, [x, y]) =>\n                    `${s}${s ? ' ' : ''}${\n                        (((x - diff.x_min) / range.x) * this.width) / 20\n                    },${(((y - diff.y_min) / range.y) * this.height) / 20}`,\n                ''\n            )\n            .replace(/NaN/g, '0');\n        this.point_list = points.map(([x, y]) => [\n            (((x - diff.x_min) / range.x) * this.width) / 20,\n            (((y - diff.y_min) / range.y) * this.height) / 20,\n        ]);\n        this._cdr.detectChanges();\n    }\n}\n","import { Component } from '@angular/core';\nimport { SettingsService } from '@placeos/common';\n\nexport interface BannerDetails {\n    id: string;\n    type?: 'info' | 'warn' | 'error';\n    content: string;\n}\n\n@Component({\n    selector: 'global-banner',\n    template: `\n        <div\n            class=\"flex items-center w-full text-white p-4 space-x-4\"\n            [class.bg-blue-600]=\"banner.type === 'info' || !banner.type\"\n            [class.bg-pending]=\"banner.type === 'warn'\"\n            [class.bg-error]=\"banner.type === 'error'\"\n            *ngIf=\"!has_viewed\"\n        >\n            <div class=\"flex-1\">{{ banner?.content }}</div>\n            <button icon (click)=\"close()\">\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class GlobalBannerComponent {\n    public get has_viewed() {\n        return (\n            !this.banner?.content ||\n            localStorage.getItem('PLACE.last_banner') === this.banner.id\n        );\n    }\n\n    public get banner(): BannerDetails {\n        return this._settings.get('app.general.banner');\n    }\n\n    constructor(private _settings: SettingsService) {}\n\n    public close() {\n        localStorage.setItem('PLACE.last_banner', this.banner?.id || '');\n    }\n}\n","import { Component, OnInit, Output, EventEmitter, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { ViewerFeature, ViewerStyles } from '@placeos/svg-viewer';\n\nimport { AsyncHandler } from '@placeos/common';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { BuildingLevel } from 'libs/organisation/src/lib/level.class';\nimport { MapPinComponent } from './map-pin.component';\n\nexport interface Locatable {\n    id: string;\n    name: string;\n    map_id: string;\n    level: BuildingLevel;\n    zones?: string[];\n}\n\n@Component({\n    selector: 'map-locate-modal',\n    template: `\n        <div class=\"h-[calc(100vh-4rem)] w-screen sm:h-auto sm:w-auto\">\n            <header class=\"p-4\">\n                <app-icon class=\"text-2xl\">place</app-icon>\n                <h1 class=\"ml-2 text-xl font-medium\">{{ item.name }}</h1>\n            </header>\n            <div\n                body\n                class=\"relative overflow-hidden h-[65vh] w-full sm:max-h-[65vh]\"\n                *ngIf=\"level\"\n            >\n                <i-map\n                    [src]=\"level.map_id\"\n                    [styles]=\"style_map\"\n                    [features]=\"features\"\n                >\n                    <mat-spinner diameter=\"64\"></mat-spinner>\n                </i-map>\n                <div\n                    class=\"absolute top-2 right-2 py-2 px-4 bg-white rounded-3xl shadow border border-gray-200\"\n                >\n                    {{ level?.name }}\n                </div>\n            </div>\n            <footer\n                class=\"w-full border-t border-gray-200 flex items-center justify-center p-2\"\n            >\n                <button btn matRipple class=\"inverse w-32\" mat-dialog-close>\n                    Close\n                </button>\n            </footer>\n        </div>\n    `,\n    styles: [\n        `\n            [body] {\n                min-width: 80vw !important;\n            }\n        `,\n    ],\n})\nexport class MapLocateModalComponent extends AsyncHandler implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter();\n    /** Space to show the location of on the map */\n    public item: Locatable = this._data.item;\n    /** Features of the map */\n    public features: ViewerFeature[];\n    /** Mapping of elements to CSS styles */\n    public style_map: ViewerStyles = {};\n\n    public get level(): BuildingLevel {\n        return this.item.level || this._org.levelWithID(this.item.zones || []);\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: { item: Locatable },\n        private _org: OrganisationService\n    ) {\n        super();\n        if (!this.item.level?.id) {\n            delete this.item.level;\n        }\n        console.log('Data:', this._data);\n    }\n\n    public ngOnInit(): void {\n        this.timeout(\n            'init',\n            () => {\n                this.processFeature();\n                this.processStyles();\n            },\n            1000\n        );\n    }\n\n    public processStyles(): void {\n        const styles: ViewerStyles = {};\n        if (this.item?.map_id) {\n            styles[`#zones`] = { display: 'none' };\n            styles[`#Zones`] = { display: 'none' };\n        }\n        this.style_map = styles;\n    }\n\n    /** Point on map to focus on */\n    public processFeature(): void {\n        if (!this.item) return null;\n        const focus = {\n            location: this.item.map_id,\n            track_id: `focus_item`,\n            content: MapPinComponent,\n            data: {\n                name: this.item.name,\n            },\n            z_index: 99,\n            zoom: 100,\n        };\n        this.features = [focus];\n    }\n}\n","import { Component, Input } from '@angular/core';\n\n@Component({\n    selector: 'image-carousel',\n    template: `\n        <div class=\"h-full w-full relative overflow-hidden flex\">\n            <div\n                image\n                class=\"h-full min-w-full relative flex items-center justify-center overflow-hidden\"\n                *ngFor=\"let image of images\"\n                [style.transform]=\"'translateX(-' + offset * 100 + '%)'\"\n            >\n                <img\n                    class=\"h-full object-contain\"\n                    *ngIf=\"image\"\n                    [src]=\"image.url || image\"\n                />\n            </div>\n            <div\n                class=\"h-full w-full relative flex flex-col items-center justify-center opacity-30 space-y-2\"\n                *ngIf=\"!images?.length\"\n            >\n                <app-icon class=\"text-5xl\">image_not_supported</app-icon>\n                <p>No images</p>\n            </div>\n            <button\n                matRipple\n                *ngIf=\"images?.length\"\n                class=\"opacity-0 hover:opacity-30 flex items-center justify-center absolute left-0 inset-y-0 w-1/3 bg-black/60 text-white\"\n                [disabled]=\"offset === 0\"\n                (click)=\"offset = offset - 1\"\n            >\n                <app-icon class=\"text-4xl\">chevron_left</app-icon>\n            </button>\n            <button\n                matRipple\n                *ngIf=\"images?.length\"\n                class=\"opacity-0 hover:opacity-30 flex items-center justify-center absolute right-0 inset-y-0 w-1/3 bg-black/60 text-white\"\n                [disabled]=\"offset >= images?.length - 1\"\n                (click)=\"offset = offset + 1\"\n            >\n                <app-icon class=\"text-4xl\">chevron_right</app-icon>\n            </button>\n            <div\n                class=\"absolute bottom-1 left-1/2 -translate-x-1/2 text-sm opacity-30 space-x-2\"\n                *ngIf=\"images?.length\"\n            >\n                <button\n                    matRipple\n                    [class.!bg-white]=\"offset === i\"\n                    *ngFor=\"let img of images; let i = index\"\n                    class=\"h-4 w-4 rounded-full bg-gray-400 shadow\"\n                ></button>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                height: 100%;\n                width: 100%;\n            }\n\n            [image] {\n                transition: transform 300ms;\n            }\n        `,\n    ],\n})\nexport class ImageCarouselComponent {\n    @Input() public images: string[] = [];\n\n    public offset = 0;\n}\n","import { Pipe } from \"@angular/core\";\nimport { formatDuration } from \"date-fns\";\n\n@Pipe({\n    name: 'duration'\n})\nexport class DurationPipe {\n\n    /**\n     * Format the duration value\n     * @param length Duration to format in minutes\n     * @param shorten Whether to shorten the period names e.g. `hours` as `h`\n     */\n    public transform(length: number, shorten: boolean = false): string {\n        let duration = formatDuration({ hours: Math.floor(length / 60), minutes: length % 60 });\n        if (shorten) {\n            duration = duration.replace('hour', 'h').replace('minute', 'm').replace(/s/gi, '');\n        }\n        return duration;\n    }\n}","import { Component, OnInit } from \"@angular/core\";\nimport { Router } from \"@angular/router\";\nimport { first } from \"rxjs/operators\";\n\nimport { SettingsService } from \"@placeos/common\";\nimport { OrganisationService } from \"libs/organisation/src/lib/organisation.service\";\n\n@Component({\n    selector: 'page-redirect',\n    template: ``,\n    styles: [``]\n})\nexport class RedirectComponent implements OnInit {\n    constructor(private _settings: SettingsService, private _org: OrganisationService, private _router: Router) {}\n\n    public async ngOnInit() {\n        await this._settings.initialised.pipe(first(_ => _)).toPromise();\n        await this._org.initialised.pipe(first(_ => _)).toPromise();\n        if (!this._settings.get('app.default_route')) return;\n        this._router.navigate(this._settings.get('app.default_route').split('/'));\n    }\n}\n","import { Component, Input, Optional, SimpleChanges } from \"@angular/core\";\nimport { CustomTooltipData } from \"./custom-tooltip.component\";\n\n@Component({\n    selector: 'json-display',\n    template: `\n        <div class=\"bg-white dark:bg-neutral-600 shadow rounded overflow-auto max-w-[80vw] max-h-[80vh] p-2\">\n            <pre class=\"font-mono text-sm bg-black/10 p-2\">{{ formatted_json }}</pre>\n        </div>\n    `\n})\nexport class JsonDisplayComponent {\n    @Input() public json: Object;\n\n    public formatted_json: string;\n\n    constructor(@Optional() _data: CustomTooltipData) {\n        this.json = _data?.data || '';\n        this._updateFormatting();\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.json) {\n            this._updateFormatting();\n        }\n    }\n\n    private _updateFormatting() {\n        this.formatted_json = JSON.stringify(this.json, undefined, 4);\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { HotkeysService } from 'libs/common/src/lib/hotkeys.service';\nimport { AsyncHandler } from 'libs/common/src/lib/async-handler.class';\nimport {\n    ClientEvent,\n    RemoteLoggingService,\n} from 'libs/common/src/lib/remote-logging.service';\nimport { JsonDisplayComponent } from './json-display.component';\n\nconst COLOR_MAP = {\n    console: 'bg-purple-600/30',\n    network: 'bg-green-600/30',\n    dom: 'bg-indigo-600/30',\n\n    log: `bg-cyan-600/50`,\n    info: `bg-blue-600/50`,\n    warn: `bg-orange-600/50`,\n    debug: `bg-gray-600/50`,\n    error: `bg-red-600/50`,\n};\n\nconst URL_STARTS = [\n    'tel:',\n    'mailto:',\n    'http:',\n    'https:',\n    'ftp:',\n    'ws:',\n    'wss:',\n];\n\n@Component({\n    selector: `debug-console`,\n    template: `\n        <div\n            class=\"absolute bottom-2 inset-x-2 bg-black/80 text-white shadow rounded overflow-hidden h-[32rem] max-h-65vh flex flex-col z-[998]\"\n            *ngIf=\"show\"\n        >\n            <cdk-virtual-scroll-viewport\n                itemSize=\"32\"\n                class=\"flex-1 h-[30rem] max-h-full w-full\"\n            >\n                <div\n                    class=\"font-mono h-8 truncate p-2 text-sm flex items-center max-w-full hover:bg-white/10 space-x-1\"\n                    *cdkVirtualFor=\"\n                        let log of filtered_logs | async;\n                        trackBy: trackByFn\n                    \"\n                >\n                    <div\n                        class=\"uppercase text-xs p-1 bg-white/10 rounded font-mono\"\n                    >\n                        {{ log.timestamp | date: 'MMM d HH:mm:ss' }}\n                    </div>\n                    <div\n                        [class]=\"\n                            'uppercase text-xs p-1 ' +\n                            colors[log.type] +\n                            ' rounded font-mono'\n                        \"\n                    >\n                        {{ log.type }}\n                    </div>\n                    <div\n                        [class]=\"\n                            'capitalize text-xs p-1 ' +\n                            colors[log.subtype] +\n                            ' rounded font-mono w-16 text-center'\n                        \"\n                    >\n                        {{ log.subtype }}\n                    </div>\n                    <div\n                        class=\"font-mono\"\n                        *ngFor=\"let obj of log.data\"\n                        [attr.data-type]=\"type(obj)\"\n                    >\n                        <ng-container [ngSwitch]=\"type(obj)\">\n                            <ng-container *ngSwitchCase=\"'link'\">\n                                <a\n                                    class=\"font-mono\"\n                                    [href]=\"obj | sanitize\"\n                                    target=\"_blank\"\n                                    rel=\"noopener noreferer\"\n                                    >{{ obj }}</a\n                                >\n                            </ng-container>\n                            <ng-container *ngSwitchCase=\"'object'\">\n                                [<span\n                                    class=\"underline font-mono hover:text-blue-500\"\n                                    customTooltip\n                                    xPosition=\"center\"\n                                    yPosition=\"bottom\"\n                                    [content]=\"json_tooltip\"\n                                    [data]=\"obj\"\n                                    [hover]=\"true\"\n                                    [backdrop]=\"false\"\n                                    >Object</span\n                                >]\n                            </ng-container>\n                            <ng-container *ngSwitchDefault>{{\n                                obj\n                            }}</ng-container>\n                        </ng-container>\n                    </div>\n                </div>\n            </cdk-virtual-scroll-viewport>\n            <div\n                class=\"absolute bottom-0 right-2 rounded-t-lg bg-black/90 p-2 flex items-center space-x-2 w-[20rem]\"\n            >\n                <input\n                    #search_input\n                    name=\"log-filter\"\n                    [ngModel]=\"filter | async\"\n                    (ngModelChange)=\"filter.next($event)\"\n                    placeholder=\"Filter logs...\"\n                    class=\"border-none bg-white/10 flex-1 text-sm px-2 py-1 font-mono rounded\"\n                />\n                <div class=\"font-mono text-xs px-2 text-center\">\n                    <span class=\"font-mono\" *ngIf=\"(filter | async)?.length\">\n                        {{ (filtered_logs | async)?.length || '0' }} of\n                    </span>\n                    {{ (logs | async)?.length }}\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class DebugConsoleComponent extends AsyncHandler {\n    @Input() public show = false;\n    public readonly colors = COLOR_MAP;\n    public readonly json_tooltip = JsonDisplayComponent;\n    public readonly filter = new BehaviorSubject<string>('');\n    public readonly logs = new BehaviorSubject<ClientEvent[]>([]);\n    public readonly filtered_logs = combineLatest([\n        this.filter,\n        this.logs,\n    ]).pipe(\n        map(([s, logs]) =>\n            logs.filter(\n                (_) =>\n                    _.type.toLowerCase().includes(s.toLowerCase()) ||\n                    _.subtype.toLowerCase().includes(s.toLowerCase()) ||\n                    `${_.data}`.toLowerCase().includes(s.toLowerCase())\n            )\n        )\n    );\n\n    constructor(\n        private _logs: RemoteLoggingService,\n        private _hotkey: HotkeysService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'logs',\n            this._logs.history.subscribe((event) =>\n                this.logs.next([...this.logs.getValue(), event])\n            )\n        );\n        this.subscription(\n            'toggle',\n            this._hotkey.listen(\n                ['Control', 'Backquote'],\n                () => (this.show = !this.show)\n            )\n        );\n    }\n\n    public type(item: any) {\n        if (\n            typeof item === 'string' &&\n            URL_STARTS.find((start) => item.startsWith(start))\n        ) {\n            return 'link';\n        } else if (item instanceof Object) {\n            return 'object';\n        }\n        return 'string';\n    }\n\n    public trackByFn(_: number, item: ClientEvent) {\n        return item?.timestamp;\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { marked } from 'marked';\n\nexport interface ChangelogModalData {\n    changelog: string;\n}\n\n@Component({\n    selector: 'changelog-modal',\n    template: `\n        <header>\n            <h3 mat-dialog-title>Changelog</h3>\n            <button icon mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"p-4 markdown max-h-[65vh] max-w-[80vw] overflow-auto\"\n            *ngIf=\"changelog; else empty_state\"\n            [innerHTML]=\"changelog | safe: 'html'\"\n        ></main>\n        <ng-template #empty_state>\n            <div class=\"flex items-center justify-center flex-col space-y-2\">\n                <app-icon class=\"text-3xl\">close</app-icon>\n                <div class=\"text\">No changelog</div>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class ChangelogModalComponent {\n    /** Whether the changelog is loading */\n    public loading: boolean;\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: ChangelogModalData) {}\n\n    /** HTML string for rendering the change log */\n    public get changelog(): string {\n        return marked(this._data.changelog || '');\n    }\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { ClipboardModule } from '@angular/cdk/clipboard';\nimport { MatRippleModule } from '@angular/material/core';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { PortalModule } from '@angular/cdk/portal';\n\nimport { HttpClientModule } from '@angular/common/http';\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { BindingDirective } from './binding.directive';\nimport { ActionIconComponent } from './action-icon.component';\nimport { IconComponent } from './icon.component';\nimport { PopoutMenuComponent } from './popout-menu.component';\nimport { UserAvatarComponent } from './user-avatar.component';\n\nimport { ConfirmModalComponent } from './confirm-modal.component';\nimport {\n    InteractiveMapComponent,\n    MAP_FEATURE_DATA,\n} from './interactive-map.component';\nimport { MapPinComponent } from './map-pin.component';\nimport { MapRadiusComponent } from './map-radius.component';\nimport { StatusOverlayComponent } from './status-overlay.component';\nimport { FixedPipe } from './fixed.pipe';\nimport { SafePipe } from './safe.pipe';\nimport { SanitizePipe } from './sanitise.pipe';\nimport { CustomTableComponent } from './custom-table.component';\nimport { CustomTooltipComponent } from './custom-tooltip.component';\nimport { VirtualKeyboardComponent } from './virtual-keyboard.component';\nimport { GlobalLoadingComponent } from './global-loading.component';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MapPolygonComponent } from './map-polygon.component';\nimport { GlobalBannerComponent } from './global-banner.component';\nimport { MapLocateModalComponent } from './map-locate-modal.component';\nimport { ImageCarouselComponent } from './image-carousel.component';\nimport { DurationPipe } from './duration.pipe';\nimport { RedirectComponent } from './redirect.component';\nimport { DebugConsoleComponent } from './debug-console.component';\nimport { ScrollingModule } from '@angular/cdk/scrolling';\nimport { JsonDisplayComponent } from './json-display.component';\nimport { ChangelogModalComponent } from './changelog-modal.component';\n\nconst MAT_MODULES: any[] = [\n    MatAutocompleteModule,\n    MatMenuModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatRippleModule,\n    MatAutocompleteModule,\n    MatSelectModule,\n    MatDialogModule,\n    MatDatepickerModule,\n    MatInputModule,\n    ClipboardModule,\n    MatProgressSpinnerModule,\n    MatChipsModule,\n    MatPaginatorModule,\n    CdkTableModule,\n    PortalModule,\n    MatSortModule,\n    ScrollingModule,\n];\n\nconst COMPONENTS: Type<any>[] = [\n    ActionIconComponent,\n    IconComponent,\n    PopoutMenuComponent,\n    UserAvatarComponent,\n\n    ConfirmModalComponent,\n    InteractiveMapComponent,\n    MapPinComponent,\n    MapRadiusComponent,\n    MapPolygonComponent,\n    StatusOverlayComponent,\n    CustomTableComponent,\n    CustomTooltipComponent,\n    VirtualKeyboardComponent,\n    GlobalLoadingComponent,\n    GlobalBannerComponent,\n    MapLocateModalComponent,\n    ImageCarouselComponent,\n    RedirectComponent,\n    DebugConsoleComponent,\n    JsonDisplayComponent,\n    ChangelogModalComponent,\n\n    FixedPipe,\n    SafePipe,\n    SanitizePipe,\n    DurationPipe,\n];\n\nconst DIRECTIVES: Type<any>[] = [BindingDirective];\n\n@NgModule({\n    declarations: [...COMPONENTS, ...DIRECTIVES],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        HttpClientModule,\n        ...MAT_MODULES,\n    ],\n    providers: [{ provide: MAP_FEATURE_DATA, useValue: {} }],\n    exports: [...COMPONENTS, ...DIRECTIVES, ...MAT_MODULES, TranslateModule],\n})\nexport class ComponentsModule {}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n    selector: 'an-action-field',\n    template: `\n        <button\n            class=\"flex items-center rounded p-2 border border-gray-300 hover:border-black w-full\"\n            type=\"button\"\n            role=\"button\"\n            [attr.disabled]=\"disabled\"\n            [attr.name]=\"name\"\n            form-field\n            tabindex=\"0\"\n            (keydown.enter)=\"performAction()\"\n        >\n            <div\n                placeholder\n                class=\"flex-1 w-0 truncate\"\n                (click)=\"performAction()\"\n            >\n                <ng-content></ng-content>\n            </div>\n            <app-icon class=\"text-xl\" (click)=\"performAction()\">\n                arrow_drop_{{ show_tooltip ? 'up' : 'down' }}\n            </app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host > div:hover {\n                box-shadow: inset 0 0 0 1px #000;\n            }\n        `,\n    ],\n})\nexport class ActionFieldComponent {\n    /** Name of the field */\n    @Input() public name: string;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Emitter for user interaction events */\n    @Output('onAction') public on_action = new EventEmitter();\n    /** Whether to show tooltip */\n    public show_tooltip = false;\n\n    /**\n     * Emit that the user has performed an action on the field\n     */\n    public performAction() {\n        this.show_tooltip = !this.show_tooltip;\n        this.on_action.emit();\n    }\n}\n","import { Component, forwardRef, Input } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\n\n@Component({\n    selector: 'a-counter',\n    template: `\n        <div\n            counter\n            class=\"flex items-center text-base\"\n            (window:keydown.shift)=\"shift_key = true\"\n            (window:keydown.control)=\"ctrl_key = true\"\n            (window:keydown.meta)=\"ctrl_key = true\"\n            (window:keyup.shift)=\"shift_key = false\"\n            (window:keyup.control)=\"ctrl_key = false\"\n            (window:keyup.meta)=\"ctrl_key = false\"\n        >\n            <button\n                icon\n                matRipple\n                name=\"remove\"\n                type=\"button\"\n                [disabled]=\"!value || value === min\"\n                (click)=\"remove()\"\n            >\n                <app-icon>remove</app-icon>\n            </button>\n            <div value class=\"p-1 text-center\">\n                {{ (render_fn ? render_fn(value) : value) || '0' }}\n            </div>\n            <button\n                icon\n                matRipple\n                name=\"add\"\n                type=\"button\"\n                [disabled]=\"value === max\"\n                (click)=\"add()\"\n            >\n                <app-icon>add</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            [value] {\n                min-width: 3em;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => CounterComponent),\n            multi: true,\n        },\n    ],\n})\nexport class CounterComponent implements ControlValueAccessor {\n    /** Size of a single step */\n    @Input() public step = 1;\n    /** Maximum amount for the counter */\n    @Input() public max = 10;\n    /** Minimum amount for the counter */\n    @Input() public min = 0;\n    /** Custom function for rendering the counter value */\n    @Input() public render_fn: (v: number) => string;\n    /** Current value of the counter */\n    public value: number;\n    /** Whether shift key is being held by the user */\n    public shift_key: boolean;\n    /** Whether control key is being held by the user */\n    public ctrl_key: boolean;\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /**\n     * Add the `step` to the current value\n     */\n    public add() {\n        if (!this.value) {\n            this.value = this.min || 0;\n        }\n        const step = this.ctrl_key\n            ? 100 * this.step\n            : this.shift_key\n            ? 10 * this.step\n            : this.step || 1;\n        this.value += step;\n        if (this.value > this.max) {\n            this.value = this.max || 10;\n        }\n        this.setValue(this.value);\n    }\n\n    /** Remove the `step` from the current value */\n    public remove() {\n        if (!this.value) {\n            this.value = this.min || 0;\n        }\n        const step = this.ctrl_key\n            ? 100 * this.step\n            : this.shift_key\n            ? 10 * this.step\n            : this.step || 1;\n        this.value -= step;\n        if (this.value < this.min) {\n            this.value = this.min || 0;\n        }\n        this.setValue(this.value);\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number): void {\n        this.value = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.value = value;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n}\n","import {\n    Component,\n    forwardRef,\n    Injectable,\n    Input,\n    OnInit,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport {\n    DateAdapter,\n    MatDateFormats,\n    MAT_DATE_FORMATS,\n    NativeDateAdapter,\n} from '@angular/material/core';\nimport {\n    addYears,\n    endOfDay,\n    format,\n    formatISO,\n    set,\n    startOfDay,\n} from 'date-fns';\nimport { AsyncHandler } from 'libs/common/src/lib/async-handler.class';\nimport { HashMap } from 'libs/common/src/lib/types';\n\n@Injectable()\nclass FieldDateAdapter extends NativeDateAdapter {\n    format(date: Date, displayFormat: HashMap | string): string {\n        if (displayFormat === 'input') {\n            return format(date, 'MMMM d, yyyy');\n        }\n        return format(date, 'MMM yyyy');\n    }\n}\nconst FIELD_DATE_FORMATS: MatDateFormats = {\n    parse: {\n        dateInput: 'LL',\n    },\n    display: {\n        dateInput: 'input',\n        monthYearLabel: 'MMM YYYY',\n        dateA11yLabel: 'LL',\n        monthYearA11yLabel: 'MMMM YYYY',\n    },\n};\n\n@Component({\n    selector: 'a-date-field',\n    template: `\n        <mat-form-field appearance=\"outline\" (click)=\"picker.open()\">\n            <input\n                matInput\n                [ngModel]=\"date\"\n                [disabled]=\"disabled\"\n                [min]=\"from\"\n                [max]=\"until\"\n                (ngModelChange)=\"setValue($event)\"\n                [matDatepicker]=\"picker\"\n            />\n            <mat-datepicker-toggle\n                matSuffix\n                [for]=\"picker\"\n            ></mat-datepicker-toggle>\n            <mat-datepicker #picker></mat-datepicker>\n            <mat-error><ng-content></ng-content></mat-error>\n        </mat-form-field>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        { provide: DateAdapter, useClass: FieldDateAdapter },\n        { provide: MAT_DATE_FORMATS, useValue: FIELD_DATE_FORMATS },\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DateFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DateFieldComponent\n    extends AsyncHandler\n    implements OnInit, ControlValueAccessor\n{\n    /** Earliest date available the user is allowed to pick */\n    @Input('from') public _from: number = new Date().valueOf();\n    /** Latest date available the user is allowed to pick */\n    @Input('to') public _to: number;\n    /** Position of the tooltip */\n    @Input() public position: 'right' | 'left' = 'right';\n    /** Offset of the tooltip */\n    @Input() public offset: 'top' | 'bottom' = 'bottom';\n    /** Whether form control is disabled */\n    @Input() public disabled: boolean;\n    /** Whether to show the calendar tooltip */\n    public show_tooltip: boolean;\n    /** Currently selected date */\n    public date: string;\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /** First allowed date on the calendar */\n    public get from(): Date {\n        return new Date(this._from) || startOfDay(new Date());\n    }\n    /** Current date value */\n    public get until(): Date {\n        return new Date(this._to) || addYears(endOfDay(new Date()), 1);\n    }\n    /** Display value for the current date */\n    public get date_string(): string {\n        return format(new Date(this.date), 'DD MMM YYYY');\n    }\n\n    public ngOnInit() {\n        this.date = new Date().toISOString();\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number) {\n        // Keep hours and minutes of the old date\n        const old_date = new Date(this.date);\n        let new_date = set(new_value, {\n            hours: old_date.getHours(),\n            minutes: old_date.getMinutes(),\n        }).valueOf();\n        // Check that new date is before from\n        if (new_date < this.from.valueOf()) {\n            new_date = this.from.valueOf();\n        }\n        this.date = formatISO(new_date || new Date());\n        if (this._onChange) {\n            this._onChange(new_date);\n        }\n        this.show_tooltip = false;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.date = formatISO(value || new Date());\n        this.show_tooltip = false;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n}\n","import {\n    Component,\n    forwardRef,\n    Input,\n    OnChanges,\n    OnInit,\n    SimpleChanges,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { addMinutes, formatDuration } from 'date-fns';\n\nexport interface DurationOption {\n    id: number;\n    name: string;\n    date?: number;\n}\n\n@Component({\n    selector: 'a-duration-field',\n    template: `\n        <div class=\"duration-field\" [attr.disabled]=\"disabled\">\n            <mat-form-field appearance=\"outline\">\n                <mat-select\n                    #select\n                    [value]=\"duration\"\n                    [disabled]=\"disabled\"\n                    [placeholder]=\"duration + ' minutes'\"\n                    (valueChange)=\"setValue($event)\"\n                >\n                    <mat-option\n                        *ngFor=\"let option of duration_options\"\n                        [value]=\"option.id\"\n                    >\n                        {{\n                            option.date\n                                ? (option.date\n                                      | date\n                                          : (option.id >= 24 * 60\n                                                ? 'mediumDate'\n                                                : 'h : mm a')) + ' ('\n                                : ''\n                        }}{{ option.name }}{{ option.date ? ')' : '' }}\n                    </mat-option>\n                </mat-select>\n                <mat-error><ng-content></ng-content></mat-error>\n            </mat-form-field>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DurationFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DurationFieldComponent\n    implements OnInit, OnChanges, ControlValueAccessor\n{\n    /** Maximum duration option available */\n    @Input() public max = 240;\n    /** Minimum duration option available */\n    @Input() public min = 30;\n    /** Step value between options */\n    @Input() public step = 15;\n    /** Reference time for displaying next to durations */\n    @Input() public time: number;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Special case prepopulation i.e. out of step options */\n    @Input() public custom_options: number[] = [];\n\n    public duration = 60;\n    /** List of available duration options */\n    public duration_options: DurationOption[] = [];\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    public ngOnInit(): void {\n        this.duration_options = this.generateDurationOptions(\n            this.max,\n            this.min,\n            this.step\n        );\n        this._updateOption();\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        /* istanbul ignore else */\n        if (\n            changes.max ||\n            changes.min ||\n            changes.step ||\n            changes.time ||\n            changes.custom_options\n        ) {\n            this.duration_options = this.generateDurationOptions(\n                this.max,\n                this.min,\n                this.step\n            );\n            this._updateOption();\n        }\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number): void {\n        this.duration = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(+new_value);\n        }\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.duration = value;\n        this._updateOption();\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    private generateDurationOptions(max: number, min: number, step: number) {\n        const blocks: DurationOption[] = [];\n        let time = min;\n        const date = this.time ? this.time : null;\n\n        // Add special cases\n        for (const option of this.custom_options) {\n            blocks.push({\n                id: option,\n                date: date ? addMinutes(date, option).valueOf() : undefined,\n                name:\n                    option >= 24 * 60\n                        ? `${formatDuration({\n                              days: Math.floor(option / (24 * 60)),\n                          })}`\n                        : `${formatDuration({\n                              hours: Math.floor(option / 60),\n                              minutes: option % 60,\n                          })}`,\n            });\n        }\n\n        while (time <= max) {\n            blocks.push({\n                id: time,\n                date: date ? addMinutes(date, time).valueOf() : undefined,\n                name:\n                    time >= 24 * 60\n                        ? `${formatDuration({\n                              days: Math.floor(time / (24 * 60)),\n                          })}`\n                        : `${formatDuration({\n                              hours: Math.floor(time / 60),\n                              minutes: time % 60,\n                          })}`,\n            });\n            time += step;\n        }\n        blocks.sort((a, b) => a.id - b.id);\n        return blocks;\n    }\n\n    private _updateOption() {\n        if (!this.duration_options?.length) return;\n        const idx = this.duration_options.findIndex(\n            (_) => _.id === this.duration\n        );\n        if (idx < 0) this.setValue(this.min);\n    }\n}\n","import {\n    Component,\n    forwardRef,\n    Input,\n    OnChanges,\n    OnInit,\n    SimpleChanges,\n    ViewChild,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatSelect } from '@angular/material/select';\nimport { AsyncHandler, Identity, timeFormatString } from '@placeos/common';\nimport {\n    addMinutes,\n    endOfDay,\n    format,\n    isAfter,\n    isSameDay,\n    roundToNearestMinutes,\n    set,\n    startOfDay,\n    startOfMinute,\n} from 'date-fns';\n\n@Component({\n    selector: 'a-time-field',\n    template: `\n        <mat-form-field appearance=\"outline\">\n            <mat-select\n                #select\n                [value]=\"time\"\n                [disabled]=\"disabled\"\n                (valueChange)=\"setValue($event)\"\n            >\n                <mat-option\n                    *ngFor=\"let option of time_options\"\n                    [value]=\"option.id\"\n                >\n                    {{ option.date | date: 'h : mm a' }}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => TimeFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class TimeFieldComponent\n    extends AsyncHandler\n    implements OnInit, OnChanges, ControlValueAccessor\n{\n    /** Time step between each allowed time option */\n    @Input() public step = 15;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Whether past times are allowed */\n    @Input() public no_past_times = true;\n    /** String representing the currently set time */\n    public date: number = new Date().valueOf();\n    /** String representing the currently set time */\n    public time: string = format(new Date(), 'HH:mm');\n    /** Available time blocks for the selected date */\n    public _time_options: any[];\n    /** Whether select field should be shown */\n    public show_select: boolean;\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /** Select field for selecting the time */\n    @ViewChild('select') private select_field: MatSelect;\n\n    public ngOnInit(): void {\n        this.show_select = true;\n        this._time_options = this.generateAvailableTimes(\n            this.date,\n            !this.no_past_times,\n            this.step\n        );\n        this.timeout('hide', () => (this.show_select = false));\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.no_past_times || changes.step) {\n            this._time_options = this.generateAvailableTimes(\n                this.date,\n                !this.no_past_times,\n                this.step\n            );\n        }\n    }\n\n    /** Available time blocks for the selected date */\n    public get time_options() {\n        const time = (this.time || '00:00').split(':');\n        const date = set(this.date, { hours: +time[0], minutes: +time[1] });\n        if (\n            date.getMinutes() % 15 !== 0 &&\n            !this._time_options.find(\n                (time) => time.id === format(date, 'HH:mm')\n            )\n        ) {\n            this._time_options.push({\n                date,\n                id: format(date, 'HH:mm'),\n            });\n            this._time_options.sort((a, b) =>\n                `${a.id}`.localeCompare(`${b.id}`)\n            );\n        }\n        return this._time_options;\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: string): void {\n        this.time = new_value;\n        if (this._onChange) {\n            const time = (this.time || '00:00').split(':');\n            const date = startOfMinute(\n                set(this.date, { hours: +time[0], minutes: +time[1] })\n            );\n            this._onChange(date.valueOf());\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.date = value || this.date;\n        let date = startOfMinute(this.date);\n        date = roundToNearestMinutes(date, { nearestTo: 5 });\n        this.time = format(date, 'HH:mm');\n        this._time_options = this.generateAvailableTimes(\n            this.date,\n            !this.no_past_times,\n            this.step\n        );\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    /**\n     * Show select field for time options\n     */\n    public showSelect() {\n        this.show_select = true;\n        this.timeout('on_shown', () => {\n            if (this.select_field) {\n                this.select_field.focus();\n                this.select_field.open();\n                this.subscription(\n                    'listen_close',\n                    this.select_field.openedChange.subscribe((state) => {\n                        if (!state) {\n                            this.show_select = false;\n                        }\n                    })\n                );\n            }\n        });\n    }\n\n    /**\n     * Generate a list of time options for the given date\n     * @param datestamp Date to generate options for\n     * @param show_past Whether past times should be options\n     */\n    private generateAvailableTimes(\n        datestamp: number,\n        show_past: boolean,\n        step: number = 15\n    ): Identity[] {\n        const now = new Date();\n        let date = new Date(datestamp);\n        const blocks = [];\n        if (show_past || (!isSameDay(date, now) && isAfter(date, now))) {\n            date = startOfDay(date);\n        } else if (isAfter(date, now)) {\n            date = now;\n        }\n        date = roundToNearestMinutes(date, { nearestTo: step });\n        const end = endOfDay(date);\n        // Add options for the rest of the day\n        while (isAfter(end, date)) {\n            blocks.push({\n                date: date.valueOf(),\n                id: format(date, 'HH:mm'),\n            });\n            date = addMinutes(date, step);\n        }\n        return blocks;\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\n\n@Component({\n    selector: 'user-form',\n    template: `\n        <form user-form *ngIf=\"form\" [formGroup]=\"form\" class=\"w-full\">\n            <div class=\"flex flex-col w-full\" *ngIf=\"form.controls.name\">\n                <label for=\"name\" [class.error]=\"hasError('name')\">\n                    Name<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        placeholder=\"Name\"\n                        formControlName=\"name\"\n                    />\n                    <mat-error>Name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"flex flex-col w-full\" *ngIf=\"form.controls.email\">\n                <label for=\"email\" [class.error]=\"hasError('email')\">\n                    Email<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"email\"\n                        placeholder=\"Email Address\"\n                        formControlName=\"email\"\n                    />\n                    <mat-error>A valid email is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div\n                class=\"flex flex-col w-full\"\n                *ngIf=\"form.controls.organisation\"\n            >\n                <label for=\"org\" [class.error]=\"hasError('organisation')\">\n                    {{ 'COMMON.ORGANISATION' | translate }}<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"org\"\n                        placeholder=\"e.g. Conteso\"\n                        formControlName=\"organisation\"\n                    />\n                    <mat-error>\n                        {{ 'COMMON.ORGANISATION' | translate }} is required\n                    </mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"flex flex-col w-full\" *ngIf=\"form.controls.phone\">\n                <label for=\"phone\" [class.error]=\"hasError('phone')\">\n                    Phone:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"phone\"\n                        type=\"tel\"\n                        placeholder=\"Phone\"\n                        formControlName=\"phone\"\n                    />\n                    <mat-error>Phone format is invalid</mat-error>\n                </mat-form-field>\n            </div>\n            <div\n                class=\"flex flex-col w-full\"\n                *ngIf=\"form.controls.assistance_required\"\n            >\n                <mat-checkbox\n                    name=\"assistance-required\"\n                    color=\"primary\"\n                    formControlName=\"assistance_required\"\n                >\n                    Assistance required\n                </mat-checkbox>\n            </div>\n            <div\n                class=\"flex flex-col w-full\"\n                *ngIf=\"form.controls.visit_expected\"\n            >\n                <mat-checkbox\n                    name=\"visit-expected\"\n                    color=\"primary\"\n                    formControlName=\"visit_expected\"\n                >\n                    Visit expected\n                </mat-checkbox>\n            </div>\n        </form>\n    `,\n    styles: [\n        `\n            :host,\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class UserFormComponent {\n    /** Group of form fields used for creating the system */\n    @Input() public form?: FormGroup;\n\n    public hasError(name: string) {\n        const { invalid, touched } = this.form?.controls[name] || {};\n        return invalid && touched;\n    }\n}\n","import { Component, OnInit, Output, EventEmitter, Inject } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { AsyncHandler, DialogEvent } from '@placeos/common';\n\nimport { User } from './user.class';\nimport { generateUserForm } from './user.utilities';\n\n@Component({\n    selector: 'new-user-modal',\n    template: `\n        <header>\n            <div class=\"heading\" mat-dialog-title>\n                {{ user?.id ? 'Edit' : 'Add' }} External Attendee\n            </div>\n            <div class=\"flex-1\"></div>\n            <button icon mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"flex flex-col items-center w-full p-2\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <user-form [form]=\"form\"></user-form>\n        </main>\n        <footer\n            class=\"flex items-center justify-center w-full p-2 border-t border-gray-300 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button btn matRipple class=\"inverse\" mat-dialog-close>\n                Cancel\n            </button>\n            <button btn matRipple (click)=\"saveChanges()\">Save</button>\n        </footer>\n        <ng-template #load_state>\n            <main class=\"flex flex-col items-center w-full p-2 space-y-2\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving attendee...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                min-height: 20em !important;\n                width: 100%;\n            }\n\n            footer button {\n                min-width: 8em;\n            }\n        `,\n    ],\n})\nexport class NewUserModalComponent extends AsyncHandler implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Form fields for the new user */\n    public form = generateUserForm(this.user || new User());\n    /** New user data store */\n    public user?: User;\n    /** Whether user details are being saved */\n    public loading = false;\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: any) {\n        super();\n        this.user = this._data.user || {};\n        this.form = generateUserForm(this.user);\n    }\n\n    public ngOnInit(): void {}\n\n    public saveChanges() {\n        if (!this.form) return;\n        this.form.markAllAsTouched();\n        if (this.form.valid) {\n            const new_user = new User({\n                ...this.form.value,\n                is_external: true,\n            });\n            this.event.emit({ reason: 'done', metadata: new_user });\n        }\n    }\n}\n","import { CateringOption } from './catering.interfaces';\n\nexport class CateringItem {\n    /** ID of the catering item */\n    public readonly id: string;\n    /** Display name for the catering item */\n    public readonly name: string;\n    /** Category that this item is associated */\n    public readonly category: string;\n    /** Description of the contents of the catering item */\n    public readonly description: string;\n    /** Unit price in cents for the catering item */\n    public readonly unit_price: number;\n    /** Number of item in the associated order */\n    public readonly quantity: number;\n    /** List of options for the catering item */\n    public readonly options: CateringOption[];\n    /** List of attributes assoicated with the catering item */\n    public readonly tags: string[];\n    /** Whether catering items can be purchased using points */\n    public readonly accept_points: boolean;\n    /** Max percentage of the cost that can be covered using points */\n    public readonly discount_cap: number;\n    /** Total cost for the item */\n    public readonly total_cost: number;\n    /** String list of available options */\n    public readonly options_string: string;\n    /** List of images for the catering item */\n    public readonly images: string[];\n    /** List of active options for the item */\n    public readonly option_list: CateringOption[];\n    /** Price per unit with selected options */\n    public readonly unit_price_with_options: number;\n    /** Zones in which this item is not allow to be ordered in */\n    public readonly hide_for_zones: string[];\n\n    public get custom_id() {\n        const options = this.option_list.map((_) => _.id).join('+');\n        return `${this.id}[${options}]`;\n    }\n\n    constructor(data: Partial<CateringItem> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || data.id || '';\n        this.category = data.category || '';\n        this.unit_price = data.unit_price || 0;\n        this.description = data.description || '';\n        this.quantity = data.quantity || 0;\n        this.discount_cap = data.discount_cap || 0;\n        this.accept_points = !!data.accept_points;\n        this.tags = data.tags || [];\n        this.images = data.images || [];\n        this.options = data.options || [];\n        const has_options = this.options.some((_) => _.active === true);\n        this.option_list =\n            (has_options\n                ? this.options.filter((_) => _.active === true)\n                : data.option_list) || [];\n        this.hide_for_zones = data.hide_for_zones || [];\n        this.unit_price_with_options =\n            this.unit_price +\n            this.option_list\n                .map((i) => i.unit_price || 0)\n                .reduce((c, a) => c + a, 0);\n        this.total_cost = this.unit_price_with_options * this.quantity;\n        this.options_string =\n            this.options\n                ?.map((_) => _.id || '')\n                .sort((a, b) => a.localeCompare(b))\n                .join(',') || '';\n    }\n}\n","import { randomInt } from '@placeos/common';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { CateringItem } from './catering-item.class';\nimport { CateringOrderStatus } from './catering.interfaces';\n\nexport class CateringOrder {\n    /** ID of the order */\n    public readonly id: string;\n    /** ID of the space the order is associated */\n    public readonly system_id: string;\n    /** ID of the event the order is associated */\n    public readonly event_id: string;\n    /** List of items associated with the order */\n    public readonly items: readonly CateringItem[];\n    /** Number of items in the order */\n    public readonly item_count: number;\n    /** Total cost of order */\n    public readonly total_cost: number;\n    /** Invoice number associated with the order */\n    public readonly invoice_number: string;\n    /** Charge code for the order */\n    public readonly charge_code: string;\n    /** Unix epoch in seconds of order delivery time */\n    public readonly deliver_at: number;\n    /** Notes associated with the order */\n    public readonly notes: string;\n    /** Current status of the order */\n    public readonly status: CateringOrderStatus;\n    /** Event associated with the order */\n    public readonly event: CalendarEvent | null;\n\n    constructor(data: Partial<CateringOrder> = {}) {\n        this.id = data.id || `order-${randomInt(9_999_999, 1_000_000)}`;\n        this.system_id = data.system_id || '';\n        this.event_id = data.event_id || data.event?.id || '';\n        this.items = (data.items || []).map((i) => new CateringItem(i));\n        this.item_count = this.items.reduce(\n            (amount, item) => amount + item.quantity,\n            0\n        );\n        this.total_cost = this.items.reduce(\n            (amount, item) => amount + (item.total_cost || 0),\n            0\n        );\n        this.charge_code = data.charge_code || '';\n        this.status = data.status || 'accepted';\n        this.invoice_number = data.invoice_number || '';\n        this.event = data.event || null;\n        this.notes = data.notes || '';\n        this.deliver_at =\n            data.deliver_at ||\n            (data as any).date ||\n            this.event?.date ||\n            new Date().getTime();\n    }\n}\n","import { RoomConfiguration } from '@placeos/common';\nimport { BuildingLevel } from '@placeos/organisation';\n\nimport { CalendarAvailability } from 'libs/calendar/src/lib/calendar.interfaces';\n\nexport type ResourceResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted';\n\nexport class Space {\n    /** ID of the space resource */\n    public readonly id: string;\n    /** Display name of the space resource */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Email address of the resource associated with space */\n    public readonly email: string;\n    /** Capacity of the space resource */\n    public readonly capacity: number;\n    /** List of features available at the space resource  */\n    public readonly feature_list: string[];\n    /** URL to a supporting site for space */\n    public readonly support_url: string;\n    /** ID of the space on the associated map */\n    public readonly map_id: string;\n    /** Whether resource is bookable */\n    public readonly bookable: boolean;\n    /** List of zones the spaces is associated with */\n    public readonly zones: string[];\n    /** List of available room configurations for this room */\n    public readonly configurations: readonly RoomConfiguration[];\n    /** Image url */\n    public readonly images: string[];\n    /** Status of the resource */\n    public readonly response_status: ResourceResponseStatus;\n    /** Level Assoicated with the space */\n    public readonly level: BuildingLevel;\n    /** List of features associated with the space */\n    public readonly features: string[];\n\n    public readonly availability: CalendarAvailability[];\n\n    constructor(data: Partial<Space> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.display_name = data.display_name || '';\n        this.email = (data.email || '').toLowerCase();\n        this.capacity = data.capacity || -1;\n        this.feature_list = data.feature_list || (data.features as any) || [];\n        this.bookable = !!data.bookable;\n        this.zones = data.zones || [];\n        this.support_url = data.support_url || '';\n        this.map_id = data.map_id || '';\n        this.images = data.images || [];\n        this.configurations = data.configurations || [];\n        this.features = data.features || [];\n        this.response_status = data.response_status;\n        this.level = data.level || new BuildingLevel();\n        this.availability = data.availability || [];\n    }\n}\n","import { HashMap } from '@placeos/common';\nimport {\n    addMinutes,\n    addSeconds,\n    differenceInMinutes,\n    format,\n    isAfter,\n    isBefore,\n    isSameMinute,\n    startOfMinute,\n} from 'date-fns';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport {\n    BookingRuleDetails,\n    BookingRules,\n    BookingRuleset,\n    BookingRulesmap,\n    RecurrenceDetails,\n    TimeBlock,\n    TimePeriod,\n} from './event.interfaces';\n\nexport function eventStatus(\n    details: HashMap\n): 'approved' | 'tentative' | 'declined' {\n    if (details.resources?.length) {\n        if (\n            details.resources.every(\n                (i) => i.response_status === 'accepted' || details.approved\n            )\n        ) {\n            return 'approved';\n        } else if (\n            details.resources.some(\n                (i) =>\n                    i.response_status === 'tentative' ||\n                    i.response_status === 'needsAction'\n            )\n        ) {\n            return 'tentative';\n        }\n        return 'declined';\n    }\n    return 'approved';\n}\n\nexport function formatRecurrence({\n    interval,\n    pattern,\n    end,\n}: RecurrenceDetails) {\n    let details = '';\n    if (interval) {\n        switch (pattern) {\n            case 'daily':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} days` : 'Daily'\n                );\n                break;\n            case 'weekly':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} weeks` : 'Weekly'\n                );\n                break;\n            case 'monthly':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} months` : 'Monthly'\n                );\n                break;\n        }\n        details = details.concat(`, until ${format(end, 'MMM do, yyyy')}`);\n    }\n    return details;\n}\n\n/**\n * Generate a list of free time slots between the given bookings\n * @param list List of bookings to find slots between\n * @param min_size Minimum length of a free slot in minutes\n */\nexport function getFreeTimeSlots(\n    list: TimePeriod[],\n    min_size: number = 30\n): TimeBlock[] {\n    let start = new Date(0);\n    const slots: TimeBlock[] = [];\n    list.sort((a, b) => a.date - b.date);\n    for (const booking of list) {\n        const bkn_start = new Date(booking.date);\n        const bkn_end = addMinutes(booking.date, booking.duration);\n        if (isAfter(booking.date, start)) {\n            const diff = Math.abs(differenceInMinutes(bkn_start, start));\n            if (diff >= min_size) {\n                slots.push({\n                    start: start.valueOf(),\n                    end: booking.date,\n                });\n            }\n            start = bkn_end;\n        } else if (isSameMinute(start, booking.date)) {\n            start = bkn_end;\n        }\n    }\n    const s = start.valueOf();\n    slots.push({\n        start: s,\n        end: (s ? s : Date.now()) * 10,\n    });\n    return slots;\n}\n\nexport function periodInFreeTimeSlot(\n    start: number,\n    end: number,\n    list: TimePeriod[],\n    min_size: number = 30\n) {\n    const blocks = getFreeTimeSlots(list, min_size);\n    for (const blk of blocks) {\n        if (\n            start >= blk.start &&\n            start < blk.end &&\n            end > blk.start &&\n            end <= blk.end\n        ) {\n            return true;\n        }\n    }\n    return false;\n}\n\n/**\n * Get the next free time slot from the given bookings\n * @param list List of bookings to find the next slot\n * @param date Date to find next slot after in ms since UTC epoch\n * @param min_size Minimum length of the free slot in minutes\n */\nexport function getNextFreeTimeSlot(\n    list: TimePeriod[],\n    date: number = new Date().valueOf(),\n    min_size: number = 30\n): TimeBlock {\n    const slots = getFreeTimeSlots(list, min_size);\n    const time = addSeconds(startOfMinute(date), 1);\n    for (const block of slots) {\n        if (isAfter(block.start, time)) {\n            return block;\n        } else if (isBefore(time, block.end)) {\n            const duration = differenceInMinutes(block.end, time);\n            if (duration >= min_size) return block;\n        }\n    }\n    return slots[slots.length - 1];\n}\n\nconst MINUTE = 1;\nconst HOUR = 60;\nconst DAY = 24 * HOUR;\nconst WEEK = 7 * DAY;\nconst MONTH = 30 * DAY;\n\nconst DURATION_MAP: { [duration: string]: number } = {\n    month: MONTH,\n    months: MONTH,\n    week: WEEK,\n    weeks: WEEK,\n    day: DAY,\n    days: DAY,\n    hour: HOUR,\n    hours: HOUR,\n    minute: MINUTE,\n    minutes: MINUTE,\n};\n\nconst DEFAULT_RULES: BookingRules = {\n    auto_approve: true,\n    hidden: false,\n};\n\n/**\n * Conver time string into minutes\n * @param str timestring e.g. `'1 day'`, `'15 minutes'`, `'2 weeks'`\n */\nexport function stringToMinutes(str: string): number {\n    const parts = (str || '').split(' ');\n    return parts.length > 1 ? +parts[0] * DURATION_MAP[parts[1]] : 0;\n}\n\nexport function addToDate(add: string, date: Date | number = new Date()) {\n    return addMinutes(date, stringToMinutes(add));\n}\n\nexport function filterSpacesFromRules(\n    spaces: Space[],\n    details: BookingRuleDetails,\n    rulemap: BookingRulesmap\n) {\n    return spaces.filter(\n        (_) => !rulesForSpace({ ...details, space: _ }, rulemap)?.hidden\n    );\n}\n\nexport function rulesForSpace(\n    details: BookingRuleDetails,\n    rulemap: BookingRulesmap\n): BookingRules {\n    const { space } = details;\n    for (const zone of space.zones) {\n        if (rulemap[zone]?.length) {\n            for (const ruleset of rulemap[zone]) {\n                if (ruleset && checkRulesMatch(details, ruleset))\n                    return { ...DEFAULT_RULES, ...ruleset.rules };\n            }\n        }\n    }\n    return DEFAULT_RULES;\n}\n\nexport function checkRulesMatch(\n    { date, duration, host }: BookingRuleDetails,\n    ruleset: BookingRuleset\n): boolean {\n    let matches = 0;\n    const { conditions } = ruleset;\n    if (!conditions) return true;\n    if (\n        conditions.groups instanceof Array &&\n        conditions.groups.every((_) => host?.groups?.includes(_))\n    )\n        matches += 1;\n    if (\n        conditions.is_before &&\n        isBefore(addMinutes(date, duration), addToDate(conditions.is_before))\n    )\n        matches += 1;\n    if (conditions.is_after && isAfter(date, addToDate(conditions.is_after)))\n        matches += 1;\n    if (\n        conditions.min_length &&\n        stringToMinutes(conditions.min_length) <= duration\n    )\n        matches += 1;\n    if (\n        conditions.max_length &&\n        stringToMinutes(conditions.max_length) >= duration\n    )\n        matches += 1;\n    return matches >= Object.keys(conditions).length;\n}\n","import { Identity, removeEmptyFields, unique } from '@placeos/common';\nimport { PlaceSystem } from '@placeos/ts-client';\nimport {\n    add,\n    addMinutes,\n    differenceInMinutes,\n    getUnixTime,\n    isAfter,\n    isBefore,\n    isSameDay,\n    roundToNearestMinutes,\n    set,\n} from 'date-fns';\nimport { CateringOrder } from 'libs/catering/src/lib/catering-order.class';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { GuestUser, User } from 'libs/users/src/lib/user.class';\nimport {\n    EventExtensionData,\n    FileDetails,\n    RecurrenceDetails,\n} from './event.interfaces';\nimport { eventStatus } from './helpers';\n\nlet _default_user: Identity = { id: 'default', name: 'Default User' };\n\nexport function setDefaultCreator(user: Identity) {\n    if (user) _default_user = user;\n}\n\ntype CalendarEventExtended = CalendarEvent & EventExtensionData;\n\n/** User's calendar event/booking */\nexport class CalendarEvent {\n    /** ID of the calendar event */\n    public readonly id: string;\n    /** Status of the event */\n    public readonly status: 'approved' | 'tentative' | 'declined' | 'none';\n    /** Email address of the host */\n    public readonly host: string;\n    /** ID of the calendar associated with the event */\n    public readonly calendar: string;\n    /** Email address of the event creator */\n    public readonly creator: string;\n    /** List of attendees of the event */\n    public readonly attendees: User[];\n    /** List of attendees of the event */\n    public readonly resources: Space[];\n    /** Summary of the event details */\n    public readonly title: string;\n    /** Extended details of the event */\n    public readonly body: string;\n    /** Unix epoch in seconds of the start time of the event */\n    public readonly event_start: number;\n    /** Unix epoch in seconds of the end time of the event */\n    public readonly event_end: number;\n    /** Whether event occurs over the full day */\n    public readonly all_day: boolean;\n    /** Unix epoch of the start time of the event */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** IANA timezone string for the event location */\n    public readonly timezone: string;\n    /** Location details for the event */\n    public readonly location: string;\n    /** URL of the associated meeting */\n    public readonly meeting_url: string;\n    /** URL of the associated meeting */\n    public readonly meeting_id: string;\n    /** URL of the associated meeting */\n    public readonly meeting_provider: string;\n    /** Whether this event is recurring */\n    public readonly recurring: boolean;\n    /** Details about the event's recurrence */\n    public readonly recurrence: RecurrenceDetails;\n    /** ID of the parent recurring event */\n    public readonly recurring_master_id: string;\n    /** Whether event details should be private */\n    public readonly private: boolean;\n    /** File attachements for the event */\n    public readonly attachments: FileDetails[];\n    /** Extra data associated with the event */\n    public readonly extension_data: Partial<EventExtensionData>;\n    /** System associated with the event */\n    public readonly system: PlaceSystem;\n    /** Previous system associated with the event */\n    public readonly old_system: PlaceSystem;\n    /** Host user details of the event */\n    public readonly organiser: User;\n    /** Type of event */\n    public readonly type: 'cancelled' | 'external' | 'internal';\n    /** Whether this event was from a PlaceOS booking instead of a user calendar */\n    public readonly from_bookings: boolean;\n    /** Master event */\n    public master?: CalendarEvent;\n    /** Unique identifier of the event */\n    public readonly ical_uid: string;\n    /** Mailbox email address of the event */\n    public readonly mailbox: string;\n\n    /** Get field from extension data */\n    public ext<K extends keyof EventExtensionData>(key: K) {\n        return this.extension_data[key];\n    }\n\n    constructor(data: Partial<CalendarEventExtended> = {}) {\n        this.id = data.id || '';\n        this.event_start =\n            data.event_start ||\n            getUnixTime(\n                data.date ||\n                    roundToNearestMinutes(addMinutes(new Date(), 3), {\n                        nearestTo: 5,\n                    })\n            );\n        this.event_end =\n            data.event_end ||\n            getUnixTime(\n                addMinutes(this.event_start * 1000, data.duration || 30)\n            );\n        this.calendar = data.calendar || '';\n        this.creator =\n            (data.creator || _default_user.email)?.toLowerCase() || '';\n        this.host = (\n            data.host ||\n            this.creator ||\n            _default_user.email ||\n            ''\n        ).toLowerCase();\n        const attendees = data.attendees || [];\n        this.attendees = attendees\n            .filter((user: any) => !user.resource)\n            .map((u) => new User(u));\n        this.resources =\n            unique(\n                data.resources ||\n                    attendees\n                        .filter((user) => (user as any).resource)\n                        .map((s) => new Space(s as any)),\n                'email'\n            ) || [];\n        this.title = data.title;\n        this.body = data.body || '';\n        this.private = !!data.private;\n        this.all_day = !!data.all_day;\n        this.date = this.event_start * 1000 || this.date;\n        this.duration = this.all_day\n            ? 24 * 60\n            : data.duration ||\n              differenceInMinutes(data.event_end * 1000, this.date) ||\n              30;\n        this.timezone =\n            data.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone;\n        this.meeting_url = data.meeting_url || data.online_meeting_url || '';\n        this.meeting_id = data.meeting_id || data.online_meeting_id || '';\n        this.meeting_provider =\n            data.meeting_provider || data.online_meeting_provider || '';\n        this.recurring = !!data.recurring;\n        this.recurring_master_id = data.recurring_master_id || '';\n        this.organiser = this.attendees.find(\n            (user) => user.email === this.host\n        );\n        this.from_bookings = data.from_bookings ?? false;\n        this.master = data.master ? new CalendarEvent(data.master) : null;\n        this.mailbox = data.mailbox || '';\n        this.ical_uid = data.ical_uid;\n        if (data.recurring) {\n            this.recurrence = {\n                start:\n                    this.event_start * 1000 ||\n                    new Date(\n                        (data.recurrence as any).range_start * 1000\n                    ).valueOf(),\n                end:\n                    data.recurrence.end ||\n                    new Date(\n                        (data.recurrence as any).range_end * 1000\n                    ).valueOf(),\n                interval: data.recurrence.interval,\n                pattern: data.recurrence.pattern,\n                days_of_week: data.recurrence.days_of_week,\n            };\n        } else {\n            this.recurrence = {} as any;\n        }\n        const system = data.system;\n        if (\n            system?.email &&\n            !this.resources.find((_) => _.email === system.email)\n        ) {\n            this.resources.push(new Space(system as any));\n        }\n        this.system = system || (this.resources[0] as any) || null;\n        this.old_system = data.old_system || data.system;\n        this.attachments = data.attachments || [];\n        this.extension_data = data.extension_data || {};\n        this.status = eventStatus({ ...data, ...this }) || 'none';\n        this.location =\n            data.location || this.space?.display_name || this.space?.name || '';\n        this.type =\n            this.status === 'declined'\n                ? 'cancelled'\n                : this.attendees.find((_) => _.is_external)\n                ? 'external'\n                : 'internal';\n        for (const key in data) {\n            if (!(key in this)) {\n                this.extension_data[key] =\n                    data[key] || this.extension_data[key];\n            }\n        }\n        this.extension_data.catering = (this.extension_data.catering || []).map(\n            (i) => new CateringOrder({ ...i, event: this })\n        );\n    }\n\n    /** List of external attendees associated with the event */\n    public get guests() {\n        return this.attendees.filter((f) => !!f.is_external) as GuestUser[];\n    }\n    /** Primary space associated with the booking */\n    public get space() {\n        return this.resources[0] || null;\n    }\n    public get is_today(): boolean {\n        return isSameDay(new Date(this.date), new Date());\n    }\n\n    /**\n     * Convert class data to simple JSON object\n     */\n    public toJSON(): Record<string, any> {\n        const obj: Record<string, any> = { ...this };\n        const end = getUnixTime(addMinutes(this.date, this.duration));\n        const date = this.all_day ? set(this.date, { hours: 12 }) : this.date;\n        obj.event_start = getUnixTime(date);\n        obj.event_end = end;\n        const attendees = this.attendees;\n        if (this.recurring) {\n            obj.recurrence = {\n                ...this.recurrence,\n                range_start: obj.event_start,\n                range_end: getUnixTime(this.recurrence.end),\n            };\n        }\n        obj.recurrence = obj.recurrence\n            ? Object.keys(obj.recurrence).length\n                ? obj.recurrence\n                : null\n            : null;\n        obj.attendees = unique(\n            [\n                ...attendees,\n                ...this.resources.map((_) => ({ ..._, resource: true })),\n            ],\n            'email'\n        );\n        if (!this.all_day) {\n            obj.extension_data.breakdown = 15;\n        }\n        obj.extension_data.catering = obj.extension_data.catering.map(\n            (i) => new CateringOrder({ ...i, event: null })\n        );\n        obj.system_id = this.system?.id;\n        delete obj.catering;\n        delete obj.date;\n        delete obj.duration;\n        delete obj.status;\n        removeEmptyFields(obj);\n        return obj;\n    }\n\n    /** Status of the booking */\n    public get state():\n        | 'future'\n        | 'upcoming'\n        | 'done'\n        | 'started'\n        | 'in_progress' {\n        const now = new Date();\n        const date = this.date;\n        if (isBefore(now, add(date, { minutes: -15 }))) return 'future';\n        if (isBefore(now, date)) return 'upcoming';\n        if (isBefore(now, add(date, { minutes: 15 }))) return 'started';\n        if (isBefore(now, add(date, { minutes: this.duration })))\n            return 'in_progress';\n        return 'done';\n    }\n\n    public get can_check_in(): boolean {\n        const now = new Date();\n        return (\n            this.is_today ||\n            (isAfter(now, this.date) &&\n                isBefore(now, addMinutes(this.date, this.duration)))\n        );\n    }\n}\n","import { del, get, patch } from '@placeos/ts-client';\nimport { map } from 'rxjs/operators';\n\nimport { CalendarEvent } from '../../../events/src/lib/event.class';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { GuestUser } from './user.class';\nimport { Observable } from 'rxjs';\n\nconst GUEST_ENDPOINT = '/api/staff/v1/guests';\n\nexport interface GuestsQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zone_ids?: string;\n    /** Comma seperated list of system(space) ids to check availability */\n    system_ids?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n}\n\n/**\n * Search guests\n * @param q Search string for filtering guests\n */\nexport function searchGuests(q: string): Observable<GuestUser[]> {\n    const query = toQueryString({ q });\n    return get(`${GUEST_ENDPOINT}${q ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new GuestUser(item)))\n    );\n}\n\n/**\n * List guests\n * @param q Parameters to pass to the API request\n */\nexport function queryGuests(q: GuestsQueryParams): Observable<GuestUser[]> {\n    const query = toQueryString({ ...q });\n    return get(`${GUEST_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new GuestUser(item)))\n    );\n}\n\n/**\n * Get guest details\n * @param id ID of the guest\n */\nexport function showGuest(id: string) {\n    return get(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new GuestUser(item))\n    );\n}\n\n/**\n * Update guest metadata\n * @param id ID of the guest\n * @param data New metadata state\n */\nexport function updateGuest(id: string, data: Partial<GuestUser>) {\n    return patch(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`, data).pipe(\n        map((item) => new GuestUser(item))\n    );\n}\n\n/**\n * Remove a guest\n * @param id ID of the guest to remove\n */\nexport function removeGuest(id: string) {\n    return del(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`, {\n        response_type: 'void',\n    });\n}\n\n/**\n * List upcoming meetings for a guest\n * @param id ID of the guest\n */\nexport function listGuestMeetings(id: string) {\n    return get(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}/meetings`).pipe(\n        map((list) => list.map((item) => new CalendarEvent(item)))\n    );\n}\n","import { HashMap } from '@placeos/common';\nimport { get } from '@placeos/ts-client';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { StaffUser } from './user.class';\n\nconst STAFF_ENDPOINT = '/api/staff/v1/people';\n\n/**\n * Search staff members\n * @param q Search string for filtering staff\n */\nexport function searchStaff(q: string): Observable<StaffUser[]> {\n    const query = toQueryString({ q });\n    return get(`${STAFF_ENDPOINT}${q ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item: HashMap) => new StaffUser(item)))\n    );\n}\n\n/**\n * Get user details\n * @param id User ID or email\n */\nexport function showStaff(id: string) {\n    return get(`${STAFF_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n\n/**\n * Get user with their location details\n * @param email User email\n */\nexport function locateStaff(email: string) {\n    return get(`${STAFF_ENDPOINT}/${email}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n","import {\n    Component,\n    forwardRef,\n    Output,\n    EventEmitter,\n    Input,\n    ViewChild,\n    ElementRef,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport {\n    AsyncHandler,\n    csvToJson,\n    currentUser,\n    downloadFile,\n    notifyError,\n    SettingsService,\n    unique,\n} from '@placeos/common';\nimport {\n    catchError,\n    debounceTime,\n    first,\n    map,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\nimport { MatDialog } from '@angular/material/dialog';\nimport { COMMA, ENTER } from '@angular/cdk/keycodes';\nimport { BehaviorSubject, combineLatest, of, zip } from 'rxjs';\n\nimport { NewUserModalComponent } from 'libs/users/src/lib/new-user-modal.component';\nimport { searchGuests } from 'libs/users/src/lib/guests.fn';\nimport { searchStaff } from 'libs/users/src/lib/staff.fn';\nimport { User } from 'libs/users/src/lib/user.class';\nimport { USER_DOMAIN } from 'libs/users/src/lib/user.utilities';\nimport { authority, queryUsers } from '@placeos/ts-client';\n\nfunction validateEmail(email) {\n    const re =\n        /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(email);\n}\n\n@Component({\n    selector: 'a-user-list-field',\n    template: `\n        <div class=\"mb-4\" form-field [attr.disabled]=\"disabled\">\n            <div search>\n                <mat-form-field\n                    class=\"w-full\"\n                    appearance=\"outline\"\n                    matAutocompleteOrigin\n                    #origin=\"matAutocompleteOrigin\"\n                >\n                    <mat-chip-grid #chipList aria-label=\"User Seleciom\">\n                        <mat-chip-row\n                            user\n                            *ngFor=\"let item of active_list\"\n                            [class.bg-yellow-300]=\"item.is_external\"\n                            (removed)=\"removeUser(item)\"\n                        >\n                            {{ item.name || item.email }}\n                            <button\n                                matChipRemove\n                                remove\n                                [attr.aria-label]=\"\n                                    'Remove ' + (item.name || item.email)\n                                \"\n                            >\n                                <app-icon>cancel</app-icon>\n                            </button>\n                        </mat-chip-row>\n                    </mat-chip-grid>\n                    <input\n                        #search_field\n                        placeholder=\"Type a name or email\"\n                        i18n-placeholder\n                        name=\"user_email\"\n                        [ngModel]=\"search$ | async\"\n                        (ngModelChange)=\"updateSearch($event)\"\n                        [matAutocomplete]=\"auto\"\n                        [matChipInputFor]=\"chipList\"\n                        [matChipInputSeparatorKeyCodes]=\"separatorKeysCodes\"\n                        (matChipInputTokenEnd)=\"addUserFromEmail($event.value)\"\n                    />\n                    <mat-spinner\n                        *ngIf=\"loading\"\n                        diameter=\"24\"\n                        matSuffix\n                    ></mat-spinner>\n                </mat-form-field>\n                <mat-autocomplete #auto=\"matAutocomplete\">\n                    <mat-option\n                        *ngIf=\"search_valid_email\"\n                        (click)=\"addUserFromEmail()\"\n                        i18n\n                    >\n                        Add external user with email \"{{ search$.getValue() }}\"\n                    </mat-option>\n                    <mat-option\n                        *ngFor=\"let user of user_list$ | async\"\n                        (click)=\"addUser(user)\"\n                        class=\"leading-tight\"\n                    >\n                        {{ user.name }}<br />\n                        <span class=\"text-xs\">{{ user.email }}</span>\n                    </mat-option>\n                </mat-autocomplete>\n            </div>\n            <div\n                class=\"flex items-center space-x-2 -mt-4\"\n                actions\n                *ngIf=\"!hide_actions\"\n            >\n                <button\n                    btn\n                    matRipple\n                    type=\"button\"\n                    name=\"new-contact\"\n                    class=\"inverse flex-1 sm:flex-none\"\n                    (click)=\"openNewUserModal()\"\n                    i18n=\"Add new external attendee\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        Add&nbsp;<span class=\"hidden sm:inline\">External</span>\n                    </div>\n                </button>\n                <button\n                    btn\n                    matRipple\n                    type=\"button\"\n                    name=\"upload-csv\"\n                    class=\"relative inverse flex-1 sm:flex-none\"\n                    i18n=\"Upload attendee list from CSV file\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        Upload&nbsp;<span class=\"hidden sm:inline\">CSV</span>\n                    </div>\n                    <input\n                        class=\"opacity-0 absolute inset-0\"\n                        type=\"file\"\n                        (change)=\"addUsersFromFile($event)\"\n                    />\n                </button>\n                <button\n                    btn\n                    matRipple\n                    type=\"button\"\n                    name=\"download-template\"\n                    class=\"inverse flex-1 sm:flex-none\"\n                    (click)=\"downloadCSVTemplate(); download.emit()\"\n                    i18n=\"Download template CSV file\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <span class=\"hidden sm:inline\">CSV</span>&nbsp;Template\n                    </div>\n                </button>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            [search] {\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UserListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UserListFieldComponent\n    extends AsyncHandler\n    implements ControlValueAccessor\n{\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Number of characters needed before a search will start */\n    @Input() public limit = 3;\n    /** Whether guests should also show when searching for users */\n    @Input() public guests = false;\n    /** Whether guests should also show when searching for users */\n    @Input() public guests_only = false;\n    /** Whether optional actions should be shown */\n    @Input('hideActions') public hide_actions = false;\n    /** Whether as custom template will be provided outside the component */\n    @Input() public custom_template = false;\n    /** Function for filtering the results of the user list */\n    @Input() public filter: (_: any) => boolean;\n    /** Emitter for action to make a new user */\n    @Output() public new_user = new EventEmitter<void>();\n    /** Whether user should download the CSV template */\n    @Output() public download = new EventEmitter<void>();\n\n    readonly separatorKeysCodes = [ENTER, COMMA] as const;\n\n    /** Whether user list is loading */\n    public loading = false;\n    public readonly search$ = new BehaviorSubject('');\n\n    @ViewChild('search_field') private _search_el: ElementRef<HTMLInputElement>;\n\n    private searchStaff(q: string) {\n        return this._settings.get('app.basic_user_search')\n            ? queryUsers({ q, authority_id: authority()?.id }).pipe(\n                  map((_) => _.data.map((u) => new User(u)))\n              )\n            : searchStaff(q);\n    }\n\n    /** User list to display */\n    public user_list$ = this.search$.pipe(\n        debounceTime(300),\n        switchMap((_) => {\n            this.loading = true;\n            return (\n                _\n                    ? this.guests\n                        ? combineLatest([\n                              this.searchStaff(_),\n                              searchGuests(_),\n                          ]).pipe(\n                              map(([staff, guests]) => {\n                                  if (this.guests_only) staff = [];\n                                  const visitors_list = [];\n                                  const visitors =\n                                      this._settings.get('visitor-invitees') ||\n                                      [];\n                                  for (const item of visitors) {\n                                      const [email, name, company] =\n                                          item.split('|');\n                                      visitors_list.push({\n                                          email,\n                                          name,\n                                          company,\n                                      });\n                                  }\n                                  return unique(\n                                      (staff as any)\n                                          .concat(guests)\n                                          .concat(visitors_list),\n                                      'email'\n                                  );\n                              })\n                          )\n                        : this.searchStaff(_)\n                    : of([])\n            ).pipe(catchError((_) => of([])));\n        }),\n        tap((_) => (this.loading = false))\n    );\n    /** List of active selected users on the list */\n    public active_list: User[] = [];\n\n    /** Form control on change handler */\n    private _onChange: (_: User[]) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: User[]) => void;\n\n    public readonly validFn = (s) => validateEmail(s);\n    public readonly emptyClick = () => this.openNewUserModal(new User());\n\n    public get search_valid_email() {\n        return validateEmail(this.search$.getValue());\n    }\n\n    constructor(\n        private _dialog: MatDialog,\n        private _settings: SettingsService\n    ) {\n        super();\n    }\n\n    public updateSearch(new_value: string = '') {\n        this.timeout('search', () => this.search$.next(new_value));\n    }\n\n    public addUserFromEmail(email: string = '') {\n        if (!email) email = this.search$.getValue();\n        if (!validateEmail(email)) return;\n        const user = new User({ id: email, email, name: email.split('@')[0] });\n        this.addUser(user);\n        const { name, organisation } = user;\n        const visitor_details = `${email}|${name}|${organisation}`;\n        const old_visitors = this._settings.get('visitor-invitees') || [];\n        this._settings.saveUserSetting('visitor-invitees', [\n            ...old_visitors.filter((_) => !_.includes(email)),\n            visitor_details,\n        ]);\n        this.timeout(\n            'clear_search',\n            () => {\n                this.search$.next('');\n                this._search_el.nativeElement.value = '';\n            },\n            100\n        );\n    }\n\n    /**\n     * Add user to the user list\n     * @param user\n     */\n    public addUser(user: User) {\n        const list = this.active_list?.filter((_) => _.id !== user.id) || [];\n        this.setValue([\n            ...list,\n            new User({\n                ...user,\n                id: user.id || user.email,\n                visit_expected:\n                    (!user.id && user.is_external !== true\n                        ? user.visit_expected\n                        : null) ?? true,\n            }),\n        ]);\n        this.timeout(\n            'clear_search',\n            () => {\n                this.search$.next('');\n                this._search_el.nativeElement.value = '';\n            },\n            100\n        );\n    }\n\n    /**\n     * Remove user from the user list\n     * @param user\n     */\n    public removeUser(user: User) {\n        const list = this.active_list.filter((a_user) => a_user.id !== user.id);\n        this.setValue(list);\n    }\n\n    /**\n     * Load CSV file and populate the user list with the contents\n     * @param event File input field event\n     */\n    public addUsersFromFile(event) {\n        /* istanbul ignore else */\n        if (event.target) {\n            const file = event.target.files[0];\n            /* istanbul ignore else */\n            if (file) {\n                const reader = new FileReader();\n                reader.readAsText(file, 'UTF-8');\n                reader.addEventListener('load', (evt) => {\n                    this.processCsvData((evt.srcElement as any).result);\n                    event.target.value = '';\n                });\n                reader.addEventListener('error', (_) =>\n                    notifyError('Error reading file.')\n                );\n            }\n        }\n    }\n\n    /**\n     * Process raw CSV data and save user data to attendee list\n     * @param data CSV data\n     */\n    private processCsvData(data: string) {\n        const list = csvToJson(data) || [];\n        const id = currentUser()?.staff_id || 'unknown';\n        for (const el of list) {\n            el.name = el.name || `${el.first_name} ${el.last_name}`;\n            const display = (\n                el.name || `${Math.floor(Math.random() * 9999_9999)}`\n            )\n                .split(' ')\n                .join('_')\n                .toLowerCase();\n            /* istanbul ignore else */\n            if (!el.email) {\n                el.email = `${display}+${id}@guest.${USER_DOMAIN}`;\n            }\n            const internal_emails = this._settings.get(\n                'app.booking.internal_emails'\n            ) || ['place.tech'];\n            el.visit_expected =\n                el.visit_expected ??\n                !internal_emails.find((_) => el.email.endsWith(_));\n\n            /** Convert phone to string. PWCME-544 */\n            el.phone = '' + el.phone;\n\n            this.addUser(new User(el));\n        }\n    }\n\n    /* istanbul ignore next */\n    /** Download template CSV file */\n    public downloadCSVTemplate() {\n        if (this.custom_template) return;\n        const template = `Organisation,First Name,Last Name,Email,Phone,Assistance Required,Visit Expected\\nFake Org,John,Smith,john.smith@example.com,01234567898,false,true`;\n        downloadFile('template.csv', template);\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User[]): void {\n        this.active_list = new_value;\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User[]) {\n        this.active_list = value;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: User[]) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: User[]) => void): void {\n        this._onTouch = fn;\n    }\n\n    public displayFn(item): string {\n        return item?.name || '';\n    }\n\n    /**\n     * Open modal to add or update user details\n     */\n    public openNewUserModal(user: User = new User()) {\n        const ref = this._dialog.open<NewUserModalComponent>(\n            NewUserModalComponent,\n            {\n                width: 'auto',\n                height: 'auto',\n                data: { user },\n            }\n        );\n        ref.componentInstance?.event\n            .pipe(first((_) => _.reason === 'done'))\n            .subscribe((event) => {\n                this.addUser(event.metadata);\n                ref.close();\n            });\n    }\n}\n","/* eslint-disable @typescript-eslint/member-ordering */\nimport {\n    Component,\n    OnInit,\n    forwardRef,\n    Input,\n    ViewChild,\n    ElementRef,\n} from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\nimport { Subject, Observable, of, forkJoin } from 'rxjs';\nimport {\n    switchMap,\n    debounceTime,\n    distinctUntilChanged,\n    map,\n    catchError,\n} from 'rxjs/operators';\n\nimport { AsyncHandler, flatten, SettingsService } from '@placeos/common';\nimport { searchGuests } from 'libs/users/src/lib/guests.fn';\nimport { searchStaff } from 'libs/users/src/lib/staff.fn';\nimport { User } from 'libs/users/src/lib/user.class';\nimport { authority, queryUsers } from '@placeos/ts-client';\n\n@Component({\n    selector: 'a-user-search-field',\n    template: `\n        <div class=\"user-search-field\" form-field>\n            <mat-form-field appearance=\"outline\">\n                <input\n                    #input\n                    matInput\n                    keyboard\n                    name=\"user-search\"\n                    [(ngModel)]=\"search_str\"\n                    (ngModelChange)=\"search$.next($event || '')\"\n                    [disabled]=\"disabled\"\n                    [placeholder]=\"placeholder || 'Search for user...'\"\n                    [matAutocomplete]=\"auto\"\n                    (keyup.enter)=\"\n                        validate && validate(search_str)\n                            ? setValue(search_str)\n                            : ''\n                    \"\n                    (blur)=\"resetSearchString()\"\n                    (focus)=\"cancelReset()\"\n                />\n                <app-icon matPrefix class=\"text-2xl relative\">search</app-icon>\n                <mat-spinner\n                    *ngIf=\"loading\"\n                    matSuffix\n                    diameter=\"16\"\n                ></mat-spinner>\n            </mat-form-field>\n            <mat-autocomplete\n                #auto=\"matAutocomplete\"\n                (optionSelected)=\"setValue($event.option.value)\"\n            >\n                <mat-option\n                    *ngFor=\"let option of user_list\"\n                    (click)=\"setValue(option); blurInput()\"\n                >\n                    <div class=\"leading-tight\">{{ option.name }}</div>\n                    <div class=\"text-xs opacity-60\">\n                        {{ option.email }}\n                    </div>\n                </mat-option>\n                <mat-option\n                    *ngIf=\"search_str && validate && validate(search_str)\"\n                    class=\"relative pointer-events-none\"\n                >\n                    <div\n                        class=\"absolute inset-0 px-4 pointer-events-auto\"\n                        (mousedown)=\"\n                            $event.stopPropagation(); $event.preventDefault()\n                        \"\n                        (touchstart)=\"\n                            $event.stopPropagation(); $event.preventDefault()\n                        \"\n                        (click)=\"\n                            setValue(search_str);\n                            $event.stopPropagation();\n                            $event.preventDefault()\n                        \"\n                    >\n                        <div class=\"pointer-events-none\" i18n>\n                            Add external attendee \"{{ search_str }}\"\n                        </div>\n                    </div>\n                </mat-option>\n                <mat-option\n                    *ngIf=\"!user_list?.length && (search_str || error)\"\n                    [disabled]=\"!empty_fn\"\n                    (click)=\"empty_fn()\"\n                >\n                    {{ search_str ? 'No users found.' : '' }} {{ error }}\n                </mat-option>\n            </mat-autocomplete>\n        </div>\n    `,\n    styles: [\n        `\n            :host,\n            mat-form-field {\n                width: 100%;\n            }\n\n            app-icon {\n                top: 0.15em;\n                left: -0.15em;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UserSearchFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UserSearchFieldComponent\n    extends AsyncHandler\n    implements OnInit, ControlValueAccessor\n{\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Placeholder text to display */\n    @Input() public placeholder: string;\n    /** Limit available options to these */\n    @Input() public options: User[];\n    /** Whether guests should also show when searching for users */\n    @Input() public guests: boolean;\n    /** Message to display when no user matches have been found */\n    @Input() public error = '';\n    /** Function to validate the search string */\n    @Input() public validate: (s: string) => boolean;\n    /** Function to call when empty list option is clicked */\n    @Input() public empty_fn: () => void;\n    /** Function for filtering the results of the user list */\n    @Input() public filter: (_: any, s?: string) => boolean;\n\n    @Input() public query_fn: (_: string) => Observable<User[]> = (q) =>\n        this._settings.get('app.basic_user_search')\n            ? queryUsers({ q, authority_id: authority()?.id }).pipe(\n                  map((_) => _.data.map((_) => new User(_)))\n              )\n            : searchStaff(q);\n    /** Currently selected user */\n    public active_user: User;\n    /** User list to display */\n    public user_list: User[];\n    /** Whether user list is loading */\n    public loading: boolean;\n    /** Current display value of the search input field  */\n    public search_str: string;\n    /** Subject holding the value of the search */\n    public search$ = new Subject<string>();\n    /** List of users from an API search */\n    public search_results$: Observable<User[]> = this.search$.pipe(\n        debounceTime(400),\n        distinctUntilChanged(),\n        switchMap((query) => {\n            this.loading = true;\n            return this.options && this.options.length > 0\n                ? of(this.options)\n                : query.length >= 3\n                ? !this.guests\n                    ? this.query_fn(query)\n                    : forkJoin([searchStaff(query), searchGuests(query)])\n                : of([]);\n        }),\n        catchError((_) => of([])),\n        map((list: User[]) => {\n            this.loading = false;\n            list = flatten(list);\n            const search = (this.search_str || '').toLowerCase();\n            return list.filter(\n                (item) => !this.filter || this.filter(item, search)\n            );\n        })\n    );\n\n    constructor(private _settings: SettingsService) {\n        super();\n    }\n\n    /** Form control on change handler */\n    private _onChange: (_: User) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: User) => void;\n\n    @ViewChild('input', { read: ElementRef })\n    private _input_el: ElementRef<HTMLInputElement>;\n\n    public cancelReset = () => this.clearTimeout('reset');\n\n    public blurInput = () => {\n        this.timeout('blur', () => this._input_el?.nativeElement?.blur());\n    };\n\n    public ngOnInit(): void {\n        // Process API results\n        this.subscription(\n            'search_results',\n            this.search_results$.subscribe((list) => (this.user_list = list))\n        );\n        this.resetSearchString();\n    }\n\n    /**\n     * Reset the search string back to the name of the active user\n     */\n    public resetSearchString() {\n        this.timeout(\n            'reset',\n            () => (this.search_str = this.active_user?.name || ''),\n            100\n        );\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User | string, email?: string): void {\n        if (\n            typeof new_value === 'string' &&\n            (new_value as any) === this.search_str\n        ) {\n            new_value = new User({\n                name: (this.search_str || email || '').split('@')[0],\n                email: this.search_str || email || '',\n            });\n        }\n        if (!(new_value instanceof User)) return;\n        this.active_user = new_value;\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n        this.resetSearchString();\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User) {\n        this.active_user = value;\n        this.resetSearchString();\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: User) => void): void {\n        this._onChange = fn;\n    }\n\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: User) => void): void {\n        this._onTouch = fn;\n    }\n}\n","import { Component, forwardRef, Input } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { FormControl } from '@angular/forms';\nimport { MatChipInputEvent } from '@angular/material/chips';\nimport { COMMA, ENTER, SPACE } from '@angular/cdk/keycodes';\n\n/**\n * Add a tag to the list of tags for the item\n * @param event Input event\n */\nexport function addChipItem<T = string>(\n    control: FormControl<T[]>,\n    event: MatChipInputEvent\n): void {\n    if (!control) return;\n    const input = event.input;\n    const value = event.value as any;\n    const item_list = control.value;\n    if ((value || '').trim()) {\n        item_list.push(value);\n        control.setValue(item_list);\n    }\n\n    // Reset the input value\n    if (input) {\n        input.value = '';\n    }\n}\n\n/**\n * Remove tag from the list\n * @param existing_tag Tag to remove\n */\nexport function removeChipItem<T = string>(\n    control: FormControl<T[]>,\n    item: T\n): void {\n    if (!control) {\n        return;\n    }\n    const item_list = control.value;\n    const index = item_list.indexOf(item);\n\n    if (index >= 0) {\n        item_list.splice(index, 1);\n        control.setValue(item_list);\n    }\n}\n\n@Component({\n    selector: 'item-list-field',\n    template: `\n        <mat-form-field appearance=\"outline\" class=\"w-full\">\n            <mat-chip-grid #chipList aria-label=\"Zone Tags\">\n                <mat-chip-row\n                    *ngFor=\"let item of value\"\n                    (removed)=\"remove(item)\"\n                >\n                    <span class=\"truncate max-w-md\">{{ item }}</span>\n                    <button matChipRemove [attr.aria-label]=\"'Remove ' + item\">\n                        <app-icon>cancel</app-icon>\n                    </button>\n                </mat-chip-row>\n            </mat-chip-grid>\n            <input\n                [placeholder]=\"placeholder || 'User groups...'\"\n                i18n-placeholder=\"@@userGroupsPlaceholder\"\n                [matChipInputFor]=\"chipList\"\n                [matChipInputSeparatorKeyCodes]=\"separators\"\n                [matChipInputAddOnBlur]=\"true\"\n                (matChipInputTokenEnd)=\"add($event)\"\n            />\n        </mat-form-field>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => ItemListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class ItemListFieldComponent<T = any> implements ControlValueAccessor {\n    @Input() public separators: number[] = [ENTER, COMMA, SPACE];\n\n    @Input() public placeholder = '';\n    /** List of items stored */\n    public value: T[] = [];\n\n    /** Form control on change handler */\n    private _onChange: (_: T[]) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: T[]) => void;\n\n    /**\n     * Add the `step` to the current value\n     */\n    public readonly add = (e: MatChipInputEvent) =>\n        addChipItem(\n            { value: this.value, setValue: (i) => this.setValue(i) } as any,\n            e\n        );\n\n    /** Remove the `step` from the current value */\n    public readonly remove = (item: T) =>\n        removeChipItem(\n            { value: this.value, setValue: (i) => this.setValue(i) } as any,\n            item\n        );\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: T[]): void {\n        this.value = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: T[]) {\n        this.value = value;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: T[]) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: T[]) => void): void {\n        this._onTouch = fn;\n    }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { randomInt } from '@placeos/common';\nimport { Attachment } from '@placeos/users';\nimport { takeWhile } from 'rxjs/operators';\n\nimport * as blobUtil from 'blob-util';\nimport { uploadFiles } from '@placeos/cloud-uploads';\n\n@Component({\n    selector: 'upload-list',\n    template: `\n        <div class=\"flex items-center space-x-2\">\n            <div\n                class=\"w-52 h-48 relative border-2 border-dashed border-gray-300 flex flex-col items-center justify-center rounded hover:bg-black/5 cursor-pointer\"\n            >\n                <app-icon class=\"text-3xl mb-2\">upload_file</app-icon>\n                <p class=\"text-center\" i18n>Drop files</p>\n                <p class=\"text-center text-xs my-1\" i18n>or</p>\n                <button btn matRipple class=\"w-28\" i18n>Browse</button>\n                <input\n                    multiple=\"true\"\n                    type=\"file\"\n                    class=\"absolute inset-0 opacity-0 max-w-full\"\n                    (change)=\"onFileEvent($event)\"\n                />\n            </div>\n            <div class=\"w-1/2 h-48 flex-1 flex flex-col items-center\">\n                <div\n                    list\n                    class=\"space-y-2 w-full h-full overflow-auto\"\n                    *ngIf=\"list?.length; else empty_state\"\n                >\n                    <div\n                        item\n                        *ngFor=\"let item of list\"\n                        class=\"w-full flex items-center border border-gray-200 rounded bg-white hover:bg-gray-100\"\n                        [class.!bg-red-600]=\"item.progress < 1\"\n                        [class.!bg-opacity-20]=\"item.progress < 1\"\n                    >\n                        <div\n                            class=\"flex-1 w-px font-mono truncate px-2 text-sm\"\n                        >\n                            {{ item.name }}\n                        </div>\n                        <ng-container\n                            *ngIf=\"item.progress >= 0 && item.progress < 100\"\n                        >\n                            <div class=\"relative mx-1\">\n                                <mat-progress-spinner\n                                    [diameter]=\"32\"\n                                    mode=\"determinate\"\n                                    [value]=\"item.progress\"\n                                ></mat-progress-spinner>\n\n                                <div\n                                    class=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-sm font-bold\"\n                                >\n                                    {{ item.progress }}\n                                </div>\n                            </div>\n                        </ng-container>\n                        <a\n                            [href]=\"item.url\"\n                            icon\n                            matRipple\n                            *ngIf=\"item.progress >= 100\"\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                        >\n                            <app-icon>link</app-icon>\n                        </a>\n                        <button icon (click)=\"removeFile(item)\">\n                            <app-icon>close</app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div\n                class=\"h-full w-full flex flex-col justify-center items-center\"\n            >\n                <p class=\"opacity-30\" i18n>No uploaded files</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UploadListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UploadListFieldComponent implements ControlValueAccessor {\n    public list: Attachment[] = [];\n    /** Form control on change handler */\n    private _onChange: (_: Attachment[]) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: Attachment[]) => void;\n\n    public readonly registerOnChange = (fn) => (this._onChange = fn);\n    public readonly registerOnTouched = (fn) => (this._onTouch = fn);\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: Attachment[]): void {\n        this.list = new_value.filter((_) => _.url && _.progress >= 100);\n        if (this._onChange) this._onChange(this.list);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: Attachment[]) {\n        this.list = value.map((_) => ({\n            id: `file-${randomInt(999_999_999)}`,\n            ..._,\n        }));\n    }\n\n    public removeFile(item: Attachment) {\n        this.list = this.list.filter((_) => _.id !== item.id);\n    }\n\n    public onFileEvent(event) {\n        const element: HTMLInputElement = event.target as any;\n        /* istanbul ignore else */\n        if (!element?.files?.length) return;\n        const files: FileList = element.files;\n        const on_change = (item) => {\n            this.list = [\n                ...(this.list || []).filter((_) => _.id !== item.id),\n            ].sort((a, b) => a.created_at - b.created_at);\n            this.setValue(this.list);\n        };\n        for (let i = 0; i < files.length; i++) {\n            this._uploadFile(files[i], on_change);\n        }\n    }\n\n    private _uploadFile(file: File, on_change: (item: Attachment) => void) {\n        const fileReader = new FileReader();\n        fileReader.addEventListener('loadend', (e: any) => {\n            const arrayBuffer = e.target.result;\n            const blob = blobUtil.arrayBufferToBlob(arrayBuffer, file.type);\n            const upload_list = uploadFiles([blob], { file_name: file.name });\n            const upload = upload_list[0];\n            const upload_details: Attachment = {\n                id: `${randomInt(9999_9999_9999)}`,\n                name: file.name,\n                progress: 0,\n                size: file.size,\n                created_at: Date.now(),\n                url: '',\n            };\n            upload.status\n                .pipe(takeWhile((_) => _.status !== 'complete', true))\n                .subscribe((state) => {\n                    if (upload.access_url)\n                        upload_details.url = upload.access_url;\n                    upload_details.progress = state.progress;\n                    if (state.status === 'error') upload_details.progress = -1;\n                    on_change(upload_details);\n                });\n            on_change(upload_details);\n        });\n        fileReader.readAsArrayBuffer(file);\n    }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { randomInt } from '@placeos/common';\nimport { Attachment } from '@placeos/users';\nimport { takeWhile } from 'rxjs/operators';\n\nimport * as blobUtil from 'blob-util';\nimport { uploadFiles } from '@placeos/cloud-uploads';\n\n@Component({\n    selector: 'upload-file',\n    template: `\n        <div\n            class=\"bg-gray-50 hover:bg-gray-100 cursor-pointer p-2 rounded border border-gray-200 w-full relative\"\n        >\n            <input\n                type=\"file\"\n                class=\"absolute inset-0 opacity-0 max-w-full z-10\"\n                (change)=\"onFileEvent($event)\"\n            />\n            <div\n                item\n                *ngIf=\"item; else empty_state\"\n                class=\"w-full flex items-center border border-gray-200 rounded bg-white hover:bg-gray-100 relative z-50\"\n                [class.!bg-red-600]=\"item.progress < 1\"\n                [class.!bg-opacity-20]=\"item.progress < 1\"\n            >\n                <div class=\"flex-1 w-px font-mono truncate px-2 text-sm\">\n                    {{ item.name }}\n                </div>\n                <ng-container *ngIf=\"item.progress >= 0 && item.progress < 100\">\n                    <div class=\"relative mx-1\">\n                        <mat-progress-spinner\n                            [diameter]=\"32\"\n                            mode=\"determinate\"\n                            [value]=\"item.progress\"\n                        ></mat-progress-spinner>\n\n                        <div\n                            class=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-sm font-bold\"\n                        >\n                            {{ item.progress }}\n                        </div>\n                    </div>\n                </ng-container>\n                <a\n                    [href]=\"item.url\"\n                    icon\n                    matRipple\n                    *ngIf=\"item.progress >= 100\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                >\n                    <app-icon>link</app-icon>\n                </a>\n                <button icon (click)=\"writeValue(null)\">\n                    <app-icon>close</app-icon>\n                </button>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div\n                class=\"h-full w-full flex flex-col justify-center items-center z-0\"\n            >\n                <p class=\"opacity-30\" i18n>Drop file or click to upload file</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UploadFileFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UploadFileFieldComponent implements ControlValueAccessor {\n    public item: Attachment;\n    /** Form control on change handler */\n    private _onChange: (_: Attachment) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: Attachment) => void;\n\n    public readonly registerOnChange = (fn) => (this._onChange = fn);\n    public readonly registerOnTouched = (fn) => (this._onTouch = fn);\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: Attachment): void {\n        this.item = new_value;\n        if (this._onChange) this._onChange(this.item);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: Attachment) {\n        this.item = value;\n    }\n\n    public onFileEvent(event) {\n        const element: HTMLInputElement = event.target as any;\n        /* istanbul ignore else */\n        if (!element?.files?.length) return;\n        const files: FileList = element.files;\n        const on_change = (item) => {\n            this.item = item;\n            this.setValue(this.item);\n        };\n        this._uploadFile(files[0], on_change);\n    }\n\n    private _uploadFile(file: File, on_change: (item: Attachment) => void) {\n        const fileReader = new FileReader();\n        fileReader.addEventListener('loadend', (e: any) => {\n            const arrayBuffer = e.target.result;\n            const blob = blobUtil.arrayBufferToBlob(arrayBuffer, file.type);\n            const upload_list = uploadFiles([blob], { file_name: file.name });\n            const upload = upload_list[0];\n            const upload_details: Attachment = {\n                id: `${randomInt(9999_9999_9999)}`,\n                name: file.name,\n                progress: 0,\n                size: file.size,\n                created_at: Date.now(),\n                url: '',\n            };\n            upload.status\n                .pipe(takeWhile((_) => _.status !== 'complete', true))\n                .subscribe((state) => {\n                    if (upload.access_url)\n                        upload_details.url = upload.access_url;\n                    upload_details.progress = state.progress;\n                    if (state.status === 'error') upload_details.progress = -1;\n                    on_change(upload_details);\n                });\n            on_change(upload_details);\n        });\n        fileReader.readAsArrayBuffer(file);\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from '@placeos/common';\nimport { Asset } from '../asset.class';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: 'asset-select-modal',\n    template: `\n        <div\n            class=\"w-[100vw] h-[100vh] sm:relative sm:w-auto sm:h-auto flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <header class=\"flex items-center space-x-4 w-full\">\n                <button icon mat-dialog-close class=\"bg-black/20\">\n                    <app-icon>close</app-icon>\n                </button>\n                <h3>Add Assets</h3>\n            </header>\n            <main\n                class=\"flex-1 flex items-center divide-x divide-gray-200 dark:divide-neutral-500 min-h-[65vh] h-[65vh] sm:max-h-[65vh] sm:max-w-[95vw] w-full overflow-hidden\"\n            >\n                <asset-filters class=\"h-full hidden sm:block\"></asset-filters>\n                <div\n                    class=\"flex flex-col items-center flex-1 w-1/2 h-full sm:min-w-[20rem] sm:h-[65vh]\"\n                >\n                    <asset-filters-display\n                        class=\"w-full border-b border-gray-200 dark:border-neutral-500 dark:bg-neutral-700\"\n                    ></asset-filters-display>\n                    <asset-list\n                        [selected]=\"selected_ids\"\n                        [favorites]=\"favorites\"\n                        (toggleFav)=\"toggleFavourite($event)\"\n                        (onSelect)=\"displayed = $event\"\n                        class=\"flex-1 h-1/2 w-full overflow-hidden\"\n                    ></asset-list>\n                </div>\n                <asset-details\n                    [item]=\"displayed!\"\n                    class=\"h-full w-full sm:h-[65vh] absolute sm:relative sm:flex sm:max-w-[20rem] bg-white  dark:bg-neutral-700 z-20\"\n                    [class.hidden]=\"!displayed\"\n                    [class.inset-0]=\"displayed\"\n                    [active]=\"selected_ids.includes(displayed?.id || '')\"\n                    (activeChange)=\"setSelected(displayed!, $event)\"\n                    [fav]=\"\n                        !!displayed &&\n                        this.favorites.includes(displayed?.id || '')\n                    \"\n                    (toggleFav)=\"toggleFavourite(displayed!)\"\n                    (close)=\"displayed = null\"\n                ></asset-details>\n            </main>\n            <footer\n                class=\"flex sm:hidden flex-col-reverse items-center justify-end p-2 border-t border-gray-200 dark:border-neutral-500w-full\"\n            >\n                <button\n                    btn\n                    matRipple\n                    back-btn\n                    class=\"inverse sm:hidden w-full sm:w-auto\"\n                    *ngIf=\"displayed\"\n                    (click)=\"displayed = null\"\n                >\n                    Back\n                </button>\n                <button\n                    btn\n                    matRipple\n                    save\n                    [mat-dialog-close]=\"selected\"\n                    [class.mb-2]=\"displayed\"\n                    class=\"w-full sm:w-auto sm:mb-0\"\n                >\n                    View List\n                </button>\n            </footer>\n            <footer\n                class=\"hidden sm:flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    btn\n                    matRipple\n                    [mat-dialog-close]=\"selected\"\n                    class=\"clear text-primary\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">arrow_back</app-icon>\n                        <div class=\"mr-1 underline\">Back to form</div>\n                    </div>\n                </button>\n                <p class=\"opacity-60 text-sm\">{{ count }} assets(s) added</p>\n                <button\n                    btn\n                    matRipple\n                    [disabled]=\"!displayed\"\n                    [class.inverse]=\"isSelected(displayed?.id)\"\n                    (click)=\"setSelected(displayed, !isSelected(displayed?.id))\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">{{\n                            isSelected(displayed?.id) ? 'remove' : 'add'\n                        }}</app-icon>\n                        <div class=\"mr-1\">\n                            {{\n                                isSelected(displayed?.id)\n                                    ? 'Remove from Booking'\n                                    : 'Add to booking'\n                            }}\n                        </div>\n                    </div>\n                </button>\n            </footer>\n        </div>\n    `,\n    styles: [``],\n})\nexport class AssetSelectModalComponent {\n    public displayed: Asset | null = null;\n    public selected: Asset[] = [...(this._items || [])];\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_assets') || EMPTY_FAVS;\n    }\n\n    public get selected_ids() {\n        return this.selected.map((_) => _.id).join(',');\n    }\n\n    public get count() {\n        return this.selected.reduce((t, i) => t + i.in_use, 0);\n    }\n\n    public isSelected(id: string) {\n        return id && this.selected_ids.includes(id);\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        @Inject(MAT_DIALOG_DATA) private _items: Asset[]\n    ) {}\n\n    public setSelected(asset: Asset, state: boolean) {\n        const list = this.selected.filter((_) => _.id !== asset.id);\n        if (state) list.push(asset);\n        this.selected = list;\n    }\n\n    public toggleFavourite(asset: Asset) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(asset.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_assets', [\n                ...fav_list,\n                asset.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_assets',\n                fav_list.filter((_) => _ !== asset.id)\n            );\n        }\n    }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\n\nimport { AssetSelectModalComponent } from 'libs/assets/src/lib/asset-select-modal/asset-select-modal.component';\nimport { Asset } from 'libs/assets/src/lib/asset.class';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: `asset-list-field`,\n    template: `\n        <div list class=\"space-y-2\">\n            <div\n                space\n                class=\"relative p-2 rounded-lg w-full flex items-center shadow border border-gray-200\"\n                *ngFor=\"let asset of items\"\n            >\n                <div class=\"w-16 h-16 rounded-xl bg-black/20 mr-4\"></div>\n                <div class=\"pb-4\">\n                    <div class=\"font-medium\">\n                        {{ asset.name || 'Asset' }}\n                    </div>\n                    <div i18n>{{ asset.amount }} requested</div>\n                    <div\n                        class=\"absolute bottom-0 right-0 flex items-center justify-end text-xs\"\n                    >\n                        <button\n                            btn\n                            matRipple\n                            edit-space\n                            class=\"clear\"\n                            (click)=\"addAssets(asset)\"\n                        >\n                            <div class=\"flex items-center space-x-2\" i18n>\n                                <app-icon>edit</app-icon>\n                                Change\n                            </div>\n                        </button>\n                        <button\n                            btn\n                            matRipple\n                            remove-space\n                            class=\"clear\"\n                            (click)=\"removeAsset(asset)\"\n                        >\n                            <div class=\"flex items-center space-x-2\" i18n>\n                                <app-icon>close</app-icon>\n                                Remove\n                            </div>\n                        </button>\n                    </div>\n                </div>\n                <button\n                    icon\n                    matRipple\n                    fav\n                    class=\"absolute top-1 right-1\"\n                    [class.text-blue-400]=\"favorites.includes(asset.id)\"\n                    (click)=\"toggleFavourite(asset)\"\n                >\n                    <app-icon>{{\n                        favorites.includes(asset.id)\n                            ? 'favorite'\n                            : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </div>\n        </div>\n        <button\n            btn\n            matRipple\n            add-space\n            class=\"w-full inverse mt-2\"\n            (click)=\"addAssets()\"\n        >\n            <div class=\"flex items-center justify-center space-x-2\">\n                <app-icon>search</app-icon>\n                <span>Add Asset</span>\n            </div>\n        </button>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => AssetListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class AssetListFieldComponent implements ControlValueAccessor {\n    public items: Asset[] = [];\n    public disabled = false;\n\n    private _onChange: (_: Asset[]) => void;\n    private _onTouch: (_: Asset[]) => void;\n    public selected: Asset[] = [];\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_assets') || EMPTY_FAVS;\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {}\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: Asset[]) {\n        this.items = new_value;\n        if (this._onChange) this._onChange(this.items);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: Asset[]) {\n        this.items = value || [];\n    }\n\n    public readonly registerOnChange = (fn: (_: Asset[]) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: Asset[]) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n\n    public removeAsset(asset: Asset) {\n        const updated_list = this.items.filter((_) => _.id !== asset.id);\n        this.setValue(updated_list);\n    }\n\n    public addAssets(asset?: Asset) {\n        const ref = this._dialog.open(AssetSelectModalComponent, {\n            data: this.items,\n        });\n        ref.afterClosed().subscribe((assets?: Asset[]) => {\n            if (!assets) return;\n            this.setValue(assets);\n        });\n    }\n\n    public toggleFavourite(asset: Asset) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(asset.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_assets', [\n                ...fav_list,\n                asset.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_assets',\n                fav_list.filter((_) => _ !== asset.id)\n            );\n        }\n    }\n}\n","import { capitalizeFirstLetter, removeEmptyFields } from '@placeos/common';\nimport { User } from 'libs/users/src/lib/user.class';\nimport {\n    add,\n    addHours,\n    addMinutes,\n    differenceInMinutes,\n    getUnixTime,\n    isAfter,\n    isBefore,\n    isSameDay,\n    roundToNearestMinutes,\n} from 'date-fns';\n\nexport type BookingType =\n    | 'desk'\n    | 'parking'\n    | 'locker'\n    | 'room'\n    | 'visitor'\n    | 'asset-request'\n    | 'staff'\n    | 'wfh-setting'\n    | ' ';\nconst IGNORE_EXT_KEYS = ['user', 'booked_by', 'resources', 'assets', 'members'];\n\nexport interface BookingComplete extends Booking {\n    members?: User[];\n}\n\n/** General purpose booking class */\nexport class Booking {\n    /** Unique Identifier of the object */\n    public readonly id: string;\n    /** Unix epoch for the start time of the booking in seconds */\n    public readonly booking_start: number;\n    /** Unix epoch for the start time of the booking in seconds */\n    public readonly booking_end: number;\n    /** ID of the user who owns the booking */\n    public readonly booked_by_id: string;\n    /** Email of the user who owns the booking */\n    public readonly booked_by_email: string;\n    /** Display name of the user who owns the booking */\n    public readonly booked_by_name: string;\n    /** ID of the user who owns the booking */\n    public readonly user_id: string;\n    /** Email of the user who owns the booking */\n    public readonly user_email: string;\n    /** Display name of the user who owns the booking */\n    public readonly user_name: string;\n    /** ID of an associated calendar event */\n    public readonly event_id?: string;\n    /** Identifier of the physical asset assocated with the booking */\n    public readonly asset_id: string;\n    /** Name of the physical asset assocated with the booking */\n    public readonly asset_name: string;\n    /** Zones associated with the asset ID */\n    public readonly zones: string[];\n    /** Type of booking */\n    public readonly booking_type: BookingType;\n    /** Start time of booking in ms */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** Whether it is an all day booking */\n    public readonly all_day: boolean;\n    /** Timezone of the booking */\n    public readonly timezone: string;\n    /** Title of the booking */\n    public readonly title: string;\n    /** Description */\n    public readonly description: string;\n    /** Whether user checked in */\n    public readonly checked_in: boolean;\n    /** Whether booking is rejected */\n    public readonly rejected: boolean;\n    /** Whether booking is approved */\n    public readonly approved: boolean;\n    /** Id of the approver */\n    public readonly approver_id: string;\n    /** Email of the approver */\n    public readonly approver_email: string;\n    /** Name of the approver */\n    public readonly approver_name: string;\n    /** Extra non-standard metadata associated with the booking */\n    public readonly extension_data: Record<string, any>;\n    /** Default type */\n    public readonly type: string;\n    /** Default type */\n    public readonly access: boolean;\n    /** Status of the booking */\n    public readonly status: 'declined' | 'approved' | 'tentative' | 'ended';\n    /** New deleted field */\n    public readonly deleted: boolean;\n    /** List of attendees for the booking */\n    public readonly attendees: User[];\n    /** Time  */\n    public readonly checked_out_at?: number;\n\n    constructor(data: Partial<BookingComplete> = {}) {\n        this.id = data.id || '';\n        this.asset_id = data.asset_id || '';\n        this.asset_name =\n            data.asset_name ||\n            data.extension_data?.asset_name ||\n            data.extension_data?.name ||\n            data.description ||\n            '';\n        this.zones = data.zones || [];\n        this.booking_start =\n            Math.floor(data.date / 1000) ||\n            data.booking_start ||\n            getUnixTime(\n                roundToNearestMinutes(addMinutes(Date.now(), 5), {\n                    nearestTo: 5,\n                })\n            );\n        this.booking_end =\n            Math.floor(data.date / 1000) + data.duration * 60 ||\n            data.booking_end ||\n            getUnixTime(\n                addMinutes(this.booking_start * 1000, data.duration || 60)\n            );\n        this.booking_type = data.booking_type || ' ';\n        this.type = data.type || data.booking_type || 'booking';\n        this.date = data.date || this.booking_start * 1000 || Date.now();\n        this.duration =\n            data.duration ||\n            Math.abs(\n                differenceInMinutes(\n                    this.booking_start * 1000,\n                    this.booking_end * 1000\n                )\n            ) ||\n            60;\n        this.timezone =\n            data.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone;\n        this.user_email = data.user_email || '';\n        this.user_id = data.user_id || '';\n        this.user_name = data.user_name || '';\n        this.title =\n            data.title ??\n            (this.booking_type\n                ? `${capitalizeFirstLetter(this.booking_type)} Booking`.trim()\n                : '');\n        this.description = data.description || '';\n        this.checked_in = !!data.checked_in;\n        this.rejected = !!data.rejected;\n        this.approved = !!data.approved;\n        this.deleted = !!data.deleted;\n        this.booked_by_id = data.booked_by_id || '';\n        this.booked_by_name = data.booked_by_name || '';\n        this.booked_by_email = data.booked_by_email || '';\n        this.approver_id = data.approver_id || '';\n        this.approver_email = data.approver_email || '';\n        this.approver_name = data.approver_name || '';\n        this.extension_data = data.extension_data || {};\n        this.access = !!data.extension_data?.access;\n        this.event_id = data.event_id;\n        this.attendees = data.attendees || data.members || [];\n        this.all_day = data.all_day ?? this.duration >= 12 * 60;\n        this.checked_out_at = data.checked_out_at;\n        this.status =\n            this.checked_out_at > 0\n                ? 'ended'\n                : this.rejected\n                ? 'declined'\n                : this.approved\n                ? 'approved'\n                : 'tentative';\n        for (const key in data) {\n            if (!(key in this) && !IGNORE_EXT_KEYS.includes(key) && data[key]) {\n                this.extension_data[key] =\n                    data[key] || this.extension_data[key];\n            }\n        }\n    }\n\n    public toJSON(this: Booking): Partial<Booking> {\n        const data = { ...this };\n        if (!this.id) delete data.id;\n        delete data.date;\n        delete data.duration;\n        removeEmptyFields(data);\n        return data;\n    }\n\n    public get location(): string {\n        return this.description;\n    }\n\n    /** Whether the booking occurs today */\n    public get is_today(): boolean {\n        return isSameDay(this.date, new Date());\n    }\n\n    /** Whether booking is done */\n    public get is_done(): boolean {\n        const start = new Date();\n        const end = this.all_day\n            ? addHours(this.date, 24)\n            : addMinutes(this.date, this.duration);\n        const checked_out =\n            (this.checked_out_at || this.extension_data.checked_out_at || 0) *\n            1000;\n        let end_time = end.getTime();\n        if (checked_out && Date.now() > checked_out) return true;\n        return isAfter(start, new Date(end_time));\n    }\n\n    /** Status of the booking */\n    public get state():\n        | 'future'\n        | 'upcoming'\n        | 'done'\n        | 'started'\n        | 'in_progress' {\n        const now = new Date();\n        const date = this.date;\n        if (isBefore(now, add(date, { minutes: -15 }))) return 'future';\n        if (isBefore(now, date)) return 'upcoming';\n        if (isBefore(now, add(date, { minutes: 15 }))) return 'started';\n        if (isBefore(now, add(date, { minutes: this.duration })))\n            return 'in_progress';\n        return 'done';\n    }\n}\n","import { del, get, patch, post, put } from '@placeos/ts-client';\nimport { Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { Booking, BookingType } from './booking.class';\nimport { GuestUser } from 'libs/users/src/lib/user.class';\nimport { addMinutes, getUnixTime } from 'date-fns';\n\nexport interface BookingsQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zones?: string;\n    /** User ID to filter bookings */\n    user?: string;\n    /** Email address to filter bookings */\n    email?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n    /** Category of booking */\n    type: BookingType;\n    /** Include checked out bookings in the response */\n    include_checked_out?: boolean;\n    /** Include deleted bookings in the response */\n    deleted?: boolean;\n}\n\nconst BOOKINGS_ENDPOINT = `/api/staff/v1/bookings`;\n\n/**\n * List bookings\n * @param q Parameters to pass to the API request\n */\nexport function queryBookings(q: BookingsQueryParams): Observable<Booking[]> {\n    const query = toQueryString(q);\n    return get(`${BOOKINGS_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new Booking(item))),\n        catchError((_) => of([]))\n    );\n}\n\n/**\n * Get booking details\n * @param id ID of the booking to grab\n * @param q Parameters to pass to the API request\n */\nexport function showBooking(id: string) {\n    return get(`${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new Booking(item))\n    );\n}\n\n/**\n * Create new booking and add it to the database\n * @param data New booking fields\n */\nexport function createBooking(data: Partial<Booking>) {\n    return post(`${BOOKINGS_ENDPOINT}`, data).pipe(\n        map((item) => new Booking(item))\n    );\n}\n\n/**\n * Update an existing booking\n * @param id ID of the booking to update\n * @param data New values for booking fields\n * @param method HTTP verb to use with API request\n */\nexport function updateBooking(\n    id: string,\n    data: Partial<Booking>,\n    method: 'put' | 'patch' = 'patch'\n) {\n    return (method === 'patch' ? patch : put)(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`,\n        data\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Save changes to or create a booking\n * @param data State of the booking\n * @param q Parameters to pass to the API request\n */\nexport const saveBooking = (data: Partial<Booking>) =>\n    data.id ? updateBooking(data.id, data) : createBooking(data);\n\n/**\n * Remove booking from the database\n * @param id ID of the booking to remove\n * @param q Parameters to pass to the API request\n */\nexport function removeBooking(id: string) {\n    return del(`${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`, {\n        response_type: 'void',\n    });\n}\n\n/**\n * Set the approval state of the booking to approved\n * @param id ID of the booking to approve\n * @param system_id Associated system to approve\n */\nexport function approveBooking(id: string) {\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/approve`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the approval state of the booking to rejected\n * @param id ID of the booking to reject\n * @param system_id Associated system to reject\n */\nexport function rejectBooking(id: string) {\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/reject`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the checkin state of a booking\n * @param id ID of the booking to grab\n * @param state New checkin state of the booking\n */\nexport function checkinBooking(id: string, state: boolean) {\n    const query = toQueryString({ state });\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/check_in?${query}`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the checkin state of a booking\n * @param id ID of the booking to grab\n * @param state New checkin state of the booking\n */\nexport function checkinBookingAttendee(\n    id: string,\n    email: string,\n    state: boolean\n) {\n    const query = toQueryString({ state });\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/guests/${encodeURIComponent(email)}/check_in?${query}`,\n        ''\n    ).pipe(map((item) => new GuestUser(item)));\n}\n\n/**\n * Filter list of resources based of the bookings found in the given query\n * @param asset_id_list List of resource IDs\n * @param query Booking query\n */\nexport function queryResourceAvailability(\n    id_list: string[],\n    start: number,\n    duration: number,\n    ignore?: string,\n    type: BookingType = 'room'\n): Observable<boolean[]> {\n    return queryBookings({\n        type,\n        period_start: getUnixTime(start),\n        period_end: getUnixTime(addMinutes(start, duration)),\n    }).pipe(\n        map((_) =>\n            id_list.map(\n                (id) =>\n                    !_.find(\n                        (b) => b.asset_id === id && (!ignore || ignore !== b.id)\n                    )\n            )\n        )\n    );\n}\n\nexport function isResourceAvailable(\n    id: string,\n    start: number,\n    duration: number,\n    ignore?: string,\n    type: BookingType = 'room'\n) {\n    return queryBookings({\n        type,\n        period_start: getUnixTime(start),\n        period_end: getUnixTime(addMinutes(start, duration)),\n    }).pipe(\n        map(\n            (_) =>\n                _.filter((_) => _.asset_id === id && _.id !== ignore).length ===\n                0\n        )\n    );\n}\n","import { del, get, patch, post, put } from '@placeos/ts-client';\nimport { Observable, of } from 'rxjs';\nimport { catchError, map } from 'rxjs/operators';\n\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { GuestUser } from 'libs/users/src/lib/user.class';\n\nimport { CalendarEvent } from './event.class';\nimport { addMinutes, getUnixTime } from 'date-fns';\n\nexport interface CalendarEventQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zone_ids?: string;\n    /** Comma seperated list of system(space) ids to check availability */\n    system_ids?: string;\n    /** Comma seperated list of calendar ids to check availability */\n    calendars?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n    /** Whether to include cancelled events in the returned list */\n    include_cancelled?: boolean;\n    /** ical UID associated with the booking */\n    ical_uid?: string;\n}\n\nexport interface CalendarEventShowParams {\n    /** ID of the personal calendar to grab the events details from */\n    calendar?: string;\n    /** ID of the system/space to get the associated calendar ID */\n    system_id?: string;\n}\n\nconst EVENTS_ENDPOINT = `/api/staff/v1/events`;\n\n/**\n * List events\n * @param q Parameters to pass to the API request\n */\nexport function queryEvents(\n    q: CalendarEventQueryParams\n): Observable<CalendarEvent[]> {\n    const query = toQueryString(q);\n    return get(`${EVENTS_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((e) => new CalendarEvent(e))),\n        catchError((_) => of([]))\n    );\n}\n\n/**\n * Get event details\n * @param id ID of the event to grab\n * @param q Parameters to pass to the API request\n */\nexport function showEvent(id: string, q: CalendarEventShowParams = {}) {\n    const query = toQueryString(q);\n    return get(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Create new calendar event and add it to the database\n * @param data New calendar event fields\n */\nexport function createEvent(data: Partial<CalendarEvent>) {\n    return post(`${EVENTS_ENDPOINT}`, new CalendarEvent(data).toJSON()).pipe(\n        map((item) => new CalendarEvent(item))\n    );\n}\n\n/**\n * Update an existing calendar event\n * @param id ID of the event to update\n * @param data New values for event fields\n * @param q Parameters to pass to the API request\n * @param method HTTP verb to use with API request\n */\nexport function updateEvent(\n    id: string,\n    data: Partial<CalendarEvent>,\n    q: CalendarEventShowParams = {},\n    method: 'put' | 'patch' = 'patch'\n) {\n    const query = toQueryString(q);\n    return (method === 'patch' ? patch : put)(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`,\n        method === 'patch' ? data : new CalendarEvent(data).toJSON()\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Save changes to or create a calendar event\n * @param data State of the calendar event\n * @param q Parameters to pass to the API request\n */\nexport const saveEvent = (\n    data: Partial<CalendarEvent>,\n    q?: CalendarEventShowParams\n) => {\n    delete (data as any)?.status;\n    return data.id ? updateEvent(data.id, data, q) : createEvent(data);\n};\n\n/**\n * Remove calendar event from the database\n * @param id ID of the event to remove\n * @param q Parameters to pass to the API request\n */\nexport function removeEvent(id: string, q: CalendarEventShowParams = {}) {\n    const query = toQueryString(q);\n    return del(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`,\n        {\n            response_type: 'void',\n        }\n    );\n}\n\n/**\n * Set the approval state of the event to approved\n * @param id ID of the event to approve\n * @param system_id Associated system to approve\n */\nexport function approveEvent(id: string, system_id: string) {\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/approve?system_id=${encodeURIComponent(system_id)}`,\n        ''\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Set the approval state of the event to rejected\n * @param id ID of the event to reject\n * @param system_id Associated system to reject\n */\nexport function rejectEvent(id: string, system_id: string) {\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/reject?system_id=${encodeURIComponent(system_id)}`,\n        ''\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * List guests for event\n * @param id ID of the event to grab\n * @param q Parameters to pass to the API request\n */\nexport function queryEventGuests(\n    id: string,\n    q: CalendarEventShowParams = {}\n): Observable<GuestUser[]> {\n    const query = toQueryString(q);\n    return get(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}/guests${\n            query ? '?' + query : ''\n        }`\n    ).pipe(map((list) => list.map((item) => new GuestUser(item))));\n}\n\n/**\n * Set the checkin state of an event guest\n * @param id ID of the event to grab\n * @param guest_id ID of the guest to update\n * @param state New checkin state of the guest\n * @param q Parameters to pass to the API request\n */\nexport function checkinEventGuest(\n    id: string,\n    guest_id: string,\n    state: boolean,\n    q: CalendarEventShowParams = {}\n) {\n    const query = toQueryString({ ...q, state });\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/guests/${guest_id}/checkin${query ? '?' + query : ''}`,\n        ''\n    ).pipe(map((item) => new GuestUser(item)));\n}\n\n/**\n * Check whether a selected space is available\n * @param id ID of the space to check\n * @param start Start of the availability period to check\n * @param duration Duration of the availability block in minutes\n * @param ignore ID of a booking to ignore when checking availability\n */\nexport function isSpaceAvailable(\n    id: string,\n    start: number,\n    duration: number,\n    ignore?: string\n) {\n    return queryEvents({\n        system_ids: id,\n        period_start: getUnixTime(start),\n        period_end: getUnixTime(addMinutes(start, duration)),\n    }).pipe(map((_) => _.filter((_) => _.id !== ignore).length === 0));\n}\n\n/**\n * Check whether a list of spaces are available\n * @param id_list List of space IDs to check\n * @param start Start of the availability period to check\n * @param duration Duration of the availability block in minutes\n * @param ignore ID of a booking to ignore when checking availability\n */\nexport function querySpaceAvailability(\n    id_list: string[],\n    start: number,\n    duration: number,\n    ignore?: string\n) {\n    return queryEvents({\n        system_ids: id_list.join(),\n        period_start: getUnixTime(start),\n        period_end: getUnixTime(addMinutes(start, duration)),\n    }).pipe(\n        map((_) =>\n            id_list.map(\n                (id) =>\n                    _.filter(\n                        (b) =>\n                            b.resources?.find((s) => s.id === id) &&\n                            b.id !== ignore\n                    ).length === 0\n            )\n        )\n    );\n}\n","import { AbstractControl } from '@angular/forms';\nimport { addMinutes, isAfter, isBefore } from 'date-fns';\n\nexport const endInFuture = (control: AbstractControl) => {\n    const date = control.parent?.get('date');\n    if (date && isAfter(Date.now(), addMinutes(date.value, control.value))) {\n        return { duration: true };\n    }\n    return null;\n};\n\n/** Check that date in unix ms is in the future */\nexport function isFuture(\n    control: AbstractControl\n): { [key: string]: boolean } | null {\n    return control.value && isBefore(control.value, new Date())\n        ? { is_future: true }\n        : null;\n}\n","import {\n    FormGroup,\n    FormControl,\n    Validators,\n    AbstractControl,\n} from '@angular/forms';\nimport {\n    add,\n    formatDuration,\n    differenceInMinutes,\n    getTime,\n    isSameDay,\n    format,\n    startOfMinute,\n    setHours,\n    setMinutes,\n    addMinutes,\n} from 'date-fns';\nimport { currentUser, timePeriodsIntersect, unique } from '@placeos/common';\n\nimport { CalendarEvent } from './event.class';\nimport { endInFuture } from './validators';\nimport { getNextFreeTimeSlot } from './helpers';\nimport { User } from 'libs/users/src/lib/user.class';\nimport { Booking } from 'libs/bookings/src/lib/booking.class';\n\nlet BOOKING_DATE = add(setMinutes(setHours(new Date(), 6), 0), { days: -1 });\n\nconst validateCateringField =\n    (catering_control: AbstractControl) => (control: AbstractControl) => {\n        if (catering_control.value?.length && !control.value) {\n            return { catering_field: 'Catering sub-fields are required' };\n        }\n        return null;\n    };\n\nexport function generateEventForm(event: CalendarEvent = new CalendarEvent()) {\n    if (!event) event = new CalendarEvent();\n    const form = new FormGroup({\n        id: new FormControl(event.id),\n        host: new FormControl(\n            event.host || event.organiser?.email || currentUser()?.email || '',\n            [Validators.required]\n        ),\n        organiser: new FormControl(\n            event.organiser || new User({ email: event.host || '' })\n        ),\n        creator: new FormControl(event.creator || currentUser()?.email),\n        calendar: new FormControl(event.calendar),\n        attendees: new FormControl(event.attendees || []),\n        resources: new FormControl(event.resources || []),\n        title: new FormControl(event.title),\n        body: new FormControl(event.body),\n        private: new FormControl(event.private),\n        date: new FormControl(event.date, [Validators.required]),\n        duration: new FormControl(event.duration, [endInFuture]),\n        all_day: new FormControl(event.all_day),\n        recurring: new FormControl(event.recurring),\n        recurrence: new FormControl(event.recurrence),\n        recurring_master_id: new FormControl(event.recurring_master_id),\n        master: new FormControl(event.master),\n        attachments: new FormControl(event.attachments),\n        catering: new FormControl(\n            (event.extension_data?.catering[0]?.items || []) as any\n        ),\n        catering_notes: new FormControl(\n            event.extension_data?.catering[0]?.notes || ''\n        ),\n        catering_charge_code: new FormControl(\n            event.extension_data?.catering[0]?.charge_code || ''\n        ),\n        assets: new FormControl(event.extension_data?.assets || []),\n        // has_catering: new FormControl(event.has_catering || false),\n        visitor_type: new FormControl(event.extension_data?.visitor_type),\n        location: new FormControl(event.location),\n        needs_space: new FormControl(true),\n        needs_parking: new FormControl(\n            event.extension_data?.needs_parking || false\n        ),\n        system: new FormControl<any>(event.system),\n    });\n    form.get('organiser').valueChanges.subscribe((o) =>\n        form.controls.host.setValue(o?.email)\n    );\n    form.get('resources').valueChanges.subscribe((l) =>\n        form.controls.system.setValue(l?.length ? (l[0] as any) : null)\n    );\n    form.get('date').valueChanges.subscribe(() =>\n        form.get('duration').updateValueAndValidity()\n    );\n    form.controls.all_day.valueChanges.subscribe((all_day) => {\n        if (all_day) form.controls.duration.disable();\n        else form.controls.duration.enable();\n    });\n    form.get('catering_charge_code').setValidators([\n        validateCateringField(form.get('catering')),\n    ]);\n    if (event.id) {\n        form.get('host').disable();\n        form.get('organiser').disable();\n    }\n    if (event.state === 'started') form.get('date').disable();\n    return form;\n}\n\n/**\n * Set the initial time used for generating mock bookings\n * @param time New initial time as ms from UTC epoch\n */\nexport function setMockBookingStartDatetime(time: number) {\n    BOOKING_DATE = startOfMinute(new Date(time));\n}\n\n/**\n * Get current status within bookings\n * @param bookings List of bookings\n * @param host Host of the new event\n * @param date Datetime of the new event\n */\nexport function statusFromBookings(\n    bookings: CalendarEvent[],\n    bookable: boolean,\n    requestable: boolean,\n    date: number = getTime(new Date())\n) {\n    const now = new Date(date);\n    const next_free_slot = getNextFreeTimeSlot(bookings, date, 5);\n    const start = new Date(next_free_slot.start);\n    const end = new Date(next_free_slot.end);\n    const currently_free = timePeriodsIntersect(\n        date,\n        date,\n        next_free_slot.start,\n        next_free_slot.end\n    );\n    const time_until_next_block = formatDuration({\n        minutes: currently_free\n            ? differenceInMinutes(end, now)\n            : differenceInMinutes(start, now),\n    });\n    const free_tomorrow = !currently_free && !isSameDay(start, now);\n    const free_today = currently_free && !isSameDay(end, now);\n    return {\n        status: !bookable\n            ? 'Not Bookable'\n            : currently_free\n            ? requestable\n                ? 'Available by Request'\n                : 'Available'\n            : 'Meeting in Progress',\n        available_until: free_today\n            ? 'No meetings today'\n            : currently_free\n            ? `Free until ${format(end, 'h:mm B')}(${time_until_next_block})`\n            : free_tomorrow\n            ? 'Unavailable today'\n            : `Free at ${format(start, 'h:mm B')}(${time_until_next_block})`,\n    };\n}\n\nexport function replaceBookings(\n    list: CalendarEvent[],\n    new_bookings: CalendarEvent[],\n    filter_options: { space: string; from: number; to: number }\n) {\n    const from = filter_options.from;\n    const to = filter_options.to;\n    const filtered_list = list.filter((booking) => {\n        const start = new Date(booking.date);\n        const end = addMinutes(start, booking.duration);\n        return (\n            !booking.resources.find(\n                (space) => space.email === filter_options.space\n            ) || !timePeriodsIntersect(from, to, start.valueOf(), end.valueOf())\n        );\n    });\n    const updated_list = filtered_list.concat(new_bookings);\n    updated_list.sort((a, b) => a.date - b.date);\n    return unique(updated_list, 'id');\n}\n\nexport function newCalendarEventFromBooking(booking: Booking) {\n    let attendees = [\n        {\n            id: booking.user_id,\n            name: booking.user_name,\n            email: booking.user_email,\n            organizer: true,\n        },\n    ];\n    if (booking.booking_type === 'visitor') {\n        attendees.push(\n            new User({\n                name: booking.asset_name || booking.description,\n                email: booking.asset_id,\n            })\n        );\n    }\n    attendees = attendees.concat(booking.attendees);\n    return new CalendarEvent({\n        ...booking,\n        ...booking.extension_data,\n        attendees,\n        id: booking.id || booking.extension_data.id,\n        host: booking.user_email,\n        from_booking: true,\n    } as any);\n}\n","import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { OrganisationService } from '@placeos/organisation';\nimport { Observable } from 'rxjs';\nimport { PaymentCardDetails } from './card-input-field.component';\n\nexport interface PaymentData {\n    type: string; // Resource Type\n    resource_name: string;\n    date: number;\n    duration: number;\n    all_day: boolean;\n    has_payment_method: boolean;\n    rate: string;\n    amount: number; // Number in cents\n    loading: Observable<string>;\n    makePayment: (_?: PaymentCardDetails) => Promise<void>;\n}\n\n@Component({\n    selector: 'payment-modal',\n    template: `\n        <div\n            class=\"relative max-h-[100vh] overflow-auto\"\n            *ngIf=\"!(loading | async); else load_state\"\n        >\n            <ng-container *ngIf=\"!success; else success_state\">\n                <main\n                    class=\"px-4 pt-8 w-[24rem] space-y-2 flex flex-col items-center relative\"\n                >\n                    <h2 class=\"text-2xl font-medium\" i18n>Booking Payment</h2>\n                    <img src=\"assets/icons/cost.svg\" class=\"w-1/2\" />\n                    <p class=\"text-sm text-center pb-2\" i18n>\n                        You are requesting a {{ details.type }} booking in\n                        {{ details.resource_name }} for\n                        {{ details.date | date: 'mediumDate' }}\n                        <ng-container *ngIf=\"!details.all_day\">\n                            between {{ details.date | date: 'shortTime' }} and\n                            {{\n                                details.date + details.duration * 60 * 1000\n                                    | date: 'shortTime'\n                            }}\n                        </ng-container>\n                    </p>\n                    <p class=\"text-sm\" i18n>You booking will cost:</p>\n                    <p class=\"text-lg font-medium text-center\">\n                        <strong>{{\n                            details.amount / 100 | currency: code\n                        }}</strong>\n                    </p>\n                    <card-input-field\n                        class=\"w-full\"\n                        [(ngModel)]=\"card_details\"\n                    ></card-input-field>\n                </main>\n                <footer class=\"p-4\">\n                    <button\n                        matRipple\n                        class=\"w-full\"\n                        (click)=\"processPayment()\"\n                        i18n\n                    >\n                        Make Payment\n                    </button>\n                </footer>\n                <button\n                    icon\n                    matRipple\n                    mat-dialog-close\n                    class=\"absolute top-1 left-1\"\n                >\n                    <i class=\"material-icons text-2xl\">close</i>\n                </button>\n            </ng-container>\n        </div>\n        <ng-template #load_state>\n            <div\n                class=\"w-full h-full flex flex-col items-center justify-center p-8\"\n            >\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>{{ loading | async }}</p>\n            </div>\n        </ng-template>\n        <ng-template #success_state>\n            <main class=\"px-8 pt-8 w-[24rem] flex flex-col relative\">\n                <h2 class=\"text-2xl font-medium\" i18n>Payment Successful</h2>\n                <h3 class=\"text-xl font-medium mb-2\">\n                    Ref #{{ transaction_id }}\n                </h3>\n                <p i18n>{{ details.amount / 100 | currency: code }} paid.</p>\n                <p i18n>{{ details.resource_name }} booked.</p>\n                <p>{{ details.date | date: 'mediumDate' }}</p>\n                <p i18n>\n                    {{ details.date | date: 'shortTime' }} and\n                    {{\n                        details.date + details.duration * 60 * 1000\n                            | date: 'shortTime'\n                    }}\n                </p>\n            </main>\n            <img src=\"assets/icons/payment-confirmed.svg\" class=\"w-full\" />\n            <footer class=\"p-4 border-t border-gray-200\">\n                <button btn matRipple mat-dialog-close class=\"w-full\" i18n>\n                    Great, thanks.\n                </button>\n            </footer>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class PaymentModalComponent {\n    @Output() public readonly event = new EventEmitter();\n    public readonly details = this._data;\n    public readonly loading = this._data.loading;\n    public card_details?: PaymentCardDetails;\n    public success = false;\n    public transaction_id = '12345678';\n\n    public get code() {\n        return this._org.currency_code;\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: PaymentData,\n        private _org: OrganisationService\n    ) {}\n\n    public async processPayment() {\n        if (!this.card_details || !this._validCardDetails()) return;\n        this.event.emit(this.card_details);\n        await this._data.makePayment(this.card_details);\n        this.success = true;\n    }\n\n    private _validCardDetails() {\n        return (\n            (this.card_details?.cardholder.length || 0) > 0 &&\n            (this.card_details?.cvv.length || 0) >= 3\n        );\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { currentUser, SettingsService } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { getModule } from '@placeos/ts-client';\nimport { BehaviorSubject, of } from 'rxjs';\nimport { shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { PaymentCardDetails } from './card-input-field.component';\nimport { PaymentModalComponent } from './payment-modal.component';\n\nexport interface PaymentDetails {\n    type: string; // Resource Type\n    resource_name: string;\n    date: number;\n    duration: number;\n    all_day: boolean;\n}\n\nexport interface PaymentResult {\n    success: boolean;\n    state: 'processing' | 'pending' | 'approved';\n    invoice_id: string;\n    amount: number;\n    created_at: number;\n    updated_at: number;\n}\n\nexport const STRIPE_ID_TOKEN = 'STRIPE+customer_id';\nconst STRIPE_MODULE = 'Payment';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class PaymentsService {\n    private _loading = new BehaviorSubject('');\n    private _active_card = new BehaviorSubject('');\n\n    public readonly loading = this._loading.asObservable();\n\n    public readonly payment_sources = of(1).pipe(\n        switchMap(() => {\n            const mod = getModule(this.payment_module, STRIPE_MODULE);\n            if (!mod) return of([]);\n            return mod.execute('list_payment_methods', ['card']);\n        }),\n        tap((_) => (_[0] ? this._active_card.next(_[0].id) : '')),\n        shareReplay(1)\n    );\n\n    public get payment_module() {\n        return this._org.binding('payments');\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {}\n\n    public async makePayment(\n        details: PaymentDetails\n    ): Promise<PaymentResult | undefined> {\n        if (!this.payment_module) throw 'Payments not enabled';\n        const [cost, period] = await this._getCostOfProduct(\n            details?.type\n        ).catch((_) => [0, 60]);\n        console.log('Cost:', cost, period);\n        if (cost <= 0) return;\n        let customer_id = this._settings.get('STRIPE_Customer_ID');\n        if (!customer_id) customer_id = await this._newCustomerID();\n        this._settings.saveUserSetting('STRIPE_Customer_ID', customer_id);\n        const amount = cost * (details.duration / period);\n        let result = undefined;\n        const makePayment = async (c: any) => {\n            result = await this._processPayment(amount, customer_id, c).catch(\n                (e) => {\n                    this._loading.next('');\n                    throw e;\n                }\n            );\n        };\n        const data = {\n            ...details,\n            rate: `$${(cost / 100).toFixed(2)} per hour`,\n            amount,\n            makePayment,\n            loading: this.loading,\n        };\n        const ref = this._dialog.open(PaymentModalComponent, { data });\n        await ref.afterClosed().toPromise();\n        return result;\n    }\n\n    private async _addPaymentMethod(card: PaymentCardDetails): Promise<string> {\n        const mod = getModule(this.payment_module, STRIPE_MODULE);\n        if (!mod) throw 'Unable to load module';\n        const payment_method = await mod.execute('add_payment_method', [\n            'card',\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            null,\n            card,\n        ]);\n        return payment_method.id || payment_method;\n    }\n\n    private async _getCostOfProduct(type: string) {\n        let price: [number, number] = [0, 60];\n        const mod = getModule(this.payment_module, STRIPE_MODULE);\n        if (!mod) return price;\n        const product_list = await mod.execute('get_product_prices', [\n            null,\n            null,\n            type,\n        ]);\n        if (!product_list.length) return price;\n        return product_list;\n    }\n\n    private async _processPayment(\n        amount: number,\n        customer_id: string,\n        card_details?: PaymentCardDetails\n    ) {\n        this._loading.next('Checking payment method...');\n        console.log('Getting payment method...');\n        const source = card_details\n            ? await this._addPaymentMethod(card_details)\n            : this._active_card.getValue();\n        if (!source) throw 'No payment source selected';\n        this._loading.next('Processing payment...');\n        console.log('Processing payment...');\n        const mod = getModule(this.payment_module, STRIPE_MODULE);\n        if (!mod) throw 'Unable to load module';\n        const id = await mod.execute<string>('create_payment_intent', [\n            amount,\n            this._org.building.currency || 'USD',\n            null,\n            null,\n            customer_id,\n            null,\n            null,\n            null,\n            currentUser()?.email,\n        ]);\n        if (!id) throw 'Failed to create payment';\n        console.log('Confirming payment...');\n        await mod.execute('confirm_payment_intent', [id, source]);\n        this._loading.next('');\n        return {\n            success: true,\n            state: 'approved',\n            invoice_id: id,\n            amount: amount,\n            created_at: Date.now(),\n            updated_at: Date.now(),\n        };\n    }\n\n    private async _newCustomerID() {\n        const mod = getModule(this.payment_module, STRIPE_MODULE);\n        if (!mod) throw 'Unable to load module';\n        const user = currentUser();\n        const id = await mod.execute<string>('create_customer', [\n            0,\n            null,\n            null,\n            null,\n            `${user.id}|${user.name}|FromPlaceOS`,\n            user.email,\n        ]);\n        return id;\n    }\n}\n","import { User } from 'libs/users/src/lib/user.class';\nimport { addMinutes, format } from 'date-fns';\nimport { toQueryString } from './api';\nimport { localToTimezone } from './timezone-helpers';\nimport { unique } from './general';\nimport { PlaceSystem } from '@placeos/ts-client';\n\nexport interface CalEvent {\n    title: string;\n    date: number;\n    duration: number;\n    all_day: boolean;\n    body: string;\n    location: string;\n    host: string;\n    organiser: User;\n    user_name?: string;\n    user_email?: string;\n    attendees: string[];\n    resources?: string[];\n    meeting_url?: string;\n    system?: PlaceSystem;\n}\n\nfunction formatUTC(date: Date | number) {\n    const utc_date = localToTimezone(date, 'UTC');\n    return `${format(utc_date, 'yyyyMMdd')}T${format(utc_date, 'HHmmss')}Z`;\n}\n\nfunction formatAllDay(date: Date | number) {\n    return `${format(date, 'yyyyMMdd')}`;\n}\n\nexport function generateCalendarFileLink(event: CalEvent): string {\n    const chunks: [string, any][] = [];\n    const description = formatCalFileText(`${event.body}`);\n    const location = formatCalFileText(`${event.location}`);\n    chunks.push(['BEGIN', 'VCALENDAR']);\n    chunks.push(['VERSION', '2.0']);\n    chunks.push(['BEGIN', 'VEVENT']);\n    chunks.push(['URL', `${event.meeting_url}`]);\n    chunks.push(['DTSTART', `${new Date(event.date).toISOString()}`]);\n    chunks.push([\n        'DTEND',\n        `${addMinutes(event.date, event.duration ?? 60).toISOString()}`,\n    ]);\n    chunks.push(['SUMMARY', `${event.title}`]);\n    chunks.push(['DESCRIPTION', description]);\n    chunks.push(['LOCATION', location]);\n    const host =\n        event.organiser?.name ||\n        event.host?.split('@') ||\n        event.user_name ||\n        'User';\n    chunks.push([\n        'ORGANIZER',\n        `CN=${host}:MAILTO:${event.host || event.user_email}`,\n    ]);\n    const url_data = chunks\n        .map(([key, value]) => `${key}:${encodeURIComponent(value)}`)\n        .join('\\n');\n    return `data:text/calendar;charset=utf8,${url_data}`;\n}\n\nexport function generateGoogleCalendarLink(event: CalEvent): string {\n    const fmt = event.all_day ? formatAllDay : formatUTC;\n    const details: any = {\n        action: 'TEMPLATE',\n        text: event.title,\n        details: event.body,\n        location: event.location,\n        trp: false,\n        dates: `${fmt(event.date)}/${fmt(\n            addMinutes(event.date, event.duration ?? 60)\n        )}`,\n    };\n    const emails = (event.attendees || []).map((_: any) => _.email || _);\n    const resources = (\n        (event.resources?.length ? event.resources : null) || [event.system]\n    ).map((_: any) => _?.email || _);\n    if (emails.length || resources.length)\n        details.add = unique([...emails, ...resources]).join();\n    return `https://calendar.google.com/calendar/render?${toQueryString(\n        details\n    )}`;\n}\n\nexport function generateMicrosoftCalendarLink(\n    event: CalEvent,\n    type: 'outlook' | 'office' = 'outlook'\n): string {\n    if (!event.date) event.date = Date.now();\n    const data: any = {\n        path: '/calendar/action/compose',\n        rru: 'addevent',\n        startdt: new Date(event.date).toISOString(),\n        enddt: addMinutes(event.date, event.duration ?? 60).toISOString(),\n        subject: event.title,\n        body: event.body,\n        location: event.location,\n        allday: event.all_day ?? false,\n    };\n    const emails = (event.attendees || []).map((_: any) => _.email || _);\n    const resources = (\n        (event.resources?.length ? event.resources : null) || [event.system]\n    ).map((_: any) => _?.email || _);\n    if (emails.length || resources.length)\n        data.to = unique([...emails, ...resources]).join();\n    return type === 'office'\n        ? `https://outlook.office.com/calendar/0/deeplink/compose?${toQueryString(\n              data\n          )}`\n        : `https://outlook.live.com/calendar/0/deeplink/compose?${toQueryString(\n              data\n          )}`;\n}\n\nfunction formatCalFileText(str: string) {\n    return str\n        .replace(/,/gm, ',')\n        .replace(/;/gm, ';')\n        .replace(/\\r\\n/gm, '\\n')\n        .replace(/\\n/gm, '\\\\n')\n        .replace(/(\\\\n)[\\s\\t]+/gm, '\\\\n');\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport {\n    generateCalendarFileLink,\n    generateGoogleCalendarLink,\n    generateMicrosoftCalendarLink,\n} from 'libs/common/src/lib/calendar-links';\nimport { CalendarEvent } from './event.class';\nimport { notifyError } from '@placeos/common';\n\n@Component({\n    selector: 'event-link-modal',\n    template: `\n        <div class=\"p-4 w-full pb-2\" i18n>Add event to your calendar</div>\n        <div class=\"flex flex-col items-center space-y-4 p-4 relative\">\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"outlook_link | sanitize: 'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n                (click)=\"has_actioned = true\"\n            >\n                <img src=\"assets/icons/outlook.svg\" class=\"w-6\" />\n                <span i18n>Create in Outlook</span>\n            </a>\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"google_link | sanitize: 'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n                (click)=\"has_actioned = true\"\n            >\n                <img src=\"assets/icons/gcal.svg\" class=\"w-6\" />\n                <span i18n>Create in Google Calendar</span>\n            </a>\n            <a\n                button\n                matRipple\n                class=\"flex items-center p-2 space-x-2 pr-4 w-64 rounded inverse\"\n                [href]=\"ical_link | safe: 'url'\"\n                target=\"_blank\"\n                rel=\"noopener noreferer\"\n                (click)=\"has_actioned = true\"\n            >\n                <app-icon class=\"text-xl\">download</app-icon>\n                <span i18n>Download iCal File</span>\n            </a>\n            <button class=\"w-64\" btn matRipple (click)=\"close()\" i18n>\n                Close\n            </button>\n        </div>\n        <button\n            icon\n            matRipple\n            [mat-dialog-close]=\"has_actioned\"\n            class=\"absolute top-2 right-0\"\n        >\n            <app-icon>close</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n        `,\n    ],\n})\nexport class EventLinkModalComponent {\n    public readonly outlook_link = generateMicrosoftCalendarLink(\n        this._event as any\n    );\n    public readonly google_link = generateGoogleCalendarLink(\n        this._event as any\n    );\n    public readonly ical_link = generateCalendarFileLink(this._event as any);\n\n    public has_actioned = false;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _event: CalendarEvent,\n        private _dialog: MatDialogRef<EventLinkModalComponent>\n    ) {}\n\n    public close() {\n        if (!this.has_actioned) {\n            return notifyError(\n                'You need to select a calendar option to finish creating this booking'\n            );\n        }\n        this._dialog.close(true);\n    }\n}\n","import { Optional, Pipe } from '@angular/core';\nimport { querySystems, showSystem } from '@placeos/ts-client';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { Space } from './space.class';\n\nconst SPACE_LIST: Space[] = [];\n\nconst EMPTY_SPACE = new Space();\n\nexport function updateSpaceList(space_list: Space[]) {\n    for (const space of space_list) {\n        if (!SPACE_LIST.find(({ id }) => id === space.id)) {\n            SPACE_LIST.push(space);\n        }\n    }\n}\n\n@Pipe({\n    name: 'space',\n})\nexport class SpacePipe {\n    constructor(@Optional() private _org?: OrganisationService) {}\n    /**\n     * Get details of the space with the given ID\n     * @param space_id ID or Email of the space\n     */\n    public async transform(space_id: string): Promise<Space> {\n        const is_email = space_id?.includes('@');\n        if (!space_id) return EMPTY_SPACE;\n        let space = SPACE_LIST.find(\n            ({ id, email }) => id === space_id || email === space_id\n        );\n        if (space) return space;\n        if (!is_email) {\n            const system = await showSystem(space_id)\n                .toPromise()\n                .catch((_) => null);\n            if (system) {\n                space = new Space({\n                    ...(system as any),\n                    level: this._org?.levelWithID([...system.zones]),\n                });\n                SPACE_LIST.push(space);\n                return space;\n            }\n        }\n        const systems = (await querySystems({ q: space_id }).toPromise()).data;\n        if (systems.length === 1) {\n            space = new Space({\n                ...(systems[0] as any),\n                level: this._org?.levelWithID([...systems[0].zones]),\n            });\n            SPACE_LIST.push(space);\n            return space;\n        }\n        return EMPTY_SPACE;\n    }\n\n    public updateSpaceList(space_list: Space[]) {\n        updateSpaceList(space_list);\n    }\n}\n","import { HashMap, predictableRandomInt } from '@placeos/common';\nimport { querySystems } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map, shareReplay, tap } from 'rxjs/operators';\nimport { USER_DOMAIN } from '../../../users/src/lib/user.utilities';\nimport { Space } from './space.class';\nimport { updateSpaceList } from './space.pipe';\n\nconst SPACE_LIST_REQUESTS: Record<string, Observable<Space[]>> = {};\n\nexport function requestSpacesForZone(id: string) {\n    if (SPACE_LIST_REQUESTS[id]) return SPACE_LIST_REQUESTS[id];\n    SPACE_LIST_REQUESTS[id] = querySystems({ zone_id: id, limit: 500 }).pipe(\n        map((_) => (_.data || []).map((_) => new Space(_ as any))),\n        tap((_) => updateSpaceList(_)),\n        shareReplay(1)\n    );\n    return SPACE_LIST_REQUESTS[id];\n}\n\nlet SPACE_COUNT: number = 0;\n/* istanbul ignore next */\nexport function generateMockSpace(overrides: HashMap = {}): HashMap {\n    const id = `space-${SPACE_COUNT++}`;\n    const name = `Test Space ${SPACE_COUNT}`;\n    const linked = predictableRandomInt(99999) % 2 === 0 && SPACE_COUNT > 1;\n    const space = {\n        id,\n        name,\n        long_name: `${name} with an long name`,\n        map_id: `${SPACE_COUNT}`,\n        capacity: predictableRandomInt(21, 1) * 2,\n        email: `${name.toLowerCase().split(' ').join('.')}@${USER_DOMAIN}`,\n        type: '',\n        searchable: predictableRandomInt(99999) % 2 === 0,\n        controlable: predictableRandomInt(99999) % 2 === 0,\n        bookable: predictableRandomInt(99999) % 2 === 0,\n        cost_hour: predictableRandomInt(300) * 100,\n        setup: predictableRandomInt(6) * 5,\n        breakdown: predictableRandomInt(6) * 5,\n        zones: ['zone_lvl-0'],\n        support_url: `/control/#/panel/${id}`,\n        bookings: [], //Array(10).fill(0).map(i => generateMockBooking()),\n        linked_rooms: linked\n            ? [`space-${predictableRandomInt(SPACE_COUNT - 1)}`]\n            : [],\n        image: '',\n        ...overrides,\n    };\n    if (space['configurations'] && space['configurations'].length > 0) {\n        space['configurations'].forEach(\n            (config) =>\n                (config.capacity = predictableRandomInt(space.capacity) + 1)\n        );\n        space['configurations'][0].capacity = space.capacity;\n    }\n    return space;\n}\n","export interface AssetResource {\n    id?: string;\n    name: string;\n    url: string;\n    price?: number;\n}\n\nexport interface AssetDetail {\n    id: string;\n    name: string;\n}\n\nexport interface AssetPurchase {\n    id?: string;\n    name: string;\n    value: string;\n}\n\nexport class Asset {\n    public readonly id: string;\n    public readonly name: string;\n    public readonly category: string;\n    public readonly images: AssetResource[];\n    public readonly barcode: string;\n    public readonly brand: string;\n    public readonly size: 'Small' | 'Medium' | 'Large';\n    public readonly description: string;\n    public readonly specifications: Record<string, string>;\n    public readonly purchase_date: number;\n    public readonly purchase_price: number;\n    public readonly purchase_details: AssetPurchase[];\n    public readonly consumables: AssetDetail[];\n    public readonly general_details: AssetDetail[];\n    public readonly invoices: AssetResource[];\n    public readonly quantity: number;\n    public readonly locations: [string, string][];\n    public in_use = 1;\n    public other_data: Record<string, any> = {};\n\n    constructor(_data: Partial<Asset> = {}) {\n        this.id = _data.id || '';\n        this.name = _data.name || '';\n        this.category = _data.category || '';\n        this.images = _data.images || [];\n        this.barcode = _data.barcode || '';\n        this.brand = _data.brand || '';\n        this.size = _data.size || 'Small';\n        this.description = _data.description || '';\n        this.specifications = _data.specifications || {};\n        this.purchase_date = _data.purchase_date * 1000 || Date.now();\n        this.purchase_price = _data.purchase_price || 0;\n        this.purchase_details = _data.purchase_details || [];\n        this.consumables = _data.consumables || [];\n        this.general_details = _data.general_details || [];\n        this.invoices = _data.invoices || [];\n        this.quantity = _data.quantity ?? 0;\n        this.locations = _data.locations || [];\n        this.in_use = _data.in_use ?? 1;\n        for (const key in _data.other_data) {\n            if (key in this) {\n                this[key] = _data.other_data[key];\n            }\n        }\n    }\n}\n","import { cleanObject, del, get, post, put } from '@placeos/ts-client';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { catchError, map } from 'rxjs/operators';\nimport { Asset } from './asset.class';\nimport { Observable, of } from 'rxjs';\nimport { endOfDay, getUnixTime, startOfDay } from 'date-fns';\nimport {\n    createBooking,\n    queryBookings,\n    removeBooking,\n} from 'libs/bookings/src/lib/bookings.fn';\nimport { Booking } from 'libs/bookings/src/lib/booking.class';\n\nconst ASSET_ENDPOINT = '/api/engine/v2/assets';\n\n/**\n * Query the list of available assets\n * @param q Filter the list based of the give string\n */\nexport function queryAssets(q?: string): Observable<Asset[]> {\n    const query = toQueryString({ q });\n    return get(`${ASSET_ENDPOINT}${query ? query : ''}`).pipe(\n        map((_: any) => _.map((d: any) => new Asset(d))),\n        catchError((_) => of([]))\n    );\n}\n\n/**\n * Delete asset with the given ID\n * @param id ID of asset to delete\n */\nexport function deleteAsset(id: string) {\n    return del(`${ASSET_ENDPOINT}/${id}`);\n}\n\n/**\n * Add asset to database with given details\n * @param asset Asset details\n */\nexport function createAsset(asset: Asset): Observable<Asset> {\n    const data = cleanObject(asset, [undefined, null, '']);\n    data.purchase_date = getUnixTime(data.purchase_date);\n    return post(`${ASSET_ENDPOINT}`, data).pipe(map((_) => new Asset(_)));\n}\n\n/**\n * Update asset in database to the new details\n * @param id ID of the asset to update\n * @param asset New details for asset\n */\nexport function updateAsset(id: string, asset: Asset) {\n    return put(`${ASSET_ENDPOINT}/${id}`, asset).pipe(map((_) => new Asset(_)));\n}\n\n/**\n * Save the details for the given asset in the database\n * @param asset Asset details\n */\nexport function saveAsset(asset: Asset) {\n    return asset.id ? updateAsset(asset.id, asset) : createAsset(asset);\n}\n\nexport async function updateAssetRequestsForResource(\n    parent_id: string,\n    { date, duration, host }: { date: number; duration: number; host: string },\n    new_assets: Asset[],\n    old_assets: Asset[]\n) {\n    const bookings = await queryBookings({\n        period_start: getUnixTime(startOfDay(date)),\n        period_end: getUnixTime(endOfDay(date)),\n        type: 'asset-request',\n        email: host,\n    }).toPromise();\n    const filtered = bookings.filter(\n        (item) =>\n            item.extension_data.parent_id === parent_id &&\n            old_assets.find((_) => _.id === item.asset_id)\n    );\n    await Promise.all(\n        filtered.map((item) => removeBooking(item.id).toPromise())\n    );\n    await Promise.all(\n        new_assets.map((item) =>\n            createBooking(\n                new Booking({\n                    date,\n                    duration,\n                    user_email: host,\n                    asset_id: item.id,\n                    asset_name: item.name,\n                    extension_data: { parent_id },\n                })\n            ).toPromise()\n        )\n    );\n}\n","import { Injectable } from '@angular/core';\nimport { Event, NavigationEnd, Router } from '@angular/router';\nimport { getModule } from '@placeos/ts-client';\nimport {\n    BehaviorSubject,\n    combineLatest,\n    forkJoin,\n    merge,\n    Observable,\n    of,\n    timer,\n} from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    distinctUntilChanged,\n    distinctUntilKeyChanged,\n    filter,\n    map,\n    shareReplay,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\nimport {\n    differenceInDays,\n    endOfDay,\n    getUnixTime,\n    isBefore,\n    startOfDay,\n} from 'date-fns';\nimport {\n    AsyncHandler,\n    currentUser,\n    flatten,\n    getInvalidFields,\n    SettingsService,\n    unique,\n} from '@placeos/common';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport {\n    queryResourceAvailability,\n    saveBooking,\n} from 'libs/bookings/src/lib/bookings.fn';\nimport { CalendarEvent } from './event.class';\nimport { querySpaceAvailability, saveEvent } from './events.fn';\nimport { generateEventForm, newCalendarEventFromBooking } from './utilities';\nimport { newBookingFromCalendarEvent } from 'libs/bookings/src/lib/booking.utilities';\nimport { PaymentsService } from 'libs/payments/src/lib/payments.service';\nimport { CateringOrder } from 'libs/catering/src/lib/catering-order.class';\nimport { MatDialog } from '@angular/material/dialog';\nimport { EventLinkModalComponent } from './event-link-modal.component';\nimport { requestSpacesForZone } from 'libs/spaces/src/lib/space.utilities';\nimport { periodInFreeTimeSlot } from './helpers';\nimport { SpacePipe } from 'libs/spaces/src/lib/space.pipe';\nimport { Validators } from '@angular/forms';\nimport { updateAssetRequestsForResource } from 'libs/assets/src/lib/assets.fn';\n\nconst BOOKING_URLS = [\n    'book/spaces',\n    'book/meeting',\n    'schedule/view',\n    'confirm/success',\n    'upcoming',\n];\n\nconst MINUTES = 60 * 1000;\n\nexport type EventFlowView =\n    | 'form'\n    | 'find'\n    | 'catering'\n    | 'confirm'\n    | 'success';\n\nexport interface EventFlowOptions {\n    /** Calendar to associate event with */\n    calendar_id?: string;\n    /** List of features to filter spaces on */\n    features: string[];\n    /** List of zones to filter spaces on */\n    zone_ids?: string[];\n    /** Minimum number of attendees to filter space on */\n    capacity?: number;\n    /** Whether to only show favourite rooms */\n    show_fav?: boolean;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class EventFormService extends AsyncHandler {\n    private _view = new BehaviorSubject<EventFlowView>('form');\n    private _options = new BehaviorSubject<EventFlowOptions>({\n        zone_ids: [],\n        features: [],\n    });\n    private _form = generateEventForm();\n    private _date = new BehaviorSubject(Date.now());\n    private _event = new BehaviorSubject<CalendarEvent>(null);\n    private _loading = new BehaviorSubject<string>('');\n    private _space_pipe: SpacePipe;\n\n    public last_success: CalendarEvent = new CalendarEvent(\n        JSON.parse(sessionStorage.getItem('PLACEOS.last_booked_event') || '{}')\n    );\n    public readonly loading = this._loading.asObservable();\n    public readonly options = this._options.asObservable();\n\n    public readonly spaces: Observable<Space[]> = combineLatest([\n        this._options.pipe(distinctUntilKeyChanged('zone_ids')),\n        this._org.active_building.pipe(\n            filter((_) => !!_),\n            distinctUntilKeyChanged('id')\n        ),\n    ]).pipe(\n        debounceTime(300),\n        tap((_) => this.unsubWith('bind:')),\n        switchMap(([{ zone_ids }]) => {\n            this._loading.next('Loading space list for location...');\n            if (!zone_ids?.length) zone_ids = [this._org.building?.id];\n            return forkJoin(zone_ids.map((id) => requestSpacesForZone(id)));\n        }),\n        map((l) => flatten(l)),\n        tap((_) => this._loading.next('')),\n        shareReplay(1)\n    );\n\n    public readonly features = this.spaces.pipe(\n        map((l) => unique(flatten(l.map((_) => _.features))))\n    );\n\n    public readonly filtered_spaces = combineLatest([\n        this.spaces,\n        this.options,\n    ]).pipe(\n        map(([spaces, { show_fav, features, capacity }]) =>\n            spaces\n                .filter((s: Space) => {\n                    const domain = (currentUser()?.email || '@').split('@')[1];\n                    const zone = (this._settings.get(\n                        'app.events.restrict_spaces'\n                    ) || {})[domain];\n                    const limit_map =\n                        this._settings.get('app.events.limit_spaces') || {};\n                    const limited_zones = Object.keys(limit_map);\n                    const zone_limit = s.zones.find((_) =>\n                        limited_zones.includes(_)\n                    );\n                    return (\n                        s.bookable &&\n                        (!zone || s.zones.includes(zone)) &&\n                        (!zone_limit || limit_map[zone_limit] === domain) &&\n                        (!show_fav || this.favorite_spaces.includes(s.id)) &&\n                        features.every((f) => s.features.includes(f)) &&\n                        s.capacity >= Math.max(0, capacity || 0)\n                    );\n                })\n                .slice(0, Math.min(100, spaces.length))\n        ),\n        shareReplay(1)\n    );\n\n    private _space_bookings = combineLatest([\n        this.spaces,\n        this.filtered_spaces,\n    ]).pipe(\n        distinctUntilChanged(([s1], [s2]) => s1 !== s2),\n        switchMap(([_, list]) => {\n            return combineLatest(\n                (list || []).map((_) => {\n                    const binding = getModule(_.id, 'Bookings').binding(\n                        'bookings'\n                    );\n                    const obs = binding\n                        .listen()\n                        .pipe(\n                            map((_) =>\n                                (_ || []).map((i) => new CalendarEvent(i))\n                            )\n                        );\n                    if (!this.hasSubscription(`bind:${_.id}`)) {\n                        this.subscription(`bind:${_.id}`, binding.bind());\n                    }\n                    return obs;\n                })\n            );\n        }),\n        shareReplay(1)\n    );\n\n    public readonly current_available_spaces = combineLatest([\n        this.filtered_spaces,\n        this._space_bookings,\n        merge(this.form.valueChanges, timer(1000)),\n    ]).pipe(\n        map(([list, bookings]) => {\n            this._loading.next('Updating available spaces...');\n            let { date, duration, all_day } = this._form.getRawValue();\n            if (all_day) {\n                date = startOfDay(date).valueOf();\n                duration = 24 * 60 - 1;\n            }\n            return (list || [])\n                .filter((_, idx) =>\n                    periodInFreeTimeSlot(\n                        date,\n                        date + duration * MINUTES,\n                        bookings[idx] || []\n                    )\n                )\n                .sort((a, b) => a.capacity - b.capacity);\n        }),\n        tap((_) => this._loading.next('')),\n        shareReplay(1)\n    );\n\n    public readonly future_available_spaces: Observable<Space[]> =\n        combineLatest([this.filtered_spaces]).pipe(\n            filter(() => !this._loading.getValue()),\n            debounceTime(300),\n            switchMap(([spaces]) => {\n                if (!spaces.length) return of([]);\n                this._loading.next('Retrieving available spaces...');\n                let { date, duration, all_day } = this._form.getRawValue();\n                const availability_method = this.has_calendar\n                    ? querySpaceAvailability\n                    : queryResourceAvailability;\n                if (all_day) {\n                    date = startOfDay(date).valueOf();\n                    duration = 24 * 60 - 1;\n                }\n                return availability_method(\n                    spaces.map(({ id }) => id),\n                    date,\n                    duration,\n                    this.event?.id || undefined\n                ).pipe(\n                    map((availability) =>\n                        spaces.filter((_, i) => availability[i])\n                    ),\n                    catchError((_) => [])\n                );\n            }),\n            tap((_) => this._loading.next('')),\n            shareReplay(1)\n        );\n\n    public readonly available_spaces = this._date.pipe(\n        switchMap((d) => {\n            const diff = Math.abs(differenceInDays(d, Date.now()));\n            return diff < 14\n                ? this.current_available_spaces\n                : this.future_available_spaces;\n        })\n    );\n\n    public get view() {\n        return this._view.getValue();\n    }\n    public get form() {\n        return this._form;\n    }\n    public get event() {\n        return this._event.getValue();\n    }\n\n    public get favorite_spaces() {\n        return this._settings.get<string[]>('favourite_spaces') || [];\n    }\n\n    public get has_calendar() {\n        return this._settings.get('app.events.use_bookings') !== true;\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _router: Router,\n        private _payments: PaymentsService,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this._space_pipe = new SpacePipe(this._org);\n        this.subscription(\n            'router.events',\n            this._router.events.subscribe((event: Event) => {\n                if (\n                    event instanceof NavigationEnd &&\n                    !BOOKING_URLS.some((_) => event.url.includes(_))\n                ) {\n                    this.clearForm();\n                }\n            })\n        );\n        this.subscription(\n            'form_change',\n            this._form.valueChanges.subscribe(({ date, catering }) => {\n                if (date && date !== this._date.getValue())\n                    this._date.next(date);\n                this.storeForm();\n            })\n        );\n        let count = 0;\n        this.interval(\n            'catering',\n            () => {\n                const catering = this._form.value.catering;\n                if (count === catering?.length) return;\n                count = catering?.length;\n                if (\n                    catering?.length &&\n                    (this._settings.get('app.events.catering_notes_required') ||\n                        this._settings.value('require_catering_notes'))\n                ) {\n                    this._form\n                        .get('catering_notes')\n                        ?.setValidators([Validators.required]);\n                    this._form\n                        .get('catering_notes')\n                        .patchValue(this._form.value.catering_notes);\n                } else {\n                    this._form.get('catering_notes')?.clearValidators();\n                    this._form.get('catering_notes').setErrors(null);\n                }\n                this._form.updateValueAndValidity();\n            },\n            500\n        );\n    }\n\n    public listenForStatusChanges() {\n        this.subscription('status:rooms', this.available_spaces.subscribe());\n    }\n\n    public setView(value: EventFlowView) {\n        this._view.next(value);\n    }\n\n    public setOptions(value: Partial<EventFlowOptions>) {\n        this._options.next({ ...this._options.getValue(), ...value });\n    }\n\n    public newForm(event: CalendarEvent = new CalendarEvent()) {\n        this._event.next(event);\n        this._date.next(event.date);\n        this.resetForm();\n    }\n\n    public resetForm() {\n        this._form.reset();\n        const event = this._event.getValue() || ({} as Partial<CalendarEvent>);\n        this._form.patchValue({\n            ...event,\n            ...event.extension_data,\n            date:\n                !event.id && isBefore(event.date || 0, Date.now())\n                    ? Date.now()\n                    : event.date,\n            host: event?.host || currentUser().email,\n        });\n        this._options.next({ features: [] });\n        this.storeForm();\n    }\n\n    public clearForm() {\n        sessionStorage.removeItem('PLACEOS.event_form');\n        this.unsubWith('status:');\n        this.unsubWith('bind:');\n        this.newForm();\n    }\n\n    public storeForm() {\n        sessionStorage.setItem(\n            'PLACEOS.event_form',\n            JSON.stringify(this._form.getRawValue() || {})\n        );\n    }\n\n    public loadForm() {\n        if (!this._form) this.newForm();\n        this._form.patchValue({\n            ...JSON.parse(sessionStorage.getItem('PLACEOS.event_form') || '{}'),\n        });\n    }\n\n    public readonly cancelPostForm = () => this.unsub('post-event-form');\n\n    public openEventLinkModal(force: boolean = false) {\n        const form = this._form;\n        form.markAllAsTouched();\n        if (!form.valid && !force) return;\n        const event = new CalendarEvent({ ...form.getRawValue() });\n        const ref = this._dialog.open(EventLinkModalComponent, { data: event });\n        ref.afterClosed().subscribe((d) =>\n            d ? this._router.navigate(['/']) : ''\n        );\n    }\n\n    public postForm(force: boolean = false) {\n        return new Promise<CalendarEvent>(async (resolve, reject) => {\n            this._loading.next('Creating event...');\n            const form = this._form;\n            form.markAllAsTouched();\n            const event = this.event || new CalendarEvent();\n            if (!form.valid && !force) {\n                this._loading.next('');\n                return reject(\n                    `Some form fields are invalid. [${getInvalidFields(\n                        form\n                    ).join(', ')}]`\n                );\n            }\n            let { id, host, date, duration, creator, all_day, assets } =\n                form.getRawValue();\n            const spaces = form.get('resources')?.value || [];\n            let catering = form.get('catering')?.value || [];\n            if (all_day) {\n                date = startOfDay(date).valueOf();\n                duration = 24 * 60 - 1;\n            }\n            if (\n                (!id || date !== event.date || duration !== event.duration) &&\n                spaces.length\n            ) {\n                const start = getUnixTime(event.date);\n                await this.checkSelectedSpacesAreAvailable(\n                    spaces,\n                    date,\n                    duration,\n                    id\n                        ? { start, end: start + event.duration * 60 }\n                        : undefined,\n                    id || ''\n                ).catch((_) => {\n                    this._loading.next('');\n                    reject(_);\n                    throw _;\n                });\n            }\n            if (assets?.length || event.extension_data.assets?.length) {\n                await updateAssetRequestsForResource(\n                    `${host}|${date}`,\n                    { date, duration, host },\n                    assets,\n                    event.extension_data.assets\n                );\n            }\n            const is_owner =\n                host === currentUser()?.email ||\n                creator === currentUser()?.email;\n            const space_id = spaces[0]?.id;\n            const query = id\n                ? is_owner\n                    ? { calendar: host || creator }\n                    : {\n                          system_id:\n                              this._event.getValue()?.system?.id || space_id,\n                      }\n                : {};\n            const value = this._form.getRawValue();\n            console.log(\n                'Payments:',\n                this._payments.payment_module,\n                spaces.length\n            );\n            if (this._payments.payment_module && spaces.length) {\n                console.log('Make Payment...');\n                const receipt = await this._payments.makePayment({\n                    type: 'space',\n                    resource_name: spaces[0].display_name || spaces[0].name,\n                    date,\n                    duration,\n                    all_day,\n                });\n                if (!receipt?.success) return this._loading.next('');\n                (value as any).extension_data = {\n                    invoice: receipt,\n                    invoice_id: receipt.invoice_id,\n                };\n                console.log('Payment success.', receipt);\n            }\n            const d = value.all_day\n                ? startOfDay(value.date).valueOf()\n                : value.date;\n            if (catering.length && !('items' in catering[0])) {\n                const items = catering.map((_) => ({\n                    ..._,\n                    options: _.options.map((o) => ({ ...o, active: false })),\n                }));\n                catering = [\n                    new CateringOrder({\n                        items,\n                        notes: value.catering_notes,\n                        charge_code: value.catering_charge_code,\n                    }),\n                ];\n            } else {\n                catering.notes = value.catering_notes;\n                catering.charge_code = value.catering_charge_code;\n            }\n            const attendees = unique(\n                [...value.attendees, value.organiser || currentUser()],\n                'email'\n            );\n            const result = await this._makeBooking(\n                new CalendarEvent({\n                    ...value,\n                    old_system: this._event.getValue()?.system,\n                    host:\n                        this._settings.get('app.events.force_host') ||\n                        (this._settings.get('app.events.room_as_host')\n                            ? value.resources[0].email\n                            : '') ||\n                        value.host,\n                    title: value.title || 'Space Booking',\n                    attendees,\n                    date: d,\n                    catering,\n                    extension_data:\n                        this._settings.get('app.events.force_host') ||\n                        this._settings.get('app.events.room_as_host')\n                            ? { host_override: value.host }\n                            : {},\n                }),\n                query\n            ).catch((e) => {\n                reject(e);\n                this._loading.next('');\n                throw e;\n            });\n            this.clearForm();\n            this.last_success = result;\n            sessionStorage.setItem(\n                'PLACEOS.last_booked_event',\n                JSON.stringify(result)\n            );\n            this.setView('success');\n            resolve(result);\n            this._loading.next('');\n        });\n    }\n\n    private async _makeBooking(\n        event: CalendarEvent,\n        query: Record<string, any>\n    ) {\n        return (\n            !this.has_calendar\n                ? saveBooking(\n                      newBookingFromCalendarEvent({\n                          ...event.toJSON(),\n                          status: this._settings.get('app.bookings.no_approval')\n                              ? 'approved'\n                              : 'tentative',\n                      } as any)\n                  ).pipe(map((_) => newCalendarEventFromBooking(_)))\n                : saveEvent(event.toJSON(), query)\n        ).toPromise();\n    }\n\n    private async checkSelectedSpacesAreAvailable(\n        spaces: Space[],\n        date: number,\n        duration: number,\n        exclude?: { start: number; end: number },\n        ignore?: string\n    ) {\n        const space_ids = (\n            await Promise.all(\n                spaces.map((_) => this._space_pipe.transform(_.id || _.email))\n            )\n        ).map((_) => _.id);\n        const query: any = {\n            period_start: getUnixTime(date),\n            period_end: getUnixTime(date + duration * 60 * 1000),\n        };\n        if (exclude) query.exclude_range = `${exclude.start}...${exclude.end}`;\n        const availability_method = this.has_calendar\n            ? querySpaceAvailability\n            : queryResourceAvailability;\n        let availability: boolean[] = await availability_method(\n            spaces.map((_) => _.id),\n            date,\n            duration,\n            ignore\n        ).toPromise();\n        if (!availability.every((_) => _))\n            throw `${\n                availability.filter((_) => _).length\n            } space(s) are not available at the selected time`;\n        return true;\n    }\n}\n","import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { currentUser } from '@placeos/common';\nimport { CalendarEvent } from 'libs/events/src/lib/event.class';\nimport { endInFuture } from 'libs/events/src/lib/validators';\nimport {\n    createViewer,\n    getViewer,\n    Point,\n    removeViewer,\n} from '@placeos/svg-viewer';\nimport { Booking } from './booking.class';\n\nexport function generateBookingForm(booking: Booking = new Booking()) {\n    const form = new FormGroup({\n        id: new FormControl(booking.id || ''),\n        date: new FormControl(booking.date, [Validators.required]),\n        all_day: new FormControl(booking.all_day ?? false),\n        name: new FormControl(\n            booking.extension_data.name || booking.asset_name || ''\n        ),\n        duration: new FormControl(booking.duration, [endInFuture]),\n        booking_type: new FormControl(booking.booking_type),\n        zones: new FormControl(booking.zones),\n        title: new FormControl(booking.title),\n        description: new FormControl(booking.description),\n        booking_asset: new FormControl(null),\n        resources: new FormControl([]),\n        company: new FormControl(''),\n        asset_id: new FormControl(booking.asset_id, [Validators.required]),\n        asset_name: new FormControl(booking.description),\n        assets: new FormControl(booking.extension_data?.assets || []),\n        attendees: new FormControl(booking.attendees || []),\n        map_id: new FormControl(booking.extension_data?.map_id),\n        user: new FormControl(currentUser()),\n        user_id: new FormControl(booking.user_id),\n        user_email: new FormControl(booking.user_email),\n        booked_by: new FormControl(currentUser()),\n        booked_by_id: new FormControl(booking.booked_by_id),\n        booked_by_email: new FormControl(booking.booked_by_email),\n        secondary_resource: new FormControl(\n            booking.extension_data?.other_asset_type ||\n                booking.extension_data?.secondary_resource\n        ),\n    });\n    form.valueChanges.subscribe((v) => {\n        const user = v.user;\n        const booker = v.booked_by;\n        booker || user\n            ? form.patchValue(\n                  {\n                      user_id: user.id || booker.id,\n                      user_email: user.email || booker.id,\n                      booked_by_id: booker.id,\n                      booked_by_email: booker.email,\n                  },\n                  { emitEvent: false }\n              )\n            : '';\n    });\n    form.controls.all_day.valueChanges.subscribe((all_day) => {\n        if (all_day) form.controls.duration.disable();\n        else form.controls.duration.enable();\n    });\n    return form;\n}\n\nexport async function findNearbyFeature(\n    map_url: string,\n    centered_at: Point | string,\n    desk_ids: string[] = []\n): Promise<string> {\n    const element = document.createElement('div');\n    element.style.position = 'absolute';\n    element.style.top = '-9999px';\n    element.style.width = '1000px';\n    element.style.height = '1000px';\n    document.body.appendChild(element);\n    const id = await createViewer({\n        url: map_url,\n        element,\n    });\n    const viewer = getViewer(id);\n    const point = (typeof centered_at === 'string'\n        ? viewer.mappings[centered_at]\n        : centered_at) || { x: 0.5, y: 0.5 };\n    let dist = 10;\n    let closest = '';\n    for (const desk of desk_ids) {\n        const { x, y } = viewer.mappings[desk] || { x: 2, y: 2 };\n        const d = Math.sqrt(\n            (x - point.x) * (x - point.x) + (y - point.y) * (y - point.y)\n        );\n        if (d < dist) {\n            dist = d;\n            closest = desk;\n        }\n    }\n    document.body.removeChild(element);\n    removeViewer(id);\n    return closest;\n}\n\nexport function newBookingFromCalendarEvent(event: CalendarEvent) {\n    return new Booking({\n        id: event.id,\n        user_email: event.host,\n        asset_id: event.system?.id,\n        asset_name: event.system?.display_name || event.system?.name,\n        booking_type: 'room',\n        approved: event.status === 'approved',\n        extension_data: {\n            ...event,\n        },\n    });\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from '@placeos/common';\nimport {\n    EventFlowOptions,\n    EventFormService,\n} from 'libs/events/src/lib/event-form.service';\nimport { Space } from '../space.class';\n\n@Component({\n    selector: 'new-space-select-modal',\n    template: `\n        <div\n            class=\"w-[100vw] h-[100vh] sm:relative sm:w-auto sm:h-auto flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <header class=\"flex items-center space-x-4 w-full\">\n                <button icon matRipple mat-dialog-close class=\"bg-black/20\">\n                    <app-icon>close</app-icon>\n                </button>\n                <h3 i18n>Find Space</h3>\n                <div class=\"hidden sm:flex items-center justify-end flex-1\">\n                    <button\n                        btn\n                        matRipple\n                        map\n                        class=\"rounded-l rounded-r-none\"\n                        [class.inverse]=\"view !== 'map'\"\n                        (click)=\"view = 'map'\"\n                    >\n                        Map\n                    </button>\n                    <button\n                        btn\n                        matRipple\n                        list\n                        class=\"rounded-r rounded-l-none\"\n                        [class.inverse]=\"view !== 'list'\"\n                        (click)=\"view = 'list'\"\n                    >\n                        List\n                    </button>\n                </div>\n            </header>\n            <main\n                class=\"flex-1 flex items-center divide-x divide-gray-200 dark:divide-neutral-500 min-h-[65vh] h-[65vh] sm:max-h-[65vh] sm:max-w-[95vw] w-full overflow-hidden\"\n            >\n                <space-filters\n                    class=\"h-full hidden sm:flex max-w-[20rem] sm:h-[65vh] sm:max-h-full\"\n                ></space-filters>\n                <div\n                    class=\"flex flex-col items-center flex-1 w-1/2 h-full sm:h-[65vh]\"\n                >\n                    <space-filters-display\n                        class=\"w-full border-b border-gray-200 dark:border-neutral-500\"\n                        [(view)]=\"view\"\n                    ></space-filters-display>\n                    <space-list\n                        *ngIf=\"view === 'list'; else map_view\"\n                        [active]=\"displayed?.id\"\n                        [selected]=\"selected_ids\"\n                        [favorites]=\"favorites\"\n                        (toggleFav)=\"toggleFavourite($event)\"\n                        (onSelect)=\"displayed = $event\"\n                        class=\"flex-1 h-1/2 bg-black/5 dark:bg-white/10\"\n                    ></space-list>\n                </div>\n                <space-details\n                    [space]=\"displayed\"\n                    class=\"h-full w-full sm:h-[65vh] absolute sm:relative flex sm:max-w-[20rem] z-20 bg-white dark:bg-neutral-600 sm:block\"\n                    [class.hidden]=\"!displayed\"\n                    [class.inset-0]=\"displayed\"\n                    [hide_map]=\"view === 'map'\"\n                    [active]=\"selected_ids.includes(displayed?.id)\"\n                    (activeChange)=\"setSelected(displayed, $event)\"\n                    [fav]=\"displayed && this.favorites.includes(displayed?.id)\"\n                    (toggleFav)=\"toggleFavourite(displayed)\"\n                    (close)=\"displayed = null\"\n                ></space-details>\n            </main>\n            <footer\n                class=\"flex sm:hidden flex-col-reverse items-center justify-end px-2 pt-2 pb-[5.5rem] border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    btn\n                    matRipple\n                    name=\"spaces-return\"\n                    class=\"inverse sm:hidden w-full\"\n                    *ngIf=\"displayed\"\n                    (click)=\"displayed = null\"\n                    i18n\n                >\n                    Back\n                </button>\n                <button\n                    btn\n                    matRipple\n                    name=\"save-spaces\"\n                    [mat-dialog-close]=\"selected\"\n                    [class.mb-2]=\"displayed\"\n                    class=\"w-full sm:w-32 sm:mb-0\"\n                    i18n\n                >\n                    View List\n                </button>\n            </footer>\n            <footer\n                class=\"hidden sm:flex items-center justify-between p-2 border-t border-gray-200 dark:border-neutral-500 w-full\"\n            >\n                <button\n                    btn\n                    matRipple\n                    name=\"spaces-return\"\n                    [mat-dialog-close]=\"selected\"\n                    class=\"clear text-primary\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">arrow_back</app-icon>\n                        <div class=\"mr-1 underline\" i18n>Back to form</div>\n                    </div>\n                </button>\n                <p class=\"opacity-60 text-sm\" i18n>\n                    {{ selected.length }} room(s) added\n                </p>\n                <button\n                    btn\n                    matRipple\n                    name=\"toggle-space\"\n                    [disabled]=\"!displayed\"\n                    [class.inverse]=\"isSelected(displayed?.id)\"\n                    (click)=\"setSelected(displayed, !isSelected(displayed?.id))\"\n                >\n                    <div class=\"flex items-center\">\n                        <app-icon class=\"text-xl\">{{\n                            isSelected(displayed?.id) ? 'remove' : 'add'\n                        }}</app-icon>\n                        <div class=\"mr-1\">\n                            {{\n                                isSelected(displayed?.id)\n                                    ? 'Remove from Booking'\n                                    : 'Add to booking'\n                            }}\n                        </div>\n                    </div>\n                </button>\n            </footer>\n        </div>\n        <ng-template #map_view>\n            <space-map\n                class=\"flex-1 h-1/2 w-full\"\n                [selected]=\"selected_ids\"\n                [is_displayed]=\"!!displayed\"\n                [active]=\"displayed?.id\"\n                (onSelect)=\"displayed = $event\"\n            >\n            </space-map>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class NewSpaceSelectModalComponent {\n    public displayed?: Space;\n    public selected: Space[] = [];\n    public view = 'list';\n\n    public get selected_ids() {\n        return this.selected.map((_) => _.id).join(',');\n    }\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_spaces') || [];\n    }\n\n    constructor(\n        private _dialog_ref: MatDialogRef<NewSpaceSelectModalComponent>,\n        private _settings: SettingsService,\n        private _event_form: EventFormService,\n        @Inject(MAT_DIALOG_DATA)\n        _data: { spaces: Space[]; options: Partial<EventFlowOptions> }\n    ) {\n        this.selected = [...(_data.spaces || [])];\n        this._event_form.setOptions(_data.options);\n    }\n\n    public isSelected(id: string) {\n        return id && this.selected_ids.includes(id);\n    }\n\n    public setSelected(item: Space, state: boolean) {\n        const list = this.selected.filter((_) => _.id !== item.id);\n        if (state) list.push(item);\n        this.selected = list;\n        if (!this._settings.get('app.events.allow_multiple_spaces') && state) {\n            this._dialog_ref.close([item]);\n        }\n    }\n\n    public toggleFavourite(item: Space) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(item.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_spaces', [\n                ...fav_list,\n                item.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_spaces',\n                fav_list.filter((_) => _ !== item.id)\n            );\n        }\n    }\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\n\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { NewSpaceSelectModalComponent } from 'libs/spaces/src/lib/space-select-modal/new-space-select-modal.component';\nimport { OrganisationService } from '@placeos/organisation';\n\nconst EMPTY_FAVS: string[] = [];\n\n@Component({\n    selector: `space-list-field`,\n    template: `\n        <div>\n            <div class=\"flex items-center flex-wrap sm:space-x-2 mb-2\">\n                <div class=\"flex-1 min-w-[256px] space-y-2\">\n                    <label i18n>Select Room Size<span>*</span></label>\n                    <div class=\"flex items-center\">\n                        <mat-radio-group\n                            aria-label=\"Select Room Size\"\n                            class=\"space-x-4\"\n                            [(ngModel)]=\"room_size\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        >\n                            <mat-radio-button [value]=\"1\" i18n>\n                                Min. 2 People\n                            </mat-radio-button>\n                            <mat-radio-button [value]=\"4\" i18n>\n                                Min. 4 People\n                            </mat-radio-button>\n                            <mat-radio-button [value]=\"10\" i18n>\n                                Min. 10 People\n                            </mat-radio-button>\n                        </mat-radio-group>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div list class=\"space-y-2\">\n            <div\n                space\n                class=\"relative p-2 rounded-lg w-full flex items-center shadow border border-gray-200\"\n                *ngFor=\"let space of spaces\"\n            >\n                <div\n                    class=\"w-24 h-24 rounded-xl bg-black/20 mr-4 overflow-hidden flex items-center justify-center\"\n                >\n                    <img\n                        *ngIf=\"space.images?.length; else placeholder\"\n                        [src]=\"space.images[0]\"\n                        class=\"min-h-full object-cover\"\n                    />\n                    <ng-template #placeholder>\n                        <img\n                            class=\"m-auto\"\n                            src=\"assets/icons/room-placeholder.svg\"\n                        />\n                    </ng-template>\n                </div>\n                <div class=\"sm:space-y-2 pb-4\">\n                    <div class=\"font-medium\">\n                        {{\n                            space.display_name || space.name || 'Meeting Space'\n                        }}\n                    </div>\n                    <div class=\"flex items-center text-sm space-x-2\">\n                        <app-icon class=\"text-blue-500\">place</app-icon>\n                        <p>\n                            {{\n                                space.location ||\n                                    level(space.zones)?.display_name ||\n                                    level(space.zones)?.name\n                            }}\n                        </p>\n                    </div>\n                    <div class=\"flex items-center text-sm space-x-2\">\n                        <app-icon class=\"text-blue-500\">people</app-icon>\n                        <p i18n>\n                            {{ space.capacity < 1 ? 2 : space.capacity }} {\n                            space.capacity, plural, =1 { Person } other { People\n                            } }\n                        </p>\n                    </div>\n                    <div\n                        class=\"absolute bottom-0 right-0 flex items-center justify-end text-xs\"\n                    >\n                        <button\n                            btn\n                            matRipple\n                            name=\"edit-space\"\n                            class=\"clear\"\n                            (click)=\"changeSpaces(space)\"\n                        >\n                            <div class=\"flex items-center space-x-2\" i18n>\n                                <app-icon>edit</app-icon>\n                                Change\n                            </div>\n                        </button>\n                        <button\n                            btn\n                            matRipple\n                            name=\"remove-space\"\n                            class=\"clear\"\n                            (click)=\"removeSpace(space)\"\n                        >\n                            <div class=\"flex items-center space-x-2\" i18n>\n                                <app-icon>close</app-icon>\n                                Remove\n                            </div>\n                        </button>\n                    </div>\n                </div>\n                <button\n                    icon\n                    matRipple\n                    name=\"toggle-space-favourite\"\n                    class=\"absolute top-1 right-1\"\n                    [class.text-blue-400]=\"favorites.includes(asset?.id)\"\n                    (click)=\"toggleFavourite(asset)\"\n                >\n                    <app-icon>{{\n                        favorites.includes(asset?.id)\n                            ? 'favorite'\n                            : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </div>\n        </div>\n        <button\n            btn\n            matRipple\n            name=\"add-space\"\n            class=\"w-full inverse mt-2\"\n            (click)=\"changeSpaces()\"\n        >\n            <div class=\"flex items-center justify-center space-x-2\">\n                <app-icon>search</app-icon>\n                <span i18n>Add Space</span>\n            </div>\n        </button>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => SpaceListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class SpaceListFieldComponent implements ControlValueAccessor {\n    public room_size = 4;\n    public spaces: Space[] = [];\n    public disabled = false;\n\n    private _onChange: (_: Space[]) => void;\n    private _onTouch: (_: Space[]) => void;\n\n    public get favorites() {\n        return this._settings.get<string[]>('favourite_spaces') || EMPTY_FAVS;\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _org: OrganisationService,\n        private _dialog: MatDialog\n    ) {}\n\n    public level(zones: string[]) {\n        return this._org.levelWithID(zones);\n    }\n\n    /** Add or edit selected spaces */\n    public changeSpaces() {\n        const ref = this._dialog.open(NewSpaceSelectModalComponent, {\n            data: {\n                spaces: this.spaces,\n                options: { capacity: this.room_size },\n            },\n        });\n        ref.afterClosed().subscribe((spaces?: Space[]) => {\n            if (!spaces) spaces = ref.componentInstance.selected;\n            this.setValue(spaces);\n        });\n    }\n\n    /** Remove the selected space from the list */\n    public removeSpace(space: Space) {\n        this.setValue(this.spaces.filter((_) => _.id !== space.id));\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: Space[]) {\n        this.spaces = new_value;\n        if (this._onChange) this._onChange(this.spaces);\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: Space[]) {\n        this.spaces = value || [];\n    }\n\n    /* istanbul ignore next */\n    public readonly registerOnChange = (fn: (_: Space[]) => void) =>\n        (this._onChange = fn);\n    /* istanbul ignore next */\n    public readonly registerOnTouched = (fn: (_: Space[]) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n\n    public toggleFavourite(space: Space) {\n        const fav_list = this.favorites;\n        const new_state = !fav_list.includes(space.id);\n        if (new_state) {\n            this._settings.saveUserSetting('favourite_spaces', [\n                ...fav_list,\n                space.id,\n            ]);\n        } else {\n            this._settings.saveUserSetting(\n                'favourite_spaces',\n                fav_list.filter((_) => _ !== space.id)\n            );\n        }\n    }\n}\n","import {\n    AfterViewInit,\n    Component,\n    ElementRef,\n    forwardRef,\n    Input,\n    OnChanges,\n    SimpleChanges,\n    ViewChild,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { AsyncHandler } from '@placeos/common';\nimport * as Quill from 'quill';\n\n@Component({\n    selector: 'rich-text-input',\n    template: `\n        <div #container>\n            <div #editor></div>\n        </div>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => RichTextInputComponent),\n            multi: true,\n        },\n    ],\n})\nexport class RichTextInputComponent\n    extends AsyncHandler\n    implements ControlValueAccessor, OnChanges, AfterViewInit\n{\n    @Input() public placeholder = '';\n    @Input() public readonly = false;\n\n    @ViewChild('container') private _container_el: ElementRef<HTMLDivElement>;\n    @ViewChild('editor') private _editor_el: ElementRef<HTMLDivElement>;\n\n    private _editor: any;\n    private _updateFn = () => this.setValue(this._editor.root.innerHTML);\n\n    private _onChange: (\n        _: string\n    ) => void; /** Form control on change handler */\n    private _onTouch: (\n        _: string\n    ) => void; /** Form control on touched handler */\n\n    public readonly registerOnChange = (fn: (_: string) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: string) => void) =>\n        (this._onTouch = fn);\n\n    public ngOnChanges(changes: SimpleChanges) {}\n\n    public ngAfterViewInit() {\n        this._initialiseEditor();\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: string): void {\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: string) {\n        if (this._editor) {\n            const delta = this._editor.clipboard.convert(value);\n            this._editor.setContents(delta, 'silent');\n        } else {\n            this.timeout('write', () => this.writeValue(value));\n        }\n    }\n\n    private _initialiseEditor() {\n        this._editor = new Quill(this._editor_el.nativeElement, {\n            bounds: this._container_el.nativeElement,\n            placeholder: this.placeholder,\n            modules: {\n                toolbar: [\n                    [{ size: ['small', false, 'large', 'huge'] }],\n                    ['bold', 'italic', 'underline'],\n                    [{ list: 'ordered' }, { list: 'bullet' }],\n                ],\n            },\n            readOnly: this.readonly,\n            theme: 'snow',\n        });\n        this._editor.on('text-change', this._updateFn);\n        this.subscription('changes', () =>\n            this._editor.off('text-change', this._updateFn)\n        );\n    }\n}\n","import { differenceInMinutes } from 'date-fns';\n\nimport { Space } from 'libs/spaces/src/lib/space.class';\n\nimport { CalendarAvailability } from './calendar.interfaces';\n\nexport class Calendar {\n    /** ID of the calendar */\n    public readonly id: string;\n    /** Name of the calendar */\n    public readonly name: string;\n    /** System associated with the calendar */\n    public readonly resource: Space;\n    /** Primary calendar of the user */\n    public readonly primary: boolean;\n    /** Summary */\n    public readonly summary: string;\n    /** Whether the user can edit events associated to this calendar */\n    public readonly can_edit: boolean;\n    /** Availability */\n    public readonly availability: CalendarAvailability[];\n    /** Whether calendar should be hidden from the user */\n    public readonly hidden: boolean;\n\n    constructor(data: Partial<Calendar> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.primary = !!data.primary;\n        this.summary = data.summary || '';\n        this.can_edit = !!data.can_edit;\n        this.resource = new Space(data.resource || (data as any).system);\n        this.availability = (data.availability || []).map(\n            ({ starts_at, ends_at, date, duration, status }: any) => {\n                return {\n                    date: new Date(date, starts_at).valueOf(),\n                    duration:\n                        duration || differenceInMinutes(ends_at, starts_at),\n                    status: status,\n                };\n            }\n        );\n        this.hidden = !!data.hidden;\n    }\n}\n","import { get } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from '@placeos/common';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\n\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { Calendar } from './calendar.class';\nimport { CalendarAvailabilityQueryParams } from './calendar.interfaces';\n\nconst CALENDAR_ENDPOINT = '/api/staff/v1/calendars';\n\n/** List calendars associated with the logged in user */\nexport function queryCalendars(): Observable<Calendar[]> {\n    return get(CALENDAR_ENDPOINT).pipe(\n        map((i) => i.map((c) => new Calendar(c)))\n    );\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function queryCalendarAvailability(\n    q: CalendarAvailabilityQueryParams\n): Observable<Calendar[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/availability${query ? '?' + query : ''}`\n    ).pipe(map((i) => i.map((c) => new Calendar(c))));\n}\n\nconst calendarsToSpaces = (org?) =>\n    map((list: Calendar[]) =>\n        list\n            .filter((cal) => !!cal.resource)\n            .map(\n                (cal) =>\n                    new Space({\n                        ...cal.resource,\n                        level: org?.levelWithID(cal.resource.zones),\n                        availability: cal.availability,\n                    })\n            )\n            .filter((space) => space.bookable)\n    );\n\n/** List available spaces based on the given query */\nexport function querySpaceCalendarAvailability(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    return queryCalendarAvailability(q).pipe(calendarsToSpaces(org));\n}\n\nexport function queryUserFreeBusy(q: CalendarAvailabilityQueryParams) {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/free_busy${query ? '?' + query : ''}`\n    ).pipe(map((i) => i as Calendar[]));\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function querySpaceFreeBusy(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/free_busy${query ? '?' + query : ''}`\n    ).pipe(\n        map((i) => i.map((c) => new Calendar(c))),\n        calendarsToSpaces(org)\n    );\n}\n","import { Component, forwardRef } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { currentUser, unique } from '@placeos/common';\nimport { showStaff } from 'libs/users/src/lib/staff.fn';\nimport { User } from 'libs/users/src/lib/user.class';\nimport { Calendar } from 'libs/calendar/src/lib/calendar.class';\nimport { queryCalendars } from 'libs/calendar/src/lib/calendar.fn';\nimport { of, zip } from 'rxjs';\nimport { catchError, map, shareReplay, switchMap } from 'rxjs/operators';\n\n@Component({\n    selector: 'host-select-field',\n    template: `\n        <mat-form-field appearance=\"outline\" class=\"w-full\">\n            <mat-select\n                [ngModel]=\"this.item\"\n                (ngModelChange)=\"setValue($event)\"\n                [disabled]=\"disabled\"\n                placeholder=\"Select host\"\n                i18n-placeholder\n            >\n                <mat-option\n                    *ngFor=\"let user of users | async\"\n                    [value]=\"user\"\n                    class=\"leading-tight\"\n                >\n                    <div class=\"flex flex-col\">\n                        <div>{{ user.name }}</div>\n                        <span class=\"hidden\">&nbsp;|&nbsp;</span>\n                        <div class=\"text-xs opacity-60\">{{ user.email }}</div>\n                    </div>\n                </mat-option>\n            </mat-select>\n            <mat-error i18n>Host is required</mat-error>\n        </mat-form-field>\n        <ng-container *ngIf=\"users | async\"></ng-container>\n    `,\n    styles: [``],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => HostSelectFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class HostSelectFieldComponent implements ControlValueAccessor {\n    public item?: User;\n    public readonly users = of(1).pipe(\n        switchMap(() =>\n            queryCalendars().pipe(catchError((_) => of([] as Calendar[])))\n        ),\n        switchMap((list) =>\n            zip(\n                ...list.map((_) =>\n                    showStaff(_.id).pipe(catchError((_) => of(null)))\n                )\n            )\n        ),\n        map((_) => unique([currentUser(), ..._], 'email')),\n        shareReplay(1)\n    );\n    public disabled = false;\n\n    private _onChange: (_: User) => void;\n    private _onTouch: (_: User) => void;\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User) {\n        this.item = new_value;\n        if (this._onChange) this._onChange(this.item);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User) {\n        this.item = value;\n        if (!value?.email) {\n            this.item = currentUser();\n        }\n    }\n\n    public readonly registerOnChange = (fn: (_: User) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: User) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n}\n","import { COMMA, ENTER } from '@angular/cdk/keycodes';\nimport { Component, ElementRef, forwardRef, ViewChild } from '@angular/core';\nimport { NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatChipInputEvent } from '@angular/material/chips';\nimport { Clipboard } from '@angular/cdk/clipboard';\nimport {\n    humanReadableByteCount,\n    Upload,\n    uploadFiles,\n} from '@placeos/cloud-uploads';\nimport { AsyncHandler, notifyInfo, randomInt, unique } from '@placeos/common';\n\nimport { BehaviorSubject, combineLatest, Observable } from 'rxjs';\nimport { filter, map, takeWhile } from 'rxjs/operators';\n\nimport * as blobUtil from 'blob-util';\n\nexport interface UploadDetails {\n    /** Unique ID for the upload */\n    id: number;\n    /** Name of the file uploaded */\n    name: string;\n    /** Progress of the file upload */\n    progress: number;\n    /** Link to the uploaded file */\n    link: string;\n    /** Formatted file size */\n    formatted_size: string;\n    /** Size of the file being uploaded */\n    size: number;\n    /** Error with upload request */\n    error?: string;\n    /** Upload object associated with the file */\n    upload: Upload;\n}\n/**\n * Upload the given file to the cloud\n * @param file File to upload\n */\nexport function uploadFile(file: File): Observable<UploadDetails> {\n    return new Observable((observer) => {\n        const fileReader = new FileReader();\n        fileReader.addEventListener('loadend', (e: any) => {\n            const arrayBuffer = e.target.result;\n            const upload_details: UploadDetails = {\n                id: randomInt(9999_9999_9999),\n                name: file.name,\n                progress: 0,\n                link: '',\n                formatted_size: humanReadableByteCount(file.size),\n                size: file.size,\n                upload: null,\n            };\n            const blob = blobUtil.arrayBufferToBlob(arrayBuffer, file.type);\n            const upload_list = uploadFiles([blob], { file_name: file.name });\n            const upload = upload_list[0];\n            upload_details.upload = upload;\n            upload.status\n                .pipe(takeWhile((_) => _.status !== 'complete', true))\n                .subscribe(\n                    (state) => {\n                        if (upload.access_url)\n                            upload_details.link = upload.access_url;\n                        upload_details.progress = state.progress;\n                        observer.next(upload_details);\n                        if (state.status === 'error')\n                            observer.error({\n                                ...upload_details,\n                                error: state.error,\n                            });\n                        if (state.status === 'complete') observer.complete();\n                    },\n                    (e) => (upload_details.error = e)\n                );\n            observer.next(upload_details);\n        });\n        fileReader.readAsArrayBuffer(file);\n    });\n}\n\n@Component({\n    selector: 'image-list-field',\n    template: `\n        <div\n            images\n            #image_list\n            class=\"space-x-2 py-2 overflow-hidden mb-2 w-full flex items-center relative\"\n            (window:resize)=\"ngAfterViewInit()\"\n        >\n            <div\n                image\n                class=\"relative rounded border-2 border-gray-200 dark:border-neutral-500 border-dashed flex-shrink-0 flex flex-col items-center justify-center h-32 w-36 hover:bg-black/10 dark:hover:bg-white/10 cursor-pointer\"\n                [style.transform]=\"'translate(-' + offset + '00%)'\"\n            >\n                <app-icon class=\"text-4xl opacity-60\">add</app-icon>\n                <p class=\"opacity-60\" i18n>Upload Image(s)</p>\n                <input\n                    type=\"file\"\n                    class=\"absolute inset-0 opacity-0 h-32 w-32 cursor-pointer\"\n                    (change)=\"uploadImages($event)\"\n                />\n            </div>\n            <div\n                image\n                *ngFor=\"let url of list; let i = index\"\n                class=\"bg-center bg-cover h-32 w-36 relative rounded overflow-hidden flex-shrink-0\"\n                [style.transform]=\"'translate(-' + offset + '00%)'\"\n                [style.background-image]=\"'url(' + url + ')'\"\n            >\n                <div\n                    overlay\n                    class=\"absolute inset-0 hover:bg-black/50 text-white\"\n                >\n                    <div\n                        actions\n                        class=\"absolute top-0 left-0 right-0 flex items-center justify-center space-x-2 opacity-0\"\n                    >\n                        <button icon (click)=\"copyLink(url)\">\n                            <app-icon>link</app-icon>\n                        </button>\n                        <button icon (click)=\"viewImage(url)\">\n                            <app-icon>visibility</app-icon>\n                        </button>\n                        <button icon (click)=\"removeImage(url)\">\n                            <app-icon>close</app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div\n                image\n                *ngFor=\"let item of uploads | async; let i = index\"\n                class=\"bg-center bg-cover h-32 w-36 rounded border bg-black/10 dark:bg-white/5 border-gray-200 dark:border-neutral-500 flex items-center justify-center flex-shrink-0\"\n                [style.transform]=\"'translate(-' + offset + '00%)'\"\n                [matTooltip]=\"item.error\"\n                (click)=\"retryUpload(item)\"\n            >\n                <mat-progress-spinner\n                    *ngIf=\"!item.error\"\n                    [value]=\"item.progress\"\n                    [diameter]=\"64\"\n                    mode=\"determinate\"\n                ></mat-progress-spinner>\n                <app-icon *ngIf=\"item.error\" class=\"text-error text-6xl\"\n                    >warning</app-icon\n                >\n                <div\n                    overlay\n                    *ngIf=\"item.error\"\n                    class=\"absolute inset-0 hover:bg-black hover:bg-opacity-50 text-white flex items-center justify-center\"\n                >\n                    <app-icon class=\"text-3xl opacity-0\">retry</app-icon>\n                </div>\n            </div>\n            <button\n                icon\n                matRipple\n                *ngIf=\"length > view_space\"\n                [disabled]=\"offset === 0\"\n                class=\"absolute top-1/2 left-0 transform -translate-y-1/2 bg-white\"\n                (click)=\"offset = offset - 1\"\n            >\n                <app-icon>chevron_left</app-icon>\n            </button>\n            <button\n                icon\n                matRipple\n                *ngIf=\"length > view_space\"\n                [disabled]=\"offset >= length - view_space\"\n                class=\"absolute top-1/2 right-0 transform -translate-y-1/2 bg-white\"\n                (click)=\"offset = offset + 1\"\n            >\n                <app-icon>chevron_right</app-icon>\n            </button>\n        </div>\n        <mat-form-field appearance=\"outline\" class=\"w-full\">\n            <mat-chip-grid #chipList aria-label=\"Image List\">\n                <mat-chip-row\n                    *ngFor=\"let item of list\"\n                    (removed)=\"removeItem(item)\"\n                >\n                    <div class=\"truncate max-w-md\">{{ item }}</div>\n                    <button matChipRemove [attr.aria-label]=\"'Remove ' + item\">\n                        <app-icon>cancel</app-icon>\n                    </button>\n                </mat-chip-row>\n            </mat-chip-grid>\n            <input\n                placeholder=\"Add image via URL\"\n                i18n-placeholder\n                [matChipInputFor]=\"chipList\"\n                [matChipInputSeparatorKeyCodes]=\"separators\"\n                [matChipInputAddOnBlur]=\"true\"\n                (matChipInputTokenEnd)=\"addImage($event)\"\n            />\n        </mat-form-field>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n            }\n\n            [overlay] {\n                transition: background 200ms;\n            }\n\n            [overlay]:hover [actions],\n            [overlay]:hover > app-icon {\n                opacity: 1 !important;\n            }\n\n            [actions],\n            [overlay] > app-icon {\n                transition: opacity 200ms;\n            }\n\n            [image] {\n                transition: transform 200ms;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => ImageListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class ImageListFieldComponent extends AsyncHandler {\n    /** List of images */\n    public list: string[] = [];\n    /** List of images */\n    public upload_ids = new BehaviorSubject<number[]>([]);\n    private _upload_list = new BehaviorSubject<UploadDetails[]>([]);\n    public readonly upload_list = this._upload_list.asObservable();\n    public offset: number = 0;\n\n    public view_space: number = 0;\n\n    public readonly separators = [COMMA, ENTER];\n\n    public readonly uploads = combineLatest([\n        this.upload_list,\n        this.upload_ids,\n    ]).pipe(map(([list, ids]) => list.filter((i) => ids.includes(i.id))));\n\n    public get length() {\n        return this.list.length + this._upload_list.getValue().length + 1;\n    }\n\n    @ViewChild('image_list') private _list_el: ElementRef<HTMLDivElement>;\n\n    constructor(private _clipboard: Clipboard) {\n        super();\n    }\n\n    /** Form control on change handler */\n    private _onChange: (_: string[]) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: string[]) => void;\n\n    public ngAfterViewInit() {\n        const box = this._list_el.nativeElement.getBoundingClientRect();\n        this.view_space = Math.floor(box.width / 152);\n        this.subscription(\n            'upload_changes',\n            this.upload_list.subscribe((list) => {\n                const id_list = this.upload_ids.getValue();\n                for (const id of id_list) {\n                    const item = list.find((_) => _.id === id);\n                    if (item && item.progress >= 100) {\n                        this.addImageUrl(item.link);\n                        this.upload_ids.next(\n                            this.upload_ids.getValue().filter((_) => _ !== id)\n                        );\n                    }\n                }\n            })\n        );\n    }\n\n    public copyLink(url: string) {\n        this._clipboard.copy(url);\n        notifyInfo('Copied image URL to clipboard');\n    }\n\n    public viewImage(url: string) {}\n\n    public removeImage(url: string) {\n        this.setValue(this.list.filter((_) => _ !== url));\n    }\n\n    public addImage(event: MatChipInputEvent) {\n        if (!event.value) return;\n        this.setValue(unique([...this.list, event.value]));\n        event.chipInput.inputElement.value = '';\n    }\n\n    public addImageUrl(url: string) {\n        this.setValue(unique([...this.list, url]));\n    }\n\n    public async uploadImages(event) {\n        const element: HTMLInputElement = event.target as any;\n        /* istanbul ignore else */\n        if (element?.files) {\n            const files: FileList = element.files;\n            /* istanbul ignore else */\n            if (files.length) {\n                for (let i = 0; i < files.length; i++) {\n                    const id = await this.uploadFile(files[i]);\n                    this.upload_ids.next([...this.upload_ids.getValue(), id]);\n                }\n            }\n        }\n    }\n\n    public setValue(value: string[]) {\n        this.list = value;\n        if (this._onChange) this._onChange(value);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: string[]) {\n        this.list = value;\n    }\n\n    public readonly registerOnChange = (fn: (_: string[]) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: string[]) => void) =>\n        (this._onTouch = fn);\n\n    public uploadFile(file: File) {\n        return new Promise<number>((resolve) => {\n            let resolved = false;\n            const update_fn = (details) => {\n                if (!resolved) {\n                    resolve(details.id);\n                    resolved = true;\n                }\n                this._upload_list.next([\n                    ...this._upload_list\n                        .getValue()\n                        .filter((_) => _.id !== details.id),\n                    details,\n                ]);\n            };\n            uploadFile(file).subscribe(update_fn, update_fn, () => {\n                this._updateUploadHistory();\n            });\n        });\n    }\n\n    private _updateUploadHistory() {\n        const done_list = this._upload_list\n            .getValue()\n            .filter((file) => file.progress >= 100);\n        done_list.forEach((i) => delete i.upload);\n        if (localStorage) {\n            localStorage.setItem(\n                'CONCIERGE.uploads',\n                JSON.stringify(done_list)\n            );\n        }\n    }\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { ClipboardModule } from '@angular/cdk/clipboard';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatRippleModule } from '@angular/material/core';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatRadioModule } from '@angular/material/radio';\n\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\n\nimport { ActionFieldComponent } from './action-field.component';\nimport { CounterComponent } from './counter.component';\nimport { DateFieldComponent } from './date-field.component';\nimport { DurationFieldComponent } from './duration-field.component';\nimport { TimeFieldComponent } from './time-field.component';\nimport { UserListFieldComponent } from './user-list-field.component';\nimport { UserSearchFieldComponent } from './user-search-field.component';\nimport { ItemListFieldComponent } from './item-list-field.component';\nimport { UploadListFieldComponent } from './upload-list-field.component';\nimport { UploadFileFieldComponent } from './upload-file-field.component';\nimport { AssetListFieldComponent } from './asset-list-field.component';\nimport { SpaceListFieldComponent } from './space-list-field.component';\nimport { RichTextInputComponent } from './rich-text-input.component';\nimport { HostSelectFieldComponent } from './host-select-field.component';\nimport { ImageListFieldComponent } from './image-list-field.component';\n\nconst COMPONENTS: Type<any>[] = [\n    ActionFieldComponent,\n    CounterComponent,\n    DateFieldComponent,\n    DurationFieldComponent,\n    TimeFieldComponent,\n    UserListFieldComponent,\n    UserSearchFieldComponent,\n    ItemListFieldComponent,\n    UploadListFieldComponent,\n    UploadFileFieldComponent,\n    AssetListFieldComponent,\n    SpaceListFieldComponent,\n    RichTextInputComponent,\n    HostSelectFieldComponent,\n    ImageListFieldComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        MatRippleModule,\n        ReactiveFormsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        MatAutocompleteModule,\n        MatTooltipModule,\n        MatCheckboxModule,\n        MatRadioModule,\n        MatChipsModule,\n        ClipboardModule,\n        ComponentsModule,\n    ],\n    exports: [...COMPONENTS],\n})\nexport class FormFieldsModule {}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Space } from './space.class';\n\n@Component({\n    selector: 'a-space-select-item',\n    template: `\n        <div\n            space\n            class=\"w-full flex items-center p-2 space-x-2 border-b border-gray-100\"\n            *ngIf=\"space\"\n        >\n            <div class=\"flex-1 w-1/2\">\n                <div class=\"text-base truncate\">{{ space.name }}</div>\n                <div class=\"text-xs\">\n                    {{ space.level?.display_name || space.level?.name }}\n                </div>\n            </div>\n            <div class=\"flex items-center\" *ngIf=\"space.capacity !== -1\">\n                <app-icon>account_circle</app-icon>\n                <div>{{ space.capacity }}</div>\n            </div>\n            <button\n                icon\n                matRipple\n                *ngIf=\"multiple; else single_button\"\n                (click)=\"action.emit()\"\n            >\n                <app-icon>{{\n                    type === 'available' ? 'add' : 'close'\n                }}</app-icon>\n            </button>\n        </div>\n        <ng-template #single_button>\n            <button\n                btn\n                matRipple\n                class=\"w-32\"\n                [class.request]=\"space.by_request\"\n            >\n                {{ space.by_request ? 'Request' : 'Book' }}\n            </button>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SpaceSelectItemComponent {\n    /** Space to display the details */\n    @Input() public space: Space;\n    /** Selected state for the space */\n    @Input() public type: 'available' | 'selected';\n    /** Whether user is allowed to select multiple spaces */\n    @Input() public multiple: boolean;\n    /** Emitter for selection actions */\n    @Output() public action = new EventEmitter();\n}\n","import { Component, Inject, Output, EventEmitter } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { addMinutes, getUnixTime } from 'date-fns';\n\nimport {\n    AsyncHandler,\n    currentUser,\n    DialogEvent,\n    HashMap,\n    Identity,\n    SettingsService,\n} from '@placeos/common';\nimport { Building, OrganisationService } from '@placeos/organisation';\n\nimport { filterSpacesFromRules } from 'libs/events/src/lib/helpers';\nimport { querySpaceCalendarAvailability } from 'libs/calendar/src/lib/calendar.fn';\nimport { Space } from './space.class';\n\nexport interface SpaceSelectModalData {\n    /** List of currently selected spaces */\n    readonly spaces: Space[];\n    /** Selected date to check space availability */\n    readonly date: number;\n    /** Duration of the availability that is desired */\n    readonly duration: number;\n    all_day?: boolean;\n    visitor_type?: string;\n}\n\n@Component({\n    selector: 'a-space-select-modal',\n    template: `\n        <header>\n            <app-icon class=\"text-3xl\">place</app-icon>\n            <div class=\"text-xl font-semibold flex-1\">\n                Select space{{ multiple ? 's' : '' }}\n            </div>\n            <button icon mat-dialog-close>\n                <app-icon class=\"text-3xl\">close</app-icon>\n            </button>\n        </header>\n        <main>\n            <mat-form-field\n                appearance=\"outline\"\n                *ngIf=\"buildings && buildings.length > 1\"\n            >\n                <mat-select\n                    name=\"booking-type\"\n                    [ngModel]=\"building.getValue()\"\n                    (ngModelChange)=\"building.next($event)\"\n                    placeholder=\"Select building\"\n                >\n                    <mat-option *ngFor=\"let bld of buildings\" [value]=\"bld\">\n                        {{ bld.display_name || bld.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <mat-form-field\n                appearance=\"outline\"\n                *ngIf=\"space_types && space_types.length > 1\"\n            >\n                <mat-select\n                    name=\"booking-type\"\n                    [(ngModel)]=\"type\"\n                    placeholder=\"Any space type\"\n                >\n                    <mat-option\n                        *ngFor=\"let type of space_types\"\n                        [value]=\"type.id\"\n                    >\n                        {{ type.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <div class=\"body\" style=\"width: 32rem\">\n                <ng-container *ngIf=\"!loading; else load_state\">\n                    <ng-container\n                        *ngIf=\"\n                            (filtered_spaces | async)?.length;\n                            else empty_state\n                        \"\n                    >\n                        <ng-container\n                            *ngFor=\"let space of filtered_spaces | async\"\n                        >\n                            <a-space-select-item\n                                *ngIf=\"!space_map[space.id]\"\n                                [space]=\"space\"\n                                [multiple]=\"multiple\"\n                                type=\"available\"\n                                (click)=\"spaceSelected(space)\"\n                            ></a-space-select-item>\n                        </ng-container>\n                    </ng-container>\n                </ng-container>\n                <div\n                    class=\"space-list\"\n                    *ngIf=\"multiple\"\n                    [class.show]=\"show_selected\"\n                >\n                    <ng-container\n                        *ngIf=\"spaces && spaces.length; else empty_state\"\n                    >\n                        <a-space-select-item\n                            *ngFor=\"let space of spaces\"\n                            [space]=\"space\"\n                            [multiple]=\"multiple\"\n                            type=\"selected\"\n                        ></a-space-select-item>\n                    </ng-container>\n                </div>\n            </div>\n            <footer *ngIf=\"multiple\">\n                <button btn matRipple (click)=\"save()\">\n                    Save selected spaces({{ spaces.length || '0' }})\n                </button>\n            </footer>\n            <ng-template #empty_state>\n                <div empty class=\"p-16 flex flex-col items-center space-y-2\">\n                    <app-icon class=\"text-3xl\">close</app-icon>\n                    <p>No spaces</p>\n                </div>\n            </ng-template>\n            <ng-template #load_state>\n                <div load class=\"p-16 flex flex-col items-center space-y-2\">\n                    <mat-spinner diameter=\"48\"></mat-spinner>\n                    <p>Finding available spaces...</p>\n                </div>\n            </ng-template>\n        </main>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.5em;\n                width: 100%;\n                padding: 0 0.25em;\n            }\n\n            .body {\n                min-width: 20rem;\n                max-width: calc(100vw - 2rem);\n                max-height: 65vh;\n                overflow: auto;\n            }\n        `,\n    ],\n})\nexport class SpaceSelectModalComponent extends AsyncHandler {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** List of selected spaces */\n    public spaces: Space[] = [...(this._data.spaces || [])];\n    /** Building to filter available spaces */\n    public building = new BehaviorSubject<Building>(null);\n    /** Whether to show selected spaces */\n    public show_selected: boolean;\n    /** List of available space types */\n    public space_types: Identity[] = [];\n    /** ID of the space type to filter available spaces on */\n    public type: string;\n    /** Whether the available spaces are being loaded */\n    public loading: boolean;\n\n    public readonly available_spaces = combineLatest([this.building]).pipe(\n        switchMap(([bld]) => {\n            this.loading = true;\n            return querySpaceCalendarAvailability({\n                zone_ids: bld?.id,\n                period_start: getUnixTime(this._data.date),\n                period_end: getUnixTime(\n                    addMinutes(this._data.date, this._data.duration)\n                ),\n            });\n        }),\n        shareReplay(1)\n    );\n\n    public readonly filtered_spaces = this.available_spaces.pipe(\n        map((list) =>\n            filterSpacesFromRules(\n                list,\n                { ...this._data, host: currentUser() } as any,\n                this._org.building.booking_rules\n            )\n        ),\n        tap(() => (this.loading = false))\n    );\n\n    public get buildings(): Building[] {\n        return this._org.buildings;\n    }\n\n    /** Whether multiple spaces can be selected */\n    public get multiple(): boolean {\n        return !!this._settings.get('app.events.multiple_spaces');\n    }\n\n    /** Mapping of spaces to whether they are selected */\n    public get space_map(): HashMap<boolean> {\n        const spaces = {};\n        this.spaces.forEach((space) => (spaces[space.id] = true));\n        return spaces;\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        @Inject(MAT_DIALOG_DATA) private _data: SpaceSelectModalData\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.building.next(this._org.building || this.buildings[0]);\n        this.subscription(\n            'spaces',\n            this.filtered_spaces.subscribe((_) => _)\n        );\n    }\n\n    public spaceSelected(space: Space) {\n        if (this.multiple) {\n            if (!this.space_map[space.id]) {\n                this.spaces.push(space);\n            }\n        } else {\n            this.spaces = [space];\n            this.save();\n        }\n    }\n\n    public save() {\n        this.event.emit({ reason: 'done', metadata: this.spaces });\n    }\n}\n","import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { ApplicationIcon, SettingsService } from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\n@Component({\n    selector: 'app-login',\n    template: `\n        <div class=\"fixed inset-0 overflow-auto\">\n            <form\n                class=\"flex flex-col items-center overflow-hidden mx-auto my-4 bg-white rounded shadow p-4\"\n            >\n                <div\n                    class=\"flex items-center justify-center\"\n                    [style.background-color]=\"logo?.background\"\n                >\n                    <i *ngIf=\"logo?.type === 'icon'\" [class]=\"logo.class\">\n                        {{ logo.content }}\n                    </i>\n                    <img\n                        *ngIf=\"logo?.type === 'img'\"\n                        [src]=\"logo.src | safe: 'resource'\"\n                    />\n                </div>\n                <div class=\"w-full relative h-1/3 flex-1\">\n                    <ng-container *ngIf=\"!loading; else loading_state\">\n                        <div class=\"flex flex-col\">\n                            <label\n                                for=\"username\"\n                                [class.focused]=\"\n                                    username || focus === 'username'\n                                \"\n                                [class.in-focus]=\"focus === 'username'\"\n                            >\n                                Username\n                            </label>\n                            <mat-form-field appearance=\"outline\">\n                                <input\n                                    #username\n                                    formControlName=\"username\"\n                                    (keyup.enter)=\"toPassword()\"\n                                />\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex flex-col\">\n                            <label for=\"password\">Password</label>\n                            <mat-form-field appearance=\"outline\">\n                                <input\n                                    #pass_field\n                                    formControlName=\"password\"\n                                    (keyup.enter)=\"login()\"\n                                />\n                                <mat-error\n                                    >Invalid username or password</mat-error\n                                >\n                            </mat-form-field>\n                        </div>\n                    </ng-container>\n                </div>\n                <div\n                    class=\"flex items-center justify-center w-full\"\n                    *ngIf=\"!loading\"\n                >\n                    <button btn matRipple color=\"primary\" (click)=\"login()\">\n                        Login\n                    </button>\n                </div>\n            </form>\n        </div>\n        <ng-template #loading_state>\n            <div\n                class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner diameter=\"64\"></mat-spinner>\n                <p>Checking user credentials...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                background-color: #f0f0f0;\n                background-image: url(\"data:image/svg+xml,%3Csvg width='64' height='64' viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 16c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zm33.414-6l5.95-5.95L45.95.636 40 6.586 34.05.636 32.636 2.05 38.586 8l-5.95 5.95 1.414 1.414L40 9.414l5.95 5.95 1.414-1.414L41.414 8zM40 48c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zM9.414 40l5.95-5.95-1.414-1.414L8 38.586l-5.95-5.95L.636 34.05 6.586 40l-5.95 5.95 1.414 1.414L8 41.414l5.95 5.95 1.414-1.414L9.414 40z' fill='%23ad1457' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E\");\n            }\n\n            form {\n                width: 20rem;\n                max-width: calc(100vw - 2rem);\n            }\n\n            img {\n                max-height: 3.75rem;\n                max-width: 15rem;\n            }\n        `,\n    ],\n})\nexport class LoginComponent implements OnInit {\n    /** Whether the user credentials are being checked */\n    public loading: boolean;\n\n    public readonly form = new FormGroup({\n        username: new FormControl('', [Validators.required]),\n        password: new FormControl('', [Validators.required]),\n    });\n\n    /** Password field element */\n    @ViewChild('pass_field', { static: true })\n    private pwd_field: ElementRef<HTMLInputElement>;\n\n    /** Logo of the application organisation */\n    public get logo(): ApplicationIcon {\n        return this._settings.get('app.logo_dark') || { type: 'icon' };\n    }\n\n    constructor(private _settings: SettingsService) {}\n\n    public async ngOnInit() {\n        this.loading = true;\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        this.loading = false;\n    }\n\n    /** Focus on the password field */\n    public toPassword() {\n        if (this.pwd_field && this.pwd_field.nativeElement) {\n            this.pwd_field.nativeElement.focus();\n        }\n    }\n\n    /** Perform user login */\n    public login() {\n        this.loading = true;\n        // this._users.login({\n        //     username: this.username,\n        //     password: this.password\n        // }, { form: true }).then(() => {\n        //     this.loading = false;\n        // }, () => {\n        //     this.loading = false;\n        //     this.error = true;\n        // });\n        this.form.setErrors({ password: 'Invalid username or password' });\n    }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'app-unauthorised',\n    template: `\n        <div\n            class=\"unauthorised rounded m-4 text-center bg-white text-black border border-gray-400 p-4 shadow\"\n        >\n            <h1 class=\"text-4xl\">403</h1>\n            <h3 class=\"text-2xl\" i18n>Access forbidden.</h3>\n            <p class=\"py-4\" i18n>\n                You do not have permission to view this page and your access\n                attempt has been recorded.\n            </p>\n            <p i18n>\n                Contact your Administrator if you feel that you should have\n                access.\n            </p>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .unauthorised {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                .unauthorised {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }\n        `,\n    ],\n})\nexport class UnauthorisedComponent {}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'app-misconfigured',\n    template: `\n        <div\n            content\n            class=\"rounded m-4 text-center bg-white text-black border border-gray-400 p-4 shadow\"\n        >\n            <h3 class=\"text-2xl\" i18n=\"@@forbiddenLabel\">\n                Application Misconfigured.\n            </h3>\n            <p class=\"py-4\" i18n=\"@@invalidPermissionLabel\">\n                This application requires a zone of type org, building and level\n                to operate.\n            </p>\n            <p i18n=\"@@contactAdminLabel\">\n                If this issue persists please contact your administrator.\n            </p>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            [content] {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                [content] {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }\n        `,\n    ],\n})\nexport class MisconfiguredComponent {}\n","import { Injectable } from '@angular/core';\nimport {\n    CanActivate,\n    CanLoad,\n    Route,\n    UrlSegment,\n    ActivatedRouteSnapshot,\n    RouterStateSnapshot,\n    UrlTree,\n    Router,\n} from '@angular/router';\nimport { onlineState } from '@placeos/ts-client';\nimport { current_user } from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class AuthorisedAdminGuard implements CanActivate, CanLoad {\n    constructor(private _router: Router) {}\n\n    public async canActivate(\n        next?: ActivatedRouteSnapshot,\n        state?: RouterStateSnapshot\n    ): Promise<boolean | UrlTree> {\n        return this.checkUser();\n    }\n\n    public async canLoad(\n        route?: Route,\n        segments?: UrlSegment[]\n    ): Promise<boolean> {\n        return this.checkUser();\n    }\n\n    private async checkUser() {\n        await onlineState()\n            .pipe(first((_) => _))\n            .toPromise();\n        const user = await current_user.pipe(first((_) => !!_)).toPromise();\n        const can_activate = user && user.groups.includes('placeos_admin');\n        if (!can_activate) {\n            this._router.navigate(['/unauthorised']);\n        }\n        return can_activate;\n    }\n}\n","import { Injectable, Optional } from '@angular/core';\nimport {\n    CanActivate,\n    CanLoad,\n    Route,\n    UrlSegment,\n    ActivatedRouteSnapshot,\n    RouterStateSnapshot,\n    UrlTree,\n    Router,\n} from '@angular/router';\nimport { onlineState } from '@placeos/ts-client';\nimport { current_user } from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\nimport { StaffUser } from '../../../users/src/lib/user.class';\n\nexport abstract class PLACEOS_APP_ACCESS {\n    public readonly group: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class AuthorisedUserGuard implements CanActivate, CanLoad {\n    constructor(\n        private _router: Router,\n        @Optional() private _access: PLACEOS_APP_ACCESS\n    ) {}\n\n    public async canActivate(\n        next?: ActivatedRouteSnapshot,\n        state?: RouterStateSnapshot\n    ): Promise<boolean | UrlTree> {\n        return this.checkUser();\n    }\n\n    public async canLoad(\n        route?: Route,\n        segments?: UrlSegment[]\n    ): Promise<boolean> {\n        return this.checkUser();\n    }\n\n    private async checkUser() {\n        await onlineState()\n            .pipe(first((_) => _))\n            .toPromise();\n        const user: StaffUser = await current_user\n            .pipe(first((_) => !!_))\n            .toPromise();\n        const can_activate = !!(\n            user &&\n            (!this._access?.group || user.groups.includes(this._access.group))\n        );\n        if (!can_activate) {\n            this._router.navigate(['/unauthorised']);\n        }\n        return !!can_activate;\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { MapPinComponent } from '@placeos/components';\nimport { OrganisationService } from '@placeos/organisation';\nimport { ViewerFeature } from '@placeos/svg-viewer';\nimport { Space } from '../space.class';\n\n@Component({\n    selector: `space-details`,\n    template: `\n        <ng-container *ngIf=\"space; else empty_state\">\n            <section\n                image\n                class=\"relative w-full bg-black/20\"\n                [class.sm:h-64]=\"space.images?.length\"\n                [class.h-40]=\"space.images?.length\"\n                [class.sm:h-0]=\"!space.images?.length\"\n                [class.h-12]=\"!space.images?.length\"\n                [class.!bg-transparent]=\"!space.images?.length\"\n            >\n                <image-carousel\n                    [images]=\"space.images\"\n                    *ngIf=\"space.images?.length\"\n                    class=\"absolute inset-0\"\n                ></image-carousel>\n                <button\n                    icon\n                    matRipple\n                    name=\"close-space-details\"\n                    (click)=\"close.emit()\"\n                    class=\"absolute top-2 left-2 bg-black/40 sm:hidden text-white\"\n                >\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <button\n                    icon\n                    matRipple\n                    name=\"toggle-space-favourite-details\"\n                    [class.text-white]=\"!fav\"\n                    [class.text-blue-400]=\"fav\"\n                    (click)=\"toggleFav.emit()\"\n                    class=\"absolute top-2 right-2 bg-black/40\"\n                >\n                    <app-icon>{{\n                        fav ? 'favorite' : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </section>\n            <div class=\"p-2 space-y-2 flex-1 h-1/2 overflow-auto\">\n                <section actions class=\"z-0\">\n                    <h2 class=\"text-xl font-medium mb-2 mt-4\">\n                        {{ space.display_name || space.name }}\n                    </h2>\n                </section>\n                <hr />\n                <section details class=\"space-y-2\">\n                    <h2 class=\"text-xl font-medium\" i18n>Details</h2>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>people</app-icon>\n                        <p i18n>{{ space.capacity }} People</p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>meeting_room</app-icon>\n                        <p>\n                            {{ level?.display_name || level?.name }}\n                        </p>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <app-icon>place</app-icon>\n                        <p>\n                            {{\n                                building?.address ||\n                                    building?.display_name ||\n                                    building?.name\n                            }}\n                        </p>\n                    </div>\n                </section>\n                <hr />\n                <section\n                    facilities\n                    class=\"space-y-2\"\n                    *ngIf=\"space.features?.length\"\n                >\n                    <h2 class=\"text-xl font-medium\" i18n>Room Facilities</h2>\n                    <div\n                        class=\"flex items-center space-x-2\"\n                        *ngFor=\"let feature of space.features\"\n                    >\n                        <!-- <app-icon>people</app-icon> -->\n                        <p i18n>{{ feature }}</p>\n                    </div>\n                </section>\n                <section\n                    map\n                    class=\"w-full mx-auto h-64 sm:h-48 relative border border-gray-200 overflow-hidden rounded\"\n                    *ngIf=\"!hide_map\"\n                >\n                    <interactive-map\n                        class=\"pointer-events-none\"\n                        [src]=\"map_url\"\n                        [features]=\"features\"\n                        [options]=\"{ disable_pan: true, disable_zoom: true }\"\n                    ></interactive-map>\n                </section>\n            </div>\n            <div\n                class=\"px-2 pt-2 pb-[5.5rem] border-t border-gray-200 shadow sm:hidden\"\n            >\n                <button\n                    btn\n                    matRipple\n                    name=\"toggle-space-details\"\n                    [class.inverse]=\"active\"\n                    class=\"w-full\"\n                    (click)=\"active = !active; activeChange.emit(active)\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <app-icon class=\"text-2xl\">{{\n                            active ? 'remove' : 'add'\n                        }}</app-icon>\n                        <p>\n                            {{ active ? 'Remove this room' : 'Add this room' }}\n                        </p>\n                    </div>\n                </button>\n            </div>\n        </ng-container>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\" i18n>\n                    Select a room to view it's details\n                </p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n                display: flex;\n                flex-direction: column;\n                width: 30%;\n                min-width: 20rem;\n                height: 100%;\n                min-height: 65vh;\n            }\n        `,\n    ],\n})\nexport class SpaceDetailsComponent {\n    @Input() public space?: Space;\n    @Input() public fav: boolean = false;\n    @Input() public active: boolean = false;\n    @Input() public hide_map: boolean = false;\n\n    @Output() public activeChange = new EventEmitter<boolean>();\n    @Output() public close = new EventEmitter<void>();\n    @Output() public toggleFav = new EventEmitter<void>();\n\n    public map_url = '';\n    public features: ViewerFeature[] = [];\n\n    public get level() {\n        return this._org.levelWithID(this.space?.zones) || this.space?.level;\n    }\n\n    public get building() {\n        return this._org.buildings.find((_) =>\n            this.space?.zones.includes(_.id)\n        );\n    }\n\n    constructor(private _org: OrganisationService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.space && this.space) {\n            this._updateFeature();\n        }\n    }\n\n    private _updateFeature() {\n        this.map_url = this.level?.map_id;\n        this.features = [\n            {\n                location: this.space?.map_id,\n                content: MapPinComponent,\n            },\n        ];\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\n\n@Component({\n    selector: 'attendee-list',\n    template: `\n        <div\n            class=\"w-full h-full overflow-hidden flex flex-col bg-white dark:bg-neutral-700\"\n        >\n            <div\n                class=\"flex items-center border-b border-gray-200 dark:border-neutral-500 p-2\"\n            >\n                <button close icon matRipple (click)=\"close.emit()\">\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <div class=\"flex-1 text-center pr-12 font-medium\" i18n>\n                    {{ list.length }} { list.length, plural, =1 { Attendee }\n                    other { Attendees } }\n                </div>\n            </div>\n            <div class=\"flex-1 w-full overflow-auto\">\n                <div\n                    attendee\n                    class=\"flex items-center p-2 space-x-2\"\n                    *ngFor=\"let user of list\"\n                >\n                    <a-user-avatar [user]=\"user\"></a-user-avatar>\n                    <div class=\"\">\n                        <div>{{ user.name }}</div>\n                        <div class=\"opacity-60\">\n                            <span *ngIf=\"host === user.email\" i18n>Host</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class AttendeeListComponent {\n    @Input() public host: string = '';\n    @Input() public list: any[] = [];\n    @Output() public close = new EventEmitter();\n}\n","import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MatDialog, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { addMinutes, format, formatDuration, getUnixTime } from 'date-fns';\n\nimport { CalendarEvent } from './event.class';\nimport { MapPinComponent } from 'libs/components/src/lib/map-pin.component';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { SpacePipe } from 'libs/spaces/src/lib/space.pipe';\nimport { Building } from 'libs/organisation/src/lib/building.class';\nimport { BuildingLevel } from 'libs/organisation/src/lib/level.class';\nimport { notifyError, SettingsService } from '@placeos/common';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { getModule } from '@placeos/ts-client';\nimport { MapLocateModalComponent } from 'libs/components/src/lib/map-locate-modal.component';\n\n@Component({\n    selector: 'event-details-modal',\n    template: `\n        <div\n            class=\"w-[100vw] h-[100vh] sm:relative sm:inset-auto sm:w-[51rem] sm:h-auto sm:max-h-[80vh] bg-white sm:bg-gray-100 sm:dark:bg-neutral-600 dark:bg-neutral-700 sm:rounded overflow-auto space-y-2 pb-2\"\n        >\n            <div\n                class=\"sm:flex flex-col items-center pb-4 max-h-screen sm:max-h-[80vh] sm:px-16 sm:border-b bg-white dark:bg-neutral-700 border-gray-300 dark:border-neutral-500\"\n            >\n                <i\n                    binding\n                    [(model)]=\"room_status\"\n                    [sys]=\"event.system?.id\"\n                    mod=\"Bookings\"\n                    bind=\"status\"\n                ></i>\n                <div\n                    class=\"h-8 w-full sm:hidden block\"\n                    *ngIf=\"!event?.system?.images?.length\"\n                ></div>\n                <div\n                    class=\"bg-black/20 dark:bg-white/20 w-full h-64 sm:rounded-b overflow-hidden\"\n                    *ngIf=\"event?.system?.images?.length\"\n                >\n                    <image-carousel\n                        [images]=\"event?.system?.images\"\n                        class=\"w-full h-64\"\n                    ></image-carousel>\n                </div>\n                <h3\n                    title\n                    class=\"px-3 mt-2 text-xl font-medium w-full\"\n                    [class.pt-4]=\"!event?.system?.images?.length\"\n                >\n                    {{ event.title }}\n                </h3>\n                <div class=\"sm:flex items-center justify-between w-full\">\n                    <div class=\"flex m-2\">\n                        <div\n                            class=\"flex items-center bg-opacity-30 rounded-2xl p-1 text-sm space-x-2 pr-2 font-medium\"\n                            [class.bg-green-600]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'approved'\n                            \"\n                            [class.bg-yellow-500]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'tentative'\n                            \"\n                            [class.bg-red-600]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'declined'\n                            \"\n                            [class.bg-gray-300]=\"event.state === 'done'\"\n                        >\n                            <div\n                                class=\"rounded-full h-5 w-5 flex items-center justify-center text-white\"\n                                [class.bg-success]=\"\n                                    event.state !== 'done' &&\n                                    event?.status === 'approved'\n                                \"\n                                [class.text-pending]=\"\n                                    event.state !== 'done' &&\n                                    event?.status === 'tentative'\n                                \"\n                                [class.bg-error]=\"\n                                    event.state !== 'done' &&\n                                    event?.status === 'declined'\n                                \"\n                                [class.text-neutral-600]=\"\n                                    event.state === 'done'\n                                \"\n                            >\n                                <app-icon>\n                                    {{\n                                        event.state === 'done'\n                                            ? 'not_interested'\n                                            : event?.status === 'approved'\n                                            ? 'done'\n                                            : event?.status === 'tentative'\n                                            ? 'warning'\n                                            : 'close'\n                                    }}\n                                </app-icon>\n                            </div>\n                            <div class=\"pr-1\">{{ period }}</div>\n                        </div>\n                    </div>\n                    <div\n                        actions\n                        class=\"flex items-center space-x-2 px-2\"\n                        *ngIf=\"event.state !== 'done'\"\n                    >\n                        <button\n                            btn\n                            matRipple\n                            class=\"flex-1 h-10\"\n                            *ngIf=\"\n                                room_status &&\n                                event?.can_check_in &&\n                                room_status !== 'free'\n                            \"\n                            [class.bg-green-600]=\"room_status !== 'pending'\"\n                            [class.border-none]=\"room_status !== 'pending'\"\n                            [class.pointer-events-none]=\"\n                                room_status !== 'pending'\n                            \"\n                            (click)=\"checkin()\"\n                        >\n                            <div\n                                class=\"flex items-center space-x-2 justify-center\"\n                            >\n                                <app-icon>{{\n                                    room_status === 'pending'\n                                        ? 'arrow_back'\n                                        : 'done'\n                                }}</app-icon>\n                                <div class=\"mr-4\" i18n>\n                                    {{\n                                        room_status === 'pending'\n                                            ? 'Check in'\n                                            : 'Checked in'\n                                    }}\n                                </div>\n                            </div>\n                        </button>\n                        <button\n                            icon\n                            matRipple\n                            [matMenuTriggerFor]=\"menu\"\n                            class=\"bg-primary rounded text-white h-10 w-10\"\n                            *ngIf=\"allow_edit\"\n                        >\n                            <app-icon>more_horiz</app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class=\"sm:flex flex-wrap sm:px-12\">\n                <div\n                    class=\"sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[3] min-w-1/3 sm:w-[16rem] space-y-2\"\n                >\n                    <h3 class=\"px-3 mt-2 text-lg font-medium mb-2\" i18n>\n                        Details\n                    </h3>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>event</app-icon>\n                        <div>{{ event.date | date: 'EEEE, dd LLLL y' }}</div>\n                    </div>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>schedule</app-icon>\n                        <div>{{ period }}</div>\n                    </div>\n                    <div class=\"flex items-center px-2 space-x-2\">\n                        <app-icon>map</app-icon>\n                        <div>\n                            <ng-container *ngIf=\"level\">\n                                {{ level?.display_name || level?.name }},\n                            </ng-container>\n                            {{\n                                event?.location ||\n                                    event?.system?.display_name ||\n                                    event?.system?.name\n                            }}\n                        </div>\n                    </div>\n                    <div\n                        class=\"flex items-center px-2 space-x-2\"\n                        *ngIf=\"building\"\n                    >\n                        <app-icon>place</app-icon>\n                        <div>\n                            {{ building?.display_name || building?.name }},\n                            {{ building?.address }}\n                        </div>\n                    </div>\n                </div>\n                <div\n                    class=\"mt-4 sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[3] min-w-1/3 sm:w-[16rem]\"\n                >\n                    <div\n                        class=\"mx-3 border-t border-gray-300 sm:border-none dark:border-neutral-500 flex items-center justify-between\"\n                    >\n                        <h3 class=\"text-lg font-medium\" i18n>Attendees</h3>\n                        <button\n                            matRipple\n                            show-attendees\n                            class=\"clear text-xs underline\"\n                            (click)=\"show_attendees = true\"\n                            i18n\n                        >\n                            See All\n                        </button>\n                    </div>\n                    <div class=\"flex items-center p-1\">\n                        <div\n                            class=\"flex flex-col flex-1 items-center justify-center space-y-1\"\n                        >\n                            <div class=\"text-lg\">{{ accept_count || 0 }}</div>\n                            <div class=\"text-sm uppercase\" i18n>Yes</div>\n                        </div>\n                        <div\n                            class=\"flex flex-col flex-1 items-center justify-center space-y-1\"\n                        >\n                            <div class=\"text-lg\">{{ declined_count || 0 }}</div>\n                            <div class=\"text-sm uppercase\" i18n>No</div>\n                        </div>\n                        <div\n                            class=\"flex flex-col flex-1 items-center justify-center space-y-1\"\n                        >\n                            <div class=\"text-lg\">{{ pending_count || 0 }}</div>\n                            <div class=\"text-sm uppercase\" i18n>Pending</div>\n                        </div>\n                    </div>\n                    <h3\n                        class=\"mx-3 mt-2 pt-2 text-lg font-medium border-t border-gray-300 dark:border-neutral-500\"\n                        i18n\n                    >\n                        Host\n                    </h3>\n                    <div class=\"px-2 flex items-center space-x-2\" host>\n                        <a-user-avatar [user]=\"event.organiser\"></a-user-avatar>\n                        <div class=\"text-sm\">\n                            <div>{{ event.organiser?.name }}</div>\n                            <div class=\"opacity-60\">{{ event.host }}</div>\n                        </div>\n                    </div>\n                </div>\n                <ng-container *ngIf=\"has_catering\">\n                    <div\n                        class=\"mt-4 sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[3] min-w-1/3 sm:w-[16rem]\"\n                    >\n                        <h3\n                            class=\"mx-3 mt-2 pt-2 text-lg font-medium border-t border-gray-300 dark:border-neutral-500\"\n                            i18n\n                        >\n                            Catering\n                        </h3>\n                        <div class=\"flex flex-col px-4 space-y-2\">\n                            <div\n                                catering-item\n                                class=\"flex space-x-2\"\n                                *ngFor=\"\n                                    let item of event.ext('catering')[0].items\n                                \"\n                            >\n                                <div\n                                    count\n                                    class=\"flex items-center justify-center h-6 w-6 rounded-full bg-gray-200 text-sm font-medium\"\n                                >\n                                    {{ item.quantity }}\n                                </div>\n                                <div details class=\"pt-0.5\">\n                                    <div class=\"text-sm\">{{ item.name }}</div>\n                                    <div\n                                        class=\"text-xs opacity-40\"\n                                        *ngFor=\"let opt of item.options\"\n                                    >\n                                        {{ opt.name }}\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </ng-container>\n                <button\n                    map\n                    class=\"mt-4 sm:mt-2 h-64 sm:h-48 relative border border-gray-200 dark:border-neutral-500 overflow-hidden rounded sm:bg-white sm:dark:bg-neutral-700 m-2 flex-grow-[3] min-w-1/3 p-2 w-[calc(100%-1rem)] sm:w-[16rem]\"\n                    (click)=\"viewLocation()\"\n                >\n                    <interactive-map\n                        *ngIf=\"!hide_map\"\n                        class=\"pointer-events-none\"\n                        [src]=\"level?.map_id\"\n                        [features]=\"features\"\n                        [options]=\"{ disable_pan: true, disable_zoom: true }\"\n                    ></interactive-map>\n                </button>\n                <div\n                    class=\"mt-4 sm:p-4 sm:bg-white sm:dark:bg-neutral-700 rounded sm:m-2 sm:border border-gray-200 dark:border-neutral-500 flex-grow-[3] min-w-1/3 sm:w-[16rem]\"\n                    *ngIf=\"event.body\"\n                >\n                    <h3\n                        class=\"mx-3 text-lg font-medium border-t sm:border-none border-gray-300 dark:border-neutral-500\"\n                        i18n\n                    >\n                        Notes\n                    </h3>\n                    <div\n                        notes\n                        class=\"mx-4 overflow-hidden max-w-full\"\n                        *ngIf=\"event.body\"\n                        [innerHTML]=\"\n                            (event.body | sanitize) ||\n                            'Unable to sanitize notes contents'\n                        \"\n                    ></div>\n                </div>\n                <button\n                    icon\n                    matRipple\n                    mat-dialog-close\n                    class=\"absolute top-2 left-2 bg-black/30 text-white\"\n                >\n                    <app-icon>close</app-icon>\n                </button>\n                <div class=\"absolute inset-0 z-50\" *ngIf=\"show_attendees\">\n                    <attendee-list\n                        [list]=\"event.attendees\"\n                        [host]=\"event.host\"\n                        (click)=\"show_attendees = false\"\n                    ></attendee-list>\n                </div>\n            </div>\n            <mat-menu #menu=\"matMenu\" xPosition=\"before\">\n                <button\n                    mat-menu-item\n                    mat-dialog-close\n                    class=\"flex items-center space-x-2 text-base\"\n                    (click)=\"edit.emit(space)\"\n                >\n                    <app-icon>edit</app-icon>\n                    <div i18n>Edit event</div>\n                </button>\n                <button\n                    mat-menu-item\n                    class=\"flex items-center space-x-2 text-base\"\n                    (click)=\"remove.emit()\"\n                >\n                    <app-icon>delete</app-icon>\n                    <div i18n>Delete event</div>\n                </button>\n            </mat-menu>\n        </div>\n    `,\n    styles: [``],\n    providers: [SpacePipe],\n})\nexport class EventDetailsModalComponent {\n    @Output() public edit = new EventEmitter();\n    @Output() public remove = new EventEmitter();\n\n    public room_status = '';\n    public hide_map = false;\n    public show_attendees: boolean = false;\n    public readonly event = this._event;\n    public features = [\n        {\n            location: this.event?.system?.map_id,\n            content: MapPinComponent,\n        },\n    ];\n\n    public readonly has_catering = this.event?.ext('catering')?.length > 0;\n\n    public level: BuildingLevel = new BuildingLevel();\n    public building: Building = new Building();\n    public space: Space = new Space();\n\n    public accept_count = this._event.attendees.reduce(\n        (c, i) => (c += i.response_status === 'accepted' ? 1 : 0),\n        0\n    );\n    public declined_count = this._event.attendees.reduce(\n        (c, i) => (c += i.response_status === 'declined' ? 1 : 0),\n        0\n    );\n    public pending_count = this._event.attendees.reduce(\n        (c, i) =>\n            (c +=\n                i.response_status === 'tentative' ||\n                i.response_status === 'needsAction'\n                    ? 1\n                    : 0),\n        0\n    );\n\n    public get allow_edit() {\n        return !this._settings.get('app.events.booking_unavailable');\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _event: CalendarEvent,\n        private _org: OrganisationService,\n        private _space_pipe: SpacePipe,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {\n        this._load().then();\n    }\n\n    public get period() {\n        if (this.event?.all_day) return 'All Day';\n        const start = this.event?.date || Date.now();\n        const duration = this.event?.duration || 60;\n        const end = addMinutes(start, duration);\n        const dur = formatDuration({\n            hours: Math.floor(duration / 60),\n            minutes: duration % 60,\n        })\n            .replace(' hour', 'hr')\n            .replace(' minute', 'min');\n        return `${format(start, 'h:mm a')} - ${format(end, 'h:mm a')} (${dur})`;\n    }\n\n    public async checkin() {\n        const mod = getModule(this.space?.id, 'Bookings');\n        if (!mod) return;\n        await mod\n            .execute('checkin', [getUnixTime(this.event.date)])\n            .catch((e) => notifyError(`Error checking in booking. ${e}`));\n    }\n\n    private async _load() {\n        this.space = await this._space_pipe.transform(\n            this._event.system?.id || this._event.system?.email\n        );\n        this.level = this._org.levelWithID(this.space.zones);\n        this.building = this._org.buildings.find((bld) =>\n            this.space.zones.includes(bld.id)\n        );\n        this.features = [\n            {\n                location: this.space.map_id,\n                content: MapPinComponent,\n            },\n        ];\n    }\n\n    public viewLocation() {\n        this.hide_map = true;\n        const ref = this._dialog.open(MapLocateModalComponent, {\n            maxWidth: '95vw',\n            maxHeight: '95vh',\n            data: { item: this.space },\n        });\n        ref.afterClosed().subscribe(() => (this.hide_map = false));\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { addMinutes, format, formatDuration, isSameDay } from 'date-fns';\nimport { AsyncHandler } from '@placeos/common';\n\nimport { CalendarEvent } from './event.class';\nimport { EventDetailsModalComponent } from './event-details-modal.component';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\n\n@Component({\n    selector: 'event-card',\n    template: `\n        <h4 class=\"mb-2 flex items-center\" *ngIf=\"event\" date>\n            <span *ngIf=\"show_day\" day>{{ day }}, </span>\n            {{ event?.date | date: 'h:mm a' }}\n            <span class=\"text-xs px-2\">({{ event?.date | date: 'z' }})</span>\n        </h4>\n        <a\n            name=\"view-event-details\"\n            class=\"w-full cursor-pointer relative\"\n            [routerLink]=\"['./']\"\n            [queryParams]=\"{ event: event?.id }\"\n            (click)=\"viewDetails()\"\n            *ngIf=\"event\"\n        >\n            <div\n                class=\"w-full bg-white dark:bg-[#1F2021] rounded-xl shadow py-4 relative\"\n            >\n                <h4 class=\"px-4 text-lg\">{{ event?.title }}</h4>\n                <div class=\"flex mx-4 my-2\">\n                    <div\n                        class=\"flex items-center bg-opacity-30 rounded-2xl p-1 text-base space-x-2 pr-2 font-medium\"\n                        [class.bg-green-600]=\"\n                            event.state !== 'done' &&\n                            event?.status === 'approved'\n                        \"\n                        [class.bg-yellow-500]=\"\n                            event.state !== 'done' &&\n                            event?.status === 'tentative'\n                        \"\n                        [class.bg-red-600]=\"\n                            event.state !== 'done' &&\n                            event?.status === 'declined'\n                        \"\n                        [class.bg-gray-300]=\"event.state === 'done'\"\n                    >\n                        <div\n                            class=\"rounded-full h-5 w-5 flex items-center justify-center text-white\"\n                            [class.bg-success]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'approved'\n                            \"\n                            [class.text-pending]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'tentative'\n                            \"\n                            [class.bg-error]=\"\n                                event.state !== 'done' &&\n                                event?.status === 'declined'\n                            \"\n                            [class.text-neutral-600]=\"event.state === 'done'\"\n                        >\n                            <app-icon>\n                                {{\n                                    event.state === 'done'\n                                        ? 'not_interested'\n                                        : event?.status === 'approved'\n                                        ? 'done'\n                                        : event?.status === 'tentative'\n                                        ? 'warning'\n                                        : 'close'\n                                }}\n                            </app-icon>\n                        </div>\n                        <div class=\"pr-1\">{{ period }}</div>\n                    </div>\n                </div>\n                <div\n                    class=\"flex flex-wrap flex-col sm:flex-row sm:divide-x divide-neutral-500 py-2 space-y-2 sm:space-y-0\"\n                >\n                    <div class=\"flex items-center px-4\">\n                        <app-icon>meeting_room</app-icon>\n                        <div class=\"mx-2 truncate\">\n                            {{ location }}\n                        </div>\n                    </div>\n                    <div class=\"flex items-center px-4\">\n                        <app-icon>person_outline</app-icon>\n                        <div class=\"mx-2\">\n                            {{\n                                event?.organiser?.name ||\n                                    event?.organiser?.email\n                            }}\n                        </div>\n                    </div>\n                    <div\n                        class=\"flex items-center px-4\"\n                        *ngIf=\"event?.ext('catering')?.length\"\n                    >\n                        <app-icon>restaurant</app-icon>\n                        <div class=\"mx-2\">Catered</div>\n                    </div>\n                    <div class=\"flex items-center px-4\">\n                        <app-icon>people</app-icon>\n                        <div class=\"mx-2\">\n                            {{ event?.attendees?.length }}\n                            {{\n                                event?.attendees?.length === 1\n                                    ? 'Person'\n                                    : 'People'\n                            }}\n                        </div>\n                    </div>\n                </div>\n                <app-icon\n                    class=\"absolute top-1/2 right-1 text-4xl -translate-y-1/2\"\n                >\n                    chevron_right\n                </app-icon>\n                <div\n                    class=\"absolute bottom-2 right-2 sm:bottom-auto sm:top-2 text-sm sm:text-base flex items-center pr-4\"\n                    *ngIf=\"event?.attendees?.length\"\n                >\n                    <div\n                        class=\"h-10 w-6\"\n                        *ngFor=\"\n                            let user of event?.attendees\n                                | slice\n                                    : 0\n                                    : (event?.attendees?.length === 6 ? 6 : 5)\n                        \"\n                    >\n                        <a-user-avatar [user]=\"user\"></a-user-avatar>\n                    </div>\n                    <div class=\"h-10 w-6\" *ngIf=\"event?.attendees?.length > 6\">\n                        <div\n                            class=\"bg-secondary rounded-full h-10 w-10 border-2 border-white flex items-center justify-center text-white\"\n                        >\n                            +{{ event?.attendees?.length - 5 }}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </a>\n    `,\n    styles: [\n        `\n            :host {\n                display: block;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class EventCardComponent extends AsyncHandler {\n    @Input() public event: CalendarEvent;\n    @Input() public show_day: boolean = false;\n    @Output() public edit = new EventEmitter();\n    @Output() public remove = new EventEmitter();\n\n    constructor(\n        private _dialog: MatDialog,\n        private _route: ActivatedRoute,\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) =>\n                params.has('event') && this.event?.id === params.get('event')\n                    ? this.viewDetails()\n                    : ''\n            )\n        );\n    }\n\n    public get day() {\n        const date = this.event?.date || Date.now();\n        const is_today = isSameDay(Date.now(), date);\n        return `${is_today ? 'Today' : format(date, 'EEEE')}`;\n    }\n\n    public get location() {\n        const zone_list: string[] =\n            this.event?.space?.zones ||\n            (this.event?.system?.zones as any) ||\n            [];\n        const zone =\n            this._org.levelWithID(zone_list) ||\n            this._org.buildings.find((_) => zone_list.includes(_.id));\n        return `${zone ? (zone.display_name || zone.name) + ', ' : ''} ${\n            this.event.space?.display_name || this.event.space?.name\n        }`;\n    }\n\n    public get period() {\n        if (this.event?.all_day) return 'All Day';\n        const start = this.event?.date || Date.now();\n        const duration = this.event?.duration || 60;\n        const end = addMinutes(start, duration);\n        const dur = formatDuration({\n            hours: Math.floor(duration / 60),\n            minutes: duration % 60,\n        })\n            .replace(' hour', 'hr')\n            .replace(' minute', 'min');\n        return `${format(start, 'h:mm a')} - ${format(end, 'h:mm a')} (${dur})`;\n    }\n\n    public viewDetails() {\n        if (!this.event) return;\n        this.timeout('open', () => {\n            const ref = this._dialog.open(EventDetailsModalComponent, {\n                data: this.event,\n            });\n            this.subscription(\n                'edit',\n                ref.componentInstance.edit.subscribe(() => this.edit.emit())\n            );\n            this.subscription(\n                'remove',\n                ref.componentInstance.remove.subscribe(() => this.remove.emit())\n            );\n        });\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatRadioModule } from '@angular/material/radio';\n\nimport { FormFieldsModule } from 'libs/form-fields/src/lib/form-fields.module';\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\n\nimport { AttendeeListComponent } from './attendee-list.component';\nimport { EventCardComponent } from './event-card.component';\nimport { EventDetailsModalComponent } from './event-details-modal.component';\nimport { EventLinkModalComponent } from './event-link-modal.component';\nimport { MatRippleModule } from '@angular/material/core';\n\nconst COMPONENTS = [\n    EventDetailsModalComponent,\n    AttendeeListComponent,\n    EventCardComponent,\n    EventLinkModalComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatRadioModule,\n        MatInputModule,\n        MatFormFieldModule,\n        MatDatepickerModule,\n        MatButtonModule,\n        MatDialogModule,\n        MatProgressSpinnerModule,\n        FormFieldsModule,\n        ComponentsModule,\n        MatRippleModule,\n    ],\n    providers: [ReactiveFormsModule],\n    exports: [...COMPONENTS],\n})\nexport class SharedEventsModule {}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { EventFormService } from '@placeos/events';\nimport { OrganisationService } from '@placeos/organisation';\nimport { differenceInDays } from 'date-fns';\nimport { Space } from '../space.class';\n\n@Component({\n    selector: `space-list`,\n    template: `\n        <h3 class=\"font-bold\">Results</h3>\n        <p count class=\"text-sm opacity-60 mb-4\" i18n>\n            {{ (available_spaces | async)?.length || 0 }} result(s) found\n        </p>\n        <ng-container *ngIf=\"!(loading | async); else load_state\">\n            <ul\n                class=\"list-style-none space-y-2\"\n                *ngIf=\"(available_spaces | async)?.length; else empty_state\"\n            >\n                <li\n                    space\n                    *ngFor=\"let space of available_spaces | async\"\n                    [class.!border-blue-400]=\"active === space.id\"\n                    class=\"relative p-2 rounded-lg w-full shadow border bg-white dark:bg-neutral-700 border-gray-200 dark:border-neutral-500\"\n                >\n                    <button\n                        matRipple\n                        name=\"select-space\"\n                        class=\"w-full h-full flex items-center\"\n                        (click)=\"selectSpace(space)\"\n                    >\n                        <div\n                            class=\"relative min-w-[5rem] w-20 h-20 rounded-xl bg-black/20 dark:bg-white/30 mr-4 overflow-hidden flex items-center justify-center\"\n                        >\n                            <div\n                                class=\"absolute top-1 left-1 border border-white bg-black/50 rounded-full h-6 w-6 flex items-center justify-center text-white\"\n                                *ngIf=\"selected.includes(space.id)\"\n                            >\n                                <app-icon>done</app-icon>\n                            </div>\n                            <img\n                                *ngIf=\"\n                                    space.images?.length;\n                                    else space_placeholder\n                                \"\n                                class=\"object-cover h-full\"\n                                [src]=\"space.images[0]\"\n                            />\n                            <ng-template #space_placeholder>\n                                <img\n                                    class=\"m-auto\"\n                                    src=\"assets/icons/room-placeholder.svg\"\n                                />\n                            </ng-template>\n                        </div>\n                        <div class=\"space-y-2\">\n                            <div class=\"font-medium truncate mr-10\">\n                                {{\n                                    space.display_name ||\n                                        space.name ||\n                                        'Meeting Space'\n                                }}\n                            </div>\n                            <div class=\"flex items-center text-sm space-x-2\">\n                                <app-icon class=\"text-blue-500\">place</app-icon>\n                                <p class=\"truncate\">\n                                    {{\n                                        space.location ||\n                                            level(space.zones)?.display_name ||\n                                            level(space.zones)?.name\n                                    }}\n                                </p>\n                            </div>\n                            <div class=\"flex items-center text-sm space-x-2\">\n                                <app-icon class=\"text-blue-500\"\n                                    >people</app-icon\n                                >\n                                <p i18n>\n                                    {{\n                                        space.capacity < 1 ? 2 : space.capacity\n                                    }}\n                                    People\n                                </p>\n                            </div>\n                        </div>\n                    </button>\n                    <button\n                        icon\n                        matRipple\n                        name=\"toggle-space-favourite\"\n                        class=\"absolute top-1 right-1\"\n                        [class.text-blue-400]=\"isFavourite(space.id)\"\n                        (click)=\"toggleFav.emit(space)\"\n                    >\n                        <app-icon>{{\n                            isFavourite(space.id)\n                                ? 'favorite'\n                                : 'favorite_border'\n                        }}</app-icon>\n                    </button>\n                </li>\n            </ul>\n        </ng-container>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\" i18n>\n                    No available spaces for selected time and/or filters\n                </p>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"opacity-30\" i18n>Finding available spaces...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n                height: 100%;\n                padding: 0.5rem;\n                overflow: auto;\n            }\n        `,\n    ],\n})\nexport class SpaceListComponent {\n    @Input() public active: string = '';\n    @Input() public selected: string = '';\n    @Input() public favorites: string[] = [];\n    @Output() public onSelect = new EventEmitter<Space>();\n    @Output() public toggleFav = new EventEmitter<Space>();\n    public readonly loading = this._event_form.loading;\n\n    public readonly available_spaces = this._event_form.available_spaces;\n\n    constructor(\n        private _event_form: EventFormService,\n        private _org: OrganisationService\n    ) {}\n\n    public level(zones: string[]) {\n        return this._org.levelWithID(zones);\n    }\n\n    public ngOnInit() {\n        this._event_form.setView('find');\n    }\n\n    public isFavourite(space_id: string) {\n        return this.favorites.includes(space_id);\n    }\n\n    public selectSpace(space: Space) {\n        this.onSelect.emit(space);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { querySystems, showSystem } from '@placeos/ts-client';\nimport { first, map } from 'rxjs/operators';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { Space } from './space.class';\nimport { flatten, SettingsService, unique } from '@placeos/common';\nimport { SpacePipe } from './space.pipe';\n\nlet SPACE_PIPE: SpacePipe;\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SpacesService {\n    /** Subject to store list of spaces */\n    private _list = new BehaviorSubject<Space[]>([]);\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    /** Observable for list of spaces */\n    public readonly list = this._list.asObservable();\n    /** List of available features */\n    public readonly features = this.list.pipe(map(_ => unique(flatten(_.map(i => i.features)))));\n    /** Default predicate for filter method */\n    protected _compare = (space: Space) =>\n        space.zones.includes(this._org.building.id);\n\n    /** List of available spaces */\n    public get space_list(): Space[] {\n        return this._list.getValue();\n    }\n\n    constructor(private _org: OrganisationService, private _settings: SettingsService) {\n        SPACE_PIPE = new SpacePipe(_org);\n        this._init();\n    }\n\n    private async _init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        if (!this._settings.get('app.prevent_space_init')) this.loadSpaces();\n        else this._initialised.next(true);\n    }\n\n    /**\n     * Get a filtered list of the available spaces\n     * @param predicate Predicate for filtering spaces\n     */\n    public filter(predicate: (_: Space) => boolean = this._compare) {\n        return this._list.getValue().filter((_) => predicate(_));\n    }\n\n    public async loadSpace(space_id: string) {\n        const system = await showSystem(space_id).toPromise();\n        const space = new Space({\n            ...system as any,\n            level: this._org.levelWithID([...system.zones]),\n        })\n        SPACE_PIPE.updateSpaceList([space]);\n    }\n\n    /**\n     * Find space with given id/email\n     * @param space_id ID/Email address associated with the space\n     */\n    public find(space_id: string) {\n        return this._list.getValue().find(({ id }) => space_id === id);\n    }\n\n    private async loadSpaces(): Promise<void> {\n        const systems = await querySystems({\n            zone_id: this._org.organisation.id,\n            limit: 5000,\n        })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        const space_list = systems.map(\n            (sys) =>\n                new Space({\n                    ...(sys as any),\n                    level: this._org.levelWithID([...sys.zones]),\n                })\n        );\n        // Remove spaces without a map ID\n        const valid_spaces = space_list.filter((space) => space.map_id);\n        this._list.next(valid_spaces);\n        SPACE_PIPE.updateSpaceList(valid_spaces);\n        this._initialised.next(true);\n    }\n}\n","import { Component, Optional } from '@angular/core';\nimport { MatBottomSheetRef } from '@angular/material/bottom-sheet';\nimport { flatten, SettingsService, unique } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { Building, OrganisationService } from '@placeos/organisation';\nimport { addDays, endOfDay } from 'date-fns';\nimport { combineLatest } from 'rxjs';\nimport { map, take } from 'rxjs/operators';\nimport { SpacesService } from '../spaces.service';\n\n@Component({\n    selector: `space-filters`,\n    template: `\n        <div class=\"flex items-center border-b border-gray-200 pb-2 sm:hidden\">\n            <div class=\"flex-1 pl-2\">\n                <button\n                    icon\n                    matRipple\n                    name=\"close-space-filters\"\n                    *ngIf=\"can_close\"\n                    (click)=\"close()\"\n                >\n                    <app-icon>keyboard_arrow_left</app-icon>\n                </button>\n            </div>\n            <h3 class=\"font-medium flex-2 text-center\" i18n>Space Filters</h3>\n            <div class=\"flex-1\"></div>\n        </div>\n        <form\n            class=\"max-h-[65vh] p-2 overflow-y-auto overflow-x-hidden divide-y divide-gray-200 w-full max-w-[100vw]\"\n            [formGroup]=\"form\"\n        >\n            <section details>\n                <h2 class=\"text-lg font-medium\" i18n>Details</h2>\n                <div class=\"flex-1 min-w-[256px] flex flex-col\">\n                    <label for=\"location\" i18n>Location</label>\n                    <mat-form-field\n                        appearance=\"outline\"\n                        class=\"w-full\"\n                        *ngIf=\"(buildings | async)?.length > 1\"\n                    >\n                        <mat-select\n                            name=\"building\"\n                            [ngModel]=\"building | async\"\n                            (ngModelChange)=\"setBuilding($event)\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                            [placeholder]=\"\n                                (building | async)?.display_name ||\n                                (building | async)?.name\n                            \"\n                        >\n                            <mat-option\n                                *ngFor=\"let bld of buildings | async\"\n                                [value]=\"bld\"\n                            >\n                                {{ bld.display_name || bld.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            name=\"location\"\n                            [ngModel]=\"(options | async)?.zone_ids\"\n                            (ngModelChange)=\"setOptions({ zone_ids: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                            placeholder=\"Any Level\"\n                            i18n-placeholder\n                            [multiple]=\"true\"\n                        >\n                            <mat-option\n                                *ngFor=\"let lvl of levels | async\"\n                                [value]=\"lvl.id\"\n                            >\n                                {{ lvl.display_name || lvl.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex-1 min-w-[256px]\">\n                    <label for=\"date\" i18n>Date<span>*</span></label>\n                    <a-date-field\n                        name=\"date\"\n                        formControlName=\"date\"\n                        i18n\n                        [to]=\"end_date\"\n                    >\n                        {{ 'FORM.DATE_ERROR' | translate }}\n                    </a-date-field>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <div class=\"flex-1 w-1/3\">\n                        <label for=\"start-time\" i18n\n                            >Start Time<span>*</span></label\n                        >\n                        <a-time-field\n                            name=\"start-time\"\n                            [ngModel]=\"form.value.date\"\n                            (ngModelChange)=\"form.patchValue({ date: $event })\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        ></a-time-field>\n                    </div>\n                    <div class=\"flex-1 w-1/3\">\n                        <label for=\"end-time\" i18n\n                            >End Time<span>*</span></label\n                        >\n                        <a-duration-field\n                            name=\"end-time\"\n                            formControlName=\"duration\"\n                            [time]=\"form?.value?.date\"\n                            [max]=\"max_duration\"\n                        >\n                        </a-duration-field>\n                    </div>\n                </div>\n            </section>\n            <section favs class=\"space-y-2 pb-4\">\n                <h2 class=\"text-lg font-medium\" i18n>\n                    {{ 'COMMON.FAVOURITES' | translate }}\n                </h2>\n                <div class=\"flex items-center\">\n                    <div for=\"fav\" class=\"flex-1 w-1/2\" i18n>\n                        {{ 'ROOMS.SHOW_FAVOURITES' | translate }}\n                    </div>\n                    <mat-checkbox\n                        name=\"fav\"\n                        [ngModel]=\"(options | async)?.show_fav\"\n                        (ngModelChange)=\"setOptions({ show_fav: $event })\"\n                        [ngModelOptions]=\"{ standalone: true }\"\n                    >\n                    </mat-checkbox>\n                </div>\n            </section>\n            <section\n                features\n                class=\"space-y-2\"\n                *ngIf=\"(features | async)?.length\"\n            >\n                <h2 class=\"text-lg font-medium\" i18n>Facilities</h2>\n                <ng-container *ngFor=\"let feat of features | async\">\n                    <div\n                        class=\"flex items-center\"\n                        *ngIf=\"!hide_features.includes(feat)\"\n                    >\n                        <div for=\"feat\" class=\"flex-1 w-1/2\">\n                            {{ feature_display[feat] || feat }}\n                        </div>\n                        <mat-checkbox\n                            name=\"feat\"\n                            [ngModel]=\"\n                                (options | async)?.features?.includes(feat)\n                            \"\n                            (ngModelChange)=\"toggleFeature(feat, $event)\"\n                            [ngModelOptions]=\"{ standalone: true }\"\n                        ></mat-checkbox>\n                    </div>\n                </ng-container>\n            </section>\n        </form>\n        <div\n            class=\"px-2 pt-2 w-full border-t border-gray-200\"\n            *ngIf=\"can_close\"\n        >\n            <button\n                btn\n                matRipple\n                class=\"w-full\"\n                name=\"apply-space-filters\"\n                (click)=\"close()\"\n                i18n\n            >\n                Apply Filters\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 100%;\n                max-width: 100vw;\n            }\n        `,\n    ],\n})\nexport class SpaceFiltersComponent {\n    public can_close = false;\n    public readonly options = this._event_form.options;\n\n    public readonly building = this._org.active_building;\n    public readonly buildings = this._org.active_buildings;\n    public readonly levels = this._org.active_levels;\n    public readonly features = combineLatest([\n        this._spaces.features,\n        this._event_form.available_spaces,\n    ]).pipe(\n        map(([features, spaces]) =>\n            unique(features.concat(flatten(spaces.map((_) => _.features))))\n        )\n    );\n\n    public readonly close = () => this._bsheet_ref.dismiss();\n    public readonly setOptions = (o) => this._event_form.setOptions(o);\n\n    public get bld() {\n        return this._org.building;\n    }\n\n    public get form() {\n        return this._event_form.form;\n    }\n\n    public get max_duration() {\n        return this._settings.get('app.events.max_duration') || 480;\n    }\n\n    public get feature_display() {\n        return this._settings.get('app.events.feature_decriptions') || {};\n    }\n\n    public get hide_features() {\n        return this._settings.get('app.events.hide_features') || [];\n    }\n\n    public get end_date() {\n        return endOfDay(\n            addDays(\n                Date.now(),\n                this._settings.get('app.events.allowed_future_days') || 180\n            )\n        );\n    }\n\n    constructor(\n        @Optional()\n        private _bsheet_ref: MatBottomSheetRef<SpaceFiltersComponent>,\n        private _settings: SettingsService,\n        private _event_form: EventFormService,\n        private _org: OrganisationService,\n        private _spaces: SpacesService\n    ) {\n        this.can_close = !!this._bsheet_ref;\n    }\n\n    public setBuilding(bld: Building) {\n        this._org.building = bld;\n    }\n\n    public async toggleFeature(feat: string, state: boolean) {\n        const { features } = await this.options.pipe(take(1)).toPromise();\n        const new_list = (features || []).filter((_) => feat !== _);\n        if (state) new_list.push(feat);\n        this.setOptions({ features: new_list });\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { MatBottomSheet } from '@angular/material/bottom-sheet';\nimport { AsyncHandler } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { OrganisationService } from '@placeos/organisation';\nimport { take } from 'rxjs/operators';\nimport { SpaceFiltersComponent } from './space-filters.component';\n\n@Component({\n    selector: `space-filters-display`,\n    template: `\n        <section actions class=\"sm:hidden space-x-2 flex items-center p-2\">\n            <button\n                btn\n                matRipple\n                name=\"edit-space-filters\"\n                class=\"flex-1 w-1/2\"\n                (click)=\"editFilters()\"\n                i18n\n            >\n                Filters\n            </button>\n            <div class=\"flex items-center\">\n                <button\n                    btn\n                    matRipple\n                    name=\"view-space-map\"\n                    class=\"rounded-l rounded-r-none\"\n                    [class.inverse]=\"view !== 'map'\"\n                    (click)=\"view = 'map'; viewChange.emit(view)\"\n                    i18n\n                >\n                    Map\n                </button>\n                <button\n                    btn\n                    matRipple\n                    name=\"view-space-list\"\n                    class=\"rounded-r rounded-l-none\"\n                    [class.inverse]=\"view !== 'list'\"\n                    (click)=\"view = 'list'; viewChange.emit(view)\"\n                    i18n\n                >\n                    List\n                </button>\n            </div>\n        </section>\n        <section\n            filters\n            class=\"flex items-center flex-wrap p-2 sm:max-w-[50vw]\"\n        >\n            <button\n                btn\n                matRipple\n                name=\"clear-space-filters\"\n                class=\"min-h-[2rem] mb-2 mr-2\"\n                *ngIf=\"(options | async)?.features?.length > 1\"\n                (click)=\"removeAllFeatures()\"\n            >\n                Clear Filters\n            </button>\n            <div\n                filter-item\n                zone\n                class=\"dark:border-neutral-500\"\n                *ngIf=\"location\"\n            >\n                {{ location }}\n            </div>\n            <div filter-item date class=\"dark:border-neutral-500\">\n                {{ start | date: 'mediumDate' }}\n            </div>\n            <div filter-item time class=\"dark:border-neutral-500\">\n                {{ start | date: 'shortTime' }} &mdash;\n                {{ end | date: 'shortTime' }}\n            </div>\n            <div filter-item count class=\"dark:border-neutral-500\" i18n>\n                Min. {{ (options | async)?.capacity || 2 }} People\n            </div>\n            <div filter-item *ngFor=\"let feat of (options | async)?.features\">\n                <p class=\"truncate\">{{ feat }}</p>\n                <button\n                    icon\n                    matRipple\n                    name=\"remove-space-filter\"\n                    class=\"-mr-4 dark:border-neutral-500\"\n                    (click)=\"removeFeature(feat)\"\n                >\n                    <app-icon>close</app-icon>\n                </button>\n            </div>\n        </section>\n    `,\n    styles: [\n        `\n            [filter-item] {\n                display: flex;\n                align-items: center;\n                padding: 0 1rem;\n                min-height: 2rem;\n                font-size: 0.875rem;\n                border: 1px solid rgba(0, 0, 0, 0.2);\n                border-radius: 1.25rem;\n                margin-right: 0.5rem;\n                margin-bottom: 0.5rem;\n                max-width: 100%;\n                text-align: center;\n            }\n\n            [filter-item]:hover {\n                background: rgba(0, 0, 0, 0.1);\n            }\n\n            [filter-item] > * + * {\n                margin-left: 0.5rem;\n            }\n        `,\n    ],\n})\nexport class SpaceFiltersDisplayComponent extends AsyncHandler {\n    @Input() public view: 'map' | 'list' = 'list';\n    @Output() public viewChange = new EventEmitter<'map' | 'list'>();\n    public readonly options = this._event_form.options;\n    public location: string = '';\n\n    public get start() {\n        return this._event_form.form.value.date;\n    }\n\n    public get end() {\n        const { date, duration } = this._event_form.form.value;\n        return date + duration * 60 * 1000;\n    }\n\n    public readonly editFilters = () =>\n        this._bsheet.open(SpaceFiltersComponent);\n\n    constructor(\n        private _bsheet: MatBottomSheet,\n        private _event_form: EventFormService,\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'opts',\n            this.options.subscribe(({ zone_ids }) =>\n                this._updateLocation(zone_ids)\n            )\n        );\n    }\n\n    public async removeFeature(feat: string) {\n        const value = await this._event_form.options.pipe(take(1)).toPromise();\n        this._event_form.setOptions({\n            ...value,\n            features: (value.features || []).filter((_) => _ !== feat),\n        });\n    }\n\n    public async removeAllFeatures() {\n        const value = await this._event_form.options.pipe(take(1)).toPromise();\n        this._event_form.setOptions({\n            ...value,\n            features: [],\n        });\n    }\n\n    private _updateLocation(zone_ids: string[] = []) {\n        const level = this._org.levelWithID(zone_ids);\n        const item = level || this._org.building;\n        this.location = item?.display_name || item?.name || '';\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAP_FEATURE_DATA } from '@placeos/components';\n\n@Component({\n    selector: 'space-location-pin',\n    template: `\n        <div class=\"absolute bottom-0 left-1/2 -translate-x-1/2\">\n            <svg\n                width=\"66\"\n                height=\"80\"\n                viewBox=\"0 0 66 80\"\n                fill=\"none\"\n                xmlns=\"http://www.w3.org/2000/svg\"\n            >\n                <g filter=\"url(#filter0_d_1065_10313)\">\n                    <path\n                        d=\"M19.724 53.0408C25.0871 60.3435 30.5582 65.8583 31.0184 66.3178C31.4558 66.755 32.0489 67.0007 32.6674 67.0008H32.6678C33.2863 67.0007 33.8795 66.755 34.3169 66.3178C34.7771 65.8583 40.2481 60.3435 45.6112 53.0408C48.2928 49.3894 50.963 45.2701 52.9663 41.0957C54.9629 36.935 56.3331 32.6459 56.3342 28.6724C56.364 25.5564 55.7725 22.4657 54.5941 19.5809C53.415 16.6946 51.6722 14.0724 49.4675 11.8677C47.2629 9.66308 44.6407 7.92024 41.7544 6.74121C38.8711 5.5634 35.782 4.97184 32.6676 5.00103C29.5533 4.97184 26.4642 5.5634 23.5809 6.74121C20.6946 7.92024 18.0724 9.66308 15.8677 11.8677C13.6631 14.0724 11.9202 16.6946 10.7412 19.5809C9.56278 22.4657 8.97122 25.5565 9.00108 28.6726C9.0022 32.646 10.3724 36.9351 12.369 41.0957C14.3723 45.2701 17.0425 49.3894 19.724 53.0408Z\"\n                        [attr.fill]=\"color\"\n                        stroke=\"#0B421D\"\n                        stroke-width=\"2\"\n                    />\n                </g>\n                <defs>\n                    <filter\n                        id=\"filter0_d_1065_10313\"\n                        x=\"0\"\n                        y=\"0\"\n                        width=\"65.3353\"\n                        height=\"80.001\"\n                        filterUnits=\"userSpaceOnUse\"\n                        color-interpolation-filters=\"sRGB\"\n                    >\n                        <feFlood\n                            flood-opacity=\"0\"\n                            result=\"BackgroundImageFix\"\n                        />\n                        <feColorMatrix\n                            in=\"SourceAlpha\"\n                            type=\"matrix\"\n                            values=\"0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0\"\n                            result=\"hardAlpha\"\n                        />\n                        <feOffset dy=\"4\" />\n                        <feGaussianBlur stdDeviation=\"4\" />\n                        <feComposite in2=\"hardAlpha\" operator=\"out\" />\n                        <feColorMatrix\n                            type=\"matrix\"\n                            values=\"0 0 0 0 0.0196078 0 0 0 0 0.109804 0 0 0 0 0.172549 0 0 0 0.2 0\"\n                        />\n                        <feBlend\n                            mode=\"normal\"\n                            in2=\"BackgroundImageFix\"\n                            result=\"effect1_dropShadow_1065_10313\"\n                        />\n                        <feBlend\n                            mode=\"normal\"\n                            in=\"SourceGraphic\"\n                            in2=\"effect1_dropShadow_1065_10313\"\n                            result=\"shape\"\n                        />\n                    </filter>\n                </defs>\n            </svg>\n            <div\n                class=\"absolute top-0 left-0 w-full h-3/4 flex items-center justify-center\"\n            >\n                <div\n                    class=\"relative z-10 h-4 w-4 rounded-full bg-white border-2 border-[#0B421D]\"\n                    *ngIf=\"!selected\"\n                ></div>\n                <app-icon\n                    class=\"relative text-white z-10 text-2xl\"\n                    *ngIf=\"selected\"\n                >\n                    done\n                </app-icon>\n            </div>\n        </div>\n    `,\n    styles: [],\n})\nexport class SpaceLocationPinComponent {\n    public readonly selected = this._data.selected === true;\n    public readonly active = this._data.active === true;\n\n    public get color() {\n        return this.active ? '#F4511E' : this.selected ? '#D32F2F' : '#309251';\n    }\n    constructor(@Inject(MAP_FEATURE_DATA) private _data: any) {\n        console.log('Pin:', _data.display_name, this.active, this.selected);\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { AsyncHandler, unique } from '@placeos/common';\nimport { EventFormService } from '@placeos/events';\nimport { BuildingLevel, OrganisationService } from '@placeos/organisation';\nimport { debounceTime, map, tap } from 'rxjs/operators';\nimport { Space } from '../space.class';\nimport { SpaceLocationPinComponent } from './space-location-pin.component';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\n\n@Component({\n    selector: `space-map`,\n    template: `\n        <i-map\n            [src]=\"map_url\"\n            [features]=\"features | async\"\n            [actions]=\"actions | async\"\n            [(zoom)]=\"zoom\"\n            [(center)]=\"center\"\n        ></i-map>\n        <div\n            class=\"absolute inset-x-0 top-0 bg-white p-2 border-b border-gray-200\"\n        >\n            <mat-form-field\n                levels\n                appearance=\"outline\"\n                class=\"w-full h-[3.25rem]\"\n            >\n                <mat-select [(ngModel)]=\"level\">\n                    <mat-option\n                        *ngFor=\"let opt of levels | async\"\n                        [value]=\"opt\"\n                    >\n                        {{ opt.display_name || opt.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n        </div>\n        <div\n            zoom\n            class=\"absolute bottom-2 right-2 rounded-lg border border-gray-200 bg-white flex flex-col overflow-hidden\"\n        >\n            <button\n                icon\n                matRipple\n                name=\"space-map-zoom-in\"\n                (click)=\"setZoom(zoom * 1.1)\"\n            >\n                <app-icon>zoom_in</app-icon>\n            </button>\n            <div class=\"border-t border-gray-200 w-full\"></div>\n            <button\n                icon\n                matRipple\n                name=\"space-map-zoom-out\"\n                (click)=\"setZoom(zoom * (1 / 1.1))\"\n            >\n                <app-icon>zoom_out</app-icon>\n            </button>\n            <div class=\"border-t border-gray-200 w-full\"></div>\n            <button icon matRipple name=\"space-map-reset\" (click)=\"resetMap()\">\n                <app-icon>refresh</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n                background: rgba(0, 0, 0, 0.05);\n                padding-top: 4rem;\n            }\n\n            button {\n                border-radius: 0;\n            }\n        `,\n    ],\n})\nexport class SpaceSelectMapComponent extends AsyncHandler {\n    @Input() public selected: string[] = [];\n    @Input() public active: string;\n    @Input() public is_displayed: boolean = false;\n    @Output() public onSelect = new EventEmitter<Space>();\n\n    public zoom = 1;\n    public center = { x: 0.5, y: 0.5 };\n\n    private _seletedSpace = (s) => () => {\n        this.onSelect.emit(s);\n        this._change.next(Date.now());\n    };\n    public level: BuildingLevel = null;\n    private _change = new BehaviorSubject(0);\n\n    public get map_url() {\n        return this.level?.map_id || '';\n    }\n\n    public readonly levels = this._event_form.available_spaces.pipe(\n        map((_) =>\n            unique(\n                _.map(({ zones }) => this._org.levelWithID(zones)),\n                'id'\n            )\n        ),\n        tap((_) => (this.level = this.level ? this.level : _[0]))\n    );\n\n    public readonly features = combineLatest([\n        this._event_form.available_spaces,\n        this._change,\n    ]).pipe(\n        debounceTime(300),\n        map(([l]) => {\n            console.log(\n                'Data:',\n                this.selected,\n                this.active,\n                l.map((_) => _.id)\n            );\n            return l.map((space) => ({\n                location: space.map_id,\n                content: SpaceLocationPinComponent,\n                data: {\n                    ...space,\n                    active: this.active === space.id,\n                    selected: this.selected.includes(space.id),\n                },\n            }));\n        })\n    );\n\n    public readonly actions = this._event_form.available_spaces.pipe(\n        map((l) =>\n            l.map((space) => ({\n                id: space.map_id,\n                action: ['touchend', 'mouseup'],\n                callback: this._seletedSpace(space),\n            }))\n        )\n    );\n\n    constructor(\n        private _event_form: EventFormService,\n        private _org: OrganisationService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'levels_update',\n            this.levels.subscribe((levels) => {\n                if (!levels.find((_) => _.id === this.level?.id)) {\n                    this.level = levels[0];\n                }\n            })\n        );\n    }\n\n    public setZoom(new_zoom: number) {\n        this.zoom = Math.max(0.5, Math.min(10, new_zoom));\n    }\n\n    public resetMap() {\n        this.zoom = 1;\n        this.center = { x: 0.5, y: 0.5 };\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatBottomSheetModule } from '@angular/material/bottom-sheet';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\n\nimport { ComponentsModule } from 'libs/components/src/lib/components.module';\nimport { FormFieldsModule } from 'libs/form-fields/src/lib/form-fields.module';\nimport { NewSpaceSelectModalComponent } from './space-select-modal/new-space-select-modal.component';\n\nimport { SpaceSelectItemComponent } from './space-select-item.component';\nimport { SpaceSelectModalComponent } from './space-select-modal.component';\nimport { SpaceDetailsComponent } from './space-select-modal/space-details.component';\nimport { SpaceListComponent } from './space-select-modal/space-list.component';\nimport { SpaceFiltersComponent } from './space-select-modal/space-filters.component';\nimport { SpaceFiltersDisplayComponent } from './space-select-modal/space-filters-display.component';\nimport { SpaceSelectMapComponent } from './space-select-modal/space-map.component';\n\nimport { SpaceLocationPinComponent } from './space-select-modal/space-location-pin.component';\nimport { SpacePipe } from './space.pipe';\n\nconst COMPONENTS: Type<any>[] = [\n    SpaceSelectModalComponent,\n    SpaceSelectItemComponent,\n    NewSpaceSelectModalComponent,\n\n    SpaceDetailsComponent,\n    SpaceListComponent,\n    SpaceFiltersComponent,\n    SpaceFiltersDisplayComponent,\n    SpaceSelectMapComponent,\n    SpaceLocationPinComponent,\n\n    SpacePipe,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        MatDialogModule,\n        ComponentsModule,\n        FormFieldsModule,\n        MatBottomSheetModule,\n        MatCheckboxModule,\n        FormsModule,\n        ReactiveFormsModule,\n    ],\n    providers: [],\n    exports: [...COMPONENTS],\n})\nexport class SharedSpacesModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport {\n    debounceTime,\n    first,\n    map,\n    shareReplay,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\n\nimport { AsyncHandler } from '@placeos/common';\nimport { Space } from '@placeos/spaces';\nimport { BehaviorSubject, of } from 'rxjs';\nimport { querySystems } from '@placeos/ts-client';\n\nconst STORE_KEY = 'PLACEOS.CONTROL.system';\n\n@Component({\n    selector: '[app-bootstrap]',\n    template: `\n        <div\n            class=\"rounded shadow m-4 bg-white dark:bg-neutral-700 border border-gray-200 dark:border-neutral-500 overflow-hidden mx-auto text-center flex flex-col items-center\"\n        >\n            <h2 class=\"bg-red-700 text-white py-2 px-4 m-0 w-full text-2xl\">\n                Control Panel Setup\n            </h2>\n            <ng-container\n                *ngIf=\"!loading || loading === 'search'; else load_state\"\n            >\n                <p class=\"description py-4\">\n                    Input the PlaceOS <em>System ID</em> to bootstrap\n                </p>\n                <mat-form-field appearance=\"outline\">\n                    <mat-label>System ID</mat-label>\n                    <input\n                        matInput\n                        [ngModel]=\"system_id$ | async\"\n                        [matAutocomplete]=\"auto\"\n                        placeholder=\"System ID\"\n                        (ngModelChange)=\"system_id$.next($event)\"\n                    />\n                    <mat-spinner\n                        [diameter]=\"32\"\n                        matSuffix\n                        *ngIf=\"loading === 'search'\"\n                    ></mat-spinner>\n                </mat-form-field>\n                <mat-autocomplete #auto=\"matAutocomplete\">\n                    <mat-option\n                        *ngFor=\"let option of space_list | async\"\n                        [value]=\"option.id\"\n                    >\n                        <div class=\"leading-tight\">\n                            <div class=\"name\">{{ option.name }}</div>\n                            <div class=\"text-xs text-dark-fade\">\n                                {{ option.id }}\n                            </div>\n                        </div>\n                    </mat-option>\n                    <mat-option\n                        class=\"pointer-events-none opacity-60\"\n                        *ngIf=\"\n                            system_id$.getValue()?.length < 2 &&\n                            !(space_list | async)?.length\n                        \"\n                    >\n                        Start typing to search for a room\n                    </mat-option>\n                </mat-autocomplete>\n                <button\n                    btn\n                    matRipple\n                    [disabled]=\"!system_id$.getValue()\"\n                    (click)=\"bootstrap()\"\n                >\n                    Submit\n                </button>\n            </ng-container>\n        </div>\n        <ng-template #load_state>\n            <div load class=\"my-16 flex flex-col items-center\">\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <div class=\"m-4\">Loading system data... {{ loading }}</div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background-color: #f0f0f0;\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='49' viewBox='0 0 28 49'%3E%3Cg fill-rule='evenodd'%3E%3Cg id='hexagons' fill='%230002' fill-opacity='1' fill-rule='nonzero'%3E%3Cpath d='M13.99 9.25l13 7.5v15l-13 7.5L1 31.75v-15l12.99-7.5zM3 17.9v12.7l10.99 6.34 11-6.35V17.9l-11-6.34L3 17.9zM0 15l12.98-7.5V0h-2v6.35L0 12.69v2.3zm0 18.5L12.98 41v8h-2v-6.85L0 35.81v-2.3zM15 0v7.5L27.99 15H28v-2.31h-.01L17 6.35V0h-2zm0 49v-8l12.99-7.5H28v2.31h-.01L17 42.15V49h-2z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\");\n            }\n\n            :host > div {\n                width: 32rem;\n                max-width: calc(100vw - 2rem);\n            }\n\n            mat-form-field {\n                width: calc(100% - 2rem);\n            }\n\n            button {\n                width: 8rem;\n                margin: 0.5rem;\n                margin-top: 0;\n            }\n        `,\n    ],\n})\nexport class BootstrapComponent extends AsyncHandler implements OnInit {\n    /** List of available systems */\n    public system_list: Space[] = [];\n    /** List of available systems */\n    public filtered_list: Space[] = [];\n    /** Whether application data is loading */\n    public loading: string;\n    /** ID of the system to bootstrap */\n    public system_id$ = new BehaviorSubject('');\n    /** Selected system to bootstrap */\n    public selected_system: Space = null;\n    /** Whether input field is focused */\n    public input_focus: boolean;\n\n    public readonly space_list = this.system_id$.pipe(\n        debounceTime(300),\n        switchMap((search) => {\n            this.loading = 'search';\n            return search.length < 2\n                ? of({ data: [] })\n                : querySystems({ q: search, limit: 20 });\n        }),\n        map((_) => _.data.map((_) => new Space(_ as any))),\n        tap((_) => (this.loading = '')),\n        shareReplay()\n    );\n\n    constructor(private route: ActivatedRoute, private _router: Router) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this.subscription(\n            'route.query',\n            this.route.queryParamMap.subscribe((params) => {\n                if (params.has('clear') && !!params.get('clear')) {\n                    this.clearBootstrap();\n                }\n                if (params.has('system_id') || params.has('sys_id')) {\n                    this.system_id$.next(\n                        params.get('system_id') || params.get('sys_id')\n                    );\n                    this.bootstrap();\n                }\n            })\n        );\n        this.checkBootstrapped();\n    }\n\n    /**\n     * Setup the default system for the application to bind to\n     */\n    public readonly bootstrap = () =>\n        this.configure(this.system_id$.getValue());\n\n    /**\n     * Check if the application has previously been bootstrapped\n     */\n    private checkBootstrapped(): void {\n        this.loading = 'Checks';\n        if (localStorage) {\n            const system_id = localStorage.getItem(STORE_KEY);\n            if (system_id) {\n                this._router.navigate(['/tabbed', system_id], {\n                    queryParamsHandling: 'preserve',\n                });\n                return;\n            }\n        }\n        this.loading = '';\n    }\n\n    /**\n     * Save the bootstrapped ID and redirect to the panel for that ID\n     * @param system_id System to bootstrap\n     */\n    private configure(system_id: string): void {\n        this.loading = 'Setup';\n        if (localStorage) {\n            localStorage.setItem(STORE_KEY, system_id);\n            localStorage.setItem('trust', 'true');\n            localStorage.setItem('fixed_device', 'true');\n        }\n        this._router.navigate(['/tabbed', system_id], {\n            queryParamsHandling: 'preserve',\n        });\n        this.loading = '';\n    }\n\n    /**\n     * Remove any previously set bootstrapping details\n     */\n    private readonly clearBootstrap = () => localStorage.removeItem(STORE_KEY);\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { first, shareReplay, tap } from 'rxjs/operators';\nimport { addMinutes, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\nimport { Calendar } from './calendar.class';\n\nimport { AsyncHandler } from 'libs/common/src/lib/async-handler.class';\nimport { SettingsService } from 'libs/common/src/lib/settings.service';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { CalendarEvent } from 'libs/events/src/lib/event.class';\nimport { CalendarAvailabilityQueryParams } from './calendar.interfaces';\nimport {\n    queryCalendarAvailability,\n    queryCalendars,\n    querySpaceFreeBusy,\n} from './calendar.fn';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class CalendarService extends AsyncHandler {\n    private readonly _calendars = new BehaviorSubject<Calendar[]>([]);\n\n    /** Observable for the list of calendars */\n    public readonly calendar_list = queryCalendars().pipe(\n        tap((l) => this._calendars.next(l)),\n        shareReplay(1)\n    );\n\n    /* istanbul ignore next */\n    public readonly query = () => queryCalendars();\n    /* istanbul ignore next */\n    public readonly freeBusy = (q: CalendarAvailabilityQueryParams) =>\n        querySpaceFreeBusy(q, this._org);\n    /* istanbul ignore next */\n    public readonly availability = (q: CalendarAvailabilityQueryParams) =>\n        queryCalendarAvailability(q);\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService\n    ) {\n        super();\n        this._org.initialised\n            .pipe(first((_) => _))\n            .subscribe(() => this.init());\n    }\n\n    public async init() {\n        if (this._settings.get('app.events.use_bookings')) return;\n        this._initialised.next(true);\n    }\n\n    public get calendars(): Calendar[] {\n        return this._calendars.getValue();\n    }\n\n    /** Get Free busy for the selected day\n     * @param calendars User calendar\n     * @param date Selected day\n     */\n    public getFreeBusyDate(date: number, calendars: string) {\n        return querySpaceFreeBusy(\n            {\n                period_start: getUnixTime(startOfDay(date)),\n                period_end: getUnixTime(endOfDay(date)),\n                calendars,\n            },\n            this._org\n        );\n    }\n\n    /** Check rooms availability */\n    public async checkSpacesAvailability(\n        system_ids: string[],\n        period_start: number,\n        period_end: number,\n        old_booking?: CalendarEvent\n    ) {\n        const result = await queryCalendarAvailability({\n            period_start,\n            period_end,\n            system_ids: system_ids.join(','),\n        }).toPromise();\n        const start = new Date(old_booking?.date).valueOf();\n        const end = addMinutes(start, old_booking?.duration).valueOf();\n        const available = result.every((i) => {\n            const availability = i.availability;\n            if (old_booking && i.id === old_booking.system?.email) {\n                const index = availability.findIndex((block) => {\n                    return (\n                        block.date >= start &&\n                        addMinutes(block.date, block.duration).valueOf() <= end\n                    );\n                });\n                if (index !== -1) {\n                    availability.splice(index, 1);\n                }\n            }\n            return !availability.length;\n        });\n        return !!available;\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nexport class SourceSelectModalData {\n    output: string;\n}\n\n@Component({\n    selector: 'source-select-modal',\n    template: `\n        <div\n            class=\"bg-white flex flex-col items-center py-16 px-8 overflow-auto\"\n            [style.max-height]=\"simple ? '80vh' : ''\"\n            [class.fixed]=\"!simple\"\n            [class.inset-0]=\"!simple\"\n            [class.relative]=\"simple\"\n            [class.rounded]=\"simple\"\n        >\n            <source-select\n                [simple]=\"simple\"\n                [output]=\"output\"\n                (source)=\"close()\"\n            ></source-select>\n            <button\n                icon\n                matRipple\n                mat-dialog-close\n                class=\"absolute\"\n                [class.top-8]=\"!simple\"\n                [class.right-8]=\"!simple\"\n                [class.top-2]=\"simple\"\n                [class.right-2]=\"simple\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n    `,\n})\nexport class SourceSelectModalComponent {\n    public simple = false;\n    public readonly output = this._data.output;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: SourceSelectModalData,\n        private _dialog_ref: MatDialogRef<SourceSelectModalComponent>\n    ) {}\n\n    public close() {\n        this._dialog_ref.close();\n    }\n}\n","import { Component } from '@angular/core';\nimport { MatDialog, MatDialogRef } from '@angular/material/dialog';\nimport { notifySuccess, openConfirmModal } from '@placeos/common';\nimport { CalendarEvent } from '@placeos/events';\nimport { format } from 'date-fns';\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'select-meeting-modal',\n    template: `\n        <div class=\"fixed inset-0 bg-white\">\n            <button\n                icon\n                matRipple\n                mat-dialog-close\n                class=\"absolute top-2 right-2\"\n            >\n                <app-icon>close</app-icon>\n            </button>\n            <div class=\"w-[40rem] max-w-full p-2 mx-auto\">\n                <h2 class=\"w-full text-center my-4 text-2xl font-medium\">\n                    Select a meeting to join\n                </h2>\n                <div class=\"w-full\">\n                    <label for=\"calendar\">User calendar:</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-full\">\n                        <mat-select\n                            [ngModel]=\"calendar | async\"\n                            (ngModelChange)=\"setCalendar($event)\"\n                        >\n                            <mat-option\n                                *ngFor=\"let cal of calendars | async\"\n                                [value]=\"cal\"\n                            >\n                                {{ cal.name || cal.summary }}\n                            </mat-option>\n                        </mat-select>\n                        <mat-hint>\n                            If you are joining the meeting on behalf of another,\n                            please use the dropdown to select their email\n                        </mat-hint>\n                    </mat-form-field>\n                </div>\n                <h3 class=\"w-full my-4 font-medium\">\n                    {{ (events | async)?.length || '0' }} Available meeting(s)\n                </h3>\n                <ng-container *ngIf=\"!loading; else load_state\">\n                    <div\n                        class=\"overflow-auto space-y-2\"\n                        *ngIf=\"(events | async)?.length; else empty_state\"\n                    >\n                        <button\n                            btn\n                            matRipple\n                            class=\"flex items-center p-4 w-full border border-gray-200 rounded\"\n                            *ngFor=\"let event of events | async\"\n                            (click)=\"select(event)\"\n                        >\n                            <div class=\"flex-1 text-left truncate w-1/2\">\n                                {{ event?.title }}\n                            </div>\n                            <div class=\"text-sm opacity-60\">\n                                {{ event?.date | date: 'shortTime' }}\n                            </div>\n                        </button>\n                    </div>\n                </ng-container>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div\n                class=\"w-full flex items-center justify-center opacity-40 h-32\"\n            >\n                No events found for selected calendar with a meeting URL\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                class=\"w-full flex items-center justify-center opacity-40 h-32\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>Loading events...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SelectMeetingModalComponent {\n    public readonly calendars = this._service.calendars;\n    public readonly events = this._service.events;\n\n    public loading = false;\n\n    public readonly calendar = this._service.calendar;\n\n    public readonly setCalendar = (c) => this._service.setCalendar(c);\n\n    public readonly select = async (e: CalendarEvent) => {\n        const details = await openConfirmModal(\n            {\n                title: 'Join meeting',\n                content: `Are you sure you wish to join ${\n                    e.organiser?.name\n                }'s meeting for ${format(e.date, 'h:mm a')}?`,\n                icon: { content: 'login' },\n            },\n            this._dialog\n        );\n        if (details.reason !== 'done') return;\n        await this._service.setEvent(e);\n        notifySuccess('Successfully setup meeting');\n        this._dialog_ref.close();\n    };\n\n    constructor(\n        private _service: ControlStateService,\n        private _dialog: MatDialog,\n        private _dialog_ref: MatDialogRef<SelectMeetingModalComponent>\n    ) {}\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { SettingsService } from '@placeos/common';\n\nimport { marked } from 'marked';\n\n@Component({\n    selector: 'help-modal',\n    template: `\n        <div\n            class=\"flex flex-col sm:flex-row items-center bg-white rounded overflow-hidden sm:h-[80vh] sm:w-[80vw] sm:relative absolute inset-0 sm:inset-auto\"\n        >\n            <div\n                sidebar\n                class=\"bg-[#212121] text-white sm:h-full w-full sm:w-64\"\n            >\n                <img [src]=\"logo?.src\" class=\"w-24 mx-auto mt-6 sm:mb-8\" />\n                <ul class=\"list-none p-0 pl-4 space-y-2 hidden sm:block\">\n                    <li\n                        class=\"flex items-center rounded-l-3xl pl-4 py-2 relative\"\n                        *ngFor=\"let item of items\"\n                        [class.active]=\"item.id === active_item.id\"\n                        (click)=\"active_item = item\"\n                    >\n                        <div\n                            class=\"w-6 h-[5.5rem] absolute bg-white right-0 top-1/2 -translate-y-1/2 overflow-hidden\"\n                            *ngIf=\"item.id === active_item.id\"\n                        >\n                            <div\n                                class=\"w-12 h-12 absolute top-0 right-0 -translate-y-1/2 bg-[#212121] rounded-full\"\n                            ></div>\n                            <div\n                                class=\"w-12 h-12 absolute bottom-0 right-0 translate-y-1/2 bg-[#212121] rounded-full\"\n                            ></div>\n                        </div>\n                        <app-icon>{{ item.icon || 'help' }}</app-icon>\n                        <div class=\"ml-4\">{{ item.title }}</div>\n                        <div\n                            class=\"absolute inset-0 overflow-hidden rounded-3xl\"\n                            matRipple\n                        ></div>\n                    </li>\n                </ul>\n                <div class=\"px-2 pb-2 w-full dark\">\n                    <mat-form-field\n                        class=\"block sm:hidden h-12 w-full\"\n                        appearance=\"outline\"\n                    >\n                        <mat-select [(ngModel)]=\"active_item\">\n                            <mat-option\n                                *ngFor=\"let item of items\"\n                                [value]=\"item\"\n                            >\n                                {{ item.title }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n            </div>\n            <div\n                content\n                class=\"overflow-auto flex-1 h-1/2 w-full sm:w-1/2 sm:h-full p-4 sm:p-8\"\n                [innerHTML]=\"content | safe\"\n            ></div>\n            <button\n                icon\n                matRipple\n                class=\"absolute top-2 right-2 text-white sm:text-black\"\n                mat-dialog-close\n            >\n                <app-icon>close</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            li.active {\n                background-color: #fff;\n                color: #000;\n                overflow: visible !important;\n            }\n        `,\n    ],\n})\nexport class HelpModalComponent {\n    public active_item = { id: '', content: `` };\n    public readonly items = this._data.items;\n\n    public get logo() {\n        return this._settings.get('app.logo_dark');\n    }\n\n    public get content() {\n        return this.active_item?.content\n            ? marked(this.active_item.content)\n            : '';\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: {\n            items: { id: string; title: string; content: string }[];\n            active_id?: string;\n        },\n        private _settings: SettingsService\n    ) {\n        this.active_item =\n            this.items?.find((_) => _.id === this._data.active_id) ||\n            this.items[0] ||\n            this.active_item;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { getModule } from '@placeos/ts-client';\nimport {\n    debounceTime,\n    distinct,\n    filter,\n    map,\n    shareReplay,\n    switchMap,\n    take,\n    tap,\n} from 'rxjs/operators';\nimport { BehaviorSubject, combineLatest, Observable, of } from 'rxjs';\n\nimport { AsyncHandler, currentUser, HashMap } from '@placeos/common';\nimport { Calendar, CalendarService } from '@placeos/calendar';\nimport { SourceSelectModalComponent } from './ui/source-select-modal.component';\nimport { CalendarEvent, queryEvents } from '@placeos/events';\nimport { endOfDay, getUnixTime } from 'date-fns';\nimport { SelectMeetingModalComponent } from './ui/select-meeting-modal.component';\nimport { HelpModalComponent } from './ui/help-modal.component';\nimport { SpacesService } from '@placeos/spaces';\n\nexport interface EnvironmentSource {\n    name: string;\n    states: string[];\n    state: string;\n}\n\nexport interface RoomAccessory {\n    name: string;\n    module: string;\n    controls: RoomAccessoryAction[];\n}\n\nexport interface RoomAccessoryAction {\n    name: string;\n    icon: string;\n    function_name: string;\n    arguments: any[];\n}\nexport interface LightScene {\n    id: number;\n    name: string;\n    icon: string;\n    opacity: number;\n}\n\nexport interface TabDetails {\n    icon: string;\n    name: string;\n    inputs: string[];\n    help: string;\n    controls: string;\n    type: string;\n}\n\nexport interface RoomInput {\n    id?: string;\n    ref: string;\n    name: string;\n    type: string;\n    mod: string;\n    index?: string;\n    volume: number;\n    mute: boolean;\n    locked: boolean;\n    routes: string[];\n    outputs: string[];\n    hidden?: boolean;\n    presentable?: boolean;\n}\n\nexport interface RoomOutput {\n    id?: string;\n    ref: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    volume: number;\n    locked: boolean;\n    source: string;\n    inputs: string[];\n    following: string;\n    hidden?: boolean;\n}\n\nexport interface SystemState {\n    name?: string;\n    power?: boolean;\n    connected?: boolean;\n    selected_tab?: string;\n    selected_input?: string;\n    mute?: boolean;\n    volume?: number;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class ControlStateService extends AsyncHandler {\n    private _id = new BehaviorSubject<string>('');\n    private _system = new BehaviorSubject<SystemState>({});\n    private _inputs = new BehaviorSubject<string[]>([]);\n    private _outputs = new BehaviorSubject<string[]>([]);\n    private _volume = new BehaviorSubject<number>(0);\n    private _mute = new BehaviorSubject<boolean>(false);\n    private _input_data = new BehaviorSubject<RoomInput[]>([]);\n    private _output_data = new BehaviorSubject<RoomOutput[]>([]);\n    private _lights = new BehaviorSubject<string[]>([]);\n    private _blinds = new BehaviorSubject<string[]>([]);\n    private _screens = new BehaviorSubject<string[]>([]);\n    private _url = new BehaviorSubject<string>('');\n    private _active_output = new BehaviorSubject<string>('');\n    private _calendar = new BehaviorSubject<Calendar>(null);\n    private _ignore_changes: string[] = [];\n\n    /** General data associated with the active system */\n    public readonly system = this._system.asObservable();\n    /** List of available input sources */\n    public readonly input_list = this._input_data.pipe(\n        map((l) => l.filter((_) => !_.hidden)),\n        shareReplay(1)\n    );\n    public readonly presentables$ = this._input_data.pipe(\n        map((l) => l.filter((_) => _.presentable !== false)),\n        shareReplay(1)\n    );\n    /** List of available output sources */\n    public readonly output_list = combineLatest([\n        this._output_data,\n        this._outputs,\n    ]).pipe(\n        map(([l, a]) =>\n            l.filter((_) => !_.hidden && (!_.id || (a || []).includes(_.id)))\n        ),\n        shareReplay(1)\n    );\n    public readonly system_id = this._id.asObservable();\n    public readonly calendar = this._calendar.asObservable();\n    /** List of available light sources */\n    public readonly lights = this._lights.asObservable();\n    /** List of available blind sources */\n    public readonly blinds = this._blinds.asObservable();\n    public readonly screens = this._screens.asObservable();\n    public readonly volume = this._volume.asObservable();\n    public readonly mute = this._mute.asObservable();\n    public readonly active_output = this._active_output.asObservable();\n    /** List of available capture output sources */\n    public readonly capture_list = this._output_data.pipe(\n        map((list) =>\n            list?.filter(\n                (_) => _.type === 'recording' || _.mod?.includes('Capture')\n            )\n        )\n    );\n    /** List of available microphone input sources */\n    public readonly mic_list = this._input_data.pipe(\n        map((list) =>\n            list?.filter(\n                (_) => _.type === 'mic' || _.mod?.includes('Microphone')\n            )\n        )\n    );\n    /** List of available camera input sources */\n    public readonly camera_list = this._input_data.pipe(\n        map((list) =>\n            list?.filter((_) => _.type === 'cam' || _.mod?.includes('Camera'))\n        )\n    );\n    public readonly selected_camera = this.system_id.pipe(\n        switchMap((id) => this._listenToSystemBinding(id, 'selected_camera')),\n        shareReplay(1)\n    );\n    public readonly microphones: Observable<string[]> = this.system_id.pipe(\n        switchMap((id) => this._listenToSystemBinding(id, 'microphones')),\n        shareReplay(1)\n    );\n    public readonly join_modes: Observable<\n        HashMap<{ name: string; room_ids: string[] }>\n    > = this.system_id.pipe(\n        switchMap((id) => this._listenToSystemBinding(id, 'join_modes')),\n        shareReplay(1)\n    );\n    public readonly joined_id: Observable<string> = this.system_id.pipe(\n        switchMap((id) => this._listenToSystemBinding(id, 'joined')),\n        shareReplay(1)\n    );\n    public readonly lighting_scenes: Observable<LightScene[]> =\n        this.system_id.pipe(\n            switchMap((id) =>\n                this._listenToSystemBinding(id, 'lighting_scenes')\n            ),\n            shareReplay(1)\n        );\n    public readonly lighting_scene: Observable<string> = this.system_id.pipe(\n        switchMap((id) => this._listenToSystemBinding(id, 'lighting_scene')),\n        shareReplay(1)\n    );\n    public readonly room_accessories: Observable<RoomAccessory[]> =\n        this.system_id.pipe(\n            switchMap((id) =>\n                this._listenToSystemBinding(id, 'room_accessories')\n            ),\n            shareReplay(1)\n        );\n    public readonly joined = combineLatest([\n        this.join_modes,\n        this.joined_id,\n    ]).pipe(map(([modes, id]) => (modes ? modes[id] : null)));\n    /** List of help items */\n    public readonly help_items = this.system_id.pipe(\n        switchMap((id) => this._listenToSystemBinding(id, 'help')),\n        map((_) =>\n            !_ ? null : Object.keys(_).map((key) => ({ id: key, ..._[key] }))\n        ),\n        shareReplay(1)\n    );\n    public readonly preview_outputs = this.system_id.pipe(\n        switchMap((id) => this._listenToSystemBinding(id, 'preview_outputs')),\n        map((_) => _?.length > 0),\n        shareReplay(1)\n    );\n    public readonly tabs: Observable<TabDetails[]> = this.system_id.pipe(\n        switchMap((id) => this._listenToSystemBinding(id, 'tabs')),\n        map((_) => _ || []),\n        shareReplay(1)\n    );\n\n    public readonly calendars = this._cal.calendar_list;\n\n    public readonly events = combineLatest([this._url, this._calendar]).pipe(\n        switchMap(([url, cal]) => {\n            if (!cal || !url) return of([] as CalendarEvent[]);\n            return queryEvents({\n                period_start: getUnixTime(Date.now()),\n                period_end: getUnixTime(endOfDay(Date.now())),\n                calendars: cal.id,\n            });\n        }),\n        map((list) => {\n            const url = this._url.getValue();\n            return list.filter((_) => _.meeting_url.startsWith(url));\n        }),\n        shareReplay(1)\n    );\n\n    public get id() {\n        return this._id.getValue();\n    }\n\n    constructor(\n        private _dialog: MatDialog,\n        private _cal: CalendarService,\n        private _spaces: SpacesService\n    ) {\n        super();\n        this._id.pipe(distinct()).subscribe((id) => this.bindToState(id));\n        this._inputs.subscribe((_) => this.bindSources('input', _ || []));\n        this._outputs.subscribe((_) => this.bindSources('output', _ || []));\n    }\n\n    public setID(id: string) {\n        if (id !== this._id.getValue()) {\n            this._id.next(id);\n            this._spaces.loadSpace(id);\n        }\n    }\n\n    /** Power on the active system */\n    public join(id: string) {\n        return this._execute('join_mode', [id]);\n    }\n\n    /** Power on the active system */\n    public powerOn() {\n        return this._execute('power', [true]);\n    }\n\n    /** Power off the active system */\n    public powerOff(unlink: boolean = false) {\n        return this._execute('power', [false, unlink]);\n    }\n\n    /** Set the active calendar */\n    public setCalendar(cal: Calendar) {\n        this._calendar.next(cal);\n    }\n\n    /** Set the active calendar */\n    public setOutput(id: string) {\n        this._active_output.next(id);\n        if (this._system.getValue()?.selected_input) {\n            this.setOutputSource(this._system.getValue()?.selected_input);\n            this._active_output.next('');\n        }\n    }\n\n    /** Route input source to output */\n    public setRoute(input: string, output: string, set_input = true) {\n        if (set_input) this.setSelectedInput(input);\n        return this._execute('route', [input, output]);\n    }\n\n    /** Clear the route on the output source */\n    public unroute(output: string) {\n        return this._execute('unroute', [output]);\n    }\n\n    /** Set the route of the active output */\n    public async setOutputSource(input: string, clear = true) {\n        const output = this._active_output.getValue();\n        const data = (this._output_data.getValue() || []).find(\n            (_) => _.id === output\n        );\n        this.setSelectedInput(input);\n        if (!output || data?.source === input) return;\n        await this.setRoute(input, output);\n        if (clear) this._active_output.next('');\n    }\n\n    public setSelectedInput(input: string) {\n        if (this._system.getValue().selected_input === input) return;\n        return this.timeout(\n            `selected`,\n            () => this._execute('selected_input', [input]),\n            50\n        );\n    }\n\n    /** Update the econtrol meeting */\n    public setEvent(event: CalendarEvent) {\n        return this._execute(\n            'econtrol',\n            [\n                currentUser().name,\n                event.meeting_url,\n                event.meeting_id,\n                event.meeting_provider,\n                event.event_start,\n                event.event_end,\n            ],\n            'MeetingPush'\n        );\n    }\n\n    public setMute(state: boolean = true, source: string = '') {\n        const outputs = this._output_data.getValue();\n        if (!source) {\n            this._mute.next(state);\n            source = outputs[0]?.id || '';\n        }\n        if (source) {\n            const data = outputs.find((_) => _.id === source);\n            if (data) {\n                this.updateSourceData('output', data.id, {\n                    ...data,\n                    mute: state,\n                });\n            }\n        }\n        return this._execute('mute', source ? [state, source] : [state]);\n    }\n\n    public setVolume(value: number = 0, source: string = '') {\n        const outputs = this._output_data.getValue();\n        if (!source) {\n            this._volume.next(value);\n            source = outputs[0]?.id || '';\n        }\n        if (source) {\n            const data = outputs.find((_) => _.id === source);\n            if (data) {\n                this.updateSourceData('output', data.id, {\n                    ...data,\n                    volume: value,\n                });\n            }\n        }\n        this._execute('volume', source ? [value, source] : [value]).then();\n        this._ignore_changes.push('volume');\n        this.timeout(\n            `set-volume`,\n            () =>\n                (this._ignore_changes = this._ignore_changes.filter(\n                    (_) => _ !== 'volume'\n                )),\n            500\n        );\n    }\n\n    /** Execute driver method */\n    private _execute(\n        name: string,\n        params: any[] = [],\n        mod_name: string = 'System'\n    ) {\n        const mod = getModule(this._id.getValue(), mod_name);\n        if (!mod) return;\n        return mod.execute(name, params);\n    }\n\n    /** Open switch source modal */\n    public switchSource(output: string) {\n        this._dialog.open(SourceSelectModalComponent, {\n            data: { output },\n        });\n    }\n\n    /** Open select meeting modal */\n    public async selectMeeting(input?: string) {\n        const cals = await this.calendars.pipe(take(1)).toPromise();\n        if (cals?.length) this.setCalendar(cals[0]);\n        this._dialog.open(SelectMeetingModalComponent, {\n            data: { input },\n        });\n    }\n\n    /** Open view help modal */\n    public async viewHelp(id?: string) {\n        this._dialog.open(HelpModalComponent, {\n            data: {\n                items: await this.help_items\n                    .pipe(\n                        filter((_) => !!_),\n                        take(1)\n                    )\n                    .toPromise(),\n                active_id: id,\n            },\n        });\n    }\n\n    private bindToState(id: string) {\n        if (!id) return;\n        this.bindTo(id, 'supported_meeting_url', 'MeetingPush', (u) => {\n            this.updateProperty('meeting_url', u);\n            this._url.next(u);\n        });\n        this.bindTo(id, 'name');\n        this.bindTo(id, 'active');\n        this.bindTo(id, 'connected');\n        this.bindTo(id, 'recording');\n        this.bindTo(id, 'has_zoom');\n        this.bindTo(id, 'selected_tab');\n        this.bindTo(id, 'selected_input');\n        this.bindTo(id, 'mute');\n        this.bindTo(id, 'volume');\n        this.bindTo(id, 'inputs', undefined, (l) => this._inputs.next(l));\n        this.bindTo(id, 'available_outputs', undefined, (l) =>\n            this._outputs.next(l)\n        );\n        this.bindTo(id, 'lights', undefined, (l) => this._lights.next(l));\n        this.bindTo(id, 'blinds', undefined, (l) => this._blinds.next(l));\n        this.bindTo(id, 'screen', undefined, (l) => this._screens.next(l));\n        this.bindTo(id, 'qsc_dial_number', undefined, (v) =>\n            this.updateProperty('phone', v)\n        );\n        this.bindTo(id, 'qsc_dial_bindings', undefined, (v) => {\n            if (v) {\n                this.bindTo(id, v.offhook_id, 'Mixer', (l) =>\n                    this.updateProperty('offhook', l)\n                );\n                this.bindTo(id, v.ringing_id, 'Mixer', (l) =>\n                    this.updateProperty('ringing', l)\n                );\n            }\n            this.updateProperty('dial_bindings', v);\n        });\n    }\n\n    /** Bind to changes on input or output sources */\n    private bindSources(type: 'input' | 'output', alias_list: string[]) {\n        const id = this._id.getValue();\n        if (!id) return;\n        for (const alias of alias_list) {\n            this.bindTo(id, `${type}/${alias}`, undefined, (d) =>\n                this.updateSourceData(type, alias, d)\n            );\n        }\n    }\n\n    /** Update listed data for given source */\n    private updateSourceData(\n        type: 'input' | 'output',\n        id: string,\n        data: HashMap\n    ) {\n        const list_observer =\n            type === 'input' ? this._input_data : this._output_data;\n        let list: any[] = [...list_observer.getValue()];\n        const index = list.findIndex((item) => item.id === id);\n        if (index >= 0) {\n            list.splice(index, 1, { id, ...data });\n        } else {\n            list.push({ id, ...data });\n        }\n        if (type === 'output') {\n            this._volume.next(list[0].volume || 0);\n            this._mute.next(!!list[0].mute);\n        }\n        list_observer.next(list);\n    }\n\n    /** List to binding */\n    private bindTo(\n        id: string,\n        name: string,\n        mod: string = 'System',\n        on_change: (v: any) => void = (v) => this.updateProperty(name, v)\n    ) {\n        const module = getModule(id, mod).binding(name);\n        this.subscription(\n            `listen:${name}`,\n            module.listen().subscribe(on_change)\n        );\n        const unbind = module.bind();\n        // setTimeout(() => this.subscription(`bind:${name}`, unbind), 300);\n    }\n\n    /** Update properties of the system data */\n    private updateProperty(name: string, value: any) {\n        if (this._ignore_changes.includes(name)) return;\n        const item = { ...this._system.getValue() };\n        item[name] = value;\n        this._system.next(item);\n    }\n\n    private _listenToSystemBinding(id: string, name: string) {\n        const mod = getModule(id, 'System');\n        const binding = mod.binding(name);\n        const unbind = binding.bind();\n        this.subscription(`binding:${name}`, unbind);\n        return binding.listen();\n    }\n}\n","import { Component } from '@angular/core';\nimport { CustomTooltipData } from '@placeos/components';\nimport { getModule } from '@placeos/ts-client';\n\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'room-accessory-tooltip',\n    template: `\n        <div\n            class=\"p-4 my-2 bg-white shadow rounded flex flex-col items-center space-y-2\"\n        >\n            <h3 class=\"mb-2 text-xl font-medium\">Room Accessories</h3>\n            <ng-container *ngIf=\"(list | async)?.length; else empty_state\">\n                <div\n                    class=\"flex items-center space-x-2 w-full\"\n                    *ngFor=\"let item of list | async\"\n                >\n                    <div class=\"flex-1 pr-8 font-medium\">{{ item.name }}</div>\n                    <button\n                        state\n                        icon\n                        matRipple\n                        *ngFor=\"let ctrl of item.controls\"\n                        class=\"border border-solid border-primary text-primary rounded\"\n                        (click)=\"\n                            performAction(\n                                item.module,\n                                ctrl.function_name,\n                                ctrl.arguments\n                            )\n                        \"\n                    >\n                        <app-icon>{{ ctrl.icon }}</app-icon>\n                    </button>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"flex items-center justify-center p-8\">\n                <p>No room accessories available to control</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class RoomAccessoryTooltipComponent {\n    public readonly list = this._state.room_accessories;\n    /** Close the tooltip */\n    public readonly close = () => this._tooltip.close();\n\n    public get id(): string {\n        return this._state.id;\n    }\n\n    constructor(\n        private _state: ControlStateService,\n        private _tooltip: CustomTooltipData\n    ) {}\n\n    public performAction(module: string, method: string, args: any[]) {\n        const mod = getModule(this.id, module);\n        if (!mod) return;\n        mod.execute(method, args);\n    }\n}\n","import {\n    Component,\n    ElementRef,\n    EventEmitter,\n    Input,\n    Output,\n    Renderer2,\n    ViewChild,\n} from '@angular/core';\nimport { Point } from '@placeos/svg-viewer';\nimport { AsyncHandler } from '@placeos/common';\n\n/**\n * Grab point details from mouse or touch event\n * @param event Event to grab details from\n */\nexport function eventToPoint(event: MouseEvent | TouchEvent): Point {\n    if (!event) {\n        return { x: -1, y: -1 };\n    }\n    if (event instanceof MouseEvent) {\n        return { x: event.clientX, y: event.clientY };\n    }\n    return event.touches && event.touches.length > 0\n        ? { x: event.touches[0].clientX, y: event.touches[0].clientY }\n        : { x: -1, y: -1 };\n}\n\nexport enum JoystickTilt {\n    Down = 'down',\n    Up = 'up',\n    Stop = 'stop',\n}\n\nexport enum JoystickPan {\n    Left = 'left',\n    Right = 'right',\n    Stop = 'stop',\n}\n\n@Component({\n    selector: 'joystick',\n    template: `\n        <div\n            #panning_control\n            joystick\n            (mousedown)=\"startPan($event)\"\n            (touchstart)=\"startPan($event)\"\n            (contextmenu)=\"$event.preventDefault()\"\n            class=\"relative h-48 w-48 rounded-full bg-gray-600 text-white\"\n        >\n            <div class=\"absolute inset-0 flex text-5xl items-center\">\n                <app-icon style=\"transform: translateX(-.5rem)\">\n                    chevron_left\n                </app-icon>\n            </div>\n            <div\n                class=\"absolute inset-0 flex text-5xl items-center justify-end\"\n            >\n                <app-icon style=\"transform: translateX(.5rem)\"\n                    >chevron_right</app-icon\n                >\n            </div>\n            <div class=\"absolute inset-0 flex text-5xl justify-center\">\n                <app-icon style=\"transform: translateY(-.5rem)\"\n                    >expand_less</app-icon\n                >\n            </div>\n            <div\n                class=\"absolute inset-0 flex text-5xl items-end justify-center\"\n            >\n                <app-icon style=\"transform: translateY(.5rem)\"\n                    >expand_more</app-icon\n                >\n            </div>\n            <div\n                class=\"absolute top-12 left-12 right-12 bottom-12 bg-white rounded-full flex items-center justify-center\"\n            >\n                <div\n                    thumb\n                    [style.transform]=\"thumb_transform\"\n                    class=\"bg-black h-12 w-12 rounded-full\"\n                ></div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class JoystickComponent extends AsyncHandler {\n    @Input() public pan: JoystickPan;\n    @Input() public tilt: JoystickTilt;\n\n    @Output() public panChange = new EventEmitter<JoystickPan>();\n    @Output() public tiltChange = new EventEmitter<JoystickTilt>();\n\n    @ViewChild('panning_control', { static: true })\n    private _panning_el: ElementRef<HTMLDivElement>;\n\n    private _box: ClientRect;\n\n    constructor(private _renderer: Renderer2) {\n        super();\n    }\n\n    public get thumb_transform() {\n        return `translate(${\n            this.pan === JoystickPan.Stop\n                ? '0'\n                : this.pan === JoystickPan.Left\n                ? '-50'\n                : '50'\n        }%, ${\n            this.tilt === JoystickTilt.Stop\n                ? '0'\n                : this.tilt === JoystickTilt.Up\n                ? '-50'\n                : '50'\n        }%)`;\n    }\n\n    public startPan(event: MouseEvent | TouchEvent) {\n        const move_event =\n            event instanceof MouseEvent ? 'mousemove' : 'touchmove';\n        const end_event = event instanceof MouseEvent ? 'mouseup' : 'touchend';\n        this._box = this._panning_el.nativeElement.getBoundingClientRect();\n        this.subscription(\n            'on_move',\n            this._renderer.listen('window', move_event, (e) =>\n                this.handlePan(e)\n            )\n        );\n        this.subscription(\n            'on_end',\n            this._renderer.listen('window', end_event, (_) => {\n                this.unsub('on_move');\n                this.unsub('on_end');\n                this.tilt = JoystickTilt.Stop;\n                this.pan = JoystickPan.Stop;\n                this.tiltChange.emit(this.tilt);\n                this.panChange.emit(this.pan);\n            })\n        );\n        this.handlePan(event);\n    }\n\n    public handlePan(event: MouseEvent | TouchEvent) {\n        const point = eventToPoint(event);\n        const box_point = {\n            y: this._box.top + this._box.height / 2,\n            x: this._box.left + this._box.width / 2,\n        };\n        const angle =\n            (Math.atan2(point.y - box_point.y, point.x - box_point.x) * 180) /\n            Math.PI;\n        const { tilt, pan } = this;\n        this.tilt =\n            angle >= 150 || angle <= -150 || (angle > -30 && angle < 30)\n                ? JoystickTilt.Stop\n                : angle > 0\n                ? JoystickTilt.Down\n                : JoystickTilt.Up;\n        this.pan =\n            (angle >= 60 && angle <= 120) || (angle <= -60 && angle >= -120)\n                ? JoystickPan.Stop\n                : angle > 90 || angle < -90\n                ? JoystickPan.Left\n                : JoystickPan.Right;\n        if (tilt !== this.tilt) this.tiltChange.emit(this.tilt);\n        if (pan !== this.pan) this.panChange.emit(this.pan);\n    }\n}\n","import { Component, Renderer2 } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { CustomTooltipData } from '@placeos/components';\nimport { getModule } from '@placeos/ts-client';\nimport { combineLatest } from 'rxjs';\n\nimport { ControlStateService, RoomInput } from '../control-state.service';\nimport { JoystickPan, JoystickTilt } from './joystick.component';\n\nexport enum ZoomDirection {\n    In = 'in',\n    Out = 'out',\n    Stop = 'stop',\n}\n@Component({\n    selector: 'camera-tooltip',\n    template: `\n        <div\n            class=\"my-2 bg-white shadow rounded flex flex-col\"\n            *ngIf=\"(camera_list | async)?.length; else empty_state\"\n        >\n            <mat-form-field appearance=\"outline\" class=\"m-4 h-12\">\n                <mat-select\n                    [(ngModel)]=\"active_camera\"\n                    (ngModelChange)=\"selectCamera($event)\"\n                    placeholder=\"Select Camera\"\n                >\n                    <mat-option\n                        *ngFor=\"let cam of camera_list | async\"\n                        [value]=\"cam\"\n                    >\n                        {{ cam.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <div class=\"flex relative border-t border-gray-400 mt-1\">\n                <div\n                    class=\"flex flex-col items-center border-r border-gray-400 p-4 space-y-2 relative\"\n                >\n                    <h3 class=\"mb-2 text-xl font-medium pr-12\">Presets</h3>\n                    <ng-container *ngIf=\"presets?.length; else no_presets\">\n                        <div\n                            class=\"flex items-center space-x-2\"\n                            *ngFor=\"let name of presets\"\n                        >\n                            <button\n                                preset\n                                btn\n                                matRipple\n                                class=\"w-48\"\n                                [class.inverse]=\"preset === name\"\n                                (click)=\"recallPreset(name)\"\n                            >\n                                {{ name }}\n                            </button>\n                            <button\n                                icon\n                                matRipple\n                                *ngIf=\"presets?.length > 1\"\n                                class=\"rounded bg-error text-white\"\n                                (click)=\"removePreset(name)\"\n                            >\n                                <app-icon>delete</app-icon>\n                            </button>\n                        </div>\n                    </ng-container>\n                    <ng-template #no_presets>\n                        <p>No presets for this camera</p>\n                    </ng-template>\n                    <button\n                        icon\n                        matRipple\n                        class=\"absolute top-1 right-4\"\n                        [matMenuTriggerFor]=\"menu\"\n                    >\n                        <app-icon>add</app-icon>\n                    </button>\n                    <mat-menu #menu=\"matMenu\">\n                        <div class=\"px-2 w-full flex flex-col\">\n                            <mat-form-field\n                                appearance=\"outline\"\n                                class=\"w-full h-[3.5rem]\"\n                                (click)=\"$event.stopPropagation()\"\n                            >\n                                <input\n                                    matInput\n                                    [(ngModel)]=\"new_preset\"\n                                    placeholder=\"New preset name\"\n                                />\n                            </mat-form-field>\n                            <button\n                                btn\n                                matRipple\n                                [disabled]=\"!new_preset\"\n                                class=\"w-full\"\n                                (click)=\"addPreset(new_preset); new_preset = ''\"\n                            >\n                                Save Preset\n                            </button>\n                        </div>\n                    </mat-menu>\n                </div>\n                <div class=\"p-4\">\n                    <h3 class=\"mb-2 text-xl font-medium\">Controls</h3>\n                    <div class=\"flex items-center space-x-2\">\n                        <joystick\n                            [(pan)]=\"pan\"\n                            [(tilt)]=\"tilt\"\n                            (panChange)=\"moveCamera()\"\n                            (tiltChange)=\"moveCamera()\"\n                        ></joystick>\n                        <div\n                            zoom\n                            class=\"flex flex-col items-center border border-gray-600 rounded\"\n                        >\n                            <button\n                                zoom-in\n                                icon\n                                matRipple\n                                class=\"rounded\"\n                                (mousedown)=\"startZoom('in', $event)\"\n                                (touchstart)=\"startZoom('in', $event)\"\n                                (contextmenu)=\"$event.preventDefault()\"\n                            >\n                                <app-icon>add</app-icon>\n                            </button>\n                            <div\n                                class=\"text-xs h-10 w-10 flex items-center justify-center border-t border-b border-gray-600\"\n                            >\n                                Zoom\n                            </div>\n\n                            <button\n                                zoom-out\n                                icon\n                                matRipple\n                                class=\"rounded\"\n                                (mousedown)=\"startZoom('out', $event)\"\n                                (touchstart)=\"startZoom('out', $event)\"\n                                (contextmenu)=\"$event.preventDefault()\"\n                            >\n                                <app-icon>remove</app-icon>\n                            </button>\n                        </div>\n                    </div>\n                </div>\n                <div\n                    class=\"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center\"\n                    *ngIf=\"!active_camera\"\n                >\n                    <p>Select a camera to control.</p>\n                </div>\n            </div>\n        </div>\n        <div hidden *ngIf=\"active_camera?.mod\">\n            <i\n                binding\n                (modelChange)=\"\n                    presets = active_camera.index\n                        ? ($event || [])[active_camera.index]\n                        : $event\n                \"\n                [sys]=\"id\"\n                [mod]=\"active_camera.mod\"\n                [bind]=\"active_camera.index ? 'camera_presets' : 'presets'\"\n            ></i>\n        </div>\n        <ng-template #empty_state>\n            <div\n                class=\"my-2 bg-white shadow rounded flex flex-col p-8 text-center\"\n            >\n                <p>No cameras available for this system</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class CameraTooltipComponent extends AsyncHandler {\n    /** Currently active camera */\n    public active_camera: RoomInput;\n    /** List of available presets for the active camera */\n    public presets: string[] = [];\n    /** Currently active preset */\n    public preset: string = '';\n    /** Current zoom value for camera */\n    public zoom: ZoomDirection = ZoomDirection.Stop;\n    /** Current panning value for camera */\n    public pan: JoystickPan = JoystickPan.Stop;\n    /** Current tilting value for camera */\n    public tilt: JoystickTilt = JoystickTilt.Stop;\n    /** List of available cameras to select from */\n    public readonly camera_list = this._state.camera_list;\n    /** Close the tooltip */\n    public readonly close = () => this._tooltip.close();\n\n    public get id(): string {\n        return this._state.id;\n    }\n\n    constructor(\n        private _state: ControlStateService,\n        private _tooltip: CustomTooltipData,\n        private _renderer: Renderer2\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'camera_list',\n            combineLatest([\n                this.camera_list,\n                this._state.selected_camera,\n            ]).subscribe(([l, cam]) => {\n                if (!l?.length) return;\n                this.active_camera =\n                    l.find((_) => _.id === cam) || this.active_camera || l[0];\n            })\n        );\n    }\n\n    public selectCamera(camera: RoomInput) {\n        const mod = getModule(this.id, 'System');\n        if (!mod) return;\n        mod.execute('selected_camera', [camera.id]);\n    }\n\n    public recallPreset(preset: string) {\n        const mod = getModule(this.id, this.active_camera.mod);\n        if (!mod) return;\n        mod.execute('recall', [preset]);\n    }\n\n    public addPreset(preset: string) {\n        const mod = getModule(this.id, 'System');\n        if (!mod) return;\n        mod.execute('add_preset', [preset, this.active_camera.id]);\n    }\n\n    public removePreset(preset: string) {\n        const mod = getModule(this.id, 'System');\n        if (!mod) return;\n        mod.execute('remove_preset', [preset, this.active_camera.id]);\n    }\n\n    public moveCamera() {\n        if (!this.active_camera) return;\n        this.timeout(\n            'move',\n            async () => {\n                const { index } = this.active_camera;\n                const mod = getModule(this.id, this.active_camera.mod);\n                if (!mod) return;\n                await mod.execute('stop', index ? [index] : []);\n                if (this.tilt !== JoystickTilt.Stop)\n                    await mod.execute(\n                        'tilt',\n                        index ? [this.tilt, index] : [this.tilt]\n                    );\n                if (this.pan !== JoystickPan.Stop)\n                    await mod.execute(\n                        'pan',\n                        index ? [this.pan, index] : [this.pan]\n                    );\n            },\n            50\n        );\n    }\n\n    public async startZoom(dir: 'in' | 'out', e: MouseEvent | TouchEvent) {\n        const mod = getModule(this.id, this.active_camera.mod);\n        if (!mod) return;\n        const end_event = e instanceof MouseEvent ? 'mouseup' : 'touchend';\n        this.zoom = dir === 'in' ? ZoomDirection.In : ZoomDirection.Out;\n        const { index } = this.active_camera;\n        await mod.execute('zoom', index ? [this.zoom, index] : [this.zoom]);\n        this.subscription(\n            'on_end',\n            this._renderer.listen('window', end_event, (_) => {\n                this.unsub('on_move');\n                this.unsub('on_end');\n                this.zoom = ZoomDirection.Stop;\n                mod.execute('zoom', index ? [this.zoom, index] : [this.zoom]);\n            })\n        );\n    }\n}\n","import { Component } from '@angular/core';\nimport { map } from 'rxjs/operators';\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'join-room-tooltip',\n    template: `\n        <div\n            class=\"p-4 my-2 bg-white shadow rounded flex flex-col items-center space-y-2\"\n        >\n            <h3 class=\"mb-2 font-medium text-center\">Join Rooms</h3>\n            <button\n                btn\n                matRipple\n                *ngFor=\"let mode of modes | async\"\n                (click)=\"join(mode.id)\"\n                [class.inverse]=\"mode.id !== (active | async)\"\n                class=\"w-64\"\n            >\n                {{ mode.name }}\n            </button>\n        </div>\n    `,\n    styles: [``],\n})\nexport class JoinRoomTooltipComponent {\n    public readonly modes = this._state.join_modes.pipe(\n        map((mapping) => {\n            const list = [];\n            for (const id in mapping) {\n                list.push({\n                    ...mapping[id],\n                    id,\n                });\n            }\n            return list;\n        })\n    );\n    public readonly active = this._state.joined_id;\n    public readonly join = (id) => this._state.join(id);\n\n    constructor(private _state: ControlStateService) {}\n}\n","import { Component } from '@angular/core';\nimport { CustomTooltipData } from '@placeos/components';\nimport { getModule } from '@placeos/ts-client';\n\nimport { ControlStateService, LightScene } from '../control-state.service';\n\n@Component({\n    selector: 'lighting-tooltip',\n    template: `\n        <div\n            class=\"p-4 my-2 bg-white shadow rounded flex flex-col items-center space-y-2\"\n        >\n            <h3 class=\"mb-2 text-xl font-medium\">Lighting Scenes</h3>\n            <ng-container *ngIf=\"(scenes | async).length; else empty_state\">\n                <button\n                    state\n                    btn\n                    matRipple\n                    class=\"w-64\"\n                    *ngFor=\"let item of scenes | async\"\n                    [class.inverse]=\"(scene | async) !== item.id\"\n                    (click)=\"setScene(item.name)\"\n                >\n                    <div class=\"flex flex-1 items-center space-x-4\">\n                        <app-icon [style.opacity]=\"item.opacity || 1\">{{\n                            item.icon\n                        }}</app-icon>\n                        <div class=\"flex-1\">{{ item.name }}</div>\n                    </div>\n                </button>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"flex items-center justify-center p-8\">\n                <p>No scenes available for lighting</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class LightingSceneTooltipComponent {\n    public readonly scene = this._state.lighting_scene;\n    public readonly scenes = this._state.lighting_scenes;\n    /** Close the tooltip */\n    public readonly close = () => this._tooltip.close();\n\n    public get id(): string {\n        return this._state.id;\n    }\n\n    constructor(\n        private _state: ControlStateService,\n        private _tooltip: CustomTooltipData\n    ) {}\n\n    public setScene(name: string) {\n        const mod = getModule(this.id, 'System');\n        if (!mod) return;\n        mod.execute('select_lighting_scene', [name]);\n    }\n}\n","import { Component } from '@angular/core';\nimport { CustomTooltipData } from '@placeos/components';\n\nimport {\n    ControlStateService,\n    EnvironmentSource,\n} from '../control-state.service';\n\n@Component({\n    selector: 'lighting-tooltip',\n    template: `\n        <div\n            class=\"p-4 my-2 bg-white shadow rounded flex flex-col items-center space-y-2\"\n        >\n            <div hidden *ngIf=\"!!(lights | async)[0]\">\n                <i\n                    binding\n                    [(model)]=\"light\"\n                    [sys]=\"id\"\n                    mod=\"System\"\n                    [bind]=\"'lights/' + (lights | async)[0]\"\n                ></i>\n            </div>\n            <h3 class=\"mb-2 text-xl font-medium\">Lighting Presets</h3>\n            <ng-container *ngIf=\"light?.states?.length; else empty_state\">\n                <button\n                    state\n                    btn\n                    matRipple\n                    class=\"w-64\"\n                    *ngFor=\"let state of light.states\"\n                    [class.inverse]=\"state === light.state\"\n                    binding\n                    onEvent=\"click\"\n                    [sys]=\"id\"\n                    mod=\"System\"\n                    exec=\"environment\"\n                    [params]=\"[(lights | async)[0], state]\"\n                >\n                    {{ state }}\n                </button>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"flex items-center justify-center p-8\">\n                <p>No presets available for lights</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class LightingTooltipComponent {\n    public light: EnvironmentSource;\n\n    public readonly lights = this._state.lights;\n    /** Close the tooltip */\n    public readonly close = () => this._tooltip.close();\n\n    public get id(): string {\n        return this._state.id;\n    }\n\n    constructor(\n        private _state: ControlStateService,\n        private _tooltip: CustomTooltipData\n    ) {}\n}\n","import { Component } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { CustomTooltipData } from '@placeos/components';\n\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'microphone-tooltip',\n    template: `\n        <div\n            class=\"p-4 my-2 bg-white shadow rounded flex flex-col items-center space-y-2 max-h-[65vh] overflow-x-hidden overflow-y-auto\"\n        >\n            <h3 class=\"mb-2 text-xl font-medium\">Microphones</h3>\n            <ng-container\n                *ngIf=\"\n                    (mic_list | async)?.length || (microphones | async)?.length;\n                    else empty_state\n                \"\n            >\n                <div *ngFor=\"let mic of mic_list | async\">\n                    <label [for]=\"mic.id\">{{ mic.name }}</label>\n                    <div\n                        class=\"flex items-center space-x-2 w-64\"\n                        [attr.name]=\"mic.id\"\n                    >\n                        <button\n                            mute\n                            icon\n                            matRipple\n                            (click)=\"mute[mic.id] = !mute[mic.id]\"\n                        >\n                            <app-icon>{{\n                                mute[mic.id]\n                                    ? 'volume_off'\n                                    : volume[mic.id] > 0\n                                    ? 'volume_up'\n                                    : 'volume_mute'\n                            }}</app-icon>\n                        </button>\n                        <mat-slider class=\"flex-1\">\n                            <input\n                                matSliderThumb\n                                [ngModel]=\"!mute[mic.id] ? volume[mic.id] : 0\"\n                                (ngModelChange)=\"\n                                    setVolume(mic.id, $event); onChange()\n                                \"\n                            />\n                        </mat-slider>\n                    </div>\n                    <div hidden *ngIf=\"mic?.mod\">\n                        <i\n                            binding\n                            [sys]=\"id\"\n                            [mod]=\"mic.mod\"\n                            bind=\"volume\"\n                            exec=\"volume\"\n                            [ignore]=\"changing\"\n                            [(model)]=\"volume[mic.id]\"\n                        ></i>\n                        <i\n                            binding\n                            [sys]=\"id\"\n                            [mod]=\"mic.mod\"\n                            bind=\"mute\"\n                            exec=\"mute\"\n                            [(model)]=\"mute[mic.id]\"\n                        ></i>\n                    </div>\n                </div>\n                <div *ngFor=\"let mic of microphones | async; let i = index\">\n                    <label [for]=\"mic.name\">{{ mic.name }}</label>\n                    <div\n                        class=\"flex items-center space-x-2 w-64\"\n                        [attr.name]=\"mic.name\"\n                    >\n                        <button\n                            mute\n                            icon\n                            matRipple\n                            [disabled]=\"!mic.mute_id?.length\"\n                            (click)=\"mute[i] = !mute[i]\"\n                        >\n                            <app-icon>{{\n                                mute[i]\n                                    ? 'volume_off'\n                                    : volume[i] > 0\n                                    ? 'volume_up'\n                                    : 'volume_mute'\n                            }}</app-icon>\n                        </button>\n                        <mat-slider\n                            [disabled]=\"!mic.level_id?.length\"\n                            [min]=\"mic.min_level || 0\"\n                            [max]=\"mic.max_level || 100\"\n                            class=\"flex-1\"\n                        >\n                            <input\n                                matSliderThumb\n                                [ngModel]=\"!mute[i] ? volume[i] : 0\"\n                                (ngModelChange)=\"\n                                    setVolume(i, $event); onChange()\n                                \"\n                        /></mat-slider>\n                    </div>\n                    <div hidden *ngIf=\"mic.module_id\">\n                        <i\n                            binding\n                            [sys]=\"id\"\n                            [mod]=\"mic.module_id\"\n                            [bind]=\"mic.level_feedback\"\n                            exec=\"fader\"\n                            [ignore]=\"changing\"\n                            [params]=\"[mic.level_id, volume[i]]\"\n                            [(model)]=\"volume[i]\"\n                        ></i>\n                        <i\n                            binding\n                            [sys]=\"id\"\n                            [mod]=\"mic.module_id\"\n                            [bind]=\"mic.mute_feedback\"\n                            exec=\"mute\"\n                            [params]=\"[mic.mute_id, mute[i]]\"\n                            [(model)]=\"mute[i]\"\n                        ></i>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"flex items-center justify-center p-8\">\n                <p>No microphones available for system</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class MicrophoneTooltipComponent extends AsyncHandler {\n    /** List of microphone inputs */\n    public readonly mic_list = this._state.mic_list;\n    /** List of microphones */\n    public readonly microphones = this._state.microphones;\n    /** Mapping of microphones to their volume */\n    public readonly volume = {};\n    /** Mapping of microphones to their mute state */\n    public readonly mute = {};\n    /** Close the tooltip */\n    public readonly close = () => this._tooltip.close();\n\n    public changing = false;\n\n    public get id(): string {\n        return this._state.id;\n    }\n\n    constructor(\n        private _state: ControlStateService,\n        private _tooltip: CustomTooltipData\n    ) {\n        super();\n    }\n\n    public setVolume(idx: number, value: number) {\n        this.volume[idx] = value;\n        this.mute[idx] = false;\n    }\n\n    public onChange() {\n        this.changing = true;\n        this.timeout('change', () => (this.changing = false), 1000);\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\n\n@Component({\n    selector: 'dialpad',\n    template: `\n        <div dialpad class=\"w-60 flex flex-wrap justify-center items-center relative\">\n            <button\n                digit\n                matRipple\n                *ngFor=\"let digit of digits\"\n                class=\"relative bg-white h-16 w-16 flex rounded-lg items-center justify-center m-2 active:top-1\"\n                (click)=\"pressed.emit(digit)\"\n            >\n                {{ digit }}\n            </button>\n            <button\n                digit\n                matRipple\n                *ngIf=\"backspace\"\n                class=\"active:-bottom-1 bg-white h-16 flex-1 flex rounded-lg items-center justify-center m-2 w-60\"\n                [class.absolute]=\"!inline\"\n                [class.bottom-0]=\"!inline\"\n                [class.-right-4]=\"!inline\"\n                [class.translate-x-full]=\"!inline\"\n                (click)=\"pressed.emit('\\b')\"\n            >\n                Backspace\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            [digit] {\n                box-shadow: 0px 4px 0px 0px #ccc;\n                border: 2px solid #ccc;\n                transition: top 200ms, bottom 200ms, box-shadow 200ms;\n                color: black !important;\n            }\n\n            [digit]:active {\n                box-shadow: none;\n            }\n        `,\n    ],\n})\nexport class DialpadComponent {\n    @Input() public backspace = true;\n    @Input() public inline = false;\n    @Output() public pressed = new EventEmitter<string>();\n\n    // prettier-ignore\n    public readonly digits = [\n        '1', '2', '3',\n        '4', '5', '6',\n        '7', '8', '9',\n        '*', '0', '#',\n    ];\n}\n","import { Component } from '@angular/core';\nimport { getModule } from '@placeos/ts-client';\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'phone-dialling-tooltip',\n    template: `\n        <div\n            class=\"p-4 my-2 bg-white shadow rounded flex flex-col items-center space-y-2\"\n        >\n            <mat-form-field appearance=\"outline\" class=\"w-full h-[3.25rem]\">\n                <input\n                    matInput\n                    readonly\n                    [ngModel]=\"(system | async)?.phone\"\n                    placeholder=\"Phone Number\"\n                />\n                <button\n                    *ngIf=\"(system | async)?.phone\"\n                    icon\n                    matRipple\n                    matSuffix\n                    (click)=\"clear()\"\n                >\n                    <app-icon>close</app-icon>\n                </button>\n            </mat-form-field>\n            <dialpad [inline]=\"true\" (pressed)=\"handleInput($event)\"></dialpad>\n            <button\n                btn\n                matRipple\n                class=\"w-full\"\n                (click)=\"dialPhone()\"\n                *ngIf=\"\n                    !((system | async)?.offhook || (system | async)?.ringing)\n                \"\n            >\n                Dial Phone\n            </button>\n            <button\n                *ngIf=\"(system | async)?.offhook || (system | async)?.ringing\"\n                btn\n                matRipple\n                class=\"w-full inverse\"\n                (click)=\"hangup()\"\n            >\n                Hangup\n            </button>\n        </div>\n    `,\n    styles: [``],\n})\nexport class PhoneDiallingTooltipComponent {\n    public phone = '';\n    public system = this._state.system;\n\n    public get sys_id() {\n        return this._state.id;\n    }\n\n    public async handleInput(char: string) {\n        const mod = getModule(this._state.id, 'System');\n        await mod.execute('qsc_dial_pad', [char]);\n    }\n\n    public async action(method: string) {\n        const mod = getModule(this._state.id, 'System');\n        await mod.execute(method);\n    }\n\n    public readonly dialPhone = () => this.action('qsc_dial_makecall');\n    public readonly hangup = () => this.action('qsc_dial_hangup');\n    public readonly clear = () => this.action('qsc_dial_pad_clear');\n\n    constructor(private _state: ControlStateService) {}\n}\n","import { Component } from '@angular/core';\nimport { CustomTooltipData } from '@placeos/components';\n\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'power-tooltip',\n    template: `\n        <div\n            class=\"p-4 my-2 bg-white shadow rounded flex flex-col items-center space-y-2\"\n        >\n            <h3 class=\"mb-2 font-medium text-center\">\n                Are you sure you want to shutdown <br />the system?\n            </h3>\n            <button btn matRipple class=\"w-64\" (click)=\"shutdown()\">\n                Yes, I'm sure\n            </button>\n            <button\n                btn\n                matRipple\n                class=\"w-64\"\n                *ngIf=\"(joined | async)?.room_ids?.length > 1\"\n                (click)=\"shutdown(true)\"\n            >\n                Yes, also unlink joined rooms\n            </button>\n            <button btn matRipple class=\"w-64 inverse\" (click)=\"close()\">\n                No, go back\n            </button>\n        </div>\n    `,\n    styles: [``],\n})\nexport class PowerTooltipComponent {\n    /** Shutdown the system */\n    public readonly shutdown = (t = false) => this._state.powerOff(t);\n    /** Close the tooltip */\n    public readonly close = () => this._tooltip.close();\n\n    public readonly joined = this._state.joined;\n\n    constructor(\n        private _state: ControlStateService,\n        private _tooltip: CustomTooltipData\n    ) {}\n}\n","import { Injectable } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { getModule } from '@placeos/ts-client';\nimport {\n    VideoCallDetails,\n    VideoLayout,\n} from 'libs/mocks/src/lib/realtime/video-conference';\nimport { Observable } from 'rxjs';\nimport {\n    distinctUntilChanged,\n    map,\n    shareReplay,\n    switchMap,\n    take,\n} from 'rxjs/operators';\nimport { ControlStateService } from '../control-state.service';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class VideoCallStateService extends AsyncHandler {\n    public readonly connected: Observable<VideoCallDetails | null> =\n        this._control.system_id.pipe(\n            distinctUntilChanged(),\n            switchMap((id) => this.bindTo(id, 'connected')),\n            shareReplay(1)\n        );\n    public readonly call: Observable<VideoCallDetails | null> =\n        this._control.system_id.pipe(\n            distinctUntilChanged(),\n            switchMap((id) => this.bindTo(id, 'calls')),\n            map((_) => {\n                for (const key in _) {\n                    if (_[key].Status) return _[key];\n                }\n                return null;\n            }),\n            shareReplay(1)\n        );\n    public readonly mic_mute: Observable<VideoCallDetails | null> =\n        this._control.system_id.pipe(\n            distinctUntilChanged(),\n            switchMap((id) => this.bindTo(id, 'mic_mute')),\n            shareReplay(1)\n        );\n    public readonly presentation_mode: Observable<VideoCallDetails | null> =\n        this._control.system_id.pipe(\n            distinctUntilChanged(),\n            switchMap((id) => this.bindTo(id, 'presentation_mode')),\n            shareReplay(1)\n        );\n    public readonly video_layout: Observable<VideoCallDetails | null> =\n        this._control.system_id.pipe(\n            distinctUntilChanged(),\n            switchMap((id) => this.bindTo(id, 'video_layout')),\n            shareReplay(1)\n        );\n    public readonly show_camera_pip: Observable<VideoCallDetails | null> =\n        this._control.system_id.pipe(\n            distinctUntilChanged(),\n            switchMap((id) => this.bindTo(id, 'selfview')),\n            shareReplay(1)\n        );\n    public readonly speaker_track: Observable<boolean> =\n        this._control.system_id.pipe(\n            distinctUntilChanged(),\n            switchMap((id) => this.bindTo(id, 'speaker_track')),\n            map((_) => (_ || {})['Status/Cameras/SpeakerTrack/Availability']),\n            shareReplay(1)\n        );\n\n    constructor(private _control: ControlStateService) {\n        super();\n    }\n\n    public async showCameraPIP(state: boolean) {\n        const id = this._control.id;\n        if (!id) return;\n        return getModule(id, 'VidConf').execute('show_camera_pip', [state]);\n    }\n\n    public async muteMicrophone(state: boolean) {\n        const id = this._control.id;\n        if (!id) return;\n        return getModule(id, 'VidConf').execute('mic_mute', [state]);\n    }\n\n    public async setVideoLayout(layout: VideoLayout) {\n        const id = this._control.id;\n        if (!id) return;\n        return getModule(id, 'VidConf').execute('video_layout', [layout]);\n    }\n\n    public async setPresentationMode(mod: 'None' | 'Local' | 'Remote') {\n        const id = this._control.id;\n        if (!id) return;\n        return getModule(id, 'VidConf').execute('presentation_mode', [mod]);\n    }\n\n    public async hangup() {\n        const id = this._control.id;\n        if (!id) return;\n        return getModule(id, 'VidConf').execute('hangup', []);\n    }\n\n    public async sendDTMF(digit: string) {\n        const id = this._control.id;\n        if (!id) return;\n        return getModule(id, 'VidConf').execute('dtmf_send', [digit]);\n    }\n\n    public async toggleCallOnHold() {\n        const id = this._control.id;\n        if (!id) return;\n        const call = await this.call.pipe(take(1)).toPromise();\n        if (!call) return;\n        return getModule(id, 'VidConf').execute(\n            call.Status === 'OnHold' ? 'call_resume' : 'call_place_on_hold',\n            []\n        );\n    }\n\n    private bindTo(id: string, name: string, mod_name: string = 'VidConf') {\n        const mod = getModule(id, mod_name);\n        const binding = mod.binding(name);\n        const unbind = binding.bind();\n        this.subscription(`binding:${name}`, unbind);\n        return binding.listen();\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { getModule } from '@placeos/ts-client';\nimport { take } from 'rxjs/operators';\nimport { ControlStateService, RoomInput } from '../control-state.service';\nimport { VideoCallStateService } from './video-call-state.service';\n\n@Component({\n    selector: 'video-call-dial-view',\n    template: `\n        <div class=\"flex justify-center\">\n            <ng-container *ngIf=\"!loading; else load_state\" class=\"\">\n                <dialpad (pressed)=\"addDigit($event)\"></dialpad>\n                <div class=\"flex flex-col\" [class.pt-8]=\"!redirect\">\n                    <p class=\"px-2 pt-4\">Enter your video conference code</p>\n                    <div class=\"p-2 w-full\">\n                        <mat-form-field\n                            appearance=\"outline\"\n                            class=\"h-12 w-full\"\n                        >\n                            <input\n                                matInput\n                                [(ngModel)]=\"dial_number\"\n                                placeholder=\"Dial number...\"\n                            />\n                        </mat-form-field>\n                    </div>\n                    <div class=\"p-2 w-full\">\n                        <button\n                            btn\n                            matRipple\n                            class=\"w-full\"\n                            [disabled]=\"!dial_number\"\n                            (click)=\"joinConference()\"\n                        >\n                            Join\n                        </button>\n                    </div>\n                    <div class=\"px-2 w-full\">\n                        <button\n                            btn\n                            matRipple\n                            class=\"w-full\"\n                            (click)=\"toggleCamera()\"\n                            [class.inverse]=\"show_camera_pip | async\"\n                        >\n                            <div class=\"flex items-center space-x-4\">\n                                <app-icon>{{\n                                    !(show_camera_pip | async)\n                                        ? 'visibility_off'\n                                        : 'visibility'\n                                }}</app-icon>\n                                <span>{{\n                                    (show_camera_pip | async)\n                                        ? 'Hide Camera PIP'\n                                        : 'Show Camera PIP'\n                                }}</span>\n                            </div>\n                        </button>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #load_state>\n            <div\n                class=\"flex flex-col items-center justify-center p-16 space-y-2\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>Joining video conference...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class VideoCallDialViewComponent {\n    @Input() public redirect = true;\n    @Output() public close = new EventEmitter<void>();\n\n    public dial_number = '';\n    public loading = false;\n    public readonly call = this._call.call;\n    public readonly show_camera_pip = this._call.show_camera_pip;\n\n    public readonly toggleCamera = async () =>\n        this._call.showCameraPIP(\n            !(await this.show_camera_pip.pipe(take(1)).toPromise())\n        );\n\n    public get id() {\n        return this._control.id;\n    }\n\n    constructor(\n        private _control: ControlStateService,\n        private _call: VideoCallStateService,\n        private _router: Router,\n        private _route: ActivatedRoute\n    ) {}\n\n    public addDigit(digit: string) {\n        digit && digit !== '\\b'\n            ? (this.dial_number += digit)\n            : (this.dial_number = this.dial_number.substr(\n                  0,\n                  this.dial_number.length - 1\n              ));\n    }\n\n    public async joinConference() {\n        if (!this.dial_number) return;\n        const system_id = this._control.id;\n        const mod = getModule(system_id, 'VidConf');\n        this.loading = true;\n        await mod.execute('dial', [this.dial_number]);\n        this.loading = false;\n        if (this.redirect) {\n            this._router.navigate(['call'], { relativeTo: this._route });\n        }\n        this.close.emit();\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { CustomTooltipData } from '@placeos/components';\nimport { getModule } from '@placeos/ts-client';\nimport { take } from 'rxjs/operators';\nimport { ControlStateService } from '../control-state.service';\nimport { VideoCallStateService } from '../video-call/video-call-state.service';\n\n@Component({\n    selector: 'video-conf-tooltip',\n    template: `\n        <div\n            class=\" my-2 bg-white shadow rounded flex flex-col items-center\"\n            *ngIf=\"!(call | async); else enabled_state\"\n        >\n            <video-call-dial-view (close)=\"close()\"></video-call-dial-view>\n        </div>\n        <ng-template #enabled_state>\n            <div\n                class=\" my-2 p-2 bg-white shadow rounded flex flex-col items-center space-y-2\"\n            >\n                <h3 class=\"p-2 w-full text-center font-medium\">In Call</h3>\n                <a\n                    button\n                    btn\n                    matRipple\n                    class=\"w-40\"\n                    [routerLink]=\"['/panel', id, 'call']\"\n                    routerLinkActive=\"inverse\"\n                >\n                    View Call\n                </a>\n                <a\n                    button\n                    btn\n                    matRipple\n                    class=\"w-40\"\n                    [routerLink]=\"['/panel', id]\"\n                    [routerLinkActiveOptions]=\"{ exact: true }\"\n                    routerLinkActive=\"inverse\"\n                >\n                    View Inputs\n                </a>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class VideoConferenceTooltipComponent {\n    public dial_number = '';\n    public loading = false;\n    public readonly call = this._vc_state.call;\n\n    constructor(\n        private _vc_state: VideoCallStateService,\n        @Inject(CustomTooltipData) private _ref: any\n    ) {}\n\n    public addDigit(digit: string) {\n        this.dial_number += digit;\n    }\n\n    public close() {\n        this._ref.close();\n    }\n}\n","import { Component } from '@angular/core';\nimport { AsyncHandler, SettingsService } from '@placeos/common';\nimport { isTrusted } from '@placeos/ts-client';\nimport { combineLatest } from 'rxjs';\nimport { ControlStateService } from './control-state.service';\nimport { RoomAccessoryTooltipComponent } from './ui/room-accessory-tooltip.component';\nimport { CameraTooltipComponent } from './ui/camera-tooltip.component';\nimport { JoinRoomTooltipComponent } from './ui/join-room-tooltip.component';\nimport { LightingSceneTooltipComponent } from './ui/lighting-scene-tooltip.component';\nimport { LightingTooltipComponent } from './ui/lighting-tooltip.component';\nimport { MicrophoneTooltipComponent } from './ui/microphone-tooltip.component';\nimport { PhoneDiallingTooltipComponent } from './ui/phone-dialling-tooltip.component';\nimport { PowerTooltipComponent } from './ui/power-tooltip.component';\nimport { VideoConferenceTooltipComponent } from './ui/video-conf-tooltip.component';\nimport { VideoCallStateService } from './video-call/video-call-state.service';\n\nenum TOOLTIP {\n    PHONE,\n    VC,\n    MEET,\n    LIGHT_SCENES,\n    LIGHTS,\n    ACCESSORIES,\n    MICS,\n    CAMERA,\n    JOIN,\n    HELP,\n    POWER,\n}\n\n@Component({\n    selector: 'topbar-header',\n    template: `\n        <div class=\"flex-1 px-4\">\n            <img logo class=\"h-10\" [src]=\"logo?.src\" alt=\"Logo\" />\n        </div>\n        <div class=\"p-4 text-lg\">{{ (system | async).name }}</div>\n        <div\n            class=\"flex-1 p-4 items-center justify-end space-x-2 hidden sm:flex\"\n        >\n            <ng-container *ngFor=\"let item of action_list\">\n                <div customTooltip [content]=\"cmp[item.id]\" *ngIf=\"item.show\">\n                    <button\n                        icon\n                        matRipple\n                        [attr.type]=\"item.id\"\n                        [class.bg-success]=\"item.enabled\"\n                        (click)=\"item.action ? item.action() : ''\"\n                    >\n                        <app-icon>{{ item.icon }}</app-icon>\n                    </button>\n                </div>\n            </ng-container>\n        </div>\n        <button\n            icon\n            matRipple\n            [matMenuTriggerFor]=\"menu\"\n            class=\"sm:hidden mr-2 bg-none\"\n        >\n            <app-icon>more_vert</app-icon>\n        </button>\n        <mat-menu #menu=\"matMenu\">\n            <ng-container *ngFor=\"let item of action_list\">\n                <div\n                    customTooltip\n                    [content]=\"cmp[item.id]\"\n                    *ngIf=\"item.show\"\n                    (click)=\"\n                        $event.stopPropagation();\n                        item.action ? item.action() : ''\n                    \"\n                >\n                    <button [attr.type]=\"item.id\" mat-menu-item>\n                        <div class=\"flex items-center text-base\">\n                            <app-icon class=\"mr-2\">{{ item.icon }}</app-icon>\n                            <span>{{ item.name }}</span>\n                        </div>\n                    </button>\n                </div>\n            </ng-container>\n        </mat-menu>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n            }\n\n            img {\n                max-height: calc(100% - 1rem);\n            }\n\n            button {\n                border-radius: 0.25rem;\n                background-color: rgba(255, 255, 255, 0.15);\n            }\n        `,\n    ],\n})\nexport class TopbarHeaderComponent extends AsyncHandler {\n    public readonly system = this._state.system;\n    public readonly mic_list = this._state.mic_list;\n    public readonly camera_list = this._state.camera_list;\n    public readonly lights_list = this._state.lights;\n    public readonly blinds_list = this._state.blinds;\n\n    public readonly cmp = {\n        phone: PhoneDiallingTooltipComponent,\n        video_conf: VideoConferenceTooltipComponent,\n        lighting: LightingTooltipComponent,\n        lighting_scenes: LightingSceneTooltipComponent,\n        power: PowerTooltipComponent,\n        blinds: RoomAccessoryTooltipComponent,\n        camera: CameraTooltipComponent,\n        mics: MicrophoneTooltipComponent,\n        join: JoinRoomTooltipComponent,\n    };\n\n    public action_list = [\n        {\n            id: 'phone',\n            name: 'Phone',\n            icon: 'call',\n            show: true,\n        },\n        {\n            id: 'video_conf',\n            name: 'Video Conference',\n            icon: 'call',\n            show: true,\n        },\n        {\n            id: 'meet',\n            name: 'Join Meeting',\n            icon: 'video_call',\n            show: true,\n            action: () => this.selectMeeting(),\n        },\n        {\n            id: 'lighting_scenes',\n            name: 'Lighting Scenes',\n            icon: 'emoji_objects',\n            show: true,\n        },\n        {\n            id: 'lighting',\n            name: 'Lighting',\n            icon: 'brightness_high',\n            show: true,\n        },\n        { id: 'blinds', name: 'Accessories', icon: 'unfold_more', show: true },\n        { id: 'mics', name: 'Microphones', icon: 'mic', show: true },\n        { id: 'camera', name: 'Cameras', icon: 'photo_camera', show: true },\n        { id: 'join', name: 'Join Rooms', icon: 'link', show: true },\n        {\n            id: 'help',\n            name: 'Help',\n            icon: 'help',\n            show: true,\n            action: () => this.viewHelp(),\n        },\n        { id: 'power', name: 'Power', icon: 'power_settings_new', show: true },\n    ];\n\n    public readonly selectMeeting = () => this._state.selectMeeting();\n    public readonly viewHelp = () => this._state.viewHelp();\n    public readonly powerOff = () => this._state.powerOff();\n\n    public get logo() {\n        return this._settings.get('app.logo_dark') || {};\n    }\n\n    public get is_trusted() {\n        return isTrusted();\n    }\n\n    constructor(\n        private _settings: SettingsService,\n        private _state: ControlStateService,\n        private _call: VideoCallStateService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'check',\n            combineLatest([\n                this.mic_list,\n                this.camera_list,\n                this.lights_list,\n                this._state.room_accessories,\n                this.system,\n                this._call.connected,\n                this._call.call,\n                this._state.microphones,\n                this._state.join_modes,\n                this._state.joined,\n                this._call.speaker_track,\n                this._state.lighting_scenes,\n                this._state.help_items,\n            ]).subscribe(\n                ([\n                    mics,\n                    cams,\n                    lights,\n                    accessories,\n                    system,\n                    has_vc,\n                    call,\n                    microphones,\n                    join_modes,\n                    joined,\n                    speaker_track,\n                    l_scenes,\n                    help_items,\n                ]) => {\n                    (this.action_list as any)[TOOLTIP.PHONE].show = !!(\n                        system as any\n                    ).dial_bindings;\n                    (this.action_list as any)[TOOLTIP.PHONE].enabled =\n                        (system as any).offhook || (system as any).ringing;\n                    (this.action_list as any)[TOOLTIP.VC].show =\n                        has_vc && false;\n                    (this.action_list as any)[TOOLTIP.VC].enabled = !!call;\n                    this.action_list[TOOLTIP.MEET].show =\n                        !this.is_trusted &&\n                        (system as any).meeting_url &&\n                        false;\n                    this.action_list[TOOLTIP.LIGHTS].show =\n                        (lights as any)?.length > 0;\n                    this.action_list[TOOLTIP.ACCESSORIES].show =\n                        (accessories as any)?.length > 0;\n                    this.action_list[TOOLTIP.MICS].show =\n                        (mics as any)?.length > 0 ||\n                        (microphones as any)?.length > 0;\n                    this.action_list[TOOLTIP.JOIN].show =\n                        Object.keys((join_modes as any) || {}).length > 1;\n                    (this.action_list[TOOLTIP.JOIN] as any).enabled =\n                        (joined as any)?.room_ids?.length > 1;\n                    this.action_list[TOOLTIP.CAMERA].show =\n                        (cams as any)?.length > 0 && !speaker_track;\n                    this.action_list[TOOLTIP.HELP].show =\n                        (help_items as any)?.length > 0;\n                    this.action_list = [...this.action_list];\n                    this.action_list[TOOLTIP.LIGHT_SCENES].show =\n                        l_scenes != null;\n                }\n            )\n        );\n    }\n}\n","import {\n    Component,\n    EventEmitter,\n    Input,\n    OnChanges,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { unique } from '@placeos/common';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { ControlStateService, RoomInput } from '../control-state.service';\n\n@Component({\n    selector: 'source-select',\n    template: `\n        <div\n            class=\"flex flex-col items-center text-black\"\n            [class.p-2]=\"simple\"\n            [class.p-4]=\"!simple\"\n        >\n            <h3 class=\"font-medium text-xl mb-2\">\n                Select input source for\n                {{ (details | async)?.name || '= No Name =' }}\n            </h3>\n            <ng-container *ngIf=\"!loading; else load_state\">\n                <div\n                    class=\"flex divide\"\n                    [class.flex-col]=\"simple\"\n                    [class.flex-wrap]=\"!simple\"\n                    *ngIf=\"(input_types | async)?.length; else empty_state\"\n                >\n                    <div\n                        group\n                        *ngFor=\"let type of input_types | async\"\n                        class=\"flex flex-col p-2 space-y-2\"\n                    >\n                        <h4 class=\"text-center underline\">{{ type }}</h4>\n                        <button\n                            btn\n                            matRipple\n                            source\n                            class=\"w-48\"\n                            [class.inverse]=\"\n                                input.id === (details | async)?.source\n                            \"\n                            *ngFor=\"let input of (input_map | async)[type]\"\n                            (click)=\"selectSource(input)\"\n                        >\n                            <div class=\"truncate\">{{ input.name }}</div>\n                        </button>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"flex flex-col items-center justify-center p-8 m-auto\">\n                <p>\n                    No input sources available for the selected output({{\n                        details?.name || 'Unknown'\n                    }})\n                </p>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                class=\"flex flex-col items-center justify-center space-y-2 p-8 m-auto\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>Switching input source...</p>\n            </div>\n        </ng-template>\n    `,\n})\nexport class SourceSelectComponent implements OnChanges {\n    // Whether to use the simple display\n    @Input() public simple = false;\n    // ID of the selected output\n    @Input() public output: string;\n    /** Emitter for changes to the selected input source */\n    @Output() public source = new EventEmitter();\n    /** Whether routing is loading */\n    public loading: boolean;\n    // Store for the ID of the selected output\n    public readonly output_id = new BehaviorSubject('');\n    // Name of the currently selected output\n    public readonly details = combineLatest([\n        this.output_id,\n        this._state.output_list,\n    ]).pipe(map(([id, list]) => list.find((_) => _.id === id)));\n    /** List of inputs available for selected output */\n    public readonly input_list = combineLatest([\n        this.output_id,\n        this._state.input_list,\n    ]).pipe(\n        map(([id, list]) =>\n            list.filter((_) => !_.outputs || _.outputs.includes(id))\n        )\n    );\n    /** Available types of inputs */\n    public readonly input_types = this.input_list.pipe(\n        map((list) => unique(list.map((_) => _.type)))\n    );\n    /** Mapping of input types to inputs */\n    public readonly input_map = combineLatest([\n        this.input_list,\n        this.input_types,\n    ]).pipe(\n        map(([list, types]) =>\n            types.reduce((m, t) => {\n                m[t] = list.filter((_) => _.type === t);\n                return m;\n            }, {})\n        )\n    );\n\n    constructor(private _state: ControlStateService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.output) {\n            this.output_id.next(this.output || '');\n        }\n    }\n\n    public async selectSource(input: RoomInput) {\n        this.loading = true;\n        await this._state.setRoute(input.id, this.output);\n        this.loading = false;\n        this.source.emit(input);\n    }\n}\n","import { Component, Input, SimpleChanges } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { ControlStateService, RoomOutput } from '../control-state.service';\n\nexport const ICON_MAP = {\n    Display: 'deskotp_windows',\n    PC: 'desktop_windows',\n    Laptop: 'laptop_chromebook',\n    Camera: 'videocam',\n    TV: 'tv',\n};\n\n@Component({\n    selector: 'output-display',\n    template: `\n        <div class=\"p-4 m-2 bg-white rounded shadow text-black\" *ngIf=\"item\">\n            <div\n                view\n                matRipple\n                class=\"h-48 border border-gray-300 relative rounded mb-2 flex flex-col items-center justify-center space-y-2\"\n                [class.opacity-60]=\"!(input | async)\"\n                [class.bg-gray-300]=\"!(input | async)\"\n                (click)=\"switchSource()\"\n            >\n                <div\n                    class=\"absolute top-1 left-1 bg-secondary text-white shadow px-2 py-1 rounded\"\n                >\n                    {{ item?.name }}\n                </div>\n                <app-icon class=\"text-7xl\">{{\n                    (input | async)?.icon ||\n                        icons[(input | async)?.type] ||\n                        'add_to_queue'\n                }}</app-icon>\n                <p class=\"font-medium\">\n                    {{\n                        (input | async)?.name || 'Click to select input source'\n                    }}\n                </p>\n                <p class=\"text-xs\">\n                    <span *ngIf=\"(input | async)?.name\" class=\"opacity-50\">\n                        Click to switch input source\n                    </span>\n                </p>\n            </div>\n            <div class=\"flex items-center space-x-2 w-full\">\n                <button icon matRipple (click)=\"setMute(!item.mute)\">\n                    <app-icon>{{\n                        item.mute\n                            ? 'volume_off'\n                            : item.volume > 0\n                            ? 'volume_up'\n                            : 'volume_mute'\n                    }}</app-icon>\n                </button>\n                <mat-slider class=\"flex-1\"\n                    ><input\n                        matSliderThumb\n                        [ngModel]=\"!mute ? item.volume : 0\"\n                        (ngModelChange)=\"setVolume($event)\"\n                /></mat-slider>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            [view] {\n                width: 28vw;\n            }\n        `,\n    ],\n})\nexport class OutputDisplayComponent extends AsyncHandler {\n    @Input() public item: RoomOutput;\n    /** Current volume level for output */\n    public volume: number;\n    /** Current mute state of the output */\n    public mute: boolean;\n    /** ID of the input associated with the displayed output */\n    private _input = new BehaviorSubject('');\n    /** Details of the associated input */\n    public readonly input = combineLatest([\n        this._input,\n        this._state.input_list,\n    ]).pipe(map(([id, list]) => list.find((_) => _.id === id || _.ref === id)));\n\n    public readonly icons = ICON_MAP;\n\n    public readonly switchSource = () => this._state.switchSource(this.item.id);\n    public readonly setVolume = (v) =>\n        this.timeout('volume', () => this._state.setVolume(v, this.item.id));\n    public readonly setMute = (s) => this._state.setMute(s, this.item.id);\n\n    public get id(): string {\n        return this._state.id;\n    }\n\n    constructor(private _state: ControlStateService) {\n        super();\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item) {\n            this._input.next(this.item?.source || '');\n        }\n    }\n}\n","import { Component } from '@angular/core';\nimport { map } from 'rxjs/operators';\n\nimport { ControlStateService } from './control-state.service';\n\n@Component({\n    selector: 'control-advanced-view',\n    template: `\n        <div\n            class=\"w-full flex-1 h-1/2 flex items-center flex-col sm:flex-row sm:justify-center sm:flex-wrap overflow-auto\"\n            *ngIf=\"(outputs | async)?.length; else empty_state\"\n        >\n            <output-display\n                class=\"w-full sm:w-auto min-w-[33%]\"\n                *ngFor=\"\n                    let output of outputs\n                        | async\n                        | slice: page * 6:(page + 1) * 6\n                \"\n                [item]=\"output\"\n            ></output-display>\n        </div>\n        <div\n            class=\"w-full h-12 flex items-center justify-center px-2 pb-2 space-x-2\"\n            *ngIf=\"(page_count | async)?.length > 1\"\n        >\n            <button\n                icon\n                matRipple\n                *ngFor=\"let idx of page_count | async; let i = index\"\n                [class.bg-primary]=\"page === i\"\n                [class.text-black]=\"page !== i\"\n                [class.bg-gray-100]=\"page !== i\"\n                (click)=\"page = i\"\n            >\n                {{ i + 1 }}\n            </button>\n        </div>\n        <ng-template #empty_state>\n            <div\n                class=\"absolute inset-0 flex flex-col items-center justify-center\"\n            >\n                <p>No output devices setup for this system.</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n                display: flex;\n                width: 100%;\n                height: 100%;\n                flex-direction: column;\n            }\n        `,\n    ],\n})\nexport class ControlAdvancedViewComponent {\n    public page = 0;\n\n    public readonly outputs = this._state.output_list.pipe(map((_) => _ || []));\n\n    public readonly page_count = this.outputs.pipe(\n        map((_) => new Array(Math.floor(_.length / 6) + 1).fill(0))\n    );\n\n    constructor(private _state: ControlStateService) {}\n}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: '[control-page-view]',\n    template: `\n        <ng-container [ngSwitch]=\"view\">\n            <source-select\n                *ngSwitchCase=\"'basic'\"\n                output=\"'ALL'\"\n            ></source-select>\n            <control-advanced-view *ngSwitchDefault></control-advanced-view>\n        </ng-container>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n                flex: 1;\n                height: 50%;\n                overflow: hidden;\n                background: #f0f0f0;\n                color: rgba(0,0,0,.85);\n            }\n        `,\n    ],\n})\nexport class ControlPageViewComponent {\n    public view: 'basic' | 'advanced';\n}\n","import { Pipe } from \"@angular/core\";\n\nexport function padLength(value: number | string, length: number = 2): string {\n    let str = `${value}`;\n    while (str.length < length) str = `0${str}`;\n    return str;\n}\n\n@Pipe({\n    name: 'duration'\n})\nexport class DurationPipe {\n    public transform(length: number): string {\n        let str = `${padLength(Math.floor(length / 60) % 60)}:${padLength(length % 60)}`;\n        const hours = Math.floor(length / 60 / 60);\n        if (hours > 0) {\n            str = `${padLength(hours)}:${str}`;\n        }\n        return str;\n    }\n}\n","import { Component } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { map, take } from 'rxjs/operators';\nimport { ControlStateService } from './control-state.service';\n\n@Component({\n    selector: 'control-status-bar',\n    template: `\n        <div\n            recording\n            *ngIf=\"!!(capture_mod | async)\"\n            class=\"text-xs divide-x divide-gray-100 text-white flex items-center\"\n        >\n            <div hidden>\n                <i\n                    binding\n                    [(model)]=\"rec_status\"\n                    [sys]=\"id\"\n                    [mod]=\"(capture_mod | async)?.mod\"\n                    bind=\"status\"\n                ></i>\n                <i\n                    binding\n                    [(model)]=\"rec_title\"\n                    [sys]=\"id\"\n                    [mod]=\"(capture_mod | async)?.mod\"\n                    bind=\"title\"\n                ></i>\n                <i\n                    binding\n                    [(model)]=\"rec_remaining\"\n                    [sys]=\"id\"\n                    [mod]=\"(capture_mod | async)?.mod\"\n                    bind=\"remaining\"\n                ></i>\n                <i\n                    binding\n                    [(model)]=\"rec_current\"\n                    [sys]=\"id\"\n                    [mod]=\"(capture_mod | async)?.mod\"\n                    bind=\"current\"\n                ></i>\n                <i\n                    binding\n                    [(model)]=\"rec_next\"\n                    [sys]=\"id\"\n                    [mod]=\"(capture_mod | async)?.mod\"\n                    bind=\"current\"\n                ></i>\n            </div>\n            <div\n                class=\"h-12 p-2 w-24 flex items-center justify-center text-center\"\n            >\n                {{ rec_title || '~Unnamed Recording~' }}\n            </div>\n            <div class=\"h-12 w-12 flex items-center justify-center\">\n                <button icon matRipple mute class=\"rounded-none\">\n                    <app-icon>fiber_manual_record</app-icon>\n                </button>\n            </div>\n            <div class=\"h-12 w-12 flex items-center justify-center\">\n                <button\n                    [attr.place-action]=\"\n                        rec_status === 'playing' ? 'pause' : 'start'\n                    \"\n                    icon\n                    matRipple\n                    class=\"rounded-none\"\n                    binding\n                    [sys]=\"id\"\n                    mod=\"Capture\"\n                    onEvent=\"click\"\n                    [exec]=\"rec_status === 'playing' ? 'pause' : 'start'\"\n                >\n                    <app-icon>{{\n                        rec_status === 'playing' ? 'pause' : 'play_arrow'\n                    }}</app-icon>\n                </button>\n            </div>\n            <div class=\"h-12 flex flex-col p-2 w-32\">\n                <div\n                    class=\"p-2 rounded uppercase text-center\"\n                    [class.bg-error]=\"rec_status === 'playing'\"\n                    [class.bg-pending]=\"rec_status === 'paused'\"\n                    [class.bg-gray-400]=\"rec_status === 'stopped'\"\n                >\n                    {{\n                        rec_status === 'playing'\n                            ? 'Recording'\n                            : rec_status === 'paused'\n                            ? 'Paused'\n                            : 'Idle'\n                    }}\n                </div>\n            </div>\n            <div class=\"h-12 p-2\">\n                <label>Remaining</label>\n                <div class=\"\">{{ rec_remaining | duration }}</div>\n            </div>\n            <div class=\"h-12 p-2\">\n                <label>Next Recording</label>\n                <div class=\"\">{{ rec_current | duration }}</div>\n            </div>\n        </div>\n        <div class=\"flex-1\"></div>\n        <div\n            class=\"flex items-center space-x-2 w-[32rem] max-w-[50%] py-2 px-4\"\n        >\n            <button icon matRipple (click)=\"toggleMute()\">\n                <app-icon>{{\n                    (system | async).mute\n                        ? 'volume_off'\n                        : (system | async).volume > 0\n                        ? 'volume_up'\n                        : 'volume_mute'\n                }}</app-icon>\n            </button>\n            <mat-slider white class=\"flex-1\">\n                <input\n                    matSliderThumb\n                    [ngModel]=\"(system | async).volume || 0\"\n                    (ngModelChange)=\"setVolume($event); mute = false\"\n                    [disabled]=\"(system | async).mute\"\n            /></mat-slider>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                height: 3rem;\n                overflow: hidden;\n            }\n        `,\n    ],\n})\nexport class ControlStatusBarComponent extends AsyncHandler {\n    /** Details of the active system */\n    public readonly system = this._state.system;\n\n    public readonly capture_mod = this._state.capture_list.pipe(\n        map((_) => _[0])\n    );\n\n    public mute: boolean;\n    public rec_status: string;\n    public rec_title: string;\n\n    public readonly setVolume = (v) => this._state.setVolume(v);\n    public readonly toggleMute = async () => {\n        const sys = await this.system.pipe(take(1)).toPromise();\n        this._state.setMute(!sys.mute);\n    };\n\n    public get id() {\n        return this._state.id;\n    }\n\n    constructor(private _state: ControlStateService) {\n        super();\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ActivatedRoute, Router } from '@angular/router';\n\nimport { AsyncHandler, VERSION } from '@placeos/common';\nimport { ChangelogModalComponent } from '@placeos/components';\n\nimport { ControlStateService } from './control-state.service';\n\n@Component({\n    selector: 'app-control-main-view',\n    template: `\n        <ng-container *ngIf=\"(system | async).connected; else load_state\">\n            <div\n                *ngIf=\"(system | async).active; else power_off_state\"\n                class=\"absolute inset-0 flex flex-col bg-slate-700 dark:bg-[#1F2021]\"\n            >\n                <topbar-header></topbar-header>\n                <div control-page-view></div>\n                <control-status-bar></control-status-bar>\n            </div>\n        </ng-container>\n        <ng-template #power_off_state>\n            <div\n                name=\"splash\"\n                class=\"absolute inset-0 text-white flex flex-col items-center justify-center\"\n                (click)=\"powerOn()\"\n                (touchend)=\"powerOn()\"\n            >\n                <h2 class=\"font-light text-4xl mb-4\">Touch to Start</h2>\n                <p class=\"text-lg\">{{ (system | async).name }}</p>\n                <div class=\"absolute bottom-0 left-0 p-2\">\n                    <div class=\"text-xs opacity-60 w-full\">\n                        <ng-container i18n>Version: </ng-container>\n                        <button\n                            class=\"underline p-0 m-0 bg-none border-none text-xs\"\n                            (click)=\"viewChangelog()\"\n                        >\n                            {{ version.hash }}\n                        </button>\n                    </div>\n                    <div class=\"text-xs opacity-60 w-full\">\n                        {{ version.time | date: 'longDate' }}\n                        ({{ version.time | date: 'shortTime' }})\n                    </div>\n                </div>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                name=\"loader\"\n                class=\"absolute inset-0 bg-white text-black flex flex-col items-center justify-center\"\n            >\n                <mat-spinner class=\"mb-4\" [diameter]=\"64\"></mat-spinner>\n                <div class=\"text-2xl my-4\">\n                    Connecting to system(<em>{{ id }}</em\n                    >)...\n                </div>\n                <div class=\"text-base\"></div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                color: #fff;\n            }\n\n            [name='loader'] {\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 304 304' width='304' height='304'%3E%3Cpath fill='%23000' fill-opacity='0.05' d='M44.1 224a5 5 0 1 1 0 2H0v-2h44.1zm160 48a5 5 0 1 1 0 2H82v-2h122.1zm57.8-46a5 5 0 1 1 0-2H304v2h-42.1zm0 16a5 5 0 1 1 0-2H304v2h-42.1zm6.2-114a5 5 0 1 1 0 2h-86.2a5 5 0 1 1 0-2h86.2zm-256-48a5 5 0 1 1 0 2H0v-2h12.1zm185.8 34a5 5 0 1 1 0-2h86.2a5 5 0 1 1 0 2h-86.2zM258 12.1a5 5 0 1 1-2 0V0h2v12.1zm-64 208a5 5 0 1 1-2 0v-54.2a5 5 0 1 1 2 0v54.2zm48-198.2V80h62v2h-64V21.9a5 5 0 1 1 2 0zm16 16V64h46v2h-48V37.9a5 5 0 1 1 2 0zm-128 96V208h16v12.1a5 5 0 1 1-2 0V210h-16v-76.1a5 5 0 1 1 2 0zm-5.9-21.9a5 5 0 1 1 0 2H114v48H85.9a5 5 0 1 1 0-2H112v-48h12.1zm-6.2 130a5 5 0 1 1 0-2H176v-74.1a5 5 0 1 1 2 0V242h-60.1zm-16-64a5 5 0 1 1 0-2H114v48h10.1a5 5 0 1 1 0 2H112v-48h-10.1zM66 284.1a5 5 0 1 1-2 0V274H50v30h-2v-32h18v12.1zM236.1 176a5 5 0 1 1 0 2H226v94h48v32h-2v-30h-48v-98h12.1zm25.8-30a5 5 0 1 1 0-2H274v44.1a5 5 0 1 1-2 0V146h-10.1zm-64 96a5 5 0 1 1 0-2H208v-80h16v-14h-42.1a5 5 0 1 1 0-2H226v18h-16v80h-12.1zm86.2-210a5 5 0 1 1 0 2H272V0h2v32h10.1zM98 101.9V146H53.9a5 5 0 1 1 0-2H96v-42.1a5 5 0 1 1 2 0zM53.9 34a5 5 0 1 1 0-2H80V0h2v34H53.9zm60.1 3.9V66H82v64H69.9a5 5 0 1 1 0-2H80V64h32V37.9a5 5 0 1 1 2 0zM101.9 82a5 5 0 1 1 0-2H128V37.9a5 5 0 1 1 2 0V82h-28.1zm16-64a5 5 0 1 1 0-2H146v44.1a5 5 0 1 1-2 0V18h-26.1zm102.2 270a5 5 0 1 1 0 2H98v14h-2v-16h124.1zM242 149.9V160h16v34h-16v62h48v48h-2v-46h-48v-66h16v-30h-16v-12.1a5 5 0 1 1 2 0zM53.9 18a5 5 0 1 1 0-2H64V2H48V0h18v18H53.9zm112 32a5 5 0 1 1 0-2H192V0h50v2h-48v48h-28.1zm-48-48a5 5 0 0 1-9.8-2h2.07a3 3 0 1 0 5.66 0H178v34h-18V21.9a5 5 0 1 1 2 0V32h14V2h-58.1zm0 96a5 5 0 1 1 0-2H137l32-32h39V21.9a5 5 0 1 1 2 0V66h-40.17l-32 32H117.9zm28.1 90.1a5 5 0 1 1-2 0v-76.51L175.59 80H224V21.9a5 5 0 1 1 2 0V82h-49.59L146 112.41v75.69zm16 32a5 5 0 1 1-2 0v-99.51L184.59 96H300.1a5 5 0 0 1 3.9-3.9v2.07a3 3 0 0 0 0 5.66v2.07a5 5 0 0 1-3.9-3.9H185.41L162 121.41v98.69zm-144-64a5 5 0 1 1-2 0v-3.51l48-48V48h32V0h2v50H66v55.41l-48 48v2.69zM50 53.9v43.51l-48 48V208h26.1a5 5 0 1 1 0 2H0v-65.41l48-48V53.9a5 5 0 1 1 2 0zm-16 16V89.41l-34 34v-2.82l32-32V69.9a5 5 0 1 1 2 0zM12.1 32a5 5 0 1 1 0 2H9.41L0 43.41V40.6L8.59 32h3.51zm265.8 18a5 5 0 1 1 0-2h18.69l7.41-7.41v2.82L297.41 50H277.9zm-16 160a5 5 0 1 1 0-2H288v-71.41l16-16v2.82l-14 14V210h-28.1zm-208 32a5 5 0 1 1 0-2H64v-22.59L40.59 194H21.9a5 5 0 1 1 0-2H41.41L66 216.59V242H53.9zm150.2 14a5 5 0 1 1 0 2H96v-56.6L56.6 162H37.9a5 5 0 1 1 0-2h19.5L98 200.6V256h106.1zm-150.2 2a5 5 0 1 1 0-2H80v-46.59L48.59 178H21.9a5 5 0 1 1 0-2H49.41L82 208.59V258H53.9zM34 39.8v1.61L9.41 66H0v-2h8.59L32 40.59V0h2v39.8zM2 300.1a5 5 0 0 1 3.9 3.9H3.83A3 3 0 0 0 0 302.17V256h18v48h-2v-46H2v42.1zM34 241v63h-2v-62H0v-2h34v1zM17 18H0v-2h16V0h2v18h-1zm273-2h14v2h-16V0h2v16zm-32 273v15h-2v-14h-14v14h-2v-16h18v1zM0 92.1A5.02 5.02 0 0 1 6 97a5 5 0 0 1-6 4.9v-2.07a3 3 0 1 0 0-5.66V92.1zM80 272h2v32h-2v-32zm37.9 32h-2.07a3 3 0 0 0-5.66 0h-2.07a5 5 0 0 1 9.8 0zM5.9 0A5.02 5.02 0 0 1 0 5.9V3.83A3 3 0 0 0 3.83 0H5.9zm294.2 0h2.07A3 3 0 0 0 304 3.83V5.9a5 5 0 0 1-3.9-5.9zm3.9 300.1v2.07a3 3 0 0 0-1.83 1.83h-2.07a5 5 0 0 1 3.9-3.9zM97 100a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-48 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 96a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-144a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM49 36a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM33 68a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 240a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm80-176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm112 176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 180a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 84a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6z'%3E%3C/path%3E%3C/svg%3E\");\n            }\n\n            [name='splash'] {\n                animation: crossfade 10s linear;\n                animation-iteration-count: infinite;\n            }\n        `,\n    ],\n})\nexport class ControlMainViewComponent extends AsyncHandler implements OnInit {\n    public readonly system = this._state.system;\n\n    public readonly powerOn = () => this._state.powerOn();\n    public get id() {\n        return this._state.id;\n    }\n\n    public get version() {\n        return VERSION;\n    }\n\n    public async viewChangelog() {\n        const changelog = await (\n            await fetch(\n                'https://raw.githubusercontent.com/PlaceOS/user-interfaces/develop/CHANGELOG.md'\n            )\n        ).text();\n        this._dialog.open(ChangelogModalComponent, { data: { changelog } });\n    }\n\n    constructor(\n        private _route: ActivatedRoute,\n        private _router: Router,\n        private _state: ControlStateService,\n        private _dialog: MatDialog\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'route.params',\n            this._route.paramMap.subscribe((params) =>\n                params.has('system')\n                    ? this._state.setID(params.get('system'))\n                    : ''\n            )\n        );\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) =>\n                params.get('join') === 'true' ? this._state.selectMeeting() : ''\n            )\n        );\n        this.timeout('init', () =>\n            !this._state.id ? this._router.navigate(['/bootstrap']) : ''\n        );\n    }\n}\n","import { Component, Renderer2 } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { CustomTooltipData } from '@placeos/components';\nimport { getModule } from '@placeos/ts-client';\nimport { combineLatest } from 'rxjs';\n\nimport { ControlStateService, RoomInput } from '../control-state.service';\nimport { JoystickPan, JoystickTilt } from './joystick.component';\n\nexport enum ZoomDirection {\n    In = 'in',\n    Out = 'out',\n    Stop = 'stop',\n}\n@Component({\n    selector: 'camera-controls',\n    template: `\n        <div class=\"flex flex-col\" *ngIf=\"(camera_list | async)?.length\">\n            <mat-form-field appearance=\"outline\" class=\"m-4 h-12\">\n                <mat-select\n                    [(ngModel)]=\"active_camera\"\n                    (ngModelChange)=\"selectCamera($event)\"\n                    placeholder=\"Select Camera\"\n                >\n                    <mat-option\n                        *ngFor=\"let cam of camera_list | async\"\n                        [value]=\"cam\"\n                    >\n                        {{ cam.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <div class=\"p-4\">\n                <h3 class=\"mb-2 text-xl font-medium\">Controls</h3>\n                <div class=\"flex items-center space-x-2\">\n                    <joystick\n                        [(pan)]=\"pan\"\n                        [(tilt)]=\"tilt\"\n                        (panChange)=\"moveCamera()\"\n                        (tiltChange)=\"moveCamera()\"\n                    ></joystick>\n                    <div\n                        zoom\n                        class=\"flex flex-col items-center border border-gray-600 rounded\"\n                    >\n                        <button\n                            zoom-in\n                            icon\n                            matRipple\n                            class=\"rounded\"\n                            (mousedown)=\"startZoom('in', $event)\"\n                            (touchstart)=\"startZoom('in', $event)\"\n                            (contextmenu)=\"$event.preventDefault()\"\n                        >\n                            <app-icon>add</app-icon>\n                        </button>\n                        <div\n                            class=\"text-xs h-10 w-10 flex items-center justify-center border-t border-b border-gray-600\"\n                        >\n                            Zoom\n                        </div>\n\n                        <button\n                            zoom-out\n                            icon\n                            matRipple\n                            class=\"rounded\"\n                            (mousedown)=\"startZoom('out', $event)\"\n                            (touchstart)=\"startZoom('out', $event)\"\n                            (contextmenu)=\"$event.preventDefault()\"\n                        >\n                            <app-icon>remove</app-icon>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div\n                class=\"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center\"\n                *ngIf=\"!active_camera\"\n            >\n                <p>Select a camera to control.</p>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class CameraControlsComponent extends AsyncHandler {\n    /** Currently active camera */\n    public active_camera: RoomInput;\n    /** List of available presets for the active camera */\n    public presets: string[] = [];\n    /** Currently active preset */\n    public preset: string = '';\n    /** Current zoom value for camera */\n    public zoom: ZoomDirection = ZoomDirection.Stop;\n    /** Current panning value for camera */\n    public pan: JoystickPan = JoystickPan.Stop;\n    /** Current tilting value for camera */\n    public tilt: JoystickTilt = JoystickTilt.Stop;\n    /** List of available cameras to select from */\n    public readonly camera_list = this._state.camera_list;\n\n    public get id(): string {\n        return this._state.id;\n    }\n\n    constructor(\n        private _state: ControlStateService,\n        private _renderer: Renderer2\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'camera_list',\n            combineLatest([\n                this.camera_list,\n                this._state.selected_camera,\n            ]).subscribe(([l, cam]) => {\n                if (!l?.length) return;\n                this.active_camera =\n                    l.find((_) => _.id === cam) || this.active_camera || l[0];\n            })\n        );\n    }\n\n    public selectCamera(camera: RoomInput) {\n        const mod = getModule(this.id, 'System');\n        if (!mod) return;\n        mod.execute('selected_camera', [camera.id]);\n    }\n\n    public recallPreset(preset: string) {\n        const mod = getModule(this.id, this.active_camera.mod);\n        if (!mod) return;\n        mod.execute('recall', [preset]);\n    }\n\n    public addPreset(preset: string) {\n        const mod = getModule(this.id, 'System');\n        if (!mod) return;\n        mod.execute('add_preset', [preset, this.active_camera.id]);\n    }\n\n    public removePreset(preset: string) {\n        const mod = getModule(this.id, 'System');\n        if (!mod) return;\n        mod.execute('remove_preset', [preset, this.active_camera.id]);\n    }\n\n    public moveCamera() {\n        if (!this.active_camera) return;\n        this.timeout(\n            'move',\n            async () => {\n                const { index } = this.active_camera;\n                const mod = getModule(this.id, this.active_camera.mod);\n                if (!mod) return;\n                await mod.execute('stop', index ? [index] : []);\n                if (this.tilt !== JoystickTilt.Stop)\n                    await mod.execute(\n                        'tilt',\n                        index ? [this.tilt, index] : [this.tilt]\n                    );\n                if (this.pan !== JoystickPan.Stop)\n                    await mod.execute(\n                        'pan',\n                        index ? [this.pan, index] : [this.pan]\n                    );\n            },\n            50\n        );\n    }\n\n    public async startZoom(dir: 'in' | 'out', e: MouseEvent | TouchEvent) {\n        const mod = getModule(this.id, this.active_camera.mod);\n        if (!mod) return;\n        const end_event = e instanceof MouseEvent ? 'mouseup' : 'touchend';\n        this.zoom = dir === 'in' ? ZoomDirection.In : ZoomDirection.Out;\n        const { index } = this.active_camera;\n        await mod.execute('zoom', index ? [this.zoom, index] : [this.zoom]);\n        this.subscription(\n            'on_end',\n            this._renderer.listen('window', end_event, (_) => {\n                this.unsub('on_move');\n                this.unsub('on_end');\n                this.zoom = ZoomDirection.Stop;\n                mod.execute('zoom', index ? [this.zoom, index] : [this.zoom]);\n            })\n        );\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AsyncHandler, notifyError } from '@placeos/common';\nimport { getModule } from '@placeos/ts-client';\nimport { filter, take } from 'rxjs/operators';\nimport { ControlStateService, RoomInput } from '../control-state.service';\nimport { VideoCallStateService } from './video-call-state.service';\n\n@Component({\n    selector: '[video-call-page]',\n    template: `\n        <div\n            class=\"text-black p-2 h-full w-full\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <div class=\"flex h-1/2 flex-1\">\n                <div\n                    class=\"flex-1 p-2 flex flex-col items-center justify-center space-y-2\"\n                >\n                    <mat-form-field\n                        appearance=\"outline\"\n                        class=\"w-full h-12\"\n                        *ngIf=\"(camera_list | async)?.length > 1\"\n                    >\n                        <mat-select\n                            [ngModel]=\"selected_camera\"\n                            (ngModelChange)=\"selectCamera($event)\"\n                            placeholder=\"Select Camera\"\n                        >\n                            <mat-option\n                                *ngFor=\"let cam of camera_list | async\"\n                                [value]=\"cam.id\"\n                            >\n                                {{ cam.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                    <mat-form-field\n                        appearance=\"outline\"\n                        *ngIf=\"present_output && (presentables$ | async)\"\n                        class=\"w-full h-[3.5rem]\"\n                    >\n                        <mat-select\n                            ngModel\n                            (ngModelChange)=\"setPresentationSource($event)\"\n                            placeholder=\"Select presentation source\"\n                        >\n                            <mat-option\n                                *ngFor=\"let opt of presentables$ | async\"\n                                [value]=\"opt\"\n                                >{{ opt.name }}</mat-option\n                            >\n                        </mat-select>\n                    </mat-form-field>\n                    <p class=\"pb-2\">HDMI Content Destination:</p>\n                    <mat-form-field\n                        appearance=\"outline\"\n                        class=\"w-full h-[3.5rem]\"\n                    >\n                        <mat-select\n                            [ngModel]=\"presentation_mode | async\"\n                            (ngModelChange)=\"setPresentationMode($event)\"\n                            placeholder=\"Select HDMI content destination\"\n                        >\n                            <mat-option value=\"None\"\n                                >Hide Presentation</mat-option\n                            >\n                            <mat-option value=\"Local\"\n                                >Present Locally</mat-option\n                            >\n                            <mat-option value=\"Remote\"\n                                >Present to All</mat-option\n                            >\n                        </mat-select>\n                    </mat-form-field>\n                    <p class=\"pb-2\">Video Layout:</p>\n                    <mat-form-field\n                        appearance=\"outline\"\n                        class=\"w-full h-[3.5rem]\"\n                    >\n                        <mat-select\n                            [ngModel]=\"video_layout | async\"\n                            (ngModelChange)=\"setVideoLayout($event)\"\n                            placeholder=\"Select Video layout\"\n                        >\n                            <mat-option\n                                *ngFor=\"let layout of video_layouts\"\n                                [value]=\"layout\"\n                                >{{ layout }}</mat-option\n                            >\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex-1 p-2 flex items-center justify-center\">\n                    <dialpad\n                        [backspace]=\"false\"\n                        (pressed)=\"sentDTMF($event)\"\n                    ></dialpad>\n                </div>\n                <div\n                    class=\"flex-1 p-2 flex flex-col items-center justify-center space-y-4\"\n                >\n                    <button\n                        btn\n                        matRipple\n                        class=\"bg-error w-full\"\n                        (click)=\"endCall()\"\n                    >\n                        <div class=\"flex items-center space-x-4\">\n                            <app-icon>call_end</app-icon>\n                            <span>End Call</span>\n                        </div>\n                    </button>\n                    <button\n                        btn\n                        matRipple\n                        class=\"w-full\"\n                        (click)=\"toggleMute()\"\n                        [class.inverse]=\"!(mic_mute | async)\"\n                    >\n                        <div class=\"flex items-center space-x-4\">\n                            <app-icon>{{\n                                (mic_mute | async) ? 'mic_off' : 'mic'\n                            }}</app-icon>\n                            <span>{{\n                                (mic_mute | async)\n                                    ? 'Unmute Microphones'\n                                    : 'Mute Microphones'\n                            }}</span>\n                        </div>\n                    </button>\n                    <button\n                        btn\n                        matRipple\n                        class=\"w-full\"\n                        [class.inverse]=\"(call | async)?.Status !== 'OnHold'\"\n                        (click)=\"toggleOnHold()\"\n                    >\n                        <div class=\"flex items-center space-x-4\">\n                            <app-icon>{{\n                                (call | async)?.Status !== 'OnHold'\n                                    ? 'stop'\n                                    : 'play_arrow'\n                            }}</app-icon>\n                            <span>{{\n                                (call | async)?.Status !== 'OnHold'\n                                    ? 'Place on Hold'\n                                    : 'Resume Call'\n                            }}</span>\n                        </div>\n                    </button>\n                    <button\n                        btn\n                        matRipple\n                        class=\"w-full\"\n                        (click)=\"toggleCamera()\"\n                        [class.inverse]=\"show_camera_pip | async\"\n                    >\n                        <div class=\"flex items-center space-x-4\">\n                            <app-icon>{{\n                                !(show_camera_pip | async)\n                                    ? 'visibility_off'\n                                    : 'visibility'\n                            }}</app-icon>\n                            <span>{{\n                                (show_camera_pip | async)\n                                    ? 'Hide Camera PIP'\n                                    : 'Show Camera PIP'\n                            }}</span>\n                        </div>\n                    </button>\n                </div>\n            </div>\n        </div>\n        <ng-template #load_state>\n            <div\n                class=\"w-full h-full flex flex-col items-center justify-center space-y-2 text-black p-24\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n        `,\n    ],\n})\nexport class VideoCallPageComponent extends AsyncHandler {\n    @Input() public redirect = true;\n    @Input() public present_output = '';\n    public loading = 'Loading call details...';\n    public readonly call = this._state.call;\n    public readonly show_camera_pip = this._state.show_camera_pip;\n    public readonly mic_mute = this._state.mic_mute;\n    public readonly video_layout = this._state.video_layout;\n    public readonly presentation_mode = this._state.presentation_mode;\n    public readonly presentables$ = this._control.presentables$;\n    /** List of available cameras to select from */\n    public readonly camera_list = this._control.camera_list;\n    public readonly video_layouts = [\n        'Auto',\n        'Equal',\n        'Overlay',\n        'Prominent',\n        'Single',\n    ];\n\n    public readonly selected_camera = this._control.selected_camera;\n\n    public readonly sentDTMF = (d) => this._state.sendDTMF(d);\n    public readonly setPresentationSource = (i) =>\n        this._control.setRoute(i.id, this.present_output, false);\n    public readonly setPresentationMode = (d) =>\n        this._state.setPresentationMode(d);\n    public readonly setVideoLayout = (d) => this._state.setVideoLayout(d);\n    public readonly toggleCamera = async () =>\n        this._state.showCameraPIP(\n            !(await this.show_camera_pip.pipe(take(1)).toPromise())\n        );\n    public readonly toggleMute = async () =>\n        this._state.muteMicrophone(\n            !(await this.mic_mute.pipe(take(1)).toPromise())\n        );\n    public readonly toggleOnHold = () => this._state.toggleCallOnHold();\n    public readonly endCall = async () => {\n        this.loading = 'Hanging up call...';\n        await this._state.hangup().catch((_) => {\n            this.loading = '';\n            notifyError('Error hanging up call.');\n            throw _;\n        });\n        this._onCallEnded();\n    };\n\n    constructor(\n        private _state: VideoCallStateService,\n        private _control: ControlStateService,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this.timeout(\n            'check_call',\n            () => {\n                notifyError('Unable to find active video conference.');\n                this._onCallEnded();\n            },\n            5000\n        );\n        await this._state.call\n            .pipe(\n                filter((_) => !!_),\n                take(1)\n            )\n            .toPromise();\n        this.loading = '';\n        this.clearTimeout('check_call');\n    }\n\n    public selectCamera(camera: string) {\n        const mod = getModule(this._control.id, 'System');\n        if (!mod) return;\n        mod.execute('selected_camera', [camera]);\n    }\n\n    private _onCallEnded() {\n        if (this.redirect) this._router.navigate(['/panel', this._control.id]);\n    }\n}\n","import { Component, Input, SimpleChanges } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map, take } from 'rxjs/operators';\nimport { ControlStateService, RoomOutput } from '../control-state.service';\nimport { ICON_MAP } from '../ui/output-display.component';\n\n@Component({\n    selector: 'device-output-list-item',\n    template: `\n        <button\n            matRipple\n            class=\"m-2 rounded bg-white shadow h-40 w-full flex-1 border p-2\"\n            [class.border-gray-200]=\"!active\"\n            [class.border-primary]=\"active\"\n            *ngIf=\"item || true\"\n            (click)=\"setActiveOutput()\"\n        >\n            <div\n                class=\"bg-blue-900 rounded w-full h-full relative flex flex-col items-center justify-center\"\n                [class.!bg-gray-400]=\"!(input | async)\"\n            >\n                <div\n                    class=\"absolute top-1 left-1 p-1 text-sm rounded bg-gray-700 text-white\"\n                    [class.!bg-primary]=\"active\"\n                >\n                    {{ item?.name || 'Display' }}\n                </div>\n                <app-icon class=\"text-5xl\">\n                    {{\n                        (input | async)?.icon ||\n                            icons[(input | async)?.type] ||\n                            'add_to_queue'\n                    }}\n                </app-icon>\n                <span\n                    class=\"text-white text-sm\"\n                    [class.opacity-60]=\"!(input | async)\"\n                >\n                    {{ (input | async)?.name || 'No input source' }}\n                </span>\n            </div>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n            }\n        `,\n    ],\n})\nexport class DeviceOutputListItemComponent extends AsyncHandler {\n    @Input() public item: RoomOutput;\n    @Input() public active: boolean;\n    /** Current volume level for output */\n    public volume: number;\n    /** Current mute state of the output */\n    public mute: boolean;\n\n    public readonly icons = ICON_MAP;\n    /** ID of the input associated with the displayed output */\n    private _input = new BehaviorSubject('');\n    /** Details of the associated input */\n    public readonly input = combineLatest([\n        this._input,\n        this._state.input_list,\n    ]).pipe(map(([id, list]) => list.find((_) => _.id === id || _.ref === id)));\n\n    public readonly setVolume = (v) =>\n        this.timeout('volume', () => this._state.setVolume(v, this.item?.id));\n    public readonly setMute = (s) => this._state.setMute(s, this.item?.id);\n    public readonly setActiveOutput = async () => {\n        const { selected_input } =\n            (await this._state.system.pipe(take(1)).toPromise()) || {};\n        this.item?.source === selected_input\n            ? this._state.unroute(this.item.id)\n            : this._state.setOutput(this.item?.id);\n    };\n\n    constructor(private _state: ControlStateService) {\n        super();\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.item) {\n            this._input.next(this.item?.source || '');\n        }\n    }\n}\n","import { Component } from '@angular/core';\nimport { map } from 'rxjs/operators';\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'device-output-list',\n    template: `\n        <ng-container\n            *ngIf=\"(outputs | async)?.length > 1 || (preview_outputs | async)\"\n        >\n            <device-output-list-item\n                *ngFor=\"let output of outputs | async\"\n                [item]=\"output\"\n                [active]=\"(active_output | async) === output.id\"\n            ></device-output-list-item>\n        </ng-container>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                width: 100%;\n                height: 100%;\n                overflow: auto;\n                align-items: center;\n                margin-bottom: -0.5rem;\n            }\n\n            :host > * {\n                min-width: 25%;\n            }\n        `,\n    ],\n})\nexport class DeviceOutputListComponent {\n    public readonly outputs = this._state.output_list.pipe(map((_) => _ || []));\n    public readonly active_output = this._state.active_output;\n    public readonly preview_outputs = this._state.preview_outputs;\n\n    constructor(private _state: ControlStateService) {\n        this.outputs.subscribe();\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { AsyncHandler } from '@placeos/common';\nimport { getModule } from '@placeos/ts-client';\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'tv-controls',\n    template: `\n        <div hidden [attr.mod]=\"mod\">\n            <i\n                binding\n                [(model)]=\"channel_list\"\n                [sys]=\"system_id\"\n                [mod]=\"mod\"\n                bind=\"channel_details\"\n            ></i>\n            <i\n                binding\n                [(model)]=\"channel_url\"\n                [sys]=\"system_id\"\n                [mod]=\"mod\"\n                bind=\"current_channel\"\n            ></i>\n        </div>\n        <div\n            class=\"flex flex-wrap p-8 items-center justify-center\"\n            *ngIf=\"channel_list?.length\"\n        >\n            <button\n                matRipple\n                class=\"w-32 h-28 m-2 flex flex-col items-center justify-center border border-gray-200 rounded space-y-2\"\n                [class.bg-gray-50]=\"channel_url !== item.channel\"\n                [class.bg-primary]=\"channel_url === item.channel\"\n                [class.text-white]=\"channel_url === item.channel\"\n                *ngFor=\"let item of channel_list\"\n                (click)=\"setChannel(item.channel)\"\n            >\n                <img\n                    *ngIf=\"item?.icon\"\n                    [src]=\"item.icon\"\n                    class=\"max-h-[3.5rem] max-w-[3.5rem]\"\n                />\n                <div class=\"\">{{ item.name }}</div>\n            </button>\n        </div>\n    `,\n})\nexport class TVControlsComponent extends AsyncHandler {\n    @Input() public mod = '';\n\n    public channel_list = [];\n    public channel_url = '';\n\n    public get system_id() {\n        return this._state.id;\n    }\n\n    constructor(private _state: ControlStateService) {\n        super();\n    }\n\n    public setChannel(url: string) {\n        const mod = getModule(this._state.id, this.mod);\n        mod.execute('channel', [url]);\n    }\n}\n","import { Pipe } from \"@angular/core\";\n\nimport { marked } from 'marked';\n\n@Pipe({\n    name: 'markdown'\n})\nexport class MarkdownPipe {\n    public transform(value: string): string {\n        return value ? marked(value) : '';\n    }\n}\n","import { Component } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { AsyncHandler } from '@placeos/common';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { debounceTime, map, take } from 'rxjs/operators';\nimport { ControlStateService } from '../control-state.service';\nimport { VideoCallStateService } from '../video-call/video-call-state.service';\n\n@Component({\n    selector: 'tab-outlet,[tab-outlet]',\n    template: `\n        <i\n            binding\n            [sys]=\"id\"\n            mod=\"HearingAugmentation\"\n            bind=\"join_code\"\n            [(model)]=\"join_code\"\n        ></i>\n        <div\n            class=\"h-full w-full flex flex-col items-center overflow-auto px-2 py-2 dark:text-white\"\n        >\n            <div\n                class=\"flex items-center w-full px-1 pt-2 overflow-hidden relative\"\n                [class.pr-24]=\"join_code\"\n            >\n                <a\n                    matRipple\n                    class=\"h-24 w-32 rounded-t rounded-b-none shadow mx-1 bg-gray-300 dark:bg-neutral-800 text-black/60 dark:text-white/60 flex flex-col border-t border-l border-r items-center justify-center leading-tight overflow-hidden\"\n                    [routerLink]=\"['/tabbed', id, tab.id || tab.name]\"\n                    routerLinkActive=\"!bg-white dark:!bg-[#1F2021] !text-primary\"\n                    queryParamsHandling=\"merge\"\n                    *ngFor=\"let tab of tabs | async\"\n                >\n                    <app-icon class=\"text-5xl\">{{ tab.icon }}</app-icon>\n                    <p>{{ tab.name }}</p>\n                </a>\n                <div\n                    class=\"absolute top-0 bottom-2 right-0 w-20 p-2 flex flex-col bg-white dark:bg-[#1F2021] rounded shadow border-gray-200\"\n                    *ngIf=\"join_code\"\n                >\n                    <img\n                        class=\"w-16 min-h-[4rem] rounded overflow-hidden border border-[hsl(217,62%,38%)]\"\n                        src=\"assets/loop.png\"\n                    />\n                    <p class=\"text-black text-center\">{{ join_code }}</p>\n                </div>\n            </div>\n            <div\n                class=\"flex-1 h-1/2 w-full bg-white dark:bg-[#1F2021] rounded shadow flex items-center divide-x divide-gray-200 text-black\"\n            >\n                <div\n                    class=\"w-64 h-full space-y-2 px-4 pt-2 pb-4 overflow-auto\"\n                    *ngIf=\"(inputs | async)?.length > 1\"\n                >\n                    <h3 class=\"text-center p-2 font-medium text-lg\">\n                        Available Inputs\n                    </h3>\n                    <button\n                        btn\n                        matRipple\n                        class=\"w-full\"\n                        *ngFor=\"let input of inputs | async\"\n                        [class.inverse]=\"\n                            (system$ | async)?.selected_input !==\n                            (input.id || input.name)\n                        \"\n                        (click)=\"setInput(input)\"\n                    >\n                        {{ input?.name }}\n                    </button>\n                    <div\n                        class=\"flex-1 h-1/2 w-full p-8 flex items-center justify-center opacity-30\"\n                        *ngIf=\"!(inputs | async)?.length\"\n                    >\n                        No inputs available for category\n                    </div>\n                </div>\n                <div\n                    style=\"flex: 2\"\n                    class=\"h-full relative overflow-auto min-h-full dark:text-white\"\n                >\n                    <ng-container [ngSwitch]=\"(tab | async)?.controls\">\n                        <ng-container *ngSwitchCase=\"'vidconf-controls'\">\n                            <ng-template #no_call_state>\n                                <div class=\"flex justify-center space-x-8\">\n                                    <camera-controls\n                                        *ngIf=\"!(speaker_track | async)\"\n                                    ></camera-controls>\n                                    <video-call-dial-view\n                                        class=\"mt-4 block\"\n                                        [redirect]=\"false\"\n                                    ></video-call-dial-view>\n                                </div>\n                            </ng-template>\n                            <div\n                                *ngIf=\"call | async; else no_call_state\"\n                                video-call-page\n                                [present_output]=\"\n                                    (tab | async)?.presentation_source\n                                \"\n                                [redirect]=\"false\"\n                            ></div>\n                        </ng-container>\n                        <ng-container *ngSwitchCase=\"'tv-channels'\">\n                            <tv-controls\n                                [mod]=\"(tab | async)?.mod\"\n                            ></tv-controls>\n                        </ng-container>\n                        <ng-container *ngSwitchDefault>\n                            <div\n                                class=\"p-8\"\n                                content\n                                *ngIf=\"help | async\"\n                                [innerHTML]=\"\n                                    (help | async).content | markdown | safe\n                                \"\n                            ></div>\n                            <div\n                                *ngIf=\"!(help | async)\"\n                                class=\"h-full w-full flex items-center justify-center opacity-60\"\n                            >\n                                <p>\n                                    No controls available for this input source\n                                </p>\n                            </div>\n                        </ng-container>\n                    </ng-container>\n                    <button\n                        *ngIf=\"(tab | async)?.help && (tab | async)?.controls\"\n                        btn\n                        matRipple\n                        class=\"absolute top-4 right-4 w-32 inverse black\"\n                        (click)=\"viewHelp()\"\n                    >\n                        <div class=\"flex items-center justify-center mr-2\">\n                            <app-icon>help</app-icon>\n                            <div class=\"mx-2\">Help</div>\n                        </div>\n                    </button>\n                </div>\n            </div>\n            <div class=\"w-full\">\n                <device-output-list></device-output-list>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            a {\n                color: #000;\n            }\n        `,\n    ],\n})\nexport class TabOutletComponent extends AsyncHandler {\n    public readonly active_tab = new BehaviorSubject('');\n    public readonly system$ = this._service.system;\n    public readonly tabs = this._service.tabs;\n    public readonly call = this._vc_state.call;\n    public readonly speaker_track = this._vc_state.speaker_track;\n    public readonly tab = combineLatest([\n        this._service.tabs,\n        this.active_tab,\n    ]).pipe(map(([_, id]) => _.find((t: any) => (t.id || t.name) === id)));\n\n    public readonly inputs = combineLatest([\n        this.active_tab,\n        this.tabs,\n        this._service.input_list,\n    ]).pipe(\n        map(([id, tabs, inputs]) => {\n            const tab = tabs.find((_: any) => (_.id || _.name) === id);\n            if (!tab) return [];\n            return inputs.filter(\n                (_) =>\n                    (!tab.inputs && (!tab.type || _.type === tab.type)) ||\n                    (tab.inputs && tab.inputs.includes(_.id))\n            );\n        })\n    );\n\n    public readonly help = combineLatest([\n        this._service.help_items,\n        this.tab,\n    ]).pipe(map(([_, t]) => (_ || []).find((h: any) => h.id === t?.help)));\n\n    public join_code: string = '';\n\n    public setInput = (s) => this._service.setOutputSource(s.id);\n    public viewHelp = async () =>\n        this._service.viewHelp((await this.tab.pipe(take(1)).toPromise()).help);\n\n    public get id() {\n        return this._service.id;\n    }\n\n    constructor(\n        private _service: ControlStateService,\n        private _vc_state: VideoCallStateService,\n        private _route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'route.params',\n            this._route.paramMap.subscribe((params) =>\n                this.active_tab.next(\n                    params.get('tab') || this.active_tab.getValue()\n                )\n            )\n        );\n        this.subscription(\n            'tab',\n            this._service.system.subscribe((_) => {\n                this.timeout(\n                    'update_tab',\n                    () => {\n                        if (_.selected_tab) {\n                            this.active_tab.next(_.selected_tab);\n                            this._router.navigate(\n                                ['/tabbed', this.id, _.selected_tab],\n                                { queryParamsHandling: 'merge' }\n                            );\n                        }\n                    },\n                    500\n                );\n            })\n        );\n        this.subscription(\n            'inputs',\n            combineLatest([this.inputs, this.system$, this.tab])\n                .pipe(debounceTime(100))\n                .subscribe(([_, { selected_input }, tab]) => {\n                    if (_.find((i) => (i.id || i.name) === selected_input))\n                        return;\n                    _.length ? this._service.setSelectedInput(_[0].id) : '';\n                })\n        );\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ActivatedRoute, Router } from '@angular/router';\n\nimport { AsyncHandler, VERSION } from '@placeos/common';\nimport { ChangelogModalComponent } from '@placeos/components';\n\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'app-control-tabbed-view',\n    template: `\n        <ng-container *ngIf=\"(system | async).connected; else load_state\">\n            <div\n                *ngIf=\"(system | async).active; else power_off_state\"\n                class=\"absolute inset-0 flex flex-col bg-slate-700 dark:bg-[#1F2021] divide divide-gray-200 dark:divide-neutral-700\"\n            >\n                <topbar-header></topbar-header>\n                <div\n                    class=\"h-1/2 flex-1 bg-gray-100 dark:bg-neutral-900\"\n                    tab-outlet\n                ></div>\n                <control-status-bar></control-status-bar>\n            </div>\n        </ng-container>\n        <ng-template #power_off_state>\n            <div\n                name=\"splash\"\n                class=\"absolute inset-0 text-white flex flex-col items-center justify-center\"\n                (click)=\"powerOn()\"\n                (touchend)=\"powerOn()\"\n            >\n                <h2 class=\"font-light text-4xl mb-4\">Touch to Start</h2>\n                <p class=\"text-lg\">{{ (system | async).name }}</p>\n                <div class=\"absolute bottom-0 left-0 p-2\">\n                    <div class=\"text-xs opacity-60 w-full\">\n                        <ng-container i18n>Version: </ng-container>\n                        <button\n                            class=\"underline p-0 m-0 bg-none border-none text-xs\"\n                            (click)=\"viewChangelog()\"\n                        >\n                            {{ version.hash }}\n                        </button>\n                    </div>\n                    <div class=\"text-xs opacity-60 w-full\">\n                        {{ version.time | date: 'longDate' }}\n                        ({{ version.time | date: 'shortTime' }})\n                    </div>\n                </div>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                name=\"loader\"\n                class=\"absolute inset-0 bg-white text-black flex flex-col items-center justify-center\"\n            >\n                <mat-spinner class=\"mb-4\" [diameter]=\"64\"></mat-spinner>\n                <div class=\"text-2xl my-4\">\n                    Connecting to system(<em>{{ id }}</em\n                    >)...\n                </div>\n                <div class=\"text-base\"></div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                color: #fff;\n            }\n\n            [name='loader'] {\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 304 304' width='304' height='304'%3E%3Cpath fill='%23000' fill-opacity='0.05' d='M44.1 224a5 5 0 1 1 0 2H0v-2h44.1zm160 48a5 5 0 1 1 0 2H82v-2h122.1zm57.8-46a5 5 0 1 1 0-2H304v2h-42.1zm0 16a5 5 0 1 1 0-2H304v2h-42.1zm6.2-114a5 5 0 1 1 0 2h-86.2a5 5 0 1 1 0-2h86.2zm-256-48a5 5 0 1 1 0 2H0v-2h12.1zm185.8 34a5 5 0 1 1 0-2h86.2a5 5 0 1 1 0 2h-86.2zM258 12.1a5 5 0 1 1-2 0V0h2v12.1zm-64 208a5 5 0 1 1-2 0v-54.2a5 5 0 1 1 2 0v54.2zm48-198.2V80h62v2h-64V21.9a5 5 0 1 1 2 0zm16 16V64h46v2h-48V37.9a5 5 0 1 1 2 0zm-128 96V208h16v12.1a5 5 0 1 1-2 0V210h-16v-76.1a5 5 0 1 1 2 0zm-5.9-21.9a5 5 0 1 1 0 2H114v48H85.9a5 5 0 1 1 0-2H112v-48h12.1zm-6.2 130a5 5 0 1 1 0-2H176v-74.1a5 5 0 1 1 2 0V242h-60.1zm-16-64a5 5 0 1 1 0-2H114v48h10.1a5 5 0 1 1 0 2H112v-48h-10.1zM66 284.1a5 5 0 1 1-2 0V274H50v30h-2v-32h18v12.1zM236.1 176a5 5 0 1 1 0 2H226v94h48v32h-2v-30h-48v-98h12.1zm25.8-30a5 5 0 1 1 0-2H274v44.1a5 5 0 1 1-2 0V146h-10.1zm-64 96a5 5 0 1 1 0-2H208v-80h16v-14h-42.1a5 5 0 1 1 0-2H226v18h-16v80h-12.1zm86.2-210a5 5 0 1 1 0 2H272V0h2v32h10.1zM98 101.9V146H53.9a5 5 0 1 1 0-2H96v-42.1a5 5 0 1 1 2 0zM53.9 34a5 5 0 1 1 0-2H80V0h2v34H53.9zm60.1 3.9V66H82v64H69.9a5 5 0 1 1 0-2H80V64h32V37.9a5 5 0 1 1 2 0zM101.9 82a5 5 0 1 1 0-2H128V37.9a5 5 0 1 1 2 0V82h-28.1zm16-64a5 5 0 1 1 0-2H146v44.1a5 5 0 1 1-2 0V18h-26.1zm102.2 270a5 5 0 1 1 0 2H98v14h-2v-16h124.1zM242 149.9V160h16v34h-16v62h48v48h-2v-46h-48v-66h16v-30h-16v-12.1a5 5 0 1 1 2 0zM53.9 18a5 5 0 1 1 0-2H64V2H48V0h18v18H53.9zm112 32a5 5 0 1 1 0-2H192V0h50v2h-48v48h-28.1zm-48-48a5 5 0 0 1-9.8-2h2.07a3 3 0 1 0 5.66 0H178v34h-18V21.9a5 5 0 1 1 2 0V32h14V2h-58.1zm0 96a5 5 0 1 1 0-2H137l32-32h39V21.9a5 5 0 1 1 2 0V66h-40.17l-32 32H117.9zm28.1 90.1a5 5 0 1 1-2 0v-76.51L175.59 80H224V21.9a5 5 0 1 1 2 0V82h-49.59L146 112.41v75.69zm16 32a5 5 0 1 1-2 0v-99.51L184.59 96H300.1a5 5 0 0 1 3.9-3.9v2.07a3 3 0 0 0 0 5.66v2.07a5 5 0 0 1-3.9-3.9H185.41L162 121.41v98.69zm-144-64a5 5 0 1 1-2 0v-3.51l48-48V48h32V0h2v50H66v55.41l-48 48v2.69zM50 53.9v43.51l-48 48V208h26.1a5 5 0 1 1 0 2H0v-65.41l48-48V53.9a5 5 0 1 1 2 0zm-16 16V89.41l-34 34v-2.82l32-32V69.9a5 5 0 1 1 2 0zM12.1 32a5 5 0 1 1 0 2H9.41L0 43.41V40.6L8.59 32h3.51zm265.8 18a5 5 0 1 1 0-2h18.69l7.41-7.41v2.82L297.41 50H277.9zm-16 160a5 5 0 1 1 0-2H288v-71.41l16-16v2.82l-14 14V210h-28.1zm-208 32a5 5 0 1 1 0-2H64v-22.59L40.59 194H21.9a5 5 0 1 1 0-2H41.41L66 216.59V242H53.9zm150.2 14a5 5 0 1 1 0 2H96v-56.6L56.6 162H37.9a5 5 0 1 1 0-2h19.5L98 200.6V256h106.1zm-150.2 2a5 5 0 1 1 0-2H80v-46.59L48.59 178H21.9a5 5 0 1 1 0-2H49.41L82 208.59V258H53.9zM34 39.8v1.61L9.41 66H0v-2h8.59L32 40.59V0h2v39.8zM2 300.1a5 5 0 0 1 3.9 3.9H3.83A3 3 0 0 0 0 302.17V256h18v48h-2v-46H2v42.1zM34 241v63h-2v-62H0v-2h34v1zM17 18H0v-2h16V0h2v18h-1zm273-2h14v2h-16V0h2v16zm-32 273v15h-2v-14h-14v14h-2v-16h18v1zM0 92.1A5.02 5.02 0 0 1 6 97a5 5 0 0 1-6 4.9v-2.07a3 3 0 1 0 0-5.66V92.1zM80 272h2v32h-2v-32zm37.9 32h-2.07a3 3 0 0 0-5.66 0h-2.07a5 5 0 0 1 9.8 0zM5.9 0A5.02 5.02 0 0 1 0 5.9V3.83A3 3 0 0 0 3.83 0H5.9zm294.2 0h2.07A3 3 0 0 0 304 3.83V5.9a5 5 0 0 1-3.9-5.9zm3.9 300.1v2.07a3 3 0 0 0-1.83 1.83h-2.07a5 5 0 0 1 3.9-3.9zM97 100a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-48 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 96a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-144a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM49 36a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM33 68a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 240a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm80-176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm112 176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 180a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 84a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6z'%3E%3C/path%3E%3C/svg%3E\");\n            }\n\n            [name='splash'] {\n                animation: crossfade 10s linear;\n                animation-iteration-count: infinite;\n            }\n        `,\n    ],\n})\nexport class ControlTabbedViewComponent extends AsyncHandler implements OnInit {\n    public readonly system = this._state.system;\n\n    public readonly powerOn = () => this._state.powerOn();\n    public get id() {\n        return this._state.id;\n    }\n\n    public get version() {\n        return VERSION;\n    }\n\n    public async viewChangelog() {\n        const changelog = await (\n            await fetch(\n                'https://raw.githubusercontent.com/PlaceOS/user-interfaces/develop/CHANGELOG.md'\n            )\n        ).text();\n        this._dialog.open(ChangelogModalComponent, { data: { changelog } });\n    }\n\n    constructor(\n        private _route: ActivatedRoute,\n        private _router: Router,\n        private _state: ControlStateService,\n        private _dialog: MatDialog\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'route.params',\n            this._route.paramMap.subscribe((params) =>\n                params.has('system')\n                    ? this._state.setID(params.get('system'))\n                    : ''\n            )\n        );\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) =>\n                params.get('join') === 'true' ? this._state.selectMeeting() : ''\n            )\n        );\n        this.timeout('init', () =>\n            !this._state.id ? this._router.navigate(['/bootstrap']) : ''\n        );\n        this.interval('update', () => null, 1000);\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\n\nimport { AsyncHandler } from '@placeos/common';\n\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'app-control-main-view',\n    template: `\n        <ng-container *ngIf=\"(system | async).connected; else load_state\">\n            <div\n                *ngIf=\"(system | async).active; else power_off_state\"\n                class=\"absolute inset-0 flex flex-col\"\n            >\n                <topbar-header></topbar-header>\n\n                <div class=\"h-1/2 flex-1\">\n                    <div\n                        class=\"absolute inset-4 flex flex-col bg-white rounded shadow\"\n                        video-call-page\n                    ></div>\n                </div>\n                <control-status-bar></control-status-bar>\n            </div>\n        </ng-container>\n        <ng-template #power_off_state>\n            <div\n                name=\"splash\"\n                class=\"absolute inset-0 text-white flex flex-col items-center justify-center\"\n                (click)=\"powerOn()\"\n                (touchend)=\"powerOn()\"\n            >\n                <h2 class=\"font-light text-4xl mb-4\">Touch to Start</h2>\n                <p class=\"text-lg\">{{ (system | async).name }}</p>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                name=\"loader\"\n                class=\"absolute inset-0 bg-white text-black flex flex-col items-center justify-center\"\n            >\n                <mat-spinner class=\"mb-4\" [diameter]=\"64\"></mat-spinner>\n                <div class=\"text-2xl my-4\">\n                    Connecting to system(<em>{{ id }}</em\n                    >)...\n                </div>\n                <div class=\"text-base\"></div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                background-color: var(--secondary);\n                color: #fff;\n            }\n\n            [name='loader'] {\n                background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 304 304' width='304' height='304'%3E%3Cpath fill='%23000' fill-opacity='0.05' d='M44.1 224a5 5 0 1 1 0 2H0v-2h44.1zm160 48a5 5 0 1 1 0 2H82v-2h122.1zm57.8-46a5 5 0 1 1 0-2H304v2h-42.1zm0 16a5 5 0 1 1 0-2H304v2h-42.1zm6.2-114a5 5 0 1 1 0 2h-86.2a5 5 0 1 1 0-2h86.2zm-256-48a5 5 0 1 1 0 2H0v-2h12.1zm185.8 34a5 5 0 1 1 0-2h86.2a5 5 0 1 1 0 2h-86.2zM258 12.1a5 5 0 1 1-2 0V0h2v12.1zm-64 208a5 5 0 1 1-2 0v-54.2a5 5 0 1 1 2 0v54.2zm48-198.2V80h62v2h-64V21.9a5 5 0 1 1 2 0zm16 16V64h46v2h-48V37.9a5 5 0 1 1 2 0zm-128 96V208h16v12.1a5 5 0 1 1-2 0V210h-16v-76.1a5 5 0 1 1 2 0zm-5.9-21.9a5 5 0 1 1 0 2H114v48H85.9a5 5 0 1 1 0-2H112v-48h12.1zm-6.2 130a5 5 0 1 1 0-2H176v-74.1a5 5 0 1 1 2 0V242h-60.1zm-16-64a5 5 0 1 1 0-2H114v48h10.1a5 5 0 1 1 0 2H112v-48h-10.1zM66 284.1a5 5 0 1 1-2 0V274H50v30h-2v-32h18v12.1zM236.1 176a5 5 0 1 1 0 2H226v94h48v32h-2v-30h-48v-98h12.1zm25.8-30a5 5 0 1 1 0-2H274v44.1a5 5 0 1 1-2 0V146h-10.1zm-64 96a5 5 0 1 1 0-2H208v-80h16v-14h-42.1a5 5 0 1 1 0-2H226v18h-16v80h-12.1zm86.2-210a5 5 0 1 1 0 2H272V0h2v32h10.1zM98 101.9V146H53.9a5 5 0 1 1 0-2H96v-42.1a5 5 0 1 1 2 0zM53.9 34a5 5 0 1 1 0-2H80V0h2v34H53.9zm60.1 3.9V66H82v64H69.9a5 5 0 1 1 0-2H80V64h32V37.9a5 5 0 1 1 2 0zM101.9 82a5 5 0 1 1 0-2H128V37.9a5 5 0 1 1 2 0V82h-28.1zm16-64a5 5 0 1 1 0-2H146v44.1a5 5 0 1 1-2 0V18h-26.1zm102.2 270a5 5 0 1 1 0 2H98v14h-2v-16h124.1zM242 149.9V160h16v34h-16v62h48v48h-2v-46h-48v-66h16v-30h-16v-12.1a5 5 0 1 1 2 0zM53.9 18a5 5 0 1 1 0-2H64V2H48V0h18v18H53.9zm112 32a5 5 0 1 1 0-2H192V0h50v2h-48v48h-28.1zm-48-48a5 5 0 0 1-9.8-2h2.07a3 3 0 1 0 5.66 0H178v34h-18V21.9a5 5 0 1 1 2 0V32h14V2h-58.1zm0 96a5 5 0 1 1 0-2H137l32-32h39V21.9a5 5 0 1 1 2 0V66h-40.17l-32 32H117.9zm28.1 90.1a5 5 0 1 1-2 0v-76.51L175.59 80H224V21.9a5 5 0 1 1 2 0V82h-49.59L146 112.41v75.69zm16 32a5 5 0 1 1-2 0v-99.51L184.59 96H300.1a5 5 0 0 1 3.9-3.9v2.07a3 3 0 0 0 0 5.66v2.07a5 5 0 0 1-3.9-3.9H185.41L162 121.41v98.69zm-144-64a5 5 0 1 1-2 0v-3.51l48-48V48h32V0h2v50H66v55.41l-48 48v2.69zM50 53.9v43.51l-48 48V208h26.1a5 5 0 1 1 0 2H0v-65.41l48-48V53.9a5 5 0 1 1 2 0zm-16 16V89.41l-34 34v-2.82l32-32V69.9a5 5 0 1 1 2 0zM12.1 32a5 5 0 1 1 0 2H9.41L0 43.41V40.6L8.59 32h3.51zm265.8 18a5 5 0 1 1 0-2h18.69l7.41-7.41v2.82L297.41 50H277.9zm-16 160a5 5 0 1 1 0-2H288v-71.41l16-16v2.82l-14 14V210h-28.1zm-208 32a5 5 0 1 1 0-2H64v-22.59L40.59 194H21.9a5 5 0 1 1 0-2H41.41L66 216.59V242H53.9zm150.2 14a5 5 0 1 1 0 2H96v-56.6L56.6 162H37.9a5 5 0 1 1 0-2h19.5L98 200.6V256h106.1zm-150.2 2a5 5 0 1 1 0-2H80v-46.59L48.59 178H21.9a5 5 0 1 1 0-2H49.41L82 208.59V258H53.9zM34 39.8v1.61L9.41 66H0v-2h8.59L32 40.59V0h2v39.8zM2 300.1a5 5 0 0 1 3.9 3.9H3.83A3 3 0 0 0 0 302.17V256h18v48h-2v-46H2v42.1zM34 241v63h-2v-62H0v-2h34v1zM17 18H0v-2h16V0h2v18h-1zm273-2h14v2h-16V0h2v16zm-32 273v15h-2v-14h-14v14h-2v-16h18v1zM0 92.1A5.02 5.02 0 0 1 6 97a5 5 0 0 1-6 4.9v-2.07a3 3 0 1 0 0-5.66V92.1zM80 272h2v32h-2v-32zm37.9 32h-2.07a3 3 0 0 0-5.66 0h-2.07a5 5 0 0 1 9.8 0zM5.9 0A5.02 5.02 0 0 1 0 5.9V3.83A3 3 0 0 0 3.83 0H5.9zm294.2 0h2.07A3 3 0 0 0 304 3.83V5.9a5 5 0 0 1-3.9-5.9zm3.9 300.1v2.07a3 3 0 0 0-1.83 1.83h-2.07a5 5 0 0 1 3.9-3.9zM97 100a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-48 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 96a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-144a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm96 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM49 36a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-32 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM33 68a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 240a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm80-176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 48a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm112 176a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-16 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 180a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0 16a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm0-32a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16 0a3 3 0 1 0 0-6 3 3 0 0 0 0 6zM17 84a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm32 64a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm16-16a3 3 0 1 0 0-6 3 3 0 0 0 0 6z'%3E%3C/path%3E%3C/svg%3E\");\n            }\n\n            [name='splash'] {\n                animation: crossfade 10s linear;\n                animation-iteration-count: infinite;\n            }\n        `,\n    ],\n})\nexport class ControlVideoCallViewComponent\n    extends AsyncHandler\n    implements OnInit\n{\n    public readonly system = this._state.system;\n\n    public readonly powerOn = () => this._state.powerOn();\n    public get id() {\n        return this._state.id;\n    }\n\n    constructor(\n        private _route: ActivatedRoute,\n        private _router: Router,\n        private _state: ControlStateService\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription(\n            'route.params',\n            this._route.paramMap.subscribe((params) =>\n                params.has('system')\n                    ? this._state.setID(params.get('system'))\n                    : ''\n            )\n        );\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) =>\n                params.get('join') === 'true' ? this._state.selectMeeting() : ''\n            )\n        );\n        this.timeout('init', () =>\n            !this._state.id ? this._router.navigate(['/bootstrap']) : ''\n        );\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { BootstrapComponent } from './bootstrap.component';\nimport { ControlMainViewComponent } from './main-view.component';\nimport { ControlTabbedViewComponent } from './tabbed-view/tabbed-view.component';\nimport { ControlVideoCallViewComponent } from './video-call/video-call-view.component';\n\nconst routes: Routes = [\n    {\n        path: 'bootstrap',\n        component: BootstrapComponent,\n    },\n    {\n        path: 'panel/:system',\n        component: ControlMainViewComponent,\n    },\n    {\n        path: 'tabbed/:system',\n        component: ControlTabbedViewComponent,\n    },\n    {\n        path: 'tabbed/:system/:tab',\n        component: ControlTabbedViewComponent,\n    },\n    {\n        path: 'panel/:system/call',\n        component: ControlVideoCallViewComponent,\n    },\n    { path: '**', redirectTo: 'bootstrap' }\n];\n\n@NgModule({\n    imports: [RouterModule.forRoot(routes, { useHash: true })],\n    exports: [RouterModule],\n})\nexport class AppRoutingModule {}\n","import { HashMap, predictableRandomInt } from '@placeos/common';\nimport { addMinutes, differenceInMinutes } from 'date-fns';\n\nexport const MOCK_MENU = [\n    {\n        id: 'item-1',\n        name: 'Coffee',\n        unit_price: 200,\n        category: 'Drinks',\n        tags: ['drink', 'Contains Nuts', 'Contains Dairy'],\n        options: [\n            { id: 'opt-1', name: 'Cappacino', group: 'type' },\n            { id: 'opt-2', name: 'Latte', group: 'type' },\n            { id: 'opt-3', name: '1 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-4', name: '2 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-5', name: '3 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-6', name: '4 Sugar', group: 'sugars', unit_price: 20 },\n        ],\n    },\n    {\n        id: 'item-2',\n        name: 'Soda',\n        unit_price: 160,\n        category: 'Drinks',\n        tags: ['drink'],\n        options: [\n            { id: 'opt-1', name: 'Pepsi', group: 'type' },\n            { id: 'opt-2', name: 'Sunkist', group: 'type' },\n            { id: 'opt-3', name: 'Solo', group: 'type' },\n            { id: 'opt-4', name: 'Dr Pepper', group: 'type' },\n        ],\n    },\n    { id: 'item-3', name: 'Water', unit_price: 100, category: 'Drinks' },\n    {\n        id: 'item-4',\n        name: 'Muffin',\n        unit_price: 160,\n        category: 'Snacks',\n        options: [\n            { id: 'opt-1', name: 'Choc Chip', group: 'type' },\n            { id: 'opt-2', name: 'Banana', group: 'type' },\n            { id: 'opt-3', name: 'Blueberry', group: 'type' },\n        ],\n    },\n    {\n        id: 'item-5',\n        name: 'Cookies',\n        unit_price: 400,\n        category: 'Snacks',\n        options: [\n            { id: 'opt-1', name: 'Choc Chip', group: 'type' },\n            { id: 'opt-2', name: 'Macadamia', group: 'type' },\n            { id: 'opt-3', name: 'Dark Choc', group: 'type' },\n        ],\n    },\n    {\n        id: 'item-6',\n        name: 'Fish & Chips',\n        unit_price: 250,\n        category: 'Simple Meals',\n        options: [\n            {\n                id: 'opt-1',\n                name: 'Tomato Sauce',\n                group: 'sauce',\n                unit_price: 30,\n            },\n            { id: 'opt-2', name: 'BBQ Sauce', group: 'sauce', unit_price: 35 },\n            {\n                id: 'opt-3',\n                name: 'Tartare Sause',\n                group: 'sauce',\n                unit_price: 40,\n            },\n            {\n                id: 'opt-4',\n                name: 'Garlic Aoili Sauce',\n                group: 'sauce',\n                unit_price: 50,\n            },\n        ],\n    },\n    {\n        id: 'item-7',\n        name: 'Sandwich',\n        unit_price: 300,\n        category: 'Simple Meals',\n        options: [\n            { id: 'opt-1', name: 'Ham & Cheese', group: 'type' },\n            { id: 'opt-2', name: 'Chicken', group: 'type' },\n            { id: 'opt-3', name: 'Fairy Bread', group: 'type' },\n        ],\n    },\n];\n\nexport function generateCateringOrder(event: HashMap) {\n    const duration = differenceInMinutes(event.event_start, event.event_end);\n    const mx = predictableRandomInt(MOCK_MENU.length);\n    return {\n        id: `order-${predictableRandomInt(999_999)}`,\n        event_id: event.id,\n        invoice_number: `I${predictableRandomInt(999_999)}`,\n        charge_code: `C${predictableRandomInt(9_999)}`,\n        deliver_at: addMinutes(\n            event.event_start * 1000,\n            predictableRandomInt(Math.floor(duration / 5)) * 5\n        ),\n        notes: predictableRandomInt(9999_9999) % 2 === 0 ? 'Test notes' : '',\n        items: new Array(3).fill(0).map((_, idx) => ({\n            ...MOCK_MENU[(mx * idx) % MOCK_MENU.length],\n            options: [],\n            quantity: predictableRandomInt(10, 1),\n        })),\n    };\n}\n","/** Domain of the organisation */\nexport const DOMAIN = 'place.tech';\n/** Endpoint where the staff API is located */\nexport const API = '/api/staff/v1';\n","import { predictableRandomInt } from '@placeos/common';\nimport { DOMAIN } from './common.mock';\n\nconst PREDEF_USERS = [\n    'Jonathan McFarlane',\n    'Alex Sorafumo',\n    'Jim Doe',\n    'Cristina Boston',\n    'Jeremy West',\n    'Viv Briffa',\n    'Candy Russo',\n    'Jeff Wiz',\n    'Sravani Kotha',\n    'Kim Burgess',\n    'Caspian Baska',\n    'Stephen Von Takach',\n    'Cameron Reeves',\n    'Shane Boseley',\n];\n\nexport const ACTIVE_USER = {\n    id: 'current',\n    name: 'PlaceOS - Mock User',\n    email: 'dev@place.tech',\n    groups: ['deals', 'user'],\n};\n\nexport const MOCK_STAFF = PREDEF_USERS.map((name, i) => ({\n    id: `user-${i + 1}`,\n    name: `${name} (PlaceOS)`,\n    email: `${name.split(' ').join('.').toLowerCase()}@${DOMAIN}`,\n})).concat([ACTIVE_USER]);\n\nexport const MOCK_GUESTS = PREDEF_USERS.map((name, i) => ({\n    id: `guest-${i + 1}`,\n    name: `${name} (External)`,\n    email: `${name.split(' ').join('.').toLowerCase()}@guest.${DOMAIN}`,\n    visit_expected: predictableRandomInt(99999) % 2 === 0,\n    extension_data: predictableRandomInt(99999) % 3 === 0 ? {\n        vaccination_proof: { url: 'https://fonts.gstatic.com/s/i/materialicons/verified/v11/24px.svg' },\n        id_data: { url: 'https://fonts.gstatic.com/s/i/materialicons/fingerprint/v12/24px.svg' } \n    } : {}\n}));\n","export const MOCK_ORGS = [\n    {\n        created_at: 1587057070,\n        updated_at: 1587692680,\n        name: 'PlaceOS',\n        description: '',\n        tags: 'org',\n        count: 0,\n        capacity: 0,\n        parent_id: '',\n        triggers: [],\n        id: 'zone-EmWFTjuYExK',\n    },\n];\n\nexport const MOCK_BUILDINGS = [\n    {\n        name: 'Sydney',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-01',\n        levels: ['lvl-G', 'lvl-1'],\n    },\n    {\n        name: 'Brisbane',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-02',\n        levels: ['lvl-2', 'lvl-3'],\n    },\n];\n\nconst mockLevel = (\n    id: string,\n    idx: number,\n    building: any,\n    num: string = '10'\n): any => {\n    let map_id = id.substr(4);\n    map_id = `assets/maps/level_${num}.svg`;\n    return {\n        id: `${building.id}_${id}`,\n        name: `Level ${id.endsWith('00') ? 'G' : id.split('-')[1]}`,\n        parent_id: building.id,\n        description: '',\n        tags: 'level',\n        map_id,\n        code: 'level code 12',\n        type: 'staff floor',\n        count: 5,\n        capacity: 30,\n        location: 'optional lat,long',\n        display_name: '',\n    };\n};\n\nexport const MOCK_LEVELS = MOCK_BUILDINGS.map((bld) =>\n    bld.levels.map((level, idx) =>\n        mockLevel(level, idx, bld, level.split('-')[1])\n    )\n).reduce((p, c) => p.concat(c), [\n    // {\n    //     id: 'test',\n    //     parent_id: 'bld-01',\n    //     name: 'Test',\n    //     map_id: 'assets/maps/test.svg',\n    // },\n    {\n        id: 'level-p1',\n        parent_id: 'bld-01',\n        name: 'Level P1',\n        tags: ['level', 'parking'],\n        map_id: 'assets/maps/level_P1.svg',\n    },\n]);\n","import { padString, predictableRandomInt } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_MENU } from './catering.data';\nimport { MOCK_STAFF } from './users.data';\nimport { MOCK_ORGS, MOCK_LEVELS, MOCK_BUILDINGS } from './zone.data';\n\nconst MOCK_METADATA = {\n    current: {\n        contacts: {\n            name: 'contacts',\n            description: '',\n            details: [\n                {\n                    id: 'user-1',\n                    name: 'Jonathan McFarlane (PlaceOS)',\n                    email: 'jon@place.tech',\n                    first_name: 'Jonathan',\n                    last_name: 'McFarlane',\n                },\n                {\n                    id: 'user-1',\n                    name: 'Alex Sorafumo (PlaceOS)',\n                    email: 'alex@place.tech',\n                    first_name: 'Alex',\n                    last_name: 'Sorafumo',\n                },\n            ],\n        },\n    },\n};\n\nexport const PARKING_SPACES = {};\n\nexport const ZONE_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/engine/v2/zones',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.tags === 'org') {\n                return MOCK_ORGS;\n            } else if (request.query_params.tags === 'region') {\n                return [];\n            } else if (request.query_params.tags === 'building') {\n                return MOCK_BUILDINGS;\n            } else if (request.query_params.tags === 'level') {\n                return MOCK_LEVELS;\n            }\n            throw { status: 404, message: 'Zones not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.name === 'bindings') {\n                return {\n                    bindings: {\n                        details: {\n                            area_management: 'space-0',\n                            location_services: 'space-0',\n                            contact_tracing: 'space-0',\n                            // payments: 'space-0',\n                        },\n                    },\n                };\n            }\n            if (request.query_params.name === 'catering') {\n                return {\n                    catering: {\n                        details: MOCK_MENU,\n                    },\n                };\n            }\n            if (request.query_params.name === 'desks') {\n                const parts = request.route_params.id.split('-');\n                const id = parts[parts.length - 1];\n                return generateMockDeskMetadata(id);\n            }\n            if (request.query_params.name === 'parking-spaces') {\n                const parts = request.route_params.id.split('-');\n                const id = parts[parts.length - 1];\n                return generateParkingSpaces(id);\n            }\n            if (request.query_params.name === 'charge_codes') {\n                const parts = request.route_params.id.split('-');\n                const id = parts[parts.length - 1];\n                return {\n                    charge_codes: {\n                        details: new Array(30)\n                            .fill(0)\n                            .map((_, idx) => `C-${idx}`),\n                    },\n                };\n            }\n            if (request.query_params.name === 'map_regions') {\n                return {\n                    map_regions: {\n                        details: {\n                            areas: [\n                                {\n                                    id: 'zone-10.A',\n                                    properties: {\n                                        capacity: 100,\n                                        label_location: { x: 0.36, y: 0.33 },\n                                        // draw_polygon: true\n                                    },\n                                    geometry: {\n                                        coordinates: [\n                                            [0.0, 0.0],\n                                            [0.0, 0.5],\n                                            [0.5, 0.5],\n                                            [0.5, 0.0],\n                                        ],\n                                    },\n                                },\n                                {\n                                    id: 'zone-10.B',\n                                    properties: {\n                                        capacity: 100,\n                                        label_location: { x: 0.76, y: 0.33 },\n                                    },\n                                },\n                                {\n                                    id: 'zone-10.C',\n                                    properties: {\n                                        capacity: 100,\n                                        label_location: { x: 0.63, y: 0.77 },\n                                    },\n                                },\n                            ],\n                        },\n                    },\n                };\n            }\n            if (\n                MOCK_METADATA[request.route_params.id] &&\n                MOCK_METADATA[request.route_params.id][\n                    request.query_params.name\n                ]\n            ) {\n                return MOCK_METADATA[request.route_params.id];\n            } else if (\n                MOCK_METADATA[request.route_params.id] &&\n                !request.query_params.name\n            ) {\n                return MOCK_METADATA[request.route_params.id] || {};\n            }\n            return {};\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id',\n        metadata: {},\n        method: 'PATCH',\n        callback: (request) => {\n            if (!MOCK_METADATA[request.route_params.id])\n                MOCK_METADATA[request.route_params.id] = {};\n            MOCK_METADATA[request.route_params.id][request.body.name] =\n                request.body;\n        },\n    });\n\n    const DESK_FEATURES = ['sit_to_stand', 'single_monitor', 'dual_monitor'];\n\n    function generateMockDeskMetadata(id: string) {\n        return {\n            desks: {\n                details: new Array(30).fill(0).map((_, idx) => ({\n                    id: `table-${padString(id, 2)}.${padString(idx + 1, 3)}`,\n                    name: `Desk ${id}.${padString(idx + 1, 3)}`,\n                    bookable: predictableRandomInt(9999) % 4 !== 0,\n                    groups:\n                        predictableRandomInt(9999) % 4 === 0 ? ['test-1'] : [],\n                    features: DESK_FEATURES.filter(\n                        (_) => predictableRandomInt(99999) % 3 === 0\n                    ),\n                })),\n            },\n        };\n    }\n\n    function generateParkingSpaces(id: string) {\n        if (!PARKING_SPACES[id]) {\n            PARKING_SPACES[id] = {\n                'parking-spaces': {\n                    details: new Array(18 * 6).fill(0).map((_, idx) => {\n                        const position = padString(\n                            (idx % 18) + Math.floor(idx / 18) * 100,\n                            3\n                        );\n                        const assignee =\n                            predictableRandomInt(9999) % 4 === 0\n                                ? MOCK_STAFF[\n                                      predictableRandomInt(MOCK_STAFF.length)\n                                  ]\n                                : ({} as any);\n                        return {\n                            id: `park-${position}`,\n                            map_id: `park-${position}`,\n                            name: `${position}`,\n                            bookable: predictableRandomInt(9999) % 4 !== 0,\n                            assigned_to: assignee.email || '',\n                            assigned_name: assignee.name || '',\n                        };\n                    }),\n                },\n            };\n        }\n        return PARKING_SPACES[id];\n    }\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id/children',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const zone = MOCK_BUILDINGS.find(\n                (_) => _.id === request.route_params.id\n            );\n            if (!zone)\n                throw {\n                    status: 404,\n                    message: `Unable to find zone with id \"${request.route_params.id}\"`,\n                };\n            return MOCK_LEVELS.filter((_) => _.parent_id === zone.id).map(\n                (lvl) => {\n                    const parts = lvl.id.split('-');\n                    const id = parts[parts.length - 1];\n                    return {\n                        zone: lvl,\n                        metadata: generateMockDeskMetadata(id),\n                    };\n                }\n            );\n        },\n    });\n}\n","import { predictableRandomInt } from '@placeos/common';\nimport { generateMockSpace } from '@placeos/spaces';\n\nconst randomSpaceFeatures = () => {\n    const f = ['Whiteboard', 'VidConf', 'Projector', 'Views'];\n    const numFeatures = predictableRandomInt(f.length + 1);\n    const res = [];\n    for (let i = 0; i < numFeatures; i++) {\n        res.push(f[predictableRandomInt(f.length)]);\n    }\n    return res.filter((el, i, r) => r.indexOf(el) === i);\n};\n\nexport const MOCK_SPACES = [\n    {\n        name: '1.01 Operations Room',\n        map_id: 'area-1.01-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: '1.03 Sydney Boardroom',\n        map_id: 'area-1.03-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: '1.04 The Studio',\n        map_id: 'area-1.04-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: 'Jam Board',\n        map_id: 'area-1.02-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: 'G.01 Cisco Room',\n        map_id: 'area-G.01-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: 'G.02 The Lab',\n        map_id: 'area-G.02-status',\n        zones: ['bld-01', 'bld-01_lvl-1'],\n    },\n    {\n        name: 'Conference Room 2.01',\n        map_id: 'area-2.01-status',\n        zones: ['bld-02', 'bld-02_lvl-2'],\n    },\n    {\n        name: 'Conference Room 2.02',\n        map_id: 'area-2.02-status',\n        zones: ['bld-02', 'bld-02_lvl-2'],\n    },\n    {\n        name: 'Conference Room 3.01',\n        map_id: 'area-3.01-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n    {\n        name: 'Conference Room 3.02',\n        map_id: 'area-3.02-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n    {\n        name: 'Conference Room 3.03',\n        map_id: 'area-3.03-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n].map((d) => generateMockSpace({ ...d, features: randomSpaceFeatures(), images: ['https://webcdn.executivecentre.com/wp-content/uploads/sites/39/2020/10/img-meetingroomrental_hire.jpg'] }));\n","import { predictableRandomInt, unique } from '@placeos/common';\nimport * as dayjs from 'dayjs';\nimport { generateCateringOrder } from './catering.data';\nimport { MOCK_SPACES } from './spaces.data';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\n\nlet EVENT_TIME = dayjs().startOf('d').hour(7);\n\nconst nextEventTime = (save = false): number => {\n    const next = EVENT_TIME.add((predictableRandomInt(8) + 1) * 15, 'm');\n    if (save) {\n        EVENT_TIME = next;\n    }\n    return next.unix();\n};\n\nconst event_status = ['tentative', 'confirmed', 'cancelled'];\nconst randomStatus = (): string => {\n    const rnd = predictableRandomInt(10);\n    return rnd < 2\n        ? event_status[2]\n        : rnd < 5\n        ? event_status[0]\n        : event_status[1];\n};\n\nexport const MOCK_EVENTS = new Array(200).fill(0).map((_, index) => {\n    const PEOPLE = MOCK_STAFF.concat(MOCK_GUESTS);\n    let attendees: any[] = new Array(predictableRandomInt(8, 1))\n        .fill(0)\n        .map(() => PEOPLE[predictableRandomInt(PEOPLE.length)]);\n    attendees.sort(\n        (a, b) => (a.visit_expected ? 0 : -1) - (b.visit_expected ? 0 : -1)\n    );\n    const space = MOCK_SPACES[predictableRandomInt(MOCK_SPACES.length)];\n    attendees = attendees.concat({ ...space, resource: true });\n    if (predictableRandomInt(9999) % 2 === 0) attendees.unshift(ACTIVE_USER);\n    else attendees.unshift(MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)]);\n    attendees = unique(attendees, 'email') || [{}];\n    const event_start = nextEventTime(true);\n    const event_end = nextEventTime();\n    const meeting_url =\n        predictableRandomInt(9999) % 3 === 0 ? 'https://meet.place.tech' : '';\n    return {\n        id: `cal-event-${index}`,\n        status: randomStatus(),\n        host: attendees[0].email,\n        calendar: 'calendar_id',\n        creator: 'optional@fake.com',\n        attendees: (unique(attendees, 'email') || []).map((_, idx) => ({\n            ..._,\n            organizer: idx === 0,\n            checked_in: predictableRandomInt(99999) % 2 === 0,\n            response_status:\n                predictableRandomInt(99999) % 2 === 0\n                    ? 'accepted'\n                    : predictableRandomInt(99999) % 6 === 0\n                    ? 'declined'\n                    : 'tentative',\n        })),\n        title: `Some Meeting ${index}`,\n        body: `A Description`,\n        private: false,\n        event_start,\n        event_end,\n        timezone: 'Australia/Sydney',\n        all_day: false,\n        location: `${space?.name}`,\n        recurring: false,\n        recurrence: {},\n        attachments: {},\n        system: space,\n        meeting_url,\n        meeting_id: meeting_url ? `m${predictableRandomInt(9999)}` : '',\n        meeting_provider: meeting_url ? 'PlaceOS' : '',\n        extension_data: {\n            catering:\n                predictableRandomInt(99999) % 4 === 0\n                    ? [\n                          generateCateringOrder({\n                              id: `cal-event-${index}`,\n                              event_start,\n                              event_end,\n                          }),\n                      ]\n                    : [],\n            setup: predictableRandomInt(4) * 5,\n            breakdown: predictableRandomInt(4) * 5,\n        },\n    };\n});\n\nconst event_spaces = {};\nMOCK_EVENTS.forEach((event) => {\n    if (!event_spaces[event.system?.id]) {\n        event_spaces[event.system?.id] = [];\n    }\n    event_spaces[event.system?.id].push(event);\n});\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\nimport { MOCK_LEVELS } from './zone.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport * as dayjs from 'dayjs';\nimport { MOCK_EVENTS } from './events.data';\n\nexport const USER_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/engine/v2/users/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.route_params.id === 'current') {\n                return ACTIVE_USER;\n            }\n            const person = MOCK_STAFF.find(\n                (user) => user.email === request.route_params.id\n            );\n            if (person) {\n                return person;\n            }\n            throw { status: 404, message: 'User not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/people',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.q) {\n                const search = request.query_params.q.toLowerCase();\n                return MOCK_STAFF.filter(\n                    (user) =>\n                        user.name.toLowerCase().includes(search) ||\n                        user.email.toLowerCase().includes(search)\n                );\n            }\n            return MOCK_STAFF;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/people/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const id = decodeURIComponent(request.route_params.id);\n            const person = MOCK_STAFF.find((user) => user.email === id);\n            if (person) {\n                return {\n                    ...person,\n                    location: generateLocation(),\n                };\n            }\n            throw { status: 404, message: 'User not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.q) {\n                const search = request.query_params.q.toLowerCase();\n                return MOCK_GUESTS.filter(\n                    (user) =>\n                        user.name.toLowerCase().includes(search) ||\n                        user.email.toLowerCase().includes(search)\n                );\n            }\n            return MOCK_STAFF;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests/:email',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const email = decodeURIComponent(request.route_params.email);\n            const person = MOCK_GUESTS.find((user) => user.email === email);\n            if (person) {\n                return person;\n            }\n            throw { status: 404, message: 'Guest not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests/:email/meetings',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.route_params.email) {\n                const email = request.route_params.email.toLowerCase();\n                const events = MOCK_EVENTS.filter((event) =>\n                    event.attendees.find(\n                        (user) => user.email.toLowerCase() === email\n                    )\n                );\n                return events;\n            }\n            throw {\n                status: 404,\n                message: `Unable to find meetings with guest with email ${request.route_params.email}`,\n            };\n        },\n    });\n\n    const LOCATION_TYPES = [\n        'meeting',\n        'desk_id',\n        'laptop',\n        'mobile',\n        'geo',\n        'none',\n    ];\n\n    function generateLocation() {\n        const type =\n            LOCATION_TYPES[predictableRandomInt(LOCATION_TYPES.length)];\n        const level = MOCK_LEVELS[predictableRandomInt(MOCK_LEVELS.length)];\n        const level_spaces = MOCK_SPACES.filter((s) =>\n            s.zones.includes(level.id)\n        );\n        const space =\n            level_spaces[predictableRandomInt(level_spaces.length)] || {};\n        const location: HashMap = {};\n        switch (type) {\n            case 'meeting':\n                location.meeting = {\n                    building: level.parent_id,\n                    level: level.id,\n                    system: space.id,\n                    map_id: space.map_id,\n                    event_id: '',\n                };\n                break;\n            case 'desk_id':\n                location.meeting = {\n                    building: level.parent_id,\n                    level: level.id,\n                    map_id: space.map_id,\n                    checked_in: dayjs().unix(),\n                };\n                break;\n            case 'laptop':\n            case 'mobile':\n                location[type] = {\n                    building: level.parent_id,\n                    level: level.id,\n                    x: +predictableRandomInt(10000),\n                    y: +predictableRandomInt(5000),\n                    last_seen: dayjs()\n                        .subtract(predictableRandomInt(60), 'm')\n                        .unix(),\n                };\n                break;\n            case 'geo':\n                location.geo = {\n                    lat: predictableRandomInt(180) - 90,\n                    lon: predictableRandomInt(360) - 180,\n                    last_seen: dayjs()\n                        .subtract(predictableRandomInt(60), 'm')\n                        .unix(),\n                };\n                break;\n        }\n        return location;\n    }\n}\n","import { HashMap, unique } from '@placeos/common';\n\nexport interface EnvironmentSource {\n    id?: string;\n    name: string;\n    type?: 'lights' | 'blinds' | 'screen';\n    state: string | number;\n    states: string[];\n}\n\nexport interface RoomInput {\n    id?: string;\n    ref: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    locked: boolean;\n    routes: string[];\n    outputs: string[];\n}\n\nexport interface RoomOutput {\n    id?: string;\n    ref: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    locked: boolean;\n    source: string;\n    inputs: string[];\n    following: string;\n}\n\nclass RoomModule {\n    public readonly name: string;\n    public readonly connected: boolean;\n    public active: boolean;\n\n    public readonly input_list: HashMap<RoomInput>;\n    public readonly output_list: HashMap<RoomOutput>;\n    public readonly env_sources: EnvironmentSource[];\n\n    public readonly inputs;\n    public readonly outputs;\n    public readonly available_outputs;\n    public readonly environment;\n\n    public readonly help = {\n        help: {\n            title: 'Help',\n            content: `\n# Using the asset browser\n\n## Activating the menu\nThe 5 finger touch can be actvated by placing 4 fingers and your thumb on the screen, or quickly double-tapping the screen. Activation through double tap will leave the menu on-screen. To close tap the ‘X’.\n\n## Selecting a menu item\nLeaving at least one finger on the screen, drag your finger to the icon to select.\n\n## Home Menu\nThe home menu allows you to access files and navigate to content and presentations via the Launcher.\n\n## Connect and stream your laptop or access the CMS to add files\nPlug your laptop into the HDMI to stream it to the screen, or access the CMS to add your own content and create custom presentations.\n\n<video></video>\n\n1. Test1\n2. Test2\n3. Test3\n            `,\n        },\n        'laptop-help': {\n            icon: 'web_asset',\n            title: 'Asset Browser',\n            content: `# Test 2`,\n        },\n    };\n\n    public tabs = [\n        {\n            icon: 'laptop',\n            name: 'Laptop',\n            type: 'Display',\n            inputs: ['Display_1'],\n            help: 'laptop-help',\n        },\n        {\n            icon: 'call',\n            name: 'VC',\n            inputs: ['VidConf_1'],\n            help: 'vidconf-help',\n            controls: 'vidconf-controls',\n        },\n    ];\n\n    public volume = 0;\n\n    constructor(_data: Partial<RoomModule>) {\n        this.name = _data.name || 'Test Module';\n        this.connected = _data.connected ?? true;\n        this.active = _data.active || false;\n        this.input_list = _data.input_list;\n        this.output_list = _data.output_list;\n        this.env_sources = _data.env_sources || [];\n        this.inputs = Object.keys(this.input_list || {}) || [];\n        this.outputs = Object.keys(this.output_list || {}) || [];\n        this.available_outputs = this.outputs;\n        const types = unique(this.env_sources.map((_) => _.type)) || [];\n        types.forEach(\n            (t) =>\n                (this[`${t}`] = this.env_sources\n                    .filter((_) => _.type === t)\n                    .map((_) => _.id))\n        );\n        this.env_sources.forEach(\n            (source) => (this[`${source.type}/${source.id}`] = source)\n        );\n        this.inputs.forEach(\n            (key) => (this[`input/${key}`] = this.input_list[key])\n        );\n        this.outputs.forEach(\n            (key) => (this[`output/${key}`] = this.output_list[key])\n        );\n    }\n\n    $power(state = true) {\n        this.active = state;\n    }\n    /** Shares a signal source with the room and any connected remote participants. */\n    $share() {}\n    /**\n     * Connect a signal source to a signal output, or set of outputs. Any intermediate\n     * device interactions are handled internally. For example, on a system using a small\n     * presentation switcher and a display, routing a laptop input will select the\n     * appropriate input on the switcher, and select the appropriate input on the display.\n     *\n     * This includes all routable signal types - in addition to the above example, this may\n     * be interacting with an audio DSP to add a microphone feed to an output zone, or\n     * connecting a USB HID input device with a specific output.\n     **/\n    $route(input: string, output: string) {\n        if (this.inputs.includes(input) && this.outputs.includes(output)) {\n            this.$updateState(input, {\n                routes: unique([\n                    ...(this.input_list[input].routes || []),\n                    output,\n                ]),\n            });\n            this.$updateState(output, {\n                source: input,\n                following: input,\n            });\n        }\n    }\n    /**\n     * Remove a signal source from a signal output.\n     * Predominantly intended for outputs that support more than one simultaneous input source\n     * (mixed audio zone, or display capable of compositing multiple video sources).\n     **/\n    $unroute() {}\n    /**\n     * Establish a call (either phone or video) with a remote participant.\n     * This may be a peer-to-peer connection or a wider group via an external bridging service.\n     **/\n    $connect() {}\n    /** End a call with a remote participant. */\n    $disconnect() {}\n    /**\n     * Bind the current system to another PlaceOS controlled space, relinquishing local control.\n     * This may be used for an education pod that pairs with a wider classroom or a room being\n     * used as an overflow from a primary event space.\n     **/\n    $link() {}\n    /**\n     * Join the current system with another PlaceOS controlled space, sharing control and signal IO.\n     * Examples of usage would be a set of rooms with moveable walls. N-way merges supported.\n     **/\n    $merge() {}\n    /** Separate from a linked or merged system. */\n    $split() {}\n    /**\n     * Display an alert visible to participants in the space. This may occur as a screen overlay,\n     * on a control interface, a bot post in a chat space associated with the current meeting or\n     * other modalities depending on hardware capability.\n     **/\n    $notify() {}\n    /**\n     * Place the room into a predefined operation mode. This may include executing an arbitrary\n     * set of device interactions, changing metadata associated with the system itself (changing\n     * available input or output nodes), or other configurable actions designed to transition\n     * the space to a specific state.\n     **/\n    $preset() {}\n    /**\n     * Set the volume for a signal node in the space. This can include outputs as well as inputs\n     * where supported (e.g. microphone). If unspecified, default is to interact with a ‘primary’\n     * output node.\n     **/\n    $volume(value: number, source: string = 'all') {\n        if (source === 'all') {\n            this.volume = value;\n        }\n    }\n    /** Interact with audio muting on supporting signal nodes within the space. */\n    $mute(state: boolean = true, source: string = 'all') {\n        this.$updateState(source, { mute: state });\n    }\n    /**\n     * Activates or deactivates a signal mute for the associated IO. If this is not possible,\n     * (e.g. unsupported by the device) an error is returned.\n     **/\n    $unmute(source: string = 'all') {\n        this.$mute(false, source);\n    }\n    /**\n     * Wrapper for an arbitrary set of control points defined in system configuration.\n     * Each of these may map to control options available on a sibling module and take one of two forms:\n     *  - Continuous value within a range (temperature set point 16.0...28.0 degrees, lighting level 0...100)\n     *  - Set of possible states (lighting high/med/low, blind up/down, electrochromic glass clear/opaque)\n     *\n     * System state provides the ability to introspect configured points for both control limits and current value.\n     **/\n    $environment(id: string, state: string | number) {\n        const source = this.env_sources.find((_) => _.id === id);\n        if (source) {\n            this[`${source.type}/${source.id}`] = { ...source, state };\n        }\n    }\n    /** Locks an IO node. Prevents any route changes that include this until unlocked. */\n    $lock(source: string) {\n        this.$updateState(source, { locked: true });\n    }\n    /** Unlocks an IO node. */\n    $unlock(source: string) {\n        this.$updateState(source, { locked: false });\n    }\n\n    $updateState(source: string, data: HashMap) {\n        if (this[`input/${source}`]) {\n            this[`input/${source}`] = { ...this[`input/${source}`], ...data };\n            this.input_list[source] = { ...this[`input/${source}`], ...data };\n        } else if (this[`output/${source}`]) {\n            this[`output/${source}`] = { ...this[`output/${source}`], ...data };\n            this.output_list[source] = { ...this[`output/${source}`], ...data };\n        }\n    }\n}\n\nconst input_list: HashMap = {\n    Mic1: {\n        name: 'Lectern Mic',\n        type: 'Microphone',\n        mod: 'Microphone_1',\n    },\n    Mic2: {\n        name: 'Lapel Mic',\n        type: 'Microphone',\n        mod: 'Microphone_2',\n    },\n    Mic3: {\n        name: 'Handheld Mic',\n        type: 'Microphone',\n        mod: 'Microphone_3',\n    },\n    PC1: {\n        name: 'PC-1',\n        type: 'PC',\n    },\n    PC2: {\n        name: 'PC-2',\n        type: 'PC',\n    },\n    PC3: {\n        name: 'PC-3',\n        type: 'PC',\n    },\n    PC4: {\n        name: 'PC-4',\n        type: 'PC',\n    },\n    HDMI: {\n        name: 'Laptop HDMI',\n        type: 'Laptop',\n    },\n    VGA: {\n        name: 'Laptop VGA',\n        type: 'Laptop',\n    },\n    Camera1: {\n        name: 'Camera Rear',\n        type: 'Camera',\n        mod: 'Camera_1',\n    },\n    Camera2: {\n        name: 'Camera Front',\n        type: 'Camera',\n        mod: 'Camera_2',\n    },\n    Camera3: {\n        name: 'Camera Rear 2',\n        type: 'Camera',\n        mod: 'Camera_3',\n    },\n    Camera4: {\n        name: 'Camera Front 2',\n        type: 'Camera',\n        mod: 'Camera_4',\n    },\n    TV1: {\n        name: 'IPTV 1',\n        type: 'TV',\n        mod: 'IPTV_1',\n    },\n    VC1: {\n        name: 'Video Conference 1',\n        type: 'VC',\n        mod: 'VidConf_1',\n    },\n};\n\nconst output_list: HashMap = {\n    Display1: {\n        name: 'Display 1',\n        type: 'Display',\n        source: 'PC1',\n        mod: 'Display_1',\n    },\n    Display2: {\n        name: 'Display 2',\n        type: 'Display',\n        mod: 'Display_2',\n    },\n    Display3: {\n        name: 'Display 3',\n        type: 'Display',\n        source: 'PC2',\n        mod: 'Display_3',\n    },\n    Display4: {\n        name: 'Display 4',\n        type: 'Display',\n        mod: 'Display_4',\n    },\n    Display5: {\n        name: 'Display 5',\n        type: 'Display',\n        mod: 'Display_5',\n        source: 'TV1',\n    },\n};\n\nconst env_sources: any[] = [\n    {\n        id: 'light1',\n        name: 'Lighting',\n        type: 'lights',\n        states: ['Off', 'Presentation', 'Meeting', 'Full'],\n        state: 'Off',\n    },\n    {\n        id: 'blind1',\n        name: 'Blinds',\n        type: 'blinds',\n        states: ['Off', 'Presentation', 'Meeting'],\n        state: 'Off',\n    },\n    {\n        id: 'screen1',\n        name: 'Screen',\n        type: 'screen',\n        states: ['Up', 'Down'],\n        state: 'Down',\n    },\n];\n\nexport const createSystemModule = (space: HashMap, overrides: HashMap = {}) =>\n    new RoomModule({\n        ...space,\n        input_list,\n        output_list,\n        env_sources,\n        ...overrides,\n    });\n","import { addSeconds, format, isBefore, subSeconds } from 'date-fns';\n\nimport { HashMap, timePeriodsIntersect } from '@placeos/common';\nimport { MOCK_EVENTS } from '../api/events.data';\n\nexport class MockBookingModule {\n    /** Timezone the associated space resided */\n    time_zone = 'Australia/Sydney';\n    /** Whether booking is disabled */\n    disable_book_now = false;\n    /** Whether ending current meeting is disabled */\n    disable_end_meeting = false;\n    /** List of current and upcoming bookings for space */\n    bookings: HashMap[] = [];\n    pending_period = 0;\n    pending_before = 0;\n    /** Control UI associated with the space */\n    control_ui = '';\n    /** Catering UI associated with the space */\n    catering_ui = '';\n    /** Time of the last booking started by a user */\n    last_booking_started = 0;\n    current_booking = null;\n    next_booking = null;\n    /** Current status of the space */\n    room_image = 'assets/boardroom.jpg'\n    status = 'free';\n    _space = null;\n\n    constructor(space, _data: Partial<MockBookingModule>) { this._space = space }\n\n    /** Start the meeting at the given time */\n    $start_meeting(t: number) {\n        this.last_booking_started = t;\n    }\n    /** End the meeting at the given time */\n    $end_meeting(t: number) {}\n    /** Book meeting for the current time */\n    $book_now(len: number, t?: string, o?: string) {}\n\n    $poll_bookings() {\n        updateBookings(this._space, this);\n    }\n}\n\nexport const createBookingsModule = (\n    space: HashMap,\n    overrides: Partial<MockBookingModule> = {}\n) => new MockBookingModule(space, overrides);\n\nfunction updateBookings(space: HashMap, mod: HashMap) {\n    const bookings =\n        MOCK_EVENTS.filter((event) =>\n            event.attendees?.find(\n                (u) =>\n                    u.email === space.email ||\n                    u.id === space.id ||\n                    event.system?.id === space.id\n            )\n        ) || [];\n    bookings.sort((a, b) => a.event_start - b.event_start);\n    mod.bookings = bookings;\n    mod.current_booking = bookings.find((_) =>\n        timePeriodsIntersect(\n            Date.now(),\n            Date.now(),\n            _.event_start * 1000,\n            _.event_end * 1000\n        )\n    );\n    mod.next_booking = bookings.find((_) => _.event_start * 1000 > Date.now());\n    const date = new Date();\n    const { current_booking, next_booking } = mod;\n    const start = new Date((current_booking || next_booking)?.event_start);\n    const pending = timePeriodsIntersect(\n        date,\n        date,\n        subSeconds(start, mod.pending_before),\n        addSeconds(start, mod.pending_period)\n    );\n    mod.status = space?.bookable\n        ? current_booking\n            ? 'busy'\n            : pending\n            ? 'pending'\n            : 'free'\n        : 'not-bookable';\n}\n","import { Md5 } from 'ts-md5';\nimport { HashMap, predictableRandomInt, randomInt } from '@placeos/common';\nimport { MOCK_LEVELS } from '../api/zone.data';\nimport { MOCK_STAFF } from '../api/users.data';\n\nexport interface ZoneOverview {\n    /** Desk count based on `desks` metadata in the zone\n     falls back to the zone.count field otherwise */\n    desk_count: number;\n\n    desk_usage: number;\n    /** Capacity of the space, set in zone.capacity field */\n    device_capacity: number;\n    /** Raw device count */\n    device_count: number;\n    /** This is the adjusted count based on the duplication factor */\n    estimated_people: number;\n\n    percentage_use: number;\n    /** The higher the recommendation number the better for recommending */\n    recommendation: number;\n}\n\nexport class MockAreaManagementModule implements HashMap {\n    /** Overview of the zones */\n    overview: HashMap<ZoneOverview> = {};\n\n    emergency_contacts = {\n        'First Aid': MOCK_STAFF.filter(\n            (_) => predictableRandomInt(9999) % 5 === 0\n        ),\n        'Fire Warden': MOCK_STAFF.filter(\n            (_) => predictableRandomInt(9999) % 5 === 0\n        ),\n    };\n\n    $locate_user(email: string, username: string) {}\n\n    $update() {\n        updateLocations(this, MOCK_LEVELS);\n    }\n}\n\nconst MAC_LOOKUP = {};\n\nexport class MockLocationServicesModule implements HashMap {\n    $check_ownership_of(mac_address: string) {\n        if (!MAC_LOOKUP[mac_address]) {\n            const staff =\n                randomInt(999_999) % 3 === 0\n                    ? MOCK_STAFF[randomInt(MOCK_STAFF.length)]\n                    : { name: '' };\n            MAC_LOOKUP[mac_address] = { assigned_to: staff.name };\n        }\n        return MAC_LOOKUP[mac_address];\n    }\n\n    $locate_user(email: string, username: string) {\n        return [{\n            type: 'wireless',\n            position: { x: 0.5, y: 0.5 },\n            level: MOCK_LEVELS[randomInt(MOCK_LEVELS.length)].id,\n            priority: 0\n        }]\n    }\n}\n\nfunction padZero(no: number, len: number = 3) {\n    let str = `${no}`;\n    while (str.length < len) {\n        str = '0' + str;\n    }\n    return str;\n}\n\nexport function createAreaManagementModule(\n    space: HashMap,\n    overrides: HashMap = {}\n) {\n    const mod = new MockAreaManagementModule();\n    for (const lvl of MOCK_LEVELS) {\n        mod.overview[lvl.id] = {\n            desk_count: 100,\n            desk_usage: 0,\n            device_capacity: 100,\n            device_count: 0,\n            estimated_people: 0,\n            percentage_use: 0,\n            recommendation: 10000,\n        };\n        mod[`${lvl.id}:desk_ids`] = new Array(mod.overview[lvl.id].desk_count)\n            .fill(0)\n            .map((_, idx) => `table-${lvl.number}.${padZero(idx)}`);\n        mod[`${lvl.id}`] = { value: [] };\n        mod[`${lvl.id}:areas`] = {\n            value: [\n                {\n                    area_id: 'zone-10.B',\n                    count: randomInt(100),\n                    name: '.L1 IFS IT',\n                },\n                {\n                    area_id: 'zone-10.A',\n                    count: randomInt(100),\n                    name: '.L1 IFS IT',\n                },\n                {\n                    area_id: 'zone-10.C',\n                    count: randomInt(50),\n                    name: '.L1 IFS IT',\n                },\n                {\n                    area_id: 'zone-02.D',\n                    count: randomInt(100),\n                    name: 'Quite Work',\n                },\n                {\n                    area_id: 'zone-02.B',\n                    count: randomInt(100),\n                    name: 'Meeting Area A',\n                },\n                {\n                    area_id: 'zone-02.A',\n                    count: randomInt(100),\n                    name: 'Meeting Area B',\n                },\n                {\n                    area_id: 'zone-02.C',\n                    count: randomInt(50),\n                    name: 'Casual Work',\n                },\n            ],\n        };\n    }\n    return mod;\n}\n\nexport function updateLocations(\n    mod: MockAreaManagementModule,\n    levels: HashMap[]\n) {\n    for (const lvl of levels) {\n        mod[lvl.id] = {\n            value: new Array(predictableRandomInt(20))\n                .fill(0)\n                .map(() => generateLocation(lvl, mod[`${lvl.id}:desk_ids`])),\n        };\n        for (const area of mod[`${lvl.id}:areas`].value) {\n            area.count = randomInt(100);\n        }\n        mod[`${lvl.id}:areas`] = { ...mod[`${lvl.id}:areas`] };\n    }\n}\n\nexport function generateLocation(\n    lvl: HashMap,\n    desks: string[],\n    users = MOCK_STAFF\n) {\n    const fixed = predictableRandomInt(9999) % 3 === 0;\n    const usr = (users || [])[predictableRandomInt((users || [])?.length)]?.email;\n    return fixed\n        ? {\n              location: 'desk',\n              at_location: predictableRandomInt(9999) % 2 !== 0,\n              map_id: desks[predictableRandomInt(desks.length)],\n              mac: Md5?.hashStr(usr || ''),\n              level: lvl.id,\n              building: lvl.parent_id,\n          }\n        : {\n              location: 'wireless',\n              coordinates_from: 'bottom-left',\n              x: predictableRandomInt(1000) / 10,\n              y: predictableRandomInt(1000) / 10,\n              lon: 55.27476066828535,\n              lat: 25.20106100633537,\n              s2_cell_id: '3e5f4281459c',\n              mac: Md5?.hashStr(usr || ''),\n              variance: 9.62534032222287,\n              last_seen: Math.floor(new Date().valueOf() / 1000),\n              map_width: 100,\n              map_height: 100,\n          };\n}\n","import { HashMap } from '@placeos/common';\n\nexport enum CameraTilt {\n    Down,\n    Up,\n    Stop,\n}\n\nexport enum CameraPan {\n    Left,\n    Right,\n    Stop,\n}\n\nclass CameraModule {\n    pan: number;\n    tilt: number;\n    zoom: number;\n\n    pan_speed: number;\n    tilt_speed: number;\n    zoom_speed: number;\n\n    presets: string[];\n\n    constructor(_) {\n        this.presets = ['Preset One', 'Preset 2', 'Preset Three'];\n    }\n\n    $pan(dir: CameraPan) {}\n\n    $tilt(tilt: CameraTilt) {}\n\n    $recall(name: string) {}\n\n    $save_preset(name: string) {}\n}\n\nexport const createCameraModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CameraModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass DisplayModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createDisplayModule = (space: HashMap, overrides: HashMap = {}) =>\n    new DisplayModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass MicrophoneModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createMicrophoneModule = (\n    space: HashMap,\n    overrides: HashMap = {}\n) => new MicrophoneModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from \"@placeos/common\";\n\nlet interval;\n\nexport class CaptureModule {\n\n    status: 'playing' | 'stopped' | 'paused' = 'stopped';\n    title: string;\n    live: boolean = false;\n    remaining: number;\n    current: number;\n    next: number;\n\n    constructor(_) {\n        this.remaining = randomInt(24 * 60 * 60);\n    }\n\n    $start() {\n        this.status = 'playing';\n        interval = setInterval(() => {\n            if (this.remaining < 1) clearInterval(interval);\n            this.remaining = this.remaining - 1;\n            this.current = this.current + 1;\n        }, 3000);\n    }\n\n    $pause() {\n        this.status = 'paused';\n        clearInterval(interval);\n    }\n\n    $resume() {\n        this.$start();\n    }\n\n    $stop() {\n        this.status = 'stopped';\n        this.current = 0;\n        clearInterval(interval);\n    }\n\n}\n\nexport const createCaptureModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CaptureModule({ ...space, ...overrides });\n","import { HashMap } from '@placeos/common';\n\nclass MeetingPushModule {\n    public supported_meeting_url = 'https://meet.';\n\n    constructor(data: any) {}\n\n    $econtrol(...args: any[]) {}\n}\n\nexport const createMeetingPushModule = (\n    details?: HashMap,\n    overrides: HashMap = {}\n) =>\n    new MeetingPushModule({\n        ...details,\n        ...overrides,\n    });\n","import { HashMap } from '@placeos/common';\n\nexport type VideoLayout = 'Auto' | 'Equal' | 'Overlay' | 'Prominent' | 'Single';\nexport type CallStatus =\n    | 'Idle'\n    | 'Dialling'\n    | 'Ringing'\n    | 'Connecting'\n    | 'Connected'\n    | 'Disconnecting'\n    | 'OnHold'\n    | 'EarlyMedia'\n    | 'Preserved'\n    | 'RemotePreserved';\n\nexport interface VideoCallDetails {\n    AnswerState: string;\n    CallType: string;\n    CallbackNumber: string;\n    DeviceType: string;\n    Direction: string;\n    DisplayName: number;\n    Duration: number;\n    'Encryption/Type': string;\n    FacilityServiceId: number;\n    HoldReason: string;\n    PlacedOnHold: boolean;\n    Protocol: string;\n    ReceiveCallRate: number;\n    RemoteNumber: string;\n    Status: CallStatus;\n    TransmitCallRate: number;\n    Ice: string;\n}\n\nclass VideoConferenceModule {\n    mic_mute: boolean = false;\n    selfview: boolean = false;\n    video_layout: VideoLayout = 'Auto';\n    presentation_mode: 'None' | 'Local' | 'Remote' = 'None';\n    presentation: false | 'Sending';\n    calls: Record<string, VideoCallDetails> = {\n        test: {\n            Status: 'Connected',\n        },\n    } as any;\n\n    $show_camera_pip(visible: boolean) {\n        this.selfview = visible;\n    }\n\n    $mic_mute(visible: boolean) {\n        this.mic_mute = visible;\n    }\n    $presentation_mode(state: 'None' | 'Local' | 'Remote') {\n        this.presentation_mode = state;\n    }\n    $hangup() {}\n    $call_place_on_hold() {\n        for (const key in this.calls) {\n            if (this.calls[key].Status) {\n                this.calls[key].Status = 'OnHold';\n                this.calls = { ...this.calls };\n                return;\n            }\n        }\n    }\n    $call_resume() {\n        for (const key in this.calls) {\n            if (this.calls[key].Status) {\n                this.calls[key].Status = 'Idle';\n                this.calls = { ...this.calls };\n                return;\n            }\n        }\n    }\n    $video_layout(layout: VideoLayout) {\n        this.video_layout = layout;\n    }\n    $dtmf_send(digit: string) {}\n    $dial(dial_number: string) {\n        return new Promise<void>((r) => setTimeout(() => r(), 1000));\n    }\n\n    constructor(_) {}\n}\n\nexport const createVideoConferenceModule = (\n    space: HashMap = {},\n    overrides: HashMap = {}\n) => new VideoConferenceModule({ ...space, ...overrides });\n","import {\n    HashMap,\n    randomInt,\n    randomString,\n    timePeriodsIntersect,\n} from '@placeos/common';\nimport { addDays, getUnixTime, isBefore, setHours } from 'date-fns';\nimport { MOCK_STAFF } from '../api/users.data';\n\nconst CONTACT_EVENTS = {};\n\nconst filterFn = (start, end) => (itm) => {\n    return timePeriodsIntersect(start, end, itm.contact_time, itm.contact_time);\n};\n\nclass ContactTracingModule {\n    constructor(_) {}\n\n    $close_contacts(email: string, user: string, start: number, end: number) {\n        if (!CONTACT_EVENTS[email]) CONTACT_EVENTS[email] = [];\n        if (CONTACT_EVENTS[email].length)\n            return CONTACT_EVENTS[email].filter(filterFn(start, end));\n        const events = [];\n        const beginning = addDays(start * 1000, -10);\n        const ending = addDays(end * 1000, 10);\n        let date = new Date(beginning);\n        while (isBefore(date, ending)) {\n            new Array(randomInt(4))\n                .fill(0)\n                .map((_) => ({\n                    mac_address: randomString(10),\n                    contact_time: getUnixTime(\n                        setHours(date, randomInt(11) + 7)\n                    ),\n                    duration: randomInt(60) * 60,\n                    username: MOCK_STAFF[randomInt(MOCK_STAFF.length)].email,\n                }))\n                .forEach((e) => events.push(e));\n            date = addDays(date, 1);\n        }\n        CONTACT_EVENTS[email] = events;\n        return CONTACT_EVENTS[email].filter(filterFn(start, end));\n    }\n}\n\nexport const createContactTracingModule = (\n    space: HashMap,\n    overrides: HashMap = {}\n) => new ContactTracingModule({ ...space, ...overrides });\n","import { HashMap, randomInt, randomString } from '@placeos/common';\n\nclass PaymentsModule {\n    \n    $list_payment_methods(type: string) {\n        \n    }\n\n    $add_payment_method(type: string, details: any) {\n\n    }\n\n    $get_product_prices(id: string, period) {\n        return [12000, 60];\n    }\n\n    $create_payment_intent(amount: number, source: string) {\n        return randomString(12);\n    }\n\n    $confirm_payment_intent(id: string) {\n\n    }\n\n    $cancel_payment_intent(id: string) {\n    }\n\n    $create_customer(...args: any) {\n        return `stripe-${randomInt(9_999_999, 1_000_000)}`;\n    }\n\n    constructor(_) {}\n}\n\nexport const createPaymentsModule = (space: HashMap, overrides: HashMap = {}) =>\n    new PaymentsModule({ ...space, ...overrides });\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { createSystem } from '../systems-bindings.mock';\nimport { MOCK_SPACES } from './spaces.data';\n\nexport const SYSTEM_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    MOCK_SPACES.forEach((space: any, index) => createSystem(space));\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/systems',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            return request.query_params?.zone_id\n                ? MOCK_SPACES.filter((_) =>\n                      _.zones.includes(request.query_params.zone_id)\n                  )\n                : MOCK_SPACES;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/systems/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const space = MOCK_SPACES.find(_ => _.id === request.route_params.id);\n            if (!space) throw { status: 404 };\n            return space;\n        },\n    });\n}\n","import { mockSystem, registerSystem } from '@placeos/ts-client';\nimport { HashMap } from '@placeos/common';\n\nimport { createSystemModule } from './realtime/control';\nimport { createBookingsModule } from './realtime/events';\nimport { createAreaManagementModule, MockLocationServicesModule } from './realtime/desks';\nimport { createCameraModule } from './realtime/camera';\nimport { createDisplayModule } from './realtime/display';\nimport { createMicrophoneModule } from './realtime/microphone';\nimport { createCaptureModule } from './realtime/capture';\nimport { createMeetingPushModule } from './realtime/meeting';\nimport { createVideoConferenceModule } from './realtime/video-conference';\nimport { createContactTracingModule } from './realtime/contact-tracing';\nimport { createPaymentsModule } from './realtime/payments';\n\nexport function createSystem(space: HashMap) {\n    registerSystem(space.id, {\n        System: [createSystemModule(space)],\n        Bookings: [createBookingsModule(space)],\n        ContactTracing: [createContactTracingModule(space)],\n        AreaManagement: [createAreaManagementModule(space)],\n        LocationServices: [new MockLocationServicesModule()],\n        Camera: new Array(10).fill(0).map((_) => createCameraModule(space)),\n        Display: new Array(10).fill(0).map((_) => createDisplayModule(space)),\n        Microphone: new Array(10)\n            .fill(0)\n            .map((_) => createMicrophoneModule(space)),\n        Capture: [createCaptureModule(space)],\n        MeetingPush: [createMeetingPushModule()],\n        VidConf: [createVideoConferenceModule()],\n        Payment: [createPaymentsModule(space)]\n    });\n\n    const system = mockSystem(space.id);\n\n    system.Bookings[0].$poll_bookings();\n    setInterval(() => system.Bookings[0].$poll_bookings(), 30 * 1000);\n\n    system.AreaManagement[0].$update();\n    setInterval(() => system.AreaManagement[0].$update(), 30 * 1000);\n}\n","import { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { mockSystem, registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_EVENTS } from './events.data';\nimport { ACTIVE_USER, MOCK_STAFF } from './users.data';\n\nexport const EVENT_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/events',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            let events = MOCK_EVENTS;\n            if (!_.query_params.zone_ids) {\n                events = events.filter(\n                    (event) =>\n                        !!event.attendees.find(\n                            (user) => user.email === ACTIVE_USER.email\n                        )\n                );\n            }\n            if (_.query_params.period_start) {\n                events = events.filter((e) =>\n                    timePeriodsIntersect(\n                        _.query_params.period_start,\n                        _.query_params.period_end,\n                        e.event_start,\n                        e.event_end\n                    )\n                );\n            }\n            return events;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const new_event = {\n                ...request.body,\n                id: `-cal-event-${predictableRandomInt(999)}`,\n            };\n            new_event.attendees = [\n                MOCK_STAFF.find((_) => _.email === new_event.host),\n                ...(new_event.attendees || []),\n            ];\n            new_event.attendees.forEach((user) => {\n                if (user.zones) user.resource = true;\n            });\n\n            if (new_event.system) {\n                new_event.attendees = [\n                    ...(new_event.attendees || []),\n                    { ...new_event.system, resource: true },\n                ];\n            }\n            MOCK_EVENTS.push(new_event);\n\n            const system = mockSystem(new_event.system?.id);\n            system?.Bookings[0]?.$poll_bookings();\n            return new_event;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const item = MOCK_EVENTS.find(\n                (event) => event.id === request.route_params.id\n            );\n            if (item) {\n                return item;\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'DELETE',\n        callback: (request) => {\n            const index = MOCK_EVENTS.findIndex(\n                (event) => event.id === request.route_params.id\n            );\n            if (index > 0) {\n                if (MOCK_EVENTS[index].host === ACTIVE_USER.email) {\n                    MOCK_EVENTS.splice(index, 1);\n                } else {\n                    const user = MOCK_EVENTS[index].attendees.find(\n                        (_) => _.email === ACTIVE_USER.email\n                    );\n                    user.response_status = 'declined';\n                }\n                return;\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'PATCH',\n        callback: (request) => {\n            const index = MOCK_EVENTS.findIndex(\n                (event) => event.id === request.route_params.id\n            );\n            if (index >= 0) {\n                return MOCK_EVENTS.splice(index, 1, request.body);\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id/guests/:email/checkin',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const event = MOCK_EVENTS.find(\n                (event) => event.id === request.route_params.id\n            );\n            if (event) {\n                const checked_in =\n                    (event.extension_data as any).checked_in || [];\n                (event.extension_data as any).checked_in = checked_in.concat([\n                    request.route_params.email,\n                ]);\n                return event;\n            }\n            throw { status: 404, message: 'Guest not found' };\n        },\n    });\n}\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_EVENTS } from './events.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { ACTIVE_USER, MOCK_STAFF } from './users.data';\n\nexport const CALENDAR_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const user = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n            const user2 = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n            const user3 = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n            return [\n                {\n                    id: ACTIVE_USER.email,\n                    summary: ACTIVE_USER.name,\n                    primary: true,\n                    can_edit: true,\n                    hidden: false,\n                },\n                {\n                    id: user.email,\n                    summary: user.name,\n                    primary: false,\n                    can_edit: true,\n                    hidden: false,\n                },\n                {\n                    id: user2.email,\n                    summary: user2.name,\n                    primary: false,\n                    can_edit: false,\n                    hidden: false,\n                },\n                {\n                    id: user3.email,\n                    summary: user3.name,\n                    primary: false,\n                    can_edit: false,\n                    hidden: true,\n                },\n            ];\n        },\n    });\n\n    const handleSpaceAvailability = (request) => {\n        const start = +request.query_params.period_start;\n        const end = +request.query_params.period_end;\n        const zones = (request.query_params.zone_ids || '')\n            .split(',')\n            .filter((i) => !!i);\n        const systems = (request.query_params.system_ids || '')\n            .split(',')\n            .filter((i) => !!i);\n\n        const spaces = MOCK_SPACES.filter((space) =>\n            zones.length\n                ? zones.reduce(\n                      (has, zone) => has && space.zones.includes(zone),\n                      true\n                  )\n                : systems.length\n                ? systems.includes(space.id)\n                : true\n        ).filter((space) => {\n            const bookings = MOCK_EVENTS.filter((event) =>\n                event.attendees.find((user) => user.id === space.id)\n            );\n            for (const event of bookings) {\n                if (\n                    timePeriodsIntersect(\n                        start,\n                        end,\n                        event.event_start,\n                        event.event_end\n                    )\n                )\n                    return false;\n            }\n            return true;\n        });\n        return spaces;\n    };\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars/availability',\n        metadata: {},\n        method: 'GET',\n        callback: (request) =>\n            handleSpaceAvailability(request).map((_) => ({\n                resource: _,\n            })),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars/free_busy',\n        metadata: {},\n        method: 'GET',\n        callback: (request) =>\n            handleSpaceAvailability(request).map((_) => ({\n                resource: _,\n            })),\n    });\n}\n","\nexport const MOCK_ASSETS = [\n    {\n        id: '1',\n        name: 'iPad',\n        category: 'Technology',\n        images: [\n            { name: 'chrome.svg', url: 'assets/support/chrome-logo.svg' },\n            { name: 'firefox.svg', url: 'assets/support/firefox-logo.svg' },\n            { name: 'safari.svg', url: 'assets/support/safari-logo.svg' },\n        ],\n    },\n    { id: '2', name: 'iPhone', category: 'Technology' },\n    { id: '3', name: 'iWatch', category: 'Technology' },\n    { id: '4', name: 'Chair', category: 'Furniture' },\n    { id: '5', name: 'Lounge', category: 'Furniture' },\n    { id: '6', name: 'Table', category: 'Furniture' },\n    { id: '7', name: 'Couch', category: 'Furniture' },\n    { id: '8', name: 'Something', category: 'Other' },\n];\n","import {\n    capitalizeFirstLetter,\n    padString,\n    predictableRandomInt,\n    randomString,\n} from '@placeos/common';\nimport { addMinutes, getUnixTime, set, subDays } from 'date-fns';\nimport { MOCK_ASSETS } from './assets.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport { MOCK_GUESTS, MOCK_STAFF } from './users.data';\nimport { MOCK_BUILDINGS, MOCK_LEVELS } from './zone.data';\nimport { PARKING_SPACES } from './zones.mock';\n\nlet EVENT_TIME = set(subDays(Date.now(), 3), {\n    hours: 7,\n    minutes: 0,\n    seconds: 0,\n    milliseconds: 0,\n});\n\nconst nextEventTime = (save = false): number => {\n    const next = addMinutes(EVENT_TIME, (predictableRandomInt(8) + 1) * 15);\n    if (save) EVENT_TIME = addMinutes(next, 60);\n    return getUnixTime(next);\n};\n\nconst TYPES = ['desk', 'parking', 'asset-request', 'visitor', 'locker'];\nconst TRACKING = ['in_storage', 'in_transit', 'at_location'];\n\nexport const MOCK_BOOKINGS = new Array(200).fill(0).map((_, index) => {\n    const throw_away = predictableRandomInt(999999) % 3 === 0;\n    const user =\n        MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)] || ({} as any);\n    const type = TYPES[predictableRandomInt(TYPES.length)];\n    const bld = MOCK_BUILDINGS[predictableRandomInt(MOCK_BUILDINGS.length)];\n    const lvls = MOCK_LEVELS.filter((_) => _.parent_id === bld?.id);\n    const lvl = lvls[predictableRandomInt(lvls.length)];\n    const lvl_spaces =\n        MOCK_SPACES.filter((_) => _.zones.includes(lvl?.id)) || [];\n    const approved = predictableRandomInt(999999) % 4;\n    const approver = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n    const guest = MOCK_GUESTS[predictableRandomInt(MOCK_GUESTS.length)];\n    const asset_count = predictableRandomInt(3, 1);\n    const position = padString(\n        (index % 18) + 1 + Math.floor(index / 18) * 100,\n        3\n    );\n    return {\n        id: `booking-${index}`,\n        booking_start: nextEventTime(true),\n        booking_end: nextEventTime(),\n        user_id: user.id,\n        user_name: user.name,\n        user_email: user.email,\n        booked_by_name: user.name,\n        booked_by_email: user.email,\n        asset_id:\n            type === 'visitor'\n                ? guest.email\n                : type === 'parking'\n                ? `park-${position}`\n                : `desk-${lvl?.id}-${index}`,\n        asset_name:\n            type === 'visitor'\n                ? guest.name\n                : type === 'parking'\n                ? position\n                : `${lvl?.id}-${index}`,\n        description:\n            type === 'visitor'\n                ? guest.name\n                : type === 'parking'\n                ? position\n                : `Desk ${index}`,\n        title: `${capitalizeFirstLetter(type)} Booking ${index}`,\n        type,\n        booking_type: type,\n        checked_in: predictableRandomInt(999999) % 3 === 0,\n        access: predictableRandomInt(999999) % 3 === 0,\n        approved: approved === 0,\n        rejected: approved === 1,\n        approver_id: approved === 0 ? approver.id : '',\n        approver_name: approved === 0 ? approver.name : '',\n        approver_email: approved === 0 ? approver.email : '',\n        zones: [bld?.id, lvl?.id],\n        extension_data: {\n            map_id: `table-10.00${index}`,\n            plate_number: randomString(\n                8,\n                'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n            ),\n            assets: new Array(asset_count).fill(0).map((_) => ({\n                ...MOCK_ASSETS[predictableRandomInt(asset_count)],\n                amount: predictableRandomInt(5, 1),\n            })),\n            tracking:\n                approved === 0\n                    ? TRACKING[predictableRandomInt(TRACKING.length)]\n                    : 'in_storage',\n            space_id: lvl_spaces[predictableRandomInt(lvl_spaces.length)]?.id,\n        },\n    };\n});\n","import { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_BOOKINGS } from './bookings.data';\n\nexport const BOOKING_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const events = MOCK_BOOKINGS.filter(\n                (event) =>\n                    timePeriodsIntersect(\n                        _.query_params.period_start,\n                        _.query_params.period_end,\n                        event.booking_start,\n                        event.booking_end\n                    ) && (event.type === _.query_params.type || event.booking_type === _.query_params.type)\n            );\n            return events;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const event = MOCK_BOOKINGS.find((e) => e.id === _.route_params.id);\n            if (!event)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${_.route_params.id}`,\n                };\n            return event;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const new_event = {\n                ...request.body,\n                id: `-booking-${predictableRandomInt(999)}`,\n            };\n            MOCK_BOOKINGS.push(new_event);\n            return new_event;\n        },\n    });\n\n    const updateBooking = (id, data) => {\n        const index = MOCK_BOOKINGS.findIndex((e) => e.id === id);\n        if (index < 0)\n            throw {\n                status: 404,\n                message: `Unable to find booking with ID ${id}`,\n            };\n        const new_event = { ...data };\n        const removed = MOCK_BOOKINGS.splice(index, 1, new_event);\n        return new_event;\n    };\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'PUT',\n        callback: (req) => updateBooking(req.route_params.id, { ...req.body }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'PATCH',\n        callback: (req) => updateBooking(req.route_params.id, { ...req.body }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/approve',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                approved: true,\n                rejected: false,\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/reject',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                approved: false,\n                rejected: true,\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/check_in',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                checked_in: req.query_params.state === 'true',\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'DELETE',\n        callback: (req) => {\n            const index = MOCK_BOOKINGS.findIndex(\n                (e) => e.id === req.route_params.id\n            );\n            if (index < 0)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${req.route_params.id}`,\n                };\n            MOCK_BOOKINGS.splice(index, 1);\n            return;\n        },\n    });\n}\n","import { predictableRandomInt } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_ASSETS } from './assets.data';\n\nconst BASE_PATH = '/api/engine/v2/assets';\n\nexport const ASSET_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: BASE_PATH,\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const events = MOCK_ASSETS;\n            return events;\n        },\n    });\n\n    registerMockEndpoint({\n        path: `${BASE_PATH}/:id`,\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const event = MOCK_ASSETS.find((e) => e.id === _.route_params.id);\n            if (!event)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${_.route_params.id}`,\n                };\n            return event;\n        },\n    });\n\n    registerMockEndpoint({\n        path: BASE_PATH,\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const new_event = {\n                ...request.body,\n                id: `-asset-${predictableRandomInt(999)}`,\n            };\n            MOCK_ASSETS.push(new_event);\n            return new_event;\n        },\n    });\n\n    const updateAsset = (id, data) => {\n        const index = MOCK_ASSETS.findIndex((e) => e.id === id);\n        if (index < 0)\n            throw {\n                status: 404,\n                message: `Unable to find booking with ID ${id}`,\n            };\n        const new_event = { ...data };\n        MOCK_ASSETS.splice(index, 1, new_event);\n        return new_event;\n    };\n\n    registerMockEndpoint({\n        path: `${BASE_PATH}/:id`,\n        metadata: {},\n        method: 'PUT',\n        callback: (req) => updateAsset(req.route_params.id, { ...req.body }),\n    });\n\n    registerMockEndpoint({\n        path: `${BASE_PATH}/:id`,\n        metadata: {},\n        method: 'DELETE',\n        callback: (req) => {\n            const index = MOCK_ASSETS.findIndex(\n                (e) => e.id === req.route_params.id\n            );\n            if (index < 0)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${req.route_params.id}`,\n                };\n            MOCK_ASSETS.splice(index, 1);\n            return;\n        },\n    });\n}\n","\nimport { log } from '@placeos/common';\n\nimport { ZONE_MOCKS } from './lib/api/zones.mock';\nimport { USER_MOCKS } from './lib/api/users.mock';\nimport { SYSTEM_MOCKS } from './lib/api/systems.mock';\nimport { EVENT_MOCKS } from './lib/api/events.mock';\nimport { CALENDAR_MOCKS } from './lib/api/calendars.mock';\nimport { BOOKING_MOCKS } from './lib/api/bookings.mock';\nimport { ASSET_MOCKS } from './lib/api/assets.mock';\n\nexport default {\n    ZONE_MOCKS,\n    USER_MOCKS,\n    SYSTEM_MOCKS,\n    EVENT_MOCKS,\n    CALENDAR_MOCKS,\n    BOOKING_MOCKS,\n    ASSET_MOCKS\n};\n\nlog('MOCKS', 'Mocks included with application.');\n","import { Component, OnInit, Optional, Renderer2 } from '@angular/core';\nimport { SwUpdate } from '@angular/service-worker';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Clipboard } from '@angular/cdk/clipboard';\nimport { first } from 'rxjs/operators';\nimport {\n    clientId,\n    invalidateToken,\n    isMock,\n    refreshToken,\n    setAPI_Key,\n    token,\n} from '@placeos/ts-client';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { addHours } from 'date-fns';\n\nimport {\n    AsyncHandler,\n    current_user,\n    currentUser,\n    HotkeysService,\n    notifySuccess,\n    setAppName,\n    setNotifyOutlet,\n    SettingsService,\n    setupCache,\n    setupPlace,\n    log,\n    GoogleAnalyticsService,\n} from '@placeos/common';\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { setInternalUserDomain } from 'libs/users/src/lib/user.utilities';\n\nimport { setDefaultCreator } from 'libs/events/src/lib/event.class';\n\nimport * as Sentry from '@sentry/angular';\nimport { MOCKS } from '@placeos/mocks';\nimport {\n    Amazon,\n    Azure,\n    Google,\n    initialiseUploadService,\n    OpenStack,\n} from '@placeos/cloud-uploads';\nimport { TranslateService } from '@ngx-translate/core';\n\nimport { StylesManager } from 'survey-core';\n\n//SurveyJS styling\nStylesManager.applyTheme('modern');\n\nexport function initSentry(dsn: string, sample_rate: number = 0.2) {\n    if (!dsn) return;\n    Sentry.init({\n        dsn,\n        tracesSampleRate: sample_rate,\n    });\n}\n\n(window as any).global = window;\n\n@Component({\n    selector: 'app-root',\n    template: `\n        <global-banner></global-banner>\n        <div class=\"flex-1 w-full relative h-1/2\">\n            <router-outlet></router-outlet>\n        </div>\n        <global-loading></global-loading>\n        <debug-console *ngIf=\"debug\"></debug-console>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class AppComponent extends AsyncHandler implements OnInit {\n    public get debug() {\n        return window.debug;\n    }\n\n    constructor(\n        private _analytics: GoogleAnalyticsService,\n        private _settings: SettingsService,\n        private _org: OrganisationService, // For init\n        private _cache: SwUpdate,\n        private _snackbar: MatSnackBar,\n        private _hotkey: HotkeysService,\n        private _clipboard: Clipboard,\n        private _route: ActivatedRoute,\n        private _renderer: Renderer2,\n        private _router: Router,\n        @Optional() private _translate: TranslateService\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        log('APP', 'MOCKS:', MOCKS);\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyM'], () => {\n            localStorage.setItem(\n                'mock',\n                `${localStorage.getItem('mock') !== 'true'}`\n            );\n            location.reload();\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyD'], () => {\n            this._settings.saveUserSetting(\n                'dark_mode',\n                !this._settings.get('dark_mode')\n            );\n            notifySuccess('Toggled dark mode.');\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyC'], () => {\n            this._clipboard.copy(`${token()}|${refreshToken()}`);\n            notifySuccess('Successfully copied token.');\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyV'], () => {\n            navigator.clipboard?.readText().then((tkn) => {\n                const parts = tkn.split('|');\n                const id = clientId();\n                localStorage.setItem(`${id}_access_token`, `${parts[0]}`);\n                localStorage.setItem(`${id}_refresh_token`, `${parts[1]}`);\n                localStorage.setItem(\n                    `${id}_expires_at`,\n                    `${addHours(new Date(), 6).valueOf()}`\n                );\n                notifySuccess('Successfully pasted token.');\n                setTimeout(() => location.reload(), 2000);\n            });\n        });\n        this._initLocale();\n        this._route.queryParamMap.subscribe((params) => {\n            if (params.has('hide_nav'))\n                localStorage.setItem('PlaceOS.hide_nav', 'true');\n            if (params.has('lang')) {\n                const locale = params.get('lang');\n                this._translate?.use(locale);\n                localStorage.setItem('PLACEOS.locale', locale);\n            }\n            if (params.has('x-api-key')) {\n                setAPI_Key(params.get('x-api-key'));\n            }\n        });\n        setNotifyOutlet(this._snackbar);\n        /** Wait for settings to initialise */\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        setAppName(this._settings.get('app.short_name'));\n        const settings = this._settings.get('composer') || {};\n        settings.mock =\n            !!this._settings.get('mock') ||\n            location.origin.includes('demo.place.tech');\n        /** Wait for authentication details to load */\n        await setupPlace(settings).catch((_) => console.error(_));\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        setupCache(this._cache);\n        if (!settings.local_login) {\n            this.timeout('wait_for_user', () => this.onInitError(), 30 * 1000);\n        }\n        await current_user.pipe(first((_) => !!_)).toPromise();\n        this.clearTimeout('wait_for_user');\n        setDefaultCreator(currentUser());\n        setInternalUserDomain(\n            this._settings.get('app.general.internal_user_domain') ||\n                `@${currentUser()?.email?.split('@')[1]}`\n        );\n        this._initAnalytics();\n        initSentry(this._settings.get('app.sentry_dsn'));\n        if (this._settings.get('app.has_uploads')) {\n            this.timeout('init_uploads', () => {\n                initialiseUploadService({\n                    auto_start: true,\n                    token: token(),\n                    endpoint: '/api/files/v1/uploads',\n                    worker_url: 'assets/md5_worker.js',\n                    providers: [Amazon, Azure, Google, OpenStack] as any,\n                });\n            });\n        }\n    }\n\n    private onInitError() {\n        if (isMock() || currentUser()?.is_logged_in) return;\n\n        invalidateToken();\n        location.reload();\n    }\n\n    private _initAnalytics() {\n        const tracking_id = this._settings.get('app.analytics.tracking_id');\n        if (!tracking_id) return;\n\n        this._analytics.init(tracking_id);\n        this._analytics.load(tracking_id);\n        this._analytics.setUser(currentUser().id);\n    }\n\n    private _initLocale() {\n        try {\n            let locale = localStorage.getItem('PLACEOS.locale');\n            const locales = this._settings.get('app.locales') || [];\n            this._translate?.addLangs(locales.map((_) => _.id));\n            if (locale) {\n                this._translate?.use(locale);\n            } else {\n                const list = navigator.languages;\n                for (const lang of list) {\n                    locale = locales.find((_) => _.id === lang);\n                    if (!locale)\n                        locale = locales.find((_) => lang.includes(_.id));\n                    if (locale) {\n                        this._translate?.use(lang);\n                        localStorage.setItem('PLACEOS.locale', lang);\n                        break;\n                    }\n                }\n            }\n        } catch {}\n    }\n}\n","import { Component } from '@angular/core';\nimport { CustomTooltipData } from '@placeos/components';\n\nimport { ControlStateService } from '../control-state.service';\n\n@Component({\n    selector: 'help-tooltip',\n    template: `\n        <div\n            class=\"p-4 my-2 bg-white shadow rounded flex flex-col items-center space-y-2\"\n        >\n            <h3 class=\"mb-2 text-xl font-medium\">Need help?</h3>\n            <p>\n                Contact <span contact>{{ support_contact || ' your administrator' }}</span> if you\n                require <br />assisatance at\n                <a email class=\"underline\" [href]=\"'mailto:' + (support_email || 'support@place.tech')\">{{\n                    support_email || 'support@place.tech'\n                }}</a>\n                or phone\n                <a phone class=\"underline\" [href]=\"'tel:' + (support_phone || '0412345678')\">{{\n                    support_phone || '0412345678'\n                }}</a>\n            </p>\n        </div>\n    `,\n    styles: [``],\n})\nexport class HelpTooltipComponent {\n    public support_contact: string;\n\n    public support_email: string;\n\n    public support_phone: string;\n\n    /** Close the tooltip */\n    public readonly close = () => this._tooltip.close();\n\n    constructor(\n        private _state: ControlStateService,\n        private _tooltip: CustomTooltipData\n    ) {}\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { RouterModule } from '@angular/router';\nimport { MatRippleModule } from '@angular/material/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatSliderModule } from '@angular/material/slider';\n\nimport { ComponentsModule } from '@placeos/components';\n\nimport { LightingTooltipComponent } from './lighting-tooltip.component';\nimport { PowerTooltipComponent } from './power-tooltip.component';\nimport { HelpTooltipComponent } from './help-tooltip.component';\nimport { RoomAccessoryTooltipComponent } from './room-accessory-tooltip.component';\nimport { CameraTooltipComponent } from './camera-tooltip.component';\nimport { MicrophoneTooltipComponent } from './microphone-tooltip.component';\nimport { SourceSelectComponent } from './source-select.component';\nimport { SourceSelectModalComponent } from './source-select-modal.component';\nimport { OutputDisplayComponent } from './output-display.component';\nimport { JoystickComponent } from './joystick.component';\nimport { DurationPipe } from './duration.pipe';\nimport { SelectMeetingModalComponent } from './select-meeting-modal.component';\nimport { VideoConferenceTooltipComponent } from './video-conf-tooltip.component';\nimport { DialpadComponent } from './dialpad.component';\nimport { HelpModalComponent } from './help-modal.component';\nimport { MarkdownPipe } from './markdown.pipe';\nimport { VideoCallDialViewComponent } from '../video-call/video-call-dial-view.component';\nimport { CameraControlsComponent } from './camera-controls.component';\nimport { PhoneDiallingTooltipComponent } from './phone-dialling-tooltip.component';\nimport { JoinRoomTooltipComponent } from './join-room-tooltip.component';\nimport { LightingSceneTooltipComponent } from './lighting-scene-tooltip.component';\n\nconst COMPONENTS: Type<any>[] = [\n    LightingTooltipComponent,\n    PowerTooltipComponent,\n    HelpTooltipComponent,\n    RoomAccessoryTooltipComponent,\n    CameraTooltipComponent,\n    MicrophoneTooltipComponent,\n    SourceSelectComponent,\n    SourceSelectModalComponent,\n    OutputDisplayComponent,\n    JoystickComponent,\n    SelectMeetingModalComponent,\n    VideoConferenceTooltipComponent,\n    DialpadComponent,\n    HelpModalComponent,\n    VideoCallDialViewComponent,\n    CameraControlsComponent,\n    PhoneDiallingTooltipComponent,\n    JoinRoomTooltipComponent,\n    LightingSceneTooltipComponent,\n\n    DurationPipe,\n    MarkdownPipe,\n];\n\nconst MAT_MODULES: any[] = [\n    MatFormFieldModule,\n    MatInputModule,\n    MatAutocompleteModule,\n    MatButtonModule,\n    MatSliderModule,\n    MatRippleModule,\n];\n\nconst ANGULAR_MODULES: any[] = [FormsModule, ReactiveFormsModule];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        ComponentsModule,\n        ...MAT_MODULES,\n        ...ANGULAR_MODULES,\n        RouterModule.forChild([]),\n    ],\n    exports: [\n        ComponentsModule,\n        ...COMPONENTS,\n        ...MAT_MODULES,\n        ...ANGULAR_MODULES,\n    ],\n})\nexport class UIModule {}\n","import { DatePipe } from '@angular/common';\nimport { Component, ElementRef, forwardRef, ViewChild } from '@angular/core';\nimport {\n    ControlValueAccessor,\n    FormControl,\n    FormGroup,\n    NG_VALUE_ACCESSOR,\n    Validators,\n} from '@angular/forms';\nimport { AsyncHandler } from '@placeos/common';\nimport { addYears, setMonth } from 'date-fns';\n\nexport interface PaymentCardDetails {\n    card_number: string;\n    cardholder: string;\n    cvv: string;\n    exp_month: string;\n    exp_year: string;\n}\n\nconst BLANK_CARD = { card_number: '                ', cardholder: '', cvv: '' };\nconst DATE_PIPE = new DatePipe('en-us', '');\n\n@Component({\n    selector: 'card-input-field',\n    template: `\n        <form [formGroup]=\"details\" (window:keyup)=\"onInput($event)\">\n            <div class=\"flex flex-col\">\n                <label for=\"card-number\" i18n>Card Number</label>\n                <div\n                    tabindex=\"0\"\n                    class=\"border border-gray-200 p-2 h-12 mb-4 focus-within:shadow focus-within:border-black flex items-center font-mono w-full rounded relative\"\n                    (focus)=\"focusInput()\"\n                >\n                    <pre class=\"flex-1\">{{ card_display }}</pre>\n                    <input\n                        #input\n                        class=\"hidden absolute\"\n                        type=\"tel\"\n                        [value]=\"details.value.card_number?.trim()\"\n                        (keydown)=\"(false)\"\n                        maxlength=\"17\"\n                    />\n                    <img\n                        *ngIf=\"card_type\"\n                        [src]=\"'assets/icons/' + card_type + '.svg'\"\n                        class=\"h-8\"\n                    />\n                </div>\n            </div>\n            <div class=\"flex flex-col flex-1\">\n                <label for=\"cardholder\" i18n>Name on Card</label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        name=\"cardholder\"\n                        matInput\n                        placeholder=\"Mr John Smith\"\n                        formControlName=\"cardholder\"\n                    />\n                    <mat-error i18n>Cardholder name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"flex items-center space-x-2\">\n                <div class=\"flex flex-col flex-1 w-1/4\">\n                    <label for=\"cardholder\" i18n>Expiry Month</label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            placeholder=\"MM\"\n                            formControlName=\"exp_month\"\n                        >\n                            <mat-option\n                                *ngFor=\"let item of months\"\n                                [value]=\"item[0]\"\n                            >\n                                {{ item[1] }} ({{ item[0] }})\n                            </mat-option>\n                        </mat-select>\n                        <mat-error i18n>Expiry month is required</mat-error>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col flex-1 w-1/4\">\n                    <label for=\"cardholder\">Expiry Year</label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            placeholder=\"YYYY\"\n                            formControlName=\"exp_year\"\n                        >\n                            <mat-option\n                                *ngFor=\"let item of years\"\n                                [value]=\"item\"\n                                >{{ item }}</mat-option\n                            >\n                        </mat-select>\n                        <mat-error i18n>Expiry year is required</mat-error>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label for=\"cvv\">CVV</label>\n                    <mat-form-field appearance=\"outline\" class=\"w-20\">\n                        <input\n                            name=\"cvv\"\n                            matInput\n                            formControlName=\"cvv\"\n                            maxlength=\"4\"\n                        />\n                        <mat-error i18n>Invalid security code</mat-error>\n                    </mat-form-field>\n                </div>\n            </div>\n        </form>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.25rem;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => CardInputFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class CardInputFieldComponent\n    extends AsyncHandler\n    implements ControlValueAccessor\n{\n    public details = new FormGroup({\n        card_number: new FormControl(Array(16).fill('X').join()),\n        cardholder: new FormControl(''),\n        exp_month: new FormControl(''),\n        exp_year: new FormControl(''),\n        cvv: new FormControl('', [\n            Validators.minLength(3),\n            Validators.maxLength(4),\n        ]),\n    });\n    public disabled = false;\n\n    public readonly months = Array(12)\n        .fill(0)\n        .map((_, idx) => [\n            DATE_PIPE.transform(setMonth(Date.now(), idx), 'MM'),\n            DATE_PIPE.transform(setMonth(Date.now(), idx), 'MMM'),\n        ]);\n    public readonly years = Array(12)\n        .fill(0)\n        .map((_, idx) =>\n            DATE_PIPE.transform(addYears(Date.now(), idx), 'yyyy')\n        );\n    public readonly digits = Array(16).fill(0);\n    private _index = 0;\n\n    @ViewChild('input', { static: true })\n    private _input_el!: ElementRef<HTMLInputElement>;\n\n    private _onChange?: (_: PaymentCardDetails) => void;\n    private _onTouch?: (_: PaymentCardDetails) => void;\n\n    public get is_amex() {\n        const no = this.details.value?.card_number || '';\n        return no.startsWith('3');\n    }\n\n    public get card_type() {\n        const no = this.details.value?.card_number || '';\n        if (no.startsWith('3')) return 'amex';\n        if (no.startsWith('4')) return 'visa';\n        if (no.startsWith('5')) return 'mastercard';\n        return '';\n    }\n\n    public get card_display() {\n        let no = this.details.value?.card_number || '';\n        if (this.card_focused)\n            no =\n                no.substring(0, this._index) +\n                '⯐' +\n                no.substring(this._index + 1);\n        return this.is_amex\n            ? `${no.substring(0, 4)}-${no.substring(4, 10)}-${no.substring(10)}`\n            : `${no.substring(0, 4)}-${no.substring(4, 8)}-${no.substring(\n                  8,\n                  12\n              )}-${no.substring(12)}`;\n    }\n\n    public get card_focused() {\n        return (\n            document.activeElement === this._input_el.nativeElement ||\n            document.activeElement ===\n                this._input_el.nativeElement.parentElement\n        );\n    }\n\n    public ngOnInit() {\n        this.subscription(\n            'changes',\n            this.details.valueChanges.subscribe((v) =>\n                this.timeout('update', () =>\n                    this.setValue(this.details.getRawValue())\n                )\n            )\n        );\n    }\n\n    public focusInput() {\n        this._input_el.nativeElement.focus();\n        this._index = this._input_el.nativeElement.selectionStart || 0;\n    }\n\n    public onInput(event: KeyboardEvent) {\n        if (!event || !this.card_focused) return;\n        const idx = this._index;\n        if (idx < 0 || idx > 16) return;\n        let card_number = this.details.value.card_number!;\n        if (\n            (event.code.startsWith('Digit') ||\n                event.code.startsWith('Numpad')) &&\n            idx < (this.is_amex ? 15 : 16)\n        ) {\n            card_number =\n                card_number.substring(0, idx) +\n                event.key +\n                card_number.substring(idx + 1);\n            this.details.patchValue({ card_number });\n            this._focusChange(idx, 1);\n        } else if (event.code === 'Backspace' && idx > 0) {\n            let card_number = this.details.value.card_number!;\n            card_number =\n                card_number.substring(0, idx) +\n                ' ' +\n                card_number.substring(idx + 1);\n            this.details.patchValue({ card_number });\n            this._focusChange(idx, -1);\n        } else if (event.code === 'ArrowLeft') {\n            this._focusChange(idx, -1);\n        } else if (event.code === 'ArrowRight' && card_number[idx] !== ' ') {\n            this._focusChange(idx, 1);\n        }\n    }\n\n    private _focusChange(idx: number, dir: 1 | -1) {\n        this._index = Math.min(16, Math.max(0, idx + dir));\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: PaymentCardDetails) {\n        if (this._onChange) this._onChange(new_value);\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value?: PaymentCardDetails) {\n        this.details.patchValue(value || BLANK_CARD);\n    }\n\n    public readonly registerOnChange = (fn: (_: PaymentCardDetails) => void) =>\n        (this._onChange = fn);\n    public readonly registerOnTouched = (fn: (_: PaymentCardDetails) => void) =>\n        (this._onTouch = fn);\n    public readonly setDisabledState = (s: boolean) => (this.disabled = s);\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { PaymentModalComponent } from './payment-modal.component';\nimport { CardInputFieldComponent } from './card-input-field.component';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\n\nconst COMPONENTS = [PaymentModalComponent, CardInputFieldComponent];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatDialogModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatButtonModule,\n        MatSelectModule,\n        MatProgressSpinnerModule,\n    ],\n    exports: [...COMPONENTS],\n})\nexport class PaymentsModule {}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Asset } from '../asset.class';\n\n@Component({\n    selector: 'asset-details',\n    template: `\n        <ng-container *ngIf=\"item; else empty_state\">\n            <section image class=\"relative w-full h-64 sm:h-40 bg-black/20\">\n                <image-carousel\n                    [images]=\"images\"\n                    class=\"absolute inset-0\"\n                ></image-carousel>\n                <button\n                    icon\n                    matRipple\n                    close\n                    (click)=\"close.emit()\"\n                    class=\"absolute top-2 left-2 bg-black/40 sm:hidden text-white\"\n                >\n                    <app-icon>arrow_back</app-icon>\n                </button>\n                <button\n                    icon\n                    matRipple\n                    fav\n                    [class.text-white]=\"!fav\"\n                    [class.text-blue-400]=\"fav\"\n                    (click)=\"toggleFav.emit()\"\n                    class=\"absolute top-2 right-2 bg-black/40\"\n                >\n                    <app-icon>{{\n                        fav ? 'favorite' : 'favorite_border'\n                    }}</app-icon>\n                </button>\n            </section>\n            <div class=\"p-2 space-y-2 flex-1 h-1/2 overflow-auto\">\n                <section actions class=\"z-0 flex items-center justify-between\">\n                    <div>\n                        <h2 class=\"text-xl font-medium mb-2 mt-4\">\n                            {{ item.name }}\n                        </h2>\n                        <p>{{ item.count }} Available</p>\n                    </div>\n                    <a-counter\n                        [(ngModel)]=\"item.amount\"\n                        [min]=\"1\"\n                        [max]=\"item.count || 2\"\n                    ></a-counter>\n                </section>\n                <hr />\n                <section details class=\"space-y-2\">\n                    <h2 class=\"text-xl font-medium\">Details</h2>\n                    <div class=\"flex items-center space-x-2\">\n                        <p>{{ item.description || 'No description' }}</p>\n                    </div>\n                </section>\n            </div>\n            <div class=\"p-2 border-t border-gray-200 shadow sm:hidden\">\n                <button\n                    btn\n                    matRipple\n                    select\n                    [class.inverse]=\"active\"\n                    class=\"w-full\"\n                    (click)=\"active = !active; activeChange.emit(active)\"\n                >\n                    <div class=\"flex items-center justify-center\">\n                        <app-icon class=\"text-2xl\">{{\n                            active ? 'remove' : 'add'\n                        }}</app-icon>\n                        <p>\n                            {{\n                                active ? 'Remove this asset' : 'Add this asset'\n                            }}\n                        </p>\n                    </div>\n                </button>\n            </div>\n        </ng-container>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    Select an asset to view it's details\n                </p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                width: 30%;\n                min-width: 20rem;\n                height: 100%;\n                min-height: 65vh;\n            }\n        `,\n    ],\n})\nexport class AssetDetailsComponent {\n    @Input() public item?: Asset;\n    @Input() public active: boolean = false;\n    @Input() public fav: boolean = false;\n\n    @Output() public toggleFav = new EventEmitter<void>();\n    @Output() public activeChange = new EventEmitter<boolean>();\n    @Output() public close = new EventEmitter<void>();\n\n    public get images() {\n        return this.item?.images.map((_) => _.url) || [];\n    }\n}\n","import { Component } from \"@angular/core\";\n\n@Component({\n    selector: 'asset-filters',\n    template: ``,\n    styles: [``]\n})\nexport class AssetFiltersComponent {\n    \n}\n","import { Component } from \"@angular/core\";\n\n@Component({\n    selector: 'asset-filters-display',\n    template: ``,\n    styles: [``]\n})\nexport class AssetFiltersDisplayComponent {\n    \n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, combineLatest, of } from 'rxjs';\nimport { debounceTime, map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { queryAssets } from './assets.fn';\nimport { queryBookings } from 'libs/bookings/src/lib/bookings.fn';\nimport { endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\nexport interface AssetOptions {\n    zone?: string;\n    date: number;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class AssetStateService {\n    private _options = new BehaviorSubject<AssetOptions>({ date: Date.now() });\n    private _search = new BehaviorSubject<string>('');\n    private _loading = new BehaviorSubject<string>('');\n\n    public readonly search = this._search.asObservable();\n    public readonly loading = this._loading.asObservable();\n\n    public readonly asset_list = of(0).pipe(\n        switchMap(() => {\n            this._loading.next(this._loading.getValue() + '[Assets]');\n            return queryAssets();\n        }),\n        tap((_) =>\n            this._loading.next(\n                this._loading.getValue().replace(/\\[Assets\\]/g, '')\n            )\n        ),\n        shareReplay(1)\n    );\n\n    public readonly asset_bookings = this._options.pipe(\n        debounceTime(300),\n        switchMap(({ zone, date }) => {\n            this._loading.next(this._loading.getValue() + '[Bookings]');\n            return queryBookings({\n                zones: zone || '',\n                period_start: getUnixTime(startOfDay(date)),\n                period_end: getUnixTime(endOfDay(date)),\n                type: 'asset-request',\n            });\n        }),\n        tap((_) =>\n            this._loading.next(\n                this._loading.getValue().replace(/\\[Bookings\\]/g, '')\n            )\n        ),\n        shareReplay(1)\n    );\n\n    public readonly available_assets = combineLatest([\n        this.asset_list,\n        this.asset_bookings,\n    ]).pipe(\n        map(([list, bookings]) =>\n            list\n                .filter((_) => !bookings.find((b) => b.asset_id === _.id))\n                .sort(\n                    (a, b) =>\n                        a.category.localeCompare(b.category) ||\n                        a.name.localeCompare(b.name)\n                )\n        ),\n        shareReplay(1)\n    );\n\n    public readonly filtered_assets = combineLatest([\n        this._search,\n        this.available_assets,\n    ]).pipe(\n        map(([search, assets]) => {\n            const s = search.toLowerCase();\n            return assets.filter(\n                (_) =>\n                    _.name.toLowerCase().includes(s) ||\n                    _.description.toLowerCase().includes(s)\n            );\n        }),\n        shareReplay(1)\n    );\n\n    public setSearch(value: string) {\n        this._search.next(`${value}`);\n    }\n\n    public setOptions(options: Partial<AssetOptions>) {\n        this._options.next({ ...this._options.value, ...options });\n    }\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { AssetStateService } from '../asset-state.service';\nimport { Asset } from '../asset.class';\n\n@Component({\n    selector: 'asset-list',\n    template: `\n        <div\n            class=\"w-full h-full overflow-auto py-2 bg-black/5 dark:bg-white/10 dark:border-neutral-500\"\n        >\n            <h3 class=\"font-bold px-2\">Results</h3>\n            <p count class=\"text-sm opacity-60 mb-4 px-2\">\n                {{ (assets | async)?.length || 0 }} result(s) found\n            </p>\n            <ng-container *ngIf=\"!(loading | async); else load_state\">\n                <ul\n                    class=\"list-style-none space-y-2 p-2\"\n                    *ngIf=\"(assets | async)?.length; else empty_state\"\n                >\n                    <li\n                        asset\n                        *ngFor=\"let asset of assets | async\"\n                        class=\"relative p-2 rounded-lg w-full shadow border bg-white dark:bg-neutral-700 border-gray-200 dark:border-neutral-500\"\n                    >\n                        <button\n                            matRipple\n                            select\n                            class=\"w-full h-full flex items-center pr-10\"\n                            (click)=\"selectAsset(asset)\"\n                        >\n                            <div\n                                class=\"relative w-16 h-16 rounded-xl bg-black/20 mr-4\"\n                            >\n                                <div\n                                    class=\"absolute top-1 left-1 border border-white bg-black/50 rounded-full h-6 w-6 flex items-center justify-center text-white\"\n                                    *ngIf=\"selected.includes(asset.id)\"\n                                >\n                                    <span class=\"text-xs\">{{\n                                        asset.amount || 1\n                                    }}</span>\n                                </div>\n                            </div>\n                            <div class=\"space-y-2 text-left flex-1\">\n                                <div\n                                    class=\"font-medium flex items-center justify-between\"\n                                >\n                                    <div>{{ asset.name || 'Asset' }}</div>\n                                    <div class=\"opacity-60 text-xs\">\n                                        {{ asset.category }}\n                                    </div>\n                                </div>\n                                <div\n                                    class=\"flex items-center text-sm space-x-2\"\n                                >\n                                    <p>\n                                        {{ asset.count < 1 ? 2 : asset.count }}\n                                        Available\n                                    </p>\n                                </div>\n                            </div>\n                        </button>\n                        <button\n                            icon\n                            matRipple\n                            fav\n                            class=\"absolute top-1 right-1\"\n                            [class.text-blue-400]=\"isFavourite(asset.id)\"\n                            (click)=\"toggleFav.emit(asset)\"\n                        >\n                            <app-icon>{{\n                                isFavourite(asset.id)\n                                    ? 'favorite'\n                                    : 'favorite_border'\n                            }}</app-icon>\n                        </button>\n                    </li>\n                </ul>\n            </ng-container>\n        </div>\n        <ng-template #empty_state>\n            <div\n                empty\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <p class=\"opacity-30 text-center\">\n                    No available assets for selected time and/or filters\n                </p>\n            </div>\n        </ng-template>\n        <ng-template #load_state>\n            <div\n                loading\n                class=\"p-16 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p class=\"opacity-30\">Finding available assets...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n                height: 100%;\n            }\n        `,\n    ],\n})\nexport class AssetListComponent {\n    @Input() public selected: string = '';\n    @Input() public favorites: string[] = [];\n    @Output() public toggleFav = new EventEmitter<Asset>();\n    @Output() public onSelect = new EventEmitter<Asset>();\n\n    public readonly loading = this._asset_state.loading;\n    public readonly assets = this._asset_state.filtered_assets;\n\n    constructor(private _asset_state: AssetStateService) {}\n\n    public isFavourite(asset_id: string) {\n        return this.favorites.includes(asset_id);\n    }\n\n    public selectAsset(asset: Asset) {\n        this.onSelect.emit(asset);\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { AssetSelectModalComponent } from './asset-select-modal/asset-select-modal.component';\nimport { ComponentsModule } from '@placeos/components';\nimport { AssetDetailsComponent } from './asset-select-modal/asset-details.component';\nimport { AssetFiltersComponent } from './asset-select-modal/asset-filters.component';\nimport { AssetFiltersDisplayComponent } from './asset-select-modal/asset-filters-display.component';\nimport { AssetListComponent } from './asset-select-modal/asset-list.component';\nimport { FormFieldsModule } from '@placeos/form-fields';\nimport { FormsModule } from '@angular/forms';\n\nexport * from './asset-select-modal/asset-select-modal.component';\n\nconst COMPONENTS = [AssetSelectModalComponent];\n\nconst MODULE_COMPONENTS = [\n    AssetDetailsComponent,\n    AssetFiltersComponent,\n    AssetFiltersDisplayComponent,\n    AssetListComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS, ...MODULE_COMPONENTS],\n    imports: [\n        CommonModule, \n        FormFieldsModule, \n        FormsModule, \n        ComponentsModule\n    ],\n    exports: [...COMPONENTS],\n})\nexport class AssetsModule {}\n","import { BrowserModule } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { ErrorHandler, NgModule } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { ServiceWorkerModule } from '@angular/service-worker';\n\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatSliderModule } from '@angular/material/slider';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from '../../../../libs/components/src/lib/app.component';\nimport { environment } from '../environments/environment';\nimport { UIModule } from './ui/ui.module';\nimport { BootstrapComponent } from './bootstrap.component';\nimport { ControlMainViewComponent } from './main-view.component';\nimport { TopbarHeaderComponent } from './topbar-header.component';\nimport { ControlPageViewComponent } from './page-view.component';\nimport { ControlStatusBarComponent } from './status-bar.component';\nimport { ControlAdvancedViewComponent } from './advanced-view.component';\n\nimport { ControlVideoCallViewComponent } from './video-call/video-call-view.component';\nimport { VideoCallPageComponent } from './video-call/video-call-page.component';\n\nimport { ControlTabbedViewComponent } from './tabbed-view/tabbed-view.component';\nimport { TabOutletComponent } from './tabbed-view/tab-outlet.component';\nimport { DeviceOutputListComponent } from './tabbed-view/output-list.component';\nimport { DeviceOutputListItemComponent } from './tabbed-view/output-list-item.component';\n\nimport * as Sentry from '@sentry/angular';\nimport { PaymentsModule } from '@placeos/payments';\nimport { AssetsModule } from '@placeos/assets';\nimport { TVControlsComponent } from './tabbed-view/tv-controls.component';\n\n@NgModule({\n    declarations: [\n        AppComponent,\n        BootstrapComponent,\n        ControlMainViewComponent,\n        ControlVideoCallViewComponent,\n        TopbarHeaderComponent,\n        ControlPageViewComponent,\n        ControlStatusBarComponent,\n        ControlAdvancedViewComponent,\n        VideoCallPageComponent,\n        ControlTabbedViewComponent,\n        DeviceOutputListComponent,\n        DeviceOutputListItemComponent,\n        TabOutletComponent,\n        TVControlsComponent,\n    ],\n    imports: [\n        BrowserModule,\n        BrowserAnimationsModule,\n        AppRoutingModule,\n        MatSnackBarModule,\n        MatDialogModule,\n        MatProgressSpinnerModule,\n        UIModule,\n        MatSliderModule,\n        PaymentsModule,\n        AssetsModule,\n        ServiceWorkerModule.register('ngsw-worker.js', {\n            enabled: environment.production,\n        }),\n    ],\n    providers: [\n        {\n            provide: ErrorHandler,\n            useValue: Sentry.createErrorHandler({\n                showDialog: false,\n            }),\n        },\n        {\n            provide: Sentry.TraceService,\n            deps: [Router],\n        },\n    ],\n    bootstrap: [AppComponent],\n})\nexport class AppModule {}\n","export const environment = {\n    production: true,\n};\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch((err) => console.error(err));\n"],"x_google_ignoreList":[]}