{"version":3,"sources":["./apps/workplace/$_lazy_route_resources|lazy|groupOptions: {}|namespace object","./apps/workplace/src/app/components/global-search.component.ts","./apps/workplace/src/app/components/nav-menu.component.ts","./apps/workplace/src/app/components/shared.module.ts","./apps/workplace/src/app/components/topbar.component.ts","./apps/workplace/src/app/overlays/view-attendees-modal/view-attendees-modal.component.html","./apps/workplace/src/app/overlays/view-attendees-modal/view-attendees-modal.component.ts","./apps/workplace/src/app/overlays/view-catering-modal/view-catering-modal.component.html","./apps/workplace/src/app/overlays/view-catering-modal/view-catering-modal.component.ts","./apps/workplace/src/app/overlays/view-room-modal.component.ts","./apps/workplace/src/app/ui/event-timeline/event-timeline.component.html","./apps/workplace/src/app/ui/event-timeline/event-timeline.component.ts","./libs/catering/src/lib/catering.module.ts","./apps/workplace/src/app/ui/shared.module.ts","./apps/workplace/src/app/ui/vertical-timeline/vertical-timeline.component.html","./apps/workplace/src/app/ui/vertical-timeline/vertical-timeline.component.ts","./libs/mocks/src/lib/api/catering.data.ts","./libs/mocks/src/lib/api/zone.data.ts","./libs/mocks/src/lib/api/zones.mock.ts","./libs/mocks/src/lib/api/common.mock.ts","./libs/mocks/src/lib/api/users.data.ts","./libs/mocks/src/lib/api/spaces.data.ts","./libs/mocks/src/lib/api/events.data.ts","./libs/mocks/src/lib/api/users.mock.ts","./libs/mocks/src/lib/realtime/control.ts","./libs/mocks/src/lib/realtime/events.ts","./libs/mocks/src/lib/realtime/desks.ts","./libs/mocks/src/lib/realtime/camera.ts","./libs/mocks/src/lib/realtime/display.ts","./libs/mocks/src/lib/realtime/microphone.ts","./libs/mocks/src/lib/realtime/capture.ts","./libs/mocks/src/lib/api/systems.mock.ts","./libs/mocks/src/lib/systems-bindings.mock.ts","./libs/mocks/src/lib/api/events.mock.ts","./libs/mocks/src/lib/api/calendars.mock.ts","./libs/mocks/src/lib/api/bookings.data.ts","./libs/mocks/src/lib/api/bookings.mock.ts","./libs/components/src/lib/app.component.ts","./apps/workplace/src/app/app-routing.module.ts","./apps/workplace/src/app/overlays/overlays.module.ts","./apps/workplace/src/app/app.module.ts","./apps/workplace/src/environments/environment.prod.ts","./apps/workplace/src/main.ts","./libs/bookings/src/lib/desk-confirm-modal.component.ts","./libs/bookings/src/lib/desk-questions-modal.component.ts","./libs/bookings/src/lib/bookings.module.ts","./libs/bookings/src/lib/booking.class.ts","./libs/bookings/src/lib/bookings.fn.ts","./libs/bookings/src/lib/booking-state.service.ts","./libs/bookings/src/lib/booking.utilities.ts","./libs/bookings/src/lib/desk.service.ts","./libs/calendar/src/lib/calendar.service.ts","./libs/calendar/src/lib/calendar.class.ts","./libs/calendar/src/lib/calendar.fn.ts","./libs/catering/src/lib/catering-item.class.ts","./libs/catering/src/lib/catering-order.class.ts","./libs/common/src/lib/hotkeys.service.ts","./apps/workplace/src/environments/settings.ts","./libs/common/src/lib/version.ts","./libs/common/src/lib/settings.service.ts","./libs/common/src/lib/angular-animations.ts","./libs/common/src/lib/notifications.ts","./libs/common/src/lib/application.ts","./libs/common/src/lib/formatting.ts","./libs/common/src/lib/placeos.ts","./libs/common/src/lib/user-state.ts","./libs/common/src/lib/api.ts","./libs/common/src/lib/base.class.ts","./libs/common/src/lib/general.ts","./libs/components/src/lib/action-icon.component.ts","./libs/components/src/lib/popout-menu.component.ts","./libs/components/src/lib/map-pin.component.ts","./libs/components/src/lib/map-radius.component.ts","./libs/components/src/lib/status-overlay.component.ts","./libs/components/src/lib/login.component.ts","./libs/components/src/lib/unauthorised.component.ts","./libs/components/src/lib/misconfigured.component.ts","./libs/components/src/lib/authorised-user.guard.ts","./libs/components/src/lib/components.module.ts","./libs/components/src/lib/confirm-modal.component.ts","./libs/components/src/lib/icon.component.ts","./libs/components/src/lib/interactive-map.component.ts","./libs/components/src/lib/safe.pipe.ts","./libs/components/src/lib/sanitise.pipe.ts","./libs/components/src/lib/user-avatar.component.ts","./libs/components/src/lib/virtual-keyboard.component.ts","./libs/events/src/lib/validators.ts","./libs/events/src/lib/utilities.ts","./libs/events/src/lib/event-state.service.ts","./libs/events/src/lib/event.class.ts","./libs/events/src/lib/events.fn.ts","./libs/events/src/lib/helpers.ts","./libs/explore/src/lib/explore-search.service.ts","./libs/explore/src/lib/explore.module.ts","./libs/explore/src/lib/explore-booking-modal.component.ts","./libs/explore/src/lib/explore-desk-info.component.ts","./libs/explore/src/lib/explore-desks.service.ts","./libs/explore/src/lib/explore-device-info.component.ts","./libs/explore/src/lib/explore-map-control.component.ts","./libs/explore/src/lib/explore-map-view.component.ts","./libs/explore/src/lib/explore-space-info.component.ts","./libs/explore/src/lib/explore-spaces.service.ts","./libs/explore/src/lib/explore-state.service.ts","./libs/explore/src/lib/explore-zones.service.ts","./libs/explore/src/lib/explore-zoom-control.component.ts","./libs/form-fields/src/lib/form-fields.module.ts","./libs/form-fields/src/lib/action-field.component.ts","./libs/form-fields/src/lib/counter.component.ts","./libs/form-fields/src/lib/date-field.component.ts","./libs/form-fields/src/lib/duration-field.component.ts","./libs/form-fields/src/lib/time-field.component.ts","./libs/form-fields/src/lib/user-list-field.component.ts","./libs/form-fields/src/lib/user-search-field.component.ts","./libs/organisation/src/lib/level.class.ts","./libs/organisation/src/lib/organisation.class.ts","./libs/organisation/src/lib/building.class.ts","./libs/organisation/src/lib/organisation.service.ts","./libs/organisation/src/lib/desk.class.ts","./libs/spaces/src/lib/space-select-modal.component.ts","./libs/spaces/src/lib/spaces.module.ts","./libs/spaces/src/lib/space.utilities.ts","./libs/spaces/src/lib/space-select-item.component.ts","./libs/spaces/src/lib/space.class.ts","./libs/spaces/src/lib/spaces.service.ts","./libs/users/src/lib/new-user-modal.component.ts","./libs/users/src/lib/user-form.component.ts","./libs/users/src/lib/users.module.ts","./libs/users/src/lib/location.class.ts","./libs/users/src/lib/guests.fn.ts","./libs/users/src/lib/staff.fn.ts","./libs/users/src/lib/user.class.ts","./libs/users/src/lib/user.utilities.ts"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","id","module","exports","GlobalSearchComponent","_service","results","this","search_results","loading","filter_str","setFilter","s","Object","NavMenuComponent","_settings","get","NewSharedComponents","TopbarComponent","value","location","href","logout","ViewAttendeesModalComponent","_data","super","attendees","ViewCateringModalComponent","_router","_dialog","catering_items_total","catering","catering_note","reduce","total","item","quantity","closeAll","navigate","edit","ViewRoomModalComponent","event","style_map","space","level","data","processFeature","processStyles","styles","map_id","display","features","content","name","zoom","EventTimelineComponent","date","valueOf","duration","can_select","dateChange","durationChange","groupsChange","vertical","model","start","hour","minute","end","generateBlocks","updateTime","interval","now","tomorrow","add","startOf","timeout","updateStartEnd","Math","floor","diff","changes","groups","processGroups","updatePeriod","blocks","time","isBefore","push","format","short","divider","grp","blk_end","events","filter","i","event_time","isAfter","isSame","checkInUseBlocks","map","unavailable","hoursToDate","blk","find","t","timestamp","parts","split","period","start_time","today","move","block","emit","center","x","touches","length","clientX","y","clientY","content_box","nativeElement","getBoundingClientRect","percent_w","left","width","percent_h","top","height","percent","end_time","block_size","ceil","max","resetMove","SharedCateringModule","MATERIAL_MODULES","CDK_MODULES","SharedContentModule","N","VerticalTimelineComponent","offset","endOf","timeline_start","timeline_end","show","disabled","minutes","active_move","off","active_start","active_length","setMove","MOCK_MENU","unit_price","category","options","group","generateCateringOrder","differenceInMinutes","event_start","event_end","mx","event_id","invoice_number","charge_code","deliver_at","addMinutes","items","Array","fill","_","idx","MOCK_ORGS","created_at","updated_at","description","tags","count","capacity","parent_id","triggers","MOCK_BUILDINGS","levels","MOCK_LEVELS","bld","building","num","substr","endsWith","type","display_name","mockLevel","p","c","concat","padString","str","path","metadata","method","callback","request","query_params","status","message","bindings","details","area_management","location_services","route_params","generateMockDeskMetadata","DESK_FEATURES","desks","bookable","zone","lvl","DOMAIN","PREDEF_USERS","ACTIVE_USER","email","MOCK_STAFF","join","toLowerCase","MOCK_GUESTS","visit_expected","randomSpaceFeatures","f","numFeatures","res","el","r","indexOf","MOCK_SPACES","zones","d","EVENT_TIME","nextEventTime","save","next","unix","event_status","randomStatus","rnd","MOCK_EVENTS","index","PEOPLE","sort","a","b","resource","unshift","host","calendar","creator","response_status","title","body","private","timezone","all_day","recurring","recurrence","attachments","system","extension_data","setup","breakdown","event_spaces","forEach","person","user","q","search","includes","decodeURIComponent","generateLocation","LOCATION_TYPES","level_spaces","meeting","checked_in","last_seen","subtract","geo","lat","lon","RoomModule","volume","connected","active","input_list","output_list","env_sources","inputs","outputs","source","key","console","log","input","output","$updateState","routes","following","state","mute","$mute","locked","Mic1","mod","Mic2","Mic3","PC1","PC2","PC3","PC4","HDMI","VGA","Camera1","Camera2","Camera3","Camera4","TV1","Display1","Display2","Display3","Display4","Display5","states","createSystemModule","overrides","MockBookingModule","time_zone","disable_book_now","disable_end_meeting","bookings","pending_period","pending_before","control_ui","catering_ui","last_booking_started","createBookingsModule","$start_meeting","$end_meeting","$book_now","len","o","updateBookings","setInterval","u","Date","current","bkn","pending","subSeconds","addSeconds","MockLocationServicesModule","overview","username","padZero","no","createLocationServicesModule","desk_count","desk_usage","device_capacity","device_count","estimated_people","percentage_use","recommendation","number","updateLocations","users","at_location","mac","coordinates_from","s2_cell_id","variance","map_width","map_height","CameraModule","presets","dir","tilt","DisplayModule","MicrophoneModule","CaptureModule","live","remaining","clearInterval","$start","createCaptureModule","System","Bookings","AreaManagement","Camera","createCameraModule","Display","createDisplayModule","Microphone","createMicrophoneModule","Capture","createSystem","zone_ids","period_start","period_end","new_event","findIndex","splice","handleSpaceAvailability","systems","system_ids","has","setHours","startOfDay","getUnixTime","TYPES","MOCK_BOOKINGS","lvls","approved","approver","booking_start","booking_end","user_id","user_name","user_email","asset_id","access","rejected","approver_id","approver_name","approver_email","updateBooking","AppComponent","_tracing","_org","_spaces","_cache","_snackbar","_hotkey","_clipboard","_loading","BehaviorSubject","asObservable","listen","localStorage","setItem","getItem","reload","copy","navigator","clipboard","readText","tkn","addHours","setTimeout","initialised","pipe","first","toPromise","settings","mock","origin","catch","onInitError","clearTimeout","dsn","sample_rate","S","integrations","tracingOrigins","routingInstrumentation","tracesSampleRate","initSentry","is_logged_in","error","component","canActivate","canLoad","loadChildren","m","DashboardModule","BookModule","ExploreModule","ControlModule","DirectoryModule","AppScheduleModule","HelpModule","redirectTo","pathMatch","AppRoutingModule","useHash","SharedOverlaysModule","AppModule","provide","useValue","showDialog","deps","enabled","bootstrapModule","err","DeskConfirmModalComponent","can_set_date","reason","DeskQuestionsModalComponent","form","travelled","unwell","contact","markAllAsTouched","valid","failure","SharedBookingsModule","roundToNearestMinutes","nearestTo","booking_type","abs","Intl","DateTimeFormat","resolvedOptions","timeZone","isSameDay","BOOKINGS_ENDPOINT","queryBookings","query","list","showBooking","encodeURIComponent","saveBooking","createBooking","removeBooking","response_type","BOOKING_URLS","BookingStateService","_view","_options","_form","_form_value","_booking","last_success","JSON","parse","sessionStorage","shareReplay","assets","distinctUntilKeyChanged","switchMap","of","tap","asset","localeCompare","available_assets","combineLatest","debounceTime","zone_id","every","grouped_availability","asset_list","members","pop","subscription","subscribe","booking","url","clearForm","setOptions","getValue","booked_by","booked_by_id","valueChanges","setValue","generateBookingForm","storeForm","newForm","patchValue","removeItem","stringify","checkQuestions","icon","postForm","close","result","setView","ref","open","race","componentInstance","afterClosed","DesksService","error_on_host","levelWithID","success","desk_list","endOfDay","all","desk","makeDeskBooking","for_user","booking_data","CalendarService","_calendars","calendar_list","freeBusy","availability","init","load","_initialised","calendars","old_booking","Calendar","primary","summary","can_edit","starts_at","ends_at","hidden","CALENDAR_ENDPOINT","queryCalendars","queryCalendarAvailability","calendarsToSpaces","org","cal","querySpaceAvailability","querySpaceFreeBusy","CateringItem","accept_points","discount_cap","total_cost","CateringOrder","system_id","item_count","amount","getTime","INVALID_STANDALONE_KEYS","HotkeysService","keydown_states","keydown_observers","combo_end","registered_combos","counter","window","addEventListener","mapKey","last_down","preventDefault","combo","combination","validCombination","last_key","updateCombinationEndList","presses","v","replace","non_meta","DEFAULT_SETTINGS","debug","composer","domain","route","protocol","port","use_domain","local_login","app","short_name","logo_light","src","logo_dark","general","menu_items","class","copyright","position","help","tiles","link","background","columns","booking_types","los_groups","ifs","deals","assurance","tax","consulting","ladies","it","capacity_filters","show_fields","html_body","multiple_spaces","desk_start","space_display","show_images","directory","show_avatars","min_search_length","explore","colors","can_select_building","show_legend_group_names","legend","Spaces","analytics","tracking_id","schedule","color","VERSION","SettingsService","_title","_app_name","_overrides","_subjects","_observables","built","semver","hash","getTitle","setTitle","application","override_settings","override","slice","opacity","ANIMATION_SHOW_CONTRACT_EXPAND","_available","_activated","_timer","setNotifyOutlet","snackbar","notify","action","on_action","config","snackbar_ref","panelClass","dismiss","onAction","notifySuccess","msg","notifyError","notifyInfo","info","setupCache","cache","isEnabled","unsubscribe","available","activateUpdate","activated","checkForUpdate","formatRecurrence","pattern","charAt","toUpperCase","setupPlace","hostname","pathname","auth_type","scope","auth_uri","token_uri","redirect_uri","handle_login","use_iframe","_current_user","current_user","currentUser","jest","delay","retry","toQueryString","hasOwnProperty","BaseClass","_timers","_intervals","_subscriptions","destroy","unsub","fn","Function","contains","subs","k","setAppName","args","stream","force","app_name","getItemWithKeys","shift","unique","array","pos","arr","randomInt","random","openConfirmModal","dialog","csvToJson","csv","delimiter","objPattern","RegExp","arrMatches","arrData","exec","headers","row","element","downloadFile","filename","contents","document","createElement","setAttribute","style","appendChild","click","removeChild","flatten","an_array","stack","isArray","reverse","timePeriodsIntersect","start1","end1","start2","end2","seed","h","imul","charCodeAt","xmur3","rand","predictableRandomInt","timeFormatString","localeString","toLocaleTimeString","querySelector","getAttribute","language","is24HourTime","getInvalidFields","invalid","controls","ActionIconComponent","className","PopoutMenuComponent","actions","MapPinComponent","_details","stroke","show_message","MapRadiusComponent","_el","radius","formatDistanceToNow","updateRadius","box","StatusOverlayComponent","links","UnauthorisedComponent","MisconfiguredComponent","PLACEOS_APP_ACCESS","AuthorisedUserGuard","_access","checkUser","segments","can_activate","MAT_MODULES","ComponentsModule","CONFIRM_METADATA","maxHeight","maxWidth","ConfirmModalComponent","_dialog_ref","confirm_text","cancel_text","disableClose","enableClose","IconComponent","MAP_FEATURE_DATA","InteractiveMapComponent","_injector","injectors","_on_changes","_feature_list","toArray","viewer","createView","providers","parent","focus","focusOn","updateDisplay","labels","updateView","feature_list","desired_zoom","desired_center","_outlet_el","rect","mappings","w","SafePipe","sanitizer","bypassSecurityTrustResourceUrl","bypassSecurityTrustUrl","bypassSecurityTrustScript","bypassSecurityTrustStyle","bypassSecurityTrustHtml","SecurityContext","SanitizePipe","sanitize","RESOURCE_URL","URL","SCRIPT","STYLE","HTML","UserAvatarComponent","DEFAULT_KEYS","VirtualKeyboardComponent","_element","_overlay","keyset","_overlay_ref","onFocus","onBlur","ngOnDestroy","blur","_portal","create","positionStrategy","global","bottom","centerHorizontally","attach","dispose","cursor_pos","selectionStart","dispatchEvent","InputEvent","updateKeyState","focusInput","selectionEnd","endInFuture","control","generateEventForm","organiser","resources","recurring_master_id","master","visitor_type","ext","needs_space","needs_parking","l","disable","setMinutes","days","EventStateService","_event","available_spaces","undefined","spaces","space_list","_default_user","setDefaultCreator","CalendarEvent","range_start","range_end","days_of_week","old_system","is_external","obj","hours","is_today","EVENTS_ENDPOINT","queryEvents","showEvent","saveEvent","toJSON","updateEvent","createEvent","removeEvent","eventStatus","some","DURATION_MAP","month","months","week","weeks","day","DEFAULT_RULES","auto_approve","stringToMinutes","addToDate","filterSpacesFromRules","rulemap","rulesForSpace","ruleset","checkRulesMatch","rules","matches","conditions","is_before","is_after","min_length","max_length","ExploreSearchService","_emergency_contacts","_filter","emergency_contacts","_user_search","search_fn","catchError","contacts","organisation","binding","contacts_map","bind","SharedExploreModule","ExploreBookingModalComponent","on_error","ExploreDeskInfoComponent","tries","parentElement","ngOnInit","parseInt","y_pos","x_pos","ExploreDesksService","_state","_desks_service","_in_use","_desks","_reserved","_statuses","_poll","_desk_bookings","j","_bind","unsubWith","buildings","processBindingChange","_state_change","in_use","reserved","is_used","is_reserved","processDesks","enable_booking","devices","processDevices","updateStatus","colours","desk_id","setStyles","device","setFeatures","hover","book_fn","bookDesk","setActions","ExploreDeviceInfoComponent","manufacturer","os","ssid","toFixed","diameter","bg_color","distance_color","overlay_ref","onEnter","loadUser","onLeave","onClick","onTouch","addSuffix","distance","execute","assigned_to","flexibleConnectedTo","_dot","withPositions","originX","originY","overlayX","overlayY","ExploreMapControlComponent","_route","building_list","active_building","active_levels","setLevel","relativeTo","queryParams","setBuilding","queryParamMap","params","ExploreMapViewComponent","_s","_zones","map_url","map_styles","positions","map_positions","map_features","map_actions","map_labels","locateSpace","locateUser","feature","locate_details","locations","priority","ExploreSpaceInfoComponent","DEFAULT_COLOURS","free","busy","unknown","ExploreSpacesService","_bookings","handleBookingsChange","handleStatusChange","updateActions","updateHoverElements","bookSpace","ExploreStateService","_level","_positions","_styles","_features","_actions","_labels","_message","show_zones","show_devices","show_contacts","values","style_mappings","level_list","levelsForBuilding","feature_map","actions_map","labels_map","ExploreZonesService","_location","_capacity","parseData","zone_metadata","areas","area","properties","label_location","filled","area_id","setLabels","ExploreZoomControlComponent","zoomIn","setPositions","min","zoomOut","reset","FormFieldsModule","ActionFieldComponent","show_tooltip","performAction","CounterComponent","step","ctrl_key","shift_key","new_value","_onChange","_onTouch","useExisting","multi","remove","FieldDateAdapter","displayFormat","FIELD_DATE_FORMATS","dateInput","monthYearLabel","dateA11yLabel","monthYearA11yLabel","DateFieldComponent","_from","_to","toISOString","old_date","new_date","getHours","getMinutes","from","useClass","DurationFieldComponent","specialPreprops","duration_options","generateDurationOptions","option","TimeFieldComponent","no_past_times","show_select","_time_options","generateAvailableTimes","select_field","openedChange","datestamp","show_past","showSelect","$event","stopPropagation","UserListFieldComponent","limit","guests","hide_actions","new_user","user_list","active_list","validFn","test","emptyClick","openNewUserModal","search_user","a_user","target","file","files","reader","FileReader","readAsText","evt","processCsvData","srcElement","staff_id","first_name","last_name","internal_emails","phone","addUser","UserSearchFieldComponent","query_fn","search$","search_results$","search_str","cancelReset","blurInput","_input_el","active_user","resetSearchString","BuildingLevel","Organisation","raw_data","Building","disc_info","discovery_info","extras","extra_id","extra_name","loan_items","building_id","_roles","roles","_lockers","lockers","locker_structure","_systems","_phone_numbers","phone_numbers","longitude","latitude","room_configurations","attributes","searchables","neighbourhoods","lvl_features","level_id","catering_hours","visitor_space","holding_bay","address","orientations","booking_details","booking_rules","catering_restricted_from","currency","OrganisationService","_buildings","_active_building","_levels","_building_settings","buildingSettings","bld_id","_organisation","id_list","orgs","loadOrganisation","loadBuildings","loadLevels","loadSettings","org_list","auth","org_zone","prev","curr","Desk","SpaceSelectModalComponent","space_types","filtered_spaces","multiple","space_map","SharedSpacesModule","SPACE_COUNT","generateMockSpace","linked","long_name","searchable","controlable","cost_hour","support_url","linked_rooms","image","SpaceSelectItemComponent","Space","configurations","SpacesService","_list","_compare","loadSpaces","predicate","valid_spaces","sys","NewUserModalComponent","UserFormComponent","touched","SharedUsersModule","MapLocation","searchGuests","STAFF_ENDPOINT","searchStaff","showStaff","User","notes","photo","organizer","required","sys_admin","support","assistance_required","GuestUser","preferred_beverage","accepted_terms_conditions","StaffUser","card_number","USER_DOMAIN","generateUserForm","fields"],"mappings":"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","file":"main.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 2726;\nmodule.exports = webpackEmptyAsyncContext;","import { Component } from '@angular/core';\n\nimport { ExploreSearchService } from '@placeos/explore';\n\n@Component({\n    selector: 'global-search',\n    template: `\n        <div\n            container\n            class=\"flex items-center rounded focus-within:shadow focus:shadow w-full px-2 relative\"\n        >\n            <app-icon class=\"text-2xl\">search</app-icon>\n            <input\n                #input\n                placeholder=\"Search for people or spaces...\"\n                class=\"flex-1 w-1/2 py-2 outline-none\"\n                [(ngModel)]=\"filter_str\"\n                (ngModelChange)=\"setFilter($event)\"\n                [matAutocomplete]=\"auto\"\n                [matAutocompleteConnectedTo]=\"origin\"\n            />\n            <mat-spinner *ngIf=\"loading | async\" [diameter]=\"32\"></mat-spinner>\n            <div\n                class=\"absolute bottom-0 left-2 right-2 min-w-[20rem]\"\n                matAutocompleteOrigin\n                #origin=\"matAutocompleteOrigin\"\n            ></div>\n        </div>\n        <mat-autocomplete #auto=\"matAutocomplete\">\n            <ng-container *ngIf=\"(loading | async) !== true && filter_str\">\n                <mat-option\n                    *ngIf=\"!(results | async)?.length\"\n                    class=\"pointer-events-none\"\n                >\n                    No matches found\n                </mat-option>\n                <mat-option\n                    *ngFor=\"let option of results | async | slice: 0:5\"\n                    [value]=\"option\"\n                >\n                    <a\n                        [routerLink]=\"['/explore']\"\n                        [queryParams]=\"\n                            option.type === 'space'\n                                ? { space: option.id }\n                                : { email: option.id }\n                        \"\n                        class=\"w-full h-full flex items-center leading-tight\"\n                    >\n                        <div class=\"flex-1 overflow-hidden\">\n                            <div class=\"truncate w-full\">\n                                {{ option.name }}\n                            </div>\n                            <div class=\"text-xs\">\n                                {{ option.description }}\n                            </div>\n                        </div>\n                        <div\n                            class=\"text-xs font-bold p-2 capitalize text-white bg-gray-500 rounded\"\n                        >\n                            {{ option.type }}\n                        </div>\n                    </a>\n                </mat-option>\n            </ng-container>\n        </mat-autocomplete>\n    `,\n    styles: [\n        `\n            [container] {\n                transition: color 200ms, background-color 200ms;\n                background-color: #fff4;\n                color: #fff8;\n            }\n\n            [container]:focus,\n            [container]:focus-within {\n                background-color: #fff;\n                color: #000;\n                outline: var(--primary);\n            }\n\n            input::placeholder {\n                color: #fff8;\n            }\n\n            input:focus ::placeholder {\n                color: #0008;\n            }\n        `,\n    ],\n})\nexport class GlobalSearchComponent {\n    public readonly results = this._service.search_results;\n    public readonly loading = this._service.loading;\n\n    public filter_str = '';\n\n    public readonly setFilter = (s) =>\n        s instanceof Object\n            ? (this.filter_str = '')\n            : this._service.setFilter(s);\n\n    constructor(private _service: ExploreSearchService) {}\n}\n","import { Component } from '@angular/core';\nimport { ApplicationLink, SettingsService } from '@placeos/common';\n\n@Component({\n    selector: 'nav-menu',\n    template: `\n        <div\n            class=\"flex sm:flex-col bg-white overflow-auto text-black shadow divide-y divide-gray-100 w-full sm:w-auto h-auto sm:h-full border-t sm:border-t border-gray-300\"\n        >\n            <a\n                mat-icon-button\n                class=\"h-16 w-16 rounded\"\n                *ngFor=\"let item of menu_items\"\n                [routerLink]=\"[item.route]\"\n                routerLinkActive=\"active\"\n            >\n                <div class=\"flex flex-col items-center\">\n                    <app-icon [icon]=\"item.icon\"></app-icon>\n                    <div\n                        text\n                        class=\"text-sm font-normal h-0 overflow-hidden opacity-0\"\n                    >\n                        {{ item.name }}\n                    </div>\n                </div>\n            </a>\n        </div>\n    `,\n    styles: [\n        `\n            [text] {\n                transition: opacity 200ms, height 200ms;\n            }\n\n            .active {\n                color: var(--primary);\n            }\n\n            .active [text],\n            a:hover [text] {\n                height: 1.25rem !important;\n                opacity: 1 !important;\n            }\n        `,\n    ],\n})\nexport class NavMenuComponent {\n    public get menu_items(): ApplicationLink[] {\n        return this._settings.get('app.general.menu_items') || [];\n    }\n\n    constructor(private _settings: SettingsService) {}\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatButtonModule } from '@angular/material/button';\nimport { RouterModule } from '@angular/router';\nimport { ComponentsModule } from '@placeos/components';\n\nimport { GlobalSearchComponent } from './global-search.component';\nimport { NavMenuComponent } from './nav-menu.component';\nimport { TopbarComponent } from './topbar.component';\n\nconst COMPONENTS: Type<any>[] = [\n    TopbarComponent,\n    NavMenuComponent,\n    GlobalSearchComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        RouterModule.forChild([]),\n        FormsModule,\n        ComponentsModule,\n        MatAutocompleteModule,\n        MatButtonModule,\n    ],\n    exports: [...COMPONENTS, ComponentsModule],\n})\nexport class NewSharedComponents {}\n","import { Component } from '@angular/core';\nimport {\n    ApplicationIcon,\n    currentUser,\n    SettingsService,\n    VERSION,\n} from '@placeos/common';\nimport { logout } from '@placeos/ts-client';\n\n@Component({\n    selector: 'topbar',\n    template: `\n        <div\n            class=\"flex items-center justify-between h-16 bg-secondary border-b border-gray-200 text-white\"\n        >\n            <div icon class=\"p-2 h-full flex items-center\" *ngIf=\"logo\">\n                <img class=\"h-10 sm:h-12\" [src]=\"logo?.src\" />\n            </div>\n            <h2 *ngIf=\"title; else search\">{{ title }}</h2>\n\n            <a-user-avatar\n                class=\"m-3 text-lg\"\n                [user]=\"user\"\n                [matMenuTriggerFor]=\"menu\"\n            ></a-user-avatar>\n        </div>\n        <mat-menu #menu=\"matMenu\">\n            <div\n                mat-menu-item\n                class=\"flex items-center pointer-events-none leading-tight pl-0\"\n            >\n                <a-user-avatar\n                    class=\"m-3 text-lg\"\n                    [user]=\"user\"\n                ></a-user-avatar>\n                <div class=\"flex flex-col\">\n                    <div class=\"text-lg\">{{ user.name }}</div>\n                    <div class=\"text-xs opacity-60\">{{ user.email }}</div>\n                </div>\n            </div>\n            <div\n                mat-menu-item\n                class=\"px-2 h-auto leading-loose pointer-events-none\"\n            >\n                <ng-container *ngFor=\"let group of user.groups || []\">\n                    <span\n                        class=\"py-1 px-2 m-1 rounded-2xl text-xs bg-gray-500 text-white\"\n                        *ngIf=\"group\"\n                    >\n                        {{ group }}\n                    </span>\n                </ng-container>\n            </div>\n            <button mat-menu-item (click)=\"logout()\">\n                <div class=\"flex items-center space-x-2\">\n                    <app-icon class=\"text-xl\">logout</app-icon>\n                    <div>Logout</div>\n                </div>\n            </button>\n            <div\n                mat-menu-item\n                class=\"flex flex-col justify-center pointer-events-none leading-tight\"\n            >\n                <div>\n                    Version: <i>{{ version.hash }}</i>\n                </div>\n                <div class=\"text-xs opacity-60\">\n                    {{ version.time | date: 'longDate' }} ~\n                    {{ version.time | date: 'shortTime' }}\n                </div>\n            </div>\n        </mat-menu>\n        <ng-template #search>\n            <global-search class=\"flex-1 mx-2\"></global-search>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class TopbarComponent {\n    public show_menu: boolean;\n\n    /** Application logo to display */\n    public get logo(): ApplicationIcon {\n        return this._settings.get('app.logo_dark');\n    }\n    /** Text to display for page title */\n    public get title(): string {\n        return this._settings.value('page_title');\n    }\n\n    public get user() {\n        return currentUser();\n    }\n\n    public get version() {\n        return VERSION;\n    }\n\n    constructor(private _settings: SettingsService) {}\n\n    public logout() {\n        logout();\n        location.href = '/logout';\n    }\n}\n","<header>\n    <app-icon\n        [icon]=\"{ type: 'icon', class: 'material-icons', content: 'people_outline' }\"\n    ></app-icon>\n    <h1>Attendees</h1>\n</header>\n<mat-dialog-content>\n    <div class=\"body\">\n        <div *ngFor=\"let item of attendees\">\n            <app-icon\n                [icon]=\"{ type: 'icon', class: 'material-icons', content: 'perm_identity' }\"\n            ></app-icon>\n            <label>{{ item.name }}</label>\n            <a href=\"mailto:{{ item.email }}\">{{ item.email }}</a>\n        </div>\n    </div>\n</mat-dialog-content>\n<mat-dialog-actions>\n    <footer>\n        <button mat-button class=\"inverse\" mat-dialog-close>Close</button>\n    </footer>\n</mat-dialog-actions>\n","import { Component, OnInit, OnChanges, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { BaseClass } from '@placeos/common';\nimport { User } from '@placeos/users';\n\n@Component({\n    selector: 'schedule-view-attendees',\n    templateUrl: './view-attendees-modal.component.html',\n    styleUrls: ['./view-attendees-modal.component.scss']\n})\nexport class ViewAttendeesModalComponent extends BaseClass implements OnChanges, OnInit {\n    public attendees: User[];\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: { attendees: User[] }) {\n        super();\n    }\n\n    public ngOnChanges() {\n\n    }\n\n    public ngOnInit() {\n            this.attendees = this._data.attendees;\n    }\n\n}\n","<header>\n    <app-icon>room_service</app-icon>\n    <h1>Catering</h1>\n</header>\n<div class=\"body\">\n    <strong>Item</strong>\n    <strong class=\"qty\">Quantity</strong>\n    <ng-container *ngFor=\"let item of catering\">\n        <label>\n            {{ item.item }}\n        </label>\n        <label class=\"qty\">\n            {{ item.qty }}\n        </label>\n    </ng-container>\n    <strong class=\"total\">Total Items</strong>\n    <strong class=\"qty\">{{ catering_items_total }}</strong>\n    <strong class=\"note-label\"> Note: </strong>\n    <div class=\"note-box\">\n        {{ catering_note }}\n    </div>\n</div>\n<footer>\n    <button mat-dialog-close>Close</button>\n    <button class=\"black\" (click)=\"edit()\">Edit</button>\n</footer>\n","import { Component, OnInit, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA, MatDialog } from '@angular/material/dialog';\nimport { Router } from '@angular/router';\n\nimport { CateringItem } from '@placeos/catering';\nimport { BaseClass } from '@placeos/common';\n\n@Component({\n    selector: 'view-catering-modal',\n    templateUrl: './view-catering-modal.component.html',\n    styleUrls: ['./view-catering-modal.component.scss']\n})\nexport class ViewCateringModalComponent extends BaseClass implements OnInit {\n    public catering: CateringItem[];\n    public catering_note: string;\n    public catering_items_total = 0;\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA)\n        private _data: { catering: CateringItem[]; catering_note: string },\n        private _router: Router,\n        private _dialog: MatDialog\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        const data = this._data;\n\n        if (data) {\n            this.catering = this._data.catering;\n            this.catering_note = this._data.catering_note;\n            this.catering_items_total = this.catering.reduce((total, item) => item.quantity + total, 0);\n        }\n    }\n\n    /**\n     * TODO: this makes no sense. catering is not a route to be accessed like this\n     */\n    public edit() {\n        this._dialog.closeAll();\n        this._router.navigate(['/catering/']);\n    }\n}\n","import { Component, OnInit, Output, EventEmitter, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { ViewerFeature, ViewerStyles } from '@placeos/svg-viewer';\n\nimport { BaseClass } from '@placeos/common';\nimport { BuildingLevel } from '@placeos/organisation';\nimport { Space } from '@placeos/spaces';\nimport { MapPinComponent } from '@placeos/components';\n\n@Component({\n    selector: 'view-room-modal',\n    template: `\n        <header class=\"h-12 px-2\">\n            <app-icon>place</app-icon>\n            <h1 class=\"ml-2\">{{ space.name }}</h1>\n        </header>\n        <div body class=\"relative overflow-hidden pointer-events-none\" *ngIf=\"level\">\n            <i-map\n                [src]=\"level.map_id\"\n                [styles]=\"style_map\"\n                [features]=\"features\"\n            >\n                <mat-spinner diameter=\"64\"></mat-spinner>\n            </i-map>\n            <div class=\"absolute top-2 right-2 py-2 px-4 bg-white rounded-3xl shadow\">{{ level?.name }}</div>\n        </div>\n        <footer class=\"w-full border-t border-gray-200 flex items-center justify-center p-2\">\n            <button mat-button class=\"inverse w-32\" mat-dialog-close>Close</button>\n        </footer>\n    `,\n    styles: [\n        `\n            [body] {\n                width: 80vw;\n                height: 65vh;\n            }\n        `,\n    ],\n})\nexport class ViewRoomModalComponent extends BaseClass implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter();\n    /** Space to show the location of on the map */\n    public space: Space;\n    /** Features of the map */\n    public features: ViewerFeature[];\n    /** Mapping of elements to CSS styles */\n    public style_map: ViewerStyles = {};\n\n    public get level(): BuildingLevel {\n        return this.space.level;\n    }\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: { space: Space }) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        const data = this._data;\n        if (data) {\n            this.space = data.space;\n            this.processFeature();\n            this.processStyles();\n        }\n    }\n\n    public processStyles(): void {\n        const styles: ViewerStyles = {};\n        if (this.space.map_id) {\n            styles[`#zones`] = { display: 'none' };\n            styles[`#Zones`] = { display: 'none' };\n        }\n        this.style_map = styles;\n    }\n\n    /** Point on map to focus on */\n    public processFeature(): void {\n        if (!this.space) {\n            return null;\n        }\n        const focus = {\n            location: this.space.map_id,\n            content: MapPinComponent,\n            data: {\n                name: this.space.name,\n            },\n            zoom: 100,\n        };\n        this.features = [focus];\n    }\n}\n","<div [class]=\"'event-timeline' + (klass ? ' ' + klass : '')\">\n    <div class=\"times\" (window:mouseup)=\"resetMove()\" (window:touchend)=\"resetMove()\">\n        <div class=\"row divider\">\n            <div class=\"header\"></div>\n            <div class=\"line\">\n                <div class=\"mini-block\" *ngFor=\"let blk of model.blocks || []\">\n                    <div class=\"time\" *ngIf=\"blk.hour\">\n                        <span>{{ blk.short }}</span>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class=\"content\">\n        <div class=\"overlay row\">\n            <div class=\"header\"></div>\n            <div class=\"line\" #overlay (mousemove)=\"move($event)\" (touchmove)=\"move($event)\">\n                <div\n                    class=\"mini-block\"\n                    *ngFor=\"let blk of model.blocks || []\"\n                    [class.unavailable]=\"blk.unavailable\"\n                    (click)=\"setTime(blk)\"\n                >\n                    <div class=\"bar\" [class.hour]=\"blk.hour\" [class.divider]=\"blk.divider\"></div>\n                </div>\n                <div\n                    class=\"current-time\"\n                    *ngIf=\"model.today > 0\"\n                    [style.left]=\"vertical ? '' : model.today * 100 + '%'\"\n                    [style.top]=\"vertical ? model.today * 100 + '%' : ''\"\n                ></div>\n                <div\n                    class=\"selected-time\"\n                    *ngIf=\"can_select\"\n                    [style.left]=\"vertical ? '' : model.start_time * 100 + '%'\"\n                    [style.top]=\"vertical ? model.start_time * 100 + '%' : ''\"\n                    [style.width]=\"vertical ? '' : model.duration * 100 + '%'\"\n                    [style.height]=\"vertical ? model.duration * 100 + '%' : ''\"\n                >\n                    <div\n                        class=\"inner\"\n                        (mousedown)=\"setMove('start')\"\n                        (touchstart)=\"setMove('start')\"\n                    ></div>\n                    <div\n                        class=\"knob start\"\n                        (mousedown)=\"setMove('start')\"\n                        (touchstart)=\"setMove('start')\"\n                    ></div>\n                    <div\n                        class=\"knob end\"\n                        (mousedown)=\"setMove('end')\"\n                        (touchstart)=\"setMove('end')\"\n                    ></div>\n                </div>\n            </div>\n        </div>\n        <div class=\"row\" *ngFor=\"let grp of this.model.groups || []\" [class.divider]=\"grp.divider\">\n            <div class=\"header\">\n                <div class=\"text\">{{ grp.name }}</div>\n                <div class=\"icon\" *ngIf=\"grp.remove\" (click)=\"grp.remove()\">\n                    <i class=\"material-icons\">close</i>\n                </div>\n            </div>\n            <div class=\"line\">\n                <div class=\"mini-block\" *ngFor=\"let blk of grp.blocks\">\n                    <div\n                        class=\"item\"\n                        *ngFor=\"let event of blk.events\"\n                        [style.width]=\"vertical ? '' : (event.duration / 5) * 100 + '%'\"\n                        [style.height]=\"vertical ? (event.duration / 5) * 100 + '%' : ''\"\n                    >\n                        <div class=\"text\">{{ event.text }}</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n","import {\n    Component,\n    OnInit,\n    Input,\n    SimpleChanges,\n    OnChanges,\n    Output,\n    EventEmitter,\n    ViewChild,\n    ElementRef,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nimport * as dayjs from 'dayjs';\n\nexport interface ITimelineEventGroup {\n    name?: string;\n    divider?: boolean;\n    can_toggle?: boolean;\n    disabled?: boolean;\n    required?: boolean;\n    events?: ITimelineEvent[];\n    blocks?: ITimelineBlock[];\n    remove?: () => void;\n}\n\nexport interface ITimelineEvent {\n    start: number;\n    duration: number;\n    text?: string;\n}\n\ninterface ITimelineBlock {\n    id: string;\n    display?: string;\n    short?: string;\n    hour?: boolean;\n    divider?: boolean;\n    unavailable?: boolean;\n    events?: ITimelineEvent[];\n}\n\n@Component({\n    selector: 'event-timeline',\n    templateUrl: './event-timeline.component.html',\n    styleUrls: ['./event-timeline.component.scss'],\n})\nexport class EventTimelineComponent extends BaseClass implements OnInit, OnChanges {\n    /** Groups and events */\n    @Input() public groups: ITimelineEventGroup[];\n    /** Selected date */\n    @Input() public date = dayjs().valueOf();\n    /** Selected duration in min */\n    @Input() public duration = 30;\n    /** Whether time can be changed */\n    @Input() public can_select = true;\n    @Input() public klass: string;\n\n    /** Output emitter */\n    @Output() public dateChange = new EventEmitter<number>();\n    @Output() public durationChange = new EventEmitter<number>();\n    @Output() public groupsChange = new EventEmitter<ITimelineEventGroup[]>();\n\n    public vertical = false;\n    public model: { [name: string]: any } = {};\n\n    @ViewChild('overlay', { static: false }) public content: ElementRef<HTMLDivElement>;\n\n    public ngOnInit(): void {\n        this.model.start = dayjs(this.date).hour(6).minute(30);\n        this.model.end = dayjs(this.date).hour(21).minute(30);\n        this.generateBlocks();\n        this.updateTime();\n        this.interval('timer', () => this.updateTime(), 60 * 1000);\n        const now = dayjs();\n        const tomorrow = dayjs().add(1, 'd').startOf('d');\n        this.timeout(\n            'update_date',\n            () => {\n                this.updateStartEnd();\n                this.interval('update_date', () => this.updateStartEnd(), 24 * 60 * 60 * 1000);\n            },\n            Math.floor(tomorrow.diff(now, 's'))\n        );\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.groups) {\n            this.processGroups();\n        }\n        if (changes.date || changes.duration) {\n            this.updateStartEnd();\n        }\n    }\n\n    public updateStartEnd() {\n        this.model.start = dayjs(this.date).hour(6).minute(30);\n        this.model.end = dayjs(this.date).hour(21).minute(30);\n        this.updatePeriod();\n        this.updateTime();\n    }\n\n    public generateBlocks() {\n        const start = this.model.start;\n        const end = this.model.end;\n        const blocks: ITimelineBlock[] = [];\n        for (let time = dayjs(start); time.isBefore(end); time = time.add(5, 'm')) {\n            blocks.push({\n                id: time.format('HH:mm'),\n                display: time.format('hh:00 a'),\n                short: time.format('hh a'),\n                hour: time.minute() === 0,\n                divider: time.minute() % 30 === 0,\n            });\n        }\n        this.model.blocks = blocks;\n    }\n\n    public processGroups() {\n        this.timeout(\n            'process',\n            () => {\n                this.model.groups = [];\n                const date = dayjs(this.model.start);\n                const end = this.model.end;\n                for (const grp of this.groups || []) {\n                    const blocks: ITimelineBlock[] = [];\n                    for (let time = dayjs(date); time.isBefore(end); time = time.add(5, 'm')) {\n                        const blk_end = dayjs(time).add(5, 'm');\n                        let events = [];\n                        if (grp.events) {\n                            events = grp.events.filter((i) => {\n                                const event_time = dayjs(this.date)\n                                    .hour(Math.floor(i.start))\n                                    .minute(Math.floor((i.start * 60) % 60));\n                                return (\n                                    (event_time.isAfter(time, 'm') ||\n                                        event_time.isSame(time, 'm')) &&\n                                    event_time.isBefore(blk_end, 'm')\n                                );\n                            });\n                        }\n                        blocks.push({\n                            id: time.format('HH:mm'),\n                            events,\n                        });\n                    }\n                    this.model.groups.push({ ...grp, blocks });\n                }\n                this.checkInUseBlocks();\n            },\n            20\n        );\n    }\n\n    public checkInUseBlocks() {\n        if (!this.model.blocks) {\n            return;\n        }\n        const blocks: ITimelineBlock[] = this.model.blocks.map((i) => ({\n            ...i,\n            unavailable: false,\n        }));\n        for (const grp of this.model.groups) {\n            for (const event of grp.events || []) {\n                const start = this.hoursToDate(event.start);\n                const end = dayjs(start).add(event.duration, 'm');\n                for (let time = dayjs(start); time.isBefore(end); time = time.add(5, 'm')) {\n                    const display = time.format('HH:mm');\n                    const blk = blocks.find((i) => i.id === display);\n                    if (blk) {\n                        blk.unavailable = true;\n                    }\n                }\n            }\n        }\n        this.model.blocks = blocks;\n    }\n\n    public hoursToDate(time: number) {\n        let t = dayjs()\n            .startOf('d')\n            .hour(Math.floor(time))\n            .minute(Math.floor((time * 60) % 60));\n        t = t.minute(Math.floor(t.minute() / 5) * 5);\n        return t;\n    }\n\n    public timeToDate(timestamp: string) {\n        const parts = timestamp.split(':');\n        let t = dayjs()\n            .startOf('d')\n            .hour(+parts[0])\n            .minute(+parts[1]);\n        t = t.minute(Math.floor(t.minute() / 5) * 5);\n        return t;\n    }\n\n    public updatePeriod() {\n        const start = dayjs(this.date).startOf('m');\n        const period = this.model.end.diff(this.model.start, 'm') / 60;\n        this.model.start_time = start.diff(this.model.start, 'm') / 60 / period;\n        this.model.duration = this.duration / 60 / period;\n    }\n\n    public updateTime() {\n        const start = dayjs().startOf('m');\n        const period = this.model.end.diff(this.model.start, 'm') / 60;\n        this.model.today = start.diff(this.model.start, 'm') / 60 / period;\n    }\n\n    public resetMove() {\n        this.model.move = '';\n    }\n\n    public setMove(move: string) {\n        this.model.move = move;\n    }\n\n    public setTime(block: ITimelineBlock) {\n        if (!block) {\n            return;\n        }\n        const parts = block.id.split(':');\n        const time = dayjs(this.date)\n            .hour(+parts[0])\n            .minute(+parts[1]);\n        this.date = time.valueOf();\n        this.dateChange.emit(this.date);\n        this.updatePeriod();\n    }\n\n    public move(e) {\n        this.timeout(\n            'move',\n            () => {\n                if (this.model.move && this.content) {\n                    const center = {\n                        x:\n                            e.touches && e.touches.length > 0\n                                ? e.touches[0].clientX || e.clientX\n                                : e.clientX,\n                        y:\n                            e.touches && e.touches.length > 0\n                                ? e.touches[0].clientY || e.clientY\n                                : e.clientY,\n                    };\n                    const content_box = this.content.nativeElement.getBoundingClientRect();\n                    const percent_w = (center.x - content_box.left) / content_box.width;\n                    const percent_h = (center.y - content_box.top) / content_box.height;\n                    const percent = !this.vertical ? percent_w : percent_h;\n\n                    const start_time = this.model.start.hour() + this.model.start.minute() / 60;\n                    const end_time = this.model.end.hour() + this.model.end.minute() / 60;\n                    const diff_time = end_time - start_time;\n                    const block_size = 15;\n                    const hour =\n                        Math.ceil((diff_time * percent + start_time) * (60 / block_size)) /\n                        (60 / block_size);\n                    if (this.model.move === 'end') {\n                        let date = dayjs(this.date);\n                        const end = dayjs(this.date)\n                            .hour(Math.floor(hour))\n                            .minute(Math.floor((hour * 60) % 60));\n                        if (end.isSame(date, 'm') || end.isBefore(date, 'm')) {\n                            date = dayjs(end).add(-this.duration, 'm');\n                            this.date = date.valueOf();\n                        } else {\n                            const duration = Math.floor(end.diff(date, 'm'));\n                            this.duration = Math.max(60, duration || block_size);\n                            this.durationChange.emit(this.duration);\n                        }\n                    } else if (this.model.move === 'start') {\n                        const date = dayjs(this.date)\n                            .hour(Math.floor(hour))\n                            .minute(Math.floor((hour * 60) % 60));\n                        this.date = date.valueOf();\n                    }\n                    this.dateChange.emit(this.date);\n                    this.updatePeriod();\n                }\n            },\n            10\n        );\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { ComponentsModule } from '@placeos/components';\nimport { FormFieldsModule } from '@placeos/form-fields';\nimport { CateringConfigModalComponent } from './catering-config-modal.component';\nimport { CateringItemModalComponent } from './catering-item-modal.component';\nimport { CateringMenuItemComponent } from './catering-menu-item.component';\nimport { CateringMenuComponent } from './catering-menu.component';\nimport { CateringItemOptionModalComponent } from './catering-option-modal.component';\nimport { CateringOrderItemComponent } from './catering-order-item.component';\nimport { CateringOrderListComponent } from './catering-order-list.component';\nimport { CateringOrderModalComponent } from './catering-order-modal.component';\nimport { CateringOrderOptionsModalComponent } from './catering-order-options-modal.component';\nimport { CateringOrderComponent } from './catering-order.component';\n\n\nconst COMPONENTS: Type<any>[] = [\n    CateringOrderOptionsModalComponent,\n    CateringOrderModalComponent,\n    CateringConfigModalComponent,\n    CateringItemModalComponent,\n    CateringMenuComponent,\n    CateringMenuItemComponent,\n    CateringItemOptionModalComponent,\n    CateringOrderListComponent,\n    CateringOrderComponent,\n    CateringOrderItemComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        MatMenuModule,\n        MatTabsModule,\n        MatAutocompleteModule,\n        MatDialogModule,\n        MatCheckboxModule,\n        FormsModule,\n        ReactiveFormsModule,\n        ComponentsModule,\n        FormFieldsModule\n    ],\n    providers: [],\n    exports: [...COMPONENTS],\n})\nexport class SharedCateringModule {}\n","import { ScrollingModule } from '@angular/cdk/scrolling';\nimport { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { RouterModule } from '@angular/router';\nimport { EditorModule } from '@tinymce/tinymce-angular';\n\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatBadgeModule } from '@angular/material/badge';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatRippleModule } from '@angular/material/core';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatExpansionModule } from '@angular/material/expansion';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatProgressBarModule } from '@angular/material/progress-bar';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatRadioModule } from '@angular/material/radio';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatTooltipModule } from '@angular/material/tooltip';\n\nimport { SharedCateringModule } from '@placeos/catering';\nimport { ComponentsModule } from '@placeos/components';\nimport { SharedSpacesModule } from '@placeos/spaces';\nimport { SharedUsersModule } from '@placeos/users';\nimport { FormFieldsModule } from '@placeos/form-fields';\nimport { SharedBookingsModule } from '@placeos/bookings';\n\nimport { EventTimelineComponent } from './event-timeline/event-timeline.component';\nimport { BookingEditComponent } from './forms/booking-edit/booking-edit.component';\nimport { BookingFormModalComponent } from './forms/booking-form-modal/booking-form-modal-component';\nimport { BookingFormComponent } from './forms/booking-form/booking-form.component';\nimport { VerticalTimelineComponent } from './vertical-timeline/vertical-timeline.component';\nimport { NewSharedComponents } from '../components/shared.module';\n\nconst COMPONENTS: Type<any>[] = [\n    BookingFormComponent,\n    BookingFormModalComponent,\n    BookingEditComponent,\n    EventTimelineComponent,\n    VerticalTimelineComponent,\n];\n\nconst MATERIAL_MODULES: any[] = [\n    MatButtonModule,\n    MatSnackBarModule,\n    MatDialogModule,\n    MatFormFieldModule,\n    MatInputModule,\n    MatProgressSpinnerModule,\n    MatProgressBarModule,\n    MatAutocompleteModule,\n    MatSelectModule,\n    MatChipsModule,\n    MatRippleModule,\n    MatMenuModule,\n    MatCheckboxModule,\n    MatExpansionModule,\n    MatTabsModule,\n    MatBadgeModule,\n    MatTooltipModule,\n    MatRadioModule,\n];\n\nconst CDK_MODULES: any[] = [ScrollingModule];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        RouterModule,\n        EditorModule,\n        ComponentsModule,\n        FormFieldsModule,\n        NewSharedComponents,\n        ...MATERIAL_MODULES,\n        ...CDK_MODULES,\n    ],\n    exports: [\n        EditorModule,\n        ComponentsModule,\n        FormFieldsModule,\n        SharedSpacesModule,\n        SharedCateringModule,\n        SharedUsersModule,\n        SharedBookingsModule,\n        NewSharedComponents,\n        ...COMPONENTS,\n        ...MATERIAL_MODULES,\n        ...CDK_MODULES,\n    ],\n})\nexport class SharedContentModule {}\n","<div class=\"timeline\" (window:mouseup)=\"resetMove()\" (window:touchend)=\"resetMove()\">\n    <div class=\"content\" (mousemove)=\"move($event)\" (touchmove)=\"move($event)\">\n        <div class=\"timeblocks\">\n            <div class=\"blk\" *ngFor=\"let item of blocks\">\n                <div class=\"text\" *ngIf=\"item.hour\">{{ item.display }}</div>\n            </div>\n        </div>\n        <div class=\"eventblocks\" #block>\n            <div\n                class=\"blk\"\n                *ngFor=\"let item of blocks\"\n                [class.shown-block]=\"item.show\"\n                [class.hour]=\"item.hour\"\n                [class.disabled]=\"item.disabled\"\n                [class.unavailable]=\"item.unavailable\"\n            ></div>\n            <div\n                class=\"selected-time\"\n                #time\n                [style.top]=\"active_start * 100 + '%'\"\n                [style.height]=\"active_length * 100 + '%'\"\n            >\n                <div class=\"inner\" (mousedown)=\"setMove('top')\" (touchstart)=\"setMove('top')\">\n                    {{ display }}\n                </div>\n                <div\n                    class=\"handle top\"\n                    (mousedown)=\"setMove('top')\"\n                    (touchstart)=\"setMove('top')\"\n                ></div>\n                <div\n                    class=\"handle bottom\"\n                    (mousedown)=\"setMove('bottom')\"\n                    (touchstart)=\"setMove('bottom')\"\n                ></div>\n            </div>\n        </div>\n    </div>\n</div>\n","import {\n    Component,\n    OnInit,\n    Input,\n    Output,\n    ViewChild,\n    ElementRef,\n    EventEmitter,\n    OnChanges,\n    SimpleChanges,\n} from '@angular/core';\nimport { formatDuration } from 'date-fns';\n\nimport { BaseClass } from '@placeos/common';\n\nimport { ITimelineEventGroup } from '../event-timeline/event-timeline.component';\n\nimport * as dayjs from 'dayjs';\n\n@Component({\n    selector: 'vertical-timeline',\n    templateUrl: './vertical-timeline.component.html',\n    styleUrls: ['./vertical-timeline.component.scss'],\n})\nexport class VerticalTimelineComponent extends BaseClass implements OnInit, OnChanges {\n    /** Active date */\n    @Input() public date: number;\n    /** Active duration */\n    @Input() public duration: number;\n    /** Groups and events */\n    @Input() public groups: ITimelineEventGroup[];\n    /** Blocks */\n    public blocks: any[];\n    /** Element to move */\n    public active_move: string;\n    /** Active start date */\n    public active_start: number;\n    /** Active duration */\n    public active_length: number;\n    /** Offset of time box */\n    public offset = { x: 0, y: 0 };\n\n    /** Output emitter */\n    @Output() public dateChange = new EventEmitter<number>();\n    @Output() public durationChange = new EventEmitter<number>();\n    @Output() public groupsChange = new EventEmitter<ITimelineEventGroup[]>();\n\n    @ViewChild('block') private block: ElementRef;\n    @ViewChild('time') private time: ElementRef;\n\n    public ngOnInit(): void {\n        this.generateBlocks();\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.groups) {\n            this.checkInUseBlocks();\n        }\n        if (changes.date || changes.duration) {\n            this.updateStartEnd();\n        }\n    }\n\n    /** Timeline start */\n    public get timeline_start() {\n        return dayjs(this.date).startOf('d');\n    }\n\n    /** Timeline end */\n    public get timeline_end() {\n        return dayjs(this.date).endOf('d');\n    }\n\n    public generateBlocks() {\n        this.blocks = [];\n        const start = this.timeline_start;\n        const end = this.timeline_end;\n        const now = dayjs();\n        for (let time = start; time.isBefore(end, 'm'); time = time.add(5, 'm')) {\n            this.blocks.push({\n                id: time.format('HH:mm'),\n                display: time.format('HH:mm'),\n                hour: time.minute() === 0,\n                show: time.minute() % 30 === 0,\n                disabled: time.isBefore(now, 'm'),\n            });\n        }\n        this.checkInUseBlocks();\n    }\n\n    public get display(): string {\n        const date = dayjs(this.date);\n        const end = dayjs(this.date).add(this.duration, 'm');\n        const duration = formatDuration({ minutes: this.duration });\n        return `${date.format('hh:mm A')} - ${end.format('hh:mm A')} (${duration})`;\n    }\n\n    public move(e) {\n        this.timeout(\n            'move',\n            () => {\n                if (this.active_move && this.block) {\n                    const center = {\n                        x:\n                            e.touches && e.touches.length > 0\n                                ? e.touches[0].clientX || e.clientX\n                                : e.clientX,\n                        y:\n                            e.touches && e.touches.length > 0\n                                ? e.touches[0].clientY || e.clientY\n                                : e.clientY,\n                    };\n                    const off = this.active_move === 'bottom' ? { x: 0, y: 0 } : this.offset;\n                    const content_box = this.block.nativeElement.getBoundingClientRect();\n                    const percent_w = (center.x - off.x - content_box.left) / content_box.width;\n                    const percent_h = (center.y - off.y - content_box.top) / content_box.height;\n                    const percent = percent_h;\n\n                    const start_time =\n                        this.timeline_start.hour() + this.timeline_start.minute() / 60;\n                    const end_time = this.timeline_end.hour() + this.timeline_end.minute() / 60;\n                    const diff_time = end_time - start_time;\n                    const block_size = 15;\n                    const hour =\n                        Math.ceil((diff_time * percent + start_time) * (60 / block_size)) /\n                        (60 / block_size);\n                    if (this.active_move === 'bottom') {\n                        let date = dayjs(this.date);\n                        const end = dayjs(this.date)\n                            .hour(Math.floor(hour))\n                            .minute(Math.floor((hour * 60) % 60));\n                        if (end.isSame(date, 'm') || end.isBefore(date, 'm')) {\n                            date = dayjs(end).add(-this.duration, 'm');\n                            this.date = date.valueOf();\n                        } else {\n                            const duration = Math.floor(end.diff(date, 'm'));\n                            this.duration = Math.max(60, duration || block_size);\n                            this.durationChange.emit(this.duration);\n                        }\n                    } else if (this.active_move === 'top') {\n                        const date = dayjs(this.date)\n                            .hour(Math.floor(hour))\n                            .minute(Math.floor((hour * 60) % 60));\n                        this.date = date.valueOf();\n                    }\n                    this.dateChange.emit(this.date);\n                    this.updateStartEnd();\n                }\n            },\n            10\n        );\n    }\n\n    // public setOffset(e) {\n    // if (this.time) {\n    //     const box = this.time.nativeElement.getBoundingClientRect();\n    //     this.offset = { x: e.center.x - box.left, y: e.center.y - box.top };\n    // }\n    // }\n\n    public setMove(move: string) {\n        this.active_move = move;\n    }\n\n    public checkInUseBlocks() {\n        if (!this.blocks || !this.groups) {\n            return;\n        }\n        const blocks = this.blocks.map((i) => ({\n            ...i,\n            unavailable: false,\n        }));\n        for (const grp of this.groups) {\n            for (const event of grp.events || []) {\n                const start = this.hoursToDate(event.start);\n                const end = dayjs(start).add(event.duration, 'm');\n                for (let time = dayjs(start); time.isBefore(end); time = time.add(5, 'm')) {\n                    const display = time.format('HH:mm');\n                    const blk = blocks.find((i) => i.id === display);\n                    if (blk) {\n                        blk.unavailable = true;\n                    }\n                }\n            }\n        }\n        this.blocks = blocks;\n    }\n\n    public hoursToDate(time: number) {\n        let t = dayjs()\n            .startOf('d')\n            .hour(Math.floor(time))\n            .minute(Math.floor((time * 60) % 60));\n        t = t.minute(Math.floor(t.minute() / 5) * 5);\n        return t;\n    }\n\n    public updateStartEnd() {\n        this.updatePeriod();\n    }\n\n    public resetMove() {\n        this.active_move = '';\n    }\n\n    public updatePeriod() {\n        const start = dayjs(this.date).startOf('m');\n        const period = this.timeline_end.diff(this.timeline_start, 'm') / 60;\n        this.active_start = start.diff(this.timeline_start, 'm') / 60 / period;\n        this.active_length = this.duration / 60 / period;\n    }\n}\n","import { HashMap, predictableRandomInt } from '@placeos/common';\nimport { addMinutes, differenceInMinutes } from 'date-fns';\n\nexport const MOCK_MENU = [\n    {\n        id: 'item-1',\n        name: 'Coffee',\n        unit_price: 200,\n        category: 'Drinks',\n        options: [\n            { id: 'opt-1', name: 'Cappacino', group: 'type' },\n            { id: 'opt-2', name: 'Latte', group: 'type' },\n            { id: 'opt-1', name: '1 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-1', name: '2 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-1', name: '3 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-1', name: '4 Sugar', group: 'sugars', unit_price: 20 },\n        ],\n    },\n    {\n        id: 'item-1',\n        name: 'Soda',\n        unit_price: 160,\n        category: 'Drinks',\n        options: [\n            { id: 'opt-1', name: 'Pepsi', group: 'type' },\n            { id: 'opt-2', name: 'Sunkist', group: 'type' },\n            { id: 'opt-3', name: 'Solo', group: 'type' },\n            { id: 'opt-4', name: 'Dr Pepper', group: 'type' },\n        ],\n    },\n    { id: 'item-1', name: 'Water', unit_price: 100, category: 'Drinks' },\n    {\n        id: 'item-1',\n        name: 'Muffin',\n        unit_price: 160,\n        category: 'Snacks',\n        options: [\n            { id: 'opt-1', name: 'Choc Chip', group: 'type' },\n            { id: 'opt-2', name: 'Banana', group: 'type' },\n            { id: 'opt-3', name: 'Blueberry', group: 'type' },\n        ],\n    },\n    {\n        id: 'item-1',\n        name: 'Cookies',\n        unit_price: 400,\n        category: 'Snacks',\n        options: [\n            { id: 'opt-1', name: 'Choc Chip', group: 'type' },\n            { id: 'opt-2', name: 'Macadamia', group: 'type' },\n            { id: 'opt-3', name: 'Dark Choc', group: 'type' },\n        ],\n    },\n    {\n        id: 'item-1',\n        name: 'Fish & Chips',\n        unit_price: 250,\n        category: 'Simple Meals',\n        options: [\n            {\n                id: 'opt-1',\n                name: 'Tomato Sauce',\n                group: 'sauce',\n                unit_price: 30,\n            },\n            { id: 'opt-2', name: 'BBQ Sauce', group: 'sauce', unit_price: 35 },\n            {\n                id: 'opt-3',\n                name: 'Tartare Sause',\n                group: 'sauce',\n                unit_price: 40,\n            },\n            {\n                id: 'opt-4',\n                name: 'Garlic Aoili Sauce',\n                group: 'sauce',\n                unit_price: 50,\n            },\n        ],\n    },\n    {\n        id: 'item-1',\n        name: 'Sandwich',\n        unit_price: 300,\n        category: 'Simple Meals',\n        options: [\n            { id: 'opt-1', name: 'Ham & Cheese', group: 'type' },\n            { id: 'opt-2', name: 'Chicken', group: 'type' },\n            { id: 'opt-3', name: 'Fairy Bread', group: 'type' },\n        ],\n    },\n];\n\nexport function generateCateringOrder(event: HashMap) {\n    const duration = differenceInMinutes(event.event_start, event.event_end);\n    const mx = predictableRandomInt(MOCK_MENU.length);\n    return {\n        id: `order-${predictableRandomInt(999_999)}`,\n        event_id: event.id,\n        invoice_number: `I${predictableRandomInt(999_999)}`,\n        charge_code: `C${predictableRandomInt(9_999)}`,\n        deliver_at: addMinutes(\n            event.event_start * 1000,\n            predictableRandomInt(Math.floor(duration / 5)) * 5\n        ),\n        items: new Array(3).fill(0).map((_, idx) => ({\n            ...MOCK_MENU[(mx * idx) % MOCK_MENU.length],\n            options: [],\n            quantity: predictableRandomInt(10, 1),\n        })),\n    };\n}\n","export const MOCK_ORGS = [\n    {\n        created_at: 1587057070,\n        updated_at: 1587692680,\n        name: 'PlaceOS',\n        description: '',\n        tags: 'org',\n        count: 0,\n        capacity: 0,\n        parent_id: '',\n        triggers: [],\n        id: 'zone-EmWFTjuYExK',\n    },\n];\n\nexport const MOCK_BUILDINGS = [\n    {\n        name: 'Sydney',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-01',\n        levels: ['lvl-10', 'lvl-11'],\n    },\n    {\n        name: 'Brisbane',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-02',\n        levels: ['lvl-2', 'lvl-3'],\n    },\n];\n\nconst mockLevel = (\n    id: string,\n    idx: number,\n    building: any,\n    num: number = 10\n): any => {\n    let map_id = id.substr(4);\n    map_id = `assets/maps/level_${num}.svg`;\n    return {\n        id: `${building.id}_${id}`,\n        name: `Level ${id.endsWith('00') ? 'G' : id.split('-')[1]}`,\n        parent_id: building.id,\n        description: '',\n        tags: 'level',\n        map_id,\n        code: 'level code 12',\n        type: 'staff floor',\n        count: 5,\n        capacity: 30,\n        location: 'optional lat,long',\n        display_name: '',\n    };\n};\n\nexport const MOCK_LEVELS = MOCK_BUILDINGS.map((bld) =>\n    bld.levels.map((level, idx) =>\n        mockLevel(level, idx, bld, +level.split('-')[1])\n    )\n).reduce((p, c) => p.concat(c), []);\n","import { predictableRandomInt } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_MENU } from './catering.data';\nimport { MOCK_ORGS, MOCK_LEVELS, MOCK_BUILDINGS } from './zone.data';\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/zones',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.query_params.tags === 'org') {\n            return MOCK_ORGS;\n        } else if (request.query_params.tags === 'building') {\n            return MOCK_BUILDINGS;\n        } else if (request.query_params.tags === 'level') {\n            return MOCK_LEVELS;\n        }\n        throw { status: 404, message: 'Zones not found' };\n    },\n});\n\nfunction padString(str: string | number, length: number = 5) {\n    str = `${str}`;\n    while (str.length < length) str = `0${str}`;\n    return str;\n}\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/metadata/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.query_params.name === 'bindings') {\n            return {\n                bindings: {\n                    details: {\n                        area_management: 'space-0',\n                        location_services: 'space-0',\n                    },\n                },\n            };\n        }\n        if (request.query_params.name === 'catering') {\n            return {\n                catering: {\n                    details: MOCK_MENU,\n                },\n            };\n        }\n        if (request.query_params.name === 'desks') {\n            const parts = request.route_params.id.split('-');\n            const id = parts[parts.length - 1];\n            return generateMockDeskMetadata(id);\n        }\n        return {};\n    },\n});\n\nconst DESK_FEATURES = ['sit_to_stand', 'single_monitor', 'dual_monitor'];\n\nfunction generateMockDeskMetadata(id: string) {\n    return {\n        desks: {\n            details: new Array(30).fill(0).map((_, idx) => ({\n                id: `table-${padString(id, 2)}.${padString(idx + 1, 3)}`,\n                name: `Desk ${id}.${padString(idx + 1, 3)}`,\n                bookable: predictableRandomInt(9999) % 4 !== 0,\n                group: '',\n                features: DESK_FEATURES.filter(\n                    (_) => predictableRandomInt(99999) % 3 === 0\n                ),\n            })),\n        },\n    };\n}\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/metadata/:id/children',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        const zone = MOCK_BUILDINGS.find(\n            (_) => _.id === request.route_params.id\n        );\n        if (!zone)\n            throw {\n                status: 404,\n                message: `Unable to find zone with id \"${request.route_params.id}\"`,\n            };\n        return MOCK_LEVELS.filter((_) => _.parent_id === zone.id).map((lvl) => {\n            const parts = lvl.id.split('-');\n            const id = parts[parts.length - 1];\n            return {\n                zone: lvl,\n                metadata: generateMockDeskMetadata(id),\n            };\n        });\n    },\n});\n","/** Domain of the organisation */\nexport const DOMAIN = 'place.tech';\n/** Endpoint where the staff API is located */\nexport const API = '/api/staff/v1';\n","import { predictableRandomInt } from '@placeos/common';\nimport { DOMAIN } from './common.mock';\n\nconst PREDEF_USERS = [\n    'Jonathan McFarlane',\n    'Alex Sorafumo',\n    'Jim Doe',\n    'Cristina Boston',\n    'Jeremy West',\n    'Alexandre Chuvand',\n    'Viv Briffa',\n    'Candy Russo',\n    'Jeff Wiz',\n    'Sravani Kotha',\n    'Kim Burgess',\n    'Landell Archer',\n    'Caspian Baska',\n    'Stephen Von Takach',\n    'Cameron Reeves',\n    'Shane Boseley',\n];\n\nexport const ACTIVE_USER = {\n    id: 'current',\n    name: 'PlaceOS - Mock User',\n    email: 'dev@place.tech',\n    groups: ['deals', ''],\n};\n\nexport const MOCK_STAFF = PREDEF_USERS.map((name, i) => ({\n    id: `user-${i + 1}`,\n    name: `${name} (PlaceOS)`,\n    email: `${name.split(' ').join('.').toLowerCase()}@${DOMAIN}`,\n})).concat([ACTIVE_USER]);\n\nexport const MOCK_GUESTS = PREDEF_USERS.map((name, i) => ({\n    id: `guest-${i + 1}`,\n    name: `${name} (External)`,\n    email: `${name.split(' ').join('.').toLowerCase()}@not-${DOMAIN}`,\n    visit_expected: predictableRandomInt(99999) % 2 === 0,\n}));\n","import { predictableRandomInt } from '@placeos/common';\nimport { generateMockSpace } from '@placeos/spaces';\n\nconst randomSpaceFeatures = () => {\n    const f = ['Whiteboard', 'VidConf', 'Projector', 'Views'];\n    const numFeatures = predictableRandomInt(f.length + 1);\n    const res = [];\n    for (let i = 0; i < numFeatures; i++) {\n        res.push(f[predictableRandomInt(f.length)]);\n    }\n    return res.filter((el, i, r) => r.indexOf(el) === i);\n};\n\nexport const MOCK_SPACES = [\n    {\n        name: 'Conference Room 10.01',\n        map_id: 'area-10.01-status',\n        zones: ['bld-01', 'bld-01_lvl-10'],\n    },\n    {\n        name: 'Conference Room 10.02',\n        map_id: 'area-10.02-status',\n        zones: ['bld-01', 'bld-01_lvl-10'],\n    },\n    {\n        name: 'Conference Room 10.03',\n        map_id: 'area-10.03-status',\n        zones: ['bld-01', 'bld-01_lvl-10'],\n    },\n    {\n        name: 'Conference Room 11.01',\n        map_id: 'area-11.01-status',\n        zones: ['bld-01', 'bld-01_lvl-11'],\n    },\n    {\n        name: 'Conference Room 11.02',\n        map_id: 'area-11.02-status',\n        zones: ['bld-01', 'bld-01_lvl-11'],\n    },\n    {\n        name: 'Conference Room 11.03',\n        map_id: 'area-11.03-status',\n        zones: ['bld-01', 'bld-01_lvl-11'],\n    },\n    {\n        name: 'Conference Room 2.01',\n        map_id: 'area-2.01-status',\n        zones: ['bld-02', 'bld-02_lvl-2'],\n    },\n    {\n        name: 'Conference Room 2.02',\n        map_id: 'area-2.02-status',\n        zones: ['bld-02', 'bld-02_lvl-2'],\n    },\n    {\n        name: 'Conference Room 3.01',\n        map_id: 'area-3.01-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n    {\n        name: 'Conference Room 3.02',\n        map_id: 'area-3.02-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n    {\n        name: 'Conference Room 3.03',\n        map_id: 'area-3.03-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n].map((d) => generateMockSpace({ ...d, features: randomSpaceFeatures() }));\n","import { predictableRandomInt, unique } from '@placeos/common';\nimport * as dayjs from 'dayjs';\nimport { generateCateringOrder } from './catering.data';\nimport { MOCK_SPACES } from './spaces.data';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\n\nlet EVENT_TIME = dayjs().startOf('d').hour(7);\n\nconst nextEventTime = (save = false): number => {\n    const next = EVENT_TIME.add((predictableRandomInt(8) + 1) * 15, 'm');\n    if (save) {\n        EVENT_TIME = next;\n    }\n    return next.unix();\n};\n\nconst event_status = ['tentative', 'confirmed', 'cancelled'];\nconst randomStatus = (): string => {\n    const rnd = predictableRandomInt(10);\n    return rnd < 2\n        ? event_status[2]\n        : rnd < 5\n        ? event_status[0]\n        : event_status[1];\n};\n\nexport const MOCK_EVENTS = new Array(200).fill(0).map((_, index) => {\n    const PEOPLE = MOCK_STAFF.concat(MOCK_GUESTS);\n    let attendees: any[] = new Array(predictableRandomInt(8, 1))\n        .fill(0)\n        .map(() => PEOPLE[predictableRandomInt(PEOPLE.length)]);\n    attendees.sort(\n        (a, b) => (a.visit_expected ? 0 : -1) - (b.visit_expected ? 0 : -1)\n    );\n    const space = MOCK_SPACES[predictableRandomInt(MOCK_SPACES.length)];\n    attendees = attendees.concat({ ...space, resource: true });\n    if (predictableRandomInt(9999) % 2 === 0) attendees.unshift(ACTIVE_USER);\n    else attendees.unshift(MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)]);\n    attendees = unique(attendees, 'email');\n    const event_start = nextEventTime(true);\n    const event_end = nextEventTime();\n    return {\n        id: `cal-event-${index}`,\n        status: randomStatus(),\n        host: attendees[0].email,\n        calendar: 'calendar_id',\n        creator: 'optional@fake.com',\n        attendees: unique(attendees, 'email').map((_) => ({\n            ..._,\n            response_status:\n                predictableRandomInt(99999) % 2 === 0\n                    ? 'accepted'\n                    : predictableRandomInt(99999) % 6 === 0\n                    ? 'declined'\n                    : 'tentative',\n        })),\n        title: `Some Meeting ${index}`,\n        body: `A Description`,\n        private: false,\n        event_start,\n        event_end,\n        timezone: 'Australia/Sydney',\n        all_day: false,\n        location: `${space.name}`,\n        recurring: false,\n        recurrence: {},\n        attachments: {},\n        system: space,\n        extension_data: {\n            catering:\n                predictableRandomInt(99999) % 4 === 0\n                    ? [\n                          generateCateringOrder({\n                              id: `cal-event-${index}`,\n                              event_start,\n                              event_end,\n                          }),\n                      ]\n                    : [],\n            setup: predictableRandomInt(4) * 5,\n            breakdown: predictableRandomInt(4) * 5,\n        },\n    };\n});\n\nconst event_spaces = {};\nMOCK_EVENTS.forEach((event) => {\n    if (!event_spaces[event.system.id]) {\n        event_spaces[event.system.id] = [];\n    }\n    event_spaces[event.system.id].push(event);\n});\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\nimport { MOCK_LEVELS } from './zone.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport * as dayjs from 'dayjs';\nimport { MOCK_EVENTS } from './events.data';\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/users/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.route_params.id === 'current') {\n            return ACTIVE_USER;\n        }\n        const person = MOCK_STAFF.find(user => user.email === request.route_params.id);\n        if (person) {\n            return person;\n        }\n        throw { status: 404, message: 'User not found' };\n    },\n});\n\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/people',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.query_params.q) {\n            const search = request.query_params.q.toLowerCase();\n            return MOCK_STAFF.filter(\n                (user) =>\n                    user.name.toLowerCase().includes(search) ||\n                    user.email.toLowerCase().includes(search)\n            );\n        }\n        return MOCK_STAFF;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/people/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        const id = decodeURIComponent(request.route_params.id);\n        const person = MOCK_STAFF.find(user => user.email === id);\n        if (person) {\n            return {\n                ...person,\n                location: generateLocation()\n            };\n        }\n        throw { status: 404, message: 'User not found' };\n    },\n});\n\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/guests',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.query_params.q) {\n            const search = request.query_params.q.toLowerCase();\n            return MOCK_GUESTS.filter(\n                (user) =>\n                    user.name.toLowerCase().includes(search) ||\n                    user.email.toLowerCase().includes(search)\n            );\n        }\n        return MOCK_STAFF;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/guests/:email',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        const person = MOCK_GUESTS.find(user => user.email === request.route_params.email);\n        if (person) {\n            return person;\n        }\n        throw { status: 404, message: 'Guest not found' };\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/guests/:email/meetings',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        if (request.route_params.email) {\n            const email = request.route_params.email.toLowerCase();\n            const events = MOCK_EVENTS.filter(\n                (event) => event.attendees.find(user => user.email.toLowerCase() === email)\n            );\n            return events;\n        }\n        throw { status: 404, message: `Unable to find meetings with guest with email ${request.route_params.email}` };\n    },\n});\n\n\n\nconst LOCATION_TYPES = ['meeting', 'desk_id', 'laptop', 'mobile', 'geo', 'none'];\n\nfunction generateLocation() {\n    const type = LOCATION_TYPES[predictableRandomInt(LOCATION_TYPES.length)];\n    const level = MOCK_LEVELS[predictableRandomInt(MOCK_LEVELS.length)];\n    const level_spaces = MOCK_SPACES.filter(s => s.zones.includes(level.id));\n    const space = level_spaces[predictableRandomInt(level_spaces.length)] || {};\n    const location: HashMap = {};\n    switch (type) {\n        case 'meeting':\n            location.meeting = {\n                building: level.parent_id,\n                level: level.id,\n                system: space.id,\n                map_id: space.map_id,\n                event_id: ''\n            };\n            break;\n        case 'desk_id':\n            location.meeting = {\n                building: level.parent_id,\n                level: level.id,\n                map_id: space.map_id,\n                checked_in: dayjs().unix()\n            };\n            break;\n        case 'laptop':\n        case 'mobile':\n            location[type] = {\n                building: level.parent_id,\n                level: level.id,\n                x: +predictableRandomInt(10000),\n                y: +predictableRandomInt(5000),\n                last_seen: dayjs().subtract(predictableRandomInt(60), 'm').unix()\n            };\n            break;\n        case 'geo':\n            location.geo = {\n                lat: predictableRandomInt(180) - 90,\n                lon: predictableRandomInt(360) - 180,\n                last_seen: dayjs().subtract(predictableRandomInt(60), 'm').unix()\n            };\n            break;\n    }\n    return location;\n}\n","import { HashMap, unique } from '@placeos/common';\n\nexport interface EnvironmentSource {\n    id?: string;\n    name: string;\n    type?: 'lights' | 'blinds' | 'screen';\n    state: string | number;\n    states: string[];\n}\n\nexport interface RoomInput {\n    id?: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    locked: boolean;\n    routes: string[];\n    outputs: string[];\n}\n\nexport interface RoomOutput {\n    id?: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    locked: boolean;\n    source: string;\n    inputs: string[];\n    following: string;\n}\n\nclass RoomModule {\n    public readonly name: string;\n    public readonly connected: boolean;\n    public active: boolean;\n\n    public readonly input_list: HashMap<RoomInput>;\n    public readonly output_list: HashMap<RoomOutput>;\n    public readonly env_sources: EnvironmentSource[];\n\n    public readonly inputs;\n    public readonly outputs;\n    public readonly environment;\n\n    public volume = 0;\n\n    constructor(_data: Partial<RoomModule>) {\n        this.name = _data.name || 'Test Module';\n        this.connected = _data.connected ?? true;\n        this.active = _data.active || false;\n        this.input_list = _data.input_list;\n        this.output_list = _data.output_list;\n        this.env_sources = _data.env_sources || [];\n        this.inputs = Object.keys(this.input_list || {}) || [];\n        this.outputs = Object.keys(this.output_list || {}) || [];\n        const types = unique(this.env_sources.map((_) => _.type));\n        types.forEach(\n            (t) =>\n                (this[`${t}`] = this.env_sources\n                    .filter((_) => _.type === t)\n                    .map((_) => _.id))\n        );\n        this.env_sources.forEach(\n            (source) => (this[`${source.type}/${source.id}`] = source)\n        );\n        this.inputs.forEach(\n            (key) => (this[`input/${key}`] = this.input_list[key])\n        );\n        this.outputs.forEach(\n            (key) => (this[`output/${key}`] = this.output_list[key])\n        );\n    }\n\n    $powerup() {\n        console.log('Power On');\n        this.active = true;\n    }\n    /**\n     * Power off the space. End any active calls, disconnect signal routes, place\n     * powerable devices into standby and return environmental configuration to\n     * sensible defaults.\n     **/\n    $shutdown() {\n        this.active = false;\n    }\n    /** Shares a signal source with the room and any connected remote participants. */\n    $share() {}\n    /**\n     * Connect a signal source to a signal output, or set of outputs. Any intermediate\n     * device interactions are handled internally. For example, on a system using a small\n     * presentation switcher and a display, routing a laptop input will select the\n     * appropriate input on the switcher, and select the appropriate input on the display.\n     *\n     * This includes all routable signal types - in addition to the above example, this may\n     * be interacting with an audio DSP to add a microphone feed to an output zone, or\n     * connecting a USB HID input device with a specific output.\n     **/\n    $route(input: string, output: string) {\n        if (this.inputs.includes(input) && this.outputs.includes(output)) {\n            this.$updateState(input, {\n                routes: unique([\n                    ...(this.input_list[input].routes || []),\n                    output,\n                ]),\n            });\n            this.$updateState(output, {\n                source: input,\n                following: input,\n            });\n        }\n    }\n    /**\n     * Remove a signal source from a signal output.\n     * Predominantly intended for outputs that support more than one simultaneous input source\n     * (mixed audio zone, or display capable of compositing multiple video sources).\n     **/\n    $unroute() {}\n    /**\n     * Establish a call (either phone or video) with a remote participant.\n     * This may be a peer-to-peer connection or a wider group via an external bridging service.\n     **/\n    $connect() {}\n    /** End a call with a remote participant. */\n    $disconnect() {}\n    /**\n     * Bind the current system to another PlaceOS controlled space, relinquishing local control.\n     * This may be used for an education pod that pairs with a wider classroom or a room being\n     * used as an overflow from a primary event space.\n     **/\n    $link() {}\n    /**\n     * Join the current system with another PlaceOS controlled space, sharing control and signal IO.\n     * Examples of usage would be a set of rooms with moveable walls. N-way merges supported.\n     **/\n    $merge() {}\n    /** Separate from a linked or merged system. */\n    $split() {}\n    /**\n     * Display an alert visible to participants in the space. This may occur as a screen overlay,\n     * on a control interface, a bot post in a chat space associated with the current meeting or\n     * other modalities depending on hardware capability.\n     **/\n    $notify() {}\n    /**\n     * Place the room into a predefined operation mode. This may include executing an arbitrary\n     * set of device interactions, changing metadata associated with the system itself (changing\n     * available input or output nodes), or other configurable actions designed to transition\n     * the space to a specific state.\n     **/\n    $preset() {}\n    /**\n     * Set the volume for a signal node in the space. This can include outputs as well as inputs\n     * where supported (e.g. microphone). If unspecified, default is to interact with a primary\n     * output node.\n     **/\n    $volume(value: number, source: string = 'all') {\n        if (source === 'all') {\n            this.volume = value;\n        }\n    }\n    /** Interact with audio muting on supporting signal nodes within the space. */\n    $mute(state: boolean = true, source: string = 'all') {\n        this.$updateState(source, { mute: state });\n    }\n    /**\n     * Activates or deactivates a signal mute for the associated IO. If this is not possible,\n     * (e.g. unsupported by the device) an error is returned.\n     **/\n    $unmute(source: string = 'all') {\n        this.$mute(false, source);\n    }\n    /**\n     * Wrapper for an arbitrary set of control points defined in system configuration.\n     * Each of these may map to control options available on a sibling module and take one of two forms:\n     *  - Continuous value within a range (temperature set point 16.0...28.0 degrees, lighting level 0...100)\n     *  - Set of possible states (lighting high/med/low, blind up/down, electrochromic glass clear/opaque)\n     *\n     * System state provides the ability to introspect configured points for both control limits and current value.\n     **/\n    $environment(id: string, state: string | number) {\n        const source = this.env_sources.find((_) => _.id === id);\n        if (source) {\n            this[`${source.type}/${source.id}`] = { ...source, state };\n        }\n    }\n    /** Locks an IO node. Prevents any route changes that include this until unlocked. */\n    $lock(source: string) {\n        this.$updateState(source, { locked: true });\n    }\n    /** Unlocks an IO node. */\n    $unlock(source: string) {\n        this.$updateState(source, { locked: false });\n    }\n\n    $updateState(source: string, data: HashMap) {\n        if (this[`input/${source}`]) {\n            this[`input/${source}`] = { ...this[`input/${source}`], ...data };\n            this.input_list[source] = { ...this[`input/${source}`], ...data };\n        } else if (this[`output/${source}`]) {\n            this[`output/${source}`] = { ...this[`output/${source}`], ...data };\n            this.output_list[source] = { ...this[`output/${source}`], ...data };\n        }\n    }\n}\n\nconst input_list: HashMap = {\n    Mic1: {\n        name: 'Lectern Mic',\n        type: 'Microphone',\n        mod: 'Microphone_1',\n    },\n    Mic2: {\n        name: 'Lapel Mic',\n        type: 'Microphone',\n        mod: 'Microphone_2',\n    },\n    Mic3: {\n        name: 'Handheld Mic',\n        type: 'Microphone',\n        mod: 'Microphone_3',\n    },\n    PC1: {\n        name: 'PC-1',\n        type: 'PC',\n    },\n    PC2: {\n        name: 'PC-2',\n        type: 'PC',\n    },\n    PC3: {\n        name: 'PC-3',\n        type: 'PC',\n    },\n    PC4: {\n        name: 'PC-4',\n        type: 'PC',\n    },\n    HDMI: {\n        name: 'Laptop HDMI',\n        type: 'Laptop',\n    },\n    VGA: {\n        name: 'Laptop VGA',\n        type: 'Laptop',\n    },\n    Camera1: {\n        name: 'Camera Rear',\n        type: 'Camera',\n        mod: 'Camera_1',\n    },\n    Camera2: {\n        name: 'Camera Front',\n        type: 'Camera',\n        mod: 'Camera_2',\n    },\n    Camera3: {\n        name: 'Camera Rear 2',\n        type: 'Camera',\n        mod: 'Camera_3',\n    },\n    Camera4: {\n        name: 'Camera Front 2',\n        type: 'Camera',\n        mod: 'Camera_4',\n    },\n    TV1: {\n        name: 'IPTV 1',\n        type: 'TV',\n        mod: 'IPTV_1',\n    },\n};\n\nconst output_list: HashMap = {\n    Display1: {\n        name: 'Display 1',\n        type: 'Display',\n        source: 'PC1',\n        mod: 'Display_1',\n    },\n    Display2: {\n        name: 'Display 2',\n        type: 'Display',\n        mod: 'Display_2',\n    },\n    Display3: {\n        name: 'Display 3',\n        type: 'Display',\n        source: 'PC2',\n        mod: 'Display_3',\n    },\n    Display4: {\n        name: 'Display 4',\n        type: 'Display',\n        mod: 'Display_4',\n    },\n    Display5: {\n        name: 'Display 5',\n        type: 'Display',\n        mod: 'Display_5',\n        source: 'TV1',\n    },\n};\n\nconst env_sources: any[] = [\n    {\n        id: 'light1',\n        name: 'Lighting',\n        type: 'lights',\n        states: ['Off', 'Presentation', 'Meeting', 'Full'],\n        state: 'Off',\n    },\n    {\n        id: 'blind1',\n        name: 'Blinds',\n        type: 'blinds',\n        states: ['Off', 'Presentation', 'Meeting'],\n        state: 'Off',\n    },\n    {\n        id: 'screen1',\n        name: 'Screen',\n        type: 'screen',\n        states: ['Up', 'Down'],\n        state: 'Down',\n    },\n];\n\nexport const createSystemModule = (space: HashMap, overrides: HashMap = {}) =>\n    new RoomModule({\n        ...space,\n        input_list,\n        output_list,\n        env_sources,\n        ...overrides,\n    });\n","import { addSeconds, isBefore, subSeconds } from 'date-fns';\n\nimport { HashMap, timePeriodsIntersect } from '@placeos/common';\nimport { MOCK_EVENTS } from '../api/events.data';\n\nexport class MockBookingModule {\n    /** Timezone the associated space resided */\n    time_zone = 'Australia/Sydney';\n    /** Whether booking is disabled */\n    disable_book_now = false;\n    /** Whether ending current meeting is disabled */\n    disable_end_meeting = false;\n    /** List of current and upcoming bookings for space */\n    bookings: HashMap[] = [];\n    pending_period = 0;\n    pending_before = 0;\n    /** Control UI associated with the space */\n    control_ui = '';\n    /** Catering UI associated with the space */\n    catering_ui = '';\n    /** Time of the last booking started by a user */\n    last_booking_started = 0;\n    /** Current status of the space */\n    status: 'pending' | 'busy' | 'free' | 'not-bookable' = 'free';\n}\n\nexport function createBookingsModule(\n    space: HashMap,\n    overrides: Partial<MockBookingModule> = {}\n) {\n    const mod = {\n        ...new MockBookingModule(),\n        ...overrides,\n        /** Start the meeting at the given time */\n        $start_meeting: function (t: number) {\n            this.last_booking_started = t;\n        },\n        /** End the meeting at the given time */\n        $end_meeting: function (t: number) {},\n        /** Book meeting for the current time */\n        $book_now: function (len: number, t?: string, o?: string) {},\n    };\n    updateBookings(space, mod);\n    setInterval(() => updateBookings(space, mod), 1000);\n    return mod;\n}\n\nfunction updateBookings(space: HashMap, mod: HashMap) {\n    const bookings =\n        MOCK_EVENTS.filter((event) =>\n            event.attendees?.find((u) => u.email === space.email)\n        ) || [];\n    bookings.sort((a, b) => a.event_start - b.event_start);\n    mod.bookings = bookings;\n    if (!space.bookable) {\n        return (mod.status = 'not-bookable');\n    }\n    const date = new Date();\n    const current = bookings.find((bkn) =>\n        timePeriodsIntersect(\n            date.valueOf(),\n            date.valueOf(),\n            bkn.event_start,\n            bkn.event_end\n        )\n    );\n    const next = bookings.find((bkn) =>\n        isBefore(date.valueOf(), bkn.event_start)\n    );\n    const start = new Date((current || next)?.event_start);\n    const pending = timePeriodsIntersect(\n        date,\n        date,\n        subSeconds(start, mod.pending_before),\n        addSeconds(start, mod.pending_period)\n    );\n    mod.status = current\n        ? pending\n            ? 'pending'\n            : 'busy'\n        : next && pending\n        ? 'pending'\n        : 'free';\n}\n","import { Md5 } from 'ts-md5';\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { MOCK_LEVELS } from '../api/zone.data';\nimport { MOCK_STAFF } from '../api/users.data';\n\nexport interface ZoneOverview {\n    /** Desk count based on `desks` metadata in the zone\n     falls back to the zone.count field otherwise */\n    desk_count: number;\n\n    desk_usage: number;\n    /** Capacity of the space, set in zone.capacity field */\n    device_capacity: number;\n    /** Raw device count */\n    device_count: number;\n    /** This is the adjusted count based on the duplication factor */\n    estimated_people: number;\n\n    percentage_use: number;\n    /** The higher the recommendation number the better for recommending */\n    recommendation: number;\n}\n\nexport class MockLocationServicesModule implements HashMap {\n    /** Overview of the zones */\n    overview: HashMap<ZoneOverview> = {};\n\n    $locate_user(email: string, username: string) {}\n}\n\nfunction padZero(no: number, len: number = 3) {\n    let str = `${no}`;\n    while (str.length < len) {\n        str = '0' + str;\n    }\n    return str;\n}\n\nexport function createLocationServicesModule(\n    space: HashMap,\n    overrides: HashMap = {}\n) {\n    const mod = new MockLocationServicesModule();\n    for (const lvl of MOCK_LEVELS) {\n        mod.overview[lvl.id] = {\n            desk_count: 100,\n            desk_usage: 0,\n            device_capacity: 100,\n            device_count: 0,\n            estimated_people: 0,\n            percentage_use: 0,\n            recommendation: 10000,\n        };\n        mod[`${lvl.id}:desk_ids`] = new Array(mod.overview[lvl.id].desk_count)\n            .fill(0)\n            .map((_, idx) => `table-${lvl.number}.${padZero(idx)}`);\n        mod[`${lvl.id}`] = { value: [] };\n    }\n    updateLocations(mod, MOCK_LEVELS);\n    setInterval(() => updateLocations(mod, MOCK_LEVELS), 60 * 1000);\n    return mod;\n}\n\nexport function updateLocations(\n    mod: MockLocationServicesModule,\n    levels: HashMap[]\n) {\n    for (const lvl of levels) {\n        mod[lvl.id] = {\n            value: new Array(predictableRandomInt(20))\n                .fill(0)\n                .map(() => generateLocation(lvl, mod[`${lvl.id}:desk_ids`])),\n        };\n    }\n}\n\nexport function generateLocation(\n    lvl: HashMap,\n    desks: string[],\n    users = MOCK_STAFF\n) {\n    const fixed = predictableRandomInt(9999) % 3 === 0;\n    return fixed\n        ? {\n              location: 'desk',\n              at_location: predictableRandomInt(9999) % 5 !== 0,\n              map_id: desks[predictableRandomInt(desks.length)],\n              mac: Md5.hashStr(\n                  users[predictableRandomInt(users.length)].email\n              ),\n              level: lvl.id,\n              building: lvl.parent_id,\n          }\n        : {\n              location: 'wireless',\n              coordinates_from: 'bottom-left',\n              x: predictableRandomInt(1000) / 10,\n              y: predictableRandomInt(1000) / 10,\n              lon: 55.27476066828535,\n              lat: 25.20106100633537,\n              s2_cell_id: '3e5f4281459c',\n              mac: Md5.hashStr(\n                  users[predictableRandomInt(users.length)].email\n              ),\n              variance: 9.62534032222287,\n              last_seen: Math.floor(new Date().valueOf() / 1000),\n              map_width: 100,\n              map_height: 100,\n          };\n}\n","import { HashMap } from '@placeos/common';\n\nexport enum CameraTilt {\n    Down,\n    Up,\n    Stop,\n}\n\nexport enum CameraPan {\n    Left,\n    Right,\n    Stop,\n}\n\nclass CameraModule {\n    pan: number;\n    tilt: number;\n    zoom: number;\n\n    pan_speed: number;\n    tilt_speed: number;\n    zoom_speed: number;\n\n    presets: string[];\n\n    constructor(_) {\n        this.presets = ['Preset One', 'Preset 2', 'Preset Three'];\n    }\n\n    $pan(dir: CameraPan) {}\n\n    $tilt(tilt: CameraTilt) {}\n\n    $recall(name: string) {}\n\n    $save_preset(name: string) {}\n}\n\nexport const createCameraModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CameraModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass DisplayModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createDisplayModule = (space: HashMap, overrides: HashMap = {}) =>\n    new DisplayModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass MicrophoneModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createMicrophoneModule = (\n    space: HashMap,\n    overrides: HashMap = {}\n) => new MicrophoneModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from \"@placeos/common\";\n\nlet interval;\n\nexport class CaptureModule {\n\n    status: 'playing' | 'stopped' | 'paused' = 'stopped';\n    title: string;\n    live: boolean = false;\n    remaining: number;\n    current: number;\n    next: number;\n\n    constructor(_) {\n        this.remaining = randomInt(24 * 60 * 60);\n    }\n\n    $start() {\n        this.status = 'playing';\n        interval = setInterval(() => {\n            if (this.remaining < 1) clearInterval(interval);\n            this.remaining = this.remaining - 1;\n            this.current = this.current + 1;\n        }, 3000);\n    }\n\n    $pause() {\n        this.status = 'paused';\n        clearInterval(interval);\n    }\n\n    $resume() {\n        this.$start();\n    }\n\n    $stop() {\n        this.status = 'stopped';\n        this.current = 0;\n        clearInterval(interval);\n    }\n\n}\n\nexport const createCaptureModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CaptureModule({ ...space, ...overrides });\n","\nimport { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { createSystem } from '../systems-bindings.mock';\nimport { MOCK_SPACES } from './spaces.data';\n\nMOCK_SPACES.forEach((space: any, index) => createSystem(space));\n\nregisterMockEndpoint({\n    path: '/api/engine/v2/systems',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        return MOCK_SPACES;\n    }\n});\n","import { registerSystem } from '@placeos/ts-client';\nimport { HashMap } from '@placeos/common';\n\nimport { createSystemModule } from './realtime/control';\nimport { createBookingsModule } from './realtime/events';\nimport { createLocationServicesModule } from './realtime/desks';\nimport { createCameraModule } from './realtime/camera';\nimport { createDisplayModule } from './realtime/display';\nimport { createMicrophoneModule } from './realtime/microphone';\nimport { createCaptureModule } from './realtime/capture';\n\nexport function createSystem(space: HashMap) {\n    registerSystem(space.id, {\n        System: [createSystemModule(space)],\n        Bookings: [createBookingsModule(space)],\n        AreaManagement: [createLocationServicesModule(space)],\n        Camera: new Array(10).fill(0).map(_ => createCameraModule(space)),\n        Display: new Array(10).fill(0).map(_ => createDisplayModule(space)),\n        Microphone: new Array(10).fill(0).map(_ => createMicrophoneModule(space)),\n        Capture: [createCaptureModule(space)]\n    });\n}\n","import { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_EVENTS } from './events.data';\nimport { ACTIVE_USER, MOCK_STAFF } from './users.data';\n\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events',\n    metadata: {},\n    method: 'GET',\n    callback: (_) => {\n        let events = MOCK_EVENTS;\n        if (!_.query_params.zone_ids) {\n            events = events.filter(\n                (event) =>\n                    !!event.attendees.find(\n                        (user) => user.email === ACTIVE_USER.email\n                    )\n            );\n        }\n        if (_.query_params.period_start) {\n            events = events.filter((e) =>\n                timePeriodsIntersect(\n                    _.query_params.period_start,\n                    _.query_params.period_end,\n                    e.event_start,\n                    e.event_end\n                )\n            );\n        }\n        return events;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events',\n    metadata: {},\n    method: 'POST',\n    callback: (request) => {\n        const new_event = {\n            ...request.body,\n            id: `-cal-event-${predictableRandomInt(999)}`,\n        };\n        new_event.attendees = [\n            MOCK_STAFF.find((_) => _.email === new_event.host),\n            ...(new_event.attendees || []),\n        ];\n        new_event.attendees.forEach((user) => {\n            if (user.zones) user.resource = true;\n        });\n\n        if (new_event.system) {\n            new_event.attendees = [\n                ...(new_event.attendees || []),\n                { ...new_event.system, resource: true },\n            ];\n        }\n        MOCK_EVENTS.push(new_event);\n        return new_event;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => {\n        const item = MOCK_EVENTS.find(\n            (event) => event.id === request.route_params.id\n        );\n        if (item) {\n            return item;\n        }\n        throw { status: 404, message: 'Event not found' };\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events/:id',\n    metadata: {},\n    method: 'DELETE',\n    callback: (request) => {\n        const index = MOCK_EVENTS.findIndex(\n            (event) => event.id === request.route_params.id\n        );\n        if (index > 0) {\n            if (MOCK_EVENTS[index].host === ACTIVE_USER.email) {\n                MOCK_EVENTS.splice(index, 1);\n            } else {\n                const user = MOCK_EVENTS[index].attendees.find((_) => _.email === ACTIVE_USER.email);\n                user.response_status = 'declined';\n            }\n            return;\n        }\n        throw { status: 404, message: 'Event not found' };\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events/:id',\n    metadata: {},\n    method: 'PATCH',\n    callback: (request) => {\n        const index = MOCK_EVENTS.findIndex(\n            (event) => event.id === request.route_params.id\n        );\n        if (index >= 0) {\n            return MOCK_EVENTS.splice(index, 1, request.body);\n        }\n        throw { status: 404, message: 'Event not found' };\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/events/:id/guests/:email/checkin',\n    metadata: {},\n    method: 'POST',\n    callback: (request) => {\n        const event = MOCK_EVENTS.find(\n            (event) => event.id === request.route_params.id\n        );\n        if (event) {\n            const checked_in = (event.extension_data as any).checked_in || [];\n            (event.extension_data as any).checked_in = checked_in.concat([\n                request.route_params.email,\n            ]);\n            return event;\n        }\n        throw { status: 404, message: 'Guest not found' };\n    },\n});\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_EVENTS } from './events.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport * as dayjs from 'dayjs';\nimport { timePeriodsIntersect } from '@placeos/common';\nregisterMockEndpoint({\n    path: '/api/staff/v1/calendars',\n    metadata: {},\n    method: 'GET',\n    callback: (request) => [],\n});\n\nconst handleSpaceAvailability = (request) => {\n    const start = +request.query_params.period_start;\n    const end = +request.query_params.period_end;\n    const zones = (request.query_params.zone_ids || '')\n        .split(',')\n        .filter((i) => !!i);\n    const systems = (request.query_params.system_ids || '')\n        .split(',')\n        .filter((i) => !!i);\n\n    const spaces = MOCK_SPACES.filter((space) =>\n        zones.length\n            ? zones.reduce(\n                  (has, zone) => has && space.zones.includes(zone),\n                  true\n              )\n            : systems.length\n            ? systems.includes(space.id)\n            : true\n    ).filter((space) => {\n        const bookings = MOCK_EVENTS.filter((event) =>\n            event.attendees.find((user) => user.id === space.id)\n        );\n        for (const event of bookings) {\n            if (\n                timePeriodsIntersect(\n                    start,\n                    end,\n                    event.event_start,\n                    event.event_end\n                )\n            )\n                return false;\n        }\n        return true;\n    });\n    return spaces;\n};\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/calendars/availability',\n    metadata: {},\n    method: 'GET',\n    callback: (request) =>\n        handleSpaceAvailability(request).map((_) => ({\n            resource: _,\n        })),\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/calendars/free_busy',\n    metadata: {},\n    method: 'GET',\n    callback: (request) =>\n        handleSpaceAvailability(request).map((_) => ({\n            resource: _,\n        })),\n});\n","import { predictableRandomInt } from '@placeos/common';\nimport { addMinutes, getUnixTime, setHours, startOfDay } from 'date-fns';\n\nimport { MOCK_STAFF } from './users.data';\nimport { MOCK_BUILDINGS, MOCK_LEVELS } from './zone.data';\n\nlet EVENT_TIME = setHours(startOfDay(new Date()), 7);\n\nconst nextEventTime = (save = false): number => {\n    const next = addMinutes(EVENT_TIME, (predictableRandomInt(8) + 1) * 15);\n    if (save) EVENT_TIME = next;\n    return getUnixTime(next);\n};\n\nconst TYPES = ['desk', 'parking'];\n\nexport const MOCK_BOOKINGS = new Array(200).fill(0).map((_, index) => {\n    const user = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n    const type = TYPES[predictableRandomInt(TYPES.length)];\n    const bld = MOCK_BUILDINGS[predictableRandomInt(MOCK_BUILDINGS.length)];\n    const lvls = MOCK_LEVELS.filter((_) => _.parent_id === bld.id);\n    const lvl = lvls[predictableRandomInt(lvls.length)];\n    const approved = predictableRandomInt(999999) % 4;\n    const approver = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n    return {\n        id: `booking-${index}`,\n        booking_start: nextEventTime(true),\n        booking_end: nextEventTime(),\n        user_id: user.id,\n        user_name: user.name,\n        user_email: user.email,\n        asset_id: `desk-${lvl?.id}-${index}`,\n        description: `Desk ${index}`,\n        title: `${type} Booking ${index}`,\n        type,\n        checked_in: predictableRandomInt(999999) % 3 === 0,\n        access: predictableRandomInt(999999) % 3 === 0,\n        approved: approved === 0,\n        rejected: approved === 1,\n        approver_id: approved === 0 ? approver.id : '',\n        approver_name: approved === 0 ? approver.name : '',\n        approver_email: approved === 0 ? approver.email : '',\n        zones: [bld.id, lvl?.id],\n        extension_data: {},\n    };\n});\n","import { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_BOOKINGS } from './bookings.data';\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings',\n    metadata: {},\n    method: 'GET',\n    callback: (_) => {\n        const events = MOCK_BOOKINGS.filter(\n            (event) =>\n                timePeriodsIntersect(\n                    _.query_params.period_start,\n                    _.query_params.period_end,\n                    event.booking_start,\n                    event.booking_end\n                ) && event.type === _.query_params.type\n        );\n        return events;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings/:id',\n    metadata: {},\n    method: 'GET',\n    callback: (_) => {\n        const event = MOCK_BOOKINGS.find((e) => e.id === _.route_params.id);\n        if (!event)\n            throw {\n                status: 404,\n                message: `Unable to find booking with ID ${_.route_params.id}`,\n            };\n        return event;\n    },\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings',\n    metadata: {},\n    method: 'POST',\n    callback: (request) => {\n        const new_event = {\n            ...request.body,\n            id: `-booking-${predictableRandomInt(999)}`,\n        };\n        MOCK_BOOKINGS.push(new_event);\n        return new_event;\n    },\n});\n\nconst updateBooking = (id, data) => {\n    const index = MOCK_BOOKINGS.findIndex((e) => e.id === id);\n    if (index < 0)\n        throw {\n            status: 404,\n            message: `Unable to find booking with ID ${id}`,\n        };\n    const new_event = { ...data };\n    MOCK_BOOKINGS.splice(index, 1, new_event);\n    return new_event;\n};\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings/:id',\n    metadata: {},\n    method: 'PUT',\n    callback: (req) => updateBooking(req.route_params.id, { ...req.body }),\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings/:id/approve',\n    metadata: {},\n    method: 'POST',\n    callback: (req) =>\n        updateBooking(req.route_params.id, {\n            ...req.body,\n            approved: true,\n            rejected: false,\n        }),\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings/:id/reject',\n    metadata: {},\n    method: 'POST',\n    callback: (req) =>\n        updateBooking(req.route_params.id, {\n            ...req.body,\n            approved: false,\n            rejected: true,\n        }),\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings/:id/check_in',\n    metadata: {},\n    method: 'POST',\n    callback: (req) =>\n        updateBooking(req.route_params.id, {\n            ...req.body,\n            checked_in: req.query_params.state === 'true',\n        }),\n});\n\nregisterMockEndpoint({\n    path: '/api/staff/v1/bookings/:id',\n    metadata: {},\n    method: 'DELETE',\n    callback: (req) => {\n        const index = MOCK_BOOKINGS.findIndex(\n            (e) => e.id === req.route_params.id\n        );\n        if (index < 0)\n            throw {\n                status: 404,\n                message: `Unable to find booking with ID ${req.route_params.id}`,\n            };\n        MOCK_BOOKINGS.splice(index, 1);\n        return;\n    },\n});\n","import { Component, OnInit } from '@angular/core';\nimport { SwUpdate } from '@angular/service-worker';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Clipboard } from '@angular/cdk/clipboard';\nimport { Integrations } from '@sentry/tracing';\nimport { BehaviorSubject } from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport {\n    clientId,\n    invalidateToken,\n    isMock,\n    refreshToken,\n    token,\n} from '@placeos/ts-client';\n\nimport {\n    BaseClass,\n    current_user,\n    currentUser,\n    HotkeysService,\n    notifySuccess,\n    setAppName,\n    setNotifyOutlet,\n    SettingsService,\n    setupCache,\n    setupPlace,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { SpacesService } from 'libs/spaces/src/lib/spaces.service';\nimport { setDefaultCreator } from 'libs/events/src/lib/event.class';\nimport { addHours } from 'date-fns';\n\nimport * as Sentry from '@sentry/angular';\n\nexport function initSentry(dsn: string, sample_rate: number = 0.2) {\n    if (!dsn) return;\n    Sentry.init({\n        dsn,\n        integrations: [\n            new Integrations.BrowserTracing({\n                tracingOrigins: ['localhost', location.origin],\n                routingInstrumentation: Sentry.routingInstrumentation,\n            }),\n        ],\n        tracesSampleRate: sample_rate,\n    });\n}\n\n@Component({\n    selector: 'app-root',\n    template: `\n        <router-outlet></router-outlet>\n        <div *ngIf=\"loading | async\" class=\"loading-block\">\n            <div class=\"info-block center\">\n                <div class=\"icon\">\n                    <mat-spinner [diameter]=\"64\"></mat-spinner>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [``],\n})\nexport class AppComponent extends BaseClass implements OnInit {\n    private _loading = new BehaviorSubject<boolean>(false);\n    /** Observable for whether the application is initialising */\n    public readonly loading = this._loading.asObservable();\n\n    constructor(\n        private _tracing: Sentry.TraceService,\n        private _settings: SettingsService,\n        private _org: OrganisationService, // For init\n        private _spaces: SpacesService, // For init\n        private _cache: SwUpdate,\n        private _snackbar: MatSnackBar,\n        private _hotkey: HotkeysService,\n        private _clipboard: Clipboard\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyM'], () => {\n            localStorage.setItem(\n                'mock',\n                `${localStorage.getItem('mock') !== 'true'}`\n            );\n            location.reload();\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyC'], () => {\n            this._clipboard.copy(`${token()}|${refreshToken()}`);\n            notifySuccess('Successfully copied token.');\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyV'], () => {\n            navigator.clipboard?.readText().then((tkn) => {\n                const parts = tkn.split('|');\n                const id = clientId();\n                localStorage.setItem(`${id}_access_token`, `${parts[0]}`);\n                localStorage.setItem(`${id}_refresh_token`, `${parts[1]}`);\n                localStorage.setItem(\n                    `${id}_expires_at`,\n                    `${addHours(new Date(), 6).valueOf()}`\n                );\n                notifySuccess('Successfully pasted token.');\n                setTimeout(() => location.reload(), 2000);\n            });\n        });\n        setNotifyOutlet(this._snackbar);\n        this._loading.next(true);\n        /** Wait for settings to initialise */\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        setAppName(this._settings.get('app.short_name'));\n        const settings = this._settings.get('composer') || {};\n        settings.mock =\n            !!this._settings.get('mock') ||\n            location.origin.includes('demo.place.tech');\n        /** Wait for authentication details to load */\n        await setupPlace(settings).catch(() => this.onInitError());\n        this._loading.next(false);\n        setupCache(this._cache);\n        this.timeout('wait_for_user', () => this.onInitError(), 5 * 1000);\n        await current_user.pipe(first((_) => !!_)).toPromise();\n        this.clearTimeout('wait_for_user');\n        setDefaultCreator(currentUser());\n\n        initSentry(this._settings.get('app.sentry_dsn'));\n    }\n\n    private onInitError() {\n        if (isMock() || currentUser()?.is_logged_in) return;\n        console.error('Error initialising user.');\n        invalidateToken();\n        location.reload();\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport {\n    AuthorisedUserGuard,\n    MisconfiguredComponent, UnauthorisedComponent\n} from '@placeos/components';\n\n\nconst routes: Routes = [\n    { path: 'unauthorised', component: UnauthorisedComponent },\n    { path: 'misconfigured', component: MisconfiguredComponent },\n    {\n        path: 'dashboard',\n        canActivate: [AuthorisedUserGuard],\n        canLoad: [AuthorisedUserGuard],\n        loadChildren: () =>\n            import('./dashboard/dashboard.module').then(\n                (m) => m.DashboardModule\n            ),\n    },\n    {\n        path: 'book',\n        canActivate: [AuthorisedUserGuard],\n        canLoad: [AuthorisedUserGuard],\n        loadChildren: () =>\n            import('./book/book.module').then((m) => m.BookModule),\n    },\n    {\n        path: 'explore',\n        canActivate: [AuthorisedUserGuard],\n        canLoad: [AuthorisedUserGuard],\n        loadChildren: () =>\n            import('./explore/explore.module').then((m) => m.ExploreModule),\n    },\n    {\n        path: 'control',\n        canActivate: [AuthorisedUserGuard],\n        canLoad: [AuthorisedUserGuard],\n        loadChildren: () =>\n            import('./control/control.module').then((m) => m.ControlModule),\n    },\n    {\n        path: 'directory',\n        canActivate: [AuthorisedUserGuard],\n        canLoad: [AuthorisedUserGuard],\n        loadChildren: () =>\n            import('./directory/directory.module').then(\n                (m) => m.DirectoryModule\n            ),\n    },\n    {\n        path: 'schedule',\n        canActivate: [AuthorisedUserGuard],\n        canLoad: [AuthorisedUserGuard],\n        loadChildren: () =>\n            import('./schedule/schedule.module').then((m) => m.AppScheduleModule),\n    },\n    {\n        path: 'help',\n        canActivate: [AuthorisedUserGuard],\n        canLoad: [AuthorisedUserGuard],\n        loadChildren: () =>\n            import('./help/help.module').then((m) => m.HelpModule),\n    },\n    { path: '**', redirectTo: 'dashboard', pathMatch: 'full' },\n];\n\n@NgModule({\n    imports: [RouterModule.forRoot(routes, { useHash: true })],\n    exports: [RouterModule],\n})\nexport class AppRoutingModule {}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { SharedContentModule } from '../ui/shared.module';\nimport { ViewRoomModalComponent } from './view-room-modal.component';\n\nimport { SpaceSelectModalComponent } from './space-select-modal/space-select-modal.component';\nimport { ItemComponent } from './space-select-modal/item/item.component';\nimport { ViewAttendeesModalComponent } from './view-attendees-modal/view-attendees-modal.component';\nimport { ViewCateringModalComponent } from './view-catering-modal/view-catering-modal.component';\nimport { RecurrenceModalComponent } from './recurrence-modal/recurrence-modal.component';\nimport { UserAvailabilityModalComponent } from './user-availability-modal/user-availability.modal.component';\n\nconst OVERLAYS: Type<any>[] = [\n    ViewRoomModalComponent,\n    ViewAttendeesModalComponent,\n    ViewCateringModalComponent,\n    RecurrenceModalComponent,\n    UserAvailabilityModalComponent,\n];\n\n@NgModule({\n    declarations: [...OVERLAYS, SpaceSelectModalComponent, ItemComponent],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        SharedContentModule,\n    ],\n    exports: [...OVERLAYS],\n})\nexport class SharedOverlaysModule {}\n","import { BrowserModule } from '@angular/platform-browser';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { ErrorHandler, NgModule } from '@angular/core';\nimport { HttpClientModule } from '@angular/common/http';\nimport { FormsModule } from '@angular/forms';\nimport { Router } from '@angular/router';\nimport { ServiceWorkerModule } from '@angular/service-worker';\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatNativeDateModule } from '@angular/material/core';\n\nimport '@placeos/mocks';\n\nimport { MisconfiguredComponent, UnauthorisedComponent } from '@placeos/components';\nimport { AppComponent } from '../../../../libs/components/src/lib/app.component';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { environment } from '../environments/environment';\nimport { SharedOverlaysModule } from './overlays/overlays.module';\nimport { SharedContentModule } from './ui/shared.module';\n\nimport * as Sentry from \"@sentry/angular\";\n\n@NgModule({\n    declarations: [\n        AppComponent,\n        UnauthorisedComponent,\n        MisconfiguredComponent\n    ],\n    imports: [\n        BrowserModule,\n        BrowserAnimationsModule,\n        AppRoutingModule,\n        ServiceWorkerModule.register('ngsw-worker.js', { enabled: environment.production }),\n        HttpClientModule,\n        FormsModule,\n        SharedOverlaysModule,\n        SharedContentModule,\n        MatNativeDateModule,\n        MatSnackBarModule,\n    ],\n    providers: [\n        {\n            provide: ErrorHandler,\n            useValue: Sentry.createErrorHandler({\n                showDialog: false,\n            }),\n        },\n        {\n            provide: Sentry.TraceService,\n            deps: [Router],\n        },\n    ],\n    bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","export const environment = {\n  production: true,\n};\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch((err) => console.error(err));\n","import { Component, EventEmitter, Inject, Output } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { DialogEvent, SettingsService } from '@placeos/common';\nimport { BuildingLevel, Desk } from '@placeos/organisation';\nimport { User } from '@placeos/users';\n\nexport interface DeskConfirmModalData {\n    host: User;\n    desks: Desk[];\n    date: number;\n    reason: string;\n    level: BuildingLevel;\n    can_set_date: boolean;\n}\n\n@Component({\n    selector: 'desk-flow-confirm-modal-component',\n    template: `\n        <header>\n            <h2>Confirm Booking</h2>\n            <div class=\"flex-1\"></div>\n            <button mat-icon-button mat-dialog-close *ngIf=\"!loading\">\n                <i class=\"material-icons\">close</i>\n            </button>\n        </header>\n        <ng-container *ngIf=\"!loading; else load_state\">\n            <main class=\"p-4\">\n                <div host class=\"flex flex-col\" *ngIf=\"can_set_host\">\n                    <label>Host</label>\n                    <a-user-search-field\n                        [(ngModel)]=\"host\"\n                    ></a-user-search-field>\n                </div>\n                <div date class=\"mb-4\">\n                    <label>Date</label>\n                    <div *ngIf=\"!can_set_date\">\n                        {{ date | date: 'mediumDate' }}\n                    </div>\n                    <a-date-field\n                        *ngIf=\"can_set_date\"\n                        [(ngModel)]=\"date\"\n                    ></a-date-field>\n                </div>\n                <div reason class=\"mb-4\" *ngIf=\"!hide_reason\">\n                    <label>Reason</label>\n                    <div>{{ reason || '~No set reason~' }}</div>\n                </div>\n                <p>\n                    Your desk{{ desks.length === 1 ? '' : 's' }} will be\n                    {{ desk_list }} on\n                    {{ level?.display_name || level?.name }}\n                </p>\n            </main>\n            <footer class=\"flex items-center justify-center p-2\">\n                <button mat-button (click)=\"confirm()\">Confirm</button>\n            </footer>\n        </ng-container>\n        <ng-template #load_state>\n            <main load class=\"flex flex-col p-12 items-center justify-center\">\n                <mat-spinner [diameter]=\"48\" class=\"mb-4\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                width: 24rem;\n                max-width: calc(100vw - 4.5rem);\n            }\n        `,\n    ],\n})\nexport class DeskConfirmModalComponent {\n    @Output() public event = new EventEmitter<DialogEvent>();\n\n    public readonly desks = this._data.desks || [];\n\n    public date = this._data.date;\n    public host = this._data.host;\n\n    public readonly can_set_date = this._data.can_set_date;\n\n    public readonly reason = this._data.reason;\n\n    public readonly level = this._data.level;\n\n    public loading: string;\n\n    public get desk_list() {\n        return this.desks.map((_) => _.name).join(', ');\n    }\n\n    public get hide_reason() {\n        return !!this._settings.get('app.desks.hide_reason');\n    }\n\n    public get can_set_host() {\n        return !!this._settings.get('app.desks.can_set_host');\n    }\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: DeskConfirmModalData,\n        private _settings: SettingsService\n    ) {}\n\n    public confirm() {\n        this.loading = 'Requesting desk booking...';\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import { Component, EventEmitter, OnInit, Output } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { DialogEvent, notifyError } from '@placeos/common';\n\n@Component({\n    selector: 'desk-question-modal',\n    template: `\n        <div *ngIf=\"!failure; else fail_state\" class=\"relative\">\n            <h2 class=\"p-4 text-xl\">COVID-19 Questionnaire</h2>\n            <main class=\"p-4\" [formGroup]=\"form\">\n                <div class=\"flex flex-col mb-4\">\n                    <label>\n                        Have you travelled overseas within the last 14\n                        days?<span>*</span>\n                    </label>\n                    <mat-radio-group\n                        formControlName=\"travelled\"\n                        class=\"space-x-2\"\n                    >\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n                <div class=\"flex flex-col mb-4\">\n                    <label>\n                        Are you unwell or experiencing any cold or flu-like\n                        symptoms?<span>*</span>\n                    </label>\n                    <mat-radio-group formControlName=\"unwell\" class=\"space-x-2\">\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label>\n                        Have you had contact with anyone with suspected\n                        COVID-19?<span>*</span>\n                    </label>\n                    <mat-radio-group\n                        formControlName=\"contact\"\n                        class=\"space-x-2\"\n                    >\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n            </main>\n            <footer class=\"flex justify-center items-center p-2\">\n                <button mat-button (click)=\"submit()\">Submit</button>\n            </footer>\n            <button close mat-icon-button mat-dialog-close>\n                <i class=\"material-icons\">close</i>\n            </button>\n        </div>\n        <ng-template #fail_state>\n            <main failure class=\"pt-8 relative\">\n                <p class=\"p-4\">\n                    Your request to work from the office has been rejected based\n                    on your response to the compulsory Covid-19 questions.\n                    Please feel free to submit a new request when circumstances\n                    change in a way that changes your answer to the questions.\n                </p>\n                <button close mat-icon-button mat-dialog-close>\n                    <i class=\"material-icons\">close</i>\n                </button>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                width: 24rem;\n                max-width: calc(100vw - 4.5rem);\n            }\n\n            [close] {\n                position: absolute;\n                top: 0.5rem;\n                right: 0.5rem;\n            }\n        `,\n    ],\n})\nexport class DeskQuestionsModalComponent implements OnInit {\n    @Output() public event = new EventEmitter<DialogEvent>();\n\n    public form: FormGroup;\n    public failure: boolean;\n\n    public ngOnInit() {\n        this.form = new FormGroup({\n            travelled: new FormControl('', [Validators.required]),\n            unwell: new FormControl('', [Validators.required]),\n            contact: new FormControl('', [Validators.required]),\n        });\n    }\n\n    public submit() {\n        this.form.markAllAsTouched();\n        if (!this.form.valid) {\n            notifyError('All the questions must be answered');\n            return;\n        } else if (\n            Object.keys(this.form.value).find(\n                (key) =>\n                    this.form.value[key] === true ||\n                    this.form.value[key] === 'true'\n            )\n        ) {\n            this.failure = true;\n            return;\n        }\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonModule } from '@angular/material/button';\n\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatRadioModule } from '@angular/material/radio';\n\nimport { FormFieldsModule } from '@placeos/form-fields';\n\nimport { DeskConfirmModalComponent } from './desk-confirm-modal.component';\nimport { DeskQuestionsModalComponent } from './desk-questions-modal.component';\n\nconst COMPONENTS = [DeskQuestionsModalComponent, DeskConfirmModalComponent];\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatRadioModule,\n        MatInputModule,\n        MatFormFieldModule,\n        MatDatepickerModule,\n        MatButtonModule,\n        MatDialogModule,\n        MatProgressSpinnerModule,\n        FormFieldsModule\n    ],\n    providers: [],\n    exports: [...COMPONENTS],\n})\nexport class SharedBookingsModule {}\n","import {\n    addHours,\n    addMinutes,\n    differenceInMinutes,\n    getUnixTime,\n    isAfter,\n    isSameDay,\n    roundToNearestMinutes\n} from 'date-fns';\n\nexport type BookingType = 'desk' | 'parking' | 'locker' | '';\n\n/** General purpose booking class */\nexport class Booking {\n    /** Unique Identifier of the object */\n    public readonly id: string;\n    /** Unix epoch for the start time of the booking in seconds */\n    public readonly booking_start: number;\n    /** Unix epoch for the start time of the booking in seconds */\n    public readonly booking_end: number;\n    /** ID of the user who owns the booking */\n    public readonly booked_by_id: string;\n    /** Email of the user who owns the booking */\n    public readonly booked_by_email: string;\n    /** Display name of the user who owns the booking */\n    public readonly booked_by_name: string;\n    /** ID of the user who owns the booking */\n    public readonly user_id: string;\n    /** Email of the user who owns the booking */\n    public readonly user_email: string;\n    /** Display name of the user who owns the booking */\n    public readonly user_name: string;\n    /** Identifier of the physical asset assocated with the booking */\n    public readonly asset_id: string;\n    /** Zones associated with the asset ID */\n    public readonly zones: string[];\n    /** Type of booking */\n    public readonly booking_type: BookingType;\n    /** Start time of booking in ms */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** Whether it is an all day booking */\n    public readonly all_day: boolean;\n    /** Timezone of the booking */\n    public readonly timezone: string;\n    /** Title of the booking */\n    public readonly title: string;\n    /** Description */\n    public readonly description: string;\n    /** Whether user checked in */\n    public readonly checked_in: boolean;\n    /** Whether booking is rejected */\n    public readonly rejected: boolean;\n    /** Whether booking is approved */\n    public readonly approved: boolean;\n    /** Id of the approver */\n    public readonly approver_id: string;\n    /** Email of the approver */\n    public readonly approver_email: string;\n    /** Name of the approver */\n    public readonly approver_name: string;\n    /** Extra non-standard metadata associated with the booking */\n    public readonly extension_data: Record<string, any>;\n    /** Default type */\n    public readonly type: string;\n    /** Default type */\n    public readonly access: boolean;\n    /** Status of the booking */\n    public readonly status: 'declined' | 'approved' | 'tentative';\n\n    constructor(data: Partial<Booking> = {}) {\n        this.id = data.id || '';\n        this.asset_id = data.asset_id || '';\n        this.zones = data.zones || [];\n        this.booking_start =\n            data.booking_start ||\n            getUnixTime(\n                data.date ||\n                    roundToNearestMinutes(addMinutes(new Date(), 2), {\n                        nearestTo: 5,\n                    })\n            );\n        this.booking_end =\n            data.booking_end ||\n            getUnixTime(addMinutes(this.booking_start * 1000, data.duration || 60));\n        this.booking_type = data.booking_type || '';\n        this.type = data.type || 'booking';\n        this.date = data.date || this.booking_start * 1000;\n        this.duration =\n            data.duration ||\n            Math.abs(differenceInMinutes(\n                this.booking_start * 1000,\n                this.booking_end * 1000\n            ));\n        this.timezone =\n            data.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone;\n        this.user_email = data.user_email || '';\n        this.user_id = data.user_id || '';\n        this.user_name = data.user_name || '';\n        this.title = data.title || 'Desk booking';\n        this.description = data.description || '';\n        this.checked_in = !!data.checked_in;\n        this.rejected = !!data.rejected;\n        this.approved = !!data.approved;\n        this.approver_id = data.approver_id || '';\n        this.approver_email = data.approver_email || '';\n        this.approver_name = data.approver_name || '';\n        this.extension_data = data.extension_data || {};\n        this.access = !!data.extension_data?.access;\n        this.all_day = data.all_day ?? true;\n        this.status = this.rejected\n            ? 'declined'\n            : this.approved\n            ? 'approved'\n            : 'tentative';\n        for (const key in data) {\n            if (!(key in this)) {\n                this.extension_data[key] =\n                    data[key] || this.extension_data[key];\n            }\n        }\n    }\n\n    public toJSON(this: Booking): Partial<Booking> {\n        const data = { ...this };\n        if (!this.id) delete data.id;\n        delete data.date;\n        delete data.duration;\n        return data;\n    }\n\n    public get location(): string {\n        return this.description;\n    }\n\n    /** Whether the booking occurs today */\n    public get is_today(): boolean {\n        return isSameDay(this.date, new Date());\n    }\n\n    /** Whether booking is done */\n    public get is_done(): boolean {\n        const start = new Date();\n        const end = this.all_day\n            ? addHours(this.date, 24)\n            : addMinutes(this.date, this.duration);\n        return isAfter(start, end);\n    }\n}\n","import { del, get, patch, post, put } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { Booking } from './booking.class';\n\nexport interface BookingsQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zones?: string;\n    /** User ID to filter bookings */\n    user?: string;\n    /** Email address to filter bookings */\n    email?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n    /** Category of booking */\n    type: string;\n}\n\nconst BOOKINGS_ENDPOINT = `/api/staff/v1/bookings`;\n\n/**\n * List bookings\n * @param q Parameters to pass to the API request\n */\nexport function queryBookings(q: BookingsQueryParams): Observable<Booking[]> {\n    const query = toQueryString(q);\n    return get(`${BOOKINGS_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new Booking(item)))\n    );\n}\n\n/**\n * Get booking details\n * @param id ID of the booking to grab\n * @param q Parameters to pass to the API request\n */\nexport function showBooking(id: string) {\n    return get(`${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new Booking(item))\n    );\n}\n\n/**\n * Create new booking and add it to the database\n * @param data New booking fields\n */\nexport function createBooking(data: Partial<Booking>) {\n    return post(`${BOOKINGS_ENDPOINT}`, data).pipe(\n        map((item) => new Booking(item))\n    );\n}\n\n/**\n * Update an existing booking\n * @param id ID of the booking to update\n * @param data New values for booking fields\n * @param method HTTP verb to use with API request\n */\nexport function updateBooking(\n    id: string,\n    data: Partial<Booking>,\n    method: 'put' | 'patch' = 'patch'\n) {\n    return (method === 'patch' ? patch : put)(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`,\n        data\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Save changes to or create a booking\n * @param data State of the booking\n * @param q Parameters to pass to the API request\n */\nexport const saveBooking = (data: Partial<Booking>) =>\n    data.id ? updateBooking(data.id, data) : createBooking(data);\n\n/**\n * Remove booking from the database\n * @param id ID of the booking to remove\n * @param q Parameters to pass to the API request\n */\nexport function removeBooking(id: string) {\n    return del(`${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`, {\n        response_type: 'void',\n    });\n}\n\n/**\n * Set the approval state of the booking to approved\n * @param id ID of the booking to approve\n * @param system_id Associated system to approve\n */\nexport function approveBooking(id: string) {\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/approve`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the approval state of the booking to rejected\n * @param id ID of the booking to reject\n * @param system_id Associated system to reject\n */\nexport function rejectBooking(id: string) {\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/reject`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the checkin state of a booking\n * @param id ID of the booking to grab\n * @param state New checkin state of the booking\n */\nexport function checkinBooking(id: string, state: boolean) {\n    const query = toQueryString({ state });\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/check_in?${query}`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n","import { Injectable } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Event, NavigationEnd, Router } from '@angular/router';\nimport {\n    BaseClass,\n    currentUser,\n    flatten,\n    getInvalidFields,\n    notifyError,\n    openConfirmModal,\n    unique,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { listChildMetadata, PlaceZone } from '@placeos/ts-client';\nimport { format, getUnixTime, addMinutes } from 'date-fns';\nimport { BehaviorSubject, combineLatest, Observable, of } from 'rxjs';\nimport {\n    debounceTime,\n    distinctUntilKeyChanged,\n    first,\n    map,\n    shareReplay,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\n\nimport { User } from 'libs/users/src/lib/user.class';\nimport { Booking } from './booking.class';\nimport { generateBookingForm } from './booking.utilities';\nimport { queryBookings, saveBooking } from './bookings.fn';\nimport { DeskQuestionsModalComponent } from './desk-questions-modal.component';\n\nexport type BookingFlowView = 'form' | 'map' | 'confirm' | 'success';\n\nconst BOOKING_URLS = ['book/desks'];\n\nexport interface BookingFlowOptions {\n    /** Type of booking being made */\n    type: 'desk' | 'parking';\n    /** Zone to check available */\n    zone_id?: string;\n    /** List of features that the asset should associate */\n    features?: string[];\n    /** Whether booking is for a group */\n    group?: boolean;\n    /** Recurrence Pattern */\n    pattern?: 'none' | 'daily' | 'weekly' | 'monthly';\n    /** Recurrence ending */\n    recurr_end?: number;\n    /** List of group members to book for */\n    members?: User[];\n}\n\nexport interface BookingAsset {\n    id: string;\n    map_id: string;\n    name: string;\n    bookable: boolean;\n    zone?: PlaceZone;\n    features: string[];\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class BookingStateService extends BaseClass {\n    private _view = new BehaviorSubject<BookingFlowView>('form');\n    private _options = new BehaviorSubject<BookingFlowOptions>({\n        type: 'desk',\n    });\n    private _form = new BehaviorSubject<FormGroup>(null);\n    private _form_value = new BehaviorSubject<Partial<Booking>>({});\n    private _booking = new BehaviorSubject<Booking>(null);\n    private _loading = new BehaviorSubject<string>('');\n\n    public last_success: Booking = new Booking(\n        JSON.parse(\n            sessionStorage.getItem('PLACEOS.last_booked_booking') || '{}'\n        )\n    );\n    public readonly loading = this._loading.asObservable();\n    public readonly options = this._options.pipe(shareReplay(1));\n\n    public readonly assets: Observable<BookingAsset[]> = this.options.pipe(\n        distinctUntilKeyChanged('zone_id'),\n        switchMap(({ type }) => {\n            if (!this._org.building) return of([]);\n            switch (type) {\n                case 'desk':\n                    this._loading.next(`Loading desks...`);\n                    return listChildMetadata(this._org.building.id, {\n                        name: 'desks',\n                    }).pipe(\n                        map((data) =>\n                            flatten(\n                                data.map((_) =>\n                                    (\n                                        _.metadata.desks?.details || []\n                                    ).map((d) => ({ ...d, zone: _.zone }))\n                                )\n                            )\n                        )\n                    );\n            }\n            return of([]);\n        }),\n        tap(() => this._loading.next(``)),\n        shareReplay(1)\n    );\n\n    public readonly features: Observable<string[]> = this.assets.pipe(\n        map((assets) => {\n            const list: string[] = [];\n            for (const asset of assets) {\n                asset.features?.forEach((_) => list.push(_));\n            }\n            return unique(list).sort((a, b) => a.localeCompare(b));\n        }),\n        shareReplay(1)\n    );\n\n    public readonly available_assets = combineLatest([\n        this.options,\n        this.assets,\n        this._form_value,\n    ]).pipe(\n        debounceTime(500),\n        tap(([{ type }]) =>\n            this._loading.next(`Checking ${type} availability...`)\n        ),\n        switchMap(([options, assets, form]) =>\n            queryBookings({\n                period_start: getUnixTime(form.date),\n                period_end: getUnixTime(\n                    addMinutes(form.date, form.duration || 24 * 60)\n                ),\n                type: options.type,\n                zones: options.zone_id,\n            }).pipe(\n                map((bookings) =>\n                    assets.filter(\n                        (asset) =>\n                            asset.bookable !== false &&\n                            (!options.features ||\n                                options.features?.every((_) =>\n                                    asset.features.includes(_)\n                                )) &&\n                            (!options.zone_id ||\n                                options.zone_id === asset.zone?.id ||\n                                options.zone_id === asset.zone?.parent_id) &&\n                            !bookings.find((bkn) => bkn.asset_id === asset.id)\n                    )\n                )\n            )\n        ),\n        tap(() => this._loading.next('')),\n        shareReplay(1)\n    );\n\n    public readonly grouped_availability = combineLatest([\n        this.options,\n        this.available_assets,\n    ]).pipe(\n        map(([options, assets]) => {\n            const groups = [];\n            const asset_list = [...assets].sort((a, b) =>\n                a.zone?.id?.localeCompare(b.zone?.id)\n            );\n            const members = options.members?.length\n                ? options.members\n                : [currentUser()];\n            while (asset_list.length) {\n                const group = [];\n                let asset = asset_list.pop();\n                while (group.length < members.length) {\n                    if (\n                        group.length &&\n                        !group.find((_) => _.zone?.id === asset.zone?.id)\n                    ) {\n                        break;\n                    }\n                    group.push(asset);\n                    asset = asset_list.pop();\n                }\n                if (group.length < members.length) continue;\n                groups.push(group);\n            }\n            return groups;\n        })\n    );\n\n    public get view() {\n        return this._view.getValue();\n    }\n\n    public get form() {\n        return this._form.getValue();\n    }\n\n    public get booking() {\n        return this._booking.getValue();\n    }\n\n    public newForm(booking: Booking = new Booking()) {\n        this._form.next(generateBookingForm(booking));\n        this.subscription(\n            'form_change',\n            this._form.getValue().valueChanges.subscribe(() => this.storeForm())\n        );\n        this._booking.next(booking);\n        this._options.next({ type: this._options.getValue().type });\n    }\n\n    constructor(\n        private _router: Router,\n        private _org: OrganisationService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this.subscription(\n            'router.bookings',\n            this._router.events.subscribe((booking: Event) => {\n                if (\n                    booking instanceof NavigationEnd &&\n                    !BOOKING_URLS.find((_) => booking.url.includes(_))\n                ) {\n                    this.clearForm();\n                }\n            })\n        );\n        this._org.initialised\n            .pipe(first((_) => _))\n            .subscribe(() => this.setOptions({}));\n    }\n\n    public setView(value: BookingFlowView) {\n        this._view.next(value);\n    }\n\n    public setOptions(value: Partial<BookingFlowOptions>) {\n        this._options.next({ ...this._options.getValue(), ...value });\n    }\n\n    public resetForm() {\n        if (!this._form.getValue()) this.newForm();\n        const booking = this._booking.getValue();\n        this._form.getValue().patchValue({\n            ...(booking || {}),\n            ...(booking?.extension_data || {}),\n        });\n        this._options.next({ type: this._options.getValue().type });\n    }\n\n    public clearForm() {\n        sessionStorage.removeItem('PLACEOS.booking_form');\n        sessionStorage.removeItem('PLACEOS.booking_form_options');\n        this.newForm();\n    }\n\n    public storeForm() {\n        sessionStorage.setItem(\n            'PLACEOS.booking_form',\n            JSON.stringify(this._form.getValue()?.value || {})\n        );\n        sessionStorage.setItem(\n            'PLACEOS.booking_form_filters',\n            JSON.stringify(this._options.getValue() || {})\n        );\n        this._form_value.next(this._form.getValue()?.value || {});\n    }\n\n    public loadForm() {\n        if (!this._form.getValue()) this.newForm();\n        this._form.getValue().patchValue({\n            ...JSON.parse(\n                sessionStorage.getItem('PLACEOS.booking_form') || '{}'\n            ),\n        });\n        this.setOptions({\n            zone_id: this._org.building.id,\n            ...JSON.parse(\n                sessionStorage.getItem('PLACEOS.booking_form_filters') || '{}'\n            ),\n        });\n    }\n\n    public async confirmPost() {\n        await this.checkQuestions();\n        const options = this._options.getValue();\n        const form = this._form.getValue();\n        const details = await openConfirmModal(\n            {\n                title: `Book ${options.type}`,\n                content: `Would you like to book the ${options.type} ${\n                    form.get('asset_id').value\n                } for ${format(form.get('date').value, 'dd MMM yyyy')}`,\n                icon: { content: 'event_available' },\n            },\n            this._dialog\n        );\n        if (details?.reason !== 'done') return;\n        details.loading('');\n        await this.postForm().catch((_) => notifyError(_));\n        details.close();\n    }\n\n    public async postForm() {\n        const form = this._form.getValue();\n        if (!form) throw 'No form for booking';\n        if (!form.valid)\n            throw `Some form fields are invalid. [${getInvalidFields(form).join(\n                ', '\n            )}]`;\n        const asset_id = form.get('asset_id').value;\n        const bookings = await queryBookings({\n            period_start: getUnixTime(form.get('date').value),\n            period_end: getUnixTime(\n                form.get('date').value + form.get('duration').value * 60 * 1000\n            ),\n            type: this._options.getValue().type,\n        }).toPromise();\n        if (bookings.find((_) => _.asset_id === asset_id))\n            throw `${asset_id} is not available at the selected time`;\n        const result = await saveBooking(\n            new Booking(this._form.getValue().value)\n        ).toPromise();\n        this.clearForm();\n        this.last_success = result;\n        sessionStorage.setItem(\n            'PLACEOS.last_booked_booking',\n            JSON.stringify(result)\n        );\n        this.setView('success');\n        return result;\n    }\n\n    private async checkQuestions() {\n        const ref = this._dialog.open(DeskQuestionsModalComponent);\n        const result = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (result?.reason !== 'done') throw 'User cancelled';\n        const form = ref.componentInstance.form.value;\n        for (const key in form) {\n            if (form[key]) throw 'User failed questionaire';\n        }\n        ref.close();\n    }\n}\n","import { FormControl, FormGroup } from '@angular/forms';\nimport { currentUser } from '@placeos/common';\nimport { Booking } from './booking.class';\n\nexport function generateBookingForm(booking: Booking) {\n    const form = new FormGroup({\n        id: new FormControl(booking.id || ''),\n        date: new FormControl(booking.date, []),\n        duration: new FormControl(booking.duration),\n        booking_type: new FormControl(booking.booking_type),\n        zones: new FormControl(booking.zones),\n        title: new FormControl(booking.title),\n        description: new FormControl(booking.description),\n        asset_id: new FormControl(booking.asset_id),\n        user: new FormControl(currentUser()),\n        user_id: new FormControl(booking.user_id),\n        booked_by: new FormControl(currentUser()),\n        booked_by_id: new FormControl(booking.booked_by_id),\n    });\n    form.get('user')?.valueChanges.subscribe((u) =>\n        u ? form.get('user_id')?.setValue(u.id) : ''\n    );\n    form.get('booked_by')?.valueChanges.subscribe((u) =>\n        u ? form.get('booked_by')?.setValue(u.id) : ''\n    );\n    return form;\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog, MatDialogRef } from '@angular/material/dialog';\nimport { DialogEvent, notifyError, notifySuccess } from '@placeos/common';\nimport { Desk, OrganisationService } from '@placeos/organisation';\nimport { StaffUser, User } from '@placeos/users';\nimport { endOfDay, getUnixTime, startOfDay } from 'date-fns';\nimport { first, map } from 'rxjs/operators';\n\nimport { queryBookings, saveBooking } from './bookings.fn';\nimport { DeskConfirmModalComponent } from './desk-confirm-modal.component';\nimport { DeskQuestionsModalComponent } from './desk-questions-modal.component';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class DesksService {\n    public can_set_date = true;\n    public error_on_host = true;\n\n    constructor(\n        private _org: OrganisationService,\n        private _dialog: MatDialog\n    ) {}\n\n    public async bookDesk({\n        desks,\n        host,\n        reason,\n        attendees,\n        date,\n    }: {\n        desks: Desk[];\n        host?: StaffUser;\n        attendees?: User[];\n        reason?: string;\n        date?: Date;\n    }) {\n        if (this.error_on_host && !host) {\n            return notifyError('You need to select a host to book a desk.');\n        }\n        reason = reason || '';\n        const level = this._org.levelWithID(\n            desks[0].zone instanceof Array ? desks[0].zone : [desks[0].zone?.id]\n        );\n        let ref: MatDialogRef<any> = this._dialog.open(\n            DeskQuestionsModalComponent\n        );\n        let success = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_: DialogEvent) => _.reason === 'done'))\n                .toPromise(),\n            ref\n                .afterClosed()\n                .pipe(map((_) => null))\n                .toPromise(),\n        ]);\n        if (!success) return;\n        ref.close();\n        ref = this._dialog.open(DeskConfirmModalComponent, {\n            data: {\n                host,\n                desks,\n                date: date ? new Date(date) : new Date(),\n                reason,\n                level,\n                can_set_date: this.can_set_date,\n            },\n        });\n        success = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_: DialogEvent) => _.reason === 'done'))\n                .toPromise(),\n            ref\n                .afterClosed()\n                .pipe(map((_) => null))\n                .toPromise(),\n        ]);\n        if (!success) return;\n        host = ref.componentInstance.host || host;\n        date = ref.componentInstance.date || date;\n        if (!host) {\n            ref.close();\n            return notifyError('You need to select a host to book a desk. ');\n        }\n        ref.componentInstance.loading =\n            'Checking for existing desk bookings...';\n        const bookings = await queryBookings({\n            type: 'desk',\n            period_start: getUnixTime(startOfDay(date || new Date())),\n            period_end: getUnixTime(endOfDay(date || new Date())),\n        }).toPromise();\n        const desk_list = bookings.filter(\n            (d) => d.user_email.toLowerCase() === host.email.toLowerCase()\n        );\n        if (desk_list?.length) {\n            ref.close();\n            return notifyError(\n                'You currently already have a desk booked for the selected date.'\n            );\n        }\n        ref.componentInstance.loading = 'Booking desk...';\n        const users = [host, ...(attendees || [])];\n        await Promise.all([\n            desks.map((desk, idx) =>\n                this.makeDeskBooking(\n                    desk,\n                    host,\n                    date.valueOf() || new Date().valueOf(),\n                    reason,\n                    users[idx]\n                )\n            ),\n        ]);\n        notifySuccess('Successfully booked desk');\n        ref.close();\n        return true;\n    }\n\n    private async makeDeskBooking(\n        desk: Desk,\n        host: StaffUser,\n        date: number,\n        reason: string,\n        for_user: User = null\n    ) {\n        const location = `${desk.zone?.name}-${desk.id}`;\n        const level = this._org.levelWithID(\n            desk.zone instanceof Array ? desk.zone : [desk.zone?.id]\n        );\n        const zones = desk.zone?.id\n            ? [desk.zone?.id, level?.parent_id]\n            : [level?.parent_id];\n        const booking_data = {\n            booking_start: getUnixTime(startOfDay(date)),\n            user_id: for_user?.id || host.id,\n            user_name: for_user?.name || host.name,\n            user_email: for_user?.email || host.email,\n            booking_end: Math.floor(endOfDay(date).valueOf() / 1000),\n            asset_id: desk.id,\n            title: reason,\n            description: location,\n            zones,\n            booking_type: 'desk',\n            extension_data: {\n                groups: desk.groups,\n                for_user: for_user?.email,\n            },\n        };\n        return saveBooking(booking_data as any).toPromise();\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\nimport { first } from 'rxjs/operators';\nimport { addMinutes, endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\nimport { Calendar } from './calendar.class';\n\nimport { BaseClass, notifyError } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { CalendarEvent } from '../../../events/src/lib/event.class';\nimport { CalendarAvailabilityQueryParams } from './calendar.interfaces';\nimport {\n    queryCalendarAvailability,\n    queryCalendars,\n    querySpaceFreeBusy,\n} from './calendar.fn';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class CalendarService extends BaseClass {\n    private readonly _calendars = new BehaviorSubject<Calendar[]>([]);\n\n    /** Observable for the list of calendars */\n    public readonly calendar_list = this._calendars.asObservable();\n\n    /* istanbul ignore next */\n    public readonly query = () => queryCalendars();\n    /* istanbul ignore next */\n    public readonly freeBusy = (q: CalendarAvailabilityQueryParams) =>\n        querySpaceFreeBusy(q, this._org);\n    /* istanbul ignore next */\n    public readonly availability = (q: CalendarAvailabilityQueryParams) =>\n        queryCalendarAvailability(q);\n\n    constructor(private _org: OrganisationService) {\n        super();\n        this._org.initialised\n            .pipe(first((_) => _))\n            .subscribe(() => this.init());\n    }\n\n    public async init() {\n        await this.load().catch((err) =>\n            notifyError('Error loading calendars data')\n        );\n        this._initialised.next(true);\n    }\n\n    public get calendars(): Calendar[] {\n        return this._calendars.getValue();\n    }\n\n    /** Get Free busy for the selected day\n     * @param calendars User calendar\n     * @param date Selected day\n     */\n    public getFreeBusyDate(date: number, calendars: string) {\n        return querySpaceFreeBusy(\n            {\n                period_start: getUnixTime(startOfDay(date)),\n                period_end: getUnixTime(endOfDay(date)),\n                calendars,\n            },\n            this._org\n        );\n    }\n\n    /** Check rooms availability */\n    public async checkSpacesAvailability(\n        system_ids: string[],\n        period_start: number,\n        period_end: number,\n        old_booking?: CalendarEvent\n    ) {\n        const result = await queryCalendarAvailability({\n            period_start,\n            period_end,\n            system_ids: system_ids.join(','),\n        }).toPromise();\n        const start = new Date(old_booking?.date).valueOf();\n        const end = addMinutes(start, old_booking?.duration).valueOf();\n        const available = result.every((i) => {\n            const availability = i.availability;\n            if (old_booking && i.id === old_booking.system?.email) {\n                const index = availability.findIndex((block) => {\n                    return (\n                        block.date >= start &&\n                        addMinutes(block.date, block.duration).valueOf() <= end\n                    );\n                });\n                if (index !== -1) {\n                    availability.splice(index, 1);\n                }\n            }\n            return !availability.length;\n        });\n        return !!available;\n    }\n\n    public async load(): Promise<void> {\n        this._calendars.next(await queryCalendars().toPromise());\n    }\n}\n","import { differenceInMinutes } from 'date-fns';\n\nimport { Space } from 'libs/spaces/src/lib/space.class';\n\nimport { CalendarAvailability } from './calendar.interfaces';\n\nexport class Calendar {\n    /** ID of the calendar */\n    public readonly id: string;\n    /** Name of the calendar */\n    public readonly name: string;\n    /** System associated with the calendar */\n    public readonly resource: Space;\n    /** Primary calendar of the user */\n    public readonly primary: boolean;\n    /** Summary */\n    public readonly summary: string;\n    /** Whether the user can edit events associated to this calendar */\n    public readonly can_edit: boolean;\n    /** Availability */\n    public readonly availability: CalendarAvailability[];\n    /** Whether calendar should be hidden from the user */\n    public readonly hidden: boolean;\n\n    constructor(data: Partial<Calendar> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.primary = !!data.primary;\n        this.summary = data.summary || '';\n        this.can_edit = !!data.can_edit;\n        this.resource = new Space(data.resource || (data as any).system);\n        this.availability = (data.availability || []).map(\n            ({ starts_at, ends_at, date, duration, status }: any) => {\n                return {\n                    date: new Date(date, starts_at).valueOf(),\n                    duration:\n                        duration || differenceInMinutes(ends_at, starts_at),\n                    status: status,\n                };\n            }\n        );\n        this.hidden = !!data.hidden;\n    }\n}\n","import { get } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { Calendar } from './calendar.class';\nimport { CalendarAvailabilityQueryParams } from './calendar.interfaces';\n\nconst CALENDAR_ENDPOINT = '/api/staff/v1/calendars';\n\n/** List calendars associated with the logged in user */\nexport function queryCalendars(): Observable<Calendar[]> {\n    return get(CALENDAR_ENDPOINT).pipe(\n        map((i) => i.map((c) => new Calendar(c)))\n    );\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function queryCalendarAvailability(\n    q: CalendarAvailabilityQueryParams\n): Observable<Calendar[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/availability${query ? '?' + query : ''}`\n    ).pipe(map((i) => i.map((c) => new Calendar(c))));\n}\n\nconst calendarsToSpaces = (org?) =>\n    map((list: Calendar[]) =>\n        list\n            .filter((cal) => !!cal.resource)\n            .map(\n                (cal) =>\n                    new Space({\n                        ...cal.resource,\n                        level: org?.levelWithID(cal.resource.zones),\n                        availability: cal.availability,\n                    })\n            )\n            .filter((space) => space.bookable)\n    );\n\n/** List available spaces based on the given query */\nexport function querySpaceAvailability(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    return queryCalendarAvailability(q).pipe(calendarsToSpaces(org));\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function querySpaceFreeBusy(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/free_busy${query ? '?' + query : ''}`\n    ).pipe(\n        map((i) => i.map((c) => new Calendar(c))),\n        calendarsToSpaces(org)\n    );\n}\n","import { CateringOption } from './catering.interfaces';\n\nexport class CateringItem {\n    /** ID of the catering item */\n    public readonly id: string;\n    /** Display name for the catering item */\n    public readonly name: string;\n    /** Category that this item is associated */\n    public readonly category: string;\n    /** Description of the contents of the catering item */\n    public readonly description: string;\n    /** Unit price in cents for the catering item */\n    public readonly unit_price: number;\n    /** Number of item in the associated order */\n    public readonly quantity: number;\n    /** List of options for the catering item */\n    public readonly options: CateringOption[];\n    /** List of attributes assoicated with the catering item */\n    public readonly tags: string[];\n    /** Total cost for the item */\n    public readonly total_cost: number;\n    /** Whether catering items can be purchased using points */\n    public readonly accept_points: boolean;\n    /** Max percentage of the cost that can be covered using points */\n    public readonly discount_cap: number;\n\n    constructor(data: Partial<CateringItem> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || data.id || '';\n        this.category = data.category || '';\n        this.unit_price = data.unit_price || 0;\n        this.description = data.description || '';\n        this.quantity = data.quantity || 0;\n        this.accept_points = data.accept_points ?? false;\n        this.quantity = data.quantity || 0;\n        this.discount_cap = data.discount_cap || 0;\n        this.tags = data.tags || [];\n        this.options = data.options || [];\n        this.total_cost =\n            (this.unit_price + this.options?.map((i) => i.unit_price || 0).reduce((c, a) => c + a, 0)) *\n            this.quantity;\n    }\n}\n","import { randomInt } from '@placeos/common';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { CateringItem } from './catering-item.class';\nimport { CateringOrderStatus } from './catering.interfaces';\n\nexport class CateringOrder {\n    /** ID of the order */\n    public readonly id: string;\n    /** ID of the space the order is associated */\n    public readonly system_id: string;\n    /** ID of the event the order is associated */\n    public readonly event_id: string;\n    /** List of items associated with the order */\n    public readonly items: readonly CateringItem[];\n    /** Number of items in the order */\n    public readonly item_count: number;\n    /** Total cost of order */\n    public readonly total_cost: number;\n    /** Invoice number associated with the order */\n    public readonly invoice_number: string;\n    /** Charge code for the order */\n    public readonly charge_code: string;\n    /** Unix epoch in seconds of order delivery time */\n    public readonly deliver_at: number;\n    /** Current status of the order */\n    public readonly status: CateringOrderStatus;\n    /** Event associated with the order */\n    public readonly event: CalendarEvent | null;\n\n    constructor(data: Partial<CateringOrder> = {}) {\n        this.id = data.id || `order-${randomInt(9_999_999, 1_000_000)}`;\n        this.system_id = data.system_id || '';\n        this.event_id = data.event_id || data.event?.id || '';\n        this.items = (data.items || []).map((i) => new CateringItem(i));\n        this.item_count = this.items.reduce(\n            (amount, item) => amount + item.quantity,\n            0\n        );\n        this.total_cost = this.items.reduce(\n            (amount, item) => amount + (item.total_cost || 0),\n            0\n        );\n        this.charge_code = data.charge_code || '';\n        this.status = data.status || 'accepted';\n        this.invoice_number = data.invoice_number || '';\n        this.event = data.event || null;\n        this.deliver_at =\n            data.deliver_at ||\n            (data as any).date ||\n            this.event?.date ||\n            new Date().getTime();\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport { HashMap } from './types';\nimport { unique } from './general';\n\n/** List of keys that cannot be in a combination by themselves or with each other */\nconst INVALID_STANDALONE_KEYS: string[] = ['control', 'shift', 'alt', 'meta', 'os'];\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class HotkeysService {\n    /** Map of subjects which store press states of keys */\n    private keydown_states: HashMap<BehaviorSubject<number>> = {};\n    /** Map of obserers for key state subjects */\n    private keydown_observers: HashMap<Observable<number>> = {};\n    /** List of keys at the end of a combination */\n    private combo_end: string[] = [];\n    /** List of registered hotkey combinations */\n    private registered_combos: string[][] = [];\n    /** Counter for the number of keydown events. Used for checking order of key presses */\n    private counter: number = 0;\n    /** Last key code to be pressed */\n    private last_down: string;\n\n    constructor() {\n        window.addEventListener('keydown', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            if (this.last_down !== code) {\n                if (!this.keydown_states[code]) {\n                    this.keydown_states[code] = new BehaviorSubject(null);\n                    this.keydown_observers[code] = this.keydown_states[code].asObservable();\n                }\n                this.keydown_states[code].next(++this.counter);\n                if (this.combo_end.indexOf(code) >= 0) {\n                    event.preventDefault();\n                }\n                this.last_down = code;\n            }\n        });\n\n        window.addEventListener('keyup', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            this.keydown_states[code].next(null);\n            if (this.last_down === code) {\n                this.last_down = null;\n            }\n        });\n    }\n\n    /**\n     * Listen to the given key combination\n     * @param combo Array of key codes to listen to or a hotkey string e.g. `Alt+Shift+KeyK`\n     * @param next Callback for combination presses\n     */\n    public listen(combo: string | string[], next: () => void): Subscription {\n        combo = (combo instanceof Array ? combo : combo.split('+'));\n        const combination: string[] = combo.map(i => this.mapKey(i.toLowerCase()));\n        if (combination.length > 0 && this.validCombination(combination)) {\n            this.registered_combos.push(combination);\n            const last_key = combination[combination.length - 1];\n            if (!this.keydown_states[last_key]) {\n                this.keydown_states[last_key] = new BehaviorSubject(null);\n                this.keydown_observers[last_key] = this.keydown_states[last_key].asObservable();\n            }\n            this.updateCombinationEndList();\n            return this.keydown_observers[last_key].subscribe((count) => {\n                if (count) {\n                    const presses: number[] = [];\n                    if (combination.length > 0) {\n                        // Check that keys are pressed\n                        for (const key of combination) {\n                            const state = this.keydown_states[key];\n                            presses.push(state ? state.getValue() || -1 : -1);\n                        }\n                        // Check that keys are pressed in the correct order\n                        for (let i = 0; i < combination.length - 1; i++) {\n                            if (presses[i] > presses[i + 1]) { return; }\n                        }\n                    }\n                    const total = presses.reduce((a, v) => a + (v > 0 ? 1 : -1), 0);\n                    if (total >= combination.length) {\n                        next();\n                    }\n                }\n            });\n        }\n        return null;\n    }\n\n    /**\n     * Map key codes with multiple versions to simple form\n     * @param code Code to transform\n     */\n    private mapKey(code: string): string {\n        if (code.indexOf('alt') >= 0 || code.indexOf('shift') >= 0 || code.indexOf('control') >= 0) {\n            return code.replace('left', '').replace('right', '');\n        }\n        return code;\n    }\n\n    /**\n     * Update the list of the last keys in combinations to allow for prevent default actions on pre-existing hotkeys\n     */\n    private updateCombinationEndList(): void {\n        const key_list = [];\n        for (const combo of this.registered_combos) {\n            this.combo_end.push(combo[combo.length - 1]);\n        }\n        this.combo_end = unique(key_list);\n    }\n\n    /**\n     * Checks if the given hotkey combination is allowed and valid\n     * @param combo Array of key codes\n     */\n    private validCombination(combo: string[]): boolean {\n        let non_meta = 0;\n        for (const key of combo) {\n            if (INVALID_STANDALONE_KEYS.indexOf(key) < 0) {\n                non_meta++;\n            }\n        }\n        return non_meta > 0;\n    }\n}\n","/**\n * GENERAL APPLICATION SETTINGS\n */\nconst general: any = {\n    menu_items: [\n        {\n            name: 'Home',\n            route: '/dashboard',\n            icon: {\n                class: 'material-icons',\n                content: 'home',\n            },\n        },\n        {\n            name: 'Book',\n            route: '/book/spaces',\n            icon: {\n                class: 'material-icons',\n                content: 'book_online',\n            },\n        },\n        {\n            name: 'Scan',\n            route: '/book/code',\n            icon: {\n                class: 'material-icons',\n                content: 'qr_code',\n            },\n        },\n        {\n            name: 'Desk',\n            route: '/book/desks',\n            icon: {\n                class: 'material-icons',\n                content: 'auto_stories',\n            },\n        },\n        {\n            name: 'Spaces',\n            route: '/explore',\n            icon: {\n                class: 'material-icons',\n                content: 'place',\n            },\n        },\n        {\n            name: 'People',\n            route: '/directory',\n            icon: {\n                class: 'material-icons',\n                content: 'person_search',\n            },\n        },\n        {\n            name: 'Help',\n            route: '/help',\n            icon: {\n                class: 'material-icons',\n                content: 'help',\n            },\n        },\n        {\n            name: 'My Day',\n            route: '/schedule',\n            icon: {\n                class: 'material-icons',\n                content: 'date_range',\n            },\n        },\n        // {\n        //     name: 'Wellness',\n        //     route: '/schedule',\n        //     icon: {\n        //         class: 'material-icons',\n        //         content: 'mood',\n        //     },\n        // },\n    ],\n    copyright: 'PlaceOS',\n    position: 'right',\n};\n/**\n * HELP/SUPPORT SETTINGS\n */\nconst help: any = {\n    tiles: [\n        {\n            name: 'About Engine',\n            link: 'https://place.technology/resources',\n            icon: {\n                type: 'icon',\n                class: 'material-icons',\n                content: 'dns',\n            },\n            background:\n                'https://static1.squarespace.com/static/52142586e4b0c09536a144ad/5c8ed203a4222fa1927bbab3/5cb7cba66e9a7f63584b4d39/1555549341622/too-many-buttons.jpg?format=2500w',\n        },\n        {\n            name: 'General Enquiries',\n            link: 'mailto:equiries@place.technology?subject=Staff%20App%20Demo',\n            icon: {\n                type: 'icon',\n                class: 'material-icons',\n                content: 'mail',\n            },\n            background: 'assets/img/it-banner.jpg',\n        },\n        {\n            name: 'Contact PlaceOS',\n            link: 'https://place.technology/contact-1',\n            icon: {\n                type: 'icon',\n                class: 'material-icons',\n                content: 'call',\n            },\n            background:\n                'https://images.squarespace-cdn.com/content/v1/52142586e4b0c09536a144ad/1569984759306-M6ZOKD64OG009U68MYUL/ke17ZwdGBToddI8pDm48kCX-V5vw-8h9IBXN10-_8XN7gQa3H78H3Y0txjaiv_0fDoOvxcdMmMKkDsyUqMSsMWxHk725yiiHCCLfrh8O1z4YTzHvnKhyp6Da-NYroOW3ZGjoBKy3azqku80C789l0p4Wyba38KfG317vYluk45_zZdtnDCZTLKcP2mivxmYi50xvY5saIGKMgOza9mH4XA/image-asset.jpeg?format=2500w',\n        },\n        {\n            name: 'About Us',\n            link: 'https://place.technology/',\n            icon: {\n                type: 'icon',\n                class: 'material-icons',\n                content: 'business',\n            },\n            background:\n                'https://images.squarespace-cdn.com/content/v1/52142586e4b0c09536a144ad/1569985184499-QF839PTJ2EV30KIZF59X/ke17ZwdGBToddI8pDm48kLkXF2pIyv_F2eUT9F60jBl7gQa3H78H3Y0txjaiv_0fDoOvxcdMmMKkDsyUqMSsMWxHk725yiiHCCLfrh8O1z4YTzHvnKhyp6Da-NYroOW3ZGjoBKy3azqku80C789l0iyqMbMesKd95J-X4EagrgU9L3Sa3U8cogeb0tjXbfawd0urKshkc5MgdBeJmALQKw/image-asset.jpeg?format=2500w',\n        },\n    ],\n    columns: 2,\n};\n/**\n * BOOKING FLOW SETTINGS\n */\nconst booking: any = {\n    booking_types: [\n        { display: 'Internal', value: 'internal' },\n        { display: 'Client', value: 'client' },\n        { display: 'External', value: 'external' },\n        { display: 'Setup', value: 'setup' },\n        { display: 'Training', value: 'training' },\n        { display: 'Interview', value: 'interview' },\n    ],\n    los_groups: {\n        ifs: 'Internal Firm Services',\n        deals: 'Deals',\n        assurance: 'Assurance',\n        tax: 'Tax',\n        consulting: 'Consulting',\n        ladies: 'Ladies',\n        it: 'IT',\n    },\n    capacity_filters: [\n        { display: '< 10', value: '0' },\n        { display: '10 - 15', value: '10' },\n        { display: '16 - 20', value: '16' },\n        { display: '21 - 25', value: '21' },\n        { display: '> 25', value: '26' },\n    ],\n    show_fields: [\n        'attendees',\n        'body',\n        'catering',\n        'date',\n        'duration',\n        'organiser',\n        'recurrence',\n        'title',\n        'type',\n        'configuration',\n    ],\n    html_body: true,\n    multiple_spaces: false,\n    desk_start: 9,\n    breakdown: 15,\n};\n/*===========================*\\\n||  SPACE LISTING SETTINGS   ||\n\\*===========================*/\nconst space_display: any = {\n    show_images: false,\n};\n/*===========================*\\\n||  USER DIRECTORY SETTINGS  ||\n\\*===========================*/\nconst directory: any = {\n    show_avatars: true,\n    min_search_length: 3,\n};\n/*===========================*\\\n||    SCHEULDE SETTINGS   ||\n\\*===========================*/\nconst schedule = {\n    legend: [\n        { name: 'Accepted', color: '#21A453' },\n        { name: 'Pending', color: '#ffbf1f' },\n        { name: 'Rejected', color: '#f44336' },\n    ],\n};\n/*===========================*\\\n||    EXPLORE MAP SETTINGS   ||\n\\*===========================*/\nconst explore: any = {\n    colors: {\n        'space-free': '#43a047',\n        'space-pending': '#ffb300',\n        'space-busy': '#e53935',\n        'space-not-bookable': '#ccc',\n        'space-unknown': '#000',\n        // 'desk-available': '#43a047',\n        // 'desk-available-stroke': '#1b5e20',\n        // 'desk-unavailable': '#e53935',\n        // 'desk-unavailable-stroke': '#b71c1c',\n        // 'desk-reserved': '#ffb300',\n        // 'desk-reserved-stroke': '#ff6f00',\n        // 'desk-not-bookable': '#fff',\n        // 'desk-not-bookable-stroke': '#ccc',\n        'zone-low': '#43a047',\n        'zone-medium': '#ffb300',\n        'zone-high': '#e53935',\n    },\n    can_select_building: true,\n    show_legend_group_names: true,\n    legend: {\n        Spaces: [\n            { key: 'space-free', name: 'Space Available' },\n            { key: 'space-pending', name: 'Space Pending' },\n            { key: 'space-busy', name: 'Space in Use' },\n            { key: 'space-not-bookable', name: 'Space not Bookable' },\n            { key: 'space-unknown', name: 'Unknown' },\n        ],\n    },\n};\n/**\n * ROOT APPLICATION SETTINGS\n */\nconst app: any = {\n    name: 'Workplace',\n    title: 'Workplace Application',\n    description: 'PlaceOS Workplace UI written with Angular Framework',\n    short_name: 'STAFF',\n    logo_light: {\n        type: 'img',\n        src: 'assets/logo-light.svg',\n    },\n    logo_dark: {\n        type: 'img',\n        src: 'assets/logo-dark.svg',\n    },\n    general,\n    help,\n    booking,\n    space_display,\n    directory,\n    explore,\n    analytics: {\n        enabled: true,\n        tracking_id: '',\n    },\n    schedule,\n};\n\n/**\n * ROOT SETTIGNS\n */\nexport const DEFAULT_SETTINGS: any = {\n    debug: true,\n    composer: {\n        domain: '',\n        route: '/staff',\n        protocol: '',\n        port: '',\n        use_domain: false,\n        local_login: false,\n    },\n    app,\n};\n","// IMPORTANT: THIS FILE IS AUTO GENERATED! DO NOT MANUALLY EDIT OR CHECKIN!\n/* tslint:disable */\nexport const VERSION = {\n    \"dirty\": false,\n    \"raw\": \"c2d9373\",\n    \"hash\": \"c2d9373\",\n    \"distance\": null,\n    \"tag\": null,\n    \"semver\": null,\n    \"suffix\": \"c2d9373\",\n    \"semverString\": null,\n    \"version\": \"0.0.0\",\n    \"time\": 1624505717800\n};\n/* tslint:enable */\n","import { Injectable } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { format, isSameDay } from 'date-fns';\n\nimport { log, getItemWithKeys } from './general';\nimport { DEFAULT_SETTINGS } from './settings';\nimport { HashMap } from './types';\nimport { BaseClass } from './base.class';\n\nimport { VERSION } from './version';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n        application: HashMap;\n    }\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SettingsService extends BaseClass {\n    /** Name of the application */\n    private _app_name = 'PlaceOS';\n    /** List of override settings in order of priority */\n    private _overrides = new BehaviorSubject<HashMap[]>([]);\n    /** Mapping of behaviour subjects */\n    private _subjects: HashMap<BehaviorSubject<any>> = {};\n    /** Mapping of observables */\n    private _observables: HashMap<Observable<any>> = {};\n\n    /**\n     * @hidden\n     */\n    public set overrides(value: HashMap[]) {\n        this._overrides.next(value);\n    }\n\n    /** Get observable for key */\n    public listen<T = any>(name: string): Observable<T> {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        return this._observables[name];\n    }\n\n    /** Update observable value for key */\n    public post<T>(name: string, value: T): void {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        this._subjects[name].next(value);\n    }\n\n    public value<T = any>(name: string): T {\n        return !this._observables[name]\n            ? null\n            : this._subjects[name].getValue();\n    }\n\n    /** Page title */\n    public get title() {\n        return this._title.getTitle();\n    }\n    public set title(value: string) {\n        this._title.setTitle(\n            `${value} | ${this.get('app.name') || this._app_name}`\n        );\n    }\n\n    constructor(private _title: Title) {\n        super();\n        const now = new Date();\n        const time = new Date(VERSION.time);\n        const built = isSameDay(now, time)\n            ? `Today at ${format(time, 'h:mma')}`\n            : format(time, 'do MMM yyyy, h:mma');\n        log('CORE', `${VERSION.semver}`, null, 'debug', true);\n        log('APP', `${VERSION.hash} | Built: ${built}`, null, 'debug', true);\n        this.init();\n    }\n\n    /**\n     * Initialise the settings\n     */\n    public async init() {\n        if (this.get('debug')) {\n            window.debug = true;\n        }\n        if (this.get('app')?.name) {\n            this._app_name = this.get('app').name;\n        }\n        log('Settings', 'Successfully loaded settings');\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.settings = this;\n        }\n    }\n\n    /** Whether settings service has initialised */\n    public get app_name() {\n        return this._app_name;\n    }\n\n    /**\n     * Get a setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public get<T = any>(key: string): T {\n        const keys = key.split('.');\n        if (keys[0] !== 'app') {\n            return getItemWithKeys(keys, DEFAULT_SETTINGS);\n        }\n        const override_settings = this._overrides.getValue();\n        for (const override of override_settings) {\n            const value = getItemWithKeys(keys.slice(1), override);\n            if (value != null) {\n                return value;\n            }\n        }\n        return getItemWithKeys(keys, DEFAULT_SETTINGS);\n    }\n}\n","import { trigger, transition, style, animate, state } from '@angular/animations';\n\nexport const ANIMATION_SHOW_ENTER_LEAVE = trigger('show', [\n    transition(':enter', [\n        style({ opacity: 0, height: 0 }),\n        animate(300, style({ opacity: 1, height: '*' }))\n    ]),\n    transition(':leave', [\n        style({ opacity: 1, height: '*' }),\n        animate(300, style({ opacity: 0, height: 0 }))\n    ])\n]);\n\nexport const ANIMATION_SHOW_CONTRACT_EXPAND = trigger('show', [\n    state('show', style({ opacity: 1, height: '*' })),\n    state('hide', style({ opacity: 0, height: 0, 'pointer-events': 'none' })),\n    transition('show <=> hide', animate('200ms ease-in'))\n]);\n","import { MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';\n\nlet _service: MatSnackBar;\n\nexport function setNotifyOutlet(snackbar: MatSnackBar) {\n    _service = snackbar;\n}\n\n/**\n * Create notification popup\n * @param type CSS Class to add to the notification\n * @param message Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notify(\n    type: string,\n    message: string,\n    action: string = 'OK',\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    if (!_service) {\n        throw new Error(\"Snackbar service hasn't been initialised\");\n    }\n    const snackbar_ref = _service.open(message, action, {\n        panelClass: [type],\n        duration: 5000,\n        ...config,\n    });\n    if (action) {\n        on_action = on_action || (() => snackbar_ref.dismiss());\n        snackbar_ref.onAction().subscribe(() => on_action());\n    }\n}\n\n/**\n * Create success notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifySuccess(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.debug(msg);\n    notify('success', msg, action, on_action, config);\n}\n\n/**\n * Create error notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyError(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.error(msg);\n    notify('error', msg, action, on_action, config);\n}\n\n/**\n * Create warning notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyWarn(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.warn(msg);\n    notify('warn', msg, action, on_action, config);\n}\n\n/**\n * Create info notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyInfo(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.info(msg);\n    notify('info', msg, action, on_action, config);\n}\n","import { SwUpdate } from '@angular/service-worker';\n\nimport { log } from './general';\nimport { Subscription } from 'rxjs';\nimport { notifyInfo } from './notifications';\n\nlet _available: Subscription;\nlet _activated: Subscription;\nlet _timer: number;\n\nexport type Notification = (message: string, callback: () => void) => void;\n\n/**\n * Setup handler for cache change events\n * @param cache Angular Service worker service\n * @param notify Function to call on changes to the cache\n * @param interval Time interval to check the cache for changes\n */\nexport function setupCache(\n    cache: SwUpdate,\n    notify: Notification = () => null,\n    interval: number = 5 * 60 * 1000\n) {\n    if (cache.isEnabled) {\n        if (_available) _available.unsubscribe();\n        if (_activated) _activated.unsubscribe();\n        if (_timer) clearInterval(_timer);\n        _available = cache.available.subscribe((event) => {\n            const current = `current version is ${event.current.hash}`;\n            const available = `available version is ${event.available.hash}`;\n            log('CACHE', `Update available: ${current} ${available}`);\n            activateUpdate(cache);\n        });\n        _activated = cache.activated.subscribe(() => {\n            log('CACHE', `Updates activated. Reloading...`);\n            notify('Newer version of the application is available', () =>\n                location.reload(true)\n            );\n        });\n        _timer = <any>setInterval(() => {\n            log('CACHE', `Checking for updates...`);\n            cache.checkForUpdate();\n        }, interval);\n    }\n}\n\n/**\n * Update the cache and reload the page\n *\n */\nfunction activateUpdate(cache: SwUpdate) {\n    if (cache.isEnabled) {\n        log('CACHE', `Activating changes to the cache...`);\n        cache.activateUpdate().then(() => {\n            notifyInfo('Newer version of the application is available', 'Refresh', () =>\n                location.reload(true)\n            );\n        });\n    }\n}\n","\nimport { format } from 'date-fns';\n\nimport { RecurrenceDetails } from '@placeos/events';\n\nexport function formatRecurrence(details: RecurrenceDetails): string {\n    let pattern: string = details.pattern || '';\n    pattern = pattern.charAt(0).toUpperCase() + pattern.slice(1);\n    return pattern ? `${pattern} until ${format(new Date(details.end), 'do MMM yyyy')}` : '<No Recurrence>';\n}\n","import { PlaceAuthOptions, setup } from '@placeos/ts-client';\nimport { notifyInfo } from './notifications';\n\nexport interface PlaceSettings {\n    /** Protocol used by the application server */\n    protocol: 'http:' | 'https:';\n    /** Domain that the API server lies  */\n    domain: string;\n    /** Port number of the API server */\n    port: number;\n    /** Route on domain application rests */\n    route: string;\n    /** Whether to use the settings domain for auth */\n    use_domain: boolean;\n    /** Whether login is handled locally by the application */\n    local_login: boolean;\n    /** Whether application should mock out API requests */\n    mock: boolean;\n}\n\n/**\n * Initialise the PlaceOS API library\n */\nexport async function setupPlace(settings: PlaceSettings): Promise<void> {\n    const protocol = settings.protocol || location.protocol;\n    const host = settings.domain || location.hostname;\n    const port = settings.port || location.port;\n    const url = settings.use_domain\n        ? `${protocol}//${host}:${port}`\n        : location.origin;\n    const route = (location.pathname + '/').replace('//', '/');\n    console.log(\n        'Mock:',\n        settings.mock,\n        location.href.includes('mock=true'),\n        localStorage.getItem('mock') === 'true'\n    );\n    const mock =\n        settings.mock ||\n        location.href.includes('mock=true') ||\n        localStorage.getItem('mock') === 'true';\n    // Generate configuration object\n    const config: PlaceAuthOptions = {\n        auth_type: 'auth_code',\n        scope: 'public',\n        host: `${host}${port ? ':' + port : ''}`,\n        auth_uri: `${url}/auth/oauth/authorize`,\n        token_uri: `${url}/auth/oauth/token`,\n        redirect_uri: `${location.origin}${route}oauth-resp.html`,\n        handle_login: !settings.local_login,\n        use_iframe: true,\n        mock,\n    };\n    if (localStorage) {\n        localStorage.setItem(\n            'mock',\n            `${!!mock && !location.href.includes('mock=false')}`\n        );\n    }\n    if (mock) {\n        notifyInfo('Application in mock mode.');\n    }\n    return setup(config);\n}\n","import { showUser } from '@placeos/ts-client';\nimport { BehaviorSubject } from 'rxjs';\nimport { delay, map, retry } from 'rxjs/operators';\n\nimport { StaffUser } from '../../../users/src/lib/user.class';\n\nconst _current_user = new BehaviorSubject<StaffUser>(null);\n\nexport const current_user = _current_user.asObservable();\n\ndeclare let jest;\n\nsetTimeout(() => {\n    try {\n        if (jest) return;\n    } catch {}\n    showUser('current')\n        .pipe(\n            delay(1000),\n            retry(10),\n            map((i) => new StaffUser(i))\n        )\n        .subscribe((user) => _current_user.next(user));\n}, 300);\n\n/** Get the current user details */\nexport function currentUser() {\n    return _current_user.getValue();\n}\n","import { HashMap } from \"./types\";\n\n/**\n * Convert map into a query string\n * @param map Key value pairs to convert\n */\nexport function toQueryString(map: HashMap) {\n    let str = '';\n    if (map) {\n        for (const key in map) {\n            if (map.hasOwnProperty(key) && map[key] !== undefined && map[key] !== null) {\n                str += `${(str ? '&' : '')}${key}=${map[key]}`;\n            }\n        }\n    }\n    return str;\n}\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class BaseClass implements OnDestroy {\n    /** Store for named timers */\n    protected _timers: { [name: string]: number } = {};\n    /** Store for named intervals */\n    protected _intervals: { [name: string]: number } = {};\n    /** Store for named subscription unsub callbacks */\n    protected _subscriptions: {\n        [name: string]: Subscription | (() => void);\n    } = {};\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n\n    /** Whether the object has been initialised */\n    public get is_initialised(): boolean {\n        return this._initialised.getValue();\n    }\n\n    public ngOnDestroy(): void {\n        this.destroy();\n    }\n\n    protected destroy() {\n        for (const key in this._timers) {\n            if (key in this._timers) {\n                this.clearTimeout(key);\n            }\n        }\n        for (const key in this._intervals) {\n            if (key in this._intervals) {\n                this.clearInterval(key);\n            }\n        }\n        for (const key in this._subscriptions) {\n            if (key in this._subscriptions) {\n                this.unsub(key);\n            }\n        }\n    }\n\n    /**\n     * Creates a named timer\n     * @param name Name of the timer\n     * @param fn Callback function for the timer\n     * @param delay Callback delay\n     */\n    protected timeout(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearTimeout(name);\n            this._timers[name] = <any>setTimeout(() => {\n                fn();\n                this._timers[name] = null;\n            }, delay);\n        } else {\n            throw new Error(\n                name\n                    ? 'Cannot create named timeout without a name'\n                    : 'Cannot create a timeout without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named timer\n     * @param name Timer name\n     */\n    protected clearTimeout(name: string) {\n        if (this._timers[name]) {\n            clearTimeout(this._timers[name]);\n            this._timers[name] = null;\n        }\n    }\n\n    /**\n     * Creates a named interval\n     * @param name Name of the interval\n     * @param fn Callback function for the interval\n     * @param delay Callback delay\n     */\n    protected interval(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearInterval(name);\n            this._intervals[name] = <any>setInterval(() => fn(), delay);\n        } else {\n            throw new Error(\n                name\n                    ? 'Cannot create named interval without a name'\n                    : 'Cannot create a interval without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named interval\n     * @param name Timer name\n     */\n    protected clearInterval(name: string) {\n        if (this._intervals[name]) {\n            clearInterval(this._intervals[name]);\n            this._intervals[name] = null;\n        }\n    }\n\n    /**\n     * Store named subscription\n     * @param name Name of the subscription\n     * @param unsub Unsubscribe callback or Subscription object\n     */\n    protected subscription(name: string, unsub: Subscription | (() => void)) {\n        this.unsub(name);\n        this._subscriptions[name] = unsub;\n    }\n\n    /**\n     * Call unsubscribe callback with the given name\n     * @param name\n     */\n    protected unsub(name: string) {\n        if (this._subscriptions && this._subscriptions[name]) {\n            this._subscriptions[name] instanceof Subscription\n                ? (this._subscriptions[name] as Subscription).unsubscribe()\n                : (this._subscriptions[name] as any)();\n            this._subscriptions[name] = null;\n        }\n    }\n\n    /** Unsubscribe to the items with names containing the given string */\n    protected unsubWith(contains: string) {\n        const subs = Object.keys(this._subscriptions).filter((k) =>\n            k.includes(contains)\n        );\n        for (const key of subs) {\n            this.unsub(key);\n        }\n    }\n}\n","import { FormGroup } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\nimport { first } from 'rxjs/operators';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA\n} from '../../../components/src/lib/confirm-modal.component';\nimport { HashMap } from './types';\n\n\n/** Available console output streams. */\nexport type ConsoleStream = 'debug' | 'warn' | 'log' | 'error';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n    }\n}\n\nlet _app_name = 'APP';\n\nexport function setAppName(name: string) {\n    _app_name = name;\n}\n\n/**\n * Log data to the browser console\n * @param type Type of message\n * @param msg Message body\n * @param args array of argments to log to the console\n * @param stream Stream to emit the console on. 'debug', 'log', 'warn' or 'error'\n * @param force Whether to force message to be emitted when debug is disabled\n */\nexport function log(\n    type: string,\n    msg: string,\n    args?: any,\n    stream: ConsoleStream = 'debug',\n    force: boolean = false,\n    app_name: string = _app_name\n) {\n    if (window.debug || force) {\n        const colors: string[] = [\n            'color: #E91E63',\n            'color: #3F51B5',\n            'color: default',\n        ];\n        if (args) {\n            console[stream](\n                `%c[${app_name}]%c[${type}] %c${msg}`,\n                ...colors,\n                args\n            );\n        } else {\n            console[stream](`%c[${app_name}]%c[${type}] %c${msg}`, ...colors);\n        }\n    }\n}\n\n/**\n * Get item from the nested object\n * @param keys List of sub-keys to search for\n * @param map Object to search\n */\nexport function getItemWithKeys(keys: string[], map: HashMap) {\n    const key = keys.shift();\n    if (map && map[key] != null) {\n        return keys.length > 0 ? getItemWithKeys(keys, map[key]) : map[key];\n    }\n    return null;\n}\n\n/**\n * Remove duplicates from the given array\n * @param array List of items to remove duplicates from\n * @param key Key on array objects to compare for uniqueness\n */\nexport function unique<T = any>(array: T[] = [], key: string = ''): T[] {\n    return array.filter(\n        (el, pos, arr) =>\n            arr.indexOf(\n                key\n                    ? arr.find((i) => i[key] === el[key])\n                    : arr.find((i) => i === el)\n            ) === pos\n    );\n}\n\n/**\n * Generate a random number\n * @param ceil Biggest value to generate not inclusive\n * @param floor Smallest value to generate. Defaults to 0\n */\nexport function randomInt(ceil: number, floor: number = 0) {\n    return Math.floor(Math.random() * (ceil - floor)) + floor;\n}\n\nexport async function openConfirmModal(\n    data: ConfirmModalData,\n    dialog: MatDialog\n) {\n    const ref = dialog.open<ConfirmModalComponent, ConfirmModalData>(\n        ConfirmModalComponent,\n        {\n            ...CONFIRM_METADATA,\n            data,\n        }\n    );\n    return {\n        ...(await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ])),\n        loading: (s) => (ref.componentInstance.loading = s),\n        close: () => ref.close(),\n    };\n}\n\n/**\n * Parse raw CSV data into a JSON object\n * @param csv CSV data to parse\n */\nexport function csvToJson(csv: string, delimiter: string = ','): HashMap[] {\n    const objPattern = new RegExp(\n        '(\\\\,|\\\\r?\\\\n|\\\\r|^)(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|([^\\\\,\\\\r\\\\n]*))',\n        'gi'\n    );\n    let arrMatches = null,\n        arrData = [[]];\n    while ((arrMatches = objPattern.exec(csv))) {\n        if (arrMatches[1].length && arrMatches[1] !== ',') arrData.push([]);\n        arrData[arrData.length - 1].push(\n            arrMatches[2]\n                ? arrMatches[2].replace(new RegExp('\"\"', 'g'), '\"')\n                : arrMatches[3]\n        );\n    }\n    const headers: string[] = arrData.splice(0, 1)[0];\n    const elements = arrData.map((row) => {\n        const element = {};\n        for (let i = 0; i < row.length; i++) {\n            try {\n                element[headers[i]] = JSON.parse(row[i]);\n            } catch (e) {\n                element[headers[i]] = row[i] || '';\n            }\n        }\n        return element;\n    });\n    return elements;\n}\n\n/**\n * Convert javascript array to CSV string\n * @param json Javascript array to convert\n */\nexport function jsonToCsv(json: HashMap[]) {\n    if (json instanceof Array && json.length > 0) {\n        const keys = Object.keys(json[0]);\n        const valid_keys = keys.filter((key) => json[0].hasOwnProperty(key));\n        return `${valid_keys.join(',')}\\n${json\n            .map((item) =>\n                valid_keys.map((key) => JSON.stringify(item[key])).join(',')\n            )\n            .join('\\n')}`;\n    }\n    return '';\n}\n\n/**\n * Downloads a file to the users computer with the given filename and contents\n * @param filename Name of the file to download\n * @param contents Contents of the file to download\n */\nexport function downloadFile(filename: string, contents: string) {\n    const element = document.createElement('a');\n    element.setAttribute(\n        'href',\n        'data:text/plain;charset=utf-8,' + encodeURIComponent(contents)\n    );\n    element.setAttribute('download', filename);\n\n    element.style.display = 'none';\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n}\n\nexport function parseJWT(token: string) {\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(\n        atob(base64)\n            .split('')\n            .map((c) => {\n                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n            })\n            .join('')\n    );\n    return JSON.parse(jsonPayload);\n}\n\n/* istanbul ignore next */\n/**\n * Flatten nested array\n * @param an_array Array to flatten\n */\nexport function flatten<T = any>(an_array: T[]) {\n    const stack = [...an_array];\n    const res = [];\n    while (stack.length) {\n        // pop value from stack\n        const next = stack.pop();\n        if (Array.isArray(next)) {\n            // push back array items, won't modify the original input\n            stack.push(...next);\n        } else {\n            res.push(next);\n        }\n    }\n    // reverse to restore input order\n    return res.reverse();\n}\n\n/**\n * Check whether two time periods intersect with each other\n * @param start1 Unix epoch in ms of the first period's start time\n * @param end1 Unix epoch in ms of the first period's end time\n * @param start2 Unix epoch in ms of the second period's start time\n * @param end2 Unix epoch in ms of the second period's end time\n */\nexport function timePeriodsIntersect(start1, end1, start2, end2) {\n    return (\n        (start1 >= start2 && start1 < end2) ||\n        (end1 > start2 && end1 < end2) ||\n        (start2 >= start1 && start2 < end1) ||\n        (end2 > start1 && end2 <= end1)\n    );\n}\n\nconst seed = xmur3('PlaceOS');\nconst rand = sfc32(0x9e3779b9, 0x243f6a88, 0xb7e15162, seed());\n\nexport function predictableRandomInt(ceil: number = 100, floor: number = 0) {\n    return Math.floor(rand() * (ceil - floor)) + floor;\n}\n\n// https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript\nfunction xmur3(str) {\n    for (var i = 0, h = 1779033703 ^ str.length; i < str.length; i++)\n        (h = Math.imul(h ^ str.charCodeAt(i), 3432918353)),\n            (h = (h << 13) | (h >>> 19));\n    return function () {\n        h = Math.imul(h ^ (h >>> 16), 2246822507);\n        h = Math.imul(h ^ (h >>> 13), 3266489909);\n        return (h ^= h >>> 16) >>> 0;\n    };\n}\n\nfunction sfc32(a, b, c, d) {\n    return function () {\n        a >>>= 0;\n        b >>>= 0;\n        c >>>= 0;\n        d >>>= 0;\n        let t = (a + b) | 0;\n        a = b ^ (b >>> 9);\n        b = (c + (c << 3)) | 0;\n        c = (c << 21) | (c >>> 11);\n        d = (d + 1) | 0;\n        t = (t + d) | 0;\n        c = (c + t) | 0;\n        return (t >>> 0) / 4294967296;\n    };\n}\n\n/** Get time format string for locale */\nexport function timeFormatString(): string {\n    return is24HourTime() ? 'HH:mm' : 'h:mm a';\n}\n\n/** Whether locale string is displayed in 24 hour time */\nexport function is24HourTime(): boolean {\n    const date = new Date();\n    const localeString = date\n        .toLocaleTimeString(\n            document.querySelector('html').getAttribute('lang') ||\n                navigator.language\n        )\n        .toLowerCase();\n    return localeString.indexOf('am') < 0 && localeString.indexOf('pm') < 0;\n}\n\nexport function getInvalidFields(form: FormGroup) {\n    const invalid = [];\n    for (const key in form.controls) {\n        if (!form.controls[key].valid) {\n            invalid.push(key)\n        }\n    }\n    return invalid;\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from '@placeos/common';\n\n@Component({\n    selector: 'action-icon',\n    template: `\n        <button\n            mat-icon-button\n            class=\"relative flex items-center justify-center h-8 w-8\"\n            [class.success]=\"state === 'success'\"\n            [disabled]=\"loading || disabled\"\n        >\n            <app-icon root [className]=\"className\" [icon]=\"icon\">\n                {{ content }}\n                <ng-content></ng-content>\n            </app-icon>\n            <div [class]=\"'state center ' + state\" *ngIf=\"!loading && state\">\n                <app-icon>\n                    {{ state === 'success' ? 'done' : 'close' }}\n                </app-icon>\n            </div>\n            <div class=\"loader center\" *ngIf=\"loading\">\n                <mat-spinner [diameter]=\"16\"></mat-spinner>\n            </div>\n        </button>\n    `,\n    styles: [\n        `\n            .action-icon.fade > app-icon {\n                opacity: 0.35;\n            }\n\n            [center] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n\n            .success {\n                pointer-events: none;\n            }\n\n            .success app-icon[root] {\n                opacity: 0.2;\n            }\n\n            .state.success {\n                color: #388e3c;\n            }\n\n            .state.error {\n                color: #e53935;\n            }\n        `,\n    ],\n})\nexport class ActionIconComponent {\n    /** Icon to display */\n    @Input() public icon: ApplicationIcon;\n    /** Icon to display */\n    @Input() public className: string = 'material-icons';\n    /** Icon to display */\n    @Input() public content: string;\n    /** Whether action is being processed */\n    @Input() public loading: boolean;\n    /** Whether action is being processed */\n    @Input() public disabled: boolean;\n    /** State of the action */\n    @Input() public state: 'success' | 'error' | '' = '';\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { ApplicationIcon, BaseClass } from '@placeos/common';\n\nexport interface PopoutAction extends ApplicationIcon {\n    /** ID of the action */\n    id: string;\n}\n\n@Component({\n    selector: 'a-popout-menu',\n    template: `\n        <button\n            mat-icon-button\n            class=\"small absolute text-base center shadow\"\n            *ngFor=\"let item of actions; let i = index\"\n            [style.top]=\"show ? -110 * i - 60 + '%' : ''\"\n            (click)=\"action.emit(item.id); show = false\"\n        >\n            <app-icon [icon]=\"item\"></app-icon>\n        </button>\n        <button\n            name=\"root\"\n            mat-icon-button\n            [class.show]=\"show\"\n            (click)=\"show = !show\"\n            (window:click)=\"show ? close() : ''\"\n        >\n            <app-icon>{{ show ? 'add' : 'more_vert' }}</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n\n            app-icon {\n                transition: transform 200ms;\n            }\n\n            button {\n                background-color: #fff;\n                color: rgba(#000, 0.85);\n                font-size: 1.25rem;\n                height: 2.5em;\n                width: 2.5em;\n            }\n\n            button.show app-icon {\n                transform: rotate(45deg);\n            }\n\n            button.small {\n                transition: top 200ms, left 200ms;\n            }\n        `,\n    ],\n})\nexport class PopoutMenuComponent extends BaseClass {\n    /** List of available actions */\n    @Input() public actions: PopoutAction[] = [];\n    /** Emitter for user actions */\n    @Output() public action = new EventEmitter<string>();\n    /** Whether actions should show */\n    public show: boolean;\n\n    public close() {\n        this.timeout('close', () => (this.show = false));\n    }\n}\n","import { Component, Inject, OnInit } from '@angular/core';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapPinData {\n    message: string;\n    fill: string;\n    stroke: string;\n    action?: () => void;\n}\n\n@Component({\n    selector: '[map-pin]',\n    template: `\n        <div\n            name=\"message\"\n            *ngIf=\"message && show_message\"\n            class=\"p-2 m-2 rounded bg-white text-gray-700 shadow\"\n        >\n            {{ message }}\n        </div>\n        <svg\n            *ngIf=\"show\"\n            name=\"pin\"\n            viewBox=\"0 0 380 560\"\n            [class.action]=\"action\"\n            (click)=\"action()\"\n        >\n            <g>\n                <path\n                    [style.fill]=\"fill\"\n                    [style.stroke]=\"stroke\"\n                    stroke-width=\"25\"\n                    d=\"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n            C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n            c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z\"\n                />\n            </g>\n        </svg>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                bottom: 0;\n                left: 50%;\n                width: 24rem;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                transform: translateX(-50%);\n                z-index: -1;\n            }\n\n            div {\n                animation: fade-in-top 1s;\n            }\n\n            .action {\n                pointer-events: auto;\n            }\n\n            svg {\n                width: 2rem;\n                animation: fade-in-top 1s;\n            }\n\n            @keyframes fade-in-top {\n                0% {\n                    opacity: 0;\n                    transform: translateY(-100%);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translateY(0%);\n                }\n            }\n        `,\n    ],\n})\nexport class MapPinComponent implements OnInit {\n    /** Message to display above the pin */\n    public readonly message = this._details.message;\n    /** Fill colour for the pin SVG */\n    public readonly fill = this._details.fill || '#e53935';\n    /** Stroke colour for the pin SVG */\n    public readonly stroke = this._details.stroke || '#fff';\n    /** Action to perform when clicking pin */\n    public readonly action = this._details.action || null;\n\n    public show: boolean;\n    public show_message: boolean;\n\n    constructor(@Inject(MAP_FEATURE_DATA) private _details: MapPinData) {}\n\n    public ngOnInit() {\n        setTimeout(() => (this.show = true), 300);\n        setTimeout(() => (this.show_message = true), 1000);\n    }\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\nimport { formatDistanceToNow } from 'date-fns';\nimport { Observable } from 'rxjs';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapRadiusData {\n    message: string;\n    radius: number;\n    fill: string;\n    stroke: string;\n    last_seen?: number;\n    zoom: Observable<number>;\n}\n\n@Component({\n    selector: '[map-radius]',\n    template: `\n        <ng-container *ngIf=\"show && radius\" (window:resize)=\"updateRadius()\">\n            <div\n                class=\"center border-4 rounded-full border-dashed\"\n                [style.border-color]=\"stroke\"\n                [style.background-color]=\"fill + '40'\"\n                [style.width]=\"radius * zoom + 'px'\"\n                [style.height]=\"radius * zoom + 'px'\"\n            ></div>\n            <div\n                *ngIf=\"message && show_message\"\n                name=\"message\"\n                [style.top]=\"'-' + (radius / 2) * zoom + 'px'\"\n                class=\"p-2 m-2 rounded bg-white text-gray-700 shadow absolute top-0 whitespace-no-wrap flex flex-col\"\n            >\n                {{ message }}\n                <span *ngIf=\"last_seen\" class=\"text-xs\">\n                    Last updated: {{ last_seen_at }}\n                </span>\n            </div>\n        </ng-container>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                height: 100%;\n                width: 100%;\n            }\n\n            [name='message'] {\n                transform: translate(-50%, -120%);\n            }\n\n            div {\n                animation: fade-in-top 1s;\n            }\n\n            @keyframes fade-in-top {\n                0% {\n                    opacity: 0;\n                    transform: translate(-50%, -220%);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translate(-50%, -120%);\n                }\n            }\n        `,\n    ],\n})\nexport class MapRadiusComponent implements OnInit {\n    public zoom = 1;\n    /** Size of the area marked by this component */\n    public radius = this._details.radius || 10;\n    /** Message to display above the pin */\n    public readonly message = this._details.message;\n    /** Fill colour for the pin SVG */\n    public readonly fill = this._details.fill || '#e53935';\n    /** Stroke colour for the pin SVG */\n    public readonly stroke = this._details.stroke || '#e53935';\n\n    public readonly last_seen: number = this._details.last_seen || 0;\n\n    public get last_seen_at() {\n        return formatDistanceToNow(this.last_seen * 1000) + ' ago';\n    }\n\n    public show: boolean;\n    public show_message: boolean;\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: MapRadiusData,\n        private _el: ElementRef<HTMLElement>\n    ) {\n        this._details.zoom.subscribe((v) =>\n            Math.max(0.5, (this.zoom = v || 1))\n        );\n    }\n\n    public ngOnInit() {\n        setTimeout(() => (this.show = true), 300);\n        setTimeout(() => (this.show_message = true), 1000);\n    }\n\n    public ngAfterViewInit() {\n        this.updateRadius();\n    }\n\n    public updateRadius() {\n        const box = this._el.nativeElement.getBoundingClientRect();\n        if (!box.width) return setTimeout(() => this.updateRadius(), 300);\n        this.radius = Math.max(\n            64,\n            (this._details.radius || 10) * (box.width || 10)\n        );\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationLink } from '@placeos/common';\n\n@Component({\n    selector: 'status-overlay',\n    template: `\n        <div\n            status-overlay\n            class=\"fixed inset-0 flex flex-col bg-secondary items-center justify-center z-50 text-white\"\n        >\n            <ng-container *ngIf=\"!loading; else load_state\">\n                <div\n                    class=\"text-4xl rounded-full bg-white mb-4\"\n                    [class.text-success]=\"!error\"\n                    [class.text-error]=\"error\"\n                >\n                    <app-icon>{{ error ? 'close' : 'done' }}</app-icon>\n                </div>\n                <div class=\"text-center text-lg mb-4\">\n                    <ng-container *ngIf=\"!error; else error_msg\">\n                        <ng-content></ng-content>\n                    </ng-container>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <a\n                        button\n                        mat-button\n                        class=\"w-32\"\n                        *ngFor=\"let link of links\"\n                        [routerLink]=\"[link.route]\"\n                    >\n                        {{ link.name }}\n                    </a>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #error_msg\n            ><p error>{{ error }}</p></ng-template\n        >\n        <ng-template #load_state>\n            <mat-spinner [diameter]=\"32\" class=\"mb-4\"></mat-spinner>\n            <p loading class=\"text-center text-lg\">{{ loading }}</p>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class StatusOverlayComponent {\n    /** Whether overlay is loading */\n    @Input() public loading: string = '';\n    /** Details about any errors that have occurred */\n    @Input() public error: string = '';\n    /** Links to display on success */\n    @Input() public links: ApplicationLink[] = [];\n}\n","import { Component, OnInit, ViewChild, ElementRef } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport {\n    ApplicationIcon,\n    BaseClass,\n    SettingsService,\n} from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\n@Component({\n    selector: 'app-login',\n    template: `\n        <div class=\"fixed inset-0 overflow-auto\">\n            <form\n                class=\"flex flex-col items-center overflow-hidden mx-auto my-4 bg-white rounded shadow p-4\"\n            >\n                <div\n                    class=\"flex items-center justify-center\"\n                    [style.background-color]=\"logo?.background\"\n                >\n                    <i *ngIf=\"logo?.type === 'icon'\" [class]=\"logo.class\">\n                        {{ logo.content }}\n                    </i>\n                    <img\n                        *ngIf=\"logo?.type === 'img'\"\n                        [src]=\"logo.src | safe: 'resource'\"\n                    />\n                </div>\n                <div class=\"w-full relative h-1/3 flex-1\">\n                    <ng-container *ngIf=\"!loading; else loading_state\">\n                        <div class=\"flex flex-col\">\n                            <label\n                                for=\"username\"\n                                [class.focused]=\"\n                                    username || focus === 'username'\n                                \"\n                                [class.in-focus]=\"focus === 'username'\"\n                            >\n                                Username\n                            </label>\n                            <mat-form-field appearance=\"outline\">\n                                <input\n                                    #username\n                                    formControlName=\"username\"\n                                    (keyup.enter)=\"toPassword()\"\n                                />\n                            </mat-form-field>\n                        </div>\n                        <div class=\"flex flex-col\">\n                            <label for=\"password\">Password</label>\n                            <mat-form-field appearance=\"outline\">\n                                <input\n                                    #pass_field\n                                    formControlName=\"password\"\n                                    (keyup.enter)=\"login()\"\n                                />\n                                <mat-error>Invalid username or password</mat-error>\n                            </mat-form-field>\n                        </div>\n                    </ng-container>\n                </div>\n                <div class=\"flex items-center justify-center w-full\" *ngIf=\"!loading\">\n                    <button mat-button color=\"primary\" (click)=\"login()\">\n                        Login\n                    </button>\n                </div>\n            </form>\n        </div>\n        <ng-template #loading_state>\n            <div\n                class=\"absolute inset-0 flex flex-col items-center justify-center space-y-2\"\n            >\n                <mat-spinner diameter=\"64\"></mat-spinner>\n                <p>Checking user credentials...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                background-color: #f0f0f0;\n                background-image: url(\"data:image/svg+xml,%3Csvg width='64' height='64' viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 16c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zm33.414-6l5.95-5.95L45.95.636 40 6.586 34.05.636 32.636 2.05 38.586 8l-5.95 5.95 1.414 1.414L40 9.414l5.95 5.95 1.414-1.414L41.414 8zM40 48c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zM9.414 40l5.95-5.95-1.414-1.414L8 38.586l-5.95-5.95L.636 34.05 6.586 40l-5.95 5.95 1.414 1.414L8 41.414l5.95 5.95 1.414-1.414L9.414 40z' fill='%23ad1457' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E\");\n            }\n\n            form {\n                width: 20rem;\n                max-width: calc(100vw - 2rem);\n            }\n\n            img {\n                max-height: 3.75rem;\n                max-width: 15rem;\n            }\n        `,\n    ],\n})\nexport class LoginComponent implements OnInit {\n    /** Whether the user credentials are being checked */\n    public loading: boolean;\n\n    public readonly form = new FormGroup({\n        username: new FormControl('', [Validators.required]),\n        password: new FormControl('', [Validators.required]),\n    });\n\n    /** Password field element */\n    @ViewChild('pass_field', { static: true })\n    private pwd_field: ElementRef<HTMLInputElement>;\n\n    /** Logo of the application organisation */\n    public get logo(): ApplicationIcon {\n        return this._settings.get('app.logo_dark') || { type: 'icon' };\n    }\n\n    constructor(private _settings: SettingsService) {}\n\n    public async ngOnInit() {\n        this.loading = true;\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        this.loading = false;\n    }\n\n    /** Focus on the password field */\n    public toPassword() {\n        if (this.pwd_field && this.pwd_field.nativeElement) {\n            this.pwd_field.nativeElement.focus();\n        }\n    }\n\n    /** Perform user login */\n    public login() {\n        this.loading = true;\n        // this._users.login({\n        //     username: this.username,\n        //     password: this.password\n        // }, { form: true }).then(() => {\n        //     this.loading = false;\n        // }, () => {\n        //     this.loading = false;\n        //     this.error = true;\n        // });\n        this.form.setErrors({ password: 'Invalid username or password' });\n    }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'app-unauthorised',\n    template: `\n        <div\n            class=\"unauthorised rounded m-4 text-center bg-white text-black border border-gray-400 p-4 shadow\"\n        >\n            <h1 class=\"text-4xl\">403</h1>\n            <h3 class=\"text-2xl\" i18n=\"@@forbiddenLabel\">Access forbidden.</h3>\n            <p class=\"py-4\" i18n=\"@@invalidPermissionLabel\">\n                You do not have permission to view this page and your access\n                attempt has been recorded.\n            </p>\n            <p i18n=\"@@contactAdminLabel\">\n                Contact your Administrator if you feel that you should have\n                access.\n            </p>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .unauthorised {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                .unauthorised {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }\n        `,\n    ],\n})\nexport class UnauthorisedComponent {}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'app-misconfigured',\n    template: `\n        <div\n            content\n            class=\"rounded m-4 text-center bg-white text-black border border-gray-400 p-4 shadow\"\n        >\n            <h3 class=\"text-2xl\" i18n=\"@@forbiddenLabel\">\n                Application Misconfigured.\n            </h3>\n            <p class=\"py-4\" i18n=\"@@invalidPermissionLabel\">\n                This application requires a zone of type org, building and level\n                to operate.\n            </p>\n            <p i18n=\"@@contactAdminLabel\">\n                If this issue persists please contact your administrator.\n            </p>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            [content] {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                [content] {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }\n        `,\n    ],\n})\nexport class MisconfiguredComponent {}\n","import { Injectable, Optional } from '@angular/core';\nimport {\n    CanActivate,\n    CanLoad,\n    Route,\n    UrlSegment,\n    ActivatedRouteSnapshot,\n    RouterStateSnapshot,\n    UrlTree,\n    Router,\n} from '@angular/router';\nimport { onlineState } from '@placeos/ts-client';\nimport { current_user } from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\nimport { StaffUser } from '../../../users/src/lib/user.class';\n\nexport abstract class PLACEOS_APP_ACCESS {\n    public readonly group: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class AuthorisedUserGuard implements CanActivate, CanLoad {\n    constructor(\n        private _router: Router,\n        @Optional() private _access: PLACEOS_APP_ACCESS\n    ) {}\n\n    public async canActivate(\n        next?: ActivatedRouteSnapshot,\n        state?: RouterStateSnapshot\n    ): Promise<boolean | UrlTree> {\n        return this.checkUser();\n    }\n\n    public async canLoad(\n        route?: Route,\n        segments?: UrlSegment[]\n    ): Promise<boolean> {\n        return this.checkUser();\n    }\n\n    private async checkUser() {\n        await onlineState()\n            .pipe(first((_) => _))\n            .toPromise();\n        const user: StaffUser = await current_user\n            .pipe(first((_) => !!_))\n            .toPromise();\n        const can_activate = !!(\n            user &&\n            (!this._access?.group || user.groups.includes(this._access.group))\n        );\n        if (!can_activate) {\n            this._router.navigate(['/unauthorised']);\n        }\n        return !!can_activate;\n    }\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { ClipboardModule } from '@angular/cdk/clipboard';\nimport { MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { PortalModule } from '@angular/cdk/portal';\n\nimport { BindingDirective } from './binding.directive';\nimport { ActionIconComponent } from './action-icon.component';\nimport { IconComponent } from './icon.component';\nimport { PopoutMenuComponent } from './popout-menu.component';\nimport { UserAvatarComponent } from './user-avatar.component';\n\nimport { ConfirmModalComponent } from './confirm-modal.component';\nimport {\n    InteractiveMapComponent,\n    MAP_FEATURE_DATA,\n} from './interactive-map.component';\nimport { MapPinComponent } from './map-pin.component';\nimport { MapRadiusComponent } from './map-radius.component';\nimport { StatusOverlayComponent } from './status-overlay.component';\nimport { FixedPipe } from './fixed.pipe';\nimport { SafePipe } from './safe.pipe';\nimport { SanitizePipe } from './sanitise.pipe';\nimport { CustomTableComponent } from './custom-table.component';\nimport { CustomTooltipComponent } from './custom-tooltip.component';\nimport { VirtualKeyboardComponent } from './virtual-keyboard.component';\n\nexport * from './action-icon.component';\nexport * from './binding.directive';\nexport * from './confirm-modal.component';\nexport * from './icon.component';\nexport * from './login.component';\nexport * from './popout-menu.component';\nexport * from './unauthorised.component';\nexport * from './user-avatar.component';\nexport * from './interactive-map.component';\nexport * from './map-pin.component';\nexport * from './map-radius.component';\nexport * from './misconfigured.component';\nexport * from './status-overlay.component';\nexport * from './custom-table.component';\nexport * from './custom-tooltip.component';\nexport * from './fixed.pipe';\nexport * from './safe.pipe';\nexport * from './sanitise.pipe';\nexport * from './virtual-keyboard.component';\n\nexport * from './authorised-admin.guard';\nexport * from './authorised-user.guard';\n\nconst MAT_MODULES: any[] = [\n    MatAutocompleteModule,\n    MatMenuModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatButtonModule,\n    MatAutocompleteModule,\n    MatSelectModule,\n    MatDialogModule,\n    MatDatepickerModule,\n    MatInputModule,\n    ClipboardModule,\n    MatProgressSpinnerModule,\n    MatChipsModule,\n    MatPaginatorModule,\n    CdkTableModule,\n    PortalModule,\n];\n\nconst COMPONENTS: Type<any>[] = [\n    ActionIconComponent,\n    IconComponent,\n    PopoutMenuComponent,\n    UserAvatarComponent,\n\n    ConfirmModalComponent,\n    InteractiveMapComponent,\n    MapPinComponent,\n    MapRadiusComponent,\n    StatusOverlayComponent,\n    CustomTableComponent,\n    CustomTooltipComponent,\n    VirtualKeyboardComponent,\n\n    FixedPipe,\n    SafePipe,\n    SanitizePipe,\n];\n\nconst DIRECTIVES: Type<any>[] = [BindingDirective];\n\n@NgModule({\n    declarations: [...COMPONENTS, ...DIRECTIVES],\n    imports: [CommonModule, FormsModule, ReactiveFormsModule, ...MAT_MODULES],\n    providers: [\n        { provide: MAT_DATE_LOCALE, useValue: 'en-GB' },\n        { provide: MAP_FEATURE_DATA, useValue: {} },\n    ],\n    exports: [...COMPONENTS, ...DIRECTIVES, ...MAT_MODULES],\n})\nexport class ComponentsModule {}\n","import { Component, Output, EventEmitter, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { ApplicationIcon, DialogEvent } from 'libs/common/src/lib/types';\n\nexport interface ConfirmModalData {\n    /** Title of the modal */\n    title: string;\n    /** Contents of the modal */\n    content: string;\n    /** Text displaed on the confirmation button */\n    confirm_text?: string;\n    /** Text displaed on the confirmation button */\n    cancel_text?: string;\n    /** Icon to display on the modal */\n    icon: ApplicationIcon;\n}\n\nexport const CONFIRM_METADATA = {\n    height: 'auto',\n    width: '24em',\n    maxHeight: 'calc(100vh - 2em)',\n    maxWidth: 'calc(100vw - 2em)',\n};\n\n@Component({\n    selector: 'confirm-modal',\n    template: `\n        <header>\n            <h3 mat-dialog-title>{{ title }}</h3>\n        </header>\n        <main\n            *ngIf=\"!loading; else load_state\"\n            class=\"flex flex-col items-center space-y-2 p-4\"\n        >\n            <app-icon [icon]=\"icon\" class=\"text-5xl\"></app-icon>\n            <p\n                content\n                class=\"text-center text-sm w-[22rem]\"\n                [innerHTML]=\"content\"\n            ></p>\n        </main>\n        <footer\n            class=\"flex items-center justify-center p-2 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button mat-button class=\"inverse w-32\" mat-dialog-close>\n                {{ cancel_text }}\n            </button>\n            <button mat-button name=\"accept\" class=\"w-32\" (click)=\"onConfirm()\">\n                {{ confirm_text }}\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main loading>\n                <div class=\"h-48 w-64 flex flex-col items-center space-y-2\">\n                    <mat-spinner diameter=\"32\"></mat-spinner>\n                    <p>{{ loading }}</p>\n                </div>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class ConfirmModalComponent {\n    /** Loading state */\n    public loading: string;\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Title of the confirm modal */\n    public readonly title: string = this._data.title || 'Confirm';\n    /** Body of the confirm modal */\n    public readonly content: string = this._data.content || 'Are you sure?';\n    /** Display text on the confirm button */\n    public readonly confirm_text: string = this._data.confirm_text || 'Accept';\n    /** Display text on the cancel button */\n    public readonly cancel_text: string = this._data.cancel_text || 'Cancel';\n    /** Display icon properties */\n    public readonly icon: ApplicationIcon = this._data.icon || {\n        class: 'material-icons',\n        content: 'done',\n    };\n    /** Prevent user from closing the modal */\n    public readonly disableClose = () => (this._dialog_ref.disableClose = true);\n    /** Allow the user to close the modal */\n    public readonly enableClose = () => (this._dialog_ref.disableClose = false);\n\n    constructor(\n        private _dialog_ref: MatDialogRef<ConfirmModalComponent>,\n        @Inject(MAT_DIALOG_DATA) private _data: ConfirmModalData\n    ) {}\n\n    /** User confirmation of the content of the modal */\n    public onConfirm() {\n        this._dialog_ref.close('done');\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from '@placeos/common';\n\n@Component({\n    selector: 'app-icon',\n    template: `\n        <div class=\"app-icon\">\n            <i *ngIf=\"!icon || icon.type !== 'img'\" [class]=\"icon?.class || className\">\n                {{ icon?.content }}\n                <ng-content></ng-content>\n            </i>\n            <img *ngIf=\"icon && icon.type === 'img'\" [src]=\"icon.src | safe: 'resource'\" />\n        </div>\n    `,\n    styles: [\n        `\n            .app-icon {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 1.25em;\n                width: 1.25em;\n            }\n\n            i {\n                font-size: 1em;\n            }\n\n            img {\n                height: 1em;\n                width: 1em;\n            }\n        `,\n    ],\n})\nexport class IconComponent {\n    @Input() public className: string = 'material-icons';\n    /** Icon details */\n    @Input() public icon: ApplicationIcon;\n}\n","import {\n    AfterViewInit,\n    Component,\n    ElementRef,\n    InjectionToken,\n    Injector,\n    Input,\n    OnChanges,\n    OnDestroy,\n    OnInit,\n    QueryList,\n    SimpleChanges,\n    TemplateRef,\n    Type,\n    ViewChild,\n    ViewChildren,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nimport {\n    applyGlobalStyles,\n    createViewer,\n    getViewer,\n    Point,\n    Viewer,\n    removeViewer,\n    updateViewer,\n    ViewAction,\n    ViewerFeature,\n    ViewerLabel,\n    ViewerStyles,\n    listenToViewerChanges,\n} from '@placeos/svg-viewer';\nimport { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport const MAP_FEATURE_DATA = new InjectionToken('Data for Map Features');\n\n@Component({\n    selector: `i-map,interactive-map`,\n    template: `\n        <div #outlet tabindex=\"0\" role=\"map\" class=\"absolute inset-0\"></div>\n        <mat-spinner\n            *ngIf=\"!viewer || loading\"\n            class=\"absolute\"\n            [diameter]=\"48\"\n        ></mat-spinner>\n        <div hidden *ngIf=\"injectors?.length\">\n            <ng-container\n                *ngFor=\"\n                    let element of features;\n                    let i = index;\n                    trackBy: element?.location\n                \"\n            >\n                <div *ngIf=\"element\">\n                    <div\n                        #feature\n                        class=\"pointer-events-none\"\n                        [attr.el-id]=\"element.location\"\n                        [attr.view-id]=\"viewer\"\n                        [ngSwitch]=\"type(element.content)\"\n                    >\n                        <ng-container *ngSwitchCase=\"'component'\">\n                            <ng-container\n                                *ngComponentOutlet=\"\n                                    element.content;\n                                    injector: injectors[i]\n                                \"\n                            ></ng-container>\n                        </ng-container>\n                        <ng-container *ngSwitchCase=\"'html'\">\n                            <div [innerHTML]=\"element.content | sanitize\"></div>\n                        </ng-container>\n                        <ng-container *ngSwitchDefault>\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    element.content;\n                                    context: element.data\n                                \"\n                            ></ng-container>\n                        </ng-container>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n\n            mat-spinner {\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n        `,\n    ],\n})\nexport class InteractiveMapComponent\n    extends BaseClass\n    implements AfterViewInit, OnChanges, OnInit, OnDestroy {\n    /** URL to the SVG file */\n    @Input() public src: string;\n    /** Custom CSS styles to apply to the SVG file */\n    @Input() public styles: ViewerStyles;\n    /** Zoom level to apply to the SVG */\n    @Input() public zoom = 1;\n    /** Zoom level to apply to the SVG */\n    @Input() public center: Point = { x: 0.5, y: 0.5 };\n    /** List of features to renderer over the SVG */\n    @Input() public features: ViewerFeature[];\n    /** List of labels to renderer over the SVG */\n    @Input() public labels: ViewerLabel[];\n    /** List of available user actions for the SVG */\n    @Input() public actions: ViewAction[];\n\n    @Input() public options: any;\n\n    @Input() public focus: string;\n\n    public loading: boolean;\n\n    public injectors: Injector[] = [];\n\n    /** ID of the active SVG Viewer */\n    public viewer: string;\n    /** Observable for changes on the SVG viewer */\n    private _on_changes: BehaviorSubject<Viewer> = new BehaviorSubject(null);\n\n    @ViewChild('outlet') private _outlet_el: ElementRef<HTMLDivElement>;\n    @ViewChildren('feature') private _feature_list: QueryList<\n        ElementRef<HTMLDivElement>\n    >;\n\n    public type(\n        content: string | TemplateRef<any> | Type<any>\n    ): 'html' | 'template' | 'component' {\n        return typeof content === 'string'\n            ? 'html'\n            : content instanceof TemplateRef\n            ? 'template'\n            : 'component';\n    }\n\n    public get feature_list() {\n        return (this.features || [])\n            .map((f, idx) => ({\n                ...f,\n                content: this._feature_list.toArray()[idx]?.nativeElement,\n            }))\n            .filter((f) => f.content);\n    }\n\n    constructor(private _injector: Injector) {\n        super();\n    }\n\n    public ngOnInit() {\n        applyGlobalStyles();\n    }\n\n    public ngOnDestroy(): void {\n        if (this.viewer) {\n            removeViewer(this.viewer);\n        }\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.src && this.src) {\n            this.createView();\n        }\n        if (changes.features) {\n            this.injectors = (this.features || []).map((f: any) =>\n                Injector.create({\n                    providers: [\n                        {\n                            provide: MAP_FEATURE_DATA,\n                            useValue: {\n                                ...f.data,\n                                zoom: this._on_changes.pipe(map((_) => _.zoom)),\n                                position: this._on_changes.pipe(\n                                    map((_) => _.center)\n                                ),\n                            },\n                        },\n                    ],\n                    parent: this._injector,\n                })\n            );\n        }\n        if (this.viewer) {\n            if (changes.focus && this.focus) {\n                this.focusOn(this.focus);\n            } else if (changes.zoom || changes.center) {\n                this.updateDisplay();\n            }\n            if (\n                changes.styles ||\n                changes.features ||\n                changes.labels ||\n                changes.actions\n            ) {\n                this.timeout('update_view', () => this.updateView(), 100);\n            }\n        }\n    }\n\n    public ngAfterViewInit() {\n        this.createView();\n    }\n\n    /** Update overlays, styles and actions of viewer */\n    private updateView() {\n        if (!getViewer(this.viewer) || this.loading) {\n            return this.timeout('update_view', () => this.updateView());\n        }\n        try {\n            updateViewer(this.viewer, {\n                styles: this.styles,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n                options: this.options,\n            });\n        } catch (e) {}\n    }\n\n    /** Update zoom and center position of viewer */\n    private updateDisplay() {\n        updateViewer(this.viewer, {\n            zoom: this.zoom,\n            desired_zoom: this.zoom,\n            center: this.center,\n            desired_center: this.center,\n            options: this.options,\n        });\n    }\n\n    private async createView() {\n        if (this.src && this._outlet_el?.nativeElement && !this.loading) {\n            this.loading = true;\n            if (this.viewer) {\n                removeViewer(this.viewer);\n            }\n            this.viewer = await createViewer({\n                element: this._outlet_el?.nativeElement,\n                url: this.src,\n                styles: this.styles,\n                zoom: this.zoom,\n                desired_zoom: this.zoom,\n                center: this.center,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n                options: this.options,\n            });\n            this.loading = false;\n            this.subscription(\n                'view_changes',\n                listenToViewerChanges(this.viewer)?.subscribe((v) =>\n                    this._on_changes.next(v)\n                )\n            );\n        } else if (\n            (this.src && !this._outlet_el?.nativeElement) ||\n            this.loading\n        ) {\n            this.timeout('create_view', () => this.createView());\n        }\n    }\n\n    private focusOn(id: string) {\n        const viewer: Viewer = getViewer(this.viewer);\n        if (!viewer) return;\n        const rect = viewer.mappings[id];\n        if (!rect) return;\n        this.center = {\n            x: 1 - (rect.x + rect.w / 2),\n            y: 1 - (rect.y + rect.h / 2),\n        };\n        this.updateDisplay();\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\n@Pipe({\n    name: 'safe'\n})\nexport class SafePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    /**\n     * Sanitizes the string allowing it to be injected into a template\n     * @param value String to sanitize\n     * @param type Type of value to sanitise. `resource`, `url`, `script`, `style` or `html`\n     */\n    public transform(\n        value: string,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n            case 'url':\n                return this.sanitizer.bypassSecurityTrustUrl(value);\n            case 'script':\n                return this.sanitizer.bypassSecurityTrustScript(value);\n            case 'style':\n                return this.sanitizer.bypassSecurityTrustStyle(value);\n            default:\n                return this.sanitizer.bypassSecurityTrustHtml(value);\n        }\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\nenum SecurityContext {\n    NONE = 0,\n    HTML = 1,\n    STYLE = 2,\n    SCRIPT = 3,\n    URL = 4,\n    RESOURCE_URL = 5\n}\n\n@Pipe({\n    name: 'sanitize'\n})\nexport class SanitizePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    transform(\n        value: any,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.sanitize(SecurityContext.RESOURCE_URL, value);\n            case 'url':\n                return this.sanitizer.sanitize(SecurityContext.URL, value);\n            case 'script':\n                return this.sanitizer.sanitize(SecurityContext.SCRIPT, value);\n            case 'style':\n                return this.sanitizer.sanitize(SecurityContext.STYLE, value);\n            default:\n                return this.sanitizer.sanitize(SecurityContext.HTML, value);\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { User } from '../../../users/src/lib/user.class';\n\n@Component({\n    selector: 'a-user-avatar',\n    template: `\n        <div\n            class=\"flex items-center justify-center rounded-full overflow-hidden border-2 border-white\"\n            *ngIf=\"user\"\n            [attr.user-id]=\"user.id\"\n        >\n            <div\n                initials\n                class=\"text-black text-opacity-50 uppercase\"\n                *ngIf=\"!user.photo; else image_state\"\n            >\n                {{ initials }}\n            </div>\n        </div>\n        <ng-template #image_state>\n            <img class=\"h-full w-full\" [src]=\"user.photo | safe: 'resource'\" />\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                height: 2.5em;\n                width: 2.5em;\n                background-color: #ccc;\n                overflow: hidden;\n                border: 2px solid white;\n            }\n\n            .initials {\n                font-size: 1em;\n            }\n        `,\n    ],\n})\nexport class UserAvatarComponent {\n    /** User to display avatar for */\n    @Input() public user: User;\n\n    public get initials(): string {\n        if (!this.user) return 'NA';\n        const parts = this.user.name\n            .replace(/[()[\\]\\-+=\\\\/]+/gi, '')\n            .split(' ');\n        return parts.length > 1\n            ? `${parts[0][0]}${parts[parts.length - 1][0]}`\n            : this.user.name.slice(0, 2);\n    }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Input,\n    OnDestroy,\n    ViewChild,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nconst DEFAULT_KEYS = [\n    '0123456789'.split(''),\n    'qwertyuiop'.split(''),\n    'asdfghjkl'.split(''),\n    'zxcvbnm'.split(''),\n    ['{caps}', '{space}', '{backspace}'],\n];\n\n@Component({\n    selector: 'input[keyboard],textarea[keyboard]',\n    template: `\n        <ng-content></ng-content>\n        <ng-template cdk-portal>\n            <div\n                keyboard\n                class=\"w-screen flex flex-col space-y-4 bg-gray-200 p-2 border-t border-gray-400\"\n            >\n                <div\n                    row\n                    class=\"flex items-center justify-center space-x-2\"\n                    *ngFor=\"let row of keyset\"\n                >\n                    <ng-container *ngFor=\"let key of row\">\n                        <div\n                            [attr.key]=\"key\"\n                            tabindex=\"0\"\n                            class=\"rounded-xl p-2 border border-gray-300 relative cursor-pointer bg-white\"\n                            [class.special]=\"key[0] === '{' && key.length > 1\"\n                            [class.space]=\"key === '{space}'\"\n                            (focus)=\"focusInput()\"\n                            (click)=\"handleKeyPress(key)\"\n                        >\n                            {{\n                                key === '{space}'\n                                    ? 'Space'\n                                    : key === '{caps}'\n                                    ? 'Caps Lock'\n                                    : key === '{backspace}'\n                                    ? 'Backspace'\n                                    : key\n                            }}\n                            <div\n                                *ngIf=\"key === '{caps}'\"\n                                dot\n                                class=\"absolute top-2 right-2 h-2 w-2 rounded-full bg-gray-300\"\n                                [class.bg-success]=\"state === 'shift'\"\n                            ></div>\n                        </div>\n                    </ng-container>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            [key] {\n                height: 3.5rem;\n                width: 4rem;\n                transition: box-shadow 200ms, top 200ms;\n                box-shadow: 0 4px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key].special {\n                width: 10rem;\n            }\n\n            [key].space {\n                flex: 1;\n                min-width: 10rem;\n                max-width: 25rem;\n            }\n\n            [key]:hover {\n                top: 2px;\n                box-shadow: 0 2px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key]:active {\n                top: 4px;\n                box-shadow: 0 0 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n        `,\n    ],\n})\nexport class VirtualKeyboardComponent extends BaseClass implements OnDestroy {\n    /** Whether virtual keyboard should activate */\n    public static enabled: boolean;\n    /** List of rows of keys to display on the keyboard */\n    @Input() public keyset = DEFAULT_KEYS;\n    /** Current state of the displayed keyset */\n    public state: 'normal' | 'caps' | 'shift' = 'normal';\n    /** References to the overlay containing the keyboard */\n    private _overlay_ref: OverlayRef = null;\n    /** Portal with the keyboard contents */\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n\n    @HostListener('focus') public onFocus = () => {\n        if (!VirtualKeyboardComponent.enabled) return;\n        this.open();\n        this.clearTimeout('blur');\n    };\n    @HostListener('blur') public onBlur = () =>\n        this.timeout('blur', () => this.close());\n\n    constructor(\n        private _element: ElementRef<HTMLInputElement | HTMLTextAreaElement>,\n        private _overlay: Overlay\n    ) {\n        super();\n    }\n\n    public ngOnDestroy() {\n        super.ngOnDestroy();\n        this.close();\n    }\n\n    public focusInput() {\n        this._element?.nativeElement?.blur();\n        this._element?.nativeElement?.focus();\n    }\n\n    public open() {\n        if (this._overlay_ref) return;\n        if (!this._portal) return;\n        this._overlay_ref = this._overlay.create({\n            positionStrategy: this._overlay\n                .position()\n                .global()\n                .bottom()\n                .centerHorizontally(),\n        });\n        this._overlay_ref.attach(this._portal);\n    }\n\n    public close() {\n        if (this._overlay_ref) {\n            this._overlay_ref.dispose();\n            this._overlay_ref = null;\n        }\n    }\n\n    public handleKeyPress(key: string) {\n        let cursor_pos = this._element.nativeElement.selectionStart;\n        const str = this._element.nativeElement.value || '';\n        switch (key.toLowerCase()) {\n            case '{caps}':\n            case '{shift}':\n                this.state = 'shift';\n                break;\n            case '{backspace}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos - 1\n                )}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos = Math.max(0, cursor_pos - 1);\n                break;\n            case '{space}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${' '}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n                break;\n            default:\n                if (this.state === 'shift') this.state = 'normal';\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${key}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n        }\n        this._element.nativeElement.dispatchEvent(new InputEvent('input'));\n        this.updateKeyState();\n        this.timeout(\n            'focus',\n            () => {\n                this.focusInput();\n                this._element.nativeElement.selectionStart = cursor_pos;\n                this._element.nativeElement.selectionEnd = cursor_pos;\n            },\n            50\n        );\n    }\n\n    public updateKeyState() {\n        this.keyset = this.keyset.map((_) =>\n            _.map((k) =>\n                k.length > 1\n                    ? k\n                    : k[\n                          this.state !== 'normal'\n                              ? 'toUpperCase'\n                              : 'toLowerCase'\n                      ]()\n            )\n        );\n    }\n}\n","import { AbstractControl } from '@angular/forms';\nimport { addMinutes, isAfter, isBefore } from 'date-fns';\n\nexport const endInFuture = (control: AbstractControl) => {\n    if (\n        control.parent?.get('date') &&\n        isAfter(\n            new Date(),\n            addMinutes(control.parent.get('date').value, control.value)\n        )\n    ) {\n        return { duration: true };\n    }\n    return null;\n};\n\n/** Check that date in unix ms is in the future */\nexport function isFuture(\n    control: AbstractControl\n): { [key: string]: boolean } | null {\n    return control.value && isBefore(control.value, new Date())\n        ? { is_future: true }\n        : null;\n}\n","import { FormGroup, FormControl, Validators } from '@angular/forms';\nimport {\n    add,\n    formatDuration,\n    differenceInMinutes,\n    getTime,\n    isSameDay,\n    format,\n    startOfMinute,\n    setHours,\n    setMinutes,\n    addMinutes,\n} from 'date-fns';\nimport { timePeriodsIntersect, unique } from '@placeos/common';\n\nimport { CalendarEvent } from './event.class';\nimport { endInFuture } from './validators';\nimport { getNextFreeTimeSlot } from './helpers';\n\nlet BOOKING_DATE = add(setMinutes(setHours(new Date(), 6), 0), { days: -1 });\n\nexport function generateEventForm(event: CalendarEvent): FormGroup {\n    const form = new FormGroup({\n        id: new FormControl(event.id),\n        host: new FormControl(event.host || '', [Validators.required]),\n        organiser: new FormControl(event.organiser || {}, [\n            Validators.required,\n        ]),\n        creator: new FormControl(event.creator, [Validators.required]),\n        calendar: new FormControl(event.calendar),\n        attendees: new FormControl(event.attendees || []),\n        resources: new FormControl(event.resources || []),\n        title: new FormControl(event.title, [Validators.required]),\n        body: new FormControl(event.body),\n        private: new FormControl(event.private),\n        date: new FormControl(event.date, [Validators.required]),\n        duration: new FormControl(event.duration, [endInFuture]),\n        all_day: new FormControl(event.all_day),\n        recurring: new FormControl(event.recurring),\n        recurrence: new FormControl(event.recurrence),\n        recurring_master_id: new FormControl(event.recurring_master_id),\n        master: new FormControl(event.master),\n        attachments: new FormControl(event.attachments),\n        catering: new FormControl(event.extension_data.catering || []),\n        // has_catering: new FormControl(event.has_catering || false),\n        visitor_type: new FormControl(event.ext('visitor_type')),\n        location: new FormControl(event.location),\n        needs_space: new FormControl(true),\n        needs_parking: new FormControl(event.ext('needs_parking') || false),\n        system: new FormControl(event.system),\n    });\n    form.get('organiser').valueChanges.subscribe((o) =>\n        form.controls.host.setValue(o?.email)\n    );\n    form.get('resources').valueChanges.subscribe((l) =>\n        form.controls.system.setValue(l.length ? l[0] : null)\n    );\n    if (event.id) {\n        form.get('host').disable();\n        form.get('organiser').disable();\n    }\n    if (event.state === 'started') form.get('date').disable();\n    return form;\n}\n\n/**\n * Set the initial time used for generating mock bookings\n * @param time New initial time as ms from UTC epoch\n */\nexport function setMockBookingStartDatetime(time: number) {\n    BOOKING_DATE = startOfMinute(new Date(time));\n}\n\n/**\n * Get current status within bookings\n * @param bookings List of bookings\n * @param host Host of the new event\n * @param date Datetime of the new event\n */\nexport function statusFromBookings(\n    bookings: CalendarEvent[],\n    bookable: boolean,\n    requestable: boolean,\n    date: number = getTime(new Date())\n) {\n    const now = new Date(date);\n    const next_free_slot = getNextFreeTimeSlot(bookings, date, 5);\n    const start = new Date(next_free_slot.start);\n    const end = new Date(next_free_slot.end);\n    const currently_free = timePeriodsIntersect(\n        date,\n        date,\n        next_free_slot.start,\n        next_free_slot.end\n    );\n    const time_until_next_block = formatDuration({\n        minutes: currently_free\n            ? differenceInMinutes(end, now)\n            : differenceInMinutes(start, now),\n    });\n    const free_tomorrow = !currently_free && !isSameDay(start, now);\n    const free_today = currently_free && !isSameDay(end, now);\n    return {\n        status: !bookable\n            ? 'Not Bookable'\n            : currently_free\n            ? requestable\n                ? 'Available by Request'\n                : 'Available'\n            : 'Meeting in Progress',\n        available_until: free_today\n            ? 'No meetings today'\n            : currently_free\n            ? `Free until ${format(end, 'h:mm B')}(${time_until_next_block})`\n            : free_tomorrow\n            ? 'Unavailable today'\n            : `Free at ${format(start, 'h:mm B')}(${time_until_next_block})`,\n    };\n}\n\nexport function replaceBookings(\n    list: CalendarEvent[],\n    new_bookings: CalendarEvent[],\n    filter_options: { space: string; from: number; to: number }\n) {\n    const from = filter_options.from;\n    const to = filter_options.to;\n    const filtered_list = list.filter((booking) => {\n        const start = new Date(booking.date);\n        const end = addMinutes(start, booking.duration);\n        return (\n            !booking.resources.find(\n                (space) => space.email === filter_options.space\n            ) || !timePeriodsIntersect(from, to, start.valueOf(), end.valueOf())\n        );\n    });\n    const updated_list = filtered_list.concat(new_bookings);\n    updated_list.sort((a, b) => a.date - b.date);\n    return unique(updated_list, 'id');\n}\n","import { Injectable } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { Event, NavigationEnd, Router } from '@angular/router';\nimport { BaseClass, getInvalidFields } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { getUnixTime } from 'date-fns';\nimport { querySpaceFreeBusy } from 'libs/calendar/src/lib/calendar.fn';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { filter, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { CalendarEvent } from './event.class';\nimport { saveEvent } from './events.fn';\nimport { generateEventForm } from './utilities';\n\nconst BOOKING_URLS = ['book/spaces', 'schedule/view'];\n\nexport type EventFlowView =\n    | 'form'\n    | 'find'\n    | 'catering'\n    | 'confirm'\n    | 'success';\n\nexport interface EventFlowOptions {\n    /** Calendar to associate event with */\n    calendar_id?: string;\n    /** List of features to filter spaces on */\n    features?: string[];\n    /** List of zones to filter spaces on */\n    zone_ids?: string[];\n    /** Minimum number of attendees to filter space on */\n    capacity?: number;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class EventStateService extends BaseClass {\n    private _view = new BehaviorSubject<EventFlowView>('form');\n    private _options = new BehaviorSubject<EventFlowOptions>({ zone_ids: [] });\n    private _form = new BehaviorSubject<FormGroup>(null);\n    private _event = new BehaviorSubject<CalendarEvent>(null);\n    private _loading = new BehaviorSubject<string>('');\n\n    public last_success: CalendarEvent = new CalendarEvent(\n        JSON.parse(sessionStorage.getItem('PLACEOS.last_booked_event') || '{}')\n    );\n    public readonly loading = this._loading.asObservable();\n    public readonly options = this._options.pipe(shareReplay(1));\n    public readonly available_spaces = combineLatest([\n        this._view,\n        this._options,\n        this._form,\n        this._org.initialised.pipe(filter((_) => _)),\n    ]).pipe(\n        filter(([v]) => v === 'find'),\n        switchMap(([_, options, form]) => {\n            this._loading.next('Retrieving available spaces...');\n            const start = form.get('date').value;\n            const end =\n                form.get('date').value + form.get('duration').value * 60 * 1000;\n            return querySpaceFreeBusy(\n                {\n                    period_start: getUnixTime(start),\n                    period_end: getUnixTime(end),\n                    zone_ids:\n                        options.zone_ids?.join(',') || this._org.building.id,\n                    features: options.features?.join(','),\n                    capacity: options.capacity ? options.capacity : undefined,\n                },\n                this._org\n            );\n        }),\n        tap((_) => {\n            this._loading.next('');\n        }),\n        shareReplay(1)\n    );\n\n    public get view() {\n        return this._view.getValue();\n    }\n    public get form() {\n        return this._form.getValue();\n    }\n    public get event() {\n        return this._event.getValue();\n    }\n\n    constructor(private _org: OrganisationService, private _router: Router) {\n        super();\n        this.available_spaces.subscribe();\n        this.subscription(\n            'router.events',\n            this._router.events.subscribe((event: Event) => {\n                if (\n                    event instanceof NavigationEnd &&\n                    !BOOKING_URLS.find((_) => event.url.includes(_))\n                ) {\n                    this.clearForm();\n                }\n            })\n        );\n    }\n\n    public setView(value: EventFlowView) {\n        this._view.next(value);\n    }\n\n    public setOptions(value: Partial<EventFlowOptions>) {\n        this._options.next({ ...this._options.getValue(), ...value });\n    }\n\n    public newForm(event: CalendarEvent = new CalendarEvent()) {\n        this._form.next(generateEventForm(event));\n        this.subscription(\n            'form_change',\n            this._form.getValue().valueChanges.subscribe(() => this.storeForm())\n        );\n        this._event.next(event);\n        this._options.next({});\n    }\n\n    public resetForm() {\n        if (!this._form.getValue()) this.newForm();\n        const event = this._event.getValue();\n        this._form\n            .getValue()\n            .patchValue({ ...(event || {}), ...(event?.extension_data || {}) });\n        this._options.next({});\n    }\n\n    public clearForm() {\n        sessionStorage.removeItem('PLACEOS.event_form');\n        this.newForm();\n    }\n\n    public storeForm() {\n        sessionStorage.setItem(\n            'PLACEOS.event_form',\n            JSON.stringify(this._form.getValue()?.value || {})\n        );\n    }\n\n    public loadForm() {\n        if (!this._form.getValue()) this.newForm();\n        this._form.getValue().patchValue({\n            ...JSON.parse(sessionStorage.getItem('PLACEOS.event_form') || '{}'),\n        });\n    }\n\n    public async postForm() {\n        const form = this._form.getValue();\n        if (!form) throw 'No form for event';\n        if (!form.valid)\n            throw `Some form fields are invalid. [${getInvalidFields(form).join(\n                ', '\n            )}]`;\n        const spaces = form.get('resources')?.value || [];\n        const space_list = spaces.length\n            ? await querySpaceFreeBusy({\n                  period_start: getUnixTime(form.get('date').value),\n                  period_end: getUnixTime(\n                      form.get('date').value +\n                          form.get('duration').value * 60 * 1000\n                  ),\n                  system_ids: spaces.map((_) => _.id).join(','),\n              }).toPromise()\n            : [];\n        if (space_list.length !== spaces.length)\n            throw `${\n                spaces.length - space_list.length\n            } space(s) are not available at the selected time`;\n        const result = await saveEvent(\n            new CalendarEvent(this._form.getValue().value)\n        ).toPromise();\n        this.clearForm();\n        this.last_success = result;\n        sessionStorage.setItem(\n            'PLACEOS.last_booked_event',\n            JSON.stringify(result)\n        );\n        this.setView('success');\n        return result;\n    }\n}\n","import { HashMap, Identity, unique } from '@placeos/common';\nimport { PlaceSystem } from '@placeos/ts-client';\nimport {\n    add,\n    addMinutes,\n    differenceInMinutes,\n    getUnixTime,\n    isAfter,\n    isBefore,\n    isSameDay,\n    roundToNearestMinutes,\n    set,\n} from 'date-fns';\nimport { CateringOrder } from 'libs/catering/src/lib/catering-order.class';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { GuestUser, User } from 'libs/users/src/lib/user.class';\nimport {\n    EventExtensionData,\n    FileDetails,\n    RecurrenceDetails,\n} from './event.interfaces';\nimport { eventStatus } from './helpers';\n\nlet _default_user: Identity = { id: 'default', name: 'Default User' };\n\nexport function setDefaultCreator(user: Identity) {\n    if (user) _default_user = user;\n}\n\ntype CalendarEventExtended = CalendarEvent & EventExtensionData;\n\n/** User's calendar event/booking */\nexport class CalendarEvent {\n    /** ID of the calendar event */\n    public readonly id: string;\n    /** Status of the event */\n    public readonly status: 'approved' | 'tentative' | 'declined' | 'none';\n    /** Email address of the host */\n    public readonly host: string;\n    /** ID of the calendar associated with the event */\n    public readonly calendar: string;\n    /** Email address of the event creator */\n    public readonly creator: string;\n    /** List of attendees of the event */\n    public readonly attendees: User[];\n    /** List of attendees of the event */\n    public readonly resources: Space[];\n    /** Summary of the event details */\n    public readonly title: string;\n    /** Extended details of the event */\n    public readonly body: string;\n    /** Unix epoch in seconds of the start time of the event */\n    public readonly event_start: number;\n    /** Unix epoch in seconds of the end time of the event */\n    public readonly event_end: number;\n    /** Whether event occurs over the full day */\n    public readonly all_day: boolean;\n    /** Unix epoch of the start time of the event */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** IANA timezone string for the event location */\n    public readonly timezone: string;\n    /** Location details for the event */\n    public readonly location: string;\n    /** Whether this event is recurring */\n    public readonly recurring: boolean;\n    /** Details about the event's recurrence */\n    public readonly recurrence: RecurrenceDetails;\n    /** ID of the parent recurring event */\n    public readonly recurring_master_id: string;\n    /** Whether event details should be private */\n    public readonly private: boolean;\n    /** File attachements for the event */\n    public readonly attachments: FileDetails[];\n    /** Extra data associated with the event */\n    public readonly extension_data: Partial<EventExtensionData>;\n    /** System associated with the event */\n    public readonly system: PlaceSystem;\n    /** Previous system associated with the event */\n    public readonly old_system: PlaceSystem;\n    /** Host user details of the event */\n    public readonly organiser: User;\n    /** Type of event */\n    public readonly type: 'cancelled' | 'external' | 'internal';\n    /** Master event */\n    public master?: CalendarEvent;\n\n    /** Get field from extension data */\n    public ext<K extends keyof EventExtensionData>(key: K) {\n        return this.extension_data[key];\n    }\n\n    constructor(data: Partial<CalendarEventExtended> = {}) {\n        this.id = data.id || '';\n        this.event_start =\n            data.event_start ||\n            getUnixTime(\n                data.date ||\n                    roundToNearestMinutes(addMinutes(new Date(), 3), {\n                        nearestTo: 5,\n                    })\n            );\n        this.event_end =\n            data.event_end ||\n            getUnixTime(\n                addMinutes(this.event_start * 1000, data.duration || 30)\n            );\n        this.calendar = data.calendar || '';\n        this.creator =\n            (data.creator || _default_user.email)?.toLowerCase() || '';\n        this.host = (\n            data.host ||\n            this.creator ||\n            _default_user.email ||\n            ''\n        ).toLowerCase();\n        const attendees: HashMap = data.attendees || [];\n        this.attendees = attendees\n            .filter((user: any) => !user.resource)\n            .map((u) => new User(u));\n        this.resources =\n            unique(\n                data.resources ||\n                    attendees\n                        .filter((user) => user.resource)\n                        .map((s) => new Space(s)),\n                'email'\n            ) || [];\n        this.title = data.title || '';\n        this.body = data.body || '';\n        this.private = !!data.private;\n        this.all_day = !!data.all_day;\n        this.date = this.event_start * 1000;\n        this.duration = this.all_day\n            ? 24 * 60\n            : data.duration ||\n              differenceInMinutes(data.event_end * 1000, this.date) ||\n              30;\n        this.timezone = data.timezone || '';\n        this.location = data.location || '';\n        this.recurring = !!data.recurring;\n        this.recurring_master_id = data.recurring_master_id || '';\n        this.organiser = this.attendees.find(\n            (user) => user.email === this.host\n        );\n        this.master = data.master ? new CalendarEvent(data.master) : null;\n        if (data.recurring) {\n            this.recurrence = {\n                start:\n                    this.event_start * 1000 ||\n                    new Date(\n                        (data.recurrence as any).range_start * 1000\n                    ).valueOf(),\n                end:\n                    data.recurrence.end ||\n                    new Date(\n                        (data.recurrence as any).range_end * 1000\n                    ).valueOf(),\n                interval: data.recurrence.interval,\n                pattern: data.recurrence.pattern,\n                days_of_week: data.recurrence.days_of_week,\n            };\n        } else {\n            this.recurrence = {} as any;\n        }\n        const system = data.system;\n        if (\n            system?.email &&\n            !this.resources.find((_) => _.email === system.email)\n        ) {\n            this.resources.push(new Space(system as any));\n        }\n        this.system = system || (this.resources[0] as any) || null;\n        this.old_system = data.old_system || data.system;\n        this.attachments = data.attachments || [];\n        this.extension_data = data.extension_data || {};\n        this.status = eventStatus(this) || 'none';\n        this.type =\n            this.status === 'declined'\n                ? 'cancelled'\n                : this.attendees.find((_) => _.is_external)\n                ? 'external'\n                : 'internal';\n        for (const key in data) {\n            if (!(key in this)) {\n                this.extension_data[key] =\n                    data[key] || this.extension_data[key];\n            }\n        }\n        this.extension_data.catering = (this.extension_data.catering || []).map(\n            (i) => new CateringOrder({ ...i, event: this })\n        );\n    }\n\n    /** List of external attendees associated with the event */\n    public get guests() {\n        return this.attendees.filter((f) => !!f.visit_expected) as GuestUser[];\n    }\n    /** Primary space associated with the booking */\n    public get space() {\n        return this.resources[0] || null;\n    }\n    public get is_today(): boolean {\n        return isSameDay(new Date(this.date), new Date());\n    }\n\n    /**\n     * Convert class data to simple JSON object\n     */\n    public toJSON(): HashMap {\n        const obj: HashMap = { ...this };\n        const end = getUnixTime(addMinutes(this.date, this.duration));\n        const date = this.all_day ? set(this.date, { hours: 12 }) : this.date;\n        obj.event_start = getUnixTime(date);\n        obj.event_end = end;\n        const attendees = this.attendees;\n        if (this.recurring) {\n            obj.recurrence = {\n                ...this.recurrence,\n                range_start: obj.event_start,\n                range_end: getUnixTime(this.recurrence.end),\n            };\n        }\n        obj.recurrence = obj.recurrence\n            ? Object.keys(obj.recurrence).length\n                ? obj.recurrence\n                : null\n            : null;\n        obj.attendees = unique(attendees, 'email');\n        if (!this.all_day) {\n            obj.extension_data.breakdown = 15;\n        }\n        obj.extension_data.catering = obj.extension_data.catering.map(\n            (i) => new CateringOrder({ ...i, event: null })\n        );\n        obj.system_id = this.system?.id;\n        delete obj.catering;\n        delete obj.date;\n        delete obj.duration;\n        delete obj.status;\n        return obj;\n    }\n\n    /** Status of the booking */\n    public get state():\n        | 'future'\n        | 'upcoming'\n        | 'done'\n        | 'started'\n        | 'in_progress' {\n        const now = new Date();\n        const date = this.date;\n        if (isBefore(now, add(date, { minutes: -15 }))) return 'future';\n        if (isBefore(now, date)) return 'upcoming';\n        if (isBefore(now, add(date, { minutes: 15 }))) return 'started';\n        if (isBefore(now, add(date, { minutes: this.duration })))\n            return 'in_progress';\n        return 'done';\n    }\n\n    public get can_check_in(): boolean {\n        const now = new Date();\n        return (\n            this.is_today ||\n            (isAfter(now, this.date) &&\n                isBefore(now, addMinutes(this.date, this.duration)))\n        );\n    }\n}\n","import { del, get, patch, post, put } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { GuestUser } from 'libs/users/src/lib/user.class';\n\nimport { CalendarEvent } from './event.class';\n\nexport interface CalendarEventQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zone_ids?: string;\n    /** Comma seperated list of system(space) ids to check availability */\n    system_ids?: string;\n    /** Comma seperated list of calendar ids to check availability */\n    calendars?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n    /** Whether to include cancelled events in the returned list */\n    include_cancelled?: boolean;\n}\n\nexport interface CalendarEventShowParams {\n    /** ID of the personal calendar to grab the events details from */\n    calendar?: string;\n    /** ID of the system/space to get the associated calendar ID */\n    system_id?: string;\n}\n\nconst EVENTS_ENDPOINT = `/api/staff/v1/events`;\n\n/**\n * List events\n * @param q Parameters to pass to the API request\n */\nexport function queryEvents(\n    q: CalendarEventQueryParams\n): Observable<CalendarEvent[]> {\n    const query = toQueryString(q);\n    return get(`${EVENTS_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((e) => new CalendarEvent(e)))\n    );\n}\n\n/**\n * Get event details\n * @param id ID of the event to grab\n * @param q Parameters to pass to the API request\n */\nexport function showEvent(id: string, q: CalendarEventShowParams = {}) {\n    const query = toQueryString(q);\n    return get(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Create new calendar event and add it to the database\n * @param data New calendar event fields\n */\nexport function createEvent(data: Partial<CalendarEvent>) {\n    return post(`${EVENTS_ENDPOINT}`, new CalendarEvent(data).toJSON()).pipe(\n        map((item) => new CalendarEvent(item))\n    );\n}\n\n/**\n * Update an existing calendar event\n * @param id ID of the event to update\n * @param data New values for event fields\n * @param q Parameters to pass to the API request\n * @param method HTTP verb to use with API request\n */\nexport function updateEvent(\n    id: string,\n    data: Partial<CalendarEvent>,\n    q: CalendarEventShowParams = {},\n    method: 'put' | 'patch' = 'patch'\n) {\n    const query = toQueryString(q);\n    return (method === 'patch' ? patch : put)(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`,\n        method === 'patch' ? data : new CalendarEvent(data).toJSON()\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Save changes to or create a calendar event\n * @param data State of the calendar event\n * @param q Parameters to pass to the API request\n */\nexport const saveEvent = (\n    data: Partial<CalendarEvent>,\n    q?: CalendarEventShowParams\n) => {\n    delete (data as any)?.status;\n    return data.id ? updateEvent(data.id, data, q) : createEvent(data);\n};\n\n/**\n * Remove calendar event from the database\n * @param id ID of the event to remove\n * @param q Parameters to pass to the API request\n */\nexport function removeEvent(id: string, q: CalendarEventShowParams = {}) {\n    const query = toQueryString(q);\n    return del(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`,\n        {\n            response_type: 'void',\n        }\n    );\n}\n\n/**\n * Set the approval state of the event to approved\n * @param id ID of the event to approve\n * @param system_id Associated system to approve\n */\nexport function approveEvent(id: string, system_id: string) {\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/approve?system_id=${encodeURIComponent(system_id)}`,\n        ''\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Set the approval state of the event to rejected\n * @param id ID of the event to reject\n * @param system_id Associated system to reject\n */\nexport function rejectEvent(id: string, system_id: string) {\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/reject?system_id=${encodeURIComponent(system_id)}`,\n        ''\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * List guests for event\n * @param id ID of the event to grab\n * @param q Parameters to pass to the API request\n */\nexport function queryEventGuests(\n    id: string,\n    q: CalendarEventShowParams = {}\n): Observable<GuestUser[]> {\n    const query = toQueryString(q);\n    return get(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}/guests${\n            query ? '?' + query : ''\n        }`\n    ).pipe(map((list) => list.map((item) => new GuestUser(item))));\n}\n\n/**\n * Set the checkin state of an event guest\n * @param id ID of the event to grab\n * @param guest_id ID of the guest to update\n * @param state New checkin state of the guest\n * @param q Parameters to pass to the API request\n */\nexport function checkinEventGuest(\n    id: string,\n    guest_id: string,\n    state: boolean,\n    q: CalendarEventShowParams = {}\n) {\n    const query = toQueryString({ ...q, state });\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/guests/${guest_id}/checkin${query ? '?' + query : ''}`,\n        ''\n    ).pipe(map((item) => new GuestUser(item)));\n}\n","import { HashMap } from '@placeos/common';\nimport {\n    addMinutes, addSeconds,\n\n    differenceInMinutes,\n    format,\n    isAfter,\n    isBefore,\n    isSameMinute,\n    startOfMinute\n} from 'date-fns';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport {\n    BookingRuleDetails,\n    BookingRules,\n    BookingRuleset,\n    BookingRulesmap,\n    RecurrenceDetails,\n    TimeBlock,\n    TimePeriod\n} from './event.interfaces';\n\nexport function eventStatus(\n    details: HashMap\n): 'approved' | 'tentative' | 'declined' {\n    if (details.resources?.length) {\n        if (details.resources.every((i) => i.response_status === 'accepted')) {\n            return 'approved';\n        } else if (\n            details.resources.some(\n                (i) =>\n                    i.response_status === 'tentative' ||\n                    i.response_status === 'needsAction'\n            )\n        ) {\n            return 'tentative';\n        }\n        return 'declined';\n    }\n    return 'approved';\n}\n\nexport function formatRecurrence({\n    interval,\n    pattern,\n    end,\n}: RecurrenceDetails) {\n    let details = '';\n    if (interval) {\n        switch (pattern) {\n            case 'daily':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} days` : 'Daily'\n                );\n                break;\n            case 'weekly':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} weeks` : 'Weekly'\n                );\n                break;\n            case 'monthly':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} months` : 'Monthly'\n                );\n                break;\n        }\n        details = details.concat(`, until ${format(end, 'MMM do, yyyy')}`);\n    }\n    return details;\n}\n\n/**\n * Generate a list of free time slots between the given bookings\n * @param list List of bookings to find slots between\n * @param min_size Minimum length of a free slot in minutes\n */\nexport function getFreeTimeSlots(\n    list: TimePeriod[],\n    min_size: number = 30\n): TimeBlock[] {\n    let start = new Date(0);\n    const slots: TimeBlock[] = [];\n    list.sort((a, b) => a.date - b.date);\n    for (const booking of list) {\n        const bkn_start = new Date(booking.date);\n        const bkn_end = addMinutes(booking.date, booking.duration);\n        if (isAfter(booking.date, start)) {\n            const diff = Math.abs(differenceInMinutes(bkn_start, start));\n            if (diff >= min_size) {\n                slots.push({\n                    start: start.valueOf(),\n                    end: booking.date,\n                });\n            }\n            start = bkn_end;\n        } else if (isSameMinute(start, booking.date)) {\n            start = bkn_end;\n        }\n    }\n    slots.push({\n        start: start.valueOf(),\n        end: start.valueOf() * 10,\n    });\n    return slots;\n}\n\n/**\n * Get the next free time slot from the given bookings\n * @param list List of bookings to find the next slot\n * @param date Date to find next slot after in ms since UTC epoch\n * @param min_size Minimum length of the free slot in minutes\n */\nexport function getNextFreeTimeSlot(\n    list: TimePeriod[],\n    date: number = new Date().valueOf(),\n    min_size: number = 30\n): TimeBlock {\n    const slots = getFreeTimeSlots(list, min_size);\n    const time = addSeconds(startOfMinute(date), 1);\n    for (const block of slots) {\n        if (isAfter(block.start, time)) {\n            return block;\n        } else if (isBefore(time, block.end)) {\n            const duration = differenceInMinutes(block.end, time);\n            if (duration >= min_size) return block;\n        }\n    }\n    return slots[slots.length - 1];\n}\n\nconst MINUTE = 1;\nconst HOUR = 60;\nconst DAY = 24 * HOUR;\nconst WEEK = 7 * DAY;\nconst MONTH = 30 * DAY;\n\nconst DURATION_MAP: { [duration: string]: number } = {\n    month: MONTH,\n    months: MONTH,\n    week: WEEK,\n    weeks: WEEK,\n    day: DAY,\n    days: DAY,\n    hour: HOUR,\n    hours: HOUR,\n    minute: MINUTE,\n    minutes: MINUTE,\n};\n\nconst DEFAULT_RULES: BookingRules = {\n    auto_approve: true,\n    hidden: false,\n};\n\n/**\n * Conver time string into minutes\n * @param str timestring e.g. `'1 day'`, `'15 minutes'`, `'2 weeks'`\n */\nexport function stringToMinutes(str: string): number {\n    const parts = (str || '').split(' ');\n    return parts.length > 1 ? +parts[0] * DURATION_MAP[parts[1]] : 0;\n}\n\nexport function addToDate(add: string, date: Date | number = new Date()) {\n    return addMinutes(date, stringToMinutes(add));\n}\n\nexport function filterSpacesFromRules(\n    spaces: Space[],\n    details: BookingRuleDetails,\n    rulemap: BookingRulesmap\n) {\n    return spaces.filter(\n        (_) => !rulesForSpace({ ...details, space: _ }, rulemap)?.hidden\n    );\n}\n\nexport function rulesForSpace(\n    details: BookingRuleDetails,\n    rulemap: BookingRulesmap\n): BookingRules {\n    const { space } = details;\n    for (const zone of space.zones) {\n        if (rulemap[zone]?.length) {\n            for (const ruleset of rulemap[zone]) {\n                if (ruleset && checkRulesMatch(details, ruleset))\n                    return { ...DEFAULT_RULES, ...ruleset.rules };\n            }\n        }\n    }\n    return DEFAULT_RULES;\n}\n\nexport function checkRulesMatch(\n    { date, duration, host }: BookingRuleDetails,\n    ruleset: BookingRuleset\n): boolean {\n    let matches = 0;\n    const { conditions } = ruleset;\n    if (!conditions) return true;\n    if (\n        conditions.groups instanceof Array &&\n        conditions.groups.every((_) => host?.groups?.includes(_))\n    )\n        matches += 1;\n    if (\n        conditions.is_before &&\n        isBefore(addMinutes(date, duration), addToDate(conditions.is_before))\n    )\n        matches += 1;\n    if (conditions.is_after && isAfter(date, addToDate(conditions.is_after)))\n        matches += 1;\n    if (\n        conditions.min_length &&\n        stringToMinutes(conditions.min_length) <= duration\n    )\n        matches += 1;\n    if (\n        conditions.max_length &&\n        stringToMinutes(conditions.max_length) >= duration\n    )\n        matches += 1;\n    return matches >= Object.keys(conditions).length;\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, combineLatest, Observable, of } from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    first,\n    map,\n    shareReplay,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\n\nimport { SpacesService } from '@placeos/spaces';\nimport { searchStaff, StaffUser, User } from '@placeos/users';\nimport { getModule } from '@placeos/ts-client';\nimport { unique } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nexport interface SearchResult {\n    /** Unique ID of the result item */\n    id: string;\n    /** Type of the item being displayed */\n    type: 'space' | 'user' | 'contact' | 'feature';\n    /** Main display string for the item */\n    name: string;\n    /** Secondary display string for the item. e.g. email, location, coordinates */\n    description: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class ExploreSearchService {\n    /** Current search results for staff users */\n    private _emergency_contacts = new BehaviorSubject<User[]>([]);\n    /** Filter string for results */\n    private _filter = new BehaviorSubject<string>('');\n    /** Whether results are being loaded */\n    private _loading = new BehaviorSubject<boolean>(false);\n\n    public readonly emergency_contacts = this._emergency_contacts.asObservable();\n\n    private _user_search: Observable<StaffUser[]> = this._filter.pipe(\n        debounceTime(400),\n        tap(() => this._loading.next(true)),\n        switchMap((q) => (q?.length > 2 ? this.search_fn(q) : of([]))),\n        catchError(() => [])\n    );\n\n    public readonly search_results: Observable<SearchResult[]> = combineLatest([\n        this._spaces.list,\n        this._user_search,\n        this._emergency_contacts,\n    ]).pipe(\n        debounceTime(1000),\n        map(([spaces, users, contacts]) => {\n            const filter = this._filter.getValue() || '';\n            const search = filter.toLowerCase();\n            const results = unique(\n                [\n                    ...spaces\n                        .filter(\n                            (_) =>\n                                _.email.toLowerCase().includes(search) ||\n                                _.name.toLowerCase().includes(search) ||\n                                _.display_name.toLowerCase().includes(search)\n                        )\n                        .map((s) => ({\n                            id: s.id,\n                            type: 'space',\n                            name: s.display_name || s.name,\n                            description: `Capacity: ${s.capacity} `,\n                        })),\n                    ...contacts\n                        .map((u) => ({\n                            id: u.email,\n                            type: (u as any).type || 'contact',\n                            name: u.name,\n                            description: u.email,\n                        }))\n                        .filter(\n                            (_) =>\n                                _.name.toLowerCase().includes(search) ||\n                                _.description.toLowerCase().includes(search) ||\n                                _.type.toLowerCase().includes(search)\n                        ),\n                    ...users.map((u) => ({\n                        id: u.email,\n                        type: 'user',\n                        name: u.name,\n                        description: u.email,\n                    })),\n                ],\n                'id'\n            );\n            results.sort((a, b) => a.name.localeCompare(b.name));\n            return results;\n        }),\n        tap(() => this._loading.next(false)),\n        shareReplay(1)\n    );\n    /** Obverable for whether results are being loaded */\n    public readonly loading = this._loading.asObservable();\n    /** Function used to query for users */\n    public search_fn = (q: string) => searchStaff(q);\n\n    constructor(\n        private _spaces: SpacesService,\n        private _org: OrganisationService\n    ) {\n        this._spaces.list.subscribe();\n        this.search_results.subscribe();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        const mod = getModule(\n            this._org.organisation.bindings?.location_services,\n            'LocationServices'\n        );\n        if (mod) {\n            const binding = mod.binding('emergency_contacts');\n            binding.listen().subscribe((contacts_map) => {\n                const list = [];\n                for (const type in contacts_map) {\n                    for (const user of contacts_map[type]) {\n                        list.push({ ...user, type });\n                    }\n                }\n                this._emergency_contacts.next(list);\n            });\n            binding.bind();\n        }\n    }\n\n    public setFilter(str: string) {\n        this._filter.next(str);\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { ComponentsModule } from '@placeos/components';\n\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { OverlayModule } from '@angular/cdk/overlay';\nimport { PortalModule } from '@angular/cdk/portal';\n\nimport { FormFieldsModule } from '@placeos/form-fields';\n\nimport { ExploreMapControlComponent } from './explore-map-control.component';\nimport { ExploreMapViewComponent } from './explore-map-view.component';\nimport { ExploreSearchComponent } from './explore-search.component';\nimport { ExploreSpaceInfoComponent } from './explore-space-info.component';\nimport { ExploreZoomControlComponent } from './explore-zoom-control.component';\nimport { ExploreDeviceInfoComponent } from './explore-device-info.component';\nimport { ExploreBookingModalComponent } from './explore-booking-modal.component';\nimport { ExploreDeskInfoComponent } from './explore-desk-info.component';\n\nconst COMPONENTS: Type<any>[] = [\n    ExploreMapControlComponent,\n    ExploreMapViewComponent,\n    ExploreSearchComponent,\n    ExploreSpaceInfoComponent,\n    ExploreDeviceInfoComponent,\n    ExploreDeskInfoComponent,\n    ExploreZoomControlComponent,\n    ExploreBookingModalComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        ComponentsModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatSlideToggleModule,\n        OverlayModule,\n        PortalModule,\n        FormFieldsModule\n    ],\n    exports: [...COMPONENTS],\n})\nexport class SharedExploreModule {}\n","import { Component, Inject, OnInit } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { notifyError, notifySuccess } from '@placeos/common';\nimport { CalendarEvent, generateEventForm, saveEvent } from '@placeos/events';\nimport { Space } from '@placeos/spaces';\nimport { querySpaceAvailability } from '@placeos/calendar';\n\nexport interface ExploreBookingModalData {\n    space: Space;\n}\n\n@Component({\n    selector: 'explore-booking-modal',\n    template: `\n        <header>\n            <h2>New Booking</h2>\n            <div class=\"flex-1\"></div>\n            <button *ngIf=\"!loading\" mat-icon-button mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <ng-container *ngIf=\"!loading; else load_state\">\n            <main *ngIf=\"form\" [formGroup]=\"form\" class=\"p-4\">\n                <div class=\"flex flex-col\">\n                    <label for=\"title\">Title<span>*</span>:</label>\n                    <mat-form-field appearance=\"outline\">\n                        <input\n                            matInput\n                            name=\"title\"\n                            formControlName=\"title\"\n                            placeholder=\"Booking Title\"\n                        />\n                        <mat-error>Booking title is required</mat-error>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label>Space:</label>\n                    <div name=\"space\" class=\"sm:mt-4 mb-4\">\n                        {{\n                            form.controls.resources?.value[0]?.display_name ||\n                                form.controls.resources?.value[0]?.name\n                        }}\n                    </div>\n                </div>\n                <div class=\"flex sm:space-x-4 flex-wrap\">\n                    <div class=\"flex flex-col\" *ngIf=\"form.controls.date\">\n                        <label>Date:</label>\n                        <div class=\"sm:mt-4 mb-4\">\n                            {{ form.controls.date?.value | date: 'medium' }}\n                        </div>\n                    </div>\n                    <div class=\"flex flex-col\" *ngIf=\"form.controls.duration\">\n                        <label>Duration:</label>\n                        <a-duration-field\n                            formControlName=\"duration\"\n                        ></a-duration-field>\n                    </div>\n                </div>\n            </main>\n            <footer class=\"flex justify-center p-2 border-t border-gray-200\">\n                <button mat-button (click)=\"save()\">Save</button>\n            </footer>\n        </ng-container>\n        <ng-template #load_state>\n            <div load class=\"h-64 flex flex-col items-center justify-center\">\n                <mat-spinner class=\"m-4\" [diameter]=\"48\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            header {\n                max-width: calc(100vw + 100%);\n            }\n\n            [load] {\n                width: 32rem;\n                max-width: calc(100vw - 2rem);\n            }\n        `,\n    ],\n})\nexport class ExploreBookingModalComponent implements OnInit {\n    public booking: CalendarEvent;\n    public form: FormGroup;\n    public loading = '';\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: ExploreBookingModalData,\n        private _dialog_ref: MatDialogRef<ExploreBookingModalComponent>\n    ) {}\n\n    public ngOnInit() {\n        this.booking = new CalendarEvent({\n            attendees: [{ ...(this._data.space || {}), resource: true } as any],\n        });\n        this.form = generateEventForm(this.booking);\n    }\n\n    public async save() {\n        this.form.markAllAsTouched();\n        const on_error = (msg) => {\n            this.loading = '';\n            notifyError(msg);\n            this._dialog_ref.disableClose = false;\n        };\n        if (!this.form.valid) {\n            const list = [];\n            for (const key in this.form.controls) {\n                if (this.form.controls[key].invalid) {\n                    list.push(key);\n                }\n            }\n            throw on_error(\n                `Some form fields are not valid: [${list.join(', ')}]`\n            );\n        }\n        this._dialog_ref.disableClose = true;\n        this.loading = 'Checking space availability...';\n        const spaces = await querySpaceAvailability({\n            system_ids: this.form.controls.resources.value\n                ?.map((s) => s.id)\n                .join(','),\n            period_start: Math.floor(this.form.value.date / 1000),\n            period_end:\n                Math.floor(this.form.value.date / 1000) +\n                this.form.value.duration * 60,\n        })\n            .toPromise()\n            .catch((e) => {\n                on_error(\n                    'Space is unavailble for the selected time and duration'\n                );\n                throw e;\n            });\n        if (spaces.length <= 0) {\n            return on_error(\n                'Space is unavailble for the selected time and duration'\n            );\n        }\n        this.loading = 'Creating booking...';\n        await saveEvent(new CalendarEvent(this.form.value))\n            .toPromise()\n            .catch((e) => {\n                on_error('Error creating booking.');\n                throw e;\n            });\n        notifySuccess(\n            `Successfully created booking in ${\n                this._data.space.display_name || this._data.space.name\n            }`\n        );\n        this._dialog_ref.close();\n    }\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\n\nimport { MAP_FEATURE_DATA } from '@placeos/components';\n\nexport interface DeskInfoData {\n    map_id: string;\n    user: string;\n    start?: number;\n    end?: number;\n    status: 'free' | 'busy' | 'pending' | 'reserved' | 'unknown' | '';\n}\n\n@Component({\n    selector: 'explore-desk-info',\n    template: `\n        <div\n            name=\"space-info\"\n            [id]=\"map_id\"\n            [class]=\"\n                'absolute rounded bg-white p-4 top-0 left-0 shadow ' +\n                x_pos +\n                ' ' +\n                y_pos\n            \"\n        >\n            <div class=\"arrow\"></div>\n            <div class=\"details\">\n                <h4 map-id class=\"m-0 font-medium\">{{ map_id }}</h4>\n                <p user class=\"mt-2 text-sm\" *ngIf=\"user\">{{ user }}</p>\n                <p start class=\"mt-1 text-sm\" *ngIf=\"start\">\n                    {{ start | date: 'shortTime' }} &ndash;\n                    {{ end | date: 'shortTime' }}\n                </p>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                pointer-events: none;\n                z-index: 1;\n            }\n\n            [name='space-info'] {\n                width: 16rem;\n            }\n\n            [name='status'] {\n                background-color: #43a047;\n                font-weight: 500;\n            }\n\n            [name='status'].busy {\n                background-color: #e53935;\n            }\n\n            [name='status'].pending {\n                background-color: #ffb300;\n            }\n\n            [name='status'].not-bookable {\n                background-color: #757575;\n            }\n        `,\n    ],\n})\nexport class ExploreDeskInfoComponent implements OnInit {\n    /** Space to display details for */\n    public readonly map_id = this._details.map_id;\n    public readonly user = this._details.user;\n    public readonly start = this._details.start;\n    public readonly end = this._details.end;\n\n    public y_pos: 'top' | 'bottom';\n\n    public x_pos: 'left' | 'right';\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: DeskInfoData,\n        private _element: ElementRef<HTMLElement>\n    ) {}\n\n    public ngOnInit(tries: number = 0) {\n        if (tries > 10) return;\n        setTimeout(() => {\n            const parent = this._element.nativeElement.parentElement\n                ?.parentElement;\n            if (!parent) return this.ngOnInit(++tries);\n            const position = {\n                y: parseInt(parent.style.top, 10) / 100,\n                x: parseInt(parent.style.left, 10) / 100,\n            };\n            this.y_pos = position.y >= 0.5 ? 'bottom' : 'top';\n            this.x_pos = position.x >= 0.5 ? 'right' : 'left';\n        }, 200);\n    }\n\n    public get available_until() {\n        return '';\n    }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { getModule, showMetadata } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { catchError, first, map, switchMap } from 'rxjs/operators';\nimport { endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\nimport { BaseClass, HashMap, SettingsService } from '@placeos/common';\nimport { DesksService, queryBookings } from '@placeos/bookings';\nimport { StaffUser } from '@placeos/users';\nimport { Desk, OrganisationService } from '@placeos/organisation';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { DEFAULT_COLOURS } from './explore-spaces.service';\nimport { ExploreDeviceInfoComponent } from './explore-device-info.component';\nimport { ExploreDeskInfoComponent } from './explore-desk-info.component';\n\nexport interface DeskOptions {\n    enable_booking?: boolean;\n    date?: number | Date;\n    zones?: string[];\n    host?: StaffUser;\n}\nexport interface DesksStats {\n    free: number;\n    occupied: number;\n    total: number;\n}\n\n@Injectable()\nexport class ExploreDesksService extends BaseClass implements OnDestroy {\n    private _in_use = new BehaviorSubject<string[]>([]);\n    private _options = new BehaviorSubject<DeskOptions>({});\n    private _desks = new BehaviorSubject<string[]>([]);\n    private _reserved = new BehaviorSubject<string[]>([]);\n    private _statuses: HashMap<string> = {};\n    private _poll = new BehaviorSubject<number>(0);\n\n    private _desk_bookings = combineLatest([\n        this._state.level,\n        this._poll,\n    ]).pipe(\n        switchMap(([lvl]) =>\n            queryBookings({\n                period_start: getUnixTime(startOfDay(new Date())),\n                period_end: getUnixTime(endOfDay(new Date())),\n                type: 'desk',\n                zones: lvl.id,\n            })\n        )\n    );\n\n    public readonly desk_list = this._state.level.pipe(\n        switchMap((lvl) =>\n            showMetadata(lvl.id, { name: 'desks' }).pipe(\n                map((i) =>\n                    (i.details instanceof Array ? i.details : []).map(\n                        (j: HashMap) => new Desk({ ...j, zone: lvl as any })\n                    )\n                )\n            )\n        ),\n        catchError((e) => [])\n    );\n\n    private _bind = this._state.level.pipe(\n        map((lvl) => {\n            this._statuses = {};\n            this.unsubWith('lvl');\n            if (!lvl) return;\n            const building = this._org.buildings.find(\n                (bld) => bld.id === lvl.parent_id\n            );\n            if (!building) return;\n            const system_id =\n                building.bindings?.area_management ||\n                this._org.organisation.bindings?.area_management;\n            if (!system_id) return;\n            let binding = getModule(system_id, 'AreaManagement').binding(\n                lvl.id\n            );\n            this.subscription(\n                `lvl-in_use`,\n                binding\n                    .listen()\n                    .subscribe((d) =>\n                        this.processBindingChange(d || {}, system_id)\n                    )\n            );\n            this.subscription('lvl-in_use_bind', binding.bind());\n            binding = getModule(system_id, 'AreaManagement').binding(\n                `${lvl.id}:desk_ids`\n            );\n            this.subscription(\n                `lvl-desks_list`,\n                binding.listen().subscribe((d) => this._desks.next(d || []))\n            );\n            this.subscription('lvl-desk_list_bind', binding.bind());\n        })\n    );\n\n    private _state_change = combineLatest([\n        this.desk_list,\n        this._in_use,\n        this._reserved,\n        this._options,\n    ]).pipe(\n        // debounceTime(50),\n        map(([desks, in_use, reserved]) => {\n            this._statuses = {};\n            for (const { id, bookable } of desks) {\n                const is_used = in_use.some((i) => id === i);\n                const is_reserved = reserved.some((i) => id === i);\n                this._statuses[id] = bookable\n                    ? !is_used\n                        ? 'free'\n                        : is_reserved\n                        ? 'reserved'\n                        : 'busy'\n                    : 'not-bookable';\n            }\n            this.processDesks(desks);\n        })\n    );\n\n    constructor(\n        private _state: ExploreStateService,\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        private _desks_service: DesksService\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.setOptions({\n            enable_booking: this._settings.get('app.desks.enabled') !== false,\n        });\n        this.subscription('bind', this._bind.subscribe());\n        this.subscription('changes', this._state_change.subscribe());\n        this.subscription(\n            'desks',\n            this.desk_list.subscribe((desks) => this.processDesks(desks))\n        );\n    }\n\n    public startPolling(delay: number = 30 * 1000) {\n        this.subscription(\n            'desks_in_use_bookings',\n            this._desk_bookings.subscribe((_) =>\n                this._in_use.next(_.map((i) => i.asset_id))\n            )\n        );\n        this.interval(\n            'poll',\n            () => this._poll.next(new Date().valueOf()),\n            delay\n        );\n    }\n\n    public stopPolling() {\n        this.clearInterval('poll');\n    }\n\n    public setOptions(options: DeskOptions) {\n        this._options.next({ ...this._options.getValue(), ...options });\n    }\n\n    public processBindingChange(\n        { value }: { value: any[] },\n        system_id: string\n    ) {\n        const devices = (value || []).filter(\n            (v) => !['desk', 'booking'].includes(v.location)\n        );\n        const desks = (value || []).filter(\n            (v) =>\n                v.location === 'desk' ||\n                (v.location === 'booking' && v.type === 'desk')\n        );\n        this._in_use.next(desks.map((v) => v.map_id || v.asset_id));\n        this._reserved.next(\n            desks\n                .filter((v) => !v.at_location)\n                .map((v) => v.map_id || v.asset_id)\n        );\n        this.processDevices(devices, system_id);\n        this.timeout('update', () => this.updateStatus(), 100);\n    }\n\n    private updateStatus() {\n        const style_map = {};\n        const colours = this._settings.get('app.explore.colors') || {};\n        for (const desk_id in this._statuses) {\n            if (!this._statuses[desk_id]) continue;\n            style_map[`#${desk_id}`] = {\n                fill:\n                    colours[`desk-${this._statuses[desk_id]}`] ||\n                    colours[`${this._statuses[desk_id]}`] ||\n                    DEFAULT_COLOURS[`${this._statuses[desk_id]}`],\n                opacity: 0.6,\n            };\n        }\n        this._state.setStyles('desks', style_map);\n    }\n\n    private processDevices(devices: HashMap[], system_id: string) {\n        const list = [];\n        for (const device of devices) {\n            const x = device.x / device.map_width;\n            const y = device.y / device.map_height;\n            list.push({\n                location: {\n                    x: device.coordinates_from?.includes('right') ? 1 - x : x,\n                    y: device.coordinates_from?.includes('bottom') ? 1 - y : y,\n                },\n                content: ExploreDeviceInfoComponent,\n                data: { ...device, system: system_id },\n            });\n        }\n        this._state.setFeatures('devices', list);\n    }\n\n    private processDesks(desks: HashMap[]) {\n        const list = [];\n        const actions = [];\n        const options = this._options.getValue();\n        for (const desk of desks) {\n            list.push({\n                location: desk.id,\n                content: ExploreDeskInfoComponent,\n                hover: true,\n                data: {\n                    map_id: desk.name,\n                    status: this._statuses[desk.map_id],\n                },\n            });\n            const book_fn = () =>\n                this._desks_service.bookDesk({\n                    desks: [desk as Desk],\n                    host: options.host,\n                    date: options.date as Date,\n                });\n            actions.push({\n                id: desk.id,\n                action: 'click',\n                callback: book_fn,\n            });\n            actions.push({\n                id: desk.id,\n                action: 'touchend',\n                callback: book_fn,\n            });\n        }\n        this._state.setActions(\n            'desks',\n            this._options.getValue().enable_booking ? actions : []\n        );\n        this._state.setFeatures('desks', list);\n        this.timeout('update', () => this.updateStatus(), 100);\n    }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Inject,\n    OnInit,\n    ViewChild,\n} from '@angular/core';\nimport { getModule } from '@placeos/ts-client';\nimport { MAP_FEATURE_DATA } from '@placeos/components';\nimport { differenceInMinutes, formatDistanceToNow } from 'date-fns';\nexport interface DeviceInfoData {\n    mac: string;\n    variance: number;\n    last_seen: number;\n    system: string;\n    manufacturer?: string;\n    os?: string;\n    ssid?: string;\n    user?: any;\n    bg_color?: string;\n}\n\n@Component({\n    selector: '[explore-device-info]',\n    template: `\n        <div\n            name=\"radius\"\n            (mouseenter)=\"loadUser()\"\n            class=\"radius absolute center bg-blue-600 bg-opacity-25 border-4 border-dashed border-blue-600 rounded-full\"\n            [style]=\"'height: ' + diameter + '%; width: ' + diameter + '%;'\"\n        ></div>\n        <div\n            name=\"dot\"\n            #dot\n            class=\"h-2 w-2 absolute center rounded-full pointer-events-auto shadow\"\n            [style.background-color]=\"bg_color\"\n        ></div>\n\n        <ng-template cdk-portal>\n            <div\n                name=\"device-info\"\n                class=\"w-64 rounded bg-white p-4 top-0 left-0 shadow pointer-events-none\"\n                (mouseleave)=\"close()\"\n            >\n                <div class=\"arrow\"></div>\n                <div class=\"details\">\n                    <p><label>MAC:</label> {{ mac }}</p>\n                    <p><label>Accuracy:</label> {{ variance }}m</p>\n                    <p><label>Last Seen:</label> {{ last_seen }}</p>\n                    <p type *ngIf=\"manufacturer\">\n                        <label>Manufacturer:</label> {{ manufacturer }}\n                    </p>\n                    <p os *ngIf=\"os\"><label>OS:</label> {{ os }}</p>\n                    <p ssid *ngIf=\"ssid\"><label>SSID:</label> {{ ssid }}</p>\n                    <p username *ngIf=\"username\">\n                        <label>Username:</label>\n                        {{ user?.name || user?.username || username }}\n                    </p>\n                    <p user *ngIf=\"user\">\n                        <label>Type:</label> {{ user.type }}\n                    </p>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                pointer-events: auto;\n            }\n\n            :host > [name='dot'] {\n                background-color: #616161;\n            }\n\n            :host:hover > [name='radius'] {\n                opacity: 1;\n            }\n\n            [name='radius'] {\n                opacity: 0;\n                transition: opacity 200ms;\n                pointer-events: none;\n            }\n        `,\n    ],\n})\nexport class ExploreDeviceInfoComponent implements OnInit {\n    /** Name of the user associated with the mac address */\n    public username = '';\n    /** User details associated with device */\n    public readonly user = this._details.user;\n    /** Mac Address of the device */\n    public readonly mac = this._details.mac;\n    /** Mac Address of the device */\n    public readonly manufacturer = this._details.manufacturer;\n    /** Mac Address of the device */\n    public readonly os = this._details.os;\n    /** Mac Address of the device */\n    public readonly ssid = this._details.ssid;\n    /** Accuracy of the location data */\n    public readonly variance = this._details.variance?.toFixed(2);\n    /** Diameter of the radius circle */\n    public readonly diameter = this._details.variance * 100;\n    /** Background color for the dot */\n    public readonly bg_color = this._details.bg_color || this.distance_color;\n\n    public overlay_ref: OverlayRef = null;\n    /** Time of the last update */\n    public get last_seen() {\n        return formatDistanceToNow((this._details.last_seen || 0) * 1000, {\n            addSuffix: true,\n        });\n    }\n\n    public y_pos: 'top' | 'bottom';\n\n    public x_pos: 'end' | 'start';\n    public get distance() {\n        return Math.abs(\n            differenceInMinutes(\n                (this._details.last_seen || 0) * 1000,\n                new Date()\n            )\n        );\n    }\n\n    public get distance_color() {\n        return this.distance < 10\n            ? '#43a047'\n            : this.distance < 20\n            ? '#ffb300'\n            : '#e53935';\n    }\n\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n    @ViewChild('dot') private _dot: ElementRef<HTMLDivElement>;\n\n    @HostListener('mouseenter') public onEnter = () => this.loadUser();\n    @HostListener('mouseleave') public onLeave = () => this.close();\n    @HostListener('click') public onClick = () => this.loadUser();\n    @HostListener('touchend') public onTouch = () => this.loadUser();\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: DeviceInfoData,\n        private _element: ElementRef<HTMLElement>,\n        private _overlay: Overlay\n    ) {}\n\n    public ngOnInit(tries: number = 0) {\n        if (tries > 10) return;\n        setTimeout(() => {\n            const parent = this._element.nativeElement.parentElement\n                ?.parentElement;\n            if (!parent) return this.ngOnInit(++tries);\n            const position = {\n                y: parseInt(parent.style.top, 10) / 100,\n                x: parseInt(parent.style.left, 10) / 100,\n            };\n            this.y_pos = position.y >= 0.5 ? 'bottom' : 'top';\n            this.x_pos = position.x >= 0.5 ? 'end' : 'start';\n        }, 200);\n    }\n\n    public async loadUser() {\n        this.open();\n        if (this.username) return;\n        const mod = getModule(this._details.system, 'LocationServices');\n        if (mod) {\n            this.username = 'Loading...';\n            const details = await mod\n                .execute('check_ownership_of', [this.mac])\n                .catch((_) => null);\n            this.username =\n                details && details.assigned_to ? details.assigned_to : '';\n        }\n    }\n\n    public open() {\n        if (this.overlay_ref) this.close();\n        if (!this._portal) return;\n        this.overlay_ref = this._overlay.create({\n            positionStrategy: this._overlay\n                .position()\n                .flexibleConnectedTo(this._dot)\n                .withPositions([\n                    {\n                        originX: this.x_pos === 'start' ? 'end' : 'start',\n                        originY: this.y_pos === 'top' ? 'bottom' : 'top',\n                        overlayX: this.x_pos || 'end',\n                        overlayY: this.y_pos || 'bottom',\n                    },\n                ]),\n        });\n        this.overlay_ref.attach(this._portal);\n    }\n\n    public close() {\n        if (this.overlay_ref) {\n            this.overlay_ref.dispose();\n            this.overlay_ref = null;\n        }\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { BaseClass } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { first } from 'rxjs/operators';\n\nimport { ExploreStateService } from './explore-state.service';\n\n@Component({\n    selector: 'explore-map-controls',\n    template: `\n        <div class=\"flex space-x-2\">\n            <mat-form-field\n                overlay\n                buildings\n                class=\"flex-1\"\n                has-bld=\"true\"\n                *ngIf=\"(buildings | async)?.length > 1\"\n                appearance=\"outline\"\n            >\n                <mat-select\n                    placeholder=\"Select Building...\"\n                    [ngModel]=\"building | async\"\n                    (ngModelChange)=\"setBuilding($event)\"\n                >\n                    <mat-option\n                        *ngFor=\"let bld of buildings | async\"\n                        [value]=\"bld\"\n                    >\n                        {{ bld.display_name || bld.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <mat-form-field\n                overlay\n                levels\n                class=\"flex-1\"\n                [attr.has-bld]=\"(buildings | async)?.length > 1\"\n                *ngIf=\"(levels | async)?.length\"\n                appearance=\"outline\"\n            >\n                <mat-select\n                    placeholder=\"Select Level...\"\n                    [ngModel]=\"level | async\"\n                    (ngModelChange)=\"setLevel($event)\"\n                >\n                    <mat-option\n                        *ngFor=\"let lvl of levels | async\"\n                        [value]=\"lvl\"\n                    >\n                        {{ lvl.display_name || lvl.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                padding: 0.5rem;\n            }\n\n            mat-form-field {\n                min-width: 10rem;\n            }\n\n            mat-form-field[has-bld='true'] {\n                max-width: calc(50vw - 2.5rem);\n            }\n\n            :host[full] mat-form-field {\n                max-width: calc(50% - 2.5rem);\n            }\n        `,\n    ],\n})\nexport class ExploreMapControlComponent extends BaseClass implements OnInit {\n    /** List of available buildings */\n    public readonly buildings = this._org.building_list;\n    /** Currently active building */\n    public readonly building = this._org.active_building;\n    /** List of availabel levels */\n    public readonly levels = this._org.active_levels;\n    /** Currently active level */\n    public readonly level = this._state.level;\n    /** Set the currently active level */\n    public readonly setLevel = (lvl) => {\n        this._state.setFeatures('_located', []);\n        this.timeout(\n            'set_level',\n            () =>\n                this._router.navigate([], {\n                    relativeTo: this._route,\n                    queryParams: { zone: lvl.id },\n                }),\n            201\n        );\n    };\n    /** Set the currenly active building */\n    public readonly setBuilding = (bld) => (this._org.building = bld);\n\n    constructor(\n        private _org: OrganisationService,\n        private _state: ExploreStateService,\n        private _router: Router,\n        private _route: ActivatedRoute\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) =>\n                params.has('zone')\n                    ? this._state.setLevel(params.get('zone'))\n                    : ''\n            )\n        );\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { getModule } from '@placeos/ts-client';\nimport { first } from 'rxjs/operators';\n\nimport { BaseClass, notifyError, SettingsService } from '@placeos/common';\nimport { Space, SpacesService } from '@placeos/spaces';\nimport { MapLocation, showStaff, User } from '@placeos/users';\nimport { MapPinComponent, MapRadiusComponent } from '@placeos/components';\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { ExploreSpacesService } from './explore-spaces.service';\nimport { ExploreZonesService } from './explore-zones.service';\nimport { ExploreDesksService } from './explore-desks.service';\n\n@Component({\n    selector: 'explore-map-view',\n    template: `\n        <i-map\n            [src]=\"url | async\"\n            [zoom]=\"(positions | async)?.zoom\"\n            [center]=\"(positions | async)?.center\"\n            [styles]=\"styles | async\"\n            [features]=\"features | async\"\n            [actions]=\"actions | async\"\n            [labels]=\"labels | async\"\n        ></i-map>\n        <explore-zoom-controls\n            class=\"absolute bottom-0 right-0\"\n        ></explore-zoom-controls>\n        <explore-map-controls\n            class=\"absolute top-0 left-0\"\n        ></explore-map-controls>\n        <!-- <explore-search class=\"absolute top-0 right-0\"></explore-search> -->\n        <div\n            name=\"zones\"\n            class=\"p-2 bg-white border border-gray-400 absolute left-0 m-2 rounded flex items-center\"\n        >\n            Zones\n            <mat-slide-toggle\n                class=\"ml-2\"\n                [ngModel]=\"(options | async)?.show_zones\"\n                (ngModelChange)=\"setOptions({ show_zones: $event })\"\n            ></mat-slide-toggle>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n                background: var(--bg);\n            }\n\n            [name='zones'] {\n                top: 3.5rem;\n            }\n        `,\n    ],\n    providers: [ExploreSpacesService, ExploreDesksService, ExploreZonesService],\n})\nexport class ExploreMapViewComponent extends BaseClass implements OnInit {\n    /** Observable for the active map */\n    public readonly url = this._state.map_url;\n    /** Observable for the active map */\n    public readonly styles = this._state.map_styles;\n    /** Observable for the active map */\n    public readonly positions = this._state.map_positions;\n    /** Observable for the active map */\n    public readonly features = this._state.map_features;\n    /** Observable for the active map */\n    public readonly actions = this._state.map_actions;\n    /** Observable for the labels map */\n    public readonly labels = this._state.map_labels;\n    /** Observable for the active map */\n    public readonly options = this._state.options;\n    /** Observable for user messages */\n    public readonly message = this._state.message;\n\n    public readonly setOptions = (o) => this._state.setOptions(o);\n\n    constructor(\n        private _state: ExploreStateService,\n        private _s: ExploreSpacesService,\n        private _desks: ExploreDesksService,\n        private _zones: ExploreZonesService,\n        private _route: ActivatedRoute,\n        private _router: Router,\n        private _spaces: SpacesService,\n        private _org: OrganisationService,\n        private _settings: SettingsService\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._spaces.initialised.pipe(first((_) => _)).toPromise();\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe(async (params) => {\n                if (params.has('level')) {\n                    this._state.setLevel(params.get('level'));\n                }\n                this._state.setFeatures('_located', []);\n                if (params.has('space')) {\n                    const space = this._spaces.find(params.get('space'));\n                    if (!space) return;\n                    this.locateSpace(space);\n                } else if (params.has('user')) {\n                    let user = this._settings.value('last_search');\n                    if (!user || params.get('user') !== user.email) {\n                        user = null;\n                        user = await showStaff(params.get('user')).toPromise();\n                    }\n                    if (!user)\n                        return notifyError(\n                            `Unable to user details for ${params.get('user')}`\n                        );\n                    this.locateUser(\n                        user instanceof Array ? user[0] : user\n                    ).catch((_) => {\n                        notifyError(`Unable to locate ${params.get('user')}`);\n                        this._router.navigate([], {\n                            relativeTo: this._route,\n                            queryParams: {},\n                        });\n                    });\n                } else {\n                    this.timeout('update_location', () => {\n                        this._state.setFeatures('_located', []);\n                    });\n                }\n            })\n        );\n    }\n\n    private locateSpace(space: Space) {\n        this._state.setLevel(this._org.levelWithID(space.zones)?.id);\n        const feature: any = {\n            location: space.map_id,\n            content: MapPinComponent,\n            data: {\n                message: `${space.display_name || space.name} is here`,\n            },\n        };\n        this.timeout('update_location', () =>\n            this._state.setFeatures('_located', [feature])\n        );\n    }\n\n    private async locateUser(user: User) {\n        let locate_details: any = this._org.organisation.bindings\n            .location_services;\n        if (!locate_details) return;\n        if (typeof locate_details === 'string') {\n            locate_details = {\n                system_id: locate_details,\n                module: 'LocationServices',\n            };\n        }\n        const mod = getModule(locate_details.system_id, locate_details.module);\n        const locations: MapLocation[] = (\n            await mod.execute('locate_user', [user.email, user.id])\n        ).map((i) => new MapLocation(i));\n        locations.sort(\n            (a, b) =>\n                locate_details.priority.indexOf(a.type) -\n                locate_details.priority.indexOf(b.type)\n        );\n        if (!locations?.length) {\n            throw 'No locations for the given user';\n        }\n        this._state.setLevel(this._org.levelWithID([locations[0]?.level])?.id);\n        const pos = locations[0].position;\n        const { coordinates_from } = locations[0];\n        const feature: any = {\n            location:\n                locations[0].type === 'wireless'\n                    ? {\n                          x: coordinates_from?.includes('right')\n                              ? 1 - pos.x\n                              : pos.x,\n                          y: coordinates_from?.includes('bottom')\n                              ? 1 - pos.y\n                              : pos.y,\n                      }\n                    : pos,\n            content:\n                locations[0].type === 'wireless'\n                    ? MapRadiusComponent\n                    : MapPinComponent,\n            data: {\n                message: `${user.name} is here`,\n                radius: locations[0].variance,\n                last_seen: locations[0].last_seen,\n            },\n        };\n        this.timeout('update_location', () => {\n            this._state.setFeatures('_located', [feature]);\n        });\n    }\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\nimport { MAP_FEATURE_DATA } from '@placeos/components';\nimport { CalendarEvent } from '@placeos/events';\nimport { Space } from '@placeos/spaces';\n\nexport interface SpaceInfoData {\n    space: Space;\n    events: CalendarEvent[];\n    status:\n        | 'free'\n        | 'busy'\n        | 'pending'\n        | 'reserved'\n        | 'not-bookable'\n        | 'unknown'\n        | '';\n}\n\n@Component({\n    selector: 'explore-space-info',\n    template: `\n        <div\n            *ngIf=\"space\"\n            name=\"space-info\"\n            [id]=\"space.id\"\n            [class]=\"\n                'absolute rounded bg-white p-4 top-0 left-0 shadow ' +\n                x_pos +\n                ' ' +\n                y_pos\n            \"\n        >\n            <div class=\"arrow\"></div>\n            <div class=\"details\">\n                <h4 class=\"m-0 mb-2\">{{ space.display_name || space.name }}</h4>\n                <div capacity class=\"text-sm\" *ngIf=\"space.capacity >= 0\">\n                    <span>Capacity: </span>{{ space.capacity }}\n                    {{ space.capacity === 1 ? 'person' : 'people' }}\n                </div>\n                <div class=\"flex flex-wrap my-2 text-sm\">\n                    <div\n                        status\n                        [class]=\"\n                            'capitalize rounded p-1 px-2 text-light ' + status\n                        \"\n                    >\n                        {{ status }}\n                    </div>\n                    <div available-until *ngIf=\"status !== 'not-bookable'\">\n                        {{ available_until }}\n                    </div>\n                </div>\n                <div features *ngIf=\"space.features?.length > 0\">\n                    <h4 class=\"m-0 mb-2\">Room Features</h4>\n                    <ul class=\"pl-2\">\n                        <li\n                            class=\"text-sm\"\n                            *ngFor=\"let feature of space.features\"\n                        >\n                            {{ feature }}\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                pointer-events: none;\n                z-index: 1;\n            }\n\n            [name='space-info'] {\n                width: 16rem;\n            }\n\n            [status] {\n                background-color: #43a047;\n                font-weight: 500;\n            }\n\n            [status].busy {\n                background-color: #e53935;\n            }\n\n            [status].pending {\n                background-color: #ffb300;\n            }\n\n            [status].not-bookable {\n                background-color: #757575;\n            }\n        `,\n    ],\n})\nexport class ExploreSpaceInfoComponent implements OnInit {\n    /** Space to display details for */\n    public readonly space = this._details.space;\n    /** List of upcoming events for space */\n    public readonly events = this._details.events;\n    /** Current status of the space */\n    public readonly status = this._details.status;\n\n    public y_pos: 'top' | 'bottom';\n\n    public x_pos: 'left' | 'right';\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: SpaceInfoData,\n        private _element: ElementRef<HTMLElement>\n    ) {}\n\n    public ngOnInit(tries: number = 0) {\n        if (tries > 10) return;\n        setTimeout(() => {\n            const parent = this._element.nativeElement.parentElement\n                ?.parentElement;\n            if (!parent) return this.ngOnInit(++tries);\n            const position = {\n                y: parseInt(parent.style.top, 10) / 100,\n                x: parseInt(parent.style.left, 10) / 100,\n            };\n            this.y_pos = position.y >= 0.5 ? 'bottom' : 'top';\n            this.x_pos = position.x >= 0.5 ? 'right' : 'left';\n        }, 200);\n    }\n\n    public get available_until() {\n        return '';\n    }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { getModule } from '@placeos/ts-client';\nimport { ViewAction, ViewerFeature } from '@placeos/svg-viewer';\nimport { map } from 'rxjs/operators';\n\nimport {\n    BaseClass,\n    HashMap,\n    notifyError,\n    SettingsService,\n} from '@placeos/common';\nimport { Space } from '@placeos/spaces';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { ExploreSpaceInfoComponent } from './explore-space-info.component';\nimport { ExploreBookingModalComponent } from './explore-booking-modal.component';\n\nexport const DEFAULT_COLOURS = {\n    free: '#43a047',\n    pending: '#ffb300',\n    reserved: '#e65100',\n    busy: '#e53935',\n    'not-bookable': '#757575',\n    unknown: '#757575',\n};\n\n@Injectable()\nexport class ExploreSpacesService extends BaseClass implements OnDestroy {\n    private _bookings: HashMap<CalendarEvent[]> = {};\n    private _statuses: HashMap<string> = {};\n\n    private _bind = this._state.spaces.pipe(\n        map((list) => {\n            console.log('Spaces:', list);\n            this.unsubWith('b-');\n            this.unsubWith('s-');\n            this._statuses = {};\n            if (!list?.length) return;\n            for (const space of list) {\n                const mod = getModule(space.id, 'Bookings');\n                let binding = mod.binding('bookings');\n                this.subscription(\n                    `b-${space.id}`,\n                    binding\n                        .listen()\n                        .subscribe((d) =>\n                            this.handleBookingsChange(list, space, d)\n                        )\n                );\n                this.subscription(`b-bind-${space.id}`, binding.bind());\n                binding = mod.binding('status');\n                this.subscription(\n                    `s-${space.id}`,\n                    binding\n                        .listen()\n                        .subscribe((d) =>\n                            this.handleStatusChange(list, space, d)\n                        )\n                );\n                this.subscription(`s-bind-${space.id}`, binding.bind());\n            }\n            this.updateActions(list);\n            this.updateHoverElements(list);\n        })\n    );\n\n    constructor(\n        private _state: ExploreStateService,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this.subscription('spaces', this._bind.subscribe());\n    }\n\n    public bookSpace(space: Space) {\n        if (this._statuses[space.id] === 'busy' || !space.bookable) {\n            return notifyError(\n                `${\n                    space.display_name || space.name\n                } is unavailable at the current time`\n            );\n        }\n        this._dialog.open(ExploreBookingModalComponent, {\n            data: { space },\n        });\n    }\n\n    public handleBookingsChange(\n        spaces: Space[],\n        space: Space,\n        bookings: HashMap[]\n    ) {\n        if (!bookings) return;\n        this._bookings[space.id] = bookings.map((i) => new CalendarEvent(i));\n        this.timeout(\n            'update_hover_els',\n            () => this.updateHoverElements(spaces),\n            100\n        );\n    }\n\n    public handleStatusChange(spaces: Space[], space: Space, status: string) {\n        this._statuses[space.id] = space.bookable\n            ? status || 'free'\n            : 'not-bookable';\n        this.timeout(\n            'update_statuses',\n            () => {\n                this.clearTimeout('update_hover_els');\n                this.updateStatus(spaces);\n                this.updateHoverElements(spaces);\n            },\n            100\n        );\n    }\n\n    private updateStatus(spaces: Space[]) {\n        const style_map = {};\n        const colours = this._settings.get('app.explore.colors') || {};\n        for (const space of spaces) {\n            const status = this._statuses[space.id] || 'not-bookable';\n            style_map[`#${space.map_id}`] = {\n                fill:\n                    colours[`space-${status}`] ||\n                    colours[`${status}`] ||\n                    DEFAULT_COLOURS[`${status}`],\n                opacity: 0.6,\n            };\n        }\n        this._state.setStyles('spaces', style_map);\n    }\n\n    private updateHoverElements(spaces: Space[]) {\n        const features: ViewerFeature[] = [];\n        for (const space of spaces) {\n            features.push({\n                location: space.map_id,\n                hover: true,\n                content: ExploreSpaceInfoComponent,\n                data: {\n                    space,\n                    events: this._bookings[space.id],\n                    status: this._statuses[space.id],\n                },\n            } as any);\n        }\n        this._state.setFeatures('spaces', features);\n    }\n\n    private updateActions(spaces: Space[]) {\n        const actions: ViewAction[] = [];\n        for (const space of spaces) {\n            actions.push({\n                id: space.map_id,\n                action: 'click',\n                callback: () => this.bookSpace(space),\n            });\n            actions.push({\n                id: space.map_id,\n                action: 'touchend',\n                callback: () => this.bookSpace(space),\n            });\n        }\n        this._state.setActions('spaces', actions);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport {\n    Point,\n    ViewAction,\n    ViewerFeature,\n    ViewerLabel,\n    ViewerStyles,\n} from '@placeos/svg-viewer';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { debounceTime, filter, first, map } from 'rxjs/operators';\n\nimport { BaseClass, HashMap, SettingsService } from '@placeos/common';\nimport { BuildingLevel, OrganisationService } from '@placeos/organisation';\nimport { SpacesService } from '@placeos/spaces';\n\nexport interface MapOptions {\n    show_zones?: boolean;\n    show_devices?: boolean;\n    show_contacts?: boolean;\n    show_levels?: boolean;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class ExploreStateService extends BaseClass {\n    /** Currently active level */\n    private _level = new BehaviorSubject<BuildingLevel>(null);\n    /** Currently active level */\n    private _positions = new BehaviorSubject<{ zoom: number; center: Point }>({\n        zoom: 1,\n        center: { x: 0.5, y: 0.5 },\n    });\n    /** Mapping of groups to their styles */\n    private _styles = new BehaviorSubject<HashMap<ViewerStyles>>({});\n    /** Mapping of groups to their features */\n    private _features = new BehaviorSubject<HashMap<ViewerFeature[]>>({});\n    /** Mapping of groups to their actions */\n    private _actions = new BehaviorSubject<HashMap<ViewAction[]>>({});\n    /** Mapping of groups to their actions */\n    private _labels = new BehaviorSubject<HashMap<ViewerLabel[]>>({});\n\n    private _options = new BehaviorSubject<MapOptions>({});\n\n    private _message = new BehaviorSubject<string>('');\n\n    /** Currently active level */\n    public readonly level = this._level.asObservable();\n    /** Currently active level */\n    public readonly message = this._message.asObservable();\n    /** Spaces associated with the active level */\n    public readonly spaces = combineLatest([\n        this._level,\n        this._spaces.list,\n    ]).pipe(\n        map(([level, spaces]) => {\n            console.log('Level:', level, spaces);\n            return spaces.filter((space) => space.zones.includes(level.id));\n        })\n    );\n    /** Currently shown space's map URL */\n    public readonly map_url = this._level.pipe(\n        map((lvl) => (lvl ? lvl.map_id : '') || '')\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_positions = this._positions.asObservable();\n    /** Currently center and zoom positions for map */\n    public readonly map_features = combineLatest([\n        this._features,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([features, options]) => {\n            let list = [];\n            for (const key in features) {\n                switch (key) {\n                    case 'devices':\n                        options.show_zones && options.show_devices\n                            ? (list = list.concat(features[key]))\n                            : '';\n                        break;\n                    case 'contacts':\n                        options.show_contacts\n                            ? (list = list.concat(features[key]))\n                            : '';\n                        break;\n                    default:\n                        list = list.concat(features[key]);\n                }\n            }\n            return list;\n        })\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_actions = this._actions.pipe(\n        debounceTime(200),\n        map((i) => Object.values(i).reduce((list, a) => list.concat(a), []))\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_labels = combineLatest([\n        this._labels,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([labels, options]) => {\n            let list = [];\n            for (const key in labels) {\n                if (key !== 'zones' || options.show_zones) {\n                    list = list.concat(labels[key]);\n                }\n            }\n            return list;\n        })\n    );\n    /** Current map styles */\n    public readonly map_styles = combineLatest([\n        this._styles,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([styles, options]) => {\n            const style_mappings = Object.keys(styles).reduce(\n                (a, h) => ({ ...a, ...styles[h] }),\n                {}\n            );\n            if (!options.show_zones) {\n                style_mappings['#zones'] = { display: 'none' };\n                style_mappings['#Zones'] = { display: 'none' };\n            }\n            style_mappings['text'] = { display: 'none' };\n            return style_mappings;\n        })\n    );\n\n    public readonly options = this._options.asObservable();\n\n    public get positions() {\n        return this._positions.getValue();\n    }\n\n    public get active_level() {\n        return this._level.getValue();\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _spaces: SpacesService,\n        private _settings: SettingsService\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this._org.active_building.pipe(filter((_) => !!_)).subscribe((bld) => {\n            const level = this._level.getValue();\n            const level_list = this._org.levelsForBuilding(bld);\n            const has_level = level_list.find((lvl) => level?.id === lvl.id);\n            if (!has_level && level_list.length) {\n                this.setLevel(level_list[0].id);\n            }\n            this.setOptions({\n                show_devices:\n                    this._settings.get('app.explore.display_devices') !== false,\n            });\n        });\n    }\n\n    public setOptions(options: MapOptions) {\n        this._options.next({ ...this._options.getValue(), ...options });\n    }\n\n    public setLevel(zone_id: string) {\n        const lvl = this._org.levelWithID([zone_id]);\n        if (lvl) {\n            this._level.next(lvl);\n        }\n    }\n\n    public setStyles(name: string, styles: ViewerStyles) {\n        const style_map = this._styles.getValue();\n        style_map[name] = styles;\n        this._styles.next(style_map);\n    }\n\n    public setFeatures(name: string, features: ViewerFeature[]) {\n        const feature_map = this._features.getValue();\n        feature_map[name] = features;\n        this._features.next(feature_map);\n    }\n\n    public setActions(name: string, actions: ViewAction[]) {\n        const actions_map = this._actions.getValue();\n        actions_map[name] = actions;\n        this._actions.next(actions_map);\n    }\n\n    public setLabels(name: string, labels: ViewerLabel[]) {\n        const labels_map = this._labels.getValue();\n        labels_map[name] = labels;\n        this._labels.next(labels_map);\n    }\n\n    public setPositions(zoom: number, center: Point) {\n        this._positions.next({ zoom, center });\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { getModule, showMetadata } from '@placeos/ts-client';\nimport { ViewerLabel, Point } from '@placeos/svg-viewer';\nimport { first, map } from 'rxjs/operators';\n\nimport { BaseClass, HashMap, SettingsService } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { DEFAULT_COLOURS } from './explore-spaces.service';\n\nconst EMPTY_LABEL = { location: { x: -10, y: -10 }, content: '0% Usage' };\n\nexport interface ZoneData {\n    /** ID of the zone */\n    area_id: string;\n    /** Number of devices in the zone */\n    count: number;\n}\n\n@Injectable()\nexport class ExploreZonesService extends BaseClass {\n    private _statuses: HashMap<string> = {};\n    private _labels: HashMap<ViewerLabel> = {};\n    private _location: HashMap<Point> = {};\n    private _capacity: HashMap<number> = {};\n\n    private _bind = this._state.level.pipe(\n        map((lvl) => {\n            if (!lvl) return;\n            this._statuses = {};\n            const building = this._org.buildings.find(\n                (bld) => bld.id === lvl.parent_id\n            );\n            if (!building) return;\n            const system_id =\n                building.bindings.area_management ||\n                this._org.organisation.bindings.area_management;\n            if (!system_id) return;\n            const binding = getModule(system_id, 'AreaManagement').binding(\n                `${lvl.id}:areas`\n            );\n            console.log('Bind:', binding);\n            this.subscription(\n                `zones`,\n                binding.listen().subscribe((d) => this.parseData(d))\n            );\n            this.subscription('binding', binding.bind());\n        })\n    );\n\n    constructor(\n        private _state: ExploreStateService,\n        private _org: OrganisationService,\n        private _settings: SettingsService\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        const zone_metadata = await Promise.all(\n            this._org.levels.map((bld) =>\n                showMetadata(bld.id, { name: 'map_regions' }).toPromise()\n            )\n        );\n        for (const zone of zone_metadata) {\n            const areas = (zone?.details as any)?.areas;\n            if (areas) {\n                for (const area of areas) {\n                    this._capacity[area.id] = area.properties?.capacity || 100;\n                    this._location[area.id] = area.properties\n                        ?.label_location || { x: 0.5, y: 0.5 };\n                }\n            }\n        }\n        this.subscription('bind', this._bind.subscribe());\n    }\n\n    public parseData(data?: { value: ZoneData[] }) {\n        const value = data?.value || [];\n        const labels = [];\n        for (const zone of value) {\n            const filled = zone.count / (this._capacity[zone.area_id] || 100);\n            this._statuses[zone.area_id] =\n                filled < 0.4 ? 'free' : filled < 0.75 ? 'pending' : 'busy';\n            this._labels[zone.area_id] = {\n                location: this._location[zone.area_id],\n                content: `${zone.count} ${\n                    zone.count === 1 ? 'Device' : 'Devices'\n                }`,\n            };\n            labels.push(this._labels[zone.area_id]);\n        }\n        this._state.setLabels('zones', labels);\n        this.timeout('update', () => this.updateStatus(), 100);\n    }\n\n    private updateStatus() {\n        const style_map = {};\n        const colours = this._settings.get('app.explore.colors') || {};\n        for (const zone_id in this._statuses) {\n            if (!this._statuses[zone_id]) continue;\n            style_map[`#${zone_id}`] = {\n                fill:\n                    colours[`zone-${this._statuses[zone_id]}`] ||\n                    colours[`${this._statuses[zone_id]}`] ||\n                    DEFAULT_COLOURS[`${this._statuses[zone_id]}`],\n                opacity: 0.6,\n            };\n        }\n        this._state.setStyles('zones', style_map);\n    }\n}\n","import { Component } from '@angular/core';\nimport { ExploreStateService } from './explore-state.service';\n\n@Component({\n    selector: `explore-zoom-controls`,\n    template: `\n        <button z-in mat-icon-button class=\"bg-white\" (click)=\"zoomIn()\">\n            <app-icon>add</app-icon>\n        </button>\n        <button z-out mat-icon-button class=\"bg-white\" (click)=\"zoomOut()\">\n            <app-icon>remove</app-icon>\n        </button>\n        <button reset mat-icon-button class=\"bg-white\" (click)=\"reset()\">\n            <app-icon>autorenew</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                padding: 0.5rem;\n            }\n\n            button {\n                border: 1px solid #ccc;\n                border-radius: 0;\n            }\n\n            button:first-child {\n                border-radius: 0.25rem 0.25rem 0 0;\n                border-bottom: none;\n            }\n\n            button:last-child {\n                border-radius: 0 0 0.25rem 0.25rem;\n                border-top: none;\n            }\n        `,\n    ],\n})\nexport class ExploreZoomControlComponent {\n    public readonly zoomIn = () =>\n        this._state.setPositions(\n            Math.min(10, this._state.positions.zoom * 1.2),\n            this._state.positions.center\n        );\n    public readonly zoomOut = () =>\n        this._state.setPositions(\n            Math.max(1, this._state.positions.zoom * (1 / 1.2)),\n            this._state.positions.center\n        );\n    public readonly reset = () =>\n        this._state.setPositions(1, { x: 0.5, y: 0.5 });\n\n    constructor(private _state: ExploreStateService) {}\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport { ComponentsModule } from '@placeos/components';\n\nimport { ActionFieldComponent } from './action-field.component';\nimport { CounterComponent } from './counter.component';\nimport { DateFieldComponent } from './date-field.component';\nimport { DurationFieldComponent } from './duration-field.component';\nimport { TimeFieldComponent } from './time-field.component';\nimport { UserListFieldComponent } from './user-list-field.component';\nimport { UserSearchFieldComponent } from './user-search-field.component';\nimport { ItemListFieldComponent } from './item-list-field.component';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\n\nexport * from './action-field.component';\nexport * from './counter.component';\nexport * from './date-field.component';\nexport * from './duration-field.component';\nexport * from './time-field.component';\nexport * from './user-list-field.component';\nexport * from './user-search-field.component';\n\nconst COMPONENTS: Type<any>[] = [\n    ActionFieldComponent,\n    CounterComponent,\n    DateFieldComponent,\n    DurationFieldComponent,\n    TimeFieldComponent,\n    UserListFieldComponent,\n    UserSearchFieldComponent,\n    ItemListFieldComponent,\n];\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        MatAutocompleteModule,\n        MatTooltipModule,\n        MatCheckboxModule,\n        ComponentsModule,\n    ],\n    exports: [...COMPONENTS],\n})\nexport class FormFieldsModule {}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\n\n@Component({\n    selector: 'an-action-field',\n    template: `\n        <div\n            class=\"flex items-center rounded p-2 border border-gray-300 hover:border-black\"\n            role=\"button\"\n            [attr.disabled]=\"disabled\"\n            form-field\n            tabindex=\"0\"\n            (keydown.enter)=\"performAction()\"\n        >\n            <div\n                placeholder\n                class=\"flex-1 w-0 truncate\"\n                (click)=\"performAction()\"\n            >\n                <ng-content></ng-content>\n            </div>\n            <app-icon class=\"text-xl\" (click)=\"performAction()\">\n                arrow_drop_{{ show_tooltip ? 'up' : 'down' }}\n            </app-icon>\n        </div>\n    `,\n    styles: [\n        `\n            :host > div:hover {\n                box-shadow: inset 0 0 0 1px #000;\n            }\n        `,\n    ],\n})\nexport class ActionFieldComponent {\n    /** Name of the field */\n    @Input() public name: string;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Emitter for user interaction events */\n    @Output('onAction') public on_action = new EventEmitter();\n    /** Whether to show tooltip */\n    public show_tooltip = false;\n\n    /**\n     * Emit that the user has performed an action on the field\n     */\n    public performAction() {\n        this.show_tooltip = !this.show_tooltip;\n        this.on_action.emit();\n    }\n}\n","import { Component, forwardRef, Input } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\n\n@Component({\n    selector: 'a-counter',\n    template: `\n        <div\n            counter\n            class=\"flex items-center text-base\"\n            (window:keydown.shift)=\"shift_key = true\"\n            (window:keydown.control)=\"ctrl_key = true\"\n            (window:keydown.meta)=\"ctrl_key = true\"\n            (window:keyup.shift)=\"shift_key = false\"\n            (window:keyup.control)=\"ctrl_key = false\"\n            (window:keyup.meta)=\"ctrl_key = false\"\n        >\n            <button\n                mat-icon-button\n                name=\"remove\"\n                type=\"button\"\n                [disabled]=\"!value || value === min\"\n                (click)=\"remove()\"\n            >\n                <app-icon>remove</app-icon>\n            </button>\n            <div value class=\"p-1 text-center\">{{ (render_fn ? render_fn(value) : value) || '0' }}</div>\n            <button\n                mat-icon-button\n                name=\"add\"\n                type=\"button\"\n                [disabled]=\"value === max\"\n                (click)=\"add()\"\n            >\n                <app-icon>add</app-icon>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            [value] {\n                min-width: 3em;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            /* istanbul ignore next */\n            useExisting: forwardRef(() => CounterComponent),\n            multi: true,\n        },\n    ],\n})\nexport class CounterComponent implements ControlValueAccessor {\n    /** Size of a single step */\n    @Input() public step = 1;\n    /** Maximum amount for the counter */\n    @Input() public max = 10;\n    /** Minimum amount for the counter */\n    @Input() public min = 0;\n    /** Custom function for rendering the counter value */\n    @Input() public render_fn: (v: number) => string;\n    /** Current value of the counter */\n    public value: number;\n    /** Whether shift key is being held by the user */\n    public shift_key: boolean;\n    /** Whether control key is being held by the user */\n    public ctrl_key: boolean;\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /**\n     * Add the `step` to the current value\n     */\n    public add() {\n        if (!this.value) {\n            this.value = this.min || 0;\n        }\n        const step = this.ctrl_key ? 100 * this.step : this.shift_key ? 10 * this.step : this.step || 1;\n        this.value += step;\n        if (this.value > this.max) {\n            this.value = this.max || 10;\n        }\n        this.setValue(this.value);\n    }\n\n    /** Remove the `step` from the current value */\n    public remove() {\n        if (!this.value) {\n            this.value = this.min || 0;\n        }\n        const step = this.ctrl_key ? 100 * this.step : this.shift_key ? 10 * this.step : this.step || 1;\n        this.value -= step;\n        if (this.value < this.min) {\n            this.value = this.min || 0;\n        }\n        this.setValue(this.value);\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number): void {\n        this.value = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.value = value;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n}\n","import {\n    Component,\n\n    forwardRef,\n\n    Injectable, Input, OnInit\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport {\n    DateAdapter,\n    MatDateFormats,\n    MAT_DATE_FORMATS,\n    NativeDateAdapter\n} from '@angular/material/core';\nimport {\n    addYears,\n\n    endOfDay,\n    format,\n    formatISO,\n    set, startOfDay\n} from 'date-fns';\nimport { BaseClass } from 'libs/common/src/lib/base.class';\nimport { HashMap } from 'libs/common/src/lib/types';\n\n@Injectable()\nclass FieldDateAdapter extends NativeDateAdapter {\n    format(date: Date, displayFormat: HashMap | string): string {\n        if (displayFormat === 'input') {\n            return format(date, 'MMMM d, yyyy');\n        }\n        return format(date, 'MMM yyyy');\n    }\n}\nconst FIELD_DATE_FORMATS: MatDateFormats = {\n    parse: {\n        dateInput: 'LL',\n    },\n    display: {\n        dateInput: 'input',\n        monthYearLabel: 'MMM YYYY',\n        dateA11yLabel: 'LL',\n        monthYearA11yLabel: 'MMMM YYYY',\n    },\n};\n\n@Component({\n    selector: 'a-date-field',\n    template: `\n        <mat-form-field appearance=\"outline\" overlay (click)=\"picker.open()\">\n            <input\n                matInput\n                [ngModel]=\"date\"\n                [disabled]=\"disabled\"\n                [min]=\"from\"\n                [max]=\"until\"\n                (ngModelChange)=\"setValue($event)\"\n                [matDatepicker]=\"picker\"\n            />\n            <mat-datepicker-toggle\n                matSuffix\n                [for]=\"picker\"\n            ></mat-datepicker-toggle>\n            <mat-datepicker #picker></mat-datepicker>\n            <mat-error><ng-content></ng-content></mat-error>\n        </mat-form-field>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        { provide: DateAdapter, useClass: FieldDateAdapter },\n        { provide: MAT_DATE_FORMATS, useValue: FIELD_DATE_FORMATS },\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DateFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DateFieldComponent\n    extends BaseClass\n    implements OnInit, ControlValueAccessor {\n    /** Earliest date available the user is allowed to pick */\n    @Input('from') public _from: number = new Date().valueOf();\n    /** Latest date available the user is allowed to pick */\n    @Input('to') public _to: number;\n    /** Position of the tooltip */\n    @Input() public position: 'right' | 'left' = 'right';\n    /** Offset of the tooltip */\n    @Input() public offset: 'top' | 'bottom' = 'bottom';\n    /** Whether form control is disabled */\n    @Input() public disabled: boolean;\n    /** Whether to show the calendar tooltip */\n    public show_tooltip: boolean;\n    /** Currently selected date */\n    public date: string;\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /** First allowed date on the calendar */\n    public get from(): Date {\n        return new Date(this._from) || startOfDay(new Date());\n    }\n    /** Current date value */\n    public get until(): Date {\n        return new Date(this._to) || addYears(endOfDay(new Date()), 1);\n    }\n    /** Display value for the current date */\n    public get date_string(): string {\n        return format(new Date(this.date), 'DD MMM YYYY');\n    }\n\n    public ngOnInit() {\n        this.date = new Date().toISOString();\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number) {\n        // Keep hours and minutes of the old date\n        const old_date = new Date(this.date);\n        let new_date = set(new_value, {\n            hours: old_date.getHours(),\n            minutes: old_date.getMinutes(),\n        }).valueOf();\n        // Check that new date is before from\n        if (new_date < this.from.valueOf()) {\n            new_date = this.from.valueOf();\n        }\n        this.date = formatISO(new_date || new Date());\n        if (this._onChange) {\n            this._onChange(new_date);\n        }\n        this.show_tooltip = false;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.date = formatISO(value || new Date());\n        this.show_tooltip = false;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n}\n","import { Component, forwardRef, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { Identity } from '@placeos/common';\nimport { formatDuration } from 'date-fns';\nimport * as dayjs from 'dayjs';\n\n\n\n@Component({\n    selector: 'a-duration-field',\n    template: `\n        <div class=\"duration-field\" [attr.disabled]=\"disabled\">\n            <mat-form-field appearance=\"outline\">\n                <mat-select\n                    #select\n                    [value]=\"duration\"\n                    [disabled]=\"disabled\"\n                    [placeholder]=\"duration + ' minutes'\"\n                    (valueChange)=\"setValue($event)\"\n                >\n                    <mat-option *ngFor=\"let option of duration_options\" [value]=\"option.id\">\n                        {{ option.name }}\n                    </mat-option>\n                </mat-select>\n                <mat-error><ng-content></ng-content></mat-error>\n            </mat-form-field>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DurationFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DurationFieldComponent implements OnInit, OnChanges, ControlValueAccessor {\n    /** Maximum duration option available */\n    @Input() public max = 240;\n    /** Minimum duration option available */\n    @Input() public min = 30;\n    /** Step value between options */\n    @Input() public step = 15;\n    /** Reference time for displaying next to durations */\n    @Input() public time: number;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Special case prepopulation i.e. out of step options */\n    @Input() public specialPreprops: Array<number> = [];\n\n    public duration = 60;\n    /** List of available duration options */\n    public duration_options: Identity[];\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    public ngOnInit(): void {\n        this.duration_options = this.generateDurationOptions(this.max, this.min, this.step);\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        /* istanbul ignore else */\n        if (changes.max || changes.min || changes.step || changes.time) {\n            this.duration_options = this.generateDurationOptions(this.max, this.min, this.step);\n        }\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number): void {\n        this.duration = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(+new_value);\n        }\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.duration = value;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    private generateDurationOptions(max: number, min: number, step: number): Identity[] {\n        const blocks: Identity[] = [];\n        let time = min;\n        const date = this.time ? dayjs(this.time) : null;\n\n        // Add special case for 10min duration/prepropulation\n        for (const option of this.specialPreprops) {\n            blocks.push({\n                id: option,\n                name: date\n                    ? `${date.add(option, 'm').format('h:mm A')} (${formatDuration({\n                          hours: Math.floor(option / 60),\n                          minutes: option % 60,\n                      })})`\n                    : `${formatDuration({ hours: Math.floor(option / 60), minutes: option % 60 })}`,\n            });\n        }\n\n        while (time <= max) {\n            blocks.push({\n                id: time,\n                name: date\n                    ? `${date.add(time, 'm').format('h:mm A')} (${formatDuration({\n                          hours: Math.floor(time / 60),\n                          minutes: time % 60,\n                      })})`\n                    : `${formatDuration({ hours: Math.floor(time / 60), minutes: time % 60 })}`,\n            });\n            time += step;\n        }\n        return blocks;\n    }\n}\n","import {\n    Component,\n    forwardRef,\n    Input,\n    OnChanges,\n    OnInit,\n    SimpleChanges,\n    ViewChild\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { MatSelect } from '@angular/material/select';\nimport { BaseClass, Identity, timeFormatString } from '@placeos/common';\nimport {\n    addMinutes,\n    endOfDay,\n    format,\n    isAfter,\n    isSameDay,\n    roundToNearestMinutes,\n    set,\n    startOfDay,\n    startOfMinute\n} from 'date-fns';\n\n@Component({\n    selector: 'a-time-field',\n    template: `\n        <mat-form-field\n            appearance=\"outline\"\n            [style.display]=\"show_select ? 'none' : ''\"\n            (keydown.enter)=\"showSelect()\"\n        >\n            <input\n                matInput\n                type=\"time\"\n                [disabled]=\"disabled\"\n                [ngModel]=\"time\"\n                (ngModelChange)=\"setValue($event)\"\n            />\n            <button mat-icon-button matSuffix class=\"relative top-1 -right-1\" (click)=\"showSelect()\">\n                <app-icon class=\"text-2xl text-black text-opacity-50\">\n                    arrow_drop_down\n                </app-icon>\n            </button>\n            <mat-error><ng-content></ng-content></mat-error>\n        </mat-form-field>\n        <mat-form-field appearance=\"outline\" *ngIf=\"show_select\">\n            <mat-select\n                #select\n                [value]=\"time\"\n                [disabled]=\"disabled\"\n                (valueChange)=\"setValue($event)\"\n            >\n                <mat-option\n                    *ngFor=\"let option of time_options\"\n                    [value]=\"option.id\"\n                >\n                    {{ option.name }}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => TimeFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class TimeFieldComponent\n    extends BaseClass\n    implements OnInit, OnChanges, ControlValueAccessor {\n    /** Time step between each allowed time option */\n    @Input() public step = 15;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Whether past times are allowed */\n    @Input() public no_past_times = true;\n    /** String representing the currently set time */\n    public date: number = new Date().valueOf();\n    /** String representing the currently set time */\n    public time: string = format(new Date(), 'HH:mm');\n    /** Available time blocks for the selected date */\n    public _time_options: Identity[];\n    /** Whether select field should be shown */\n    public show_select: boolean;\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    /** Select field for selecting the time */\n    @ViewChild('select') private select_field: MatSelect;\n\n    public ngOnInit(): void {\n        this.show_select = true;\n        this._time_options = this.generateAvailableTimes(\n            this.date,\n            !this.no_past_times,\n            this.step\n        );\n        this.timeout('hide', () => (this.show_select = false));\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.no_past_times || changes.step) {\n            this._time_options = this.generateAvailableTimes(\n                this.date,\n                !this.no_past_times,\n                this.step\n            );\n        }\n    }\n\n    /** Available time blocks for the selected date */\n    public get time_options() {\n        const time = (this.time || '00:00').split(':');\n        const date = set(this.date, { hours: +time[0], minutes: +time[1] });\n        if (\n            date.getMinutes() % 15 !== 0 &&\n            !this._time_options.find(\n                (time) => time.id === format(date, 'HH:mm')\n            )\n        ) {\n            this._time_options.push({\n                name: `${format(date, timeFormatString())}`,\n                id: format(date, 'HH:mm'),\n            });\n            this._time_options.sort((a, b) =>\n                `${a.id}`.localeCompare(`${b.id}`)\n            );\n        }\n        return this._time_options;\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: string): void {\n        this.time = new_value;\n        if (this._onChange) {\n            const time = (this.time || '00:00').split(':');\n            const date = startOfMinute(\n                set(this.date, { hours: +time[0], minutes: +time[1] })\n            );\n            this._onChange(date.valueOf());\n        }\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.date = value || this.date;\n        let date = startOfMinute(this.date);\n        date = roundToNearestMinutes(date, { nearestTo: 5 });\n        this.time = format(date, 'HH:mm');\n        this._time_options = this.generateAvailableTimes(\n            this.date,\n            !this.no_past_times,\n            this.step\n        );\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    /**\n     * Show select field for time options\n     */\n    public showSelect() {\n        this.show_select = true;\n        this.timeout('on_shown', () => {\n            if (this.select_field) {\n                this.select_field.focus();\n                this.select_field.open();\n                this.subscription(\n                    'listen_close',\n                    this.select_field.openedChange.subscribe((state) => {\n                        if (!state) {\n                            this.show_select = false;\n                        }\n                    })\n                );\n            }\n        });\n    }\n\n    /**\n     * Generate a list of time options for the given date\n     * @param datestamp Date to generate options for\n     * @param show_past Whether past times should be options\n     */\n    private generateAvailableTimes(\n        datestamp: number,\n        show_past: boolean,\n        step: number = 15\n    ): Identity[] {\n        const now = new Date();\n        let date = new Date(datestamp);\n        const blocks = [];\n        if (show_past || (!isSameDay(date, now) && isAfter(date, now))) {\n            date = startOfDay(date);\n        } else if (isAfter(date, now)) {\n            date = now;\n        }\n        date = roundToNearestMinutes(date, { nearestTo: step });\n        const end = endOfDay(date);\n        // Add options for the rest of the day\n        while (isAfter(end, date)) {\n            blocks.push({\n                name: `${format(date, timeFormatString())}`,\n                id: format(date, 'HH:mm'),\n            });\n            date = addMinutes(date, step);\n        }\n        return blocks;\n    }\n}\n","import {\n    Component,\n    forwardRef,\n    Output,\n    EventEmitter,\n    Input,\n} from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport {\n    BaseClass,\n    csvToJson,\n    currentUser,\n    downloadFile,\n    notifyError,\n    SettingsService,\n} from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\nimport { NewUserModalComponent, User, USER_DOMAIN } from '@placeos/users';\nimport { MatDialog } from '@angular/material/dialog';\n\nfunction validateEmail(email) {\n    const re = /^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    return re.test(email);\n}\n\n@Component({\n    selector: 'a-user-list-field',\n    template: `\n        <div\n            class=\"mb-4bg-white text-black\"\n            form-field\n            [attr.disabled]=\"disabled\"\n        >\n            <div search>\n                <a-user-search-field\n                    [(ngModel)]=\"search_user\"\n                    [guests]=\"guests\"\n                    [filter]=\"filter\"\n                    error=\"Click on Add External to add an attendee.\"\n                    [empty_fn]=\"emptyClick\"\n                    [validate]=\"validFn\"\n                    (ngModelChange)=\"addUser($event)\"\n                ></a-user-search-field>\n            </div>\n            <div class=\"flex items-center\" *ngIf=\"!hide_actions && !simple\">\n                <button\n                    mat-button\n                    type=\"button\"\n                    name=\"new-contact\"\n                    class=\"clear underline flex-1\"\n                    (click)=\"openNewUserModal()\"\n                    i18n=\"Add new external attendee\"\n                >\n                    Add External\n                </button>\n                <button\n                    mat-button\n                    type=\"button\"\n                    class=\"clear underline flex-1 relative\"\n                    name=\"upload-csv\"\n                    i18n=\"Upload attendee list from CSV file\"\n                >\n                    Upload CSV\n                    <input\n                        class=\"opacity-0 absolute inset-0\"\n                        type=\"file\"\n                        (change)=\"addUsersFromFile($event)\"\n                    />\n                </button>\n                <button\n                    mat-button\n                    type=\"button\"\n                    class=\"clear underline flex-1\"\n                    name=\"download-template\"\n                    (click)=\"downloadCSVTemplate()\"\n                    i18n=\"Download template CSV file\"\n                >\n                    CSV Template\n                </button>\n            </div>\n            <div\n                class=\"flex flex-col py-2\"\n                *ngIf=\"active_list?.length; else empty_state\"\n            >\n                <div\n                    user\n                    *ngFor=\"let user of active_list\"\n                    class=\"flex items-center space-x-2 p-2 hover:bg-black hover:bg-opacity-5 rounded\"\n                    (click)=\"openNewUserModal(user)\"\n                >\n                    <a-user-avatar\n                        [user]=\"user\"\n                        [icon]=\"!user.is_external\"\n                        [matTooltip]=\"\n                            user.is_external\n                                ? 'External Attendee'\n                                : 'Staff Attendee'\n                        \"\n                        matTooltipPosition=\"right\"\n                    >\n                        <div class=\"h-full w-full bg-success text-white\">\n                            <app-icon>done</app-icon>\n                        </div>\n                    </a-user-avatar>\n                    <div class=\"flex-1\">\n                        <div>{{ user.name }}</div>\n                        <div class=\"text-xs\">{{ user.email }}</div>\n                    </div>\n                    <mat-checkbox\n                        class=\"mt-2 mx-4\"\n                        [(ngModel)]=\"user.required\"\n                        matTooltip=\"Required\"\n                        matTooltipPosition=\"left\"\n                        (click)=\"$event.stopPropagation()\"\n                        *ngIf=\"!simple\"\n                    ></mat-checkbox>\n                    <button\n                        mat-icon-button\n                        type=\"button\"\n                        (click)=\"\n                            user.visit_expected = !user.visit_expected;\n                            $event.stopPropagation()\n                        \"\n                        [class.bg-success]=\"user.visit_expected\"\n                        [class.text-white]=\"user.visit_expected\"\n                        matTooltip=\"Physical visit expected\"\n                        matTooltipPosition=\"left\"\n                        *ngIf=\"!simple\"\n                    >\n                        <app-icon>meeting_room</app-icon>\n                    </button>\n                    <button\n                        mat-icon-button\n                        type=\"button\"\n                        [disabled]=\"!user.is_external\"\n                        (click)=\"\n                            user.assistance_required = !user.assistance_required;\n                            $event.stopPropagation()\n                        \"\n                        [class.bg-success]=\"user.assistance_required\"\n                        [class.text-white]=\"user.assistance_required\"\n                        matTooltip=\"Assistance Required\"\n                        matTooltipPosition=\"left\"\n                        *ngIf=\"!simple\"\n                    >\n                        <app-icon *ngIf=\"user.is_external\"\n                            >contact_support</app-icon\n                        >\n                    </button>\n                    <button\n                        mat-icon-button\n                        type=\"button\"\n                        (click)=\"removeUser(user); $event.stopPropagation()\"\n                    >\n                        <app-icon>close</app-icon>\n                    </button>\n                </div>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"m-2 opacity-50 text-center\" i18n=\"Attendee empty state\">\n                None\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            button {\n                background: transparent;\n                border-top: none !important;\n                border-bottom: none !important;\n            }\n\n            [search] {\n                height: 3.5rem;\n                margin-top: -0.25rem;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UserListFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UserListFieldComponent\n    extends BaseClass\n    implements ControlValueAccessor {\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Whether form field should show simplifyed template */\n    @Input() public simple: boolean;\n    /** Number of characters needed before a search will start */\n    @Input() public limit = 3;\n    /** Whether guests should also show when searching for users */\n    @Input() public guests = false;\n    /** Whether optional actions should be shown */\n    @Input('hideActions') public hide_actions = false;\n    /** Function for filtering the results of the user list */\n    @Input() public filter: (_: any) => boolean;\n    /** Emitter for action to make a new user */\n    @Output() public new_user = new EventEmitter<void>();\n\n    public search_user: User;\n\n    /** User list to display */\n    public user_list: User[] = [];\n    /** List of active selected users on the list */\n    public active_list: User[] = [];\n    /** Whether user list is loading */\n    public loading: boolean;\n\n    /** Form control on change handler */\n    private _onChange: (_: User[]) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: User[]) => void;\n\n    public readonly validFn = (s) => validateEmail(s);\n    public readonly emptyClick = () => this.openNewUserModal(new User());\n\n    constructor(\n        private _dialog: MatDialog,\n        private _settings: SettingsService\n    ) {\n        super();\n    }\n\n    /**\n     * Add user to the user list\n     * @param user\n     */\n    public addUser(user: User) {\n        console.log('Add user:', user);\n        const list = this.active_list.filter((_) => _.email !== user.email);\n        this.setValue([...list, user]);\n        this.timeout('clear_user', () => (this.search_user = null), 10);\n    }\n\n    /**\n     * Remove user from the user list\n     * @param user\n     */\n    public removeUser(user: User) {\n        const list = this.active_list.filter(\n            (a_user) => a_user.email !== user.email\n        );\n        this.setValue(list);\n    }\n\n    /**\n     * Load CSV file and populate the user list with the contents\n     * @param event File input field event\n     */\n    public addUsersFromFile(event) {\n        /* istanbul ignore else */\n        if (event.target) {\n            const file = event.target.files[0];\n            /* istanbul ignore else */\n            if (file) {\n                const reader = new FileReader();\n                reader.readAsText(file, 'UTF-8');\n                reader.addEventListener('load', (evt) => {\n                    this.processCsvData((evt.srcElement as any).result);\n                    event.target.value = '';\n                });\n                reader.addEventListener('error', (_) =>\n                    notifyError('Error reading file.')\n                );\n            }\n        }\n    }\n\n    /**\n     * Process raw CSV data and save user data to attendee list\n     * @param data CSV data\n     */\n    private processCsvData(data: string) {\n        const list = csvToJson(data) || [];\n        const id = currentUser()?.staff_id || 'unknown';\n        for (const el of list) {\n            el.name = el.name || `${el.first_name} ${el.last_name}`;\n            const display = (\n                el.name || `${Math.floor(Math.random() * 9999_9999)}`\n            )\n                .split(' ')\n                .join('_')\n                .toLowerCase();\n            /* istanbul ignore else */\n            if (!el.email) {\n                el.email = `${display}+${id}@guest.${USER_DOMAIN}`;\n            }\n            const internal_emails = this._settings.get(\n                'app.booking.internal_emails'\n            ) || ['place.tech'];\n            el.visit_expected = !internal_emails.find((_) =>\n                el.email.endsWith(_)\n            );\n\n            /** Convert phone to string. PWCME-544 */\n            el.phone = '' + el.phone;\n\n            this.addUser(new User(el));\n        }\n    }\n\n    /* istanbul ignore next */\n    /** Download template CSV file */\n    public downloadCSVTemplate() {\n        const template = `Organisation,First Name,Last Name,Email,Phone,Assistance Required\\nFake Org,John,Smith,john.smith@example.com,01234567898, yes`;\n        downloadFile('template.csv', template);\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User[]): void {\n        this.active_list = new_value;\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User[]) {\n        this.active_list = value;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: User[]) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: User[]) => void): void {\n        this._onTouch = fn;\n    }\n\n    public displayFn(item): string {\n        return item?.name || '';\n    }\n\n    /**\n     * Open modal to add or update user details\n     */\n    public openNewUserModal(user: User = new User()) {\n        console.log('Open User Modal:', user);\n        const ref = this._dialog.open<NewUserModalComponent>(\n            NewUserModalComponent,\n            {\n                width: 'auto',\n                height: 'auto',\n                data: { user },\n            }\n        );\n        ref.componentInstance?.event\n            .pipe(first((_) => _.reason === 'done'))\n            .subscribe((event) => {\n                this.addUser(event.metadata);\n                ref.close();\n            });\n    }\n}\n","/* eslint-disable @typescript-eslint/member-ordering */\nimport {\n    Component,\n    OnInit,\n    forwardRef,\n    Input,\n    ViewChild,\n    ElementRef,\n} from '@angular/core';\nimport { NG_VALUE_ACCESSOR, ControlValueAccessor } from '@angular/forms';\nimport { Subject, Observable, of, forkJoin } from 'rxjs';\nimport {\n    switchMap,\n    debounceTime,\n    distinctUntilChanged,\n    map,\n    catchError,\n} from 'rxjs/operators';\n\nimport { BaseClass, flatten } from '@placeos/common';\nimport { searchGuests, searchStaff, User } from '@placeos/users';\n\n@Component({\n    selector: 'a-user-search-field',\n    template: `\n        <div class=\"user-search-field text-black\" form-field>\n            <mat-form-field overlay appearance=\"outline\">\n                <input\n                    #input\n                    matInput\n                    keyboard\n                    name=\"user-search\"\n                    [(ngModel)]=\"search_str\"\n                    (ngModelChange)=\"search$.next($event)\"\n                    [disabled]=\"disabled\"\n                    [placeholder]=\"placeholder || 'Search for user...'\"\n                    [matAutocomplete]=\"auto\"\n                    (keyup.enter)=\"\n                        validate && validate(search_str)\n                            ? setValue(search_str)\n                            : ''\n                    \"\n                    (blur)=\"resetSearchString()\"\n                    (focus)=\"cancelReset()\"\n                />\n                <app-icon matPrefix class=\"text-2xl relative\">search</app-icon>\n                <mat-spinner\n                    *ngIf=\"loading\"\n                    matSuffix\n                    diameter=\"16\"\n                ></mat-spinner>\n            </mat-form-field>\n            <mat-autocomplete\n                #auto=\"matAutocomplete\"\n                (optionSelected)=\"setValue($event.option.value)\"\n            >\n                <mat-option\n                    *ngFor=\"let option of user_list\"\n                    [value]=\"option\"\n                    (click)=\"blurInput()\"\n                >\n                    <div class=\"leading-tight\">{{ option.name }}</div>\n                    <div class=\"text-xs text-black opacity-60\">\n                        {{ option.email }}\n                    </div>\n                </mat-option>\n                <mat-option\n                    *ngIf=\"search_str && validate && validate(search_str)\"\n                    [value]=\"search_str\"\n                >\n                    Add external attendee \"{{ search_str }}\"\n                </mat-option>\n                <mat-option\n                    *ngIf=\"!user_list?.length && (search_str || error)\"\n                    [disabled]=\"!empty_fn\"\n                    (click)=\"empty_fn()\"\n                >\n                    {{ search_str ? 'No users found.' : '' }} {{ error }}\n                </mat-option>\n            </mat-autocomplete>\n        </div>\n    `,\n    styles: [\n        `\n            :host,\n            mat-form-field {\n                width: 100%;\n            }\n\n            app-icon {\n                top: 0.15em;\n                left: -0.15em;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => UserSearchFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class UserSearchFieldComponent\n    extends BaseClass\n    implements OnInit, ControlValueAccessor {\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Placeholder text to display */\n    @Input() public placeholder: string;\n    /** Limit available options to these */\n    @Input() public options: User[];\n    /** Whether guests should also show when searching for users */\n    @Input() public guests: boolean;\n    /** Message to display when no user matches have been found */\n    @Input() public error = '';\n    /** Function to validate the search string */\n    @Input() public validate: (s: string) => boolean;\n    /** Function to call when empty list option is clicked */\n    @Input() public empty_fn: () => void;\n    /** Function for filtering the results of the user list */\n    @Input() public filter: (_: any, s?: string) => boolean;\n\n    @Input() public query_fn: (_: string) => Observable<User[]> = (q) =>\n        searchStaff(q);\n    /** Currently selected user */\n    public active_user: User;\n    /** User list to display */\n    public user_list: User[];\n    /** Whether user list is loading */\n    public loading: boolean;\n    /** Current display value of the search input field  */\n    public search_str: string;\n    /** Subject holding the value of the search */\n    public search$ = new Subject<string>();\n    /** List of users from an API search */\n    public search_results$: Observable<User[]> = this.search$.pipe(\n        debounceTime(400),\n        distinctUntilChanged(),\n        switchMap((query) => {\n            this.loading = true;\n            return this.options && this.options.length > 0\n                ? of(this.options)\n                : query.length >= 3\n                ? !this.guests\n                    ? this.query_fn(query)\n                    : forkJoin([searchStaff(query), searchGuests(query)])\n                : of([]);\n        }),\n        catchError((_) => of([])),\n        map((list: User[]) => {\n            this.loading = false;\n            list = flatten(list);\n            const search = (this.search_str || '').toLowerCase();\n            return list.filter(\n                (item) => !this.filter || this.filter(item, search)\n            );\n        })\n    );\n\n    /** Form control on change handler */\n    private _onChange: (_: User) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: User) => void;\n\n    @ViewChild('input', { read: ElementRef })\n    private _input_el: ElementRef<HTMLInputElement>;\n\n    public cancelReset = () => this.clearTimeout('reset');\n\n    public blurInput = () => {\n        this.timeout('blur', () => this._input_el?.nativeElement?.blur());\n    };\n\n    public ngOnInit(): void {\n        // Process API results\n        this.subscription(\n            'search_results',\n            this.search_results$.subscribe((list) => (this.user_list = list))\n        );\n    }\n\n    /**\n     * Reset the search string back to the name of the active user\n     */\n    public resetSearchString() {\n        this.timeout(\n            'reset',\n            () => (this.search_str = this.active_user?.name || ''),\n            150\n        );\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: User | string, email?: string): void {\n        if (\n            typeof new_value === 'string' &&\n            (new_value as any) === this.search_str\n        ) {\n            new_value = new User({\n                name: (this.search_str || email || '').split('@')[0],\n                email: this.search_str || email || '',\n            });\n        }\n        if (!(new_value instanceof User)) return;\n        this.active_user = new_value;\n        if (this._onChange) {\n            this._onChange(new_value);\n        }\n        this.resetSearchString();\n    }\n\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: User) {\n        this.active_user = value;\n        this.resetSearchString();\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: User) => void): void {\n        this._onChange = fn;\n    }\n\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: User) => void): void {\n        this._onTouch = fn;\n    }\n}\n","import { HashMap, Identity } from '@placeos/common';\n\n/** Building Level data */\nexport class BuildingLevel {\n    /** ID of the building level zone */\n    public readonly id: string;\n    /** ID of the building zone associated with the level */\n    public readonly parent_id: string;\n    /** Name of the level */\n    public readonly name: string;\n    /** Display name */\n    public readonly display_name: string;\n    /** Capacity for the level */\n    public readonly capacity: number;\n    /** Number or letter representing the level */\n    public readonly number: string;\n    /** URL of the map associated with the level */\n    public readonly map_id: string;\n    /** Settings overrides associated with the level */\n    public readonly settings: HashMap = {};\n    /** List of points of interest for the level */\n    public readonly locations: readonly Identity[];\n\n    constructor(_data: Partial<BuildingLevel> = {}) {\n        this.id = _data.id || '';\n        this.parent_id = _data.parent_id || '';\n        this.name = _data.name || '';\n        this.display_name = _data.display_name || '';\n        this.map_id = _data.map_id || '';\n        this.capacity = _data.capacity || 0;\n        this.locations = _data.locations || [];\n        const parts = this.display_name.split(' ');\n        this.number =\n            (parts.length >= 2\n                ? parts[parts.length - 1]\n                : this.display_name[0]\n            )?.toUpperCase() || '';\n    }\n}\n","import { getItemWithKeys, HashMap } from '@placeos/common';\n\nexport interface OrganisationComplete extends Organisation {\n    settings?: HashMap;\n}\n\nexport class Organisation {\n    /** PlaceOS zone id of the building */\n    public readonly id: string;\n    /** Name of the building zone */\n    public readonly name: string;\n    /** Description for the Organisation */\n    public readonly description: string;\n    /** Tags for the Organisation */\n    public readonly tags: string[];\n    /** Count for the Organisation */\n    public readonly count: number;\n    /** Capacity for the Organisation */\n    public readonly capacity: number;\n    /** PlaceOS bindings for applications */\n    public readonly bindings: HashMap<string>;\n    /** Map of custom settings for the building */\n    private _settings: HashMap;\n\n    constructor(raw_data: Partial<OrganisationComplete> = {}) {\n        this.id = raw_data.id || '';\n        this.name = raw_data.name || '';\n        this.description = raw_data.description || '';\n        this.tags = raw_data.tags || [];\n        this.count = raw_data.count || 0;\n        this.capacity = raw_data.capacity || 0;\n        this.bindings = raw_data.bindings || {};\n        this._settings = raw_data.settings || {};\n    }\n\n    /**\n     * Get a custom organisation setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public setting(key: string): any {\n        const keys = key.split('.');\n        const value = getItemWithKeys(keys, this._settings);\n        return value;\n    }\n}\n","import { HashMap, Identity, RoomConfiguration } from '@placeos/common';\nimport { BookingRulesmap } from 'libs/events/src/lib/event.interfaces';\n\nimport { BuildingLevel } from './level.class';\n\nexport interface IBuildingRoleUser {\n    name: string;\n    email: string;\n    phone: string;\n}\n\nexport interface LockerMap {\n    [zone: string]: {\n        [area: string]: {\n            [type: string]: (string | boolean)[][];\n        };\n    };\n}\n\nexport interface ICoordinates {\n    longitude: number;\n    latitude: number;\n}\n\nexport interface LevelFeature {\n    id: string;\n    level_id: string;\n    name: string;\n}\n\nexport interface BookingRuleDetails {\n    /** List of booking rules details for the building */\n    readonly rules: readonly string[];\n    /** Custom booking rules for the map */\n    readonly map_rules?: readonly string[];\n    /** Contact email address for the building */\n    readonly contact?: string;\n    /** Information string to display before the rule listings */\n    readonly info?: string;\n}\n\nexport interface BuildingComplete extends Building {\n    settings: HashMap;\n    locker_structure: HashMap;\n    roles: HashMap;\n    zone: string;\n    location: string;\n    neighbourhoods: HashMap;\n}\n\nexport class Building {\n    /** PlaceOS zone id of the building */\n    public readonly id: string;\n    /** Name of the building zone */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Engine Zone ID for the building */\n    public readonly zone_id: string;\n    /** Organisation Code for the building */\n    public readonly code: string;\n    /** Geographical address of the building */\n    public readonly address: string;\n    /** IANA timezone string for building */\n    public readonly timezone: string;\n    /** ID of space that temporarily holds new meetings */\n    public readonly holding_bay: string;\n    /** ID of the space for assigning new visitor bookings to */\n    public readonly visitor_space: string;\n    /** Details about the booking rules for the building */\n    public readonly booking_details: BookingRuleDetails;\n    /** Details about the booking rules for the building */\n    public readonly booking_rules: BookingRulesmap;\n    /** Number of hour before a booking catering is restricted */\n    public readonly catering_restricted_from: number;\n    /** Currency code for the country assoicated with the building */\n    public readonly currency: string;\n    /** List of available extras for the building */\n    public readonly extras: readonly Identity[];\n    /** List of available extra equipment for loan at the building */\n    public readonly loan_items: readonly Identity[];\n    /** List of available levels for the building */\n    public readonly levels: readonly BuildingLevel[];\n    /** List of zones associated with the building */\n    public readonly zones: readonly string[];\n    /** Searchable map features */\n    public readonly searchables: readonly LevelFeature[];\n    /** List of available room configurations for the building */\n    public readonly room_configurations: readonly RoomConfiguration[];\n    /** Start and end hours catering can be delivered */\n    public readonly catering_hours: { start: number; end: number };\n    /** PlaceOS bindings for applications */\n    public readonly bindings: HashMap<string>;\n\n    public readonly orientations: HashMap<number>;\n    public readonly attributes: readonly Identity[];\n    /** Map of roles and list of the associated users */\n    private _roles: HashMap<IBuildingRoleUser[]>;\n    /** Map of the locker ID arrays */\n    private _lockers: LockerMap;\n    /** Map of important system ids for the building */\n    private _systems: HashMap<string>;\n    /** Map of important phone numbers for the building */\n    private _phone_numbers: HashMap<string>;\n    /** Globe coordiates for the build */\n    private _location: ICoordinates;\n\n    constructor(raw_data: Partial<BuildingComplete> = {}) {\n        this.id = raw_data.id || '';\n        this.name = raw_data.name || '';\n        const settings = raw_data.settings || {};\n        this.display_name = raw_data.display_name;\n        const disc_info = settings.discovery_info || settings;\n        this.zone_id = raw_data.zone_id || raw_data.zone;\n        this.extras = (raw_data.extras || disc_info.extras || []).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.loan_items = (\n            raw_data.loan_items ||\n            disc_info.loan_items ||\n            []\n        ).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.levels = (raw_data.levels || disc_info.levels || []).map(\n            (i) => new BuildingLevel({ ...i, building_id: this.id })\n        );\n        this._roles = raw_data.roles || disc_info.roles || {};\n        this._lockers =\n            raw_data.lockers ||\n            raw_data.locker_structure ||\n            disc_info.locker_structure ||\n            {};\n        this._systems = raw_data.systems || disc_info.systems || {};\n        this._phone_numbers =\n            raw_data.phone_numbers || disc_info.phone_numbers || {};\n        this._location = raw_data.location ||\n            disc_info.location || { longitude: null, latitude: null };\n        this.room_configurations =\n            raw_data.room_configurations || disc_info.room_configurations || [];\n        this.attributes = raw_data.attributes || disc_info.attributes || [];\n        const searchables = [];\n        if (raw_data.neighbourhoods) {\n            for (const lvl in raw_data.neighbourhoods) {\n                if (lvl in raw_data.neighbourhoods) {\n                    const lvl_features = raw_data.neighbourhoods[lvl] || {};\n                    for (const feature in lvl_features) {\n                        if (feature in lvl_features) {\n                            searchables.push({\n                                id: lvl_features[feature],\n                                name: feature,\n                                level_id: lvl,\n                            });\n                        }\n                    }\n                }\n            }\n        }\n        this.bindings = raw_data.bindings || {};\n        this.searchables = searchables;\n        this.timezone =\n            raw_data.timezone || disc_info.timezone || settings.timezone || '';\n        this.catering_hours = raw_data.catering_hours ||\n            disc_info.catering_hours ||\n            settings.catering_hours || { start: 7, end: 20 };\n        this.visitor_space =\n            raw_data.visitor_space ||\n            disc_info.visitor_space ||\n            settings.visitor_space ||\n            '';\n        this.holding_bay =\n            raw_data.holding_bay ||\n            disc_info.holding_bay ||\n            settings.holding_bay ||\n            '';\n        this.code = raw_data.code || disc_info.code || settings.code || '';\n        this.address =\n            raw_data.address || disc_info.address || settings.address || '';\n        this.orientations =\n            raw_data.orientations ||\n            disc_info.orientations ||\n            settings.orientations ||\n            {};\n        this.booking_details =\n            raw_data.booking_details ||\n            disc_info.booking_details ||\n            settings.booking_details ||\n            null;\n        this.booking_rules =\n            raw_data.booking_rules ||\n            disc_info.booking_rules ||\n            settings.booking_rules ||\n            {};\n        this.catering_restricted_from =\n            raw_data.catering_restricted_from ||\n            disc_info.catering_restricted_from ||\n            settings.catering_restricted_from ||\n            -1440;\n        this.currency =\n            raw_data.currency ||\n            disc_info.currency ||\n            settings.currency ||\n            'USD';\n    }\n\n    /**\n     * Get list of users with the associated role\n     * @param name Role to find users for\n     */\n    public role(name: string): IBuildingRoleUser[] {\n        return [...(this._roles[name] || [])];\n    }\n    /**\n     * Get list of the names of available user role lists\n     */\n    public get role_names(): string[] {\n        return Object.keys(this._roles).filter((i) => i in this._roles);\n    }\n    /** Map of the locker ID arrays */\n    public get lockers(): LockerMap {\n        return { ...(this._lockers || {}) };\n    }\n    /** Map of important system ids for the building */\n    public get systems(): HashMap<string> {\n        return { ...(this._systems || {}) };\n    }\n    /** Map of important phone numbers for the building */\n    public get phone_numbers(): HashMap<string> {\n        return { ...(this._phone_numbers || {}) };\n    }\n\n    /**\n     * Get search map feature for the given level ID\n     * @param level_id ID of level to grab features for\n     */\n    public featuresForLevel(level_id: string): LevelFeature[] {\n        return (this.searchables || []).filter((i) => i.level_id === level_id);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport {\n    HashMap,\n    notifyError,\n    RoomConfiguration,\n    SettingsService\n} from '@placeos/common';\nimport {\n    authority,\n    isMock,\n    onlineState,\n    queryZones,\n    showMetadata\n} from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { first, map } from 'rxjs/operators';\nimport { Building } from './building.class';\nimport { BuildingLevel } from './level.class';\nimport { Organisation } from './organisation.class';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class OrganisationService {\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    private readonly _buildings = new BehaviorSubject<Building[]>([]);\n    private readonly _active_building = new BehaviorSubject<Building>(null);\n    private readonly _levels = new BehaviorSubject<BuildingLevel[]>([]);\n\n    /** Observable for the list of buildings */\n    public readonly building_list = this._buildings.asObservable();\n    /** Observable for the list of levels */\n    public readonly level_list = this._levels.asObservable();\n    /** Observable for the currently active building */\n    public readonly active_building = this._active_building.asObservable();\n    /** Observable for the levels associated with the currently active building */\n    public readonly active_levels = combineLatest([\n        this._levels,\n        this._active_building,\n    ]).pipe(map(([_, bld]) => (bld ? this.levelsForBuilding(bld) : [])));\n    /** Organisation data for the application */\n    private _organisation: Organisation;\n    /** Mapping of organisation settings overrides */\n    private _settings: HashMap = {};\n    /** Mapping of buildings to settings overrides */\n    private _building_settings: HashMap<HashMap> = {};\n\n    /** Mapping of organisation settings overrides */\n    public get settings(): HashMap {\n        return this._settings;\n    }\n\n    /** Mapping of builgins to settings overrides */\n    public get building_settings(): HashMap<HashMap> {\n        return this._building_settings;\n    }\n\n    /** Mapping building settings overrides */\n    public buildingSettings(bld_id: string = ''): HashMap {\n        if (!bld_id && this.building) {\n            bld_id = this.building.id;\n        }\n        return this._building_settings\n            ? this._building_settings[bld_id] || {}\n            : {};\n    }\n\n    /** Organisation data for the application */\n    public get organisation(): Organisation {\n        return this._organisation;\n    }\n\n    /** List of available buildings */\n    public get buildings(): Building[] {\n        return this._buildings.getValue();\n    }\n\n    /** Currently active building */\n    public get building(): Building {\n        return this._active_building.getValue();\n    }\n    public set building(bld: Building) {\n        this._active_building.next(bld);\n        this._service.overrides = [\n            this._settings.details,\n            this.buildingSettings(bld.id).details,\n        ];\n    }\n\n    /** Get building by id */\n    public find(id: string) {\n        return this.buildings.find((i) => i.id === id);\n    }\n\n    /** List of available levels */\n    public get levels(): BuildingLevel[] {\n        return this._levels.getValue();\n    }\n\n    constructor(private _service: SettingsService, private _router: Router) {\n        onlineState()\n            .pipe(first((_) => _))\n            .subscribe(() => setTimeout(() => this.init(), 1000));\n        this.active_building.subscribe((bld) => {\n            if (bld) {\n                this._service.overrides = [\n                    this._settings,\n                    this.buildingSettings(bld.id),\n                ];\n            }\n        });\n    }\n\n    /**\n     * Get level with a matching ID\n     * @param id_list List of IDs to find a match\n     */\n    public levelWithID(id_list: string[]): BuildingLevel {\n        return this.levels.find((lvl) => id_list?.includes(lvl.id));\n    }\n\n    /**\n     * Get list of levels for the given building\n     * @param bld Building to list levels for\n     */\n    public levelsForBuilding(bld: Building): BuildingLevel[] {\n        return this.levels.filter((lvl) => lvl.parent_id === bld.id);\n    }\n\n    private async init(tries: number = 0) {\n        this._initialised.next(false);\n        await this.load().catch((err) => {\n            notifyError('Error loading organisation data. Retrying...');\n            setTimeout(() => this.init(tries), Math.min(10_000, 300 * ++tries));\n            throw err;\n        });\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.orgs = this;\n        }\n    }\n\n    /**\n     * Initialise service data\n     */\n    private async load(): Promise<void> {\n        await this.loadOrganisation();\n        await this.loadBuildings();\n        await this.loadLevels();\n        await this.loadSettings();\n    }\n\n    /**\n     * Load organisation data for application\n     */\n    public async loadOrganisation(): Promise<void> {\n        const org_list = await queryZones({ tags: 'org' })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (org_list.length) {\n            const auth = authority();\n            const org =\n                org_list.find(\n                    (list) => isMock() || list.id === auth?.config?.org_zone\n                ) || org_list[0];\n            const bindings: HashMap = (\n                await showMetadata(org.id, { name: 'bindings' }).toPromise()\n            )?.details;\n            this._organisation = new Organisation({ ...org, bindings });\n        } else {\n            this._router.navigate(['/misconfigured']);\n        }\n    }\n\n    /**\n     * Load buildings data for the organisation\n     */\n    public async loadBuildings(): Promise<void> {\n        const building_list = await queryZones({\n            tags: 'building',\n            limit: 500,\n        } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (!building_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const buildings = [];\n        for (const bld of building_list) {\n            const bindings: HashMap = (\n                await showMetadata(bld.id, { name: 'bindings' }).toPromise()\n            )?.details;\n            buildings.push(new Building({ ...bld, bindings }));\n        }\n        this._buildings.next(buildings);\n        const id = localStorage.getItem(`PLACEOS.building`);\n        if (id && this.buildings.find((bld) => bld.id === id)) {\n            this._active_building.next(\n                this.buildings.find((bld) => bld.id === id)\n            );\n        }\n        if (!this.building?.id && buildings?.length > 0) {\n            this.building = buildings[0];\n        }\n    }\n\n    /**\n     * Load levels data for the buildings\n     */\n    public async loadLevels(): Promise<void> {\n        const level_list = await queryZones({\n            tags: 'level',\n            limit: 2500,\n        } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (!level_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const levels = level_list.map((lvl) => new BuildingLevel(lvl));\n        levels.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\n        this._levels.next(levels);\n    }\n\n    public get available_room_configs(): RoomConfiguration[] {\n        return this.buildings\n            .map((m) => [...m.room_configurations])\n            .reduce((prev, curr) => prev.concat(curr), [])\n            .sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    public async loadSettings() {\n        if (!this._organisation) return;\n        const app_name = `${(\n            this._service.get('app.name') || 'workplace'\n        ).toLowerCase()}_app`;\n        this._settings = await showMetadata(this._organisation.id, {\n            name: app_name,\n        }).toPromise();\n        const buildings = this.buildings;\n        for (const bld of buildings) {\n            this._building_settings[bld.id] = await showMetadata(bld.id, {\n                name: app_name,\n            }).toPromise();\n        }\n        this._service.overrides = [\n            this._settings.details,\n            this.buildingSettings(this.building.id).details,\n        ];\n    }\n\n    /** Save building selection */\n    public saveBuilding(id: string) {\n        localStorage.setItem(`PLACEOS.building`, id);\n    }\n}\n","import { PlaceZone } from '@placeos/ts-client';\n\nexport class Desk {\n    /** ID of the desk also map_id */\n    public readonly id: string;\n    /** ID of the desk on the associated map */\n    public readonly map_id: string;\n    /** Name of the desk */\n    public readonly name: string;\n    /** Whether desk is available / bookable */\n    public readonly bookable: boolean;\n    /** Zone/Level of the desk */\n    public readonly zone: PlaceZone;\n    /** Group/Department allocated to the desk */\n    public readonly groups: string[];\n\n    constructor(data: Partial<Desk> = {}) {\n        this.id = data.id || '';\n        this.map_id = data.map_id || data.id || '';\n        this.name = data.name || '';\n        this.bookable = data.bookable ?? false;\n        this.zone = data.zone || new PlaceZone();\n        this.groups = data.groups || [];\n    }\n\n    public format() {\n        const { id, name, bookable, groups } = this;\n        return {\n            id,\n            name,\n            bookable,\n            groups,\n        };\n    }\n\n    public readonly toJSON = () => this.format();\n}\n","import { Component, Inject, Output, EventEmitter } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { addMinutes, getUnixTime } from 'date-fns';\n\nimport {\n    BaseClass,\n    currentUser,\n    DialogEvent,\n    HashMap,\n    Identity,\n    SettingsService,\n} from '@placeos/common';\nimport { Building, OrganisationService } from '@placeos/organisation';\n\nimport { filterSpacesFromRules } from 'libs/events/src/lib/helpers';\nimport { querySpaceFreeBusy } from 'libs/calendar/src/lib/calendar.fn';\nimport { Space } from './space.class';\n\nexport interface SpaceSelectModalData {\n    /** List of currently selected spaces */\n    readonly spaces: Space[];\n    /** Selected date to check space availability */\n    readonly date: number;\n    /** Duration of the availability that is desired */\n    readonly duration: number;\n    all_day?: boolean;\n    visitor_type?: string;\n}\n\n@Component({\n    selector: 'a-space-select-modal',\n    template: `\n        <header>\n            <app-icon class=\"text-3xl\">place</app-icon>\n            <div class=\"text-xl font-semibold flex-1\">\n                Select space{{ multiple ? 's' : '' }}\n            </div>\n            <button mat-icon-button mat-dialog-close>\n                <app-icon class=\"text-3xl\">close</app-icon>\n            </button>\n        </header>\n        <main>\n            <mat-form-field\n                appearance=\"outline\"\n                *ngIf=\"buildings && buildings.length > 1\"\n            >\n                <mat-select\n                    name=\"booking-type\"\n                    [ngModel]=\"building.getValue()\"\n                    (ngModelChange)=\"building.next($event)\"\n                    placeholder=\"Select building\"\n                >\n                    <mat-option *ngFor=\"let bld of buildings\" [value]=\"bld\">\n                        {{ bld.display_name || bld.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <mat-form-field\n                appearance=\"outline\"\n                *ngIf=\"space_types && space_types.length > 1\"\n            >\n                <mat-select\n                    name=\"booking-type\"\n                    [(ngModel)]=\"type\"\n                    placeholder=\"Any space type\"\n                >\n                    <mat-option\n                        *ngFor=\"let type of space_types\"\n                        [value]=\"type.id\"\n                    >\n                        {{ type.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <div class=\"body\" style=\"width: 32rem\">\n                <ng-container *ngIf=\"!loading; else load_state\">\n                    <ng-container\n                        *ngIf=\"\n                            (filtered_spaces | async)?.length;\n                            else empty_state\n                        \"\n                    >\n                        <ng-container\n                            *ngFor=\"let space of filtered_spaces | async\"\n                        >\n                            <a-space-select-item\n                                *ngIf=\"!space_map[space.id]\"\n                                [space]=\"space\"\n                                [multiple]=\"multiple\"\n                                type=\"available\"\n                                (click)=\"spaceSelected(space)\"\n                            ></a-space-select-item>\n                        </ng-container>\n                    </ng-container>\n                </ng-container>\n                <div\n                    class=\"space-list\"\n                    *ngIf=\"multiple\"\n                    [class.show]=\"show_selected\"\n                >\n                    <ng-container\n                        *ngIf=\"spaces && spaces.length; else empty_state\"\n                    >\n                        <a-space-select-item\n                            *ngFor=\"let space of spaces\"\n                            [space]=\"space\"\n                            [multiple]=\"multiple\"\n                            type=\"selected\"\n                        ></a-space-select-item>\n                    </ng-container>\n                </div>\n            </div>\n            <footer *ngIf=\"multiple\">\n                <button mat-button (click)=\"save()\">\n                    Save selected spaces({{ spaces.length || '0' }})\n                </button>\n            </footer>\n            <ng-template #empty_state>\n                <div empty class=\"p-16 flex flex-col items-center space-y-2\">\n                    <app-icon class=\"text-3xl\">close</app-icon>\n                    <p>No spaces</p>\n                </div>\n            </ng-template>\n            <ng-template #load_state>\n                <div load class=\"p-16 flex flex-col items-center space-y-2\">\n                    <mat-spinner diameter=\"48\"></mat-spinner>\n                    <p>Finding available spaces...</p>\n                </div>\n            </ng-template>\n        </main>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.5em;\n                width: 100%;\n                padding: 0 0.25em;\n            }\n\n            .body {\n                min-width: 20rem;\n                max-width: calc(100vw - 2rem);\n            }\n        `,\n    ],\n})\nexport class SpaceSelectModalComponent extends BaseClass {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** List of selected spaces */\n    public spaces: Space[] = [...(this._data.spaces || [])];\n    /** Building to filter available spaces */\n    public building = new BehaviorSubject<Building>(null);\n    /** Whether to show selected spaces */\n    public show_selected: boolean;\n    /** List of available space types */\n    public space_types: Identity[] = [];\n    /** ID of the space type to filter available spaces on */\n    public type: string;\n    /** Whether the available spaces are being loaded */\n    public loading: boolean;\n\n    public readonly available_spaces = combineLatest([this.building]).pipe(\n        switchMap(([bld]) => {\n            this.loading = true;\n            return querySpaceFreeBusy({\n                zone_ids: bld?.id,\n                period_start: getUnixTime(this._data.date),\n                period_end: getUnixTime(\n                    addMinutes(this._data.date, this._data.duration)\n                ),\n            });\n        }),\n        shareReplay(1)\n    );\n\n    public readonly filtered_spaces = this.available_spaces.pipe(\n        map((list) =>\n            filterSpacesFromRules(\n                list,\n                { ...this._data, host: currentUser() } as any,\n                this._org.building.booking_rules\n            )\n        ),\n        tap(() => (this.loading = false))\n    );\n\n    public get buildings(): Building[] {\n        return this._org.buildings;\n    }\n\n    /** Whether multiple spaces can be selected */\n    public get multiple(): boolean {\n        return !!this._settings.get('app.booking.multiple_spaces');\n    }\n\n    /** Mapping of spaces to whether they are selected */\n    public get space_map(): HashMap<boolean> {\n        const spaces = {};\n        this.spaces.forEach((space) => (spaces[space.id] = true));\n        return spaces;\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        @Inject(MAT_DIALOG_DATA) private _data: SpaceSelectModalData\n    ) {\n        super();\n        this.building.next(this._org.building || this.buildings[0]);\n        this.subscription(\n            'spaces',\n            this.filtered_spaces.subscribe((_) => _)\n        );\n    }\n\n    public spaceSelected(space: Space) {\n        if (this.multiple) {\n            if (!this.space_map[space.id]) {\n                this.spaces.push(space);\n            }\n        } else {\n            this.spaces = [space];\n            this.save();\n        }\n    }\n\n    public save() {\n        this.event.emit({ reason: 'done', metadata: this.spaces });\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ComponentsModule } from '@placeos/components';\n\nimport { SpaceSelectItemComponent } from './space-select-item.component';\nimport { SpaceSelectModalComponent } from './space-select-modal.component';\n\nconst COMPONENTS: Type<any>[] = [\n    SpaceSelectModalComponent,\n    SpaceSelectItemComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [CommonModule, MatDialogModule, ComponentsModule],\n    providers: [],\n    exports: [...COMPONENTS],\n})\nexport class SharedSpacesModule {}\n","import { HashMap, predictableRandomInt } from '@placeos/common';\nimport { USER_DOMAIN } from '../../../users/src/lib/user.utilities';\n\nlet SPACE_COUNT: number = 0;\n/* istanbul ignore next */\nexport function generateMockSpace(overrides: HashMap = {}): HashMap {\n    const id = `space-${SPACE_COUNT++}`;\n    const name = `Test Space ${SPACE_COUNT}`;\n    const linked = predictableRandomInt(99999) % 2 === 0 && SPACE_COUNT > 1;\n    const space = {\n        id,\n        name,\n        long_name: `${name} with an long name`,\n        map_id: `${SPACE_COUNT}`,\n        capacity: predictableRandomInt(21, 1) * 2,\n        email: `${name.toLowerCase().split(' ').join('.')}@${USER_DOMAIN}`,\n        type: '',\n        searchable: predictableRandomInt(99999) % 2 === 0,\n        controlable: predictableRandomInt(99999) % 2 === 0,\n        bookable: predictableRandomInt(99999) % 2 === 0,\n        cost_hour: predictableRandomInt(300) * 100,\n        setup: predictableRandomInt(6) * 5,\n        breakdown: predictableRandomInt(6) * 5,\n        zones: ['zone_lvl-0'],\n        support_url: `/control/#/panel/${id}`,\n        bookings: [], //Array(10).fill(0).map(i => generateMockBooking()),\n        linked_rooms: linked\n            ? [`space-${predictableRandomInt(SPACE_COUNT - 1)}`]\n            : [],\n        image: '',\n        ...overrides,\n    };\n    if (space['configurations'] && space['configurations'].length > 0) {\n        space['configurations'].forEach(\n            (config) =>\n                (config.capacity = predictableRandomInt(space.capacity) + 1)\n        );\n        space['configurations'][0].capacity = space.capacity;\n    }\n    return space;\n}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Space } from './space.class';\n\n@Component({\n    selector: 'a-space-select-item',\n    template: `\n        <div space class=\"w-full flex items-center p-2 space-x-2\" *ngIf=\"space\">\n            <div class=\"flex-1 w-1/2\">\n                <div class=\"text-base truncate\">{{ space.name }}</div>\n                <div class=\"text-xs\">\n                    {{ space.level?.display_name || space.level?.name }}\n                </div>\n            </div>\n            <div class=\"flex items-center\" *ngIf=\"space.capacity !== -1\">\n                <app-icon>account_circle</app-icon>\n                <div>{{ space.capacity }}</div>\n            </div>\n            <button\n                mat-icon-button\n                *ngIf=\"multiple; else single_button\"\n                (click)=\"action.emit()\"\n            >\n                <app-icon>{{\n                    type === 'available' ? 'add' : 'close'\n                }}</app-icon>\n            </button>\n        </div>\n        <ng-template #single_button>\n            <button mat-button [class.request]=\"space.by_request\">\n                {{ space.by_request ? 'Request' : 'Book' }}\n            </button>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SpaceSelectItemComponent {\n    /** Space to display the details */\n    @Input() public space: Space;\n    /** Selected state for the space */\n    @Input() public type: 'available' | 'selected';\n    /** Whether user is allowed to select multiple spaces */\n    @Input() public multiple: boolean;\n    /** Emitter for selection actions */\n    @Output() public action = new EventEmitter();\n}\n","import { RoomConfiguration } from '@placeos/common';\nimport { BuildingLevel } from '@placeos/organisation';\n\nimport { CalendarAvailability } from 'libs/calendar/src/lib/calendar.interfaces';\n\nexport type ResourceResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted';\n\nexport class Space {\n    /** ID of the space resource */\n    public readonly id: string;\n    /** Display name of the space resource */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Email address of the resource associated with space */\n    public readonly email: string;\n    /** Capacity of the space resource */\n    public readonly capacity: number;\n    /** List of features available at the space resource  */\n    public readonly feature_list: string[];\n    /** URL to a supporting site for space */\n    public readonly support_url: string;\n    /** ID of the space on the associated map */\n    public readonly map_id: string;\n    /** Whether resource is bookable */\n    public readonly bookable: boolean;\n    /** List of zones the spaces is associated with */\n    public readonly zones: string[];\n    /** List of available room configurations for this room */\n    public readonly configurations: readonly RoomConfiguration[];\n    /** Image url */\n    public readonly image: string;\n    /** Status of the resource */\n    public readonly response_status: ResourceResponseStatus;\n    /** Level Assoicated with the space */\n    public readonly level: BuildingLevel;\n    /** List of features associated with the space */\n    public readonly features: string[];\n\n    public readonly availability: CalendarAvailability[];\n\n    constructor(data: Partial<Space> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.display_name = data.display_name || '';\n        this.email = (data.email || '').toLowerCase();\n        this.capacity = data.capacity || -1;\n        this.feature_list = data.feature_list || (data.features as any) || [];\n        this.bookable = !!data.bookable;\n        this.zones = data.zones || [];\n        this.support_url = data.support_url || '';\n        this.map_id = data.map_id || '';\n        this.image = data.image || '';\n        this.configurations = data.configurations || [];\n        this.features = data.features || [];\n        this.response_status = data.response_status;\n        this.level = data.level || new BuildingLevel();\n        this.availability = data.availability || [];\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { querySystems } from '@placeos/ts-client';\nimport { first, map } from 'rxjs/operators';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { Space } from './space.class';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SpacesService {\n    /** Subject to store list of spaces */\n    private _list = new BehaviorSubject<Space[]>([]);\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    /** Observable for list of spaces */\n    public readonly list = this._list.asObservable();\n    /** Default predicate for filter method */\n    protected _compare = (space: Space) =>\n        space.zones.includes(this._org.building.id);\n\n    /** List of available spaces */\n    public get space_list(): Space[] {\n        return this._list.getValue();\n    }\n\n    constructor(private _org: OrganisationService) {\n        this._org.initialised\n            .pipe(first((_) => _))\n            .subscribe(() => this.loadSpaces());\n    }\n\n    /**\n     * Get a filtered list of the available spaces\n     * @param predicate Predicate for filtering spaces\n     */\n    public filter(predicate: (_: Space) => boolean = this._compare) {\n        return this._list.getValue().filter((_) => predicate(_));\n    }\n\n    /**\n     * Find space with given id/email\n     * @param id ID/Email address associated with the space\n     */\n    public find(id: string) {\n        return this._list\n            .getValue()\n            .find((space) => space.id === id || space.email === id);\n    }\n\n    private async loadSpaces(): Promise<void> {\n        const systems = await querySystems({\n            zone_id: this._org.organisation.id,\n            limit: 5000,\n        })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        const space_list = systems.map(\n            (sys) =>\n                new Space({\n                    ...(sys as any),\n                    level: this._org.levelWithID([...sys.zones]),\n                })\n        );\n        // Remove spaces without a map ID\n        const valid_spaces = space_list.filter((space) => space.map_id);\n        this._list.next(valid_spaces);\n        this._initialised.next(true);\n    }\n}\n","import { Component, OnInit, Output, EventEmitter, Inject } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BaseClass, DialogEvent } from '@placeos/common';\n\nimport { User } from './user.class';\nimport { generateUserForm } from './user.utilities';\n\n@Component({\n    selector: 'new-user-modal',\n    template: `\n        <header>\n            <div class=\"heading\" mat-dialog-title>\n                {{ user?.id ? 'Edit' : 'Add' }} External Attendee\n            </div>\n            <div class=\"flex-1\"></div>\n            <button mat-icon-button mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"flex flex-col items-center w-full p-2\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <user-form [form]=\"form\"></user-form>\n        </main>\n        <footer\n            class=\"flex items-center justify-center w-full p-2 border-t border-gray-300 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button mat-button class=\"inverse\" mat-dialog-close>Cancel</button>\n            <button mat-button (click)=\"saveChanges()\">Save</button>\n        </footer>\n        <ng-template #load_state>\n            <main class=\"flex flex-col items-center w-full p-2 space-y-2\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving attendee...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                min-height: 20em !important;\n                width: 100%;\n            }\n\n            footer button {\n                min-width: 8em;\n            }\n        `,\n    ],\n})\nexport class NewUserModalComponent extends BaseClass implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Form fields for the new user */\n    public form: FormGroup;\n    /** New user data store */\n    public user: User;\n    /** Whether user details are being saved */\n    public loading: boolean;\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: any) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.user = this._data.user || {};\n        this.form = generateUserForm(this.user);\n    }\n\n    public saveChanges() {\n        this.form.markAllAsTouched();\n        if (this.form.valid) {\n            const new_user = new User({\n                ...this.form.value,\n                type: 'external',\n            });\n            this.event.emit({ reason: 'done', metadata: new_user });\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\n\n@Component({\n    selector: 'user-form',\n    template: `\n        <form user-form *ngIf=\"form\" [formGroup]=\"form\">\n            <div class=\"field\" *ngIf=\"form.controls.name\">\n                <label for=\"name\" [class.error]=\"hasError('name')\">\n                    Name<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        placeholder=\"Name\"\n                        formControlName=\"name\"\n                    />\n                    <mat-error>Name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.email\">\n                <label for=\"email\" [class.error]=\"hasError('email')\">\n                    Email<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"email\"\n                        placeholder=\"Email Address\"\n                        formControlName=\"email\"\n                    />\n                    <mat-error>A valid email is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.organisation\">\n                <label for=\"org\" [class.error]=\"hasError('organisation')\">\n                    Organisation<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"org\"\n                        placeholder=\"Organisation\"\n                        formControlName=\"organisation\"\n                    />\n                    <mat-error>Organisation is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.phone\">\n                <label for=\"phone\" [class.error]=\"hasError('phone')\">\n                    Phone:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"phone\"\n                        placeholder=\"Phone\"\n                        formControlName=\"phone\"\n                    />\n                    <mat-error>Phone format is invalid</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.assistance_required\">\n                <mat-checkbox\n                    name=\"assistance-required\"\n                    color=\"primary\"\n                    formControlName=\"assistance_required\"\n                >\n                    Assistance required\n                </mat-checkbox>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.visit_expected\">\n                <mat-checkbox\n                    name=\"visit-expected\"\n                    color=\"primary\"\n                    formControlName=\"visit_expected\"\n                >\n                    Visit expected\n                </mat-checkbox>\n            </div>\n        </form>\n    `,\n    styles: [\n        `\n            .field {\n                display: flex;\n                flex-wrap: wrap;\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class UserFormComponent {\n    /** Group of form fields used for creating the system */\n    @Input() public form: FormGroup;\n\n    public hasError(name: string) {\n        return (\n            this.form.controls[name].invalid && this.form.controls[name].touched\n        );\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { ComponentsModule } from '@placeos/components';\n\nimport { NewUserModalComponent } from './new-user-modal.component';\nimport { UserFormComponent } from './user-form.component';\n\n@NgModule({\n    declarations: [NewUserModalComponent, UserFormComponent],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatDialogModule,\n        ComponentsModule,\n        MatCheckboxModule,\n    ],\n    exports: [NewUserModalComponent],\n})\nexport class SharedUsersModule {}\n","import { Point } from '@placeos/svg-viewer';\nimport { HashMap } from '@placeos/common';\nimport { getUnixTime } from 'date-fns';\nexport class MapLocation {\n    /** Source that the location was generated */\n    public type: 'desk' | 'wireless' | 'meeting' | 'other';\n    /** Details of the location */\n    public position: string | Point;\n    /** Accuracy of the location data */\n    public variance: number;\n    /** Unix epoch in seconds that the data was last updated */\n    public last_seen: number;\n    /** ID of the level associated with the location */\n    public level: string;\n    /** ID of the building associated with the location */\n    public building: string;\n    /** Whether user is currently at the location if fixed */\n    public at_location: boolean;\n    /**  */\n    public coordinates_from:\n        | 'top-left'\n        | 'top-right'\n        | 'bottom-left'\n        | 'bottom-right';\n\n    constructor(_data: HashMap = {}) {\n        this.type = _data.type || _data.location || 'other';\n        this.position = _data.position ||\n            _data.map_id || {\n                x: _data.x / _data.map_width || 0,\n                y: _data.y / _data.map_height || 0,\n            };\n        this.variance = _data.variance || 0;\n        this.last_seen = _data.last_seen || getUnixTime(new Date());\n        this.level = _data.level;\n        this.building = _data.building;\n        this.at_location = !!_data.at_location;\n        this.coordinates_from = _data.coordinates_from || 'top-left';\n    }\n}\n","import { del, get, patch } from '@placeos/ts-client';\nimport { map } from 'rxjs/operators';\n\nimport { CalendarEvent } from '../../../events/src/lib/event.class';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { GuestUser } from './user.class';\nimport { Observable } from 'rxjs';\n\nconst GUEST_ENDPOINT = '/api/staff/v1/guests';\n\nexport interface GuestsQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zone_ids?: string;\n    /** Comma seperated list of system(space) ids to check availability */\n    system_ids?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n}\n\n/**\n * Search guests\n * @param q Search string for filtering guests\n */\nexport function searchGuests(q: string): Observable<GuestUser[]> {\n    const query = toQueryString({ q });\n    return get(`${GUEST_ENDPOINT}${q ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new GuestUser(item)))\n    );\n}\n\n/**\n * List guests\n * @param q Parameters to pass to the API request\n */\nexport function queryGuests(q: GuestsQueryParams): Observable<GuestUser[]> {\n    const query = toQueryString({ ...q });\n    return get(`${GUEST_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new GuestUser(item)))\n    );\n}\n\n/**\n * Get guest details\n * @param id ID of the guest\n */\nexport function showGuest(id: string) {\n    return get(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new GuestUser(item))\n    );\n}\n\n/**\n * Update guest metadata\n * @param id ID of the guest\n * @param data New metadata state\n */\nexport function updateGuest(id: string, data: Partial<GuestUser>) {\n    return patch(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`, data).pipe(\n        map((item) => new GuestUser(item))\n    );\n}\n\n/**\n * Remove a guest\n * @param id ID of the guest to remove\n */\nexport function removeGuest(id: string) {\n    return del(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}`, {\n        response_type: 'void',\n    });\n}\n\n/**\n * List upcoming meetings for a guest\n * @param id ID of the guest\n */\nexport function listGuestMeetings(id: string) {\n    return get(`${GUEST_ENDPOINT}/${encodeURIComponent(id)}/meetings`).pipe(\n        map((list) => list.map((item) => new CalendarEvent(item)))\n    );\n}\n","import { get } from '@placeos/ts-client';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { StaffUser } from './user.class';\n\nconst STAFF_ENDPOINT = '/api/staff/v1/people';\n\n/**\n * Search staff members\n * @param q Search string for filtering staff\n */\nexport function searchStaff(q: string): Observable<StaffUser[]> {\n    const query = toQueryString({ q });\n    return get(`${STAFF_ENDPOINT}${q ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new StaffUser(item)))\n    );\n}\n\n/**\n * Get user details\n * @param id User ID or email\n */\nexport function showStaff(id: string) {\n    return get(`${STAFF_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n\n/**\n * Get user with their location details\n * @param email User email\n */\nexport function locateStaff(email: string) {\n    return get(`${STAFF_ENDPOINT}/${email}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n","import { MapLocation } from './location.class';\nimport { USER_DOMAIN } from './user.utilities';\n\nexport interface UserComplete extends User {\n    sys_admin?: boolean;\n    support?: boolean;\n}\n\nexport type EventResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted'\n    | '';\n\nexport class User {\n    /** ID of the user */\n    public readonly id: string;\n    /** Display name of the user */\n    public readonly name: string;\n    /** Email address of the user */\n    public readonly email: string;\n    /** First name of the user */\n    public readonly first_name: string;\n    /** Last name of the user */\n    public readonly last_name: string;\n    /** Username of the user */\n    public readonly username: string;\n    /** Phone number of the user */\n    public readonly phone: string;\n    /** Organisation associated with the user */\n    public readonly organisation: string;\n    /** Details about the user */\n    public readonly notes: string;\n    /** URL to the user's photo */\n    public readonly photo: string;\n    /** Whether user attendance is required */\n    public readonly required: boolean;\n    /** Whether user is the event organiser */\n    public readonly organizer: boolean;\n    /** Whether the users is expected for an event */\n    public readonly response_status: EventResponseStatus;\n    /** Whether the users is expected for an event */\n    public visit_expected: boolean;\n    /** Whether user has been checked in */\n    public readonly checked_in: boolean;\n    /** Department that the user belongs to in the organisation */\n    public readonly groups: string[];\n    /** Extra metadata associated with the user */\n    public readonly extension_data: Record<string, any>;\n    /** Whether user is external from the organisation */\n    public readonly is_external: boolean;\n    /** Whether user needs assistance when attending an event */\n    public readonly assistance_required: boolean;\n\n    constructor(data: Partial<UserComplete> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.email = data.email || '';\n        this.first_name = data.first_name || data.name || '';\n        this.last_name = data.last_name || '';\n        this.phone = data.phone || '';\n        this.organisation = data.organisation || '';\n        this.notes = data.notes || '';\n        this.photo = data.photo || '';\n        this.username = data.username || '';\n        this.organizer = !!data.organizer;\n        this.groups = data.groups || [];\n        this.checked_in = !!data.checked_in;\n        this.required = data.required ?? true;\n        this.response_status = data.response_status || '';\n        const groups = data.groups || [];\n        if (data.sys_admin) groups.push('placeos_admin');\n        if (data.support) groups.push('placeos_support');\n        this.groups = groups;\n        this.extension_data = data.extension_data || {};\n        this.extension_data.assistance_required =\n            data.assistance_required || this.extension_data.assistance_required;\n        this.is_external = !this.email?.endsWith(`${USER_DOMAIN}`);\n        this.visit_expected = data.visit_expected ?? true;\n        this.assistance_required = !!this.extension_data?.assistance_required;\n    }\n}\n\nexport class GuestUser extends User {\n    /** Preferred beverage of the guest */\n    public readonly preferred_beverage: string;\n    /** Whether guest has accepted the terms and conditions */\n    public readonly accepted_terms_conditions: boolean;\n\n    constructor(data: Partial<GuestUser> = {}) {\n        super(data);\n        this.preferred_beverage = data.preferred_beverage || '';\n        this.accepted_terms_conditions =\n            data.accepted_terms_conditions || false;\n    }\n}\n\nexport class StaffUser extends User {\n    /** Number associated with the user's access card */\n    public readonly card_number: string;\n    /** ID of the user */\n    public readonly staff_id: string;\n    /** Whether user is logged in */\n    public readonly is_logged_in: boolean;\n    /** Location of the user */\n    public readonly location: Record<string, MapLocation>;\n\n    constructor(data: Partial<StaffUser> = {}) {\n        super(data);\n        this.card_number = data.card_number || '';\n        this.staff_id = data.staff_id || '';\n        this.location = data.location || {};\n        this.is_logged_in = !!data.is_logged_in;\n    }\n}\n","import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { predictableRandomInt, unique } from '../../../common/src/lib/general';\n\nimport { GuestUser, User } from './user.class';\n\nlet USER_COUNT = 0;\n\ntype HashMap<T = any> = Record<string, T>;\n\nexport let USER_DOMAIN = 'place.tech';\n\nconst USER_EMAILS: string[] = [];\n/* istanbul ignore next */\n/**\n * Generate raw mock data for a user\n * @param id Forced ID for the mock\n * @param name Forced name for the user\n * @param external Whether user is external of the organisation\n */\nexport function generateMockUser(\n    id?: string,\n    name?: string,\n    external?: boolean\n): HashMap {\n    if (!id) {\n        id = `user-${USER_COUNT++}`;\n    }\n    if (!name) {\n        name = `User ${USER_COUNT}`;\n    }\n    if (external === undefined) {\n        external = !(predictableRandomInt(99999) % 2);\n    }\n    const organisation = external ? `Fake Co.` : USER_DOMAIN.split('.')[0];\n    let delegates: string[] = [];\n    const delegate_count = Math.min(\n        predictableRandomInt(4) + 1,\n        USER_EMAILS.length\n    );\n    for (let i = 0; i < delegate_count; i++) {\n        delegates.push(USER_EMAILS[predictableRandomInt(USER_EMAILS.length)]);\n    }\n    delegates = unique(delegates);\n    const email = `${name.split(' ').join('.').toLowerCase()}@${\n        external ? 'not-' : ''\n    }${USER_DOMAIN}`;\n    USER_EMAILS.push(email);\n    return {\n        id,\n        name,\n        first_name: name.split(' ')[0],\n        last_name: name.split(' ')[1],\n        email,\n        phone: `(02) 4567 8901`,\n        visitor: external,\n        organisation: {\n            id: organisation.split(' ').join('.').toLowerCase(),\n            name: organisation,\n        },\n        department: `Department ${predictableRandomInt(10)}`,\n        staff_code: predictableRandomInt(999_999),\n        delegates,\n        image: `${id}.png`,\n    };\n}\n\n/**\n * Generate form fields for the given user\n * @param user User to generate form for\n */\nexport function generateUserForm(user: User): FormGroup {\n    if (!user) {\n        throw Error('No user passed');\n    }\n\n    const fields: HashMap<FormControl> = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(user.phone || ''),\n        assistance_required: new FormControl(user.assistance_required || false),\n        visit_expected: new FormControl(user.visit_expected ?? true),\n    };\n\n    // Generate form group for the user\n    const form = new FormGroup(fields);\n    return form;\n}\n\nexport function generateGuestForm(\n    user: GuestUser,\n    host: string = ''\n): FormGroup {\n    const fields: HashMap<FormControl> = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(user.phone || ''),\n        host: new FormControl(host || '', [Validators.required]),\n    };\n    // Generate form group for the guest\n    const form = new FormGroup(fields);\n    return form;\n}\n"],"sourceRoot":"webpack:///"}