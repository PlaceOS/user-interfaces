{"version":3,"sources":["./apps/map-kiosk/$_lazy_route_resources|lazy|groupOptions: {}|namespace object","./libs/common/src/lib/base.class.ts","./libs/components/src/lib/confirm-modal.component.ts","./libs/common/src/lib/general.ts","./libs/common/src/lib/hotkeys.service.ts","./apps/map-kiosk/src/environments/settings.ts","./libs/common/src/lib/settings.service.ts","./libs/common/src/lib/version.ts","./libs/common/src/lib/api.ts","./libs/common/src/lib/notifications.ts","./libs/common/src/lib/application.ts","./libs/common/src/lib/angular-animations.ts","./libs/users/src/lib/user.utilities.ts","./libs/users/src/lib/user.class.ts","./libs/common/src/lib/user-state.ts","./libs/components/src/lib/action-icon.component.ts","./libs/components/src/lib/safe.pipe.ts","./libs/components/src/lib/icon.component.ts","./libs/components/src/lib/popout-menu.component.ts","./libs/components/src/lib/sanitise.pipe.ts","./libs/components/src/lib/interactive-map.component.ts","./libs/components/src/lib/map-pin.component.ts","./libs/components/src/lib/map-radius.component.ts","./libs/components/src/lib/status-overlay.component.ts","./libs/components/src/lib/custom-tooltip.component.ts","./libs/components/src/lib/virtual-keyboard.component.ts","./libs/organisation/src/lib/level.class.ts","./libs/organisation/src/lib/building.class.ts","./libs/organisation/src/lib/organisation.class.ts","./libs/organisation/src/lib/organisation.service.ts","./libs/organisation/src/lib/desk.class.ts","./libs/spaces/src/lib/space.class.ts","./libs/spaces/src/lib/spaces.service.ts","./libs/components/src/lib/global-loading.component.ts","./libs/components/src/lib/map-polygon.component.ts","./libs/components/src/lib/unauthorised.component.ts","./libs/components/src/lib/components.module.ts","./libs/form-fields/src/lib/duration-field.component.ts","./libs/users/src/lib/new-user-modal.component.ts","./libs/users/src/lib/user-form.component.ts","./libs/users/src/lib/users.module.ts","./libs/users/src/lib/location.class.ts","./libs/catering/src/lib/catering-item.class.ts","./libs/catering/src/lib/catering-order.class.ts","./libs/events/src/lib/helpers.ts","./libs/events/src/lib/event.class.ts","./libs/users/src/lib/staff.fn.ts","./libs/form-fields/src/lib/form-fields.module.ts","./libs/spaces/src/lib/space-select-item.component.ts","./libs/calendar/src/lib/calendar.class.ts","./libs/calendar/src/lib/calendar.fn.ts","./libs/spaces/src/lib/space-select-modal.component.ts","./libs/spaces/src/lib/spaces.module.ts","./libs/spaces/src/lib/space.utilities.ts","./libs/explore/src/lib/explore-state.service.ts","./libs/events/src/lib/events.fn.ts","./libs/events/src/lib/validators.ts","./libs/explore/src/lib/explore-space-info.component.ts","./libs/events/src/lib/utilities.ts","./libs/explore/src/lib/explore-booking-modal.component.ts","./libs/explore/src/lib/explore-spaces.service.ts","./libs/explore/src/lib/explore-zones.service.ts","./libs/bookings/src/lib/desk-questions-modal.component.ts","./libs/bookings/src/lib/booking.class.ts","./libs/bookings/src/lib/bookings.fn.ts","./libs/bookings/src/lib/booking-form.service.ts","./libs/bookings/src/lib/booking.utilities.ts","./libs/explore/src/lib/explore-device-info.component.ts","./libs/explore/src/lib/explore-desk-info.component.ts","./libs/explore/src/lib/explore-desks.service.ts","./libs/explore/src/lib/explore-zoom-control.component.ts","./libs/explore/src/lib/explore-search.service.ts","./libs/explore/src/lib/explore-search.component.ts","./libs/explore/src/lib/explore.module.ts","./apps/map-kiosk/src/app/bootstrap.component.ts","./apps/map-kiosk/src/app/footer-menu.component.ts","./apps/map-kiosk/src/app/desk-booking.component.ts","./apps/map-kiosk/src/app/explore-level-select.component.ts","./apps/map-kiosk/src/app/explore.component.ts","./apps/map-kiosk/src/app/app-routing.module.ts","./libs/mocks/src/lib/api/catering.data.ts","./libs/mocks/src/lib/api/zone.data.ts","./libs/mocks/src/lib/api/zones.mock.ts","./libs/mocks/src/lib/api/common.mock.ts","./libs/mocks/src/lib/api/users.data.ts","./libs/mocks/src/lib/api/spaces.data.ts","./libs/mocks/src/lib/api/events.data.ts","./libs/mocks/src/lib/api/users.mock.ts","./libs/mocks/src/lib/realtime/control.ts","./libs/mocks/src/lib/realtime/events.ts","./libs/mocks/src/lib/realtime/desks.ts","./libs/mocks/src/lib/realtime/camera.ts","./libs/mocks/src/lib/realtime/display.ts","./libs/mocks/src/lib/realtime/microphone.ts","./libs/mocks/src/lib/realtime/capture.ts","./libs/mocks/src/lib/api/systems.mock.ts","./libs/mocks/src/lib/systems-bindings.mock.ts","./libs/mocks/src/lib/api/events.mock.ts","./libs/mocks/src/lib/api/calendars.mock.ts","./libs/mocks/src/lib/api/bookings.data.ts","./libs/mocks/src/index.ts","./libs/mocks/src/lib/api/bookings.mock.ts","./libs/components/src/lib/app.component.ts","./libs/common/src/lib/placeos.ts","./apps/map-kiosk/src/app/app.module.ts","./apps/map-kiosk/src/environments/environment.prod.ts","./apps/map-kiosk/src/main.ts"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","id","module","exports","BaseClass","_timers","_intervals","_subscriptions","_initialised","initialised","this","asObservable","getValue","destroy","key","clearTimeout","clearInterval","unsub","name","fn","delay","Function","setTimeout","setInterval","Subscription","unsubscribe","contains","subs","Object","filter","k","includes","CONFIRM_METADATA","height","width","maxHeight","maxWidth","ConfirmModalComponent","_dialog_ref","_data","event","title","content","confirm_text","cancel_text","icon","class","disableClose","enableClose","emit","reason","_app_name","setAppName","log","type","msg","args","stream","force","app_name","window","debug","colors","console","getItemWithKeys","map","shift","length","array","el","pos","arr","indexOf","find","i","randomInt","ceil","floor","Math","random","start1","end1","start2","end2","seed","str","h","imul","charCodeAt","xmur3","rand","a","b","c","d","t","INVALID_STANDALONE_KEYS","HotkeysService","keydown_states","keydown_observers","combo_end","registered_combos","counter","addEventListener","mapKey","toLowerCase","last_down","next","preventDefault","combo","combination","Array","split","validCombination","push","last_key","updateCombinationEndList","subscribe","count","presses","state","reduce","v","replace","non_meta","DEFAULT_SETTINGS","composer","domain","route","protocol","port","use_domain","local_login","app","description","short_name","logo","src","logo_dark","general","desks","hide_reason","can_set_host","SettingsService","_title","super","_overrides","_subjects","_observables","now","Date","time","built","init","value","getTitle","setTitle","get","location","pathname","slice","join","toUpperCase","application","settings","override_settings","override","hasOwnProperty","_service","_available","_activated","_timer","notify","message","action","on_action","config","snackbar_ref","open","panelClass","duration","dismiss","onAction","error","notifyInfo","info","opacity","USER_DOMAIN","User","data","email","first_name","last_name","phone","organisation","notes","photo","username","organizer","groups","checked_in","required","response_status","sys_admin","support","extension_data","assistance_required","is_external","endsWith","visit_expected","card_number","staff_id","is_logged_in","_current_user","jest","pipe","retry","user","ActionIconComponent","className","SafePipe","sanitizer","bypassSecurityTrustResourceUrl","bypassSecurityTrustUrl","bypassSecurityTrustScript","bypassSecurityTrustStyle","bypassSecurityTrustHtml","IconComponent","PopoutMenuComponent","actions","timeout","show","close","SecurityContext","SanitizePipe","sanitize","RESOURCE_URL","URL","SCRIPT","STYLE","HTML","MAP_FEATURE_DATA","InteractiveMapComponent","_injector","zoom","center","x","y","injectors","_on_changes","updateDisplay","features","f","idx","_feature_list","toArray","nativeElement","viewer","changes","createView","providers","provide","useValue","_","position","parent","focus","focusOn","styles","labels","updateView","loading","feature_list","options","desired_zoom","desired_center","_outlet_el","element","url","subscription","rect","mappings","w","MapPinComponent","_details","fill","stroke","show_message","MapRadiusComponent","_el","radius","last_seen","max","formatDistanceToNow","updateRadius","box","getBoundingClientRect","StatusOverlayComponent","links","injector","CustomTooltipData","CustomTooltipComponent","_element","_overlay","backdrop","hover","_overlay_ref","onClick","onEnter","onLeave","_updateInjector","x_pos","y_pos","ngOnDestroy","_updateType","_portal","create","hasBackdrop","positionStrategy","flexibleConnectedTo","withPositions","originX","originY","overlayX","overlayY","attach","backdropClick","dispose","DEFAULT_KEYS","VirtualKeyboardComponent","keyset","onFocus","enabled","onBlur","blur","global","bottom","centerHorizontally","cursor_pos","selectionStart","substr","dispatchEvent","InputEvent","updateKeyState","focusInput","selectionEnd","BuildingLevel","parent_id","display_name","map_id","capacity","locations","parts","number","Building","raw_data","disc_info","discovery_info","zone_id","zone","extras","extra_id","extra_name","loan_items","levels","building_id","_roles","roles","_lockers","lockers","locker_structure","_systems","systems","_phone_numbers","phone_numbers","_location","longitude","latitude","room_configurations","attributes","searchables","neighbourhoods","lvl","lvl_features","feature","level_id","bindings","timezone","catering_hours","start","end","visitor_space","holding_bay","address","orientations","booking_details","booking_rules","catering_restricted_from","currency","Organisation","tags","_settings","OrganisationService","_router","_buildings","_active_building","_levels","building_list","level_list","active_building","active_levels","bld","levelsForBuilding","_building_settings","overrides","buildingSettings","bld_id","building","_organisation","details","buildings","id_list","tries","load","catch","err","min","orgs","loadOrganisation","loadBuildings","loadLevels","loadSettings","org_list","toPromise","auth","org","list","org_zone","navigate","limit","localStorage","getItem","sort","localeCompare","m","prev","curr","concat","setItem","Desk","toJSON","format","bookable","qr_code","Space","zones","support_url","image","configurations","level","availability","SpacesService","_org","_list","_compare","space","loadSpaces","predicate","valid_spaces","sys","levelWithID","GlobalLoadingComponent","_spaces","MapPolygonComponent","_cdr","color","padding","scale","offset_x","offset_y","points","point_list","data$","processPoints","diff","x_min","x_max","y_min","y_max","range","ratio","edge_padding","s","detectChanges","UnauthorisedComponent","MAT_MODULES","ComponentsModule","DurationFieldComponent","step","specialPreprops","duration_options","generateDurationOptions","new_value","_onChange","disabled","_onTouch","blocks","date","option","add","hours","minutes","useExisting","multi","setValue","NewUserModalComponent","form","fields","generateUserForm","markAllAsTouched","valid","new_user","metadata","UserFormComponent","controls","invalid","touched","MapLocation","map_width","map_height","variance","at_location","coordinates_from","CateringItem","category","unit_price","quantity","discount_cap","accept_points","total_cost","options_string","CateringOrder","system_id","event_id","items","item_count","amount","item","charge_code","status","invoice_number","deliver_at","getTime","DURATION_MAP","month","months","week","weeks","day","days","hour","minute","DEFAULT_RULES","auto_approve","hidden","stringToMinutes","addToDate","checkRulesMatch","host","ruleset","matches","conditions","every","is_before","is_after","min_length","max_length","_default_user","event_start","roundToNearestMinutes","nearestTo","event_end","calendar","creator","attendees","resource","u","resources","body","private","all_day","recurring","recurring_master_id","organiser","master","recurrence","range_start","valueOf","range_end","interval","pattern","days_of_week","system","old_system","attachments","some","eventStatus","catering","obj","set","breakdown","is_today","STAFF_ENDPOINT","FormFieldsModule","SpaceSelectItemComponent","primary","summary","can_edit","starts_at","ends_at","CALENDAR_ENDPOINT","calendarsToSpaces","cal","SpaceSelectModalComponent","spaces","space_types","available_spaces","q","query","zone_ids","period_start","period_end","filtered_spaces","filterSpacesFromRules","rulemap","rules","rulesForSpace","forEach","multiple","space_map","save","SPACE_COUNT","ExploreStateService","_level","_positions","_styles","_features","_actions","_labels","_options","disable","_message","map_url","map_positions","map_features","debounceTime","disable_features","map_actions","disable_actions","map_labels","disable_labels","map_styles","style_mappings","text","display","disable_styles","setLevel","setOptions","old_options","style_map","feature_map","actions_map","labels_map","EVENTS_ENDPOINT","endInFuture","control","setMinutes","setHours","ExploreSpaceInfoComponent","events","parentElement","ngOnInit","parseInt","style","top","left","ExploreBookingModalComponent","booking","visitor_type","needs_space","needs_parking","valueChanges","o","l","on_error","system_ids","method","encodeURIComponent","updateEvent","createEvent","DEFAULT_COLOURS","free","pending","reserved","busy","unknown","ExploreSpacesService","_state","_dialog","_bookings","_statuses","_bind","unsubWith","mod","binding","listen","handleBookingsChange","bind","handleStatusChange","updateActions","updateHoverElements","bookings","updateStatus","colours","setStyles","full_size","setFeatures","callback","bookSpace","setActions","ExploreZonesService","_capacity","_draw","_points","area_management","parseData","zone_metadata","all","areas","area","properties","label_location","draw_polygon","geometry","coordinates","filled","area_id","ambient_temp","people_count","humidity","queue_size","z_index","setLabels","colour","getCenterPoint","DeskQuestionsModalComponent","travelled","unwell","contact","failure","asset_id","booking_start","booking_end","booking_type","abs","Intl","DateTimeFormat","resolvedOptions","timeZone","user_email","user_id","user_name","rejected","approved","approver_id","approver_email","approver_name","access","addHours","BOOKINGS_ENDPOINT","BookingFormService","_view","_form","_form_value","_booking","_loading","last_success","JSON","parse","sessionStorage","assets","distinctUntilKeyChanged","of","an_array","stack","res","pop","isArray","reverse","flatten","asset","available_assets","bkn","grouped_availability","asset_list","members","group","clearForm","booked_by","booked_by_id","booked_by_email","booker","patchValue","emitEvent","generateBookingForm","storeForm","newForm","removeItem","stringify","checkQuestions","dialog","ref","race","componentInstance","afterClosed","openConfirmModal","postForm","result","updateBooking","createBooking","setView","ExploreDeviceInfoComponent","mac","manufacturer","os","ssid","toFixed","diameter","bg_color","distance_color","overlay_ref","loadUser","onTouch","addSuffix","distance","execute","assigned_to","_dot","ExploreDeskInfoComponent","ExploreDesksService","_in_use","_desks","_reserved","_poll","_desk_bookings","desk_list","j","catchError","processBindingChange","_state_change","in_use","is_used","is_reserved","processDesks","enable_booking","devices","processDevices","desk_id","device","desk","book_fn","confirmPost","ExploreZoomControlComponent","zoomIn","setPositions","positions","zoomOut","reset","ExploreSearchService","_emergency_contacts","_filter","emergency_contacts","_user_search","search_fn","search_results","users","contacts","search","results","searchStaff","location_services","contacts_map","ExploreSearchComponent","_search","_route","search_str","setFilter","select","checkClick","target","_input_el","relativeTo","queryParams","closeSearch","showSearch","SharedExploreModule","BootstrapComponent","rotations","active_level","queryParamMap","params","has","osk_enabled","bootstrapKiosk","checkBootstrap","active_rotation","active_location","FooterMenuComponent","DeskBookingComponent","resetCountdown","countdown_time","ExploreLevelSelectComponent","_orgs","routes","path","component","ExploreComponent","_s","_zones","reset_delay","onMouse","resetKiosk","take","locateSpace","locateUser","locate_details","priority","document","activeElement","closeAll","toggleZones","redirectTo","AppRoutingModule","useHash","MOCK_MENU","generateCateringOrder","mx","MOCK_ORGS","created_at","updated_at","triggers","MOCK_BUILDINGS","MOCK_LEVELS","num","mockLevel","p","MOCK_METADATA","current","ZONE_MOCKS","padString","request","query_params","route_params","generateMockDeskMetadata","DESK_FEATURES","registerMocks","DOMAIN","PREDEF_USERS","ACTIVE_USER","MOCK_STAFF","MOCK_GUESTS","randomSpaceFeatures","numFeatures","r","MOCK_SPACES","linked","long_name","searchable","controlable","cost_hour","setup","linked_rooms","generateMockSpace","EVENT_TIME","startOf","nextEventTime","unix","event_status","randomStatus","rnd","MOCK_EVENTS","index","PEOPLE","unshift","event_spaces","USER_MOCKS","person","decodeURIComponent","generateLocation","LOCATION_TYPES","level_spaces","meeting","subtract","geo","lat","lon","RoomModule","volume","connected","active","input_list","output_list","env_sources","inputs","outputs","source","input","output","$updateState","following","mute","$mute","locked","Mic1","Mic2","Mic3","PC1","PC2","PC3","PC4","HDMI","VGA","Camera1","Camera2","Camera3","Camera4","TV1","Display1","Display2","Display3","Display4","Display5","states","createSystemModule","MockBookingModule","time_zone","disable_book_now","disable_end_meeting","pending_period","pending_before","control_ui","catering_ui","last_booking_started","createBookingsModule","$start_meeting","$end_meeting","$book_now","len","updateBookings","subSeconds","MockLocationServicesModule","overview","padZero","no","createLocationServicesModule","desk_count","desk_usage","device_capacity","device_count","estimated_people","percentage_use","recommendation","updateLocations","s2_cell_id","CameraModule","presets","dir","tilt","DisplayModule","MicrophoneModule","CaptureModule","live","remaining","$start","createCaptureModule","SYSTEM_MOCKS","System","Bookings","AreaManagement","Camera","createCameraModule","Display","createDisplayModule","Microphone","createMicrophoneModule","Capture","createSystem","EVENT_MOCKS","new_event","findIndex","splice","CALENDAR_MOCKS","handleSpaceAvailability","TYPES","MOCK_BOOKINGS","lvls","approver","BOOKING_MOCKS","AppComponent","_tracing","_cache","_snackbar","_hotkey","_clipboard","reload","copy","navigator","clipboard","readText","tkn","mock","origin","hostname","href","auth_type","scope","auth_uri","token_uri","redirect_uri","handle_login","use_iframe","setupPlace","onInitError","cache","isEnabled","available","hash","activateUpdate","activated","checkForUpdate","setupCache","dsn","sample_rate","S","integrations","tracingOrigins","routingInstrumentation","tracesSampleRate","initSentry","AppModule","showDialog","deps","bootstrapModule"],"mappings":"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","file":"main.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(() => {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = () => ([]);\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = 9921;\nmodule.exports = webpackEmptyAsyncContext;","import { Injectable, OnDestroy } from '@angular/core';\nimport { Subscription, BehaviorSubject } from 'rxjs';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class BaseClass implements OnDestroy {\n    /** Store for named timers */\n    protected _timers: { [name: string]: number } = {};\n    /** Store for named intervals */\n    protected _intervals: { [name: string]: number } = {};\n    /** Store for named subscription unsub callbacks */\n    protected _subscriptions: {\n        [name: string]: Subscription | (() => void);\n    } = {};\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n\n    /** Whether the object has been initialised */\n    public get is_initialised(): boolean {\n        return this._initialised.getValue();\n    }\n\n    public ngOnDestroy(): void {\n        this.destroy();\n    }\n\n    protected destroy() {\n        for (const key in this._timers) {\n            if (key in this._timers) {\n                this.clearTimeout(key);\n            }\n        }\n        for (const key in this._intervals) {\n            if (key in this._intervals) {\n                this.clearInterval(key);\n            }\n        }\n        for (const key in this._subscriptions) {\n            if (key in this._subscriptions) {\n                this.unsub(key);\n            }\n        }\n    }\n\n    /**\n     * Creates a named timer\n     * @param name Name of the timer\n     * @param fn Callback function for the timer\n     * @param delay Callback delay\n     */\n    protected timeout(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearTimeout(name);\n            this._timers[name] = <any>setTimeout(() => {\n                fn();\n                this._timers[name] = null;\n            }, delay);\n        } else {\n            throw new Error(\n                name\n                    ? 'Cannot create named timeout without a name'\n                    : 'Cannot create a timeout without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named timer\n     * @param name Timer name\n     */\n    protected clearTimeout(name: string) {\n        if (this._timers[name]) {\n            clearTimeout(this._timers[name]);\n            this._timers[name] = null;\n        }\n    }\n\n    /**\n     * Creates a named interval\n     * @param name Name of the interval\n     * @param fn Callback function for the interval\n     * @param delay Callback delay\n     */\n    protected interval(name: string, fn: () => void, delay: number = 300) {\n        if (name && fn && fn instanceof Function) {\n            this.clearInterval(name);\n            this._intervals[name] = <any>setInterval(() => fn(), delay);\n        } else {\n            throw new Error(\n                name\n                    ? 'Cannot create named interval without a name'\n                    : 'Cannot create a interval without a callback'\n            );\n        }\n    }\n\n    /**\n     * Clears the named interval\n     * @param name Timer name\n     */\n    protected clearInterval(name: string) {\n        if (this._intervals[name]) {\n            clearInterval(this._intervals[name]);\n            this._intervals[name] = null;\n        }\n    }\n\n    /**\n     * Store named subscription\n     * @param name Name of the subscription\n     * @param unsub Unsubscribe callback or Subscription object\n     */\n    protected subscription(name: string, unsub: Subscription | (() => void)) {\n        this.unsub(name);\n        this._subscriptions[name] = unsub;\n    }\n\n    /**\n     * Call unsubscribe callback with the given name\n     * @param name\n     */\n    protected unsub(name: string) {\n        if (this._subscriptions && this._subscriptions[name]) {\n            this._subscriptions[name] instanceof Subscription\n                ? (this._subscriptions[name] as Subscription).unsubscribe()\n                : (this._subscriptions[name] as any)();\n            this._subscriptions[name] = null;\n        }\n    }\n\n    /** Unsubscribe to the items with names containing the given string */\n    protected unsubWith(contains: string) {\n        const subs = Object.keys(this._subscriptions).filter((k) =>\n            k.includes(contains)\n        );\n        for (const key of subs) {\n            this.unsub(key);\n        }\n    }\n}\n","import { Component, Output, EventEmitter, Inject } from '@angular/core';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\n\nimport { ApplicationIcon, DialogEvent } from 'libs/common/src/lib/types';\n\nexport interface ConfirmModalData {\n    /** Title of the modal */\n    title: string;\n    /** Contents of the modal */\n    content: string;\n    /** Text displaed on the confirmation button */\n    confirm_text?: string;\n    /** Text displaed on the confirmation button */\n    cancel_text?: string;\n    /** Icon to display on the modal */\n    icon: ApplicationIcon;\n}\n\nexport const CONFIRM_METADATA = {\n    height: 'auto',\n    width: '24em',\n    maxHeight: 'calc(100vh - 2em)',\n    maxWidth: 'calc(100vw - 2em)',\n};\n\n@Component({\n    selector: 'confirm-modal',\n    template: `\n        <header>\n            <h3 mat-dialog-title>{{ title }}</h3>\n        </header>\n        <main\n            *ngIf=\"!loading; else load_state\"\n            class=\"flex flex-col items-center space-y-2 p-4\"\n        >\n            <app-icon [icon]=\"icon\" class=\"text-5xl\"></app-icon>\n            <p\n                content\n                class=\"text-center text-sm w-[22rem]\"\n                [innerHTML]=\"content\"\n            ></p>\n        </main>\n        <footer\n            class=\"flex items-center justify-center p-2 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button mat-button class=\"inverse w-32\" mat-dialog-close>\n                {{ cancel_text }}\n            </button>\n            <button mat-button name=\"accept\" class=\"w-32\" (click)=\"onConfirm()\">\n                {{ confirm_text }}\n            </button>\n        </footer>\n        <ng-template #load_state>\n            <main loading>\n                <div\n                    class=\"w-full h-48 flex flex-col items-center justify-center space-y-2\"\n                >\n                    <mat-spinner diameter=\"32\"></mat-spinner>\n                    <p>{{ loading }}</p>\n                </div>\n            </main>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class ConfirmModalComponent {\n    /** Loading state */\n    public loading: string;\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Title of the confirm modal */\n    public readonly title: string = this._data.title || 'Confirm';\n    /** Body of the confirm modal */\n    public readonly content: string = this._data.content || 'Are you sure?';\n    /** Display text on the confirm button */\n    public readonly confirm_text: string = this._data.confirm_text || 'Accept';\n    /** Display text on the cancel button */\n    public readonly cancel_text: string = this._data.cancel_text || 'Cancel';\n    /** Display icon properties */\n    public readonly icon: ApplicationIcon = this._data.icon || {\n        class: 'material-icons',\n        content: 'done',\n    };\n    /** Prevent user from closing the modal */\n    public readonly disableClose = () => (this._dialog_ref.disableClose = true);\n    /** Allow the user to close the modal */\n    public readonly enableClose = () => (this._dialog_ref.disableClose = false);\n\n    constructor(\n        private _dialog_ref: MatDialogRef<ConfirmModalComponent>,\n        @Inject(MAT_DIALOG_DATA) private _data: ConfirmModalData\n    ) {}\n\n    /** User confirmation of the content of the modal */\n    public onConfirm() {\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import { FormGroup } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\nimport { first } from 'rxjs/operators';\nimport {\n    ConfirmModalComponent,\n    ConfirmModalData,\n    CONFIRM_METADATA,\n} from '../../../components/src/lib/confirm-modal.component';\nimport { HashMap } from './types';\n\n/** Available console output streams. */\nexport type ConsoleStream = 'debug' | 'warn' | 'log' | 'error';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n    }\n}\n\nlet _app_name = 'APP';\n\nexport function setAppName(name: string) {\n    _app_name = name;\n}\n\n/**\n * Log data to the browser console\n * @param type Type of message\n * @param msg Message body\n * @param args array of argments to log to the console\n * @param stream Stream to emit the console on. 'debug', 'log', 'warn' or 'error'\n * @param force Whether to force message to be emitted when debug is disabled\n */\nexport function log(\n    type: string,\n    msg: string,\n    args?: any,\n    stream: ConsoleStream = 'debug',\n    force: boolean = false,\n    app_name: string = _app_name\n) {\n    if (window.debug || force) {\n        const colors: string[] = [\n            'color: #E91E63',\n            'color: #3F51B5',\n            'color: default',\n        ];\n        if (args) {\n            console[stream](\n                `%c[${app_name}]%c[${type}] %c${msg}`,\n                ...colors,\n                args\n            );\n        } else {\n            console[stream](`%c[${app_name}]%c[${type}] %c${msg}`, ...colors);\n        }\n    }\n}\n\n/**\n * Get item from the nested object\n * @param keys List of sub-keys to search for\n * @param map Object to search\n */\nexport function getItemWithKeys(keys: string[], map: HashMap) {\n    const key = keys.shift();\n    if (map && map[key] != null) {\n        return keys.length > 0 ? getItemWithKeys(keys, map[key]) : map[key];\n    }\n    return null;\n}\n\n/**\n * Remove duplicates from the given array\n * @param array List of items to remove duplicates from\n * @param key Key on array objects to compare for uniqueness\n */\nexport function unique<T = any>(array: T[] = [], key: string = ''): T[] {\n    return array.filter(\n        (el, pos, arr) =>\n            arr.indexOf(\n                key\n                    ? arr.find((i) => i[key] === el[key])\n                    : arr.find((i) => i === el)\n            ) === pos\n    );\n}\n\n/**\n * Generate a random number\n * @param ceil Biggest value to generate not inclusive\n * @param floor Smallest value to generate. Defaults to 0\n */\nexport function randomInt(ceil: number, floor: number = 0) {\n    return Math.floor(Math.random() * (ceil - floor)) + floor;\n}\n\nexport async function openConfirmModal(\n    data: ConfirmModalData,\n    dialog: MatDialog\n) {\n    const ref = dialog.open<ConfirmModalComponent, ConfirmModalData>(\n        ConfirmModalComponent,\n        {\n            ...CONFIRM_METADATA,\n            data,\n        }\n    );\n    return {\n        ...(await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ])),\n        loading: (s) => (ref.componentInstance.loading = s),\n        close: () => ref.close(),\n    };\n}\n\n/**\n * Parse raw CSV data into a JSON object\n * @param csv CSV data to parse\n */\nexport function csvToJson(csv: string, delimiter: string = ','): HashMap[] {\n    const objPattern = new RegExp(\n        '(\\\\,|\\\\r?\\\\n|\\\\r|^)(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|([^\\\\,\\\\r\\\\n]*))',\n        'gi'\n    );\n    let arrMatches = null;\n    const arrData = [[]];\n    while ((arrMatches = objPattern.exec(csv))) {\n        if (arrMatches[1].length && arrMatches[1] !== ',') arrData.push([]);\n        arrData[arrData.length - 1].push(\n            arrMatches[2]\n                ? arrMatches[2].replace(new RegExp('\"\"', 'g'), '\"')\n                : arrMatches[3]\n        );\n    }\n    const headers: string[] = arrData.splice(0, 1)[0];\n    const elements = arrData.map((row) => {\n        const element = {};\n        for (let i = 0; i < row.length; i++) {\n            const key = headers[i].split(' ').join('_').toLowerCase();\n            try {\n                element[key] = JSON.parse(row[i]);\n            } catch (e) {\n                element[key] = row[i] || '';\n            }\n        }\n        return element;\n    });\n    return elements;\n}\n\n/**\n * Convert javascript array to CSV string\n * @param json Javascript array to convert\n */\nexport function jsonToCsv(json: HashMap[]) {\n    if (json instanceof Array && json.length > 0) {\n        const keys = Object.keys(json[0]);\n        const valid_keys = keys.filter((key) => key in json[0]);\n        return `${valid_keys.join(',')}\\n${json\n            .map((item) =>\n                valid_keys.map((key) => JSON.stringify(item[key])).join(',')\n            )\n            .join('\\n')}`;\n    }\n    return '';\n}\n\n/**\n * Downloads a file to the users computer with the given filename and contents\n * @param filename Name of the file to download\n * @param contents Contents of the file to download\n */\nexport function downloadFile(filename: string, contents: string) {\n    const element = document.createElement('a');\n    element.setAttribute(\n        'href',\n        'data:text/plain;charset=utf-8,' + encodeURIComponent(contents)\n    );\n    element.setAttribute('download', filename);\n\n    element.style.display = 'none';\n    document.body.appendChild(element);\n\n    element.click();\n\n    document.body.removeChild(element);\n}\n\nexport function parseJWT(token: string) {\n    const base64Url = token.split('.')[1];\n    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\n    const jsonPayload = decodeURIComponent(\n        atob(base64)\n            .split('')\n            .map((c) => {\n                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n            })\n            .join('')\n    );\n    return JSON.parse(jsonPayload);\n}\n\n/* istanbul ignore next */\n/**\n * Flatten nested array\n * @param an_array Array to flatten\n */\nexport function flatten<T = any>(an_array: T[]) {\n    const stack = [...an_array];\n    const res = [];\n    while (stack.length) {\n        // pop value from stack\n        const next = stack.pop();\n        if (Array.isArray(next)) {\n            // push back array items, won't modify the original input\n            stack.push(...next);\n        } else {\n            res.push(next);\n        }\n    }\n    // reverse to restore input order\n    return res.reverse();\n}\n\n/**\n * Check whether two time periods intersect with each other\n * @param start1 Unix epoch in ms of the first period's start time\n * @param end1 Unix epoch in ms of the first period's end time\n * @param start2 Unix epoch in ms of the second period's start time\n * @param end2 Unix epoch in ms of the second period's end time\n */\nexport function timePeriodsIntersect(start1, end1, start2, end2) {\n    return (\n        (start1 >= start2 && start1 < end2) ||\n        (end1 > start2 && end1 < end2) ||\n        (start2 >= start1 && start2 < end1) ||\n        (end2 > start1 && end2 <= end1)\n    );\n}\n\nconst seed = xmur3('PlaceOS');\nconst rand = sfc32(0x9e3779b9, 0x243f6a88, 0xb7e15162, seed());\n\nexport function predictableRandomInt(ceil: number = 100, floor: number = 0) {\n    return Math.floor(rand() * (ceil - floor)) + floor;\n}\n\n// https://stackoverflow.com/questions/521295/seeding-the-random-number-generator-in-javascript\nfunction xmur3(str) {\n    let h = 1779033703 ^ str.length;\n    for (let i = 0; i < str.length; i++)\n        (h = Math.imul(h ^ str.charCodeAt(i), 3432918353)),\n            (h = (h << 13) | (h >>> 19));\n    return function () {\n        h = Math.imul(h ^ (h >>> 16), 2246822507);\n        h = Math.imul(h ^ (h >>> 13), 3266489909);\n        return (h ^= h >>> 16) >>> 0;\n    };\n}\n\nfunction sfc32(a, b, c, d) {\n    return function () {\n        a >>>= 0;\n        b >>>= 0;\n        c >>>= 0;\n        d >>>= 0;\n        let t = (a + b) | 0;\n        a = b ^ (b >>> 9);\n        b = (c + (c << 3)) | 0;\n        c = (c << 21) | (c >>> 11);\n        d = (d + 1) | 0;\n        t = (t + d) | 0;\n        c = (c + t) | 0;\n        return (t >>> 0) / 4294967296;\n    };\n}\n\n/** Get time format string for locale */\nexport function timeFormatString(): string {\n    return is24HourTime() ? 'HH:mm' : 'h:mm a';\n}\n\n/** Whether locale string is displayed in 24 hour time */\nexport function is24HourTime(): boolean {\n    const date = new Date();\n    const localeString = date\n        .toLocaleTimeString(\n            document.querySelector('html').getAttribute('lang') ||\n                navigator.language\n        )\n        .toLowerCase();\n    return localeString.indexOf('am') < 0 && localeString.indexOf('pm') < 0;\n}\n\nexport function getInvalidFields(form: FormGroup) {\n    const invalid = [];\n    for (const key in form.controls) {\n        if (!form.controls[key].valid) {\n            invalid.push(key);\n        }\n    }\n    return invalid;\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, Observable, Subscription } from 'rxjs';\n\nimport { HashMap } from './types';\nimport { unique } from './general';\n\n/** List of keys that cannot be in a combination by themselves or with each other */\nconst INVALID_STANDALONE_KEYS: string[] = ['control', 'shift', 'alt', 'meta', 'os'];\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class HotkeysService {\n    /** Map of subjects which store press states of keys */\n    private keydown_states: HashMap<BehaviorSubject<number>> = {};\n    /** Map of obserers for key state subjects */\n    private keydown_observers: HashMap<Observable<number>> = {};\n    /** List of keys at the end of a combination */\n    private combo_end: string[] = [];\n    /** List of registered hotkey combinations */\n    private registered_combos: string[][] = [];\n    /** Counter for the number of keydown events. Used for checking order of key presses */\n    private counter: number = 0;\n    /** Last key code to be pressed */\n    private last_down: string;\n\n    constructor() {\n        window.addEventListener('keydown', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            if (this.last_down !== code) {\n                if (!this.keydown_states[code]) {\n                    this.keydown_states[code] = new BehaviorSubject(null);\n                    this.keydown_observers[code] = this.keydown_states[code].asObservable();\n                }\n                this.keydown_states[code].next(++this.counter);\n                if (this.combo_end.indexOf(code) >= 0) {\n                    event.preventDefault();\n                }\n                this.last_down = code;\n            }\n        });\n\n        window.addEventListener('keyup', (event: KeyboardEvent) => {\n            const code = this.mapKey((event.code || '').toLowerCase());\n            this.keydown_states[code].next(null);\n            if (this.last_down === code) {\n                this.last_down = null;\n            }\n        });\n    }\n\n    /**\n     * Listen to the given key combination\n     * @param combo Array of key codes to listen to or a hotkey string e.g. `Alt+Shift+KeyK`\n     * @param next Callback for combination presses\n     */\n    public listen(combo: string | string[], next: () => void): Subscription {\n        combo = (combo instanceof Array ? combo : combo.split('+'));\n        const combination: string[] = combo.map(i => this.mapKey(i.toLowerCase()));\n        if (combination.length > 0 && this.validCombination(combination)) {\n            this.registered_combos.push(combination);\n            const last_key = combination[combination.length - 1];\n            if (!this.keydown_states[last_key]) {\n                this.keydown_states[last_key] = new BehaviorSubject(null);\n                this.keydown_observers[last_key] = this.keydown_states[last_key].asObservable();\n            }\n            this.updateCombinationEndList();\n            return this.keydown_observers[last_key].subscribe((count) => {\n                if (count) {\n                    const presses: number[] = [];\n                    if (combination.length > 0) {\n                        // Check that keys are pressed\n                        for (const key of combination) {\n                            const state = this.keydown_states[key];\n                            presses.push(state ? state.getValue() || -1 : -1);\n                        }\n                        // Check that keys are pressed in the correct order\n                        for (let i = 0; i < combination.length - 1; i++) {\n                            if (presses[i] > presses[i + 1]) { return; }\n                        }\n                    }\n                    const total = presses.reduce((a, v) => a + (v > 0 ? 1 : -1), 0);\n                    if (total >= combination.length) {\n                        next();\n                    }\n                }\n            });\n        }\n        return null;\n    }\n\n    /**\n     * Map key codes with multiple versions to simple form\n     * @param code Code to transform\n     */\n    private mapKey(code: string): string {\n        if (code.indexOf('alt') >= 0 || code.indexOf('shift') >= 0 || code.indexOf('control') >= 0) {\n            return code.replace('left', '').replace('right', '');\n        }\n        return code;\n    }\n\n    /**\n     * Update the list of the last keys in combinations to allow for prevent default actions on pre-existing hotkeys\n     */\n    private updateCombinationEndList(): void {\n        const key_list = [];\n        for (const combo of this.registered_combos) {\n            this.combo_end.push(combo[combo.length - 1]);\n        }\n        this.combo_end = unique(key_list);\n    }\n\n    /**\n     * Checks if the given hotkey combination is allowed and valid\n     * @param combo Array of key codes\n     */\n    private validCombination(combo: string[]): boolean {\n        let non_meta = 0;\n        for (const key of combo) {\n            if (INVALID_STANDALONE_KEYS.indexOf(key) < 0) {\n                non_meta++;\n            }\n        }\n        return non_meta > 0;\n    }\n}\n","const general = {};\n\nconst desks = {\n    hide_reason: true,\n    can_set_host: true,\n};\n\nconst app = {\n    name: 'MapKiosk',\n    title: 'PlaceOS',\n    description: 'Map Kiosk UI',\n    short_name: 'PlaceOS',\n    logo: {\n        type: 'img',\n        src: 'assets/logo-light.svg',\n    },\n    logo_dark: {\n        type: 'img',\n        src: 'assets/logo-dark.svg',\n    },\n    general,\n    desks,\n};\n\n/**\n * ROOT SETTIGNS\n */\nexport const DEFAULT_SETTINGS = {\n    debug: true,\n    composer: {\n        domain: '',\n        route: '/kiosk',\n        protocol: '',\n        port: '',\n        use_domain: false,\n        local_login: false,\n    },\n    app,\n};\n","import { Injectable } from '@angular/core';\nimport { Title } from '@angular/platform-browser';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { format, isSameDay } from 'date-fns';\n\nimport { log, getItemWithKeys, setAppName } from './general';\nimport { DEFAULT_SETTINGS } from './settings';\nimport { HashMap } from './types';\nimport { BaseClass } from './base.class';\n\nimport { VERSION } from './version';\n\ndeclare global {\n    interface Window {\n        debug: boolean;\n        application: HashMap;\n    }\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SettingsService extends BaseClass {\n    /** Name of the application */\n    private _app_name = 'PlaceOS';\n    /** List of override settings in order of priority */\n    private _overrides = new BehaviorSubject<HashMap[]>([]);\n    /** Mapping of behaviour subjects */\n    private _subjects: HashMap<BehaviorSubject<any>> = {};\n    /** Mapping of observables */\n    private _observables: HashMap<Observable<any>> = {};\n\n    /**\n     * @hidden\n     */\n    public set overrides(value: HashMap[]) {\n        this._overrides.next(value);\n    }\n\n    /** Get observable for key */\n    public listen<T = any>(name: string): Observable<T> {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        return this._observables[name];\n    }\n\n    /** Update observable value for key */\n    public post<T>(name: string, value: T): void {\n        if (!this._observables[name]) {\n            this._subjects[name] = new BehaviorSubject<T>(null);\n            this._observables[name] = this._subjects[name].asObservable();\n        }\n        this._subjects[name].next(value);\n    }\n\n    public value<T = any>(name: string): T {\n        return !this._observables[name]\n            ? null\n            : this._subjects[name].getValue();\n    }\n\n    /** Page title */\n    public get title() {\n        return this._title.getTitle();\n    }\n    public set title(value: string) {\n        this._title.setTitle(\n            `${value} | ${this.get('app.name') || this._app_name}`\n        );\n    }\n\n    constructor(private _title: Title) {\n        super();\n        const now = new Date();\n        const time = new Date(VERSION.time);\n        const built = isSameDay(now, time)\n            ? `Today at ${format(time, 'h:mma')}`\n            : format(time, 'do MMM yyyy, h:mma');\n        log('CORE', `${VERSION.semver}`, null, 'debug', true);\n        log('APP', `${VERSION.hash} | Built: ${built}`, null, 'debug', true);\n        this.init();\n    }\n\n    /**\n     * Initialise the settings\n     */\n    public async init() {\n        if (this.get('debug')) {\n            window.debug = true;\n        }\n        if (this.get('app')?.name) {\n            this._app_name = this.get('app').name;\n        }\n        this._app_name =\n            location.pathname.slice(1).split('/').join('-') || this._app_name;\n        setAppName(this._app_name.split('-').join('_').toUpperCase());\n        log('Settings', 'Successfully loaded settings');\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.settings = this;\n        }\n    }\n\n    /** Whether settings service has initialised */\n    public get app_name() {\n        return this._app_name;\n    }\n\n    /**\n     * Get a setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public get<T = any>(key: string): T {\n        const keys = key.split('.');\n        if (keys[0] !== 'app') {\n            return getItemWithKeys(keys, DEFAULT_SETTINGS);\n        }\n        const override_settings = this._overrides.getValue();\n        for (const override of override_settings) {\n            const value = getItemWithKeys(keys.slice(1), override);\n            if (value != null) {\n                return value;\n            }\n        }\n        return getItemWithKeys(keys, DEFAULT_SETTINGS);\n    }\n}\n","// IMPORTANT: THIS FILE IS AUTO GENERATED! DO NOT MANUALLY EDIT OR CHECKIN!\n/* tslint:disable */\nexport const VERSION = {\n    \"dirty\": false,\n    \"raw\": \"6ce1541\",\n    \"hash\": \"6ce1541\",\n    \"distance\": null,\n    \"tag\": null,\n    \"semver\": null,\n    \"suffix\": \"6ce1541\",\n    \"semverString\": null,\n    \"version\": \"0.0.0\",\n    \"time\": 1628646783114\n};\n/* tslint:enable */\n","import { HashMap } from \"./types\";\n\n/**\n * Convert map into a query string\n * @param map Key value pairs to convert\n */\nexport function toQueryString(map: HashMap) {\n    let str = '';\n    if (map) {\n        for (const key in map) {\n            if (map.hasOwnProperty(key) && map[key] !== undefined && map[key] !== null) {\n                str += `${(str ? '&' : '')}${key}=${map[key]}`;\n            }\n        }\n    }\n    return str;\n}\n","import { MatSnackBar, MatSnackBarConfig } from '@angular/material/snack-bar';\n\nlet _service: MatSnackBar;\n\nexport function setNotifyOutlet(snackbar: MatSnackBar) {\n    _service = snackbar;\n}\n\n/**\n * Create notification popup\n * @param type CSS Class to add to the notification\n * @param message Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notify(\n    type: string,\n    message: string,\n    action: string = 'OK',\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    if (!_service) {\n        throw new Error(\"Snackbar service hasn't been initialised\");\n    }\n    const snackbar_ref = _service.open(message, action, {\n        panelClass: [type],\n        duration: 5000,\n        ...config,\n    });\n    if (action) {\n        on_action = on_action || (() => snackbar_ref.dismiss());\n        snackbar_ref.onAction().subscribe(() => on_action());\n    }\n}\n\n/**\n * Create success notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifySuccess(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.debug(msg);\n    notify('success', msg, action, on_action, config);\n}\n\n/**\n * Create error notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyError(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.error(msg);\n    notify('error', msg, action, on_action, config);\n}\n\n/**\n * Create warning notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyWarn(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.warn(msg);\n    notify('warn', msg, action, on_action, config);\n}\n\n/**\n * Create info notification popup\n * @param msg Message to display on the notificaiton\n * @param action Display text for the callback action\n * @param on_action Callback of action on the notification\n * @param config Configuration details to pass to the snackbar\n */\nexport function notifyInfo(\n    msg: string,\n    action?: string,\n    on_action?: () => void,\n    config: Partial<MatSnackBarConfig> = {}\n): void {\n    console.info(msg);\n    notify('info', msg, action, on_action, config);\n}\n","import { SwUpdate } from '@angular/service-worker';\n\nimport { log } from './general';\nimport { Subscription } from 'rxjs';\nimport { notifyInfo } from './notifications';\n\nlet _available: Subscription;\nlet _activated: Subscription;\nlet _timer: number;\n\nexport type Notification = (message: string, callback: () => void) => void;\n\n/**\n * Setup handler for cache change events\n * @param cache Angular Service worker service\n * @param notify Function to call on changes to the cache\n * @param interval Time interval to check the cache for changes\n */\nexport function setupCache(\n    cache: SwUpdate,\n    notify: Notification = () => null,\n    interval: number = 5 * 60 * 1000\n) {\n    if (cache.isEnabled) {\n        if (_available) _available.unsubscribe();\n        if (_activated) _activated.unsubscribe();\n        if (_timer) clearInterval(_timer);\n        _available = cache.available.subscribe((event) => {\n            const current = `current version is ${event.current.hash}`;\n            const available = `available version is ${event.available.hash}`;\n            log('CACHE', `Update available: ${current} ${available}`);\n            activateUpdate(cache);\n        });\n        _activated = cache.activated.subscribe(() => {\n            log('CACHE', `Updates activated. Reloading...`);\n            notify('Newer version of the application is available', () =>\n                location.reload(true)\n            );\n        });\n        _timer = <any>setInterval(() => {\n            log('CACHE', `Checking for updates...`);\n            cache.checkForUpdate();\n        }, interval);\n    }\n}\n\n/**\n * Update the cache and reload the page\n *\n */\nfunction activateUpdate(cache: SwUpdate) {\n    if (cache.isEnabled) {\n        log('CACHE', `Activating changes to the cache...`);\n        cache.activateUpdate().then(() => {\n            notifyInfo('Newer version of the application is available', 'Refresh', () =>\n                location.reload(true)\n            );\n        });\n    }\n}\n","import { trigger, transition, style, animate, state } from '@angular/animations';\n\nexport const ANIMATION_SHOW_ENTER_LEAVE = trigger('show', [\n    transition(':enter', [\n        style({ opacity: 0, height: 0 }),\n        animate(300, style({ opacity: 1, height: '*' }))\n    ]),\n    transition(':leave', [\n        style({ opacity: 1, height: '*' }),\n        animate(300, style({ opacity: 0, height: 0 }))\n    ])\n]);\n\nexport const ANIMATION_SHOW_CONTRACT_EXPAND = trigger('show', [\n    state('show', style({ opacity: 1, height: '*' })),\n    state('hide', style({ opacity: 0, height: 0, 'pointer-events': 'none' })),\n    transition('show <=> hide', animate('200ms ease-in'))\n]);\n","import { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { predictableRandomInt, unique } from '../../../common/src/lib/general';\n\nimport { GuestUser, User } from './user.class';\n\nlet USER_COUNT = 0;\n\ntype HashMap<T = any> = Record<string, T>;\n\nexport let USER_DOMAIN = 'place.tech';\n\nexport function setInternalUserDomain(domain: string) {\n    USER_DOMAIN = domain;\n}\n\nconst USER_EMAILS: string[] = [];\n/* istanbul ignore next */\n/**\n * Generate raw mock data for a user\n * @param id Forced ID for the mock\n * @param name Forced name for the user\n * @param external Whether user is external of the organisation\n */\nexport function generateMockUser(\n    id?: string,\n    name?: string,\n    external?: boolean\n): HashMap {\n    if (!id) {\n        id = `user-${USER_COUNT++}`;\n    }\n    if (!name) {\n        name = `User ${USER_COUNT}`;\n    }\n    if (external === undefined) {\n        external = !(predictableRandomInt(99999) % 2);\n    }\n    const organisation = external ? `Fake Co.` : USER_DOMAIN.split('.')[0];\n    let delegates: string[] = [];\n    const delegate_count = Math.min(\n        predictableRandomInt(4) + 1,\n        USER_EMAILS.length\n    );\n    for (let i = 0; i < delegate_count; i++) {\n        delegates.push(USER_EMAILS[predictableRandomInt(USER_EMAILS.length)]);\n    }\n    delegates = unique(delegates);\n    const email = `${name.split(' ').join('.').toLowerCase()}@${\n        external ? 'not-' : ''\n    }${USER_DOMAIN}`;\n    USER_EMAILS.push(email);\n    return {\n        id,\n        name,\n        first_name: name.split(' ')[0],\n        last_name: name.split(' ')[1],\n        email,\n        phone: `(02) 4567 8901`,\n        visitor: external,\n        organisation: {\n            id: organisation.split(' ').join('.').toLowerCase(),\n            name: organisation,\n        },\n        department: `Department ${predictableRandomInt(10)}`,\n        staff_code: predictableRandomInt(999_999),\n        delegates,\n        image: `${id}.png`,\n    };\n}\n\n/**\n * Generate form fields for the given user\n * @param user User to generate form for\n */\nexport function generateUserForm(user: User): FormGroup {\n    if (!user) {\n        throw Error('No user passed');\n    }\n\n    const fields: HashMap<FormControl> = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(user.phone || ''),\n        assistance_required: new FormControl(user.assistance_required || false),\n        visit_expected: new FormControl(user.visit_expected ?? true),\n    };\n\n    // Generate form group for the user\n    const form = new FormGroup(fields);\n    return form;\n}\n\nexport function generateGuestForm(\n    user: GuestUser,\n    host: string = ''\n): FormGroup {\n    const fields: HashMap<FormControl> = {\n        name: new FormControl(user.name || ''),\n        email: new FormControl(user.email || '', [\n            Validators.email,\n            Validators.required,\n        ]),\n        organisation: new FormControl(\n            user.organisation || '',\n            Validators.required\n        ),\n        phone: new FormControl(user.phone || ''),\n        host: new FormControl(host || '', [Validators.required]),\n    };\n    // Generate form group for the guest\n    const form = new FormGroup(fields);\n    return form;\n}\n","import { MapLocation } from './location.class';\nimport { USER_DOMAIN } from './user.utilities';\n\nexport interface UserComplete extends User {\n    sys_admin?: boolean;\n    support?: boolean;\n}\n\nexport type EventResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted'\n    | '';\n\nexport class User {\n    /** ID of the user */\n    public readonly id: string;\n    /** Display name of the user */\n    public readonly name: string;\n    /** Email address of the user */\n    public readonly email: string;\n    /** First name of the user */\n    public readonly first_name: string;\n    /** Last name of the user */\n    public readonly last_name: string;\n    /** Username of the user */\n    public readonly username: string;\n    /** Phone number of the user */\n    public readonly phone: string;\n    /** Organisation associated with the user */\n    public readonly organisation: string;\n    /** Details about the user */\n    public readonly notes: string;\n    /** URL to the user's photo */\n    public readonly photo: string;\n    /** Whether user attendance is required */\n    public readonly required: boolean;\n    /** Whether user is the event organiser */\n    public readonly organizer: boolean;\n    /** Whether the users is expected for an event */\n    public readonly response_status: EventResponseStatus;\n    /** Whether the users is expected for an event */\n    public visit_expected: boolean;\n    /** Whether user has been checked in */\n    public readonly checked_in: boolean;\n    /** Department that the user belongs to in the organisation */\n    public readonly groups: string[];\n    /** Extra metadata associated with the user */\n    public readonly extension_data: Record<string, any>;\n    /** Whether user is external from the organisation */\n    public readonly is_external: boolean;\n    /** Whether user needs assistance when attending an event */\n    public readonly assistance_required: boolean;\n\n    constructor(data: Partial<UserComplete> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.email = data.email || '';\n        this.first_name = data.first_name || data.name || '';\n        this.last_name = data.last_name || '';\n        this.phone = data.phone || '';\n        this.organisation = data.organisation || '';\n        this.notes = data.notes || '';\n        this.photo = data.photo || '';\n        this.username = data.username || '';\n        this.organizer = !!data.organizer;\n        this.groups = data.groups || [];\n        this.checked_in = !!data.checked_in;\n        this.required = data.required ?? true;\n        this.response_status = data.response_status || '';\n        const groups = data.groups || [];\n        if (data.sys_admin) groups.push('placeos_admin');\n        if (data.support) groups.push('placeos_support');\n        this.groups = groups;\n        this.extension_data = data.extension_data || {};\n        this.extension_data.assistance_required =\n            data.assistance_required || this.extension_data.assistance_required;\n        this.is_external = !this.email?.endsWith(`${USER_DOMAIN}`);\n        this.visit_expected = data.visit_expected ?? true;\n        this.assistance_required = !!this.extension_data?.assistance_required;\n    }\n}\n\nexport class GuestUser extends User {\n    /** Preferred beverage of the guest */\n    public readonly preferred_beverage: string;\n    /** Whether guest has accepted the terms and conditions */\n    public readonly accepted_terms_conditions: boolean;\n\n    constructor(data: Partial<GuestUser> = {}) {\n        super(data);\n        this.preferred_beverage = data.preferred_beverage || '';\n        this.accepted_terms_conditions =\n            data.accepted_terms_conditions || false;\n    }\n}\n\nexport class StaffUser extends User {\n    /** Number associated with the user's access card */\n    public readonly card_number: string;\n    /** ID of the user */\n    public readonly staff_id: string;\n    /** Whether user is logged in */\n    public readonly is_logged_in: boolean;\n    /** Location of the user */\n    public readonly location: Record<string, MapLocation>;\n\n    constructor(data: Partial<StaffUser> = {}) {\n        super(data);\n        this.card_number = data.card_number || '';\n        this.staff_id = data.staff_id || '';\n        this.location = data.location || {};\n        this.is_logged_in = !!data.is_logged_in;\n    }\n}\n","import { showUser } from '@placeos/ts-client';\nimport { BehaviorSubject } from 'rxjs';\nimport { delay, map, retry } from 'rxjs/operators';\n\nimport { StaffUser } from '../../../users/src/lib/user.class';\n\nconst _current_user = new BehaviorSubject<StaffUser>(null);\n\nexport const current_user = _current_user.asObservable();\n\ndeclare let jest;\n\nsetTimeout(() => {\n    try {\n        if (jest) return;\n    } catch {}\n    showUser('current')\n        .pipe(\n            delay(1000),\n            retry(10),\n            map((i) => new StaffUser(i))\n        )\n        .subscribe((user) => _current_user.next(user));\n}, 300);\n\n/** Get the current user details */\nexport function currentUser() {\n    return _current_user.getValue();\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from '@placeos/common';\n\n@Component({\n    selector: 'action-icon',\n    template: `\n        <button\n            mat-icon-button\n            class=\"relative flex items-center justify-center h-8 w-8\"\n            [class.success]=\"state === 'success'\"\n            [disabled]=\"loading || disabled\"\n        >\n            <app-icon root [className]=\"className\" [icon]=\"icon\">\n                {{ content }}\n                <ng-content></ng-content>\n            </app-icon>\n            <div [class]=\"'state center ' + state\" *ngIf=\"!loading && state\">\n                <app-icon>\n                    {{ state === 'success' ? 'done' : 'close' }}\n                </app-icon>\n            </div>\n            <div class=\"loader center\" *ngIf=\"loading\">\n                <mat-spinner [diameter]=\"16\"></mat-spinner>\n            </div>\n        </button>\n    `,\n    styles: [\n        `\n            .action-icon.fade > app-icon {\n                opacity: 0.35;\n            }\n\n            [center] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n\n            .success {\n                pointer-events: none;\n            }\n\n            .success app-icon[root] {\n                opacity: 0.2;\n            }\n\n            .state.success {\n                color: #388e3c;\n            }\n\n            .state.error {\n                color: #e53935;\n            }\n        `,\n    ],\n})\nexport class ActionIconComponent {\n    /** Icon to display */\n    @Input() public icon: ApplicationIcon;\n    /** Icon to display */\n    @Input() public className: string = 'material-icons';\n    /** Icon to display */\n    @Input() public content: string;\n    /** Whether action is being processed */\n    @Input() public loading: boolean;\n    /** Whether action is being processed */\n    @Input() public disabled: boolean;\n    /** State of the action */\n    @Input() public state: 'success' | 'error' | '' = '';\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\n@Pipe({\n    name: 'safe'\n})\nexport class SafePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    /**\n     * Sanitizes the string allowing it to be injected into a template\n     * @param value String to sanitize\n     * @param type Type of value to sanitise. `resource`, `url`, `script`, `style` or `html`\n     */\n    public transform(\n        value: string,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.bypassSecurityTrustResourceUrl(value);\n            case 'url':\n                return this.sanitizer.bypassSecurityTrustUrl(value);\n            case 'script':\n                return this.sanitizer.bypassSecurityTrustScript(value);\n            case 'style':\n                return this.sanitizer.bypassSecurityTrustStyle(value);\n            default:\n                return this.sanitizer.bypassSecurityTrustHtml(value);\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationIcon } from '@placeos/common';\n\n@Component({\n    selector: 'app-icon',\n    template: `\n        <div class=\"app-icon\">\n            <i *ngIf=\"!icon || icon.type !== 'img'\" [class]=\"icon?.class || className\">\n                {{ icon?.content }}\n                <ng-content></ng-content>\n            </i>\n            <img *ngIf=\"icon && icon.type === 'img'\" [src]=\"icon.src | safe: 'resource'\" />\n        </div>\n    `,\n    styles: [\n        `\n            .app-icon {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                height: 1.25em;\n                width: 1.25em;\n            }\n\n            i {\n                font-size: 1em;\n            }\n\n            img {\n                height: 1em;\n                width: 1em;\n            }\n        `,\n    ],\n})\nexport class IconComponent {\n    @Input() public className: string = 'material-icons';\n    /** Icon details */\n    @Input() public icon: ApplicationIcon;\n}\n","import { Component, Input, Output, EventEmitter } from '@angular/core';\nimport { ApplicationIcon, BaseClass } from '@placeos/common';\n\nexport interface PopoutAction extends ApplicationIcon {\n    /** ID of the action */\n    id: string;\n}\n\n@Component({\n    selector: 'a-popout-menu',\n    template: `\n        <button\n            mat-icon-button\n            class=\"small absolute text-base center shadow\"\n            *ngFor=\"let item of actions; let i = index\"\n            [style.top]=\"show ? -110 * i - 60 + '%' : ''\"\n            (click)=\"action.emit(item.id); show = false\"\n        >\n            <app-icon [icon]=\"item\"></app-icon>\n        </button>\n        <button\n            name=\"root\"\n            mat-icon-button\n            [class.show]=\"show\"\n            (click)=\"show = !show\"\n            (window:click)=\"show ? close() : ''\"\n        >\n            <app-icon>{{ show ? 'add' : 'more_vert' }}</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n            }\n\n            app-icon {\n                transition: transform 200ms;\n            }\n\n            button {\n                background-color: #fff;\n                color: rgba(#000, 0.85);\n                font-size: 1.25rem;\n                height: 2.5em;\n                width: 2.5em;\n            }\n\n            button.show app-icon {\n                transform: rotate(45deg);\n            }\n\n            button.small {\n                transition: top 200ms, left 200ms;\n            }\n        `,\n    ],\n})\nexport class PopoutMenuComponent extends BaseClass {\n    /** List of available actions */\n    @Input() public actions: PopoutAction[] = [];\n    /** Emitter for user actions */\n    @Output() public action = new EventEmitter<string>();\n    /** Whether actions should show */\n    public show: boolean;\n\n    public close() {\n        this.timeout('close', () => (this.show = false));\n    }\n}\n","import { Pipe, PipeTransform } from '@angular/core';\nimport { DomSanitizer, SafeHtml, SafeResourceUrl, SafeScript, SafeStyle } from '@angular/platform-browser';\n\nenum SecurityContext {\n    NONE = 0,\n    HTML = 1,\n    STYLE = 2,\n    SCRIPT = 3,\n    URL = 4,\n    RESOURCE_URL = 5\n}\n\n@Pipe({\n    name: 'sanitize'\n})\nexport class SanitizePipe implements PipeTransform {\n    constructor(private sanitizer: DomSanitizer) {}\n\n    transform(\n        value: any,\n        type: 'resource' | 'url' | 'script' | 'style' | 'html' = 'html'\n    ): SafeHtml | SafeResourceUrl | SafeScript | SafeStyle {\n        switch (type) {\n            case 'resource':\n                return this.sanitizer.sanitize(SecurityContext.RESOURCE_URL, value);\n            case 'url':\n                return this.sanitizer.sanitize(SecurityContext.URL, value);\n            case 'script':\n                return this.sanitizer.sanitize(SecurityContext.SCRIPT, value);\n            case 'style':\n                return this.sanitizer.sanitize(SecurityContext.STYLE, value);\n            default:\n                return this.sanitizer.sanitize(SecurityContext.HTML, value);\n        }\n    }\n}\n","import {\n    AfterViewInit,\n    Component,\n    ElementRef,\n    HostListener,\n    InjectionToken,\n    Injector,\n    Input,\n    OnChanges,\n    OnDestroy,\n    OnInit,\n    QueryList,\n    SimpleChanges,\n    TemplateRef,\n    Type,\n    ViewChild,\n    ViewChildren,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nimport {\n    applyGlobalStyles,\n    createViewer,\n    getViewer,\n    Point,\n    Viewer,\n    removeViewer,\n    updateViewer,\n    ViewAction,\n    ViewerFeature,\n    ViewerLabel,\n    ViewerStyles,\n    listenToViewerChanges,\n} from '@placeos/svg-viewer';\nimport { BehaviorSubject } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nexport const MAP_FEATURE_DATA = new InjectionToken('Data for Map Features');\n\n@Component({\n    selector: `i-map,interactive-map`,\n    template: `\n        <div #outlet tabindex=\"0\" role=\"map\" class=\"absolute inset-0\"></div>\n        <mat-spinner\n            *ngIf=\"!viewer || loading\"\n            class=\"absolute\"\n            [diameter]=\"48\"\n        ></mat-spinner>\n        <div hidden *ngIf=\"injectors?.length\">\n            <ng-container\n                *ngFor=\"\n                    let element of features;\n                    let i = index;\n                    trackBy: element?.location\n                \"\n            >\n                <div *ngIf=\"element\">\n                    <div\n                        #feature\n                        class=\"pointer-events-none\"\n                        [attr.el-id]=\"element.location\"\n                        [attr.view-id]=\"viewer\"\n                        [ngSwitch]=\"type(element.content)\"\n                    >\n                        <ng-container *ngSwitchCase=\"'component'\">\n                            <ng-container\n                                *ngComponentOutlet=\"\n                                    element.content;\n                                    injector: injectors[i]\n                                \"\n                            ></ng-container>\n                        </ng-container>\n                        <ng-container *ngSwitchCase=\"'html'\">\n                            <div [innerHTML]=\"element.content | sanitize\"></div>\n                        </ng-container>\n                        <ng-container *ngSwitchDefault>\n                            <ng-container\n                                *ngTemplateOutlet=\"\n                                    element.content;\n                                    context: element.data\n                                \"\n                            ></ng-container>\n                        </ng-container>\n                    </div>\n                </div>\n            </ng-container>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                height: 100%;\n                width: 100%;\n            }\n\n            mat-spinner {\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n            }\n        `,\n    ],\n})\nexport class InteractiveMapComponent\n    extends BaseClass\n    implements AfterViewInit, OnChanges, OnInit, OnDestroy {\n    /** URL to the SVG file */\n    @Input() public src: string;\n    /** Custom CSS styles to apply to the SVG file */\n    @Input() public styles: ViewerStyles;\n    /** Zoom level to apply to the SVG */\n    @Input() public zoom = 1;\n    /** Zoom level to apply to the SVG */\n    @Input() public center: Point = { x: 0.5, y: 0.5 };\n    /** List of features to renderer over the SVG */\n    @Input() public features: ViewerFeature[];\n    /** List of labels to renderer over the SVG */\n    @Input() public labels: ViewerLabel[];\n    /** List of available user actions for the SVG */\n    @Input() public actions: ViewAction[];\n\n    @Input() public options: any;\n\n    @Input() public focus: string;\n\n    public loading: boolean;\n\n    public injectors: Injector[] = [];\n\n    /** ID of the active SVG Viewer */\n    public viewer: string;\n    /** Observable for changes on the SVG viewer */\n    private _on_changes: BehaviorSubject<Viewer> = new BehaviorSubject(null);\n\n    @ViewChild('outlet') private _outlet_el: ElementRef<HTMLDivElement>;\n    @ViewChildren('feature') private _feature_list: QueryList<\n        ElementRef<HTMLDivElement>\n    >;\n\n    @HostListener('window:resize') public onResize() {\n        this.zoom = 1;\n        this.center = { x: 0.5, y: 0.5 };\n        this.updateDisplay();\n    }\n\n    public type(\n        content: string | TemplateRef<any> | Type<any>\n    ): 'html' | 'template' | 'component' {\n        return typeof content === 'string'\n            ? 'html'\n            : content instanceof TemplateRef\n            ? 'template'\n            : 'component';\n    }\n\n    public get feature_list() {\n        return (this.features || [])\n            .map((f, idx) => ({\n                ...f,\n                content: this._feature_list.toArray()[idx]?.nativeElement,\n            }))\n            .filter((f) => f.content);\n    }\n\n    constructor(private _injector: Injector) {\n        super();\n    }\n\n    public ngOnInit() {\n        applyGlobalStyles();\n    }\n\n    public ngOnDestroy(): void {\n        if (this.viewer) {\n            removeViewer(this.viewer);\n        }\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        if (changes.src && this.src) {\n            this.createView();\n        }\n        if (changes.features) {\n            this.injectors = (this.features || []).map((f: any) =>\n                Injector.create({\n                    providers: [\n                        {\n                            provide: MAP_FEATURE_DATA,\n                            useValue: {\n                                ...f.data,\n                                zoom: this._on_changes.pipe(map((_) => _.zoom)),\n                                position: this._on_changes.pipe(\n                                    map((_) => _.center)\n                                ),\n                            },\n                        },\n                    ],\n                    parent: this._injector,\n                })\n            );\n        }\n        if (this.viewer) {\n            if (changes.focus && this.focus) {\n                this.focusOn(this.focus);\n            } else if (changes.zoom || changes.center) {\n                this.updateDisplay();\n            }\n            if (\n                changes.styles ||\n                changes.features ||\n                changes.labels ||\n                changes.actions\n            ) {\n                this.timeout('update_view', () => this.updateView(), 100);\n            }\n        }\n    }\n\n    public ngAfterViewInit() {\n        this.createView();\n    }\n\n    /** Update overlays, styles and actions of viewer */\n    private updateView() {\n        try {\n            if (!getViewer(this.viewer) || this.loading) {\n                return this.timeout('update_view', () => this.updateView());\n            }\n            updateViewer(this.viewer, {\n                styles: this.styles,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n                options: this.options,\n            });\n        } catch (e) {}\n    }\n\n    /** Update zoom and center position of viewer */\n    private updateDisplay() {\n        try {\n            updateViewer(this.viewer, {\n                zoom: this.zoom,\n                desired_zoom: this.zoom,\n                center: this.center,\n                desired_center: this.center,\n                options: this.options,\n            });\n        } catch (e) {}\n    }\n\n    private async createView() {\n        if (this.src && this._outlet_el?.nativeElement && !this.loading) {\n            this.loading = true;\n            if (this.viewer) {\n                updateViewer(this.viewer, {\n                    styles: this.styles,\n                    features: [],\n                    labels: this.labels,\n                    actions: this.actions,\n                    options: this.options,\n                });\n                removeViewer(this.viewer);\n            }\n            this.viewer = await createViewer({\n                element: this._outlet_el?.nativeElement,\n                url: this.src,\n                styles: this.styles,\n                zoom: this.zoom,\n                desired_zoom: this.zoom,\n                center: this.center,\n                features: this.feature_list,\n                labels: this.labels,\n                actions: this.actions,\n                options: this.options,\n            });\n            this.loading = false;\n            this.subscription(\n                'view_changes',\n                listenToViewerChanges(this.viewer)?.subscribe((v) =>\n                    this._on_changes.next(v)\n                )\n            );\n        } else if (\n            (this.src && !this._outlet_el?.nativeElement) ||\n            this.loading\n        ) {\n            this.timeout('create_view', () => this.createView());\n        }\n    }\n\n    private focusOn(id: string) {\n        if (!id || !this.viewer) return;\n        const viewer: Viewer = getViewer(this.viewer);\n        if (!viewer) return;\n        const rect = viewer.mappings[id];\n        if (!rect) return;\n        this.center = {\n            x: 1 - (rect.x + rect.w / 2),\n            y: 1 - (rect.y + rect.h / 2),\n        };\n        this.updateDisplay();\n    }\n}\n","import { Component, Inject, OnInit } from '@angular/core';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapPinData {\n    message: string;\n    fill: string;\n    stroke: string;\n    action?: () => void;\n}\n\n@Component({\n    selector: '[map-pin]',\n    template: `\n        <div\n            name=\"message\"\n            *ngIf=\"message && show_message\"\n            class=\"p-2 m-2 rounded bg-white text-gray-700 shadow\"\n        >\n            {{ message }}\n        </div>\n        <svg\n            *ngIf=\"show\"\n            name=\"pin\"\n            viewBox=\"0 0 380 560\"\n            [class.action]=\"action\"\n            (click)=\"action()\"\n        >\n            <g>\n                <path\n                    [style.fill]=\"fill\"\n                    [style.stroke]=\"stroke\"\n                    stroke-width=\"25\"\n                    d=\"M182.9,551.7c0,0.1,0.2,0.3,0.2,0.3S358.3,283,358.3,194.6c0-130.1-88.8-186.7-175.4-186.9\n            C96.3,7.9,7.5,64.5,7.5,194.6c0,88.4,175.3,357.4,175.3,357.4S182.9,551.7,182.9,551.7z M122.2,187.2c0-33.6,27.2-60.8,60.8-60.8\n            c33.6,0,60.8,27.2,60.8,60.8S216.5,248,182.9,248C149.4,248,122.2,220.8,122.2,187.2z\"\n                />\n            </g>\n        </svg>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                bottom: 0;\n                left: 50%;\n                width: 24rem;\n                display: flex;\n                flex-direction: column;\n                align-items: center;\n                transform: translateX(-50%);\n                z-index: -1;\n            }\n\n            div {\n                animation: fade-in-top 1s;\n            }\n\n            .action {\n                pointer-events: auto;\n            }\n\n            svg {\n                width: 2rem;\n                animation: fade-in-top 1s;\n            }\n\n            @keyframes fade-in-top {\n                0% {\n                    opacity: 0;\n                    transform: translateY(-100%);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translateY(0%);\n                }\n            }\n        `,\n    ],\n})\nexport class MapPinComponent implements OnInit {\n    /** Message to display above the pin */\n    public readonly message = this._details.message;\n    /** Fill colour for the pin SVG */\n    public readonly fill = this._details.fill || '#e53935';\n    /** Stroke colour for the pin SVG */\n    public readonly stroke = this._details.stroke || '#fff';\n    /** Action to perform when clicking pin */\n    public readonly action = this._details.action || null;\n\n    public show: boolean;\n    public show_message: boolean;\n\n    constructor(@Inject(MAP_FEATURE_DATA) private _details: MapPinData) {}\n\n    public ngOnInit() {\n        setTimeout(() => (this.show = true), 300);\n        setTimeout(() => (this.show_message = true), 1000);\n    }\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\nimport { formatDistanceToNow } from 'date-fns';\nimport { Observable } from 'rxjs';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapRadiusData {\n    message: string;\n    radius: number;\n    fill: string;\n    stroke: string;\n    last_seen?: number;\n    zoom: Observable<number>;\n}\n\n@Component({\n    selector: '[map-radius]',\n    template: `\n        <ng-container *ngIf=\"show && radius\" (window:resize)=\"updateRadius()\">\n            <div\n                class=\"center border-4 rounded-full border-dashed\"\n                [style.border-color]=\"stroke\"\n                [style.background-color]=\"fill + '40'\"\n                [style.width]=\"radius * zoom + 'px'\"\n                [style.height]=\"radius * zoom + 'px'\"\n            ></div>\n            <div\n                *ngIf=\"message && show_message\"\n                name=\"message\"\n                [style.top]=\"'-' + (radius / 2) * zoom + 'px'\"\n                class=\"p-2 m-2 rounded bg-white text-gray-700 shadow absolute top-0 whitespace-no-wrap flex flex-col\"\n            >\n                {{ message }}\n                <span *ngIf=\"last_seen\" class=\"text-xs\">\n                    Last updated: {{ last_seen_at }}\n                </span>\n            </div>\n        </ng-container>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                height: 100%;\n                width: 100%;\n            }\n\n            [name='message'] {\n                transform: translate(-50%, -120%);\n            }\n\n            div {\n                animation: fade-in-top 1s;\n            }\n\n            @keyframes fade-in-top {\n                0% {\n                    opacity: 0;\n                    transform: translate(-50%, -220%);\n                }\n                100% {\n                    opacity: 1;\n                    transform: translate(-50%, -120%);\n                }\n            }\n        `,\n    ],\n})\nexport class MapRadiusComponent implements OnInit {\n    public zoom = 1;\n    /** Size of the area marked by this component */\n    public radius = this._details.radius || 10;\n    /** Message to display above the pin */\n    public readonly message = this._details.message;\n    /** Fill colour for the pin SVG */\n    public readonly fill = this._details.fill || '#e53935';\n    /** Stroke colour for the pin SVG */\n    public readonly stroke = this._details.stroke || '#e53935';\n\n    public readonly last_seen: number = this._details.last_seen || 0;\n\n    public get last_seen_at() {\n        return formatDistanceToNow(this.last_seen * 1000) + ' ago';\n    }\n\n    public show: boolean;\n    public show_message: boolean;\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: MapRadiusData,\n        private _el: ElementRef<HTMLElement>\n    ) {\n        this._details.zoom.subscribe((v) =>\n            Math.max(0.5, (this.zoom = v || 1))\n        );\n    }\n\n    public ngOnInit() {\n        setTimeout(() => (this.show = true), 300);\n        setTimeout(() => (this.show_message = true), 1000);\n    }\n\n    public ngAfterViewInit() {\n        this.updateRadius();\n    }\n\n    public updateRadius() {\n        const box = this._el.nativeElement.getBoundingClientRect();\n        if (!box.width) return setTimeout(() => this.updateRadius(), 300);\n        this.radius = Math.max(\n            64,\n            (this._details.radius || 10) * (box.width || 10)\n        );\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { ApplicationLink } from '@placeos/common';\n\n@Component({\n    selector: 'status-overlay',\n    template: `\n        <div\n            status-overlay\n            class=\"fixed inset-0 flex flex-col bg-secondary items-center justify-center z-50 text-white\"\n        >\n            <ng-container *ngIf=\"!loading; else load_state\">\n                <div\n                    class=\"text-4xl rounded-full bg-white mb-4\"\n                    [class.text-success]=\"!error\"\n                    [class.text-error]=\"error\"\n                >\n                    <app-icon>{{ error ? 'close' : 'done' }}</app-icon>\n                </div>\n                <div class=\"text-center text-lg mb-4\">\n                    <ng-container *ngIf=\"!error; else error_msg\">\n                        <ng-content></ng-content>\n                    </ng-container>\n                </div>\n                <div class=\"flex items-center space-x-2\">\n                    <a\n                        button\n                        mat-button\n                        class=\"w-32\"\n                        *ngFor=\"let link of links\"\n                        [routerLink]=\"[link.route]\"\n                    >\n                        {{ link.name }}\n                    </a>\n                </div>\n            </ng-container>\n        </div>\n        <ng-template #error_msg\n            ><p error>{{ error }}</p></ng-template\n        >\n        <ng-template #load_state>\n            <mat-spinner [diameter]=\"32\" class=\"mb-4\"></mat-spinner>\n            <p loading class=\"text-center text-lg\">{{ loading }}</p>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class StatusOverlayComponent {\n    /** Whether overlay is loading */\n    @Input() public loading: string = '';\n    /** Details about any errors that have occurred */\n    @Input() public error: string = '';\n    /** Links to display on success */\n    @Input() public links: ApplicationLink[] = [];\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Injectable,\n    Injector,\n    Input,\n    OnChanges,\n    OnDestroy,\n    SimpleChanges,\n    TemplateRef,\n    Type,\n    ViewChild,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\n@Injectable()\nexport class CustomTooltipData<T = any> {\n    data: T;\n    close: () => void;\n    constructor(d) {\n        this.data = d.data;\n        this.close = d.close || (() => null);\n    }\n}\n\n@Component({\n    selector: '[customTooltip]',\n    template: `\n        <ng-content></ng-content>\n\n        <ng-template cdk-portal>\n            <div custom-tooltip class=\"relative\" [ngSwitch]=\"type\">\n                <ng-container *ngSwitchCase=\"'component'\">\n                    <ng-container\n                        *ngComponentOutlet=\"content; injector: injector\"\n                    ></ng-container>\n                </ng-container>\n                <ng-container *ngSwitchCase=\"'html'\">\n                    <div [innerHTML]=\"content | sanitize\"></div>\n                </ng-container>\n                <ng-container *ngSwitchDefault>\n                    <ng-container\n                        *ngTemplateOutlet=\"content; context: data\"\n                    ></ng-container>\n                </ng-container>\n            </div>\n        </ng-template>\n    `,\n})\nexport class CustomTooltipComponent<T = any>\n    extends BaseClass\n    implements OnChanges, OnDestroy {\n    /** Horizontal position of the rendered overlay */\n    @Input('xPosition') public x_pos: 'start' | 'center' | 'end';\n    /** Vertical position of the rendered overlay */\n    @Input('yPosition') public y_pos: 'top' | 'center' | 'bottom';\n    /** Content to render in the tooltip */\n    @Input() public content: TemplateRef<any> | Type<any> | string;\n    /** Data associated with the tooltip content */\n    @Input() public data: T;\n    /** Whether tooltip has a backdrop */\n    @Input() public backdrop = true;\n    /** Whether tooltip has a backdrop */\n    @Input() public hover = false;\n    /** Type of content to render */\n    public type: 'template' | 'component' | 'html' = 'template';\n\n    public injector: Injector;\n\n    private _overlay_ref: OverlayRef = null;\n\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n\n    @HostListener('click') public readonly onClick = () => this.open();\n    @HostListener('mouseenter') public readonly onEnter = () =>\n        this.hover ? this.open() : '';\n    @HostListener('mouseleave') public readonly onLeave = () =>\n        this.hover ? this.close() : '';\n\n    constructor(\n        private _element: ElementRef<HTMLElement>,\n        private _overlay: Overlay,\n        private _injector: Injector\n    ) {\n        super();\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        this._updateInjector();\n        if (\n            this._overlay_ref &&\n            (changes.x_pos || changes.y_pos || changes.content)\n        ) {\n            this.open();\n        }\n    }\n\n    public ngOnDestroy() {\n        super.ngOnDestroy();\n        this.close();\n    }\n\n    public open() {\n        this._updateType();\n        if (this._overlay_ref) this.close();\n        if (!this._portal) return;\n        this._overlay_ref = this._overlay.create({\n            hasBackdrop: !!this.backdrop,\n            positionStrategy: this._overlay\n                .position()\n                .flexibleConnectedTo(this._element)\n                .withPositions([\n                    {\n                        originX: this.x_pos || 'end',\n                        originY:\n                            (this.y_pos === 'top'\n                                ? 'bottom'\n                                : this.y_pos == 'bottom'\n                                ? 'top'\n                                : this.y_pos) || 'bottom',\n                        overlayX: this.x_pos || 'end',\n                        overlayY: this.y_pos || 'top',\n                    },\n                ]),\n        });\n        this._overlay_ref.attach(this._portal);\n        if (this.backdrop) {\n            this.subscription(\n                'backdrop',\n                this._overlay_ref.backdropClick().subscribe(() => this.close())\n            );\n        }\n    }\n\n    public close() {\n        if (this._overlay_ref) {\n            this._overlay_ref.dispose();\n            this._overlay_ref = null;\n        }\n    }\n\n    private _updateType() {\n        this.type =\n            typeof this.content === 'string'\n                ? 'html'\n                : this.content instanceof TemplateRef\n                ? 'template'\n                : 'component';\n    }\n\n    private _updateInjector() {\n        this.injector = Injector.create({\n            providers: [\n                {\n                    provide: CustomTooltipData,\n                    useValue: { data: this.data, close: () => this.close() },\n                },\n            ],\n            parent: this._injector,\n        });\n    }\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Input,\n    OnDestroy,\n    ViewChild,\n} from '@angular/core';\nimport { BaseClass } from '@placeos/common';\n\nconst DEFAULT_KEYS = [\n    '0123456789'.split(''),\n    'qwertyuiop'.split(''),\n    'asdfghjkl'.split(''),\n    'zxcvbnm'.split(''),\n    ['{caps}', '{space}', '{backspace}'],\n];\n\n@Component({\n    selector: 'input[keyboard],textarea[keyboard]',\n    template: `\n        <ng-content></ng-content>\n        <ng-template cdk-portal>\n            <div\n                keyboard\n                class=\"w-screen flex flex-col space-y-4 bg-gray-200 p-2 border-t border-gray-400\"\n            >\n                <div\n                    row\n                    class=\"flex items-center justify-center space-x-2\"\n                    *ngFor=\"let row of keyset\"\n                >\n                    <ng-container *ngFor=\"let key of row\">\n                        <div\n                            [attr.key]=\"key\"\n                            tabindex=\"0\"\n                            class=\"rounded-xl p-2 border border-gray-300 relative cursor-pointer bg-white\"\n                            [class.special]=\"key[0] === '{' && key.length > 1\"\n                            [class.space]=\"key === '{space}'\"\n                            (focus)=\"focusInput()\"\n                            (click)=\"handleKeyPress(key)\"\n                        >\n                            {{\n                                key === '{space}'\n                                    ? 'Space'\n                                    : key === '{caps}'\n                                    ? 'Caps Lock'\n                                    : key === '{backspace}'\n                                    ? 'Backspace'\n                                    : key\n                            }}\n                            <div\n                                *ngIf=\"key === '{caps}'\"\n                                dot\n                                class=\"absolute top-2 right-2 h-2 w-2 rounded-full bg-gray-300\"\n                                [class.bg-success]=\"state === 'shift'\"\n                            ></div>\n                        </div>\n                    </ng-container>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            [key] {\n                height: 3.5rem;\n                width: 4rem;\n                transition: box-shadow 200ms, top 200ms;\n                box-shadow: 0 4px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key].special {\n                width: 10rem;\n            }\n\n            [key].space {\n                flex: 1;\n                min-width: 10rem;\n                max-width: 25rem;\n            }\n\n            [key]:hover {\n                top: 2px;\n                box-shadow: 0 2px 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n\n            [key]:active {\n                top: 4px;\n                box-shadow: 0 0 0 0.04px rgba(0, 0, 0, 0.1);\n            }\n        `,\n    ],\n})\nexport class VirtualKeyboardComponent extends BaseClass implements OnDestroy {\n    /** Whether virtual keyboard should activate */\n    public static enabled: boolean;\n    /** List of rows of keys to display on the keyboard */\n    @Input() public keyset = DEFAULT_KEYS;\n    /** Current state of the displayed keyset */\n    public state: 'normal' | 'caps' | 'shift' = 'normal';\n    /** References to the overlay containing the keyboard */\n    private _overlay_ref: OverlayRef = null;\n    /** Portal with the keyboard contents */\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n\n    @HostListener('focus') public onFocus = () => {\n        if (!VirtualKeyboardComponent.enabled) return;\n        this.open();\n        this.clearTimeout('blur');\n    };\n    @HostListener('blur') public onBlur = () =>\n        this.timeout('blur', () => this.close());\n\n    constructor(\n        private _element: ElementRef<HTMLInputElement | HTMLTextAreaElement>,\n        private _overlay: Overlay\n    ) {\n        super();\n    }\n\n    public ngOnDestroy() {\n        super.ngOnDestroy();\n        this.close();\n    }\n\n    public focusInput() {\n        this._element?.nativeElement?.blur();\n        this._element?.nativeElement?.focus();\n    }\n\n    public open() {\n        if (this._overlay_ref) return;\n        if (!this._portal) return;\n        this._overlay_ref = this._overlay.create({\n            positionStrategy: this._overlay\n                .position()\n                .global()\n                .bottom()\n                .centerHorizontally(),\n        });\n        this._overlay_ref.attach(this._portal);\n    }\n\n    public close() {\n        if (this._overlay_ref) {\n            this._overlay_ref.dispose();\n            this._overlay_ref = null;\n        }\n    }\n\n    public handleKeyPress(key: string) {\n        let cursor_pos = this._element.nativeElement.selectionStart;\n        const str = this._element.nativeElement.value || '';\n        switch (key.toLowerCase()) {\n            case '{caps}':\n            case '{shift}':\n                this.state = 'shift';\n                break;\n            case '{backspace}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos - 1\n                )}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos = Math.max(0, cursor_pos - 1);\n                break;\n            case '{space}':\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${' '}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n                break;\n            default:\n                if (this.state === 'shift') this.state = 'normal';\n                this._element.nativeElement.value = `${str.substr(\n                    0,\n                    cursor_pos\n                )}${key}${str.substr(cursor_pos, str.length)}`;\n                cursor_pos += 1;\n        }\n        this._element.nativeElement.dispatchEvent(new InputEvent('input'));\n        this.updateKeyState();\n        this.timeout(\n            'focus',\n            () => {\n                this.focusInput();\n                this._element.nativeElement.selectionStart = cursor_pos;\n                this._element.nativeElement.selectionEnd = cursor_pos;\n            },\n            50\n        );\n    }\n\n    public updateKeyState() {\n        this.keyset = this.keyset.map((_) =>\n            _.map((k) =>\n                k.length > 1\n                    ? k\n                    : k[\n                          this.state !== 'normal'\n                              ? 'toUpperCase'\n                              : 'toLowerCase'\n                      ]()\n            )\n        );\n    }\n}\n","import { HashMap, Identity } from '@placeos/common';\n\n/** Building Level data */\nexport class BuildingLevel {\n    /** ID of the building level zone */\n    public readonly id: string;\n    /** ID of the building zone associated with the level */\n    public readonly parent_id: string;\n    /** Name of the level */\n    public readonly name: string;\n    /** Display name */\n    public readonly display_name: string;\n    /** Capacity for the level */\n    public readonly capacity: number;\n    /** Number or letter representing the level */\n    public readonly number: string;\n    /** URL of the map associated with the level */\n    public readonly map_id: string;\n    /** Settings overrides associated with the level */\n    public readonly settings: HashMap = {};\n    /** List of points of interest for the level */\n    public readonly locations: readonly Identity[];\n\n    constructor(_data: Partial<BuildingLevel> = {}) {\n        this.id = _data.id || '';\n        this.parent_id = _data.parent_id || '';\n        this.name = _data.name || '';\n        this.display_name = _data.display_name || '';\n        this.map_id = _data.map_id || '';\n        this.capacity = _data.capacity || 0;\n        this.locations = _data.locations || [];\n        const parts = this.display_name.split(' ');\n        this.number =\n            (parts.length >= 2\n                ? parts[parts.length - 1]\n                : this.display_name[0]\n            )?.toUpperCase() || '';\n    }\n}\n","import { HashMap, Identity, RoomConfiguration } from '@placeos/common';\nimport { BookingRulesmap } from 'libs/events/src/lib/event.interfaces';\n\nimport { BuildingLevel } from './level.class';\n\nexport interface IBuildingRoleUser {\n    name: string;\n    email: string;\n    phone: string;\n}\n\nexport interface LockerMap {\n    [zone: string]: {\n        [area: string]: {\n            [type: string]: (string | boolean)[][];\n        };\n    };\n}\n\nexport interface ICoordinates {\n    longitude: number;\n    latitude: number;\n}\n\nexport interface LevelFeature {\n    id: string;\n    level_id: string;\n    name: string;\n}\n\nexport interface BookingRuleDetails {\n    /** List of booking rules details for the building */\n    readonly rules: readonly string[];\n    /** Custom booking rules for the map */\n    readonly map_rules?: readonly string[];\n    /** Contact email address for the building */\n    readonly contact?: string;\n    /** Information string to display before the rule listings */\n    readonly info?: string;\n}\n\nexport interface BuildingComplete extends Building {\n    settings: HashMap;\n    locker_structure: HashMap;\n    roles: HashMap;\n    zone: string;\n    location: string;\n    neighbourhoods: HashMap;\n}\n\nexport class Building {\n    /** PlaceOS zone id of the building */\n    public readonly id: string;\n    /** Name of the building zone */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Engine Zone ID for the building */\n    public readonly zone_id: string;\n    /** Organisation Code for the building */\n    public readonly code: string;\n    /** Geographical address of the building */\n    public readonly address: string;\n    /** IANA timezone string for building */\n    public readonly timezone: string;\n    /** ID of space that temporarily holds new meetings */\n    public readonly holding_bay: string;\n    /** ID of the space for assigning new visitor bookings to */\n    public readonly visitor_space: string;\n    /** Details about the booking rules for the building */\n    public readonly booking_details: BookingRuleDetails;\n    /** Details about the booking rules for the building */\n    public readonly booking_rules: BookingRulesmap;\n    /** Number of hour before a booking catering is restricted */\n    public readonly catering_restricted_from: number;\n    /** Currency code for the country assoicated with the building */\n    public readonly currency: string;\n    /** List of available extras for the building */\n    public readonly extras: readonly Identity[];\n    /** List of available extra equipment for loan at the building */\n    public readonly loan_items: readonly Identity[];\n    /** List of available levels for the building */\n    public readonly levels: readonly BuildingLevel[];\n    /** List of zones associated with the building */\n    public readonly zones: readonly string[];\n    /** Searchable map features */\n    public readonly searchables: readonly LevelFeature[];\n    /** List of available room configurations for the building */\n    public readonly room_configurations: readonly RoomConfiguration[];\n    /** Start and end hours catering can be delivered */\n    public readonly catering_hours: { start: number; end: number };\n    /** PlaceOS bindings for applications */\n    public readonly bindings: HashMap<string>;\n\n    public readonly orientations: HashMap<number>;\n    public readonly attributes: readonly Identity[];\n    /** Map of roles and list of the associated users */\n    private _roles: HashMap<IBuildingRoleUser[]>;\n    /** Map of the locker ID arrays */\n    private _lockers: LockerMap;\n    /** Map of important system ids for the building */\n    private _systems: HashMap<string>;\n    /** Map of important phone numbers for the building */\n    private _phone_numbers: HashMap<string>;\n    /** Globe coordiates for the build */\n    private _location: ICoordinates;\n\n    constructor(raw_data: Partial<BuildingComplete> = {}) {\n        this.id = raw_data.id || '';\n        this.name = raw_data.name || '';\n        const settings = raw_data.settings || {};\n        this.display_name = raw_data.display_name;\n        const disc_info = settings.discovery_info || settings;\n        this.zone_id = raw_data.zone_id || raw_data.zone;\n        this.extras = (raw_data.extras || disc_info.extras || []).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.loan_items = (\n            raw_data.loan_items ||\n            disc_info.loan_items ||\n            []\n        ).map((i) => ({\n            id: i.extra_id || i.id,\n            name: i.extra_name || i.name,\n        }));\n        this.levels = (raw_data.levels || disc_info.levels || []).map(\n            (i) => new BuildingLevel({ ...i, building_id: this.id })\n        );\n        this._roles = raw_data.roles || disc_info.roles || {};\n        this._lockers =\n            raw_data.lockers ||\n            raw_data.locker_structure ||\n            disc_info.locker_structure ||\n            {};\n        this._systems = raw_data.systems || disc_info.systems || {};\n        this._phone_numbers =\n            raw_data.phone_numbers || disc_info.phone_numbers || {};\n        this._location = raw_data.location ||\n            disc_info.location || { longitude: null, latitude: null };\n        this.room_configurations =\n            raw_data.room_configurations || disc_info.room_configurations || [];\n        this.attributes = raw_data.attributes || disc_info.attributes || [];\n        const searchables = [];\n        if (raw_data.neighbourhoods) {\n            for (const lvl in raw_data.neighbourhoods) {\n                if (lvl in raw_data.neighbourhoods) {\n                    const lvl_features = raw_data.neighbourhoods[lvl] || {};\n                    for (const feature in lvl_features) {\n                        if (feature in lvl_features) {\n                            searchables.push({\n                                id: lvl_features[feature],\n                                name: feature,\n                                level_id: lvl,\n                            });\n                        }\n                    }\n                }\n            }\n        }\n        this.bindings = raw_data.bindings || {};\n        this.searchables = searchables;\n        this.timezone =\n            raw_data.timezone || disc_info.timezone || settings.timezone || '';\n        this.catering_hours = raw_data.catering_hours ||\n            disc_info.catering_hours ||\n            settings.catering_hours || { start: 7, end: 20 };\n        this.visitor_space =\n            raw_data.visitor_space ||\n            disc_info.visitor_space ||\n            settings.visitor_space ||\n            '';\n        this.holding_bay =\n            raw_data.holding_bay ||\n            disc_info.holding_bay ||\n            settings.holding_bay ||\n            '';\n        this.code = raw_data.code || disc_info.code || settings.code || '';\n        this.address =\n            raw_data.address || disc_info.address || settings.address || '';\n        this.orientations =\n            raw_data.orientations ||\n            disc_info.orientations ||\n            settings.orientations ||\n            {};\n        this.booking_details =\n            raw_data.booking_details ||\n            disc_info.booking_details ||\n            settings.booking_details ||\n            null;\n        this.booking_rules =\n            raw_data.booking_rules ||\n            disc_info.booking_rules ||\n            settings.booking_rules ||\n            {};\n        this.catering_restricted_from =\n            raw_data.catering_restricted_from ||\n            disc_info.catering_restricted_from ||\n            settings.catering_restricted_from ||\n            -1440;\n        this.currency =\n            raw_data.currency ||\n            disc_info.currency ||\n            settings.currency ||\n            'USD';\n    }\n\n    /**\n     * Get list of users with the associated role\n     * @param name Role to find users for\n     */\n    public role(name: string): IBuildingRoleUser[] {\n        return [...(this._roles[name] || [])];\n    }\n    /**\n     * Get list of the names of available user role lists\n     */\n    public get role_names(): string[] {\n        return Object.keys(this._roles).filter((i) => i in this._roles);\n    }\n    /** Map of the locker ID arrays */\n    public get lockers(): LockerMap {\n        return { ...(this._lockers || {}) };\n    }\n    /** Map of important system ids for the building */\n    public get systems(): HashMap<string> {\n        return { ...(this._systems || {}) };\n    }\n    /** Map of important phone numbers for the building */\n    public get phone_numbers(): HashMap<string> {\n        return { ...(this._phone_numbers || {}) };\n    }\n\n    /**\n     * Get search map feature for the given level ID\n     * @param level_id ID of level to grab features for\n     */\n    public featuresForLevel(level_id: string): LevelFeature[] {\n        return (this.searchables || []).filter((i) => i.level_id === level_id);\n    }\n}\n","import { getItemWithKeys, HashMap } from '@placeos/common';\n\nexport interface OrganisationComplete extends Organisation {\n    settings?: HashMap;\n}\n\nexport class Organisation {\n    /** PlaceOS zone id of the building */\n    public readonly id: string;\n    /** Name of the building zone */\n    public readonly name: string;\n    /** Description for the Organisation */\n    public readonly description: string;\n    /** Tags for the Organisation */\n    public readonly tags: string[];\n    /** Count for the Organisation */\n    public readonly count: number;\n    /** Capacity for the Organisation */\n    public readonly capacity: number;\n    /** PlaceOS bindings for applications */\n    public readonly bindings: HashMap<string>;\n    /** Map of custom settings for the building */\n    private _settings: HashMap;\n\n    constructor(raw_data: Partial<OrganisationComplete> = {}) {\n        this.id = raw_data.id || '';\n        this.name = raw_data.name || '';\n        this.description = raw_data.description || '';\n        this.tags = raw_data.tags || [];\n        this.count = raw_data.count || 0;\n        this.capacity = raw_data.capacity || 0;\n        this.bindings = raw_data.bindings || {};\n        this._settings = raw_data.settings || {};\n    }\n\n    /**\n     * Get a custom organisation setting\n     * @param key Name of the setting. i.e. nested items can be grabbed using `.` to seperate key names\n     */\n    public setting(key: string): any {\n        const keys = key.split('.');\n        const value = getItemWithKeys(keys, this._settings);\n        return value;\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { Router } from '@angular/router';\nimport {\n    HashMap,\n    notifyError,\n    RoomConfiguration,\n    SettingsService,\n} from '@placeos/common';\nimport {\n    authority,\n    isMock,\n    onlineState,\n    queryZones,\n    showMetadata,\n} from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { first, map } from 'rxjs/operators';\nimport { Building } from './building.class';\nimport { BuildingLevel } from './level.class';\nimport { Organisation } from './organisation.class';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class OrganisationService {\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    private readonly _buildings = new BehaviorSubject<Building[]>([]);\n    private readonly _active_building = new BehaviorSubject<Building>(null);\n    private readonly _levels = new BehaviorSubject<BuildingLevel[]>([]);\n\n    /** Observable for the list of buildings */\n    public readonly building_list = this._buildings.asObservable();\n    /** Observable for the list of levels */\n    public readonly level_list = this._levels.asObservable();\n    /** Observable for the currently active building */\n    public readonly active_building = this._active_building.asObservable();\n    /** Observable for the levels associated with the currently active building */\n    public readonly active_levels = combineLatest([\n        this._levels,\n        this._active_building,\n    ]).pipe(map(([_, bld]) => (bld ? this.levelsForBuilding(bld) : [])));\n    /** Organisation data for the application */\n    private _organisation: Organisation;\n    /** Mapping of organisation settings overrides */\n    private _settings: HashMap = {};\n    /** Mapping of buildings to settings overrides */\n    private _building_settings: HashMap<HashMap> = {};\n\n    /** Mapping of organisation settings overrides */\n    public get settings(): HashMap {\n        return this._settings;\n    }\n\n    /** Mapping of builgins to settings overrides */\n    public get building_settings(): HashMap<HashMap> {\n        return this._building_settings;\n    }\n\n    /** Mapping building settings overrides */\n    public buildingSettings(bld_id: string = ''): HashMap {\n        if (!bld_id && this.building) {\n            bld_id = this.building.id;\n        }\n        return this._building_settings\n            ? this._building_settings[bld_id] || {}\n            : {};\n    }\n\n    /** Organisation data for the application */\n    public get organisation(): Organisation {\n        return this._organisation;\n    }\n\n    /** List of available buildings */\n    public get buildings(): Building[] {\n        return this._buildings.getValue();\n    }\n\n    /** Currently active building */\n    public get building(): Building {\n        return this._active_building.getValue();\n    }\n    public set building(bld: Building) {\n        this._active_building.next(bld);\n        this._service.overrides = [\n            this._settings.details,\n            this.buildingSettings(bld.id).details,\n        ];\n    }\n\n    /** Get building by id */\n    public find(id: string) {\n        return this.buildings.find((i) => i.id === id);\n    }\n\n    /** List of available levels */\n    public get levels(): BuildingLevel[] {\n        return this._levels.getValue();\n    }\n\n    constructor(private _service: SettingsService, private _router: Router) {\n        onlineState()\n            .pipe(first((_) => _))\n            .subscribe(() => setTimeout(() => this.init(), 1000));\n        this.active_building.subscribe((bld) => {\n            if (bld) {\n                this._service.overrides = [\n                    this._settings,\n                    this.buildingSettings(bld.id),\n                ];\n            }\n        });\n    }\n\n    /**\n     * Get level with a matching ID\n     * @param id_list List of IDs to find a match\n     */\n    public levelWithID(id_list: string[]): BuildingLevel {\n        return this.levels.find((lvl) => id_list?.includes(lvl.id));\n    }\n\n    /**\n     * Get list of levels for the given building\n     * @param bld Building to list levels for\n     */\n    public levelsForBuilding(bld: Building): BuildingLevel[] {\n        return this.levels.filter((lvl) => lvl.parent_id === bld.id);\n    }\n\n    private async init(tries: number = 0) {\n        this._initialised.next(false);\n        await this.load().catch((err) => {\n            notifyError('Error loading organisation data. Retrying...');\n            setTimeout(() => this.init(tries), Math.min(10_000, 300 * ++tries));\n            throw err;\n        });\n        this._initialised.next(true);\n        if (window.debug) {\n            if (!window.application) window.application = {};\n            window.application.orgs = this;\n        }\n    }\n\n    /**\n     * Initialise service data\n     */\n    private async load(): Promise<void> {\n        await this.loadOrganisation();\n        await this.loadBuildings();\n        await this.loadLevels();\n        await this.loadSettings();\n    }\n\n    /**\n     * Load organisation data for application\n     */\n    public async loadOrganisation(): Promise<void> {\n        const org_list = await queryZones({ tags: 'org' })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (org_list.length) {\n            const auth = authority();\n            const org =\n                org_list.find(\n                    (list) => isMock() || list.id === auth?.config?.org_zone\n                ) || org_list[0];\n            const bindings: HashMap = (\n                await showMetadata(org.id, { name: 'bindings' }).toPromise()\n            )?.details;\n            const settings: HashMap = (\n                await showMetadata(org.id, { name: 'settings' }).toPromise()\n            )?.details;\n            this._settings = { ...this._settings, ...settings };\n            this._organisation = new Organisation({ ...org, bindings });\n        } else {\n            this._router.navigate(['/misconfigured']);\n        }\n    }\n\n    /**\n     * Load buildings data for the organisation\n     */\n    public async loadBuildings(): Promise<void> {\n        const building_list = await queryZones({\n            tags: 'building',\n            limit: 500,\n        } as any)\n            .pipe(\n                map((i) =>\n                    i.data.filter((_) => _.parent_id === this._organisation.id)\n                )\n            )\n            .toPromise();\n        if (!building_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const buildings = [];\n        for (const bld of building_list) {\n            const bindings: HashMap = (\n                await showMetadata(bld.id, { name: 'bindings' }).toPromise()\n            )?.details;\n            buildings.push(new Building({ ...bld, bindings }));\n        }\n        this._buildings.next(buildings);\n        const id = localStorage.getItem(`PLACEOS.building`);\n        if (id && this.buildings.find((bld) => bld.id === id)) {\n            this._active_building.next(\n                this.buildings.find((bld) => bld.id === id)\n            );\n        }\n        if (!this.building?.id && buildings?.length > 0) {\n            this.building = buildings[0];\n        }\n    }\n\n    /**\n     * Load levels data for the buildings\n     */\n    public async loadLevels(): Promise<void> {\n        const level_list = await queryZones({\n            tags: 'level',\n            limit: 2500,\n        } as any)\n            .pipe(map((i) => i.data))\n            .toPromise();\n        if (!level_list?.length) {\n            this._router.navigate(['/misconfigured']);\n        }\n        const levels = level_list.map((lvl) => new BuildingLevel(lvl));\n        levels.sort((a, b) => (a.name || '').localeCompare(b.name || ''));\n        this._levels.next(levels);\n    }\n\n    public get available_room_configs(): RoomConfiguration[] {\n        return this.buildings\n            .map((m) => [...m.room_configurations])\n            .reduce((prev, curr) => prev.concat(curr), [])\n            .sort((a, b) => a.name.localeCompare(b.name));\n    }\n\n    public async loadSettings() {\n        if (!this._organisation) return;\n        const app_name = `${(\n            this._service.get('app.name') || 'workplace'\n        ).toLowerCase()}_app`;\n        this._settings = await showMetadata(this._organisation.id, {\n            name: app_name,\n        }).toPromise();\n        const buildings = this.buildings;\n        for (const bld of buildings) {\n            this._building_settings[bld.id] = await showMetadata(bld.id, {\n                name: app_name,\n            }).toPromise();\n        }\n        this._service.overrides = [\n            this._settings.details,\n            this.buildingSettings(this.building.id).details,\n        ];\n    }\n\n    /** Save building selection */\n    public saveBuilding(id: string) {\n        localStorage.setItem(`PLACEOS.building`, id);\n    }\n}\n","import { PlaceZone } from '@placeos/ts-client';\n\nexport class Desk {\n    /** ID of the desk also map_id */\n    public readonly id: string;\n    /** ID of the desk on the associated map */\n    public readonly map_id: string;\n    /** Name of the desk */\n    public readonly name: string;\n    /** Whether desk is available / bookable */\n    public readonly bookable: boolean;\n    /** Zone/Level of the desk */\n    public readonly zone: PlaceZone;\n    /** Group/Department allocated to the desk */\n    public readonly groups: string[];\n    /** QR code image data */\n    public readonly qr_code: string;\n\n    constructor(data: Partial<Desk> = {}) {\n        this.id = data.id || '';\n        this.map_id = data.map_id || data.id || '';\n        this.name = data.name || '';\n        this.bookable = data.bookable ?? false;\n        this.zone = data.zone || new PlaceZone();\n        this.groups = data.groups || [];\n        this.qr_code = data.qr_code || '';\n    }\n\n    public format() {\n        const { id, name, bookable, groups } = this;\n        return {\n            id,\n            name,\n            bookable,\n            groups,\n        };\n    }\n\n    public readonly toJSON = () => this.format();\n}\n","import { RoomConfiguration } from '@placeos/common';\nimport { BuildingLevel } from '@placeos/organisation';\n\nimport { CalendarAvailability } from 'libs/calendar/src/lib/calendar.interfaces';\n\nexport type ResourceResponseStatus =\n    | 'needsAction'\n    | 'declined'\n    | 'tentative'\n    | 'accepted';\n\nexport class Space {\n    /** ID of the space resource */\n    public readonly id: string;\n    /** Display name of the space resource */\n    public readonly name: string;\n    /** Name to display */\n    public readonly display_name: string;\n    /** Email address of the resource associated with space */\n    public readonly email: string;\n    /** Capacity of the space resource */\n    public readonly capacity: number;\n    /** List of features available at the space resource  */\n    public readonly feature_list: string[];\n    /** URL to a supporting site for space */\n    public readonly support_url: string;\n    /** ID of the space on the associated map */\n    public readonly map_id: string;\n    /** Whether resource is bookable */\n    public readonly bookable: boolean;\n    /** List of zones the spaces is associated with */\n    public readonly zones: string[];\n    /** List of available room configurations for this room */\n    public readonly configurations: readonly RoomConfiguration[];\n    /** Image url */\n    public readonly image: string;\n    /** Status of the resource */\n    public readonly response_status: ResourceResponseStatus;\n    /** Level Assoicated with the space */\n    public readonly level: BuildingLevel;\n    /** List of features associated with the space */\n    public readonly features: string[];\n\n    public readonly availability: CalendarAvailability[];\n\n    constructor(data: Partial<Space> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.display_name = data.display_name || '';\n        this.email = (data.email || '').toLowerCase();\n        this.capacity = data.capacity || -1;\n        this.feature_list = data.feature_list || (data.features as any) || [];\n        this.bookable = !!data.bookable;\n        this.zones = data.zones || [];\n        this.support_url = data.support_url || '';\n        this.map_id = data.map_id || '';\n        this.image = data.image || '';\n        this.configurations = data.configurations || [];\n        this.features = data.features || [];\n        this.response_status = data.response_status;\n        this.level = data.level || new BuildingLevel();\n        this.availability = data.availability || [];\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { querySystems } from '@placeos/ts-client';\nimport { first, map } from 'rxjs/operators';\nimport { BehaviorSubject } from 'rxjs';\n\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { Space } from './space.class';\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class SpacesService {\n    /** Subject to store list of spaces */\n    private _list = new BehaviorSubject<Space[]>([]);\n    /** Subject which stores the initialised state of the object */\n    protected readonly _initialised = new BehaviorSubject<boolean>(false);\n    /** Observable of the initialised state of the object */\n    public readonly initialised = this._initialised.asObservable();\n    /** Observable for list of spaces */\n    public readonly list = this._list.asObservable();\n    /** Default predicate for filter method */\n    protected _compare = (space: Space) =>\n        space.zones.includes(this._org.building.id);\n\n    /** List of available spaces */\n    public get space_list(): Space[] {\n        return this._list.getValue();\n    }\n\n    constructor(private _org: OrganisationService) {\n        this._org.initialised\n            .pipe(first((_) => _))\n            .subscribe(() => this.loadSpaces());\n    }\n\n    /**\n     * Get a filtered list of the available spaces\n     * @param predicate Predicate for filtering spaces\n     */\n    public filter(predicate: (_: Space) => boolean = this._compare) {\n        return this._list.getValue().filter((_) => predicate(_));\n    }\n\n    /**\n     * Find space with given id/email\n     * @param id ID/Email address associated with the space\n     */\n    public find(id: string) {\n        return this._list\n            .getValue()\n            .find((space) => space.id === id || space.email === id);\n    }\n\n    private async loadSpaces(): Promise<void> {\n        const systems = await querySystems({\n            zone_id: this._org.organisation.id,\n            limit: 5000,\n        })\n            .pipe(map((i) => i.data))\n            .toPromise();\n        const space_list = systems.map(\n            (sys) =>\n                new Space({\n                    ...(sys as any),\n                    level: this._org.levelWithID([...sys.zones]),\n                })\n        );\n        // Remove spaces without a map ID\n        const valid_spaces = space_list.filter((space) => space.map_id);\n        this._list.next(valid_spaces);\n        this._initialised.next(true);\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { SpacesService } from 'libs/spaces/src/lib/spaces.service';\n\nimport { OrganisationService } from 'libs/organisation/src/lib/organisation.service';\nimport { first } from 'rxjs/operators';\n\n@Component({\n    selector: 'global-loading',\n    template: `\n        <div\n            *ngIf=\"loading\"\n            class=\"fixed inset-0 flex items-center justify-center pointer-events-auto bg-white\"\n        >\n            <mat-spinner [diameter]=\"64\"></mat-spinner>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                pointer-events: none;\n            }\n\n            :host > div {\n                z-index: 9999;\n                background-image: url(\"data:image/svg+xml,%3Csvg width='36' height='36' viewBox='0 0 36 36' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M36 0H0v36h36V0zM15.126 2H2v13.126c.367.094.714.24 1.032.428L15.554 3.032c-.188-.318-.334-.665-.428-1.032zM18 4.874V18H4.874c-.094-.367-.24-.714-.428-1.032L16.968 4.446c.318.188.665.334 1.032.428zM22.874 2h11.712L20 16.586V4.874c1.406-.362 2.512-1.468 2.874-2.874zm10.252 18H20v13.126c.367.094.714.24 1.032.428l12.522-12.522c-.188-.318-.334-.665-.428-1.032zM36 22.874V36H22.874c-.094-.367-.24-.714-.428-1.032l12.522-12.522c.318.188.665.334 1.032.428zm0-7.748V3.414L21.414 18h11.712c.362-1.406 1.468-2.512 2.874-2.874zm-18 18V21.414L3.414 36h11.712c.362-1.406 1.468-2.512 2.874-2.874zM4.874 20h11.712L2 34.586V22.874c1.406-.362 2.512-1.468 2.874-2.874z' fill='%23000000' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E\");\n            }\n        `,\n    ],\n})\nexport class GlobalLoadingComponent implements OnInit {\n    public loading: boolean;\n\n    constructor(\n        private _org: OrganisationService,\n        private _spaces: SpacesService\n    ) {}\n\n    public async ngOnInit() {\n        this.loading = true;\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        await this._spaces.initialised.pipe(first((_) => _)).toPromise();\n        setTimeout(() => (this.loading = false), 300);\n    }\n}\n","import { ChangeDetectorRef, Component, Inject, OnInit } from '@angular/core';\nimport { BaseClass, HashMap } from '@placeos/common';\nimport { Observable } from 'rxjs';\nimport { MAP_FEATURE_DATA } from './interactive-map.component';\n\nexport interface MapPolygonData {\n    /** Name of the region */\n    name: string;\n    /** Color to display region in on overlay */\n    color: string;\n    /** Array of points that define the shape of the region */\n    points: [number, number][];\n    /**  */\n    ratio?: number;\n\n    data$?: Observable<MapPolygonData>;\n}\n\n@Component({\n    selector: '[map-polygon]',\n    template: `\n        <div polygon class=\"absolute w-full h-full center\">\n            <svg\n                [attr.viewBox]=\"\n                    '0 0 ' + width + padding + ' ' + height + padding\n                \"\n                [style.width]=\"width * (100 / scale) + '%'\"\n                [style.height]=\"height * (100 / scale) + '%'\"\n                class=\"center top-1/2 left-1/2\"\n            >\n                <polygon\n                    [attr.points]=\"points\"\n                    [style.fill]=\"fill\"\n                    [style.stroke]=\"stroke\"\n                />\n                <circle\n                    *ngFor=\"let point of point_list\"\n                    [attr.cx]=\"point[0] || 0\"\n                    [attr.cy]=\"point[1] || 0\"\n                    [attr.r]=\"4\"\n                    [style.stroke]=\"'#000'\"\n                    [style.fill]=\"'#fffd'\"\n                />\n            </svg>\n            <div\n                text\n                class=\"center top-1/2 left-1/2 text-shadow text-white text-xl text-center whitespace-pre-line\"\n            >\n                {{ name }}\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            polygon {\n                stroke-width: 4;\n            }\n            circle {\n                stroke-width: 2;\n            }\n\n            svg {\n                width: 100%;\n                height: 100%;\n            }\n\n            .center {\n                position: absolute;\n                transform: translate(-50%, -50%);\n            }\n\n            [text] {\n                width: 32rem;\n                max-width: 65vw;\n            }\n        `,\n    ],\n})\nexport class MapPolygonComponent extends BaseClass implements OnInit {\n    /** Message to display above the pin */\n    public name = this._details.name;\n    /** Fill colour for the pin SVG */\n    public fill = `${this._details.color || '#e53935'}88`;\n    /** Stroke colour for the pin SVG */\n    public stroke = this._details.color || '#e53935';\n\n    public padding = 32;\n\n    public scale = 8;\n\n    public offset_x = 0;\n    public offset_y = 0;\n    public width = 1;\n    public height = 1;\n\n    /** List of points for drawing the polygon */\n    public points = `0,0 0,${this.height} ${this.width},${this.height} ${this.width},0`;\n\n    public point_list: [number, number][] = [];\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: MapPolygonData,\n        private _cdr: ChangeDetectorRef\n    ) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        if (this._details.data$) {\n            this.subscription(\n                'data',\n                this._details.data$.subscribe((_) => {\n                    this.name = _.name;\n                    this.fill = `${_.color || '#e53935'}88`;\n                    this.stroke = _.color || '#e53935';\n                    this.processPoints(_.points);\n                })\n            );\n        }\n        this.processPoints(this._details.points);\n    }\n\n    public processPoints(points: [number, number][]) {\n        const diff: HashMap<number> = points.reduce(\n            (m, [x, y]) => ({\n                x_min: x < m.x_min ? x : m.x_min,\n                x_max: x > m.x_max ? x : m.x_max,\n                y_min: y < m.y_min ? y : m.y_min,\n                y_max: y > m.y_max ? y : m.y_max,\n            }),\n            {\n                x_min: 100,\n                x_max: -100,\n                y_min: 100,\n                y_max: -100,\n            }\n        );\n        this.offset_x = diff.x_min * 100;\n        this.offset_y = diff.y_min * 100;\n        const range = {\n            x: diff.x_max - diff.x_min,\n            y: diff.y_max - diff.y_min,\n        };\n        this.width = range.x * 100 * this.scale;\n        this.height = range.y * 100 * (this._details?.ratio || 1) * this.scale;\n        const edge_padding = this.padding / 2 + 8;\n        this.width = Math.floor(this.width * 100) / 100;\n        this.height = Math.floor(this.height * 100) / 100;\n        this.points = points\n            .reduce(\n                (s, [x, y]) =>\n                    `${s}${s ? ' ' : ''}${\n                        ((x - diff.x_min) / range.x) * this.width + edge_padding\n                    },${\n                        ((y - diff.y_min) / range.y) * this.height +\n                        edge_padding\n                    }`,\n                ''\n            )\n            .replace(/NaN/g, '0');\n        this.point_list = points.map(([x, y]) => [\n            ((x - diff.x_min) / range.x) * this.width + edge_padding,\n            ((y - diff.y_min) / range.y) * this.height + edge_padding,\n        ]);\n        this.width = this.width + this.padding + 8;\n        this.height = this.height + this.padding + 8;\n        this._cdr.detectChanges();\n    }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'app-unauthorised',\n    template: `\n        <div\n            class=\"unauthorised rounded m-4 text-center bg-white text-black border border-gray-400 p-4 shadow\"\n        >\n            <h1 class=\"text-4xl\">403</h1>\n            <h3 class=\"text-2xl\" i18n=\"@@forbiddenLabel\">Access forbidden.</h3>\n            <p class=\"py-4\" i18n=\"@@invalidPermissionLabel\">\n                You do not have permission to view this page and your access\n                attempt has been recorded.\n            </p>\n            <p i18n=\"@@contactAdminLabel\">\n                Contact your Administrator if you feel that you should have\n                access.\n            </p>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n            }\n\n            .unauthorised {\n                width: 28em;\n                max-width: calc(100vw - 1rem);\n            }\n\n            @media (prefers-color-scheme: dark) {\n                .unauthorised {\n                    background-color: #262626;\n                    color: #fff;\n                }\n            }\n        `,\n    ],\n})\nexport class UnauthorisedComponent {}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatMenuModule } from '@angular/material/menu';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\nimport { MatDatepickerModule } from '@angular/material/datepicker';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { ClipboardModule } from '@angular/cdk/clipboard';\nimport { MAT_DATE_LOCALE } from '@angular/material/core';\nimport { MatPaginatorModule } from '@angular/material/paginator';\nimport { CdkTableModule } from '@angular/cdk/table';\nimport { PortalModule } from '@angular/cdk/portal';\n\nimport { BindingDirective } from './binding.directive';\nimport { ActionIconComponent } from './action-icon.component';\nimport { IconComponent } from './icon.component';\nimport { PopoutMenuComponent } from './popout-menu.component';\nimport { UserAvatarComponent } from './user-avatar.component';\n\nimport { ConfirmModalComponent } from './confirm-modal.component';\nimport {\n    InteractiveMapComponent,\n    MAP_FEATURE_DATA,\n} from './interactive-map.component';\nimport { MapPinComponent } from './map-pin.component';\nimport { MapRadiusComponent } from './map-radius.component';\nimport { StatusOverlayComponent } from './status-overlay.component';\nimport { FixedPipe } from './fixed.pipe';\nimport { SafePipe } from './safe.pipe';\nimport { SanitizePipe } from './sanitise.pipe';\nimport { CustomTableComponent } from './custom-table.component';\nimport { CustomTooltipComponent } from './custom-tooltip.component';\nimport { VirtualKeyboardComponent } from './virtual-keyboard.component';\nimport { GlobalLoadingComponent } from './global-loading.component';\nimport { MatSortModule } from '@angular/material/sort';\nimport { MapPolygonComponent } from './map-polygon.component';\n\nexport * from './action-icon.component';\nexport * from './binding.directive';\nexport * from './confirm-modal.component';\nexport * from './icon.component';\nexport * from './login.component';\nexport * from './popout-menu.component';\nexport * from './unauthorised.component';\nexport * from './user-avatar.component';\nexport * from './interactive-map.component';\nexport * from './map-pin.component';\nexport * from './map-radius.component';\nexport * from './misconfigured.component';\nexport * from './status-overlay.component';\nexport * from './custom-table.component';\nexport * from './custom-tooltip.component';\nexport * from './fixed.pipe';\nexport * from './safe.pipe';\nexport * from './sanitise.pipe';\nexport * from './virtual-keyboard.component';\nexport * from './global-loading.component';\n\nexport * from './authorised-admin.guard';\nexport * from './authorised-user.guard';\n\nconst MAT_MODULES: any[] = [\n    MatAutocompleteModule,\n    MatMenuModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    MatButtonModule,\n    MatAutocompleteModule,\n    MatSelectModule,\n    MatDialogModule,\n    MatDatepickerModule,\n    MatInputModule,\n    ClipboardModule,\n    MatProgressSpinnerModule,\n    MatChipsModule,\n    MatPaginatorModule,\n    CdkTableModule,\n    PortalModule,\n    MatSortModule,\n];\n\nconst COMPONENTS: Type<any>[] = [\n    ActionIconComponent,\n    IconComponent,\n    PopoutMenuComponent,\n    UserAvatarComponent,\n\n    ConfirmModalComponent,\n    InteractiveMapComponent,\n    MapPinComponent,\n    MapRadiusComponent,\n    MapPolygonComponent,\n    StatusOverlayComponent,\n    CustomTableComponent,\n    CustomTooltipComponent,\n    VirtualKeyboardComponent,\n    GlobalLoadingComponent,\n\n    FixedPipe,\n    SafePipe,\n    SanitizePipe,\n];\n\nconst DIRECTIVES: Type<any>[] = [BindingDirective];\n\n@NgModule({\n    declarations: [...COMPONENTS, ...DIRECTIVES],\n    imports: [CommonModule, FormsModule, ReactiveFormsModule, ...MAT_MODULES],\n    providers: [\n        { provide: MAT_DATE_LOCALE, useValue: 'en-GB' },\n        { provide: MAP_FEATURE_DATA, useValue: {} },\n    ],\n    exports: [...COMPONENTS, ...DIRECTIVES, ...MAT_MODULES],\n})\nexport class ComponentsModule {}\n","import { Component, forwardRef, Input, OnChanges, OnInit, SimpleChanges } from '@angular/core';\nimport { ControlValueAccessor, NG_VALUE_ACCESSOR } from '@angular/forms';\nimport { Identity } from '@placeos/common';\nimport { formatDuration } from 'date-fns';\nimport * as dayjs from 'dayjs';\n\n\n\n@Component({\n    selector: 'a-duration-field',\n    template: `\n        <div class=\"duration-field\" [attr.disabled]=\"disabled\">\n            <mat-form-field appearance=\"outline\">\n                <mat-select\n                    #select\n                    [value]=\"duration\"\n                    [disabled]=\"disabled\"\n                    [placeholder]=\"duration + ' minutes'\"\n                    (valueChange)=\"setValue($event)\"\n                >\n                    <mat-option *ngFor=\"let option of duration_options\" [value]=\"option.id\">\n                        {{ option.name }}\n                    </mat-option>\n                </mat-select>\n                <mat-error><ng-content></ng-content></mat-error>\n            </mat-form-field>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                width: 100%;\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n    providers: [\n        {\n            provide: NG_VALUE_ACCESSOR,\n            useExisting: forwardRef(() => DurationFieldComponent),\n            multi: true,\n        },\n    ],\n})\nexport class DurationFieldComponent implements OnInit, OnChanges, ControlValueAccessor {\n    /** Maximum duration option available */\n    @Input() public max = 240;\n    /** Minimum duration option available */\n    @Input() public min = 30;\n    /** Step value between options */\n    @Input() public step = 15;\n    /** Reference time for displaying next to durations */\n    @Input() public time: number;\n    /** Whether form field is disabled */\n    @Input() public disabled: boolean;\n    /** Special case prepopulation i.e. out of step options */\n    @Input() public specialPreprops: Array<number> = [];\n\n    public duration = 60;\n    /** List of available duration options */\n    public duration_options: Identity[];\n\n    /** Form control on change handler */\n    private _onChange: (_: number) => void;\n    /** Form control on touch handler */\n    private _onTouch: (_: number) => void;\n\n    public ngOnInit(): void {\n        this.duration_options = this.generateDurationOptions(this.max, this.min, this.step);\n    }\n\n    public ngOnChanges(changes: SimpleChanges): void {\n        /* istanbul ignore else */\n        if (changes.max || changes.min || changes.step || changes.time) {\n            this.duration_options = this.generateDurationOptions(this.max, this.min, this.step);\n        }\n    }\n\n    /**\n     * Update the form field value\n     * @param new_value New value to set on the form field\n     */\n    public setValue(new_value: number): void {\n        this.duration = new_value;\n        /* istanbul ignore else */\n        if (this._onChange) {\n            this._onChange(+new_value);\n        }\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Update local value when form control value is changed\n     * @param value The new value for the component\n     */\n    public writeValue(value: number) {\n        this.duration = value;\n    }\n\n    public setDisabledState(disabled: boolean) {\n        this.disabled = disabled;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function that is called when the control's value changes in the UI.\n     * @param fn The callback function to register\n     */\n    public registerOnChange(fn: (_: number) => void): void {\n        this._onChange = fn;\n    }\n\n    /* istanbul ignore next */\n    /**\n     * Registers a callback function is called by the forms API on initialization to update the form model on blur.\n     * @param fn The callback function to register\n     */\n    public registerOnTouched(fn: (_: number) => void): void {\n        this._onTouch = fn;\n    }\n\n    private generateDurationOptions(max: number, min: number, step: number): Identity[] {\n        const blocks: Identity[] = [];\n        let time = min;\n        const date = this.time ? dayjs(this.time) : null;\n\n        // Add special case for 10min duration/prepropulation\n        for (const option of this.specialPreprops) {\n            blocks.push({\n                id: option,\n                name: date\n                    ? `${date.add(option, 'm').format('h:mm A')} (${formatDuration({\n                          hours: Math.floor(option / 60),\n                          minutes: option % 60,\n                      })})`\n                    : `${formatDuration({ hours: Math.floor(option / 60), minutes: option % 60 })}`,\n            });\n        }\n\n        while (time <= max) {\n            blocks.push({\n                id: time,\n                name: date\n                    ? `${date.add(time, 'm').format('h:mm A')} (${formatDuration({\n                          hours: Math.floor(time / 60),\n                          minutes: time % 60,\n                      })})`\n                    : `${formatDuration({ hours: Math.floor(time / 60), minutes: time % 60 })}`,\n            });\n            time += step;\n        }\n        return blocks;\n    }\n}\n","import { Component, OnInit, Output, EventEmitter, Inject } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BaseClass, DialogEvent } from '@placeos/common';\n\nimport { User } from './user.class';\nimport { generateUserForm } from './user.utilities';\n\n@Component({\n    selector: 'new-user-modal',\n    template: `\n        <header>\n            <div class=\"heading\" mat-dialog-title>\n                {{ user?.id ? 'Edit' : 'Add' }} External Attendee\n            </div>\n            <div class=\"flex-1\"></div>\n            <button mat-icon-button mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main\n            class=\"flex flex-col items-center w-full p-2\"\n            *ngIf=\"!loading; else load_state\"\n        >\n            <user-form [form]=\"form\"></user-form>\n        </main>\n        <footer\n            class=\"flex items-center justify-center w-full p-2 border-t border-gray-300 space-x-2\"\n            *ngIf=\"!loading\"\n        >\n            <button mat-button class=\"inverse\" mat-dialog-close>Cancel</button>\n            <button mat-button (click)=\"saveChanges()\">Save</button>\n        </footer>\n        <ng-template #load_state>\n            <main class=\"flex flex-col items-center w-full p-2 space-y-2\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p>Saving attendee...</p>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                min-height: 20em !important;\n                width: 100%;\n            }\n\n            footer button {\n                min-width: 8em;\n            }\n        `,\n    ],\n})\nexport class NewUserModalComponent extends BaseClass implements OnInit {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** Form fields for the new user */\n    public form: FormGroup;\n    /** New user data store */\n    public user: User;\n    /** Whether user details are being saved */\n    public loading: boolean;\n\n    constructor(@Inject(MAT_DIALOG_DATA) private _data: any) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.user = this._data.user || {};\n        this.form = generateUserForm(this.user);\n    }\n\n    public saveChanges() {\n        this.form.markAllAsTouched();\n        if (this.form.valid) {\n            const new_user = new User({\n                ...this.form.value,\n                type: 'external',\n            });\n            this.event.emit({ reason: 'done', metadata: new_user });\n        }\n    }\n}\n","import { Component, Input } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\n\n@Component({\n    selector: 'user-form',\n    template: `\n        <form user-form *ngIf=\"form\" [formGroup]=\"form\">\n            <div class=\"field\" *ngIf=\"form.controls.name\">\n                <label for=\"name\" [class.error]=\"hasError('name')\">\n                    Name<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"name\"\n                        placeholder=\"Name\"\n                        formControlName=\"name\"\n                    />\n                    <mat-error>Name is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.email\">\n                <label for=\"email\" [class.error]=\"hasError('email')\">\n                    Email<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"email\"\n                        placeholder=\"Email Address\"\n                        formControlName=\"email\"\n                    />\n                    <mat-error>A valid email is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.organisation\">\n                <label for=\"org\" [class.error]=\"hasError('organisation')\">\n                    Organisation<span>*</span>:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"org\"\n                        placeholder=\"Organisation\"\n                        formControlName=\"organisation\"\n                    />\n                    <mat-error>Organisation is required</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.phone\">\n                <label for=\"phone\" [class.error]=\"hasError('phone')\">\n                    Phone:\n                </label>\n                <mat-form-field appearance=\"outline\">\n                    <input\n                        matInput\n                        name=\"phone\"\n                        type=\"tel\"\n                        placeholder=\"Phone\"\n                        formControlName=\"phone\"\n                    />\n                    <mat-error>Phone format is invalid</mat-error>\n                </mat-form-field>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.assistance_required\">\n                <mat-checkbox\n                    name=\"assistance-required\"\n                    color=\"primary\"\n                    formControlName=\"assistance_required\"\n                >\n                    Assistance required\n                </mat-checkbox>\n            </div>\n            <div class=\"field\" *ngIf=\"form.controls.visit_expected\">\n                <mat-checkbox\n                    name=\"visit-expected\"\n                    color=\"primary\"\n                    formControlName=\"visit_expected\"\n                >\n                    Visit expected\n                </mat-checkbox>\n            </div>\n        </form>\n    `,\n    styles: [\n        `\n            .field {\n                display: flex;\n                flex-wrap: wrap;\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n        `,\n    ],\n})\nexport class UserFormComponent {\n    /** Group of form fields used for creating the system */\n    @Input() public form: FormGroup;\n\n    public hasError(name: string) {\n        return (\n            this.form.controls[name].invalid && this.form.controls[name].touched\n        );\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\nimport { ComponentsModule } from '@placeos/components';\n\nimport { NewUserModalComponent } from './new-user-modal.component';\nimport { UserFormComponent } from './user-form.component';\n\n@NgModule({\n    declarations: [NewUserModalComponent, UserFormComponent],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatDialogModule,\n        ComponentsModule,\n        MatCheckboxModule,\n    ],\n    exports: [NewUserModalComponent],\n})\nexport class SharedUsersModule {}\n","import { Point } from '@placeos/svg-viewer';\nimport { HashMap } from '@placeos/common';\nimport { getUnixTime } from 'date-fns';\nexport class MapLocation {\n    /** Source that the location was generated */\n    public type: 'desk' | 'wireless' | 'meeting' | 'other';\n    /** Details of the location */\n    public position: string | Point;\n    /** Accuracy of the location data */\n    public variance: number;\n    /** Unix epoch in seconds that the data was last updated */\n    public last_seen: number;\n    /** ID of the level associated with the location */\n    public level: string;\n    /** ID of the building associated with the location */\n    public building: string;\n    /** Whether user is currently at the location if fixed */\n    public at_location: boolean;\n    /**  */\n    public coordinates_from:\n        | 'top-left'\n        | 'top-right'\n        | 'bottom-left'\n        | 'bottom-right';\n\n    constructor(_data: HashMap = {}) {\n        this.type = _data.type || _data.location || 'other';\n        this.position = _data.position ||\n            _data.map_id || {\n                x: _data.x / _data.map_width || 0,\n                y: _data.y / _data.map_height || 0,\n            };\n        this.variance = _data.variance || 0;\n        this.last_seen = _data.last_seen || getUnixTime(new Date());\n        this.level = _data.level;\n        this.building = _data.building;\n        this.at_location = !!_data.at_location;\n        this.coordinates_from = _data.coordinates_from || 'top-left';\n    }\n}\n","import { CateringOption } from './catering.interfaces';\n\nexport class CateringItem {\n    /** ID of the catering item */\n    public readonly id: string;\n    /** Display name for the catering item */\n    public readonly name: string;\n    /** Category that this item is associated */\n    public readonly category: string;\n    /** Description of the contents of the catering item */\n    public readonly description: string;\n    /** Unit price in cents for the catering item */\n    public readonly unit_price: number;\n    /** Number of item in the associated order */\n    public readonly quantity: number;\n    /** List of options for the catering item */\n    public readonly options: CateringOption[];\n    /** List of attributes assoicated with the catering item */\n    public readonly tags: string[];\n    /** Whether catering items can be purchased using points */\n    public readonly accept_points: boolean;\n    /** Max percentage of the cost that can be covered using points */\n    public readonly discount_cap: number;\n    /** Total cost for the item */\n    public readonly total_cost: number;\n\n    public readonly options_string: string;\n\n    constructor(data: Partial<CateringItem> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || data.id || '';\n        this.category = data.category || '';\n        this.unit_price = data.unit_price || 0;\n        this.description = data.description || '';\n        this.quantity = data.quantity || 0;\n        this.discount_cap = data.discount_cap || 0;\n        this.accept_points = !!data.accept_points;\n        this.options = data.options || [];\n        this.tags = data.tags || [];\n        this.total_cost =\n            (this.unit_price +\n                this.options\n                    .map((i) => i.unit_price || 0)\n                    .reduce((c, a) => c + a, 0)) *\n            this.quantity;\n\n        this.options_string =\n            this.options\n                ?.map((_) => _.id || '')\n                .sort((a, b) => a.localeCompare(b))\n                .join(',') || '';\n    }\n}\n","import { randomInt } from '@placeos/common';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { CateringItem } from './catering-item.class';\nimport { CateringOrderStatus } from './catering.interfaces';\n\nexport class CateringOrder {\n    /** ID of the order */\n    public readonly id: string;\n    /** ID of the space the order is associated */\n    public readonly system_id: string;\n    /** ID of the event the order is associated */\n    public readonly event_id: string;\n    /** List of items associated with the order */\n    public readonly items: readonly CateringItem[];\n    /** Number of items in the order */\n    public readonly item_count: number;\n    /** Total cost of order */\n    public readonly total_cost: number;\n    /** Invoice number associated with the order */\n    public readonly invoice_number: string;\n    /** Charge code for the order */\n    public readonly charge_code: string;\n    /** Unix epoch in seconds of order delivery time */\n    public readonly deliver_at: number;\n    /** Current status of the order */\n    public readonly status: CateringOrderStatus;\n    /** Event associated with the order */\n    public readonly event: CalendarEvent | null;\n\n    constructor(data: Partial<CateringOrder> = {}) {\n        this.id = data.id || `order-${randomInt(9_999_999, 1_000_000)}`;\n        this.system_id = data.system_id || '';\n        this.event_id = data.event_id || data.event?.id || '';\n        this.items = (data.items || []).map((i) => new CateringItem(i));\n        this.item_count = this.items.reduce(\n            (amount, item) => amount + item.quantity,\n            0\n        );\n        this.total_cost = this.items.reduce(\n            (amount, item) => amount + (item.total_cost || 0),\n            0\n        );\n        this.charge_code = data.charge_code || '';\n        this.status = data.status || 'accepted';\n        this.invoice_number = data.invoice_number || '';\n        this.event = data.event || null;\n        this.deliver_at =\n            data.deliver_at ||\n            (data as any).date ||\n            this.event?.date ||\n            new Date().getTime();\n    }\n}\n","import { HashMap } from '@placeos/common';\nimport {\n    addMinutes, addSeconds,\n\n    differenceInMinutes,\n    format,\n    isAfter,\n    isBefore,\n    isSameMinute,\n    startOfMinute\n} from 'date-fns';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport {\n    BookingRuleDetails,\n    BookingRules,\n    BookingRuleset,\n    BookingRulesmap,\n    RecurrenceDetails,\n    TimeBlock,\n    TimePeriod\n} from './event.interfaces';\n\nexport function eventStatus(\n    details: HashMap\n): 'approved' | 'tentative' | 'declined' {\n    if (details.resources?.length) {\n        if (details.resources.every((i) => i.response_status === 'accepted')) {\n            return 'approved';\n        } else if (\n            details.resources.some(\n                (i) =>\n                    i.response_status === 'tentative' ||\n                    i.response_status === 'needsAction'\n            )\n        ) {\n            return 'tentative';\n        }\n        return 'declined';\n    }\n    return 'approved';\n}\n\nexport function formatRecurrence({\n    interval,\n    pattern,\n    end,\n}: RecurrenceDetails) {\n    let details = '';\n    if (interval) {\n        switch (pattern) {\n            case 'daily':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} days` : 'Daily'\n                );\n                break;\n            case 'weekly':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} weeks` : 'Weekly'\n                );\n                break;\n            case 'monthly':\n                details = details.concat(\n                    interval > 1 ? `Every ${interval} months` : 'Monthly'\n                );\n                break;\n        }\n        details = details.concat(`, until ${format(end, 'MMM do, yyyy')}`);\n    }\n    return details;\n}\n\n/**\n * Generate a list of free time slots between the given bookings\n * @param list List of bookings to find slots between\n * @param min_size Minimum length of a free slot in minutes\n */\nexport function getFreeTimeSlots(\n    list: TimePeriod[],\n    min_size: number = 30\n): TimeBlock[] {\n    let start = new Date(0);\n    const slots: TimeBlock[] = [];\n    list.sort((a, b) => a.date - b.date);\n    for (const booking of list) {\n        const bkn_start = new Date(booking.date);\n        const bkn_end = addMinutes(booking.date, booking.duration);\n        if (isAfter(booking.date, start)) {\n            const diff = Math.abs(differenceInMinutes(bkn_start, start));\n            if (diff >= min_size) {\n                slots.push({\n                    start: start.valueOf(),\n                    end: booking.date,\n                });\n            }\n            start = bkn_end;\n        } else if (isSameMinute(start, booking.date)) {\n            start = bkn_end;\n        }\n    }\n    slots.push({\n        start: start.valueOf(),\n        end: start.valueOf() * 10,\n    });\n    return slots;\n}\n\n/**\n * Get the next free time slot from the given bookings\n * @param list List of bookings to find the next slot\n * @param date Date to find next slot after in ms since UTC epoch\n * @param min_size Minimum length of the free slot in minutes\n */\nexport function getNextFreeTimeSlot(\n    list: TimePeriod[],\n    date: number = new Date().valueOf(),\n    min_size: number = 30\n): TimeBlock {\n    const slots = getFreeTimeSlots(list, min_size);\n    const time = addSeconds(startOfMinute(date), 1);\n    for (const block of slots) {\n        if (isAfter(block.start, time)) {\n            return block;\n        } else if (isBefore(time, block.end)) {\n            const duration = differenceInMinutes(block.end, time);\n            if (duration >= min_size) return block;\n        }\n    }\n    return slots[slots.length - 1];\n}\n\nconst MINUTE = 1;\nconst HOUR = 60;\nconst DAY = 24 * HOUR;\nconst WEEK = 7 * DAY;\nconst MONTH = 30 * DAY;\n\nconst DURATION_MAP: { [duration: string]: number } = {\n    month: MONTH,\n    months: MONTH,\n    week: WEEK,\n    weeks: WEEK,\n    day: DAY,\n    days: DAY,\n    hour: HOUR,\n    hours: HOUR,\n    minute: MINUTE,\n    minutes: MINUTE,\n};\n\nconst DEFAULT_RULES: BookingRules = {\n    auto_approve: true,\n    hidden: false,\n};\n\n/**\n * Conver time string into minutes\n * @param str timestring e.g. `'1 day'`, `'15 minutes'`, `'2 weeks'`\n */\nexport function stringToMinutes(str: string): number {\n    const parts = (str || '').split(' ');\n    return parts.length > 1 ? +parts[0] * DURATION_MAP[parts[1]] : 0;\n}\n\nexport function addToDate(add: string, date: Date | number = new Date()) {\n    return addMinutes(date, stringToMinutes(add));\n}\n\nexport function filterSpacesFromRules(\n    spaces: Space[],\n    details: BookingRuleDetails,\n    rulemap: BookingRulesmap\n) {\n    return spaces.filter(\n        (_) => !rulesForSpace({ ...details, space: _ }, rulemap)?.hidden\n    );\n}\n\nexport function rulesForSpace(\n    details: BookingRuleDetails,\n    rulemap: BookingRulesmap\n): BookingRules {\n    const { space } = details;\n    for (const zone of space.zones) {\n        if (rulemap[zone]?.length) {\n            for (const ruleset of rulemap[zone]) {\n                if (ruleset && checkRulesMatch(details, ruleset))\n                    return { ...DEFAULT_RULES, ...ruleset.rules };\n            }\n        }\n    }\n    return DEFAULT_RULES;\n}\n\nexport function checkRulesMatch(\n    { date, duration, host }: BookingRuleDetails,\n    ruleset: BookingRuleset\n): boolean {\n    let matches = 0;\n    const { conditions } = ruleset;\n    if (!conditions) return true;\n    if (\n        conditions.groups instanceof Array &&\n        conditions.groups.every((_) => host?.groups?.includes(_))\n    )\n        matches += 1;\n    if (\n        conditions.is_before &&\n        isBefore(addMinutes(date, duration), addToDate(conditions.is_before))\n    )\n        matches += 1;\n    if (conditions.is_after && isAfter(date, addToDate(conditions.is_after)))\n        matches += 1;\n    if (\n        conditions.min_length &&\n        stringToMinutes(conditions.min_length) <= duration\n    )\n        matches += 1;\n    if (\n        conditions.max_length &&\n        stringToMinutes(conditions.max_length) >= duration\n    )\n        matches += 1;\n    return matches >= Object.keys(conditions).length;\n}\n","import { HashMap, Identity, unique } from '@placeos/common';\nimport { PlaceSystem } from '@placeos/ts-client';\nimport {\n    add,\n    addMinutes,\n    differenceInMinutes,\n    getUnixTime,\n    isAfter,\n    isBefore,\n    isSameDay,\n    roundToNearestMinutes,\n    set,\n} from 'date-fns';\nimport { CateringOrder } from 'libs/catering/src/lib/catering-order.class';\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { GuestUser, User } from 'libs/users/src/lib/user.class';\nimport {\n    EventExtensionData,\n    FileDetails,\n    RecurrenceDetails,\n} from './event.interfaces';\nimport { eventStatus } from './helpers';\n\nlet _default_user: Identity = { id: 'default', name: 'Default User' };\n\nexport function setDefaultCreator(user: Identity) {\n    if (user) _default_user = user;\n}\n\ntype CalendarEventExtended = CalendarEvent & EventExtensionData;\n\n/** User's calendar event/booking */\nexport class CalendarEvent {\n    /** ID of the calendar event */\n    public readonly id: string;\n    /** Status of the event */\n    public readonly status: 'approved' | 'tentative' | 'declined' | 'none';\n    /** Email address of the host */\n    public readonly host: string;\n    /** ID of the calendar associated with the event */\n    public readonly calendar: string;\n    /** Email address of the event creator */\n    public readonly creator: string;\n    /** List of attendees of the event */\n    public readonly attendees: User[];\n    /** List of attendees of the event */\n    public readonly resources: Space[];\n    /** Summary of the event details */\n    public readonly title: string;\n    /** Extended details of the event */\n    public readonly body: string;\n    /** Unix epoch in seconds of the start time of the event */\n    public readonly event_start: number;\n    /** Unix epoch in seconds of the end time of the event */\n    public readonly event_end: number;\n    /** Whether event occurs over the full day */\n    public readonly all_day: boolean;\n    /** Unix epoch of the start time of the event */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** IANA timezone string for the event location */\n    public readonly timezone: string;\n    /** Location details for the event */\n    public readonly location: string;\n    /** Whether this event is recurring */\n    public readonly recurring: boolean;\n    /** Details about the event's recurrence */\n    public readonly recurrence: RecurrenceDetails;\n    /** ID of the parent recurring event */\n    public readonly recurring_master_id: string;\n    /** Whether event details should be private */\n    public readonly private: boolean;\n    /** File attachements for the event */\n    public readonly attachments: FileDetails[];\n    /** Extra data associated with the event */\n    public readonly extension_data: Partial<EventExtensionData>;\n    /** System associated with the event */\n    public readonly system: PlaceSystem;\n    /** Previous system associated with the event */\n    public readonly old_system: PlaceSystem;\n    /** Host user details of the event */\n    public readonly organiser: User;\n    /** Type of event */\n    public readonly type: 'cancelled' | 'external' | 'internal';\n    /** Master event */\n    public master?: CalendarEvent;\n\n    /** Get field from extension data */\n    public ext<K extends keyof EventExtensionData>(key: K) {\n        return this.extension_data[key];\n    }\n\n    constructor(data: Partial<CalendarEventExtended> = {}) {\n        this.id = data.id || '';\n        this.event_start =\n            data.event_start ||\n            getUnixTime(\n                data.date ||\n                    roundToNearestMinutes(addMinutes(new Date(), 3), {\n                        nearestTo: 5,\n                    })\n            );\n        this.event_end =\n            data.event_end ||\n            getUnixTime(\n                addMinutes(this.event_start * 1000, data.duration || 30)\n            );\n        this.calendar = data.calendar || '';\n        this.creator =\n            (data.creator || _default_user.email)?.toLowerCase() || '';\n        this.host = (\n            data.host ||\n            this.creator ||\n            _default_user.email ||\n            ''\n        ).toLowerCase();\n        const attendees: HashMap = data.attendees || [];\n        this.attendees = attendees\n            .filter((user: any) => !user.resource)\n            .map((u) => new User(u));\n        this.resources =\n            unique(\n                data.resources ||\n                    attendees\n                        .filter((user) => user.resource)\n                        .map((s) => new Space(s)),\n                'email'\n            ) || [];\n        this.title = data.title || '';\n        this.body = data.body || '';\n        this.private = !!data.private;\n        this.all_day = !!data.all_day;\n        this.date = this.event_start * 1000;\n        this.duration = this.all_day\n            ? 24 * 60\n            : data.duration ||\n              differenceInMinutes(data.event_end * 1000, this.date) ||\n              30;\n        this.timezone = data.timezone || '';\n        this.location = data.location || '';\n        this.recurring = !!data.recurring;\n        this.recurring_master_id = data.recurring_master_id || '';\n        this.organiser = this.attendees.find(\n            (user) => user.email === this.host\n        );\n        this.master = data.master ? new CalendarEvent(data.master) : null;\n        if (data.recurring) {\n            this.recurrence = {\n                start:\n                    this.event_start * 1000 ||\n                    new Date(\n                        (data.recurrence as any).range_start * 1000\n                    ).valueOf(),\n                end:\n                    data.recurrence.end ||\n                    new Date(\n                        (data.recurrence as any).range_end * 1000\n                    ).valueOf(),\n                interval: data.recurrence.interval,\n                pattern: data.recurrence.pattern,\n                days_of_week: data.recurrence.days_of_week,\n            };\n        } else {\n            this.recurrence = {} as any;\n        }\n        const system = data.system;\n        if (\n            system?.email &&\n            !this.resources.find((_) => _.email === system.email)\n        ) {\n            this.resources.push(new Space(system as any));\n        }\n        this.system = system || (this.resources[0] as any) || null;\n        this.old_system = data.old_system || data.system;\n        this.attachments = data.attachments || [];\n        this.extension_data = data.extension_data || {};\n        this.status = eventStatus(this) || 'none';\n        this.type =\n            this.status === 'declined'\n                ? 'cancelled'\n                : this.attendees.find((_) => _.is_external)\n                ? 'external'\n                : 'internal';\n        for (const key in data) {\n            if (!(key in this)) {\n                this.extension_data[key] =\n                    data[key] || this.extension_data[key];\n            }\n        }\n        this.extension_data.catering = (this.extension_data.catering || []).map(\n            (i) => new CateringOrder({ ...i, event: this })\n        );\n    }\n\n    /** List of external attendees associated with the event */\n    public get guests() {\n        return this.attendees.filter((f) => !!f.is_external) as GuestUser[];\n    }\n    /** Primary space associated with the booking */\n    public get space() {\n        return this.resources[0] || null;\n    }\n    public get is_today(): boolean {\n        return isSameDay(new Date(this.date), new Date());\n    }\n\n    /**\n     * Convert class data to simple JSON object\n     */\n    public toJSON(): HashMap {\n        const obj: HashMap = { ...this };\n        const end = getUnixTime(addMinutes(this.date, this.duration));\n        const date = this.all_day ? set(this.date, { hours: 12 }) : this.date;\n        obj.event_start = getUnixTime(date);\n        obj.event_end = end;\n        const attendees = this.attendees;\n        if (this.recurring) {\n            obj.recurrence = {\n                ...this.recurrence,\n                range_start: obj.event_start,\n                range_end: getUnixTime(this.recurrence.end),\n            };\n        }\n        obj.recurrence = obj.recurrence\n            ? Object.keys(obj.recurrence).length\n                ? obj.recurrence\n                : null\n            : null;\n        obj.attendees = unique(attendees, 'email');\n        if (!this.all_day) {\n            obj.extension_data.breakdown = 15;\n        }\n        obj.extension_data.catering = obj.extension_data.catering.map(\n            (i) => new CateringOrder({ ...i, event: null })\n        );\n        obj.system_id = this.system?.id;\n        delete obj.catering;\n        delete obj.date;\n        delete obj.duration;\n        delete obj.status;\n        return obj;\n    }\n\n    /** Status of the booking */\n    public get state():\n        | 'future'\n        | 'upcoming'\n        | 'done'\n        | 'started'\n        | 'in_progress' {\n        const now = new Date();\n        const date = this.date;\n        if (isBefore(now, add(date, { minutes: -15 }))) return 'future';\n        if (isBefore(now, date)) return 'upcoming';\n        if (isBefore(now, add(date, { minutes: 15 }))) return 'started';\n        if (isBefore(now, add(date, { minutes: this.duration })))\n            return 'in_progress';\n        return 'done';\n    }\n\n    public get can_check_in(): boolean {\n        const now = new Date();\n        return (\n            this.is_today ||\n            (isAfter(now, this.date) &&\n                isBefore(now, addMinutes(this.date, this.duration)))\n        );\n    }\n}\n","import { get } from '@placeos/ts-client';\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { StaffUser } from './user.class';\n\nconst STAFF_ENDPOINT = '/api/staff/v1/people';\n\n/**\n * Search staff members\n * @param q Search string for filtering staff\n */\nexport function searchStaff(q: string): Observable<StaffUser[]> {\n    const query = toQueryString({ q });\n    return get(`${STAFF_ENDPOINT}${q ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new StaffUser(item)))\n    );\n}\n\n/**\n * Get user details\n * @param id User ID or email\n */\nexport function showStaff(id: string) {\n    return get(`${STAFF_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n\n/**\n * Get user with their location details\n * @param email User email\n */\nexport function locateStaff(email: string) {\n    return get(`${STAFF_ENDPOINT}/${email}`).pipe(\n        map((item) => new StaffUser(item))\n    );\n}\n","import { NgModule, Type } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatInputModule } from '@angular/material/input';\nimport { MatSelectModule } from '@angular/material/select';\nimport { MatAutocompleteModule } from '@angular/material/autocomplete';\n\nimport { ComponentsModule } from '@placeos/components';\n\nimport { ActionFieldComponent } from './action-field.component';\nimport { CounterComponent } from './counter.component';\nimport { DateFieldComponent } from './date-field.component';\nimport { DurationFieldComponent } from './duration-field.component';\nimport { TimeFieldComponent } from './time-field.component';\nimport { UserListFieldComponent } from './user-list-field.component';\nimport { UserSearchFieldComponent } from './user-search-field.component';\nimport { ItemListFieldComponent } from './item-list-field.component';\nimport { MatTooltipModule } from '@angular/material/tooltip';\nimport { MatCheckboxModule } from '@angular/material/checkbox';\n\nexport * from './action-field.component';\nexport * from './counter.component';\nexport * from './date-field.component';\nexport * from './duration-field.component';\nexport * from './time-field.component';\nexport * from './user-list-field.component';\nexport * from './user-search-field.component';\n\nconst COMPONENTS: Type<any>[] = [\n    ActionFieldComponent,\n    CounterComponent,\n    DateFieldComponent,\n    DurationFieldComponent,\n    TimeFieldComponent,\n    UserListFieldComponent,\n    UserSearchFieldComponent,\n    ItemListFieldComponent,\n];\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatFormFieldModule,\n        MatInputModule,\n        MatSelectModule,\n        MatAutocompleteModule,\n        MatTooltipModule,\n        MatCheckboxModule,\n        ComponentsModule,\n    ],\n    exports: [...COMPONENTS],\n})\nexport class FormFieldsModule {}\n","import { Component, EventEmitter, Input, Output } from '@angular/core';\nimport { Space } from './space.class';\n\n@Component({\n    selector: 'a-space-select-item',\n    template: `\n        <div\n            space\n            class=\"w-full flex items-center p-2 space-x-2 border-b border-gray-100\"\n            *ngIf=\"space\"\n        >\n            <div class=\"flex-1 w-1/2\">\n                <div class=\"text-base truncate\">{{ space.name }}</div>\n                <div class=\"text-xs\">\n                    {{ space.level?.display_name || space.level?.name }}\n                </div>\n            </div>\n            <div class=\"flex items-center\" *ngIf=\"space.capacity !== -1\">\n                <app-icon>account_circle</app-icon>\n                <div>{{ space.capacity }}</div>\n            </div>\n            <button\n                mat-icon-button\n                *ngIf=\"multiple; else single_button\"\n                (click)=\"action.emit()\"\n            >\n                <app-icon>{{\n                    type === 'available' ? 'add' : 'close'\n                }}</app-icon>\n            </button>\n        </div>\n        <ng-template #single_button>\n            <button mat-button class=\"w-32\" [class.request]=\"space.by_request\">\n                {{ space.by_request ? 'Request' : 'Book' }}\n            </button>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class SpaceSelectItemComponent {\n    /** Space to display the details */\n    @Input() public space: Space;\n    /** Selected state for the space */\n    @Input() public type: 'available' | 'selected';\n    /** Whether user is allowed to select multiple spaces */\n    @Input() public multiple: boolean;\n    /** Emitter for selection actions */\n    @Output() public action = new EventEmitter();\n}\n","import { differenceInMinutes } from 'date-fns';\n\nimport { Space } from 'libs/spaces/src/lib/space.class';\n\nimport { CalendarAvailability } from './calendar.interfaces';\n\nexport class Calendar {\n    /** ID of the calendar */\n    public readonly id: string;\n    /** Name of the calendar */\n    public readonly name: string;\n    /** System associated with the calendar */\n    public readonly resource: Space;\n    /** Primary calendar of the user */\n    public readonly primary: boolean;\n    /** Summary */\n    public readonly summary: string;\n    /** Whether the user can edit events associated to this calendar */\n    public readonly can_edit: boolean;\n    /** Availability */\n    public readonly availability: CalendarAvailability[];\n    /** Whether calendar should be hidden from the user */\n    public readonly hidden: boolean;\n\n    constructor(data: Partial<Calendar> = {}) {\n        this.id = data.id || '';\n        this.name = data.name || '';\n        this.primary = !!data.primary;\n        this.summary = data.summary || '';\n        this.can_edit = !!data.can_edit;\n        this.resource = new Space(data.resource || (data as any).system);\n        this.availability = (data.availability || []).map(\n            ({ starts_at, ends_at, date, duration, status }: any) => {\n                return {\n                    date: new Date(date, starts_at).valueOf(),\n                    duration:\n                        duration || differenceInMinutes(ends_at, starts_at),\n                    status: status,\n                };\n            }\n        );\n        this.hidden = !!data.hidden;\n    }\n}\n","import { get } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { Space } from 'libs/spaces/src/lib/space.class';\nimport { Calendar } from './calendar.class';\nimport { CalendarAvailabilityQueryParams } from './calendar.interfaces';\n\nconst CALENDAR_ENDPOINT = '/api/staff/v1/calendars';\n\n/** List calendars associated with the logged in user */\nexport function queryCalendars(): Observable<Calendar[]> {\n    return get(CALENDAR_ENDPOINT).pipe(\n        map((i) => i.map((c) => new Calendar(c)))\n    );\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function queryCalendarAvailability(\n    q: CalendarAvailabilityQueryParams\n): Observable<Calendar[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/availability${query ? '?' + query : ''}`\n    ).pipe(map((i) => i.map((c) => new Calendar(c))));\n}\n\nconst calendarsToSpaces = (org?) =>\n    map((list: Calendar[]) =>\n        list\n            .filter((cal) => !!cal.resource)\n            .map(\n                (cal) =>\n                    new Space({\n                        ...cal.resource,\n                        level: org?.levelWithID(cal.resource.zones),\n                        availability: cal.availability,\n                    })\n            )\n            .filter((space) => space.bookable)\n    );\n\n/** List available spaces based on the given query */\nexport function querySpaceAvailability(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    return queryCalendarAvailability(q).pipe(calendarsToSpaces(org));\n}\n\n/** List room calendars for available spaces based on the given query */\nexport function querySpaceFreeBusy(\n    q: CalendarAvailabilityQueryParams,\n    org?: OrganisationService\n): Observable<Space[]> {\n    const query = toQueryString(q);\n    return get(\n        `${CALENDAR_ENDPOINT}/free_busy${query ? '?' + query : ''}`\n    ).pipe(\n        map((i) => i.map((c) => new Calendar(c))),\n        calendarsToSpaces(org)\n    );\n}\n","import { Component, Inject, Output, EventEmitter } from '@angular/core';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map, shareReplay, switchMap, tap } from 'rxjs/operators';\nimport { addMinutes, getUnixTime } from 'date-fns';\n\nimport {\n    BaseClass,\n    currentUser,\n    DialogEvent,\n    HashMap,\n    Identity,\n    SettingsService,\n} from '@placeos/common';\nimport { Building, OrganisationService } from '@placeos/organisation';\n\nimport { filterSpacesFromRules } from 'libs/events/src/lib/helpers';\nimport { querySpaceFreeBusy } from 'libs/calendar/src/lib/calendar.fn';\nimport { Space } from './space.class';\n\nexport interface SpaceSelectModalData {\n    /** List of currently selected spaces */\n    readonly spaces: Space[];\n    /** Selected date to check space availability */\n    readonly date: number;\n    /** Duration of the availability that is desired */\n    readonly duration: number;\n    all_day?: boolean;\n    visitor_type?: string;\n}\n\n@Component({\n    selector: 'a-space-select-modal',\n    template: `\n        <header>\n            <app-icon class=\"text-3xl\">place</app-icon>\n            <div class=\"text-xl font-semibold flex-1\">\n                Select space{{ multiple ? 's' : '' }}\n            </div>\n            <button mat-icon-button mat-dialog-close>\n                <app-icon class=\"text-3xl\">close</app-icon>\n            </button>\n        </header>\n        <main>\n            <mat-form-field\n                appearance=\"outline\"\n                *ngIf=\"buildings && buildings.length > 1\"\n            >\n                <mat-select\n                    name=\"booking-type\"\n                    [ngModel]=\"building.getValue()\"\n                    (ngModelChange)=\"building.next($event)\"\n                    placeholder=\"Select building\"\n                >\n                    <mat-option *ngFor=\"let bld of buildings\" [value]=\"bld\">\n                        {{ bld.display_name || bld.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <mat-form-field\n                appearance=\"outline\"\n                *ngIf=\"space_types && space_types.length > 1\"\n            >\n                <mat-select\n                    name=\"booking-type\"\n                    [(ngModel)]=\"type\"\n                    placeholder=\"Any space type\"\n                >\n                    <mat-option\n                        *ngFor=\"let type of space_types\"\n                        [value]=\"type.id\"\n                    >\n                        {{ type.name }}\n                    </mat-option>\n                </mat-select>\n            </mat-form-field>\n            <div class=\"body\" style=\"width: 32rem\">\n                <ng-container *ngIf=\"!loading; else load_state\">\n                    <ng-container\n                        *ngIf=\"\n                            (filtered_spaces | async)?.length;\n                            else empty_state\n                        \"\n                    >\n                        <ng-container\n                            *ngFor=\"let space of filtered_spaces | async\"\n                        >\n                            <a-space-select-item\n                                *ngIf=\"!space_map[space.id]\"\n                                [space]=\"space\"\n                                [multiple]=\"multiple\"\n                                type=\"available\"\n                                (click)=\"spaceSelected(space)\"\n                            ></a-space-select-item>\n                        </ng-container>\n                    </ng-container>\n                </ng-container>\n                <div\n                    class=\"space-list\"\n                    *ngIf=\"multiple\"\n                    [class.show]=\"show_selected\"\n                >\n                    <ng-container\n                        *ngIf=\"spaces && spaces.length; else empty_state\"\n                    >\n                        <a-space-select-item\n                            *ngFor=\"let space of spaces\"\n                            [space]=\"space\"\n                            [multiple]=\"multiple\"\n                            type=\"selected\"\n                        ></a-space-select-item>\n                    </ng-container>\n                </div>\n            </div>\n            <footer *ngIf=\"multiple\">\n                <button mat-button (click)=\"save()\">\n                    Save selected spaces({{ spaces.length || '0' }})\n                </button>\n            </footer>\n            <ng-template #empty_state>\n                <div empty class=\"p-16 flex flex-col items-center space-y-2\">\n                    <app-icon class=\"text-3xl\">close</app-icon>\n                    <p>No spaces</p>\n                </div>\n            </ng-template>\n            <ng-template #load_state>\n                <div load class=\"p-16 flex flex-col items-center space-y-2\">\n                    <mat-spinner diameter=\"48\"></mat-spinner>\n                    <p>Finding available spaces...</p>\n                </div>\n            </ng-template>\n        </main>\n    `,\n    styles: [\n        `\n            mat-form-field {\n                height: 3.5em;\n                width: 100%;\n                padding: 0 0.25em;\n            }\n\n            .body {\n                min-width: 20rem;\n                max-width: calc(100vw - 2rem);\n                max-height: 65vh;\n                overflow: auto;\n            }\n        `,\n    ],\n})\nexport class SpaceSelectModalComponent extends BaseClass {\n    /** Emitter for user action on the modal */\n    @Output() public event = new EventEmitter<DialogEvent>();\n    /** List of selected spaces */\n    public spaces: Space[] = [...(this._data.spaces || [])];\n    /** Building to filter available spaces */\n    public building = new BehaviorSubject<Building>(null);\n    /** Whether to show selected spaces */\n    public show_selected: boolean;\n    /** List of available space types */\n    public space_types: Identity[] = [];\n    /** ID of the space type to filter available spaces on */\n    public type: string;\n    /** Whether the available spaces are being loaded */\n    public loading: boolean;\n\n    public readonly available_spaces = combineLatest([this.building]).pipe(\n        switchMap(([bld]) => {\n            this.loading = true;\n            return querySpaceFreeBusy({\n                zone_ids: bld?.id,\n                period_start: getUnixTime(this._data.date),\n                period_end: getUnixTime(\n                    addMinutes(this._data.date, this._data.duration)\n                ),\n            });\n        }),\n        shareReplay(1)\n    );\n\n    public readonly filtered_spaces = this.available_spaces.pipe(\n        map((list) =>\n            filterSpacesFromRules(\n                list,\n                { ...this._data, host: currentUser() } as any,\n                this._org.building.booking_rules\n            )\n        ),\n        tap(() => (this.loading = false))\n    );\n\n    public get buildings(): Building[] {\n        return this._org.buildings;\n    }\n\n    /** Whether multiple spaces can be selected */\n    public get multiple(): boolean {\n        return !!this._settings.get('app.booking.multiple_spaces');\n    }\n\n    /** Mapping of spaces to whether they are selected */\n    public get space_map(): HashMap<boolean> {\n        const spaces = {};\n        this.spaces.forEach((space) => (spaces[space.id] = true));\n        return spaces;\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        @Inject(MAT_DIALOG_DATA) private _data: SpaceSelectModalData\n    ) {\n        super();\n        this.building.next(this._org.building || this.buildings[0]);\n        this.subscription(\n            'spaces',\n            this.filtered_spaces.subscribe((_) => _)\n        );\n    }\n\n    public spaceSelected(space: Space) {\n        if (this.multiple) {\n            if (!this.space_map[space.id]) {\n                this.spaces.push(space);\n            }\n        } else {\n            this.spaces = [space];\n            this.save();\n        }\n    }\n\n    public save() {\n        this.event.emit({ reason: 'done', metadata: this.spaces });\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { MatDialogModule } from '@angular/material/dialog';\n\nimport { ComponentsModule } from '@placeos/components';\n\nimport { SpaceSelectItemComponent } from './space-select-item.component';\nimport { SpaceSelectModalComponent } from './space-select-modal.component';\n\nconst COMPONENTS: Type<any>[] = [\n    SpaceSelectModalComponent,\n    SpaceSelectItemComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [CommonModule, MatDialogModule, ComponentsModule],\n    providers: [],\n    exports: [...COMPONENTS],\n})\nexport class SharedSpacesModule {}\n","import { HashMap, predictableRandomInt } from '@placeos/common';\nimport { USER_DOMAIN } from '../../../users/src/lib/user.utilities';\n\nlet SPACE_COUNT: number = 0;\n/* istanbul ignore next */\nexport function generateMockSpace(overrides: HashMap = {}): HashMap {\n    const id = `space-${SPACE_COUNT++}`;\n    const name = `Test Space ${SPACE_COUNT}`;\n    const linked = predictableRandomInt(99999) % 2 === 0 && SPACE_COUNT > 1;\n    const space = {\n        id,\n        name,\n        long_name: `${name} with an long name`,\n        map_id: `${SPACE_COUNT}`,\n        capacity: predictableRandomInt(21, 1) * 2,\n        email: `${name.toLowerCase().split(' ').join('.')}@${USER_DOMAIN}`,\n        type: '',\n        searchable: predictableRandomInt(99999) % 2 === 0,\n        controlable: predictableRandomInt(99999) % 2 === 0,\n        bookable: predictableRandomInt(99999) % 2 === 0,\n        cost_hour: predictableRandomInt(300) * 100,\n        setup: predictableRandomInt(6) * 5,\n        breakdown: predictableRandomInt(6) * 5,\n        zones: ['zone_lvl-0'],\n        support_url: `/control/#/panel/${id}`,\n        bookings: [], //Array(10).fill(0).map(i => generateMockBooking()),\n        linked_rooms: linked\n            ? [`space-${predictableRandomInt(SPACE_COUNT - 1)}`]\n            : [],\n        image: '',\n        ...overrides,\n    };\n    if (space['configurations'] && space['configurations'].length > 0) {\n        space['configurations'].forEach(\n            (config) =>\n                (config.capacity = predictableRandomInt(space.capacity) + 1)\n        );\n        space['configurations'][0].capacity = space.capacity;\n    }\n    return space;\n}\n","import { Injectable } from '@angular/core';\nimport {\n    Point,\n    ViewAction,\n    ViewerFeature,\n    ViewerLabel,\n    ViewerStyles,\n} from '@placeos/svg-viewer';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { debounceTime, filter, first, map } from 'rxjs/operators';\n\nimport { BaseClass, HashMap, SettingsService, unique } from '@placeos/common';\nimport { BuildingLevel, OrganisationService } from '@placeos/organisation';\nimport { SpacesService } from '@placeos/spaces';\n\nexport interface MapOptions {\n    /** List of keys to ignore for any map resource */\n    disable?: string[];\n    /** List of keys to ignore for map labels */\n    disable_labels?: string[];\n    /** List of keys to ignore for map actions */\n    disable_actions?: string[];\n    /** List of keys to ignore for map features */\n    disable_features?: string[];\n    /** List of keys to ignore for map styles */\n    disable_styles?: string[];\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class ExploreStateService extends BaseClass {\n    /** Currently active level */\n    private _level = new BehaviorSubject<BuildingLevel>(null);\n    /** Currently active level */\n    private _positions = new BehaviorSubject<{ zoom: number; center: Point }>({\n        zoom: 1,\n        center: { x: 0.5, y: 0.5 },\n    });\n    /** Mapping of groups to their styles */\n    private _styles = new BehaviorSubject<HashMap<ViewerStyles>>({});\n    /** Mapping of groups to their features */\n    private _features = new BehaviorSubject<HashMap<ViewerFeature[]>>({});\n    /** Mapping of groups to their actions */\n    private _actions = new BehaviorSubject<HashMap<ViewAction[]>>({});\n    /** Mapping of groups to their actions */\n    private _labels = new BehaviorSubject<HashMap<ViewerLabel[]>>({});\n\n    private _options = new BehaviorSubject<MapOptions>({\n        disable: ['zones', 'devices'],\n    });\n\n    private _message = new BehaviorSubject<string>('');\n\n    /** Currently active level */\n    public readonly level = this._level.asObservable();\n    /** Currently active level */\n    public readonly message = this._message.asObservable();\n    /** Spaces associated with the active level */\n    public readonly spaces = combineLatest([\n        this._level,\n        this._spaces.list,\n    ]).pipe(\n        map(([level, spaces]) =>\n            spaces.filter((space) => space.zones.includes(level?.id))\n        )\n    );\n    /** Currently shown space's map URL */\n    public readonly map_url = this._level.pipe(\n        map((lvl) => (lvl ? lvl.map_id : '') || '')\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_positions = this._positions.asObservable();\n    /** Currently center and zoom positions for map */\n    public readonly map_features = combineLatest([\n        this._features,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([features, options]) => {\n            let list = [];\n            for (const key in features) {\n                if (\n                    options.disable?.includes(key) ||\n                    options.disable_features?.includes(key)\n                )\n                    continue;\n                list = list.concat(features[key]);\n            }\n            return list;\n        })\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_actions = combineLatest([\n        this._actions,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([actions, options]) => {\n            let list = [];\n            for (const key in actions) {\n                if (\n                    options.disable?.includes(key) ||\n                    options.disable_actions?.includes(key)\n                )\n                    continue;\n                list = list.concat(actions[key]);\n            }\n            return list;\n        })\n    );\n    /** Currently center and zoom positions for map */\n    public readonly map_labels = combineLatest([\n        this._labels,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([labels, options]) => {\n            let list = [];\n            for (const key in labels) {\n                if (\n                    options.disable?.includes(key) ||\n                    options.disable_labels?.includes(key)\n                )\n                    continue;\n                list = list.concat(labels[key]);\n            }\n            return list;\n        })\n    );\n    /** Current map styles */\n    public readonly map_styles = combineLatest([\n        this._styles,\n        this._options,\n    ]).pipe(\n        debounceTime(200),\n        map(([styles, options]) => {\n            let style_mappings = { text: { display: 'none' } };\n            for (const key in styles) {\n                if (\n                    options.disable?.includes(key) ||\n                    options.disable_styles?.includes(key)\n                )\n                    continue;\n                style_mappings = { ...style_mappings, ...styles[key] };\n            }\n            if (options.disable?.includes('zones')) {\n                style_mappings['#zones'] = { display: 'none' };\n                style_mappings['#Zones'] = { display: 'none' };\n            }\n            return style_mappings;\n        })\n    );\n\n    public readonly options = this._options.asObservable();\n\n    public get positions() {\n        return this._positions.getValue();\n    }\n\n    public get active_level() {\n        return this._level.getValue();\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _spaces: SpacesService,\n        private _settings: SettingsService\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this._org.active_building.pipe(filter((_) => !!_)).subscribe((bld) => {\n            const level = this._level.getValue();\n            const level_list = this._org.levelsForBuilding(bld);\n            const has_level = level_list.find((lvl) => level?.id === lvl.id);\n            if (!has_level && level_list.length) {\n                this.setLevel(level_list[0].id);\n            }\n            if (this._settings.get('app.explore.disable_actions')) {\n                this.setOptions({\n                    disable_actions: this._settings.get(\n                        'app.explore.disable_actions'\n                    ),\n                });\n            }\n            if (this._settings.get('app.explore.disable_labels')) {\n                this.setOptions({\n                    disable_labels: this._settings.get(\n                        'app.explore.disable_labels'\n                    ),\n                });\n            }\n            if (this._settings.get('app.explore.disable_features')) {\n                this.setOptions({\n                    disable_features: this._settings.get(\n                        'app.explore.disable_features'\n                    ),\n                });\n            }\n            if (this._settings.get('app.explore.disable_styles')) {\n                this.setOptions({\n                    disable_styles: this._settings.get(\n                        'app.explore.disable_styles'\n                    ),\n                });\n            }\n        });\n    }\n\n    public setOptions(options: MapOptions) {\n        const old_options = this._options.getValue();\n        const disable = unique([\n            ...(options.disable || old_options.disable),\n            ...(this._settings.get('app.explore.disable') || []),\n        ]);\n        this._options.next({\n            ...this._options.getValue(),\n            ...options,\n            disable,\n        });\n    }\n\n    public setLevel(zone_id: string) {\n        const lvl = this._org.levelWithID([zone_id]);\n        if (lvl) {\n            this._level.next(lvl);\n        }\n    }\n\n    public setStyles(name: string, styles: ViewerStyles) {\n        const style_map = this._styles.getValue();\n        style_map[name] = styles;\n        this._styles.next(style_map);\n    }\n\n    public setFeatures(name: string, features: ViewerFeature[]) {\n        const feature_map = this._features.getValue();\n        feature_map[name] = features;\n        this._features.next(feature_map);\n    }\n\n    public setActions(name: string, actions: ViewAction[]) {\n        const actions_map = this._actions.getValue();\n        actions_map[name] = actions;\n        this._actions.next(actions_map);\n    }\n\n    public setLabels(name: string, labels: ViewerLabel[]) {\n        const labels_map = this._labels.getValue();\n        labels_map[name] = labels;\n        this._labels.next(labels_map);\n    }\n\n    public setPositions(zoom: number, center: Point) {\n        this._positions.next({ zoom, center });\n    }\n}\n","import { del, get, patch, post, put } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { GuestUser } from 'libs/users/src/lib/user.class';\n\nimport { CalendarEvent } from './event.class';\n\nexport interface CalendarEventQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zone_ids?: string;\n    /** Comma seperated list of system(space) ids to check availability */\n    system_ids?: string;\n    /** Comma seperated list of calendar ids to check availability */\n    calendars?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n    /** Whether to include cancelled events in the returned list */\n    include_cancelled?: boolean;\n}\n\nexport interface CalendarEventShowParams {\n    /** ID of the personal calendar to grab the events details from */\n    calendar?: string;\n    /** ID of the system/space to get the associated calendar ID */\n    system_id?: string;\n}\n\nconst EVENTS_ENDPOINT = `/api/staff/v1/events`;\n\n/**\n * List events\n * @param q Parameters to pass to the API request\n */\nexport function queryEvents(\n    q: CalendarEventQueryParams\n): Observable<CalendarEvent[]> {\n    const query = toQueryString(q);\n    return get(`${EVENTS_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((e) => new CalendarEvent(e)))\n    );\n}\n\n/**\n * Get event details\n * @param id ID of the event to grab\n * @param q Parameters to pass to the API request\n */\nexport function showEvent(id: string, q: CalendarEventShowParams = {}) {\n    const query = toQueryString(q);\n    return get(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Create new calendar event and add it to the database\n * @param data New calendar event fields\n */\nexport function createEvent(data: Partial<CalendarEvent>) {\n    return post(`${EVENTS_ENDPOINT}`, new CalendarEvent(data).toJSON()).pipe(\n        map((item) => new CalendarEvent(item))\n    );\n}\n\n/**\n * Update an existing calendar event\n * @param id ID of the event to update\n * @param data New values for event fields\n * @param q Parameters to pass to the API request\n * @param method HTTP verb to use with API request\n */\nexport function updateEvent(\n    id: string,\n    data: Partial<CalendarEvent>,\n    q: CalendarEventShowParams = {},\n    method: 'put' | 'patch' = 'patch'\n) {\n    const query = toQueryString(q);\n    return (method === 'patch' ? patch : put)(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`,\n        method === 'patch' ? data : new CalendarEvent(data).toJSON()\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Save changes to or create a calendar event\n * @param data State of the calendar event\n * @param q Parameters to pass to the API request\n */\nexport const saveEvent = (\n    data: Partial<CalendarEvent>,\n    q?: CalendarEventShowParams\n) => {\n    delete (data as any)?.status;\n    return data.id ? updateEvent(data.id, data, q) : createEvent(data);\n};\n\n/**\n * Remove calendar event from the database\n * @param id ID of the event to remove\n * @param q Parameters to pass to the API request\n */\nexport function removeEvent(id: string, q: CalendarEventShowParams = {}) {\n    const query = toQueryString(q);\n    return del(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}${\n            query ? '?' + query : ''\n        }`,\n        {\n            response_type: 'void',\n        }\n    );\n}\n\n/**\n * Set the approval state of the event to approved\n * @param id ID of the event to approve\n * @param system_id Associated system to approve\n */\nexport function approveEvent(id: string, system_id: string) {\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/approve?system_id=${encodeURIComponent(system_id)}`,\n        ''\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * Set the approval state of the event to rejected\n * @param id ID of the event to reject\n * @param system_id Associated system to reject\n */\nexport function rejectEvent(id: string, system_id: string) {\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/reject?system_id=${encodeURIComponent(system_id)}`,\n        ''\n    ).pipe(map((item) => new CalendarEvent(item)));\n}\n\n/**\n * List guests for event\n * @param id ID of the event to grab\n * @param q Parameters to pass to the API request\n */\nexport function queryEventGuests(\n    id: string,\n    q: CalendarEventShowParams = {}\n): Observable<GuestUser[]> {\n    const query = toQueryString(q);\n    return get(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(id)}/guests${\n            query ? '?' + query : ''\n        }`\n    ).pipe(map((list) => list.map((item) => new GuestUser(item))));\n}\n\n/**\n * Set the checkin state of an event guest\n * @param id ID of the event to grab\n * @param guest_id ID of the guest to update\n * @param state New checkin state of the guest\n * @param q Parameters to pass to the API request\n */\nexport function checkinEventGuest(\n    id: string,\n    guest_id: string,\n    state: boolean,\n    q: CalendarEventShowParams = {}\n) {\n    const query = toQueryString({ ...q, state });\n    return post(\n        `${EVENTS_ENDPOINT}/${encodeURIComponent(\n            id\n        )}/guests/${guest_id}/checkin${query ? '?' + query : ''}`,\n        ''\n    ).pipe(map((item) => new GuestUser(item)));\n}\n","import { AbstractControl } from '@angular/forms';\nimport { addMinutes, isAfter, isBefore } from 'date-fns';\n\nexport const endInFuture = (control: AbstractControl) => {\n    if (\n        control.parent?.get('date') &&\n        isAfter(\n            new Date(),\n            addMinutes(control.parent.get('date').value, control.value)\n        )\n    ) {\n        return { duration: true };\n    }\n    return null;\n};\n\n/** Check that date in unix ms is in the future */\nexport function isFuture(\n    control: AbstractControl\n): { [key: string]: boolean } | null {\n    return control.value && isBefore(control.value, new Date())\n        ? { is_future: true }\n        : null;\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\nimport { MAP_FEATURE_DATA } from '@placeos/components';\nimport { CalendarEvent } from '@placeos/events';\nimport { Space } from '@placeos/spaces';\n\nexport interface SpaceInfoData {\n    space: Space;\n    events: CalendarEvent[];\n    status:\n        | 'free'\n        | 'busy'\n        | 'pending'\n        | 'reserved'\n        | 'not-bookable'\n        | 'unknown'\n        | '';\n}\n\n@Component({\n    selector: 'explore-space-info',\n    template: `\n        <div\n            customTooltip\n            [content]=\"space_tooltip\"\n            [backdrop]=\"false\"\n            [xPosition]=\"'center'\"\n            [yPosition]=\"'center'\"\n            [hover]=\"true\"\n            class=\"h-full w-full pointer-events-auto relative\"\n        ></div>\n        <ng-template #space_tooltip>\n            <div\n                name=\"space-info\"\n                [id]=\"space.id\"\n                class=\"\n                    absolute rounded bg-white p-4 top-0 left-0 transform shadow pointer-events-none\n                \"\n                [class.-translate-x-full]=\"x_pos === 'end'\"\n                [class.-translate-y-full]=\"y_pos === 'bottom'\"\n            >\n                <div class=\"arrow\"></div>\n                <div class=\"details\">\n                    <h4 class=\"m-0 mb-2\">\n                        {{ space.display_name || space.name }}\n                    </h4>\n                    <div capacity class=\"text-sm\" *ngIf=\"space.capacity >= 0\">\n                        <span>Capacity: </span>{{ space.capacity }}\n                        {{ space.capacity === 1 ? 'person' : 'people' }}\n                    </div>\n                    <div class=\"flex flex-wrap my-2 text-sm\">\n                        <div\n                            status\n                            [class]=\"\n                                'capitalize rounded p-1 px-2 text-light ' +\n                                status\n                            \"\n                        >\n                            {{ status }}\n                        </div>\n                        <div available-until *ngIf=\"status !== 'not-bookable'\">\n                            {{ available_until }}\n                        </div>\n                    </div>\n                    <div features *ngIf=\"space.features?.length > 0\">\n                        <h4 class=\"m-0 mb-2\">Room Features</h4>\n                        <ul class=\"pl-2\">\n                            <li\n                                class=\"text-sm\"\n                                *ngFor=\"let feature of space.features\"\n                            >\n                                {{ feature }}\n                            </li>\n                        </ul>\n                    </div>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            [name='space-info'] {\n                width: 16rem;\n            }\n\n            [status] {\n                background-color: #43a047;\n                font-weight: 500;\n            }\n\n            [status].busy {\n                background-color: #e53935;\n            }\n\n            [status].pending {\n                background-color: #ffb300;\n            }\n\n            [status].not-bookable {\n                background-color: #757575;\n            }\n        `,\n    ],\n})\nexport class ExploreSpaceInfoComponent implements OnInit {\n    /** Space to display details for */\n    public readonly space = this._details.space;\n    /** List of upcoming events for space */\n    public readonly events = this._details.events;\n    /** Current status of the space */\n    public readonly status = this._details.status;\n\n    public y_pos: 'top' | 'bottom';\n\n    public x_pos: 'start' | 'end';\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: SpaceInfoData,\n        private _element: ElementRef<HTMLElement>\n    ) {}\n\n    public ngOnInit(tries: number = 0) {\n        if (tries > 10) return;\n        setTimeout(() => {\n            const parent = this._element.nativeElement.parentElement\n                ?.parentElement;\n            if (!parent) return this.ngOnInit(++tries);\n            const position = {\n                y: parseInt(parent.style.top, 10) / 100,\n                x: parseInt(parent.style.left, 10) / 100,\n            };\n            this.y_pos = position.y >= 0.5 ? 'bottom' : 'top';\n            this.x_pos = position.x >= 0.5 ? 'end' : 'start';\n        }, 200);\n    }\n\n    public get available_until() {\n        return '';\n    }\n}\n","import { FormGroup, FormControl, Validators } from '@angular/forms';\nimport {\n    add,\n    formatDuration,\n    differenceInMinutes,\n    getTime,\n    isSameDay,\n    format,\n    startOfMinute,\n    setHours,\n    setMinutes,\n    addMinutes,\n} from 'date-fns';\nimport { timePeriodsIntersect, unique } from '@placeos/common';\n\nimport { CalendarEvent } from './event.class';\nimport { endInFuture } from './validators';\nimport { getNextFreeTimeSlot } from './helpers';\n\nlet BOOKING_DATE = add(setMinutes(setHours(new Date(), 6), 0), { days: -1 });\n\nexport function generateEventForm(event: CalendarEvent): FormGroup {\n    const form = new FormGroup({\n        id: new FormControl(event.id),\n        host: new FormControl(event.host || '', [Validators.required]),\n        organiser: new FormControl(event.organiser || {}, [\n            Validators.required,\n        ]),\n        creator: new FormControl(event.creator, [Validators.required]),\n        calendar: new FormControl(event.calendar),\n        attendees: new FormControl(event.attendees || []),\n        resources: new FormControl(event.resources || []),\n        title: new FormControl(event.title, [Validators.required]),\n        body: new FormControl(event.body),\n        private: new FormControl(event.private),\n        date: new FormControl(event.date, [Validators.required]),\n        duration: new FormControl(event.duration, [endInFuture]),\n        all_day: new FormControl(event.all_day),\n        recurring: new FormControl(event.recurring),\n        recurrence: new FormControl(event.recurrence),\n        recurring_master_id: new FormControl(event.recurring_master_id),\n        master: new FormControl(event.master),\n        attachments: new FormControl(event.attachments),\n        catering: new FormControl(event.extension_data?.catering || []),\n        // has_catering: new FormControl(event.has_catering || false),\n        visitor_type: new FormControl(event.extension_data?.visitor_type),\n        location: new FormControl(event.location),\n        needs_space: new FormControl(true),\n        needs_parking: new FormControl(\n            event.extension_data?.needs_parking || false\n        ),\n        system: new FormControl(event.system),\n    });\n    form.get('organiser').valueChanges.subscribe((o) =>\n        form.controls.host.setValue(o?.email)\n    );\n    form.get('resources').valueChanges.subscribe((l) =>\n        form.controls.system.setValue(l.length ? l[0] : null)\n    );\n    if (event.id) {\n        form.get('host').disable();\n        form.get('organiser').disable();\n    }\n    if (event.state === 'started') form.get('date').disable();\n    return form;\n}\n\n/**\n * Set the initial time used for generating mock bookings\n * @param time New initial time as ms from UTC epoch\n */\nexport function setMockBookingStartDatetime(time: number) {\n    BOOKING_DATE = startOfMinute(new Date(time));\n}\n\n/**\n * Get current status within bookings\n * @param bookings List of bookings\n * @param host Host of the new event\n * @param date Datetime of the new event\n */\nexport function statusFromBookings(\n    bookings: CalendarEvent[],\n    bookable: boolean,\n    requestable: boolean,\n    date: number = getTime(new Date())\n) {\n    const now = new Date(date);\n    const next_free_slot = getNextFreeTimeSlot(bookings, date, 5);\n    const start = new Date(next_free_slot.start);\n    const end = new Date(next_free_slot.end);\n    const currently_free = timePeriodsIntersect(\n        date,\n        date,\n        next_free_slot.start,\n        next_free_slot.end\n    );\n    const time_until_next_block = formatDuration({\n        minutes: currently_free\n            ? differenceInMinutes(end, now)\n            : differenceInMinutes(start, now),\n    });\n    const free_tomorrow = !currently_free && !isSameDay(start, now);\n    const free_today = currently_free && !isSameDay(end, now);\n    return {\n        status: !bookable\n            ? 'Not Bookable'\n            : currently_free\n            ? requestable\n                ? 'Available by Request'\n                : 'Available'\n            : 'Meeting in Progress',\n        available_until: free_today\n            ? 'No meetings today'\n            : currently_free\n            ? `Free until ${format(end, 'h:mm B')}(${time_until_next_block})`\n            : free_tomorrow\n            ? 'Unavailable today'\n            : `Free at ${format(start, 'h:mm B')}(${time_until_next_block})`,\n    };\n}\n\nexport function replaceBookings(\n    list: CalendarEvent[],\n    new_bookings: CalendarEvent[],\n    filter_options: { space: string; from: number; to: number }\n) {\n    const from = filter_options.from;\n    const to = filter_options.to;\n    const filtered_list = list.filter((booking) => {\n        const start = new Date(booking.date);\n        const end = addMinutes(start, booking.duration);\n        return (\n            !booking.resources.find(\n                (space) => space.email === filter_options.space\n            ) || !timePeriodsIntersect(from, to, start.valueOf(), end.valueOf())\n        );\n    });\n    const updated_list = filtered_list.concat(new_bookings);\n    updated_list.sort((a, b) => a.date - b.date);\n    return unique(updated_list, 'id');\n}\n","import { Component, Inject, OnInit } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MatDialogRef, MAT_DIALOG_DATA } from '@angular/material/dialog';\nimport { notifyError, notifySuccess } from '@placeos/common';\nimport { CalendarEvent, generateEventForm, saveEvent } from '@placeos/events';\nimport { Space } from '@placeos/spaces';\nimport { querySpaceAvailability } from '@placeos/calendar';\n\nexport interface ExploreBookingModalData {\n    space: Space;\n}\n\n@Component({\n    selector: 'explore-booking-modal',\n    template: `\n        <header>\n            <h2>New Booking</h2>\n            <div class=\"flex-1\"></div>\n            <button *ngIf=\"!loading\" mat-icon-button mat-dialog-close>\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <ng-container *ngIf=\"!loading; else load_state\">\n            <main *ngIf=\"form\" [formGroup]=\"form\" class=\"p-4\">\n                <div class=\"flex flex-col\">\n                    <label for=\"title\">Title<span>*</span>:</label>\n                    <mat-form-field appearance=\"outline\">\n                        <input\n                            matInput\n                            name=\"title\"\n                            formControlName=\"title\"\n                            placeholder=\"Booking Title\"\n                        />\n                        <mat-error>Booking title is required</mat-error>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label>Space:</label>\n                    <div name=\"space\" class=\"sm:mt-4 mb-4\">\n                        {{\n                            form.controls.resources?.value[0]?.display_name ||\n                                form.controls.resources?.value[0]?.name\n                        }}\n                    </div>\n                </div>\n                <div class=\"flex sm:space-x-4 flex-wrap\">\n                    <div class=\"flex flex-col\" *ngIf=\"form.controls.date\">\n                        <label>Date:</label>\n                        <div class=\"sm:mt-4 mb-4\">\n                            {{ form.controls.date?.value | date: 'medium' }}\n                        </div>\n                    </div>\n                    <div class=\"flex flex-col\" *ngIf=\"form.controls.duration\">\n                        <label>Duration:</label>\n                        <a-duration-field\n                            formControlName=\"duration\"\n                        ></a-duration-field>\n                    </div>\n                </div>\n            </main>\n            <footer class=\"flex justify-center p-2 border-t border-gray-200\">\n                <button mat-button (click)=\"save()\">Save</button>\n            </footer>\n        </ng-container>\n        <ng-template #load_state>\n            <div load class=\"h-64 flex flex-col items-center justify-center\">\n                <mat-spinner class=\"m-4\" [diameter]=\"48\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            header {\n                max-width: calc(100vw + 100%);\n            }\n\n            [load] {\n                width: 32rem;\n                max-width: calc(100vw - 2rem);\n            }\n        `,\n    ],\n})\nexport class ExploreBookingModalComponent implements OnInit {\n    public booking: CalendarEvent;\n    public form: FormGroup;\n    public loading = '';\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: ExploreBookingModalData,\n        private _dialog_ref: MatDialogRef<ExploreBookingModalComponent>\n    ) {}\n\n    public ngOnInit() {\n        this.booking = new CalendarEvent({\n            attendees: [{ ...(this._data.space || {}), resource: true } as any],\n        });\n        this.form = generateEventForm(this.booking);\n    }\n\n    public async save() {\n        this.form.markAllAsTouched();\n        const on_error = (msg) => {\n            this.loading = '';\n            notifyError(msg);\n            this._dialog_ref.disableClose = false;\n        };\n        if (!this.form.valid) {\n            const list = [];\n            for (const key in this.form.controls) {\n                if (this.form.controls[key].invalid) {\n                    list.push(key);\n                }\n            }\n            throw on_error(\n                `Some form fields are not valid: [${list.join(', ')}]`\n            );\n        }\n        this._dialog_ref.disableClose = true;\n        this.loading = 'Checking space availability...';\n        const spaces = await querySpaceAvailability({\n            system_ids: this.form.controls.resources.value\n                ?.map((s) => s.id)\n                .join(','),\n            period_start: Math.floor(this.form.value.date / 1000),\n            period_end:\n                Math.floor(this.form.value.date / 1000) +\n                this.form.value.duration * 60,\n        })\n            .toPromise()\n            .catch((e) => {\n                on_error(\n                    'Space is unavailble for the selected time and duration'\n                );\n                throw e;\n            });\n        if (spaces.length <= 0) {\n            return on_error(\n                'Space is unavailble for the selected time and duration'\n            );\n        }\n        this.loading = 'Creating booking...';\n        await saveEvent(new CalendarEvent(this.form.value))\n            .toPromise()\n            .catch((e) => {\n                on_error('Error creating booking.');\n                throw e;\n            });\n        notifySuccess(\n            `Successfully created booking in ${\n                this._data.space.display_name || this._data.space.name\n            }`\n        );\n        this._dialog_ref.close();\n    }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { getModule } from '@placeos/ts-client';\nimport { ViewAction, ViewerFeature } from '@placeos/svg-viewer';\nimport { map } from 'rxjs/operators';\n\nimport {\n    BaseClass,\n    HashMap,\n    notifyError,\n    SettingsService,\n} from '@placeos/common';\nimport { Space } from '@placeos/spaces';\nimport { CalendarEvent } from '@placeos/events';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { ExploreSpaceInfoComponent } from './explore-space-info.component';\nimport { ExploreBookingModalComponent } from './explore-booking-modal.component';\n\nexport const DEFAULT_COLOURS = {\n    free: '#43a047',\n    pending: '#ffb300',\n    reserved: '#e65100',\n    busy: '#e53935',\n    'not-bookable': '#757575',\n    unknown: '#757575',\n};\n\n@Injectable()\nexport class ExploreSpacesService extends BaseClass implements OnDestroy {\n    private _bookings: HashMap<CalendarEvent[]> = {};\n    private _statuses: HashMap<string> = {};\n\n    private _bind = this._state.spaces.pipe(\n        map((list) => {\n            this.unsubWith('b-');\n            this.unsubWith('s-');\n            this._statuses = {};\n            if (!list?.length) return;\n            for (const space of list) {\n                const mod = getModule(space.id, 'Bookings');\n                let binding = mod.binding('bookings');\n                this.subscription(\n                    `b-${space.id}`,\n                    binding\n                        .listen()\n                        .subscribe((d) =>\n                            this.handleBookingsChange(list, space, d)\n                        )\n                );\n                this.subscription(`b-bind-${space.id}`, binding.bind());\n                binding = mod.binding('status');\n                this.subscription(\n                    `s-${space.id}`,\n                    binding\n                        .listen()\n                        .subscribe((d) =>\n                            this.handleStatusChange(list, space, d)\n                        )\n                );\n                this.subscription(`s-bind-${space.id}`, binding.bind());\n            }\n            this.updateActions(list);\n            this.updateHoverElements(list);\n        })\n    );\n\n    constructor(\n        private _state: ExploreStateService,\n        private _settings: SettingsService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this.subscription('spaces', this._bind.subscribe());\n    }\n\n    public bookSpace(space: Space) {\n        if (this._statuses[space.id] === 'busy' || !space.bookable) {\n            return notifyError(\n                `${\n                    space.display_name || space.name\n                } is unavailable at the current time`\n            );\n        }\n        this._dialog.open(ExploreBookingModalComponent, {\n            data: { space },\n        });\n    }\n\n    public handleBookingsChange(\n        spaces: Space[],\n        space: Space,\n        bookings: HashMap[]\n    ) {\n        if (!bookings) return;\n        this._bookings[space.id] = bookings.map((i) => new CalendarEvent(i));\n        this.timeout(\n            'update_hover_els',\n            () => this.updateHoverElements(spaces),\n            100\n        );\n    }\n\n    public handleStatusChange(spaces: Space[], space: Space, status: string) {\n        this._statuses[space.id] = space.bookable\n            ? status || 'free'\n            : 'not-bookable';\n        this.timeout(\n            'update_statuses',\n            () => {\n                this.clearTimeout('update_hover_els');\n                this.updateStatus(spaces);\n                this.updateHoverElements(spaces);\n            },\n            100\n        );\n    }\n\n    private updateStatus(spaces: Space[]) {\n        const style_map = {};\n        const colours = this._settings.get('app.explore.colors') || {};\n        for (const space of spaces) {\n            const status = this._statuses[space.id] || 'not-bookable';\n            style_map[`#${space.map_id}`] = {\n                fill:\n                    colours[`space-${status}`] ||\n                    colours[`${status}`] ||\n                    DEFAULT_COLOURS[`${status}`],\n                opacity: 0.6,\n            };\n        }\n        this._state.setStyles('spaces', style_map);\n    }\n\n    private updateHoverElements(spaces: Space[]) {\n        const features: ViewerFeature[] = [];\n        for (const space of spaces) {\n            features.push({\n                location: space.map_id,\n                full_size: true,\n                content: ExploreSpaceInfoComponent,\n                data: {\n                    space,\n                    events: this._bookings[space.id],\n                    status: this._statuses[space.id],\n                },\n            } as any);\n        }\n        this._state.setFeatures('spaces', features);\n    }\n\n    private updateActions(spaces: Space[]) {\n        const actions: ViewAction[] = [];\n        for (const space of spaces) {\n            actions.push({\n                id: space.map_id,\n                action: 'click',\n                callback: () => this.bookSpace(space),\n            });\n            actions.push({\n                id: space.map_id,\n                action: 'touchend',\n                callback: () => this.bookSpace(space),\n            });\n        }\n        this._state.setActions('spaces', actions);\n    }\n}\n","import { Injectable } from '@angular/core';\nimport { getModule, showMetadata } from '@placeos/ts-client';\nimport { ViewerLabel, Point } from '@placeos/svg-viewer';\nimport { first, map } from 'rxjs/operators';\n\nimport { BaseClass, HashMap, SettingsService } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { DEFAULT_COLOURS } from './explore-spaces.service';\nimport { MapPolygonComponent } from 'libs/components/src/lib/map-polygon.component';\n\nconst EMPTY_LABEL = { location: { x: -10, y: -10 }, content: '0% Usage' };\n\nexport interface ZoneData {\n    /** ID of the zone */\n    area_id: string;\n    /** Number of devices in the zone */\n    count: number;\n\n    ambient_temp: number;\n    people_count: number;\n    humidity: number;\n    queue_size: number;\n    counter: number;\n}\n\n@Injectable()\nexport class ExploreZonesService extends BaseClass {\n    private _statuses: HashMap<string> = {};\n    private _labels: HashMap<ViewerLabel> = {};\n    private _location: HashMap<Point> = {};\n    private _capacity: HashMap<number> = {};\n    private _draw: HashMap<boolean> = {};\n    private _points: HashMap<[number, number][]> = {};\n\n    private _bind = this._state.level.pipe(\n        map((lvl) => {\n            if (!lvl) return;\n            this._statuses = {};\n            const building = this._org.buildings.find(\n                (bld) => bld.id === lvl.parent_id\n            );\n            if (!building) return;\n            const system_id =\n                building.bindings.area_management ||\n                this._org.organisation.bindings.area_management;\n            if (!system_id) return;\n            const binding = getModule(system_id, 'AreaManagement').binding(\n                `${lvl.id}:areas`\n            );\n            this.subscription(\n                `zones`,\n                binding.listen().subscribe((d) => this.parseData(d))\n            );\n            this.subscription('binding', binding.bind());\n        })\n    );\n\n    constructor(\n        private _state: ExploreStateService,\n        private _org: OrganisationService,\n        private _settings: SettingsService\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        const zone_metadata = await Promise.all(\n            this._org.levels.map((bld) =>\n                showMetadata(bld.id, { name: 'map_regions' }).toPromise()\n            )\n        );\n        for (const zone of zone_metadata) {\n            const areas = (zone?.details as any)?.areas;\n            if (areas) {\n                for (const area of areas) {\n                    this._capacity[area.id] = area.properties?.capacity || 100;\n                    this._location[area.id] = area.properties?.label_location;\n                    this._draw[area.id] = !!area.properties?.draw_polygon;\n                    this._points[area.id] = area.geometry?.coordinates || [];\n                }\n            }\n        }\n        this.subscription('bind', this._bind.subscribe());\n    }\n\n    public parseData(data?: { value: ZoneData[] }) {\n        const value = data?.value || [];\n        const labels = [];\n        for (const zone of value) {\n            const filled = zone.count / (this._capacity[zone.area_id] || 100);\n            this._statuses[zone.area_id] =\n                filled < 0.4 ? 'free' : filled < 0.75 ? 'pending' : 'busy';\n            if (!this._location[zone.area_id]) continue;\n            let content = '';\n            if (zone.count) {\n                content += `${zone.count || 0} ${\n                    zone.count === 1 ? 'Device' : 'Devices'\n                }\\n`;\n            }\n            if (zone.ambient_temp)\n                content += `Ambient Temp: ${zone.ambient_temp} C\\n`;\n            if (zone.people_count > 0)\n                content += `${zone.people_count} ${\n                    zone.people_count === 1 ? 'Person' : 'People'\n                }\\n`;\n            if (zone.humidity) content += `Humidity: ${zone.humidity}%\\n`;\n            if (zone.queue_size) content += `Queue Size: ${zone.queue_size}%\\n`;\n            if (zone.counter) content += `Count: ${zone.queue_size}\\n`;\n            this._labels[zone.area_id] = {\n                location: this._location[zone.area_id],\n                content,\n                z_index: 100,\n            };\n            labels.push(this._labels[zone.area_id]);\n        }\n        this._state.setLabels('zones', labels);\n        this.timeout('update', () => this.updateStatus(), 100);\n    }\n\n    private updateStatus() {\n        const style_map = {};\n        const features = [];\n        const colours = this._settings.get('app.explore.colors') || {};\n        for (const zone_id in this._statuses) {\n            const colour =\n                colours[`zone-${this._statuses[zone_id]}`] ||\n                colours[`${this._statuses[zone_id]}`] ||\n                DEFAULT_COLOURS[`${this._statuses[zone_id]}`];\n            if (this._draw[zone_id]) {\n                features.push({\n                    location: getCenterPoint(this._points[zone_id]),\n                    content: MapPolygonComponent,\n                    data: {\n                        color: colour,\n                        points: this._points[zone_id],\n                    },\n                    z_index: 50,\n                });\n            } else {\n                style_map[`#${zone_id}`] = {\n                    fill: colour,\n                    opacity: 0.6,\n                };\n            }\n        }\n        this._state.setFeatures('zones', features);\n        this._state.setStyles('zones', style_map);\n    }\n}\n\nfunction getCenterPoint(points: [number, number][]) {\n    const diff: HashMap<number> = points.reduce(\n        (m, [x, y]) => ({\n            x_min: x < m.x_min ? x : m.x_min,\n            x_max: x > m.x_max ? x : m.x_max,\n            y_min: y < m.y_min ? y : m.y_min,\n            y_max: y > m.y_max ? y : m.y_max,\n        }),\n        {\n            x_min: 100,\n            x_max: -100,\n            y_min: 100,\n            y_max: -100,\n        }\n    );\n    return {\n        x: diff.x_min + (diff.x_max - diff.x_min) / 2,\n        y: diff.y_min + (diff.y_max - diff.y_min) / 2,\n    };\n}\n","import { Component, EventEmitter, OnInit, Output } from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { DialogEvent, notifyError } from '@placeos/common';\n\n@Component({\n    selector: 'desk-question-modal',\n    template: `\n        <div *ngIf=\"!failure; else fail_state\" class=\"relative\">\n            <h2 class=\"p-4 text-xl\">COVID-19 Questionnaire</h2>\n            <main class=\"p-4\" [formGroup]=\"form\">\n                <div class=\"flex flex-col mb-4\">\n                    <label>\n                        Have you travelled overseas within the last 14\n                        days?<span>*</span>\n                    </label>\n                    <mat-radio-group\n                        formControlName=\"travelled\"\n                        class=\"space-x-2\"\n                    >\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n                <div class=\"flex flex-col mb-4\">\n                    <label>\n                        Are you unwell or experiencing any cold or flu-like\n                        symptoms?<span>*</span>\n                    </label>\n                    <mat-radio-group formControlName=\"unwell\" class=\"space-x-2\">\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label>\n                        Have you had contact with anyone with suspected\n                        COVID-19?<span>*</span>\n                    </label>\n                    <mat-radio-group\n                        formControlName=\"contact\"\n                        class=\"space-x-2\"\n                    >\n                        <mat-radio-button [value]=\"true\">Yes</mat-radio-button>\n                        <mat-radio-button [value]=\"false\">No</mat-radio-button>\n                    </mat-radio-group>\n                </div>\n            </main>\n            <footer class=\"flex justify-center items-center p-2\">\n                <button mat-button (click)=\"submit()\">Submit</button>\n            </footer>\n            <button close mat-icon-button mat-dialog-close>\n                <i class=\"material-icons\">close</i>\n            </button>\n        </div>\n        <ng-template #fail_state>\n            <main failure class=\"pt-8 relative\">\n                <p class=\"p-4\">\n                    Your request to work from the office has been rejected based\n                    on your response to the compulsory Covid-19 questions.\n                    Please feel free to submit a new request when circumstances\n                    change in a way that changes your answer to the questions.\n                </p>\n                <button close mat-icon-button mat-dialog-close>\n                    <i class=\"material-icons\">close</i>\n                </button>\n            </main>\n        </ng-template>\n    `,\n    styles: [\n        `\n            main {\n                width: 24rem;\n                max-width: calc(100vw - 4.5rem);\n            }\n\n            [close] {\n                position: absolute;\n                top: 0.5rem;\n                right: 0.5rem;\n            }\n        `,\n    ],\n})\nexport class DeskQuestionsModalComponent implements OnInit {\n    @Output() public event = new EventEmitter<DialogEvent>();\n\n    public form: FormGroup;\n    public failure: boolean;\n\n    public ngOnInit() {\n        this.form = new FormGroup({\n            travelled: new FormControl('', [Validators.required]),\n            unwell: new FormControl('', [Validators.required]),\n            contact: new FormControl('', [Validators.required]),\n        });\n    }\n\n    public submit() {\n        this.form.markAllAsTouched();\n        if (!this.form.valid) {\n            notifyError('All the questions must be answered');\n            return;\n        } else if (\n            Object.keys(this.form.value).find(\n                (key) =>\n                    this.form.value[key] === true ||\n                    this.form.value[key] === 'true'\n            )\n        ) {\n            this.failure = true;\n            return;\n        }\n        this.event.emit({ reason: 'done' });\n    }\n}\n","import {\n    addHours,\n    addMinutes,\n    differenceInMinutes,\n    getUnixTime,\n    isAfter,\n    isSameDay,\n    roundToNearestMinutes\n} from 'date-fns';\n\nexport type BookingType = 'desk' | 'parking' | 'locker' | '';\n\n/** General purpose booking class */\nexport class Booking {\n    /** Unique Identifier of the object */\n    public readonly id: string;\n    /** Unix epoch for the start time of the booking in seconds */\n    public readonly booking_start: number;\n    /** Unix epoch for the start time of the booking in seconds */\n    public readonly booking_end: number;\n    /** ID of the user who owns the booking */\n    public readonly booked_by_id: string;\n    /** Email of the user who owns the booking */\n    public readonly booked_by_email: string;\n    /** Display name of the user who owns the booking */\n    public readonly booked_by_name: string;\n    /** ID of the user who owns the booking */\n    public readonly user_id: string;\n    /** Email of the user who owns the booking */\n    public readonly user_email: string;\n    /** Display name of the user who owns the booking */\n    public readonly user_name: string;\n    /** Identifier of the physical asset assocated with the booking */\n    public readonly asset_id: string;\n    /** Zones associated with the asset ID */\n    public readonly zones: string[];\n    /** Type of booking */\n    public readonly booking_type: BookingType;\n    /** Start time of booking in ms */\n    public readonly date: number;\n    /** Duration of the event in minutes */\n    public readonly duration: number;\n    /** Whether it is an all day booking */\n    public readonly all_day: boolean;\n    /** Timezone of the booking */\n    public readonly timezone: string;\n    /** Title of the booking */\n    public readonly title: string;\n    /** Description */\n    public readonly description: string;\n    /** Whether user checked in */\n    public readonly checked_in: boolean;\n    /** Whether booking is rejected */\n    public readonly rejected: boolean;\n    /** Whether booking is approved */\n    public readonly approved: boolean;\n    /** Id of the approver */\n    public readonly approver_id: string;\n    /** Email of the approver */\n    public readonly approver_email: string;\n    /** Name of the approver */\n    public readonly approver_name: string;\n    /** Extra non-standard metadata associated with the booking */\n    public readonly extension_data: Record<string, any>;\n    /** Default type */\n    public readonly type: string;\n    /** Default type */\n    public readonly access: boolean;\n    /** Status of the booking */\n    public readonly status: 'declined' | 'approved' | 'tentative';\n\n    constructor(data: Partial<Booking> = {}) {\n        this.id = data.id || '';\n        this.asset_id = data.asset_id || '';\n        this.zones = data.zones || [];\n        this.booking_start =\n            data.booking_start ||\n            getUnixTime(\n                data.date ||\n                    roundToNearestMinutes(addMinutes(new Date(), 2), {\n                        nearestTo: 5,\n                    })\n            );\n        this.booking_end =\n            data.booking_end ||\n            getUnixTime(addMinutes(this.booking_start * 1000, data.duration || 60));\n        this.booking_type = data.booking_type || '';\n        this.type = data.type || 'booking';\n        this.date = data.date || this.booking_start * 1000;\n        this.duration =\n            data.duration ||\n            Math.abs(differenceInMinutes(\n                this.booking_start * 1000,\n                this.booking_end * 1000\n            ));\n        this.timezone =\n            data.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone;\n        this.user_email = data.user_email || '';\n        this.user_id = data.user_id || '';\n        this.user_name = data.user_name || '';\n        this.title = data.title || 'Desk booking';\n        this.description = data.description || '';\n        this.checked_in = !!data.checked_in;\n        this.rejected = !!data.rejected;\n        this.approved = !!data.approved;\n        this.approver_id = data.approver_id || '';\n        this.approver_email = data.approver_email || '';\n        this.approver_name = data.approver_name || '';\n        this.extension_data = data.extension_data || {};\n        this.access = !!data.extension_data?.access;\n        this.all_day = data.all_day ?? true;\n        this.status = this.rejected\n            ? 'declined'\n            : this.approved\n            ? 'approved'\n            : 'tentative';\n        for (const key in data) {\n            if (!(key in this)) {\n                this.extension_data[key] =\n                    data[key] || this.extension_data[key];\n            }\n        }\n    }\n\n    public toJSON(this: Booking): Partial<Booking> {\n        const data = { ...this };\n        if (!this.id) delete data.id;\n        delete data.date;\n        delete data.duration;\n        return data;\n    }\n\n    public get location(): string {\n        return this.description;\n    }\n\n    /** Whether the booking occurs today */\n    public get is_today(): boolean {\n        return isSameDay(this.date, new Date());\n    }\n\n    /** Whether booking is done */\n    public get is_done(): boolean {\n        const start = new Date();\n        const end = this.all_day\n            ? addHours(this.date, 24)\n            : addMinutes(this.date, this.duration);\n        return isAfter(start, end);\n    }\n}\n","import { del, get, patch, post, put } from '@placeos/ts-client';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { toQueryString } from 'libs/common/src/lib/api';\nimport { Booking } from './booking.class';\n\nexport interface BookingsQueryParams {\n    /** Comma seperated list of zone ids to check availability */\n    zones?: string;\n    /** User ID to filter bookings */\n    user?: string;\n    /** Email address to filter bookings */\n    email?: string;\n    /** Epoch in seconds for the start of the availability period */\n    period_start: number;\n    /** Epoch in seconds for the end of the availability period */\n    period_end: number;\n    /** Category of booking */\n    type: string;\n}\n\nconst BOOKINGS_ENDPOINT = `/api/staff/v1/bookings`;\n\n/**\n * List bookings\n * @param q Parameters to pass to the API request\n */\nexport function queryBookings(q: BookingsQueryParams): Observable<Booking[]> {\n    const query = toQueryString(q);\n    return get(`${BOOKINGS_ENDPOINT}${query ? '?' + query : ''}`).pipe(\n        map((list) => list.map((item) => new Booking(item)))\n    );\n}\n\n/**\n * Get booking details\n * @param id ID of the booking to grab\n * @param q Parameters to pass to the API request\n */\nexport function showBooking(id: string) {\n    return get(`${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`).pipe(\n        map((item) => new Booking(item))\n    );\n}\n\n/**\n * Create new booking and add it to the database\n * @param data New booking fields\n */\nexport function createBooking(data: Partial<Booking>) {\n    return post(`${BOOKINGS_ENDPOINT}`, data).pipe(\n        map((item) => new Booking(item))\n    );\n}\n\n/**\n * Update an existing booking\n * @param id ID of the booking to update\n * @param data New values for booking fields\n * @param method HTTP verb to use with API request\n */\nexport function updateBooking(\n    id: string,\n    data: Partial<Booking>,\n    method: 'put' | 'patch' = 'patch'\n) {\n    return (method === 'patch' ? patch : put)(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`,\n        data\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Save changes to or create a booking\n * @param data State of the booking\n * @param q Parameters to pass to the API request\n */\nexport const saveBooking = (data: Partial<Booking>) =>\n    data.id ? updateBooking(data.id, data) : createBooking(data);\n\n/**\n * Remove booking from the database\n * @param id ID of the booking to remove\n * @param q Parameters to pass to the API request\n */\nexport function removeBooking(id: string) {\n    return del(`${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}`, {\n        response_type: 'void',\n    });\n}\n\n/**\n * Set the approval state of the booking to approved\n * @param id ID of the booking to approve\n * @param system_id Associated system to approve\n */\nexport function approveBooking(id: string) {\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/approve`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the approval state of the booking to rejected\n * @param id ID of the booking to reject\n * @param system_id Associated system to reject\n */\nexport function rejectBooking(id: string) {\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/reject`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n\n/**\n * Set the checkin state of a booking\n * @param id ID of the booking to grab\n * @param state New checkin state of the booking\n */\nexport function checkinBooking(id: string, state: boolean) {\n    const query = toQueryString({ state });\n    return post(\n        `${BOOKINGS_ENDPOINT}/${encodeURIComponent(id)}/check_in?${query}`,\n        ''\n    ).pipe(map((item) => new Booking(item)));\n}\n","import { Injectable } from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Event, NavigationEnd, Router } from '@angular/router';\nimport {\n    BaseClass,\n    currentUser,\n    flatten,\n    getInvalidFields,\n    notifyError,\n    openConfirmModal,\n    unique,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { listChildMetadata, PlaceZone } from '@placeos/ts-client';\nimport { format, getUnixTime, addMinutes } from 'date-fns';\nimport { BehaviorSubject, combineLatest, Observable, of } from 'rxjs';\nimport {\n    debounceTime,\n    distinctUntilKeyChanged,\n    first,\n    map,\n    shareReplay,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\n\nimport { User } from 'libs/users/src/lib/user.class';\nimport { Booking } from './booking.class';\nimport { generateBookingForm } from './booking.utilities';\nimport { queryBookings, saveBooking } from './bookings.fn';\nimport { DeskQuestionsModalComponent } from './desk-questions-modal.component';\n\nexport type BookingFlowView = 'form' | 'map' | 'confirm' | 'success';\n\nconst BOOKING_URLS = ['book/desks'];\n\nexport interface BookingFlowOptions {\n    /** Type of booking being made */\n    type: 'desk' | 'parking';\n    /** Zone to check available */\n    zone_id?: string;\n    /** List of features that the asset should associate */\n    features?: string[];\n    /** Whether booking is for a group */\n    group?: boolean;\n    /** Recurrence Pattern */\n    pattern?: 'none' | 'daily' | 'weekly' | 'monthly';\n    /** Recurrence ending */\n    recurr_end?: number;\n    /** List of group members to book for */\n    members?: User[];\n}\n\nexport interface BookingAsset {\n    id: string;\n    map_id: string;\n    name: string;\n    bookable: boolean;\n    zone?: PlaceZone;\n    features: string[];\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class BookingFormService extends BaseClass {\n    private _view = new BehaviorSubject<BookingFlowView>('form');\n    private _options = new BehaviorSubject<BookingFlowOptions>({\n        type: 'desk',\n    });\n    private _form = new BehaviorSubject<FormGroup>(null);\n    private _form_value = new BehaviorSubject<Partial<Booking>>({});\n    private _booking = new BehaviorSubject<Booking>(null);\n    private _loading = new BehaviorSubject<string>('');\n\n    public last_success: Booking = new Booking(\n        JSON.parse(\n            sessionStorage.getItem('PLACEOS.last_booked_booking') || '{}'\n        )\n    );\n    public readonly loading = this._loading.asObservable();\n    public readonly options = this._options.pipe(shareReplay(1));\n\n    public readonly assets: Observable<BookingAsset[]> = this.options.pipe(\n        distinctUntilKeyChanged('zone_id'),\n        switchMap(({ type }) => {\n            if (!this._org.building) return of([]);\n            switch (type) {\n                case 'desk':\n                    this._loading.next(`Loading desks...`);\n                    return listChildMetadata(this._org.building.id, {\n                        name: 'desks',\n                    }).pipe(\n                        map((data) =>\n                            flatten(\n                                data.map((_) =>\n                                    (\n                                        _.metadata.desks?.details || []\n                                    ).map((d) => ({ ...d, zone: _.zone }))\n                                )\n                            )\n                        )\n                    );\n            }\n            return of([]);\n        }),\n        tap(() => this._loading.next(``)),\n        shareReplay(1)\n    );\n\n    public readonly features: Observable<string[]> = this.assets.pipe(\n        map((assets) => {\n            const list: string[] = [];\n            for (const asset of assets) {\n                asset.features?.forEach((_) => list.push(_));\n            }\n            return unique(list).sort((a, b) => a.localeCompare(b));\n        }),\n        shareReplay(1)\n    );\n\n    public readonly available_assets = combineLatest([\n        this.options,\n        this.assets,\n        this._form_value,\n    ]).pipe(\n        debounceTime(500),\n        tap(([{ type }]) =>\n            this._loading.next(`Checking ${type} availability...`)\n        ),\n        switchMap(([options, assets, form]) =>\n            queryBookings({\n                period_start: getUnixTime(form.date),\n                period_end: getUnixTime(\n                    addMinutes(form.date, form.duration || 24 * 60)\n                ),\n                type: options.type,\n                zones: options.zone_id,\n            }).pipe(\n                map((bookings) =>\n                    assets.filter(\n                        (asset) =>\n                            asset.bookable !== false &&\n                            (!options.features ||\n                                options.features?.every((_) =>\n                                    asset.features.includes(_)\n                                )) &&\n                            (!options.zone_id ||\n                                options.zone_id === asset.zone?.id ||\n                                options.zone_id === asset.zone?.parent_id) &&\n                            !bookings.find((bkn) => bkn.asset_id === asset.id)\n                    )\n                )\n            )\n        ),\n        tap(() => this._loading.next('')),\n        shareReplay(1)\n    );\n\n    public readonly grouped_availability = combineLatest([\n        this.options,\n        this.available_assets,\n    ]).pipe(\n        map(([options, assets]) => {\n            const groups = [];\n            const asset_list = [...assets].sort((a, b) =>\n                a.zone?.id?.localeCompare(b.zone?.id)\n            );\n            const members = options.members?.length\n                ? options.members\n                : [currentUser()];\n            while (asset_list.length) {\n                const group = [];\n                let asset = asset_list.pop();\n                while (group.length < members.length) {\n                    if (\n                        group.length &&\n                        !group.find((_) => _.zone?.id === asset.zone?.id)\n                    ) {\n                        break;\n                    }\n                    group.push(asset);\n                    asset = asset_list.pop();\n                }\n                if (group.length < members.length) continue;\n                groups.push(group);\n            }\n            return groups;\n        })\n    );\n\n    public get view() {\n        return this._view.getValue();\n    }\n\n    public get form() {\n        return this._form.getValue();\n    }\n\n    public get booking() {\n        return this._booking.getValue();\n    }\n\n    public newForm(booking: Booking = new Booking()) {\n        this._form.next(generateBookingForm(booking));\n        this.subscription(\n            'form_change',\n            this._form.getValue().valueChanges.subscribe(() => this.storeForm())\n        );\n        this._booking.next(booking);\n        this._options.next({ type: this._options.getValue().type });\n    }\n\n    constructor(\n        private _router: Router,\n        private _org: OrganisationService,\n        private _dialog: MatDialog\n    ) {\n        super();\n        this.subscription(\n            'router.bookings',\n            this._router.events.subscribe((booking: Event) => {\n                if (\n                    booking instanceof NavigationEnd &&\n                    !BOOKING_URLS.find((_) => booking.url.includes(_))\n                ) {\n                    this.clearForm();\n                }\n            })\n        );\n        this._org.initialised\n            .pipe(first((_) => _))\n            .subscribe(() => this.setOptions({}));\n    }\n\n    public setView(value: BookingFlowView) {\n        this._view.next(value);\n    }\n\n    public setOptions(value: Partial<BookingFlowOptions>) {\n        this._options.next({ ...this._options.getValue(), ...value });\n    }\n\n    public resetForm() {\n        if (!this._form.getValue()) this.newForm();\n        const booking = this._booking.getValue();\n        this._form.getValue().patchValue({\n            ...(booking || {}),\n            ...(booking?.extension_data || {}),\n        });\n        this._options.next({ type: this._options.getValue().type });\n    }\n\n    public clearForm() {\n        sessionStorage.removeItem('PLACEOS.booking_form');\n        sessionStorage.removeItem('PLACEOS.booking_form_options');\n        this.newForm();\n    }\n\n    public storeForm() {\n        sessionStorage.setItem(\n            'PLACEOS.booking_form',\n            JSON.stringify(this._form.getValue()?.value || {})\n        );\n        sessionStorage.setItem(\n            'PLACEOS.booking_form_filters',\n            JSON.stringify(this._options.getValue() || {})\n        );\n        this._form_value.next(this._form.getValue()?.value || {});\n    }\n\n    public loadForm() {\n        if (!this._form.getValue()) this.newForm();\n        this._form.getValue().patchValue({\n            ...JSON.parse(\n                sessionStorage.getItem('PLACEOS.booking_form') || '{}'\n            ),\n        });\n        this.setOptions({\n            zone_id: this._org.building.id,\n            ...JSON.parse(\n                sessionStorage.getItem('PLACEOS.booking_form_filters') || '{}'\n            ),\n        });\n    }\n\n    public async confirmPost() {\n        await this.checkQuestions();\n        const options = this._options.getValue();\n        const form = this._form.getValue();\n        const details = await openConfirmModal(\n            {\n                title: `Book ${options.type}`,\n                content: `Would you like to book the ${options.type} ${\n                    form.get('asset_id').value\n                } for ${format(form.get('date').value, 'dd MMM yyyy')}`,\n                icon: { content: 'event_available' },\n            },\n            this._dialog\n        );\n        if (details?.reason !== 'done') return;\n        details.loading('Performing booking request...');\n        await this.postForm().catch((_) => {\n            notifyError(_);\n            details.close();\n            throw _;\n        });\n        details.close();\n    }\n\n    public async postForm() {\n        const form = this._form.getValue();\n        if (!form) throw 'No form for booking';\n        if (!form.valid)\n            throw `Some form fields are invalid. [${getInvalidFields(form).join(\n                ', '\n            )}]`;\n        const asset_id = form.get('asset_id').value;\n        const bookings = await queryBookings({\n            period_start: getUnixTime(form.get('date').value),\n            period_end: getUnixTime(\n                form.get('date').value + form.get('duration').value * 60 * 1000\n            ),\n            type: this._options.getValue().type,\n        }).toPromise();\n        if (bookings.find((_) => _.asset_id === asset_id))\n            throw `${asset_id} is not available at the selected time`;\n        if (\n            bookings.find(\n                (_) =>\n                    _.user_email ===\n                    (form.value.user_email || currentUser()?.email)\n            )\n        )\n            throw `You already have a desk booked`;\n        const result = await saveBooking(new Booking(form.value)).toPromise();\n        this.clearForm();\n        this.last_success = result;\n        sessionStorage.setItem(\n            'PLACEOS.last_booked_booking',\n            JSON.stringify(result)\n        );\n        this.setView('success');\n        return result;\n    }\n\n    private async checkQuestions() {\n        const ref = this._dialog.open(DeskQuestionsModalComponent);\n        const result = await Promise.race([\n            ref.componentInstance.event\n                .pipe(first((_) => _.reason === 'done'))\n                .toPromise(),\n            ref.afterClosed().toPromise(),\n        ]);\n        if (result?.reason !== 'done') throw 'User cancelled';\n        const form = ref.componentInstance.form.value;\n        for (const key in form) {\n            if (form[key]) throw 'User failed questionaire';\n        }\n        ref.close();\n    }\n}\n","import { FormControl, FormGroup } from '@angular/forms';\nimport { currentUser } from '@placeos/common';\nimport { Booking } from './booking.class';\n\nexport function generateBookingForm(booking: Booking) {\n    const form = new FormGroup({\n        id: new FormControl(booking.id || ''),\n        date: new FormControl(booking.date, []),\n        duration: new FormControl(booking.duration),\n        booking_type: new FormControl(booking.booking_type),\n        zones: new FormControl(booking.zones),\n        title: new FormControl(booking.title),\n        description: new FormControl(booking.description),\n        asset_id: new FormControl(booking.asset_id),\n        user: new FormControl(currentUser()),\n        user_id: new FormControl(booking.user_id),\n        user_email: new FormControl(booking.user_email),\n        booked_by: new FormControl(currentUser()),\n        booked_by_id: new FormControl(booking.booked_by_id),\n        booked_by_email: new FormControl(booking.booked_by_email),\n    });\n    form.valueChanges.subscribe((v) => {\n        const user = v.user;\n        const booker = v.booked_by;\n        booker || user\n            ? form.patchValue(\n                  {\n                      user_id: user.id || booker.id,\n                      user_email: user.email || booker.id,\n                      booked_by_id: booker.id,\n                      booked_by_email: booker.email,\n                  },\n                  { emitEvent: false }\n              )\n            : '';\n    });\n    return form;\n}\n","import { Overlay, OverlayRef } from '@angular/cdk/overlay';\nimport { CdkPortal } from '@angular/cdk/portal';\nimport {\n    Component,\n    ElementRef,\n    HostListener,\n    Inject,\n    OnInit,\n    ViewChild,\n} from '@angular/core';\nimport { getModule } from '@placeos/ts-client';\nimport { MAP_FEATURE_DATA } from '@placeos/components';\nimport { differenceInMinutes, formatDistanceToNow } from 'date-fns';\nexport interface DeviceInfoData {\n    mac: string;\n    variance: number;\n    last_seen: number;\n    system: string;\n    manufacturer?: string;\n    os?: string;\n    ssid?: string;\n    user?: any;\n    bg_color?: string;\n}\n\n@Component({\n    selector: '[explore-device-info]',\n    template: `\n        <div\n            name=\"radius\"\n            (mouseenter)=\"loadUser()\"\n            class=\"radius absolute center bg-blue-600 bg-opacity-25 border-4 border-dashed border-blue-600 rounded-full\"\n            [style]=\"'height: ' + diameter + '%; width: ' + diameter + '%;'\"\n        ></div>\n        <div\n            name=\"dot\"\n            #dot\n            class=\"h-2 w-2 absolute center rounded-full pointer-events-auto shadow\"\n            [style.background-color]=\"bg_color\"\n        ></div>\n\n        <ng-template cdk-portal>\n            <div\n                name=\"device-info\"\n                class=\"w-64 rounded bg-white p-4 top-0 left-0 shadow pointer-events-none\"\n                (mouseleave)=\"close()\"\n            >\n                <div class=\"arrow\"></div>\n                <div class=\"details\">\n                    <p><label>MAC:</label> {{ mac }}</p>\n                    <p><label>Accuracy:</label> {{ variance }}m</p>\n                    <p><label>Last Seen:</label> {{ last_seen }}</p>\n                    <p type *ngIf=\"manufacturer\">\n                        <label>Manufacturer:</label> {{ manufacturer }}\n                    </p>\n                    <p os *ngIf=\"os\"><label>OS:</label> {{ os }}</p>\n                    <p ssid *ngIf=\"ssid\"><label>SSID:</label> {{ ssid }}</p>\n                    <p username *ngIf=\"username\">\n                        <label>Username:</label>\n                        {{ user?.name || user?.username || username }}\n                    </p>\n                    <p user *ngIf=\"user\">\n                        <label>Type:</label> {{ user.type }}\n                    </p>\n                </div>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host {\n                pointer-events: auto;\n            }\n\n            :host > [name='dot'] {\n                background-color: #616161;\n            }\n\n            :host:hover > [name='radius'] {\n                opacity: 1;\n            }\n\n            [name='radius'] {\n                opacity: 0;\n                transition: opacity 200ms;\n                pointer-events: none;\n            }\n        `,\n    ],\n})\nexport class ExploreDeviceInfoComponent implements OnInit {\n    /** Name of the user associated with the mac address */\n    public username = '';\n    /** User details associated with device */\n    public readonly user = this._details.user;\n    /** Mac Address of the device */\n    public readonly mac = this._details.mac;\n    /** Mac Address of the device */\n    public readonly manufacturer = this._details.manufacturer;\n    /** Mac Address of the device */\n    public readonly os = this._details.os;\n    /** Mac Address of the device */\n    public readonly ssid = this._details.ssid;\n    /** Accuracy of the location data */\n    public readonly variance = this._details.variance?.toFixed(2);\n    /** Diameter of the radius circle */\n    public readonly diameter = this._details.variance * 100;\n    /** Background color for the dot */\n    public readonly bg_color = this._details.bg_color || this.distance_color;\n\n    public overlay_ref: OverlayRef = null;\n    /** Time of the last update */\n    public get last_seen() {\n        return formatDistanceToNow((this._details.last_seen || 0) * 1000, {\n            addSuffix: true,\n        });\n    }\n\n    public y_pos: 'top' | 'bottom';\n\n    public x_pos: 'end' | 'start';\n    public get distance() {\n        return Math.abs(\n            differenceInMinutes(\n                (this._details.last_seen || 0) * 1000,\n                new Date()\n            )\n        );\n    }\n\n    public get distance_color() {\n        return this.distance < 10\n            ? '#43a047'\n            : this.distance < 20\n            ? '#ffb300'\n            : '#e53935';\n    }\n\n    @ViewChild(CdkPortal) private _portal: CdkPortal;\n    @ViewChild('dot') private _dot: ElementRef<HTMLDivElement>;\n\n    @HostListener('mouseenter') public onEnter = () => this.loadUser();\n    @HostListener('mouseleave') public onLeave = () => this.close();\n    @HostListener('click') public onClick = () => this.loadUser();\n    @HostListener('touchend') public onTouch = () => this.loadUser();\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: DeviceInfoData,\n        private _element: ElementRef<HTMLElement>,\n        private _overlay: Overlay\n    ) {}\n\n    public ngOnInit(tries: number = 0) {\n        if (tries > 10) return;\n        setTimeout(() => {\n            const parent = this._element.nativeElement.parentElement\n                ?.parentElement;\n            if (!parent) return this.ngOnInit(++tries);\n            const position = {\n                y: parseInt(parent.style.top, 10) / 100,\n                x: parseInt(parent.style.left, 10) / 100,\n            };\n            this.y_pos = position.y >= 0.5 ? 'bottom' : 'top';\n            this.x_pos = position.x >= 0.5 ? 'end' : 'start';\n        }, 200);\n    }\n\n    public async loadUser() {\n        this.open();\n        if (this.username) return;\n        const mod = getModule(this._details.system, 'LocationServices');\n        if (mod) {\n            this.username = 'Loading...';\n            const details = await mod\n                .execute('check_ownership_of', [this.mac])\n                .catch((_) => null);\n            this.username =\n                details && details.assigned_to ? details.assigned_to : '';\n        }\n    }\n\n    public open() {\n        if (this.overlay_ref) this.close();\n        if (!this._portal) return;\n        this.overlay_ref = this._overlay.create({\n            positionStrategy: this._overlay\n                .position()\n                .flexibleConnectedTo(this._dot)\n                .withPositions([\n                    {\n                        originX: this.x_pos === 'start' ? 'end' : 'start',\n                        originY: this.y_pos === 'top' ? 'bottom' : 'top',\n                        overlayX: this.x_pos || 'end',\n                        overlayY: this.y_pos || 'bottom',\n                    },\n                ]),\n        });\n        this.overlay_ref.attach(this._portal);\n    }\n\n    public close() {\n        if (this.overlay_ref) {\n            this.overlay_ref.dispose();\n            this.overlay_ref = null;\n        }\n    }\n}\n","import { Component, ElementRef, Inject, OnInit } from '@angular/core';\n\nimport { MAP_FEATURE_DATA } from '@placeos/components';\n\nexport interface DeskInfoData {\n    map_id: string;\n    user: string;\n    start?: number;\n    end?: number;\n    status: 'free' | 'busy' | 'pending' | 'reserved' | 'unknown' | '';\n}\n\n@Component({\n    selector: 'explore-desk-info',\n    template: `\n        <div\n            name=\"space-info\"\n            [id]=\"map_id\"\n            [class]=\"\n                'absolute rounded bg-white p-4 top-0 left-0 shadow ' +\n                x_pos +\n                ' ' +\n                y_pos\n            \"\n        >\n            <div class=\"arrow\"></div>\n            <div class=\"details\">\n                <h4 map-id class=\"m-0 font-medium\">{{ map_id }}</h4>\n                <p user class=\"mt-2 text-sm\" *ngIf=\"user\">{{ user }}</p>\n                <p start class=\"mt-1 text-sm\" *ngIf=\"start\">\n                    {{ start | date: 'shortTime' }} &ndash;\n                    {{ end | date: 'shortTime' }}\n                </p>\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                pointer-events: none;\n                z-index: 1;\n            }\n\n            [name='space-info'] {\n                width: 16rem;\n            }\n\n            [name='status'] {\n                background-color: #43a047;\n                font-weight: 500;\n            }\n\n            [name='status'].busy {\n                background-color: #e53935;\n            }\n\n            [name='status'].pending {\n                background-color: #ffb300;\n            }\n\n            [name='status'].not-bookable {\n                background-color: #757575;\n            }\n        `,\n    ],\n})\nexport class ExploreDeskInfoComponent implements OnInit {\n    /** Space to display details for */\n    public readonly map_id = this._details.map_id;\n    public readonly user = this._details.user;\n    public readonly start = this._details.start;\n    public readonly end = this._details.end;\n\n    public y_pos: 'top' | 'bottom';\n\n    public x_pos: 'left' | 'right';\n\n    constructor(\n        @Inject(MAP_FEATURE_DATA) private _details: DeskInfoData,\n        private _element: ElementRef<HTMLElement>\n    ) {}\n\n    public ngOnInit(tries: number = 0) {\n        if (tries > 10) return;\n        setTimeout(() => {\n            const parent = this._element.nativeElement.parentElement\n                ?.parentElement;\n            if (!parent) return this.ngOnInit(++tries);\n            const position = {\n                y: parseInt(parent.style.top, 10) / 100,\n                x: parseInt(parent.style.left, 10) / 100,\n            };\n            this.y_pos = position.y >= 0.5 ? 'bottom' : 'top';\n            this.x_pos = position.x >= 0.5 ? 'right' : 'left';\n        }, 200);\n    }\n\n    public get available_until() {\n        return '';\n    }\n}\n","import { Injectable, OnDestroy } from '@angular/core';\nimport { getModule, showMetadata } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { catchError, first, map, switchMap } from 'rxjs/operators';\nimport { endOfDay, getUnixTime, startOfDay } from 'date-fns';\n\nimport {\n    BaseClass,\n    currentUser,\n    HashMap,\n    notifySuccess,\n    SettingsService,\n} from '@placeos/common';\nimport {\n    BookingFormService,\n    DesksService,\n    queryBookings,\n} from '@placeos/bookings';\nimport { StaffUser } from '@placeos/users';\nimport { Desk, OrganisationService } from '@placeos/organisation';\n\nimport { ExploreStateService } from './explore-state.service';\nimport { DEFAULT_COLOURS } from './explore-spaces.service';\nimport { ExploreDeviceInfoComponent } from './explore-device-info.component';\nimport { ExploreDeskInfoComponent } from './explore-desk-info.component';\n\nexport interface DeskOptions {\n    enable_booking?: boolean;\n    date?: number | Date;\n    zones?: string[];\n    host?: StaffUser;\n}\nexport interface DesksStats {\n    free: number;\n    occupied: number;\n    total: number;\n}\n\n@Injectable()\nexport class ExploreDesksService extends BaseClass implements OnDestroy {\n    private _in_use = new BehaviorSubject<string[]>([]);\n    private _options = new BehaviorSubject<DeskOptions>({});\n    private _desks = new BehaviorSubject<string[]>([]);\n    private _reserved = new BehaviorSubject<string[]>([]);\n    private _statuses: HashMap<string> = {};\n    private _poll = new BehaviorSubject<number>(0);\n\n    private _desk_bookings = combineLatest([\n        this._state.level,\n        this._poll,\n    ]).pipe(\n        switchMap(([lvl]) =>\n            queryBookings({\n                period_start: getUnixTime(startOfDay(new Date())),\n                period_end: getUnixTime(endOfDay(new Date())),\n                type: 'desk',\n                zones: lvl.id,\n            })\n        )\n    );\n\n    public readonly desk_list = this._state.level.pipe(\n        switchMap((lvl) =>\n            showMetadata(lvl.id, { name: 'desks' }).pipe(\n                map((i) =>\n                    (i.details instanceof Array ? i.details : []).map(\n                        (j: HashMap) => new Desk({ ...j, zone: lvl as any })\n                    )\n                )\n            )\n        ),\n        catchError((e) => [])\n    );\n\n    private _bind = this._state.level.pipe(\n        map((lvl) => {\n            this._statuses = {};\n            this.unsubWith('lvl');\n            if (!lvl) return;\n            const building = this._org.buildings.find(\n                (bld) => bld.id === lvl.parent_id\n            );\n            if (!building) return;\n            const system_id =\n                building.bindings?.area_management ||\n                this._org.organisation.bindings?.area_management;\n            if (!system_id) return;\n            let binding = getModule(system_id, 'AreaManagement').binding(\n                lvl.id\n            );\n            this.subscription(\n                `lvl-in_use`,\n                binding\n                    .listen()\n                    .subscribe((d) =>\n                        this.processBindingChange(d || {}, system_id)\n                    )\n            );\n            this.subscription('lvl-in_use_bind', binding.bind());\n            binding = getModule(system_id, 'AreaManagement').binding(\n                `${lvl.id}:desk_ids`\n            );\n            this.subscription(\n                `lvl-desks_list`,\n                binding.listen().subscribe((d) => this._desks.next(d || []))\n            );\n            this.subscription('lvl-desk_list_bind', binding.bind());\n        })\n    );\n\n    private _state_change = combineLatest([\n        this.desk_list,\n        this._in_use,\n        this._reserved,\n        this._options,\n    ]).pipe(\n        // debounceTime(50),\n        map(([desks, in_use, reserved]) => {\n            this._statuses = {};\n            for (const { id, bookable } of desks) {\n                const is_used = in_use.some((i) => id === i);\n                const is_reserved = reserved.some((i) => id === i);\n                this._statuses[id] = bookable\n                    ? !is_used\n                        ? 'free'\n                        : is_reserved\n                        ? 'reserved'\n                        : 'busy'\n                    : 'not-bookable';\n            }\n            this.processDesks(desks);\n        })\n    );\n\n    constructor(\n        private _state: ExploreStateService,\n        private _org: OrganisationService,\n        private _settings: SettingsService,\n        private _bookings: BookingFormService\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.setOptions({\n            enable_booking: this._settings.get('app.desks.enabled') !== false,\n        });\n        this.subscription('bind', this._bind.subscribe());\n        this.subscription('changes', this._state_change.subscribe());\n        this.subscription(\n            'desks',\n            this.desk_list.subscribe((desks) => this.processDesks(desks))\n        );\n    }\n\n    public startPolling(delay: number = 30 * 1000) {\n        this.subscription(\n            'desks_in_use_bookings',\n            this._desk_bookings.subscribe((_) =>\n                this._in_use.next(_.map((i) => i.asset_id))\n            )\n        );\n        this.interval(\n            'poll',\n            () => this._poll.next(new Date().valueOf()),\n            delay\n        );\n    }\n\n    public stopPolling() {\n        this.clearInterval('poll');\n    }\n\n    public setOptions(options: DeskOptions) {\n        this._options.next({ ...this._options.getValue(), ...options });\n    }\n\n    public processBindingChange(\n        { value }: { value: any[] },\n        system_id: string\n    ) {\n        const devices = (value || []).filter(\n            (v) => !['desk', 'booking'].includes(v.location)\n        );\n        const desks = (value || []).filter(\n            (v) =>\n                v.location === 'desk' ||\n                (v.location === 'booking' && v.type === 'desk')\n        );\n        this._in_use.next(desks.map((v) => v.map_id || v.asset_id));\n        this._reserved.next(\n            desks\n                .filter((v) => !v.at_location)\n                .map((v) => v.map_id || v.asset_id)\n        );\n        this.processDevices(devices, system_id);\n        this.timeout('update', () => this.updateStatus(), 100);\n    }\n\n    private updateStatus() {\n        const style_map = {};\n        const colours = this._settings.get('app.explore.colors') || {};\n        for (const desk_id in this._statuses) {\n            if (!this._statuses[desk_id]) continue;\n            style_map[`#${desk_id}`] = {\n                fill:\n                    colours[`desk-${this._statuses[desk_id]}`] ||\n                    colours[`${this._statuses[desk_id]}`] ||\n                    DEFAULT_COLOURS[`${this._statuses[desk_id]}`],\n                opacity: 0.6,\n            };\n        }\n        this._state.setStyles('desks', style_map);\n    }\n\n    private processDevices(devices: HashMap[], system_id: string) {\n        const list = [];\n        for (const device of devices) {\n            const x = device.x / device.map_width;\n            const y = device.y / device.map_height;\n            list.push({\n                location: {\n                    x: device.coordinates_from?.includes('right') ? 1 - x : x,\n                    y: device.coordinates_from?.includes('bottom') ? 1 - y : y,\n                },\n                content: ExploreDeviceInfoComponent,\n                data: { ...device, system: system_id },\n            });\n        }\n        this._state.setFeatures('devices', list);\n    }\n\n    private processDesks(desks: HashMap[]) {\n        const list = [];\n        const actions = [];\n        const options = this._options.getValue();\n        for (const desk of desks) {\n            list.push({\n                location: desk.id,\n                content: ExploreDeskInfoComponent,\n                hover: true,\n                data: {\n                    map_id: desk.name,\n                    status: this._statuses[desk.map_id],\n                },\n            });\n            const book_fn = async () => {\n                this._bookings.newForm();\n                this._bookings.form.patchValue({\n                    asset_id: desk.id,\n                    user: options.host || currentUser(),\n                    booking_type: 'desk',\n                });\n                await this._bookings.confirmPost();\n                notifySuccess(\n                    `Successfull booked desk ${desk.name || desk.id}`\n                );\n            };\n            actions.push({\n                id: desk.id,\n                action: 'click',\n                callback: book_fn,\n            });\n            actions.push({\n                id: desk.id,\n                action: 'touchend',\n                callback: book_fn,\n            });\n        }\n        this._state.setActions(\n            'desks',\n            this._options.getValue().enable_booking ? actions : []\n        );\n        this._state.setFeatures('desks', list);\n        this.timeout('update', () => this.updateStatus(), 100);\n    }\n}\n","import { Component } from '@angular/core';\nimport { ExploreStateService } from './explore-state.service';\n\n@Component({\n    selector: `explore-zoom-controls`,\n    template: `\n        <button z-in mat-icon-button class=\"bg-white\" (click)=\"zoomIn()\">\n            <app-icon>add</app-icon>\n        </button>\n        <button z-out mat-icon-button class=\"bg-white\" (click)=\"zoomOut()\">\n            <app-icon>remove</app-icon>\n        </button>\n        <button reset mat-icon-button class=\"bg-white\" (click)=\"reset()\">\n            <app-icon>autorenew</app-icon>\n        </button>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                padding: 0.5rem;\n            }\n\n            button {\n                border: 1px solid #ccc;\n                border-radius: 0;\n            }\n\n            button:first-child {\n                border-radius: 0.25rem 0.25rem 0 0;\n                border-bottom: none;\n            }\n\n            button:last-child {\n                border-radius: 0 0 0.25rem 0.25rem;\n                border-top: none;\n            }\n        `,\n    ],\n})\nexport class ExploreZoomControlComponent {\n    public readonly zoomIn = () =>\n        this._state.setPositions(\n            Math.min(10, this._state.positions.zoom * 1.2),\n            this._state.positions.center\n        );\n    public readonly zoomOut = () =>\n        this._state.setPositions(\n            Math.max(1, this._state.positions.zoom * (1 / 1.2)),\n            this._state.positions.center\n        );\n    public readonly reset = () =>\n        this._state.setPositions(1, { x: 0.5, y: 0.5 });\n\n    constructor(private _state: ExploreStateService) {}\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject, combineLatest, Observable, of } from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    first,\n    map,\n    shareReplay,\n    switchMap,\n    tap,\n} from 'rxjs/operators';\n\nimport { SpacesService } from '@placeos/spaces';\nimport { searchStaff, StaffUser, User } from '@placeos/users';\nimport { getModule } from '@placeos/ts-client';\nimport { unique } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\n\nexport interface SearchResult {\n    /** Unique ID of the result item */\n    id: string;\n    /** Type of the item being displayed */\n    type: 'space' | 'user' | 'contact' | 'feature';\n    /** Main display string for the item */\n    name: string;\n    /** Secondary display string for the item. e.g. email, location, coordinates */\n    description: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class ExploreSearchService {\n    /** Current search results for staff users */\n    private _emergency_contacts = new BehaviorSubject<User[]>([]);\n    /** Filter string for results */\n    private _filter = new BehaviorSubject<string>('');\n    /** Whether results are being loaded */\n    private _loading = new BehaviorSubject<boolean>(false);\n\n    public readonly emergency_contacts = this._emergency_contacts.asObservable();\n\n    private _user_search: Observable<StaffUser[]> = this._filter.pipe(\n        debounceTime(400),\n        tap(() => this._loading.next(true)),\n        switchMap((q) => (q?.length > 2 ? this.search_fn(q) : of([]))),\n        catchError(() => [])\n    );\n\n    public readonly search_results: Observable<SearchResult[]> = combineLatest([\n        this._spaces.list,\n        this._user_search,\n        this._emergency_contacts,\n    ]).pipe(\n        debounceTime(1000),\n        map(([spaces, users, contacts]) => {\n            const filter = this._filter.getValue() || '';\n            const search = filter.toLowerCase();\n            const results = unique(\n                [\n                    ...spaces\n                        .filter(\n                            (_) =>\n                                _.email.toLowerCase().includes(search) ||\n                                _.name.toLowerCase().includes(search) ||\n                                _.display_name.toLowerCase().includes(search)\n                        )\n                        .map((s) => ({\n                            id: s.id,\n                            type: 'space',\n                            name: s.display_name || s.name,\n                            description: `Capacity: ${s.capacity} `,\n                        })),\n                    ...contacts\n                        .map((u) => ({\n                            id: u.email,\n                            type: (u as any).type || 'contact',\n                            name: u.name,\n                            description: u.email,\n                        }))\n                        .filter(\n                            (_) =>\n                                _.name.toLowerCase().includes(search) ||\n                                _.description.toLowerCase().includes(search) ||\n                                _.type.toLowerCase().includes(search)\n                        ),\n                    ...users.map((u) => ({\n                        id: u.email,\n                        type: 'user',\n                        name: u.name,\n                        description: u.email,\n                    })),\n                ],\n                'id'\n            );\n            results.sort((a, b) => a.name.localeCompare(b.name));\n            return results;\n        }),\n        tap(() => this._loading.next(false)),\n        shareReplay(1)\n    );\n    /** Obverable for whether results are being loaded */\n    public readonly loading = this._loading.asObservable();\n    /** Function used to query for users */\n    public search_fn = (q: string) => searchStaff(q);\n\n    constructor(\n        private _spaces: SpacesService,\n        private _org: OrganisationService\n    ) {\n        this._spaces.list.subscribe();\n        this.search_results.subscribe();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        const mod = getModule(\n            this._org.organisation.bindings?.location_services,\n            'LocationServices'\n        );\n        if (mod) {\n            const binding = mod.binding('emergency_contacts');\n            binding.listen().subscribe((contacts_map) => {\n                const list = [];\n                for (const type in contacts_map) {\n                    for (const user of contacts_map[type]) {\n                        list.push({ ...user, type });\n                    }\n                }\n                this._emergency_contacts.next(list);\n            });\n            binding.bind();\n        }\n    }\n\n    public setFilter(str: string) {\n        this._filter.next(str);\n    }\n}\n","import { Component, ElementRef, HostListener, ViewChild } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { BaseClass } from '@placeos/common';\n\nimport { ExploreSearchService, SearchResult } from './explore-search.service';\n\n@Component({\n    selector: 'explore-search',\n    template: `\n        <div\n            role=\"search\"\n            tabindex=\"0\"\n            matRipple\n            class=\"bg-white m-2 flex items-center z-10 relative overflow-hidden outline-none\"\n            [class.show]=\"show || search_str\"\n        >\n            <app-icon\n                class=\"text-2xl outline-none\"\n                tabindex=\"0\"\n                (click)=\"show ? closeSearch($event) : showSearch()\"\n            >\n                {{ show || search_str ? 'close' : 'search' }}\n            </app-icon>\n            <input\n                #input\n                keyboard\n                class=\"flex-1 text-base border-none outline-none\"\n                [(ngModel)]=\"search_str\"\n                (ngModelChange)=\"setItem($event)\"\n                placeholder=\"Search for...\"\n                (blur)=\"show = !!search_str\"\n                [matAutocomplete]=\"auto\"\n                [matAutocompleteConnectedTo]=\"origin\"\n            />\n            <mat-spinner\n                *ngIf=\"loading | async\"\n                class=\"mr-2\"\n                [diameter]=\"32\"\n            ></mat-spinner>\n            <div\n                class=\"absolute bottom-0 left-8 right-8 min-w-[20rem]\"\n                matAutocompleteOrigin\n                #origin=\"matAutocompleteOrigin\"\n            ></div>\n        </div>\n        <mat-autocomplete #auto=\"matAutocomplete\">\n            <ng-container\n                *ngIf=\"(loading | async) !== true && (show || search_str)\"\n            >\n                <mat-option\n                    *ngIf=\"!(results | async)?.length\"\n                    class=\"pointer-events-none\"\n                >\n                    No matches found\n                </mat-option>\n                <mat-option\n                    *ngFor=\"let option of results | async | slice: 0:5\"\n                    [value]=\"option\"\n                >\n                    <div class=\"flex items-center leading-tight\">\n                        <div class=\"flex-1 overflow-hidden\">\n                            <div class=\"truncate w-full\">{{ option.name }}</div>\n                            <div class=\"text-xs\">{{ option.description }}</div>\n                        </div>\n                        <div\n                            class=\"text-xs font-bold p-2 capitalize text-white bg-gray-500 rounded\"\n                        >\n                            {{ option.type }}\n                        </div>\n                    </div>\n                </mat-option>\n            </ng-container>\n        </mat-autocomplete>\n    `,\n    styles: [\n        `\n            :host {\n                z-index: 99;\n            }\n\n            [role='search'] {\n                height: 3.125rem;\n                width: 3.125rem;\n                border-radius: 1.5rem;\n                border: 1px solid #ccc;\n                transition: width 200ms;\n            }\n\n            app-icon {\n                margin: 0.55rem;\n            }\n\n            [role='search'].show {\n                width: 32rem;\n                max-width: calc(100vw - 1rem);\n                border-color: #1e88e5;\n            }\n        `,\n    ],\n})\nexport class ExploreSearchComponent extends BaseClass {\n    public show = false;\n    public search_str = '';\n    public readonly results = this._search.search_results;\n    public readonly loading = this._search.loading;\n    public readonly setFilter = (s) => this._search.setFilter(s);\n    public readonly setItem = (i) =>\n        i instanceof Object ? this.select(i) : this.setFilter(i);\n\n    @ViewChild('input') private _input_el: ElementRef<HTMLInputElement>;\n\n    @HostListener('document:click', ['$event'])\n    public checkClick(event) {\n        if (!this._el?.nativeElement?.contains(event.target)) {\n            this.show = false;\n            this._input_el?.nativeElement?.blur();\n        }\n    }\n\n    @HostListener('document:touchstart', ['$event']) public onTouch = (e) =>\n        this.checkClick(e);\n\n    constructor(\n        private _el: ElementRef<HTMLElement>,\n        private _search: ExploreSearchService,\n        private _router: Router,\n        private _route: ActivatedRoute\n    ) {\n        super();\n    }\n\n    public showSearch() {\n        this.show = true;\n        if (this._input_el?.nativeElement) {\n            this.timeout(\n                'focus',\n                () => this._input_el.nativeElement.focus(),\n                300\n            );\n        }\n    }\n\n    public closeSearch(e?: any) {\n        this.show = false;\n        this.search_str = '';\n        this.setFilter('');\n        if (this._input_el?.nativeElement) {\n            this._input_el.nativeElement.focus();\n            this._input_el.nativeElement.blur();\n        }\n    }\n\n    public select(item: SearchResult) {\n        this.search_str = item.name;\n        const query: any = {};\n        const type =\n            item.type === 'space'\n                ? 'space'\n                : item.type === 'feature'\n                ? 'feature'\n                : 'user';\n        query[type] = item.id;\n        this._router.navigate([], {\n            relativeTo: this._route,\n            queryParams: query,\n        });\n    }\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Type } from '@angular/core';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { ComponentsModule } from '@placeos/components';\n\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\nimport { OverlayModule } from '@angular/cdk/overlay';\nimport { PortalModule } from '@angular/cdk/portal';\n\nimport { FormFieldsModule } from '@placeos/form-fields';\n\nimport { ExploreMapControlComponent } from './explore-map-control.component';\nimport { ExploreMapViewComponent } from './explore-map-view.component';\nimport { ExploreSearchComponent } from './explore-search.component';\nimport { ExploreSpaceInfoComponent } from './explore-space-info.component';\nimport { ExploreZoomControlComponent } from './explore-zoom-control.component';\nimport { ExploreDeviceInfoComponent } from './explore-device-info.component';\nimport { ExploreBookingModalComponent } from './explore-booking-modal.component';\nimport { ExploreDeskInfoComponent } from './explore-desk-info.component';\n\nconst COMPONENTS: Type<any>[] = [\n    ExploreMapControlComponent,\n    ExploreMapViewComponent,\n    ExploreSearchComponent,\n    ExploreSpaceInfoComponent,\n    ExploreDeviceInfoComponent,\n    ExploreDeskInfoComponent,\n    ExploreZoomControlComponent,\n    ExploreBookingModalComponent,\n];\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        ComponentsModule,\n        FormsModule,\n        ReactiveFormsModule,\n        MatSlideToggleModule,\n        OverlayModule,\n        PortalModule,\n        FormFieldsModule\n    ],\n    exports: [...COMPONENTS],\n})\nexport class SharedExploreModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { BaseClass, Identity } from '@placeos/common';\nimport { VirtualKeyboardComponent } from '@placeos/components';\nimport {\n    Building,\n    BuildingLevel,\n    OrganisationService,\n} from '@placeos/organisation';\nimport { first } from 'rxjs/operators';\n\n@Component({\n    selector: '[bootstrap]',\n    template: `\n        <div\n            form\n            class=\"absolute top-2 left-1/2 transform -translate-x-1/2 bg-white overflow-hidden flex flex-col items-center shadow rounded\"\n        >\n            <header\n                class=\"px-4 py-2 bg-primary text-white w-full text-lg font-medium mb-2\"\n            >\n                Map Kiosk Setup\n            </header>\n            <ng-container *ngIf=\"!loading; else load_state\">\n                <div *ngIf=\"buildings && buildings.length\">\n                    <label>Select a building from the dropdown below</label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            #select\n                            building\n                            [(ngModel)]=\"active_building\"\n                            (ngModelChange)=\"updateRotations()\"\n                            placeholder=\"Select building\"\n                        >\n                            <mat-option\n                                *ngFor=\"let option of buildings\"\n                                [value]=\"option\"\n                            >\n                                {{ option.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div *ngIf=\"levels && levels.length\">\n                    <label>Select a level from the dropdown below</label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            #select\n                            level\n                            [(ngModel)]=\"active_level\"\n                            placeholder=\"Select level\"\n                        >\n                            <mat-option\n                                *ngFor=\"let option of levels\"\n                                [value]=\"option\"\n                            >\n                                {{ option.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div *ngIf=\"rotations && rotations.length\">\n                    <label>\n                        Please select an orientation from the dropdown below\n                    </label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            #select\n                            [(value)]=\"active_rotation\"\n                            placeholder=\"Select orientation\"\n                        >\n                            <mat-option\n                                *ngFor=\"let option of rotations\"\n                                [value]=\"option\"\n                            >\n                                {{ option.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div *ngIf=\"locations && locations.length\">\n                    <label>\n                        Please select an fixed location from the dropdown below\n                    </label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            #select\n                            [(value)]=\"active_location\"\n                            placeholder=\"Select location\"\n                        >\n                            <mat-option\n                                *ngFor=\"let option of locations\"\n                                [value]=\"option\"\n                            >\n                                {{ option.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <button\n                    mat-button\n                    class=\"mb-2\"\n                    [disabled]=\"!active_building && !active_level\"\n                    (click)=\"bootstrapKiosk()\"\n                >\n                    Finish Setup\n                </button>\n            </ng-container>\n        </div>\n        <ng-template #load_state>\n            <div class=\"flex flex-col items-center p-8 m-auto\">\n                <mat-spinner [diameter]=\"32\"></mat-spinner>\n                <p>{{ loading }}</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [\n        `\n            :host > div {\n                width: 24rem;\n                max-width: calc(100vw - 2rem);\n            }\n\n            mat-form-field {\n                width: 100%;\n            }\n\n            [form] > div {\n                padding: 0 1em;\n            }\n        `,\n    ],\n})\nexport class BootstrapComponent extends BaseClass implements OnInit {\n    /** Loading state of the bootstrap */\n    public loading: string;\n    /** Actively selected building */\n    public active_building: Building;\n    /** Actively selected level */\n    public active_level: BuildingLevel;\n    /** Actively selected level */\n    public active_rotation: Identity;\n    /** Actively selected location */\n    public active_location: Identity;\n\n    public rotations: Identity[] = [];\n\n    /** List of available buildings */\n    public get buildings(): Building[] {\n        return this._org.buildings;\n    }\n\n    /** List of available levels */\n    public get levels(): readonly BuildingLevel[] {\n        if (!this.active_building) {\n            return [];\n        }\n        return this._org.levelsForBuilding(this.active_building) || [];\n    }\n\n    /** List of available locations */\n    public get locations(): readonly Identity[] {\n        if (!this.active_level) {\n            return [];\n        }\n        return this.active_level.locations || [];\n    }\n\n    constructor(\n        private _org: OrganisationService,\n        private _route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) => {\n                if (params.has('osk')) {\n                    const osk_enabled = params.get('osk') === 'true';\n                    localStorage.setItem('OSK.enabled', `${osk_enabled}`);\n                }\n                if (params.has('clear') && params.get('clear') === 'true') {\n                    localStorage.removeItem('KIOSK.building');\n                    localStorage.removeItem('KIOSK.level');\n                    localStorage.removeItem('KIOSK.orientation');\n                }\n                if (params.has('level')) {\n                    const level = this._org.levelWithID([params.get('level')]);\n                    if (level) {\n                        this.active_level = level;\n                        this.bootstrapKiosk();\n                    }\n                }\n            })\n        );\n        this.timeout('check', () => this.checkBootstrap(), 1000);\n    }\n\n    public updateRotations() {\n        const orientations = this.active_building.orientations;\n        const rotations: Identity[] = [];\n        for (const key in orientations) {\n            if (orientations[key]) {\n                rotations.push({\n                    id: key,\n                    name: `${key.split('_').join(' ')} (${\n                        orientations[key] * 90\n                    })`,\n                    value: orientations[key],\n                });\n            }\n        }\n        this.rotations = rotations;\n        this.active_rotation = this.rotations[0];\n    }\n\n    /**\n     * Store bootstrapped values and navigate to the main page\n     */\n    public bootstrapKiosk() {\n        this.loading = 'Bootstrapping application...';\n        if (this.active_level) {\n            if (localStorage) {\n                localStorage.setItem(\n                    'KIOSK.building',\n                    this.active_building?.id || this.active_level.parent_id\n                );\n                localStorage.setItem('KIOSK.level', this.active_level.id);\n                if (this.active_rotation) {\n                    localStorage.setItem(\n                        'KIOSK.orientation',\n                        `${this.active_rotation.id}`\n                    );\n                }\n                if (this.active_location) {\n                    localStorage.setItem(\n                        'KIOSK.location',\n                        `${this.active_location.id}`\n                    );\n                }\n            }\n            this._router.navigate(['/explore']);\n        }\n        this.loading = null;\n    }\n\n    /**\n     * Check for any existing bootstrapped values\n     */\n    private checkBootstrap() {\n        this.loading = 'Checking for existing parameters...';\n        if (localStorage) {\n            const building_id = localStorage.getItem('KIOSK.building');\n            const level_id = localStorage.getItem('KIOSK.level');\n            if (building_id && level_id) {\n                this._router.navigate(['/explore']);\n            }\n        }\n        VirtualKeyboardComponent.enabled =\n            localStorage.getItem('OSK.enabled') === 'true';\n        this.loading = null;\n    }\n}\n","import { Component } from '@angular/core';\n\n@Component({\n    selector: 'footer-menu',\n    template: `\n        <div\n            class=\"flex items-center bg-white divide-x border-t border-solid border-gray-300 w-full\"\n        >\n            <a\n                mat-button\n                class=\"flex-1 h-16 !rounded-none\"\n                [routerLink]=\"['/desks']\"\n                routerLinkActive=\"!bg-primary !text-white\"\n            >\n                <div class=\"flex flex-col items-center justify-center\">\n                    <app-icon class=\"text-2xl\">book</app-icon>\n                    <p class=\"m-0\">Book Desk</p>\n                </div>\n            </a>\n            <a\n                mat-button\n                class=\"flex-1 h-16 !rounded-none\"\n                [routerLink]=\"['/explore']\"\n                routerLinkActive=\"!bg-primary !text-white\"\n            >\n                <div class=\"flex flex-col items-center justify-center\">\n                    <app-icon class=\"text-2xl\">place</app-icon>\n                    <p class=\"m-0\">Map</p>\n                </div>\n            </a>\n        </div>\n    `\n})\nexport class FooterMenuComponent {}\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { BaseClass, current_user, SettingsService } from '@placeos/common';\nimport { first } from 'rxjs/operators';\n\n@Component({\n    selector: '[desk-booking]',\n    template: ` <footer-menu></footer-menu> `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n                background: #f0f0f0;\n            }\n\n            desk-flow-listing {\n                max-height: calc(100% - 4rem);\n            }\n        `,\n    ],\n})\nexport class DeskBookingComponent extends BaseClass implements OnInit {\n    public get countdown_time() {\n        return (\n            this._settings.get('app.general.kiosk_reset_delay') || 5 * 60 * 1000\n        );\n    }\n\n    constructor(private _settings: SettingsService, private _router: Router) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await current_user.pipe(first((_) => !!_)).toPromise();\n        this.resetCountdown();\n    }\n\n    public resetCountdown() {\n        this.timeout(\n            'reset',\n            () => this._router.navigate(['/explore']),\n            this.countdown_time\n        );\n    }\n}\n","import { Component } from '@angular/core';\nimport { ExploreStateService } from '@placeos/explore';\nimport { OrganisationService } from '@placeos/organisation';\n\n@Component({\n    selector: 'explore-level-select',\n    template: `\n        <div\n            class=\"m-2 rounded overflow-hidden bg-white shadow border border-solid border-gray-300\"\n        >\n            <button\n                *ngFor=\"let lvl of levels | async\"\n                class=\"flex flex-col items-center justify-center h-16 w-16 p-2 border-none\"\n                [class.active]=\"lvl.id === (level | async)?.id\"\n                (click)=\"setLevel(lvl)\"\n                matRipple\n            >\n                <div class=\"text-2xl\">{{ lvl.number }}</div>\n                <p class=\"text-sm whitespace-nowrap m-0\">\n                    {{ lvl.display_name || lvl.name }}\n                </p>\n            </button>\n        </div>\n    `,\n    styles: [\n        `\n            .active {\n                color: var(--primary) !important;\n            }\n\n            button:not(:first-child) {\n                border-top: 1px solid #ccc !important;\n            }\n        `,\n    ],\n})\nexport class ExploreLevelSelectComponent {\n    public readonly levels = this._orgs.active_levels;\n    public readonly level = this._state.level;\n\n    public readonly setLevel = (lvl) => this._state.setLevel(lvl.id);\n\n    constructor(\n        private _orgs: OrganisationService,\n        private _state: ExploreStateService\n    ) {}\n}\n","import { Component, HostListener, OnInit } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport {\n    BaseClass,\n    notifyError,\n    SettingsService,\n    unique,\n} from '@placeos/common';\nimport {\n    MapPinComponent,\n    MapRadiusComponent,\n    VirtualKeyboardComponent,\n} from '@placeos/components';\nimport {\n    ExploreDesksService,\n    ExploreSpacesService,\n    ExploreStateService,\n    ExploreZonesService,\n} from '@placeos/explore';\nimport { OrganisationService } from '@placeos/organisation';\nimport { Space, SpacesService } from '@placeos/spaces';\nimport { getModule } from '@placeos/ts-client';\nimport { MapLocation, showStaff, User } from '@placeos/users';\nimport { first, take } from 'rxjs/operators';\n\n@Component({\n    selector: '[app-explore]',\n    template: `\n        <div\n            class=\"absolute top-0 left-0 bg-secondary rounded-br-xl p-4 z-10 shadow\"\n        >\n            <img class=\"w-32\" [src]=\"logo?.src\" />\n        </div>\n        <!-- <explore-map-stack class=\"z-0\"></explore-map-stack> -->\n        <div class=\"absolute inset-20\">\n            <i-map\n                [src]=\"url | async\"\n                [zoom]=\"(positions | async)?.zoom\"\n                [center]=\"(positions | async)?.center\"\n                [styles]=\"styles | async\"\n                [features]=\"features | async\"\n                [actions]=\"actions | async\"\n                [labels]=\"labels | async\"\n            ></i-map>\n        </div>\n        <explore-zoom-controls\n            class=\"absolute top-1/2 transform -translate-y-1/2 right-0\"\n        ></explore-zoom-controls>\n        <explore-level-select\n            class=\"absolute left-1 top-1/2 transform -translate-y-1/2 z-10\"\n        ></explore-level-select>\n        <explore-search\n            *ngIf=\"can_search\"\n            class=\"absolute top-1 right-1\"\n        ></explore-search>\n        <div\n            name=\"zones\"\n            class=\"p-2 bg-white border border-gray-300 absolute right-1 m-2 rounded flex flex-col items-center space-y-2\"\n            [class.top-2]=\"!can_search\"\n            [class.top-16]=\"can_search\"\n        >\n            <div class=\"flex items-center\">\n                Zones\n                <mat-slide-toggle\n                    class=\"ml-2\"\n                    [ngModel]=\"!(options | async)?.disable?.includes('zones')\"\n                    (ngModelChange)=\"toggleZones($event)\"\n                ></mat-slide-toggle>\n            </div>\n            <div\n                zone-legend\n                *ngIf=\"!(options | async)?.disable?.includes('zones')\"\n                class=\"space-y-2\"\n            >\n                <div class=\"font-medium\">\n                    Zone Usage\n                    <div class=\"flex items-center space-x-2\">\n                        <div class=\"h-3 w-3 rounded-full bg-success\"></div>\n                        <div class=\"w-20 text-center\">0 ~ 50%</div>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <div class=\"h-3 w-3 rounded-full bg-pending\"></div>\n                        <div class=\"w-20 text-center\">51 ~ 75%</div>\n                    </div>\n                    <div class=\"flex items-center space-x-2\">\n                        <div class=\"h-3 w-3 rounded-full bg-error\"></div>\n                        <div class=\"w-20 text-center\">76 ~ 100%</div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div\n            class=\"absolute bottom-2 right-2 p-2 rounded bg-white shadow border border-gray-100\"\n        >\n            <div class=\"font-medium\">Legend</div>\n            <div class=\"flex items-center space-x-2 p-2\">\n                <div class=\"h-3 w-3 rounded-full bg-success\"></div>\n                <div class=\"text-center\">Space Available</div>\n            </div>\n            <div class=\"flex items-center space-x-2 rounded bg-gray-50 p-2\">\n                <div class=\"h-3 w-3 rounded-full bg-error\"></div>\n                <div class=\"text-center\">Space In Use</div>\n            </div>\n            <div class=\"flex items-center space-x-2 p-2\">\n                <div class=\"h-3 w-3 rounded-full bg-gray-400\"></div>\n                <div class=\"text-center\">Space Not-bookable</div>\n            </div>\n        </div>\n        <!-- <footer-menu class=\"w-full\"></footer-menu> -->\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                display: flex;\n                flex-direction: column;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                background-color: #f0f0f0;\n            }\n\n            @media screen and (max-height: 640px) {\n                explore-level-select {\n                    transform: translateY(0) !important;\n                    top: auto !important;\n                    bottom: 0 !important;\n                }\n            }\n\n            @media screen and (orientation: landscape) {\n                explore-level-select {\n                    transform: translateY(0) !important;\n                    top: auto !important;\n                    bottom: 0 !important;\n                }\n            }\n        `,\n    ],\n    providers: [ExploreSpacesService, ExploreDesksService, ExploreZonesService],\n})\nexport class ExploreComponent extends BaseClass implements OnInit {\n    /** Number of seconds after a user action to reset the kiosk state */\n    public reset_delay = 180;\n\n    public get logo() {\n        return this._settings.get('app.logo_dark');\n    }\n    /** Observable for the active map */\n    public readonly url = this._state.map_url;\n    /** Observable for the active map */\n    public readonly styles = this._state.map_styles;\n    /** Observable for the active map */\n    public readonly positions = this._state.map_positions;\n    /** Observable for the active map */\n    public readonly features = this._state.map_features;\n    /** Observable for the active map */\n    public readonly actions = this._state.map_actions;\n    /** Observable for the labels map */\n    public readonly labels = this._state.map_labels;\n    /** Observable for the active map */\n    public readonly options = this._state.options;\n\n    @HostListener('window:mousedown') public onMouse = () =>\n        this.timeout('reset', () => this.resetKiosk(), this.reset_delay * 1000);\n    @HostListener('window:touchstart') public onTouch = () =>\n        this.timeout('reset', () => this.resetKiosk(), this.reset_delay * 1000);\n\n    public readonly setOptions = (o) => this._state.setOptions(o);\n\n    public async toggleZones(enabled: boolean) {\n        const options = await this.options.pipe(take(1)).toPromise();\n        const disable = !enabled\n            ? unique([...(options.disable || []), 'zones', 'devices'])\n            : options.disable.filter((_) => _ !== 'zones' && _ !== 'devices') ||\n              [];\n        this.setOptions({ disable });\n    }\n\n    public get can_search() {\n        return !!this._settings.get('app.explore.search_enabled');\n    }\n\n    constructor(\n        private _state: ExploreStateService,\n        private _s: ExploreSpacesService,\n        private _desks: ExploreDesksService,\n        private _zones: ExploreZonesService,\n        private _settings: SettingsService,\n        private _org: OrganisationService,\n        private _spaces: SpacesService,\n        private _dialog: MatDialog,\n        private _route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._spaces.initialised.pipe(first((_) => _)).toPromise();\n        this.reset_delay =\n            this._settings.get('app.inactivity_timeout_secs') || 180;\n        this.resetKiosk();\n        VirtualKeyboardComponent.enabled =\n            localStorage.getItem('OSK.enabled') === 'true';\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe(async (params) => {\n                if (params.has('level')) {\n                    this._state.setLevel(params.get('level'));\n                }\n                this._state.setFeatures('_located', []);\n                if (params.has('space')) {\n                    const space = this._spaces.find(params.get('space'));\n                    if (!space) return;\n                    this.locateSpace(space);\n                } else if (params.has('user')) {\n                    let user = this._settings.value('last_search');\n                    if (!user || params.get('user') !== user.email) {\n                        user = null;\n                        user = await showStaff(params.get('user')).toPromise();\n                    }\n                    if (!user)\n                        return notifyError(\n                            `Unable to user details for ${params.get('user')}`\n                        );\n                    this.locateUser(\n                        user instanceof Array ? user[0] : user\n                    ).catch((_) => {\n                        notifyError(`Unable to locate ${params.get('user')}`);\n                        this._router.navigate([], {\n                            relativeTo: this._route,\n                            queryParams: {},\n                        });\n                    });\n                } else {\n                    this.timeout('update_location', () => {\n                        this._state.setFeatures('_located', []);\n                    });\n                }\n            })\n        );\n    }\n\n    private locateSpace(space: Space) {\n        this._state.setLevel(this._org.levelWithID(space.zones)?.id);\n        const feature: any = {\n            location: space.map_id,\n            content: MapPinComponent,\n            data: {\n                message: `${space.display_name || space.name} is here`,\n            },\n        };\n        this.timeout('update_location', () =>\n            this._state.setFeatures('_located', [feature])\n        );\n    }\n\n    private async locateUser(user: User) {\n        let locate_details: any = this._org.organisation.bindings\n            .location_services;\n        if (!locate_details) return;\n        if (typeof locate_details === 'string') {\n            locate_details = {\n                system_id: locate_details,\n                module: 'LocationServices',\n            };\n        }\n        const mod = getModule(locate_details.system_id, locate_details.module);\n        const locations: MapLocation[] = (\n            await mod.execute('locate_user', [\n                user.email,\n                user.username || user.id,\n            ])\n        ).map((i) => new MapLocation(i));\n        locations.sort(\n            (a, b) =>\n                locate_details.priority.indexOf(a.type) -\n                locate_details.priority.indexOf(b.type)\n        );\n        if (!locations?.length) {\n            throw 'No locations for the given user';\n        }\n        this._state.setLevel(this._org.levelWithID([locations[0]?.level])?.id);\n        const pos = locations[0].position;\n        const { coordinates_from } = locations[0];\n        const feature: any = {\n            location:\n                locations[0].type === 'wireless'\n                    ? {\n                          x: coordinates_from?.includes('right')\n                              ? 1 - pos.x\n                              : pos.x,\n                          y: coordinates_from?.includes('bottom')\n                              ? 1 - pos.y\n                              : pos.y,\n                      }\n                    : pos,\n            content:\n                locations[0].type === 'wireless'\n                    ? MapRadiusComponent\n                    : MapPinComponent,\n            data: {\n                message: `${user.name} is here`,\n                radius: locations[0].variance,\n                last_seen: locations[0].last_seen,\n            },\n        };\n        this.timeout('update_location', () => {\n            this._state.setFeatures('_located', [feature]);\n        });\n    }\n\n    public resetKiosk() {\n        if ((document.activeElement as any)?.blur)\n            (document.activeElement as any)?.blur();\n        const level = localStorage.getItem('KIOSK.level');\n        this._state.setPositions(1, { x: 0.5, y: 0.5 });\n        if (level) this._state.setLevel(level);\n        this._dialog.closeAll();\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { UnauthorisedComponent } from '@placeos/components';\nimport { BootstrapComponent } from './bootstrap.component';\nimport { DeskBookingComponent } from './desk-booking.component';\nimport { ExploreComponent } from './explore.component';\n\nconst routes: Routes = [\n    {\n        path: 'unauthorised',\n        component: UnauthorisedComponent,\n    },\n    { path: 'bootstrap', component: BootstrapComponent },\n    { path: 'explore', component: ExploreComponent },\n    { path: 'desks', component: DeskBookingComponent },\n    { path: '**', redirectTo: 'bootstrap' },\n];\n\n@NgModule({\n    imports: [RouterModule.forRoot(routes, { useHash: true })],\n    exports: [RouterModule],\n})\nexport class AppRoutingModule {}\n","import { HashMap, predictableRandomInt } from '@placeos/common';\nimport { addMinutes, differenceInMinutes } from 'date-fns';\n\nexport const MOCK_MENU = [\n    {\n        id: 'item-1',\n        name: 'Coffee',\n        unit_price: 200,\n        category: 'Drinks',\n        tags: ['drink'],\n        options: [\n            { id: 'opt-1', name: 'Cappacino', group: 'type' },\n            { id: 'opt-2', name: 'Latte', group: 'type' },\n            { id: 'opt-3', name: '1 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-4', name: '2 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-5', name: '3 Sugar', group: 'sugars', unit_price: 20 },\n            { id: 'opt-6', name: '4 Sugar', group: 'sugars', unit_price: 20 },\n        ],\n    },\n    {\n        id: 'item-2',\n        name: 'Soda',\n        unit_price: 160,\n        category: 'Drinks',\n        tags: ['drink'],\n        options: [\n            { id: 'opt-1', name: 'Pepsi', group: 'type' },\n            { id: 'opt-2', name: 'Sunkist', group: 'type' },\n            { id: 'opt-3', name: 'Solo', group: 'type' },\n            { id: 'opt-4', name: 'Dr Pepper', group: 'type' },\n        ],\n    },\n    { id: 'item-3', name: 'Water', unit_price: 100, category: 'Drinks' },\n    {\n        id: 'item-4',\n        name: 'Muffin',\n        unit_price: 160,\n        category: 'Snacks',\n        options: [\n            { id: 'opt-1', name: 'Choc Chip', group: 'type' },\n            { id: 'opt-2', name: 'Banana', group: 'type' },\n            { id: 'opt-3', name: 'Blueberry', group: 'type' },\n        ],\n    },\n    {\n        id: 'item-5',\n        name: 'Cookies',\n        unit_price: 400,\n        category: 'Snacks',\n        options: [\n            { id: 'opt-1', name: 'Choc Chip', group: 'type' },\n            { id: 'opt-2', name: 'Macadamia', group: 'type' },\n            { id: 'opt-3', name: 'Dark Choc', group: 'type' },\n        ],\n    },\n    {\n        id: 'item-6',\n        name: 'Fish & Chips',\n        unit_price: 250,\n        category: 'Simple Meals',\n        options: [\n            {\n                id: 'opt-1',\n                name: 'Tomato Sauce',\n                group: 'sauce',\n                unit_price: 30,\n            },\n            { id: 'opt-2', name: 'BBQ Sauce', group: 'sauce', unit_price: 35 },\n            {\n                id: 'opt-3',\n                name: 'Tartare Sause',\n                group: 'sauce',\n                unit_price: 40,\n            },\n            {\n                id: 'opt-4',\n                name: 'Garlic Aoili Sauce',\n                group: 'sauce',\n                unit_price: 50,\n            },\n        ],\n    },\n    {\n        id: 'item-7',\n        name: 'Sandwich',\n        unit_price: 300,\n        category: 'Simple Meals',\n        options: [\n            { id: 'opt-1', name: 'Ham & Cheese', group: 'type' },\n            { id: 'opt-2', name: 'Chicken', group: 'type' },\n            { id: 'opt-3', name: 'Fairy Bread', group: 'type' },\n        ],\n    },\n];\n\nexport function generateCateringOrder(event: HashMap) {\n    const duration = differenceInMinutes(event.event_start, event.event_end);\n    const mx = predictableRandomInt(MOCK_MENU.length);\n    return {\n        id: `order-${predictableRandomInt(999_999)}`,\n        event_id: event.id,\n        invoice_number: `I${predictableRandomInt(999_999)}`,\n        charge_code: `C${predictableRandomInt(9_999)}`,\n        deliver_at: addMinutes(\n            event.event_start * 1000,\n            predictableRandomInt(Math.floor(duration / 5)) * 5\n        ),\n        items: new Array(3).fill(0).map((_, idx) => ({\n            ...MOCK_MENU[(mx * idx) % MOCK_MENU.length],\n            options: [],\n            quantity: predictableRandomInt(10, 1),\n        })),\n    };\n}\n","export const MOCK_ORGS = [\n    {\n        created_at: 1587057070,\n        updated_at: 1587692680,\n        name: 'PlaceOS',\n        description: '',\n        tags: 'org',\n        count: 0,\n        capacity: 0,\n        parent_id: '',\n        triggers: [],\n        id: 'zone-EmWFTjuYExK',\n    },\n];\n\nexport const MOCK_BUILDINGS = [\n    {\n        name: 'Sydney',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-01',\n        levels: ['lvl-10', 'lvl-11'],\n    },\n    {\n        name: 'Brisbane',\n        description: '',\n        tags: 'building',\n        count: 0,\n        capacity: 0,\n        parent_id: 'zone-EmWFTjuYExK',\n        triggers: [],\n        id: 'bld-02',\n        levels: ['lvl-2', 'lvl-3'],\n    },\n];\n\nconst mockLevel = (\n    id: string,\n    idx: number,\n    building: any,\n    num: number = 10\n): any => {\n    let map_id = id.substr(4);\n    map_id = `assets/maps/level_${num}.svg`;\n    return {\n        id: `${building.id}_${id}`,\n        name: `Level ${id.endsWith('00') ? 'G' : id.split('-')[1]}`,\n        parent_id: building.id,\n        description: '',\n        tags: 'level',\n        map_id,\n        code: 'level code 12',\n        type: 'staff floor',\n        count: 5,\n        capacity: 30,\n        location: 'optional lat,long',\n        display_name: '',\n    };\n};\n\nexport const MOCK_LEVELS = MOCK_BUILDINGS.map((bld) =>\n    bld.levels.map((level, idx) =>\n        mockLevel(level, idx, bld, +level.split('-')[1])\n    )\n).reduce((p, c) => p.concat(c), []);\n","import { predictableRandomInt } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_MENU } from './catering.data';\nimport { MOCK_ORGS, MOCK_LEVELS, MOCK_BUILDINGS } from './zone.data';\n\nconst MOCK_METADATA = {\n    current: {\n        contacts: {\n            name: 'contacts',\n            description: '',\n            details: [\n                {\n                    id: 'user-1',\n                    name: 'Jonathan McFarlane (PlaceOS)',\n                    email: 'jon@place.tech',\n                    first_name: 'Jonathan',\n                    last_name: 'McFarlane',\n                },\n                {\n                    id: 'user-1',\n                    name: 'Alex Sorafumo (PlaceOS)',\n                    email: 'alex@place.tech',\n                    first_name: 'Alex',\n                    last_name: 'Sorafumo',\n                },\n            ],\n        },\n    },\n};\n\nexport const ZONE_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/engine/v2/zones',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.tags === 'org') {\n                return MOCK_ORGS;\n            } else if (request.query_params.tags === 'building') {\n                return MOCK_BUILDINGS;\n            } else if (request.query_params.tags === 'level') {\n                return MOCK_LEVELS;\n            }\n            throw { status: 404, message: 'Zones not found' };\n        },\n    });\n\n    function padString(str: string | number, length: number = 5) {\n        str = `${str}`;\n        while (str.length < length) str = `0${str}`;\n        return str;\n    }\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.name === 'bindings') {\n                return {\n                    bindings: {\n                        details: {\n                            area_management: 'space-0',\n                            location_services: 'space-0',\n                        },\n                    },\n                };\n            }\n            if (request.query_params.name === 'catering') {\n                return {\n                    catering: {\n                        details: MOCK_MENU,\n                    },\n                };\n            }\n            if (request.query_params.name === 'desks') {\n                const parts = request.route_params.id.split('-');\n                const id = parts[parts.length - 1];\n                return generateMockDeskMetadata(id);\n            }\n            if (\n                MOCK_METADATA[request.route_params.id] &&\n                MOCK_METADATA[request.route_params.id][\n                    request.query_params.name\n                ]\n            ) {\n                return MOCK_METADATA[request.route_params.id];\n            } else if (\n                MOCK_METADATA[request.route_params.id] &&\n                !request.query_params.name\n            ) {\n                return MOCK_METADATA[request.route_params.id] || {};\n            }\n            return {};\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id',\n        metadata: {},\n        method: 'PATCH',\n        callback: (request) => {\n            if (!MOCK_METADATA[request.route_params.id])\n                MOCK_METADATA[request.route_params.id] = {};\n            MOCK_METADATA[request.route_params.id][request.body.name] =\n                request.body;\n        },\n    });\n\n    const DESK_FEATURES = ['sit_to_stand', 'single_monitor', 'dual_monitor'];\n\n    function generateMockDeskMetadata(id: string) {\n        return {\n            desks: {\n                details: new Array(30).fill(0).map((_, idx) => ({\n                    id: `table-${padString(id, 2)}.${padString(idx + 1, 3)}`,\n                    name: `Desk ${id}.${padString(idx + 1, 3)}`,\n                    bookable: predictableRandomInt(9999) % 4 !== 0,\n                    group: '',\n                    features: DESK_FEATURES.filter(\n                        (_) => predictableRandomInt(99999) % 3 === 0\n                    ),\n                })),\n            },\n        };\n    }\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/metadata/:id/children',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const zone = MOCK_BUILDINGS.find(\n                (_) => _.id === request.route_params.id\n            );\n            if (!zone)\n                throw {\n                    status: 404,\n                    message: `Unable to find zone with id \"${request.route_params.id}\"`,\n                };\n            return MOCK_LEVELS.filter((_) => _.parent_id === zone.id).map(\n                (lvl) => {\n                    const parts = lvl.id.split('-');\n                    const id = parts[parts.length - 1];\n                    return {\n                        zone: lvl,\n                        metadata: generateMockDeskMetadata(id),\n                    };\n                }\n            );\n        },\n    });\n}\n","/** Domain of the organisation */\nexport const DOMAIN = 'place.tech';\n/** Endpoint where the staff API is located */\nexport const API = '/api/staff/v1';\n","import { predictableRandomInt } from '@placeos/common';\nimport { DOMAIN } from './common.mock';\n\nconst PREDEF_USERS = [\n    'Jonathan McFarlane',\n    'Alex Sorafumo',\n    'Jim Doe',\n    'Cristina Boston',\n    'Jeremy West',\n    'Viv Briffa',\n    'Candy Russo',\n    'Jeff Wiz',\n    'Sravani Kotha',\n    'Kim Burgess',\n    'Caspian Baska',\n    'Stephen Von Takach',\n    'Cameron Reeves',\n    'Shane Boseley',\n];\n\nexport const ACTIVE_USER = {\n    id: 'current',\n    name: 'PlaceOS - Mock User',\n    email: 'dev@place.tech',\n    groups: ['deals', ''],\n};\n\nexport const MOCK_STAFF = PREDEF_USERS.map((name, i) => ({\n    id: `user-${i + 1}`,\n    name: `${name} (PlaceOS)`,\n    email: `${name.split(' ').join('.').toLowerCase()}@${DOMAIN}`,\n})).concat([ACTIVE_USER]);\n\nexport const MOCK_GUESTS = PREDEF_USERS.map((name, i) => ({\n    id: `guest-${i + 1}`,\n    name: `${name} (External)`,\n    email: `${name.split(' ').join('.').toLowerCase()}@not-${DOMAIN}`,\n    visit_expected: predictableRandomInt(99999) % 2 === 0,\n}));\n","import { predictableRandomInt } from '@placeos/common';\nimport { generateMockSpace } from '@placeos/spaces';\n\nconst randomSpaceFeatures = () => {\n    const f = ['Whiteboard', 'VidConf', 'Projector', 'Views'];\n    const numFeatures = predictableRandomInt(f.length + 1);\n    const res = [];\n    for (let i = 0; i < numFeatures; i++) {\n        res.push(f[predictableRandomInt(f.length)]);\n    }\n    return res.filter((el, i, r) => r.indexOf(el) === i);\n};\n\nexport const MOCK_SPACES = [\n    {\n        name: 'Conference Room 10.01',\n        map_id: 'area-10.01-status',\n        zones: ['bld-01', 'bld-01_lvl-10'],\n    },\n    {\n        name: 'Conference Room 10.02',\n        map_id: 'area-10.02-status',\n        zones: ['bld-01', 'bld-01_lvl-10'],\n    },\n    {\n        name: 'Conference Room 10.03',\n        map_id: 'area-10.03-status',\n        zones: ['bld-01', 'bld-01_lvl-10'],\n    },\n    {\n        name: 'Conference Room 11.01',\n        map_id: 'area-11.01-status',\n        zones: ['bld-01', 'bld-01_lvl-11'],\n    },\n    {\n        name: 'Conference Room 11.02',\n        map_id: 'area-11.02-status',\n        zones: ['bld-01', 'bld-01_lvl-11'],\n    },\n    {\n        name: 'Conference Room 11.03',\n        map_id: 'area-11.03-status',\n        zones: ['bld-01', 'bld-01_lvl-11'],\n    },\n    {\n        name: 'Conference Room 2.01',\n        map_id: 'area-2.01-status',\n        zones: ['bld-02', 'bld-02_lvl-2'],\n    },\n    {\n        name: 'Conference Room 2.02',\n        map_id: 'area-2.02-status',\n        zones: ['bld-02', 'bld-02_lvl-2'],\n    },\n    {\n        name: 'Conference Room 3.01',\n        map_id: 'area-3.01-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n    {\n        name: 'Conference Room 3.02',\n        map_id: 'area-3.02-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n    {\n        name: 'Conference Room 3.03',\n        map_id: 'area-3.03-status',\n        zones: ['bld-02', 'bld-02_lvl-3'],\n    },\n].map((d) => generateMockSpace({ ...d, features: randomSpaceFeatures() }));\n","import { predictableRandomInt, unique } from '@placeos/common';\nimport * as dayjs from 'dayjs';\nimport { generateCateringOrder } from './catering.data';\nimport { MOCK_SPACES } from './spaces.data';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\n\nlet EVENT_TIME = dayjs().startOf('d').hour(7);\n\nconst nextEventTime = (save = false): number => {\n    const next = EVENT_TIME.add((predictableRandomInt(8) + 1) * 15, 'm');\n    if (save) {\n        EVENT_TIME = next;\n    }\n    return next.unix();\n};\n\nconst event_status = ['tentative', 'confirmed', 'cancelled'];\nconst randomStatus = (): string => {\n    const rnd = predictableRandomInt(10);\n    return rnd < 2\n        ? event_status[2]\n        : rnd < 5\n        ? event_status[0]\n        : event_status[1];\n};\n\nexport const MOCK_EVENTS = new Array(200).fill(0).map((_, index) => {\n    const PEOPLE = MOCK_STAFF.concat(MOCK_GUESTS);\n    let attendees: any[] = new Array(predictableRandomInt(8, 1))\n        .fill(0)\n        .map(() => PEOPLE[predictableRandomInt(PEOPLE.length)]);\n    attendees.sort(\n        (a, b) => (a.visit_expected ? 0 : -1) - (b.visit_expected ? 0 : -1)\n    );\n    const space = MOCK_SPACES[predictableRandomInt(MOCK_SPACES.length)];\n    attendees = attendees.concat({ ...space, resource: true });\n    if (predictableRandomInt(9999) % 2 === 0) attendees.unshift(ACTIVE_USER);\n    else attendees.unshift(MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)]);\n    attendees = unique(attendees, 'email');\n    const event_start = nextEventTime(true);\n    const event_end = nextEventTime();\n    return {\n        id: `cal-event-${index}`,\n        status: randomStatus(),\n        host: attendees[0].email,\n        calendar: 'calendar_id',\n        creator: 'optional@fake.com',\n        attendees: unique(attendees, 'email').map((_) => ({\n            ..._,\n            response_status:\n                predictableRandomInt(99999) % 2 === 0\n                    ? 'accepted'\n                    : predictableRandomInt(99999) % 6 === 0\n                    ? 'declined'\n                    : 'tentative',\n        })),\n        title: `Some Meeting ${index}`,\n        body: `A Description`,\n        private: false,\n        event_start,\n        event_end,\n        timezone: 'Australia/Sydney',\n        all_day: false,\n        location: `${space.name}`,\n        recurring: false,\n        recurrence: {},\n        attachments: {},\n        system: space,\n        extension_data: {\n            catering:\n                predictableRandomInt(99999) % 4 === 0\n                    ? [\n                          generateCateringOrder({\n                              id: `cal-event-${index}`,\n                              event_start,\n                              event_end,\n                          }),\n                      ]\n                    : [],\n            setup: predictableRandomInt(4) * 5,\n            breakdown: predictableRandomInt(4) * 5,\n        },\n    };\n});\n\nconst event_spaces = {};\nMOCK_EVENTS.forEach((event) => {\n    if (!event_spaces[event.system.id]) {\n        event_spaces[event.system.id] = [];\n    }\n    event_spaces[event.system.id].push(event);\n});\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { ACTIVE_USER, MOCK_GUESTS, MOCK_STAFF } from './users.data';\nimport { MOCK_LEVELS } from './zone.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport * as dayjs from 'dayjs';\nimport { MOCK_EVENTS } from './events.data';\n\nexport const USER_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/engine/v2/users/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.route_params.id === 'current') {\n                return ACTIVE_USER;\n            }\n            const person = MOCK_STAFF.find(\n                (user) => user.email === request.route_params.id\n            );\n            if (person) {\n                return person;\n            }\n            throw { status: 404, message: 'User not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/people',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.q) {\n                const search = request.query_params.q.toLowerCase();\n                return MOCK_STAFF.filter(\n                    (user) =>\n                        user.name.toLowerCase().includes(search) ||\n                        user.email.toLowerCase().includes(search)\n                );\n            }\n            return MOCK_STAFF;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/people/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const id = decodeURIComponent(request.route_params.id);\n            const person = MOCK_STAFF.find((user) => user.email === id);\n            if (person) {\n                return {\n                    ...person,\n                    location: generateLocation(),\n                };\n            }\n            throw { status: 404, message: 'User not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.query_params.q) {\n                const search = request.query_params.q.toLowerCase();\n                return MOCK_GUESTS.filter(\n                    (user) =>\n                        user.name.toLowerCase().includes(search) ||\n                        user.email.toLowerCase().includes(search)\n                );\n            }\n            return MOCK_STAFF;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests/:email',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const email = decodeURIComponent(request.route_params.email);\n            const person = MOCK_GUESTS.find((user) => user.email === email);\n            if (person) {\n                return person;\n            }\n            throw { status: 404, message: 'Guest not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/guests/:email/meetings',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            if (request.route_params.email) {\n                const email = request.route_params.email.toLowerCase();\n                const events = MOCK_EVENTS.filter((event) =>\n                    event.attendees.find(\n                        (user) => user.email.toLowerCase() === email\n                    )\n                );\n                return events;\n            }\n            throw {\n                status: 404,\n                message: `Unable to find meetings with guest with email ${request.route_params.email}`,\n            };\n        },\n    });\n\n    const LOCATION_TYPES = [\n        'meeting',\n        'desk_id',\n        'laptop',\n        'mobile',\n        'geo',\n        'none',\n    ];\n\n    function generateLocation() {\n        const type =\n            LOCATION_TYPES[predictableRandomInt(LOCATION_TYPES.length)];\n        const level = MOCK_LEVELS[predictableRandomInt(MOCK_LEVELS.length)];\n        const level_spaces = MOCK_SPACES.filter((s) =>\n            s.zones.includes(level.id)\n        );\n        const space =\n            level_spaces[predictableRandomInt(level_spaces.length)] || {};\n        const location: HashMap = {};\n        switch (type) {\n            case 'meeting':\n                location.meeting = {\n                    building: level.parent_id,\n                    level: level.id,\n                    system: space.id,\n                    map_id: space.map_id,\n                    event_id: '',\n                };\n                break;\n            case 'desk_id':\n                location.meeting = {\n                    building: level.parent_id,\n                    level: level.id,\n                    map_id: space.map_id,\n                    checked_in: dayjs().unix(),\n                };\n                break;\n            case 'laptop':\n            case 'mobile':\n                location[type] = {\n                    building: level.parent_id,\n                    level: level.id,\n                    x: +predictableRandomInt(10000),\n                    y: +predictableRandomInt(5000),\n                    last_seen: dayjs()\n                        .subtract(predictableRandomInt(60), 'm')\n                        .unix(),\n                };\n                break;\n            case 'geo':\n                location.geo = {\n                    lat: predictableRandomInt(180) - 90,\n                    lon: predictableRandomInt(360) - 180,\n                    last_seen: dayjs()\n                        .subtract(predictableRandomInt(60), 'm')\n                        .unix(),\n                };\n                break;\n        }\n        return location;\n    }\n}\n","import { HashMap, unique } from '@placeos/common';\n\nexport interface EnvironmentSource {\n    id?: string;\n    name: string;\n    type?: 'lights' | 'blinds' | 'screen';\n    state: string | number;\n    states: string[];\n}\n\nexport interface RoomInput {\n    id?: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    locked: boolean;\n    routes: string[];\n    outputs: string[];\n}\n\nexport interface RoomOutput {\n    id?: string;\n    name: string;\n    type: string;\n    mod: string;\n    mute: boolean;\n    locked: boolean;\n    source: string;\n    inputs: string[];\n    following: string;\n}\n\nclass RoomModule {\n    public readonly name: string;\n    public readonly connected: boolean;\n    public active: boolean;\n\n    public readonly input_list: HashMap<RoomInput>;\n    public readonly output_list: HashMap<RoomOutput>;\n    public readonly env_sources: EnvironmentSource[];\n\n    public readonly inputs;\n    public readonly outputs;\n    public readonly environment;\n\n    public volume = 0;\n\n    constructor(_data: Partial<RoomModule>) {\n        this.name = _data.name || 'Test Module';\n        this.connected = _data.connected ?? true;\n        this.active = _data.active || false;\n        this.input_list = _data.input_list;\n        this.output_list = _data.output_list;\n        this.env_sources = _data.env_sources || [];\n        this.inputs = Object.keys(this.input_list || {}) || [];\n        this.outputs = Object.keys(this.output_list || {}) || [];\n        const types = unique(this.env_sources.map((_) => _.type));\n        types.forEach(\n            (t) =>\n                (this[`${t}`] = this.env_sources\n                    .filter((_) => _.type === t)\n                    .map((_) => _.id))\n        );\n        this.env_sources.forEach(\n            (source) => (this[`${source.type}/${source.id}`] = source)\n        );\n        this.inputs.forEach(\n            (key) => (this[`input/${key}`] = this.input_list[key])\n        );\n        this.outputs.forEach(\n            (key) => (this[`output/${key}`] = this.output_list[key])\n        );\n    }\n\n    $powerup() {\n        console.log('Power On');\n        this.active = true;\n    }\n    /**\n     * Power off the space. End any active calls, disconnect signal routes, place\n     * powerable devices into standby and return environmental configuration to\n     * sensible defaults.\n     **/\n    $shutdown() {\n        this.active = false;\n    }\n    /** Shares a signal source with the room and any connected remote participants. */\n    $share() {}\n    /**\n     * Connect a signal source to a signal output, or set of outputs. Any intermediate\n     * device interactions are handled internally. For example, on a system using a small\n     * presentation switcher and a display, routing a laptop input will select the\n     * appropriate input on the switcher, and select the appropriate input on the display.\n     *\n     * This includes all routable signal types - in addition to the above example, this may\n     * be interacting with an audio DSP to add a microphone feed to an output zone, or\n     * connecting a USB HID input device with a specific output.\n     **/\n    $route(input: string, output: string) {\n        if (this.inputs.includes(input) && this.outputs.includes(output)) {\n            this.$updateState(input, {\n                routes: unique([\n                    ...(this.input_list[input].routes || []),\n                    output,\n                ]),\n            });\n            this.$updateState(output, {\n                source: input,\n                following: input,\n            });\n        }\n    }\n    /**\n     * Remove a signal source from a signal output.\n     * Predominantly intended for outputs that support more than one simultaneous input source\n     * (mixed audio zone, or display capable of compositing multiple video sources).\n     **/\n    $unroute() {}\n    /**\n     * Establish a call (either phone or video) with a remote participant.\n     * This may be a peer-to-peer connection or a wider group via an external bridging service.\n     **/\n    $connect() {}\n    /** End a call with a remote participant. */\n    $disconnect() {}\n    /**\n     * Bind the current system to another PlaceOS controlled space, relinquishing local control.\n     * This may be used for an education pod that pairs with a wider classroom or a room being\n     * used as an overflow from a primary event space.\n     **/\n    $link() {}\n    /**\n     * Join the current system with another PlaceOS controlled space, sharing control and signal IO.\n     * Examples of usage would be a set of rooms with moveable walls. N-way merges supported.\n     **/\n    $merge() {}\n    /** Separate from a linked or merged system. */\n    $split() {}\n    /**\n     * Display an alert visible to participants in the space. This may occur as a screen overlay,\n     * on a control interface, a bot post in a chat space associated with the current meeting or\n     * other modalities depending on hardware capability.\n     **/\n    $notify() {}\n    /**\n     * Place the room into a predefined operation mode. This may include executing an arbitrary\n     * set of device interactions, changing metadata associated with the system itself (changing\n     * available input or output nodes), or other configurable actions designed to transition\n     * the space to a specific state.\n     **/\n    $preset() {}\n    /**\n     * Set the volume for a signal node in the space. This can include outputs as well as inputs\n     * where supported (e.g. microphone). If unspecified, default is to interact with a primary\n     * output node.\n     **/\n    $volume(value: number, source: string = 'all') {\n        if (source === 'all') {\n            this.volume = value;\n        }\n    }\n    /** Interact with audio muting on supporting signal nodes within the space. */\n    $mute(state: boolean = true, source: string = 'all') {\n        this.$updateState(source, { mute: state });\n    }\n    /**\n     * Activates or deactivates a signal mute for the associated IO. If this is not possible,\n     * (e.g. unsupported by the device) an error is returned.\n     **/\n    $unmute(source: string = 'all') {\n        this.$mute(false, source);\n    }\n    /**\n     * Wrapper for an arbitrary set of control points defined in system configuration.\n     * Each of these may map to control options available on a sibling module and take one of two forms:\n     *  - Continuous value within a range (temperature set point 16.0...28.0 degrees, lighting level 0...100)\n     *  - Set of possible states (lighting high/med/low, blind up/down, electrochromic glass clear/opaque)\n     *\n     * System state provides the ability to introspect configured points for both control limits and current value.\n     **/\n    $environment(id: string, state: string | number) {\n        const source = this.env_sources.find((_) => _.id === id);\n        if (source) {\n            this[`${source.type}/${source.id}`] = { ...source, state };\n        }\n    }\n    /** Locks an IO node. Prevents any route changes that include this until unlocked. */\n    $lock(source: string) {\n        this.$updateState(source, { locked: true });\n    }\n    /** Unlocks an IO node. */\n    $unlock(source: string) {\n        this.$updateState(source, { locked: false });\n    }\n\n    $updateState(source: string, data: HashMap) {\n        if (this[`input/${source}`]) {\n            this[`input/${source}`] = { ...this[`input/${source}`], ...data };\n            this.input_list[source] = { ...this[`input/${source}`], ...data };\n        } else if (this[`output/${source}`]) {\n            this[`output/${source}`] = { ...this[`output/${source}`], ...data };\n            this.output_list[source] = { ...this[`output/${source}`], ...data };\n        }\n    }\n}\n\nconst input_list: HashMap = {\n    Mic1: {\n        name: 'Lectern Mic',\n        type: 'Microphone',\n        mod: 'Microphone_1',\n    },\n    Mic2: {\n        name: 'Lapel Mic',\n        type: 'Microphone',\n        mod: 'Microphone_2',\n    },\n    Mic3: {\n        name: 'Handheld Mic',\n        type: 'Microphone',\n        mod: 'Microphone_3',\n    },\n    PC1: {\n        name: 'PC-1',\n        type: 'PC',\n    },\n    PC2: {\n        name: 'PC-2',\n        type: 'PC',\n    },\n    PC3: {\n        name: 'PC-3',\n        type: 'PC',\n    },\n    PC4: {\n        name: 'PC-4',\n        type: 'PC',\n    },\n    HDMI: {\n        name: 'Laptop HDMI',\n        type: 'Laptop',\n    },\n    VGA: {\n        name: 'Laptop VGA',\n        type: 'Laptop',\n    },\n    Camera1: {\n        name: 'Camera Rear',\n        type: 'Camera',\n        mod: 'Camera_1',\n    },\n    Camera2: {\n        name: 'Camera Front',\n        type: 'Camera',\n        mod: 'Camera_2',\n    },\n    Camera3: {\n        name: 'Camera Rear 2',\n        type: 'Camera',\n        mod: 'Camera_3',\n    },\n    Camera4: {\n        name: 'Camera Front 2',\n        type: 'Camera',\n        mod: 'Camera_4',\n    },\n    TV1: {\n        name: 'IPTV 1',\n        type: 'TV',\n        mod: 'IPTV_1',\n    },\n};\n\nconst output_list: HashMap = {\n    Display1: {\n        name: 'Display 1',\n        type: 'Display',\n        source: 'PC1',\n        mod: 'Display_1',\n    },\n    Display2: {\n        name: 'Display 2',\n        type: 'Display',\n        mod: 'Display_2',\n    },\n    Display3: {\n        name: 'Display 3',\n        type: 'Display',\n        source: 'PC2',\n        mod: 'Display_3',\n    },\n    Display4: {\n        name: 'Display 4',\n        type: 'Display',\n        mod: 'Display_4',\n    },\n    Display5: {\n        name: 'Display 5',\n        type: 'Display',\n        mod: 'Display_5',\n        source: 'TV1',\n    },\n};\n\nconst env_sources: any[] = [\n    {\n        id: 'light1',\n        name: 'Lighting',\n        type: 'lights',\n        states: ['Off', 'Presentation', 'Meeting', 'Full'],\n        state: 'Off',\n    },\n    {\n        id: 'blind1',\n        name: 'Blinds',\n        type: 'blinds',\n        states: ['Off', 'Presentation', 'Meeting'],\n        state: 'Off',\n    },\n    {\n        id: 'screen1',\n        name: 'Screen',\n        type: 'screen',\n        states: ['Up', 'Down'],\n        state: 'Down',\n    },\n];\n\nexport const createSystemModule = (space: HashMap, overrides: HashMap = {}) =>\n    new RoomModule({\n        ...space,\n        input_list,\n        output_list,\n        env_sources,\n        ...overrides,\n    });\n","import { addSeconds, isBefore, subSeconds } from 'date-fns';\n\nimport { HashMap, timePeriodsIntersect } from '@placeos/common';\nimport { MOCK_EVENTS } from '../api/events.data';\n\nexport class MockBookingModule {\n    /** Timezone the associated space resided */\n    time_zone = 'Australia/Sydney';\n    /** Whether booking is disabled */\n    disable_book_now = false;\n    /** Whether ending current meeting is disabled */\n    disable_end_meeting = false;\n    /** List of current and upcoming bookings for space */\n    bookings: HashMap[] = [];\n    pending_period = 0;\n    pending_before = 0;\n    /** Control UI associated with the space */\n    control_ui = '';\n    /** Catering UI associated with the space */\n    catering_ui = '';\n    /** Time of the last booking started by a user */\n    last_booking_started = 0;\n    /** Current status of the space */\n    status: 'pending' | 'busy' | 'free' | 'not-bookable' = 'free';\n}\n\nexport function createBookingsModule(\n    space: HashMap,\n    overrides: Partial<MockBookingModule> = {}\n) {\n    const mod = {\n        ...new MockBookingModule(),\n        ...overrides,\n        /** Start the meeting at the given time */\n        $start_meeting: function (t: number) {\n            this.last_booking_started = t;\n        },\n        /** End the meeting at the given time */\n        $end_meeting: function (t: number) {},\n        /** Book meeting for the current time */\n        $book_now: function (len: number, t?: string, o?: string) {},\n    };\n    updateBookings(space, mod);\n    setInterval(() => updateBookings(space, mod), 1000);\n    return mod;\n}\n\nfunction updateBookings(space: HashMap, mod: HashMap) {\n    const bookings =\n        MOCK_EVENTS.filter((event) =>\n            event.attendees?.find((u) => u.email === space.email)\n        ) || [];\n    bookings.sort((a, b) => a.event_start - b.event_start);\n    mod.bookings = bookings;\n    if (!space.bookable) {\n        return (mod.status = 'not-bookable');\n    }\n    const date = new Date();\n    const current = bookings.find((bkn) =>\n        timePeriodsIntersect(\n            date.valueOf(),\n            date.valueOf(),\n            bkn.event_start,\n            bkn.event_end\n        )\n    );\n    const next = bookings.find((bkn) =>\n        isBefore(date.valueOf(), bkn.event_start)\n    );\n    const start = new Date((current || next)?.event_start);\n    const pending = timePeriodsIntersect(\n        date,\n        date,\n        subSeconds(start, mod.pending_before),\n        addSeconds(start, mod.pending_period)\n    );\n    mod.status = current\n        ? pending\n            ? 'pending'\n            : 'busy'\n        : next && pending\n        ? 'pending'\n        : 'free';\n}\n","import { Md5 } from 'ts-md5';\nimport { HashMap, predictableRandomInt } from '@placeos/common';\nimport { MOCK_LEVELS } from '../api/zone.data';\nimport { MOCK_STAFF } from '../api/users.data';\n\nexport interface ZoneOverview {\n    /** Desk count based on `desks` metadata in the zone\n     falls back to the zone.count field otherwise */\n    desk_count: number;\n\n    desk_usage: number;\n    /** Capacity of the space, set in zone.capacity field */\n    device_capacity: number;\n    /** Raw device count */\n    device_count: number;\n    /** This is the adjusted count based on the duplication factor */\n    estimated_people: number;\n\n    percentage_use: number;\n    /** The higher the recommendation number the better for recommending */\n    recommendation: number;\n}\n\nexport class MockLocationServicesModule implements HashMap {\n    /** Overview of the zones */\n    overview: HashMap<ZoneOverview> = {};\n\n    $locate_user(email: string, username: string) {}\n}\n\nfunction padZero(no: number, len: number = 3) {\n    let str = `${no}`;\n    while (str.length < len) {\n        str = '0' + str;\n    }\n    return str;\n}\n\nexport function createLocationServicesModule(\n    space: HashMap,\n    overrides: HashMap = {}\n) {\n    const mod = new MockLocationServicesModule();\n    for (const lvl of MOCK_LEVELS) {\n        mod.overview[lvl.id] = {\n            desk_count: 100,\n            desk_usage: 0,\n            device_capacity: 100,\n            device_count: 0,\n            estimated_people: 0,\n            percentage_use: 0,\n            recommendation: 10000,\n        };\n        mod[`${lvl.id}:desk_ids`] = new Array(mod.overview[lvl.id].desk_count)\n            .fill(0)\n            .map((_, idx) => `table-${lvl.number}.${padZero(idx)}`);\n        mod[`${lvl.id}`] = { value: [] };\n    }\n    updateLocations(mod, MOCK_LEVELS);\n    setInterval(() => updateLocations(mod, MOCK_LEVELS), 60 * 1000);\n    return mod;\n}\n\nexport function updateLocations(\n    mod: MockLocationServicesModule,\n    levels: HashMap[]\n) {\n    for (const lvl of levels) {\n        mod[lvl.id] = {\n            value: new Array(predictableRandomInt(20))\n                .fill(0)\n                .map(() => generateLocation(lvl, mod[`${lvl.id}:desk_ids`])),\n        };\n    }\n}\n\nexport function generateLocation(\n    lvl: HashMap,\n    desks: string[],\n    users = MOCK_STAFF\n) {\n    const fixed = predictableRandomInt(9999) % 3 === 0;\n    return fixed\n        ? {\n              location: 'desk',\n              at_location: predictableRandomInt(9999) % 5 !== 0,\n              map_id: desks[predictableRandomInt(desks.length)],\n              mac: Md5.hashStr(\n                  users[predictableRandomInt(users.length)].email\n              ),\n              level: lvl.id,\n              building: lvl.parent_id,\n          }\n        : {\n              location: 'wireless',\n              coordinates_from: 'bottom-left',\n              x: predictableRandomInt(1000) / 10,\n              y: predictableRandomInt(1000) / 10,\n              lon: 55.27476066828535,\n              lat: 25.20106100633537,\n              s2_cell_id: '3e5f4281459c',\n              mac: Md5.hashStr(\n                  users[predictableRandomInt(users.length)].email\n              ),\n              variance: 9.62534032222287,\n              last_seen: Math.floor(new Date().valueOf() / 1000),\n              map_width: 100,\n              map_height: 100,\n          };\n}\n","import { HashMap } from '@placeos/common';\n\nexport enum CameraTilt {\n    Down,\n    Up,\n    Stop,\n}\n\nexport enum CameraPan {\n    Left,\n    Right,\n    Stop,\n}\n\nclass CameraModule {\n    pan: number;\n    tilt: number;\n    zoom: number;\n\n    pan_speed: number;\n    tilt_speed: number;\n    zoom_speed: number;\n\n    presets: string[];\n\n    constructor(_) {\n        this.presets = ['Preset One', 'Preset 2', 'Preset Three'];\n    }\n\n    $pan(dir: CameraPan) {}\n\n    $tilt(tilt: CameraTilt) {}\n\n    $recall(name: string) {}\n\n    $save_preset(name: string) {}\n}\n\nexport const createCameraModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CameraModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass DisplayModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createDisplayModule = (space: HashMap, overrides: HashMap = {}) =>\n    new DisplayModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from '@placeos/common';\n\nclass MicrophoneModule {\n    mute: boolean;\n    volume: number;\n\n    $mute(state: boolean = true) {\n        this.mute = state;\n    }\n\n    $volume(value: number) {\n        this.volume = value;\n    }\n\n    constructor(_) {\n        this.volume = randomInt(100);\n    }\n}\n\nexport const createMicrophoneModule = (\n    space: HashMap,\n    overrides: HashMap = {}\n) => new MicrophoneModule({ ...space, ...overrides });\n","import { HashMap, randomInt } from \"@placeos/common\";\n\nlet interval;\n\nexport class CaptureModule {\n\n    status: 'playing' | 'stopped' | 'paused' = 'stopped';\n    title: string;\n    live: boolean = false;\n    remaining: number;\n    current: number;\n    next: number;\n\n    constructor(_) {\n        this.remaining = randomInt(24 * 60 * 60);\n    }\n\n    $start() {\n        this.status = 'playing';\n        interval = setInterval(() => {\n            if (this.remaining < 1) clearInterval(interval);\n            this.remaining = this.remaining - 1;\n            this.current = this.current + 1;\n        }, 3000);\n    }\n\n    $pause() {\n        this.status = 'paused';\n        clearInterval(interval);\n    }\n\n    $resume() {\n        this.$start();\n    }\n\n    $stop() {\n        this.status = 'stopped';\n        this.current = 0;\n        clearInterval(interval);\n    }\n\n}\n\nexport const createCaptureModule = (space: HashMap, overrides: HashMap = {}) =>\n    new CaptureModule({ ...space, ...overrides });\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { createSystem } from '../systems-bindings.mock';\nimport { MOCK_SPACES } from './spaces.data';\n\nexport const SYSTEM_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    MOCK_SPACES.forEach((space: any, index) => createSystem(space));\n\n    registerMockEndpoint({\n        path: '/api/engine/v2/systems',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            return MOCK_SPACES;\n        },\n    });\n}\n","import { registerSystem } from '@placeos/ts-client';\nimport { HashMap } from '@placeos/common';\n\nimport { createSystemModule } from './realtime/control';\nimport { createBookingsModule } from './realtime/events';\nimport { createLocationServicesModule } from './realtime/desks';\nimport { createCameraModule } from './realtime/camera';\nimport { createDisplayModule } from './realtime/display';\nimport { createMicrophoneModule } from './realtime/microphone';\nimport { createCaptureModule } from './realtime/capture';\n\nexport function createSystem(space: HashMap) {\n    registerSystem(space.id, {\n        System: [createSystemModule(space)],\n        Bookings: [createBookingsModule(space)],\n        AreaManagement: [createLocationServicesModule(space)],\n        Camera: new Array(10).fill(0).map(_ => createCameraModule(space)),\n        Display: new Array(10).fill(0).map(_ => createDisplayModule(space)),\n        Microphone: new Array(10).fill(0).map(_ => createMicrophoneModule(space)),\n        Capture: [createCaptureModule(space)]\n    });\n}\n","import { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\nimport { MOCK_EVENTS } from './events.data';\nimport { ACTIVE_USER, MOCK_STAFF } from './users.data';\n\nexport const EVENT_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/events',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            let events = MOCK_EVENTS;\n            if (!_.query_params.zone_ids) {\n                events = events.filter(\n                    (event) =>\n                        !!event.attendees.find(\n                            (user) => user.email === ACTIVE_USER.email\n                        )\n                );\n            }\n            if (_.query_params.period_start) {\n                events = events.filter((e) =>\n                    timePeriodsIntersect(\n                        _.query_params.period_start,\n                        _.query_params.period_end,\n                        e.event_start,\n                        e.event_end\n                    )\n                );\n            }\n            return events;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const new_event = {\n                ...request.body,\n                id: `-cal-event-${predictableRandomInt(999)}`,\n            };\n            new_event.attendees = [\n                MOCK_STAFF.find((_) => _.email === new_event.host),\n                ...(new_event.attendees || []),\n            ];\n            new_event.attendees.forEach((user) => {\n                if (user.zones) user.resource = true;\n            });\n\n            if (new_event.system) {\n                new_event.attendees = [\n                    ...(new_event.attendees || []),\n                    { ...new_event.system, resource: true },\n                ];\n            }\n            MOCK_EVENTS.push(new_event);\n            return new_event;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => {\n            const item = MOCK_EVENTS.find(\n                (event) => event.id === request.route_params.id\n            );\n            if (item) {\n                return item;\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'DELETE',\n        callback: (request) => {\n            const index = MOCK_EVENTS.findIndex(\n                (event) => event.id === request.route_params.id\n            );\n            if (index > 0) {\n                if (MOCK_EVENTS[index].host === ACTIVE_USER.email) {\n                    MOCK_EVENTS.splice(index, 1);\n                } else {\n                    const user = MOCK_EVENTS[index].attendees.find(\n                        (_) => _.email === ACTIVE_USER.email\n                    );\n                    user.response_status = 'declined';\n                }\n                return;\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id',\n        metadata: {},\n        method: 'PATCH',\n        callback: (request) => {\n            const index = MOCK_EVENTS.findIndex(\n                (event) => event.id === request.route_params.id\n            );\n            if (index >= 0) {\n                return MOCK_EVENTS.splice(index, 1, request.body);\n            }\n            throw { status: 404, message: 'Event not found' };\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/events/:id/guests/:email/checkin',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const event = MOCK_EVENTS.find(\n                (event) => event.id === request.route_params.id\n            );\n            if (event) {\n                const checked_in =\n                    (event.extension_data as any).checked_in || [];\n                (event.extension_data as any).checked_in = checked_in.concat([\n                    request.route_params.email,\n                ]);\n                return event;\n            }\n            throw { status: 404, message: 'Guest not found' };\n        },\n    });\n}\n","import { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_EVENTS } from './events.data';\nimport { MOCK_SPACES } from './spaces.data';\n\nimport { timePeriodsIntersect } from '@placeos/common';\n\nexport const CALENDAR_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars',\n        metadata: {},\n        method: 'GET',\n        callback: (request) => [],\n    });\n\n    const handleSpaceAvailability = (request) => {\n        const start = +request.query_params.period_start;\n        const end = +request.query_params.period_end;\n        const zones = (request.query_params.zone_ids || '')\n            .split(',')\n            .filter((i) => !!i);\n        const systems = (request.query_params.system_ids || '')\n            .split(',')\n            .filter((i) => !!i);\n\n        const spaces = MOCK_SPACES.filter((space) =>\n            zones.length\n                ? zones.reduce(\n                      (has, zone) => has && space.zones.includes(zone),\n                      true\n                  )\n                : systems.length\n                ? systems.includes(space.id)\n                : true\n        ).filter((space) => {\n            const bookings = MOCK_EVENTS.filter((event) =>\n                event.attendees.find((user) => user.id === space.id)\n            );\n            for (const event of bookings) {\n                if (\n                    timePeriodsIntersect(\n                        start,\n                        end,\n                        event.event_start,\n                        event.event_end\n                    )\n                )\n                    return false;\n            }\n            return true;\n        });\n        return spaces;\n    };\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars/availability',\n        metadata: {},\n        method: 'GET',\n        callback: (request) =>\n            handleSpaceAvailability(request).map((_) => ({\n                resource: _,\n            })),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/calendars/free_busy',\n        metadata: {},\n        method: 'GET',\n        callback: (request) =>\n            handleSpaceAvailability(request).map((_) => ({\n                resource: _,\n            })),\n    });\n}\n","import { predictableRandomInt } from '@placeos/common';\nimport { addMinutes, getUnixTime, setHours, startOfDay } from 'date-fns';\n\nimport { MOCK_STAFF } from './users.data';\nimport { MOCK_BUILDINGS, MOCK_LEVELS } from './zone.data';\n\nlet EVENT_TIME = setHours(startOfDay(new Date()), 7);\n\nconst nextEventTime = (save = false): number => {\n    const next = addMinutes(EVENT_TIME, (predictableRandomInt(8) + 1) * 15);\n    if (save) EVENT_TIME = next;\n    return getUnixTime(next);\n};\n\nconst TYPES = ['desk', 'parking'];\n\nexport const MOCK_BOOKINGS = new Array(200).fill(0).map((_, index) => {\n    const user = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n    const type = TYPES[predictableRandomInt(TYPES.length)];\n    const bld = MOCK_BUILDINGS[predictableRandomInt(MOCK_BUILDINGS.length)];\n    const lvls = MOCK_LEVELS.filter((_) => _.parent_id === bld.id);\n    const lvl = lvls[predictableRandomInt(lvls.length)];\n    const approved = predictableRandomInt(999999) % 4;\n    const approver = MOCK_STAFF[predictableRandomInt(MOCK_STAFF.length)];\n    return {\n        id: `booking-${index}`,\n        booking_start: nextEventTime(true),\n        booking_end: nextEventTime(),\n        user_id: user.id,\n        user_name: user.name,\n        user_email: user.email,\n        asset_id: `desk-${lvl?.id}-${index}`,\n        description: `Desk ${index}`,\n        title: `${type} Booking ${index}`,\n        type,\n        checked_in: predictableRandomInt(999999) % 3 === 0,\n        access: predictableRandomInt(999999) % 3 === 0,\n        approved: approved === 0,\n        rejected: approved === 1,\n        approver_id: approved === 0 ? approver.id : '',\n        approver_name: approved === 0 ? approver.name : '',\n        approver_email: approved === 0 ? approver.email : '',\n        zones: [bld.id, lvl?.id],\n        extension_data: {},\n    };\n});\n","import { log } from '@placeos/common';\n\nimport { ZONE_MOCKS } from './lib/api/zones.mock';\nimport { USER_MOCKS } from './lib/api/users.mock';\nimport { SYSTEM_MOCKS } from './lib/api/systems.mock';\nimport { EVENT_MOCKS } from './lib/api/events.mock';\nimport { CALENDAR_MOCKS } from './lib/api/calendars.mock';\nimport { BOOKING_MOCKS } from './lib/api/bookings.mock';\n\nexport default {\n    ZONE_MOCKS,\n    USER_MOCKS,\n    SYSTEM_MOCKS,\n    EVENT_MOCKS,\n    CALENDAR_MOCKS,\n    BOOKING_MOCKS,\n};\n\nlog('MOCKS', 'Mocks included with application.');\n","import { predictableRandomInt, timePeriodsIntersect } from '@placeos/common';\nimport { registerMockEndpoint } from '@placeos/ts-client';\n\nimport { MOCK_BOOKINGS } from './bookings.data';\n\nexport const BOOKING_MOCKS = registerMocks();\n\nfunction registerMocks() {\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const events = MOCK_BOOKINGS.filter(\n                (event) =>\n                    timePeriodsIntersect(\n                        _.query_params.period_start,\n                        _.query_params.period_end,\n                        event.booking_start,\n                        event.booking_end\n                    ) && event.type === _.query_params.type\n            );\n            return events;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'GET',\n        callback: (_) => {\n            const event = MOCK_BOOKINGS.find((e) => e.id === _.route_params.id);\n            if (!event)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${_.route_params.id}`,\n                };\n            return event;\n        },\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings',\n        metadata: {},\n        method: 'POST',\n        callback: (request) => {\n            const new_event = {\n                ...request.body,\n                id: `-booking-${predictableRandomInt(999)}`,\n            };\n            MOCK_BOOKINGS.push(new_event);\n            return new_event;\n        },\n    });\n\n    const updateBooking = (id, data) => {\n        const index = MOCK_BOOKINGS.findIndex((e) => e.id === id);\n        if (index < 0)\n            throw {\n                status: 404,\n                message: `Unable to find booking with ID ${id}`,\n            };\n        const new_event = { ...data };\n        MOCK_BOOKINGS.splice(index, 1, new_event);\n        return new_event;\n    };\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'PUT',\n        callback: (req) => updateBooking(req.route_params.id, { ...req.body }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/approve',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                approved: true,\n                rejected: false,\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/reject',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                approved: false,\n                rejected: true,\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id/check_in',\n        metadata: {},\n        method: 'POST',\n        callback: (req) =>\n            updateBooking(req.route_params.id, {\n                ...req.body,\n                checked_in: req.query_params.state === 'true',\n            }),\n    });\n\n    registerMockEndpoint({\n        path: '/api/staff/v1/bookings/:id',\n        metadata: {},\n        method: 'DELETE',\n        callback: (req) => {\n            const index = MOCK_BOOKINGS.findIndex(\n                (e) => e.id === req.route_params.id\n            );\n            if (index < 0)\n                throw {\n                    status: 404,\n                    message: `Unable to find booking with ID ${req.route_params.id}`,\n                };\n            MOCK_BOOKINGS.splice(index, 1);\n            return;\n        },\n    });\n}\n","import { Component, OnInit } from '@angular/core';\nimport { SwUpdate } from '@angular/service-worker';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { Clipboard } from '@angular/cdk/clipboard';\nimport { Integrations } from '@sentry/tracing';\nimport { first } from 'rxjs/operators';\nimport {\n    clientId,\n    invalidateToken,\n    isMock,\n    refreshToken,\n    token,\n} from '@placeos/ts-client';\n\nimport {\n    BaseClass,\n    current_user,\n    currentUser,\n    HotkeysService,\n    notifySuccess,\n    setAppName,\n    setNotifyOutlet,\n    SettingsService,\n    setupCache,\n    setupPlace,\n    log,\n} from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { setInternalUserDomain } from 'libs/users/src/lib/user.utilities';\n\nimport { SpacesService } from 'libs/spaces/src/lib/spaces.service';\nimport { setDefaultCreator } from 'libs/events/src/lib/event.class';\nimport { addHours } from 'date-fns';\n\nimport * as Sentry from '@sentry/angular';\nimport * as MOCKS from '@placeos/mocks';\n\nexport function initSentry(dsn: string, sample_rate: number = 0.2) {\n    if (!dsn) return;\n    Sentry.init({\n        dsn,\n        integrations: [\n            new Integrations.BrowserTracing({\n                tracingOrigins: ['localhost', location.origin],\n                routingInstrumentation: Sentry.routingInstrumentation,\n            }),\n        ],\n        tracesSampleRate: sample_rate,\n    });\n}\n\n@Component({\n    selector: 'app-root',\n    template: `\n        <router-outlet></router-outlet>\n        <global-loading></global-loading>\n    `,\n    styles: [``],\n})\nexport class AppComponent extends BaseClass implements OnInit {\n    constructor(\n        private _tracing: Sentry.TraceService,\n        private _settings: SettingsService,\n        private _org: OrganisationService, // For init\n        private _spaces: SpacesService, // For init\n        private _cache: SwUpdate,\n        private _snackbar: MatSnackBar,\n        private _hotkey: HotkeysService,\n        private _clipboard: Clipboard\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        log('APP', 'MOCKS:', MOCKS);\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyM'], () => {\n            localStorage.setItem(\n                'mock',\n                `${localStorage.getItem('mock') !== 'true'}`\n            );\n            location.reload();\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyC'], () => {\n            this._clipboard.copy(`${token()}|${refreshToken()}`);\n            notifySuccess('Successfully copied token.');\n        });\n        this._hotkey.listen(['Control', 'Alt', 'Shift', 'KeyV'], () => {\n            navigator.clipboard?.readText().then((tkn) => {\n                const parts = tkn.split('|');\n                const id = clientId();\n                localStorage.setItem(`${id}_access_token`, `${parts[0]}`);\n                localStorage.setItem(`${id}_refresh_token`, `${parts[1]}`);\n                localStorage.setItem(\n                    `${id}_expires_at`,\n                    `${addHours(new Date(), 6).valueOf()}`\n                );\n                notifySuccess('Successfully pasted token.');\n                setTimeout(() => location.reload(), 2000);\n            });\n        });\n        setNotifyOutlet(this._snackbar);\n        /** Wait for settings to initialise */\n        await this._settings.initialised.pipe(first((_) => _)).toPromise();\n        setAppName(this._settings.get('app.short_name'));\n        const settings = this._settings.get('composer') || {};\n        settings.mock =\n            !!this._settings.get('mock') ||\n            location.origin.includes('demo.place.tech');\n        /** Wait for authentication details to load */\n        await setupPlace(settings).catch(() => this.onInitError());\n        setupCache(this._cache);\n        this.timeout('wait_for_user', () => this.onInitError(), 30 * 1000);\n        await current_user.pipe(first((_) => !!_)).toPromise();\n        this.clearTimeout('wait_for_user');\n        setDefaultCreator(currentUser());\n        setInternalUserDomain(\n            this._settings.get('app.general.internal_user_domain') ||\n                currentUser()?.email?.split('@')[1]\n        );\n        initSentry(this._settings.get('app.sentry_dsn'));\n    }\n\n    private onInitError() {\n        if (isMock() || currentUser()?.is_logged_in) return;\n        console.error('Error initialising user.');\n        invalidateToken();\n        location.reload();\n    }\n}\n","import { PlaceAuthOptions, setup } from '@placeos/ts-client';\nimport { notifyInfo } from './notifications';\n\nexport interface PlaceSettings {\n    /** Protocol used by the application server */\n    protocol: 'http:' | 'https:';\n    /** Domain that the API server lies  */\n    domain: string;\n    /** Port number of the API server */\n    port: number;\n    /** Route on domain application rests */\n    route: string;\n    /** Whether to use the settings domain for auth */\n    use_domain: boolean;\n    /** Whether login is handled locally by the application */\n    local_login: boolean;\n    /** Whether application should mock out API requests */\n    mock: boolean;\n}\n\n/**\n * Initialise the PlaceOS API library\n */\nexport async function setupPlace(settings: PlaceSettings): Promise<void> {\n    const protocol = settings.protocol || location.protocol;\n    const host = settings.domain || location.hostname;\n    const port = settings.port || location.port;\n    const url = settings.use_domain\n        ? `${protocol}//${host}:${port}`\n        : location.origin;\n    const route = (location.pathname + '/').replace('//', '/');\n    console.log(\n        'Mock:',\n        settings.mock,\n        location.href.includes('mock=true'),\n        localStorage.getItem('mock') === 'true'\n    );\n    const mock =\n        settings.mock ||\n        location.href.includes('mock=true') ||\n        localStorage.getItem('mock') === 'true';\n    // Generate configuration object\n    const config: PlaceAuthOptions = {\n        auth_type: 'auth_code',\n        scope: 'public',\n        host: `${host}${port ? ':' + port : ''}`,\n        auth_uri: `${url}/auth/oauth/authorize`,\n        token_uri: `${url}/auth/oauth/token`,\n        redirect_uri: `${location.origin}${route}oauth-resp.html`,\n        handle_login: !settings.local_login,\n        use_iframe: true,\n        mock,\n    };\n    if (localStorage) {\n        localStorage.setItem(\n            'mock',\n            `${!!mock && !location.href.includes('mock=false')}`\n        );\n    }\n    if (mock) {\n        notifyInfo('Application in mock mode.');\n    }\n    return setup(config);\n}\n","import { BrowserModule } from '@angular/platform-browser';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { ErrorHandler, NgModule } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { ServiceWorkerModule } from '@angular/service-worker';\n\nimport { MatSnackBarModule } from '@angular/material/snack-bar';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatProgressSpinnerModule } from '@angular/material/progress-spinner';\nimport { MatRippleModule } from '@angular/material/core';\nimport { MatButtonToggleModule } from '@angular/material/button-toggle';\n\nimport { ComponentsModule, UnauthorisedComponent } from '@placeos/components';\nimport { SharedExploreModule } from '@placeos/explore';\nimport { FormFieldsModule } from '@placeos/form-fields';\n\nimport { AppRoutingModule } from './app-routing.module';\nimport { AppComponent } from 'libs/components/src/lib/app.component';\nimport { environment } from '../environments/environment';\nimport { BootstrapComponent } from './bootstrap.component';\nimport { ExploreComponent } from './explore.component';\nimport { ExploreLevelSelectComponent } from './explore-level-select.component';\nimport { ExploreMapStackComponent } from './explore-map-stack.component';\nimport { FooterMenuComponent } from './footer-menu.component';\nimport { DeskBookingComponent } from './desk-booking.component';\n\nimport * as Sentry from '@sentry/angular';\nimport { MatSlideToggleModule } from '@angular/material/slide-toggle';\n\n@NgModule({\n    declarations: [\n        AppComponent,\n        UnauthorisedComponent,\n        BootstrapComponent,\n        ExploreComponent,\n        ExploreLevelSelectComponent,\n        ExploreMapStackComponent,\n        DeskBookingComponent,\n        FooterMenuComponent,\n    ],\n    imports: [\n        BrowserModule,\n        BrowserAnimationsModule,\n        FormsModule,\n        ReactiveFormsModule,\n        AppRoutingModule,\n        MatSnackBarModule,\n        MatDialogModule,\n        MatProgressSpinnerModule,\n        MatRippleModule,\n        MatButtonToggleModule,\n        MatSlideToggleModule,\n        ComponentsModule,\n        FormFieldsModule,\n        SharedExploreModule,\n        ServiceWorkerModule.register('ngsw-worker.js', {\n            enabled: environment.production,\n        }),\n    ],\n    providers: [\n        {\n            provide: ErrorHandler,\n            useValue: Sentry.createErrorHandler({\n                showDialog: false,\n            }),\n        },\n        {\n            provide: Sentry.TraceService,\n            deps: [Router],\n        },\n    ],\n    bootstrap: [AppComponent],\n})\nexport class AppModule {}\n","export const environment = {\n    production: true,\n};\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\nif (environment.production) {\n  enableProdMode();\n}\n\nplatformBrowserDynamic()\n  .bootstrapModule(AppModule)\n  .catch((err) => console.error(err));\n"],"sourceRoot":"webpack:///"}