"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[566],{5566:(z,S,o)=>{o.d(S,{TI:()=>J.T,QB:()=>q.Q,_I:()=>l._,sp:()=>c,bR:()=>w});var e=o(177),t=o(9417),O=o(850),N=o(2765),n=o(4006),b=o(9115),L=o(6850),k=o(5951),G=o(4823),K=o(3719),R=o(3046),j=o(3258),M=(o(807),o(8519),o(7053),o(3872),o(1623),o(2912),o(7707),o(6095),o(1732),o(2499),o(699),o(6386),o(1601),o(467)),B=o(2333),u=o(9493),l=o(2201),i=o(4438),p=o(9434),_=o(6600),d=o(9631),r=o(9183);function m(V,Z){if(1&V){const F=i.RV6();i.j41(0,"div",6)(1,"mat-form-field",7)(2,"input",8),i.mxI("ngModelChange",function(Y){const Q=i.eBV(F).index,tt=i.XpG(2);return i.DH7(tt.charge_codes[Q],Y)||(tt.charge_codes[Q]=Y),i.Njj(Y)}),i.k0s()(),i.j41(3,"button",9),i.bIt("click",function(){const Y=i.eBV(F).index,Q=i.XpG(2);return i.Njj(Q.removeCode(Y))}),i.j41(4,"app-icon"),i.EFF(5,"delete"),i.k0s()()()}if(2&V){const F=Z.index,X=i.XpG(2);i.R7$(2),i.R50("ngModel",X.charge_codes[F])}}function a(V,Z){if(1&V&&(i.j41(0,"main",4),i.DNE(1,m,6,1,"div",5),i.k0s()),2&V){const F=i.XpG();i.R7$(),i.Y8G("ngForOf",F.charge_codes)("ngForTrackBy",F.trackByFn)}}function s(V,Z){if(1&V){const F=i.RV6();i.j41(0,"footer",10)(1,"button",11),i.EFF(2," Import Codes "),i.j41(3,"input",12),i.bIt("change",function(Y){i.eBV(F);const Q=i.XpG();return i.Njj(Q.addCodesFromFile(Y))}),i.k0s()(),i.j41(4,"button",13),i.bIt("click",function(){i.eBV(F);const Y=i.XpG();return i.Njj(Y.newCode())}),i.EFF(5," Add Code "),i.k0s(),i.j41(6,"button",13),i.bIt("click",function(){i.eBV(F);const Y=i.XpG();return i.Njj(Y.saveChargeCodes())}),i.EFF(7," Save Changes "),i.k0s()()}}function h(V,Z){1&V&&(i.j41(0,"main",14),i.nrm(1,"mat-spinner",15),i.j41(2,"p"),i.EFF(3,"Saving changes to charge codes..."),i.k0s()())}let c=(()=>{class V{constructor(F,X){this._state=F,this._dialog_ref=X,this.charge_codes=[],this.loading=!1}ngOnInit(){var F=this;return(0,M.A)(function*(){F.charge_codes=(yield F._state.charge_codes.pipe((0,u.s)(1)).toPromise())||[]})()}newCode(){this.charge_codes.push("")}removeCode(F){this.charge_codes.splice(F,1)}addCodesFromFile(F){if(F.target){const X=F.target.files[0];if(X){const Y=new FileReader;Y.readAsText(X,"UTF-8"),Y.addEventListener("load",Q=>{const tt=(0,B.a6)(Q.srcElement.result)||[];for(const{code:nt}of tt)this.charge_codes.push(nt);this.charge_codes=(0,B.Am)(this.charge_codes),F.target.value=""}),Y.addEventListener("error",Q=>(0,B.UG)("Error reading file."))}}}saveChargeCodes(){var F=this;return(0,M.A)(function*(){F.loading=!0;const X=F.charge_codes.filter(Y=>Y&&Y.trim());yield F._state.saveSettings({charge_codes:X}),F._dialog_ref.close()})()}trackByFn(F,X){return F}static#t=this.\u0275fac=function(X){return new(X||V)(i.rXU(l._),i.rXU(n.CP))};static#e=this.\u0275cmp=i.VBU({type:V,selectors:[["charge-code-list-modal"]],decls:10,vars:3,consts:[["load_state",""],["icon","","mat-dialog-close",""],["class","overflow-auto max-h-[65vh] min-h-[20rem] flex flex-col",4,"ngIf","ngIfElse"],["class","flex items-center p-2 space-x-2 border-t border-base-200",4,"ngIf"],[1,"overflow-auto","max-h-[65vh]","min-h-[20rem]","flex","flex-col"],["class","flex items-center space-x-2 w-full hover:bg-neutral px-2",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-center","space-x-2","w-full","hover:bg-neutral","px-2"],["appearance","outline",1,"h-14","flex-1"],["matInput","","placeholder","Charge Code",3,"ngModelChange","ngModel"],["icon","",3,"click"],[1,"flex","items-center","p-2","space-x-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-48","inverse","relative"],["type","file",1,"opacity-0","absolute","inset-0",3,"change"],["btn","","matRipple","",1,"w-48",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-20","space-y-2"],["diameter","32"]],template:function(X,Y){if(1&X&&(i.j41(0,"header")(1,"h2"),i.EFF(2,"Edit Charge Codes"),i.k0s(),i.j41(3,"button",1)(4,"app-icon"),i.EFF(5,"close"),i.k0s()()(),i.DNE(6,a,2,2,"main",2)(7,s,8,0,"footer",3)(8,h,4,0,"ng-template",null,0,i.C5r)),2&X){const Q=i.sdS(9);i.R7$(6),i.Y8G("ngIf",!Y.loading)("ngIfElse",Q),i.R7$(),i.Y8G("ngIf",!Y.loading)}},dependencies:[e.Sq,e.bT,n.tx,t.me,t.BC,t.vS,p.R,K.rl,_.r6,d.fg,r.LG]})}return V})();o(9505);let w=(()=>{class V{static#t=this.\u0275fac=function(X){return new(X||V)};static#e=this.\u0275mod=i.$C({type:V});static#n=this.\u0275inj=i.G2t({imports:[e.MD,b.Cn,L.RI,O.jL,n.hM,N.g7,k.Wk,G.uc,t.YN,t.X1,j.h,K.RG,R.cQ,r.D6]})}return V})();var J=o(5892),q=(o(5555),o(8197));o(1074)},6095:(z,S,o)=>{o.d(S,{k:()=>j});var e=o(4438),t=o(2333),O=o(5892),N=o(177),n=o(4006),b=o(9434),L=o(6600),k=o(9183);function G(v,D){1&v&&(e.j41(0,"button",4)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function K(v,D){if(1&v){const P=e.RV6();e.j41(0,"main")(1,"div",5)(2,"app-icon",6),e.EFF(3,"upload"),e.k0s(),e.j41(4,"p"),e.EFF(5,"Click to select file or Drag and drop files"),e.k0s(),e.j41(6,"input",7),e.bIt("change",function($){e.eBV(P);const f=e.XpG();return e.Njj(f.handleFileEvent($))}),e.k0s()(),e.j41(7,"div",8)(8,"button",9),e.bIt("click",function(){e.eBV(P);const $=e.XpG();return e.Njj($.downloadTemplate())}),e.EFF(9," Download Template "),e.k0s()()()}}function R(v,D){if(1&v&&(e.j41(0,"main",10),e.nrm(1,"mat-spinner",11),e.j41(2,"p"),e.EFF(3),e.k0s()()),2&v){const P=e.XpG();e.R7$(3),e.JRh(P.loading)}}let j=(()=>{class v{constructor(){this.event=new e.bkB}handleFileEvent(P){this.loading="Processing menu data...";const U=P.target;if(!U?.files)return this.loading="";const $=U.files;if(!$.length)return this.loading="";const f=$[0],y=new FileReader;y.addEventListener("loadend",E=>{const T=(0,t.a6)(E.target.result);this.loading="",this.event.emit({reason:"done",metadata:T.filter(A=>"item"===(A.type||"").toLowerCase()).map(A=>new O.T({...A,options:T.filter(g=>"option"===(g.type||"").toLowerCase()&&g.tags===A.id).map(g=>({id:g.id,name:g.name,group:g.category,multiple:g.multiple,unit_price:g.unit_price}))}))})}),y.readAsText(f)}downloadTemplate(){(0,t.PE)("import-menu-template.csv","ID,Type,Name,Unit Price,Category,Description,Tags,Multiple\nitem-1,item,Coffee,200,Drink,Wake Up,,\noption-1,option,1 Sugar,20,Sugars,,item-1,false")}static#t=this.\u0275fac=function(U){return new(U||v)};static#e=this.\u0275cmp=e.VBU({type:v,selectors:[["catering-import-menu-modal"]],outputs:{event:"event"},decls:7,vars:3,consts:[["load_state",""],[1,"h-12","bg-primary","flex","items-center","justify-between","px-4"],["icon","","mat-dialog-close","",4,"ngIf"],[4,"ngIf","ngIfElse"],["icon","","mat-dialog-close",""],[1,"relative","flex","flex-col","items-center","justify-center","space-y-2","h-[24rem]","w-[24rem]","border-4","border-base-200","border-dashed","rounded-xl","hover:bg-base-200","m-4","p-4","cursor-pointer"],[1,"text-4xl"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"],[1,"flex","items-center","justify-center","px-4","pb-4"],["matRipple","",1,"clear","underline","w-48",3,"click"],[1,"flex","flex-col","items-center","justify-center","space-y-2","p-8","h-[24rem]","w-[24rem]"],["diameter","32"]],template:function(U,$){if(1&U&&(e.j41(0,"header",1)(1,"h2"),e.EFF(2,"Import Catering Menu"),e.k0s(),e.DNE(3,G,3,0,"button",2),e.k0s(),e.DNE(4,K,10,0,"main",3)(5,R,4,1,"ng-template",null,0,e.C5r)),2&U){const f=e.sdS(6);e.R7$(3),e.Y8G("ngIf",!$.loading),e.R7$(),e.Y8G("ngIf",!$.loading)("ngIfElse",f)}},dependencies:[N.bT,n.tx,b.R,L.r6,k.LG]})}return v})()},807:(z,S,o)=>{o.d(S,{d:()=>p});var e=o(7336),t=o(4438),O=o(9417),N=o(4006),n=o(2333),b=o(5892),L=o(177),k=o(850),G=o(6600),K=o(2765),R=o(9434),j=o(3719),v=o(9631),D=o(9183),P=o(6471),U=o(5507),$=o(6864);const f=()=>({standalone:!0});function y(_,d){1&_&&(t.j41(0,"button",9)(1,"app-icon"),t.EFF(2,"close"),t.k0s()())}function E(_,d){if(1&_&&(t.j41(0,"div",20)(1,"label",21),t.EFF(2," Name"),t.j41(3,"span"),t.EFF(4,"*"),t.k0s(),t.EFF(5,": "),t.k0s(),t.j41(6,"mat-form-field",22),t.nrm(7,"input",23),t.j41(8,"mat-error"),t.EFF(9,"Name is required"),t.k0s()()()),2&_){const r=t.XpG(2);t.R7$(),t.AVh("error",r.form.controls.name.invalid&&r.form.controls.name.touched)}}function x(_,d){if(1&_&&(t.j41(0,"div",20)(1,"label",24),t.EFF(2," Category"),t.j41(3,"span"),t.EFF(4,"*"),t.k0s(),t.EFF(5,": "),t.k0s(),t.j41(6,"mat-form-field",22),t.nrm(7,"input",25),t.j41(8,"mat-error"),t.EFF(9,"Category is required"),t.k0s()()()),2&_){const r=t.XpG(2),m=t.sdS(9);t.R7$(),t.AVh("error",r.form.controls.category.invalid&&r.form.controls.category.touched),t.R7$(6),t.Y8G("matAutocomplete",m)}}function T(_,d){if(1&_){const r=t.RV6();t.j41(0,"mat-chip-row",30),t.bIt("removed",function(){const a=t.eBV(r).$implicit,s=t.XpG(3);return t.Njj(s.removeTag(a))}),t.EFF(1),t.j41(2,"button",31)(3,"app-icon"),t.EFF(4,"cancel"),t.k0s()()()}if(2&_){const r=d.$implicit;t.R7$(),t.SpI(" ",r," "),t.R7$(),t.BMQ("aria-label","Remove "+r)}}function A(_,d){if(1&_){const r=t.RV6();t.j41(0,"div",20)(1,"label",26),t.pXf(2,3),t.k0s(),t.j41(3,"mat-form-field",22)(4,"mat-chip-grid",27,2),t.DNE(6,T,5,2,"mat-chip-row",28),t.k0s(),t.j41(7,"input",29),t.bIt("matChipInputTokenEnd",function(a){t.eBV(r);const s=t.XpG(2);return t.Njj(s.addTag(a))}),t.k0s()()()}if(2&_){const r=t.sdS(5),m=t.XpG(2);t.R7$(),t.AVh("error",m.form.controls.tags.invalid&&m.form.controls.tags.touched),t.R7$(5),t.Y8G("ngForOf",m.tag_list),t.R7$(),t.Y8G("matChipInputFor",r)("matChipInputSeparatorKeyCodes",m.separators)("matChipInputAddOnBlur",!0)}}function g(_,d){1&_&&(t.j41(0,"div",20)(1,"label",32),t.EFF(2,"Description:"),t.k0s(),t.j41(3,"mat-form-field",22),t.nrm(4,"textarea",33),t.k0s()())}function I(_,d){if(1&_&&(t.j41(0,"div",20)(1,"label",21),t.EFF(2," Unit Price"),t.j41(3,"span"),t.EFF(4,"*"),t.k0s(),t.EFF(5,": "),t.k0s(),t.j41(6,"mat-form-field",22),t.nrm(7,"input",34),t.j41(8,"mat-error"),t.EFF(9,"Unit Price is required"),t.k0s()()()),2&_){const r=t.XpG(2);t.R7$(),t.AVh("error",r.form.controls.unit_price.invalid&&r.form.controls.unit_price.touched)}}function M(_,d){1&_&&(t.j41(0,"div",20)(1,"label",35),t.pXf(2,4),t.k0s(),t.nrm(3,"image-list-field",36),t.k0s())}function B(_,d){if(1&_){const r=t.RV6();t.j41(0,"form",10)(1,"div",11),t.DNE(2,E,10,2,"div",12)(3,x,10,3,"div",12),t.k0s(),t.DNE(4,A,8,6,"div",12)(5,g,5,0,"div",12)(6,I,10,2,"div",12),t.j41(7,"div",13)(8,"label",14),t.EFF(9,"Accept Points?"),t.k0s(),t.j41(10,"mat-checkbox",15),t.EFF(11),t.k0s()(),t.j41(12,"div",16)(13,"mat-checkbox",17),t.bIt("ngModelChange",function(a){t.eBV(r);const s=t.XpG();return t.Njj(a?s.addTag({value:"Gluten Free"}):s.removeTag("Gluten Free"))}),t.EFF(14," Gluten Free (GF) "),t.k0s(),t.j41(15,"mat-checkbox",17),t.bIt("ngModelChange",function(a){t.eBV(r);const s=t.XpG();return t.Njj(a?s.addTag({value:"Vegan"}):s.removeTag("Vegan"))}),t.EFF(16," Vegan (VG) "),t.k0s(),t.j41(17,"mat-checkbox",17),t.bIt("ngModelChange",function(a){t.eBV(r);const s=t.XpG();return t.Njj(a?s.addTag({value:"Vegetarian"}):s.removeTag("Vegetarian"))}),t.EFF(18," Vegetarian (V) "),t.k0s(),t.j41(19,"mat-checkbox",17),t.bIt("ngModelChange",function(a){t.eBV(r);const s=t.XpG();return t.Njj(a?s.addTag({value:"Contains Dairy"}):s.removeTag("Contains Dairy"))}),t.EFF(20," Contains Dairy (D) "),t.k0s(),t.j41(21,"mat-checkbox",17),t.bIt("ngModelChange",function(a){t.eBV(r);const s=t.XpG();return t.Njj(a?s.addTag({value:"Contains Nuts"}):s.removeTag("Contains Nuts"))}),t.EFF(22," Contains Nuts (N) "),t.k0s()(),t.j41(23,"div",13)(24,"label",18),t.EFF(25,"Discount Cap"),t.k0s(),t.nrm(26,"a-counter",19),t.k0s(),t.DNE(27,M,4,0,"div",12),t.k0s()}if(2&_){let r;const m=t.XpG();t.Y8G("formGroup",m.form),t.R7$(2),t.Y8G("ngIf",m.form.controls.name),t.R7$(),t.Y8G("ngIf",m.form.controls.category),t.R7$(),t.Y8G("ngIf",m.form.controls.tags),t.R7$(),t.Y8G("ngIf",m.form.controls.description),t.R7$(),t.Y8G("ngIf",m.form.controls.unit_price),t.R7$(5),t.JRh(null!=(r=m.form.get("accept_points"))&&r.value?"No":"Yes"),t.R7$(2),t.Y8G("ngModel",m.hasTag("Gluten Free"))("ngModelOptions",t.lJ4(22,f)),t.R7$(2),t.Y8G("ngModel",m.hasTag("Vegan"))("ngModelOptions",t.lJ4(23,f)),t.R7$(2),t.Y8G("ngModel",m.hasTag("Vegetarian"))("ngModelOptions",t.lJ4(24,f)),t.R7$(2),t.Y8G("ngModel",m.hasTag("Contains Dairy"))("ngModelOptions",t.lJ4(25,f)),t.R7$(2),t.Y8G("ngModel",m.hasTag("Contains Nuts"))("ngModelOptions",t.lJ4(26,f)),t.R7$(5),t.Y8G("min",0)("max",100)("step",5)("render_fn",m.renderPercent),t.R7$(),t.Y8G("ngIf",m.form.controls.images)}}function u(_,d){if(1&_){const r=t.RV6();t.j41(0,"footer",37)(1,"button",38),t.bIt("click",function(){t.eBV(r);const a=t.XpG();return t.Njj(a.saveChanges())}),t.EFF(2," Save "),t.k0s()()}if(2&_){const r=t.XpG();t.R7$(),t.Y8G("disabled",!r.form.dirty)}}function l(_,d){1&_&&(t.j41(0,"div",39),t.nrm(1,"mat-spinner",40),t.j41(2,"p"),t.EFF(3,"Saving catering item..."),t.k0s()())}function i(_,d){if(1&_&&(t.j41(0,"mat-option",41),t.EFF(1),t.k0s()),2&_){const r=d.$implicit;t.Y8G("value",r),t.R7$(),t.SpI(" ",r," ")}}let p=(()=>{class _{get item(){return this._data.item||new b.T}get categories(){return this._data.categories||[]}get tag_list(){return this.form.controls.tags.value}renderPercent(r=0){return`${r}%`}hasTag(r){return this.tag_list.includes(r)}constructor(r){this._data=r,this.event=new t.bkB,this.form=new O.gE({name:new O.MJ(this.item.name||"",[O.k0.required]),description:new O.MJ(this.item.description||""),category:new O.MJ(this.item.category||"",[O.k0.required]),unit_price:new O.MJ(this.item.unit_price,[O.k0.required]),tags:new O.MJ(this.item.tags||[]),accept_points:new O.MJ(this.item.accept_points||!1),discount_cap:new O.MJ(this.item.discount_cap||0),images:new O.MJ(this.item.images||[])}),this.loading=!1,this.separators=[e.Fm,e.KE,e.t6]}addTag(r){if(!this.form||!this.form.controls.tags)return;this.form.controls.tags.markAsDirty();const m=r.input,a=r.value,s=this.tag_list;(a||"").trim()&&(s.push(a),this.form.controls.tags.setValue(s)),m&&(m.value="")}removeTag(r){if(!this.form||!this.form.controls.tags)return;const m=this.tag_list;this.form.controls.tags.markAsDirty();const a=m.indexOf(r);a>=0&&(m.splice(a,1),this.form.controls.tags.setValue(m))}saveChanges(){this.loading=!0,this.event.emit({reason:"done",metadata:{item:new b.T({...this.item,id:this.item.id||`item-${(0,n.HO)(99999999)}`,...this.form.value})}})}static#t=this.\u0275fac=function(m){return new(m||_)(t.rXU(N.Vh))};static#e=this.\u0275cmp=t.VBU({type:_,selectors:[["catering-item-modal"]],outputs:{event:"event"},decls:11,vars:6,consts:()=>{let r,m,a;return r=$localize`:@@zoneTagsPlaceholder␟c133beffffe3288bbdbf8572a32910c33ce14991␟2194594490376201833:Item tags e.g. Gluten Free, Vegan etc.`,m=$localize`:@@tagsLabel␟800ffadd463cfe152c5af3fa9f13803ab2e77b93␟4746186018558508280: Tags: `,a=$localize`:@@imagesLabel␟e5d9e00faa06714d7671b164cad364b26f4c585b␟5137125764814732349:Images:`,[["load_state",""],["auto","matAutocomplete"],["chipList",""],m,a,["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 overflow-auto max-h-[65vh]",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex p-2 items-center justify-center border-t border-solid border-base-200",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","overflow-auto","max-h-[65vh]",3,"formGroup"],[1,"flex","items-center","space-x-2"],["class","flex flex-col",4,"ngIf"],[1,"flex","items-center"],[1,"flex-none","w-28","min-w-0"],["formControlName","accept_points"],["list","",1,"flex","items-center","flex-wrap","max-w-lg"],[3,"ngModelChange","ngModel","ngModelOptions"],[1,"flex-1","w-24","min-w-0"],["formControlName","discount_cap",1,"border","border-base-200","rounded",3,"min","max","step","render_fn"],[1,"flex","flex-col"],["for","title"],["appearance","outline"],["matInput","","name","name","placeholder","Item name","formControlName","name"],["for","category"],["matInput","","name","category","placeholder","Category","formControlName","category",3,"matAutocomplete"],["for","tags"],["aria-label","Item Tags"],[3,"removed",4,"ngFor","ngForOf"],["name","tags","placeholder",r,3,"matChipInputTokenEnd","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur"],[3,"removed"],["matChipRemove",""],["for","description"],["matInput","","name","description","placeholder","Item Description","formControlName","description"],["matInput","","name","unit-price","type","number","placeholder","Unit Price","formControlName","unit_price"],["for","images"],["name","images","formControlName","images"],[1,"flex","p-2","items-center","justify-center","border-t","border-solid","border-base-200"],["btn","","matRipple","",3,"click","disabled"],[1,"flex","flex-col","items-center","p-8","space-y-2","w-64"],["diameter","32"],[3,"value"]]},template:function(m,a){if(1&m&&(t.j41(0,"header")(1,"h3"),t.EFF(2),t.k0s(),t.DNE(3,y,3,0,"button",5),t.k0s(),t.DNE(4,B,28,27,"form",6)(5,u,3,1,"footer",7)(6,l,4,0,"ng-template",null,0,t.C5r),t.j41(8,"mat-autocomplete",null,1),t.DNE(10,i,2,2,"mat-option",8),t.k0s()),2&m){const s=t.sdS(7);t.R7$(2),t.SpI("",a.item.id?"Edit":"Add"," Item"),t.R7$(),t.Y8G("ngIf",!a.loading),t.R7$(),t.Y8G("ngIf",a.form&&!a.loading)("ngIfElse",s),t.R7$(),t.Y8G("ngIf",!a.loading),t.R7$(5),t.Y8G("ngForOf",a.categories)}},dependencies:[L.Sq,L.bT,k.$3,G.wT,k.pN,N.tx,K.So,O.qT,O.me,O.Q0,O.BC,O.cb,O.vS,O.j4,O.JD,R.R,j.rl,j.TL,G.r6,v.fg,D.LG,P.HW,P.D7,P.Zv,P.jH,U.s,$.$],styles:["[list][_ngcontent-%COMP%]   mat-checkbox[_ngcontent-%COMP%]{margin:.5rem}"]})}return _})()},8519:(z,S,o)=>{o.d(S,{o:()=>B});var e=o(2201),t=o(5892),O=o(2333),N=o(8197),n=o(4438),b=o(177),L=o(9115),k=o(2765),G=o(4823),K=o(9417),R=o(9434),j=o(8328),v=o(6600);const D=u=>({key:"active",name:" ",content:u,size:"3.5rem",sortable:!1}),P=()=>({key:"name",name:"Name"}),U=()=>({key:"category",name:"Category"}),$=u=>({key:"unit_price",name:"Price",content:u,size:"6rem"}),f=u=>({key:"actions",name:" ",content:u,size:"6.5rem",sortable:!1}),y=(u,l,i,p,_)=>[u,l,i,p,_];function E(u,l){if(1&u){const i=n.RV6();n.j41(0,"mat-checkbox",6),n.bIt("ngModelChange",function(_){const d=n.eBV(i).row,r=n.XpG();return n.Njj(r.setEnabled(d,_))}),n.k0s()}if(2&u){const i=l.row,p=n.XpG();n.Y8G("ngModel",p.isEnabled(i))}}function x(u,l){if(1&u&&(n.j41(0,"div",7),n.EFF(1),n.nI1(2,"async"),n.nI1(3,"currency"),n.k0s()),2&u){const i=l.data,p=n.XpG();n.R7$(),n.SpI(" ",n.i5U(3,3,i/100,n.bMT(2,1,p.symbol))," ")}}function T(u,l){if(1&u){const i=n.RV6();n.j41(0,"div",8)(1,"button",9)(2,"app-icon"),n.EFF(3,"more_vert"),n.k0s()(),n.j41(4,"mat-menu",null,4)(6,"button",10),n.bIt("click",function(){const _=n.eBV(i).row,d=n.XpG();return n.Njj(d.addOption(_))}),n.j41(7,"div",11)(8,"app-icon"),n.EFF(9,"add"),n.k0s(),n.j41(10,"div"),n.EFF(11,"Add Option"),n.k0s()()(),n.j41(12,"button",10),n.bIt("click",function(){const _=n.eBV(i).row,d=n.XpG();return n.Njj(d.editItem(_))}),n.j41(13,"div",11)(14,"app-icon"),n.EFF(15,"edit"),n.k0s(),n.j41(16,"div"),n.EFF(17,"Edit Item"),n.k0s()()(),n.j41(18,"button",10),n.bIt("click",function(){const _=n.eBV(i).row,d=n.XpG();return n.Njj(d.removeItem(_))}),n.j41(19,"div",11)(20,"app-icon",12),n.EFF(21,"delete"),n.k0s(),n.j41(22,"div"),n.EFF(23,"Remove Item"),n.k0s()()()(),n.j41(24,"button",13),n.bIt("click",function(){const _=n.eBV(i).row,d=n.XpG();return n.Njj(d.show_children[_.id]=!d.show_children[_.id])}),n.j41(25,"app-icon"),n.EFF(26),n.k0s()()()}if(2&u){const i=l.row,p=n.sdS(5),_=n.XpG();n.R7$(),n.AVh("opacity-0",!_.can_edit),n.Y8G("disabled",!_.can_edit)("matMenuTriggerFor",p),n.R7$(23),n.Y8G("disabled",!(null!=i.options&&i.options.length))("matTooltip",null!=i.options&&i.options.length?(_.show_children[i.id]?"Hide":"Show")+" Menu Item Options":""),n.R7$(2),n.SpI(" ",_.show_children[i.id]?"keyboard_arrow_down":"chevron_right"," ")}}function A(u,l){if(1&u){const i=n.RV6();n.j41(0,"button",22),n.bIt("click",function(){n.eBV(i);const _=n.XpG().$implicit,d=n.XpG().row,r=n.XpG();return n.Njj(r.editOption(d,_))}),n.j41(1,"app-icon"),n.EFF(2,"edit"),n.k0s()()}}function g(u,l){if(1&u){const i=n.RV6();n.j41(0,"button",23),n.bIt("click",function(){n.eBV(i);const _=n.XpG().$implicit,d=n.XpG().row,r=n.XpG();return n.Njj(r.removeOption(d,_))}),n.j41(1,"app-icon",12),n.EFF(2,"delete"),n.k0s()()}}function I(u,l){if(1&u&&(n.j41(0,"div",15),n.nrm(1,"div",16),n.j41(2,"div",17)(3,"div",18),n.EFF(4),n.k0s(),n.j41(5,"div",19),n.EFF(6),n.k0s()(),n.DNE(7,A,3,0,"button",20)(8,g,3,0,"button",21),n.k0s()),2&u){const i=l.$implicit,p=n.XpG(2);n.R7$(4),n.JRh(i.name),n.R7$(2),n.SpI(" ",i.group," "),n.R7$(),n.Y8G("ngIf",p.can_edit),n.R7$(),n.Y8G("ngIf",p.can_edit)}}function M(u,l){1&u&&n.DNE(0,I,9,4,"div",14),2&u&&n.Y8G("ngForOf",l.row.options)}let B=(()=>{class u{get filters(){return this._orders.filters}get can_edit(){return this._catering.is_editable}get categories(){return this._catering.categories}constructor(i,p){this._catering=i,this._orders=p,this.show_children={},this.menu=this._catering.menu,this.addOption=_=>this._catering.addOption(_),this.editOption=(_,d)=>this._catering.addOption(_,d),this.removeOption=(_,d)=>this._catering.deleteOption(_,d),this.editItem=_=>this._catering.addItem(_),this.removeItem=_=>this._catering.deleteItem(_)}isEnabled(i){return!i.hide_for_zones.includes(this._catering.zone)}setEnabled(i,p){let _=i.hide_for_zones;_=p?_.filter(d=>d!==this._catering.zone):(0,O.Am)([..._,this._catering.zone]),this._catering.updateItem(new t.T({...i,hide_for_zones:_}))}static#t=this.\u0275fac=function(p){return new(p||u)(n.rXU(e._),n.rXU(N.Q))};static#e=this.\u0275cmp=n.VBU({type:u,selectors:[["catering-menu"]],decls:9,vars:20,consts:[["active_template",""],["price_template",""],["actions_template",""],["child_template",""],["menu","matMenu"],["empty_message","No Items in Menu",1,"w-full","min-w-[32rem]","block","text-sm",3,"data","columns","filter","show_children","child_template","sortable"],["matTooltip","Allow Ordering Item for this zone","matTooltipPosition","right",1,"mx-auto",3,"ngModelChange","ngModel"],[1,"px-2","py-1","font-mono","text-xs","flex","items-center","mx-auto","bg-secondary","text-secondary-content","rounded"],[1,"p-2","flex","items-center","mx-auto","space-x-2"],["icon","","matRipple","",3,"disabled","matMenuTriggerFor"],["mat-menu-item","",1,"flex","items-center",3,"click"],[1,"flex","items-center","space-x-2","pr-2"],[1,"text-error"],["icon","","matRipple","",3,"click","disabled","matTooltip"],["class","flex p-2 items-center border-b border-solid border-base-200 relative space-x-2",4,"ngFor","ngForOf"],[1,"flex","p-2","items-center","border-b","border-solid","border-base-200","relative","space-x-2"],[1,"absolute","inset-y-0","left-0","w-2","bg-black","opacity-10"],[1,"flex-1","pl-4","pr-2"],[1,"text"],[1,"text-xs","opacity-60"],["icon","","matRipple","","matTooltip","Edit Menu Item Option",3,"click",4,"ngIf"],["icon","","matRipple","","class","!mr-1","matTooltip","Remove Menu Item Option",3,"click",4,"ngIf"],["icon","","matRipple","","matTooltip","Edit Menu Item Option",3,"click"],["icon","","matRipple","","matTooltip","Remove Menu Item Option",1,"!mr-1",3,"click"]],template:function(p,_){if(1&p&&(n.nrm(0,"simple-table",5),n.DNE(1,E,1,1,"ng-template",null,0,n.C5r)(3,x,4,6,"ng-template",null,1,n.C5r)(5,T,27,7,"ng-template",null,2,n.C5r)(7,M,1,1,"ng-template",null,3,n.C5r)),2&p){const d=n.sdS(2),r=n.sdS(4),m=n.sdS(6),a=n.sdS(8);n.Y8G("data",_.menu)("columns",n.s1E(14,y,n.eq3(6,D,d),n.lJ4(8,P),n.lJ4(9,U),n.eq3(10,$,r),n.eq3(12,f,m)))("filter",null==_.filters?null:_.filters.search)("show_children",_.show_children)("child_template",a)("sortable",!0)}},dependencies:[b.Sq,b.bT,L.kk,L.fb,L.Cp,k.So,G.oV,K.BC,K.vS,R.R,j.O,v.r6,b.Jj,b.oe],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:90%;width:100%}"]})}return u})()},7053:(z,S,o)=>{o.d(S,{e:()=>A});var e=o(4438),t=o(9417),O=o(4006),N=o(4217),n=o(5892),b=o(177),L=o(850),k=o(6600),G=o(2765),K=o(9434),R=o(3719),j=o(9631),v=o(9183);function D(g,I){1&g&&(e.j41(0,"button",6)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function P(g,I){if(1&g&&(e.j41(0,"div",9)(1,"label",10),e.EFF(2," Name"),e.j41(3,"span"),e.EFF(4,"*"),e.k0s(),e.EFF(5,": "),e.k0s(),e.j41(6,"mat-form-field",11),e.nrm(7,"input",12),e.j41(8,"mat-error"),e.EFF(9,"Name is required"),e.k0s()()()),2&g){const M=e.XpG(2);e.R7$(),e.AVh("error",M.form.controls.name.invalid&&M.form.controls.name.touched)}}function U(g,I){if(1&g&&(e.j41(0,"div",9)(1,"label",13),e.EFF(2," Type"),e.j41(3,"span"),e.EFF(4,"*"),e.k0s(),e.EFF(5,": "),e.k0s(),e.j41(6,"mat-form-field",11),e.nrm(7,"input",14),e.j41(8,"mat-error"),e.EFF(9,"Type is required"),e.k0s()()()),2&g){const M=e.XpG(2),B=e.sdS(9);e.R7$(),e.AVh("error",M.form.controls.group.invalid&&M.form.controls.group.touched),e.R7$(6),e.Y8G("matAutocomplete",B)}}function $(g,I){1&g&&(e.j41(0,"div",9)(1,"label",10),e.EFF(2,"Unit Price:"),e.k0s(),e.j41(3,"mat-form-field",11),e.nrm(4,"input",15),e.k0s()())}function f(g,I){1&g&&(e.j41(0,"div",9)(1,"mat-checkbox",16),e.EFF(2," Can select multiple of type "),e.k0s()())}function y(g,I){if(1&g&&(e.j41(0,"form",7),e.DNE(1,P,10,2,"div",8)(2,U,10,3,"div",8)(3,$,5,0,"div",8)(4,f,3,0,"div",8),e.k0s()),2&g){const M=e.XpG();e.Y8G("formGroup",M.form),e.R7$(),e.Y8G("ngIf",M.form.controls.name),e.R7$(),e.Y8G("ngIf",M.form.controls.group),e.R7$(),e.Y8G("ngIf",M.form.controls.unit_price),e.R7$(),e.Y8G("ngIf",M.form.controls.multiple)}}function E(g,I){if(1&g){const M=e.RV6();e.j41(0,"footer",17)(1,"button",18),e.bIt("click",function(){e.eBV(M);const u=e.XpG();return e.Njj(u.saveChanges())}),e.EFF(2," Save "),e.k0s()()}if(2&g){const M=e.XpG();e.R7$(),e.Y8G("disabled",!M.form.dirty)}}function x(g,I){1&g&&(e.j41(0,"div",19),e.nrm(1,"mat-spinner",20),e.j41(2,"p"),e.EFF(3,"Saving catering item option..."),e.k0s()())}function T(g,I){if(1&g&&(e.j41(0,"mat-option",21),e.EFF(1),e.k0s()),2&g){const M=I.$implicit;e.Y8G("value",M),e.R7$(),e.SpI(" ",M," ")}}let A=(()=>{class g{get option(){return this._data.option}get types(){return this._data.types||[]}constructor(M){this._data=M,this.event=new e.bkB,this.form=new t.gE({name:new t.MJ(this.option.name||"",[t.k0.required]),group:new t.MJ(this.option.group||"",[t.k0.required]),unit_price:new t.MJ(this.option.unit_price),multiple:new t.MJ(!!this.option.multiple,[])}),this.loading=!1}saveChanges(){this.loading=!0;const M={...this.option,id:this.option.id||`option-${(0,N.HO)(99999999)}`,...this.form.value};this.event.emit({reason:"done",metadata:{item:new n.T({...this._data.parent,options:this._data.parent.options.filter(B=>B.id!==M.id).concat([M])})}})}static#t=this.\u0275fac=function(B){return new(B||g)(e.rXU(O.Vh))};static#e=this.\u0275cmp=e.VBU({type:g,selectors:[["catering-option-modal"]],outputs:{event:"event"},decls:11,vars:6,consts:[["load_state",""],["auto","matAutocomplete"],["icon","","mat-dialog-close","",4,"ngIf"],["class","p-4 overflow-auto max-h-[65vh]",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex p-2 items-center justify-center border-t border-solid border-base-200",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],["icon","","mat-dialog-close",""],[1,"p-4","overflow-auto","max-h-[65vh]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","title"],["appearance","outline"],["matInput","","name","name","placeholder","Item name","formControlName","name"],["for","group"],["matInput","","name","group","placeholder","Type of option e.g. Number of sugars","formControlName","group",3,"matAutocomplete"],["matInput","","name","unit-price","type","number","placeholder","Unit Price","formControlName","unit_price"],["name","multiple","formControlName","multiple"],[1,"flex","p-2","items-center","justify-center","border-t","border-solid","border-base-200"],["btn","","matRipple","",3,"click","disabled"],["loading","",1,"flex","flex-col","items-center","p-8","space-y-2","w-64"],["diameter","32"],[3,"value"]],template:function(B,u){if(1&B&&(e.j41(0,"header")(1,"h3"),e.EFF(2),e.k0s(),e.DNE(3,D,3,0,"button",2),e.k0s(),e.DNE(4,y,5,5,"form",3)(5,E,3,1,"footer",4)(6,x,4,0,"ng-template",null,0,e.C5r),e.j41(8,"mat-autocomplete",null,1),e.DNE(10,T,2,2,"mat-option",5),e.k0s()),2&B){const l=e.sdS(7);e.R7$(2),e.SpI("",u.option.id?"Edit":"Add"," Item Option"),e.R7$(),e.Y8G("ngIf",!u.loading),e.R7$(),e.Y8G("ngIf",u.form&&!u.loading)("ngIfElse",l),e.R7$(),e.Y8G("ngIf",!u.loading),e.R7$(5),e.Y8G("ngForOf",u.types)}},dependencies:[b.Sq,b.bT,L.$3,k.wT,L.pN,O.tx,G.So,t.qT,t.me,t.Q0,t.BC,t.cb,t.j4,t.JD,K.R,R.rl,R.TL,k.r6,j.fg,v.LG]})}return g})()},3872:(z,S,o)=>{o.d(S,{Q:()=>K});var e=o(4438),t=o(177),O=o(9434),N=o(6600);const n=["catering-order-item",""];function b(R,j){if(1&R&&(e.j41(0,"div",12),e.EFF(1),e.k0s()),2&R){const v=e.XpG().$implicit;e.R7$(),e.SpI(" ",v.name," ")}}function L(R,j){if(1&R&&(e.qex(0),e.DNE(1,b,2,1,"div",11),e.bVm()),2&R){const v=j.$implicit;e.R7$(),e.Y8G("ngIf",v)}}function k(R,j){if(1&R){const v=e.RV6();e.qex(0),e.j41(1,"div",1),e.nrm(2,"div",2),e.k0s(),e.j41(3,"div",3)(4,"button",4),e.bIt("click",function(){e.eBV(v);const P=e.XpG();return e.Njj(P.toggle())}),e.j41(5,"app-icon"),e.EFF(6),e.k0s()()(),e.j41(7,"div",5)(8,"div",6)(9,"div",7),e.EFF(10),e.k0s()(),e.j41(11,"div",8),e.EFF(12),e.k0s(),e.j41(13,"div",9),e.DNE(14,L,2,1,"ng-container",10),e.k0s()(),e.bVm()}if(2&R){const v=e.XpG();e.R7$(4),e.AVh("bg-success",v.active)("text-white",v.active)("border-solid",v.active),e.R7$(2),e.JRh(v.active?"done":"local_pizza"),e.R7$(4),e.SpI(" \u2a2f",(null==v.item?null:v.item.amount)||(null==v.item?null:v.item.quantity)||1," "),e.R7$(2),e.JRh(null==v.item?null:v.item.name),e.R7$(2),e.Y8G("ngForOf",v.item.option_list)}}const G=new Set;let K=(()=>{class R{constructor(){this.active=!1}get item_key(){return`${this.order_id}|${this.item?.id}`}ngOnInit(){this.active=G.has(this.item_key)}toggle(){G.has(this.item_key)?(G.delete(this.item_key),this.active=!1):(G.add(this.item_key),this.active=!0)}static#t=this.\u0275fac=function(D){return new(D||R)};static#e=this.\u0275cmp=e.VBU({type:R,selectors:[["","catering-order-item",""]],inputs:{order_id:"order_id",item:"item"},attrs:n,decls:1,vars:1,consts:[[4,"ngIf"],[1,"w-16","text-right","h-14","relative"],["arm","",1,"border-b-2","border-l-2","border-base-200","w-4","h-16","absolute","top-1/2","left-1/2","-translate-y-full","-translate-x-px"],[1,"w-12","mr-4"],["action","","icon","","matRipple","",1,"border-2","border-base-200","border-dashed","text-xl","text-dark-fade","p-2",3,"click"],[1,"flex","flex-1","items-center","border-b","border-base-200","border-solid","py-4","space-x-4"],[1,""],[1,"p-1","rounded-full","bg-base-400","w-8","h-8","flex","items-center","justify-center"],[1,"flex-1"],[1,"flex","space-x-2","mr-2","px-4"],[4,"ngFor","ngForOf"],["class","text-xs py-1 px-2 bg-warning text-warning-content rounded-2xl shadow",4,"ngIf"],[1,"text-xs","py-1","px-2","bg-warning","text-warning-content","rounded-2xl","shadow"]],template:function(D,P){1&D&&e.DNE(0,k,15,10,"ng-container",0),2&D&&e.Y8G("ngIf",P.item)},dependencies:[t.Sq,t.bT,O.R,N.r6],styles:["[_nghost-%COMP%]:last-child > div[_ngcontent-%COMP%]{border:none!important}"]})}return R})()},1623:(z,S,o)=>{o.d(S,{r:()=>a});var e=o(467),t=o(8197),O=o(2333),N=o(1074),n=o(4438),b=o(177),L=o(9115),k=o(4823),G=o(9434),K=o(8328),R=o(6600),j=o(3872);const v=s=>({key:"state",name:" ",size:"4rem",sortable:!1,content:s}),D=s=>({key:"deliver_at",name:"Time",content:s}),P=s=>({key:"event",name:"Meeting Time",content:s}),U=s=>({key:"event",name:"Location",content:s}),$=s=>({key:"event",name:"Host",content:s}),f=()=>({key:"charge_code",name:"Charge Code"}),y=()=>({key:"invoice_number",name:"Invoice No."}),E=s=>({key:"status",name:"Status",content:s,size:"11rem"}),x=s=>({key:"actions",name:" ",size:"6.5rem",content:s,sortable:!1}),T=(s,h,c,C,W,w,J,H,q)=>[s,h,c,C,W,w,J,H,q];function A(s,h){1&s&&(n.j41(0,"div",11)(1,"div",12)(2,"app-icon"),n.EFF(3,"room_service"),n.k0s()()())}function g(s,h){if(1&s&&(n.j41(0,"div",13),n.EFF(1),n.nI1(2,"date"),n.k0s()),2&s){const c=h.data,C=n.XpG();n.R7$(),n.JRh(n.i5U(2,1,c,C.time_format))}}function I(s,h){if(1&s&&(n.j41(0,"div",14),n.EFF(1),n.nI1(2,"date"),n.nI1(3,"date"),n.nrm(4,"br"),n.EFF(5),n.nI1(6,"date"),n.nI1(7,"date"),n.k0s()),2&s){const c=h.data,C=n.XpG();n.R7$(),n.Lme(" ",n.i5U(2,4,null==c?null:c.date,"MMM d"),", ",n.i5U(3,7,null==c?null:c.date,C.time_format)," "),n.R7$(4),n.Lme(" ",n.i5U(6,10,null==c?null:c.date_end,"MMM d"),", ",n.i5U(7,13,null==c?null:c.date_end,C.time_format)," ")}}function M(s,h){1&s&&(n.j41(0,"span",16),n.EFF(1," No Location "),n.k0s())}function B(s,h){if(1&s&&(n.j41(0,"div",13),n.EFF(1),n.DNE(2,M,2,0,"span",15),n.k0s()),2&s){const c=h.data;n.R7$(),n.SpI(" ",(null==c||null==c.space?null:c.space.display_name)||(null==c||null==c.space?null:c.space.name)||""," "),n.R7$(),n.Y8G("ngIf",!(null!=c&&null!=c.space&&c.space.display_name||null!=c&&null!=c.space&&c.space.name))}}function u(s,h){1&s&&(n.j41(0,"span",16),n.EFF(1," Unknown Host "),n.k0s())}function l(s,h){if(1&s&&(n.j41(0,"div",13),n.EFF(1),n.DNE(2,u,2,0,"span",15),n.k0s()),2&s){const c=h.data;n.R7$(),n.SpI(" ",(null==c||null==c.organiser?null:c.organiser.name)||(null==c?null:c.host)||""," "),n.R7$(),n.Y8G("ngIf",!(null!=c&&null!=c.organiser&&c.organiser.name||null!=c&&c.host))}}function i(s,h){if(1&s){const c=n.RV6();n.j41(0,"button",22),n.bIt("click",function(){const W=n.eBV(c).$implicit,w=n.XpG().row,J=n.XpG();return n.Njj(J.updateStatus(w,W.id))}),n.j41(1,"div",23),n.nrm(2,"div",24),n.j41(3,"span",25),n.EFF(4),n.k0s()()()}if(2&s){const c=h.$implicit;n.R7$(2),n.xc7("background-color",c.colour),n.R7$(2),n.JRh(c.name)}}function p(s,h){if(1&s&&(n.j41(0,"div",17)(1,"button",18)(2,"div",19),n.EFF(3),n.k0s(),n.j41(4,"app-icon",20),n.EFF(5,"arrow_drop_down"),n.k0s()()(),n.j41(6,"mat-menu",null,8),n.DNE(8,i,5,3,"button",21),n.k0s()),2&s){let c,C;const W=h.data,w=n.sdS(7),J=n.XpG();n.R7$(),n.xc7("background",null==(c=J.status(W))?null:c.colour),n.Y8G("matMenuTriggerFor",w),n.R7$(2),n.SpI(" ",null==(C=J.status(W))?null:C.name," "),n.R7$(5),n.Y8G("ngForOf",J.statuses)}}function _(s,h){if(1&s){const c=n.RV6();n.j41(0,"div",26)(1,"button",27)(2,"app-icon"),n.EFF(3,"description"),n.k0s()(),n.j41(4,"button",28),n.bIt("click",function(){const W=n.eBV(c).row,w=n.XpG();return n.Njj(w.show_children[W.id]=!w.show_children[W.id])}),n.j41(5,"app-icon"),n.EFF(6),n.k0s()()()}if(2&s){const c=h.row,C=n.XpG();n.R7$(),n.Y8G("matTooltip",c.notes),n.R7$(5),n.SpI(" ",C.show_children[c.id]?"keyboard_arrow_down":"chevron_right"," ")}}function d(s,h){if(1&s&&n.nrm(0,"li",32),2&s){const c=h.$implicit,C=n.XpG(2).row;n.Y8G("order_id",null==C?null:C.id)("item",c)}}function r(s,h){if(1&s&&(n.j41(0,"ul",30),n.DNE(1,d,1,2,"li",31),n.k0s()),2&s){const c=n.XpG().row;n.R7$(),n.Y8G("ngForOf",c.items)}}function m(s,h){if(1&s&&n.DNE(0,r,2,1,"ul",29),2&s){const c=h.row;n.Y8G("ngIf",null==c?null:c.items.length)}}let a=(()=>{class s extends O.Tv{get time_format(){return this._settings.time_format}status(c){return N.T.find(C=>C.id===c)}constructor(c,C){var W;super(),W=this,this._orders=c,this._settings=C,this.order_list=this._orders.filtered,this.loading=this._orders.loading,this.statuses=N.T,this.show_children={},this.updateStatus=function(){var w=(0,e.A)(function*(J,H){yield W._orders.updateStatus(J,H),W.timeout("status-change",()=>J.status=H)});return function(J,H){return w.apply(this,arguments)}}()}ngOnInit(){this._orders.startPolling()}ngOnDestroy(){this._orders.stopPolling()}trackByFn(c,C){return C?C.id:void 0}static#t=this.\u0275fac=function(C){return new(C||s)(n.rXU(t.Q),n.rXU(O.h$))};static#e=this.\u0275cmp=n.VBU({type:s,selectors:[["catering-order-list"]],features:[n.Vt3],decls:18,vars:31,consts:[["state_template",""],["time_template",""],["event_time_template",""],["location_template",""],["host_template",""],["status_template",""],["actions_template",""],["child_template",""],["menu","matMenu"],[1,"flex","flex-col","h-full","w-full","overflow-auto"],["empty_message","No Catering Orders",1,"min-w-[80rem]","w-full","block","text-sm",3,"data","columns","sortable","show_children","child_template"],[1,"p-2"],[1,"rounded-full","bg-base-300","p-2","text-2xl","text-base-content","opacity-60","flex","items-center","justify-center"],[1,"p-4"],[1,"px-4","py-2","text-sm"],["class","opacity-30",4,"ngIf"],[1,"opacity-30"],[1,"px-4","py-2"],["status","","matRipple","",1,"rounded-3xl","text-base","border-none","h-10","px-4","flex","items-center","text-white","w-36",3,"matMenuTriggerFor"],[1,"flex","text-center","capitalize","mx-2"],[1,"pl-2"],["mat-menu-item","","class","flex items-center",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",1,"flex","items-center",3,"click"],[1,"flex","items-center","space-x-2"],[1,"rounded-full","h-4","w-4","mr-2"],[1,"mr-2","w-20"],[1,"flex","items-center","space-x-2","p-2","mx-auto"],["icon","","matRipple","",3,"matTooltip"],["icon","","matRipple","",3,"click"],["class","list-none p-0 m-0 w-full relative z-0",4,"ngIf"],[1,"list-none","p-0","m-0","w-full","relative","z-0"],["catering-order-item","","class","flex items-center",3,"order_id","item",4,"ngFor","ngForOf"],["catering-order-item","",1,"flex","items-center",3,"order_id","item"]],template:function(C,W){if(1&C&&(n.j41(0,"div",9),n.nrm(1,"simple-table",10),n.DNE(2,A,4,0,"ng-template",null,0,n.C5r)(4,g,3,4,"ng-template",null,1,n.C5r)(6,I,8,16,"ng-template",null,2,n.C5r)(8,B,3,2,"ng-template",null,3,n.C5r)(10,l,3,2,"ng-template",null,4,n.C5r)(12,p,9,5,"ng-template",null,5,n.C5r)(14,_,7,2,"ng-template",null,6,n.C5r)(16,m,1,1,"ng-template",null,7,n.C5r),n.k0s()),2&C){const w=n.sdS(3),J=n.sdS(5),H=n.sdS(7),q=n.sdS(9),et=n.sdS(11),V=n.sdS(13),Z=n.sdS(15),F=n.sdS(17);n.R7$(),n.Y8G("data",W.order_list)("columns",n.zJS(21,T,[n.eq3(5,v,w),n.eq3(7,D,J),n.eq3(9,P,H),n.eq3(11,U,q),n.eq3(13,$,et),n.lJ4(15,f),n.lJ4(16,y),n.eq3(17,E,V),n.eq3(19,x,Z)]))("sortable",!0)("show_children",W.show_children)("child_template",F)}},dependencies:[b.Sq,b.bT,L.kk,L.fb,L.Cp,k.oV,G.R,K.O,R.r6,j.Q,b.vh],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}"]})}return s})()},2912:(z,S,o)=>{o.d(S,{g:()=>d});var e=o(467),t=o(4438),O=o(4006),N=o(2333),n=o(5892),b=o(5555),L=o(2185),k=o(2666),G=o(177),K=o(6850),R=o(4823),j=o(9417),v=o(9434),D=o(6600),P=o(9183),U=o(5507);const $=()=>({});function f(r,m){1&r&&(t.j41(0,"div",18),t.EFF(1," Options Available "),t.k0s())}function y(r,m){if(1&r){const a=t.RV6();t.j41(0,"a-counter",19),t.bIt("ngModelChange",function(h){t.eBV(a);const c=t.XpG().$implicit,C=t.XpG(5);return t.Njj(C.updateItemQuantity(c,h))}),t.k0s()}if(2&r){const a=t.XpG().$implicit;t.Y8G("ngModel",a.quantity)}}function E(r,m){if(1&r){const a=t.RV6();t.j41(0,"div",20)(1,"div",21)(2,"button",22)(3,"app-icon"),t.EFF(4,"remove"),t.k0s()()(),t.j41(5,"div",23),t.EFF(6),t.k0s(),t.j41(7,"button",24),t.bIt("click",function(){t.eBV(a);const h=t.XpG().$implicit,c=t.XpG(5);return t.Njj(c.addItem(h))}),t.j41(8,"app-icon"),t.EFF(9,"add"),t.k0s()()()}if(2&r){const a=t.XpG().$implicit;t.R7$(),t.Y8G("matTooltip",a.quantity?"Items with options must be removed from order confirmation page":""),t.R7$(),t.Y8G("disabled",!0),t.R7$(4),t.SpI(" ",a.quantity," ")}}function x(r,m){if(1&r&&(t.j41(0,"div",12)(1,"div",13)(2,"div",13),t.EFF(3),t.k0s(),t.DNE(4,f,2,0,"div",14),t.k0s(),t.j41(5,"div",15),t.EFF(6),t.nI1(7,"currency"),t.k0s(),t.DNE(8,y,1,1,"a-counter",16)(9,E,10,3,"div",17),t.k0s()),2&r){const a=m.$implicit,s=t.XpG(5);t.R7$(3),t.SpI(" ",a.name," "),t.R7$(),t.Y8G("ngIf",a.options.length),t.R7$(2),t.SpI(" ",t.i5U(7,5,a.unit_price/100,s.code)," "),t.R7$(2),t.Y8G("ngIf",!a.options.length),t.R7$(),t.Y8G("ngIf",a.options.length)}}function T(r,m){if(1&r&&(t.j41(0,"mat-tab",9)(1,"div",10),t.DNE(2,x,10,8,"div",11),t.k0s()()),2&r){const a=t.XpG().$implicit,s=t.XpG(3);t.Y8G("label",a),t.R7$(2),t.Y8G("ngForOf",(s.menu_items||t.lJ4(2,$))[a])}}function A(r,m){if(1&r&&(t.qex(0),t.DNE(1,T,3,3,"mat-tab",8),t.bVm()),2&r){const a=m.$implicit,s=t.XpG(3);t.R7$(),t.Y8G("ngIf",(s.menu_items||t.lJ4(1,$))[a].length)}}function g(r,m){if(1&r&&(t.qex(0),t.j41(1,"mat-tab-group"),t.DNE(2,A,2,2,"ng-container",7),t.k0s(),t.bVm()),2&r){const a=t.XpG(2);t.R7$(2),t.Y8G("ngForOf",a.categories)}}function I(r,m){if(1&r&&(t.j41(0,"div",5),t.DNE(1,g,3,1,"ng-container",6),t.k0s()),2&r){const a=t.XpG(),s=t.sdS(5);t.R7$(),t.Y8G("ngIf",!a.show_order_details)("ngIfElse",s)}}function M(r,m){if(1&r){const a=t.RV6();t.qex(0),t.j41(1,"button",26),t.EFF(2," Cancel "),t.k0s(),t.j41(3,"button",27),t.bIt("click",function(){t.eBV(a);const h=t.XpG(2);return t.Njj(h.show_order_details=!0)}),t.EFF(4," Confirm "),t.k0s(),t.bVm()}if(2&r){const a=t.XpG(2);t.R7$(3),t.Y8G("disabled",!a.order.item_count)("matBadge",a.order.item_count)("matBadgeHidden",!a.order.item_count)}}function B(r,m){if(1&r){const a=t.RV6();t.j41(0,"button",28),t.bIt("click",function(){t.eBV(a);const h=t.XpG(2);return t.Njj(h.show_order_details=!1)}),t.EFF(1," Back "),t.k0s(),t.j41(2,"button",29),t.bIt("click",function(){t.eBV(a);const h=t.XpG(2);return t.Njj(h.saveOrder())}),t.EFF(3," Save Order "),t.k0s()}}function u(r,m){if(1&r&&(t.j41(0,"footer",25),t.DNE(1,M,5,3,"ng-container",6)(2,B,4,0,"ng-template",null,2,t.C5r),t.k0s()),2&r){const a=t.sdS(3),s=t.XpG();t.R7$(),t.Y8G("ngIf",!s.show_order_details)("ngIfElse",a)}}function l(r,m){if(1&r&&(t.j41(0,"div",30),t.nrm(1,"mat-spinner",31),t.j41(2,"p"),t.EFF(3),t.k0s()()),2&r){const a=t.XpG();t.R7$(3),t.JRh(a.loading)}}function i(r,m){if(1&r&&(t.j41(0,"div",35),t.EFF(1),t.k0s()),2&r){const a=t.XpG().$implicit,s=t.XpG(2);t.Y8G("matTooltip",s.optionsFor(a)),t.R7$(),t.Lme(" ",a.options.length," option",1===a.options.length?"":"s"," selected ")}}function p(r,m){if(1&r){const a=t.RV6();t.j41(0,"div",12)(1,"div",13)(2,"div",13),t.EFF(3),t.k0s(),t.DNE(4,i,2,3,"div",33),t.k0s(),t.j41(5,"div",15),t.EFF(6),t.nI1(7,"currency"),t.k0s(),t.j41(8,"a-counter",34),t.bIt("ngModelChange",function(h){const c=t.eBV(a).$implicit,C=t.XpG(2);return t.Njj(C.updateItemQuantity(c,h))}),t.k0s()()}if(2&r){const a=m.$implicit,s=t.XpG(2);t.R7$(3),t.JRh(a.name),t.R7$(),t.Y8G("ngIf",a.options.length),t.R7$(2),t.SpI(" ",t.i5U(7,4,a.total_cost/100,s.code)," "),t.R7$(2),t.Y8G("ngModel",a.quantity)}}function _(r,m){if(1&r&&(t.j41(0,"header",32)(1,"h3"),t.EFF(2,"Confirm Order"),t.k0s()(),t.j41(3,"div",10),t.DNE(4,p,9,7,"div",11),t.k0s()),2&r){const a=t.XpG();t.R7$(4),t.Y8G("ngForOf",a.order.items)}}let d=(()=>{class r extends N.Tv{get code(){return this._org.currency_code}constructor(a,s){super(),this._org=a,this._data=s,this.event=new t.bkB,this.loading="",this.menu_items={},this.categories=[],this.loading="Loading menu..."}ngOnInit(){var a=this;return(0,e.A)(function*(){a.loading="Loading menu...",a.order=new b.M(a._data.order),a.rules=yield a._data.getCateringConfig(a.order.event?.space?.level?.parent_id),a._data.menu.subscribe(s=>{a.loading="Loading menu...";const h=(0,N.Am)(s.map(C=>C.category)),c={};for(const C of h)c[C]=s.filter(W=>W.category===C&&(0,k.c)(W,a.rules,a.order.event));a.categories=h,a.menu_items=c,a.updateMenuQuantities(),a.timeout("clear_loading",()=>a.loading="",1e3)})})()}addItem(a,s=!0){const h=this.order.items.find(c=>c.id===a.id&&c.options.length===c.options.reduce((C,W)=>C+(a.options.find(w=>W.id===w.id)?1:0),0));s&&a.options?.length?this._data.selectOptions(a.options).then(c=>{const C=new n.T({...a,options:c});this.addItem(C,!1)}):this.order=new b.M(h?{...this.order,items:this.order.items.filter(c=>!(c.id===a.id&&c.options_string===a.options_string)).concat([new n.T({...a,quantity:h.quantity+1})])}:{...this.order,items:this.order.items.concat([new n.T({...a,quantity:1})])}),this.updateMenuQuantities()}removeItem(a){this.order=new b.M({...this.order,items:this.order.items.filter(s=>s.id!==a.id&&s.options_string===a.options_string)}),this.updateMenuQuantities()}updateItemQuantity(a,s){const h=this.order.items.find(C=>C.id===a.id&&C.options_string===a.options_string);let c=[...this.order.items];c=h?this.order.items.filter(C=>!(C.id===a.id&&C.options_string===a.options_string)).concat([new n.T({...a,quantity:s})]):this.order.items.concat([new n.T({...a,quantity:s})]),c.sort((C,W)=>C.name.localeCompare(W.name)),this.order=new b.M({...this.order,items:c}),this.updateMenuQuantities()}updateMenuQuantities(){for(const a in this.menu_items)for(const s of this.menu_items[a])s.quantity=this.order.items.reduce((h,c)=>c.id===s.id?h+c.quantity:h,0)}optionsFor(a){return a.options.map(s=>s.name).join("\n")}saveOrder(){this.event.emit({reason:"done",metadata:{order:this.order}})}confirmOrder(){this.show_order_details=!0}static#t=this.\u0275fac=function(s){return new(s||r)(t.rXU(L.yb),t.rXU(O.Vh))};static#e=this.\u0275cmp=t.VBU({type:r,selectors:[["app-catering-order-modal"]],outputs:{event:"event"},features:[t.Vt3],decls:6,vars:3,consts:[["load_state",""],["order_details",""],["order_actions",""],["class","main min-w-[20rem]",4,"ngIf","ngIfElse"],["class","flex items-center justify-center space-x-2 p-2 border-t border-base-200",4,"ngIf"],[1,"main","min-w-[20rem]"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[1,"list"],["item","","class","flex items-center p-2 border-b border-base-200",4,"ngFor","ngForOf"],["item","",1,"flex","items-center","p-2","border-b","border-base-200"],[1,"flex-1","w-1/2"],["class","text-xs no-underline",4,"ngIf"],[1,"bg-primary","text-xs","rounded","px-4","py-2","mx-2","text-white","font-medium"],["ngDefaultControl","",3,"ngModel","ngModelChange",4,"ngIf"],["class","flex items-center",4,"ngIf"],[1,"text-xs","no-underline"],["ngDefaultControl","",3,"ngModelChange","ngModel"],[1,"flex","items-center"],[3,"matTooltip"],["icon","","matRipple","",3,"disabled"],[1,"count","h-12","w-12","flex","items-center","justify-center"],["icon","","matRipple","",3,"click"],[1,"flex","items-center","justify-center","space-x-2","p-2","border-t","border-base-200"],["btn","","matRipple","","mat-dialog-close","",1,"inverse"],["confirm","","btn","","matRipple","","matBadgeColor","warn",3,"click","disabled","matBadge","matBadgeHidden"],["matRipple","",1,"inverse",3,"click"],["save","","btn","","matRipple","",3,"click"],[1,"flex","flex-col","w-64","p-8","items-center","space-y-2"],["diameter","32"],[1,"h-[3.25rem]"],["class","text-xs underline",3,"matTooltip",4,"ngIf"],[3,"ngModelChange","ngModel"],[1,"text-xs","underline",3,"matTooltip"]],template:function(s,h){if(1&s&&t.DNE(0,I,2,2,"div",3)(1,u,4,2,"footer",4)(2,l,4,1,"ng-template",null,0,t.C5r)(4,_,5,1,"ng-template",null,1,t.C5r),2&s){const c=t.sdS(3);t.Y8G("ngIf",!h.loading)("ngIfElse",c),t.R7$(),t.Y8G("ngIf",!h.loading)}},dependencies:[G.Sq,G.bT,K.mq,K.T8,O.tx,R.oV,j.me,j.BC,j.vS,v.R,D.r6,P.LG,U.s,G.oe],styles:[".list[_ngcontent-%COMP%]{height:24em;min-width:32em;max-width:calc(100vw - 1em)}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:12em}input[_ngcontent-%COMP%]{position:relative;width:100%;padding:1em;border:none;border-radius:0!important;border-top:1px solid #ccc;border-bottom:1px solid #ccc;outline:none;font-size:1em}input[_ngcontent-%COMP%]:focus{border:none;border-top:2px solid var(--s);border-bottom:2px solid var(--s);box-shadow:none}input.error[_ngcontent-%COMP%]::placeholder{color:rgba(var(--error),.45)}"]})}return r})()},7707:(z,S,o)=>{o.d(S,{C:()=>$});var e=o(4438),t=o(4006),O=o(4217),N=o(177),n=o(2765),b=o(5951),L=o(9417),k=o(9434),G=o(6600);function K(f,y){if(1&f&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"currency"),e.k0s()),2&f){const E=e.XpG().$implicit,x=e.XpG(3);e.R7$(),e.SpI(" +",e.i5U(2,1,E.unit_price/100,x.code)," ")}}function R(f,y){if(1&f&&(e.j41(0,"mat-radio-button",14)(1,"div",15)(2,"div",16),e.EFF(3),e.k0s(),e.DNE(4,K,3,4,"div",17),e.k0s()()),2&f){const E=y.$implicit;e.Y8G("value",E.id),e.R7$(3),e.SpI(" ",E.name," "),e.R7$(),e.Y8G("ngIf",E.unit_price)}}function j(f,y){if(1&f){const E=e.RV6();e.qex(0),e.j41(1,"mat-radio-group",10),e.bIt("ngModelChange",function(T){e.eBV(E);const A=e.XpG().$implicit,g=e.XpG();return e.Njj(g.updateGroupOption(A,T))}),e.j41(2,"mat-radio-button",11)(3,"span",12),e.EFF(4,"None"),e.k0s()(),e.DNE(5,R,5,3,"mat-radio-button",13),e.k0s(),e.bVm()}if(2&f){const E=e.XpG().$implicit;e.R7$(5),e.Y8G("ngForOf",null==E?null:E.options)}}function v(f,y){if(1&f&&(e.j41(0,"div",18),e.EFF(1),e.nI1(2,"currency"),e.k0s()),2&f){const E=e.XpG().$implicit,x=e.XpG(3);e.R7$(),e.SpI(" +",e.i5U(2,1,E.unit_price/100,x.code)," ")}}function D(f,y){if(1&f){const E=e.RV6();e.j41(0,"mat-checkbox",20),e.mxI("ngModelChange",function(T){const A=e.eBV(E).$implicit,g=e.XpG(3);return e.DH7(g.option_state[A.id],T)||(g.option_state[A.id]=T),e.Njj(T)}),e.j41(1,"div",15)(2,"div",16),e.EFF(3),e.k0s(),e.DNE(4,v,3,4,"div",17),e.k0s()()}if(2&f){const E=y.$implicit,x=e.XpG(3);e.R50("ngModel",x.option_state[E.id]),e.R7$(3),e.SpI(" ",E.name," "),e.R7$(),e.Y8G("ngIf",E.unit_price)}}function P(f,y){if(1&f&&e.DNE(0,D,5,3,"mat-checkbox",19),2&f){const E=e.XpG().$implicit;e.Y8G("ngForOf",null==E?null:E.options)}}function U(f,y){if(1&f&&(e.j41(0,"div",6)(1,"div",7),e.EFF(2),e.k0s(),e.j41(3,"div",8),e.DNE(4,j,6,1,"ng-container",9)(5,P,1,1,"ng-template",null,0,e.C5r),e.k0s()()),2&f){const E=y.$implicit,x=e.sdS(6);e.BMQ("group",E.name),e.R7$(2),e.JRh(E.name),e.R7$(2),e.Y8G("ngIf",!E.multiple)("ngIfElse",x)}}let $=(()=>{class f{constructor(E){this._data=E,this.event=new e.bkB,this.option_state={},this.code=this._data.code;const x=(0,O.Am)(this._data.options.map(A=>A.group||"Other")),T=[];for(const A of x){const g=this._data.options.filter(I=>I.group===A);T.push({name:A,multiple:!!g.find(I=>I.multiple),options:g})}this.groups=T}updateGroupOption(E,x){for(const T of E.options)this.option_state[T.id]=T.id===x}saveOptions(){const E=this._data.options.filter(x=>this.option_state[x.id]);this.event.emit({reason:"done",metadata:{options:E}})}static#t=this.\u0275fac=function(x){return new(x||f)(e.rXU(t.Vh))};static#e=this.\u0275cmp=e.VBU({type:f,selectors:[["app-catering-options-modal"]],outputs:{event:"event"},decls:11,vars:1,consts:[["multi_options",""],["icon","","mat-dialog-close",""],[1,"overflow-auto"],["class","pt-1 pb-2 border-b border-base-200",4,"ngFor","ngForOf"],[1,"p-2"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"pt-1","pb-2","border-b","border-base-200"],[1,"font-medium","p-2","capitalize"],[1,"flex","flex-col","pl-6"],[4,"ngIf","ngIfElse"],["aria-label","Select an option","ngModel","",1,"flex","flex-col",3,"ngModelChange"],["value","",1,"my-1","mx-0"],[1,"font-medium","p-2"],["class","my-1 mx-0",3,"value",4,"ngFor","ngForOf"],[1,"my-1","mx-0",3,"value"],[1,"flex","items-center","justify-center"],[1,"font-medium","p-2","flex-1","w-1/2"],["class","opacity-60 text-xs",4,"ngIf"],[1,"opacity-60","text-xs"],[3,"ngModel","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModelChange","ngModel"]],template:function(x,T){1&x&&(e.j41(0,"header")(1,"h3"),e.EFF(2,"Select options"),e.k0s(),e.j41(3,"button",1)(4,"app-icon"),e.EFF(5,"close"),e.k0s()()(),e.j41(6,"main",2),e.DNE(7,U,7,4,"div",3),e.k0s(),e.j41(8,"footer",4)(9,"button",5),e.bIt("click",function(){return T.saveOptions()}),e.EFF(10," Save "),e.k0s()()),2&x&&(e.R7$(7),e.Y8G("ngForOf",T.groups))},dependencies:[N.Sq,N.bT,t.tx,n.So,b.VT,b._g,L.BC,L.vS,k.R,G.r6,N.oe],styles:["main[_ngcontent-%COMP%]{min-height:24em;width:24rem;max-width:calc(100vw - 2rem)}"]})}return f})()},8197:(z,S,o)=>{o.d(S,{Q:()=>x});var e=o(467),t=o(9928),O=o(9714),N=o(4421),n=o(3020),b=o(9090),L=o(3921),k=o(5006),G=o(8841),K=o(8712),R=o(3888),j=o(3636),v=o(7383),D=o(8097),P=o(2333),U=o(1416),$=o(6727),f=o(5555),y=o(4438);let x=(()=>{class T extends P.Tv{get filters(){return this._filters.getValue()}set filters(g){this._filters.next(g)}constructor(){super(),this._poll=new t.t(0),this._loading=new t.t(!1),this._filters=new t.t({}),this.orders=(0,O.zV)([this._filters,this._poll]).pipe((0,n.B)(1e3),(0,b.n)(([{date:g,zones:I}])=>{this._loading.next(!0);const M=(0,R.A)((0,j.A)(g||Date.now())),B=(0,R.A)((0,v.A)(g||Date.now()));return(0,U.UU)({zone_ids:(I||[]).join(","),period_start:M,period_end:B}).pipe((0,L.W)(()=>(0,N.of)([])),(0,k.T)(u=>(0,P.Bq)(u.map(l=>l.valid_catering.map(i=>new f.M({...i,event:l}))))),(0,k.T)(u=>u.filter(l=>(0,D.A)(l.deliver_at,"yyyy-MM-dd")===(0,D.A)(1e3*M,"yyyy-MM-dd"))))}),(0,G.M)(()=>this._loading.next(!1)),(0,K.t)(1)),this.loading=this._loading.asObservable(),this.filtered=this.orders.pipe((0,k.T)(g=>g.filter(I=>function E(T,A){const g=(A.search||"").toLowerCase();return!!T.items.find(I=>I.name.toLowerCase().includes(g)||!!I.options.find(M=>M.name.toLowerCase().includes(g)))}(I,this._filters.getValue())).sort((I,M)=>I.deliver_at-M.deliver_at))),this.subscription("changes",this.orders.subscribe())}startPolling(g=15e3){this.interval("polling",()=>this._poll.next((new Date).valueOf()),g)}stopPolling(){this.clearInterval("polling")}updateStatus(g,I){var M=this;return(0,e.A)(function*(){g.status=I;const B=new f.M({...g,status:I,event:null}),u=[...(g.event.extension_data.catering||[]).filter(_=>_.id!==g.id),B].map(_=>new f.M({..._})),l=new $.L({...g.event,catering:u}),i=l?.resources[0]?.id||l?.system?.id,p=yield(0,U.zZ)(l.id,i,l.extension_data).toPromise();return M.timeout("refresh-list",()=>M._poll.next(Date.now()),1e3),g.status=I,p})()}static#t=this.\u0275fac=function(I){return new(I||T)};static#e=this.\u0275prov=y.jDH({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()},2201:(z,S,o)=>{o.d(S,{_:()=>M});var e=o(467),t=o(9596),O=o(9928),N=o(9714),n=o(4421),b=o(8728),L=o(9090),k=o(3921),G=o(5006),K=o(8841),R=o(8712),j=o(4046),v=o(9493),D=o(2333),P=o(2185),U=o(807),$=o(7053),f=o(6815),y=o(5892),E=o(5555),x=o(2912),T=o(7707),A=o(6095),g=o(4438),I=o(4006);let M=(()=>{class B extends D.Tv{get is_editable(){return!this.zone||this.zone===this._org.building?.id}get categories(){const l=this._menu.getValue();return(0,D.Am)(l.map(i=>i.category))}constructor(l,i,p){var _;super(),_=this,this._org=l,this._dialog=i,this._settings=p,this._updated=new O.t(0),this._menu=new O.t([]),this._loading=new O.t(!1),this._currency=new O.t("USD"),this._change=new O.t(0),this.menu=this._menu.asObservable(),this.loading=this._loading.asObservable(),this.currency=this._currency.asObservable(),this.settings=(0,N.zV)([this._org.active_building,this._change]).pipe((0,b.p)(([d])=>!!d),(0,L.n)(([d])=>(0,t.bpY)(d.id,"catering-settings").pipe((0,k.W)(r=>(0,n.of)({})))),(0,G.T)(d=>d.details||{}),(0,K.M)(d=>this._settings.post("require_catering_notes",!!d?.require_notes)),(0,R.t)(1)),this.charge_codes=this.settings.pipe((0,G.T)(d=>d.charge_codes||[])),this.availability=this.settings.pipe((0,G.T)(d=>d.disabled_rooms||[])),this.zone="",this.subscription("building",this._org.active_building.subscribe(function(){var d=(0,e.A)(function*(r){if(r){const m=(yield _.getCateringForZone(r.id)).map(a=>new y.T(a));_._currency.next(_._settings.get("app.currency")||r.currency||"USD"),_._menu.next(m)}});return function(r){return d.apply(this,arguments)}}()))}manageCateringOrder(l){var i=this;return(0,e.A)(function*(){const p=i._dialog.open(x.g,{data:{code:i._currency.getValue(),order:l,menu:i.menu,loading:i.loading,getCateringConfig:d=>i.getCateringConfig(d),selectOptions:d=>i.selectOptions(d)}}),_=yield Promise.race([p.componentInstance.event.pipe((0,j.$)(d=>"done"===d.reason)).toPromise(),p.afterClosed().toPromise()]);return p.close(),_?.metadata?.order||l})()}addItem(l=new y.T){var i=this;return(0,e.A)(function*(){const p=i._dialog.open(U.d,{data:{item:l,categories:i.categories}}),_=yield Promise.race([p.componentInstance.event.pipe((0,j.$)(m=>"done"===m.reason)).toPromise(),p.afterClosed().toPromise()]);if("done"!==_?.reason)return;const d=i._menu.getValue(),r=d.findIndex(m=>m.id===l.id);r>=0?d.splice(r,1,_.metadata.item):d.push(_.metadata.item),i.updateMenu(i._org.building.id,d).then(()=>{i._menu.next([...d]),p.close()},()=>p.componentInstance.loading=!1)})()}updateItem(l){const i=this._menu.getValue(),p=i.findIndex(_=>_.id===l.id);p>=0?i.splice(p,1,l):i.push(l),this.updateMenu(this._org.building.id,i).then(()=>this._menu.next([...i]))}addOption(l,i={}){var p=this;return(0,e.A)(function*(){const _=(0,D.Am)(l.options.map(s=>s.group)),d=p._dialog.open($.e,{data:{parent:l,option:i,types:_}}),r=yield Promise.race([d.componentInstance.event.pipe((0,j.$)(s=>"done"===s.reason)).toPromise(),d.afterClosed().toPromise()]);if("done"!==r?.reason)return;const m=p._menu.getValue(),a=m.findIndex(s=>s.id===l.id);a>=0?m.splice(a,1,r.metadata.item):m.push(r.metadata.item),p.updateMenu(p._org.building.id,m).then(()=>{p._menu.next([...m]),d.close()},()=>d.componentInstance.loading=!1)})()}selectOptions(l){var i=this;return(0,e.A)(function*(){const p=i._dialog.open(T.C,{data:{code:i._currency.getValue(),options:l}}),_=yield Promise.race([p.componentInstance.event.pipe((0,j.$)(d=>"done"===d.reason)).toPromise(),p.afterClosed().toPromise()]);return"done"!==_?.reason?[]:(p.close(),_.metadata.options)})()}deleteItem(l){var i=this;return(0,e.A)(function*(){const p=yield(0,D.GE)({title:"Delete Catering Item",content:`Are you sure you wish to remove the catering item ${l.name} from the menu?`,icon:{type:"icon",class:"material-icons",content:"delete"}},i._dialog);if("done"!==p.reason)return;p.loading("Removing catering item...");const _=i._menu.getValue().filter(d=>l.id!==d.id);i.updateMenu(i._org.building.id,_).then(()=>{i._menu.next([..._]),p.close()},()=>p.loading(""))})()}deleteOption(l,i){var p=this;return(0,e.A)(function*(){const _=yield(0,D.GE)({title:"Delete Catering Item Option",content:`Are you sure you wish to remove the catering option "${i.name}" from "${l.name}"?`,icon:{type:"icon",class:"material-icons",content:"delete"}},p._dialog);if("done"!==_.reason)return;_.loading("Removing catering item option...");const d=p._menu.getValue();d.splice(d.findIndex(r=>r.id===l.id),1,new y.T({...l,options:l.options.filter(r=>r.id!==i.id)})),p.updateMenu(p._org.building.id,d).then(()=>{p._menu.next([...d]),_.close()},()=>_.loading(""))})()}editConfig(){var l=this;return(0,e.A)(function*(){const i=yield l.getCateringConfig(l._org.building.id),{require_notes:p}=yield l.settings.pipe((0,v.s)(1)).toPromise(),_=l._menu.getValue(),d=(0,D.Am)((0,D.Bq)(_.map(a=>[a.category,...a.tags]))),r=l._dialog.open(f.Rt,{data:{config:i,types:d,require_notes:p,saveNotes:a=>l.saveSettings({require_notes:a})}}),m=yield Promise.race([r.componentInstance.event.pipe((0,j.$)(a=>"done"===a.reason)).toPromise(),r.afterClosed().toPromise()]);"done"===m?.reason&&l.updateConfig(l._org.building.id,m.metadata).then(()=>r.close(),()=>r.componentInstance.loading=!1)})()}importMenu(){var l=this;return(0,e.A)(function*(){const i=l._dialog.open(A.k),p=yield Promise.race([i.componentInstance.event.pipe((0,j.$)(m=>"done"===m.reason)).toPromise(),i.afterClosed().toPromise()]);if("done"!==p?.reason)return;i.componentInstance.loading="Updating menu...";const _=l._menu.getValue(),d=l._org.building,r=(0,D.Am)(p.metadata.concat(_),"id");yield l.updateMenu(d.id,r).catch(m=>{throw(0,D.UG)("Error importing catering menu"),i.close(),m}),(0,D.VX)(`Successfully imported catering menu. ${p.metadata.length} item(s) added.`),i.close()})()}updateMenu(l,i){return(0,t.D58)(l,{id:l,name:"catering",details:i,description:`Catering menu for ${l}`}).toPromise()}saveSettings(l){var i=this;return(0,e.A)(function*(){const p=yield i.settings.pipe((0,v.s)(1)).toPromise(),_=yield(0,t.D58)(i._org.building.id,{id:i._org.building.id,name:"catering-settings",details:{...p,...l},description:`Catering settings for ${i._org.building.id}`}).toPromise();return i._change.next(Date.now()),_})()}getCateringForZone(l){return(0,e.A)(function*(){const i=(yield(0,t.bpY)(l,"catering").toPromise()).details;return i instanceof Array?i:[]})()}getCateringConfig(l=this._org.building.id){return(0,e.A)(function*(){const i=(yield(0,t.bpY)(l,"catering_config").toPromise()).details;return i instanceof Array?i:[]})()}updateConfig(l,i){return(0,t.D58)(l,{id:l,name:"catering_config",details:i,description:`Catering menu config for ${l}`}).toPromise()}addItemToOrder(l,i){let p=l.items;const _=p.find(r=>r.id===i.id&&i.options?.length===r.options?.reduce((m,a)=>m+(i.options.find(s=>a.id===s.id)?1:0),0));return _?_.quantity+=1:p=p.concat([new y.T({...i,quantity:1})]),new E.M({...l,items:p,event:null})}static#t=this.\u0275fac=function(i){return new(i||B)(g.KVO(P.yb),g.KVO(I.bZ),g.KVO(D.h$))};static#e=this.\u0275prov=g.jDH({token:B,factory:B.\u0275fac,providedIn:"root"})}return B})()},1074:(z,S,o)=>{o.d(S,{T:()=>e});const e=[{id:"pending",name:"Pending",icon:{class:"custom-pending"},colour:"#ccc"},{id:"accepted",name:"Accepted",icon:{class:"custom-accepted"},colour:"#3996B6"},{id:"preparing",name:"Preparing",icon:{class:"custom-preparing"},colour:"#E7536B"},{id:"ready",name:"Ready",icon:{class:"custom-ready"},colour:"#FFD028"},{id:"delivered",name:"Delivered",icon:{class:"custom-delivered"},colour:"#75BB43"},{id:"cancelled",name:"Cancelled",icon:{class:"custom-cancelled"},colour:"#747474"}]}}]);