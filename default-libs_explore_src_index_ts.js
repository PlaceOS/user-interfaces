"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["default-libs_explore_src_index_ts"],{2373:(Le,pe,r)=>{r.d(pe,{Xp:()=>I,ck:()=>P.c,P2:()=>V});var h=r(4666),d=r(2508),H=r(6725),ie=r(4714),S=r(5895),Z=r(7520),C=r(4110),T=r(9262),f=r(1670),u=r(9112),K=r(5670),$=r(565),P=r(6667),e=r(2560),X=r(9885),ee=r(207),Me=r(5074),Ie=r(7371);function Se(i,n){if(1&i&&(e.TgZ(0,"mat-option",6),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function Ze(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",3)(1,"mat-select",4),e.NdJ("ngModelChange",function(o){e.CHM(t);const a=e.oxw();return e.KtG(a.setBuilding(o))}),e.ALo(2,"async"),e.YNc(3,Se,2,2,"mat-option",5),e.ALo(4,"async"),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",e.lcZ(2,2,t.building)),e.xp6(2),e.Q6J("ngForOf",e.lcZ(4,4,t.buildings))}}function Pe(i,n){if(1&i&&(e.TgZ(0,"mat-option",6),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function Ne(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"mat-form-field",7),e.ALo(1,"async"),e.TgZ(2,"mat-select",8),e.NdJ("ngModelChange",function(o){e.CHM(t);const a=e.oxw();return e.KtG(a.setLevel(o))}),e.ALo(3,"async"),e.YNc(4,Pe,2,2,"mat-option",5),e.ALo(5,"async"),e.qZA()()}if(2&i){const t=e.oxw();let s;e.uIk("has-bld",(null==(s=e.lcZ(1,3,t.buildings))?null:s.length)>1),e.xp6(2),e.Q6J("ngModel",e.lcZ(3,5,t.level)),e.xp6(2),e.Q6J("ngForOf",e.lcZ(5,7,t.levels))}}class B extends u.cx{constructor(n,t,s,o){super(),this._org=n,this._state=t,this._router=s,this._route=o,this.buildings=this._org.active_buildings,this.building=this._org.active_building,this.levels=this._org.active_levels,this.level=this._state.level,this.setLevel=a=>{this._state.setFeatures("_located",[]),this.timeout("set_level",()=>this._router.navigate([],{relativeTo:this._route,queryParams:{zone:a.id}}),201)},this.setBuilding=a=>this._org.building=a}ngOnInit(){var n=this;return(0,f.Z)(function*(){yield n._org.initialised.pipe((0,K.P)(t=>t)).toPromise(),n.subscription("route.query",n._route.queryParamMap.subscribe(t=>t.has("zone")?n._state.setLevel(t.get("zone")):""))})()}}B.\u0275fac=function(n){return new(n||B)(e.Y36($.w),e.Y36(P.c),e.Y36(X.F0),e.Y36(X.gz))},B.\u0275cmp=e.Xpm({type:B,selectors:[["explore-map-controls"]],features:[e.qOj],decls:5,vars:6,consts:function(){let i,n;return i=$localize`:␟dea1f8bc2b32584fadf07ef815709b946d3726ff␟1533056789917995243:Select Building...`,n=$localize`:␟025373b97845a8c2b54d2eb17d9c479f64207b11␟7854898325453225869:Select Level...`,[[1,"flex","space-x-2","w-full"],["overlay","","buildings","","class","flex-1 min-w-[10.5rem]","has-bld","true","appearance","outline",4,"ngIf"],["overlay","","levels","","class","flex-1 min-w-[10.25rem]","appearance","outline",4,"ngIf"],["overlay","","buildings","","has-bld","true","appearance","outline",1,"flex-1","min-w-[10.5rem]"],["placeholder",i,3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["overlay","","levels","","appearance","outline",1,"flex-1","min-w-[10.25rem]"],["placeholder",n,3,"ngModel","ngModelChange"]]},template:function(n,t){if(1&n&&(e.TgZ(0,"div",0),e.YNc(1,Ze,5,6,"mat-form-field",1),e.ALo(2,"async"),e.YNc(3,Ne,6,9,"mat-form-field",2),e.ALo(4,"async"),e.qZA()),2&n){let s,o;e.xp6(1),e.Q6J("ngIf",(null==(s=e.lcZ(2,2,t.buildings))?null:s.length)>1),e.xp6(2),e.Q6J("ngIf",null==(o=e.lcZ(4,4,t.levels))?null:o.length)}},dependencies:[h.sg,h.O5,ee.ey,Me.KE,Ie.gD,d.JJ,d.On,h.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.5rem}mat-form-field[has-bld=true][_ngcontent-%COMP%]{max-width:calc(50vw - 2.5rem)}[full][_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{max-width:calc(50% - 2.5rem)}\n/*# sourceMappingURL=explore-map-control.component.ts-angular-inline--75.css.map*/"]});var x=r(308),ke=r(3910),ve=r(6150),Re=r(73),de=r(4702),Ae=r(3159),be=r(6198),z=r(6888),E=(r(4922),r(6942)),we=r(9627),ae=r(5306);function $e(i,n){if(1&i&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"thermostat"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&i){const t=e.oxw();e.xp6(4),e.hij("",t.temp,"\u02daF")}}function Xe(i,n){if(1&i&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"opacity"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&i){const t=e.oxw();e.xp6(4),e.hij("",t.humidity,"%")}}function Be(i,n){1&i&&(e.TgZ(0,"div",5)(1,"app-icon",6),e._uU(2,"error"),e.qZA()())}class U{constructor(n){this._details=n,this.temp=this._details.temp||0,this.humidity=this._details.humidity||0}}U.\u0275fac=function(n){return new(n||U)(e.Y36(H.ui))},U.\u0275cmp=e.Xpm({type:U,selectors:[["explore-sensor-info"]],decls:4,vars:3,consts:[[1,"absolute","center","bg-white","rounded-lg","border","border-gray-300","p-2","text-xl"],["class","flex items-center space-x-2 whitespace-nowrap pr-2",4,"ngIf"],["class","absolute top-0 right-0 rounded-full translate-x-1/2 -translate-y-1/2 bg-white border border-gray-300",4,"ngIf"],[1,"flex","items-center","space-x-2","whitespace-nowrap","pr-2"],[1,""],[1,"absolute","top-0","right-0","rounded-full","translate-x-1/2","-translate-y-1/2","bg-white","border","border-gray-300"],[1,"text-error","text-xl"]],template:function(n,t){1&n&&(e.TgZ(0,"div",0),e.YNc(1,$e,5,1,"div",1),e.YNc(2,Xe,5,1,"div",1),e.YNc(3,Be,3,0,"div",2),e.qZA()),2&n&&(e.xp6(1),e.Q6J("ngIf",t.temp),e.xp6(1),e.Q6J("ngIf",t.humidity),e.xp6(1),e.Q6J("ngIf",t.temp>82))},dependencies:[h.O5,ae.o]});class N extends u.cx{constructor(n,t,s){super(),this._state=n,this._org=t,this._settings=s,this._statuses={},this._location={},this._capacity={},this._draw={},this._points={},this._features=[],this._bind=this._state.level.pipe((0,E.U)(o=>{if(!o)return;this._statuses={};let a=this._org.binding("area_management");if(!a)return;const l=(0,x.rTZ)(a,"AreaManagement").binding(`${o.id}:areas`);this.subscription("zones",l.listen().subscribe(c=>this.parseData(c))),this.subscription("binding",l.bind())})),this.init()}init(){var n=this;return(0,f.Z)(function*(){yield n._org.initialised.pipe((0,K.P)(s=>s)).toPromise();const t=yield Promise.all(n._org.levels.map(s=>(0,x.rlq)(s.id,"map_regions").toPromise()));for(const s of t){const o=s?.details?.areas;if(o)for(const a of o){const{capacity:l,hide_label:c,label_location:_,draw_polygon:p}=a.properties||{},{coordinates:m}=a.geometry||{};n._capacity[a.id]=l||100,n._location[a.id]=!1===c?_||(m?.length?Ce(m):null):null,n._draw[a.id]=!!p||n._settings.get("app.explore.use_zone_polygons"),n._points[a.id]=m||[]}}n.updateStatus(),n.subscription("bind",n._bind.subscribe())})()}parseData(n){const t=n?.value||[],s=[],o=[];for(const a of t){const l=a.count/(this._capacity[a.area_id]||100);if(this._statuses[a.area_id]=l<.4?"free":l<.75?"pending":"busy",!this._location[a.area_id])continue;let c="";a.count&&(c+=`${a.count||0} User Device${1===a.count?"":"s"}\n`),a.temperature&&(c+=`Temperature: ${a.temperature} \u02daC\n`),a.people_count>0&&(c+=`${a.people_count_sum} ${1===a.people_count_sum?"Person":"People"}\n`),a.humidity&&(c+=`Humidity: ${a.humidity}%\n`),a.queue_size&&(c+=`Queue Size: ${a.queue_size}%\n`),a.counter&&(c+=`Count: ${a.counter}\n`),s.push({location:this._location[a.area_id],content:c,z_index:100}),this._settings.get("app.explore.show_simple_sensor_info")&&(a.temperature||a.humidity)&&o.push({location:this._location[a.area_id],content:U,data:{temp:a.temperature,humidity:a.humidity},z_index:98})}this._features=o,this._settings.get("app.explore.show_simple_sensor_info")||this._state.setLabels("zones",s),this.updateStatus()}updateStatus(){const n={},t=[],s=this._settings.get("app.explore.colors")||{};for(const o in this._statuses){const a=s[`zone-${this._statuses[o]}`]||s[`${this._statuses[o]}`]||z.y[`${this._statuses[o]}`];this._draw[o]?t.push({track_id:`zone:${o}`,location:Ce(this._points[o]),content:we.i,data:{color:a,points:this._points[o]},z_index:10}):n[`#${o}`]={fill:a,opacity:.6}}this._state.setFeatures("zones",[...t,this._features]),this._state.setStyles("zones",n)}}function Ce(i){const n=(i||[]).reduce((t,[s,o])=>({x_min:s<t.x_min?s:t.x_min,x_max:s>t.x_max?s:t.x_max,y_min:o<t.y_min?o:t.y_min,y_max:o>t.y_max?o:t.y_max}),{x_min:100,x_max:-100,y_min:100,y_max:-100});return{x:n.x_min+(n.x_max-n.x_min)/2,y:n.y_min+(n.y_max-n.y_min)/2}}N.\u0275fac=function(n){return new(n||N)(e.LFG(P.c),e.LFG($.w),e.LFG(u.gb))},N.\u0275prov=e.Yz7({token:N,factory:N.\u0275fac});var L=r(1810),ze=r(6361),Ue=r(2317),le=r(3200),ue=r(312),v=r(4505),b=r(7716),M=r(9095),re=r(8759),k=r(9128),me=r(7418),Fe=r(8929),ce=r(354),De=r(9502),F=r(1484),Je=r(2306),Ye=r(1022),Ge=r(7303),Qe=r(9697);function je(i,n){1&i&&(e.TgZ(0,"div",7)(1,"div",8)(2,"label"),e._uU(3,"Host"),e.qZA(),e._UZ(4,"a-user-search-field",13),e.qZA()())}const Ve=function(){return{standalone:!0}};function qe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"main",5),e.YNc(1,je,5,0,"div",6),e.TgZ(2,"div",7)(3,"div",8)(4,"label"),e._uU(5,"Date"),e.qZA(),e.TgZ(6,"a-date-field",9),e._uU(7," Date and time must be in the future "),e.qZA()()(),e.TgZ(8,"div",7)(9,"div",10)(10,"label"),e._uU(11,"Start Time"),e.qZA(),e.TgZ(12,"a-time-field",11),e.NdJ("ngModelChange",function(o){e.CHM(t);const a=e.oxw();return e.KtG(a.form.patchValue({date:o}))}),e.qZA()(),e.TgZ(13,"div",10)(14,"label"),e._uU(15,"End Time"),e.qZA(),e._UZ(16,"a-duration-field",12),e.qZA()()()}if(2&i){const t=e.oxw();let s;e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",t.host),e.xp6(5),e.Q6J("to",t.book_until),e.xp6(6),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(9,Ve)),e.xp6(4),e.Q6J("time",null==(s=t.form.get("date"))?null:s.value)("max",720)("min",60)("step",60)}}class D{constructor(n){this._data=n,this.host=this._data.host,this.form=new d.cw({user:new d.NI(this._data.user),date:new d.NI(this._data.date),duration:new d.NI(this._data.duration)}),this.book_until=this._data.until}}D.\u0275fac=function(n){return new(n||D)(e.Y36(F.WI))},D.\u0275cmp=e.Xpm({type:D,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-gray-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModel","ngModelOptions","ngModelChange"],["formControlName","duration",3,"time","max","min","step"],["formControlName","user"]],template:function(n,t){1&n&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2,"Set date and time"),e.qZA(),e.TgZ(3,"button",1)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.YNc(6,qe,17,10,"main",2),e.TgZ(7,"footer",3)(8,"button",4),e._uU(9," Continue "),e.qZA()()),2&n&&(e.xp6(6),e.Q6J("ngIf",t.form),e.xp6(2),e.Q6J("mat-dialog-close",t.form.value))},dependencies:[h.O5,ae.o,ee.wG,F.ZT,d.JJ,d.JL,d.On,d.sg,d.u,Je.Q,Ye.B,Ge.N,Qe.d]});var he=r(9136),fe=r(3970);function We(i,n){if(1&i&&(e.TgZ(0,"p",9),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.user)}}function He(i,n){if(1&i&&(e.TgZ(0,"p",10),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.department," ")}}function Ke(i,n){if(1&i&&(e.TgZ(0,"p",11),e._uU(1),e.ALo(2,"date"),e.ALo(3,"date"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE(" ",e.xi3(2,2,t.start,"shortTime")," \u2013 ",e.xi3(3,5,t.end,"shortTime")," ")}}function et(i,n){if(1&i&&(e.TgZ(0,"div",2),e._UZ(1,"div",3),e.TgZ(2,"div",4)(3,"h4",5),e._uU(4),e.qZA(),e.YNc(5,We,2,1,"p",6),e.YNc(6,He,2,1,"p",7),e.YNc(7,Ke,4,8,"p",8),e.qZA()()),2&i){const t=e.oxw();e.Tol("absolute rounded bg-white dark:bg-neutral-800 p-4 top-0 left-0 shadow pointer-events-none "+t.x_pos+" "+t.y_pos),e.Q6J("id",t.map_id),e.xp6(4),e.hij(" ",t.name||t.map_id||t.id," "),e.xp6(1),e.Q6J("ngIf",t.user),e.xp6(1),e.Q6J("ngIf",t.user&&t.department),e.xp6(1),e.Q6J("ngIf",t.start)}}class J{constructor(n,t){this._details=n,this._element=t,this.id=this._details.id,this.map_id=this._details.map_id,this.name=this._details.name,this.user=this._details.user,this.start=this._details.start,this.end=this._details.end,this.status=this._details.status,this.department=this._details.department}ngOnInit(n=0){n>10||setTimeout(()=>{const t=this._element.nativeElement.parentElement?.parentElement;if(!t)return this.ngOnInit(++n);const s_y=parseInt(t.style.top,10)/100,s_x=parseInt(t.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"right":"left"},200)}get available_until(){return""}}J.\u0275fac=function(n){return new(n||J)(e.Y36(he.u),e.Y36(e.SBq))},J.\u0275cmp=e.Xpm({type:J,selectors:[["explore-desk-info"]],decls:3,vars:10,consts:[["customTooltip","",1,"h-full","w-full","pointer-events-auto","relative",3,"content","backdrop","xPosition","yPosition","hover","delay"],["desk_tooltip",""],["name","space-info",3,"id"],[1,"arrow"],[1,"details"],["map-id","",1,"m-0","font-medium"],["user","","class","mt-2 text-sm",4,"ngIf"],["user","","class","mt-1 text-sm",4,"ngIf"],["start","","class","mt-1 text-sm",4,"ngIf"],["user","",1,"mt-2","text-sm"],["user","",1,"mt-1","text-sm"],["start","",1,"mt-1","text-sm"]],template:function(n,t){if(1&n&&(e._UZ(0,"div",0),e.YNc(1,et,8,7,"ng-template",null,1,e.W1O)),2&n){const s=e.MAs(2);e.ekj("hidden","free"===t.status),e.Q6J("content",s)("backdrop",!1)("xPosition","center")("yPosition","center")("hover",!0)("delay",3e3),e.uIk("id",t.id)("map_id",t.map_id)}},dependencies:[h.O5,fe.X,h.uU],styles:["[name=space-info][_ngcontent-%COMP%]{width:16rem}[name=status][_ngcontent-%COMP%]{background-color:#43a047;font-weight:500}[name=status].busy[_ngcontent-%COMP%]{background-color:#e53935}[name=status].pending[_ngcontent-%COMP%]{background-color:#ffb300}[name=status].not-bookable[_ngcontent-%COMP%]{background-color:#757575}\n/*# sourceMappingURL=explore-desk-info.component.ts-angular-inline--76.css.map*/"]});var tt=r(9380),nt=r(1361);function ot(i,n){if(1&i&&(e.TgZ(0,"p",17)(1,"label"),e.SDv(2,18),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.mac," ")}}function it(i,n){if(1&i&&(e.TgZ(0,"p",19)(1,"label"),e.SDv(2,20),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.manufacturer," ")}}function at(i,n){if(1&i&&(e.TgZ(0,"p",21)(1,"label"),e.SDv(2,22),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.os," ")}}function lt(i,n){if(1&i&&(e.TgZ(0,"p",23)(1,"label"),e.SDv(2,24),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.ssid," ")}}function rt(i,n){if(1&i&&(e.TgZ(0,"p",25)(1,"label"),e.SDv(2,26),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function ct(i,n){if(1&i&&(e.TgZ(0,"p",27)(1,"label"),e.SDv(2,28),e.qZA(),e._uU(3),e.qZA()),2&i){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.user.type," ")}}function _t(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",6),e.NdJ("mouseleave",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.close())}),e._UZ(1,"div",7),e.TgZ(2,"div",8),e.YNc(3,ot,4,1,"p",9),e.TgZ(4,"p")(5,"label"),e.SDv(6,10),e.qZA(),e._uU(7),e.qZA(),e.TgZ(8,"p")(9,"label"),e.SDv(10,11),e.qZA(),e._uU(11),e.qZA(),e.YNc(12,it,4,1,"p",12),e.YNc(13,at,4,1,"p",13),e.YNc(14,lt,4,1,"p",14),e.YNc(15,rt,4,1,"p",15),e.YNc(16,ct,4,1,"p",16),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.xp6(4),e.hij(" ",t.variance,"m"),e.xp6(4),e.hij(" ",t.last_seen,""),e.xp6(1),e.Q6J("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.xp6(1),e.Q6J("ngIf",t.os&&!t.hide_fields.includes("os")),e.xp6(1),e.Q6J("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.xp6(1),e.Q6J("ngIf",t.username&&!t.hide_fields.includes("username")),e.xp6(1),e.Q6J("ngIf",t.user&&!t.hide_fields.includes("user"))}}const pt=[];class Y extends u.cx{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||pt}get last_seen(){return(0,tt.Z)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,nt.Z)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(n,t,s){super(),this._details=n,this._settings=t,this._element=s,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(n=0){n>10||setTimeout(()=>{const t=this._element.nativeElement.parentElement?.parentElement;if(!t)return this.ngOnInit(++n);const s_y=parseInt(t.style.top,10)/100,s_x=parseInt(t.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(o=>this.zoom=o))},200)}loadUser(){var n=this;return(0,f.Z)(function*(){if(n.username)return;const t=(0,x.rTZ)(n._details.system,"LocationServices");if(!t)return;n.username="Loading...";const s=yield t.execute("check_ownership_of",[n.mac]).catch(o=>null);n.username=s&&s.assigned_to?s.assigned_to:""})()}}Y.\u0275fac=function(n){return new(n||Y)(e.Y36(he.u),e.Y36(u.gb),e.Y36(e.SBq))},Y.\u0275cmp=e.Xpm({type:Y,selectors:[["","explore-device-info",""]],features:[e.qOj],attrs:["explore-device-info",""],decls:7,vars:9,consts:function(){let i,n,t,s,o,a,l,c;return i=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,n=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,t=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,s=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,o=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,a=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,l=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,c=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["name","radius",1,"radius","absolute","center","bg-blue-600","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-black/40","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["dot",""],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"content","backdrop","xPosition","yPosition","hover","mouseenter"],["device_tooltip",""],["name","device-info",1,"w-64","rounded","bg-white","dark:bg-neutral-800","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],i,n,["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],t,["type",""],s,["os",""],o,["ssid",""],a,["username",""],l,["user",""],c]},template:function(n,t){if(1&n&&(e._UZ(0,"div",0)(1,"div",1)(2,"div",2,3),e.TgZ(4,"div",4),e.NdJ("mouseenter",function(){return t.loadUser()}),e.qZA(),e.YNc(5,_t,17,8,"ng-template",null,5,e.W1O)),2&n){const s=e.MAs(6);e.Akn("height: "+t.diameter+"%; width: "+t.diameter+"%;"),e.xp6(2),e.Udp("background-color",t.bg_color),e.xp6(2),e.Q6J("content",s)("backdrop",!1)("xPosition",t.x_pos)("yPosition",t.y_pos)("hover",!0)}},dependencies:[h.O5,fe.X],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}\n/*# sourceMappingURL=explore-device-info.component.ts-angular-inline--77.css.map*/"]});class I extends u.cx{constructor(n,t,s,o,a){super(),this._state=n,this._org=t,this._settings=s,this._bookings=o,this._dialog=a,this._in_use=new v.X([]),this._options=new v.X({}),this._presence=new v.X([]),this._signs_of_life=new v.X([]),this._statuses={},this._users={},this._departments={},this._poll=new v.X(0),this._checked_in=new v.X([]),this._desk_bookings=(0,b.aj)([this._state.level,this._poll]).pipe((0,M.w)(([l])=>(0,ce.F2)({period_start:(0,L.Z)((0,ze.Z)(new Date)),period_end:(0,L.Z)((0,Ue.Z)(new Date,60)),type:"desk",zones:l.id})),(0,re.b)(l=>{this._users={},this._departments={},l.forEach(c=>{const _=this._settings.get("app.department_map")||{};this._users[c.asset_id]=c.user_name,this._departments[c.asset_id]=_[c.extension_data.department]||""})}),(0,k.d)(1)),this.desk_list=this._state.level.pipe((0,M.w)(l=>(0,x.rlq)(l.id,"desks").pipe((0,E.U)(c=>(c.details instanceof Array?c.details:[]).map(_=>new De.n({..._,zone:l}))))),(0,me.K)(l=>[]),(0,k.d)(1)),this._bind=this._state.level.pipe((0,E.U)(l=>{if(this._statuses={},this.unsubWith("lvl"),!l)return;const c=this._org.binding("area_management");if(!c)return;let _=(0,x.rTZ)(c,"AreaManagement").binding(l.id);this.subscription("lvl-in_use",_.listen().subscribe(p=>this.processBindingChange(p||{},c))),this.subscription("lvl-in_use_bind",_.bind())})),this._state_change=(0,b.aj)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this._options]).pipe((0,E.U)(([l,c,_,p,m])=>{this._statuses={};for(const{id:g,bookable:w}of l){const O=c.some(y=>g===y),q=_.some(y=>g===y),se=m.some(y=>g===y),W=p.some(y=>g===y);this._statuses[g]=w?O||q||W?q||W?"busy":"pending":se?"signs-of-life":"free":"not-bookable"}this.processDesks(l)})),this.init()}init(){var n=this;return(0,f.Z)(function*(){yield n._org.initialised.pipe((0,K.P)(t=>t)).toPromise(),n.setOptions({enable_booking:!1!==n._settings.get("app.desks.enable_maps")}),n.subscription("bind",n._bind.subscribe()),n.subscription("changes",n._state_change.subscribe()),n.subscription("desks",n.desk_list.subscribe(t=>n.processDesks(t)))})()}startPolling(n=1e4){return this.subscription("desks_in_use_bookings",this._desk_bookings.subscribe(t=>{const s=t.filter(o=>!(o.rejected||o.deleted||"ended"===o.extension_data.current_state||o.is_done));this._in_use.next(s.map(o=>o.asset_id)),this._checked_in.next(s.filter(o=>o.checked_in).map(o=>o.asset_id))})),this.interval("poll",()=>this._poll.next((new Date).valueOf()),n),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setOptions(n){this._options.next({...this._options.getValue(),...n})}processBindingChange({value:n},t){const s=(n||[]).filter(l=>!["desk","booking"].includes(l.location)),o=(n||[]).filter(l=>"desk"===l.location||"booking"===l.location&&"desk"===l.type);this._presence.next(o.filter(l=>l.at_location).map(l=>l.map_id||l.asset_id)),this._signs_of_life.next(o.filter(l=>l.signs_of_life).map(l=>l.map_id||l.asset_id));const a=this._settings.get("app.department_map")||{};for(const l of o)this._users[l.map_id]=l.staff_name,this._departments[l.map_id]=a[l.department]||"";this.processDevices(s,t),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const n={},t=this._settings.get("app.explore.colors")||{};for(const s in this._statuses)this._statuses[s]&&(n[`#${s}`]={fill:t[`desk-${this._statuses[s]}`]||t[`${this._statuses[s]}`]||z.y[`${this._statuses[s]}`]});this._state.setStyles("desks",n)}processDevices(n,t){const s=[];for(const o of n){const a=o.x/o.map_width,l=o.y/o.map_height;s.push({track_id:`device:hover:${a},${l}`,location:{x:o.coordinates_from?.includes("right")?1-a:a,y:o.coordinates_from?.includes("bottom")?1-l:l},content:Y,z_index:20,data:{...o,system:t}})}this._state.setFeatures("devices",s)}processDesks(n){var t=this;const s=[],o=[],a=this._options.getValue();for(const l of n){if(s.push({track_id:`desk:hover:${l.map_id||l.id}`,location:l.id,content:J,full_size:!0,no_scale:!0,data:{id:l.map_id||l.id,map_id:l.name,name:l.name||l.map_id,user:this._users[l.map_id]||l.staff_name,status:this._statuses[l.map_id],department:this._departments[l.map_id]||""},z_index:20}),!l.bookable)continue;const c=function(){var _=(0,f.Z)(function*(){if("free"!==t._statuses[l.id])return(0,u.cB)(`${l.name} is unavailable at this time.`);t._bookings.newForm(),t._bookings.setOptions({type:"desk"});const{date:p,duration:m,user:g}=yield t._setBookingTime(t._bookings.form.value.date,t._bookings.form.value.duration,t._options.getValue()?.custom??!1);t._bookings.form.patchValue({asset_id:l.id,asset_name:l.name,date:p,duration:m,map_id:l?.map_id||l?.id,description:l.name,user:g||a.host||(0,u.ar)(),booking_type:"desk",zones:l.zone?[l.zone?.parent_id,l.zone?.id]:[]}),yield t._bookings.confirmPost(),t._users[l.map_id]=(a.host||(0,u.ar)())?.name,(0,u.t5)(`Successfully booked desk ${l.name||l.id}`)});return function(){return _.apply(this,arguments)}}();o.push({id:l.id,action:"click",callback:c}),o.push({id:l.id,action:"touchend",callback:c})}this._state.setActions("desks",this._options.getValue().enable_booking?o:[]),this._state.setFeatures("desks",s),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(n,t,s=!1){var o=this;return(0,f.Z)(function*(){let a=null;if(o._settings.get("app.desks.allow_time_changes")){const l=(0,le.Z)((0,ue.Z)(Date.now(),o._settings.get("app.desks.available_period")||90)),_=yield o._dialog.open(D,{data:{date:n,duration:t,until:l,host:s}}).afterClosed().toPromise();if(!_)throw"User cancelled";n=_.date,t=_.duration,a=_.user}return{date:n,duration:t,user:a}})()}}I.\u0275fac=function(n){return new(n||I)(e.LFG(P.c),e.LFG($.w),e.LFG(u.gb),e.LFG(Fe.f),e.LFG(F.uw))},I.\u0275prov=e.Yz7({token:I,factory:I.\u0275fac});var _e=r(9377),dt=r(5845),ut=r(4350);class R extends u.cx{constructor(n,t,s){super(),this._org=n,this._state=t,this._settings=s,this._options=new v.X({date:(0,_e.Z)(Date.now()).valueOf()}),this._poll=new v.X(0),this.options=this._options.asObservable(),this.levels=this._org.active_levels.pipe((0,E.U)(o=>o.filter(a=>a.tags.includes("parking")))),this.events=(0,b.aj)([this._org.active_building,this._options,this._poll]).pipe((0,M.w)(([o,a])=>(0,ce.F2)({period_start:(0,L.Z)((0,_e.Z)(a.date)),period_end:(0,L.Z)((0,le.Z)(a.date)),type:"parking",zones:o?.id})),(0,k.d)(1)),this.existing_event=(0,b.aj)([this._options]).pipe((0,M.w)(([o])=>(0,ce.F2)({period_start:(0,L.Z)((0,_e.Z)(o.date)),period_end:(0,L.Z)((0,le.Z)(o.date)),type:"parking",email:o?.user||(0,u.ar)()?.email})),(0,k.d)(1)),this.week_events=(0,b.aj)([this._org.active_building,this._options]).pipe((0,M.w)(([o,a])=>(0,ce.F2)({period_start:(0,L.Z)((0,_e.Z)(a.date)),period_end:(0,L.Z)((0,ue.Z)((0,le.Z)(a.date),6)),type:"parking",zones:o?.id})),(0,k.d)(1)),this.spaces=this.levels.pipe((0,M.w)(o=>(0,ut.D)(o.map(a=>(0,x.rlq)(a.id,"parking-spaces").pipe((0,E.U)(l=>l.details.map(c=>({...c,zone_id:a.id}))))))),(0,E.U)(o=>(0,u.xH)(o)),(0,k.d)(1)),this.available_spaces=(0,b.aj)([this.events,this.spaces,this._state.level]).pipe((0,E.U)(([o,a,l])=>a.filter(c=>c.zone_id===l?.id&&!o.find(_=>_.asset_id===c.id)))),this.week_availablility=(0,b.aj)([this.week_events,this.spaces,this._options]).pipe((0,E.U)(([o,a,{date:l}])=>{const c={};for(let _=0;_<7;_++){const p=(0,ue.Z)(l,_),m=o.filter(g=>(0,dt.Z)(p,g.date));c[p.valueOf()]=a.filter(g=>!m.find(w=>w.asset_id===g.id)).length}return c})),this.subscription("spaces",(0,b.aj)([this.spaces,this.available_spaces]).subscribe(([o,a])=>this._updateParkingSpaces(o,a))),this.interval("poll",()=>this._poll.next(Date.now()),1e4)}setOptions(n){this._options.next({...this._options.getValue(),...n})}_updateParkingSpaces(n,t){console.log("Spaces:",n,t);const s={},o=[],a=this._settings.get("app.explore.colors")||{};for(const l of n){const c=!!t.find(p=>p.id===l.id),_=c?"free":"busy";s[`#${l.map_id}`]={fill:a[`parking-${_}`]||a[`${_}`]||z.y[`${_}`],opacity:.6},c&&o.push({location:`${l.map_id}`,content:`${l.name}\nFree`})}this._state.setStyles("parking",s),this._state.setLabels("parking",o)}}R.\u0275fac=function(n){return new(n||R)(e.LFG($.w),e.LFG(P.c),e.LFG(u.gb))},R.\u0275prov=e.Yz7({token:R,factory:R.\u0275fac});var mt=r(7121),ht=r(9151),ge=r(4139),ft=r(6221),gt=r(800);class G{constructor(n){this._data=n,this.bank=this._data.bank,this.lockers=this._data.lockers.reduce((t,s)=>(t[s.id]="busy",t),{})}}function Et(i,n){if(1&i&&(e.TgZ(0,"div",3)(1,"h3",4),e._uU(2),e.qZA(),e.TgZ(3,"p",5),e._uU(4),e.qZA()()),2&i){const t=e.oxw();e.Tol("absolute rounded bg-white dark:bg-neutral-800 p-4 top-0 left-0 shadow pointer-events-none "+t.x_pos+" "+t.y_pos),e.Q6J("id",t.map_id),e.xp6(2),e.Oqu(t.bank.name),e.xp6(2),e.AsE(" ",t.in_use_count," lockers in use of ",t.bank.lockers.length||1," ")}}G.\u0275fac=function(n){return new(n||G)(e.Y36(F.WI))},G.\u0275cmp=e.Xpm({type:G,selectors:[["explore-locker-bank-modal"]],decls:8,vars:3,consts:[[1,"text-xl","font-medium"],["btn","","icon","","matRipple","","mat-dialog-close",""],[1,"h-[65vh]","overflow-hidden"],[3,"bank","bank_status"]],template:function(n,t){1&n&&(e.TgZ(0,"header")(1,"h2",0),e._uU(2),e.qZA(),e.TgZ(3,"button",1)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.TgZ(6,"main",2),e._UZ(7,"locker-grid",3),e.qZA()),2&n&&(e.xp6(2),e.Oqu(t.bank.name),e.xp6(5),e.Q6J("bank",t.bank)("bank_status",t.lockers))},dependencies:[ae.o,ee.wG,F.ZT,gt.V]});class Q{constructor(n,t,s){this._details=n,this._element=t,this._dialog=s,this.bank=this._details.bank,this.in_use_count=this._details.in_use_count}ngOnInit(n=0){n>10||setTimeout(()=>{const t=this._element.nativeElement.parentElement?.parentElement;if(!t)return this.ngOnInit(++n);const s_y=parseInt(t.style.top,10)/100,s_x=parseInt(t.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"right":"left"},200)}openBankModal(){this._dialog.open(G,{data:{...this._details}})}}Q.\u0275fac=function(n){return new(n||Q)(e.Y36(H.ui),e.Y36(e.SBq),e.Y36(F.uw))},Q.\u0275cmp=e.Xpm({type:Q,selectors:[["explore-locker-bank-info"]],decls:4,vars:6,consts:[[1,"h-full","w-full","pointer-events-auto","relative",3,"click"],["customTooltip","",1,"h-full","w-full","pointer-events-auto","relative",3,"content","backdrop","xPosition","yPosition","hover","delay"],["desk_tooltip",""],["name","space-info",3,"id"],[1,"font-medium"],[1,"whitespace-nowrap","text-sm"]],template:function(n,t){if(1&n&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return t.openBankModal()}),e._UZ(1,"div",1),e.qZA(),e.YNc(2,Et,5,6,"ng-template",null,2,e.W1O)),2&n){const s=e.MAs(3);e.xp6(1),e.Q6J("content",s)("backdrop",!1)("xPosition","center")("yPosition","center")("hover",!0)("delay",3e3)}},dependencies:[fe.X]});class A extends u.cx{constructor(n,t,s,o){super(),this._lockers=n,this._explore=t,this._org=s,this._settings=o,this._status=new v.X([]),this.lockers$=this._lockers.filtered_lockers$,this.status=(0,b.aj)([this._org.active_building,this._explore.level]).pipe((0,E.U)(([a,l])=>{if(!l)return[];const c=this._org.binding("area_management");if(!c)return(0,ge.of)({});let _=(0,x.rTZ)(c,"AreaManagement").binding(l.id);this.subscription("lvl-in_use",_.listen().subscribe(p=>this._status.next(p.filter(m=>"locker"===m.location)))),this.subscription("lvl-in_use_bind",_.bind())})),this.locker_status=(0,b.aj)([this._explore.level,this._lockers.lockers_banks$,this.lockers$,this._status]).pipe((0,E.U)(([a,l,c,_])=>{const p=[],m={},g=this._settings.get("app.explore.colors")||{},w=(0,u.Tw)(l.filter(O=>O.level_id===a.id).map(O=>O.id));for(const O of w){const q=c.filter(oe=>oe.bank_id===O);let se=0;for(const oe of q)se+=_.find(Te=>Te.locker_id===oe.id&&Te.allocated)?1:0;const W=l.find(oe=>oe.id===O);p.push({location:W.map_id,content:Q,full_size:!0,no_scale:!0,z_index:20,data:{bank:W,lockers:c,in_use_count:se,locker_count:q.length,system:this._org.binding("area_management")}});const y=se/q.length,xe=y>.8?"busy":y>.3?"pending":"free";m[`#${W.map_id}`]={fill:g[`lockers-${xe}`]||g[`${xe}`]||z.y[`${xe}`]}}console.log("Features:",p),this._explore.setStyles("lockers",m),this._explore.setFeatures("lockers",p)})),console.log("ExploreLockersService"),this.subscription("level",this._explore.level.pipe((0,ht.h)(a=>!!a)).subscribe(a=>this._lockers.setLevel(a.id))),this.subscription("status",this.status.subscribe()),this.subscription("locker_status",this.locker_status.subscribe())}}A.\u0275fac=function(n){return new(n||A)(e.LFG(mt.A),e.LFG(P.c),e.LFG(ft.w7),e.LFG(u.gb))},A.\u0275prov=e.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"});var Oe=r(8461);function xt(i,n){if(1&i&&(e.TgZ(0,"div",3),e._UZ(1,"div",12),e.TgZ(2,"div",13),e._uU(3),e.qZA()()),2&i){const t=n.$implicit;e.xp6(1),e.Udp("background-color",t[1]),e.xp6(2),e.Oqu(t[0])}}function vt(i,n){if(1&i&&(e.TgZ(0,"div",8)(1,"h3",9),e.SDv(2,10),e.qZA(),e.YNc(3,xt,4,3,"div",11),e.qZA()),2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.legend)}}const bt=[];class te extends u.cx{toggleZones(n){var t=this;return(0,f.Z)(function*(){const s=yield t.options.pipe((0,ke.q)(1)).toPromise(),o=n?s.disable?.filter(a=>"zones"!==a&&"devices"!==a)||[]:(0,u.Tw)([...s.disable||[],"zones","devices"]);t.setOptions({disable:o})})()}get show_legend(){return!!this._settings.get("app.explore.show_legend")}get legend(){return this._settings.get("app.explore.legend")||bt}constructor(n,t,s,o,a,l,c,_,p,m,g,w){super(),this._state=n,this._s=t,this._desks=s,this._zones=o,this._parking=a,this._lockers=l,this._route=c,this._router=_,this._spaces=p,this._org=m,this._settings=g,this._space_pipe=w,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options,this.message=this._state.message,this.setOptions=O=>this._state.setOptions(O)}ngOnInit(){var n=this;return(0,f.Z)(function*(){n._state.reset(),yield n._spaces.initialised.pipe((0,K.P)(t=>t)).toPromise(),n.toggleZones(!1),n.subscription("desks",n._desks.startPolling()),n.subscription("route.query",n._route.queryParamMap.subscribe(function(){var t=(0,f.Z)(function*(s){if(s.has("level")&&n._state.setLevel(s.get("level")),n._state.setFeatures("_located",[]),s.has("space"))n.locateSpace(s.get("space"));else if(s.has("user")){let o=n._settings.value("last_search");if((!o||s.get("user")!==o.email)&&(o=null,o=yield(0,ve.w0)(s.get("user")).toPromise()),!o)return(0,u.cB)(`Unable to user details for ${s.get("user")}`);n.locateUser(o instanceof Array?o[0]:o).catch(a=>{console.error(a),(0,u.cB)(`Unable to locate ${s.get("user")}`),n._router.navigate([],{relativeTo:n._route,queryParams:{}})})}else s.has("locate")?n._locateFeature(s.get("locate"),s.get("name")):n.timeout("update_location",()=>{n._state.setFeatures("_located",[])})});return function(s){return t.apply(this,arguments)}}()))})()}updateZoom(n){this._state.setPositions(n,this._state.positions.center)}updateCenter(n){this._state.setPositions(this._state.positions.zoom,n)}_locateFeature(n,t=""){const s=n.includes(","),o=n.split(","),a={track_id:`locate-${n}`,location:s?{x:parseFloat(o[0]),y:parseFloat(o[1])}:n,content:de.q,z_index:99,data:{message:t}};this.timeout("update_location",()=>this._state.setFeatures("_located",[a]))}locateSpace(n){var t=this;return(0,f.Z)(function*(){const s=yield t._space_pipe.transform(n);if(!s)return(0,u.cB)("Unable to load space details.");t._state.setLevel(t._org.levelWithID(s.zones)?.id);const o={track_id:`locate-${s.id}`,location:s.map_id,content:de.q,z_index:99,data:{message:`${s.display_name||s.name} is here`}};t.timeout("update_location",()=>t._state.setFeatures("_located",[o]))})()}locateUser(n){var t=this;return(0,f.Z)(function*(){let s=t._org.binding("location_services");if(!s)throw"Location services is not setup for this application.";"string"==typeof s&&(s={system_id:s,module:"LocationServices",priority:[]});const a=(yield(0,x.rTZ)(s.system_id,s.module).execute("locate_user",[n.email,n.username||n.id])).map(p=>new ve.Y(p));if(a.sort((p,m)=>s.priority.indexOf(p.type)-s.priority.indexOf(m.type)),!a?.length)throw"No locations for the given user";t._state.setLevel(t._org.levelWithID([a[0]?.level])?.id);const l=a[0].position,{coordinates_from:c}=a[0],_={track_id:`locate-${n.id}`,location:"wireless"===a[0].type?{x:c?.includes("right")?1-l.x:l.x,y:c?.includes("bottom")?1-l.y:l.y}:l,content:"wireless"===a[0].type?Ae.n:de.q,z_index:99,data:{message:`${n.name} is here`,radius:a[0].variance,last_seen:a[0].last_seen}};t.timeout("update_location",()=>{t._state.setFeatures("_located",[_])})})()}}te.\u0275fac=function(n){return new(n||te)(e.Y36(P.c),e.Y36(z.a),e.Y36(I),e.Y36(N),e.Y36(R),e.Y36(A),e.Y36(X.gz),e.Y36(X.F0),e.Y36(Re.s),e.Y36($.w),e.Y36(u.gb),e.Y36(be.X))},te.\u0275cmp=e.Xpm({type:te,selectors:[["explore-map-view"]],features:[e._Bn([z.a,I,N,R,A,be.X]),e.qOj],decls:17,vars:25,consts:function(){let i,n;return i=$localize`:␟dab9a30ea9f109a7395ec84fe144c4f70d50c32d␟4377629928032707348:Zones`,n=$localize`:␟5c5419db944ed6a96f9515a2ac0ee390ec8cf3b5␟7297822327994766046:Legend`,[[3,"src","zoom","center","styles","features","actions","labels","zoomChange","centerChange"],[1,"absolute","bottom-2","right-2"],["controls","",1,"absolute","top-2","left-2","max-w-[calc(100vw-1rem)]","bg-white","dark:bg-neutral-800","border","border-gray-200","dark:border-neutral-500","rounded","p-2","space-y-2","overflow-hidden"],[1,"flex","items-center","space-x-2"],["name","zones",1,"ml-2",3,"ngModel","ngModelChange"],["for","zones",1,"mb-0"],i,["legend","","class","absolute bottom-2 left-2 p-2 rounded bg-white dark:bg-neutral-800 border border-gray-300",4,"ngIf"],["legend","",1,"absolute","bottom-2","left-2","p-2","rounded","bg-white","dark:bg-neutral-800","border","border-gray-300"],[1,"mb-2","font-medium"],n,["class","flex items-center space-x-2",4,"ngFor","ngForOf"],[1,"w-3","h-3","rounded-full","border","border-gray-400"],[1,"text-sm"]]},template:function(n,t){if(1&n&&(e.TgZ(0,"i-map",0),e.NdJ("zoomChange",function(o){return t.updateZoom(o)})("centerChange",function(o){return t.updateCenter(o)}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.qZA(),e._UZ(8,"explore-zoom-controls",1),e.TgZ(9,"div",2),e._UZ(10,"explore-map-controls"),e.TgZ(11,"div",3)(12,"mat-slide-toggle",4),e.NdJ("ngModelChange",function(o){return t.toggleZones(o)}),e.ALo(13,"async"),e.qZA(),e.TgZ(14,"label",5),e.SDv(15,6),e.qZA()()(),e.YNc(16,vt,4,1,"div",7)),2&n){let s,o,a;e.Q6J("src",e.lcZ(1,9,t.url))("zoom",null==(s=e.lcZ(2,11,t.positions))?null:s.zoom)("center",null==(o=e.lcZ(3,13,t.positions))?null:o.center)("styles",e.lcZ(4,15,t.styles))("features",e.lcZ(5,17,t.features))("actions",e.lcZ(6,19,t.actions))("labels",e.lcZ(7,21,t.labels)),e.xp6(12),e.Q6J("ngModel",!(null!=(a=e.lcZ(13,23,t.options))&&null!=a.disable&&a.disable.includes("zones"))),e.xp6(4),e.Q6J("ngIf",t.show_legend&&t.legend.length)}},dependencies:[h.sg,h.O5,he.p,d.JJ,d.On,ie.Rr,B,Oe.s,h.Ov],styles:["[_nghost-%COMP%]{height:100%;width:100%}[zones][_ngcontent-%COMP%]{top:3.5rem}\n/*# sourceMappingURL=explore-map-view.component.ts-angular-inline--78.css.map*/"]});var ye=r(823),Ct=r(656),Ot=r(9012);class j{constructor(n,t){this._org=n,this._settings=t,this._emergency_contacts=new v.X([]),this._filter=new v.X(""),this._loading=new v.X(!1),this.emergency_contacts=this._emergency_contacts.asObservable(),this._user_search=this._filter.pipe((0,ye.b)(400),(0,re.b)(()=>this._loading.next(!0)),(0,M.w)(s=>s?.length>2?this.search_fn(s):(0,ge.of)([])),(0,me.K)(()=>[])),this._space_search=this._filter.pipe((0,ye.b)(400),(0,re.b)(()=>this._loading.next(!0)),(0,M.w)(s=>s?.length>2?(0,x.vIL)({q:s,zone_id:this._org.organisation.id}).pipe((0,E.U)(({data:o})=>o.filter(a=>a.map_id).map(a=>new Ct.T({...a,level:this._org.levelWithID(a.zones)})))):(0,ge.of)([])),(0,me.K)(()=>[])),this.search_results=(0,b.aj)([this._space_search,this._user_search,this._emergency_contacts,this._filter]).pipe((0,E.U)(([s,o,a,l])=>{const c=l.toLowerCase(),_=(0,u.Tw)([...s.filter(p=>p.email.toLowerCase().includes(c)||p.name.toLowerCase().includes(c)||p.display_name.toLowerCase().includes(c)).map(p=>({id:p.id,type:"space",name:p.display_name||p.name,description:`Capacity: ${p.capacity} `})),...a.map(p=>({id:p.email,type:p.type||"contact",name:p.name,description:p.email})).filter(p=>p.name.toLowerCase().includes(c)||p.description.toLowerCase().includes(c)||p.type.toLowerCase().includes(c)),...o.map(p=>({id:p.email,type:"user",name:p.name,description:p.email}))],"id");return _.sort((p,m)=>p.name.localeCompare(m.name)),_}),(0,re.b)(()=>this._loading.next(!1)),(0,k.d)(1)),this.loading=this._loading.asObservable(),this.search_fn=s=>this._settings.get("app.basic_user_search")?(0,x.E4d)({q:s,authority_id:(0,x.N9E)()?.id}).pipe((0,E.U)(o=>o.data)):(0,Ot.VE)(s),this.search_results.subscribe(),this.init()}init(){var n=this;return(0,f.Z)(function*(){yield n._org.initialised.pipe((0,K.P)(o=>o)).toPromise();let t=n._org.binding("location_services");if(!t)return;const s=(0,x.rTZ)(t,"LocationServices");if(s){const o=s.binding("emergency_contacts");o.listen().subscribe(a=>{const l=[];for(const c in a)for(const _ of a[c])l.push({..._,type:c});n._emergency_contacts.next(l)}),o.bind()}})()}setFilter(n){this._filter.next(n)}}j.\u0275fac=function(n){return new(n||j)(e.LFG($.w),e.LFG(u.gb))},j.\u0275prov=e.Yz7({token:j,factory:j.\u0275fac,providedIn:"root"});var yt=r(4618),Ee=r(8550),Tt=r(1708);const Lt=["input"];function Mt(i,n){1&i&&e._UZ(0,"mat-spinner",9),2&i&&e.Q6J("diameter",32)}function It(i,n){1&i&&(e.TgZ(0,"mat-option",12),e.SDv(1,13),e.qZA())}function St(i,n){if(1&i&&(e.TgZ(0,"mat-option",14)(1,"div",15)(2,"div",16)(3,"div",17),e._uU(4),e.qZA(),e.TgZ(5,"div",18),e._uU(6),e.qZA()(),e.TgZ(7,"div",19),e._uU(8),e.qZA()()()),2&i){const t=n.$implicit;e.Q6J("value",t),e.xp6(4),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij(" ",t.type," ")}}function Zt(i,n){if(1&i&&(e.ynx(0),e.YNc(1,It,2,0,"mat-option",10),e.ALo(2,"async"),e.YNc(3,St,9,4,"mat-option",11),e.ALo(4,"slice"),e.ALo(5,"async"),e.BQk()),2&i){const t=e.oxw();let s;e.xp6(1),e.Q6J("ngIf",!(null!=(s=e.lcZ(2,2,t.results))&&s.length)),e.xp6(2),e.Q6J("ngForOf",e.Dn7(4,4,e.lcZ(5,8,t.results),0,5))}}class ne extends u.cx{checkClick(n){this._el?.nativeElement?.contains(n.target)||(this.show=!1,this._input_el?.nativeElement?.blur())}constructor(n,t,s,o){super(),this._el=n,this._search=t,this._router=s,this._route=o,this.show=!1,this.search_str="",this.results=this._search.search_results,this.loading=this._search.loading,this.setFilter=a=>this._search.setFilter(a),this.setItem=a=>a instanceof Object?this.select(a):this.setFilter(a),this.onTouch=a=>this.checkClick(a)}showSearch(){this.show=!0,this._input_el?.nativeElement&&this.timeout("focus",()=>this._input_el.nativeElement.focus(),300)}closeSearch(n){this.show=!1,this.search_str="",this.setFilter(""),this._input_el?.nativeElement&&(this._input_el.nativeElement.focus(),this._input_el.nativeElement.blur())}select(n){this.search_str=n.name;const t={};t["space"===n.type?"space":"feature"===n.type?"feature":"user"]=n.id,this._router.navigate([],{relativeTo:this._route,queryParams:t})}}ne.\u0275fac=function(n){return new(n||ne)(e.Y36(e.SBq),e.Y36(j),e.Y36(X.F0),e.Y36(X.gz))},ne.\u0275cmp=e.Xpm({type:ne,selectors:[["explore-search"]],viewQuery:function(n,t){if(1&n&&e.Gf(Lt,5),2&n){let s;e.iGM(s=e.CRH())&&(t._input_el=s.first)}},hostBindings:function(n,t){1&n&&e.NdJ("click",function(o){return t.checkClick(o)},!1,e.evT)("touchstart",function(o){return t.onTouch(o)},!1,e.evT)},features:[e.qOj],decls:13,vars:12,consts:function(){let i,n;return i=$localize`:␟7a428104a6c33787961fda306f9c518f89fb0261␟6939663044582448373:Search for...`,n=$localize`:␟0c720c4e60410fcfcd8582a32297bdd397620830␟3411517965707112535: No matches found `,[["role","search","tabindex","0","matRipple","",1,"bg-white","m-2","flex","items-center","z-10","relative","overflow-hidden","outline-none"],["tabindex","0",1,"text-2xl","outline-none",3,"click"],["keyboard","","placeholder",i,1,"flex-1","text-base","border-none","outline-none",3,"ngModel","matAutocomplete","matAutocompleteConnectedTo","ngModelChange","blur"],["input",""],["class","mr-2",3,"diameter",4,"ngIf"],["matAutocompleteOrigin","",1,"absolute","bottom-0","left-8","right-8","min-w-[20rem]"],["origin","matAutocompleteOrigin"],["auto","matAutocomplete"],[4,"ngIf"],[1,"mr-2",3,"diameter"],["class","pointer-events-none",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none"],n,[3,"value"],[1,"flex","items-center","leading-tight"],[1,"flex-1","overflow-hidden"],[1,"truncate","w-full"],[1,"text-xs"],[1,"text-xs","font-bold","p-2","capitalize","text-white","bg-gray-500","rounded"]]},template:function(n,t){if(1&n&&(e.TgZ(0,"div",0)(1,"app-icon",1),e.NdJ("click",function(o){return t.show?t.closeSearch(o):t.showSearch()}),e._uU(2),e.qZA(),e.TgZ(3,"input",2,3),e.NdJ("ngModelChange",function(o){return t.search_str=o})("ngModelChange",function(o){return t.setItem(o)})("blur",function(){return t.show=!!t.search_str}),e.qZA(),e.YNc(5,Mt,1,1,"mat-spinner",4),e.ALo(6,"async"),e._UZ(7,"div",5,6),e.qZA(),e.TgZ(9,"mat-autocomplete",null,7),e.YNc(11,Zt,6,10,"ng-container",8),e.ALo(12,"async"),e.qZA()),2&n){const s=e.MAs(8),o=e.MAs(10);e.ekj("show",t.show||t.search_str),e.xp6(2),e.hij(" ",t.show||t.search_str?"close":"search"," "),e.xp6(1),e.Q6J("ngModel",t.search_str)("matAutocomplete",o)("matAutocompleteConnectedTo",s),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,8,t.loading)),e.xp6(6),e.Q6J("ngIf",!0!==e.lcZ(12,10,t.loading)&&(t.show||t.search_str))}},dependencies:[h.sg,h.O5,ae.o,yt.U,Ee.XC,ee.ey,Ee.ZL,Ee.BU,ee.wG,Tt.Ou,d.Fj,d.JJ,d.On,h.Ov,h.OU],styles:["[_nghost-%COMP%]{z-index:99}[role=search][_ngcontent-%COMP%]{height:3.125rem;width:3.125rem;border-radius:1.5rem;border:1px solid #ccc;transition:width .2s}app-icon[_ngcontent-%COMP%]{margin:.55rem}[role=search].show[_ngcontent-%COMP%]{width:32rem;max-width:calc(100vw - 1rem);border-color:#1e88e5}\n/*# sourceMappingURL=explore-search.component.ts-angular-inline--79.css.map*/"]}),r(9275),r(1718),r(3496);class V{}V.\u0275fac=function(n){return new(n||V)},V.\u0275mod=e.oAB({type:V}),V.\u0275inj=e.cJS({imports:[h.ez,H.Kk,d.u5,d.UX,ie.rP,S.U8,Z.eL,C.W,T.E]})},8461:(Le,pe,r)=>{r.d(pe,{s:()=>S});var h=r(6667),d=r(2560),H=r(5306),ie=r(207);class S{constructor(C){this._state=C,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}}S.\u0275fac=function(C){return new(C||S)(d.Y36(h.c))},S.\u0275cmp=d.Xpm({type:S,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:function(){let Z,C,T;return Z=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,C=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,T=$localize`:␟77981432124895c410e5b9157b3deb948831ffc6␟5016012668378976433:Reset Zoom & Center`,[["z-in","","icon","","matRipple","","matTooltip",Z,1,"bg-white","dark:bg-neutral-800",3,"click"],["z-out","","icon","","matRipple","","matTooltip",C,1,"bg-white","dark:bg-neutral-800",3,"click"],["reset","","icon","","matRipple","","matTooltip",T,1,"bg-white","dark:bg-neutral-800",3,"click"]]},template:function(C,T){1&C&&(d.TgZ(0,"button",0),d.NdJ("click",function(){return T.zoomIn()}),d.TgZ(1,"app-icon"),d._uU(2,"add"),d.qZA()(),d.TgZ(3,"button",1),d.NdJ("click",function(){return T.zoomOut()}),d.TgZ(4,"app-icon"),d._uU(5,"remove"),d.qZA()(),d.TgZ(6,"button",2),d.NdJ("click",function(){return T.reset()}),d.TgZ(7,"app-icon"),d._uU(8,"autorenew"),d.qZA()())},dependencies:[H.o,ie.wG],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}button[_ngcontent-%COMP%]{border:1px solid #9998;border-radius:0}button[_ngcontent-%COMP%]:first-child{border-radius:.25rem .25rem 0 0;border-bottom:none}button[_ngcontent-%COMP%]:last-child{border-radius:0 0 .25rem .25rem;border-top:none}\n/*# sourceMappingURL=explore-zoom-control.component.ts-angular-inline--80.css.map*/"]})}}]);
//# sourceMappingURL=default-libs_explore_src_index_ts.js.map