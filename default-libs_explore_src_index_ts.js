"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["default-libs_explore_src_index_ts"],{23685:(me,q,c)=>{c.d(q,{vz:()=>pe,XU:()=>de,Oe:()=>G.O,Rp:()=>Ut});var y=c(60316),h=c(34456),A=c(46815),U=c(8827),ee=c(81570),Y=c(9168),V=c(481),ie=c(49478),v=c(89204),m=c(77375),b=c(57871),T=c(45762),G=c(12455),e=c(7404),Z=(c(26842),c(85060)),ae=c(24950);c(25175);var O=c(3998),te=c(33602),J=(c(68390),c(7401),c(71865),c(95384),c(22011),c(65897)),N=c(8627),I=c(35443),X=c(19803),ne=c(69434),le=c(22238),R=c(90521),M=c(42175);c(37558);var W=c(56441),H=c(99908),ye=c(33240),xe=c(28797),$=c(71536),S=c(71963),D=c(29314),L=c(7841),oe=c(66e3),Ce=c(18379),We=c(47451),se=c(12587),He=c(19608),Ie=c(83476),Qe=c(81413),Oe=c(18e3);const qe=()=>({standalone:!0});function et(i,f){if(1&i&&(e.j41(0,"div",7)(1,"div",13)(2,"label"),e.EFF(3,"Resource:"),e.k0s(),e.j41(4,"div",14),e.EFF(5),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(5),e.SpI(" ",t.resource.name||t.resource.map_id||"Unknown Resource"," ")}}function tt(i,f){1&i&&(e.j41(0,"div",7)(1,"div",8)(2,"label"),e.EFF(3,"Host"),e.k0s(),e.nrm(4,"a-user-search-field",15),e.k0s()())}function st(i,f){if(1&i){const t=e.RV6();e.j41(0,"main",5),e.DNE(1,et,6,1,"div",6)(2,tt,5,0,"div",6),e.j41(3,"div",7)(4,"div",8)(5,"label"),e.EFF(6,"Date"),e.k0s(),e.j41(7,"a-date-field",9),e.EFF(8," Date and time must be in the future "),e.k0s()()(),e.j41(9,"div",7)(10,"div",10)(11,"label"),e.EFF(12,"Start Time"),e.k0s(),e.j41(13,"a-time-field",11),e.bIt("ngModelChange",function(s){e.eBV(t);const o=e.XpG();return e.Njj(o.form.patchValue({date:s}))}),e.k0s()(),e.j41(14,"div",10)(15,"label"),e.EFF(16,"End Time"),e.k0s(),e.nrm(17,"a-duration-field",12),e.k0s()()()}if(2&i){let t;const n=e.XpG();e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("ngIf",n.resource),e.R7$(),e.Y8G("ngIf",n.host),e.R7$(5),e.Y8G("to",n.book_until),e.R7$(6),e.Y8G("ngModel",n.form.value.date)("ngModelOptions",e.lJ4(12,qe))("use_24hr",n.use_24hr_time),e.R7$(4),e.Y8G("time",null==(t=n.form.get("date"))?null:t.value)("max",600)("min",60)("step",60)("use_24hr",n.use_24hr_time)}}let ce=(()=>{class i{get use_24hr_time(){return this._settings.get("app.use_24_hour_time")}constructor(t,n){this._data=t,this._settings=n,this.host=this._data.host,this.form=new h.gE({user:new h.MJ(this._data.user),date:new h.MJ(this._data.date),duration:new h.MJ(this._data.duration)}),this.book_until=this._data.until,this.resource=this._data.resource}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(se.Vh),e.rXU(m.h$))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-base-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModelChange","ngModel","ngModelOptions","use_24hr"],["formControlName","duration",3,"time","max","min","step","use_24hr"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4","mb-2"],[1,"px-4","py-3","border","border-base-200","rounded","w-full","mb-4"],["formControlName","user",1,"mb-4"]],template:function(n,s){1&n&&(e.j41(0,"header",0)(1,"h2"),e.EFF(2,"Set date and time"),e.k0s(),e.j41(3,"button",1)(4,"app-icon"),e.EFF(5,"close"),e.k0s()()(),e.DNE(6,st,18,13,"main",2),e.j41(7,"footer",3)(8,"button",4),e.EFF(9," Continue "),e.k0s()()),2&n&&(e.R7$(6),e.Y8G("ngIf",s.form),e.R7$(2),e.Y8G("mat-dialog-close",s.form.value))},dependencies:[y.bT,ne.R,Z.r6,se.tx,h.BC,h.cb,h.vS,h.j4,h.JD,He.G,Ie.y,Qe.t,Oe.$]})}return i})();var Me=c(82882),nt=c(78578),ot=c(1874),Te=c(24918);const it=["explore-device-info",""];function at(i,f){if(1&i&&(e.j41(0,"p",23)(1,"label"),e.pXf(2,4),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.mac," ")}}function rt(i,f){if(1&i&&(e.j41(0,"p",24)(1,"label"),e.pXf(2,5),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.manufacturer," ")}}function lt(i,f){if(1&i&&(e.j41(0,"p",25)(1,"label"),e.pXf(2,6),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.os," ")}}function ct(i,f){if(1&i&&(e.j41(0,"p",26)(1,"label"),e.pXf(2,7),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.ssid," ")}}function _t(i,f){if(1&i&&(e.j41(0,"p",27)(1,"label"),e.pXf(2,8),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function pt(i,f){if(1&i&&(e.j41(0,"p",28)(1,"label"),e.pXf(2,9),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.user.type," ")}}function dt(i,f){if(1&i){const t=e.RV6();e.j41(0,"div",14),e.bIt("mouseleave",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.close())}),e.nrm(1,"div",15),e.j41(2,"div",16),e.DNE(3,at,4,1,"p",17),e.j41(4,"p")(5,"label"),e.pXf(6,2),e.k0s(),e.EFF(7),e.k0s(),e.j41(8,"p")(9,"label"),e.pXf(10,3),e.k0s(),e.EFF(11),e.k0s(),e.DNE(12,rt,4,1,"p",18)(13,lt,4,1,"p",19)(14,ct,4,1,"p",20)(15,_t,4,1,"p",21)(16,pt,4,1,"p",22),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(3),e.Y8G("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.R7$(4),e.SpI(" ",t.variance,"m"),e.R7$(4),e.SpI(" ",t.last_seen,""),e.R7$(),e.Y8G("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.R7$(),e.Y8G("ngIf",t.os&&!t.hide_fields.includes("os")),e.R7$(),e.Y8G("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.R7$(),e.Y8G("ngIf",t.username&&!t.hide_fields.includes("username")),e.R7$(),e.Y8G("ngIf",t.user&&!t.hide_fields.includes("user"))}}const ut=[];let Re=(()=>{class i extends m.Tv{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||ut}get last_seen(){return(0,nt.m)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,ot.o)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(t,n,s){super(),this._details=t,this._settings=n,this._element=s,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(t=0){t>10||setTimeout(()=>{const n=this._element.nativeElement.parentElement?.parentElement;if(!n)return this.ngOnInit(++t);const s_y=parseInt(n.style.top,10)/100,s_x=parseInt(n.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(o=>this.zoom=o))},200)}loadUser(){var t=this;return(0,v.A)(function*(){if(t.username)return;const n=(0,O.f_4)(t._details.system,"LocationServices");if(!n)return;t.username="Loading...";const s=yield n.execute("check_ownership_of",[t.mac]).catch(o=>null);t.username=s&&s.assigned_to?s.assigned_to:""})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(Te.N),e.rXU(m.h$),e.rXU(e.aKT))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["","explore-device-info",""]],features:[e.Vt3],attrs:it,decls:7,vars:9,consts:()=>{let t,n,s,o,a,l,r,_;return t=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,n=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,s=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,o=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,a=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,l=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,r=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,_=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["dot",""],["device_tooltip",""],t,n,s,o,a,l,r,_,["name","radius",1,"radius","absolute","center","bg-info","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-neutral","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"mouseenter","content","backdrop","xPosition","yPosition","hover"],["name","device-info",1,"w-64","rounded","bg-base-100","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],["type",""],["os",""],["ssid",""],["username",""],["user",""]]},template:function(n,s){if(1&n){const o=e.RV6();e.nrm(0,"div",10)(1,"div",11)(2,"div",12,0),e.j41(4,"div",13),e.bIt("mouseenter",function(){return e.eBV(o),e.Njj(s.loadUser())}),e.k0s(),e.DNE(5,dt,17,8,"ng-template",null,1,e.C5r)}if(2&n){const o=e.sdS(6);e.Aen("height: "+s.diameter+"%; width: "+s.diameter+"%;"),e.R7$(2),e.xc7("background-color",s.bg_color),e.R7$(2),e.Y8G("content",o)("backdrop",!1)("xPosition",s.x_pos)("yPosition",s.y_pos)("hover",!0)}},dependencies:[y.bT,le.I],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}\n\n/*# sourceMappingURL=explore-device-info.component.ts-angular-inline--105.css.map*/"]})}return i})();var _e=c(18026);let pe=(()=>{class i extends m.Tv{constructor(t,n,s,o,a){var l;super(),l=this,this._state=t,this._org=n,this._settings=s,this._bookings=o,this._dialog=a,this._in_use=new R.t([]),this._options=new R.t({}),this._presence=new R.t([]),this._signs_of_life=new R.t([]),this._statuses={},this._users={},this._departments={},this._checked_in=new R.t([]),this.booking_rules=this._org.active_building.pipe((0,N.p)(r=>!!r),(0,S.n)(r=>(0,O.bpY)(r.id,"desk_booking_rules").pipe((0,D.W)(()=>(0,$.of)({details:[]})))),(0,I.T)(r=>r?.details instanceof Array?r.details:[]),(0,L.t)(1)),this.desk_list=this._state.level.pipe((0,X.B)(50),(0,S.n)(r=>(0,O.bpY)(r.id,"desks").pipe((0,D.W)(()=>(0,$.of)({details:[]})),(0,I.T)(_=>(_?.details instanceof Array?_.details:[]).map(p=>new We.g({...p,zone:r}))))),(0,D.W)(r=>[]),(0,L.t)(1)),this._bind=(0,M.zV)([this._state.level,this._state.options]).pipe((0,X.B)(300),(0,N.p)(([r,{is_public:_}])=>!!r&&!_),(0,I.T)(([r])=>{this._statuses={};const _=this._org.binding("area_management");if(!_)return;let p=(0,O.f_4)(_,"AreaManagement")?.binding(r.id);p&&(this.subscription("lvl-in_use",p.listen().subscribe(g=>this.processBindingChange(g||{},_))),this.subscription("lvl-in_use_bind",p.bind()))})),this._booking_list=(0,M.zV)([this._options,this._state.level]).pipe((0,N.p)(([r,_])=>(r.use_api||r.date>(0,W.D)(Date.now()).valueOf())&&!!_),(0,S.n)(([r,_])=>(0,_e.tj)({type:"desk",period_start:(0,H._)((0,ye.o)(r.date||Date.now())),period_end:(0,H._)((0,W.D)(r.date||Date.now())),zones:_.id})),(0,X.B)(200),(0,oe.M)(r=>{this._in_use.next(r.map(_=>_.asset_id)),this._checked_in.next(r.filter(_=>_.checked_in).map(_=>_.asset_id))}),(0,L.t)(1)),this._state_change=(0,M.zV)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this.booking_rules,this._options]).pipe((0,X.B)(50),(0,I.T)(function(){var r=(0,v.A)(function*([_,p,g,x,u,C]){l._statuses={};const d=yield l._state.level.pipe((0,te.s)(1)).toPromise();for(const{id:E,bookable:j}of _){const F=p.some(k=>E===k),w=g.some(k=>E===k),B=u.some(k=>E===k),z=x.some(k=>E===k)||F&&l._settings.get("app.desk.auto_checkin"),Q=(0,m.RH)({date:Date.now(),duration:60,host:(0,m.Ny)(),resource:{id:E,zones:[d.parent_id,d.id]}},C)?.hidden;l._statuses[E]=j&&!Q?F||w||z?w||z?"busy":"pending":B?"signs-of-life":"free":"not-bookable"}l.processDesks(_)});return function(_){return r.apply(this,arguments)}}())),this.init()}init(){var t=this;return(0,v.A)(function*(){yield t._org.initialised.pipe((0,b.$)(n=>n)).toPromise(),t.setOptions({enable_booking:!1!==t._settings.get("app.desks.enable_maps")}),t.subscription("bookings",t._booking_list.subscribe()),t.subscription("bind",t._bind.subscribe()),t.subscription("booking_rules",t.booking_rules.subscribe()),t.subscription("changes",t._state_change.subscribe()),t.subscription("desks",t.desk_list.subscribe(n=>t.processDesks(n)))})()}setOptions(t){this._options.next({...this._options.getValue(),...t})}processBindingChange({value:t},n){const s=(t||[]).filter(r=>!["desk","booking"].includes(r.location)),o=(t||[]).filter(r=>"desk"===r.location||"booking"===r.location&&"desk"===r.type);(this._options.getValue().date||Date.now())<=(0,W.D)(Date.now()).valueOf()&&!this._options.getValue().use_api&&(this._in_use.next(o.filter(r=>"booking"===r.location).map(r=>r.map_id||r.asset_id)),this._checked_in.next(o.filter(r=>"booking"===r.location&&r.checked_in).map(r=>r.map_id||r.asset_id)),this._presence.next(o.filter(r=>r.at_location).map(r=>r.map_id||r.asset_id)),this._signs_of_life.next(o.filter(r=>r.signs_of_life).map(r=>r.map_id||r.asset_id)));const l=this._settings.get("app.department_map")||{};for(const r of o)this._users[r.map_id||r.asset_id]=r.staff_name,this._departments[r.map_id||r.asset_id]=l[r.department]||"";this.processDevices(s,n),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},n=this._settings.get("app.explore.colors")||{};for(const s in this._statuses)this._statuses[s]&&(t[`#${s}`]={fill:n[`desk-${this._statuses[s]}`]||n[`${this._statuses[s]}`]||J.U[`${this._statuses[s]}`]});this._state.setStyles("desks",t)}processDevices(t,n){const s=[];for(const o of t){const a=o.x/o.map_width,l=o.y/o.map_height;s.push({track_id:`device:hover:${a},${l}`,location:{x:o.coordinates_from?.includes("right")?1-a:a,y:o.coordinates_from?.includes("bottom")?1-l:l},content:Re,z_index:20,data:{...o,system:n}})}this._state.setFeatures("devices",s)}processDesks(t){var n=this;const s=[],o=[],a=this._options.getValue();for(const l of t){if(s.push({track_id:`desk:hover:${l.map_id||l.id}`,location:l.id,content:Me.Y,full_size:!0,no_scale:!0,data:{id:l.map_id||l.id,map_id:l.name,name:l.name||l.map_id,user:this._users[l.map_id]||l.staff_name,status:this._statuses[l.map_id],department:this._departments[l.map_id]||""},z_index:20}),!l.bookable)continue;let r=!0;const _=function(){var p=(0,v.A)(function*(){if(!r)return;if("free"!==n._statuses[l.id])return(0,m.UG)(`${l.name||"Desk"} is unavailable at this time.`);if(l.groups?.length&&!l.groups.find(d=>(0,m.Ny)().groups.includes(d)))return(0,m.UG)(`You are not allowed to book ${l.name}.`);n._bookings.newForm(),n._bookings.setOptions({type:"desk"}),a.date&&(n._bookings.form.patchValue({date:a.date}),n._bookings.form.patchValue({all_day:!!a.all_day}));let{date:g,duration:x,user:u}=yield n._setBookingTime(n._bookings.form.value.date,n._bookings.form.value.duration,n._options.getValue()?.custom??!1,l);u=u||a.host||(0,m.Ny)();const C=u?.email;n._bookings.form.patchValue({resources:[l],asset_id:l.id,asset_name:l.name,date:g,duration:a.all_day?720:x,map_id:l?.map_id||l?.id,description:l.name,user:u,user_email:C,booking_type:"desk",zones:l.zone?[l.zone?.parent_id,l.zone?.id]:[]}),yield n._bookings.confirmPost().catch(d=>{throw console.log(d),(0,m.UG)(`Failed to book desk ${l.name||l.id}. ${d.message||d.error||d}`),d}),n._users[l.map_id]=(a.host||(0,m.Ny)())?.name,(0,m.VX)(`Successfully booked desk ${l.name||l.id}`)});return function(){return p.apply(this,arguments)}}();["mousedown","touchstart"].forEach(p=>o.push({id:l.id,action:p,priority:10,callback:()=>{r=!0,this.timeout("booking",()=>r=!1)}})),["mouseup","touchend"].forEach(p=>o.push({id:l.id,action:p,priority:10,callback:_}))}this._state.setActions("desks",this._options.getValue().enable_booking?o:[]),this._state.setFeatures("desks",s),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(t,n,s=!1,o=null){var a=this;return(0,v.A)(function*(){let l=null;if(a._settings.get("app.desks.allow_time_changes")){const r=(0,W.D)((0,xe.f)(Date.now(),a._settings.get("app.desks.available_period")||90)),p=yield a._dialog.open(ce,{data:{date:t,duration:n,until:r,host:s,resource:o}}).afterClosed().toPromise();if(!p)throw"User cancelled";t=p.date,n=p.duration,l=p.user}return{date:t,duration:n,user:l}})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.KVO(G.O),e.KVO(T.y),e.KVO(m.h$),e.KVO(Ce.n),e.KVO(se.bZ))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac})}return i})();var mt=c(23206),ht=c(5469),ft=c(68757);function gt(i,f){if(1&i&&(e.j41(0,"div",7)(1,"div",8),e.EFF(2," Plate Number "),e.k0s(),e.j41(3,"div",9),e.EFF(4),e.k0s()()),2&i){const t=e.XpG();e.R7$(4),e.SpI(" ",t.plate_number||"ABC3"," ")}}let Se=(()=>{class i{get is_concierge(){return this._settings.app_name.toLowerCase().includes("concierge")}constructor(t,n,s){this._data=t,this._element=n,this._settings=s,this.status=this._data.assigned_to===this._data.user&&this._data.user?"reserved":this._data.status,this.user=this._data.user,this.name=this._data.name,this.map_id=this._data.map_id,this.plate_number=this._data.plate_number}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(A.Nw),e.rXU(e.aKT),e.rXU(m.h$))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["explore-parking-info"]],decls:9,vars:15,consts:[[1,"absolute","bg-base-300","p-2","rounded-lg","!rounded-tl-none","shadow","top-1/2","left-1/2","text-left"],[1,"absolute","top-0.5","left-0.5","triangle"],[1,"flex","space-x-2"],[1,"flex","flex-col","leading-tight","min-w-24","pl-1"],[1,"whitespace-nowrap"],[1,"capitalize","text-sm","font-medium"],["class","flex flex-col relative h-full px-2 rounded bg-base-100 text-base-content shadow leading-tight",4,"ngIf"],[1,"flex","flex-col","relative","h-full","px-2","rounded","bg-base-100","text-base-content","shadow","leading-tight"],[1,"text-[0.625rem]","w-full","text-center","pt-1","whitespace-nowrap","font-medium"],[1,"font-mono","pb-1","w-full","text-center","uppercase"]],template:function(n,s){1&n&&(e.j41(0,"div",0),e.nrm(1,"div",1),e.j41(2,"div",2)(3,"div",3)(4,"div",4),e.EFF(5),e.k0s(),e.j41(6,"div",5),e.EFF(7),e.k0s()(),e.DNE(8,gt,5,1,"div",6),e.k0s()()),2&n&&(e.AVh("!bg-error","busy"===s.status)("!text-error-content","busy"===s.status)("!bg-warning","reserved"===s.status)("!text-warning-content","reserved"===s.status)("!bg-success","free"===s.status)("!text-success-content","free"===s.status),e.R7$(5),e.JRh(s.name),e.R7$(2),e.SpI(" ",s.status," "),e.R7$(),e.Y8G("ngIf",s.is_concierge&&s.plate_number))},dependencies:[y.bT],styles:[".triangle[_ngcontent-%COMP%]{width:0px;height:0px;border-style:solid;border-width:.5rem .5rem 0 0;border-color:currentColor transparent transparent transparent;transform:rotate(0)}\n\n/*# sourceMappingURL=explore-parking-info.component.ts-angular-inline--106.css.map*/"]})}return i})();var bt=c(1593);let de=(()=>{class i extends m.Tv{constructor(t,n,s,o,a,l){super(),this._org=t,this._state=n,this._settings=s,this._bookings=o,this._parking=a,this._dialog=l,this._options=new R.t({}),this._poll=new R.t(0),this.options=this._options.asObservable(),this.on_book=null,this.levels=this._org.active_levels.pipe((0,I.T)(r=>r.filter(_=>_.tags.includes("parking")))),this.events=(0,M.zV)([this._org.active_building,this._options,this._poll,this._state.options]).pipe((0,X.B)(300),(0,S.n)(([r,_,p,{is_public:g}])=>g?(0,$.of)([]):(0,_e.tj)({period_start:(0,H._)((0,mt.c)(_.date||Date.now())),period_end:(0,H._)((0,ht.V)(_.date||Date.now())),type:"parking",zones:this._settings.get("app.use_region")?r?.parent_id:r?.id})),(0,L.t)(1)),this.user_events=(0,M.zV)([this._options]).pipe((0,S.n)(([r])=>(0,_e.tj)({period_start:(0,H._)((0,ye.o)(r.date||Date.now())),period_end:(0,H._)((0,W.D)(r.date||Date.now())),type:"parking",email:r?.user||(0,m.Ny)()?.email})),(0,L.t)(1)),this.spaces=this.levels.pipe((0,S.n)(r=>(0,ft.p)(r.map(_=>(0,O.bpY)(_.id,"parking-spaces").pipe((0,I.T)(p=>(p.details instanceof Array?p.details:[]).map(g=>({...g,zone_id:_.id}))))))),(0,I.T)(r=>(0,m.Bq)(r)),(0,L.t)(1)),this.active_spaces=(0,M.zV)([this.spaces,this._state.level]).pipe((0,I.T)(([r,_])=>r.filter(p=>p.zone_id===_.id))),this._users={},this._plate_numbers={},this.available_spaces=(0,M.zV)([this.events,this.active_spaces,this._parking.users]).pipe((0,I.T)(([r,_,p])=>{const g=_.filter(x=>{const u=r.find(E=>E.asset_id===x.id),C=`${u?.user_email||x.assigned_to||""}`.toLowerCase(),d=p.find(E=>E.email.toLowerCase()===C.toLowerCase());return this._users[x.id]=C,this._plate_numbers[x.id]=u?.extension_data?.plate_number||d?.plate_number||void 0,!C});return this._updateParkingSpaces(_,g),g})),this.subscription("spaces",this.available_spaces.subscribe()),this.setOptions({enable_booking:!1!==this._settings.get("app.parking.enable_maps")})}startPolling(){return this.interval("poll",()=>this._poll.next(Date.now()),1e4),this._poll.next(Date.now()),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setOptions(t){this._options.next({...this._options.getValue(),...t})}_updateParkingSpaces(t,n){var s=this;return(0,v.A)(function*(){const o={},a=[],l=[],r=s._settings.get("app.explore.colors")||{};let _=s._options.getValue();yield s._parking.assigned_space.pipe((0,te.s)(1)).toPromise();const g=yield s._parking.deny_parking_access.pipe((0,te.s)(1)).toPromise(),x=yield s._parking.booked_space.pipe((0,te.s)(1)).toPromise();for(const u of t){const C=!!n.find(F=>F.id===u.id),d=!!u.assigned_to,E=C?"free":d?"pending":"busy";if(o[`#${u.map_id}`]={fill:r[`parking-${E}`]||r[`${E}`]||J.U[`${E}`],opacity:.6},a.push({location:`${u.map_id}`,content:Se,z_index:20,hover:!0,data:{...u,user:s._users[u.id],plate_number:s._plate_numbers[u.id],status:"pending"===E&&d?"reserved":E}}),!C)continue;const j=function(){var F=(0,v.A)(function*(){if(s.on_book)return yield s.on_book(u),void s._poll.next(Date.now());if(g)return(0,m.UG)(`Your user account has been denied parking access to ${u.zone?.display_name||u.zone?.name}.`);if(d)return(0,m.UG)(`You are already assigned to parking space "${u.name||u.id}".`);if(x?.find(P=>P.id===u.id))return(0,m.UG)("You already have a parking space booked for the selected time.");if("free"!==E)return(0,m.UG)(`${u.name||"Parking Space"} is unavailable at this time.`);if(u.groups?.length&&!u.groups.find(P=>(0,m.Ny)().groups.includes(P)))return(0,m.UG)(`You are not allowed to book ${u.name}.`);s._bookings.newForm(),s._bookings.setOptions({type:"parking"}),_=s._options.getValue(),_.date&&(s._bookings.form.patchValue({date:_.date}),s._bookings.form.patchValue({all_day:!!_.all_day}));let{date:w,duration:B,user:z}=yield s._setBookingTime(s._bookings.form.value.date,s._bookings.form.value.duration,s._options.getValue()?.custom??!1,u);z=z||_.host||(0,m.Ny)();const Q=z?.email,k=s._state.active_level;s._bookings.form.patchValue({resources:[u],asset_id:u.id,asset_name:u.name,date:w,duration:_.all_day?720:B,map_id:u?.map_id||u?.id,description:u.name,user:z,user_email:Q,booking_type:"parking",zones:u.zone?[u.zone?.parent_id,u.zone?.id]:[k.parent_id,k.id]}),yield s._bookings.confirmPost().catch(P=>{throw"User cancelled"===P||(0,m.UG)(`Failed to book parking space ${u.name||u.id}. ${P.message||P.error||P}`),P}),(0,m.VX)(`Successfully booked parking space ${u.name||u.id}`),s._poll.next(Date.now())});return function(){return F.apply(this,arguments)}}();l.push({id:u?.map_id||u?.id,action:"click",priority:10,callback:j})}s._state.setActions("parking",_.enable_booking?l:[]),s._state.setStyles("parking",o),s._state.setFeatures("parking",a)})()}_setBookingTime(t,n,s=!1,o=null){var a=this;return(0,v.A)(function*(){let l=null;if(a._settings.get("app.parking.allow_time_changes")){const r=(0,W.D)((0,xe.f)(Date.now(),a._settings.get("app.parking.available_period")||90)),p=yield a._dialog.open(ce,{data:{date:t,duration:n,until:r,host:s,resource:o}}).afterClosed().toPromise();if(!p)throw"User cancelled";t=p.date,n=p.duration,l=p.user}return{date:t,duration:n,user:l}})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.KVO(T.y),e.KVO(G.O),e.KVO(m.h$),e.KVO(Ce.n),e.KVO(bt.w),e.KVO(se.bZ))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac})}return i})();c(98796),c(12185),c(84810),c(99420),c(30735),c(2372),c(75080),c(79771);var Ne=c(41134),Xe=c(48303),Fe=(c(69801),c(76301)),jt=(c(72213),c(50795),c(93208)),At=c(87984);let Ut=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.$C({type:i});static#s=this.\u0275inj=e.G2t({imports:[y.MD,A.hI,h.YN,h.X1,U.mV,ee.z_,Y.jc,V.c,ie.S]})}return i})();e.wjB(Xe.x,[y.Sq,y.bT,le.I,jt.U],[]),e.wjB(Fe.t,[y.bT,ne.R,ae.rl,ae.TL,Z.r6,se.tx,At.fg,Ne.LG,h.me,h.BC,h.cb,h.j4,h.JD,Ie.y,Oe.$],[y.Jj,y.vh])},69801:(me,q,c)=>{c.d(q,{l:()=>Y});var y=c(12455),h=c(7404),A=c(69434),U=c(85060),ee=c(80640);let Y=(()=>{class V{constructor(v){this._state=v,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}static#e=this.\u0275fac=function(m){return new(m||V)(h.rXU(y.O))};static#t=this.\u0275cmp=h.VBU({type:V,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:()=>{let v,m,b;return v=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,m=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,b=$localize`:␟77981432124895c410e5b9157b3deb948831ffc6␟5016012668378976433:Reset Zoom & Center`,[["z-in","","icon","","matRipple","","matTooltip",v,1,"bg-base-100",3,"click"],["z-out","","icon","","matRipple","","matTooltip",m,1,"bg-base-100",3,"click"],["reset","","icon","","matRipple","","matTooltip",b,1,"bg-base-100",3,"click"]]},template:function(m,b){1&m&&(h.j41(0,"button",0),h.bIt("click",function(){return b.zoomIn()}),h.j41(1,"app-icon"),h.EFF(2,"add"),h.k0s()(),h.j41(3,"button",1),h.bIt("click",function(){return b.zoomOut()}),h.j41(4,"app-icon"),h.EFF(5,"remove"),h.k0s()(),h.j41(6,"button",2),h.bIt("click",function(){return b.reset()}),h.j41(7,"app-icon"),h.EFF(8,"autorenew"),h.k0s()())},dependencies:[A.R,U.r6,ee.oV],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}button[_ngcontent-%COMP%]{border:1px solid #9998;border-radius:0}button[_ngcontent-%COMP%]:first-child{border-radius:.25rem .25rem 0 0;border-bottom:none}button[_ngcontent-%COMP%]:last-child{border-radius:0 0 .25rem .25rem;border-top:none}\n\n/*# sourceMappingURL=explore-zoom-control.component.ts-angular-inline--109.css.map*/"]})}return V})()},68390:(me,q,c)=>{c.d(q,{g8:()=>ee,kR:()=>y.k,Gp:()=>Y.Gp,KJ:()=>Y.KJ,N8:()=>v.N8,SZ:()=>v.SZ,is:()=>ie.is});var y=c(73850),U=(c(11543),c(44621),c(99908));class ee{constructor(b={}){this.type=b.type||b.location||"other",this.position=b.position||b.map_id||b.asset_id||{x:b.x/b.map_width||0,y:b.y/b.map_height||0},this.variance=b.variance||0,this.last_seen=b.last_seen||(0,U._)(new Date),this.level=b.level,this.building=b.building,this.at_location=!!b.at_location,this.coordinates_from=b.coordinates_from||"top-left"}}var Y=c(93693),ie=(c(24129),c(86039)),v=c(2372)}}]);
//# sourceMappingURL=default-libs_explore_src_index_ts.js.map