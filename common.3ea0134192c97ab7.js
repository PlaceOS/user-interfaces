"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[592],{9519:(U,M,t)=>{t.d(M,{H:()=>l});var d=t(5861),u=t(8186),g=t(591),E=t(13),f=t(7545),c=t(4850),O=t(7221),k=t(5154),v=t(8115),m=t(2722),D=t(9925),r=t(1722),n=t(9112),P=t(6221),p=t(6168),h=t(4650),A=t(5938);class l extends n.cx{get new_desk_count(){return this._new_desks.getValue()?.length||0}constructor(e,i){super(),this._org=e,this._dialog=i,this._filters=new g.X({}),this._new_desks=new g.X([]),this._desk_bookings=[],this._desks=[],this._loading=new g.X(!1),this.new_desks=this._new_desks.asObservable(),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,E.b)(500),(0,f.w)(s=>{const o=s.zones||[];return o.includes("All")?(0,u.BW_)(this._org.building?.id,{name:"desks"}).pipe((0,c.U)(_=>_.map(a=>a.metadata.desks.details).reduce((a,C)=>[...a,...C],[]))):(0,u.rlq)(o[0],"desks").pipe((0,c.U)(_=>_.details))}),(0,O.K)(s=>[]),(0,c.U)(s=>(s instanceof Array||(s=[]),s.sort((o,_)=>o.name.localeCompare(_.name)),this._desks=s.map(o=>new P.nk({...o,qr_code:""})),this._desks)),(0,k.d)(1)),this.bookings=this._filters.pipe((0,E.b)(500),(0,f.w)(s=>{this._loading.next(!0);const o=s.date?new Date(s.date):new Date;let _=(s.zones||[]).filter(a=>-1!==a&&"-1"!==a&&"All"!==a);return _?.length||(_=this._org.levelsForBuilding(this._org.building).map(a=>a.id)),(0,r.F2)({period_start:Math.floor((0,v.Z)(o).valueOf()/1e3),period_end:Math.floor((0,m.Z)(o).valueOf()/1e3),type:"desk",zones:(_||[]).join(",")})}),(0,c.U)(s=>(s.sort((o,_)=>o.date-_.date),this._desk_bookings=s.map(o=>new r.$N({...o,extension_data:{...o.extension_data,checkin_qr_code:(0,p.w)(`/workplace/#/book/code?asset_id=${encodeURIComponent(o.asset_id)}`)}})),this._loading.next(!1),s)),(0,k.d)(1))}setFilters(e){e.zones?.includes("All")?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(i=>i.id)]:e.zones&&this._filters.getValue()?.zones?.includes("All")&&(e.zones=[]),this._filters.next({...this._filters.getValue(),...e})}startPolling(e=3e4){this.interval("poll",()=>this.setFilters(this._filters.getValue()),e)}stopPolling(){this.clearInterval("poll")}addDesks(e){this._new_desks.next(this._new_desks.getValue().concat(e))}clearNewDesks(){this._new_desks.next([])}checkinDesk(e){return(0,d.Z)(function*(){"failed"===(yield(0,r.FD)(e.id,!0).toPromise().catch(s=>"failed"))?(0,n.cB)("Error checking in desk booking"):(0,n.t5)(`Checked in ${e.user_name}.`)})()}approveDesk(e){return(0,d.Z)(function*(){"failed"===(yield(0,r.jT)(e.id).toPromise().catch(s=>"failed"))?(0,n.cB)("Error approving in desk booking"):(0,n.t5)(`Approved desk booking for ${e.user_name} on ${(0,D.Z)(e.date,"MMM do")}.`)})()}rejectDesk(e){return(0,d.Z)(function*(){"failed"===(yield(0,r.FP)(e.id).toPromise().catch(s=>"failed"))?(0,n.cB)("Error rejecting in desk booking"):(0,n.t5)(`Rejected desk booking for ${e.user_name} on ${(0,D.Z)(e.date,"MMM do")}.`)})()}giveAccess(e){var i=this;return(0,d.Z)(function*(){const s=yield(0,r.km)(new r.$N({...e,access:!0})).toPromise().catch(o=>"failed");if("failed"===s)return(0,n.cB)("Error giving building access booking host");(0,n.t5)(`Successfully gave building access to ${e.user_name} for desk booking.`),i._desk_bookings=[...i._desk_bookings,s]})()}rejectAllDesks(){var e=this;return(0,d.Z)(function*(){const i=e._desk_bookings||[];if(i.length<=0)return(0,n.QD)("No desks to reject for the selected date");const s=yield(0,n._5)({title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}},e._dialog);"done"!==s.reason&&(s.loading("Rejecting all desks for selected date..."),yield Promise.all(i.map(o=>(0,r.FP)(o.id).toPromise())),(0,n.t5)("Successfully rejected all desk bookings for selected date."),s.close())})()}}l.\u0275fac=function(e){return new(e||l)(h.LFG(P.w7),h.LFG(A.uw))},l.\u0275prov=h.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}}]);