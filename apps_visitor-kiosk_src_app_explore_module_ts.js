"use strict";(self.webpackChunkvisitor_kiosk=self.webpackChunkvisitor_kiosk||[]).push([["apps_visitor-kiosk_src_app_explore_module_ts"],{1713:(_s,he,_)=>{_.r(he),_.d(he,{AppExploreModule:()=>cs});var y=_(6575),A=_(9794),x=_(8849),k=_(5077),ie=_(9293),Se=_(2698),Ae=_(3517),ke=_(5022),Ne=_(1502),b=_(1670),g=_(4592),E=_(7422),D=_(7627),Y=_(4955),N=_(855),e=_(9039),z=_(257);_(1268),_(6355);var C=_(2141),ae=_(6939),H=_(8377),K=(_(982),_(1970),_(8550),_(942)),P=_(9229),U=(_(7023),_(5046)),Je=_(4186),q=_(4888);function De(n,m){if(1&n&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"thermostat"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij("",t.temp,"\u02daF")}}function Ye(n,m){if(1&n&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"opacity"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij("",t.humidity,"%")}}function Ge(n,m){1&n&&(e.TgZ(0,"div",5)(1,"app-icon",6),e._uU(2,"error"),e.qZA()())}let xe=(()=>{class n{constructor(t){this._details=t,this.temp=this._details.temp||0,this.humidity=this._details.humidity||0}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(k.ui))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-sensor-info"]],decls:4,vars:3,consts:[[1,"absolute","center","bg-base-100","rounded-lg","border","border-base-200","p-2","text-xl"],["class","flex items-center space-x-2 whitespace-nowrap pr-2",4,"ngIf"],["class","absolute top-0 right-0 rounded-full translate-x-1/2 -translate-y-1/2 bg-base-100 border border-base-200",4,"ngIf"],[1,"flex","items-center","space-x-2","whitespace-nowrap","pr-2"],[1,""],[1,"absolute","top-0","right-0","rounded-full","translate-x-1/2","-translate-y-1/2","bg-base-100","border","border-base-200"],[1,"text-error","text-xl"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,De,5,1,"div",1)(2,Ye,5,1,"div",1)(3,Ge,3,0,"div",2),e.qZA()),2&o&&(e.xp6(),e.Q6J("ngIf",s.temp),e.xp6(),e.Q6J("ngIf",s.humidity),e.xp6(),e.Q6J("ngIf",s.temp>82))},dependencies:[y.O5,q.o]})}return n})();var T=_(8159);let W=(()=>{class n extends g.cx{constructor(t,o,s){super(),this._state=t,this._org=o,this._settings=s,this._statuses={},this._count_key={},this._location={},this._label_location={},this._capacity={},this._draw={},this._points={},this._features=[],this._bind=(0,T.aj)([this._org.active_building,this._state.level]).pipe((0,U.h)(([a,i])=>!!a&&!!i),(0,E.U)(([a,i])=>{this._statuses={};let l=this._org.binding("area_management");if(!l)return;const r=(0,C.rTZ)(l,"AreaManagement").binding(`${i.id}:areas`);this.subscription("zones",r.listen().subscribe(p=>this.parseData(p))),this.subscription("binding",r.bind())})),this.init()}init(){var t=this;return(0,b.Z)(function*(){yield t._org.initialised.pipe((0,D.P)(s=>s)).toPromise();const o=yield Promise.all(t._org.levels.map(s=>(0,C.rlq)(s.id,"map_regions").toPromise()));for(const s of o){const a=s?.details?.areas;if(a)for(const i of a){const{capacity:l,hide_label:r,label_location:p,draw_polygon:c,area_count_key:d}=i.properties||{},{coordinates:u}=i.geometry||{};t._capacity[i.id]=l||100,t._count_key[i.id]=d||"",t._location[i.id]=u?.length?be(u):null,t._label_location[i.id]=!1===r?p||t._location[i.id]:null,t._draw[i.id]=!!c||t._settings.get("app.explore.use_zone_polygons"),t._points[i.id]=u||[]}}t.updateStatus(),t.subscription("bind",t._bind.subscribe())})()}parseData(t){const o=t?.value||[],s=[],a=[];for(const i of o){const l=i.capacity||this._capacity[i.area_id]||100,p=(i[this._count_key[i.area_id]||this._settings.get("app.explore.area_count_key")||"count"]||0)/l;if(this._statuses[i.area_id]=p<.4?"free":p<.75?"pending":"busy",!this._location[i.area_id])continue;let c="";i.count&&(c+=`${i.count||0} User Device${1===i.count?"":"s"}\n`),i.temperature&&(c+=`Temperature: ${i.temperature} \u02daC\n`),i.people_count>0&&(c+=`${i.people_count_sum} ${1===i.people_count_sum?"Person":"People"}\n`),i.humidity&&(c+=`Humidity: ${i.humidity}%\n`),i.queue_size&&(c+=`Queue Size: ${i.queue_size}%\n`),i.counter&&(c+=`Count: ${i.counter}\n`),this._label_location[i.area_id]&&!this._settings.get("app.explore.show_zone_labels")&&s.push({location:this._label_location[i.area_id],content:c,z_index:100}),this._settings.get("app.explore.show_zone_sensor_info")&&(i.temperature||i.humidity)&&a.push({track_id:`sensors:${i.area_id}`,location:this._location[i.area_id],content:xe,data:{temp:i.temperature,humidity:i.humidity},z_index:98})}this._features=a,this._state.setLabels("zones",s),this.updateStatus()}updateStatus(){const t={},o=[],s=this._settings.get("app.explore.colors")||{};for(const a in this._statuses){const i=s[`zone-${this._statuses[a]}`]||s[`${this._statuses[a]}`]||P.y[`${this._statuses[a]}`];this._draw[a]?o.push({track_id:`zone:${a}`,location:be(this._points[a]),content:Je.i,data:{color:i,points:this._points[a]},z_index:10}):t[`#${a}`]={fill:i,opacity:.6}}this._state.setFeatures("zones",[...o,...this._features]),this._state.setStyles("zones",t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(N.c),e.LFG(Y.w),e.LFG(g.gb))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();function be(n){const m=(n||[]).reduce((t,[o,s])=>({x_min:o<t.x_min?o:t.x_min,x_max:o>t.x_max?o:t.x_max,y_min:s<t.y_min?s:t.y_min,y_max:s>t.y_max?s:t.y_max}),{x_min:100,x_max:-100,y_min:100,y_max:-100});return{x:m.x_min+(m.x_max-m.x_min)/2,y:m.y_min+(m.y_max-m.y_min)/2}}var X=_(4512),R=_(7343),re=_(7016),ee=_(5822),O=_(462),F=_(9681),M=_(6520),G=_(8175),w=_(680),Q=_(5933),j=_(5746),ve=_(3863),Qe=_(8480),V=_(7401),qe=_(6362),je=_(8442),Ve=_(9590),He=_(576);function Ke(n,m){if(1&n&&(e.TgZ(0,"div",7)(1,"div",13)(2,"label"),e._uU(3,"Resource:"),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(5),e.hij(" ",t.resource.name||t.resource.map_id||"Unknown Resource"," ")}}function We(n,m){1&n&&(e.TgZ(0,"div",7)(1,"div",8)(2,"label"),e._uU(3,"Host"),e.qZA(),e._UZ(4,"a-user-search-field",15),e.qZA()())}const et=()=>({standalone:!0});function tt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"main",5),e.YNc(1,Ke,6,1,"div",6)(2,We,5,0,"div",6),e.TgZ(3,"div",7)(4,"div",8)(5,"label"),e._uU(6,"Date"),e.qZA(),e.TgZ(7,"a-date-field",9),e._uU(8," Date and time must be in the future "),e.qZA()()(),e.TgZ(9,"div",7)(10,"div",10)(11,"label"),e._uU(12,"Start Time"),e.qZA(),e.TgZ(13,"a-time-field",11),e.NdJ("ngModelChange",function(s){e.CHM(t);const a=e.oxw();return e.KtG(a.form.patchValue({date:s}))}),e.qZA()(),e.TgZ(14,"div",10)(15,"label"),e._uU(16,"End Time"),e.qZA(),e._UZ(17,"a-duration-field",12),e.qZA()()()}if(2&n){const t=e.oxw();let o;e.Q6J("formGroup",t.form),e.xp6(),e.Q6J("ngIf",t.resource),e.xp6(),e.Q6J("ngIf",t.host),e.xp6(5),e.Q6J("to",t.book_until),e.xp6(6),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(12,et))("use_24hr",t.use_24hr_time),e.xp6(4),e.Q6J("time",null==(o=t.form.get("date"))?null:o.value)("max",600)("min",60)("step",60)("use_24hr",t.use_24hr_time)}}let ce=(()=>{class n{get use_24hr_time(){return this._settings.get("app.use_24_hour_time")}constructor(t,o){this._data=t,this._settings=o,this.host=this._data.host,this.form=new x.cw({user:new x.NI(this._data.user),date:new x.NI(this._data.date),duration:new x.NI(this._data.duration)}),this.book_until=this._data.until,this.resource=this._data.resource}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(V.WI),e.Y36(g.gb))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-base-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModel","ngModelOptions","use_24hr","ngModelChange"],["formControlName","duration",3,"time","max","min","step","use_24hr"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4","mb-2"],[1,"px-4","py-3","border","border-base-200","rounded","w-full","mb-4"],["formControlName","user"]],template:function(o,s){1&o&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2,"Set date and time"),e.qZA(),e.TgZ(3,"button",1)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.YNc(6,tt,18,13,"main",2),e.TgZ(7,"footer",3)(8,"button",4),e._uU(9," Continue "),e.qZA()()),2&o&&(e.xp6(6),e.Q6J("ngIf",s.form),e.xp6(2),e.Q6J("mat-dialog-close",s.form.value))},dependencies:[y.O5,q.o,z.wG,V.ZT,x.JJ,x.JL,x.On,x.sg,x.u,qe.Q,je.B,Ve.N,He.d]})}return n})();var _e=_(141),st=_(9437),ot=_(9737),pe=_(1674),ye=_(3884);const nt=["explore-device-info",""];function it(n,m){if(1&n&&(e.TgZ(0,"p",17)(1,"label"),e.SDv(2,18),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.mac," ")}}function at(n,m){if(1&n&&(e.TgZ(0,"p",19)(1,"label"),e.SDv(2,20),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.manufacturer," ")}}function lt(n,m){if(1&n&&(e.TgZ(0,"p",21)(1,"label"),e.SDv(2,22),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.os," ")}}function rt(n,m){if(1&n&&(e.TgZ(0,"p",23)(1,"label"),e.SDv(2,24),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.ssid," ")}}function ct(n,m){if(1&n&&(e.TgZ(0,"p",25)(1,"label"),e.SDv(2,26),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function _t(n,m){if(1&n&&(e.TgZ(0,"p",27)(1,"label"),e.SDv(2,28),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.user.type," ")}}function pt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"div",6),e.NdJ("mouseleave",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.close())}),e._UZ(1,"div",7),e.TgZ(2,"div",8),e.YNc(3,it,4,1,"p",9),e.TgZ(4,"p")(5,"label"),e.SDv(6,10),e.qZA(),e._uU(7),e.qZA(),e.TgZ(8,"p")(9,"label"),e.SDv(10,11),e.qZA(),e._uU(11),e.qZA(),e.YNc(12,at,4,1,"p",12)(13,lt,4,1,"p",13)(14,rt,4,1,"p",14)(15,ct,4,1,"p",15)(16,_t,4,1,"p",16),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.xp6(4),e.hij(" ",t.variance,"m"),e.xp6(4),e.hij(" ",t.last_seen,""),e.xp6(),e.Q6J("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.xp6(),e.Q6J("ngIf",t.os&&!t.hide_fields.includes("os")),e.xp6(),e.Q6J("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.xp6(),e.Q6J("ngIf",t.username&&!t.hide_fields.includes("username")),e.xp6(),e.Q6J("ngIf",t.user&&!t.hide_fields.includes("user"))}}const dt=[];let Ee=(()=>{class n extends g.cx{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||dt}get last_seen(){return(0,st.Z)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,ot.Z)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(t,o,s){super(),this._details=t,this._settings=o,this._element=s,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(t=0){t>10||setTimeout(()=>{const o=this._element.nativeElement.parentElement?.parentElement;if(!o)return this.ngOnInit(++t);const s_y=parseInt(o.style.top,10)/100,s_x=parseInt(o.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(a=>this.zoom=a))},200)}loadUser(){var t=this;return(0,b.Z)(function*(){if(t.username)return;const o=(0,C.rTZ)(t._details.system,"LocationServices");if(!o)return;t.username="Loading...";const s=yield o.execute("check_ownership_of",[t.mac]).catch(a=>null);t.username=s&&s.assigned_to?s.assigned_to:""})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(pe.u),e.Y36(g.gb),e.Y36(e.SBq))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","explore-device-info",""]],features:[e.qOj],attrs:nt,decls:7,vars:9,consts:()=>{let t,o,s,a,i,l,r,p;return t=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,o=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,s=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,a=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,i=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,l=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,r=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,p=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["name","radius",1,"radius","absolute","center","bg-info","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-neutral","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["dot",""],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"content","backdrop","xPosition","yPosition","hover","mouseenter"],["device_tooltip",""],["name","device-info",1,"w-64","rounded","bg-base-100","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],t,o,["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],s,["type",""],a,["os",""],i,["ssid",""],l,["username",""],r,["user",""],p]},template:function(o,s){if(1&o&&(e._UZ(0,"div",0)(1,"div",1)(2,"div",2,3),e.TgZ(4,"div",4),e.NdJ("mouseenter",function(){return s.loadUser()}),e.qZA(),e.YNc(5,pt,17,8,"ng-template",null,5,e.W1O)),2&o){const a=e.MAs(6);e.Akn("height: "+s.diameter+"%; width: "+s.diameter+"%;"),e.xp6(2),e.Udp("background-color",s.bg_color),e.xp6(2),e.Q6J("content",a)("backdrop",!1)("xPosition",s.x_pos)("yPosition",s.y_pos)("hover",!0)}},dependencies:[y.O5,ye.X],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}\n\n/*# sourceMappingURL=explore-device-info.component.ts-angular-inline--74.css.map*/"]})}return n})();var te=_(5183);let se=(()=>{class n extends g.cx{constructor(t,o,s,a,i){var l;super(),l=this,this._state=t,this._org=o,this._settings=s,this._bookings=a,this._dialog=i,this._in_use=new O.X([]),this._options=new O.X({}),this._presence=new O.X([]),this._signs_of_life=new O.X([]),this._statuses={},this._users={},this._departments={},this._checked_in=new O.X([]),this.booking_rules=this._org.active_building.pipe((0,U.h)(r=>!!r),(0,M.w)(r=>(0,C.rlq)(r.id,"desk_booking_rules").pipe((0,G.K)(()=>(0,F.of)({details:[]})))),(0,E.U)(r=>r?.details instanceof Array?r.details:[]),(0,w.d)(1)),this.desk_list=this._state.level.pipe((0,Q.b)(50),(0,M.w)(r=>(0,C.rlq)(r.id,"desks").pipe((0,G.K)(()=>(0,F.of)({details:[]})),(0,E.U)(p=>(p?.details instanceof Array?p.details:[]).map(c=>new Qe.n({...c,zone:r}))))),(0,G.K)(r=>[]),(0,w.d)(1)),this._bind=this._state.level.pipe((0,Q.b)(300),(0,U.h)(r=>!!r),(0,j.b)(r=>{this._statuses={};const p=this._org.binding("area_management");if(!p)return;let c=(0,C.rTZ)(p,"AreaManagement")?.binding(r.id);c&&(this.subscription("lvl-in_use",c.listen().subscribe(d=>this.processBindingChange(d||{},p))),this.subscription("lvl-in_use_bind",c.bind()))})),this._booking_list=(0,T.aj)([this._options,this._state.level]).pipe((0,U.h)(([r,p])=>(r.use_api||r.date>(0,X.Z)(Date.now()).valueOf())&&!!p),(0,M.w)(([r,p])=>(0,te.F2)({type:"desk",period_start:(0,R.Z)((0,re.Z)(r.date||Date.now())),period_end:(0,R.Z)((0,X.Z)(r.date||Date.now())),zones:p.id})),(0,Q.b)(200),(0,j.b)(r=>{this._in_use.next(r.map(p=>p.asset_id)),this._checked_in.next(r.filter(p=>p.checked_in).map(p=>p.asset_id))}),(0,w.d)(1)),this._state_change=(0,T.aj)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this.booking_rules,this._options]).pipe((0,Q.b)(50),(0,E.U)(function(){var r=(0,b.Z)(function*([p,c,d,u,f,v]){l._statuses={};const h=yield l._state.level.pipe((0,ae.q)(1)).toPromise();for(const{id:Z,bookable:B}of p){const I=c.some(J=>Z===J),$=d.some(J=>Z===J),S=f.some(J=>Z===J),L=u.some(J=>Z===J)||I&&l._settings.get("app.desk.auto_checkin"),ne=(0,g.e8)({date:Date.now(),duration:60,host:(0,g.ar)(),resource:{id:Z,zones:[h.parent_id,h.id]}},v)?.hidden;l._statuses[Z]=B&&!ne?I||$||L?$||L?"busy":"pending":S?"signs-of-life":"free":"not-bookable"}l.processDesks(p)});return function(p){return r.apply(this,arguments)}}())),this.init()}init(){var t=this;return(0,b.Z)(function*(){yield t._org.initialised.pipe((0,D.P)(o=>o)).toPromise(),t.setOptions({enable_booking:!1!==t._settings.get("app.desks.enable_maps")}),t.subscription("bookings",t._booking_list.subscribe()),t.subscription("bind",t._bind.subscribe()),t.subscription("booking_rules",t.booking_rules.subscribe()),t.subscription("changes",t._state_change.subscribe()),t.subscription("desks",t.desk_list.subscribe(o=>t.processDesks(o)))})()}setOptions(t){this._options.next({...this._options.getValue(),...t})}processBindingChange({value:t},o){const s=(t||[]).filter(r=>!["desk","booking"].includes(r.location)),a=(t||[]).filter(r=>"desk"===r.location||"booking"===r.location&&"desk"===r.type);(this._options.getValue().date||Date.now())<=(0,X.Z)(Date.now()).valueOf()&&!this._options.getValue().use_api&&(this._in_use.next(a.filter(r=>"booking"===r.location).map(r=>r.map_id||r.asset_id)),this._checked_in.next(a.filter(r=>"booking"===r.location&&r.checked_in).map(r=>r.map_id||r.asset_id)),this._presence.next(a.filter(r=>r.at_location).map(r=>r.map_id||r.asset_id)),this._signs_of_life.next(a.filter(r=>r.signs_of_life).map(r=>r.map_id||r.asset_id)));const l=this._settings.get("app.department_map")||{};for(const r of a)this._users[r.map_id||r.asset_id]=r.staff_name,this._departments[r.map_id||r.asset_id]=l[r.department]||"";this.processDevices(s,o),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},o=this._settings.get("app.explore.colors")||{};for(const s in this._statuses)this._statuses[s]&&(t[`#${s}`]={fill:o[`desk-${this._statuses[s]}`]||o[`${this._statuses[s]}`]||P.y[`${this._statuses[s]}`]});this._state.setStyles("desks",t)}processDevices(t,o){const s=[];for(const a of t){const i=a.x/a.map_width,l=a.y/a.map_height;s.push({track_id:`device:hover:${i},${l}`,location:{x:a.coordinates_from?.includes("right")?1-i:i,y:a.coordinates_from?.includes("bottom")?1-l:l},content:Ee,z_index:20,data:{...a,system:o}})}this._state.setFeatures("devices",s)}processDesks(t){var o=this;const s=[],a=[],i=this._options.getValue();for(const l of t){if(s.push({track_id:`desk:hover:${l.map_id||l.id}`,location:l.id,content:_e.c,full_size:!0,no_scale:!0,data:{id:l.map_id||l.id,map_id:l.name,name:l.name||l.map_id,user:this._users[l.map_id]||l.staff_name,status:this._statuses[l.map_id],department:this._departments[l.map_id]||""},z_index:20}),!l.bookable)continue;let r=!0;const p=function(){var c=(0,b.Z)(function*(){if(!r)return;if("free"!==o._statuses[l.id])return(0,g.cB)(`${l.name||"Desk"} is unavailable at this time.`);if(l.groups?.length&&!l.groups.find(h=>(0,g.ar)().groups.includes(h)))return(0,g.cB)(`You are not allowed to book ${l.name}.`);o._bookings.newForm(),o._bookings.setOptions({type:"desk"}),i.date&&(o._bookings.form.patchValue({date:i.date}),o._bookings.form.patchValue({all_day:!!i.all_day}));let{date:d,duration:u,user:f}=yield o._setBookingTime(o._bookings.form.value.date,o._bookings.form.value.duration,o._options.getValue()?.custom??!1,l);f=f||i.host||(0,g.ar)();const v=f?.email;o._bookings.form.patchValue({resources:[l],asset_id:l.id,asset_name:l.name,date:d,duration:i.all_day?720:u,map_id:l?.map_id||l?.id,description:l.name,user:f,user_email:v,booking_type:"desk",zones:l.zone?[l.zone?.parent_id,l.zone?.id]:[]}),yield o._bookings.confirmPost().catch(h=>{throw console.log(h),(0,g.cB)(`Failed to book desk ${l.name||l.id}. ${h.message||h.error||h}`),h}),o._users[l.map_id]=(i.host||(0,g.ar)())?.name,(0,g.t5)(`Successfully booked desk ${l.name||l.id}`)});return function(){return c.apply(this,arguments)}}();["mousedown","touchstart"].forEach(c=>a.push({id:l.id,action:c,priority:10,callback:()=>{r=!0,this.timeout("booking",()=>r=!1)}})),["mouseup","touchend"].forEach(c=>a.push({id:l.id,action:c,priority:10,callback:p}))}this._state.setActions("desks",this._options.getValue().enable_booking?a:[]),this._state.setFeatures("desks",s),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(t,o,s=!1,a=null){var i=this;return(0,b.Z)(function*(){let l=null;if(i._settings.get("app.desks.allow_time_changes")){const r=(0,X.Z)((0,ee.Z)(Date.now(),i._settings.get("app.desks.available_period")||90)),c=yield i._dialog.open(ce,{data:{date:t,duration:o,until:r,host:s,resource:a}}).afterClosed().toPromise();if(!c)throw"User cancelled";t=c.date,o=c.duration,l=c.user}return{date:t,duration:o,user:l}})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(N.c),e.LFG(Y.w),e.LFG(g.gb),e.LFG(ve.f),e.LFG(V.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();var Ce=_(5702),ut=_(60),mt=_(7393),gt=_(2130);let oe=(()=>{class n extends g.cx{constructor(t,o,s,a,i){super(),this._org=t,this._state=o,this._settings=s,this._bookings=a,this._dialog=i,this._options=new O.X({}),this._poll=new O.X(0),this.options=this._options.asObservable(),this.levels=this._org.active_levels.pipe((0,E.U)(l=>l.filter(r=>r.tags.includes("parking")))),this.events=(0,T.aj)([this._org.active_building,this._options,this._poll]).pipe((0,M.w)(([l,r])=>(0,te.F2)({period_start:(0,R.Z)((0,Ce.Z)(r.date||Date.now())),period_end:(0,R.Z)((0,ut.Z)(r.date||Date.now())),type:"parking",zones:l?.id})),(0,w.d)(1)),this.existing_event=(0,T.aj)([this._options]).pipe((0,M.w)(([l])=>(0,te.F2)({period_start:(0,R.Z)((0,re.Z)(l.date||Date.now())),period_end:(0,R.Z)((0,X.Z)(l.date||Date.now())),type:"parking",email:l?.user||(0,g.ar)()?.email})),(0,w.d)(1)),this.week_events=(0,T.aj)([this._org.active_building,this._options]).pipe((0,M.w)(([l,r])=>(0,te.F2)({period_start:(0,R.Z)((0,re.Z)(r.date||Date.now())),period_end:(0,R.Z)((0,ee.Z)((0,X.Z)(r.date||Date.now()),6)),type:"parking",zones:l?.id})),(0,w.d)(1)),this.spaces=this.levels.pipe((0,M.w)(l=>(0,gt.D)(l.map(r=>(0,C.rlq)(r.id,"parking-spaces").pipe((0,E.U)(p=>(p.details instanceof Array?p.details:[]).map(c=>({...c,zone_id:r.id}))))))),(0,E.U)(l=>(0,g.xH)(l)),(0,w.d)(1)),this.active_spaces=(0,T.aj)([this.spaces,this._state.level]).pipe((0,E.U)(([l,r])=>l.filter(p=>p.zone_id===r.id))),this._users={},this.available_spaces=(0,T.aj)([this.events,this.active_spaces]).pipe((0,E.U)(([l,r])=>r.filter(p=>{const c=l.find(d=>d.asset_id===p.id)?.user_name||p.assigned_to;return this._users[p.id]=c,!c}))),this.week_availablility=(0,T.aj)([this.week_events,this.spaces,this._options]).pipe((0,E.U)(([l,r,{date:p}])=>{const c={};for(let d=0;d<7;d++){const u=(0,ee.Z)(p,d),f=l.filter(v=>(0,mt.Z)(u,v.date));c[u.valueOf()]=r.filter(v=>!f.find(h=>h.asset_id===v.id)).length}return c})),this.subscription("spaces",(0,T.aj)([this.spaces,this.available_spaces]).subscribe(([l,r])=>this._updateParkingSpaces(l,r))),this.setOptions({enable_booking:!1!==this._settings.get("app.parking.enable_maps")}),this.interval("poll",()=>this._poll.next(Date.now()),1e4)}setOptions(t){this._options.next({...this._options.getValue(),...t})}_updateParkingSpaces(t,o){var s=this;const a={},i=[],l=[],r=[],p=this._settings.get("app.explore.colors")||{},c=this._options.getValue();for(const d of t){const u=!!o.find(h=>h.id===d.id),f=u?"free":"busy";if(a[`#${d.map_id}`]={fill:p[`parking-${f}`]||p[`${f}`]||P.y[`${f}`],opacity:.6},i.push({track_id:`parking:hover:${d.map_id}`,location:`${d.map_id}`,content:_e.c,full_size:!0,no_scale:!0,z_index:20,data:{...d,user:this._users[d.id],status:f}}),!u)continue;l.push({zoom_level:1.1,location:`${d.map_id}`,content:`${d.name}\nFree`});const v=function(){var h=(0,b.Z)(function*(){if("free"!==f)return(0,g.cB)(`${d.name||"Parking Space"} is unavailable at this time.`);if(d.groups?.length&&!d.groups.find(L=>(0,g.ar)().groups.includes(L)))return(0,g.cB)(`You are not allowed to book ${d.name}.`);s._bookings.newForm(),s._bookings.setOptions({type:"parking"}),c.date&&(s._bookings.form.patchValue({date:c.date}),s._bookings.form.patchValue({all_day:!!c.all_day}));let{date:Z,duration:B,user:I}=yield s._setBookingTime(s._bookings.form.value.date,s._bookings.form.value.duration,s._options.getValue()?.custom??!1,d);I=I||c.host||(0,g.ar)();const $=I?.email,S=s._state.active_level;s._bookings.form.patchValue({resources:[d],asset_id:d.id,asset_name:d.name,date:Z,duration:c.all_day?720:B,map_id:d?.map_id||d?.id,description:d.name,user:I,user_email:$,booking_type:"parking",zones:d.zone?[d.zone?.parent_id,d.zone?.id]:[S.parent_id,S.id]}),yield s._bookings.confirmPost().catch(L=>{throw console.log(L),(0,g.cB)(`Failed to book parking space ${d.name||d.id}. ${L.message||L.error||L}`),L}),(0,g.t5)(`Successfully booked parking space ${d.name||d.id}`)});return function(){return h.apply(this,arguments)}}();r.push({id:d?.map_id||d?.id,action:"click",priority:10,callback:v})}this._state.setActions("parking",c.enable_booking?r:[]),this._state.setStyles("parking",a),this._state.setLabels("parking",l)}_setBookingTime(t,o,s=!1,a=null){var i=this;return(0,b.Z)(function*(){let l=null;if(i._settings.get("app.parking.allow_time_changes")){const r=(0,X.Z)((0,ee.Z)(Date.now(),i._settings.get("app.parking.available_period")||90)),c=yield i._dialog.open(ce,{data:{date:t,duration:o,until:r,host:s,resource:a}}).afterClosed().toPromise();if(!c)throw"User cancelled";t=c.date,o=c.duration,l=c.user}return{date:t,duration:o,user:l}})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(Y.w),e.LFG(N.c),e.LFG(g.gb),e.LFG(ve.f),e.LFG(V.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();_(1635);var de=_(3121);_(4620),_(9253);var Le=_(1125),xt=_(702);let ue=(()=>{class n{constructor(t){this._state=t,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(N.c))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:()=>{let t,o,s;return t=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,o=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,s=$localize`:␟77981432124895c410e5b9157b3deb948831ffc6␟5016012668378976433:Reset Zoom & Center`,[["z-in","","icon","","matRipple","","matTooltip",t,1,"bg-base-100",3,"click"],["z-out","","icon","","matRipple","","matTooltip",o,1,"bg-base-100",3,"click"],["reset","","icon","","matRipple","","matTooltip",s,1,"bg-base-100",3,"click"]]},template:function(o,s){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return s.zoomIn()}),e.TgZ(1,"app-icon"),e._uU(2,"add"),e.qZA()(),e.TgZ(3,"button",1),e.NdJ("click",function(){return s.zoomOut()}),e.TgZ(4,"app-icon"),e._uU(5,"remove"),e.qZA()(),e.TgZ(6,"button",2),e.NdJ("click",function(){return s.reset()}),e.TgZ(7,"app-icon"),e._uU(8,"autorenew"),e.qZA()())},dependencies:[q.o,z.wG,xt.gM],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}button[_ngcontent-%COMP%]{border:1px solid #9998;border-radius:0}button[_ngcontent-%COMP%]:first-child{border-radius:.25rem .25rem 0 0;border-bottom:none}button[_ngcontent-%COMP%]:last-child{border-radius:0 0 .25rem .25rem;border-top:none}\n\n/*# sourceMappingURL=explore-zoom-control.component.ts-angular-inline--77.css.map*/"]})}return n})();var Mt=_(3362),wt=_(8675);let It=(()=>{class n{constructor(t,o){this._org=t,this._settings=o,this._emergency_contacts=new O.X([]),this._filter=new O.X(""),this._loading=new O.X(!1),this.emergency_contacts=this._emergency_contacts.asObservable(),this._role_assigned_contacts=this._org.active_building.pipe((0,U.h)(s=>!!s),(0,M.w)(s=>(0,C.rlq)(s.id,"emergency_contacts")),(0,E.U)(({details:s})=>s?.contacts||[]),(0,w.d)(1)),this._user_search=this._filter.pipe((0,Q.b)(400),(0,j.b)(()=>this._loading.next(!0)),(0,M.w)(s=>s?.length>2?this.search_fn(s).pipe((0,G.K)(()=>(0,F.of)([]))):(0,F.of)([])),(0,w.d)(1)),this._space_search=this._filter.pipe((0,Q.b)(400),(0,j.b)(()=>this._loading.next(!0)),(0,M.w)(s=>s?.length>2?(0,C.vIL)({q:s,zone_id:this._org.organisation.id}).pipe((0,E.U)(({data:a})=>a.filter(i=>i.map_id).map(i=>new Mt.T({...i,level:this._org.levelWithID(i.zones)})))):(0,F.of)([])),(0,G.K)(()=>[])),this._points_of_interest=this._org.active_building.pipe((0,U.h)(s=>!!s),(0,M.w)(()=>(0,C.BW_)(this._org.building.id,{name:"points_of_interest"}).pipe((0,G.K)(()=>(0,F.of)({details:[]})))),(0,E.U)(s=>{const a=[];for(const i of s){const l=i.metadata.points_of_interest;if(l)for(const r of l.details)a.push({id:r.id,type:"feature",name:r.name,description:"",zone:i.zone})}return a})),this.search_results=(0,T.aj)([this._filter,this._space_search,this._user_search,this._emergency_contacts,this._role_assigned_contacts,this._points_of_interest]).pipe((0,E.U)(([s,a,i,l,r,p])=>{const c=s.toLowerCase(),d=[...a.filter(u=>u.email.toLowerCase().includes(c)||u.name.toLowerCase().includes(c)||u.display_name.toLowerCase().includes(c)).map(u=>({id:u.id,type:"space",name:u.display_name||u.name,description:`Capacity: ${u.capacity} `})),...(0,g.xH)(r.map(u=>u.roles.map(f=>({id:u.email,type:f||"contact",is_role:!0,name:u.name,description:u.email})))).filter(u=>u.name.toLowerCase().includes(c)||u.description.toLowerCase().includes(c)||u.type.toLowerCase().includes(c)),...l.map(u=>({id:u.email,type:u.type||"contact",is_role:!0,name:u.name,description:u.email})).filter(u=>u.name.toLowerCase().includes(c)||u.description.toLowerCase().includes(c)||u.type.toLowerCase().includes(c)),...i.map(u=>({id:u.email,type:"user",name:u.name,description:u.email})),...p.filter(u=>u.name.toLowerCase().includes(c)).map(u=>({id:u.id,type:"feature",name:u.name,description:"",zone:u.zone?.id}))];return d.sort((u,f)=>u.name.localeCompare(f.name)),d}),(0,j.b)(()=>this._loading.next(!1)),(0,w.d)(1)),this.loading=this._loading.asObservable(),this.search_fn=s=>this._settings.get("app.basic_user_search")?(0,C.E4d)({q:s,authority_id:(0,C.N9E)()?.id}).pipe((0,E.U)(a=>a.data)):(0,wt.VE)(s),this.search_results.subscribe(),this.init()}init(){var t=this;return(0,b.Z)(function*(){yield t._org.initialised.pipe((0,D.P)(s=>s)).toPromise();const o=(0,de.as)(t._org.binding("location_services"),"LocationServices");if(o){const s=o.binding("emergency_contacts");s.listen().subscribe(a=>{const i=[];for(const l in a)for(const r of a[l])i.push({...r,type:l});t._emergency_contacts.next(i)}),s.bind()}})()}setFilter(t){this._filter.next(t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(Y.w),e.LFG(g.gb))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var St=_(7147),me=_(9892),At=_(3910);const kt=["input"],Nt=["button"];function Pt(n,m){1&n&&e._UZ(0,"mat-spinner",9),2&n&&e.Q6J("diameter",32)}function Rt(n,m){1&n&&(e.TgZ(0,"mat-option",12),e.SDv(1,13),e.qZA())}function $t(n,m){if(1&n&&(e.TgZ(0,"mat-option",14)(1,"div",15)(2,"div",16)(3,"div",17),e._uU(4),e.qZA(),e.TgZ(5,"div",18),e._uU(6),e.qZA()(),e.TgZ(7,"div",19),e._uU(8),e.qZA()()()),2&n){const t=m.$implicit;e.Q6J("value",t),e.xp6(4),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij(" ",t.type," ")}}function zt(n,m){if(1&n&&(e.ynx(0),e.YNc(1,Rt,2,0,"mat-option",10),e.ALo(2,"async"),e.YNc(3,$t,9,4,"mat-option",11),e.ALo(4,"slice"),e.ALo(5,"async"),e.BQk()),2&n){const t=e.oxw();let o;e.xp6(),e.Q6J("ngIf",!(null!=(o=e.lcZ(2,2,t.results))&&o.length)),e.xp6(2),e.Q6J("ngForOf",e.Dn7(4,4,e.lcZ(5,8,t.results),0,5))}}let Oe=(()=>{class n extends g.cx{checkClick(t){this._el?.nativeElement?.contains(t.target)||(this.show=!1,this._input_el?.nativeElement?.blur())}constructor(t,o,s,a){super(),this._el=t,this._search=o,this._router=s,this._route=a,this.show=!1,this.search_str="",this.right_size=!1,this.results=this._search.search_results,this.loading=this._search.loading,this.setFilter=i=>this._search.setFilter(i),this.setItem=i=>i instanceof Object?this.select(i):this.setFilter(i),this.onTouch=i=>this.checkClick(i)}ngOnInit(){this.checkButtonPosition()}focusInput(){this._input_el?.nativeElement&&this.timeout("focus",()=>this._input_el.nativeElement.focus(),300)}showSearch(){this.show=!0,this.focusInput()}closeSearch(t){this.show=!1,this.search_str="",this.setFilter(""),this._input_el?.nativeElement&&(this._input_el.nativeElement.focus(),this._input_el.nativeElement.blur())}select(t){this.search_str=t.name;const o={};o["space"===t.type?"space":"feature"===t.type?"feature":"user"]=t.id,this._router.navigate([],{relativeTo:this._route,queryParams:o})}checkButtonPosition(){const t=window.innerWidth,o=this._button_el.nativeElement.getBoundingClientRect();this.right_size=o.left+o.width/2>t/2}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(e.SBq),e.Y36(It),e.Y36(A.F0),e.Y36(A.gz))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-search"]],viewQuery:function(o,s){if(1&o&&(e.Gf(kt,5),e.Gf(Nt,7)),2&o){let a;e.iGM(a=e.CRH())&&(s._input_el=a.first),e.iGM(a=e.CRH())&&(s._button_el=a.first)}},hostBindings:function(o,s){1&o&&e.NdJ("click",function(i){return s.checkClick(i)},!1,e.evT)("touchstart",function(i){return s.onTouch(i)},!1,e.evT)},features:[e.qOj],decls:14,vars:20,consts:()=>{let t,o;return t=$localize`:␟7a428104a6c33787961fda306f9c518f89fb0261␟6939663044582448373:Search for...`,o=$localize`:␟0c720c4e60410fcfcd8582a32297bdd397620830␟3411517965707112535: No matches found `,[["icon","","matRipple","",1,"bg-base-200","m-2",3,"resize","click"],["button",""],["role","search","tabindex","0","matRipple","","matAutocompleteOrigin","",1,"absolute","top-1/2","-translate-y-1/2","bg-base-100","flex","items-center","z-10","overflow-hidden","outline-none","px-4","max-w-[calc(100vw-7rem)]",3,"click"],["origin","matAutocompleteOrigin"],["keyboard","","placeholder",t,1,"flex-1","text-base","border-none","outline-none",3,"ngModel","matAutocomplete","matAutocompleteConnectedTo","ngModelChange","blur"],["input",""],["class","mr-2",3,"diameter",4,"ngIf"],["auto","matAutocomplete"],[4,"ngIf"],[1,"mr-2",3,"diameter"],["class","pointer-events-none",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none"],o,[3,"value"],[1,"flex","items-center","leading-tight","w-[22rem]","max-w-[calc(100vw-2rem)]"],[1,"flex-1","w-1/2","overflow-hidden"],[1,"truncate","w-full"],[1,"text-xs"],[1,"text-xs","font-bold","p-2","capitalize","text-white","bg-base-300","rounded"]]},template:function(o,s){if(1&o&&(e.TgZ(0,"button",0,1),e.NdJ("resize",function(){return s.checkButtonPosition()},!1,e.Jf7)("click",function(i){return s.show?s.closeSearch(i):s.showSearch()}),e.TgZ(2,"app-icon"),e._uU(3),e.qZA()(),e.TgZ(4,"div",2,3),e.NdJ("click",function(){return s.focusInput()}),e.TgZ(6,"input",4,5),e.NdJ("ngModelChange",function(i){return s.search_str=i})("ngModelChange",function(i){return s.setItem(i)})("blur",function(){return s.show=!!s.search_str}),e.qZA(),e.YNc(8,Pt,1,1,"mat-spinner",6),e.ALo(9,"async"),e.qZA(),e.TgZ(10,"mat-autocomplete",null,7),e.YNc(12,zt,6,10,"ng-container",8),e.ALo(13,"async"),e.qZA()),2&o){const a=e.MAs(5),i=e.MAs(11);e.xp6(3),e.Oqu(s.show||s.search_str?"close":"search"),e.xp6(),e.ekj("right-0",s.right_size)("-translate-x-14",s.right_size)("left-0",!s.right_size)("translate-x-14",!s.right_size)("show",s.show||s.search_str),e.xp6(2),e.Q6J("ngModel",s.search_str)("matAutocomplete",i)("matAutocompleteConnectedTo",a),e.xp6(2),e.Q6J("ngIf",e.lcZ(9,16,s.loading)),e.xp6(4),e.Q6J("ngIf",!0!==e.lcZ(13,18,s.loading)&&(s.show||s.search_str))}},dependencies:[y.sg,y.O5,q.o,St.U,me.XC,z.ey,me.ZL,me.BU,z.wG,At.Ou,x.Fj,x.JJ,x.On,y.Ov,y.OU],styles:["[_nghost-%COMP%]{z-index:99;position:relative}[role=search][_ngcontent-%COMP%]{height:3rem;width:0;border-radius:1.5rem;border:1px solid var(--b3);transition:width .2s opacity .2s;opacity:0;pointer-events:none}[role=search].show[_ngcontent-%COMP%]{width:24rem;opacity:1;pointer-events:auto}\n\n/*# sourceMappingURL=explore-search.component.ts-angular-inline--76.css.map*/"]})}return n})();_(6967),_(2182),_(6687),_(151);let Jt=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#s=this.\u0275inj=e.cJS({imports:[y.ez,k.Kk,x.u5,x.UX,ie.rP,Se.U8,Ae.eL,ke.W,Ne.E]})}return n})();var Me=_(7049),Dt=_(8714),ge=_(8128),we=_(549);function Yt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"div",4),e._uU(2,"A"),e.qZA(),e.TgZ(3,"mat-slider",5)(4,"input",6),e.NdJ("ngModelChange",function(s){e.CHM(t);const a=e.oxw();return e.KtG(a.applySetting("font_size",s))}),e.qZA()(),e.TgZ(5,"div",7),e._uU(6,"A"),e.qZA(),e.TgZ(7,"div",8),e._uU(8),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("min",10)("max",24)("step",2),e.xp6(),e.Q6J("ngModel",t.font_size),e.xp6(4),e.hij(" ",t.font_size,"px ")}}let Gt=(()=>{class n extends g.cx{constructor(t){super(),this._settings=t,this.applySetting=(o,s)=>this.timeout("apply_setting",()=>this._settings.saveUserSetting(o,s),1e3)}get dark_mode(){return"dark"===this._settings.get("theme")}get can_change_dark_mode(){return!!this._settings.get("app.general.dark_mode")}get accessible(){return!!this._settings.get("accessible")}get font_size(){return this._settings.get("font_size")||16}setDarkMode(t){this.timeout("dark_mode",()=>{const o=this._settings.get("theme");t&&"dark"!==o?this._settings.setTheme("dark"):!t&&"dark"===o&&this._settings.setTheme("light")},100)}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(g.gb))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["accessibility-controls"]],features:[e.qOj],decls:9,vars:3,consts:[["matRipple","",1,"flex","items-center","justify-between","hover:bg-base-200","w-full","p-2","rounded",3,"click"],[3,"ngModel","ngModelChange"],["class","flex items-center pl-2 space-x-4",4,"ngIf"],[1,"flex","items-center","pl-2","space-x-4"],[1,"text-sm"],[1,"flex-1","w-px","min-w-0","text-[16px]",3,"min","max","step"],["matSliderThumb","",1,"text-[16px]",3,"ngModel","ngModelChange"],[1,"text-2xl"],[1,"text-base","py-1","px-2","rounded","bg-base-300","text-base-content","my-2"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return s.setDarkMode(!s.dark_mode)}),e.TgZ(1,"div"),e._uU(2,"Dark Mode"),e.qZA(),e.TgZ(3,"mat-slide-toggle",1),e.NdJ("ngModelChange",function(i){return s.setDarkMode(i)}),e.qZA()(),e.TgZ(4,"button",0),e.NdJ("click",function(){return s.applySetting("accessible",!s.accessible)}),e.TgZ(5,"div"),e._uU(6,"Text Size"),e.qZA(),e.TgZ(7,"mat-slide-toggle",1),e.NdJ("ngModelChange",function(i){return s.applySetting("accessible",i)}),e.qZA()(),e.YNc(8,Yt,9,5,"div",2)),2&o&&(e.xp6(3),e.Q6J("ngModel",s.dark_mode),e.xp6(4),e.Q6J("ngModel",s.accessible),e.xp6(),e.Q6J("ngIf",s.accessible))},dependencies:[y.O5,z.wG,we.pH,we.$5,ie.Rr,x.Fj,x.JJ,x.On]})}return n})();const Qt=["app-explore",""];function qt(n,m){1&n&&e._UZ(0,"explore-search")}function jt(n,m){1&n&&(e.TgZ(0,"div",18),e._UZ(1,"accessibility-controls"),e.qZA())}function Vt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",23),e.NdJ("click",function(){const a=e.CHM(t).$implicit,i=e.oxw(3);return e.KtG(i.setLevel(a))}),e._uU(1),e.qZA()}if(2&n){const t=m.$implicit;e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function Ht(n,m){if(1&n&&(e.ynx(0),e.TgZ(1,"button",20)(2,"div",10),e._uU(3,"Level"),e.qZA(),e.TgZ(4,"app-icon",1),e._uU(5,"keyboard_arrow_down"),e.qZA()(),e.TgZ(6,"mat-menu",null,21),e.YNc(8,Vt,2,1,"button",22),e.ALo(9,"async"),e.qZA(),e.BQk()),2&n){const t=e.MAs(7),o=e.oxw(2);e.xp6(),e.Q6J("matMenuTriggerFor",t),e.xp6(7),e.Q6J("ngForOf",e.lcZ(9,2,o.levels))}}function Kt(n,m){if(1&n&&(e.TgZ(0,"div",26),e._UZ(1,"div",27),e.TgZ(2,"div",28),e._uU(3),e.qZA()()),2&n){const t=m.$implicit;e.xp6(),e.Udp("background-color",t.color),e.xp6(2),e.hij(" ",t.name," ")}}function Wt(n,m){if(1&n&&(e.ynx(0),e.TgZ(1,"button",20)(2,"div",10),e._uU(3,"Legend"),e.qZA(),e.TgZ(4,"app-icon",1),e._uU(5,"keyboard_arrow_down"),e.qZA()(),e.TgZ(6,"mat-menu",null,24),e.YNc(8,Kt,4,3,"div",25),e.qZA(),e.BQk()),2&n){const t=e.MAs(7),o=e.oxw(2);e.xp6(),e.Q6J("matMenuTriggerFor",t),e.xp6(7),e.Q6J("ngForOf",o.legend)}}function es(n,m){if(1&n&&(e.ynx(0),e.TgZ(1,"div",19),e.YNc(2,Ht,10,4,"ng-container",4),e.ALo(3,"async"),e.YNc(4,Wt,9,2,"ng-container",4),e.qZA(),e.BQk()),2&n){const t=e.oxw();let o;e.xp6(2),e.Q6J("ngIf",null==(o=e.lcZ(3,2,t.levels))?null:o.length),e.xp6(2),e.Q6J("ngIf",t.legend.length)}}function ts(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",30),e.NdJ("click",function(){const a=e.CHM(t).$implicit,i=e.oxw(2);return e.KtG(i.setLevel(a))}),e.ALo(1,"async"),e.TgZ(2,"div",31),e._uU(3),e.qZA()()}if(2&n){const t=m.$implicit,o=e.oxw(2);let s;e.ekj("opacity-30",t.id!==(null==(s=e.lcZ(1,3,o.level))?null:s.id)),e.xp6(3),e.hij(" ",t.display_name||t.name," ")}}function ss(n,m){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.show_levels=!s.show_levels)}),e.TgZ(2,"app-icon",1),e._uU(3,"corporate_fare"),e.qZA(),e.TgZ(4,"div",10),e._uU(5,"Level"),e.qZA(),e.TgZ(6,"app-icon",1),e._uU(7),e.qZA()(),e.TgZ(8,"div",11)(9,"div",12),e.YNc(10,ts,4,5,"button",29),e.ALo(11,"async"),e.qZA()(),e._UZ(12,"hr",13),e.BQk()}if(2&n){const t=e.oxw();e.xp6(7),e.Oqu(t.show_levels?"keyboard_arrow_up":"keyboard_arrow_down"),e.xp6(),e.Q6J("@show",t.show_levels?"show":"hide"),e.xp6(2),e.Q6J("ngForOf",e.lcZ(11,3,t.levels))}}function os(n,m){if(1&n&&(e.TgZ(0,"div",26),e._UZ(1,"div",27),e.TgZ(2,"div",28),e._uU(3),e.qZA()()),2&n){const t=m.$implicit;e.xp6(),e.Udp("background-color",t.color),e.xp6(2),e.hij(" ",t.name," ")}}function ns(n,m){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.show_legend=!s.show_legend)}),e.TgZ(2,"app-icon",1),e._uU(3,"place"),e.qZA(),e.TgZ(4,"div",10),e._uU(5,"Legend"),e.qZA(),e.TgZ(6,"app-icon",1),e._uU(7),e.qZA()(),e.TgZ(8,"div",11)(9,"div",12),e.YNc(10,os,4,3,"div",25),e.qZA()(),e._UZ(11,"hr",13),e.BQk()}if(2&n){const t=e.oxw();e.xp6(7),e.Oqu(t.show_legend?"keyboard_arrow_up":"keyboard_arrow_down"),e.xp6(),e.Q6J("@show",t.show_legend?"show":"hide"),e.xp6(2),e.Q6J("ngForOf",t.legend)}}function is(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"i-map",32),e.NdJ("zoomChange",function(s){e.CHM(t);const a=e.oxw();return e.KtG(a.updateZoom(s))})("centerChange",function(s){e.CHM(t);const a=e.oxw();return e.KtG(a.updateCenter(s))}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.qZA()}if(2&n){const t=e.oxw();let o,s;e.Q6J("src",e.lcZ(1,7,t.url))("zoom",null==(o=e.lcZ(2,9,t.positions))?null:o.zoom)("center",null==(s=e.lcZ(3,11,t.positions))?null:s.center)("styles",e.lcZ(4,13,t.styles))("features",e.lcZ(5,15,t.features))("actions",e.lcZ(6,17,t.actions))("labels",e.lcZ(7,19,t.labels))}}function as(n,m){if(1&n&&(e._UZ(0,"indoor-maps",33),e.ALo(1,"async"),e.ALo(2,"async")),2&n){const t=e.oxw();e.Q6J("styles",e.lcZ(1,3,t.styles))("actions",e.lcZ(2,5,t.actions))("locate",t.locate)}}function ls(n,m){1&n&&e._UZ(0,"explore-zoom-controls",34)}let Ie=(()=>{class n extends g.cx{get logo(){return"dark"===this._settings.get("theme")?this._settings.get("app.logo_dark"):this._settings.get("app.logo_light")}get time(){return(0,Ce.Z)(Date.now())}get hide_zones(){return this._settings.get("app.hide_zones")}updateZoom(t){this._state.setPositions(t,this._state.positions.center)}updateCenter(t){this._state.setPositions(this._state.positions.zoom,t)}toggleZones(t){var o=this;return(0,b.Z)(function*(){const s=yield o.options.pipe((0,ae.q)(1)).toPromise(),a=t?s.disable.filter(i=>"zones"!==i&&"devices"!==i)||[]:(0,g.Tw)([...s.disable||[],"zones","devices"]);o.setOptions({disable:a})})()}get can_search(){return!!this._settings.get("app.explore.search_enabled")}constructor(t,o,s,a,i,l,r,p,c,d,u,f,v){super(),this._state=t,this._s=o,this._desks=s,this._zones=a,this._parking=i,this._settings=l,this._org=r,this._spaces=p,this._dialog=c,this._route=d,this._router=u,this._space_pipe=f,this._maps=v,this.reset_delay=180,this.show_levels=!0,this.show_legend=!1,this.show_accessibility=!1,this.legend=[{id:"free",name:"Space Available",color:"#43a047"},{id:"busy",name:"Space In Use",color:"#e53935"},{id:"pending",name:"Space Pending",color:"#ffb300"},{id:"not-bookable",name:"Space Not-bookable",color:"#ccc"}],this.levels=this._org.active_levels,this.level=this._state.level,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options,this.locate="",this.onMouse=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.onTouch=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.setOptions=h=>this._state.setOptions(h),this.setLevel=h=>this._state.setLevel(h.id),this.use_mapsindoors$=this._maps.available$}ngOnInit(){var t=this;return(0,b.Z)(function*(){yield t._spaces.initialised.pipe((0,D.P)(o=>o)).toPromise(),t._desks.setOptions({custom:!0}),t.reset_delay=t._settings.get("app.inactivity_timeout_secs")||180,t.resetKiosk(),k.Uk.enabled="true"===localStorage.getItem("OSK.enabled"),t.subscription("level",t._state.level.subscribe(()=>t.timeout("update_location",()=>{t._state.setFeatures("_located",[])}))),t.subscription("route.query",t._route.queryParamMap.subscribe(function(){var o=(0,b.Z)(function*(s){if(s.has("level")&&t._state.setLevel(s.get("level")),t._state.setFeatures("_located",[]),s.has("space"))t.locateSpace(s.get("space"));else if(s.has("user")){let a=t._settings.value("last_search");if((!a||s.get("user")!==a.email)&&(a=null,a=yield(0,H.w0)(s.get("user")).toPromise()),!a)return(0,g.cB)(`Unable to user details for ${s.get("user")}`);t.locateUser(a instanceof Array?a[0]:a).catch(i=>{(0,g.cB)(`Unable to locate ${s.get("user")}`),t._router.navigate([],{relativeTo:t._route,queryParams:{}})})}else s.has("feature")?t.timeout("update_location",()=>{t._state.setFeatures("_located",[{location:s.get("feature"),content:k.qL,data:{}}])}):s.has("locate")?t.locate=s.get("locate"):t.timeout("update_location",()=>{t._state.setFeatures("_located",[])})});return function(s){return o.apply(this,arguments)}}()))})()}locateSpace(t){var o=this;return(0,b.Z)(function*(){const s=yield o._space_pipe.transform(t);if(!s)return;o._state.setLevel(o._org.levelWithID(s.zones)?.id);const a={location:s.map_id,content:k.qL,data:{message:`${s.display_name||s.name} is here`}};o.timeout("update_location",()=>o._state.setFeatures("_located",[a]))})()}locateUser(t){var o=this;return(0,b.Z)(function*(){let s=o._org.binding("location_services");if(!s)return;"string"==typeof s&&(s={system_id:s,module:"LocationServices"});const i=(yield(0,C.rTZ)(s.system_id,s.module).execute("locate_user",[t.email,t.username||t.id])).map(c=>new H.Y(c));if(i.sort((c,d)=>s.priority.indexOf(c.type)-s.priority.indexOf(d.type)),!i?.length)throw"No locations for the given user";o._state.setLevel(o._org.levelWithID([i[0]?.level])?.id);const l=i[0].position,{coordinates_from:r}=i[0],p={location:"wireless"===i[0].type?{x:r?.includes("right")?1-l.x:l.x,y:r?.includes("bottom")?1-l.y:l.y}:l,content:"wireless"===i[0].type?k.nb:k.qL,z_index:99,data:{message:`${t.name} is here`,radius:i[0].variance,last_seen:i[0].last_seen}};o.timeout("update_location",()=>{o._state.setFeatures("_located",[p])})})()}resetKiosk(){document.activeElement?.blur&&document.activeElement?.blur();const t=localStorage.getItem("KIOSK.level");this._state.setPositions(1,{x:.5,y:.5}),t&&this._state.setLevel(t),this._dialog.closeAll()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(N.c),e.Y36(P.a),e.Y36(se),e.Y36(W),e.Y36(oe),e.Y36(g.gb),e.Y36(de.w7),e.Y36(Me.sK),e.Y36(V.uw),e.Y36(A.gz),e.Y36(A.F0),e.Y36(K.X),e.Y36(g.sF))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","app-explore",""]],hostBindings:function(o,s){1&o&&e.NdJ("mousedown",function(){return s.onMouse()},!1,e.Jf7)("touchstart",function(){return s.onTouch()},!1,e.Jf7)},features:[e._Bn([P.a,se,W,oe,K.X]),e.qOj],attrs:Qt,decls:38,vars:22,consts:[["topbar","",1,"relative","flex","items-center","justify-between","p-4","border-b","border-base-300","bg-base-100","text-base-content"],[1,"text-2xl"],[1,"text-primary"],[1,"absolute","top-1/2","-translate-y-1/2","right-2","flex","items-center"],[4,"ngIf"],["icon","","matRipple","","customTooltip","",1,"bg-base-200","flex","sm:hidden",3,"content"],["accessibility_controls",""],[1,"flex","flex-1","h-1/2"],["sidebar","",1,"w-[20rem]","hidden","sm:block","bg-base-100","text-base-content","border-r","border-base-300","px-2","py-4"],["btn","","matRipple","",1,"flex","items","clear","w-full","space-x-4","hover:bg-base-200",3,"click"],[1,"flex-1","text-left","font-medium"],[1,"px-8"],[1,"py-4","space-y-2"],[1,"w-[calc(100%-4rem)]","mx-auto"],[1,"relative","flex-1","h-full"],[3,"src","zoom","center","styles","features","actions","labels","zoomChange","centerChange",4,"ngIf"],[3,"styles","actions","locate",4,"ngIf"],["class","absolute bottom-2 sm:bottom-auto sm:top-1/2 transform -translate-y-1/2 right-0",4,"ngIf"],[1,"bg-base-100","rounded","p-2","w-[18rem]"],["options","",1,"flex","sm:hidden","items-center","bg-base-content","text-base-100","p-2","space-x-2"],["btn","","matRipple","",1,"clear","text-base-100",3,"matMenuTriggerFor"],["levelMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],["legendMenu","matMenu"],["class","flex items-center py-2 px-4 rounded hover:bg-base-200 w-full space-x-4",4,"ngFor","ngForOf"],[1,"flex","items-center","py-2","px-4","rounded","hover:bg-base-200","w-full","space-x-4"],[1,"h-3","w-3","rounded-full"],[1,"text-left","opacity-60"],["btn","","matRipple","","class","clear hover:bg-base-200 hover:opacity-100 w-full",3,"opacity-30","click",4,"ngFor","ngForOf"],["btn","","matRipple","",1,"clear","hover:bg-base-200","hover:opacity-100","w-full",3,"click"],[1,"text-left","w-full"],[3,"src","zoom","center","styles","features","actions","labels","zoomChange","centerChange"],[3,"styles","actions","locate"],[1,"absolute","bottom-2","sm:bottom-auto","sm:top-1/2","transform","-translate-y-1/2","right-0"]],template:function(o,s){if(1&o&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2,"Place"),e.TgZ(3,"span",2),e._uU(4,"OS"),e.qZA()(),e.TgZ(5,"div",3),e.YNc(6,qt,1,0,"explore-search",4),e.ALo(7,"async"),e.TgZ(8,"button",5)(9,"app-icon"),e._uU(10,"accessible"),e.qZA()(),e.YNc(11,jt,2,0,"ng-template",null,6,e.W1O),e.qZA()(),e.YNc(13,es,5,4,"ng-container",4),e.ALo(14,"async"),e.TgZ(15,"div",7)(16,"div",8),e.YNc(17,ss,13,5,"ng-container",4),e.ALo(18,"async"),e.YNc(19,ns,12,3,"ng-container",4),e.TgZ(20,"button",9),e.NdJ("click",function(){return s.show_accessibility=!s.show_accessibility}),e.TgZ(21,"app-icon",1),e._uU(22,"accessible"),e.qZA(),e.TgZ(23,"div",10),e._uU(24," Accessibility "),e.qZA(),e.TgZ(25,"app-icon",1),e._uU(26),e.qZA()(),e.TgZ(27,"div",11)(28,"div",12),e._UZ(29,"accessibility-controls"),e.qZA()(),e._UZ(30,"hr",13),e.qZA(),e.TgZ(31,"div",14),e.YNc(32,is,8,21,"i-map",15),e.ALo(33,"async"),e.YNc(34,as,3,7,"indoor-maps",16),e.ALo(35,"async"),e.YNc(36,ls,1,0,"explore-zoom-controls",17),e.ALo(37,"async"),e.qZA()()),2&o){const a=e.MAs(12);let i,l;e.xp6(6),e.Q6J("ngIf",s.can_search&&!e.lcZ(7,10,s.use_mapsindoors$)),e.xp6(2),e.Q6J("content",a),e.xp6(5),e.Q6J("ngIf",(null==(i=e.lcZ(14,12,s.levels))?null:i.length)||s.legend.length),e.xp6(4),e.Q6J("ngIf",null==(l=e.lcZ(18,14,s.levels))?null:l.length),e.xp6(2),e.Q6J("ngIf",s.legend.length),e.xp6(7),e.Oqu(s.show_accessibility?"keyboard_arrow_up":"keyboard_arrow_down"),e.xp6(),e.Q6J("@show",s.show_accessibility?"show":"hide"),e.xp6(5),e.Q6J("ngIf",!e.lcZ(33,16,s.use_mapsindoors$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(35,18,s.use_mapsindoors$)),e.xp6(2),e.Q6J("ngIf",!e.lcZ(37,20,s.use_mapsindoors$))}},dependencies:[y.sg,y.O5,q.o,pe.p,Le.R,ye.X,ge.VK,ge.OP,ge.p6,z.wG,Oe,ue,Gt,y.Ov],styles:["[_nghost-%COMP%]{position:absolute;display:flex;flex-direction:column;inset:0;background-color:var(--b2)}hr[_ngcontent-%COMP%]{margin-top:.5rem!important;margin-bottom:.5rem!important}\n\n/*# sourceMappingURL=explore.component.ts-angular-inline--80.css.map*/"],data:{animation:[g.X7]}})}return n})();const rs=[{path:"",component:Ie},{path:":search_type",component:Ie}];let cs=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#s=this.\u0275inj=e.cJS({imports:[y.ez,A.Bz.forChild(rs),k.Kk,Me.YR,Dt.q,x.u5,Jt]})}return n})()}}]);
//# sourceMappingURL=apps_visitor-kiosk_src_app_explore_module_ts.js.map