"use strict";(self.webpackChunkvisitor_kiosk=self.webpackChunkvisitor_kiosk||[]).push([["apps_visitor-kiosk_src_app_explore_module_ts"],{6401:(Kt,ue,_)=>{_.r(ue),_.d(ue,{AppExploreModule:()=>Ht});var x=_(6477),M=_(854),f=_(9542),N=_(3689),ae=_(4291),Oe=_(2778),Me=_(2035),Se=_(9472),Ie=_(4317),v=_(1670),m=_(9743),$=_(5670),B=_(3174),w=_(6667),e=_(9445),D=_(7728);_(8750),_(6508);var y=_(7502),j=_(3910),q=_(5533),H=(_(73),_(4702),_(3159),_(6198)),k=_(6888),b=(_(4922),_(6942)),Xe=_(9627),K=_(5306);function Ue(n,c){if(1&n&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"thermostat"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij("",t.temp,"\u02daF")}}function Fe(n,c){if(1&n&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"opacity"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij("",t.humidity,"%")}}function Be(n,c){1&n&&(e.TgZ(0,"div",5)(1,"app-icon",6),e._uU(2,"error"),e.qZA()())}let ge=(()=>{class n{constructor(t){this._details=t,this.temp=this._details.temp||0,this.humidity=this._details.humidity||0}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(N.ui))},n.\u0275cmp=e.Xpm({type:n,selectors:[["explore-sensor-info"]],decls:4,vars:3,consts:[[1,"absolute","center","bg-white","rounded-lg","border","border-gray-300","p-2","text-xl"],["class","flex items-center space-x-2 whitespace-nowrap pr-2",4,"ngIf"],["class","absolute top-0 right-0 rounded-full translate-x-1/2 -translate-y-1/2 bg-white border border-gray-300",4,"ngIf"],[1,"flex","items-center","space-x-2","whitespace-nowrap","pr-2"],[1,""],[1,"absolute","top-0","right-0","rounded-full","translate-x-1/2","-translate-y-1/2","bg-white","border","border-gray-300"],[1,"text-error","text-xl"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Ue,5,1,"div",1),e.YNc(2,Fe,5,1,"div",1),e.YNc(3,Be,3,0,"div",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.temp),e.xp6(1),e.Q6J("ngIf",o.humidity),e.xp6(1),e.Q6J("ngIf",o.temp>82))},dependencies:[x.O5,K.o]}),n})(),W=(()=>{class n extends m.cx{constructor(t,o,s){super(),this._state=t,this._org=o,this._settings=s,this._statuses={},this._location={},this._capacity={},this._draw={},this._points={},this._features=[],this._bind=this._state.level.pipe((0,b.U)(i=>{if(!i)return;this._statuses={};let a=this._org.binding("area_management");if(!a)return;const l=(0,y.rTZ)(a,"AreaManagement").binding(`${i.id}:areas`);this.subscription("zones",l.listen().subscribe(r=>this.parseData(r))),this.subscription("binding",l.bind())})),this.init()}init(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(s=>s)).toPromise();const o=yield Promise.all(t._org.levels.map(s=>(0,y.rlq)(s.id,"map_regions").toPromise()));for(const s of o){const i=s?.details?.areas;if(i)for(const a of i){const{capacity:l,hide_label:r,label_location:d,draw_polygon:p}=a.properties||{},{coordinates:u}=a.geometry||{};t._capacity[a.id]=l||100,t._location[a.id]=!1===r?d||(u?.length?he(u):null):null,t._draw[a.id]=!!p||t._settings.get("app.explore.use_zone_polygons"),t._points[a.id]=u||[]}}t.updateStatus(),t.subscription("bind",t._bind.subscribe())})()}parseData(t){const o=t?.value||[],s=[],i=[];for(const a of o){const l=a.count/(this._capacity[a.area_id]||100);if(this._statuses[a.area_id]=l<.4?"free":l<.75?"pending":"busy",!this._location[a.area_id])continue;let r="";a.count&&(r+=`${a.count||0} User Device${1===a.count?"":"s"}\n`),a.temperature&&(r+=`Temperature: ${a.temperature} \u02daC\n`),a.people_count>0&&(r+=`${a.people_count_sum} ${1===a.people_count_sum?"Person":"People"}\n`),a.humidity&&(r+=`Humidity: ${a.humidity}%\n`),a.queue_size&&(r+=`Queue Size: ${a.queue_size}%\n`),a.counter&&(r+=`Count: ${a.counter}\n`),s.push({location:this._location[a.area_id],content:r,z_index:100}),this._settings.get("app.explore.show_simple_sensor_info")&&(a.temperature||a.humidity)&&i.push({location:this._location[a.area_id],content:ge,data:{temp:a.temperature,humidity:a.humidity},z_index:98})}this._features=i,this._settings.get("app.explore.show_simple_sensor_info")||this._state.setLabels("zones",s),this.updateStatus()}updateStatus(){const t={},o=[],s=this._settings.get("app.explore.colors")||{};for(const i in this._statuses){const a=s[`zone-${this._statuses[i]}`]||s[`${this._statuses[i]}`]||k.y[`${this._statuses[i]}`];this._draw[i]?o.push({track_id:`zone:${i}`,location:he(this._points[i]),content:Xe.i,data:{color:a,points:this._points[i]},z_index:10}):t[`#${i}`]={fill:a,opacity:.6}}this._state.setFeatures("zones",[...o,this._features]),this._state.setStyles("zones",t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(w.c),e.LFG(B.w),e.LFG(m.gb))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();function he(n){const c=(n||[]).reduce((t,[o,s])=>({x_min:o<t.x_min?o:t.x_min,x_max:o>t.x_max?o:t.x_max,y_min:s<t.y_min?s:t.y_min,y_max:s>t.y_max?s:t.y_max}),{x_min:100,x_max:-100,y_min:100,y_max:-100});return{x:c.x_min+(c.x_max-c.x_min)/2,y:c.y_min+(c.y_max-c.y_min)/2}}var z=_(3200),R=_(1810),le=_(9377),ee=_(312),O=_(4505),X=_(4139),Z=_(7716),G=_(9151),S=_(9095),Y=_(7418),A=_(9128),J=_(823),Q=_(8759),fe=_(8929),De=_(9502),V=_(7486),Ye=_(2306),Je=_(1022),Ge=_(7303),Qe=_(9697);function Ve(n,c){if(1&n&&(e.TgZ(0,"div",7)(1,"div",13)(2,"label"),e._uU(3,"Resource:"),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(5),e.hij(" ",t.resource.name||t.resource.map_id||"Unknown Resource"," ")}}function je(n,c){1&n&&(e.TgZ(0,"div",7)(1,"div",8)(2,"label"),e._uU(3,"Host"),e.qZA(),e._UZ(4,"a-user-search-field",15),e.qZA()())}const qe=function(){return{standalone:!0}};function He(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"main",5),e.YNc(1,Ve,6,1,"div",6),e.YNc(2,je,5,0,"div",6),e.TgZ(3,"div",7)(4,"div",8)(5,"label"),e._uU(6,"Date"),e.qZA(),e.TgZ(7,"a-date-field",9),e._uU(8," Date and time must be in the future "),e.qZA()()(),e.TgZ(9,"div",7)(10,"div",10)(11,"label"),e._uU(12,"Start Time"),e.qZA(),e.TgZ(13,"a-time-field",11),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.form.patchValue({date:s}))}),e.qZA()(),e.TgZ(14,"div",10)(15,"label"),e._uU(16,"End Time"),e.qZA(),e._UZ(17,"a-duration-field",12),e.qZA()()()}if(2&n){const t=e.oxw();let o;e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",t.resource),e.xp6(1),e.Q6J("ngIf",t.host),e.xp6(5),e.Q6J("to",t.book_until),e.xp6(6),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(12,qe))("use_24hr",t.use_24hr_time),e.xp6(4),e.Q6J("time",null==(o=t.form.get("date"))?null:o.value)("max",600)("min",60)("step",60)("use_24hr",t.use_24hr_time)}}let ce=(()=>{class n{get use_24hr_time(){return this._settings.get("app.use_24_hour_time")}constructor(t,o){this._data=t,this._settings=o,this.host=this._data.host,this.form=new f.cw({user:new f.NI(this._data.user),date:new f.NI(this._data.date),duration:new f.NI(this._data.duration)}),this.book_until=this._data.until,this.resource=this._data.resource}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(V.WI),e.Y36(m.gb))},n.\u0275cmp=e.Xpm({type:n,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-gray-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModel","ngModelOptions","use_24hr","ngModelChange"],["formControlName","duration",3,"time","max","min","step","use_24hr"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4","mb-2"],[1,"px-4","py-3","border","border-gray-200","rounded","w-full","mb-4"],["formControlName","user"]],template:function(t,o){1&t&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2,"Set date and time"),e.qZA(),e.TgZ(3,"button",1)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.YNc(6,He,18,13,"main",2),e.TgZ(7,"footer",3)(8,"button",4),e._uU(9," Continue "),e.qZA()()),2&t&&(e.xp6(6),e.Q6J("ngIf",o.form),e.xp6(2),e.Q6J("mat-dialog-close",o.form.value))},dependencies:[x.O5,K.o,D.wG,V.ZT,f.JJ,f.JL,f.On,f.sg,f.u,Ye.Q,Je.B,Ge.N,Qe.d]}),n})();var ve=_(1838),Ke=_(8305),We=_(8987),_e=_(9136),et=_(3970);const tt=["explore-device-info",""];function ot(n,c){if(1&n&&(e.TgZ(0,"p",17)(1,"label"),e.SDv(2,18),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.mac," ")}}function st(n,c){if(1&n&&(e.TgZ(0,"p",19)(1,"label"),e.SDv(2,20),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.manufacturer," ")}}function nt(n,c){if(1&n&&(e.TgZ(0,"p",21)(1,"label"),e.SDv(2,22),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.os," ")}}function it(n,c){if(1&n&&(e.TgZ(0,"p",23)(1,"label"),e.SDv(2,24),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.ssid," ")}}function at(n,c){if(1&n&&(e.TgZ(0,"p",25)(1,"label"),e.SDv(2,26),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function rt(n,c){if(1&n&&(e.TgZ(0,"p",27)(1,"label"),e.SDv(2,28),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.user.type," ")}}function lt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",6),e.NdJ("mouseleave",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.close())}),e._UZ(1,"div",7),e.TgZ(2,"div",8),e.YNc(3,ot,4,1,"p",9),e.TgZ(4,"p")(5,"label"),e.SDv(6,10),e.qZA(),e._uU(7),e.qZA(),e.TgZ(8,"p")(9,"label"),e.SDv(10,11),e.qZA(),e._uU(11),e.qZA(),e.YNc(12,st,4,1,"p",12),e.YNc(13,nt,4,1,"p",13),e.YNc(14,it,4,1,"p",14),e.YNc(15,at,4,1,"p",15),e.YNc(16,rt,4,1,"p",16),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.xp6(4),e.hij(" ",t.variance,"m"),e.xp6(4),e.hij(" ",t.last_seen,""),e.xp6(1),e.Q6J("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.xp6(1),e.Q6J("ngIf",t.os&&!t.hide_fields.includes("os")),e.xp6(1),e.Q6J("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.xp6(1),e.Q6J("ngIf",t.username&&!t.hide_fields.includes("username")),e.xp6(1),e.Q6J("ngIf",t.user&&!t.hide_fields.includes("user"))}}const ct=[];let xe=(()=>{class n extends m.cx{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||ct}get last_seen(){return(0,Ke.Z)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,We.Z)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(t,o,s){super(),this._details=t,this._settings=o,this._element=s,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(t=0){t>10||setTimeout(()=>{const o=this._element.nativeElement.parentElement?.parentElement;if(!o)return this.ngOnInit(++t);const s_y=parseInt(o.style.top,10)/100,s_x=parseInt(o.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(i=>this.zoom=i))},200)}loadUser(){var t=this;return(0,v.Z)(function*(){if(t.username)return;const o=(0,y.rTZ)(t._details.system,"LocationServices");if(!o)return;t.username="Loading...";const s=yield o.execute("check_ownership_of",[t.mac]).catch(i=>null);t.username=s&&s.assigned_to?s.assigned_to:""})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_e.u),e.Y36(m.gb),e.Y36(e.SBq))},n.\u0275cmp=e.Xpm({type:n,selectors:[["","explore-device-info",""]],features:[e.qOj],attrs:tt,decls:7,vars:9,consts:function(){let c,t,o,s,i,a,l,r;return c=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,t=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,o=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,s=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,i=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,a=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,l=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,r=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["name","radius",1,"radius","absolute","center","bg-blue-600","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-black/40","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["dot",""],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"content","backdrop","xPosition","yPosition","hover","mouseenter"],["device_tooltip",""],["name","device-info",1,"w-64","rounded","bg-white","dark:bg-neutral-800","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],c,t,["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],o,["type",""],s,["os",""],i,["ssid",""],a,["username",""],l,["user",""],r]},template:function(t,o){if(1&t&&(e._UZ(0,"div",0)(1,"div",1)(2,"div",2,3),e.TgZ(4,"div",4),e.NdJ("mouseenter",function(){return o.loadUser()}),e.qZA(),e.YNc(5,lt,17,8,"ng-template",null,5,e.W1O)),2&t){const s=e.MAs(6);e.Akn("height: "+o.diameter+"%; width: "+o.diameter+"%;"),e.xp6(2),e.Udp("background-color",o.bg_color),e.xp6(2),e.Q6J("content",s)("backdrop",!1)("xPosition",o.x_pos)("yPosition",o.y_pos)("hover",!0)}},dependencies:[x.O5,et.X],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}\n/*# sourceMappingURL=explore-device-info.component.ts-angular-inline--70.css.map*/"]}),n})();var te=_(354);let oe=(()=>{class n extends m.cx{constructor(t,o,s,i,a){var l;super(),l=this,this._state=t,this._org=o,this._settings=s,this._bookings=i,this._dialog=a,this._in_use=new O.X([]),this._options=new O.X({}),this._presence=new O.X([]),this._signs_of_life=new O.X([]),this._statuses={},this._users={},this._departments={},this._checked_in=new O.X([]),this.booking_rules=this._org.active_building.pipe((0,G.h)(r=>!!r),(0,S.w)(r=>(0,y.rlq)(r.id,"desk_booking_rules").pipe((0,Y.K)(()=>(0,X.of)({details:[]})))),(0,b.U)(r=>r?.details instanceof Array?r.details:[]),(0,A.d)(1)),this.desk_list=this._state.level.pipe((0,J.b)(50),(0,S.w)(r=>(0,y.rlq)(r.id,"desks").pipe((0,Y.K)(()=>(0,X.of)({details:[]})),(0,b.U)(d=>(d?.details instanceof Array?d.details:[]).map(p=>new De.n({...p,zone:r}))))),(0,Y.K)(r=>[]),(0,A.d)(1)),this._bind=this._state.level.pipe((0,J.b)(300),(0,G.h)(r=>!!r),(0,Q.b)(r=>{this._statuses={};const d=this._org.binding("area_management");if(!d)return;let p=(0,y.rTZ)(d,"AreaManagement")?.binding(r.id);p&&(this.subscription("lvl-in_use",p.listen().subscribe(u=>this.processBindingChange(u||{},d))),this.subscription("lvl-in_use_bind",p.bind()))})),this._booking_list=(0,Z.aj)([this._options,this._state.level]).pipe((0,G.h)(([r,d])=>(r.use_api||r.date>(0,z.Z)(Date.now()).valueOf())&&!!d),(0,S.w)(([r,d])=>(0,te.F2)({type:"desk",period_start:(0,R.Z)((0,le.Z)(r.date||Date.now())),period_end:(0,R.Z)((0,z.Z)(r.date||Date.now())),zones:d.id})),(0,J.b)(200),(0,Q.b)(r=>{this._in_use.next(r.map(d=>d.asset_id)),this._checked_in.next(r.filter(d=>d.checked_in).map(d=>d.asset_id))}),(0,A.d)(1)),this._state_change=(0,Z.aj)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this.booking_rules,this._options]).pipe((0,J.b)(50),(0,b.U)(function(){var r=(0,v.Z)(function*([d,p,u,h,C,g]){l._statuses={};const L=yield l._state.level.pipe((0,j.q)(1)).toPromise();for(const{id:T,bookable:I}of d){const U=p.some(F=>T===F),P=u.some(F=>T===F),E=C.some(F=>T===F),ne=h.some(F=>T===F)||U&&l._settings.get("app.desk.auto_checkin"),ie=(0,m.e8)({date:Date.now(),duration:60,host:(0,m.ar)(),resource:{id:T,zones:[L.parent_id,L.id]}},g)?.hidden;l._statuses[T]=I&&!ie?U||P||ne?P||ne?"busy":"pending":E?"signs-of-life":"free":"not-bookable"}l.processDesks(d)});return function(d){return r.apply(this,arguments)}}())),this.init()}init(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(o=>o)).toPromise(),t.setOptions({enable_booking:!1!==t._settings.get("app.desks.enable_maps")}),t.subscription("bookings",t._booking_list.subscribe()),t.subscription("bind",t._bind.subscribe()),t.subscription("booking_rules",t.booking_rules.subscribe()),t.subscription("changes",t._state_change.subscribe()),t.subscription("desks",t.desk_list.subscribe(o=>t.processDesks(o)))})()}setOptions(t){this._options.next({...this._options.getValue(),...t})}processBindingChange({value:t},o){const s=(t||[]).filter(r=>!["desk","booking"].includes(r.location)),i=(t||[]).filter(r=>"desk"===r.location||"booking"===r.location&&"desk"===r.type);(this._options.getValue().date||Date.now())<=(0,z.Z)(Date.now()).valueOf()&&!this._options.getValue().use_api&&(this._in_use.next(i.filter(r=>"booking"===r.location).map(r=>r.map_id||r.asset_id)),this._checked_in.next(i.filter(r=>"booking"===r.location&&r.checked_in).map(r=>r.map_id||r.asset_id)),this._presence.next(i.filter(r=>r.at_location).map(r=>r.map_id||r.asset_id)),this._signs_of_life.next(i.filter(r=>r.signs_of_life).map(r=>r.map_id||r.asset_id)));const l=this._settings.get("app.department_map")||{};for(const r of i)this._users[r.map_id||r.asset_id]=r.staff_name,this._departments[r.map_id||r.asset_id]=l[r.department]||"";this.processDevices(s,o),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},o=this._settings.get("app.explore.colors")||{};for(const s in this._statuses)this._statuses[s]&&(t[`#${s}`]={fill:o[`desk-${this._statuses[s]}`]||o[`${this._statuses[s]}`]||k.y[`${this._statuses[s]}`]});this._state.setStyles("desks",t)}processDevices(t,o){const s=[];for(const i of t){const a=i.x/i.map_width,l=i.y/i.map_height;s.push({track_id:`device:hover:${a},${l}`,location:{x:i.coordinates_from?.includes("right")?1-a:a,y:i.coordinates_from?.includes("bottom")?1-l:l},content:xe,z_index:20,data:{...i,system:o}})}this._state.setFeatures("devices",s)}processDesks(t){var o=this;const s=[],i=[],a=this._options.getValue();for(const l of t){if(s.push({track_id:`desk:hover:${l.map_id||l.id}`,location:l.id,content:ve.c,full_size:!0,no_scale:!0,data:{id:l.map_id||l.id,map_id:l.name,name:l.name||l.map_id,user:this._users[l.map_id]||l.staff_name,status:this._statuses[l.map_id],department:this._departments[l.map_id]||""},z_index:20}),!l.bookable)continue;const r=function(){var d=(0,v.Z)(function*(){if("free"!==o._statuses[l.id])return(0,m.cB)(`${l.name||"Desk"} is unavailable at this time.`);if(l.groups?.length&&!l.groups.find(g=>(0,m.ar)().groups.includes(g)))return(0,m.cB)(`You are not allowed to book ${l.name}.`);o._bookings.newForm(),o._bookings.setOptions({type:"desk"}),a.date&&(o._bookings.form.patchValue({date:a.date}),o._bookings.form.patchValue({all_day:!!a.all_day}));let{date:p,duration:u,user:h}=yield o._setBookingTime(o._bookings.form.value.date,o._bookings.form.value.duration,o._options.getValue()?.custom??!1,l);h=h||a.host||(0,m.ar)();const C=h?.email;o._bookings.form.patchValue({resources:[l],asset_id:l.id,asset_name:l.name,date:p,duration:a.all_day?720:u,map_id:l?.map_id||l?.id,description:l.name,user:h,user_email:C,booking_type:"desk",zones:l.zone?[l.zone?.parent_id,l.zone?.id]:[]}),yield o._bookings.confirmPost().catch(g=>{throw console.log(g),(0,m.cB)(`Failed to book desk ${l.name||l.id}. ${g.message||g.error||g}`),g}),o._users[l.map_id]=(a.host||(0,m.ar)())?.name,(0,m.t5)(`Successfully booked desk ${l.name||l.id}`)});return function(){return d.apply(this,arguments)}}();i.push({id:l.id,action:"click",priority:10,callback:r}),i.push({id:l.id,action:"touchend",priority:10,callback:r})}this._state.setActions("desks",this._options.getValue().enable_booking?i:[]),this._state.setFeatures("desks",s),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(t,o,s=!1,i=null){var a=this;return(0,v.Z)(function*(){let l=null;if(a._settings.get("app.desks.allow_time_changes")){const r=(0,z.Z)((0,ee.Z)(Date.now(),a._settings.get("app.desks.available_period")||90)),p=yield a._dialog.open(ce,{data:{date:t,duration:o,until:r,host:s,resource:i}}).afterClosed().toPromise();if(!p)throw"User cancelled";t=p.date,o=p.duration,l=p.user}return{date:t,duration:o,user:l}})()}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(w.c),e.LFG(B.w),e.LFG(m.gb),e.LFG(fe.f),e.LFG(V.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac}),n})();var be=_(6361);_(3725),_(5845),_(4350),_(7121);var se=_(5912);_(437),_(3348),_(7686);var ht=_(2423);let pe=(()=>{class n{constructor(t){this._state=t,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.c))},n.\u0275cmp=e.Xpm({type:n,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:function(){let c,t,o;return c=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,t=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,o=$localize`:␟77981432124895c410e5b9157b3deb948831ffc6␟5016012668378976433:Reset Zoom & Center`,[["z-in","","icon","","matRipple","","matTooltip",c,1,"bg-white","dark:bg-neutral-800",3,"click"],["z-out","","icon","","matRipple","","matTooltip",t,1,"bg-white","dark:bg-neutral-800",3,"click"],["reset","","icon","","matRipple","","matTooltip",o,1,"bg-white","dark:bg-neutral-800",3,"click"]]},template:function(t,o){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return o.zoomIn()}),e.TgZ(1,"app-icon"),e._uU(2,"add"),e.qZA()(),e.TgZ(3,"button",1),e.NdJ("click",function(){return o.zoomOut()}),e.TgZ(4,"app-icon"),e._uU(5,"remove"),e.qZA()(),e.TgZ(6,"button",2),e.NdJ("click",function(){return o.reset()}),e.TgZ(7,"app-icon"),e._uU(8,"autorenew"),e.qZA()())},dependencies:[K.o,D.wG,ht.gM],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}button[_ngcontent-%COMP%]{border:1px solid #9998;border-radius:0}button[_ngcontent-%COMP%]:first-child{border-radius:.25rem .25rem 0 0;border-bottom:none}button[_ngcontent-%COMP%]:last-child{border-radius:0 0 .25rem .25rem;border-top:none}\n/*# sourceMappingURL=explore-zoom-control.component.ts-angular-inline--73.css.map*/"]}),n})();var Ot=_(656),Mt=_(9012);let St=(()=>{class n{constructor(t,o){this._org=t,this._settings=o,this._emergency_contacts=new O.X([]),this._filter=new O.X(""),this._loading=new O.X(!1),this.emergency_contacts=this._emergency_contacts.asObservable(),this._user_search=this._filter.pipe((0,J.b)(400),(0,Q.b)(()=>this._loading.next(!0)),(0,S.w)(s=>s?.length>2?this.search_fn(s).pipe((0,Y.K)(()=>(0,X.of)([]))):(0,X.of)([])),(0,A.d)(1)),this._space_search=this._filter.pipe((0,J.b)(400),(0,Q.b)(()=>this._loading.next(!0)),(0,S.w)(s=>s?.length>2?(0,y.vIL)({q:s,zone_id:this._org.organisation.id}).pipe((0,b.U)(({data:i})=>i.filter(a=>a.map_id).map(a=>new Ot.T({...a,level:this._org.levelWithID(a.zones)})))):(0,X.of)([])),(0,Y.K)(()=>[])),this._points_of_interest=this._org.active_building.pipe((0,G.h)(s=>!!s),(0,S.w)(()=>(0,y.BW_)(this._org.building.id,{name:"points_of_interest"}).pipe((0,Y.K)(()=>(0,X.of)({details:[]})))),(0,b.U)(s=>{const i=[];for(const a of s){const l=a.metadata.points_of_interest;if(l)for(const r of l.details)i.push({id:r.id,type:"feature",name:r.name,description:"",zone:a.zone})}return i})),this.search_results=(0,Z.aj)([this._filter,this._space_search,this._user_search,this._emergency_contacts,this._points_of_interest]).pipe((0,b.U)(([s,i,a,l,r])=>{const d=s.toLowerCase(),p=(0,m.Tw)([...i.filter(u=>u.email.toLowerCase().includes(d)||u.name.toLowerCase().includes(d)||u.display_name.toLowerCase().includes(d)).map(u=>({id:u.id,type:"space",name:u.display_name||u.name,description:`Capacity: ${u.capacity} `})),...l.map(u=>({id:u.email,type:u.type||"contact",is_role:!0,name:u.name,description:u.email})).filter(u=>u.name.toLowerCase().includes(d)||u.description.toLowerCase().includes(d)||u.type.toLowerCase().includes(d)),...a.map(u=>({id:u.email,type:"user",name:u.name,description:u.email})),...r.filter(u=>u.name.toLowerCase().includes(d)).map(u=>({id:u.id,type:"feature",name:u.name,description:"",zone:u.zone?.id}))],"id");return p.sort((u,h)=>u.name.localeCompare(h.name)),p}),(0,Q.b)(()=>this._loading.next(!1)),(0,A.d)(1)),this.loading=this._loading.asObservable(),this.search_fn=s=>this._settings.get("app.basic_user_search")?(0,y.E4d)({q:s,authority_id:(0,y.N9E)()?.id}).pipe((0,b.U)(i=>i.data)):(0,Mt.VE)(s),this.search_results.subscribe(),this.init()}init(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(s=>s)).toPromise();const o=(0,se.as)(t._org.binding("location_services"),"LocationServices");if(o){const s=o.binding("emergency_contacts");s.listen().subscribe(i=>{const a=[];for(const l in i)for(const r of i[l])a.push({...r,type:l});t._emergency_contacts.next(a)}),s.bind()}})()}setFilter(t){this._filter.next(t)}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(B.w),e.LFG(m.gb))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var It=_(4618),de=_(2556),wt=_(5312);const At=["input"];function Pt(n,c){1&n&&e._UZ(0,"mat-spinner",9),2&n&&e.Q6J("diameter",32)}function Nt(n,c){1&n&&(e.TgZ(0,"mat-option",12),e.SDv(1,13),e.qZA())}function kt(n,c){if(1&n&&(e.TgZ(0,"mat-option",14)(1,"div",15)(2,"div",16)(3,"div",17),e._uU(4),e.qZA(),e.TgZ(5,"div",18),e._uU(6),e.qZA()(),e.TgZ(7,"div",19),e._uU(8),e.qZA()()()),2&n){const t=c.$implicit;e.Q6J("value",t),e.xp6(4),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij(" ",t.type," ")}}function Rt(n,c){if(1&n&&(e.ynx(0),e.YNc(1,Nt,2,0,"mat-option",10),e.ALo(2,"async"),e.YNc(3,kt,9,4,"mat-option",11),e.ALo(4,"slice"),e.ALo(5,"async"),e.BQk()),2&n){const t=e.oxw();let o;e.xp6(1),e.Q6J("ngIf",!(null!=(o=e.lcZ(2,2,t.results))&&o.length)),e.xp6(2),e.Q6J("ngForOf",e.Dn7(4,4,e.lcZ(5,8,t.results),0,5))}}let Le=(()=>{class n extends m.cx{checkClick(t){this._el?.nativeElement?.contains(t.target)||(this.show=!1,this._input_el?.nativeElement?.blur())}constructor(t,o,s,i){super(),this._el=t,this._search=o,this._router=s,this._route=i,this.show=!1,this.search_str="",this.results=this._search.search_results,this.loading=this._search.loading,this.setFilter=a=>this._search.setFilter(a),this.setItem=a=>a instanceof Object?this.select(a):this.setFilter(a),this.onTouch=a=>this.checkClick(a)}showSearch(){this.show=!0,this._input_el?.nativeElement&&this.timeout("focus",()=>this._input_el.nativeElement.focus(),300)}closeSearch(t){this.show=!1,this.search_str="",this.setFilter(""),this._input_el?.nativeElement&&(this._input_el.nativeElement.focus(),this._input_el.nativeElement.blur())}select(t){this.search_str=t.name;const o={};o["space"===t.type?"space":"feature"===t.type?"feature":"user"]=t.id,this._router.navigate([],{relativeTo:this._route,queryParams:o})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(e.SBq),e.Y36(St),e.Y36(M.F0),e.Y36(M.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["explore-search"]],viewQuery:function(t,o){if(1&t&&e.Gf(At,5),2&t){let s;e.iGM(s=e.CRH())&&(o._input_el=s.first)}},hostBindings:function(t,o){1&t&&e.NdJ("click",function(i){return o.checkClick(i)},!1,e.evT)("touchstart",function(i){return o.onTouch(i)},!1,e.evT)},features:[e.qOj],decls:13,vars:12,consts:function(){let c,t;return c=$localize`:␟7a428104a6c33787961fda306f9c518f89fb0261␟6939663044582448373:Search for...`,t=$localize`:␟0c720c4e60410fcfcd8582a32297bdd397620830␟3411517965707112535: No matches found `,[["role","search","tabindex","0","matRipple","",1,"bg-white","m-2","flex","items-center","z-10","relative","overflow-hidden","outline-none"],["tabindex","0",1,"text-2xl","outline-none",3,"click"],["keyboard","","placeholder",c,1,"flex-1","text-base","border-none","outline-none",3,"ngModel","matAutocomplete","matAutocompleteConnectedTo","ngModelChange","blur"],["input",""],["class","mr-2",3,"diameter",4,"ngIf"],["matAutocompleteOrigin","",1,"absolute","bottom-0","left-8","right-8","min-w-[20rem]"],["origin","matAutocompleteOrigin"],["auto","matAutocomplete"],[4,"ngIf"],[1,"mr-2",3,"diameter"],["class","pointer-events-none",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none"],t,[3,"value"],[1,"flex","items-center","leading-tight","w-[26rem]","max-w-[calc(100vw-2rem)]"],[1,"flex-1","w-1/2","overflow-hidden"],[1,"truncate","w-full"],[1,"text-xs"],[1,"text-xs","font-bold","p-2","capitalize","text-white","bg-gray-500","rounded"]]},template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"app-icon",1),e.NdJ("click",function(i){return o.show?o.closeSearch(i):o.showSearch()}),e._uU(2),e.qZA(),e.TgZ(3,"input",2,3),e.NdJ("ngModelChange",function(i){return o.search_str=i})("ngModelChange",function(i){return o.setItem(i)})("blur",function(){return o.show=!!o.search_str}),e.qZA(),e.YNc(5,Pt,1,1,"mat-spinner",4),e.ALo(6,"async"),e._UZ(7,"div",5,6),e.qZA(),e.TgZ(9,"mat-autocomplete",null,7),e.YNc(11,Rt,6,10,"ng-container",8),e.ALo(12,"async"),e.qZA()),2&t){const s=e.MAs(8),i=e.MAs(10);e.ekj("show",o.show||o.search_str),e.xp6(2),e.hij(" ",o.show||o.search_str?"close":"search"," "),e.xp6(1),e.Q6J("ngModel",o.search_str)("matAutocomplete",i)("matAutocompleteConnectedTo",s),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,8,o.loading)),e.xp6(6),e.Q6J("ngIf",!0!==e.lcZ(12,10,o.loading)&&(o.show||o.search_str))}},dependencies:[x.sg,x.O5,K.o,It.U,de.XC,D.ey,de.ZL,de.BU,D.wG,wt.Ou,f.Fj,f.JJ,f.On,x.Ov,x.OU],styles:["[_nghost-%COMP%]{z-index:99}[role=search][_ngcontent-%COMP%]{height:3.125rem;width:3.125rem;border-radius:1.5rem;border:1px solid #ccc;transition:width .2s}app-icon[_ngcontent-%COMP%]{margin:.55rem}[role=search].show[_ngcontent-%COMP%]{width:32rem;max-width:calc(100vw - 1rem);border-color:#1e88e5}\n/*# sourceMappingURL=explore-search.component.ts-angular-inline--72.css.map*/"]}),n})();_(9275),_(1718),_(7801),_(3905);let Ft=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[x.ez,N.Kk,f.u5,f.UX,ae.rP,Oe.U8,Me.eL,Se.W,Ie.E]}),n})();var Ze=_(1790),Bt=_(2487);function Dt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"button",2),e.NdJ("click",function(){const i=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.setLevel(i))}),e.ALo(1,"async"),e.TgZ(2,"div",3),e._uU(3),e.qZA(),e.TgZ(4,"p",4),e._uU(5),e.qZA()()}if(2&n){const t=c.$implicit,o=e.oxw();let s;e.ekj("active",t.id===(null==(s=e.lcZ(1,4,o.level))?null:s.id)),e.xp6(3),e.Oqu(t.number),e.xp6(2),e.hij(" ",t.display_name||t.name," ")}}let Yt=(()=>{class n{constructor(t,o){this._org=t,this._state=o,this.levels=this._org.active_levels,this.level=this._state.level,this.setLevel=s=>this._state.setLevel(s.id)}ngOnInit(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(s=>s)).toPromise();const o=yield t._org.active_levels.pipe((0,j.q)(1)).toPromise();console.log("Levels:",o,t._org.building)})()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(se.w7),e.Y36(w.c))},n.\u0275cmp=e.Xpm({type:n,selectors:[["explore-level-select"]],decls:3,vars:3,consts:[[1,"m-2","rounded","overflow-hidden","bg-white","shadow","border","border-solid","border-gray-300"],["class","flex flex-col items-center justify-center h-16 w-16 p-2 border-none","matRipple","",3,"active","click",4,"ngFor","ngForOf"],["matRipple","",1,"flex","flex-col","items-center","justify-center","h-16","w-16","p-2","border-none",3,"click"],[1,"text-2xl"],[1,"text-sm","whitespace-nowrap","m-0"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Dt,6,6,"button",1),e.ALo(2,"async"),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,o.levels)))},dependencies:[x.sg,D.wG,x.Ov],styles:[".active[_ngcontent-%COMP%]{background:var(--secondary)!important;color:#fff!important}button[_ngcontent-%COMP%]:not(:first-child){border-top:1px solid #ccc!important}\n/*# sourceMappingURL=explore-level-select.component.ts-angular-inline--77.css.map*/"]}),n})();const Jt=["app-explore",""];function Gt(n,c){1&n&&e._UZ(0,"explore-search",18)}function Qt(n,c){1&n&&(e.TgZ(0,"div",23)(1,"div",10),e._uU(2," Zone Usage "),e.TgZ(3,"div",24),e._UZ(4,"div",12),e.TgZ(5,"div",25),e._uU(6,"0 ~ 50%"),e.qZA()(),e.TgZ(7,"div",24),e._UZ(8,"div",16),e.TgZ(9,"div",25),e._uU(10,"51 ~ 75%"),e.qZA()(),e.TgZ(11,"div",24),e._UZ(12,"div",15),e.TgZ(13,"div",25),e._uU(14,"76 ~ 100%"),e.qZA()()()())}function Vt(n,c){if(1&n){const t=e.EpF();e.TgZ(0,"div",19)(1,"div",20),e._uU(2," Zones "),e.TgZ(3,"mat-slide-toggle",21),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.toggleZones(s))}),e.ALo(4,"async"),e.qZA()(),e.YNc(5,Qt,15,0,"div",22),e.ALo(6,"async"),e.qZA()}if(2&n){const t=e.oxw();let o,s;e.ekj("top-2",!t.can_search)("top-16",t.can_search),e.xp6(3),e.Q6J("ngModel",!(null!=(o=e.lcZ(4,6,t.options))&&null!=o.disable&&o.disable.includes("zones"))),e.xp6(2),e.Q6J("ngIf",!(null!=(s=e.lcZ(6,8,t.options))&&null!=s.disable&&s.disable.includes("zones")))}}const jt=function(){return["/"]};let Te=(()=>{class n extends m.cx{get logo(){return this._settings.get("app.logo_dark")}get time(){return(0,be.Z)(Date.now())}get hide_zones(){return this._settings.get("app.hide_zones")}toggleZones(t){var o=this;return(0,v.Z)(function*(){const s=yield o.options.pipe((0,j.q)(1)).toPromise(),i=t?s.disable.filter(a=>"zones"!==a&&"devices"!==a)||[]:(0,m.Tw)([...s.disable||[],"zones","devices"]);o.setOptions({disable:i})})()}get can_search(){return!!this._settings.get("app.explore.search_enabled")}constructor(t,o,s,i,a,l,r,d,p,u,h){super(),this._state=t,this._s=o,this._desks=s,this._zones=i,this._settings=a,this._org=l,this._spaces=r,this._dialog=d,this._route=p,this._router=u,this._space_pipe=h,this.reset_delay=180,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options,this.onMouse=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.onTouch=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.setOptions=C=>this._state.setOptions(C)}ngOnInit(){var t=this;return(0,v.Z)(function*(){yield t._spaces.initialised.pipe((0,$.P)(o=>o)).toPromise(),t._desks.setOptions({custom:!0}),t.reset_delay=t._settings.get("app.inactivity_timeout_secs")||180,t.resetKiosk(),N.Uk.enabled="true"===localStorage.getItem("OSK.enabled"),t.subscription("level",t._state.level.subscribe(()=>t.timeout("update_location",()=>{t._state.setFeatures("_located",[])}))),t.subscription("route.query",t._route.queryParamMap.subscribe(function(){var o=(0,v.Z)(function*(s){if(s.has("level")&&t._state.setLevel(s.get("level")),t._state.setFeatures("_located",[]),s.has("space"))t.locateSpace(s.get("space"));else if(s.has("user")){let i=t._settings.value("last_search");if((!i||s.get("user")!==i.email)&&(i=null,i=yield(0,q.w0)(s.get("user")).toPromise()),!i)return(0,m.cB)(`Unable to user details for ${s.get("user")}`);t.locateUser(i instanceof Array?i[0]:i).catch(a=>{(0,m.cB)(`Unable to locate ${s.get("user")}`),t._router.navigate([],{relativeTo:t._route,queryParams:{}})})}else s.has("feature")?t.timeout("update_location",()=>{t._state.setFeatures("_located",[{location:s.get("feature"),content:N.qL,data:{}}])}):t.timeout("update_location",()=>{t._state.setFeatures("_located",[])})});return function(s){return o.apply(this,arguments)}}()))})()}locateSpace(t){var o=this;return(0,v.Z)(function*(){const s=yield o._space_pipe.transform(t);if(!s)return;o._state.setLevel(o._org.levelWithID(s.zones)?.id);const i={location:s.map_id,content:N.qL,data:{message:`${s.display_name||s.name} is here`}};o.timeout("update_location",()=>o._state.setFeatures("_located",[i]))})()}locateUser(t){var o=this;return(0,v.Z)(function*(){let s=o._org.binding("location_services");if(!s)return;"string"==typeof s&&(s={system_id:s,module:"LocationServices"});const a=(yield(0,y.rTZ)(s.system_id,s.module).execute("locate_user",[t.email,t.username||t.id])).map(p=>new q.Y(p));if(a.sort((p,u)=>s.priority.indexOf(p.type)-s.priority.indexOf(u.type)),!a?.length)throw"No locations for the given user";o._state.setLevel(o._org.levelWithID([a[0]?.level])?.id);const l=a[0].position,{coordinates_from:r}=a[0],d={location:"wireless"===a[0].type?{x:r?.includes("right")?1-l.x:l.x,y:r?.includes("bottom")?1-l.y:l.y}:l,content:"wireless"===a[0].type?N.nb:N.qL,z_index:99,data:{message:`${t.name} is here`,radius:a[0].variance,last_seen:a[0].last_seen}};o.timeout("update_location",()=>{o._state.setFeatures("_located",[d])})})()}resetKiosk(){document.activeElement?.blur&&document.activeElement?.blur();const t=localStorage.getItem("KIOSK.level");this._state.setPositions(1,{x:.5,y:.5}),t&&this._state.setLevel(t),this._dialog.closeAll()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(w.c),e.Y36(k.a),e.Y36(oe),e.Y36(W),e.Y36(m.gb),e.Y36(se.w7),e.Y36(Ze.sK),e.Y36(V.uw),e.Y36(M.gz),e.Y36(M.F0),e.Y36(H.X))},n.\u0275cmp=e.Xpm({type:n,selectors:[["","app-explore",""]],hostBindings:function(t,o){1&t&&e.NdJ("mousedown",function(){return o.onMouse()},!1,e.Jf7)("touchstart",function(){return o.onTouch()},!1,e.Jf7)},features:[e._Bn([k.a,oe,W,H.X]),e.qOj],attrs:Jt,decls:37,vars:30,consts:[[1,"absolute","top-0","left-0","bg-gray-900","rounded-br-2xl","p-4","z-10","shadow","border-b","border-r","border-gray-200",3,"routerLink"],[1,"w-32",3,"src"],[1,"absolute","top-0","left-1/2","-translate-x-1/2","bg-gray-900","rounded-b-2xl","px-4","pb-4","pt-3","z-10","shadow","border-b","border-r","border-gray-200","text-white"],[1,"absolute","inset-0"],[3,"src","zoom","center","styles","features","actions","labels"],[1,"absolute","top-1/2","transform","-translate-y-1/2","right-0"],[1,"absolute","left-1","top-1/2","transform","-translate-y-1/2","z-10"],["class","absolute top-1 right-1",4,"ngIf"],["name","zones","class","p-2 bg-white border border-gray-300 absolute right-1 m-2 rounded flex flex-col items-center space-y-2",3,"top-2","top-16",4,"ngIf"],[1,"absolute","bottom-2","right-2","p-2","rounded","bg-white","shadow","border","border-gray-100"],[1,"font-medium"],[1,"flex","items-center","space-x-2","p-2"],[1,"h-3","w-3","rounded-full","bg-success"],[1,"text-center"],[1,"flex","items-center","space-x-2","rounded","bg-gray-50","p-2"],[1,"h-3","w-3","rounded-full","bg-error"],[1,"h-3","w-3","rounded-full","bg-pending"],[1,"h-3","w-3","rounded-full","bg-gray-400"],[1,"absolute","top-1","right-1"],["name","zones",1,"p-2","bg-white","border","border-gray-300","absolute","right-1","m-2","rounded","flex","flex-col","items-center","space-y-2"],[1,"flex","items-center"],[1,"ml-2",3,"ngModel","ngModelChange"],["zone-legend","","class","space-y-2",4,"ngIf"],["zone-legend","",1,"space-y-2"],[1,"flex","items-center","space-x-2"],[1,"w-20","text-center"]],template:function(t,o){if(1&t&&(e.TgZ(0,"a",0),e._UZ(1,"img",1),e.qZA(),e.TgZ(2,"div",2),e._uU(3),e.ALo(4,"date"),e.qZA(),e.TgZ(5,"div",3),e._UZ(6,"i-map",4),e.ALo(7,"async"),e.ALo(8,"async"),e.ALo(9,"async"),e.ALo(10,"async"),e.ALo(11,"async"),e.ALo(12,"async"),e.ALo(13,"async"),e.qZA(),e._UZ(14,"explore-zoom-controls",5)(15,"explore-level-select",6),e.YNc(16,Gt,1,0,"explore-search",7),e.YNc(17,Vt,7,10,"div",8),e.TgZ(18,"div",9)(19,"div",10),e._uU(20,"Legend"),e.qZA(),e.TgZ(21,"div",11),e._UZ(22,"div",12),e.TgZ(23,"div",13),e._uU(24,"Space Available"),e.qZA()(),e.TgZ(25,"div",14),e._UZ(26,"div",15),e.TgZ(27,"div",13),e._uU(28,"Space In Use"),e.qZA()(),e.TgZ(29,"div",14),e._UZ(30,"div",16),e.TgZ(31,"div",13),e._uU(32,"Space Pending"),e.qZA()(),e.TgZ(33,"div",11),e._UZ(34,"div",17),e.TgZ(35,"div",13),e._uU(36,"Space Not-bookable"),e.qZA()()()),2&t){let s,i;e.Q6J("routerLink",e.DdM(29,jt)),e.xp6(1),e.Q6J("src",null==o.logo?null:o.logo.src,e.LSH),e.xp6(2),e.hij(" ",e.xi3(4,12,o.time,"fullDate")," "),e.xp6(3),e.Q6J("src",e.lcZ(7,15,o.url))("zoom",null==(s=e.lcZ(8,17,o.positions))?null:s.zoom)("center",null==(i=e.lcZ(9,19,o.positions))?null:i.center)("styles",e.lcZ(10,21,o.styles))("features",e.lcZ(11,23,o.features))("actions",e.lcZ(12,25,o.actions))("labels",e.lcZ(13,27,o.labels)),e.xp6(10),e.Q6J("ngIf",o.can_search),e.xp6(1),e.Q6J("ngIf",!o.hide_zones)}},dependencies:[x.O5,M.rH,_e.p,ae.Rr,f.JJ,f.On,Le,pe,Yt,x.Ov,x.uU],styles:["[_nghost-%COMP%]{position:absolute;display:flex;flex-direction:column;inset:0;background-color:#f0f0f0}@media screen and (max-height: 640px){explore-level-select[_ngcontent-%COMP%]{transform:translateY(0)!important;top:auto!important;bottom:0!important}}@media screen and (orientation: landscape){explore-level-select[_ngcontent-%COMP%]{transform:translateY(0)!important;top:auto!important;bottom:0!important}}\n/*# sourceMappingURL=explore.component.ts-angular-inline--76.css.map*/"]}),n})();const qt=[{path:"",component:Te},{path:":search_type",component:Te}];let Ht=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[x.ez,M.Bz.forChild(qt),N.Kk,Ze.YR,Bt.q,f.u5,Ft]}),n})()}}]);
//# sourceMappingURL=apps_visitor-kiosk_src_app_explore_module_ts.js.map