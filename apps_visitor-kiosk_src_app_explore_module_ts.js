"use strict";(self.webpackChunkvisitor_kiosk=self.webpackChunkvisitor_kiosk||[]).push([["apps_visitor-kiosk_src_app_explore_module_ts"],{7345:(cs,ge,c)=>{c.r(ge),c.d(ge,{AppExploreModule:()=>ls});var E=c(316),L=c(9805),b=c(4456),N=c(8030),ae=c(8827),Xe=c(1570),we=c(9168),Pe=c(9714),je=c(7651),x=c(9204),m=c(2333),y=c(5443),U=c(7871),Y=c(5762),P=c(2455),e=c(8559),X=c(5060),re=c(4950);c(5175);var I=c(6484),le=c(3602),W=c(8390),Q=(c(7401),c(1865),c(5384),c(2011)),j=c(5897),B=c(8627),G=c(9803),Z=c(9434),q=c(2238);function Ye(i,h){if(1&i&&(e.j41(0,"div",5)(1,"app-icon"),e.EFF(2,"thermostat"),e.k0s(),e.j41(3,"div",6),e.EFF(4),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.SpI("",t.temp,"\u02daF")}}function Ze(i,h){if(1&i&&(e.j41(0,"div",5)(1,"app-icon"),e.EFF(2,"opacity"),e.k0s(),e.j41(3,"div",6),e.EFF(4),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(4),e.SpI("",t.humidity,"%")}}function Ke(i,h){1&i&&(e.j41(0,"div",7)(1,"app-icon",8),e.EFF(2,"error"),e.k0s()())}function Je(i,h){if(1&i&&(e.j41(0,"div",2),e.DNE(1,Ye,5,1,"div",3)(2,Ze,5,1,"div",3)(3,Ke,3,0,"div",4),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.temp),e.R7$(),e.Y8G("ngIf",t.humidity),e.R7$(),e.Y8G("ngIf",t.temp>82)}}let ve="",Ee=(()=>{class i extends m.Tv{get show(){return ve===this._details.id}set show(t){this.timeout("show",()=>ve=t?this._details.id:"")}constructor(t){super(),this._details=t,this.temp=this._details.temp||0,this.humidity=this._details.humidity||0}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(N.Nw))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["explore-sensor-info"]],features:[e.Vt3],decls:5,vars:1,consts:[["stats",""],["icon","","matRipple","","customTooltip","","yPosition","center","xPosition","center",1,"absolute","top-1/2","left-1/2","w-7","h-7","min-w-0","-translate-x-1/2","-translate-y-1/2","bg-base-100","shadow","pointer-events-auto",3,"content"],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","bg-base-100","rounded-lg","border","border-base-200","p-2","text-xl"],["class","flex items-center space-x-2 whitespace-nowrap pr-2",4,"ngIf"],["class","absolute top-0 right-0 rounded-full translate-x-1/2 -translate-y-1/2 bg-base-100 border border-base-200",4,"ngIf"],[1,"flex","items-center","space-x-2","whitespace-nowrap","pr-2"],[1,""],[1,"absolute","top-0","right-0","rounded-full","translate-x-1/2","-translate-y-1/2","bg-base-100","border","border-base-200"],[1,"text-error","text-xl"]],template:function(n,s){if(1&n&&(e.j41(0,"button",1)(1,"app-icon"),e.EFF(2," visibility "),e.k0s()(),e.DNE(3,Je,4,3,"ng-template",null,0,e.C5r)),2&n){const o=e.sdS(4);e.Y8G("content",o)}},dependencies:[E.bT,Z.R,q.I,X.r6]})}return i})();var M=c(521),C=c(2175),He=c(7558);let ee=(()=>{class i extends m.Tv{constructor(t,n,s){super(),this._state=t,this._org=n,this._settings=s,this._area_list=[],this._statuses={},this._count_key={},this._location={},this._label_location={},this._capacity={},this._draw={},this._points={},this._features=[],this._polygons$=new M.t([]),this._bind=(0,C.zV)([this._org.active_building,this._state.level,this._state.options]).pipe((0,B.p)(([o,a,{is_public:r}])=>!!o&&!!a&&!r),(0,y.T)(([o,a])=>{this._statuses={};let r=this._org.binding("area_management");if(!r)return;const l=(0,I.f_4)(r,"AreaManagement").binding(`${a.id}:areas`),p=(0,I.f_4)(r,"AreaManagement").binding(`${a.id}`),_=(0,C.zV)([l.listen(),p.listen()]).pipe((0,G.B)(100),(0,y.T)(([d,g])=>[...d?.value||[],...(g?.value||[]).filter(v=>"area"===v.location)]));this.subscription("zones-status",_.subscribe(d=>this.parseData(d))),this.subscription("binding",l.bind()),this.subscription("zone-binding",p.bind())})),this.init()}init(){var t=this;return(0,x.A)(function*(){yield t._org.initialised.pipe((0,U.$)(s=>s)).toPromise();const n=yield Promise.all(t._org.levels.map(s=>(0,I.bpY)(s.id,"map_regions").toPromise()));t._area_list=[];for(const s of n){const o=s?.details?.areas;if(o)for(const a of o){const{capacity:r,hide_label:l,label_location:p,draw_polygon:_,area_count_key:d}=a.properties||{},{coordinates:g}=a.geometry||{};t._capacity[a.id]=r||100,t._count_key[a.id]=d||"",t._location[a.id]=g?.length?We(g):null,t._label_location[a.id]=!1===l?p||t._location[a.id]:null,t._draw[a.id]=!!_||t._settings.get("app.explore.use_zone_polygons"),t._points[a.id]=g||[],t._area_list.push(a.map_id||a.id)}}t._state.setFeatures("zones-canvas",[{track_id:"zones-canvas",location:{x:.5,y:.5},content:He.I,data:{polygons$:t._polygons$,draw_points:!1,draw_labels:!1}}]),t.updateStatus(),t.subscription("bind",t._bind.subscribe())})()}parseData(t=[]){const n=[],s=[];for(const o of t){const a=o.map_id||o.area_id,r=o.capacity||this._capacity[a]||100,p=(o[this._count_key[a]||this._settings.get("app.explore.area_count_key")||"count"]||0)/r;if(this._statuses[a]=o.at_location?"busy":p<.4?"free":p<.75?"pending":"busy",!this._location[a])continue;let _="";o.count&&(_+=`${o.count||0} User Device${1===o.count?"":"s"}\n`),o.temperature&&(_+=`Temperature: ${o.temperature} \u02daC\n`),o.people_count>0&&(_+=`${o.people_count_sum} ${1===o.people_count_sum?"Person":"People"}\n`),o.humidity&&(_+=`Humidity: ${o.humidity}%\n`),o.queue_size&&(_+=`Queue Size: ${o.queue_size}%\n`),o.counter&&(_+=`Count: ${o.counter}\n`),this._label_location[a]&&!this._settings.get("app.explore.show_zone_labels")&&n.push({location:this._label_location[a],content:_,z_index:100}),this._settings.get("app.explore.show_zone_sensor_info")&&(o.temperature||o.humidity)&&s.push({track_id:`sensors:${a}`,location:this._location[a],content:Ee,data:{id:a,temp:o.temperature||10,humidity:o.humidity||10},z_index:98})}this._features=s,this._state.setLabels("zones",n),this.updateStatus()}updateStatus(){const t={},s=this._settings.get("app.explore.colors")||{},o=[];for(const a in this._statuses){const r=s[`zone-${this._statuses[a]}`]||s[`${this._statuses[a]}`]||j.U[`${this._statuses[a]}`];this._draw[a]?o.push({name:a,points:this._points[a],color:r}):t[`#${a}`]={fill:r,opacity:.6}}this._polygons$.next(o),this._state.setFeatures("zones",[...this._features]),this._state.setStyles("zones-styles",t)}static#e=this.\u0275fac=function(n){return new(n||i)(e.KVO(P.O),e.KVO(Y.y),e.KVO(m.h$))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac})}return i})();function We(i){const h=(i||[]).reduce((t,[n,s])=>({x_min:n<t.x_min?n:t.x_min,x_max:n>t.x_max?n:t.x_max,y_min:s<t.y_min?s:t.y_min,y_max:s>t.y_max?s:t.y_max}),{x_min:100,x_max:-100,y_min:100,y_max:-100});return{x:h.x_min+(h.x_max-h.x_min)/2,y:h.y_min+(h.y_max-h.y_min)/2}}var D=c(6441),z=c(9908),_e=c(3240),te=c(8797),w=c(1536),O=c(1963),K=c(9314),$=c(7841),H=c(6e3),ye=c(8379),Qe=c(7451),J=c(2587),qe=c(9608),xe=c(3476),et=c(1413),Ce=c(8e3);const tt=()=>({standalone:!0});function st(i,h){if(1&i&&(e.j41(0,"div",7)(1,"div",13)(2,"label"),e.EFF(3,"Resource:"),e.k0s(),e.j41(4,"div",14),e.EFF(5),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(5),e.SpI(" ",t.resource.name||t.resource.map_id||"Unknown Resource"," ")}}function nt(i,h){1&i&&(e.j41(0,"div",7)(1,"div",8)(2,"label"),e.EFF(3,"Host"),e.k0s(),e.nrm(4,"a-user-search-field",15),e.k0s()())}function ot(i,h){if(1&i){const t=e.RV6();e.j41(0,"main",5),e.DNE(1,st,6,1,"div",6)(2,nt,5,0,"div",6),e.j41(3,"div",7)(4,"div",8)(5,"label"),e.EFF(6,"Date"),e.k0s(),e.j41(7,"a-date-field",9),e.EFF(8," Date and time must be in the future "),e.k0s()()(),e.j41(9,"div",7)(10,"div",10)(11,"label"),e.EFF(12,"Start Time"),e.k0s(),e.j41(13,"a-time-field",11),e.bIt("ngModelChange",function(s){e.eBV(t);const o=e.XpG();return e.Njj(o.form.patchValue({date:s}))}),e.k0s()(),e.j41(14,"div",10)(15,"label"),e.EFF(16,"End Time"),e.k0s(),e.nrm(17,"a-duration-field",12),e.k0s()()()}if(2&i){let t;const n=e.XpG();e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("ngIf",n.resource),e.R7$(),e.Y8G("ngIf",n.host),e.R7$(5),e.Y8G("to",n.book_until),e.R7$(6),e.Y8G("ngModel",n.form.value.date)("ngModelOptions",e.lJ4(12,tt))("use_24hr",n.use_24hr_time),e.R7$(4),e.Y8G("time",null==(t=n.form.get("date"))?null:t.value)("max",600)("min",60)("step",60)("use_24hr",n.use_24hr_time)}}let pe=(()=>{class i{get use_24hr_time(){return this._settings.get("app.use_24_hour_time")}constructor(t,n){this._data=t,this._settings=n,this.host=this._data.host,this.form=new b.gE({user:new b.MJ(this._data.user),date:new b.MJ(this._data.date),duration:new b.MJ(this._data.duration)}),this.book_until=this._data.until,this.resource=this._data.resource}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(J.Vh),e.rXU(m.h$))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-base-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModelChange","ngModel","ngModelOptions","use_24hr"],["formControlName","duration",3,"time","max","min","step","use_24hr"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4","mb-2"],[1,"px-4","py-3","border","border-base-200","rounded","w-full","mb-4"],["formControlName","user",1,"mb-4"]],template:function(n,s){1&n&&(e.j41(0,"header",0)(1,"h2"),e.EFF(2,"Set date and time"),e.k0s(),e.j41(3,"button",1)(4,"app-icon"),e.EFF(5,"close"),e.k0s()()(),e.DNE(6,ot,18,13,"main",2),e.j41(7,"footer",3)(8,"button",4),e.EFF(9," Continue "),e.k0s()()),2&n&&(e.R7$(6),e.Y8G("ngIf",s.form),e.R7$(2),e.Y8G("mat-dialog-close",s.form.value))},dependencies:[E.bT,Z.R,X.r6,J.tx,b.BC,b.cb,b.vS,b.j4,b.JD,qe.G,xe.y,et.t,Ce.$]})}return i})();var de=c(2882),it=c(2439),at=c(1874),ue=c(4918);const rt=["explore-device-info",""];function lt(i,h){if(1&i&&(e.j41(0,"p",23)(1,"label"),e.pXf(2,4),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.mac," ")}}function ct(i,h){if(1&i&&(e.j41(0,"p",24)(1,"label"),e.pXf(2,5),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.manufacturer," ")}}function _t(i,h){if(1&i&&(e.j41(0,"p",25)(1,"label"),e.pXf(2,6),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.os," ")}}function pt(i,h){if(1&i&&(e.j41(0,"p",26)(1,"label"),e.pXf(2,7),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.ssid," ")}}function dt(i,h){if(1&i&&(e.j41(0,"p",27)(1,"label"),e.pXf(2,8),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function ut(i,h){if(1&i&&(e.j41(0,"p",28)(1,"label"),e.pXf(2,9),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2);e.R7$(3),e.SpI(" ",t.user.type," ")}}function mt(i,h){if(1&i){const t=e.RV6();e.j41(0,"div",14),e.bIt("mouseleave",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.close())}),e.nrm(1,"div",15),e.j41(2,"div",16),e.DNE(3,lt,4,1,"p",17),e.j41(4,"p")(5,"label"),e.pXf(6,2),e.k0s(),e.EFF(7),e.k0s(),e.j41(8,"p")(9,"label"),e.pXf(10,3),e.k0s(),e.EFF(11),e.k0s(),e.DNE(12,ct,4,1,"p",18)(13,_t,4,1,"p",19)(14,pt,4,1,"p",20)(15,dt,4,1,"p",21)(16,ut,4,1,"p",22),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(3),e.Y8G("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.R7$(4),e.SpI(" ",t.variance,"m"),e.R7$(4),e.SpI(" ",t.last_seen,""),e.R7$(),e.Y8G("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.R7$(),e.Y8G("ngIf",t.os&&!t.hide_fields.includes("os")),e.R7$(),e.Y8G("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.R7$(),e.Y8G("ngIf",t.username&&!t.hide_fields.includes("username")),e.R7$(),e.Y8G("ngIf",t.user&&!t.hide_fields.includes("user"))}}const ht=[];let Ie=(()=>{class i extends m.Tv{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||ht}get last_seen(){return(0,it.m)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,at.o)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(t,n,s){super(),this._details=t,this._settings=n,this._element=s,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(t=0){t>10||setTimeout(()=>{const n=this._element.nativeElement.parentElement?.parentElement;if(!n)return this.ngOnInit(++t);const s_y=parseInt(n.style.top,10)/100,s_x=parseInt(n.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(o=>this.zoom=o))},200)}loadUser(){var t=this;return(0,x.A)(function*(){if(t.username)return;const n=(0,I.f_4)(t._details.system,"LocationServices");if(!n)return;t.username="Loading...";const s=yield n.execute("check_ownership_of",[t.mac]).catch(o=>null);t.username=s&&s.assigned_to?s.assigned_to:""})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(ue.N),e.rXU(m.h$),e.rXU(e.aKT))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["","explore-device-info",""]],features:[e.Vt3],attrs:rt,decls:7,vars:9,consts:()=>{let t,n,s,o,a,r,l,p;return t=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,n=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,s=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,o=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,a=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,r=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,l=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,p=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["dot",""],["device_tooltip",""],t,n,s,o,a,r,l,p,["name","radius",1,"radius","absolute","center","bg-info","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-neutral","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"mouseenter","content","backdrop","xPosition","yPosition","hover"],["name","device-info",1,"w-64","rounded","bg-base-100","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],["type",""],["os",""],["ssid",""],["username",""],["user",""]]},template:function(n,s){if(1&n){const o=e.RV6();e.nrm(0,"div",10)(1,"div",11)(2,"div",12,0),e.j41(4,"div",13),e.bIt("mouseenter",function(){return e.eBV(o),e.Njj(s.loadUser())}),e.k0s(),e.DNE(5,mt,17,8,"ng-template",null,1,e.C5r)}if(2&n){const o=e.sdS(6);e.Aen("height: "+s.diameter+"%; width: "+s.diameter+"%;"),e.R7$(2),e.xc7("background-color",s.bg_color),e.R7$(2),e.Y8G("content",o)("backdrop",!1)("xPosition",s.x_pos)("yPosition",s.y_pos)("hover",!0)}},dependencies:[E.bT,q.I],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}\n\n/*# sourceMappingURL=explore-device-info.component.ts-angular-inline--75.css.map*/"]})}return i})();var se=c(8026);let ne=(()=>{class i extends m.Tv{constructor(t,n,s,o,a){var r;super(),r=this,this._state=t,this._org=n,this._settings=s,this._bookings=o,this._dialog=a,this._in_use=new M.t([]),this._options=new M.t({}),this._presence=new M.t([]),this._signs_of_life=new M.t([]),this._statuses={},this._users={},this._departments={},this._checked_in=new M.t([]),this.booking_rules=this._org.active_building.pipe((0,B.p)(l=>!!l),(0,O.n)(l=>(0,I.bpY)(l.id,"desk_booking_rules").pipe((0,K.W)(()=>(0,w.of)({details:[]})))),(0,y.T)(l=>l?.details instanceof Array?l.details:[]),(0,$.t)(1)),this.desk_list=this._state.level.pipe((0,G.B)(50),(0,O.n)(l=>(0,I.bpY)(l.id,"desks").pipe((0,K.W)(()=>(0,w.of)({details:[]})),(0,y.T)(p=>(p?.details instanceof Array?p.details:[]).map(_=>new Qe.g({..._,zone:l}))))),(0,K.W)(l=>[]),(0,$.t)(1)),this._bind=(0,C.zV)([this._state.level,this._state.options]).pipe((0,G.B)(300),(0,B.p)(([l,{is_public:p}])=>!!l&&!p),(0,y.T)(([l])=>{this._statuses={};const p=this._org.binding("area_management");if(!p)return;let _=(0,I.f_4)(p,"AreaManagement")?.binding(l.id);_&&(this.subscription("lvl-in_use",_.listen().subscribe(d=>this.processBindingChange(d||{},p))),this.subscription("lvl-in_use_bind",_.bind()))})),this._booking_list=(0,C.zV)([this._options,this._state.level]).pipe((0,B.p)(([l,p])=>(l.use_api||l.date>(0,D.D)(Date.now()).valueOf())&&!!p),(0,O.n)(([l,p])=>(0,se.tj)({type:"desk",period_start:(0,z._)((0,_e.o)(l.date||Date.now())),period_end:(0,z._)((0,D.D)(l.date||Date.now())),zones:p.id})),(0,G.B)(200),(0,H.M)(l=>{this._in_use.next(l.map(p=>p.asset_id)),this._checked_in.next(l.filter(p=>p.checked_in).map(p=>p.asset_id))}),(0,$.t)(1)),this._state_change=(0,C.zV)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this.booking_rules,this._options]).pipe((0,G.B)(50),(0,y.T)(function(){var l=(0,x.A)(function*([p,_,d,g,v,u]){r._statuses={};const f=yield r._state.level.pipe((0,le.s)(1)).toPromise();for(const{id:T,bookable:R}of p){const k=_.some(A=>T===A),V=d.some(A=>T===A),F=v.some(A=>T===A),S=g.some(A=>T===A)||k&&r._settings.get("app.desk.auto_checkin"),ie=(0,m.RH)({date:Date.now(),duration:60,host:(0,m.Ny)(),resource:{id:T,zones:[f.parent_id,f.id]}},u)?.hidden;r._statuses[T]=R&&!ie?k||V||S?V||S?"busy":"pending":F?"signs-of-life":"free":"not-bookable"}r.processDesks(p)});return function(p){return l.apply(this,arguments)}}())),this.init()}init(){var t=this;return(0,x.A)(function*(){yield t._org.initialised.pipe((0,U.$)(n=>n)).toPromise(),t.setOptions({enable_booking:!1!==t._settings.get("app.desks.enable_maps")}),t.subscription("bookings",t._booking_list.subscribe()),t.subscription("bind",t._bind.subscribe()),t.subscription("booking_rules",t.booking_rules.subscribe()),t.subscription("changes",t._state_change.subscribe()),t.subscription("desks",t.desk_list.subscribe(n=>t.processDesks(n)))})()}setOptions(t){this._options.next({...this._options.getValue(),...t})}processBindingChange({value:t},n){const s=(t||[]).filter(l=>!["desk","booking"].includes(l.location)),o=(t||[]).filter(l=>"desk"===l.location||"booking"===l.location&&"desk"===l.type);(this._options.getValue().date||Date.now())<=(0,D.D)(Date.now()).valueOf()&&!this._options.getValue().use_api&&(this._in_use.next(o.filter(l=>"booking"===l.location).map(l=>l.map_id||l.asset_id)),this._checked_in.next(o.filter(l=>"booking"===l.location&&l.checked_in).map(l=>l.map_id||l.asset_id)),this._presence.next(o.filter(l=>l.at_location).map(l=>l.map_id||l.asset_id)),this._signs_of_life.next(o.filter(l=>l.signs_of_life).map(l=>l.map_id||l.asset_id)));const r=this._settings.get("app.department_map")||{};for(const l of o)this._users[l.map_id||l.asset_id]=l.staff_name,this._departments[l.map_id||l.asset_id]=r[l.department]||"";this.processDevices(s,n),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},n=this._settings.get("app.explore.colors")||{};for(const s in this._statuses)this._statuses[s]&&(t[`#${s}`]={fill:n[`desk-${this._statuses[s]}`]||n[`${this._statuses[s]}`]||j.U[`${this._statuses[s]}`]});this._state.setStyles("desks",t)}processDevices(t,n){const s=[];for(const o of t){const a=o.x/o.map_width,r=o.y/o.map_height;s.push({track_id:`device:hover:${a},${r}`,location:{x:o.coordinates_from?.includes("right")?1-a:a,y:o.coordinates_from?.includes("bottom")?1-r:r},content:Ie,z_index:20,data:{...o,system:n}})}this._state.setFeatures("devices",s)}processDesks(t){var n=this;const s=[],o=[],a=this._options.getValue();for(const r of t){if(s.push({track_id:`desk:hover:${r.map_id||r.id}`,location:r.id,content:de.Y,full_size:!0,no_scale:!0,data:{id:r.map_id||r.id,map_id:r.name,name:r.name||r.map_id,user:this._users[r.map_id]||r.staff_name,status:this._statuses[r.map_id],department:this._departments[r.map_id]||""},z_index:20}),!r.bookable)continue;let l=!0;const p=function(){var _=(0,x.A)(function*(){if(!l)return;if("free"!==n._statuses[r.id])return(0,m.UG)(`${r.name||"Desk"} is unavailable at this time.`);if(r.groups?.length&&!r.groups.find(f=>(0,m.Ny)().groups.includes(f)))return(0,m.UG)(`You are not allowed to book ${r.name}.`);n._bookings.newForm(),n._bookings.setOptions({type:"desk"}),a.date&&(n._bookings.form.patchValue({date:a.date}),n._bookings.form.patchValue({all_day:!!a.all_day}));let{date:d,duration:g,user:v}=yield n._setBookingTime(n._bookings.form.value.date,n._bookings.form.value.duration,n._options.getValue()?.custom??!1,r);v=v||a.host||(0,m.Ny)();const u=v?.email;n._bookings.form.patchValue({resources:[r],asset_id:r.id,asset_name:r.name,date:d,duration:a.all_day?720:g,map_id:r?.map_id||r?.id,description:r.name,user:v,user_email:u,booking_type:"desk",zones:r.zone?[r.zone?.parent_id,r.zone?.id]:[]}),yield n._bookings.confirmPost().catch(f=>{throw console.log(f),(0,m.UG)(`Failed to book desk ${r.name||r.id}. ${f.message||f.error||f}`),f}),n._users[r.map_id]=(a.host||(0,m.Ny)())?.name,(0,m.VX)(`Successfully booked desk ${r.name||r.id}`)});return function(){return _.apply(this,arguments)}}();["mousedown","touchstart"].forEach(_=>o.push({id:r.id,action:_,priority:10,callback:()=>{l=!0,this.timeout("booking",()=>l=!1)}})),["mouseup","touchend"].forEach(_=>o.push({id:r.id,action:_,priority:10,callback:p}))}this._state.setActions("desks",this._options.getValue().enable_booking?o:[]),this._state.setFeatures("desks",s),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(t,n,s=!1,o=null){var a=this;return(0,x.A)(function*(){let r=null;if(a._settings.get("app.desks.allow_time_changes")){const l=(0,D.D)((0,te.f)(Date.now(),a._settings.get("app.desks.available_period")||90)),_=yield a._dialog.open(pe,{data:{date:t,duration:n,until:l,host:s,resource:o}}).afterClosed().toPromise();if(!_)throw"User cancelled";t=_.date,n=_.duration,r=_.user}return{date:t,duration:n,user:r}})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.KVO(P.O),e.KVO(Y.y),e.KVO(m.h$),e.KVO(ye.n),e.KVO(J.bZ))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac})}return i})();var Te=c(3206),ft=c(5469),gt=c(1257),bt=c(8757);let oe=(()=>{class i extends m.Tv{constructor(t,n,s,o,a){super(),this._org=t,this._state=n,this._settings=s,this._bookings=o,this._dialog=a,this._options=new M.t({}),this._poll=new M.t(0),this.options=this._options.asObservable(),this.levels=this._org.active_levels.pipe((0,y.T)(r=>r.filter(l=>l.tags.includes("parking")))),this.events=(0,C.zV)([this._org.active_building,this._options,this._poll,this._state.options]).pipe((0,O.n)(([r,l,p,{is_public:_}])=>_?(0,w.of)([]):(0,se.tj)({period_start:(0,z._)((0,Te.c)(l.date||Date.now())),period_end:(0,z._)((0,ft.V)(l.date||Date.now())),type:"parking",zones:r?.id})),(0,$.t)(1)),this.existing_event=(0,C.zV)([this._options]).pipe((0,O.n)(([r])=>(0,se.tj)({period_start:(0,z._)((0,_e.o)(r.date||Date.now())),period_end:(0,z._)((0,D.D)(r.date||Date.now())),type:"parking",email:r?.user||(0,m.Ny)()?.email})),(0,$.t)(1)),this.week_events=(0,C.zV)([this._org.active_building,this._options]).pipe((0,O.n)(([r,l])=>(0,se.tj)({period_start:(0,z._)((0,_e.o)(l.date||Date.now())),period_end:(0,z._)((0,te.f)((0,D.D)(l.date||Date.now()),6)),type:"parking",zones:r?.id})),(0,$.t)(1)),this.spaces=this.levels.pipe((0,O.n)(r=>(0,bt.p)(r.map(l=>(0,I.bpY)(l.id,"parking-spaces").pipe((0,y.T)(p=>(p.details instanceof Array?p.details:[]).map(_=>({..._,zone_id:l.id}))))))),(0,y.T)(r=>(0,m.Bq)(r)),(0,$.t)(1)),this.active_spaces=(0,C.zV)([this.spaces,this._state.level]).pipe((0,y.T)(([r,l])=>r.filter(p=>p.zone_id===l.id))),this._users={},this.available_spaces=(0,C.zV)([this.events,this.active_spaces]).pipe((0,y.T)(([r,l])=>l.filter(p=>{const _=r.find(d=>d.asset_id===p.id)?.user_name||p.assigned_to;return this._users[p.id]=_,!_}))),this.week_availablility=(0,C.zV)([this.week_events,this.spaces,this._options]).pipe((0,y.T)(([r,l,{date:p}])=>{const _={};for(let d=0;d<7;d++){const g=(0,te.f)(p,d),v=r.filter(u=>(0,gt.r)(g,u.date));_[g.valueOf()]=l.filter(u=>!v.find(f=>f.asset_id===u.id)).length}return _})),this.subscription("spaces",(0,C.zV)([this.spaces,this.available_spaces]).subscribe(([r,l])=>this._updateParkingSpaces(r,l))),this.setOptions({enable_booking:!1!==this._settings.get("app.parking.enable_maps")}),this.interval("poll",()=>this._poll.next(Date.now()),1e4)}setOptions(t){this._options.next({...this._options.getValue(),...t})}_updateParkingSpaces(t,n){var s=this;const o={},a=[],r=[],l=[],p=this._settings.get("app.explore.colors")||{},_=this._options.getValue();for(const d of t){const g=!!n.find(f=>f.id===d.id),v=g?"free":"busy";if(o[`#${d.map_id}`]={fill:p[`parking-${v}`]||p[`${v}`]||j.U[`${v}`],opacity:.6},a.push({track_id:`parking:hover:${d.map_id}`,location:`${d.map_id}`,content:de.Y,full_size:!0,no_scale:!0,z_index:20,data:{...d,user:this._users[d.id],status:v}}),!g)continue;r.push({zoom_level:1.1,location:`${d.map_id}`,content:`${d.name}\nFree`});const u=function(){var f=(0,x.A)(function*(){if("free"!==v)return(0,m.UG)(`${d.name||"Parking Space"} is unavailable at this time.`);if(d.groups?.length&&!d.groups.find(S=>(0,m.Ny)().groups.includes(S)))return(0,m.UG)(`You are not allowed to book ${d.name}.`);s._bookings.newForm(),s._bookings.setOptions({type:"parking"}),_.date&&(s._bookings.form.patchValue({date:_.date}),s._bookings.form.patchValue({all_day:!!_.all_day}));let{date:T,duration:R,user:k}=yield s._setBookingTime(s._bookings.form.value.date,s._bookings.form.value.duration,s._options.getValue()?.custom??!1,d);k=k||_.host||(0,m.Ny)();const V=k?.email,F=s._state.active_level;s._bookings.form.patchValue({resources:[d],asset_id:d.id,asset_name:d.name,date:T,duration:_.all_day?720:R,map_id:d?.map_id||d?.id,description:d.name,user:k,user_email:V,booking_type:"parking",zones:d.zone?[d.zone?.parent_id,d.zone?.id]:[F.parent_id,F.id]}),yield s._bookings.confirmPost().catch(S=>{throw console.log(S),(0,m.UG)(`Failed to book parking space ${d.name||d.id}. ${S.message||S.error||S}`),S}),(0,m.VX)(`Successfully booked parking space ${d.name||d.id}`)});return function(){return f.apply(this,arguments)}}();l.push({id:d?.map_id||d?.id,action:"click",priority:10,callback:u})}this._state.setActions("parking",_.enable_booking?l:[]),this._state.setStyles("parking",o),this._state.setLabels("parking",r)}_setBookingTime(t,n,s=!1,o=null){var a=this;return(0,x.A)(function*(){let r=null;if(a._settings.get("app.parking.allow_time_changes")){const l=(0,D.D)((0,te.f)(Date.now(),a._settings.get("app.parking.available_period")||90)),_=yield a._dialog.open(pe,{data:{date:t,duration:n,until:l,host:s,resource:o}}).afterClosed().toPromise();if(!_)throw"User cancelled";t=_.date,n=_.duration,r=_.user}return{date:t,duration:n,user:r}})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.KVO(Y.y),e.KVO(P.O),e.KVO(m.h$),e.KVO(ye.n),e.KVO(J.bZ))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac})}return i})();c(8796);var me=c(2185);c(4810),c(9420);var Ot=c(735),Rt=c(2372);let St=(()=>{class i{constructor(t,n,s){this._org=t,this._settings=n,this._maps_people=s,this._emergency_contacts=new M.t([]),this._filter=new M.t(""),this._loading=new M.t(!1),this.emergency_contacts=this._emergency_contacts.asObservable(),this._role_assigned_contacts=this._org.active_building.pipe((0,B.p)(o=>!!o),(0,O.n)(o=>(0,I.bpY)(o.id,"emergency_contacts")),(0,y.T)(({details:o})=>o?.contacts||[]),(0,$.t)(1)),this._user_search=this._filter.pipe((0,G.B)(400),(0,H.M)(()=>this._loading.next(!0)),(0,O.n)(o=>o?.length>2?this.search_fn(o).pipe((0,K.W)(()=>(0,w.of)([]))):(0,w.of)([])),(0,$.t)(1)),this._space_search=this._filter.pipe((0,G.B)(400),(0,H.M)(()=>this._loading.next(!0)),(0,O.n)(o=>o?.length>2?(0,I.BbB)({q:o,zone_id:this._org.organisation.id}).pipe((0,y.T)(({data:a})=>a.filter(r=>r.map_id).map(r=>new Ot.$({...r,level:this._org.levelWithID(r.zones)})))):(0,w.of)([])),(0,K.W)(()=>[])),this._maps_people_search=(0,C.zV)([this._maps_people.available$,this._filter,this._org.active_building]).pipe((0,G.B)(1e3),(0,O.n)(([o,a])=>o&&a.length>2?mapsindoors?.services.LocationsService.getLocations({q:a}):(0,w.of)([])),(0,y.T)(o=>o.map(a=>({id:a.properties?.externalId||a.properties?.roomId||a.roomId||a.id,map_id:a.properties?.externalId||a.properties?.roomId||a.roomId||"",type:"feature",name:a.properties?.name||"",description:`${a.properties?.roomId} , Level ${a.properties?.floorName}`}))),(0,$.t)(1)),this._points_of_interest=this._org.active_building.pipe((0,B.p)(o=>!!o),(0,O.n)(()=>(0,I.WsZ)(this._org.building.id,{name:"maps_features"}).pipe((0,K.W)(()=>(0,w.of)({details:[]})))),(0,y.T)(o=>{const a=[];for(const r of o){const l=r.metadata.points_of_interest;if(l)for(const p of l.details)a.push({id:p.id,type:"feature",name:p.name,description:"",zone:r.zone})}return a})),this.search_results=(0,C.zV)([this._filter,this._space_search,this._user_search,this._emergency_contacts,this._role_assigned_contacts,this._points_of_interest,this._maps_people_search]).pipe((0,y.T)(([o,a,r,l,p,_,d])=>{const g=o.toLowerCase(),v=[...d,...a.filter(u=>u.email.toLowerCase().includes(g)||u.name.toLowerCase().includes(g)||u.display_name.toLowerCase().includes(g)).map(u=>({id:u.id,type:"space",name:u.display_name||u.name,description:`Capacity: ${u.capacity} `})),...(0,m.Bq)(p.map(u=>u.roles.map(f=>({id:u.email,type:f||"contact",is_role:!0,name:u.name,description:u.email})))).filter(u=>u.name.toLowerCase().includes(g)||u.description.toLowerCase().includes(g)||u.type.toLowerCase().includes(g)),...l.map(u=>({id:u.email,type:u.type||"contact",is_role:!0,name:u.name,description:u.email})).filter(u=>u.name.toLowerCase().includes(g)||u.description.toLowerCase().includes(g)||u.type.toLowerCase().includes(g)),...r.map(u=>({id:u.email,type:"user",name:u.name,description:u.email})),..._.filter(u=>u.name.toLowerCase().includes(g)).map(u=>({id:u.id,type:"feature",name:u.name,description:"",zone:u.zone?.id}))];return v.sort((u,f)=>u.name.localeCompare(f.name)),v}),(0,H.M)(()=>this._loading.next(!1)),(0,$.t)(1)),this.loading=this._loading.asObservable(),this.search_fn=o=>this._settings.get("app.basic_user_search")?(0,I.n1$)({q:o,authority_id:(0,I.kup)()?.id}).pipe((0,y.T)(a=>a.data)):(0,Rt.N8)(o),this.search_results.subscribe(),this.init()}init(){var t=this;return(0,x.A)(function*(){yield t._org.initialised.pipe((0,U.$)(s=>s)).toPromise();const n=(0,me.WS)(t._org.binding("location_services"),"LocationServices");if(n){const s=n.binding("emergency_contacts");s.listen().subscribe(o=>{const a=[];for(const r in o)for(const l of o[r])a.push({...l,type:r});t._emergency_contacts.next(a)}),s.bind()}})()}setFilter(t){this._filter.next(t)}static#e=this.\u0275fac=function(n){return new(n||i)(e.KVO(Y.y),e.KVO(m.h$),e.KVO(m._e))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var $t=c(5080),he=c(9771),Oe=c(1134);const Lt=["input"],Ft=["button"];function Nt(i,h){1&i&&e.nrm(0,"mat-spinner",10),2&i&&e.Y8G("diameter",32)}function Xt(i,h){1&i&&(e.j41(0,"mat-option",13),e.pXf(1,4),e.k0s())}function wt(i,h){if(1&i&&(e.j41(0,"mat-option",14)(1,"div",15)(2,"div",16)(3,"div",17),e.EFF(4),e.k0s(),e.j41(5,"div",18),e.EFF(6),e.k0s()(),e.j41(7,"div",19),e.EFF(8),e.k0s()()()),2&i){const t=h.$implicit;e.Y8G("value",t),e.R7$(4),e.JRh(t.name),e.R7$(2),e.JRh(t.description),e.R7$(2),e.SpI(" ",t.type," ")}}function Pt(i,h){if(1&i&&(e.qex(0),e.DNE(1,Xt,2,0,"mat-option",11),e.nI1(2,"async"),e.DNE(3,wt,9,4,"mat-option",12),e.nI1(4,"async"),e.nI1(5,"slice"),e.bVm()),2&i){let t;const n=e.XpG();e.R7$(),e.Y8G("ngIf",!(null!=(t=e.bMT(2,2,n.results))&&t.length)),e.R7$(2),e.Y8G("ngForOf",e.brH(5,6,e.bMT(4,4,n.results),0,5))}}let Re=(()=>{class i extends m.Tv{checkClick(t){this._el?.nativeElement?.contains(t.target)||(this.show=!1,this._input_el?.nativeElement?.blur())}constructor(t,n,s,o){super(),this._el=t,this._search=n,this._router=s,this._route=o,this.show=!1,this.search_str="",this.right_size=!1,this.results=this._search.search_results,this.loading=this._search.loading,this.setFilter=a=>this._search.setFilter(a),this.setItem=a=>a instanceof Object?this.select(a):this.setFilter(a),this.onTouch=a=>this.checkClick(a)}ngOnInit(){this.checkButtonPosition()}focusInput(){this._input_el?.nativeElement&&this.timeout("focus",()=>this._input_el.nativeElement.focus(),300)}showSearch(){this.show=!0,this.focusInput()}closeSearch(t){this.show=!1,this.search_str="",this.setFilter(""),this._input_el?.nativeElement&&(this._input_el.nativeElement.focus(),this._input_el.nativeElement.blur())}select(t){this.search_str=t.name;const n={};n["space"===t.type?"space":"feature"===t.type?"feature":"user"]=t.id,this._router.navigate([],{relativeTo:this._route,queryParams:n})}checkButtonPosition(){const t=window.innerWidth,n=this._button_el.nativeElement.getBoundingClientRect();this.right_size=n.left+n.width/2>t/2}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(e.aKT),e.rXU(St),e.rXU(L.Ix),e.rXU(L.nX))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["explore-search"]],viewQuery:function(n,s){if(1&n&&(e.GBs(Lt,5),e.GBs(Ft,7)),2&n){let o;e.mGM(o=e.lsd())&&(s._input_el=o.first),e.mGM(o=e.lsd())&&(s._button_el=o.first)}},hostBindings:function(n,s){1&n&&e.bIt("click",function(a){return s.checkClick(a)},!1,e.EBC)("touchstart",function(a){return s.onTouch(a)},!1,e.EBC)},features:[e.Vt3],decls:14,vars:20,consts:()=>{let t,n;return t=$localize`:␟7a428104a6c33787961fda306f9c518f89fb0261␟6939663044582448373:Search for...`,n=$localize`:␟0c720c4e60410fcfcd8582a32297bdd397620830␟3411517965707112535: No matches found `,[["button",""],["origin","matAutocompleteOrigin"],["input",""],["auto","matAutocomplete"],n,["icon","","matRipple","",1,"bg-base-200","m-2",3,"resize","click"],["role","search","tabindex","0","matRipple","","matAutocompleteOrigin","",1,"absolute","top-1/2","-translate-y-1/2","bg-base-100","flex","items-center","z-10","overflow-hidden","outline-none","px-4","max-w-[calc(100vw-7rem)]",3,"click"],["keyboard","","placeholder",t,1,"flex-1","text-base","border-none","outline-none",3,"ngModelChange","blur","ngModel","matAutocomplete","matAutocompleteConnectedTo"],["class","mr-2",3,"diameter",4,"ngIf"],[4,"ngIf"],[1,"mr-2",3,"diameter"],["class","pointer-events-none",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none"],[3,"value"],[1,"flex","items-center","leading-tight","w-[22rem]","max-w-[calc(100vw-2rem)]"],[1,"flex-1","w-1/2","overflow-hidden"],[1,"truncate","w-full"],[1,"text-xs"],[1,"text-xs","font-bold","p-2","capitalize","text-white","bg-base-300","rounded"]]},template:function(n,s){if(1&n){const o=e.RV6();e.j41(0,"button",5,0),e.bIt("resize",function(){return e.eBV(o),e.Njj(s.checkButtonPosition())},!1,e.tSv)("click",function(r){return e.eBV(o),e.Njj(s.show?s.closeSearch(r):s.showSearch())}),e.j41(2,"app-icon"),e.EFF(3),e.k0s()(),e.j41(4,"div",6,1),e.bIt("click",function(){return e.eBV(o),e.Njj(s.focusInput())}),e.j41(6,"input",7,2),e.mxI("ngModelChange",function(r){return e.eBV(o),e.DH7(s.search_str,r)||(s.search_str=r),e.Njj(r)}),e.bIt("ngModelChange",function(r){return e.eBV(o),e.Njj(s.setItem(r))})("blur",function(){return e.eBV(o),e.Njj(s.show=!!s.search_str)}),e.k0s(),e.DNE(8,Nt,1,1,"mat-spinner",8),e.nI1(9,"async"),e.k0s(),e.j41(10,"mat-autocomplete",null,3),e.DNE(12,Pt,6,10,"ng-container",9),e.nI1(13,"async"),e.k0s()}if(2&n){const o=e.sdS(5),a=e.sdS(11);e.R7$(3),e.JRh(s.show||s.search_str?"close":"search"),e.R7$(),e.AVh("right-0",s.right_size)("-translate-x-14",s.right_size)("left-0",!s.right_size)("translate-x-14",!s.right_size)("show",s.show||s.search_str),e.R7$(2),e.R50("ngModel",s.search_str),e.Y8G("matAutocomplete",a)("matAutocompleteConnectedTo",o),e.R7$(2),e.Y8G("ngIf",e.bMT(9,16,s.loading)),e.R7$(4),e.Y8G("ngIf",!0!==e.bMT(13,18,s.loading)&&(s.show||s.search_str))}},dependencies:[E.Sq,E.bT,Z.R,$t.e,he.$3,X.wT,he.pN,he.Vn,X.r6,Oe.LG,b.me,b.BC,b.vS,E.Jj,E.P9],styles:["[_nghost-%COMP%]{z-index:99;position:relative}[role=search][_ngcontent-%COMP%]{height:3rem;width:0;border-radius:1.5rem;border:1px solid var(--b3);transition:width .2s opacity .2s;opacity:0;pointer-events:none}[role=search].show[_ngcontent-%COMP%]{width:24rem;opacity:1;pointer-events:auto}\n\n/*# sourceMappingURL=explore-search.component.ts-angular-inline--77.css.map*/"]})}return i})();var Se=c(8303);c(640);var $e=c(6301),Bt=(c(2035),c(795),c(3208)),Dt=c(7984);let At=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.$C({type:i});static#s=this.\u0275inj=e.G2t({imports:[E.MD,N.hI,b.YN,b.X1,ae.mV,Xe.z_,we.jc,Pe.c,je.S]})}return i})();e.wjB(Se.x,[E.Sq,E.bT,q.I,Bt.U],[]),e.wjB($e.t,[E.bT,Z.R,re.rl,re.TL,X.r6,J.tx,Dt.fg,Oe.LG,b.me,b.BC,b.cb,b.j4,b.JD,xe.y,Ce.$],[E.Jj,E.vh]);var Le=c(2168),Ut=c(4658),fe=c(1034),Fe=c(4992);function Yt(i,h){if(1&i){const t=e.RV6();e.j41(0,"div",3)(1,"div",4),e.EFF(2,"A"),e.k0s(),e.j41(3,"mat-slider",5)(4,"input",6),e.bIt("ngModelChange",function(s){e.eBV(t);const o=e.XpG();return e.Njj(o.applySetting("font_size",s))}),e.k0s()(),e.j41(5,"div",7),e.EFF(6,"A"),e.k0s(),e.j41(7,"div",8),e.EFF(8),e.k0s()()}if(2&i){const t=e.XpG();e.R7$(3),e.Y8G("min",10)("max",24)("step",2),e.R7$(),e.Y8G("ngModel",t.font_size),e.R7$(4),e.SpI(" ",t.font_size,"px ")}}let Zt=(()=>{class i extends m.Tv{constructor(t){super(),this._settings=t,this.applySetting=(n,s)=>this.timeout("apply_setting",()=>this._settings.saveUserSetting(n,s),1e3)}get dark_mode(){return"dark"===this._settings.get("theme")}get can_change_dark_mode(){return!!this._settings.get("app.general.dark_mode")}get accessible(){return!!this._settings.get("accessible")}get font_size(){return this._settings.get("font_size")||16}setDarkMode(t){this.timeout("dark_mode",()=>{const n=this._settings.get("theme");t&&"dark"!==n?this._settings.setTheme("dark"):!t&&"dark"===n&&this._settings.setTheme("light")},100)}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(m.h$))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["accessibility-controls"]],features:[e.Vt3],decls:9,vars:3,consts:[["matRipple","",1,"flex","items-center","justify-between","hover:bg-base-200","w-full","p-2","rounded",3,"click"],[3,"ngModelChange","ngModel"],["class","flex items-center pl-2 space-x-4",4,"ngIf"],[1,"flex","items-center","pl-2","space-x-4"],[1,"text-sm"],[1,"flex-1","w-px","min-w-0","text-[16px]",3,"min","max","step"],["matSliderThumb","",1,"text-[16px]",3,"ngModelChange","ngModel"],[1,"text-2xl"],[1,"text-base","py-1","px-2","rounded","bg-base-300","text-base-content","my-2"]],template:function(n,s){1&n&&(e.j41(0,"button",0),e.bIt("click",function(){return s.setDarkMode(!s.dark_mode)}),e.j41(1,"div"),e.EFF(2,"Dark Mode"),e.k0s(),e.j41(3,"mat-slide-toggle",1),e.bIt("ngModelChange",function(a){return s.setDarkMode(a)}),e.k0s()(),e.j41(4,"button",0),e.bIt("click",function(){return s.applySetting("accessible",!s.accessible)}),e.j41(5,"div"),e.EFF(6,"Text Size"),e.k0s(),e.j41(7,"mat-slide-toggle",1),e.bIt("ngModelChange",function(a){return s.applySetting("accessible",a)}),e.k0s()(),e.DNE(8,Yt,9,5,"div",2)),2&n&&(e.R7$(3),e.Y8G("ngModel",s.dark_mode),e.R7$(4),e.Y8G("ngModel",s.accessible),e.R7$(),e.Y8G("ngIf",s.accessible))},dependencies:[E.bT,X.r6,Fe.IV,Fe.OU,ae.sG,b.me,b.BC,b.vS]})}return i})();const Kt=["app-explore",""],Jt=()=>({controls:!0});function Ht(i,h){1&i&&e.nrm(0,"explore-search")}function Wt(i,h){1&i&&(e.j41(0,"div",19),e.nrm(1,"accessibility-controls"),e.k0s())}function Qt(i,h){if(1&i){const t=e.RV6();e.j41(0,"button",23),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(3);return e.Njj(o.setLevel(s))}),e.EFF(1),e.k0s()}if(2&i){const t=h.$implicit;e.R7$(),e.SpI(" ",t.display_name||t.name," ")}}function qt(i,h){if(1&i&&(e.qex(0),e.j41(1,"button",21)(2,"div",13),e.EFF(3,"Level"),e.k0s(),e.j41(4,"app-icon",12),e.EFF(5,"keyboard_arrow_down"),e.k0s()(),e.j41(6,"mat-menu",null,1),e.DNE(8,Qt,2,1,"button",22),e.nI1(9,"async"),e.k0s(),e.bVm()),2&i){const t=e.sdS(7),n=e.XpG(2);e.R7$(),e.Y8G("matMenuTriggerFor",t),e.R7$(7),e.Y8G("ngForOf",e.bMT(9,2,n.levels))}}function es(i,h){if(1&i&&(e.j41(0,"div",25),e.nrm(1,"div",26),e.j41(2,"div",27),e.EFF(3),e.k0s()()),2&i){const t=h.$implicit;e.R7$(),e.xc7("background-color",t.color),e.R7$(2),e.SpI(" ",t.name," ")}}function ts(i,h){if(1&i&&(e.qex(0),e.j41(1,"button",21)(2,"div",13),e.EFF(3,"Legend"),e.k0s(),e.j41(4,"app-icon",12),e.EFF(5,"keyboard_arrow_down"),e.k0s()(),e.j41(6,"mat-menu",null,2),e.DNE(8,es,4,3,"div",24),e.k0s(),e.bVm()),2&i){const t=e.sdS(7),n=e.XpG(2);e.R7$(),e.Y8G("matMenuTriggerFor",t),e.R7$(7),e.Y8G("ngForOf",n.legend)}}function ss(i,h){if(1&i&&(e.qex(0),e.j41(1,"div",20),e.DNE(2,qt,10,4,"ng-container",7),e.nI1(3,"async"),e.DNE(4,ts,9,2,"ng-container",7),e.k0s(),e.bVm()),2&i){let t;const n=e.XpG();e.R7$(2),e.Y8G("ngIf",null==(t=e.bMT(3,2,n.levels))?null:t.length),e.R7$(2),e.Y8G("ngIf",n.legend.length)}}function ns(i,h){if(1&i){const t=e.RV6();e.j41(0,"button",29),e.nI1(1,"async"),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.setLevel(s))}),e.j41(2,"div",30),e.EFF(3),e.k0s()()}if(2&i){let t;const n=h.$implicit,s=e.XpG(2);e.AVh("opacity-30",n.id!==(null==(t=e.bMT(1,3,s.level))?null:t.id)),e.R7$(3),e.SpI(" ",n.display_name||n.name," ")}}function os(i,h){if(1&i){const t=e.RV6();e.qex(0),e.j41(1,"button",11),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.show_levels=!s.show_levels)}),e.j41(2,"app-icon",12),e.EFF(3,"corporate_fare"),e.k0s(),e.j41(4,"div",13),e.EFF(5,"Level"),e.k0s(),e.j41(6,"app-icon",12),e.EFF(7),e.k0s()(),e.j41(8,"div",14)(9,"div",15),e.DNE(10,ns,4,5,"button",28),e.nI1(11,"async"),e.k0s()(),e.nrm(12,"hr",16),e.bVm()}if(2&i){const t=e.XpG();e.R7$(7),e.JRh(t.show_levels?"keyboard_arrow_up":"keyboard_arrow_down"),e.R7$(),e.Y8G("@show",t.show_levels?"show":"hide"),e.R7$(2),e.Y8G("ngForOf",e.bMT(11,3,t.levels))}}function is(i,h){if(1&i&&(e.j41(0,"div",25),e.nrm(1,"div",26),e.j41(2,"div",27),e.EFF(3),e.k0s()()),2&i){const t=h.$implicit;e.R7$(),e.xc7("background-color",t.color),e.R7$(2),e.SpI(" ",t.name," ")}}function as(i,h){if(1&i){const t=e.RV6();e.qex(0),e.j41(1,"button",11),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.show_legend=!s.show_legend)}),e.j41(2,"app-icon",12),e.EFF(3,"place"),e.k0s(),e.j41(4,"div",13),e.EFF(5,"Legend"),e.k0s(),e.j41(6,"app-icon",12),e.EFF(7),e.k0s()(),e.j41(8,"div",14)(9,"div",15),e.DNE(10,is,4,3,"div",24),e.k0s()(),e.nrm(11,"hr",16),e.bVm()}if(2&i){const t=e.XpG();e.R7$(7),e.JRh(t.show_legend?"keyboard_arrow_up":"keyboard_arrow_down"),e.R7$(),e.Y8G("@show",t.show_legend?"show":"hide"),e.R7$(2),e.Y8G("ngForOf",t.legend)}}let Ne=(()=>{class i extends m.Tv{get logo(){return"dark"===this._settings.get("theme")?this._settings.get("app.logo_dark"):this._settings.get("app.logo_light")}get time(){return(0,Te.c)(Date.now())}get hide_zones(){return this._settings.get("app.hide_zones")}updateZoom(t){this._state.setPositions(t,this._state.positions.center)}updateCenter(t){this._state.setPositions(this._state.positions.zoom,t)}toggleZones(t){var n=this;return(0,x.A)(function*(){const s=yield n.options.pipe((0,le.s)(1)).toPromise(),o=t?s.disable.filter(a=>"zones"!==a&&"devices"!==a)||[]:(0,m.Am)([...s.disable||[],"zones","devices"]);n.setOptions({disable:o})})()}get can_search(){return!!this._settings.get("app.explore.search_enabled")}constructor(t,n,s,o,a,r,l,p,_,d,g,v,u){super(),this._state=t,this._s=n,this._desks=s,this._zones=o,this._parking=a,this._settings=r,this._org=l,this._spaces=p,this._dialog=_,this._route=d,this._router=g,this._space_pipe=v,this._maps=u,this.reset_delay=180,this.show_levels=!0,this.show_legend=!1,this.show_accessibility=!1,this.legend=[{id:"free",name:"Space Available",color:"#43a047"},{id:"busy",name:"Space In Use",color:"#e53935"},{id:"pending",name:"Space Pending",color:"#ffb300"},{id:"not-bookable",name:"Space Not-bookable",color:"#ccc"}],this.levels=(0,C.zV)([this._org.active_region,this._org.active_building]).pipe((0,y.T)(([f,T])=>(this._settings.get("app.use_region")?(0,m.Bq)(this._org.buildings.filter(R=>f.id===R.parent_id).map(R=>this._org.levelsForBuilding(R).map(k=>({...k,display_name:`${R.display_name} - ${k.display_name}`})))):this._org.levelsForBuilding(T))||[]),(0,H.M)(f=>console.log("Levels:",f))),this.level=this._state.level,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options,this.locate="",this.onMouse=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.onTouch=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.setOptions=f=>this._state.setOptions(f),this.setLevel=f=>this._state.setLevel(f.id),this.use_mapsindoors$=this._maps.available$}ngOnInit(){var t=this;return(0,x.A)(function*(){(location.hash.includes("public=true")||location.search.includes("public=true"))&&t._state.setOptions({is_public:!0}),yield t._spaces.initialised.pipe((0,U.$)(n=>n)).toPromise(),t._desks.setOptions({custom:!0}),t.reset_delay=t._settings.get("app.inactivity_timeout_secs")||180,t.resetKiosk(!1),N.eW.enabled="true"===localStorage.getItem("OSK.enabled"),t.subscription("level",t._state.level.subscribe(()=>t.timeout("update_location",()=>{t._state.setFeatures("_located",[])}))),t.subscription("route.query",t._route.queryParamMap.subscribe(function(){var n=(0,x.A)(function*(s){if(s.has("level")){(0,m.Rm)("Explore","Level changed to:",s.get("level")),t._state.setLevel(s.get("level"));const o=t._org.levelWithID([s.get("level")]);if(!o)return;const a=t._org.buildings.find(r=>o.parent_id===r.id);if(!a)return;t._org.building=a}if(t._state.setFeatures("_located",[]),s.has("space"))(0,m.Rm)("Explore","Focusing on space:",s.get("space")),t.locateSpace(s.get("space"));else if(s.has("user")){(0,m.Rm)("Explore","Focusing on user:",s.get("user"));let o=t._settings.value("last_search");if((!o||s.get("user")!==o.email)&&(o=null,o=yield(0,W.SZ)(s.get("user")).toPromise()),!o)return(0,m.UG)(`Unable to user details for ${s.get("user")}`);t.locateUser(o instanceof Array?o[0]:o).catch(a=>{(0,m.UG)(`Unable to locate ${s.get("user")}`),t._router.navigate([],{relativeTo:t._route,queryParams:{}})})}else s.has("feature")?((0,m.Rm)("Explore","Focusing on feature:",s.get("feature")),t.timeout("update_location",()=>{t._state.setFeatures("_located",[{location:s.get("feature"),content:N.VT,data:{}}])})):s.has("locate")?((0,m.Rm)("Explore","Focusing on location:",s.get("locate")),t.locate=s.get("locate"),t.timeout("update_location",()=>{t._state.setFeatures("_located",[{location:s.get("locate"),content:N.VT,data:{}}])})):t.timeout("update_location",()=>{t._state.setFeatures("_located",[])})});return function(s){return n.apply(this,arguments)}}()))})()}locateSpace(t){var n=this;return(0,x.A)(function*(){const s=yield n._space_pipe.transform(t);if(!s)return;n._state.setLevel(n._org.levelWithID(s.zones)?.id);const o={location:s.map_id,content:N.VT,data:{message:`${s.display_name||s.name} is here`}};n.timeout("update_location",()=>n._state.setFeatures("_located",[o]))})()}locateUser(t){var n=this;return(0,x.A)(function*(){let s=n._org.binding("location_services");if(!s)return;"string"==typeof s&&(s={system_id:s,module:"LocationServices"});const a=(yield(0,I.f_4)(s.system_id,s.module).execute("locate_user",[t.email,t.username||t.id])).map(_=>new W.g8(_));if(a.sort((_,d)=>s.priority.indexOf(_.type)-s.priority.indexOf(d.type)),!a?.length)throw"No locations for the given user";n._state.setLevel(n._org.levelWithID([a[0]?.level])?.id);const r=a[0].position,{coordinates_from:l}=a[0],p={location:"wireless"===a[0].type?{x:l?.includes("right")?1-r.x:r.x,y:l?.includes("bottom")?1-r.y:r.y}:r,content:"wireless"===a[0].type?N.o:N.VT,z_index:99,data:{message:`${t.name} is here`,radius:a[0].variance,last_seen:a[0].last_seen}};n.timeout("update_location",()=>{n._state.setFeatures("_located",[p])})})()}resetKiosk(t=!0){document.activeElement?.blur&&document.activeElement?.blur();const n=localStorage.getItem("KIOSK.level");this._state.setPositions(1,{x:.5,y:.5}),n&&this._state.setLevel(n),this._dialog.closeAll(),t&&this._router.navigate(["/"])}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(P.O),e.rXU(j.s),e.rXU(ne),e.rXU(ee),e.rXU(oe),e.rXU(m.h$),e.rXU(me.yb),e.rXU(Le.bh),e.rXU(J.bZ),e.rXU(L.nX),e.rXU(L.Ix),e.rXU(Q.J),e.rXU(m._e))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["","app-explore",""]],hostBindings:function(n,s){1&n&&e.bIt("mousedown",function(){return s.onMouse()},!1,e.tSv)("touchstart",function(){return s.onTouch()},!1,e.tSv)},features:[e.Jv_([j.s,ne,ee,oe,Q.J]),e.Vt3],attrs:Kt,decls:39,vars:35,consts:[["accessibility_controls",""],["levelMenu","matMenu"],["legendMenu","matMenu"],["topbar","",1,"relative","flex","items-center","justify-between","px-4","py-2","border-b","border-base-300","bg-base-100","text-base-content"],["matRipple","","routerLink","/",1,"text-2xl","rounded","p-2"],[1,"text-primary"],[1,"absolute","top-1/2","-translate-y-1/2","right-2","flex","items-center"],[4,"ngIf"],["icon","","matRipple","","customTooltip","",1,"bg-base-200","flex","sm:hidden",3,"content"],[1,"flex","flex-1","h-1/2"],["sidebar","",1,"w-[20rem]","hidden","sm:block","bg-base-100","text-base-content","border-r","border-base-300","px-2","py-4"],["btn","","matRipple","",1,"flex","items","clear","w-full","space-x-4","hover:bg-base-200",3,"click"],[1,"text-2xl"],[1,"flex-1","text-left","font-medium"],[1,"px-8"],[1,"py-4","space-y-2"],[1,"w-[calc(100%-4rem)]","mx-auto"],[1,"relative","flex-1","h-full"],[3,"zoomChange","centerChange","src","zoom","center","styles","features","actions","labels","options","focus"],[1,"bg-base-100","rounded","p-2","w-[18rem]"],["options","",1,"flex","sm:hidden","items-center","bg-base-content","text-base-100","p-2","space-x-2"],["btn","","matRipple","",1,"clear","text-base-100",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],["class","flex items-center py-2 px-4 rounded hover:bg-base-200 w-full space-x-4",4,"ngFor","ngForOf"],[1,"flex","items-center","py-2","px-4","rounded","hover:bg-base-200","w-full","space-x-4"],[1,"h-3","w-3","rounded-full"],[1,"text-left","opacity-60"],["btn","","matRipple","","class","clear hover:bg-base-200 hover:opacity-100 w-full",3,"opacity-30","click",4,"ngFor","ngForOf"],["btn","","matRipple","",1,"clear","hover:bg-base-200","hover:opacity-100","w-full",3,"click"],[1,"text-left","w-full"]],template:function(n,s){if(1&n){const o=e.RV6();e.j41(0,"div",3)(1,"a",4),e.EFF(2," Place"),e.j41(3,"span",5),e.EFF(4,"OS"),e.k0s()(),e.j41(5,"div",6),e.DNE(6,Ht,1,0,"explore-search",7),e.j41(7,"button",8)(8,"app-icon"),e.EFF(9,"accessible"),e.k0s()(),e.DNE(10,Wt,2,0,"ng-template",null,0,e.C5r),e.k0s()(),e.DNE(12,ss,5,4,"ng-container",7),e.nI1(13,"async"),e.j41(14,"div",9)(15,"div",10),e.DNE(16,os,13,5,"ng-container",7),e.nI1(17,"async"),e.DNE(18,as,12,3,"ng-container",7),e.j41(19,"button",11),e.bIt("click",function(){return e.eBV(o),e.Njj(s.show_accessibility=!s.show_accessibility)}),e.j41(20,"app-icon",12),e.EFF(21,"accessible"),e.k0s(),e.j41(22,"div",13),e.EFF(23," Accessibility "),e.k0s(),e.j41(24,"app-icon",12),e.EFF(25),e.k0s()(),e.j41(26,"div",14)(27,"div",15),e.nrm(28,"accessibility-controls"),e.k0s()(),e.nrm(29,"hr",16),e.k0s(),e.j41(30,"div",17)(31,"interactive-map",18),e.nI1(32,"async"),e.nI1(33,"async"),e.nI1(34,"async"),e.nI1(35,"async"),e.nI1(36,"async"),e.nI1(37,"async"),e.nI1(38,"async"),e.bIt("zoomChange",function(r){return e.eBV(o),e.Njj(s.updateZoom(r))})("centerChange",function(r){return e.eBV(o),e.Njj(s.updateCenter(r))}),e.k0s()()()}if(2&n){let o,a,r,l;const p=e.sdS(11);e.R7$(6),e.Y8G("ngIf",s.can_search),e.R7$(),e.Y8G("content",p),e.R7$(5),e.Y8G("ngIf",(null==(o=e.bMT(13,16,s.levels))?null:o.length)||s.legend.length),e.R7$(4),e.Y8G("ngIf",null==(a=e.bMT(17,18,s.levels))?null:a.length),e.R7$(2),e.Y8G("ngIf",s.legend.length),e.R7$(7),e.JRh(s.show_accessibility?"keyboard_arrow_up":"keyboard_arrow_down"),e.R7$(),e.Y8G("@show",s.show_accessibility?"show":"hide"),e.R7$(5),e.Y8G("src",e.bMT(32,20,s.url))("zoom",null==(r=e.bMT(33,22,s.positions))?null:r.zoom)("center",null==(l=e.bMT(34,24,s.positions))?null:l.center)("styles",e.bMT(35,26,s.styles))("features",e.bMT(36,28,s.features))("actions",e.bMT(37,30,s.actions))("labels",e.bMT(38,32,s.labels))("options",e.lJ4(34,Jt))("focus",s.locate)}},dependencies:[E.Sq,E.bT,L.Wk,Z.R,ue.S,q.I,fe.kk,fe.fb,fe.Cp,X.r6,Re,Zt,E.Jj],styles:["[_nghost-%COMP%]{position:absolute;display:flex;flex-direction:column;inset:0;background-color:var(--b2)}hr[_ngcontent-%COMP%]{margin-top:.5rem!important;margin-bottom:.5rem!important}\n\n/*# sourceMappingURL=explore.component.ts-angular-inline--81.css.map*/"],data:{animation:[m.Ft]}})}return i})();const rs=[{path:"",component:Ne},{path:":search_type",component:Ne}];let ls=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.$C({type:i});static#s=this.\u0275inj=e.G2t({imports:[E.MD,L.iI.forChild(rs),N.hI,Le.lx,Ut.u,b.YN,At]})}return i})()}}]);
//# sourceMappingURL=apps_visitor-kiosk_src_app_explore_module_ts.js.map