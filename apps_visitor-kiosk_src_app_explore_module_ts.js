"use strict";(self.webpackChunkvisitor_kiosk=self.webpackChunkvisitor_kiosk||[]).push([["apps_visitor-kiosk_src_app_explore_module_ts"],{4894:(Wt,me,_)=>{_.r(me),_.d(me,{AppExploreModule:()=>Kt});var x=_(6575),S=_(9794),f=_(8849),N=_(5077),le=_(9293),Me=_(2698),Se=_(3517),Ie=_(7687),we=_(1502),v=_(1670),u=_(7109),$=_(7627),D=_(4955),A=_(855),e=_(163),J=_(257);_(1268),_(162);var y=_(2141),j=_(6939),q=_(8377),H=(_(982),_(1970),_(8550),_(942)),R=_(9229),z=(_(7023),_(5046)),b=_(7422),Ue=_(4186),K=_(4888);function Fe(n,m){if(1&n&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"thermostat"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij("",t.temp,"\u02daF")}}function Be(n,m){if(1&n&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"opacity"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&n){const t=e.oxw();e.xp6(4),e.hij("",t.humidity,"%")}}function De(n,m){1&n&&(e.TgZ(0,"div",5)(1,"app-icon",6),e._uU(2,"error"),e.qZA()())}let ge=(()=>{class n{constructor(t){this._details=t,this.temp=this._details.temp||0,this.humidity=this._details.humidity||0}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(N.ui))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-sensor-info"]],decls:4,vars:3,consts:[[1,"absolute","center","bg-base-100","rounded-lg","border","border-base-200","p-2","text-xl"],["class","flex items-center space-x-2 whitespace-nowrap pr-2",4,"ngIf"],["class","absolute top-0 right-0 rounded-full translate-x-1/2 -translate-y-1/2 bg-base-100 border border-base-200",4,"ngIf"],[1,"flex","items-center","space-x-2","whitespace-nowrap","pr-2"],[1,""],[1,"absolute","top-0","right-0","rounded-full","translate-x-1/2","-translate-y-1/2","bg-base-100","border","border-base-200"],[1,"text-error","text-xl"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Fe,5,1,"div",1)(2,Be,5,1,"div",1)(3,De,3,0,"div",2),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngIf",s.temp),e.xp6(1),e.Q6J("ngIf",s.humidity),e.xp6(1),e.Q6J("ngIf",s.temp>82))},dependencies:[x.O5,K.o]})}return n})();var L=_(8159);let W=(()=>{class n extends u.cx{constructor(t,o,s){super(),this._state=t,this._org=o,this._settings=s,this._statuses={},this._count_key={},this._location={},this._capacity={},this._draw={},this._points={},this._features=[],this._bind=(0,L.aj)([this._org.active_building,this._state.level]).pipe((0,z.h)(([a,i])=>!!a&&!!i),(0,b.U)(([a,i])=>{this._statuses={};let r=this._org.binding("area_management");if(!r)return;const l=(0,y.rTZ)(r,"AreaManagement").binding(`${i.id}:areas`);this.subscription("zones",l.listen().subscribe(p=>this.parseData(p))),this.subscription("binding",l.bind())})),this.init()}init(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(s=>s)).toPromise();const o=yield Promise.all(t._org.levels.map(s=>(0,y.rlq)(s.id,"map_regions").toPromise()));for(const s of o){const a=s?.details?.areas;if(a)for(const i of a){const{capacity:r,hide_label:l,label_location:p,draw_polygon:c,area_count_key:h}=i.properties||{},{coordinates:d}=i.geometry||{};t._capacity[i.id]=r||100,t._count_key[i.id]=h||"",t._location[i.id]=!1===l?p||(d?.length?fe(d):null):null,t._draw[i.id]=!!c||t._settings.get("app.explore.use_zone_polygons"),t._points[i.id]=d||[]}}t.updateStatus(),t.subscription("bind",t._bind.subscribe())})()}parseData(t){const o=t?.value||[],s=[],a=[];for(const i of o){const l=i[this._count_key[i.area_id]||this._settings.get("app.explore.area_count_key")||"count"]/(this._capacity[i.area_id]||100);if(this._statuses[i.area_id]=l<.4?"free":l<.75?"pending":"busy",!this._location[i.area_id])continue;let p="";i.count&&(p+=`${i.count||0} User Device${1===i.count?"":"s"}\n`),i.temperature&&(p+=`Temperature: ${i.temperature} \u02daC\n`),i.people_count>0&&(p+=`${i.people_count_sum} ${1===i.people_count_sum?"Person":"People"}\n`),i.humidity&&(p+=`Humidity: ${i.humidity}%\n`),i.queue_size&&(p+=`Queue Size: ${i.queue_size}%\n`),i.counter&&(p+=`Count: ${i.counter}\n`),s.push({location:this._location[i.area_id],content:p,z_index:100}),this._settings.get("app.explore.show_simple_sensor_info")&&(i.temperature||i.humidity)&&a.push({location:this._location[i.area_id],content:ge,data:{temp:i.temperature,humidity:i.humidity},z_index:98})}this._features=a,this._settings.get("app.explore.show_simple_sensor_info")||this._state.setLabels("zones",s),this.updateStatus()}updateStatus(){const t={},o=[],s=this._settings.get("app.explore.colors")||{};for(const a in this._statuses){const i=s[`zone-${this._statuses[a]}`]||s[`${this._statuses[a]}`]||R.y[`${this._statuses[a]}`];this._draw[a]?o.push({track_id:`zone:${a}`,location:fe(this._points[a]),content:Ue.i,data:{color:i,points:this._points[a]},z_index:10}):t[`#${a}`]={fill:i,opacity:.6}}this._state.setFeatures("zones",[...o,this._features]),this._state.setStyles("zones",t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(A.c),e.LFG(D.w),e.LFG(u.gb))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();function fe(n){const m=(n||[]).reduce((t,[o,s])=>({x_min:o<t.x_min?o:t.x_min,x_max:o>t.x_max?o:t.x_max,y_min:s<t.y_min?s:t.y_min,y_max:s>t.y_max?s:t.y_max}),{x_min:100,x_max:-100,y_min:100,y_max:-100});return{x:m.x_min+(m.x_max-m.x_min)/2,y:m.y_min+(m.y_max-m.y_min)/2}}var X=_(4512),k=_(7343),ce=_(7016),ee=_(5822),O=_(462),U=_(9681),M=_(6520),Y=_(8175),I=_(680),G=_(5933),Q=_(5746),ve=_(3863),Je=_(8480),V=_(7401),Ye=_(6362),Ge=_(8442),Qe=_(9590),Ve=_(576);function je(n,m){if(1&n&&(e.TgZ(0,"div",7)(1,"div",13)(2,"label"),e._uU(3,"Resource:"),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(5),e.hij(" ",t.resource.name||t.resource.map_id||"Unknown Resource"," ")}}function qe(n,m){1&n&&(e.TgZ(0,"div",7)(1,"div",8)(2,"label"),e._uU(3,"Host"),e.qZA(),e._UZ(4,"a-user-search-field",15),e.qZA()())}const He=()=>({standalone:!0});function Ke(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"main",5),e.YNc(1,je,6,1,"div",6)(2,qe,5,0,"div",6),e.TgZ(3,"div",7)(4,"div",8)(5,"label"),e._uU(6,"Date"),e.qZA(),e.TgZ(7,"a-date-field",9),e._uU(8," Date and time must be in the future "),e.qZA()()(),e.TgZ(9,"div",7)(10,"div",10)(11,"label"),e._uU(12,"Start Time"),e.qZA(),e.TgZ(13,"a-time-field",11),e.NdJ("ngModelChange",function(s){e.CHM(t);const a=e.oxw();return e.KtG(a.form.patchValue({date:s}))}),e.qZA()(),e.TgZ(14,"div",10)(15,"label"),e._uU(16,"End Time"),e.qZA(),e._UZ(17,"a-duration-field",12),e.qZA()()()}if(2&n){const t=e.oxw();let o;e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",t.resource),e.xp6(1),e.Q6J("ngIf",t.host),e.xp6(5),e.Q6J("to",t.book_until),e.xp6(6),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(12,He))("use_24hr",t.use_24hr_time),e.xp6(4),e.Q6J("time",null==(o=t.form.get("date"))?null:o.value)("max",600)("min",60)("step",60)("use_24hr",t.use_24hr_time)}}let _e=(()=>{class n{get use_24hr_time(){return this._settings.get("app.use_24_hour_time")}constructor(t,o){this._data=t,this._settings=o,this.host=this._data.host,this.form=new f.cw({user:new f.NI(this._data.user),date:new f.NI(this._data.date),duration:new f.NI(this._data.duration)}),this.book_until=this._data.until,this.resource=this._data.resource}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(V.WI),e.Y36(u.gb))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-base-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModel","ngModelOptions","use_24hr","ngModelChange"],["formControlName","duration",3,"time","max","min","step","use_24hr"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4","mb-2"],[1,"px-4","py-3","border","border-base-200","rounded","w-full","mb-4"],["formControlName","user"]],template:function(o,s){1&o&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2,"Set date and time"),e.qZA(),e.TgZ(3,"button",1)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.YNc(6,Ke,18,13,"main",2),e.TgZ(7,"footer",3)(8,"button",4),e._uU(9," Continue "),e.qZA()()),2&o&&(e.xp6(6),e.Q6J("ngIf",s.form),e.xp6(2),e.Q6J("mat-dialog-close",s.form.value))},dependencies:[x.O5,K.o,J.wG,V.ZT,f.JJ,f.JL,f.On,f.sg,f.u,Ye.Q,Ge.B,Qe.N,Ve.d]})}return n})();var xe=_(141),We=_(9437),et=_(9737),pe=_(1674),tt=_(3884);const st=["explore-device-info",""];function ot(n,m){if(1&n&&(e.TgZ(0,"p",17)(1,"label"),e.SDv(2,18),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.mac," ")}}function nt(n,m){if(1&n&&(e.TgZ(0,"p",19)(1,"label"),e.SDv(2,20),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.manufacturer," ")}}function it(n,m){if(1&n&&(e.TgZ(0,"p",21)(1,"label"),e.SDv(2,22),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.os," ")}}function at(n,m){if(1&n&&(e.TgZ(0,"p",23)(1,"label"),e.SDv(2,24),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.ssid," ")}}function lt(n,m){if(1&n&&(e.TgZ(0,"p",25)(1,"label"),e.SDv(2,26),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function rt(n,m){if(1&n&&(e.TgZ(0,"p",27)(1,"label"),e.SDv(2,28),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.user.type," ")}}function ct(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"div",6),e.NdJ("mouseleave",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.close())}),e._UZ(1,"div",7),e.TgZ(2,"div",8),e.YNc(3,ot,4,1,"p",9),e.TgZ(4,"p")(5,"label"),e.SDv(6,10),e.qZA(),e._uU(7),e.qZA(),e.TgZ(8,"p")(9,"label"),e.SDv(10,11),e.qZA(),e._uU(11),e.qZA(),e.YNc(12,nt,4,1,"p",12)(13,it,4,1,"p",13)(14,at,4,1,"p",14)(15,lt,4,1,"p",15)(16,rt,4,1,"p",16),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.xp6(4),e.hij(" ",t.variance,"m"),e.xp6(4),e.hij(" ",t.last_seen,""),e.xp6(1),e.Q6J("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.xp6(1),e.Q6J("ngIf",t.os&&!t.hide_fields.includes("os")),e.xp6(1),e.Q6J("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.xp6(1),e.Q6J("ngIf",t.username&&!t.hide_fields.includes("username")),e.xp6(1),e.Q6J("ngIf",t.user&&!t.hide_fields.includes("user"))}}const _t=[];let be=(()=>{class n extends u.cx{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||_t}get last_seen(){return(0,We.Z)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,et.Z)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(t,o,s){super(),this._details=t,this._settings=o,this._element=s,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(t=0){t>10||setTimeout(()=>{const o=this._element.nativeElement.parentElement?.parentElement;if(!o)return this.ngOnInit(++t);const s_y=parseInt(o.style.top,10)/100,s_x=parseInt(o.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(a=>this.zoom=a))},200)}loadUser(){var t=this;return(0,v.Z)(function*(){if(t.username)return;const o=(0,y.rTZ)(t._details.system,"LocationServices");if(!o)return;t.username="Loading...";const s=yield o.execute("check_ownership_of",[t.mac]).catch(a=>null);t.username=s&&s.assigned_to?s.assigned_to:""})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(pe.u),e.Y36(u.gb),e.Y36(e.SBq))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","explore-device-info",""]],features:[e.qOj],attrs:st,decls:7,vars:9,consts:()=>{let t,o,s,a,i,r,l,p;return t=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,o=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,s=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,a=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,i=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,r=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,l=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,p=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["name","radius",1,"radius","absolute","center","bg-info","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-neutral","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["dot",""],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"content","backdrop","xPosition","yPosition","hover","mouseenter"],["device_tooltip",""],["name","device-info",1,"w-64","rounded","bg-base-100","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],t,o,["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],s,["type",""],a,["os",""],i,["ssid",""],r,["username",""],l,["user",""],p]},template:function(o,s){if(1&o&&(e._UZ(0,"div",0)(1,"div",1)(2,"div",2,3),e.TgZ(4,"div",4),e.NdJ("mouseenter",function(){return s.loadUser()}),e.qZA(),e.YNc(5,ct,17,8,"ng-template",null,5,e.W1O)),2&o){const a=e.MAs(6);e.Akn("height: "+s.diameter+"%; width: "+s.diameter+"%;"),e.xp6(2),e.Udp("background-color",s.bg_color),e.xp6(2),e.Q6J("content",a)("backdrop",!1)("xPosition",s.x_pos)("yPosition",s.y_pos)("hover",!0)}},dependencies:[x.O5,tt.X],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}\n\n/*# sourceMappingURL=explore-device-info.component.ts-angular-inline--74.css.map*/"]})}return n})();var te=_(5183);let se=(()=>{class n extends u.cx{constructor(t,o,s,a,i){var r;super(),r=this,this._state=t,this._org=o,this._settings=s,this._bookings=a,this._dialog=i,this._in_use=new O.X([]),this._options=new O.X({}),this._presence=new O.X([]),this._signs_of_life=new O.X([]),this._statuses={},this._users={},this._departments={},this._checked_in=new O.X([]),this.booking_rules=this._org.active_building.pipe((0,z.h)(l=>!!l),(0,M.w)(l=>(0,y.rlq)(l.id,"desk_booking_rules").pipe((0,Y.K)(()=>(0,U.of)({details:[]})))),(0,b.U)(l=>l?.details instanceof Array?l.details:[]),(0,I.d)(1)),this.desk_list=this._state.level.pipe((0,G.b)(50),(0,M.w)(l=>(0,y.rlq)(l.id,"desks").pipe((0,Y.K)(()=>(0,U.of)({details:[]})),(0,b.U)(p=>(p?.details instanceof Array?p.details:[]).map(c=>new Je.n({...c,zone:l}))))),(0,Y.K)(l=>[]),(0,I.d)(1)),this._bind=this._state.level.pipe((0,G.b)(300),(0,z.h)(l=>!!l),(0,Q.b)(l=>{this._statuses={};const p=this._org.binding("area_management");if(!p)return;let c=(0,y.rTZ)(p,"AreaManagement")?.binding(l.id);c&&(this.subscription("lvl-in_use",c.listen().subscribe(h=>this.processBindingChange(h||{},p))),this.subscription("lvl-in_use_bind",c.bind()))})),this._booking_list=(0,L.aj)([this._options,this._state.level]).pipe((0,z.h)(([l,p])=>(l.use_api||l.date>(0,X.Z)(Date.now()).valueOf())&&!!p),(0,M.w)(([l,p])=>(0,te.F2)({type:"desk",period_start:(0,k.Z)((0,ce.Z)(l.date||Date.now())),period_end:(0,k.Z)((0,X.Z)(l.date||Date.now())),zones:p.id})),(0,G.b)(200),(0,Q.b)(l=>{this._in_use.next(l.map(p=>p.asset_id)),this._checked_in.next(l.filter(p=>p.checked_in).map(p=>p.asset_id))}),(0,I.d)(1)),this._state_change=(0,L.aj)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this.booking_rules,this._options]).pipe((0,G.b)(50),(0,b.U)(function(){var l=(0,v.Z)(function*([p,c,h,d,E,g]){r._statuses={};const C=yield r._state.level.pipe((0,j.q)(1)).toPromise();for(const{id:T,bookable:w}of p){const F=c.some(B=>T===B),P=h.some(B=>T===B),Z=E.some(B=>T===B),ie=d.some(B=>T===B)||F&&r._settings.get("app.desk.auto_checkin"),ae=(0,u.e8)({date:Date.now(),duration:60,host:(0,u.ar)(),resource:{id:T,zones:[C.parent_id,C.id]}},g)?.hidden;r._statuses[T]=w&&!ae?F||P||ie?P||ie?"busy":"pending":Z?"signs-of-life":"free":"not-bookable"}r.processDesks(p)});return function(p){return l.apply(this,arguments)}}())),this.init()}init(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(o=>o)).toPromise(),t.setOptions({enable_booking:!1!==t._settings.get("app.desks.enable_maps")}),t.subscription("bookings",t._booking_list.subscribe()),t.subscription("bind",t._bind.subscribe()),t.subscription("booking_rules",t.booking_rules.subscribe()),t.subscription("changes",t._state_change.subscribe()),t.subscription("desks",t.desk_list.subscribe(o=>t.processDesks(o)))})()}setOptions(t){this._options.next({...this._options.getValue(),...t})}processBindingChange({value:t},o){const s=(t||[]).filter(l=>!["desk","booking"].includes(l.location)),a=(t||[]).filter(l=>"desk"===l.location||"booking"===l.location&&"desk"===l.type);(this._options.getValue().date||Date.now())<=(0,X.Z)(Date.now()).valueOf()&&!this._options.getValue().use_api&&(this._in_use.next(a.filter(l=>"booking"===l.location).map(l=>l.map_id||l.asset_id)),this._checked_in.next(a.filter(l=>"booking"===l.location&&l.checked_in).map(l=>l.map_id||l.asset_id)),this._presence.next(a.filter(l=>l.at_location).map(l=>l.map_id||l.asset_id)),this._signs_of_life.next(a.filter(l=>l.signs_of_life).map(l=>l.map_id||l.asset_id)));const r=this._settings.get("app.department_map")||{};for(const l of a)this._users[l.map_id||l.asset_id]=l.staff_name,this._departments[l.map_id||l.asset_id]=r[l.department]||"";this.processDevices(s,o),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},o=this._settings.get("app.explore.colors")||{};for(const s in this._statuses)this._statuses[s]&&(t[`#${s}`]={fill:o[`desk-${this._statuses[s]}`]||o[`${this._statuses[s]}`]||R.y[`${this._statuses[s]}`]});this._state.setStyles("desks",t)}processDevices(t,o){const s=[];for(const a of t){const i=a.x/a.map_width,r=a.y/a.map_height;s.push({track_id:`device:hover:${i},${r}`,location:{x:a.coordinates_from?.includes("right")?1-i:i,y:a.coordinates_from?.includes("bottom")?1-r:r},content:be,z_index:20,data:{...a,system:o}})}this._state.setFeatures("devices",s)}processDesks(t){var o=this;const s=[],a=[],i=this._options.getValue();for(const r of t){if(s.push({track_id:`desk:hover:${r.map_id||r.id}`,location:r.id,content:xe.c,full_size:!0,no_scale:!0,data:{id:r.map_id||r.id,map_id:r.name,name:r.name||r.map_id,user:this._users[r.map_id]||r.staff_name,status:this._statuses[r.map_id],department:this._departments[r.map_id]||""},z_index:20}),!r.bookable)continue;const l=function(){var p=(0,v.Z)(function*(){if("free"!==o._statuses[r.id])return(0,u.cB)(`${r.name||"Desk"} is unavailable at this time.`);if(r.groups?.length&&!r.groups.find(g=>(0,u.ar)().groups.includes(g)))return(0,u.cB)(`You are not allowed to book ${r.name}.`);o._bookings.newForm(),o._bookings.setOptions({type:"desk"}),i.date&&(o._bookings.form.patchValue({date:i.date}),o._bookings.form.patchValue({all_day:!!i.all_day}));let{date:c,duration:h,user:d}=yield o._setBookingTime(o._bookings.form.value.date,o._bookings.form.value.duration,o._options.getValue()?.custom??!1,r);d=d||i.host||(0,u.ar)();const E=d?.email;o._bookings.form.patchValue({resources:[r],asset_id:r.id,asset_name:r.name,date:c,duration:i.all_day?720:h,map_id:r?.map_id||r?.id,description:r.name,user:d,user_email:E,booking_type:"desk",zones:r.zone?[r.zone?.parent_id,r.zone?.id]:[]}),yield o._bookings.confirmPost().catch(g=>{throw console.log(g),(0,u.cB)(`Failed to book desk ${r.name||r.id}. ${g.message||g.error||g}`),g}),o._users[r.map_id]=(i.host||(0,u.ar)())?.name,(0,u.t5)(`Successfully booked desk ${r.name||r.id}`)});return function(){return p.apply(this,arguments)}}();a.push({id:r.id,action:"click",priority:10,callback:l}),a.push({id:r.id,action:"touchend",priority:10,callback:l})}this._state.setActions("desks",this._options.getValue().enable_booking?a:[]),this._state.setFeatures("desks",s),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(t,o,s=!1,a=null){var i=this;return(0,v.Z)(function*(){let r=null;if(i._settings.get("app.desks.allow_time_changes")){const l=(0,X.Z)((0,ee.Z)(Date.now(),i._settings.get("app.desks.available_period")||90)),c=yield i._dialog.open(_e,{data:{date:t,duration:o,until:l,host:s,resource:a}}).afterClosed().toPromise();if(!c)throw"User cancelled";t=c.date,o=c.duration,r=c.user}return{date:t,duration:o,user:r}})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(A.c),e.LFG(D.w),e.LFG(u.gb),e.LFG(ve.f),e.LFG(V.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();var Ee=_(5702),pt=_(60),dt=_(7393),ut=_(2130);let oe=(()=>{class n extends u.cx{constructor(t,o,s,a,i){super(),this._org=t,this._state=o,this._settings=s,this._bookings=a,this._dialog=i,this._options=new O.X({}),this._poll=new O.X(0),this.options=this._options.asObservable(),this.levels=this._org.active_levels.pipe((0,b.U)(r=>r.filter(l=>l.tags.includes("parking")))),this.events=(0,L.aj)([this._org.active_building,this._options,this._poll]).pipe((0,M.w)(([r,l])=>(0,te.F2)({period_start:(0,k.Z)((0,Ee.Z)(l.date||Date.now())),period_end:(0,k.Z)((0,pt.Z)(l.date||Date.now())),type:"parking",zones:r?.id})),(0,I.d)(1)),this.existing_event=(0,L.aj)([this._options]).pipe((0,M.w)(([r])=>(0,te.F2)({period_start:(0,k.Z)((0,ce.Z)(r.date||Date.now())),period_end:(0,k.Z)((0,X.Z)(r.date||Date.now())),type:"parking",email:r?.user||(0,u.ar)()?.email})),(0,I.d)(1)),this.week_events=(0,L.aj)([this._org.active_building,this._options]).pipe((0,M.w)(([r,l])=>(0,te.F2)({period_start:(0,k.Z)((0,ce.Z)(l.date||Date.now())),period_end:(0,k.Z)((0,ee.Z)((0,X.Z)(l.date||Date.now()),6)),type:"parking",zones:r?.id})),(0,I.d)(1)),this.spaces=this.levels.pipe((0,M.w)(r=>(0,ut.D)(r.map(l=>(0,y.rlq)(l.id,"parking-spaces").pipe((0,b.U)(p=>p.details.map(c=>({...c,zone_id:l.id}))))))),(0,b.U)(r=>(0,u.xH)(r)),(0,I.d)(1)),this.active_spaces=(0,L.aj)([this.spaces,this._state.level]).pipe((0,b.U)(([r,l])=>r.filter(p=>p.zone_id===l.id))),this.available_spaces=(0,L.aj)([this.events,this.active_spaces]).pipe((0,b.U)(([r,l])=>l.filter(p=>!r.find(c=>c.asset_id===p.id)&&!p.assigned_to))),this.week_availablility=(0,L.aj)([this.week_events,this.spaces,this._options]).pipe((0,b.U)(([r,l,{date:p}])=>{const c={};for(let h=0;h<7;h++){const d=(0,ee.Z)(p,h),E=r.filter(g=>(0,dt.Z)(d,g.date));c[d.valueOf()]=l.filter(g=>!E.find(C=>C.asset_id===g.id)).length}return c})),this.subscription("spaces",(0,L.aj)([this.spaces,this.available_spaces]).subscribe(([r,l])=>this._updateParkingSpaces(r,l))),this.setOptions({enable_booking:!1!==this._settings.get("app.parking.enable_maps")}),this.interval("poll",()=>this._poll.next(Date.now()),1e4)}setOptions(t){this._options.next({...this._options.getValue(),...t})}_updateParkingSpaces(t,o){var s=this;const a={},i=[],r=[],l=this._settings.get("app.explore.colors")||{},p=this._options.getValue();for(const c of t){const h=!!o.find(g=>g.id===c.id),d=h?"free":"busy";if(a[`#${c.map_id}`]={fill:l[`parking-${d}`]||l[`${d}`]||R.y[`${d}`],opacity:.6},!h)continue;i.push({zoom_level:2,location:`${c.map_id}`,content:`${c.name}\nFree`});const E=function(){var g=(0,v.Z)(function*(){if("free"!==d)return(0,u.cB)(`${c.name||"Parking Space"} is unavailable at this time.`);if(c.groups?.length&&!c.groups.find(Z=>(0,u.ar)().groups.includes(Z)))return(0,u.cB)(`You are not allowed to book ${c.name}.`);s._bookings.newForm(),s._bookings.setOptions({type:"parking"}),p.date&&(s._bookings.form.patchValue({date:p.date}),s._bookings.form.patchValue({all_day:!!p.all_day}));let{date:C,duration:T,user:w}=yield s._setBookingTime(s._bookings.form.value.date,s._bookings.form.value.duration,s._options.getValue()?.custom??!1,c);w=w||p.host||(0,u.ar)();const F=w?.email,P=s._state.active_level;s._bookings.form.patchValue({resources:[c],asset_id:c.id,asset_name:c.name,date:C,duration:p.all_day?720:T,map_id:c?.map_id||c?.id,description:c.name,user:w,user_email:F,booking_type:"parking",zones:c.zone?[c.zone?.parent_id,c.zone?.id]:[P.parent_id,P.id]}),yield s._bookings.confirmPost().catch(Z=>{throw console.log(Z),(0,u.cB)(`Failed to book parking space ${c.name||c.id}. ${Z.message||Z.error||Z}`),Z}),(0,u.t5)(`Successfully booked parking space ${c.name||c.id}`)});return function(){return g.apply(this,arguments)}}();r.push({id:c?.map_id||c?.id,action:"click",priority:10,callback:E})}this._state.setActions("parking",p.enable_booking?r:[]),this._state.setStyles("parking",a),this._state.setLabels("parking",i)}_setBookingTime(t,o,s=!1,a=null){var i=this;return(0,v.Z)(function*(){let r=null;if(i._settings.get("app.parking.allow_time_changes")){const l=(0,X.Z)((0,ee.Z)(Date.now(),i._settings.get("app.parking.available_period")||90)),c=yield i._dialog.open(_e,{data:{date:t,duration:o,until:l,host:s,resource:a}}).afterClosed().toPromise();if(!c)throw"User cancelled";t=c.date,o=c.duration,r=c.user}return{date:t,duration:o,user:r}})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(D.w),e.LFG(A.c),e.LFG(u.gb),e.LFG(ve.f),e.LFG(V.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();_(1635);var ne=_(3121);_(4620),_(3650);var Ze=_(1125),gt=_(702);let de=(()=>{class n{constructor(t){this._state=t,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(A.c))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:()=>{let t,o,s;return t=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,o=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,s=$localize`:␟77981432124895c410e5b9157b3deb948831ffc6␟5016012668378976433:Reset Zoom & Center`,[["z-in","","icon","","matRipple","","matTooltip",t,1,"bg-base-100",3,"click"],["z-out","","icon","","matRipple","","matTooltip",o,1,"bg-base-100",3,"click"],["reset","","icon","","matRipple","","matTooltip",s,1,"bg-base-100",3,"click"]]},template:function(o,s){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return s.zoomIn()}),e.TgZ(1,"app-icon"),e._uU(2,"add"),e.qZA()(),e.TgZ(3,"button",1),e.NdJ("click",function(){return s.zoomOut()}),e.TgZ(4,"app-icon"),e._uU(5,"remove"),e.qZA()(),e.TgZ(6,"button",2),e.NdJ("click",function(){return s.reset()}),e.TgZ(7,"app-icon"),e._uU(8,"autorenew"),e.qZA()())},dependencies:[K.o,J.wG,gt.gM],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}button[_ngcontent-%COMP%]{border:1px solid #9998;border-radius:0}button[_ngcontent-%COMP%]:first-child{border-radius:.25rem .25rem 0 0;border-bottom:none}button[_ngcontent-%COMP%]:last-child{border-radius:0 0 .25rem .25rem;border-top:none}\n\n/*# sourceMappingURL=explore-zoom-control.component.ts-angular-inline--77.css.map*/"]})}return n})();var Tt=_(3362),Ot=_(8675);let Mt=(()=>{class n{constructor(t,o){this._org=t,this._settings=o,this._emergency_contacts=new O.X([]),this._filter=new O.X(""),this._loading=new O.X(!1),this.emergency_contacts=this._emergency_contacts.asObservable(),this._role_assigned_contacts=this._org.active_building.pipe((0,z.h)(s=>!!s),(0,M.w)(s=>(0,y.rlq)(s.id,"emergency_contacts")),(0,b.U)(({details:s})=>s?.contacts||[]),(0,I.d)(1)),this._user_search=this._filter.pipe((0,G.b)(400),(0,Q.b)(()=>this._loading.next(!0)),(0,M.w)(s=>s?.length>2?this.search_fn(s).pipe((0,Y.K)(()=>(0,U.of)([]))):(0,U.of)([])),(0,I.d)(1)),this._space_search=this._filter.pipe((0,G.b)(400),(0,Q.b)(()=>this._loading.next(!0)),(0,M.w)(s=>s?.length>2?(0,y.vIL)({q:s,zone_id:this._org.organisation.id}).pipe((0,b.U)(({data:a})=>a.filter(i=>i.map_id).map(i=>new Tt.T({...i,level:this._org.levelWithID(i.zones)})))):(0,U.of)([])),(0,Y.K)(()=>[])),this._points_of_interest=this._org.active_building.pipe((0,z.h)(s=>!!s),(0,M.w)(()=>(0,y.BW_)(this._org.building.id,{name:"points_of_interest"}).pipe((0,Y.K)(()=>(0,U.of)({details:[]})))),(0,b.U)(s=>{const a=[];for(const i of s){const r=i.metadata.points_of_interest;if(r)for(const l of r.details)a.push({id:l.id,type:"feature",name:l.name,description:"",zone:i.zone})}return a})),this.search_results=(0,L.aj)([this._filter,this._space_search,this._user_search,this._emergency_contacts,this._role_assigned_contacts,this._points_of_interest]).pipe((0,b.U)(([s,a,i,r,l,p])=>{const c=s.toLowerCase(),h=[...a.filter(d=>d.email.toLowerCase().includes(c)||d.name.toLowerCase().includes(c)||d.display_name.toLowerCase().includes(c)).map(d=>({id:d.id,type:"space",name:d.display_name||d.name,description:`Capacity: ${d.capacity} `})),...(0,u.xH)(l.map(d=>d.roles.map(E=>({id:d.email,type:E||"contact",is_role:!0,name:d.name,description:d.email})))).filter(d=>d.name.toLowerCase().includes(c)||d.description.toLowerCase().includes(c)||d.type.toLowerCase().includes(c)),...r.map(d=>({id:d.email,type:d.type||"contact",is_role:!0,name:d.name,description:d.email})).filter(d=>d.name.toLowerCase().includes(c)||d.description.toLowerCase().includes(c)||d.type.toLowerCase().includes(c)),...i.map(d=>({id:d.email,type:"user",name:d.name,description:d.email})),...p.filter(d=>d.name.toLowerCase().includes(c)).map(d=>({id:d.id,type:"feature",name:d.name,description:"",zone:d.zone?.id}))];return h.sort((d,E)=>d.name.localeCompare(E.name)),h}),(0,Q.b)(()=>this._loading.next(!1)),(0,I.d)(1)),this.loading=this._loading.asObservable(),this.search_fn=s=>this._settings.get("app.basic_user_search")?(0,y.E4d)({q:s,authority_id:(0,y.N9E)()?.id}).pipe((0,b.U)(a=>a.data)):(0,Ot.VE)(s),this.search_results.subscribe(),this.init()}init(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(s=>s)).toPromise();const o=(0,ne.as)(t._org.binding("location_services"),"LocationServices");if(o){const s=o.binding("emergency_contacts");s.listen().subscribe(a=>{const i=[];for(const r in a)for(const l of a[r])i.push({...l,type:r});t._emergency_contacts.next(i)}),s.bind()}})()}setFilter(t){this._filter.next(t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(D.w),e.LFG(u.gb))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var St=_(7147),ue=_(9892),It=_(3910);const wt=["input"];function At(n,m){1&n&&e._UZ(0,"mat-spinner",9),2&n&&e.Q6J("diameter",32)}function Pt(n,m){1&n&&(e.TgZ(0,"mat-option",12),e.SDv(1,13),e.qZA())}function Nt(n,m){if(1&n&&(e.TgZ(0,"mat-option",14)(1,"div",15)(2,"div",16)(3,"div",17),e._uU(4),e.qZA(),e.TgZ(5,"div",18),e._uU(6),e.qZA()(),e.TgZ(7,"div",19),e._uU(8),e.qZA()()()),2&n){const t=m.$implicit;e.Q6J("value",t),e.xp6(4),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij(" ",t.type," ")}}function Rt(n,m){if(1&n&&(e.ynx(0),e.YNc(1,Pt,2,0,"mat-option",10),e.ALo(2,"async"),e.YNc(3,Nt,9,4,"mat-option",11),e.ALo(4,"slice"),e.ALo(5,"async"),e.BQk()),2&n){const t=e.oxw();let o;e.xp6(1),e.Q6J("ngIf",!(null!=(o=e.lcZ(2,2,t.results))&&o.length)),e.xp6(2),e.Q6J("ngForOf",e.Dn7(4,4,e.lcZ(5,8,t.results),0,5))}}let Le=(()=>{class n extends u.cx{checkClick(t){this._el?.nativeElement?.contains(t.target)||(this.show=!1,this._input_el?.nativeElement?.blur())}constructor(t,o,s,a){super(),this._el=t,this._search=o,this._router=s,this._route=a,this.show=!1,this.search_str="",this.results=this._search.search_results,this.loading=this._search.loading,this.setFilter=i=>this._search.setFilter(i),this.setItem=i=>i instanceof Object?this.select(i):this.setFilter(i),this.onTouch=i=>this.checkClick(i)}showSearch(){this.show=!0,this._input_el?.nativeElement&&this.timeout("focus",()=>this._input_el.nativeElement.focus(),300)}closeSearch(t){this.show=!1,this.search_str="",this.setFilter(""),this._input_el?.nativeElement&&(this._input_el.nativeElement.focus(),this._input_el.nativeElement.blur())}select(t){this.search_str=t.name;const o={};o["space"===t.type?"space":"feature"===t.type?"feature":"user"]=t.id,this._router.navigate([],{relativeTo:this._route,queryParams:o})}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(e.SBq),e.Y36(Mt),e.Y36(S.F0),e.Y36(S.gz))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-search"]],viewQuery:function(o,s){if(1&o&&e.Gf(wt,5),2&o){let a;e.iGM(a=e.CRH())&&(s._input_el=a.first)}},hostBindings:function(o,s){1&o&&e.NdJ("click",function(i){return s.checkClick(i)},!1,e.evT)("touchstart",function(i){return s.onTouch(i)},!1,e.evT)},features:[e.qOj],decls:13,vars:12,consts:()=>{let t,o;return t=$localize`:␟7a428104a6c33787961fda306f9c518f89fb0261␟6939663044582448373:Search for...`,o=$localize`:␟0c720c4e60410fcfcd8582a32297bdd397620830␟3411517965707112535: No matches found `,[["role","search","tabindex","0","matRipple","",1,"bg-base-100","m-2","flex","items-center","z-10","relative","overflow-hidden","outline-none"],["tabindex","0",1,"text-2xl","outline-none",3,"click"],["keyboard","","placeholder",t,1,"flex-1","text-base","border-none","outline-none",3,"ngModel","matAutocomplete","matAutocompleteConnectedTo","ngModelChange","blur"],["input",""],["class","mr-2",3,"diameter",4,"ngIf"],["matAutocompleteOrigin","",1,"absolute","bottom-0","left-8","right-8","min-w-[20rem]"],["origin","matAutocompleteOrigin"],["auto","matAutocomplete"],[4,"ngIf"],[1,"mr-2",3,"diameter"],["class","pointer-events-none",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none"],o,[3,"value"],[1,"flex","items-center","leading-tight","w-[26rem]","max-w-[calc(100vw-2rem)]"],[1,"flex-1","w-1/2","overflow-hidden"],[1,"truncate","w-full"],[1,"text-xs"],[1,"text-xs","font-bold","p-2","capitalize","text-white","bg-base-300","rounded"]]},template:function(o,s){if(1&o&&(e.TgZ(0,"div",0)(1,"app-icon",1),e.NdJ("click",function(i){return s.show?s.closeSearch(i):s.showSearch()}),e._uU(2),e.qZA(),e.TgZ(3,"input",2,3),e.NdJ("ngModelChange",function(i){return s.search_str=i})("ngModelChange",function(i){return s.setItem(i)})("blur",function(){return s.show=!!s.search_str}),e.qZA(),e.YNc(5,At,1,1,"mat-spinner",4),e.ALo(6,"async"),e._UZ(7,"div",5,6),e.qZA(),e.TgZ(9,"mat-autocomplete",null,7),e.YNc(11,Rt,6,10,"ng-container",8),e.ALo(12,"async"),e.qZA()),2&o){const a=e.MAs(8),i=e.MAs(10);e.ekj("show",s.show||s.search_str),e.xp6(2),e.hij(" ",s.show||s.search_str?"close":"search"," "),e.xp6(1),e.Q6J("ngModel",s.search_str)("matAutocomplete",i)("matAutocompleteConnectedTo",a),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,8,s.loading)),e.xp6(6),e.Q6J("ngIf",!0!==e.lcZ(12,10,s.loading)&&(s.show||s.search_str))}},dependencies:[x.sg,x.O5,K.o,St.U,ue.XC,J.ey,ue.ZL,ue.BU,J.wG,It.Ou,f.Fj,f.JJ,f.On,x.Ov,x.OU],styles:["[_nghost-%COMP%]{z-index:99}[role=search][_ngcontent-%COMP%]{height:3.125rem;width:3.125rem;border-radius:1.5rem;border:1px solid #ccc;transition:width .2s}app-icon[_ngcontent-%COMP%]{margin:.55rem}[role=search].show[_ngcontent-%COMP%]{width:32rem;max-width:calc(100vw - 1rem);border-color:#1e88e5}\n\n/*# sourceMappingURL=explore-search.component.ts-angular-inline--76.css.map*/"]})}return n})();_(6967),_(2182),_(6687),_(151);let Ut=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#s=this.\u0275inj=e.cJS({imports:[x.ez,N.Kk,f.u5,f.UX,le.rP,Me.U8,Se.eL,Ie.W,we.E]})}return n})();var Te=_(7049),Ft=_(8714);function Bt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",2),e.NdJ("click",function(){const a=e.CHM(t).$implicit,i=e.oxw();return e.KtG(i.setLevel(a))}),e.ALo(1,"async"),e.TgZ(2,"div",3),e._uU(3),e.qZA(),e.TgZ(4,"p",4),e._uU(5),e.qZA()()}if(2&n){const t=m.$implicit,o=e.oxw();let s;e.ekj("active",t.id===(null==(s=e.lcZ(1,4,o.level))?null:s.id)),e.xp6(3),e.Oqu(t.number),e.xp6(2),e.hij(" ",t.display_name||t.name," ")}}let Dt=(()=>{class n{constructor(t,o){this._org=t,this._state=o,this.levels=this._org.active_levels,this.level=this._state.level,this.setLevel=s=>this._state.setLevel(s.id)}ngOnInit(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,$.P)(s=>s)).toPromise(),yield t._org.active_levels.pipe((0,j.q)(1)).toPromise()})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(ne.w7),e.Y36(A.c))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-level-select"]],decls:3,vars:3,consts:[[1,"m-2","rounded","overflow-hidden","bg-base-100","shadow","border","border-solid","border-base-300"],["class","flex flex-col items-center justify-center h-16 w-16 p-2 border-none","matRipple","",3,"active","click",4,"ngFor","ngForOf"],["matRipple","",1,"flex","flex-col","items-center","justify-center","h-16","w-16","p-2","border-none",3,"click"],[1,"text-2xl"],[1,"text-sm","whitespace-nowrap","m-0"]],template:function(o,s){1&o&&(e.TgZ(0,"div",0),e.YNc(1,Bt,6,6,"button",1),e.ALo(2,"async"),e.qZA()),2&o&&(e.xp6(1),e.Q6J("ngForOf",e.lcZ(2,1,s.levels)))},dependencies:[x.sg,J.wG,x.Ov],styles:[".active[_ngcontent-%COMP%]{background:var(--s)!important;color:#fff!important}button[_ngcontent-%COMP%]:not(:first-child){border-top:1px solid var(--b3)!important}\n\n/*# sourceMappingURL=explore-level-select.component.ts-angular-inline--81.css.map*/"]})}return n})();const Jt=["app-explore",""];function Yt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"i-map",19),e.NdJ("zoomChange",function(s){e.CHM(t);const a=e.oxw();return e.KtG(a.updateZoom(s))})("centerChange",function(s){e.CHM(t);const a=e.oxw();return e.KtG(a.updateCenter(s))}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.qZA()}if(2&n){const t=e.oxw();let o,s;e.Q6J("src",e.lcZ(1,7,t.url))("zoom",null==(o=e.lcZ(2,9,t.positions))?null:o.zoom)("center",null==(s=e.lcZ(3,11,t.positions))?null:s.center)("styles",e.lcZ(4,13,t.styles))("features",e.lcZ(5,15,t.features))("actions",e.lcZ(6,17,t.actions))("labels",e.lcZ(7,19,t.labels))}}function Gt(n,m){if(1&n&&(e._UZ(0,"indoor-maps",20),e.ALo(1,"async"),e.ALo(2,"async")),2&n){const t=e.oxw();e.Q6J("styles",e.lcZ(1,2,t.styles))("actions",e.lcZ(2,4,t.actions))}}function Qt(n,m){1&n&&e._UZ(0,"explore-search",21)}function Vt(n,m){1&n&&(e.TgZ(0,"div",26)(1,"div",11),e._uU(2," Zone Usage "),e.TgZ(3,"div",27),e._UZ(4,"div",13),e.TgZ(5,"div",28),e._uU(6,"0 ~ 50%"),e.qZA()(),e.TgZ(7,"div",27),e._UZ(8,"div",17),e.TgZ(9,"div",28),e._uU(10,"51 ~ 75%"),e.qZA()(),e.TgZ(11,"div",27),e._UZ(12,"div",16),e.TgZ(13,"div",28),e._uU(14,"76 ~ 100%"),e.qZA()()()())}function jt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"div",22)(1,"div",23),e._uU(2," Zones "),e.TgZ(3,"mat-slide-toggle",24),e.NdJ("ngModelChange",function(s){e.CHM(t);const a=e.oxw();return e.KtG(a.toggleZones(s))}),e.ALo(4,"async"),e.qZA()(),e.YNc(5,Vt,15,0,"div",25),e.ALo(6,"async"),e.qZA()}if(2&n){const t=e.oxw();let o,s;e.ekj("top-2",!t.can_search)("top-16",t.can_search),e.xp6(3),e.Q6J("ngModel",!(null!=(o=e.lcZ(4,6,t.options))&&null!=o.disable&&o.disable.includes("zones"))),e.xp6(2),e.Q6J("ngIf",!(null!=(s=e.lcZ(6,8,t.options))&&null!=s.disable&&s.disable.includes("zones")))}}const qt=()=>["/"];let Oe=(()=>{class n extends u.cx{get logo(){return"dark"===this._settings.get("theme")?this._settings.get("app.logo_dark"):this._settings.get("app.logo_light")}get time(){return(0,Ee.Z)(Date.now())}get hide_zones(){return this._settings.get("app.hide_zones")}updateZoom(t){this._state.setPositions(t,this._state.positions.center)}updateCenter(t){this._state.setPositions(this._state.positions.zoom,t)}toggleZones(t){var o=this;return(0,v.Z)(function*(){const s=yield o.options.pipe((0,j.q)(1)).toPromise(),a=t?s.disable.filter(i=>"zones"!==i&&"devices"!==i)||[]:(0,u.Tw)([...s.disable||[],"zones","devices"]);o.setOptions({disable:a})})()}get can_search(){return!!this._settings.get("app.explore.search_enabled")}constructor(t,o,s,a,i,r,l,p,c,h,d,E,g){super(),this._state=t,this._s=o,this._desks=s,this._zones=a,this._parking=i,this._settings=r,this._org=l,this._spaces=p,this._dialog=c,this._route=h,this._router=d,this._space_pipe=E,this._maps=g,this.reset_delay=180,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options,this.onMouse=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.onTouch=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.setOptions=C=>this._state.setOptions(C),this.use_mapsindoors$=this._maps.use_mapspeople$}ngOnInit(){var t=this;return(0,v.Z)(function*(){yield t._spaces.initialised.pipe((0,$.P)(o=>o)).toPromise(),t._desks.setOptions({custom:!0}),t.reset_delay=t._settings.get("app.inactivity_timeout_secs")||180,t.resetKiosk(),N.Uk.enabled="true"===localStorage.getItem("OSK.enabled"),t.subscription("level",t._state.level.subscribe(()=>t.timeout("update_location",()=>{t._state.setFeatures("_located",[])}))),t.subscription("route.query",t._route.queryParamMap.subscribe(function(){var o=(0,v.Z)(function*(s){if(s.has("level")&&t._state.setLevel(s.get("level")),t._state.setFeatures("_located",[]),s.has("space"))t.locateSpace(s.get("space"));else if(s.has("user")){let a=t._settings.value("last_search");if((!a||s.get("user")!==a.email)&&(a=null,a=yield(0,q.w0)(s.get("user")).toPromise()),!a)return(0,u.cB)(`Unable to user details for ${s.get("user")}`);t.locateUser(a instanceof Array?a[0]:a).catch(i=>{(0,u.cB)(`Unable to locate ${s.get("user")}`),t._router.navigate([],{relativeTo:t._route,queryParams:{}})})}else s.has("feature")?t.timeout("update_location",()=>{t._state.setFeatures("_located",[{location:s.get("feature"),content:N.qL,data:{}}])}):t.timeout("update_location",()=>{t._state.setFeatures("_located",[])})});return function(s){return o.apply(this,arguments)}}()))})()}locateSpace(t){var o=this;return(0,v.Z)(function*(){const s=yield o._space_pipe.transform(t);if(!s)return;o._state.setLevel(o._org.levelWithID(s.zones)?.id);const a={location:s.map_id,content:N.qL,data:{message:`${s.display_name||s.name} is here`}};o.timeout("update_location",()=>o._state.setFeatures("_located",[a]))})()}locateUser(t){var o=this;return(0,v.Z)(function*(){let s=o._org.binding("location_services");if(!s)return;"string"==typeof s&&(s={system_id:s,module:"LocationServices"});const i=(yield(0,y.rTZ)(s.system_id,s.module).execute("locate_user",[t.email,t.username||t.id])).map(c=>new q.Y(c));if(i.sort((c,h)=>s.priority.indexOf(c.type)-s.priority.indexOf(h.type)),!i?.length)throw"No locations for the given user";o._state.setLevel(o._org.levelWithID([i[0]?.level])?.id);const r=i[0].position,{coordinates_from:l}=i[0],p={location:"wireless"===i[0].type?{x:l?.includes("right")?1-r.x:r.x,y:l?.includes("bottom")?1-r.y:r.y}:r,content:"wireless"===i[0].type?N.nb:N.qL,z_index:99,data:{message:`${t.name} is here`,radius:i[0].variance,last_seen:i[0].last_seen}};o.timeout("update_location",()=>{o._state.setFeatures("_located",[p])})})()}resetKiosk(){document.activeElement?.blur&&document.activeElement?.blur();const t=localStorage.getItem("KIOSK.level");this._state.setPositions(1,{x:.5,y:.5}),t&&this._state.setLevel(t),this._dialog.closeAll()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(A.c),e.Y36(R.a),e.Y36(se),e.Y36(W),e.Y36(oe),e.Y36(u.gb),e.Y36(ne.w7),e.Y36(Te.sK),e.Y36(V.uw),e.Y36(S.gz),e.Y36(S.F0),e.Y36(H.X),e.Y36(u.gT))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","app-explore",""]],hostBindings:function(o,s){1&o&&e.NdJ("mousedown",function(){return s.onMouse()},!1,e.Jf7)("touchstart",function(){return s.onTouch()},!1,e.Jf7)},features:[e._Bn([R.a,se,W,oe,H.X]),e.qOj],attrs:Jt,decls:33,vars:15,consts:[[1,"absolute","top-0","left-0","bg-base-100","rounded-br-2xl","p-4","z-10","shadow","border-b","border-r","border-base-200",3,"routerLink"],[1,"w-32",3,"src"],[1,"absolute","top-0","left-1/2","-translate-x-1/2","bg-base-100","rounded-b-2xl","px-4","pb-4","pt-3","z-10","shadow","border-b","border-r","border-base-200","text-base-content"],[1,"absolute","inset-0"],[3,"src","zoom","center","styles","features","actions","labels","zoomChange","centerChange",4,"ngIf"],[3,"styles","actions",4,"ngIf"],[1,"absolute","top-1/2","transform","-translate-y-1/2","right-0"],[1,"absolute","left-1","top-1/2","transform","-translate-y-1/2","z-10"],["class","absolute top-1 right-1",4,"ngIf"],["name","zones","class","p-2 bg-base-100 border border-base-200 absolute right-1 m-2 rounded flex flex-col items-center space-y-2",3,"top-2","top-16",4,"ngIf"],[1,"absolute","bottom-2","right-2","p-2","rounded","bg-base-100","shadow","border","border-base-200"],[1,"font-medium"],[1,"flex","items-center","space-x-2","p-2"],[1,"h-3","w-3","rounded-full","bg-success"],[1,"text-center"],[1,"flex","items-center","space-x-2","rounded","bg-base-200","p-2"],[1,"h-3","w-3","rounded-full","bg-error"],[1,"h-3","w-3","rounded-full","bg-warning"],[1,"h-3","w-3","rounded-full","bg-base-300"],[3,"src","zoom","center","styles","features","actions","labels","zoomChange","centerChange"],[3,"styles","actions"],[1,"absolute","top-1","right-1"],["name","zones",1,"p-2","bg-base-100","border","border-base-200","absolute","right-1","m-2","rounded","flex","flex-col","items-center","space-y-2"],[1,"flex","items-center"],[1,"ml-2",3,"ngModel","ngModelChange"],["zone-legend","","class","space-y-2",4,"ngIf"],["zone-legend","",1,"space-y-2"],[1,"flex","items-center","space-x-2"],[1,"w-20","text-center"]],template:function(o,s){1&o&&(e.TgZ(0,"a",0),e._UZ(1,"img",1),e.qZA(),e.TgZ(2,"div",2),e._uU(3),e.ALo(4,"date"),e.qZA(),e.TgZ(5,"div",3),e.YNc(6,Yt,8,21,"i-map",4),e.ALo(7,"async"),e.YNc(8,Gt,3,6,"indoor-maps",5),e.ALo(9,"async"),e.qZA(),e._UZ(10,"explore-zoom-controls",6)(11,"explore-level-select",7),e.YNc(12,Qt,1,0,"explore-search",8)(13,jt,7,10,"div",9),e.TgZ(14,"div",10)(15,"div",11),e._uU(16,"Legend"),e.qZA(),e.TgZ(17,"div",12),e._UZ(18,"div",13),e.TgZ(19,"div",14),e._uU(20,"Space Available"),e.qZA()(),e.TgZ(21,"div",15),e._UZ(22,"div",16),e.TgZ(23,"div",14),e._uU(24,"Space In Use"),e.qZA()(),e.TgZ(25,"div",15),e._UZ(26,"div",17),e.TgZ(27,"div",14),e._uU(28,"Space Pending"),e.qZA()(),e.TgZ(29,"div",12),e._UZ(30,"div",18),e.TgZ(31,"div",14),e._uU(32,"Space Not-bookable"),e.qZA()()()),2&o&&(e.Q6J("routerLink",e.DdM(14,qt)),e.xp6(1),e.Q6J("src",null==s.logo?null:s.logo.src,e.LSH),e.xp6(2),e.hij(" ",e.xi3(4,7,s.time,"fullDate")," "),e.xp6(3),e.Q6J("ngIf",!e.lcZ(7,10,s.use_mapsindoors$)),e.xp6(2),e.Q6J("ngIf",e.lcZ(9,12,s.use_mapsindoors$)),e.xp6(4),e.Q6J("ngIf",s.can_search),e.xp6(1),e.Q6J("ngIf",!s.hide_zones))},dependencies:[x.O5,S.rH,pe.p,Ze.R,le.Rr,f.JJ,f.On,Le,de,Dt,x.Ov,x.uU],styles:["[_nghost-%COMP%]{position:absolute;display:flex;flex-direction:column;inset:0;background-color:var(--b2)}@media screen and (max-height: 640px){explore-level-select[_ngcontent-%COMP%]{transform:translateY(0)!important;top:auto!important;bottom:0!important}}@media screen and (orientation: landscape){explore-level-select[_ngcontent-%COMP%]{transform:translateY(0)!important;top:auto!important;bottom:0!important}}\n\n/*# sourceMappingURL=explore.component.ts-angular-inline--80.css.map*/"]})}return n})();const Ht=[{path:"",component:Oe},{path:":search_type",component:Oe}];let Kt=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#s=this.\u0275inj=e.cJS({imports:[x.ez,S.Bz.forChild(Ht),N.Kk,Te.YR,Ft.q,f.u5,Ut]})}return n})()}}]);
//# sourceMappingURL=apps_visitor-kiosk_src_app_explore_module_ts.js.map