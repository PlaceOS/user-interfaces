"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_region-manager_region-manager_module_ts"],{555:(nn,f,t)=>{t.r(f),t.d(f,{RegionManagerModule:()=>k});var p=t(6477),s=t(9542),x=t(6585),N=t(3045),C=t(2886),y=t(5533),u=t(5912),c=t(308),_=t(4505),T=t(7716),E=t(6942),A=t(1670),d=t(7486),h=t(1426),n=t(6839),I=t(8750),Z=t(380),O=t(5312),R=t(5306);function G(e,a){1&e&&(n.TgZ(0,"button",4)(1,"app-icon"),n._uU(2,"close"),n.qZA()())}function P(e,a){1&e&&(n.TgZ(0,"div",9)(1,"label",10),n.SDv(2,11),n.qZA(),n.TgZ(3,"mat-form-field",12),n._UZ(4,"input",13),n.qZA()())}function S(e,a){if(1&e&&(n.TgZ(0,"form",7),n.YNc(1,P,5,0,"div",8),n.qZA()),2&e){const o=n.oxw(2);n.Q6J("formGroup",o.form),n.xp6(1),n.Q6J("ngIf",o.form.controls.display_name)}}function b(e,a){if(1&e&&(n.TgZ(0,"main",5),n.YNc(1,S,2,2,"form",6),n.qZA()),2&e){const o=n.oxw();n.xp6(1),n.Q6J("ngIf",o.form)}}function w(e,a){if(1&e){const o=n.EpF();n.TgZ(0,"footer",14)(1,"button",15),n.NdJ("click",function(){n.CHM(o);const l=n.oxw();return n.KtG(l.save())}),n._uU(2,"Save"),n.qZA()()}}function L(e,a){1&e&&(n.TgZ(0,"div",16),n._UZ(1,"mat-spinner",17),n.TgZ(2,"p",18),n._uU(3,"Saving region..."),n.qZA()())}let U=(()=>{class e{constructor(o,i){this._org=o,this._data=i,this.loading=!1,this.building_list=this._org.building_list,this.form=new s.cw({id:new s.NI(this._data?.id||""),display_name:new s.NI(this._data?.display_name||"",[s.kI.required]),parent_id:new s.NI(this._org.organisation.id)})}save(){var o=this;return(0,A.Z)(function*(){if(!o.form.valid)return(0,h.cB)(`Some form fields are invalid. [${(0,h.RD)(o.form).join(", ")}]`);const i=o.form.getRawValue();o.loading=!0,yield(i.id?(0,c.BfP)(i.id,{...i,name:`REGION ${(0,c.N9E)().description} ${i.display_name}`}):(0,c.ri3)({...i,name:`REGION ${(0,c.N9E)().description} ${i.display_name}`})).toPromise().catch(),o.loading=!1})()}}return e.\u0275fac=function(o){return new(o||e)(n.Y36(u.w7),n.Y36(d.WI))},e.\u0275cmp=n.Xpm({type:e,selectors:[["region-modal"]],decls:8,vars:5,consts:function(){let a,o;return a=$localize`:@@displayNameLabel␟8d766661ed5e178519720ec8e959d2a737f600a6␟1377207093952578744: Display Name: `,o=$localize`:@@displayNamePlaceholder␟e438ba78cbafdb5bcbce0820bfaad995a504f222␟3013055597615607317:Display Name`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-gray-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[36rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[36rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","display-name"],a,["appearance","outline"],["matInput","","name","display-name","placeholder",o,"formControlName","display_name"],[1,"p-2","flex","justify-end","border-t","border-gray-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(o,i){if(1&o&&(n.TgZ(0,"header")(1,"h2"),n._uU(2),n.qZA(),n.YNc(3,G,3,0,"button",0),n.qZA(),n.YNc(4,b,2,1,"main",1),n.YNc(5,w,3,0,"footer",2),n.YNc(6,L,4,0,"ng-template",null,3,n.W1O)),2&o){const l=n.MAs(7);n.xp6(2),n.hij("",i.form.value.id?"Edit":"Add"," Region"),n.xp6(1),n.Q6J("ngIf",!i.loading),n.xp6(1),n.Q6J("ngIf",!i.loading)("ngIfElse",l),n.xp6(1),n.Q6J("ngIf",!i.loading)}},dependencies:[p.O5,s._Y,s.Fj,s.JJ,s.JL,I.KE,Z.Nt,O.Ou,d.ZT,s.sg,s.u,R.o]}),e})(),v=(()=>{class e{constructor(o,i){this._org=o,this._dialog=i,this._options=new _.X({}),this._change=new _.X(0),this.options=this._options.asObservable(),this.filtered_regions=(0,T.aj)([this._org.building_list,this._org.region_list,this._options]).pipe((0,E.U)(([l,r,m])=>{m.search&&(r=r.filter(g=>g.name.toLowerCase().includes(m.search.toLowerCase())));for(const g of r)g.building_count=l.filter(q=>q.parent_id===g.id).length;return r}))}setFilters(o){this._options.next({...this._options.getValue(),...o})}setSearchString(o){this._options.next({...this._options.getValue(),search:o})}editRegion(o=new c.TT8){this._dialog.open(U,{data:o}).afterClosed().subscribe(l=>{l&&setTimeout(()=>this._change.next(Date.now()),300)})}}return e.\u0275fac=function(o){return new(o||e)(n.LFG(u.w7),n.LFG(d.uw))},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var $=t(6866),D=t(3320),J=t(7728),Y=t(2423),j=t(1110);function F(e,a){if(1&e){const o=n.EpF();n.TgZ(0,"div",3)(1,"button",4),n.NdJ("click",function(){const r=n.CHM(o).row,m=n.oxw();return n.KtG(m.editRegion(r))}),n.TgZ(2,"app-icon"),n._uU(3,"edit"),n.qZA()()()}}const X=function(){return["display_name","building_count","actions"]},z=function(){return["Name","Buildings"," "]},Q=function(){return["flex","10r","5r"]},B=function(e){return{actions:e}};let K=(()=>{class e{constructor(o){this._manager=o,this.regions=this._manager.filtered_regions,this.editRegion=i=>this._manager.editRegion(i)}}return e.\u0275fac=function(o){return new(o||e)(n.Y36(v))},e.\u0275cmp=n.Xpm({type:e,selectors:[["region-list"]],decls:4,vars:10,consts:[[1,"absolute","inset-0","overflow-auto"],["empty","No regions",1,"block","min-w-[48rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["action_template",""],[1,"w-full","flex","justify-end","space-x-2"],["btn","","icon","","matTooltip","Edit Region",3,"click"]],template:function(o,i){if(1&o&&(n.TgZ(0,"div",0),n._UZ(1,"custom-table",1),n.qZA(),n.YNc(2,F,4,0,"ng-template",null,2,n.W1O)),2&o){const l=n.MAs(3);n.xp6(1),n.Q6J("dataSource",i.regions)("columns",n.DdM(5,X))("display_column",n.DdM(6,z))("column_size",n.DdM(7,Q))("template",n.VKq(8,B,l))}},dependencies:[Y.gM,R.o,j.C]}),e})();const V=["app-region-manager",""];let M=(()=>{class e{constructor(o){this._state=o,this.newRegion=()=>this._state.editRegion()}}return e.\u0275fac=function(o){return new(o||e)(n.Y36(v))},e.\u0275cmp=n.Xpm({type:e,selectors:[["","app-region-manager",""]],attrs:V,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","p-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(o,i){1&o&&(n._UZ(0,"app-topbar"),n.TgZ(1,"div",0),n._UZ(2,"app-sidebar"),n.TgZ(3,"main",1)(4,"header",2)(5,"h2",3),n._uU(6,"Region Management"),n.qZA(),n.TgZ(7,"button",4),n.NdJ("click",function(){return i.newRegion()}),n._uU(8," Add Region "),n.qZA()(),n._UZ(9,"region-list",5),n.qZA()())},dependencies:[$.O,D.u,J.wG,K],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:#fff}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n/*# sourceMappingURL=region-manager.component.ts-angular-inline--179.css.map*/"]}),e})();var H=t(1031);const W=[{path:"",component:M},{path:"new",component:M}];let k=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[p.ez,s.u5,N.v,C.YR,y.PP,H.Hi,x.Bz.forChild(W)]}),e})()}}]);
//# sourceMappingURL=apps_concierge_src_app_region-manager_region-manager_module_ts.js.map