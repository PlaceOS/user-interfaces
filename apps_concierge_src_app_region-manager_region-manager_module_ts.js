"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_region-manager_region-manager_module_ts"],{555:(te,u,i)=>{i.r(u),i.d(u,{RegionManagerModule:()=>ne});var f=i(6477),l=i(9542),T=i(6585),A=i(3045),E=i(2886),y=i(5533),_=i(5912),m=i(308),h=i(4505),O=i(7716),I=i(6942),Z=i(1670),p=i(7486),c=i(1426),e=i(6839),R=i(8750),G=i(380),N=i(7728),P=i(5312),M=i(2556),C=i(5306);function b(n,a){1&n&&(e.TgZ(0,"button",4)(1,"app-icon"),e._uU(2,"close"),e.qZA()())}function S(n,a){1&n&&(e.TgZ(0,"div",9)(1,"label",10),e.SDv(2,18),e.qZA(),e.TgZ(3,"mat-form-field",12),e._UZ(4,"input",19),e.qZA()())}function L(n,a){if(1&n&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&n){const o=a.$implicit;e.Q6J("value",o),e.xp6(1),e.Oqu(o)}}function w(n,a){1&n&&(e.TgZ(0,"mat-option",21),e._uU(1," No matching timezones "),e.qZA()),2&n&&e.Q6J("disabled",!0)}function z(n,a){if(1&n&&(e.TgZ(0,"form",7),e.YNc(1,S,5,0,"div",8),e.TgZ(2,"div",9)(3,"label",10),e.SDv(4,11),e.qZA(),e.TgZ(5,"mat-form-field",12)(6,"app-icon",13),e._uU(7,"search"),e.qZA(),e._UZ(8,"input",14),e.qZA(),e.TgZ(9,"mat-autocomplete",null,15),e.YNc(11,L,2,2,"mat-option",16),e.YNc(12,w,2,1,"mat-option",17),e.qZA()()()),2&n){const o=e.MAs(10),t=e.oxw(2);e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",t.form.controls.display_name),e.xp6(7),e.Q6J("matAutocomplete",o),e.xp6(3),e.Q6J("ngForOf",t.filtered_timezones),e.xp6(1),e.Q6J("ngIf",!t.timezones.length)}}function $(n,a){if(1&n&&(e.TgZ(0,"main",5),e.YNc(1,z,13,5,"form",6),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngIf",o.form)}}function U(n,a){if(1&n){const o=e.EpF();e.TgZ(0,"footer",22)(1,"button",23),e.NdJ("click",function(){e.CHM(o);const s=e.oxw();return e.KtG(s.save())}),e._uU(2,"Save"),e.qZA()()}}function J(n,a){1&n&&(e.TgZ(0,"div",24),e._UZ(1,"mat-spinner",25),e.TgZ(2,"p",26),e._uU(3,"Saving region..."),e.qZA()())}let D=(()=>{class n extends c.cx{constructor(o,t){super(),this._org=o,this._data=t,this.loading=!1,this.building_list=this._org.building_list,this.timezones=[],this.filtered_timezones=[],this.form=new l.cw({id:new l.NI(this._data?.id||""),display_name:new l.NI(this._data?.display_name||"",[l.kI.required]),timezone:new l.NI(Intl?.DateTimeFormat()?.resolvedOptions()?.timeZone||""),parent_id:new l.NI(this._org.organisation.id)})}ngOnInit(){this._updateTimezoneList(),this.subscription("tz-change",this.form.valueChanges.subscribe(({timezone:o})=>this.filtered_timezones=this.timezones.filter(t=>t.toLowerCase().includes(o.toLowerCase()))))}save(){var o=this;return(0,Z.Z)(function*(){if(!o.form.valid)return(0,c.cB)(`Some form fields are invalid. [${(0,c.RD)(o.form).join(", ")}]`);const t=o.form.getRawValue();o.loading=!0,yield(t.id?(0,m.BfP)(t.id,{...t,name:`REGION ${(0,m.N9E)().description} ${t.display_name}`}):(0,m.ri3)({...t,name:`REGION ${(0,m.N9E)().description} ${t.display_name}`})).toPromise().catch(),o.loading=!1})()}_updateTimezoneList(){const o=this.form?.value?.timezone||"";this.timezones=c.sM,this.filtered_timezones=this.timezones.filter(t=>t.toLowerCase().includes(o.toLowerCase()))}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(_.w7),e.Y36(p.WI))},n.\u0275cmp=e.Xpm({type:n,selectors:[["region-modal"]],features:[e.qOj],decls:8,vars:5,consts:function(){let a,o,t;return a=$localize`:@@displayNameLabel␟dbd34479df566856113383ebef3a2cb98e494642␟7608711767660448404: Timezone: `,o=$localize`:@@displayNameLabel␟8d766661ed5e178519720ec8e959d2a737f600a6␟1377207093952578744: Display Name: `,t=$localize`:@@displayNamePlaceholder␟e438ba78cbafdb5bcbce0820bfaad995a504f222␟3013055597615607317:Display Name`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-gray-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[36rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[36rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","display-name"],a,["appearance","outline"],["matPrefix","",1,"text-2xl"],["matInput","","formControlName","timezone","placeholder","Building timezone",3,"matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],o,["matInput","","name","display-name","placeholder",t,"formControlName","display_name"],[3,"value"],[3,"disabled"],[1,"p-2","flex","justify-end","border-t","border-gray-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(o,t){if(1&o&&(e.TgZ(0,"header")(1,"h2"),e._uU(2),e.qZA(),e.YNc(3,b,3,0,"button",0),e.qZA(),e.YNc(4,$,2,1,"main",1),e.YNc(5,U,3,0,"footer",2),e.YNc(6,J,4,0,"ng-template",null,3,e.W1O)),2&o){const s=e.MAs(7);e.xp6(2),e.hij("",t.form.value.id?"Edit":"Add"," Region"),e.xp6(1),e.Q6J("ngIf",!t.loading),e.xp6(1),e.Q6J("ngIf",!t.loading)("ngIfElse",s),e.xp6(1),e.Q6J("ngIf",!t.loading)}},dependencies:[f.sg,f.O5,l._Y,l.Fj,l.JJ,l.JL,R.KE,R.qo,G.Nt,N.ey,P.Ou,p.ZT,M.XC,M.ZL,l.sg,l.u,C.o]}),n})(),v=(()=>{class n{constructor(o,t){this._org=o,this._dialog=t,this._options=new h.X({}),this._change=new h.X(0),this.options=this._options.asObservable(),this.filtered_regions=(0,O.aj)([this._org.building_list,this._org.region_list,this._options]).pipe((0,I.U)(([s,r,d])=>{d.search&&(r=r.filter(g=>g.name.toLowerCase().includes(d.search.toLowerCase())));for(const g of r)g.building_count=s.filter(oe=>oe.parent_id===g.id).length;return r}))}setFilters(o){this._options.next({...this._options.getValue(),...o})}setSearchString(o){this._options.next({...this._options.getValue(),search:o})}editRegion(o=new m.TT8){this._dialog.open(D,{data:o}).afterClosed().subscribe(s=>{s&&setTimeout(()=>this._change.next(Date.now()),300)})}}return n.\u0275fac=function(o){return new(o||n)(e.LFG(_.w7),e.LFG(p.uw))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var Y=i(6866),F=i(3320),j=i(2423),Q=i(1110);function X(n,a){if(1&n){const o=e.EpF();e.TgZ(0,"div",3)(1,"button",4),e.NdJ("click",function(){const r=e.CHM(o).row,d=e.oxw();return e.KtG(d.editRegion(r))}),e.TgZ(2,"app-icon"),e._uU(3,"edit"),e.qZA()()()}}const B=function(){return["display_name","building_count","actions"]},K=function(){return["Name","Buildings"," "]},V=function(){return["flex","10r","5r"]},H=function(n){return{actions:n}};let W=(()=>{class n{constructor(o){this._manager=o,this.regions=this._manager.filtered_regions,this.editRegion=t=>this._manager.editRegion(t)}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(v))},n.\u0275cmp=e.Xpm({type:n,selectors:[["region-list"]],decls:4,vars:10,consts:[[1,"absolute","inset-0","overflow-auto"],["empty","No regions",1,"block","min-w-[48rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["action_template",""],[1,"w-full","flex","justify-end","space-x-2"],["btn","","icon","","matTooltip","Edit Region",3,"click"]],template:function(o,t){if(1&o&&(e.TgZ(0,"div",0),e._UZ(1,"custom-table",1),e.qZA(),e.YNc(2,X,4,0,"ng-template",null,2,e.W1O)),2&o){const s=e.MAs(3);e.xp6(1),e.Q6J("dataSource",t.regions)("columns",e.DdM(5,B))("display_column",e.DdM(6,K))("column_size",e.DdM(7,V))("template",e.VKq(8,H,s))}},dependencies:[j.gM,C.o,Q.C]}),n})();const q=["app-region-manager",""];let x=(()=>{class n{constructor(o){this._state=o,this.newRegion=()=>this._state.editRegion()}}return n.\u0275fac=function(o){return new(o||n)(e.Y36(v))},n.\u0275cmp=e.Xpm({type:n,selectors:[["","app-region-manager",""]],attrs:q,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","p-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(o,t){1&o&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1)(4,"header",2)(5,"h2",3),e._uU(6,"Region Management"),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return t.newRegion()}),e._uU(8," Add Region "),e.qZA()(),e._UZ(9,"region-list",5),e.qZA()())},dependencies:[Y.O,F.u,N.wG,W],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:#fff}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n/*# sourceMappingURL=region-manager.component.ts-angular-inline--179.css.map*/"]}),n})();var k=i(1031);const ee=[{path:"",component:x},{path:"new",component:x}];let ne=(()=>{class n{}return n.\u0275fac=function(o){return new(o||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[f.ez,l.u5,A.v,E.YR,y.PP,k.Hi,T.Bz.forChild(ee)]}),n})()}}]);
//# sourceMappingURL=apps_concierge_src_app_region-manager_region-manager_module_ts.js.map