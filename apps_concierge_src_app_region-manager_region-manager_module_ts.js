"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_region-manager_region-manager_module_ts"],{1696:(O,f,s)=>{s.r(f),s.d(f,{RegionManagerModule:()=>se});var p=s(316),r=s(4456),y=s(6842),v=s(363),E=s(2168),g=s(8390),C=s(9204),u=s(2185),c=s(3998),N=s(521),l=s(2175),F=s(5443),h=s(2587),d=s(2333),e=s(7404),x=s(4950),A=s(7984),M=s(5060),S=s(1134),G=s(9771),I=s(9434);function P(n,m){1&n&&(e.j41(0,"button",7)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function L(n,m){1&n&&(e.j41(0,"div",12)(1,"label",13),e.pXf(2,3),e.k0s(),e.j41(3,"mat-form-field",14),e.nrm(4,"input",19),e.k0s()())}function $(n,m){if(1&n&&(e.j41(0,"mat-option",20),e.EFF(1),e.k0s()),2&n){const t=m.$implicit;e.Y8G("value",t),e.R7$(),e.JRh(t)}}function w(n,m){1&n&&(e.j41(0,"mat-option",21),e.EFF(1," No matching timezones "),e.k0s()),2&n&&e.Y8G("disabled",!0)}function k(n,m){if(1&n&&(e.j41(0,"form",10),e.DNE(1,L,5,0,"div",11),e.j41(2,"div",12)(3,"label",13),e.pXf(4,2),e.k0s(),e.j41(5,"mat-form-field",14)(6,"app-icon",15),e.EFF(7,"search"),e.k0s(),e.nrm(8,"input",16),e.k0s(),e.j41(9,"mat-autocomplete",null,1),e.DNE(11,$,2,2,"mat-option",17)(12,w,2,1,"mat-option",18),e.k0s()()()),2&n){const t=e.sdS(10),o=e.XpG(2);e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("ngIf",o.form.controls.display_name),e.R7$(7),e.Y8G("matAutocomplete",t),e.R7$(3),e.Y8G("ngForOf",o.filtered_timezones),e.R7$(),e.Y8G("ngIf",!o.timezones.length)}}function z(n,m){if(1&n&&(e.j41(0,"main",8),e.DNE(1,k,13,5,"form",9),e.k0s()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.form)}}function D(n,m){if(1&n){const t=e.RV6();e.j41(0,"footer",22)(1,"button",23),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.save())}),e.EFF(2,"Save"),e.k0s()()}}function X(n,m){1&n&&(e.j41(0,"div",24),e.nrm(1,"mat-spinner",25),e.j41(2,"p",26),e.EFF(3,"Saving region..."),e.k0s()())}let V=(()=>{class n extends d.Tv{constructor(t,o,i){super(),this._org=t,this._data=o,this._dialog_ref=i,this.loading=!1,this.building_list=this._org.building_list,this.timezones=[],this.filtered_timezones=[],this.form=new r.gE({id:new r.MJ(this._data?.id||""),display_name:new r.MJ(this._data?.display_name||"",[r.k0.required]),timezone:new r.MJ(Intl?.DateTimeFormat()?.resolvedOptions()?.timeZone||""),parent_id:new r.MJ(this._org.organisation.id)})}ngOnInit(){this._updateTimezoneList(),this.subscription("tz-change",this.form.valueChanges.subscribe(({timezone:t})=>this.filtered_timezones=this.timezones.filter(o=>o.toLowerCase().includes(t.toLowerCase()))))}save(){var t=this;return(0,C.A)(function*(){if(!t.form.valid)return(0,d.UG)(`Some form fields are invalid. [${(0,d.F7)(t.form).join(", ")}]`);const o=t.form.getRawValue();o.tags=["region"],t.loading=!0;const i=yield(o.id?(0,c.G5B)(o.id,{...o,name:`REGION ${(0,c.kup)().description} ${o.display_name}`}):(0,c.aP8)({...o,name:`REGION ${(0,c.kup)().description} ${o.display_name}`})).toPromise().catch();i.id&&t._dialog_ref.close(i),t.loading=!1})()}_updateTimezoneList(){const t=this.form?.value?.timezone||"";this.timezones=d.Rd,this.filtered_timezones=this.timezones.filter(o=>o.toLowerCase().includes(t.toLowerCase()))}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(u.yb),e.rXU(h.Vh),e.rXU(h.CP))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["region-modal"]],features:[e.Vt3],decls:8,vars:5,consts:()=>{let t,o,i;return t=$localize`:@@displayNameLabel␟dbd34479df566856113383ebef3a2cb98e494642␟7608711767660448404: Timezone: `,o=$localize`:@@displayNamePlaceholder␟e438ba78cbafdb5bcbce0820bfaad995a504f222␟3013055597615607317:Display Name`,i=$localize`:@@displayNameLabel␟8d766661ed5e178519720ec8e959d2a737f600a6␟1377207093952578744: Display Name: `,[["load_state",""],["auto","matAutocomplete"],t,i,["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[36rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[36rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","display-name"],["appearance","outline"],["matPrefix","",1,"text-2xl"],["matInput","","formControlName","timezone","placeholder","Building timezone",3,"matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],["matInput","","name","display-name","placeholder",o,"formControlName","display_name"],[3,"value"],[3,"disabled"],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(o,i){if(1&o&&(e.j41(0,"header")(1,"h2"),e.EFF(2),e.k0s(),e.DNE(3,P,3,0,"button",4),e.k0s(),e.DNE(4,z,2,1,"main",5)(5,D,3,0,"footer",6)(6,X,4,0,"ng-template",null,0,e.C5r)),2&o){const a=e.sdS(7);e.R7$(2),e.SpI("",i.form.value.id?"Edit":"Add"," Region"),e.R7$(),e.Y8G("ngIf",!i.loading),e.R7$(),e.Y8G("ngIf",!i.loading)("ngIfElse",a),e.R7$(),e.Y8G("ngIf",!i.loading)}},dependencies:[p.Sq,p.bT,r.qT,r.me,r.BC,r.cb,x.rl,x.JW,A.fg,M.wT,S.LG,h.tx,G.$3,G.pN,r.j4,r.JD,I.R]})}return n})();var B=s(6252);let T=(()=>{class n{constructor(t,o){this._org=t,this._dialog=o,this._options=new N.t({}),this._change=new N.t(0),this.options=this._options.asObservable(),this.filtered_regions=(0,l.zV)([this._org.building_list,this._org.region_list,this._options]).pipe((0,F.T)(([i,a,_])=>{_.search&&(a=a.filter(R=>R.name.toLowerCase().includes(_.search.toLowerCase())));for(const R of a)R.building_count=i.filter(ae=>ae.parent_id===R.id).length;return a}))}setFilters(t){this._options.next({...this._options.getValue(),...t})}setSearchString(t){this._options.next({...this._options.getValue(),search:t})}editRegion(t=new c.kMc){this._dialog.open(V,{data:t}).afterClosed().subscribe(i=>{i&&this._org.addZone(i)})}editRegionMetadata(t=new c.kMc){this._dialog.open(B.j,{data:{zone:t}}).afterClosed().subscribe(i=>{i&&setTimeout(()=>location.reload(),300)})}removeRegion(t){var o=this;return(0,C.A)(function*(){const i=yield(0,d.GE)({title:"Remove Building",content:`Are you sure you want to remove the building "${t.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},o._dialog);if("done"!==i.reason)return i.close();i.loading("Removing building..."),yield(0,c.ZhK)(t.id).toPromise(),o._org.removeZone({id:t.id,tags:["region"]}),(0,d.VX)("Successfully removed building."),i.close()})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.KVO(u.yb),e.KVO(h.bZ))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Y=s(5189),U=s(6843),J=s(2352),b=s(1034),Z=s(8328);const K=n=>({key:"display_name",name:"Building Name",content:n}),H=()=>({key:"building_count",name:"Buildings",size:"8rem"}),W=n=>({key:"actions",name:" ",content:n,size:"3rem",sortable:!1}),Q=(n,m,t)=>[n,m,t];function q(n,m){if(1&n){const t=e.RV6();e.j41(0,"button",6),e.bIt("click",function(){const i=e.eBV(t).row,a=e.XpG();return e.Njj(a.copyToClipboard(i.id))}),e.j41(1,"div",7),e.EFF(2),e.k0s(),e.j41(3,"div",8),e.EFF(4),e.k0s()()}if(2&n){const t=m.row,o=m.data;e.R7$(2),e.JRh(o),e.R7$(2),e.SpI(" ",t.id," ")}}function ee(n,m){if(1&n){const t=e.RV6();e.j41(0,"div",9)(1,"button",10)(2,"app-icon"),e.EFF(3,"more_vert"),e.k0s()(),e.j41(4,"mat-menu",null,2)(6,"button",11),e.bIt("click",function(){const i=e.eBV(t).row,a=e.XpG();return e.Njj(a.editMetadata(i))}),e.j41(7,"div",12)(8,"app-icon"),e.EFF(9,"edit_square"),e.k0s(),e.j41(10,"span"),e.EFF(11,"App Configuration"),e.k0s()()(),e.j41(12,"button",11),e.bIt("click",function(){const i=e.eBV(t).row,a=e.XpG();return e.Njj(a.editRegion(i))}),e.j41(13,"div",12)(14,"app-icon"),e.EFF(15,"edit"),e.k0s(),e.j41(16,"span"),e.EFF(17,"Edit Region"),e.k0s()()(),e.j41(18,"button",11),e.bIt("click",function(){const i=e.eBV(t).row,a=e.XpG();return e.Njj(a.removeRegion(i))}),e.j41(19,"div",13)(20,"app-icon",14),e.EFF(21,"delete"),e.k0s(),e.j41(22,"span"),e.EFF(23,"Delete Region"),e.k0s()()()()()}if(2&n){const t=e.sdS(5);e.R7$(),e.Y8G("matMenuTriggerFor",t)}}let te=(()=>{class n{constructor(t,o){this._manager=t,this._clipboard=o,this.regions=this._manager.filtered_regions,this.editRegion=i=>this._manager.editRegion(i),this.removeRegion=i=>this._manager.removeRegion(i),this.editMetadata=i=>this._manager.editRegionMetadata(i),this.copyToClipboard=i=>{this._clipboard.copy(i)&&(0,d.VX)("Region ID copied to clipboard.")}}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(T),e.rXU(J.B0))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["region-list"]],decls:7,vars:12,consts:[["name_template",""],["action_template",""],["menu","matMenu"],[1,"absolute","inset-0","overflow-auto","px-8"],["empty_message","No Regions",1,"min-w-[32rem]","block","text-sm",3,"data","columns","sortable"],[1,"w-full","h-20"],[1,"px-4","py-2","text-left","leading-tight",3,"click"],[1,""],[1,"text-[0.625rem]","opacity-30","font-mono"],[1,"w-full","flex","justify-end","space-x-2"],["icon","","matRipple","",1,"h-12","w-12","rounded",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","space-x-2","text-red-500"],[1,"text-error"]],template:function(o,i){if(1&o&&(e.j41(0,"div",3),e.nrm(1,"simple-table",4)(2,"div",5),e.k0s(),e.DNE(3,q,5,2,"ng-template",null,0,e.C5r)(5,ee,24,1,"ng-template",null,1,e.C5r)),2&o){const a=e.sdS(4),_=e.sdS(6);e.R7$(),e.Y8G("data",i.regions)("columns",e.sMw(8,Q,e.eq3(3,K,a),e.lJ4(5,H),e.eq3(6,W,_)))("sortable",!0)}},dependencies:[b.kk,b.fb,b.Cp,M.r6,I.R,Z.O]})}return n})();const ne=["app-region-manager",""];let j=(()=>{class n{constructor(t){this._state=t,this.newRegion=()=>this._state.editRegion()}static#e=this.\u0275fac=function(o){return new(o||n)(e.rXU(T))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["","app-region-manager",""]],attrs:ne,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","px-8","pt-4","pb-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",1,"w-40",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(o,i){1&o&&(e.nrm(0,"app-topbar"),e.j41(1,"div",0),e.nrm(2,"app-sidebar"),e.j41(3,"main",1)(4,"header",2)(5,"h2",3),e.EFF(6,"Region Management"),e.k0s(),e.j41(7,"button",4),e.bIt("click",function(){return i.newRegion()}),e.EFF(8," Add Region "),e.k0s()(),e.nrm(9,"region-list",5),e.k0s()())},dependencies:[Y.S,U.c,M.r6,te],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=region-manager.component.ts-angular-inline--186.css.map*/"]})}return n})();var oe=s(2772);const ie=[{path:"",component:j},{path:"new",component:j}];let se=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[p.MD,r.YN,v.r,E.lx,g.kR,oe.YN,y.iI.forChild(ie)]})}return n})()},8390:(O,f,s)=>{s.d(f,{g8:()=>E,kR:()=>p.k,Gp:()=>g.Gp,KJ:()=>g.KJ,N8:()=>c.N8,SZ:()=>c.SZ,is:()=>u.is});var p=s(1081),v=(s(3924),s(4621),s(9908));class E{constructor(l={}){this.type=l.type||l.location||"other",this.position=l.position||l.map_id||l.asset_id||{x:l.x/l.map_width||0,y:l.y/l.map_height||0},this.variance=l.variance||0,this.last_seen=l.last_seen||(0,v._)(new Date),this.level=l.level,this.building=l.building,this.at_location=!!l.at_location,this.coordinates_from=l.coordinates_from||"top-left"}}var g=s(3693),u=(s(4129),s(6039)),c=s(2372)}}]);
//# sourceMappingURL=apps_concierge_src_app_region-manager_region-manager_module_ts.js.map