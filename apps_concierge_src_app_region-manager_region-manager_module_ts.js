"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_region-manager_region-manager_module_ts"],{3887:(b,f,i)=>{i.r(f),i.d(f,{RegionManagerModule:()=>ne});var p=i(26575),r=i(28849),A=i(92649),v=i(97910),x=i(46514),R=i(59524),C=i(71670),u=i(93121),c=i(47298),N=i(70462),l=i(28159),P=i(47422),_=i(17401),g=i(34592),e=i(29039),Z=i(71268),G=i(99674),T=i(10257),L=i(33910),y=i(99892),E=i(94888);function w(n,m){1&n&&(e.TgZ(0,"button",4)(1,"app-icon"),e._uU(2,"close"),e.qZA()())}function S(n,m){1&n&&(e.TgZ(0,"div",9)(1,"label",10),e.SDv(2,18),e.qZA(),e.TgZ(3,"mat-form-field",12),e._UZ(4,"input",19),e.qZA()())}function z(n,m){if(1&n&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&n){const t=m.$implicit;e.Q6J("value",t),e.xp6(),e.Oqu(t)}}function U(n,m){1&n&&(e.TgZ(0,"mat-option",21),e._uU(1," No matching timezones "),e.qZA()),2&n&&e.Q6J("disabled",!0)}function J(n,m){if(1&n&&(e.TgZ(0,"form",7),e.YNc(1,S,5,0,"div",8),e.TgZ(2,"div",9)(3,"label",10),e.SDv(4,11),e.qZA(),e.TgZ(5,"mat-form-field",12)(6,"app-icon",13),e._uU(7,"search"),e.qZA(),e._UZ(8,"input",14),e.qZA(),e.TgZ(9,"mat-autocomplete",null,15),e.YNc(11,z,2,2,"mat-option",16)(12,U,2,1,"mat-option",17),e.qZA()()()),2&n){const t=e.MAs(10),o=e.oxw(2);e.Q6J("formGroup",o.form),e.xp6(),e.Q6J("ngIf",o.form.controls.display_name),e.xp6(7),e.Q6J("matAutocomplete",t),e.xp6(3),e.Q6J("ngForOf",o.filtered_timezones),e.xp6(),e.Q6J("ngIf",!o.timezones.length)}}function $(n,m){if(1&n&&(e.TgZ(0,"main",5),e.YNc(1,J,13,5,"form",6),e.qZA()),2&n){const t=e.oxw();e.xp6(),e.Q6J("ngIf",t.form)}}function D(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"footer",22)(1,"button",23),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.save())}),e._uU(2,"Save"),e.qZA()()}}function F(n,m){1&n&&(e.TgZ(0,"div",24),e._UZ(1,"mat-spinner",25),e.TgZ(2,"p",26),e._uU(3,"Saving region..."),e.qZA()())}let Y=(()=>{class n extends g.cx{constructor(t,o,s){super(),this._org=t,this._data=o,this._dialog_ref=s,this.loading=!1,this.building_list=this._org.building_list,this.timezones=[],this.filtered_timezones=[],this.form=new r.cw({id:new r.NI(this._data?.id||""),display_name:new r.NI(this._data?.display_name||"",[r.kI.required]),timezone:new r.NI(Intl?.DateTimeFormat()?.resolvedOptions()?.timeZone||""),parent_id:new r.NI(this._org.organisation.id)})}ngOnInit(){this._updateTimezoneList(),this.subscription("tz-change",this.form.valueChanges.subscribe(({timezone:t})=>this.filtered_timezones=this.timezones.filter(o=>o.toLowerCase().includes(t.toLowerCase()))))}save(){var t=this;return(0,C.Z)(function*(){if(!t.form.valid)return(0,g.cB)(`Some form fields are invalid. [${(0,g.RD)(t.form).join(", ")}]`);const o=t.form.getRawValue();o.tags=["region"],t.loading=!0;const s=yield(o.id?(0,c.BfP)(o.id,{...o,name:`REGION ${(0,c.N9E)().description} ${o.display_name}`}):(0,c.ri3)({...o,name:`REGION ${(0,c.N9E)().description} ${o.display_name}`})).toPromise().catch();s.id&&t._dialog_ref.close(s),t.loading=!1})()}_updateTimezoneList(){const t=this.form?.value?.timezone||"";this.timezones=g.sM,this.filtered_timezones=this.timezones.filter(o=>o.toLowerCase().includes(t.toLowerCase()))}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(u.w7),e.Y36(_.WI),e.Y36(_.so))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["region-modal"]],features:[e.qOj],decls:8,vars:5,consts:()=>{let t,o,s;return t=$localize`:@@displayNameLabel␟dbd34479df566856113383ebef3a2cb98e494642␟7608711767660448404: Timezone: `,o=$localize`:@@displayNameLabel␟8d766661ed5e178519720ec8e959d2a737f600a6␟1377207093952578744: Display Name: `,s=$localize`:@@displayNamePlaceholder␟e438ba78cbafdb5bcbce0820bfaad995a504f222␟3013055597615607317:Display Name`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[36rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[36rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","display-name"],t,["appearance","outline"],["matPrefix","",1,"text-2xl"],["matInput","","formControlName","timezone","placeholder","Building timezone",3,"matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],o,["matInput","","name","display-name","placeholder",s,"formControlName","display_name"],[3,"value"],[3,"disabled"],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(o,s){if(1&o&&(e.TgZ(0,"header")(1,"h2"),e._uU(2),e.qZA(),e.YNc(3,w,3,0,"button",0),e.qZA(),e.YNc(4,$,2,1,"main",1)(5,D,3,0,"footer",2)(6,F,4,0,"ng-template",null,3,e.W1O)),2&o){const a=e.MAs(7);e.xp6(2),e.hij("",s.form.value.id?"Edit":"Add"," Region"),e.xp6(),e.Q6J("ngIf",!s.loading),e.xp6(),e.Q6J("ngIf",!s.loading)("ngIfElse",a),e.xp6(),e.Q6J("ngIf",!s.loading)}},dependencies:[p.sg,p.O5,r._Y,r.Fj,r.JJ,r.JL,Z.KE,Z.qo,G.Nt,T.ey,L.Ou,_.ZT,y.XC,y.ZL,r.sg,r.u,E.o]})}return n})();var Q=i(66229);let O=(()=>{class n{constructor(t,o){this._org=t,this._dialog=o,this._options=new N.X({}),this._change=new N.X(0),this.options=this._options.asObservable(),this.filtered_regions=(0,l.aj)([this._org.building_list,this._org.region_list,this._options]).pipe((0,P.U)(([s,a,d])=>{d.search&&(a=a.filter(h=>h.name.toLowerCase().includes(d.search.toLowerCase())));for(const h of a)h.building_count=s.filter(ie=>ie.parent_id===h.id).length;return a}))}setFilters(t){this._options.next({...this._options.getValue(),...t})}setSearchString(t){this._options.next({...this._options.getValue(),search:t})}editRegion(t=new c.TT8){this._dialog.open(Y,{data:t}).afterClosed().subscribe(s=>{s&&this._org.addZone(s)})}editRegionMetadata(t=new c.TT8){this._dialog.open(Q.K,{data:{zone:t}}).afterClosed().subscribe(s=>{s&&setTimeout(()=>location.reload(),300)})}removeRegion(t){var o=this;return(0,C.Z)(function*(){const s=yield(0,g._5)({title:"Remove Building",content:`Are you sure you want to remove the building "${t.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},o._dialog);if("done"!==s.reason)return s.close();s.loading("Removing building..."),yield(0,c.Jwl)(t.id).toPromise(),o._org.removeZone({id:t.id,tags:["region"]}),(0,g.t5)("Successfully removed building."),s.close()})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(u.w7),e.LFG(_.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var j=i(33005),X=i(19842),M=i(78128),B=i(27442);function K(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"button",4)(2,"app-icon"),e._uU(3,"more_vert"),e.qZA()(),e.TgZ(4,"mat-menu",null,5)(6,"button",6),e.NdJ("click",function(){const a=e.CHM(t).row,d=e.oxw();return e.KtG(d.editMetadata(a))}),e.TgZ(7,"div",7)(8,"app-icon"),e._uU(9,"edit_square"),e.qZA(),e.TgZ(10,"span"),e._uU(11,"App Configuration"),e.qZA()()(),e.TgZ(12,"button",6),e.NdJ("click",function(){const a=e.CHM(t).row,d=e.oxw();return e.KtG(d.editRegion(a))}),e.TgZ(13,"div",7)(14,"app-icon"),e._uU(15,"edit"),e.qZA(),e.TgZ(16,"span"),e._uU(17,"Edit Region"),e.qZA()()(),e.TgZ(18,"button",6),e.NdJ("click",function(){const a=e.CHM(t).row,d=e.oxw();return e.KtG(d.removeRegion(a))}),e.TgZ(19,"div",8)(20,"app-icon"),e._uU(21,"delete"),e.qZA(),e.TgZ(22,"span"),e._uU(23,"Delete Region"),e.qZA()()()()()}if(2&n){const t=e.MAs(5);e.xp6(),e.Q6J("matMenuTriggerFor",t)}}const V=()=>["display_name","building_count","actions"],H=()=>["Name","Buildings"," "],W=()=>["flex","10r","3.75r"],q=n=>({actions:n});let k=(()=>{class n{constructor(t){this._manager=t,this.regions=this._manager.filtered_regions,this.editRegion=o=>this._manager.editRegion(o),this.removeRegion=o=>this._manager.removeRegion(o),this.editMetadata=o=>this._manager.editRegionMetadata(o)}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(O))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["region-list"]],decls:4,vars:10,consts:[[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No regions",1,"block","min-w-[32rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["action_template",""],[1,"w-full","flex","justify-end","space-x-2"],["btn","","icon","","matRipple","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","space-x-2","text-red-500"]],template:function(o,s){if(1&o&&(e.TgZ(0,"div",0),e._UZ(1,"custom-table",1),e.qZA(),e.YNc(2,K,24,1,"ng-template",null,2,e.W1O)),2&o){const a=e.MAs(3);e.xp6(),e.Q6J("dataSource",s.regions)("columns",e.DdM(5,V))("display_column",e.DdM(6,H))("column_size",e.DdM(7,W))("template",e.VKq(8,q,a))}},dependencies:[M.VK,M.OP,M.p6,T.wG,E.o,B.C]})}return n})();const ee=["app-region-manager",""];let I=(()=>{class n{constructor(t){this._state=t,this.newRegion=()=>this._state.editRegion()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(O))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","app-region-manager",""]],attrs:ee,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","px-4","py-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(o,s){1&o&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1)(4,"header",2)(5,"h2",3),e._uU(6,"Region Management"),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return s.newRegion()}),e._uU(8," Add Region "),e.qZA()(),e._UZ(9,"region-list",5),e.qZA()())},dependencies:[j.O,X.u,T.wG,k],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=region-manager.component.ts-angular-inline--188.css.map*/"]})}return n})();var te=i(21757);const oe=[{path:"",component:I},{path:"new",component:I}];let ne=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#o=this.\u0275inj=e.cJS({imports:[p.ez,r.u5,v.v,x.YR,R.PP,te.Hi,A.Bz.forChild(oe)]})}return n})()},59524:(b,f,i)=>{i.d(f,{Y:()=>x,PP:()=>p.P,mO:()=>R.mO,VE:()=>c.VE,w0:()=>c.w0,sF:()=>u.sF});var p=i(43211),v=(i(86755),i(80882),i(67343));class x{constructor(l={}){this.type=l.type||l.location||"other",this.position=l.position||l.map_id||l.asset_id||{x:l.x/l.map_width||0,y:l.y/l.map_height||0},this.variance=l.variance||0,this.last_seen=l.last_seen||(0,v.Z)(new Date),this.level=l.level,this.building=l.building,this.at_location=!!l.at_location,this.coordinates_from=l.coordinates_from||"top-left"}}var R=i(223),u=(i(11451),i(38125)),c=i(48675)}}]);
//# sourceMappingURL=apps_concierge_src_app_region-manager_region-manager_module_ts.js.map