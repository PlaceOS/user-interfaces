"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[74],{3540:(_t,u,r)=>{r.r(u),r.d(u,{UrlManagerModule:()=>ct});var g=r(6814),i=r(6223),S=r(6980),U=r(7910),v=r(7049),N=r(5157),m=r(5861),L=r(3121),h=r(5125),T=r(2994),R=r(5222),E=r(9185),Z=r(6124),d=r(9347),c=r(4592),t=r(9212),P=r(4170),b=r(8582),F=r(5986),O=r(5940),I=r(3313),x=r(4888);function G(o,s){1&o&&(t.TgZ(0,"button",4)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function y(o,s){1&o&&(t.TgZ(0,"div",10)(1,"label",11),t.tHW(2,12),t._UZ(3,"span"),t.N_p(),t.qZA(),t.TgZ(4,"mat-form-field",13),t._UZ(5,"input",14),t.qZA()())}function w(o,s){1&o&&(t.TgZ(0,"div",15)(1,"label",16),t.SDv(2,17),t.qZA(),t._UZ(3,"rich-text-input",18),t.qZA())}function $(o,s){1&o&&(t.TgZ(0,"div",10)(1,"label",19),t.tHW(2,20),t._UZ(3,"span"),t.N_p(),t.qZA(),t.TgZ(4,"mat-form-field",13),t._UZ(5,"input",21),t.qZA()())}function D(o,s){1&o&&(t.TgZ(0,"div",15)(1,"mat-checkbox",22),t._uU(2," Enabled "),t.qZA()())}function J(o,s){if(1&o&&(t.TgZ(0,"form",7),t.YNc(1,y,6,0,"div",8)(2,w,4,0,"div",9)(3,$,6,0,"div",8)(4,D,3,0,"div",9),t.qZA()),2&o){const e=t.oxw(2);t.Q6J("formGroup",e.form),t.xp6(),t.Q6J("ngIf",e.form.controls.name),t.xp6(),t.Q6J("ngIf",e.form.controls.description),t.xp6(),t.Q6J("ngIf",e.form.controls.uri),t.xp6(),t.Q6J("ngIf",e.form.controls.enabled)}}function Q(o,s){if(1&o&&(t.TgZ(0,"main",5),t.YNc(1,J,5,5,"form",6),t.qZA()),2&o){const e=t.oxw();t.xp6(),t.Q6J("ngIf",e.form)}}function X(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"footer",23)(1,"button",24),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.save())}),t._uU(2,"Save"),t.qZA()()}}function j(o,s){1&o&&(t.TgZ(0,"div",25),t._UZ(1,"mat-spinner",26),t.TgZ(2,"p",27),t._uU(3,"Saving Short URL..."),t.qZA()())}let Y=(()=>{class o extends c.cx{constructor(e,n){super(),this._data=e,this._dialog_ref=n,this.loading=!1,this.form=new i.cw({id:new i.NI(this._data?.id||""),name:new i.NI(this._data?.name||"",[i.kI.required]),description:new i.NI(this._data?.description||"",[]),uri:new i.NI(this._data?.uri||"",[i.kI.required]),enabled:new i.NI(this._data?.enabled??!0,[])})}ngOnInit(){return(0,m.Z)(function*(){})()}save(){var e=this;return(0,m.Z)(function*(){if(!e.form.valid)return(0,c.cB)(`Some form fields are invalid. [${(0,c.RD)(e.form).join(", ")}]`);const n=e.form.getRawValue();e.loading=!0;const a=yield(0,c.Nc)(n).toPromise().catch(l=>(0,c.cB)(`Error saving Short URL: ${l.message}`));a.id&&e._dialog_ref.close(a),e.loading=!1})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(d.WI),t.Y36(d.so))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["short-url-modal"]],features:[t.qOj],decls:8,vars:5,consts:()=>{let e,n,a,l,_;return e=$localize`:@@nameLabel␟5813c0ce49afffe90191cb912c58fa68674457d8␟1912970594501107766: Name${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,n=$localize`:@@namePlaceholder␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,a=$localize`:@@nameLabel␟9965b5a3b51c515676f9a276e6a893e2a1732ca3␟8750987738498515809: Description: `,l=$localize`:@@nameLabel␟376ac142eacbbec6739bf8511dbcf6c843326916␟7187203761692841608: URI${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,_=$localize`:@@uriPlaceholder␟6afb9c1cbd2b73b7a916ca72a1827142d917dc51␟4044274328469675696:URI`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[28rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[28rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],["class","flex flex-col pb-4",4,"ngIf"],[1,"flex","flex-col"],["for","name"],e,["appearance","outline"],["matInput","","name","name","placeholder",n,"formControlName","name"],[1,"flex","flex-col","pb-4"],["for","description"],a,["name","description","formControlName","description"],["for","uri"],l,["matInput","","name","uri","placeholder",_,"formControlName","uri"],["formControlName","enabled"],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(n,a){if(1&n&&(t.TgZ(0,"header")(1,"h2"),t._uU(2),t.qZA(),t.YNc(3,G,3,0,"button",0),t.qZA(),t.YNc(4,Q,2,1,"main",1)(5,X,3,0,"footer",2)(6,j,4,0,"ng-template",null,3,t.W1O)),2&n){const l=t.MAs(7);t.xp6(2),t.hij("",a.form.value.id?"Edit":"Add"," Short URL"),t.xp6(),t.Q6J("ngIf",!a.loading),t.xp6(),t.Q6J("ngIf",!a.loading)("ngIfElse",l),t.xp6(),t.Q6J("ngIf",!a.loading)}},dependencies:[g.O5,i._Y,i.Fj,i.JJ,i.JL,P.KE,b.Nt,F.oG,O.Ou,d.ZT,i.sg,i.u,I.n,x.o]})}return o})(),A=(()=>{class o{constructor(e,n){this._org=e,this._dialog=n,this._options=new h.X({}),this._change=new h.X(0),this.options=this._options.asObservable(),this._url_list=(0,T.aj)([this._org.active_building,this._change]).pipe((0,R.w)(([a])=>(0,c.O)({})),(0,E.d)(1)),this.filtered_urls=(0,T.aj)([this._url_list,this._options]).pipe((0,Z.U)(([a,l])=>a.filter(_=>!l.search||_.name.toLowerCase().includes(l.search.toLowerCase()))))}setFilters(e){this._options.next({...this._options.getValue(),...e})}setSearchString(e){this._options.next({...this._options.getValue(),search:e})}editURL(e){this._dialog.open(Y,{data:e}).afterClosed().subscribe(()=>this._change.next(Date.now()))}removeURL(e){var n=this;return(0,m.Z)(function*(){const a=yield(0,c._5)({title:"Remove Short URL",content:`Are you sure you want to remove the Short URL "${e.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},n._dialog);if("done"!==a.reason)return a.close();a.loading("Removing Short URL..."),yield(0,c.fF)(e.id).toPromise().catch(l=>{throw(0,c.cB)(`Error removing Short URL: ${l.message}`),a.close(),l}),(0,c.t5)("Successfully removed Short URL."),a.close(),n._change.next(Date.now())})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.LFG(L.w7),t.LFG(d.uw))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var H=r(3005),z=r(9842),C=r(3680),f=r(7988),W=r(7442),B=r(3884),K=r(1886),k=r(6318);function q(o,s){if(1&o&&(t.TgZ(0,"a",4),t._uU(1),t.qZA()),2&o){const e=s.data;t.Q6J("href",e,t.LSH),t.xp6(),t.Oqu(e)}}function V(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",14)(1,"div",15)(2,"a",16),t.ALo(3,"safe"),t._UZ(4,"img",17),t.qZA(),t.TgZ(5,"div",18),t._uU(6),t.qZA()(),t.TgZ(7,"button",19),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.print())}),t._uU(8," Print QR Code "),t.qZA()()}if(2&o){const e=t.oxw().row;t.xp6(2),t.Q6J("href",t.xi3(3,3,e.uri,"url"),t.LSH),t.xp6(2),t.Q6J("src",e.qr_code,t.LSH),t.xp6(2),t.hij(" ",e.name||e.id," ")}}function tt(o,s){if(1&o){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){const l=t.CHM(e).row,_=t.oxw();return t.KtG(_.loadQrCode(l))}),t.TgZ(2,"app-icon"),t._uU(3,"qr_code"),t.qZA()(),t.YNc(4,V,9,6,"ng-template",null,7,t.W1O),t.TgZ(6,"button",8)(7,"app-icon"),t._uU(8,"more_vert"),t.qZA()(),t.TgZ(9,"mat-menu",null,9)(11,"button",10),t.NdJ("click",function(){const l=t.CHM(e).row,_=t.oxw();return t.KtG(_.edit(l))}),t.TgZ(12,"div",11)(13,"app-icon"),t._uU(14,"edit"),t.qZA(),t.TgZ(15,"span"),t._uU(16,"Edit Short URL"),t.qZA()()(),t.TgZ(17,"button",10),t.NdJ("click",function(){const l=t.CHM(e).row,_=t.oxw();return t.KtG(_.remove(l))}),t.TgZ(18,"div",12)(19,"app-icon",13),t._uU(20,"delete"),t.qZA(),t.TgZ(21,"span"),t._uU(22,"Delete Short URL"),t.qZA()()()()()}if(2&o){const e=t.MAs(5),n=t.MAs(10);t.xp6(),t.Q6J("content",e),t.xp6(5),t.Q6J("matMenuTriggerFor",n)}}const et=()=>["name","uri","user_name","description","actions"],ot=()=>["Name","URI","Creator","Description"," "],nt=()=>["flex","14r","10r","10r","6.5r"],at=(o,s)=>({uri:o,actions:s});let rt=(()=>{class o{get kiosk_url(){const e=this._settings.get("app.kiosk_url_path")||"/map-kiosk";return`${window.location.origin}${e}`}loadQrCode(e){return(0,m.Z)(function*(){e.qr_code=yield(0,c.J5)(e.id)})()}constructor(e,n){this._manager=e,this._settings=n,this.features=this._manager.filtered_urls,this.edit=a=>this._manager.editURL(a),this.remove=a=>this._manager.removeURL(a)}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(A),t.Y36(c.gb))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["short-url-list"]],decls:6,vars:11,consts:[[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No Points of Interest found.",1,"block","min-w-[32rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["url_template",""],["action_template",""],["link","",3,"href"],[1,"w-full","flex","justify-end","space-x-2"],["icon","","matRipple","","customTooltip","",3,"content","click"],["qr_menu",""],["btn","","icon","","matRipple","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","space-x-2","text-red-500"],[1,"text-error"],[1,"bg-base-100","py-2","shadow","rounded"],["printable","",1,""],["target","_blank","ref","noopener noreferrer",1,"block","p-2","mx-4","my-2","rounded-lg","border","border-base-200","bg-base-100",3,"href"],[1,"w-48","mx-auto",3,"src"],[1,"w-[calc(100%-2rem)]","text-center","mt-2","font-mono","text-sm","bg-base-200","rounded","p-2","mx-4"],["btn","","matRipple","",1,"w-[calc(100%-2rem)]","mx-4","my-2",3,"click"]],template:function(n,a){if(1&n&&(t.TgZ(0,"div",0),t._UZ(1,"custom-table",1),t.qZA(),t.YNc(2,q,2,2,"ng-template",null,2,t.W1O)(4,tt,23,2,"ng-template",null,3,t.W1O)),2&n){const l=t.MAs(3),_=t.MAs(5);t.xp6(),t.Q6J("dataSource",a.features)("columns",t.DdM(5,et))("display_column",t.DdM(6,ot))("column_size",t.DdM(7,nt))("template",t.WLB(8,at,l,_))}},dependencies:[f.VK,f.OP,f.p6,C.wG,x.o,W.C,B.X,K.o,k.y]})}return o})();const lt=["app-short-url-manager",""];let M=(()=>{class o{constructor(e){this._state=e,this.new=()=>this._state.editURL()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(A))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","app-short-url-manager",""]],attrs:lt,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","px-4","py-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(n,a){1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1)(4,"header",2)(5,"h2",3),t._uU(6,"Short URL Management"),t.qZA(),t.TgZ(7,"button",4),t.NdJ("click",function(){return a.new()}),t._uU(8,"Add Short URL"),t.qZA()(),t._UZ(9,"short-url-list",5),t.qZA()())},dependencies:[H.O,z.u,C.wG,rt],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}"]})}return o})();var it=r(2557);const st=[{path:"",component:M},{path:"new",component:M}];let ct=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#o=this.\u0275inj=t.cJS({imports:[g.ez,i.u5,U.v,v.YR,N.PP,it.Hi,S.Bz.forChild(st)]})}return o})()}}]);