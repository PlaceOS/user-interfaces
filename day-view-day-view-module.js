(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{Y9LB:function(n,e,t){"use strict";t.r(e),t.d(e,"DayViewModule",function(){return sn});var i=t("SVse"),o=t("s7LF"),c=t("iInd"),s=t("URK9"),a=t("8Y7J"),l=t("ORrl"),r=t("mrSG"),d=t("SxV6"),h=t("grfs"),b=t("lRLz"),g=t("InVF"),f=t("Dxy4"),u=t("z03u"),p=t("Q2Ze"),m=t("ZTz/"),v=t("jMqV"),_=t("jfXU"),w=t("UhP/");function x(n,e){if(1&n&&(a.Xb(0,"mat-option",12),a.Nc(1),a.Wb()),2&n){const n=e.$implicit;a.tc("value",n.id),a.Fb(1),a.Pc(" ",n.display_name||n.name," ")}}function O(n,e){if(1&n&&(a.Xb(0,"mat-option",12),a.Nc(1),a.Wb()),2&n){const n=e.$implicit;a.tc("value",n.id),a.Fb(1),a.Pc(" ",n.name," ")}}const y=function(){return{class:"material-icons",content:"add"}};let M=(()=>{class n extends h.b{constructor(n,e,t,i){super(),this._state=n,this._org=e,this._route=t,this._router=i,this.zones=[],this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(n=>`${n.id}`),this.setDate=n=>this._state.setDate(n),this.newBooking=n=>this._state.newBooking(n),this.levels=this._org.active_levels,this.ui_options=this._state.options,this.updateZones=n=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:n.join(",")}}),this._state.setZones(n)},this.updateTypes=n=>this._state.setFilters({hide_type:this.types.reduce((e,t)=>(!n.includes(t.id)&&e.push(t),e),[])})}updateUIOptions(n){this._state.setUIOptions(n)}ngOnInit(){return Object(r.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(d.a)(n=>n)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const e=n.get("zone_ids").split(",");if(e.length){const n=this._org.levelWithID(e);if(!n)return;this._org.building=this._org.buildings.find(e=>e.id===n.parent_id),this.zones=e}}})),this.subscription("levels",this._org.active_levels.subscribe(n=>{this.zones=this.zones.filter(e=>n.find(n=>n.id===e)),!this.zones.length&&n.length&&this.zones.push(n[0].id),this.updateZones(this.zones)})),this.updateTypes(this.type_list)})}}return n.\u0275fac=function(e){return new(e||n)(a.Rb(b.a),a.Rb(g.c),a.Rb(c.a),a.Rb(c.d))},n.\u0275cmp=a.Lb({type:n,selectors:[["dayview-topbar"]],features:[a.Cb],decls:24,vars:14,consts:[["mat-button","",1,"w-12","xl:w-auto",3,"click"],[1,"flex","items-center"],[1,"mr-2",3,"icon"],[1,"hidden","xl:block"],["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["multiple","","placeholder","No Events",3,"ngModel","ngModelChange"],[1,"m-2",3,"ngModel","ngModelChange"],[1,"text-xs"],[1,"flex-1","w-0"],[3,"dateChange"],[3,"value"]],template:function(n,e){if(1&n&&(a.Xb(0,"button",0),a.ic("click",function(){return e.newBooking()}),a.Xb(1,"div",1),a.Sb(2,"app-icon",2),a.Xb(3,"div",3),a.Nc(4,"New Booking"),a.Wb(),a.Wb(),a.Wb(),a.Xb(5,"mat-form-field",4),a.Xb(6,"mat-select",5),a.ic("ngModelChange",function(n){return e.zones=n})("ngModelChange",function(n){return e.updateZones(n)}),a.Lc(7,x,2,2,"mat-option",6),a.nc(8,"async"),a.Wb(),a.Wb(),a.Xb(9,"mat-form-field",4),a.Xb(10,"mat-select",7),a.ic("ngModelChange",function(n){return e.type_list=n})("ngModelChange",function(n){return e.updateTypes(n)}),a.Xb(11,"mat-select-trigger"),a.Nc(12,"Legend"),a.Wb(),a.Lc(13,O,2,2,"mat-option",6),a.Wb(),a.Wb(),a.Xb(14,"mat-slide-toggle",8),a.ic("ngModelChange",function(n){return e.updateUIOptions({show_overflow:n})}),a.nc(15,"async"),a.Xb(16,"div",9),a.Nc(17,"Setup / Breakdown"),a.Wb(),a.Wb(),a.Xb(18,"mat-slide-toggle",8),a.ic("ngModelChange",function(n){return e.updateUIOptions({show_cleaning:n})}),a.nc(19,"async"),a.Xb(20,"div",9),a.Nc(21,"Cleaners View"),a.Wb(),a.Wb(),a.Sb(22,"div",10),a.Xb(23,"date-options",11),a.ic("dateChange",function(n){return e.setDate(n)}),a.Wb()),2&n){let n=null,t=null;a.Fb(2),a.tc("icon",a.uc(13,y)),a.Fb(4),a.tc("ngModel",e.zones),a.Fb(1),a.tc("ngForOf",a.oc(8,7,e.levels)),a.Fb(3),a.tc("ngModel",e.type_list),a.Fb(3),a.tc("ngForOf",e.types),a.Fb(1),a.tc("ngModel",null==(n=a.oc(15,9,e.ui_options))?null:n.show_overflow),a.Fb(4),a.tc("ngModel",null==(t=a.oc(19,11,e.ui_options))?null:t.show_cleaning)}},directives:[f.b,u.a,p.c,m.a,o.l,o.o,i.m,m.c,v.a,_.a,w.l],pipes:[i.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                background-color: #fff;\n                height: 5em;\n                padding: 0 1em;\n            }\n\n            button[_ngcontent-%COMP%] {\n                min-width: 0;\n                padding: 0 .85rem;\n            }\n\n            mat-form-field[_ngcontent-%COMP%] {\n                height: 3.25em;\n                width: 8em;\n                margin-left: 1em;\n            }\n\n            mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] {\n                width: 5.5em;\n                white-space: initial;\n                line-height: 1.2em\n            }"]}),n})();var C=t("itXk"),F=t("lJxs"),P=t("EE6m"),k=t("sWYD"),X=t("IYaI"),W=t("M34a"),I=t("jG/O");function S(n,e){if(1&n&&a.Sb(0,"div"),2&n){const n=a.mc();a.Hb("overflow-block absolute rounded overflow-hidden w-full "+n.type),a.Ic("top",100*n.overflow_top+"%")("height",100*n.overflow_height+"%")}}const L=function(){return{class:"material-icons",content:"title"}};function z(n,e){if(1&n&&(a.Xb(0,"div",6),a.Sb(1,"app-icon",7),a.Nc(2),a.Wb()),2&n){const n=a.mc(2);a.Fb(1),a.tc("icon",a.uc(2,L)),a.Fb(1),a.Pc(" ",n.event.title," ")}}const j=function(){return{class:"material-icons",content:"schedule"}};function N(n,e){if(1&n&&(a.Xb(0,"div",6),a.Sb(1,"app-icon",7),a.Nc(2),a.Wb()),2&n){const n=a.mc(2);a.Fb(1),a.tc("icon",a.uc(2,j)),a.Fb(1),a.Pc(" ",n.time," ")}}const R=function(){return{class:"material-icons",content:"user"}};function D(n,e){if(1&n&&(a.Xb(0,"div",6),a.Sb(1,"app-icon",7),a.Nc(2),a.Wb()),2&n){const n=a.mc(2);a.Fb(1),a.tc("icon",a.uc(3,R)),a.Fb(1),a.Qc(" ",n.event.attendees.length," Attendee",1===n.event.attendees.length?"":"s"," ")}}function B(n,e){if(1&n){const n=a.Yb();a.Xb(0,"div",3),a.ic("click",function(){a.Cc(n);const e=a.mc();return e.view(e.event)}),a.Xb(1,"div",4),a.Nc(2),a.Wb(),a.Lc(3,z,3,3,"div",5),a.Lc(4,N,3,3,"div",5),a.Lc(5,D,3,4,"div",5),a.Wb()}if(2&n){const n=a.mc();a.Hb("absolute rounded overflow-hidden text-sm "+n.type),a.Ic("top",100*n.top+"%")("height",100*n.height+"%"),a.Fb(2),a.Oc(null==n.event.organiser?null:n.event.organiser.name),a.Fb(1),a.tc("ngIf",n.event.duration>30),a.Fb(1),a.tc("ngIf",n.event.duration>60),a.Fb(1),a.tc("ngIf",n.event.duration>90)}}const E=function(n){return{class:"material-icons",content:n}};function T(n,e){if(1&n&&(a.Xb(0,"div",8),a.Xb(1,"div"),a.Sb(2,"app-icon",9),a.Wb(),a.Xb(3,"div",10),a.Nc(4),a.Wb(),a.Wb()),2&n){const n=a.mc();a.Ic("top",100*n.overflow_top+"%")("height",100*n.overflow_height+"%"),a.Fb(1),a.Hb("icon flex mr-2 text-3xl rounded "+n.event.cleaning_status),a.Fb(1),a.tc("icon",a.vc(9,E,"done"===n.event.cleaning_status?"done":"warning")),a.Fb(2),a.Qc(" ","done"===n.event.cleaning_status?"Finished":"Scheduled to"," clean at ",n.event.cleaning_time," ")}}let U=(()=>{class n{constructor(n){this._state=n,this.top=-999,this.height=0,this.overflow_top=-999,this.overflow_height=0,this.view=n=>this._state.setEvent(n),this.ui_options=this._state.options}get time(){const n=new Date(this.event.date);return Object(k.a)(n,"h:mm a")+" - "+Object(k.a)(Object(X.a)(n,this.event.duration),"h:mm a")}get type(){return this.event.guests.length?"external":"cancelled"===this.event.status?"cancelled":"internal"}ngOnChanges(n){if(n.event&&this.event){const n=Object(W.a)(new Date(this.event.date)),e=Object(I.a)(new Date(this.event.date),n);this.top=e/1440,this.height=this.event.duration/1440,this.overflow_top=(e-this.event.ext("setup"))/1440,this.overflow_height=(this.event.duration+this.event.ext("setup")+this.event.ext("breakdown"))/1440}}}return n.\u0275fac=function(e){return new(e||n)(a.Rb(b.a))},n.\u0275cmp=a.Lb({type:n,selectors:[["dayview-event"]],inputs:{event:"event"},features:[a.Db],decls:5,vars:7,consts:[[3,"class","top","height",4,"ngIf"],["name","event","matRipple","",3,"class","top","height","click",4,"ngIf"],["class","catering-block absolute rounded overflow-hidden flex w-full shadow p-2",3,"top","height",4,"ngIf"],["name","event","matRipple","",3,"click"],[1,"info"],["class","info flex items-center",4,"ngIf"],[1,"info","flex","items-center"],[1,"mx-2",3,"icon"],[1,"catering-block","absolute","rounded","overflow-hidden","flex","w-full","shadow","p-2"],[3,"icon"],[1,"text"]],template:function(n,e){if(1&n&&(a.Lc(0,S,1,6,"div",0),a.nc(1,"async"),a.Lc(2,B,6,10,"div",1),a.Lc(3,T,5,11,"div",2),a.nc(4,"async")),2&n){let n=null,t=null;a.tc("ngIf",null==(n=a.oc(1,3,e.ui_options))?null:n.show_overflow),a.Fb(2),a.tc("ngIf",e.event),a.Fb(1),a.tc("ngIf",null==(t=a.oc(4,5,e.ui_options))?null:t.show_cleaning)}},directives:[i.n,w.o,u.a],pipes:[i.b],styles:["[_nghost-%COMP%] {\n                border-right: 1px solid rgba(0, 0, 0, 0.1);\n            }\n\n            [name='event'][_ngcontent-%COMP%] {\n                background-color: #ccc;\n                width: 12rem;\n                z-index: 100;\n                transition: box-shadow 200ms;\n            }\n\n            [name='event'][_ngcontent-%COMP%]:hover {\n                box-shadow: 0 1px 3px 1px rgba(0, 0, 0, 0.2),\n                    0 1px 1px 0 rgba(0, 0, 0, 0.14),\n                    0 2px 1px -1px rgba(0, 0, 0, 0.12);\n                cursor: pointer;\n                z-index: 999;\n            }\n\n            .overflow-block[_ngcontent-%COMP%] {\n                opacity: 0.3;\n                width: 12rem;\n            }\n\n            .catering-block[_ngcontent-%COMP%] {\n                background-color: #fff;\n                width: 12rem;\n                z-index: 999;\n            }\n\n            .internal[_ngcontent-%COMP%] {\n                background-color: #00a4c7;\n                color: #fff;\n            }\n\n            .icon[_ngcontent-%COMP%] {\n                height: 1.5em;\n                width: 1.5em;\n                color: #ffbf1f;\n                background-color: #f0f0f0;\n            }\n\n            .icon.done[_ngcontent-%COMP%] {\n                color: #21a453;\n            }\n\n            .external[_ngcontent-%COMP%] {\n                background-color: #d85be0;\n                color: #fff;\n            }\n\n            .cancelled[_ngcontent-%COMP%] {\n                background-color: #eee;\n            }\n\n            .info[_ngcontent-%COMP%]:first-child {\n                padding: 0.75em 0.5em;\n            }\n\n            .info[_ngcontent-%COMP%] {\n                padding: 0.25em 0.5em;\n            }"]}),n})();function V(n,e){1&n&&a.Sb(0,"dayview-event",1),2&n&&a.tc("event",e.$implicit)}let Y=(()=>{class n{constructor(n){this._state=n,this.events=this._state.filtered.pipe(Object(F.a)(n=>n.filter(n=>n.resources.find(n=>this.space.email===n.email))))}ngOnInit(){this._state.filtered.subscribe(n=>{})}}return n.\u0275fac=function(e){return new(e||n)(a.Rb(b.a))},n.\u0275cmp=a.Lb({type:n,selectors:[["dayview-space"]],inputs:{space:"space"},decls:2,vars:3,consts:[[3,"event",4,"ngFor","ngForOf"],[3,"event"]],template:function(n,e){1&n&&(a.Lc(0,V,1,1,"dayview-event",0),a.nc(1,"async")),2&n&&a.tc("ngForOf",a.oc(1,1,e.events))},directives:[i.m,U],pipes:[i.b],styles:["[_nghost-%COMP%] {\n                position: relative;\n                border-right: 1px solid rgba(0, 0, 0, 0.1);\n            }"]}),n})();var $=t("BTe0");const q=["ref"];function A(n,e){if(1&n&&(a.Xb(0,"div",16),a.Xb(1,"div",17),a.Nc(2),a.Wb(),a.Sb(3,"div",6),a.Wb()),2&n){const n=e.$implicit,t=a.mc();a.Ic("transform","translateY(-"+t.scroll.y+"px)"),a.Fb(2),a.Oc(n)}}function Z(n,e){if(1&n&&(a.Xb(0,"div",18),a.Sb(1,"div",6),a.Xb(2,"div",19),a.Nc(3),a.Wb(),a.Wb()),2&n){const n=e.$implicit,t=a.mc();a.Ic("transform","translateX(-"+t.scroll.x+"px)"),a.Fb(3),a.Oc(n.display_name||n.name)}}function H(n,e){1&n&&a.Sb(0,"dayview-space",20),2&n&&a.tc("space",e.$implicit)}function J(n,e){if(1&n&&(a.Sb(0,"div",21),a.nc(1,"async")),2&n){const n=e.index,t=a.mc();a.Ic("width",12*a.oc(1,4,t.space_list).length+"em")("top",4*n+"em")}}function Q(n,e){1&n&&a.Sb(0,"mat-progress-bar",22)}function G(n,e){if(1&n&&(a.Sb(0,"dayview-event-details",23),a.nc(1,"async")),2&n){const n=a.mc();a.tc("event",a.oc(1,1,n.event))}}const K=new Array(24).fill(0).map((n,e)=>(e%12==0?12:e%12)+(e>=12?" PM":" AM"));let nn=(()=>{class n extends h.b{constructor(n,e,t){super(),this._org=n,this._spaces=e,this._state=t,this.blocks=K,this.scroll={x:0,y:0},this.loading=this._state.loading,this.event=this._state.event,this.space_list=Object(C.a)([this._org.active_building,this._spaces.list,this._state.zones]).pipe(Object(F.a)(n=>{const[e,t,i]=n;return t.filter(n=>n.zones.includes(e.id)&&(!(null==i?void 0:i.length)||n.zones.find(n=>i.includes(n))))||[]}))}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}ngAfterViewInit(){this.box=this._ref_el.nativeElement.getBoundingClientRect()}onScroll(n){this._ref_el&&requestAnimationFrame(()=>this.scroll={x:n.srcElement.scrollLeft,y:n.srcElement.scrollTop})}}return n.\u0275fac=function(e){return new(e||n)(a.Rb(g.c),a.Rb(P.c),a.Rb(b.a))},n.\u0275cmp=a.Lb({type:n,selectors:[["dayview-timeline"]],viewQuery:function(n,e){if(1&n&&a.Sc(q,1),2&n){let n;a.xc(n=a.jc())&&(e._ref_el=n.first)}},features:[a.Cb],decls:20,vars:14,consts:[[1,"time","h-full","overflow-hidden"],[1,"headers","relative"],[1,"white-space","absolute","inset-0",2,"bottom","1em"],["name","change-transform","class","relative",3,"transform",4,"ngFor","ngForOf"],[1,"h-full","flex-1","flex","flex-col"],[1,"headers","flex","relative","overflow-hidden"],[1,"bar","absolute"],["name","change-transform","class","relative w",3,"transform",4,"ngFor","ngForOf"],[1,"content","relative","flex","flex-1","overflow-auto",3,"scroll"],["scroll_el",""],[1,"ref","absolute"],["ref",""],[3,"space",4,"ngFor","ngForOf"],["class","block absolute w-full",3,"width","top",4,"ngFor","ngForOf"],["mode","indeterminate",4,"ngIf"],[3,"event",4,"ngIf"],["name","change-transform",1,"relative"],[1,"text","absolute","w-full","text-xs"],["name","change-transform",1,"relative","w"],[1,"name","m-2","text-center"],[3,"space"],[1,"block","absolute","w-full"],["mode","indeterminate"],[3,"event"]],template:function(n,e){1&n&&(a.Xb(0,"div",0),a.Xb(1,"div",1),a.Sb(2,"div",2),a.Wb(),a.Lc(3,A,4,3,"div",3),a.Wb(),a.Xb(4,"div",4),a.Xb(5,"div",5),a.Sb(6,"div",6),a.Lc(7,Z,4,3,"div",7),a.nc(8,"async"),a.Wb(),a.Xb(9,"div",8,9),a.ic("scroll",function(n){return e.onScroll(n)}),a.Sb(11,"div",10,11),a.Lc(13,H,1,1,"dayview-space",12),a.nc(14,"async"),a.Lc(15,J,2,6,"div",13),a.Wb(),a.Wb(),a.Lc(16,Q,1,0,"mat-progress-bar",14),a.nc(17,"async"),a.Lc(18,G,2,3,"dayview-event-details",15),a.nc(19,"async")),2&n&&(a.Fb(3),a.tc("ngForOf",e.blocks),a.Fb(4),a.tc("ngForOf",a.oc(8,6,e.space_list)),a.Fb(6),a.tc("ngForOf",a.oc(14,8,e.space_list)),a.Fb(2),a.tc("ngForOf",e.blocks),a.Fb(1),a.tc("ngIf",a.oc(17,10,e.loading)),a.Fb(2),a.tc("ngIf",a.oc(19,12,e.event)))},directives:[i.m,i.n,Y,$.a],pipes:[i.b],styles:['[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                flex: 1;\n                min-height: 50%;\n            }\n\n            .time[_ngcontent-%COMP%] {\n                width: 6em;\n            }\n\n            .time[_ngcontent-%COMP%]    > div[_ngcontent-%COMP%]:not(.headers) {\n                height: 4em;\n            }\n\n            .bar[_ngcontent-%COMP%] {\n                width: 1em;\n                top: 0;\n                right: 0;\n                height: 1px;\n                background-color: rgba(0, 0, 0, 0.1);\n                z-index: 0;\n            }\n\n            .headers[_ngcontent-%COMP%] {\n                height: 4em;\n                max-width: calc(100vw - 12em);\n            }\n\n            .white-space[_ngcontent-%COMP%] {\n                background-color: #f0f0f0;\n                z-index: 999;\n            }\n\n            .headers[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%] {\n                width: 1px;\n                bottom: 0;\n                right: -1px;\n                height: 2em;\n                background-color: rgba(0, 0, 0, 0.1);\n                top: auto;\n            }\n\n            .headers[_ngcontent-%COMP%]    > .bar[_ngcontent-%COMP%]:first-child {\n                width: 1px;\n                bottom: 0;\n                right: auto;\n                left: 0;\n                height: 2em;\n                background-color: rgba(0, 0, 0, 0.1);\n                top: auto;\n            }\n\n            .w[_ngcontent-%COMP%], dayview-space[_ngcontent-%COMP%] {\n                width: 12em;\n                min-width: 12em;\n            }\n\n            dayview-space[_ngcontent-%COMP%] {\n                height: 96em;\n            }\n\n            .block[_ngcontent-%COMP%] {\n                height: 4em;\n                border-bottom: 1px solid rgba(0, 0, 0, 0.1);\n                pointer-events: none;\n                min-width: 100%;\n                z-index: 0;\n            }\n\n            .text[_ngcontent-%COMP%] {\n                text-align: center;\n                transform: translateY(-50%);\n                padding: 0 2.5em;\n                opacity: 0.65;\n            }\n\n            .ref[_ngcontent-%COMP%] {\n                top: 0;\n                left: 0;\n                height: 1px;\n                width: 1px;\n                height: 96em;\n            }\n\n            .content[_ngcontent-%COMP%] {\n                max-width: calc(100vw - 12em);\n                border-top: 1px solid rgba(0, 0, 0, 0.1);\n                border-left: 1px solid rgba(0, 0, 0, 0.1);\n            }\n\n            mat-progress-bar[_ngcontent-%COMP%] {\n                position: absolute;\n                left: 0;\n                right: 0;\n                bottom: 0;\n            }\n\n            [name="change-transform"][_ngcontent-%COMP%] {\n                will-change: transform;\n            }']}),n})();const en=["app-dayview",""];let tn=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=a.Lb({type:n,selectors:[["","app-dayview",""]],attrs:en,decls:4,vars:0,consts:[[1,"relative","overflow-hidden"]],template:function(n,e){1&n&&(a.Sb(0,"sidebar"),a.Xb(1,"main",0),a.Sb(2,"dayview-topbar"),a.Sb(3,"dayview-timeline"),a.Wb())},directives:[l.a,M,nn],styles:["[_nghost-%COMP%] {\n                display: flex;\n                height: 100%;\n                width: 100%;\n                background: var(--bg);\n            }\n\n            sidebar[_ngcontent-%COMP%] {\n                height: 100%;\n            }\n\n            main[_ngcontent-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                flex: 1;\n                min-width: 50%;\n                height: 100%;\n            }"]}),n})();var on=t("qdGH");const cn=[{path:"",component:tn}];let sn=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=a.Pb({type:n}),n.\u0275inj=a.Ob({imports:[[i.c,o.h,s.a,P.a,on.c,c.g.forChild(cn)]]}),n})()}}]);
//# sourceMappingURL=day-view-day-view-module.js.map