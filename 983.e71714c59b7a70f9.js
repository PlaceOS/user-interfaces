"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[983],{1983:(Te,le,l)=>{l.d(le,{Xp:()=>N,ck:()=>L.c,P2:()=>G});var g=l(6895),p=l(4006),te=l(6725),se=l(455),M=l(8184),y=l(4080),C=l(8070),b=l(577),h=l(5861),m=l(1426),K=l(7224),$=l(565),L=l(6667),e=l(4650),D=l(3007),oe=l(3238),be=l(9549),Ie=l(4385);function Ne(a,s){if(1&a&&(e.TgZ(0,"mat-option",6),e._uU(1),e.qZA()),2&a){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function Me(a,s){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field",3)(1,"mat-select",4),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.setBuilding(n))}),e.ALo(2,"async"),e.YNc(3,Ne,2,2,"mat-option",5),e.ALo(4,"async"),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",e.lcZ(2,2,t.building)),e.xp6(2),e.Q6J("ngForOf",e.lcZ(4,4,t.buildings))}}function ye(a,s){if(1&a&&(e.TgZ(0,"mat-option",6),e._uU(1),e.qZA()),2&a){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function Le(a,s){if(1&a){const t=e.EpF();e.TgZ(0,"mat-form-field",7),e.ALo(1,"async"),e.TgZ(2,"mat-select",8),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.setLevel(n))}),e.ALo(3,"async"),e.YNc(4,ye,2,2,"mat-option",5),e.ALo(5,"async"),e.qZA()()}if(2&a){const t=e.oxw();let o;e.uIk("has-bld",(null==(o=e.lcZ(1,3,t.buildings))?null:o.length)>1),e.xp6(2),e.Q6J("ngModel",e.lcZ(3,5,t.level)),e.xp6(2),e.Q6J("ngForOf",e.lcZ(5,7,t.levels))}}class X extends m.cx{constructor(s,t,o,n){super(),this._org=s,this._state=t,this._router=o,this._route=n,this.buildings=this._org.active_buildings,this.building=this._org.active_building,this.levels=this._org.active_levels,this.level=this._state.level,this.setLevel=i=>{this._state.setFeatures("_located",[]),this.timeout("set_level",()=>this._router.navigate([],{relativeTo:this._route,queryParams:{zone:i.id}}),201)},this.setBuilding=i=>this._org.building=i}ngOnInit(){var s=this;return(0,h.Z)(function*(){yield s._org.initialised.pipe((0,K.P)(t=>t)).toPromise(),s.subscription("route.query",s._route.queryParamMap.subscribe(t=>t.has("zone")?s._state.setLevel(t.get("zone")):""))})()}}X.\u0275fac=function(s){return new(s||X)(e.Y36($.w),e.Y36(L.c),e.Y36(D.F0),e.Y36(D.gz))},X.\u0275cmp=e.Xpm({type:X,selectors:[["explore-map-controls"]],features:[e.qOj],decls:5,vars:6,consts:function(){let a,s;return a=$localize`:␟dea1f8bc2b32584fadf07ef815709b946d3726ff␟1533056789917995243:Select Building...`,s=$localize`:␟025373b97845a8c2b54d2eb17d9c479f64207b11␟7854898325453225869:Select Level...`,[[1,"flex","space-x-2","w-full"],["overlay","","buildings","","class","flex-1 min-w-[10.5rem]","has-bld","true","appearance","outline",4,"ngIf"],["overlay","","levels","","class","flex-1 min-w-[10.25rem]","appearance","outline",4,"ngIf"],["overlay","","buildings","","has-bld","true","appearance","outline",1,"flex-1","min-w-[10.5rem]"],["placeholder",a,3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["overlay","","levels","","appearance","outline",1,"flex-1","min-w-[10.25rem]"],["placeholder",s,3,"ngModel","ngModelChange"]]},template:function(s,t){if(1&s&&(e.TgZ(0,"div",0),e.YNc(1,Me,5,6,"mat-form-field",1),e.ALo(2,"async"),e.YNc(3,Le,6,9,"mat-form-field",2),e.ALo(4,"async"),e.qZA()),2&s){let o,n;e.xp6(1),e.Q6J("ngIf",(null==(o=e.lcZ(2,2,t.buildings))?null:o.length)>1),e.xp6(2),e.Q6J("ngIf",null==(n=e.lcZ(4,4,t.levels))?null:n.length)}},dependencies:[g.sg,g.O5,oe.ey,be.KE,Ie.gD,p.JJ,p.On,g.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.5rem}mat-form-field[has-bld=true][_ngcontent-%COMP%]{max-width:calc(50vw - 2.5rem)}[full][_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{max-width:calc(50% - 2.5rem)}"]});var S=l(8186),Pe=l(2986),ge=l(1529),Ue=l(73),re=l(4702),Ze=l(3159),Ee=l(6198),F=l(6888),E=(l(1228),l(4850)),Ae=l(9627),ce=l(5306);function we(a,s){if(1&a&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"thermostat"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&a){const t=e.oxw();e.xp6(4),e.hij("",t.temp,"\u02daF")}}function $e(a,s){if(1&a&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"opacity"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&a){const t=e.oxw();e.xp6(4),e.hij("",t.humidity,"%")}}function De(a,s){1&a&&(e.TgZ(0,"div",5)(1,"app-icon",6),e._uU(2,"error"),e.qZA()())}class k{constructor(s){this._details=s,this.temp=this._details.temp||0,this.humidity=this._details.humidity||0}}k.\u0275fac=function(s){return new(s||k)(e.Y36(te.ui))},k.\u0275cmp=e.Xpm({type:k,selectors:[["explore-sensor-info"]],decls:4,vars:3,consts:[[1,"absolute","center","bg-white","rounded-lg","border","border-gray-300","p-2","text-xl"],["class","flex items-center space-x-2 whitespace-nowrap pr-2",4,"ngIf"],["class","absolute top-0 right-0 rounded-full translate-x-1/2 -translate-y-1/2 bg-white border border-gray-300",4,"ngIf"],[1,"flex","items-center","space-x-2","whitespace-nowrap","pr-2"],[1,""],[1,"absolute","top-0","right-0","rounded-full","translate-x-1/2","-translate-y-1/2","bg-white","border","border-gray-300"],[1,"text-error","text-xl"]],template:function(s,t){1&s&&(e.TgZ(0,"div",0),e.YNc(1,we,5,1,"div",1),e.YNc(2,$e,5,1,"div",1),e.YNc(3,De,3,0,"div",2),e.qZA()),2&s&&(e.xp6(1),e.Q6J("ngIf",t.temp),e.xp6(1),e.Q6J("ngIf",t.humidity),e.xp6(1),e.Q6J("ngIf",t.temp>82))},dependencies:[g.O5,ce.o]});class P extends m.cx{constructor(s,t,o){super(),this._state=s,this._org=t,this._settings=o,this._statuses={},this._location={},this._capacity={},this._draw={},this._points={},this._features=[],this._bind=this._state.level.pipe((0,E.U)(n=>{if(!n)return;this._statuses={};let i=this._org.binding("area_management");if(!i)return;const _=(0,S.rTZ)(i,"AreaManagement").binding(`${n.id}:areas`);this.subscription("zones",_.listen().subscribe(r=>this.parseData(r))),this.subscription("binding",_.bind())})),this.init()}init(){var s=this;return(0,h.Z)(function*(){yield s._org.initialised.pipe((0,K.P)(o=>o)).toPromise();const t=yield Promise.all(s._org.levels.map(o=>(0,S.rlq)(o.id,"map_regions").toPromise()));for(const o of t){const n=o?.details?.areas;if(n)for(const i of n){const{capacity:_,hide_label:r,label_location:c,draw_polygon:u}=i.properties||{},{coordinates:d}=i.geometry||{};s._capacity[i.id]=_||100,s._location[i.id]=!1===r?c||(d?.length?Se(d):null):null,s._draw[i.id]=!!u||s._settings.get("app.explore.use_zone_polygons"),s._points[i.id]=d||[]}}s.updateStatus(),s.subscription("bind",s._bind.subscribe())})()}parseData(s){const t=s?.value||[],o=[],n=[];for(const i of t){const _=i.count/(this._capacity[i.area_id]||100);if(this._statuses[i.area_id]=_<.4?"free":_<.75?"pending":"busy",!this._location[i.area_id])continue;let r="";i.count&&(r+=`${i.count||0} User Device${1===i.count?"":"s"}\n`),i.temperature&&(r+=`Temperature: ${i.temperature} \u02daC\n`),i.people_count>0&&(r+=`${i.people_count_sum} ${1===i.people_count_sum?"Person":"People"}\n`),i.humidity&&(r+=`Humidity: ${i.humidity}%\n`),i.queue_size&&(r+=`Queue Size: ${i.queue_size}%\n`),i.counter&&(r+=`Count: ${i.counter}\n`),o.push({location:this._location[i.area_id],content:r,z_index:100}),this._settings.get("app.explore.show_simple_sensor_info")&&(i.temperature||i.humidity)&&n.push({location:this._location[i.area_id],content:k,data:{temp:i.temperature,humidity:i.humidity},z_index:98})}this._features=n,this._settings.get("app.explore.show_simple_sensor_info")||this._state.setLabels("zones",o),this.updateStatus()}updateStatus(){const s={},t=[],o=this._settings.get("app.explore.colors")||{};for(const n in this._statuses){const i=o[`zone-${this._statuses[n]}`]||o[`${this._statuses[n]}`]||F.y[`${this._statuses[n]}`];this._draw[n]?t.push({track_id:`zone:${n}`,location:Se(this._points[n]),content:Ae.i,data:{color:i,points:this._points[n]},z_index:10}):s[`#${n}`]={fill:i,opacity:.6}}this._state.setFeatures("zones",[...t,this._features]),this._state.setStyles("zones",s)}}function Se(a){const s=(a||[]).reduce((t,[o,n])=>({x_min:o<t.x_min?o:t.x_min,x_max:o>t.x_max?o:t.x_max,y_min:n<t.y_min?n:t.y_min,y_max:n>t.y_max?n:t.y_max}),{x_min:100,x_max:-100,y_min:100,y_max:-100});return{x:s.x_min+(s.x_max-s.x_min)/2,y:s.y_min+(s.y_max-s.y_min)/2}}P.\u0275fac=function(s){return new(s||P)(e.LFG(L.c),e.LFG($.w),e.LFG(m.gb))},P.\u0275prov=e.Yz7({token:P,factory:P.\u0275fac});var I=l(9972),Xe=l(7552),Fe=l(9756),ne=l(2722),de=l(5650),O=l(591),v=l(3426),Q=l(1086),pe=l(2198),ue=l(13),T=l(7545),j=l(7221),ie=l(2994),U=l(5154),ke=l(2084),_e=l(354),ze=l(9502),me=l(5938),Be=l(2329),Ye=l(1022),Ge=l(7303),Je=l(9697);function We(a,s){if(1&a&&(e.TgZ(0,"div",7)(1,"div",13)(2,"label"),e._uU(3,"Resource:"),e.qZA(),e.TgZ(4,"p",14),e._uU(5),e.qZA()()()),2&a){const t=e.oxw(2);e.xp6(5),e.hij(" ",t.resource.name||t.resource.map_id||"Unknown Resource"," ")}}function Ke(a,s){1&a&&(e.TgZ(0,"div",7)(1,"div",8)(2,"label"),e._uU(3,"Host"),e.qZA(),e._UZ(4,"a-user-search-field",15),e.qZA()())}const Qe=function(){return{standalone:!0}};function je(a,s){if(1&a){const t=e.EpF();e.TgZ(0,"main",5),e.YNc(1,We,6,1,"div",6),e.YNc(2,Ke,5,0,"div",6),e.TgZ(3,"div",7)(4,"div",8)(5,"label"),e._uU(6,"Date"),e.qZA(),e.TgZ(7,"a-date-field",9),e._uU(8," Date and time must be in the future "),e.qZA()()(),e.TgZ(9,"div",7)(10,"div",10)(11,"label"),e._uU(12,"Start Time"),e.qZA(),e.TgZ(13,"a-time-field",11),e.NdJ("ngModelChange",function(n){e.CHM(t);const i=e.oxw();return e.KtG(i.form.patchValue({date:n}))}),e.qZA()(),e.TgZ(14,"div",10)(15,"label"),e._uU(16,"End Time"),e.qZA(),e._UZ(17,"a-duration-field",12),e.qZA()()()}if(2&a){const t=e.oxw();let o;e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",t.resource),e.xp6(1),e.Q6J("ngIf",t.host),e.xp6(5),e.Q6J("to",t.book_until),e.xp6(6),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(10,Qe)),e.xp6(4),e.Q6J("time",null==(o=t.form.get("date"))?null:o.value)("max",720)("min",60)("step",60)}}class z{constructor(s){this._data=s,this.host=this._data.host,this.form=new p.cw({user:new p.NI(this._data.user),date:new p.NI(this._data.date),duration:new p.NI(this._data.duration)}),this.book_until=this._data.until,this.resource=this._data.resource,console.log("Data:",this._data)}}z.\u0275fac=function(s){return new(s||z)(e.Y36(me.WI))},z.\u0275cmp=e.Xpm({type:z,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-gray-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModel","ngModelOptions","ngModelChange"],["formControlName","duration",3,"time","max","min","step"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4","mb-4"],[1,"p-4"],["formControlName","user"]],template:function(s,t){1&s&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2,"Set date and time"),e.qZA(),e.TgZ(3,"button",1)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.YNc(6,je,18,11,"main",2),e.TgZ(7,"footer",3)(8,"button",4),e._uU(9," Continue "),e.qZA()()),2&s&&(e.xp6(6),e.Q6J("ngIf",t.form),e.xp6(2),e.Q6J("mat-dialog-close",t.form.value))},dependencies:[g.O5,ce.o,oe.wG,me.ZT,p.JJ,p.JL,p.On,p.sg,p.u,Be.Q,Ye.B,Ge.N,Je.d]});var Oe=l(1838),Ve=l(3779),He=l(3494),ve=l(9136),qe=l(3970);function tt(a,s){if(1&a&&(e.TgZ(0,"p",17)(1,"label"),e.SDv(2,18),e.qZA(),e._uU(3),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.mac," ")}}function st(a,s){if(1&a&&(e.TgZ(0,"p",19)(1,"label"),e.SDv(2,20),e.qZA(),e._uU(3),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.manufacturer," ")}}function ot(a,s){if(1&a&&(e.TgZ(0,"p",21)(1,"label"),e.SDv(2,22),e.qZA(),e._uU(3),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.os," ")}}function nt(a,s){if(1&a&&(e.TgZ(0,"p",23)(1,"label"),e.SDv(2,24),e.qZA(),e._uU(3),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.ssid," ")}}function it(a,s){if(1&a&&(e.TgZ(0,"p",25)(1,"label"),e.SDv(2,26),e.qZA(),e._uU(3),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.hij(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function _t(a,s){if(1&a&&(e.TgZ(0,"p",27)(1,"label"),e.SDv(2,28),e.qZA(),e._uU(3),e.qZA()),2&a){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.user.type," ")}}function at(a,s){if(1&a){const t=e.EpF();e.TgZ(0,"div",6),e.NdJ("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.close())}),e._UZ(1,"div",7),e.TgZ(2,"div",8),e.YNc(3,tt,4,1,"p",9),e.TgZ(4,"p")(5,"label"),e.SDv(6,10),e.qZA(),e._uU(7),e.qZA(),e.TgZ(8,"p")(9,"label"),e.SDv(10,11),e.qZA(),e._uU(11),e.qZA(),e.YNc(12,st,4,1,"p",12),e.YNc(13,ot,4,1,"p",13),e.YNc(14,nt,4,1,"p",14),e.YNc(15,it,4,1,"p",15),e.YNc(16,_t,4,1,"p",16),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.xp6(4),e.hij(" ",t.variance,"m"),e.xp6(4),e.hij(" ",t.last_seen,""),e.xp6(1),e.Q6J("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.xp6(1),e.Q6J("ngIf",t.os&&!t.hide_fields.includes("os")),e.xp6(1),e.Q6J("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.xp6(1),e.Q6J("ngIf",t.username&&!t.hide_fields.includes("username")),e.xp6(1),e.Q6J("ngIf",t.user&&!t.hide_fields.includes("user"))}}const lt=[];class B extends m.cx{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||lt}get last_seen(){return(0,Ve.Z)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,He.Z)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(s,t,o){super(),this._details=s,this._settings=t,this._element=o,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(s=0){s>10||setTimeout(()=>{const t=this._element.nativeElement.parentElement?.parentElement;if(!t)return this.ngOnInit(++s);const o_y=parseInt(t.style.top,10)/100,o_x=parseInt(t.style.left,10)/100;this.y_pos=o_y>=.5?"bottom":"top",this.x_pos=o_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(n=>this.zoom=n))},200)}loadUser(){var s=this;return(0,h.Z)(function*(){if(s.username)return;const t=(0,S.rTZ)(s._details.system,"LocationServices");if(!t)return;s.username="Loading...";const o=yield t.execute("check_ownership_of",[s.mac]).catch(n=>null);s.username=o&&o.assigned_to?o.assigned_to:""})()}}B.\u0275fac=function(s){return new(s||B)(e.Y36(ve.u),e.Y36(m.gb),e.Y36(e.SBq))},B.\u0275cmp=e.Xpm({type:B,selectors:[["","explore-device-info",""]],features:[e.qOj],attrs:["explore-device-info",""],decls:7,vars:9,consts:function(){let a,s,t,o,n,i,_,r;return a=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,s=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,t=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,o=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,n=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,i=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,_=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,r=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["name","radius",1,"radius","absolute","center","bg-blue-600","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-black/40","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["dot",""],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"content","backdrop","xPosition","yPosition","hover","mouseenter"],["device_tooltip",""],["name","device-info",1,"w-64","rounded","bg-white","dark:bg-neutral-800","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],a,s,["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],t,["type",""],o,["os",""],n,["ssid",""],i,["username",""],_,["user",""],r]},template:function(s,t){if(1&s&&(e._UZ(0,"div",0)(1,"div",1)(2,"div",2,3),e.TgZ(4,"div",4),e.NdJ("mouseenter",function(){return t.loadUser()}),e.qZA(),e.YNc(5,at,17,8,"ng-template",null,5,e.W1O)),2&s){const o=e.MAs(6);e.Akn("height: "+t.diameter+"%; width: "+t.diameter+"%;"),e.xp6(2),e.Udp("background-color",t.bg_color),e.xp6(2),e.Q6J("content",o)("backdrop",!1)("xPosition",t.x_pos)("yPosition",t.y_pos)("hover",!0)}},dependencies:[g.O5,qe.X],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}"]});class N extends m.cx{constructor(s,t,o,n,i){super(),this._state=s,this._org=t,this._settings=o,this._bookings=n,this._dialog=i,this._in_use=new O.X([]),this._options=new O.X({}),this._presence=new O.X([]),this._signs_of_life=new O.X([]),this._statuses={},this._users={},this._departments={},this._poll=new O.X(0),this._checked_in=new O.X([]),this._desk_bookings=(0,v.aj)([this._state.level,this._options,this._poll]).pipe((0,pe.h)(([_])=>!!_),(0,ue.b)(600),(0,T.w)(([_,{date:r}])=>(0,_e.F2)({period_start:(0,I.Z)((0,Xe.Z)(r||Date.now())),period_end:(0,I.Z)((0,Fe.Z)(r||Date.now(),60)),type:"desk",zones:_.id}).pipe((0,j.K)(()=>(0,Q.of)([])))),(0,ie.b)(_=>{this._users={},this._departments={},_.forEach(r=>{const c=this._settings.get("app.department_map")||{};this._users[r.asset_id]=r.user_name,this._departments[r.asset_id]=c[r.extension_data.department]||""})}),(0,U.d)(1)),this.desk_list=this._state.level.pipe((0,T.w)(_=>(0,S.rlq)(_.id,"desks").pipe((0,E.U)(r=>(r.details instanceof Array?r.details:[]).map(c=>new ze.n({...c,zone:_}))))),(0,j.K)(_=>[]),(0,U.d)(1)),this._bind=this._state.level.pipe((0,E.U)(_=>{if(this._statuses={},this.unsubWith("lvl"),!_)return;const r=this._org.binding("area_management");if(!r)return;let c=(0,S.rTZ)(r,"AreaManagement").binding(_.id);this.subscription("lvl-in_use",c.listen().subscribe(u=>this.processBindingChange(u||{},r))),this.subscription("lvl-in_use_bind",c.bind())})),this._state_change=(0,v.aj)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this._options]).pipe((0,E.U)(([_,r,c,u,d])=>{this._statuses={};for(const{id:f,bookable:w}of _){const x=r.some(R=>f===R),J=c.some(R=>f===R),q=d.some(R=>f===R),W=u.some(R=>f===R);this._statuses[f]=w?x||J||W?J||W?"busy":"pending":q?"signs-of-life":"free":"not-bookable"}this.processDesks(_)})),this.init()}init(){var s=this;return(0,h.Z)(function*(){yield s._org.initialised.pipe((0,K.P)(t=>t)).toPromise(),s.setOptions({enable_booking:!1!==s._settings.get("app.desks.enable_maps")}),s.subscription("bind",s._bind.subscribe()),s.subscription("changes",s._state_change.subscribe()),s.subscription("desks",s.desk_list.subscribe(t=>s.processDesks(t)))})()}startPolling(s=1e4){return this.subscription("desks_in_use_bookings",this._desk_bookings.subscribe(t=>{const o=t.filter(n=>!(n.rejected||n.deleted||"ended"===n.extension_data.current_state||n.is_done));this._in_use.next(o.map(n=>n.asset_id)),this._checked_in.next(o.filter(n=>n.checked_in).map(n=>n.asset_id))})),this._poll.next(Date.now()),this.interval("poll",()=>this._poll.next(Date.now()),s),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setOptions(s){this._options.next({...this._options.getValue(),...s}),s.date&&this._poll.next(Date.now())}processBindingChange({value:s},t){const o=(s||[]).filter(_=>!["desk","booking"].includes(_.location)),n=(s||[]).filter(_=>"desk"===_.location||"booking"===_.location&&"desk"===_.type);this._presence.next(n.filter(_=>_.at_location).map(_=>_.map_id||_.asset_id)),this._signs_of_life.next(n.filter(_=>_.signs_of_life).map(_=>_.map_id||_.asset_id));const i=this._settings.get("app.department_map")||{};for(const _ of n)this._users[_.map_id]=_.staff_name,this._departments[_.map_id]=i[_.department]||"";this.processDevices(o,t),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const s={},t=this._settings.get("app.explore.colors")||{};for(const o in this._statuses)this._statuses[o]&&(s[`#${o}`]={fill:t[`desk-${this._statuses[o]}`]||t[`${this._statuses[o]}`]||F.y[`${this._statuses[o]}`]});this._state.setStyles("desks",s)}processDevices(s,t){const o=[];for(const n of s){const i=n.x/n.map_width,_=n.y/n.map_height;o.push({track_id:`device:hover:${i},${_}`,location:{x:n.coordinates_from?.includes("right")?1-i:i,y:n.coordinates_from?.includes("bottom")?1-_:_},content:B,z_index:20,data:{...n,system:t}})}this._state.setFeatures("devices",o)}processDesks(s){var t=this;const o=[],n=[],i=this._options.getValue();for(const _ of s){if(o.push({track_id:`desk:hover:${_.map_id||_.id}`,location:_.id,content:Oe.c,full_size:!0,no_scale:!0,data:{id:_.map_id||_.id,map_id:_.name,name:_.name||_.map_id,user:this._users[_.map_id]||_.staff_name,status:this._statuses[_.map_id],department:this._departments[_.map_id]||""},z_index:20}),!_.bookable)continue;const r=function(){var c=(0,h.Z)(function*(){if("free"!==t._statuses[_.id])return(0,m.cB)(`${_.name} is unavailable at this time.`);t._bookings.newForm(),t._bookings.setOptions({type:"desk"});const{date:u,duration:d,user:f}=yield t._setBookingTime(t._bookings.form.value.date,t._bookings.form.value.duration,t._options.getValue()?.custom??!1,_);t._bookings.form.patchValue({asset_id:_.id,asset_name:_.name,date:u,duration:d,map_id:_?.map_id||_?.id,description:_.name,user:f||i.host||(0,m.ar)(),booking_type:"desk",zones:_.zone?[_.zone?.parent_id,_.zone?.id]:[]}),yield t._bookings.confirmPost(),t._users[_.map_id]=(i.host||(0,m.ar)())?.name,(0,m.t5)(`Successfully booked desk ${_.name||_.id}`)});return function(){return c.apply(this,arguments)}}();n.push({id:_.id,action:"click",callback:r}),n.push({id:_.id,action:"touchend",callback:r})}this._state.setActions("desks",this._options.getValue().enable_booking?n:[]),this._state.setFeatures("desks",o),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(s,t,o=!1,n=null){var i=this;return(0,h.Z)(function*(){let _=null;if(i._settings.get("app.desks.allow_time_changes")){const r=(0,ne.Z)((0,de.Z)(Date.now(),i._settings.get("app.desks.available_period")||90)),u=yield i._dialog.open(z,{data:{date:s,duration:t,until:r,host:o,resource:n}}).afterClosed().toPromise();if(!u)throw"User cancelled";s=u.date,t=u.duration,_=u.user}return{date:s,duration:t,user:_}})()}}N.\u0275fac=function(s){return new(s||N)(e.LFG(L.c),e.LFG($.w),e.LFG(m.gb),e.LFG(ke.f),e.LFG(me.uw))},N.\u0275prov=e.Yz7({token:N,factory:N.\u0275fac});var ae=l(8115),rt=l(2641),ct=l(567);class Z extends m.cx{constructor(s,t,o){super(),this._org=s,this._state=t,this._settings=o,this._options=new O.X({date:(0,ae.Z)(Date.now()).valueOf()}),this._poll=new O.X(0),this.options=this._options.asObservable(),this.levels=this._org.active_levels.pipe((0,E.U)(n=>n.filter(i=>i.tags.includes("parking")))),this.events=(0,v.aj)([this._org.active_building,this._options,this._poll]).pipe((0,T.w)(([n,i])=>(0,_e.F2)({period_start:(0,I.Z)((0,ae.Z)(i.date)),period_end:(0,I.Z)((0,ne.Z)(i.date)),type:"parking",zones:n?.id})),(0,U.d)(1)),this.existing_event=(0,v.aj)([this._options]).pipe((0,T.w)(([n])=>(0,_e.F2)({period_start:(0,I.Z)((0,ae.Z)(n.date)),period_end:(0,I.Z)((0,ne.Z)(n.date)),type:"parking",email:n?.user||(0,m.ar)()?.email})),(0,U.d)(1)),this.week_events=(0,v.aj)([this._org.active_building,this._options]).pipe((0,T.w)(([n,i])=>(0,_e.F2)({period_start:(0,I.Z)((0,ae.Z)(i.date)),period_end:(0,I.Z)((0,de.Z)((0,ne.Z)(i.date),6)),type:"parking",zones:n?.id})),(0,U.d)(1)),this.spaces=this.levels.pipe((0,T.w)(n=>(0,ct.D)(n.map(i=>(0,S.rlq)(i.id,"parking-spaces").pipe((0,E.U)(_=>_.details.map(r=>({...r,zone_id:i.id}))))))),(0,E.U)(n=>(0,m.xH)(n)),(0,U.d)(1)),this.available_spaces=(0,v.aj)([this.events,this.spaces,this._state.level]).pipe((0,E.U)(([n,i,_])=>i.filter(r=>r.zone_id===_?.id&&!n.find(c=>c.asset_id===r.id)))),this.week_availablility=(0,v.aj)([this.week_events,this.spaces,this._options]).pipe((0,E.U)(([n,i,{date:_}])=>{const r={};for(let c=0;c<7;c++){const u=(0,de.Z)(_,c),d=n.filter(f=>(0,rt.Z)(u,f.date));r[u.valueOf()]=i.filter(f=>!d.find(w=>w.asset_id===f.id)).length}return r})),this.subscription("spaces",(0,v.aj)([this.spaces,this.available_spaces]).subscribe(([n,i])=>this._updateParkingSpaces(n,i))),this.interval("poll",()=>this._poll.next(Date.now()),1e4)}setOptions(s){this._options.next({...this._options.getValue(),...s})}_updateParkingSpaces(s,t){console.log("Spaces:",s,t);const o={},n=[],i=this._settings.get("app.explore.colors")||{};for(const _ of s){const r=!!t.find(u=>u.id===_.id),c=r?"free":"busy";o[`#${_.map_id}`]={fill:i[`parking-${c}`]||i[`${c}`]||F.y[`${c}`],opacity:.6},r&&n.push({zoom_level:2,location:`${_.map_id}`,content:`${_.name}\nFree`})}this._state.setStyles("parking",o),this._state.setLabels("parking",n)}}Z.\u0275fac=function(s){return new(s||Z)(e.LFG($.w),e.LFG(L.c),e.LFG(m.gb))},Z.\u0275prov=e.Yz7({token:Z,factory:Z.\u0275fac});var dt=l(7121),pt=l(6221),Ce=l(437);class A extends m.cx{constructor(s,t,o,n){super(),this._lockers=s,this._explore=t,this._org=o,this._settings=n,this._status=new O.X([]),this.lockers$=this._lockers.filtered_lockers$,this.status=(0,v.aj)([this._org.active_building,this._explore.level]).pipe((0,E.U)(([i,_])=>{if(!_)return[];const r=this._org.binding("area_management");if(!r)return(0,Q.of)({});let c=(0,S.rTZ)(r,"AreaManagement").binding(_.id);this.subscription("lvl-in_use",c.listen().subscribe(({value:u})=>this._status.next(u?.filter(d=>"locker"===d.location)||[]))),this.subscription("lvl-in_use_bind",c.bind())})),this.locker_status=(0,v.aj)([this._explore.level,this._lockers.lockers_banks$,this.lockers$,this._status]).pipe((0,E.U)(([i,_,r,c])=>{const u=[],d={},f=this._settings.get("app.explore.colors")||{},w=(0,m.Tw)(_.filter(x=>x.level_id===i.id).map(x=>x.id));for(const x of w){const J=r.filter(ee=>ee.bank_id===x);let q=0;for(const ee of J)q+=c.find(Re=>Re.locker_id===ee.id&&Re.allocated)?1:0;const W=_.find(ee=>ee.id===x);u.push({location:W.map_id,content:Ce.D,full_size:!0,no_scale:!0,z_index:20,data:{bank:W,lockers:r,in_use_count:q,locker_count:J.length,system:this._org.binding("area_management")}});const R=q/J.length,fe=R>.8?"busy":R>.3?"pending":"free";d[`#${W.map_id}`]={fill:f[`lockers-${fe}`]||f[`${fe}`]||F.y[`${fe}`]}}console.log("Features:",u),this._explore.setStyles("lockers",d),this._explore.setFeatures("lockers",u)})),console.log("ExploreLockersService"),this.subscription("level",this._explore.level.pipe((0,pe.h)(i=>!!i)).subscribe(i=>this._lockers.setLevel(i.id))),this.subscription("status",this.status.subscribe()),this.subscription("locker_status",this.locker_status.subscribe())}}A.\u0275fac=function(s){return new(s||A)(e.LFG(dt.A),e.LFG(L.c),e.LFG(pt.w7),e.LFG(m.gb))},A.\u0275prov=e.Yz7({token:A,factory:A.\u0275fac,providedIn:"root"});var xe=l(8461);function ut(a,s){if(1&a&&(e.TgZ(0,"div",3),e._UZ(1,"div",12),e.TgZ(2,"div",13),e._uU(3),e.qZA()()),2&a){const t=s.$implicit;e.xp6(1),e.Udp("background-color",t[1]),e.xp6(2),e.Oqu(t[0])}}function mt(a,s){if(1&a&&(e.TgZ(0,"div",8)(1,"h3",9),e.SDv(2,10),e.qZA(),e.YNc(3,ut,4,3,"div",11),e.qZA()),2&a){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.legend)}}const ht=[];class V extends m.cx{toggleZones(s){var t=this;return(0,h.Z)(function*(){const o=yield t.options.pipe((0,Pe.q)(1)).toPromise(),n=s?o.disable?.filter(i=>"zones"!==i&&"devices"!==i)||[]:(0,m.Tw)([...o.disable||[],"zones","devices"]);t.setOptions({disable:n})})()}get show_legend(){return!!this._settings.get("app.explore.show_legend")}get legend(){return this._settings.get("app.explore.legend")||ht}constructor(s,t,o,n,i,_,r,c,u,d,f,w){super(),this._state=s,this._s=t,this._desks=o,this._zones=n,this._parking=i,this._lockers=_,this._route=r,this._router=c,this._spaces=u,this._org=d,this._settings=f,this._space_pipe=w,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options,this.message=this._state.message,this.setOptions=x=>this._state.setOptions(x)}ngOnInit(){var s=this;return(0,h.Z)(function*(){s._state.reset(),yield s._spaces.initialised.pipe((0,K.P)(t=>t)).toPromise(),s.toggleZones(!1),s.subscription("desks",s._desks.startPolling()),s.subscription("route.query",s._route.queryParamMap.subscribe(function(){var t=(0,h.Z)(function*(o){if(o.has("level")&&s._state.setLevel(o.get("level")),s._state.setFeatures("_located",[]),o.has("space"))s.locateSpace(o.get("space"));else if(o.has("user")){let n=s._settings.value("last_search");if((!n||o.get("user")!==n.email)&&(n=null,n=yield(0,ge.w0)(o.get("user")).toPromise()),!n)return(0,m.cB)(`Unable to user details for ${o.get("user")}`);s.locateUser(n instanceof Array?n[0]:n).catch(i=>{console.error(i),(0,m.cB)(`Unable to locate ${o.get("user")}`),s._router.navigate([],{relativeTo:s._route,queryParams:{}})})}else o.has("locate")?s._locateFeature(o.get("locate"),o.get("name")):s.timeout("update_location",()=>{s._state.setFeatures("_located",[])})});return function(o){return t.apply(this,arguments)}}()))})()}updateZoom(s){this._state.setPositions(s,this._state.positions.center)}updateCenter(s){this._state.setPositions(this._state.positions.zoom,s)}_locateFeature(s,t=""){const o=s.includes(","),n=s.split(","),i={track_id:`locate-${s}`,location:o?{x:parseFloat(n[0]),y:parseFloat(n[1])}:s,content:re.q,z_index:99,data:{message:t}};this.timeout("update_location",()=>this._state.setFeatures("_located",[i]))}locateSpace(s){var t=this;return(0,h.Z)(function*(){const o=yield t._space_pipe.transform(s);if(!o)return(0,m.cB)("Unable to load space details.");t._state.setLevel(t._org.levelWithID(o.zones)?.id);const n={track_id:`locate-${o.id}`,location:o.map_id,content:re.q,z_index:99,data:{message:`${o.display_name||o.name} is here`}};t.timeout("update_location",()=>t._state.setFeatures("_located",[n]))})()}locateUser(s){var t=this;return(0,h.Z)(function*(){let o=t._org.binding("location_services");if(!o)throw"Location services is not setup for this application.";"string"==typeof o&&(o={system_id:o,module:"LocationServices",priority:[]});const i=(yield(0,S.rTZ)(o.system_id,o.module).execute("locate_user",[s.email,s.username||s.id])).map(u=>new ge.Y(u));if(i.sort((u,d)=>o.priority.indexOf(u.type)-o.priority.indexOf(d.type)),!i?.length)throw"No locations for the given user";t._state.setLevel(t._org.levelWithID([i[0]?.level])?.id);const _=i[0].position,{coordinates_from:r}=i[0],c={track_id:`locate-${s.id}`,location:"wireless"===i[0].type?{x:r?.includes("right")?1-_.x:_.x,y:r?.includes("bottom")?1-_.y:_.y}:_,content:"wireless"===i[0].type?Ze.n:re.q,z_index:99,data:{message:`${s.name} is here`,radius:i[0].variance,last_seen:i[0].last_seen}};t.timeout("update_location",()=>{t._state.setFeatures("_located",[c])})})()}}V.\u0275fac=function(s){return new(s||V)(e.Y36(L.c),e.Y36(F.a),e.Y36(N),e.Y36(P),e.Y36(Z),e.Y36(A),e.Y36(D.gz),e.Y36(D.F0),e.Y36(Ue.s),e.Y36($.w),e.Y36(m.gb),e.Y36(Ee.X))},V.\u0275cmp=e.Xpm({type:V,selectors:[["explore-map-view"]],features:[e._Bn([F.a,N,P,Z,A,Ee.X]),e.qOj],decls:17,vars:25,consts:function(){let a,s;return a=$localize`:␟dab9a30ea9f109a7395ec84fe144c4f70d50c32d␟4377629928032707348:Zones`,s=$localize`:␟5c5419db944ed6a96f9515a2ac0ee390ec8cf3b5␟7297822327994766046:Legend`,[[3,"src","zoom","center","styles","features","actions","labels","zoomChange","centerChange"],[1,"absolute","bottom-2","right-2"],["controls","",1,"absolute","top-2","left-2","max-w-[calc(100vw-1rem)]","bg-white","dark:bg-neutral-800","border","border-gray-200","dark:border-neutral-500","rounded","p-2","space-y-2","overflow-hidden"],[1,"flex","items-center","space-x-2"],["name","zones",1,"ml-2",3,"ngModel","ngModelChange"],["for","zones",1,"mb-0"],a,["legend","","class","absolute bottom-2 left-2 p-2 rounded bg-white dark:bg-neutral-800 border border-gray-300",4,"ngIf"],["legend","",1,"absolute","bottom-2","left-2","p-2","rounded","bg-white","dark:bg-neutral-800","border","border-gray-300"],[1,"mb-2","font-medium"],s,["class","flex items-center space-x-2",4,"ngFor","ngForOf"],[1,"w-3","h-3","rounded-full","border","border-gray-400"],[1,"text-sm"]]},template:function(s,t){if(1&s&&(e.TgZ(0,"i-map",0),e.NdJ("zoomChange",function(n){return t.updateZoom(n)})("centerChange",function(n){return t.updateCenter(n)}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.qZA(),e._UZ(8,"explore-zoom-controls",1),e.TgZ(9,"div",2),e._UZ(10,"explore-map-controls"),e.TgZ(11,"div",3)(12,"mat-slide-toggle",4),e.NdJ("ngModelChange",function(n){return t.toggleZones(n)}),e.ALo(13,"async"),e.qZA(),e.TgZ(14,"label",5),e.SDv(15,6),e.qZA()()(),e.YNc(16,mt,4,1,"div",7)),2&s){let o,n,i;e.Q6J("src",e.lcZ(1,9,t.url))("zoom",null==(o=e.lcZ(2,11,t.positions))?null:o.zoom)("center",null==(n=e.lcZ(3,13,t.positions))?null:n.center)("styles",e.lcZ(4,15,t.styles))("features",e.lcZ(5,17,t.features))("actions",e.lcZ(6,19,t.actions))("labels",e.lcZ(7,21,t.labels)),e.xp6(12),e.Q6J("ngModel",!(null!=(i=e.lcZ(13,23,t.options))&&null!=i.disable&&i.disable.includes("zones"))),e.xp6(4),e.Q6J("ngIf",t.show_legend&&t.legend.length)}},dependencies:[g.sg,g.O5,ve.p,p.JJ,p.On,se.Rr,X,xe.s,g.Ov],styles:["[_nghost-%COMP%]{height:100%;width:100%}[zones][_ngcontent-%COMP%]{top:3.5rem}"]});var ft=l(656),gt=l(9012);class Y{constructor(s,t){this._org=s,this._settings=t,this._emergency_contacts=new O.X([]),this._filter=new O.X(""),this._loading=new O.X(!1),this.emergency_contacts=this._emergency_contacts.asObservable(),this._user_search=this._filter.pipe((0,ue.b)(400),(0,ie.b)(()=>this._loading.next(!0)),(0,T.w)(o=>o?.length>2?this.search_fn(o):(0,Q.of)([])),(0,j.K)(()=>[])),this._space_search=this._filter.pipe((0,ue.b)(400),(0,ie.b)(()=>this._loading.next(!0)),(0,T.w)(o=>o?.length>2?(0,S.vIL)({q:o,zone_id:this._org.organisation.id}).pipe((0,E.U)(({data:n})=>n.filter(i=>i.map_id).map(i=>new ft.T({...i,level:this._org.levelWithID(i.zones)})))):(0,Q.of)([])),(0,j.K)(()=>[])),this._points_of_interest=this._org.active_building.pipe((0,pe.h)(o=>!!o),(0,T.w)(()=>(0,S.BW_)(this._org.building.id,{name:"points_of_interest"}).pipe((0,j.K)(()=>(0,Q.of)({details:[]})))),(0,E.U)(o=>{console.log("Data:",o);const n=[];for(const i of o){const _=i.metadata.points_of_interest;if(_)for(const r of _.details)n.push({id:r.id,type:"feature",name:r.name,description:"",zone:i.zone})}return n})),this.search_results=(0,v.aj)([this._filter,this._space_search,this._user_search,this._emergency_contacts,this._points_of_interest]).pipe((0,E.U)(([o,n,i,_,r])=>{const c=o.toLowerCase(),u=(0,m.Tw)([...n.filter(d=>d.email.toLowerCase().includes(c)||d.name.toLowerCase().includes(c)||d.display_name.toLowerCase().includes(c)).map(d=>({id:d.id,type:"space",name:d.display_name||d.name,description:`Capacity: ${d.capacity} `})),..._.map(d=>({id:d.email,type:d.type||"contact",name:d.name,description:d.email})).filter(d=>d.name.toLowerCase().includes(c)||d.description.toLowerCase().includes(c)||d.type.toLowerCase().includes(c)),...i.map(d=>({id:d.email,type:"user",name:d.name,description:d.email})),...r.filter(d=>d.name.toLowerCase().includes(c)).map(d=>({id:d.id,type:"feature",name:d.name,description:""}))],"id");return u.sort((d,f)=>d.name.localeCompare(f.name)),u}),(0,ie.b)(()=>this._loading.next(!1)),(0,U.d)(1)),this.loading=this._loading.asObservable(),this.search_fn=o=>this._settings.get("app.basic_user_search")?(0,S.E4d)({q:o,authority_id:(0,S.N9E)()?.id}).pipe((0,E.U)(n=>n.data)):(0,gt.VE)(o),this.search_results.subscribe(),this.init()}init(){var s=this;return(0,h.Z)(function*(){yield s._org.initialised.pipe((0,K.P)(n=>n)).toPromise();let t=s._org.binding("location_services");if(!t)return;const o=(0,S.rTZ)(t,"LocationServices");if(o){const n=o.binding("emergency_contacts");n.listen().subscribe(i=>{const _=[];for(const r in i)for(const c of i[r])_.push({...c,type:r});s._emergency_contacts.next(_)}),n.bind()}})()}setFilter(s){this._filter.next(s)}}Y.\u0275fac=function(s){return new(s||Y)(e.LFG($.w),e.LFG(m.gb))},Y.\u0275prov=e.Yz7({token:Y,factory:Y.\u0275fac,providedIn:"root"});var Et=l(4618),he=l(7957),St=l(1572);const Ot=["input"];function vt(a,s){1&a&&e._UZ(0,"mat-spinner",9),2&a&&e.Q6J("diameter",32)}function Ct(a,s){1&a&&(e.TgZ(0,"mat-option",12),e.SDv(1,13),e.qZA())}function xt(a,s){if(1&a&&(e.TgZ(0,"mat-option",14)(1,"div",15)(2,"div",16)(3,"div",17),e._uU(4),e.qZA(),e.TgZ(5,"div",18),e._uU(6),e.qZA()(),e.TgZ(7,"div",19),e._uU(8),e.qZA()()()),2&a){const t=s.$implicit;e.Q6J("value",t),e.xp6(4),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij(" ",t.type," ")}}function Rt(a,s){if(1&a&&(e.ynx(0),e.YNc(1,Ct,2,0,"mat-option",10),e.ALo(2,"async"),e.YNc(3,xt,9,4,"mat-option",11),e.ALo(4,"slice"),e.ALo(5,"async"),e.BQk()),2&a){const t=e.oxw();let o;e.xp6(1),e.Q6J("ngIf",!(null!=(o=e.lcZ(2,2,t.results))&&o.length)),e.xp6(2),e.Q6J("ngForOf",e.Dn7(4,4,e.lcZ(5,8,t.results),0,5))}}class H extends m.cx{checkClick(s){this._el?.nativeElement?.contains(s.target)||(this.show=!1,this._input_el?.nativeElement?.blur())}constructor(s,t,o,n){super(),this._el=s,this._search=t,this._router=o,this._route=n,this.show=!1,this.search_str="",this.results=this._search.search_results,this.loading=this._search.loading,this.setFilter=i=>this._search.setFilter(i),this.setItem=i=>i instanceof Object?this.select(i):this.setFilter(i),this.onTouch=i=>this.checkClick(i)}showSearch(){this.show=!0,this._input_el?.nativeElement&&this.timeout("focus",()=>this._input_el.nativeElement.focus(),300)}closeSearch(s){this.show=!1,this.search_str="",this.setFilter(""),this._input_el?.nativeElement&&(this._input_el.nativeElement.focus(),this._input_el.nativeElement.blur())}select(s){this.search_str=s.name;const t={};t["space"===s.type?"space":"feature"===s.type?"feature":"user"]=s.id,this._router.navigate([],{relativeTo:this._route,queryParams:t})}}H.\u0275fac=function(s){return new(s||H)(e.Y36(e.SBq),e.Y36(Y),e.Y36(D.F0),e.Y36(D.gz))},H.\u0275cmp=e.Xpm({type:H,selectors:[["explore-search"]],viewQuery:function(s,t){if(1&s&&e.Gf(Ot,5),2&s){let o;e.iGM(o=e.CRH())&&(t._input_el=o.first)}},hostBindings:function(s,t){1&s&&e.NdJ("click",function(n){return t.checkClick(n)},!1,e.evT)("touchstart",function(n){return t.onTouch(n)},!1,e.evT)},features:[e.qOj],decls:13,vars:12,consts:function(){let a,s;return a=$localize`:␟7a428104a6c33787961fda306f9c518f89fb0261␟6939663044582448373:Search for...`,s=$localize`:␟0c720c4e60410fcfcd8582a32297bdd397620830␟3411517965707112535: No matches found `,[["role","search","tabindex","0","matRipple","",1,"bg-white","m-2","flex","items-center","z-10","relative","overflow-hidden","outline-none"],["tabindex","0",1,"text-2xl","outline-none",3,"click"],["keyboard","","placeholder",a,1,"flex-1","text-base","border-none","outline-none",3,"ngModel","matAutocomplete","matAutocompleteConnectedTo","ngModelChange","blur"],["input",""],["class","mr-2",3,"diameter",4,"ngIf"],["matAutocompleteOrigin","",1,"absolute","bottom-0","left-8","right-8","min-w-[20rem]"],["origin","matAutocompleteOrigin"],["auto","matAutocomplete"],[4,"ngIf"],[1,"mr-2",3,"diameter"],["class","pointer-events-none",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none"],s,[3,"value"],[1,"flex","items-center","leading-tight","w-[26rem]","max-w-[calc(100vw-2rem)]"],[1,"flex-1","w-1/2","overflow-hidden"],[1,"truncate","w-full"],[1,"text-xs"],[1,"text-xs","font-bold","p-2","capitalize","text-white","bg-gray-500","rounded"]]},template:function(s,t){if(1&s&&(e.TgZ(0,"div",0)(1,"app-icon",1),e.NdJ("click",function(n){return t.show?t.closeSearch(n):t.showSearch()}),e._uU(2),e.qZA(),e.TgZ(3,"input",2,3),e.NdJ("ngModelChange",function(n){return t.search_str=n})("ngModelChange",function(n){return t.setItem(n)})("blur",function(){return t.show=!!t.search_str}),e.qZA(),e.YNc(5,vt,1,1,"mat-spinner",4),e.ALo(6,"async"),e._UZ(7,"div",5,6),e.qZA(),e.TgZ(9,"mat-autocomplete",null,7),e.YNc(11,Rt,6,10,"ng-container",8),e.ALo(12,"async"),e.qZA()),2&s){const o=e.MAs(8),n=e.MAs(10);e.ekj("show",t.show||t.search_str),e.xp6(2),e.hij(" ",t.show||t.search_str?"close":"search"," "),e.xp6(1),e.Q6J("ngModel",t.search_str)("matAutocomplete",n)("matAutocompleteConnectedTo",o),e.xp6(2),e.Q6J("ngIf",e.lcZ(6,8,t.loading)),e.xp6(6),e.Q6J("ngIf",!0!==e.lcZ(12,10,t.loading)&&(t.show||t.search_str))}},dependencies:[g.sg,g.O5,ce.o,Et.U,he.XC,oe.ey,he.ZL,he.BU,oe.wG,St.Ou,p.Fj,p.JJ,p.On,g.Ov,g.OU],styles:["[_nghost-%COMP%]{z-index:99}[role=search][_ngcontent-%COMP%]{height:3.125rem;width:3.125rem;border-radius:1.5rem;border:1px solid #ccc;transition:width .2s}app-icon[_ngcontent-%COMP%]{margin:.55rem}[role=search].show[_ngcontent-%COMP%]{width:32rem;max-width:calc(100vw - 1rem);border-color:#1e88e5}"]}),l(9275),l(1718),l(3496),l(3905);class G{}G.\u0275fac=function(s){return new(s||G)},G.\u0275mod=e.oAB({type:G}),G.\u0275inj=e.cJS({imports:[g.ez,te.Kk,p.u5,p.UX,se.rP,M.U8,y.eL,C.W,b.E]})},8461:(Te,le,l)=>{l.d(le,{s:()=>M});var g=l(6667),p=l(4650),te=l(5306),se=l(3238);class M{constructor(C){this._state=C,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}}M.\u0275fac=function(C){return new(C||M)(p.Y36(g.c))},M.\u0275cmp=p.Xpm({type:M,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:function(){let y,C,b;return y=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,C=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,b=$localize`:␟77981432124895c410e5b9157b3deb948831ffc6␟5016012668378976433:Reset Zoom & Center`,[["z-in","","icon","","matRipple","","matTooltip",y,1,"bg-white","dark:bg-neutral-800",3,"click"],["z-out","","icon","","matRipple","","matTooltip",C,1,"bg-white","dark:bg-neutral-800",3,"click"],["reset","","icon","","matRipple","","matTooltip",b,1,"bg-white","dark:bg-neutral-800",3,"click"]]},template:function(C,b){1&C&&(p.TgZ(0,"button",0),p.NdJ("click",function(){return b.zoomIn()}),p.TgZ(1,"app-icon"),p._uU(2,"add"),p.qZA()(),p.TgZ(3,"button",1),p.NdJ("click",function(){return b.zoomOut()}),p.TgZ(4,"app-icon"),p._uU(5,"remove"),p.qZA()(),p.TgZ(6,"button",2),p.NdJ("click",function(){return b.reset()}),p.TgZ(7,"app-icon"),p._uU(8,"autorenew"),p.qZA()())},dependencies:[te.o,se.wG],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}button[_ngcontent-%COMP%]{border:1px solid #9998;border-radius:0}button[_ngcontent-%COMP%]:first-child{border-radius:.25rem .25rem 0 0;border-bottom:none}button[_ngcontent-%COMP%]:last-child{border-radius:0 0 .25rem .25rem;border-top:none}"]})}}]);