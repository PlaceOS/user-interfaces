(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"G/of":function(t,e,n){"use strict";n.r(e),n.d(e,"ReportsModule",function(){return Dt});var s=n("SVse"),o=n("s7LF"),i=n("iInd"),c=n("URK9"),a=n("5QHs"),l=n("8Y7J"),r=n("ORrl"),u=n("mrSG"),b=n("SxV6"),d=n("grfs"),p=n("K2Fw"),g=n("Qfz5"),h=n("D01k"),f=n("M34a"),v=n("piIK"),m=n("/Tr7"),_=n("JCDJ"),y=n("jIYg"),O=864e5;function j(t,e){Object(y.a)(2,arguments);var n=Object(f.a)(t),s=Object(f.a)(e),o=n.getTime()-Object(_.a)(n),i=s.getTime()-Object(_.a)(s);return Math.round((o-i)/O)}function W(t,e){var n=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return n<0?-1:n>0?1:n}function X(t,e){Object(y.a)(2,arguments);var n=Object(m.a)(t),s=Object(m.a)(e),o=W(n,s),i=Math.abs(j(n,s));n.setDate(n.getDate()-o*i);var c=W(n,s)===-o,a=o*(i-c);return 0===a?0:a}var w=n("sWYD"),x=n("XNiG"),k=n("2Vo4"),M=n("LRne"),N=n("itXk"),F=n("Kj3r"),S=n("eIep"),z=n("JIr8"),L=n("lJxs"),R=n("UXun"),I=n("InVF");let D=(()=>{class t{constructor(t){this._org=t,this._generate=new x.b,this._loading=new k.a(""),this._active_bookings=new k.a([]),this._options=new k.a({start:new Date,end:new Date}),this._bookings_list=this._generate.pipe(Object(F.a)(500),Object(S.a)(t=>{var e;console.log("Report:",t);const n=this._options.getValue();if(this._loading.next("Loading report details..."),!(null==n?void 0:n.type)&&!(null===(e=null==n?void 0:n.zones)||void 0===e?void 0:e.length))return Object(M.a)([]);const s=Object(f.a)((null==n?void 0:n.start)?new Date(n.start):new Date).valueOf(),o=Object(v.a)((null==n?void 0:n.end)?new Date(n.end):s).valueOf(),i=(null==n?void 0:n.zones)?n.zones.filter(t=>"All"!==t).join(","):"",c={period_start:Math.floor(s/1e3),period_end:Math.floor(o/1e3)};return"desks"===n.type?Object(g.e)(Object.assign(Object.assign({},c),{zones:i,type:"desk"})):Object(h.d)(Object.assign(Object.assign({},c),{zone_ids:i}))}),Object(z.a)(t=>[]),Object(L.a)(t=>(this._loading.next(""),(null==t?void 0:t.length)||Object(d.l)("No bookings for the selected levels and period"),this._active_bookings.next(t||[]),t)),Object(R.a)()),this.loading=this._loading.asObservable(),this.options=this._options.asObservable(),this.bookings=this._active_bookings.asObservable(),this.counts=this._options.pipe(Object(F.a)(500),Object(S.a)(t=>{const e=(t.zones||[]).filter(t=>-1!==t&&"All"!==t);return Promise.all(e.map(t=>Object(p.t)(t,{name:"desks"}).pipe(Object(L.a)(e=>[t,e.details.length])).toPromise()))}),Object(z.a)(t=>[]),Object(L.a)(t=>{const e={};return this._active_bookings.next([]),t.forEach(([t,n])=>e[t]=n),e}),Object(R.a)()),this.stats=Object(N.a)([this.counts,this.bookings]).pipe(Object(L.a)(([t,e])=>e[0]instanceof h.a?function(t,e=8){const n=t.reduce((t,e)=>t+e.attendees.length,0),s=t.reduce((t,e)=>{var n;return t+(null===(n=e.system)||void 0===n?void 0:n.capacity)},0),o=t.reduce((t,e)=>t+e.duration,0)/(60*e),i=n/s;return{count:t.length,avg_length:t.reduce((t,e)=>t+e.duration,0)/t.length,efficiency:(o+i)/2,total_users:n,total_capacity:s,occupancy:i,utilisation:o,events:t}}(e,8*this.duration):function(t,e=1,n={}){console.log("Counts:",n);const s=Object.keys(n).reduce((t,e)=>t+(n[e]||0),0);return{total:s,count:t.length,utilisation:t.length/s,events:t}}(e||[],this.duration,t))),this._bookings_list.subscribe(t=>t)}get duration(){const t=this._options.getValue();return Math.abs(X(t.start,t.end))}generateReport(){this._generate.next((new Date).valueOf())}setOptions(t){var e,n,s,o,i,c,a;(null===(e=t.zones)||void 0===e?void 0:e.includes("All"))?t.zones=["All",...this._org.levelsForBuilding(this._org.building).map(t=>t.id)]:t.zones&&(null===(s=null===(n=this._options.getValue())||void 0===n?void 0:n.zones)||void 0===s?void 0:s.includes("All"))&&(t.zones=[]),(null===(o=t.start)||void 0===o?void 0:o.valueOf())!==(null===(i=this._options.getValue().start)||void 0===i?void 0:i.valueOf())&&(null===(c=t.end)||void 0===c?void 0:c.valueOf())!==(null===(a=this._options.getValue().end)||void 0===a?void 0:a.valueOf())&&this._options.next(Object.assign(Object.assign({},this._options.getValue()),t))}downloadReport(){const t=this._options.getValue(),e=this._active_bookings.getValue();Object(d.h)(`report+${t.type}+${Object(w.a)(t.start,"yyyy-MM-dd")}+${Object(w.a)(t.end,"yyyy-MM-dd")}.csv`,Object(d.k)(e.map(t=>{const e=t.toJSON();return delete e.zones,delete e.server_names,e})))}}return t.\u0275fac=function(e){return new(e||t)(l.ec(I.c))},t.\u0275prov=l.Nb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var P=n("Q2Ze"),C=n("ZTz/"),E=n("UhP/"),V=n("TN/R"),U=n("Dxy4"),A=n("pu8Q");function T(t,e){if(1&t&&(l.Xb(0,"mat-option",13),l.Nc(1),l.Wb()),2&t){const t=e.$implicit;l.tc("value",t.id),l.Fb(1),l.Pc(" ",t.display_name||t.name," ")}}function J(t,e){1&t&&l.Sb(0,"mat-spinner",14),2&t&&l.tc("diameter",32)}function B(t,e){1&t&&(l.Xb(0,"p"),l.Nc(1,"Generate Report"),l.Wb())}let Y=(()=>{class t extends d.b{constructor(t,e,n){super(),this._state=t,this._org=e,this._route=n,this.zones=[],this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(t=>`${t.id}`),this.levels=this._org.active_levels,this.loading=this._state.loading,this.bookings=this._state.bookings,this.options=this._state.options,this.generateReport=()=>this._state.generateReport(),this.downloadReport=()=>this._state.downloadReport(),this.setStartDate=t=>this._state.setOptions({start:new Date(t)}),this.setEndDate=t=>this._state.setOptions({end:new Date(t)}),this.setZones=t=>this._state.setOptions({zones:t})}ngOnInit(){return Object(u.a)(this,void 0,void 0,function*(){yield this._org.initialised.pipe(Object(b.a)(t=>t)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{if(t.has("zone_ids")){const e=t.get("zone_ids").split(",");if(e.length){const t=this._org.levelWithID(e);if(!t)return;this._org.building=this._org.buildings.find(e=>e.id===t.parent_id),this.setZones(e)}}}))})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(D),l.Rb(I.c),l.Rb(i.a))},t.\u0275cmp=l.Lb({type:t,selectors:[["reports-options"]],features:[l.Cb],decls:27,vars:28,consts:[["appearance","outline",1,"w-48"],["multiple","","placeholder","Select Levels...",3,"ngModel","ngModelChange"],["value","All"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-64"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["mat-button","",1,"ml-4",3,"disabled","click"],[3,"diameter",4,"ngIf"],[4,"ngIf"],[3,"value"],[3,"diameter"]],template:function(t,e){if(1&t&&(l.Xb(0,"mat-form-field",0),l.Xb(1,"mat-select",1),l.ic("ngModelChange",function(t){return e.setZones(t)}),l.nc(2,"async"),l.Xb(3,"mat-option",2),l.Nc(4,"All Levels"),l.Wb(),l.Lc(5,T,2,2,"mat-option",3),l.nc(6,"async"),l.Wb(),l.Wb(),l.Xb(7,"mat-form-field",4),l.Xb(8,"mat-date-range-input",5),l.Xb(9,"input",6),l.ic("ngModelChange",function(t){return t?e.setStartDate(t):""}),l.nc(10,"async"),l.Wb(),l.Xb(11,"input",7),l.ic("ngModelChange",function(t){return t?e.setEndDate(t):""}),l.nc(12,"async"),l.Wb(),l.Wb(),l.Sb(13,"mat-datepicker-toggle",8),l.Sb(14,"mat-date-range-picker",null,9),l.Wb(),l.Xb(16,"button",10),l.ic("click",function(){return e.generateReport()}),l.nc(17,"async"),l.nc(18,"async"),l.Lc(19,J,1,1,"mat-spinner",11),l.nc(20,"async"),l.Lc(21,B,2,0,"p",12),l.nc(22,"async"),l.Wb(),l.Xb(23,"button",10),l.ic("click",function(){return e.downloadReport()}),l.nc(24,"async"),l.Xb(25,"p"),l.Nc(26,"Download Report"),l.Wb(),l.Wb()),2&t){const t=l.yc(15);let n=null,s=null,o=null,i=null,c=null;l.Fb(1),l.tc("ngModel",null==(n=l.oc(2,10,e.options))?null:n.zones),l.Fb(4),l.tc("ngForOf",l.oc(6,12,e.levels)),l.Fb(3),l.tc("rangePicker",t),l.Fb(1),l.tc("ngModel",null==(s=l.oc(10,14,e.options))?null:s.start),l.Fb(2),l.tc("ngModel",null==(o=l.oc(12,16,e.options))?null:o.end),l.Fb(2),l.tc("for",t),l.Fb(3),l.tc("disabled",!!l.oc(17,18,e.loading)||!(null!=(i=l.oc(18,20,e.options))&&null!=i.zones&&i.zones.length)),l.Fb(3),l.tc("ngIf",l.oc(20,22,e.loading)),l.Fb(2),l.tc("ngIf",!l.oc(22,24,e.loading)),l.Fb(2),l.tc("disabled",!(null!=(c=l.oc(24,26,e.bookings))&&c.length))}},directives:[P.c,C.a,o.l,o.o,E.l,s.m,V.a,V.h,o.c,V.g,V.f,P.g,V.b,U.b,s.n,A.b],pipes:[s.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                background-color: #fff;\n                height: 5em;\n                padding: 0 1em;\n            }\n\n            button[_ngcontent-%COMP%] {\n                min-width: 0;\n                padding: 0 0.85rem;\n            }\n\n            mat-form-field[_ngcontent-%COMP%] {\n                height: 3.25em;\n                margin-left: 1em;\n            }\n\n            mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%] {\n                width: 5.5em;\n                white-space: initial;\n                line-height: 1.2em;\n            }"]}),t})();var q=n("z03u");const G=function(){return["/reports","desks"]},Q=function(){return["/reports","spaces"]};let Z=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=l.Lb({type:t,selectors:[["reports-menu"],["","reports-menu",""]],decls:20,vars:4,consts:[["matRipple","",1,"h-64","w-64","m-4","p-4","flex","flex-col","items-center","justify-center","bg-white","rounded","shadow","hover:bg-gray-100",3,"routerLink"],[1,"text-8xl"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center"],[1,"ml-2"]],template:function(t,e){1&t&&(l.Xb(0,"a",0),l.Xb(1,"app-icon",1),l.Nc(2,"room"),l.Wb(),l.Xb(3,"h3",2),l.Nc(4,"Desks"),l.Wb(),l.Xb(5,"div",3),l.Xb(6,"p"),l.Nc(7,"View Report"),l.Wb(),l.Xb(8,"app-icon",4),l.Nc(9,"chevron_right"),l.Wb(),l.Wb(),l.Wb(),l.Xb(10,"a",0),l.Xb(11,"app-icon",1),l.Nc(12,"meeting_room"),l.Wb(),l.Xb(13,"h3",2),l.Nc(14,"Rooms"),l.Wb(),l.Xb(15,"div",3),l.Xb(16,"p"),l.Nc(17,"View Report"),l.Wb(),l.Xb(18,"app-icon",4),l.Nc(19,"chevron_right"),l.Wb(),l.Wb(),l.Wb()),2&t&&(l.tc("routerLink",l.uc(2,G)),l.Fb(10),l.tc("routerLink",l.uc(3,Q)))},directives:[i.f,E.o,q.a],styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: var(--bg);\n            }"]}),t})();const $=["app-reports",""];function H(t,e){1&t&&l.Sb(0,"div",4)}let K=(()=>{class t{constructor(t){this._router=t}get path(){const t=this._router.url.split("/");return t[t.length-1]}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(i.d))},t.\u0275cmp=l.Lb({type:t,selectors:[["","app-reports",""]],attrs:$,decls:6,vars:1,consts:[[1,"h-full"],[1,"relative","overflow-hidden","flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex-1","h-1/2","w-full","overflow-auto"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(t,e){1&t&&(l.Sb(0,"sidebar",0),l.Xb(1,"main",1),l.Sb(2,"reports-options"),l.Xb(3,"div",2),l.Sb(4,"router-outlet"),l.Wb(),l.Lc(5,H,1,0,"div",3),l.Wb()),2&t&&(l.Fb(5),l.tc("ngIf","reports"===e.path))},directives:[r.a,Y,i.h,s.n,Z],styles:["[_nghost-%COMP%] {\n                display: flex;\n                height: 100%;\n                width: 100%;\n                background: var(--bg);\n            }"]}),t})();var tt=n("EE6m"),et=n("qdGH"),nt=n("VSY4");let st=(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe(Object(L.a)(t=>t.count||0)),this.avg_length=this._state.stats.pipe(Object(L.a)(t=>Object(nt.a)({minutes:t.avg_length||0}))),this.efficiency=this._state.stats.pipe(Object(L.a)(t=>(100*(t.efficiency||0)).toFixed(1))),this.total_users=this._state.stats.pipe(Object(L.a)(t=>t.total_users||0)),this.total_capacity=this._state.stats.pipe(Object(L.a)(t=>t.total_capacity||0)),this.occupancy=this._state.stats.pipe(Object(L.a)(t=>(100*(t.occupancy||0)).toFixed(1))),this.utilisation=this._state.stats.pipe(Object(L.a)(t=>(100*(t.utilisation||0)).toFixed(1)))}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(D))},t.\u0275cmp=l.Lb({type:t,selectors:[["report-spaces-overall"]],decls:44,vars:21,consts:[[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"flex-1","flex","flex-col","items-center","justify-center"]],template:function(t,e){1&t&&(l.Xb(0,"div",0),l.Xb(1,"div",1),l.Xb(2,"h3"),l.Nc(3,"Total Bookings"),l.Wb(),l.Xb(4,"p"),l.Nc(5),l.nc(6,"async"),l.Wb(),l.Wb(),l.Xb(7,"div",1),l.Xb(8,"h3"),l.Nc(9,"Average Bookings Length"),l.Wb(),l.Xb(10,"p"),l.Nc(11),l.nc(12,"async"),l.Wb(),l.Wb(),l.Wb(),l.Xb(13,"div",0),l.Xb(14,"div",2),l.Xb(15,"h3"),l.Nc(16,"Overall Efficiency"),l.Wb(),l.Xb(17,"p"),l.Nc(18),l.nc(19,"async"),l.Wb(),l.Wb(),l.Xb(20,"div",2),l.Xb(21,"h3"),l.Nc(22,"Occupancy"),l.Wb(),l.Xb(23,"p"),l.Nc(24),l.nc(25,"async"),l.Wb(),l.Wb(),l.Xb(26,"div",2),l.Xb(27,"h3"),l.Nc(28,"Total Attendees"),l.Wb(),l.Xb(29,"p"),l.Nc(30),l.nc(31,"async"),l.Wb(),l.Wb(),l.Xb(32,"div",2),l.Xb(33,"h3"),l.Nc(34,"Total Capacity"),l.Wb(),l.Xb(35,"p"),l.Nc(36),l.nc(37,"async"),l.Wb(),l.Wb(),l.Xb(38,"div",2),l.Xb(39,"h3"),l.Nc(40,"Utilisation"),l.Wb(),l.Xb(41,"p"),l.Nc(42),l.nc(43,"async"),l.Wb(),l.Wb(),l.Wb()),2&t&&(l.Fb(5),l.Oc(l.oc(6,7,e.total_count)||0),l.Fb(6),l.Oc(l.oc(12,9,e.avg_length)||"None"),l.Fb(7),l.Pc("",l.oc(19,11,e.efficiency)||0,"%"),l.Fb(6),l.Pc("",l.oc(25,13,e.occupancy)||0,"%"),l.Fb(6),l.Oc(l.oc(31,15,e.total_users)||0),l.Fb(6),l.Oc(l.oc(37,17,e.total_capacity)||0),l.Fb(6),l.Pc("",l.oc(43,19,e.utilisation)||0,"%"))},pipes:[s.b],styles:["h3[_ngcontent-%COMP%] {\n            font-weight: 500;\n        }\n\n        p[_ngcontent-%COMP%]:not([simple]) {\n            font-size: 1.75rem;\n        }"]}),t})();var ot=n("IzEk"),it=n("QRxW");const ct=function(){return["name","capacity","count","utilisation","avg_attendees","occupancy"]},at=function(){return["Name","Capacity","Meeting Count","Utilisation","Avg. Attendees","Occupancy"]},lt=function(){return["flex"]};let rt=(()=>{class t{constructor(t){this._reports=t,this.space_list=Object(N.a)([this._reports.stats,this._reports.options]).pipe(Object(F.a)(300),Object(L.a)(([t,{start:e,end:n}])=>{let s=[];for(const i of t.events){const t=i.resources||[];for(const e of t){s.find(t=>t.id===e.id)||s.push({id:e.id,name:e.display_name||e.name,capacity:e.capacity||1,count:0,attendees:0,avg_attendees:0,usage:0,utilisation:0,occupancy:0});const t=s.find(t=>t.id===e.id);t.count+=1,t.usage+=i.duration,t.attendees+=i.attendees.length}}const o=X(n,e);for(const i of s)i.avg_attendees=i.attendees/i.count,i.utilisation=i.usage/60/8/o,i.occupancy=i.avg_attendees/i.capacity;return s})),this.download=()=>Object(u.a)(this,void 0,void 0,function*(){const t=yield this.space_list.pipe(Object(ot.a)(1)).toPromise();Object(d.h)("report-spaces-usage.csv",Object(d.k)(t))})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(D))},t.\u0275cmp=l.Lb({type:t,selectors:[["report-spaces-space-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(l.Xb(0,"div",0),l.Xb(1,"div",1),l.Xb(2,"h3",2),l.Nc(3,"Space Utilisation"),l.Wb(),l.Xb(4,"button",3),l.ic("click",function(){return e.download()}),l.Xb(5,"app-icon"),l.Nc(6,"download"),l.Wb(),l.Wb(),l.Wb(),l.Sb(7,"custom-table",4),l.Wb()),2&t&&(l.Fb(7),l.tc("dataSource",e.space_list)("pagination",!0)("columns",l.uc(5,ct))("display_column",l.uc(6,at))("column_size",l.uc(7,lt)))},directives:[U.b,q.a,it.a],styles:[""]}),t})();const ut=function(){return["name","capacity","count","avg_attendees","occupancy"]},bt=function(){return["Name","Capacity","Meeting Count","Avg. Attendees","Occupancy"]},dt=function(){return["flex"]};let pt=(()=>{class t{constructor(t){this._reports=t,this.user_list=Object(N.a)([this._reports.stats]).pipe(Object(F.a)(300),Object(L.a)(([t])=>{let e=[];for(const n of t.events){const t=n.attendees||[],s=n.resources.reduce((t,e)=>t+e.capacity,0)||1;for(const o of t){e.find(t=>t.email===o.email)||e.push({id:o.email,name:o.name,capacity:s,count:0,attendees:0,avg_attendees:0,occupancy:0});const t=e.find(t=>t.id===o.email);t.count+=1,t.attendees+=n.attendees.length}}for(const n of e)n.avg_attendees=n.attendees/n.count,n.occupancy=n.avg_attendees/n.capacity;return e}),Object(R.a)(1)),this.download=()=>Object(u.a)(this,void 0,void 0,function*(){const t=yield this.user_list.pipe(Object(ot.a)(1)).toPromise();Object(d.h)("report-space-attendee-usage.csv",Object(d.k)(t))})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(D))},t.\u0275cmp=l.Lb({type:t,selectors:[["report-spaces-user-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(l.Xb(0,"div",0),l.Xb(1,"div",1),l.Xb(2,"h3",2),l.Nc(3,"Staff Utilisation"),l.Wb(),l.Xb(4,"button",3),l.ic("click",function(){return e.download()}),l.Xb(5,"app-icon"),l.Nc(6,"download"),l.Wb(),l.Wb(),l.Wb(),l.Sb(7,"custom-table",4),l.Wb()),2&t&&(l.Fb(7),l.tc("dataSource",e.user_list)("pagination",!0)("columns",l.uc(5,ut))("display_column",l.uc(6,bt))("column_size",l.uc(7,dt)))},directives:[U.b,q.a,it.a],styles:[""]}),t})();const gt=["report-spaces",""];function ht(t,e){1&t&&(l.Vb(0),l.Sb(1,"report-spaces-overall"),l.Sb(2,"report-spaces-space-listing"),l.Sb(3,"report-spaces-user-listing"),l.Ub())}function ft(t,e){if(1&t&&(l.Vb(0),l.Lc(1,ht,4,0,"ng-container",0),l.nc(2,"async"),l.Ub()),2&t){const t=l.mc(),e=l.yc(5);l.Fb(1),l.tc("ngIf",l.oc(2,2,t.total_count))("ngIfElse",e)}}function vt(t,e){1&t&&(l.Xb(0,"div",3),l.Sb(1,"mat-spinner",4),l.Xb(2,"p",5),l.Nc(3,"Loading report data..."),l.Wb(),l.Wb()),2&t&&(l.Fb(1),l.tc("diameter",32))}function mt(t,e){1&t&&(l.Xb(0,"div",3),l.Xb(1,"p",5),l.Nc(2," Select levels and time period to generate a report. "),l.Wb(),l.Wb())}let _t=(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe(Object(L.a)(t=>t.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(D))},t.\u0275cmp=l.Lb({type:t,selectors:[["","report-spaces",""]],attrs:gt,decls:6,vars:4,consts:[[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(t,e){if(1&t&&(l.Lc(0,ft,3,4,"ng-container",0),l.nc(1,"async"),l.Lc(2,vt,4,1,"ng-template",null,1,l.Mc),l.Lc(4,mt,3,0,"ng-template",null,2,l.Mc)),2&t){const t=l.yc(3);l.tc("ngIf",!l.oc(1,2,e.loading))("ngIfElse",t)}},directives:[s.n,st,rt,pt,A.b],pipes:[s.b],styles:[""]}),t})();var yt=n("dndX"),Ot=n("9/EM");const jt=function(){return["date","usage","approved","count","utilisation"]},Wt=function(){return["Date","Used Desks","Approved Bookings","Total Requests","Utilisation"]},Xt=function(){return["flex"]};let wt=(()=>{class t{constructor(t){this._state=t,this.day_list=Object(N.a)([this._state.options,this._state.stats]).pipe(Object(L.a)(([t,e])=>{const{start:n,end:s}=t;let o=n;const i=[];for(;Object(yt.a)(o,s);){const t=Object(f.a)(o).valueOf(),n=Object(v.a)(t).valueOf(),s=e.events.filter(e=>Object(d.w)(t,n,e.date,e.date+60*e.duration*1e3));i.push({date:t,total:e.total,free:e.total-s.length,approved:s.reduce((t,e)=>t+(e.approved?1:0),0),count:s.length,utilisation:(s.length/e.total*100).toFixed(1)}),o=Object(Ot.a)(o,1)}return i}),Object(R.a)(1)),this.download=()=>Object(u.a)(this,void 0,void 0,function*(){let t=yield this.day_list.pipe(Object(ot.a)(1)).toPromise();t=t.map(t=>Object.assign(Object.assign({},t),{date:Object(w.a)(t.date,"MMMM d, y(EEE)")})),Object(d.h)("desks-usage.csv",Object(d.k)(t))})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(D))},t.\u0275cmp=l.Lb({type:t,selectors:[["report-desks-overall-list"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(l.Xb(0,"div",0),l.Xb(1,"div",1),l.Xb(2,"h3",2),l.Nc(3,"Daily Utilisation"),l.Wb(),l.Xb(4,"button",3),l.ic("click",function(){return e.download()}),l.Xb(5,"app-icon"),l.Nc(6,"download"),l.Wb(),l.Wb(),l.Wb(),l.Sb(7,"custom-table",4),l.Wb()),2&t&&(l.Fb(7),l.tc("dataSource",e.day_list)("pagination",!0)("columns",l.uc(5,jt))("display_column",l.uc(6,Wt))("column_size",l.uc(7,Xt)))},directives:[U.b,q.a,it.a],encapsulation:2}),t})();const xt=function(){return["name","avg_usage","approved","count","utilisation"]},kt=function(){return["Level","Avg. Used Desks","Approved Bookings","Total Requests","Utilisation"]},Mt=function(){return["flex"]};let Nt=(()=>{class t{constructor(t,e){this._state=t,this._org=e,this.level_list=Object(N.a)([this._state.options,this._state.stats,this._state.counts]).pipe(Object(L.a)(([t,e,n])=>{const{start:s,end:o,zones:i}=t,c=X(o,s),a=[];console.log("Duration:",c);for(const l of i){if("All"===l)continue;const t=this._org.levelWithID([l]),s=n[l]||0,o=e.events.filter(t=>t.zones.includes(l));console.log("Evnets:",o.length);let i=(s*c-o.length)/c;i%1!=0&&(i=i.toFixed(2)),a.push({name:(null==t?void 0:t.display_name)||(null==t?void 0:t.name),free:i,total:s,count:o.length,utilisation:(o.length/(s*c)*100||0).toFixed(2)})}return a}),Object(R.a)(1)),this.download=()=>Object(u.a)(this,void 0,void 0,function*(){let t=yield this.level_list.pipe(Object(ot.a)(1)).toPromise();Object(d.h)("desks-levels-usage.csv",Object(d.k)(t))})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(D),l.Rb(I.c))},t.\u0275cmp=l.Lb({type:t,selectors:[["report-desks-levels-list"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(l.Xb(0,"div",0),l.Xb(1,"div",1),l.Xb(2,"h3",2),l.Nc(3,"Level Utilisation"),l.Wb(),l.Xb(4,"button",3),l.ic("click",function(){return e.download()}),l.Xb(5,"app-icon"),l.Nc(6,"download"),l.Wb(),l.Wb(),l.Wb(),l.Sb(7,"custom-table",4),l.Wb()),2&t&&(l.Fb(7),l.tc("dataSource",e.level_list)("pagination",!0)("columns",l.uc(5,xt))("display_column",l.uc(6,kt))("column_size",l.uc(7,Mt)))},directives:[U.b,q.a,it.a],encapsulation:2}),t})();const Ft=["report-desks",""];function St(t,e){if(1&t&&(l.Vb(0),l.Xb(1,"div",3),l.Xb(2,"div",4),l.Xb(3,"h3"),l.Nc(4,"Total Bookings"),l.Wb(),l.Xb(5,"p"),l.Nc(6),l.nc(7,"async"),l.Wb(),l.Wb(),l.Xb(8,"div",4),l.Xb(9,"h3"),l.Nc(10,"Utilisation"),l.Wb(),l.Xb(11,"p"),l.Nc(12),l.nc(13,"async"),l.Wb(),l.Wb(),l.Wb(),l.Sb(14,"report-desks-overall-list"),l.Sb(15,"report-desks-levels-list"),l.Ub()),2&t){const t=l.mc(2);l.Fb(6),l.Oc(l.oc(7,2,t.total_count)||0),l.Fb(6),l.Pc("",l.oc(13,4,t.utilisation)||0,"%")}}function zt(t,e){if(1&t&&(l.Vb(0),l.Lc(1,St,16,6,"ng-container",0),l.nc(2,"async"),l.Ub()),2&t){const t=l.mc(),e=l.yc(5);l.Fb(1),l.tc("ngIf",l.oc(2,2,t.total_count))("ngIfElse",e)}}function Lt(t,e){1&t&&(l.Xb(0,"div",5),l.Sb(1,"mat-spinner",6),l.Xb(2,"p",7),l.Nc(3,"Loading report data..."),l.Wb(),l.Wb()),2&t&&(l.Fb(1),l.tc("diameter",32))}function Rt(t,e){1&t&&(l.Xb(0,"div",5),l.Xb(1,"p",7),l.Nc(2," Select levels and time period to generate a report. "),l.Wb(),l.Wb())}const It=[{path:"",component:K,children:[{path:""},{path:"spaces",component:_t},{path:"desks",component:(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe(Object(L.a)(t=>t.count||0)),this.utilisation=this._state.stats.pipe(Object(L.a)(t=>(100*(t.utilisation||0)).toFixed(1))),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"desks"})}}return t.\u0275fac=function(e){return new(e||t)(l.Rb(D))},t.\u0275cmp=l.Lb({type:t,selectors:[["","report-desks",""]],attrs:Ft,decls:6,vars:4,consts:[[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(t,e){if(1&t&&(l.Lc(0,zt,3,4,"ng-container",0),l.nc(1,"async"),l.Lc(2,Lt,4,1,"ng-template",null,1,l.Mc),l.Lc(4,Rt,3,0,"ng-template",null,2,l.Mc)),2&t){const t=l.yc(3);l.tc("ngIf",!l.oc(1,2,e.loading))("ngIfElse",t)}},directives:[s.n,wt,Nt,A.b],pipes:[s.b],styles:["h3[_ngcontent-%COMP%] {\n                font-weight: 500;\n            }\n\n            p[_ngcontent-%COMP%]:not([simple]) {\n                font-size: 1.75rem;\n            }"]}),t})()},{path:"**",redirectTo:"desks"}]}];let Dt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=l.Pb({type:t}),t.\u0275inj=l.Ob({imports:[[s.c,o.h,c.a,tt.a,et.c,a.b,i.g.forChild(It)]]}),t})()}}]);
//# sourceMappingURL=reports-reports-module.js.map