"use strict";(self.webpackChunkvisitor_kiosk=self.webpackChunkvisitor_kiosk||[]).push([[868],{2868:(ls,ge,c)=>{c.r(ge),c.d(ge,{AppExploreModule:()=>as});var E=c(6814),k=c(4641),v=c(6223),P=c(5077),ie=c(2599),we=c(9594),Se=c(8484),Ie=c(5832),Ae=c(1502),y=c(5861),h=c(4592),x=c(6124),Y=c(8419),G=c(2120),R=c(855),e=c(9212),$=c(3680);c(4170),c(8525);var T=c(618),ae=c(1418),H=c(5157),K=(c(982),c(1970),c(8550),c(942)),z=c(9229),B=(c(5490),c(7734)),X=c(6776),j=c(4888),re=c(3884);function Ue(n,m){if(1&n&&(e.TgZ(0,"div",5)(1,"app-icon"),e._uU(2,"thermostat"),e.qZA(),e.TgZ(3,"div",6),e._uU(4),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(4),e.hij("",t.temp,"\u02daF")}}function Be(n,m){if(1&n&&(e.TgZ(0,"div",5)(1,"app-icon"),e._uU(2,"opacity"),e.qZA(),e.TgZ(3,"div",6),e._uU(4),e.qZA()()),2&n){const t=e.oxw(2);e.xp6(4),e.hij("",t.humidity,"%")}}function Je(n,m){1&n&&(e.TgZ(0,"div",7)(1,"app-icon",8),e._uU(2,"error"),e.qZA()())}function De(n,m){if(1&n&&(e.TgZ(0,"div",2),e.YNc(1,Ue,5,1,"div",3)(2,Be,5,1,"div",3)(3,Je,3,0,"div",4),e.qZA()),2&n){const t=e.oxw();e.xp6(),e.Q6J("ngIf",t.temp),e.xp6(),e.Q6J("ngIf",t.humidity),e.xp6(),e.Q6J("ngIf",t.temp>82)}}let be="",ve=(()=>{class n extends h.cx{get show(){return be===this._details.id}set show(t){this.timeout("show",()=>be=t?this._details.id:"")}constructor(t){super(),this._details=t,this.temp=this._details.temp||0,this.humidity=this._details.humidity||0}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(P.ui))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-sensor-info"]],features:[e.qOj],decls:5,vars:1,consts:[["icon","","matRipple","","customTooltip","","yPosition","center","xPosition","center",1,"absolute","top-1/2","left-1/2","w-7","h-7","min-w-0","-translate-x-1/2","-translate-y-1/2","bg-base-100","shadow","pointer-events-auto",3,"content"],["stats",""],[1,"absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2","bg-base-100","rounded-lg","border","border-base-200","p-2","text-xl"],["class","flex items-center space-x-2 whitespace-nowrap pr-2",4,"ngIf"],["class","absolute top-0 right-0 rounded-full translate-x-1/2 -translate-y-1/2 bg-base-100 border border-base-200",4,"ngIf"],[1,"flex","items-center","space-x-2","whitespace-nowrap","pr-2"],[1,""],[1,"absolute","top-0","right-0","rounded-full","translate-x-1/2","-translate-y-1/2","bg-base-100","border","border-base-200"],[1,"text-error","text-xl"]],template:function(o,s){if(1&o&&(e.TgZ(0,"button",0)(1,"app-icon"),e._uU(2," visibility "),e.qZA()(),e.YNc(3,De,4,3,"ng-template",null,1,e.W1O)),2&o){const i=e.MAs(4);e.Q6J("content",i)}},dependencies:[E.O5,j.o,re.X,$.wG]})}return n})();var L=c(5125),C=c(2994),Ye=c(7145);let W=(()=>{class n extends h.cx{constructor(t,o,s){super(),this._state=t,this._org=o,this._settings=s,this._area_list=[],this._statuses={},this._count_key={},this._location={},this._label_location={},this._capacity={},this._draw={},this._points={},this._features=[],this._polygons$=new L.X([]),this._bind=(0,C.aj)([this._org.active_building,this._state.level,this._state.options]).pipe((0,B.h)(([i,a,{is_public:l}])=>!!i&&!!a&&!l),(0,x.U)(([i,a])=>{this._statuses={};let l=this._org.binding("area_management");if(!l)return;const r=(0,T.rTZ)(l,"AreaManagement").binding(`${a.id}:areas`),p=(0,T.rTZ)(l,"AreaManagement").binding(`${a.id}`),_=(0,C.aj)([r.listen(),p.listen()]).pipe((0,X.b)(100),(0,x.U)(([d,f])=>[...d?.value||[],...(f?.value||[]).filter(b=>"area"===b.location)]));this.subscription("zones-status",_.subscribe(d=>this.parseData(d))),this.subscription("binding",r.bind()),this.subscription("zone-binding",p.bind())})),this.init()}init(){var t=this;return(0,y.Z)(function*(){yield t._org.initialised.pipe((0,Y.P)(s=>s)).toPromise();const o=yield Promise.all(t._org.levels.map(s=>(0,T.rlq)(s.id,"map_regions").toPromise()));t._area_list=[];for(const s of o){const i=s?.details?.areas;if(i)for(const a of i){const{capacity:l,hide_label:r,label_location:p,draw_polygon:_,area_count_key:d}=a.properties||{},{coordinates:f}=a.geometry||{};t._capacity[a.id]=l||100,t._count_key[a.id]=d||"",t._location[a.id]=f?.length?Ge(f):null,t._label_location[a.id]=!1===r?p||t._location[a.id]:null,t._draw[a.id]=!!_||t._settings.get("app.explore.use_zone_polygons"),t._points[a.id]=f||[],t._area_list.push(a.map_id||a.id)}}t._state.setFeatures("zones-canvas",[{track_id:"zones-canvas",location:{x:.5,y:.5},content:Ye.S,data:{polygons$:t._polygons$,draw_points:!1,draw_labels:!1}}]),t.updateStatus(),t.subscription("bind",t._bind.subscribe())})()}parseData(t=[]){const o=[],s=[];for(const i of t){const a=i.map_id||i.area_id,l=i.capacity||this._capacity[a]||100,p=(i[this._count_key[a]||this._settings.get("app.explore.area_count_key")||"count"]||0)/l;if(this._statuses[a]=i.at_location?"busy":p<.4?"free":p<.75?"pending":"busy",!this._location[a])continue;let _="";i.count&&(_+=`${i.count||0} User Device${1===i.count?"":"s"}\n`),i.temperature&&(_+=`Temperature: ${i.temperature} \u02daC\n`),i.people_count>0&&(_+=`${i.people_count_sum} ${1===i.people_count_sum?"Person":"People"}\n`),i.humidity&&(_+=`Humidity: ${i.humidity}%\n`),i.queue_size&&(_+=`Queue Size: ${i.queue_size}%\n`),i.counter&&(_+=`Count: ${i.counter}\n`),this._label_location[a]&&!this._settings.get("app.explore.show_zone_labels")&&o.push({location:this._label_location[a],content:_,z_index:100}),this._settings.get("app.explore.show_zone_sensor_info")&&(i.temperature||i.humidity)&&s.push({track_id:`sensors:${a}`,location:this._location[a],content:ve,data:{id:a,temp:i.temperature||10,humidity:i.humidity||10},z_index:98})}this._features=s,this._state.setLabels("zones",o),this.updateStatus()}updateStatus(){const t={},s=this._settings.get("app.explore.colors")||{},i=[];for(const a in this._statuses){const l=s[`zone-${this._statuses[a]}`]||s[`${this._statuses[a]}`]||z.y[`${this._statuses[a]}`];this._draw[a]?i.push({name:a,points:this._points[a],color:l}):t[`#${a}`]={fill:l,opacity:.6}}this._polygons$.next(i),this._state.setFeatures("zones",[...this._features]),this._state.setStyles("zones-styles",t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(R.c),e.LFG(G.w),e.LFG(h.gb))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();function Ge(n){const m=(n||[]).reduce((t,[o,s])=>({x_min:o<t.x_min?o:t.x_min,x_max:o>t.x_max?o:t.x_max,y_min:s<t.y_min?s:t.y_min,y_max:s>t.y_max?s:t.y_max}),{x_min:100,x_max:-100,y_min:100,y_max:-100});return{x:m.x_min+(m.x_max-m.x_min)/2,y:m.y_min+(m.y_max-m.y_min)/2}}var J=c(8372),F=c(3740),ce=c(9189),ee=c(8584),N=c(9193),M=c(5222),Q=c(2413),I=c(9185),q=c(7927),xe=c(3863),Qe=c(8480),V=c(9347),qe=c(8668),je=c(8442),Ve=c(9590),He=c(576);function Ke(n,m){if(1&n&&(e.TgZ(0,"div",7)(1,"div",13)(2,"label"),e._uU(3,"Resource:"),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(5),e.hij(" ",t.resource.name||t.resource.map_id||"Unknown Resource"," ")}}function We(n,m){1&n&&(e.TgZ(0,"div",7)(1,"div",8)(2,"label"),e._uU(3,"Host"),e.qZA(),e._UZ(4,"a-user-search-field",15),e.qZA()())}const et=()=>({standalone:!0});function tt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"main",5),e.YNc(1,Ke,6,1,"div",6)(2,We,5,0,"div",6),e.TgZ(3,"div",7)(4,"div",8)(5,"label"),e._uU(6,"Date"),e.qZA(),e.TgZ(7,"a-date-field",9),e._uU(8," Date and time must be in the future "),e.qZA()()(),e.TgZ(9,"div",7)(10,"div",10)(11,"label"),e._uU(12,"Start Time"),e.qZA(),e.TgZ(13,"a-time-field",11),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.form.patchValue({date:s}))}),e.qZA()(),e.TgZ(14,"div",10)(15,"label"),e._uU(16,"End Time"),e.qZA(),e._UZ(17,"a-duration-field",12),e.qZA()()()}if(2&n){const t=e.oxw();let o;e.Q6J("formGroup",t.form),e.xp6(),e.Q6J("ngIf",t.resource),e.xp6(),e.Q6J("ngIf",t.host),e.xp6(5),e.Q6J("to",t.book_until),e.xp6(6),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(12,et))("use_24hr",t.use_24hr_time),e.xp6(4),e.Q6J("time",null==(o=t.form.get("date"))?null:o.value)("max",600)("min",60)("step",60)("use_24hr",t.use_24hr_time)}}let _e=(()=>{class n{get use_24hr_time(){return this._settings.get("app.use_24_hour_time")}constructor(t,o){this._data=t,this._settings=o,this.host=this._data.host,this.form=new v.cw({user:new v.NI(this._data.user),date:new v.NI(this._data.date),duration:new v.NI(this._data.duration)}),this.book_until=this._data.until,this.resource=this._data.resource}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(V.WI),e.Y36(h.gb))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-base-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModel","ngModelOptions","use_24hr","ngModelChange"],["formControlName","duration",3,"time","max","min","step","use_24hr"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4","mb-2"],[1,"px-4","py-3","border","border-base-200","rounded","w-full","mb-4"],["formControlName","user"]],template:function(o,s){1&o&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2,"Set date and time"),e.qZA(),e.TgZ(3,"button",1)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.YNc(6,tt,18,13,"main",2),e.TgZ(7,"footer",3)(8,"button",4),e._uU(9," Continue "),e.qZA()()),2&o&&(e.xp6(6),e.Q6J("ngIf",s.form),e.xp6(2),e.Q6J("mat-dialog-close",s.form.value))},dependencies:[E.O5,j.o,$.wG,V.ZT,v.JJ,v.JL,v.On,v.sg,v.u,qe.Q,je.B,Ve.N,He.d]})}return n})();var pe=c(141),st=c(303),ot=c(6278),de=c(1674);const nt=["explore-device-info",""];function it(n,m){if(1&n&&(e.TgZ(0,"p",17)(1,"label"),e.SDv(2,18),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.mac," ")}}function at(n,m){if(1&n&&(e.TgZ(0,"p",19)(1,"label"),e.SDv(2,20),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.manufacturer," ")}}function lt(n,m){if(1&n&&(e.TgZ(0,"p",21)(1,"label"),e.SDv(2,22),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.os," ")}}function rt(n,m){if(1&n&&(e.TgZ(0,"p",23)(1,"label"),e.SDv(2,24),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.ssid," ")}}function ct(n,m){if(1&n&&(e.TgZ(0,"p",25)(1,"label"),e.SDv(2,26),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function _t(n,m){if(1&n&&(e.TgZ(0,"p",27)(1,"label"),e.SDv(2,28),e.qZA(),e._uU(3),e.qZA()),2&n){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.user.type," ")}}function pt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"div",6),e.NdJ("mouseleave",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.close())}),e._UZ(1,"div",7),e.TgZ(2,"div",8),e.YNc(3,it,4,1,"p",9),e.TgZ(4,"p")(5,"label"),e.SDv(6,10),e.qZA(),e._uU(7),e.qZA(),e.TgZ(8,"p")(9,"label"),e.SDv(10,11),e.qZA(),e._uU(11),e.qZA(),e.YNc(12,at,4,1,"p",12)(13,lt,4,1,"p",13)(14,rt,4,1,"p",14)(15,ct,4,1,"p",15)(16,_t,4,1,"p",16),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.xp6(4),e.hij(" ",t.variance,"m"),e.xp6(4),e.hij(" ",t.last_seen,""),e.xp6(),e.Q6J("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.xp6(),e.Q6J("ngIf",t.os&&!t.hide_fields.includes("os")),e.xp6(),e.Q6J("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.xp6(),e.Q6J("ngIf",t.username&&!t.hide_fields.includes("username")),e.xp6(),e.Q6J("ngIf",t.user&&!t.hide_fields.includes("user"))}}const dt=[];let ye=(()=>{class n extends h.cx{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||dt}get last_seen(){return(0,st.Z)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,ot.Z)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(t,o,s){super(),this._details=t,this._settings=o,this._element=s,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(t=0){t>10||setTimeout(()=>{const o=this._element.nativeElement.parentElement?.parentElement;if(!o)return this.ngOnInit(++t);const s_y=parseInt(o.style.top,10)/100,s_x=parseInt(o.style.left,10)/100;this.y_pos=s_y>=.5?"bottom":"top",this.x_pos=s_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(i=>this.zoom=i))},200)}loadUser(){var t=this;return(0,y.Z)(function*(){if(t.username)return;const o=(0,T.rTZ)(t._details.system,"LocationServices");if(!o)return;t.username="Loading...";const s=yield o.execute("check_ownership_of",[t.mac]).catch(i=>null);t.username=s&&s.assigned_to?s.assigned_to:""})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(de.u),e.Y36(h.gb),e.Y36(e.SBq))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","explore-device-info",""]],features:[e.qOj],attrs:nt,decls:7,vars:9,consts:()=>{let t,o,s,i,a,l,r,p;return t=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,o=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,s=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,i=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,a=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,l=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,r=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,p=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["name","radius",1,"radius","absolute","center","bg-info","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-neutral","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["dot",""],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"content","backdrop","xPosition","yPosition","hover","mouseenter"],["device_tooltip",""],["name","device-info",1,"w-64","rounded","bg-base-100","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],t,o,["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],s,["type",""],i,["os",""],a,["ssid",""],l,["username",""],r,["user",""],p]},template:function(o,s){if(1&o&&(e._UZ(0,"div",0)(1,"div",1)(2,"div",2,3),e.TgZ(4,"div",4),e.NdJ("mouseenter",function(){return s.loadUser()}),e.qZA(),e.YNc(5,pt,17,8,"ng-template",null,5,e.W1O)),2&o){const i=e.MAs(6);e.Akn("height: "+s.diameter+"%; width: "+s.diameter+"%;"),e.xp6(2),e.Udp("background-color",s.bg_color),e.xp6(2),e.Q6J("content",i)("backdrop",!1)("xPosition",s.x_pos)("yPosition",s.y_pos)("hover",!0)}},dependencies:[E.O5,re.X],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}"]})}return n})();var te=c(5183);let se=(()=>{class n extends h.cx{constructor(t,o,s,i,a){var l;super(),l=this,this._state=t,this._org=o,this._settings=s,this._bookings=i,this._dialog=a,this._in_use=new L.X([]),this._options=new L.X({}),this._presence=new L.X([]),this._signs_of_life=new L.X([]),this._statuses={},this._users={},this._departments={},this._checked_in=new L.X([]),this.booking_rules=this._org.active_building.pipe((0,B.h)(r=>!!r),(0,M.w)(r=>(0,T.rlq)(r.id,"desk_booking_rules").pipe((0,Q.K)(()=>(0,N.of)({details:[]})))),(0,x.U)(r=>r?.details instanceof Array?r.details:[]),(0,I.d)(1)),this.desk_list=this._state.level.pipe((0,X.b)(50),(0,M.w)(r=>(0,T.rlq)(r.id,"desks").pipe((0,Q.K)(()=>(0,N.of)({details:[]})),(0,x.U)(p=>(p?.details instanceof Array?p.details:[]).map(_=>new Qe.n({..._,zone:r}))))),(0,Q.K)(r=>[]),(0,I.d)(1)),this._bind=(0,C.aj)([this._state.level,this._state.options]).pipe((0,X.b)(300),(0,B.h)(([r,{is_public:p}])=>!!r&&!p),(0,q.b)(([r])=>{this._statuses={};const p=this._org.binding("area_management");if(!p)return;let _=(0,T.rTZ)(p,"AreaManagement")?.binding(r.id);_&&(this.subscription("lvl-in_use",_.listen().subscribe(d=>this.processBindingChange(d||{},p))),this.subscription("lvl-in_use_bind",_.bind()))})),this._booking_list=(0,C.aj)([this._options,this._state.level]).pipe((0,B.h)(([r,p])=>(r.use_api||r.date>(0,J.Z)(Date.now()).valueOf())&&!!p),(0,M.w)(([r,p])=>(0,te.F2)({type:"desk",period_start:(0,F.Z)((0,ce.Z)(r.date||Date.now())),period_end:(0,F.Z)((0,J.Z)(r.date||Date.now())),zones:p.id})),(0,X.b)(200),(0,q.b)(r=>{this._in_use.next(r.map(p=>p.asset_id)),this._checked_in.next(r.filter(p=>p.checked_in).map(p=>p.asset_id))}),(0,I.d)(1)),this._state_change=(0,C.aj)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this.booking_rules,this._options]).pipe((0,X.b)(50),(0,x.U)(function(){var r=(0,y.Z)(function*([p,_,d,f,b,u]){l._statuses={};const g=yield l._state.level.pipe((0,ae.q)(1)).toPromise();for(const{id:Z,bookable:w}of p){const O=_.some(D=>Z===D),U=d.some(D=>Z===D),A=b.some(D=>Z===D),S=f.some(D=>Z===D)||O&&l._settings.get("app.desk.auto_checkin"),ne=(0,h.e8)({date:Date.now(),duration:60,host:(0,h.ar)(),resource:{id:Z,zones:[g.parent_id,g.id]}},u)?.hidden;l._statuses[Z]=w&&!ne?O||U||S?U||S?"busy":"pending":A?"signs-of-life":"free":"not-bookable"}l.processDesks(p)});return function(p){return r.apply(this,arguments)}}())),this.init()}init(){var t=this;return(0,y.Z)(function*(){yield t._org.initialised.pipe((0,Y.P)(o=>o)).toPromise(),t.setOptions({enable_booking:!1!==t._settings.get("app.desks.enable_maps")}),t.subscription("bookings",t._booking_list.subscribe()),t.subscription("bind",t._bind.subscribe()),t.subscription("booking_rules",t.booking_rules.subscribe()),t.subscription("changes",t._state_change.subscribe()),t.subscription("desks",t.desk_list.subscribe(o=>t.processDesks(o)))})()}setOptions(t){this._options.next({...this._options.getValue(),...t})}processBindingChange({value:t},o){const s=(t||[]).filter(r=>!["desk","booking"].includes(r.location)),i=(t||[]).filter(r=>"desk"===r.location||"booking"===r.location&&"desk"===r.type);(this._options.getValue().date||Date.now())<=(0,J.Z)(Date.now()).valueOf()&&!this._options.getValue().use_api&&(this._in_use.next(i.filter(r=>"booking"===r.location).map(r=>r.map_id||r.asset_id)),this._checked_in.next(i.filter(r=>"booking"===r.location&&r.checked_in).map(r=>r.map_id||r.asset_id)),this._presence.next(i.filter(r=>r.at_location).map(r=>r.map_id||r.asset_id)),this._signs_of_life.next(i.filter(r=>r.signs_of_life).map(r=>r.map_id||r.asset_id)));const l=this._settings.get("app.department_map")||{};for(const r of i)this._users[r.map_id||r.asset_id]=r.staff_name,this._departments[r.map_id||r.asset_id]=l[r.department]||"";this.processDevices(s,o),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},o=this._settings.get("app.explore.colors")||{};for(const s in this._statuses)this._statuses[s]&&(t[`#${s}`]={fill:o[`desk-${this._statuses[s]}`]||o[`${this._statuses[s]}`]||z.y[`${this._statuses[s]}`]});this._state.setStyles("desks",t)}processDevices(t,o){const s=[];for(const i of t){const a=i.x/i.map_width,l=i.y/i.map_height;s.push({track_id:`device:hover:${a},${l}`,location:{x:i.coordinates_from?.includes("right")?1-a:a,y:i.coordinates_from?.includes("bottom")?1-l:l},content:ye,z_index:20,data:{...i,system:o}})}this._state.setFeatures("devices",s)}processDesks(t){var o=this;const s=[],i=[],a=this._options.getValue();for(const l of t){if(s.push({track_id:`desk:hover:${l.map_id||l.id}`,location:l.id,content:pe.c,full_size:!0,no_scale:!0,data:{id:l.map_id||l.id,map_id:l.name,name:l.name||l.map_id,user:this._users[l.map_id]||l.staff_name,status:this._statuses[l.map_id],department:this._departments[l.map_id]||""},z_index:20}),!l.bookable)continue;let r=!0;const p=function(){var _=(0,y.Z)(function*(){if(!r)return;if("free"!==o._statuses[l.id])return(0,h.cB)(`${l.name||"Desk"} is unavailable at this time.`);if(l.groups?.length&&!l.groups.find(g=>(0,h.ar)().groups.includes(g)))return(0,h.cB)(`You are not allowed to book ${l.name}.`);o._bookings.newForm(),o._bookings.setOptions({type:"desk"}),a.date&&(o._bookings.form.patchValue({date:a.date}),o._bookings.form.patchValue({all_day:!!a.all_day}));let{date:d,duration:f,user:b}=yield o._setBookingTime(o._bookings.form.value.date,o._bookings.form.value.duration,o._options.getValue()?.custom??!1,l);b=b||a.host||(0,h.ar)();const u=b?.email;o._bookings.form.patchValue({resources:[l],asset_id:l.id,asset_name:l.name,date:d,duration:a.all_day?720:f,map_id:l?.map_id||l?.id,description:l.name,user:b,user_email:u,booking_type:"desk",zones:l.zone?[l.zone?.parent_id,l.zone?.id]:[]}),yield o._bookings.confirmPost().catch(g=>{throw console.log(g),(0,h.cB)(`Failed to book desk ${l.name||l.id}. ${g.message||g.error||g}`),g}),o._users[l.map_id]=(a.host||(0,h.ar)())?.name,(0,h.t5)(`Successfully booked desk ${l.name||l.id}`)});return function(){return _.apply(this,arguments)}}();["mousedown","touchstart"].forEach(_=>i.push({id:l.id,action:_,priority:10,callback:()=>{r=!0,this.timeout("booking",()=>r=!1)}})),["mouseup","touchend"].forEach(_=>i.push({id:l.id,action:_,priority:10,callback:p}))}this._state.setActions("desks",this._options.getValue().enable_booking?i:[]),this._state.setFeatures("desks",s),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(t,o,s=!1,i=null){var a=this;return(0,y.Z)(function*(){let l=null;if(a._settings.get("app.desks.allow_time_changes")){const r=(0,J.Z)((0,ee.Z)(Date.now(),a._settings.get("app.desks.available_period")||90)),_=yield a._dialog.open(_e,{data:{date:t,duration:o,until:r,host:s,resource:i}}).afterClosed().toPromise();if(!_)throw"User cancelled";t=_.date,o=_.duration,l=_.user}return{date:t,duration:o,user:l}})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(R.c),e.LFG(G.w),e.LFG(h.gb),e.LFG(xe.f),e.LFG(V.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();var Ee=c(4732),ut=c(6446),mt=c(3166),ht=c(7504);let oe=(()=>{class n extends h.cx{constructor(t,o,s,i,a){super(),this._org=t,this._state=o,this._settings=s,this._bookings=i,this._dialog=a,this._options=new L.X({}),this._poll=new L.X(0),this.options=this._options.asObservable(),this.levels=this._org.active_levels.pipe((0,x.U)(l=>l.filter(r=>r.tags.includes("parking")))),this.events=(0,C.aj)([this._org.active_building,this._options,this._poll,this._state.options]).pipe((0,M.w)(([l,r,p,{is_public:_}])=>_?(0,N.of)([]):(0,te.F2)({period_start:(0,F.Z)((0,Ee.Z)(r.date||Date.now())),period_end:(0,F.Z)((0,ut.Z)(r.date||Date.now())),type:"parking",zones:l?.id})),(0,I.d)(1)),this.existing_event=(0,C.aj)([this._options]).pipe((0,M.w)(([l])=>(0,te.F2)({period_start:(0,F.Z)((0,ce.Z)(l.date||Date.now())),period_end:(0,F.Z)((0,J.Z)(l.date||Date.now())),type:"parking",email:l?.user||(0,h.ar)()?.email})),(0,I.d)(1)),this.week_events=(0,C.aj)([this._org.active_building,this._options]).pipe((0,M.w)(([l,r])=>(0,te.F2)({period_start:(0,F.Z)((0,ce.Z)(r.date||Date.now())),period_end:(0,F.Z)((0,ee.Z)((0,J.Z)(r.date||Date.now()),6)),type:"parking",zones:l?.id})),(0,I.d)(1)),this.spaces=this.levels.pipe((0,M.w)(l=>(0,ht.D)(l.map(r=>(0,T.rlq)(r.id,"parking-spaces").pipe((0,x.U)(p=>(p.details instanceof Array?p.details:[]).map(_=>({..._,zone_id:r.id}))))))),(0,x.U)(l=>(0,h.xH)(l)),(0,I.d)(1)),this.active_spaces=(0,C.aj)([this.spaces,this._state.level]).pipe((0,x.U)(([l,r])=>l.filter(p=>p.zone_id===r.id))),this._users={},this.available_spaces=(0,C.aj)([this.events,this.active_spaces]).pipe((0,x.U)(([l,r])=>r.filter(p=>{const _=l.find(d=>d.asset_id===p.id)?.user_name||p.assigned_to;return this._users[p.id]=_,!_}))),this.week_availablility=(0,C.aj)([this.week_events,this.spaces,this._options]).pipe((0,x.U)(([l,r,{date:p}])=>{const _={};for(let d=0;d<7;d++){const f=(0,ee.Z)(p,d),b=l.filter(u=>(0,mt.Z)(f,u.date));_[f.valueOf()]=r.filter(u=>!b.find(g=>g.asset_id===u.id)).length}return _})),this.subscription("spaces",(0,C.aj)([this.spaces,this.available_spaces]).subscribe(([l,r])=>this._updateParkingSpaces(l,r))),this.setOptions({enable_booking:!1!==this._settings.get("app.parking.enable_maps")}),this.interval("poll",()=>this._poll.next(Date.now()),1e4)}setOptions(t){this._options.next({...this._options.getValue(),...t})}_updateParkingSpaces(t,o){var s=this;const i={},a=[],l=[],r=[],p=this._settings.get("app.explore.colors")||{},_=this._options.getValue();for(const d of t){const f=!!o.find(g=>g.id===d.id),b=f?"free":"busy";if(i[`#${d.map_id}`]={fill:p[`parking-${b}`]||p[`${b}`]||z.y[`${b}`],opacity:.6},a.push({track_id:`parking:hover:${d.map_id}`,location:`${d.map_id}`,content:pe.c,full_size:!0,no_scale:!0,z_index:20,data:{...d,user:this._users[d.id],status:b}}),!f)continue;l.push({zoom_level:1.1,location:`${d.map_id}`,content:`${d.name}\nFree`});const u=function(){var g=(0,y.Z)(function*(){if("free"!==b)return(0,h.cB)(`${d.name||"Parking Space"} is unavailable at this time.`);if(d.groups?.length&&!d.groups.find(S=>(0,h.ar)().groups.includes(S)))return(0,h.cB)(`You are not allowed to book ${d.name}.`);s._bookings.newForm(),s._bookings.setOptions({type:"parking"}),_.date&&(s._bookings.form.patchValue({date:_.date}),s._bookings.form.patchValue({all_day:!!_.all_day}));let{date:Z,duration:w,user:O}=yield s._setBookingTime(s._bookings.form.value.date,s._bookings.form.value.duration,s._options.getValue()?.custom??!1,d);O=O||_.host||(0,h.ar)();const U=O?.email,A=s._state.active_level;s._bookings.form.patchValue({resources:[d],asset_id:d.id,asset_name:d.name,date:Z,duration:_.all_day?720:w,map_id:d?.map_id||d?.id,description:d.name,user:O,user_email:U,booking_type:"parking",zones:d.zone?[d.zone?.parent_id,d.zone?.id]:[A.parent_id,A.id]}),yield s._bookings.confirmPost().catch(S=>{throw console.log(S),(0,h.cB)(`Failed to book parking space ${d.name||d.id}. ${S.message||S.error||S}`),S}),(0,h.t5)(`Successfully booked parking space ${d.name||d.id}`)});return function(){return g.apply(this,arguments)}}();r.push({id:d?.map_id||d?.id,action:"click",priority:10,callback:u})}this._state.setActions("parking",_.enable_booking?r:[]),this._state.setStyles("parking",i),this._state.setLabels("parking",l)}_setBookingTime(t,o,s=!1,i=null){var a=this;return(0,y.Z)(function*(){let l=null;if(a._settings.get("app.parking.allow_time_changes")){const r=(0,J.Z)((0,ee.Z)(Date.now(),a._settings.get("app.parking.available_period")||90)),_=yield a._dialog.open(_e,{data:{date:t,duration:o,until:r,host:s,resource:i}}).afterClosed().toPromise();if(!_)throw"User cancelled";t=_.date,o=_.duration,l=_.user}return{date:t,duration:o,user:l}})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(G.w),e.LFG(R.c),e.LFG(h.gb),e.LFG(xe.f),e.LFG(V.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac})}return n})();c(1635);var ue=c(3121);c(4620),c(9253);var Zt=c(3362),Ot=c(8675);let Lt=(()=>{class n{constructor(t,o,s){this._org=t,this._settings=o,this._maps_people=s,this._emergency_contacts=new L.X([]),this._filter=new L.X(""),this._loading=new L.X(!1),this.emergency_contacts=this._emergency_contacts.asObservable(),this._role_assigned_contacts=this._org.active_building.pipe((0,B.h)(i=>!!i),(0,M.w)(i=>(0,T.rlq)(i.id,"emergency_contacts")),(0,x.U)(({details:i})=>i?.contacts||[]),(0,I.d)(1)),this._user_search=this._filter.pipe((0,X.b)(400),(0,q.b)(()=>this._loading.next(!0)),(0,M.w)(i=>i?.length>2?this.search_fn(i).pipe((0,Q.K)(()=>(0,N.of)([]))):(0,N.of)([])),(0,I.d)(1)),this._space_search=this._filter.pipe((0,X.b)(400),(0,q.b)(()=>this._loading.next(!0)),(0,M.w)(i=>i?.length>2?(0,T.vIL)({q:i,zone_id:this._org.organisation.id}).pipe((0,x.U)(({data:a})=>a.filter(l=>l.map_id).map(l=>new Zt.T({...l,level:this._org.levelWithID(l.zones)})))):(0,N.of)([])),(0,Q.K)(()=>[])),this._maps_people_search=(0,C.aj)([this._maps_people.available$,this._filter,this._org.active_building]).pipe((0,X.b)(1e3),(0,M.w)(([i,a])=>i&&a.length>2?mapsindoors?.services.LocationsService.getLocations({q:a}):(0,N.of)([])),(0,x.U)(i=>i.map(a=>({id:a.properties?.externalId||a.properties?.roomId||a.roomId||a.id,map_id:a.properties?.externalId||a.properties?.roomId||a.roomId||"",type:"feature",name:a.properties?.name||"",description:`${a.properties?.roomId} , Level ${a.properties?.floorName}`}))),(0,I.d)(1)),this._points_of_interest=this._org.active_building.pipe((0,B.h)(i=>!!i),(0,M.w)(()=>(0,T.BW_)(this._org.building.id,{name:"maps_features"}).pipe((0,Q.K)(()=>(0,N.of)({details:[]})))),(0,x.U)(i=>{const a=[];for(const l of i){const r=l.metadata.points_of_interest;if(r)for(const p of r.details)a.push({id:p.id,type:"feature",name:p.name,description:"",zone:l.zone})}return a})),this.search_results=(0,C.aj)([this._filter,this._space_search,this._user_search,this._emergency_contacts,this._role_assigned_contacts,this._points_of_interest,this._maps_people_search]).pipe((0,x.U)(([i,a,l,r,p,_,d])=>{const f=i.toLowerCase(),b=[...d,...a.filter(u=>u.email.toLowerCase().includes(f)||u.name.toLowerCase().includes(f)||u.display_name.toLowerCase().includes(f)).map(u=>({id:u.id,type:"space",name:u.display_name||u.name,description:`Capacity: ${u.capacity} `})),...(0,h.xH)(p.map(u=>u.roles.map(g=>({id:u.email,type:g||"contact",is_role:!0,name:u.name,description:u.email})))).filter(u=>u.name.toLowerCase().includes(f)||u.description.toLowerCase().includes(f)||u.type.toLowerCase().includes(f)),...r.map(u=>({id:u.email,type:u.type||"contact",is_role:!0,name:u.name,description:u.email})).filter(u=>u.name.toLowerCase().includes(f)||u.description.toLowerCase().includes(f)||u.type.toLowerCase().includes(f)),...l.map(u=>({id:u.email,type:"user",name:u.name,description:u.email})),..._.filter(u=>u.name.toLowerCase().includes(f)).map(u=>({id:u.id,type:"feature",name:u.name,description:"",zone:u.zone?.id}))];return b.sort((u,g)=>u.name.localeCompare(g.name)),b}),(0,q.b)(()=>this._loading.next(!1)),(0,I.d)(1)),this.loading=this._loading.asObservable(),this.search_fn=i=>this._settings.get("app.basic_user_search")?(0,T.E4d)({q:i,authority_id:(0,T.N9E)()?.id}).pipe((0,x.U)(a=>a.data)):(0,Ot.VE)(i),this.search_results.subscribe(),this.init()}init(){var t=this;return(0,y.Z)(function*(){yield t._org.initialised.pipe((0,Y.P)(s=>s)).toPromise();const o=(0,ue.as)(t._org.binding("location_services"),"LocationServices");if(o){const s=o.binding("emergency_contacts");s.listen().subscribe(i=>{const a=[];for(const l in i)for(const r of i[l])a.push({...r,type:l});t._emergency_contacts.next(a)}),s.bind()}})()}setFilter(t){this._filter.next(t)}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(G.w),e.LFG(h.gb),e.LFG(h.sF))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Mt=c(7147),me=c(4630),wt=c(5940);const St=["input"],It=["button"];function At(n,m){1&n&&e._UZ(0,"mat-spinner",9),2&n&&e.Q6J("diameter",32)}function kt(n,m){1&n&&(e.TgZ(0,"mat-option",12),e.SDv(1,13),e.qZA())}function Nt(n,m){if(1&n&&(e.TgZ(0,"mat-option",14)(1,"div",15)(2,"div",16)(3,"div",17),e._uU(4),e.qZA(),e.TgZ(5,"div",18),e._uU(6),e.qZA()(),e.TgZ(7,"div",19),e._uU(8),e.qZA()()()),2&n){const t=m.$implicit;e.Q6J("value",t),e.xp6(4),e.Oqu(t.name),e.xp6(2),e.Oqu(t.description),e.xp6(2),e.hij(" ",t.type," ")}}function Pt(n,m){if(1&n&&(e.ynx(0),e.YNc(1,kt,2,0,"mat-option",10),e.ALo(2,"async"),e.YNc(3,Nt,9,4,"mat-option",11),e.ALo(4,"slice"),e.ALo(5,"async"),e.BQk()),2&n){const t=e.oxw();let o;e.xp6(),e.Q6J("ngIf",!(null!=(o=e.lcZ(2,2,t.results))&&o.length)),e.xp6(2),e.Q6J("ngForOf",e.Dn7(4,4,e.lcZ(5,8,t.results),0,5))}}let Ze=(()=>{class n extends h.cx{checkClick(t){this._el?.nativeElement?.contains(t.target)||(this.show=!1,this._input_el?.nativeElement?.blur())}constructor(t,o,s,i){super(),this._el=t,this._search=o,this._router=s,this._route=i,this.show=!1,this.search_str="",this.right_size=!1,this.results=this._search.search_results,this.loading=this._search.loading,this.setFilter=a=>this._search.setFilter(a),this.setItem=a=>a instanceof Object?this.select(a):this.setFilter(a),this.onTouch=a=>this.checkClick(a)}ngOnInit(){this.checkButtonPosition()}focusInput(){this._input_el?.nativeElement&&this.timeout("focus",()=>this._input_el.nativeElement.focus(),300)}showSearch(){this.show=!0,this.focusInput()}closeSearch(t){this.show=!1,this.search_str="",this.setFilter(""),this._input_el?.nativeElement&&(this._input_el.nativeElement.focus(),this._input_el.nativeElement.blur())}select(t){this.search_str=t.name;const o={};o["space"===t.type?"space":"feature"===t.type?"feature":"user"]=t.id,this._router.navigate([],{relativeTo:this._route,queryParams:o})}checkButtonPosition(){const t=window.innerWidth,o=this._button_el.nativeElement.getBoundingClientRect();this.right_size=o.left+o.width/2>t/2}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(e.SBq),e.Y36(Lt),e.Y36(k.F0),e.Y36(k.gz))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["explore-search"]],viewQuery:function(o,s){if(1&o&&(e.Gf(St,5),e.Gf(It,7)),2&o){let i;e.iGM(i=e.CRH())&&(s._input_el=i.first),e.iGM(i=e.CRH())&&(s._button_el=i.first)}},hostBindings:function(o,s){1&o&&e.NdJ("click",function(a){return s.checkClick(a)},!1,e.evT)("touchstart",function(a){return s.onTouch(a)},!1,e.evT)},features:[e.qOj],decls:14,vars:20,consts:()=>{let t,o;return t=$localize`:␟7a428104a6c33787961fda306f9c518f89fb0261␟6939663044582448373:Search for...`,o=$localize`:␟0c720c4e60410fcfcd8582a32297bdd397620830␟3411517965707112535: No matches found `,[["icon","","matRipple","",1,"bg-base-200","m-2",3,"resize","click"],["button",""],["role","search","tabindex","0","matRipple","","matAutocompleteOrigin","",1,"absolute","top-1/2","-translate-y-1/2","bg-base-100","flex","items-center","z-10","overflow-hidden","outline-none","px-4","max-w-[calc(100vw-7rem)]",3,"click"],["origin","matAutocompleteOrigin"],["keyboard","","placeholder",t,1,"flex-1","text-base","border-none","outline-none",3,"ngModel","matAutocomplete","matAutocompleteConnectedTo","ngModelChange","blur"],["input",""],["class","mr-2",3,"diameter",4,"ngIf"],["auto","matAutocomplete"],[4,"ngIf"],[1,"mr-2",3,"diameter"],["class","pointer-events-none",4,"ngIf"],[3,"value",4,"ngFor","ngForOf"],[1,"pointer-events-none"],o,[3,"value"],[1,"flex","items-center","leading-tight","w-[22rem]","max-w-[calc(100vw-2rem)]"],[1,"flex-1","w-1/2","overflow-hidden"],[1,"truncate","w-full"],[1,"text-xs"],[1,"text-xs","font-bold","p-2","capitalize","text-white","bg-base-300","rounded"]]},template:function(o,s){if(1&o&&(e.TgZ(0,"button",0,1),e.NdJ("resize",function(){return s.checkButtonPosition()},!1,e.Jf7)("click",function(a){return s.show?s.closeSearch(a):s.showSearch()}),e.TgZ(2,"app-icon"),e._uU(3),e.qZA()(),e.TgZ(4,"div",2,3),e.NdJ("click",function(){return s.focusInput()}),e.TgZ(6,"input",4,5),e.NdJ("ngModelChange",function(a){return s.search_str=a})("ngModelChange",function(a){return s.setItem(a)})("blur",function(){return s.show=!!s.search_str}),e.qZA(),e.YNc(8,At,1,1,"mat-spinner",6),e.ALo(9,"async"),e.qZA(),e.TgZ(10,"mat-autocomplete",null,7),e.YNc(12,Pt,6,10,"ng-container",8),e.ALo(13,"async"),e.qZA()),2&o){const i=e.MAs(5),a=e.MAs(11);e.xp6(3),e.Oqu(s.show||s.search_str?"close":"search"),e.xp6(),e.ekj("right-0",s.right_size)("-translate-x-14",s.right_size)("left-0",!s.right_size)("translate-x-14",!s.right_size)("show",s.show||s.search_str),e.xp6(2),e.Q6J("ngModel",s.search_str)("matAutocomplete",a)("matAutocompleteConnectedTo",i),e.xp6(2),e.Q6J("ngIf",e.lcZ(9,16,s.loading)),e.xp6(4),e.Q6J("ngIf",!0!==e.lcZ(13,18,s.loading)&&(s.show||s.search_str))}},dependencies:[E.sg,E.O5,j.o,Mt.U,me.XC,$.ey,me.ZL,me.BU,$.wG,wt.Ou,v.Fj,v.JJ,v.On,E.Ov,E.OU],styles:["[_nghost-%COMP%]{z-index:99;position:relative}[role=search][_ngcontent-%COMP%]{height:3rem;width:0;border-radius:1.5rem;border:1px solid var(--b3);transition:width .2s opacity .2s;opacity:0;pointer-events:none}[role=search].show[_ngcontent-%COMP%]{width:24rem;opacity:1;pointer-events:auto}"]})}return n})();c(6967),c(2596),c(2182),c(6687),c(151);let Bt=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#s=this.\u0275inj=e.cJS({imports:[E.ez,P.Kk,v.u5,v.UX,ie.rP,we.U8,Se.eL,Ie.W,Ae.E]})}return n})();var Oe=c(7049),Jt=c(7178),he=c(7988),Le=c(2202);function Dt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"div",3)(1,"div",4),e._uU(2,"A"),e.qZA(),e.TgZ(3,"mat-slider",5)(4,"input",6),e.NdJ("ngModelChange",function(s){e.CHM(t);const i=e.oxw();return e.KtG(i.applySetting("font_size",s))}),e.qZA()(),e.TgZ(5,"div",7),e._uU(6,"A"),e.qZA(),e.TgZ(7,"div",8),e._uU(8),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("min",10)("max",24)("step",2),e.xp6(),e.Q6J("ngModel",t.font_size),e.xp6(4),e.hij(" ",t.font_size,"px ")}}let Yt=(()=>{class n extends h.cx{constructor(t){super(),this._settings=t,this.applySetting=(o,s)=>this.timeout("apply_setting",()=>this._settings.saveUserSetting(o,s),1e3)}get dark_mode(){return"dark"===this._settings.get("theme")}get can_change_dark_mode(){return!!this._settings.get("app.general.dark_mode")}get accessible(){return!!this._settings.get("accessible")}get font_size(){return this._settings.get("font_size")||16}setDarkMode(t){this.timeout("dark_mode",()=>{const o=this._settings.get("theme");t&&"dark"!==o?this._settings.setTheme("dark"):!t&&"dark"===o&&this._settings.setTheme("light")},100)}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(h.gb))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["accessibility-controls"]],features:[e.qOj],decls:9,vars:3,consts:[["matRipple","",1,"flex","items-center","justify-between","hover:bg-base-200","w-full","p-2","rounded",3,"click"],[3,"ngModel","ngModelChange"],["class","flex items-center pl-2 space-x-4",4,"ngIf"],[1,"flex","items-center","pl-2","space-x-4"],[1,"text-sm"],[1,"flex-1","w-px","min-w-0","text-[16px]",3,"min","max","step"],["matSliderThumb","",1,"text-[16px]",3,"ngModel","ngModelChange"],[1,"text-2xl"],[1,"text-base","py-1","px-2","rounded","bg-base-300","text-base-content","my-2"]],template:function(o,s){1&o&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return s.setDarkMode(!s.dark_mode)}),e.TgZ(1,"div"),e._uU(2,"Dark Mode"),e.qZA(),e.TgZ(3,"mat-slide-toggle",1),e.NdJ("ngModelChange",function(a){return s.setDarkMode(a)}),e.qZA()(),e.TgZ(4,"button",0),e.NdJ("click",function(){return s.applySetting("accessible",!s.accessible)}),e.TgZ(5,"div"),e._uU(6,"Text Size"),e.qZA(),e.TgZ(7,"mat-slide-toggle",1),e.NdJ("ngModelChange",function(a){return s.applySetting("accessible",a)}),e.qZA()(),e.YNc(8,Dt,9,5,"div",2)),2&o&&(e.xp6(3),e.Q6J("ngModel",s.dark_mode),e.xp6(4),e.Q6J("ngModel",s.accessible),e.xp6(),e.Q6J("ngIf",s.accessible))},dependencies:[E.O5,$.wG,Le.pH,Le.$5,ie.Rr,v.Fj,v.JJ,v.On]})}return n})();const Gt=["app-explore",""];function Qt(n,m){1&n&&e._UZ(0,"explore-search")}function qt(n,m){1&n&&(e.TgZ(0,"div",16),e._UZ(1,"accessibility-controls"),e.qZA())}function jt(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",21),e.NdJ("click",function(){const i=e.CHM(t).$implicit,a=e.oxw(3);return e.KtG(a.setLevel(i))}),e._uU(1),e.qZA()}if(2&n){const t=m.$implicit;e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function Vt(n,m){if(1&n&&(e.ynx(0),e.TgZ(1,"button",18)(2,"div",10),e._uU(3,"Level"),e.qZA(),e.TgZ(4,"app-icon",1),e._uU(5,"keyboard_arrow_down"),e.qZA()(),e.TgZ(6,"mat-menu",null,19),e.YNc(8,jt,2,1,"button",20),e.ALo(9,"async"),e.qZA(),e.BQk()),2&n){const t=e.MAs(7),o=e.oxw(2);e.xp6(),e.Q6J("matMenuTriggerFor",t),e.xp6(7),e.Q6J("ngForOf",e.lcZ(9,2,o.levels))}}function Ht(n,m){if(1&n&&(e.TgZ(0,"div",24),e._UZ(1,"div",25),e.TgZ(2,"div",26),e._uU(3),e.qZA()()),2&n){const t=m.$implicit;e.xp6(),e.Udp("background-color",t.color),e.xp6(2),e.hij(" ",t.name," ")}}function Kt(n,m){if(1&n&&(e.ynx(0),e.TgZ(1,"button",18)(2,"div",10),e._uU(3,"Legend"),e.qZA(),e.TgZ(4,"app-icon",1),e._uU(5,"keyboard_arrow_down"),e.qZA()(),e.TgZ(6,"mat-menu",null,22),e.YNc(8,Ht,4,3,"div",23),e.qZA(),e.BQk()),2&n){const t=e.MAs(7),o=e.oxw(2);e.xp6(),e.Q6J("matMenuTriggerFor",t),e.xp6(7),e.Q6J("ngForOf",o.legend)}}function Wt(n,m){if(1&n&&(e.ynx(0),e.TgZ(1,"div",17),e.YNc(2,Vt,10,4,"ng-container",4),e.ALo(3,"async"),e.YNc(4,Kt,9,2,"ng-container",4),e.qZA(),e.BQk()),2&n){const t=e.oxw();let o;e.xp6(2),e.Q6J("ngIf",null==(o=e.lcZ(3,2,t.levels))?null:o.length),e.xp6(2),e.Q6J("ngIf",t.legend.length)}}function es(n,m){if(1&n){const t=e.EpF();e.TgZ(0,"button",28),e.NdJ("click",function(){const i=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.setLevel(i))}),e.ALo(1,"async"),e.TgZ(2,"div",29),e._uU(3),e.qZA()()}if(2&n){const t=m.$implicit,o=e.oxw(2);let s;e.ekj("opacity-30",t.id!==(null==(s=e.lcZ(1,3,o.level))?null:s.id)),e.xp6(3),e.hij(" ",t.display_name||t.name," ")}}function ts(n,m){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.show_levels=!s.show_levels)}),e.TgZ(2,"app-icon",1),e._uU(3,"corporate_fare"),e.qZA(),e.TgZ(4,"div",10),e._uU(5,"Level"),e.qZA(),e.TgZ(6,"app-icon",1),e._uU(7),e.qZA()(),e.TgZ(8,"div",11)(9,"div",12),e.YNc(10,es,4,5,"button",27),e.ALo(11,"async"),e.qZA()(),e._UZ(12,"hr",13),e.BQk()}if(2&n){const t=e.oxw();e.xp6(7),e.Oqu(t.show_levels?"keyboard_arrow_up":"keyboard_arrow_down"),e.xp6(),e.Q6J("@show",t.show_levels?"show":"hide"),e.xp6(2),e.Q6J("ngForOf",e.lcZ(11,3,t.levels))}}function ss(n,m){if(1&n&&(e.TgZ(0,"div",24),e._UZ(1,"div",25),e.TgZ(2,"div",26),e._uU(3),e.qZA()()),2&n){const t=m.$implicit;e.xp6(),e.Udp("background-color",t.color),e.xp6(2),e.hij(" ",t.name," ")}}function os(n,m){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"button",9),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.show_legend=!s.show_legend)}),e.TgZ(2,"app-icon",1),e._uU(3,"place"),e.qZA(),e.TgZ(4,"div",10),e._uU(5,"Legend"),e.qZA(),e.TgZ(6,"app-icon",1),e._uU(7),e.qZA()(),e.TgZ(8,"div",11)(9,"div",12),e.YNc(10,ss,4,3,"div",23),e.qZA()(),e._UZ(11,"hr",13),e.BQk()}if(2&n){const t=e.oxw();e.xp6(7),e.Oqu(t.show_legend?"keyboard_arrow_up":"keyboard_arrow_down"),e.xp6(),e.Q6J("@show",t.show_legend?"show":"hide"),e.xp6(2),e.Q6J("ngForOf",t.legend)}}const ns=()=>({controls:!0});let Me=(()=>{class n extends h.cx{get logo(){return"dark"===this._settings.get("theme")?this._settings.get("app.logo_dark"):this._settings.get("app.logo_light")}get time(){return(0,Ee.Z)(Date.now())}get hide_zones(){return this._settings.get("app.hide_zones")}updateZoom(t){this._state.setPositions(t,this._state.positions.center)}updateCenter(t){this._state.setPositions(this._state.positions.zoom,t)}toggleZones(t){var o=this;return(0,y.Z)(function*(){const s=yield o.options.pipe((0,ae.q)(1)).toPromise(),i=t?s.disable.filter(a=>"zones"!==a&&"devices"!==a)||[]:(0,h.Tw)([...s.disable||[],"zones","devices"]);o.setOptions({disable:i})})()}get can_search(){return!!this._settings.get("app.explore.search_enabled")}constructor(t,o,s,i,a,l,r,p,_,d,f,b,u){super(),this._state=t,this._s=o,this._desks=s,this._zones=i,this._parking=a,this._settings=l,this._org=r,this._spaces=p,this._dialog=_,this._route=d,this._router=f,this._space_pipe=b,this._maps=u,this.reset_delay=180,this.show_levels=!0,this.show_legend=!1,this.show_accessibility=!1,this.legend=[{id:"free",name:"Space Available",color:"#43a047"},{id:"busy",name:"Space In Use",color:"#e53935"},{id:"pending",name:"Space Pending",color:"#ffb300"},{id:"not-bookable",name:"Space Not-bookable",color:"#ccc"}],this.levels=(0,C.aj)([this._org.active_region,this._org.active_building]).pipe((0,x.U)(([g,Z])=>(this._settings.get("app.use_region")?(0,h.xH)(this._org.buildings.filter(w=>g.id===w.parent_id).map(w=>this._org.levelsForBuilding(w).map(O=>({...O,display_name:`${w.display_name} - ${O.display_name}`})))):this._org.levelsForBuilding(Z))||[]),(0,q.b)(g=>console.log("Levels:",g))),this.level=this._state.level,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options,this.locate="",this.onMouse=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.onTouch=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.setOptions=g=>this._state.setOptions(g),this.setLevel=g=>this._state.setLevel(g.id),this.use_mapsindoors$=this._maps.available$}ngOnInit(){var t=this;return(0,y.Z)(function*(){(location.hash.includes("public=true")||location.search.includes("public=true"))&&t._state.setOptions({is_public:!0}),yield t._spaces.initialised.pipe((0,Y.P)(o=>o)).toPromise(),t._desks.setOptions({custom:!0}),t.reset_delay=t._settings.get("app.inactivity_timeout_secs")||180,t.resetKiosk(),P.Uk.enabled="true"===localStorage.getItem("OSK.enabled"),t.subscription("level",t._state.level.subscribe(()=>t.timeout("update_location",()=>{t._state.setFeatures("_located",[])}))),t.subscription("route.query",t._route.queryParamMap.subscribe(function(){var o=(0,y.Z)(function*(s){if(s.has("level")&&t._state.setLevel(s.get("level")),t._state.setFeatures("_located",[]),s.has("space"))t.locateSpace(s.get("space"));else if(s.has("user")){let i=t._settings.value("last_search");if((!i||s.get("user")!==i.email)&&(i=null,i=yield(0,H.w0)(s.get("user")).toPromise()),!i)return(0,h.cB)(`Unable to user details for ${s.get("user")}`);t.locateUser(i instanceof Array?i[0]:i).catch(a=>{(0,h.cB)(`Unable to locate ${s.get("user")}`),t._router.navigate([],{relativeTo:t._route,queryParams:{}})})}else s.has("feature")?t.timeout("update_location",()=>{t._state.setFeatures("_located",[{location:s.get("feature"),content:P.qL,data:{}}])}):s.has("locate")?t.locate=s.get("locate"):t.timeout("update_location",()=>{t._state.setFeatures("_located",[])})});return function(s){return o.apply(this,arguments)}}()))})()}locateSpace(t){var o=this;return(0,y.Z)(function*(){const s=yield o._space_pipe.transform(t);if(!s)return;o._state.setLevel(o._org.levelWithID(s.zones)?.id);const i={location:s.map_id,content:P.qL,data:{message:`${s.display_name||s.name} is here`}};o.timeout("update_location",()=>o._state.setFeatures("_located",[i]))})()}locateUser(t){var o=this;return(0,y.Z)(function*(){let s=o._org.binding("location_services");if(!s)return;"string"==typeof s&&(s={system_id:s,module:"LocationServices"});const a=(yield(0,T.rTZ)(s.system_id,s.module).execute("locate_user",[t.email,t.username||t.id])).map(_=>new H.Y(_));if(a.sort((_,d)=>s.priority.indexOf(_.type)-s.priority.indexOf(d.type)),!a?.length)throw"No locations for the given user";o._state.setLevel(o._org.levelWithID([a[0]?.level])?.id);const l=a[0].position,{coordinates_from:r}=a[0],p={location:"wireless"===a[0].type?{x:r?.includes("right")?1-l.x:l.x,y:r?.includes("bottom")?1-l.y:l.y}:l,content:"wireless"===a[0].type?P.nb:P.qL,z_index:99,data:{message:`${t.name} is here`,radius:a[0].variance,last_seen:a[0].last_seen}};o.timeout("update_location",()=>{o._state.setFeatures("_located",[p])})})()}resetKiosk(){document.activeElement?.blur&&document.activeElement?.blur();const t=localStorage.getItem("KIOSK.level");this._state.setPositions(1,{x:.5,y:.5}),t&&this._state.setLevel(t),this._dialog.closeAll()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(R.c),e.Y36(z.a),e.Y36(se),e.Y36(W),e.Y36(oe),e.Y36(h.gb),e.Y36(ue.w7),e.Y36(Oe.sK),e.Y36(V.uw),e.Y36(k.gz),e.Y36(k.F0),e.Y36(K.X),e.Y36(h.sF))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","app-explore",""]],hostBindings:function(o,s){1&o&&e.NdJ("mousedown",function(){return s.onMouse()},!1,e.Jf7)("touchstart",function(){return s.onTouch()},!1,e.Jf7)},features:[e._Bn([z.a,se,W,oe,K.X]),e.qOj],attrs:Gt,decls:40,vars:37,consts:[["topbar","",1,"relative","flex","items-center","justify-between","p-4","border-b","border-base-300","bg-base-100","text-base-content"],[1,"text-2xl"],[1,"text-primary"],[1,"absolute","top-1/2","-translate-y-1/2","right-2","flex","items-center"],[4,"ngIf"],["icon","","matRipple","","customTooltip","",1,"bg-base-200","flex","sm:hidden",3,"content"],["accessibility_controls",""],[1,"flex","flex-1","h-1/2"],["sidebar","",1,"w-[20rem]","hidden","sm:block","bg-base-100","text-base-content","border-r","border-base-300","px-2","py-4"],["btn","","matRipple","",1,"flex","items","clear","w-full","space-x-4","hover:bg-base-200",3,"click"],[1,"flex-1","text-left","font-medium"],[1,"px-8"],[1,"py-4","space-y-2"],[1,"w-[calc(100%-4rem)]","mx-auto"],[1,"relative","flex-1","h-full"],[3,"src","zoom","center","styles","features","actions","labels","options","focus","zoomChange","centerChange"],[1,"bg-base-100","rounded","p-2","w-[18rem]"],["options","",1,"flex","sm:hidden","items-center","bg-base-content","text-base-100","p-2","space-x-2"],["btn","","matRipple","",1,"clear","text-base-100",3,"matMenuTriggerFor"],["levelMenu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],["legendMenu","matMenu"],["class","flex items-center py-2 px-4 rounded hover:bg-base-200 w-full space-x-4",4,"ngFor","ngForOf"],[1,"flex","items-center","py-2","px-4","rounded","hover:bg-base-200","w-full","space-x-4"],[1,"h-3","w-3","rounded-full"],[1,"text-left","opacity-60"],["btn","","matRipple","","class","clear hover:bg-base-200 hover:opacity-100 w-full",3,"opacity-30","click",4,"ngFor","ngForOf"],["btn","","matRipple","",1,"clear","hover:bg-base-200","hover:opacity-100","w-full",3,"click"],[1,"text-left","w-full"]],template:function(o,s){if(1&o&&(e.TgZ(0,"div",0)(1,"h2",1),e._uU(2,"Place"),e.TgZ(3,"span",2),e._uU(4,"OS"),e.qZA()(),e.TgZ(5,"div",3),e.YNc(6,Qt,1,0,"explore-search",4),e.ALo(7,"async"),e.TgZ(8,"button",5)(9,"app-icon"),e._uU(10,"accessible"),e.qZA()(),e.YNc(11,qt,2,0,"ng-template",null,6,e.W1O),e.qZA()(),e.YNc(13,Wt,5,4,"ng-container",4),e.ALo(14,"async"),e.TgZ(15,"div",7)(16,"div",8),e.YNc(17,ts,13,5,"ng-container",4),e.ALo(18,"async"),e.YNc(19,os,12,3,"ng-container",4),e.TgZ(20,"button",9),e.NdJ("click",function(){return s.show_accessibility=!s.show_accessibility}),e.TgZ(21,"app-icon",1),e._uU(22,"accessible"),e.qZA(),e.TgZ(23,"div",10),e._uU(24," Accessibility "),e.qZA(),e.TgZ(25,"app-icon",1),e._uU(26),e.qZA()(),e.TgZ(27,"div",11)(28,"div",12),e._UZ(29,"accessibility-controls"),e.qZA()(),e._UZ(30,"hr",13),e.qZA(),e.TgZ(31,"div",14)(32,"interactive-map",15),e.NdJ("zoomChange",function(a){return s.updateZoom(a)})("centerChange",function(a){return s.updateCenter(a)}),e.ALo(33,"async"),e.ALo(34,"async"),e.ALo(35,"async"),e.ALo(36,"async"),e.ALo(37,"async"),e.ALo(38,"async"),e.ALo(39,"async"),e.qZA()()()),2&o){const i=e.MAs(12);let a,l,r,p;e.xp6(6),e.Q6J("ngIf",s.can_search&&!e.lcZ(7,16,s.use_mapsindoors$)),e.xp6(2),e.Q6J("content",i),e.xp6(5),e.Q6J("ngIf",(null==(a=e.lcZ(14,18,s.levels))?null:a.length)||s.legend.length),e.xp6(4),e.Q6J("ngIf",null==(l=e.lcZ(18,20,s.levels))?null:l.length),e.xp6(2),e.Q6J("ngIf",s.legend.length),e.xp6(7),e.Oqu(s.show_accessibility?"keyboard_arrow_up":"keyboard_arrow_down"),e.xp6(),e.Q6J("@show",s.show_accessibility?"show":"hide"),e.xp6(5),e.Q6J("src",e.lcZ(33,22,s.url))("zoom",null==(r=e.lcZ(34,24,s.positions))?null:r.zoom)("center",null==(p=e.lcZ(35,26,s.positions))?null:p.center)("styles",e.lcZ(36,28,s.styles))("features",e.lcZ(37,30,s.features))("actions",e.lcZ(38,32,s.actions))("labels",e.lcZ(39,34,s.labels))("options",e.DdM(36,ns))("focus",s.locate)}},dependencies:[E.sg,E.O5,j.o,de.p,re.X,he.VK,he.OP,he.p6,$.wG,Ze,Yt,E.Ov],styles:["[_nghost-%COMP%]{position:absolute;display:flex;flex-direction:column;inset:0;background-color:var(--b2)}hr[_ngcontent-%COMP%]{margin-top:.5rem!important;margin-bottom:.5rem!important}"],data:{animation:[h.X7]}})}return n})();const is=[{path:"",component:Me},{path:":search_type",component:Me}];let as=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#s=this.\u0275inj=e.cJS({imports:[E.ez,k.Bz.forChild(is),P.Kk,Oe.YR,Jt.q,v.u5,Bt]})}return n})()}}]);