{"version":3,"file":"apps_concierge_src_app_building-manager_building-manager_module_ts.js","mappings":"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","names":["i0","region_r9","id","display_name","name","BuildingFormComponent_ng_container_0_form_1_div_1_mat_option_7_Template","ctx_r4","default_parent","region_list","tz_r10","BuildingFormComponent_ng_container_0_form_1_div_1_Template","BuildingFormComponent_ng_container_0_form_1_mat_option_17_Template","BuildingFormComponent_ng_container_0_form_1_mat_option_18_Template","ctx_r3","form","tmp_1_0","length","_r5","filtered_timezones","timezones","BuildingFormComponent_ng_container_0_form_1_Template","ctx_r0","BuildingFormComponent","AsyncHandler","this","_org","organisation","constructor","super","building","save","loading","loadingChange","EventEmitter","done","FormGroup","FormControl","parent_id","Validators","timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","location","ngOnInit","_updateTimezoneList","subscription","valueChanges","subscribe","filter","_","toLowerCase","includes","patchValue","ngOnChanges","changes","saveChanges","_this","_asyncToGenerator","valid","notifyError","getInvalidFields","join","data","getRawValue","emit","body","authority","description","updateZone","addZone","toPromise","catch","e","message","error","notifySuccess","value","TIMEZONES_IANA","t","i1","core","Xpm","selectors","inputs","outputs","features","decls","vars","consts","i18n_0","$localize","BuildingFormComponent_ng_container_0_Template","BuildingFormComponent_ng_template_1_Template","ctx","_r1","_r3","ctx_r2","BuildingModalComponent","_data","_dialog_ref","save_state","close","Date","now","MAT_DIALOG_DATA","template","rf","BuildingModalComponent_button_3_Template","$event","BuildingModalComponent_footer_6_Template","BuildingManagementService","_dialog","_options","BehaviorSubject","_change","options","asObservable","filtered_buildings","combineLatest","building_list","initialised","pipe","map","regions","list","zone","search","bld","parent","find","region","level_count","levelsForBuilding","setFilters","next","getValue","setSearchString","editBuilding","PlaceZone","open","afterClosed","setTimeout","removeBuilding","ref","openConfirmModal","title","content","icon","confirm_text","reason","removeZone","i2","Yz7","factory","Éµfac","providedIn","tmp_0_0","data_r6","data_r7","BuildingListComponent_ng_template_4_img_0_Template","BuildingListComponent_ng_template_4_span_1_Template","row_r11","_r14","row","ctx_r13","ctx_r15","deleteBuilding","_r12","BuildingListComponent","_manager","buildings","BuildingListComponent_ng_template_2_Template","BuildingListComponent_ng_template_4_Template","BuildingListComponent_ng_template_6_Template","_c0","_c1","_c2","_c3","_r2","_r0","_r4","BuildingManagerComponent","_state","newBuilding","attrs","ROUTES","path","component","BuildingManagerModule","oAB","cJS","CommonModule","FormsModule","UIModule","SharedSpacesModule","SharedUsersModule","MatChipsModule","RouterModule"],"sourceRoot":"webpack:///","sources":["./apps/concierge/src/app/building-manager/building-form.component.ts","./apps/concierge/src/app/building-manager/building-modal.component.ts","./apps/concierge/src/app/building-manager/building-management.service.ts","./apps/concierge/src/app/building-manager/building-list.component.ts","./apps/concierge/src/app/building-manager/building-manager.component.ts","./apps/concierge/src/app/building-manager/building-manager.module.ts"],"sourcesContent":["import {\n    Component,\n    EventEmitter,\n    Input,\n    Output,\n    SimpleChanges,\n} from '@angular/core';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport {\n    AsyncHandler,\n    TIMEZONES_IANA,\n    getInvalidFields,\n    notifyError,\n    notifySuccess,\n} from '@placeos/common';\nimport { Building, OrganisationService } from '@placeos/organisation';\nimport { addZone, authority, updateZone } from '@placeos/ts-client';\n\n@Component({\n    selector: 'building-form',\n    template: `\n        <ng-container *ngIf=\"!loading; else load_state\">\n            <form\n                building\n                class=\"flex flex-col w-[36rem] max-w-[calc(100vw-4rem)]\"\n                *ngIf=\"form\"\n                [formGroup]=\"form\"\n            >\n                <div\n                    class=\"flex flex-col\"\n                    *ngIf=\"(region_list | async)?.length\"\n                >\n                    <label for=\"region\" i18n=\"@@displayNameLabel\">\n                        Region:\n                    </label>\n                    <mat-form-field appearance=\"outline\">\n                        <mat-select\n                            name=\"region\"\n                            formControlName=\"parent_id\"\n                            placeholder=\"Select Region...\"\n                        >\n                            <mat-option [value]=\"default_parent\"\n                                >None</mat-option\n                            >\n                            <mat-option\n                                *ngFor=\"let region of region_list | async\"\n                                [value]=\"region.id\"\n                            >\n                                {{ region.display_name || region.name }}\n                            </mat-option>\n                        </mat-select>\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label for=\"display-name\" i18n=\"@@displayNameLabel\">\n                        Display Name:\n                    </label>\n                    <mat-form-field appearance=\"outline\">\n                        <input\n                            matInput\n                            name=\"display-name\"\n                            placeholder=\"Display Name\"\n                            formControlName=\"display_name\"\n                        />\n                    </mat-form-field>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label for=\"display-name\" i18n=\"@@displayNameLabel\">\n                        Timezone:\n                    </label>\n                    <mat-form-field appearance=\"outline\">\n                        <app-icon matPrefix class=\"text-2xl\">search</app-icon>\n                        <input\n                            matInput\n                            formControlName=\"timezone\"\n                            placeholder=\"Building timezone\"\n                            [matAutocomplete]=\"auto\"\n                        />\n                    </mat-form-field>\n                    <mat-autocomplete #auto=\"matAutocomplete\">\n                        <mat-option\n                            *ngFor=\"let tz of filtered_timezones\"\n                            [value]=\"tz\"\n                            >{{ tz }}</mat-option\n                        >\n                        <mat-option *ngIf=\"!timezones.length\" [disabled]=\"true\">\n                            No matching timezones\n                        </mat-option>\n                    </mat-autocomplete>\n                </div>\n                <div class=\"flex flex-col\">\n                    <label for=\"address\" i18n=\"@@displayNameLabel\">\n                        Location:\n                    </label>\n                    <mat-form-field appearance=\"outline\">\n                        <input\n                            matInput\n                            name=\"address\"\n                            placeholder=\"Location or Address...\"\n                            formControlName=\"location\"\n                        />\n                    </mat-form-field>\n                </div>\n            </form>\n        </ng-container>\n        <ng-template #load_state>\n            <div class=\"flex flex-col items-center justify-center w-64 h-64\">\n                <mat-spinner diameter=\"32\"></mat-spinner>\n                <p class=\"mt-4\">Saving building...</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class BuildingFormComponent extends AsyncHandler {\n    @Input() public building: Building | null = null;\n    @Input() public save: number = 0;\n    @Input() public loading = false;\n    @Output() public loadingChange = new EventEmitter<boolean>();\n    @Output() public done = new EventEmitter();\n\n    public timezones: string[] = [];\n    public filtered_timezones: string[] = [];\n\n    public readonly form = new FormGroup({\n        id: new FormControl(''),\n        parent_id: new FormControl(this._org.organisation.id, [\n            Validators.required,\n        ]),\n        display_name: new FormControl('', [Validators.required]),\n        timezone: new FormControl(\n            Intl?.DateTimeFormat()?.resolvedOptions()?.timeZone || ''\n        ),\n        location: new FormControl(''),\n    });\n\n    public get default_parent() {\n        return this._org.organisation.id;\n    }\n\n    constructor(private _org: OrganisationService) {\n        super();\n    }\n\n    public ngOnInit() {\n        this._updateTimezoneList();\n        this.subscription(\n            'tz-change',\n            this.form.valueChanges.subscribe(\n                ({ timezone }) =>\n                    (this.filtered_timezones = this.timezones.filter((_) =>\n                        _.toLowerCase().includes(timezone.toLowerCase())\n                    ))\n            )\n        );\n        if (this.building) this.form.patchValue(this.building);\n    }\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.building && this.building) {\n            this.form.patchValue(this.building);\n        }\n        if (changes.save && this.save) this.saveChanges();\n    }\n\n    public async saveChanges() {\n        if (!this.form.valid) {\n            return notifyError(\n                `Some form fields are invalid. [${getInvalidFields(\n                    this.form\n                ).join(', ')}]`\n            );\n        }\n        const data = this.form.getRawValue();\n        this.loading = true;\n        this.loadingChange.emit(true);\n        const body = {\n            ...data,\n            name: `BLD ${authority().description} ${data.display_name}`,\n        };\n        await (data.id ? updateZone(data.id, body) : addZone(body))\n            .toPromise()\n            .catch((e) => {\n                notifyError(\n                    `Error saving building: ${e.message || e.error || e}`\n                );\n                this.loading = false;\n                this.loadingChange.emit(false);\n                throw e;\n            });\n        notifySuccess('Successfully saved building.');\n        this.loading = false;\n        this.loadingChange.emit(false);\n        this.done.emit();\n    }\n\n    private _updateTimezoneList() {\n        const timezone = this.form?.value?.timezone || '';\n        this.timezones = TIMEZONES_IANA;\n        this.filtered_timezones = this.timezones.filter((_) =>\n            _.toLowerCase().includes(timezone.toLowerCase())\n        );\n    }\n}\n","import { Component, Inject } from '@angular/core';\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { Building } from '@placeos/organisation';\n\n@Component({\n    selector: 'building-modal',\n    template: `\n        <header>\n            <h2>{{ building.id ? 'Edit' : 'Add' }} Building</h2>\n            <button btn icon mat-dialog-close *ngIf=\"!loading\">\n                <app-icon>close</app-icon>\n            </button>\n        </header>\n        <main class=\"max-h-[65vh] overflow-y-auto overflow-x-hidden p-4\">\n            <building-form\n                [building]=\"building\"\n                [save]=\"save_state\"\n                [(loading)]=\"loading\"\n                (done)=\"close()\"\n            ></building-form>\n        </main>\n        <footer\n            class=\"p-2 flex justify-end border-t border-gray-200\"\n            *ngIf=\"!loading\"\n        >\n            <button btn class=\"w-32\" (click)=\"save()\">Save</button>\n        </footer>\n    `,\n    styles: [``],\n})\nexport class BuildingModalComponent {\n    public loading = false;\n    public save_state = 0;\n    public readonly building = this._data;\n\n    public readonly close = () => this._dialog_ref.close();\n    public readonly save = () => (this.save_state = Date.now());\n\n    constructor(\n        @Inject(MAT_DIALOG_DATA) private _data: Building | undefined,\n        private _dialog_ref: MatDialogRef<BuildingModalComponent>\n    ) {}\n}\n","import { Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { notifySuccess, openConfirmModal } from '@placeos/common';\nimport { Building, OrganisationService } from '@placeos/organisation';\nimport { PlaceZone, removeZone } from '@placeos/ts-client';\nimport { BehaviorSubject, combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { BuildingModalComponent } from './building-modal.component';\n\nexport interface BuildingListOptions {\n    zone?: string;\n    search?: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class BuildingManagementService {\n    private _options = new BehaviorSubject<BuildingListOptions>({});\n    private _change = new BehaviorSubject(0);\n\n    public options = this._options.asObservable();\n\n    public readonly filtered_buildings = combineLatest([\n        this._org.region_list,\n        this._org.building_list,\n        this._options,\n        this._org.initialised,\n    ]).pipe(\n        map(([regions, list, options]) => {\n            if (options.zone) {\n                list = list.filter((_) => _.parent_id === options.zone);\n            }\n            if (options.search) {\n                list = list.filter((_) =>\n                    _.name.toLowerCase().includes(options.search.toLowerCase())\n                );\n            }\n            for (const bld of list) {\n                const parent = regions.find((_) => _.id === bld.parent_id);\n                if (parent) {\n                    (bld as any).region = parent.display_name || parent.name;\n                }\n                (bld as any).level_count =\n                    this._org.levelsForBuilding(bld)?.length || 0;\n            }\n            return list;\n        })\n    );\n\n    constructor(\n        private _org: OrganisationService,\n        private _dialog: MatDialog\n    ) {}\n\n    public setFilters(options: Partial<BuildingListOptions>) {\n        this._options.next({ ...this._options.getValue(), ...options });\n    }\n\n    public setSearchString(search: string) {\n        this._options.next({ ...this._options.getValue(), search });\n    }\n\n    public editBuilding(building: PlaceZone = new PlaceZone()) {\n        const ref = this._dialog.open(BuildingModalComponent, {\n            data: building,\n        });\n        ref.afterClosed().subscribe((data) => {\n            if (data) setTimeout(() => this._change.next(Date.now()), 300);\n        });\n    }\n\n    public async removeBuilding(building: Building) {\n        const ref = await openConfirmModal(\n            {\n                title: 'Remove Building',\n                content: `Are you sure you want to remove the building \"${building.name}\"?`,\n                icon: { content: 'delete_forever' },\n                confirm_text: 'Remove',\n            },\n            this._dialog\n        );\n        if (ref.reason !== 'done') return ref.close();\n        ref.loading('Removing building...');\n        await removeZone(building.id).toPromise();\n        notifySuccess('Successfully removed building.');\n        ref.close();\n    }\n}\n","import { Component } from '@angular/core';\nimport { BuildingManagementService } from './building-management.service';\n\n@Component({\n    selector: 'building-list',\n    template: `\n        <div class=\"absolute inset-0 overflow-auto\">\n            <custom-table\n                class=\"block min-w-[60rem] w-full h-full\"\n                [dataSource]=\"buildings\"\n                [columns]=\"[\n                    'display_name',\n                    'address',\n                    'timezone',\n                    'region',\n                    'level_count',\n                    'actions'\n                ]\"\n                [display_column]=\"[\n                    'Name',\n                    'Location',\n                    'Timezone',\n                    'Region',\n                    'Levels',\n                    ' '\n                ]\"\n                [column_size]=\"['flex', '12r', '12r', '10r', '6r', '6r', '5r']\"\n                [template]=\"{\n                    images: image_template,\n                    zones: level_template,\n                    actions: action_template\n                }\"\n                empty=\"No buildings\"\n            ></custom-table>\n        </div>\n        <ng-template #level_template let-data=\"data\">\n            {{ (data | level)?.display_name || (data | level)?.name }}\n        </ng-template>\n        <ng-template #image_template let-data=\"data\">\n            <img\n                *ngIf=\"data.length\"\n                [src]=\"data[0]\"\n                class=\"max-h-[3rem] max-w-[8rem]\"\n            />\n            <span *ngIf=\"!data.length\" class=\"opacity-30\">No Images</span>\n        </ng-template>\n        <ng-template #action_template let-row=\"row\">\n            <div class=\"w-full flex justify-end space-x-2\">\n                <button btn icon [matMenuTriggerFor]=\"menu\">\n                    <app-icon>more_vert</app-icon>\n                </button>\n                <mat-menu #menu=\"matMenu\">\n                    <button mat-menu-item (click)=\"editBuilding(row)\">\n                        <div class=\"flex items-center space-x-2\">\n                            <app-icon>edit</app-icon>\n                            <span>Edit Building</span>\n                        </div>\n                    </button>\n                    <button mat-menu-item (click)=\"deleteBuilding(row)\">\n                        <div class=\"flex items-center space-x-2 text-red-500\">\n                            <app-icon>delete</app-icon>\n                            <span>Delete Building</span>\n                        </div>\n                    </button>\n                </mat-menu>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class BuildingListComponent {\n    public readonly buildings = this._manager.filtered_buildings;\n\n    public readonly editBuilding = (building) =>\n        this._manager.editBuilding(building);\n\n    public readonly removeBuilding = (building) =>\n        this._manager.removeBuilding(building);\n\n    constructor(private _manager: BuildingManagementService) {}\n}\n","import { Component } from '@angular/core';\nimport { Building } from '@placeos/organisation';\nimport { BuildingManagementService } from './building-management.service';\n\n@Component({\n    selector: '[app-building-manager]',\n    template: `\n        <app-topbar></app-topbar>\n        <div class=\"flex flex-1 h-px\">\n            <app-sidebar></app-sidebar>\n            <main class=\"flex flex-col flex-1 w-1/2 h-full\">\n                <header class=\"flex items-center justify-between mb-2 p-8\">\n                    <h2 class=\"text-2xl font-medium\">Building Management</h2>\n                    <button btn matRipple (click)=\"newBuilding()\">\n                        Add Building\n                    </button>\n                </header>\n                <building-list\n                    class=\"block w-full relative flex-1 h-1/2\"\n                ></building-list>\n            </main>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n                background-color: #fff;\n            }\n\n            sidebar {\n                height: 100%;\n            }\n\n            main {\n                display: flex;\n                flex-direction: column;\n                flex: 1;\n                min-width: 50%;\n                height: 100%;\n            }\n        `,\n    ],\n})\nexport class BuildingManagerComponent {\n    public readonly newBuilding = () => this._state.editBuilding();\n\n    constructor(private _state: BuildingManagementService) {}\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule, Route } from '@angular/router';\n\nimport { UIModule } from '../ui/ui.module';\n\nimport { SharedSpacesModule } from '@placeos/spaces';\nimport { SharedUsersModule } from '@placeos/users';\n\nimport { BuildingManagerComponent } from './building-manager.component';\nimport { MatChipsModule } from '@angular/material/chips';\nimport { BuildingListComponent } from './building-list.component';\nimport { BuildingFormComponent } from './building-form.component';\nimport { BuildingModalComponent } from './building-modal.component';\n\nconst ROUTES: Route[] = [\n    { path: '', component: BuildingManagerComponent },\n    { path: 'new', component: BuildingManagerComponent },\n];\n\n@NgModule({\n    declarations: [\n        BuildingManagerComponent,\n        BuildingListComponent,\n        BuildingFormComponent,\n        BuildingModalComponent,\n    ],\n    imports: [\n        CommonModule,\n        FormsModule,\n        UIModule,\n        SharedSpacesModule,\n        SharedUsersModule,\n        MatChipsModule,\n        RouterModule.forChild(ROUTES),\n    ],\n})\nexport class BuildingManagerModule {}\n"],"x_google_ignoreList":[]}