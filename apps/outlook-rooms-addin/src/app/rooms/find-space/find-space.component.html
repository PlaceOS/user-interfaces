<div class="w-full min-h-[800px] bg-gray-50">
    <div class="flex flex-col mx-6">
        <div class="flex flex-row border-b mr-auto mt-3 w-full">
            <button (click)="this.closeModal()">
                <mat-icon class="text-3xl text-gray-700">close</mat-icon>
            </button>

            <div class="flex w-full justify-center w-[460px]">
                <span class="flex items-center text-xl font-bold">
                    Find Space</span
                >
            </div>
        </div>

        <mat-form-field
            overlay
            buildings
            class="w-full sm:w-px sm:flex-1 h-[3.25rem]"
            *ngIf="(buildings | async)?.length > 1"
            appearance="outline"
        >
            <mat-select
                placeholder="Select Building..."
                [ngModel]="building | async"
                (ngModelChange)="setBuilding($event)"
            >
                <mat-option *ngFor="let bld of buildings | async" [value]="bld">
                    {{ bld.display_name || bld.name }}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field
            class="w-full sm:w-px sm:flex-1 h-[3.25rem]"
            overlay
            *ngIf="(levels | async)?.length > 0"
            appearance="outline"
        >
            <mat-select
                placeholder="Level"
                [ngModel]="
                    (options | async)?.zone_ids?.length
                        ? (options | async)?.zone_ids[0]
                        : ''
                "
                (ngModelChange)="setOptions({ zone_ids: [$event] })"
            >
                <mat-option
                    *ngFor="let item of levels | async"
                    [value]="item.id"
                >
                    {{ item.display_name || item.name }}
                </mat-option>
            </mat-select>
        </mat-form-field>

        <div class="flex flex-row mt-3">
            <button
                mat-flat-button
                (click)="openFilter()"
                class="block mt-3 bg-gray-300 w-[350px]"
            >
                Filter
            </button>
            <button
                mat-flat-button
                class="block mt-3 bg-gray-300 w-[100px] ml-3"
            >
                Map
            </button>
        </div>

        <section class="flex flex-row">
            <mat-chip-list class="mt-3">
                <mat-chip class="text-gray-700">
                    {{ this.form?.controls.date.value | date: 'dd MMMM yyyy' }}
                </mat-chip>

                <div *ngIf="this.form?.controls.attendees.value.length > 0">
                    <mat-chip class="text-gray-700">
                        {{ this.form?.controls.attendees.value.length }}
                        People
                    </mat-chip>
                </div>

                <mat-chip class="text-gray-700">
                    {{ this.startTime }} - {{ this.endTime }}
                </mat-chip>
            </mat-chip-list>
        </section>

        <section class="flex flex-row my-6 border-t">
            <div class="flex flex-col">
                <span class="text-xl font-bold mt-3"> Results</span>
                <span class="text-sm text-gray-500 mt-3">
                    {{ form.get('resources')?.value?.length }} results
                    found</span
                >
            </div>
        </section>

        <div class="flex-1 w-full bg-gray-100 overflow-auto w-[460px]">
            <ng-container *ngIf="!(loading | async); else load_state">
                <ng-container
                    *ngIf="(spaces$ | async)?.length > 0; else empty_state"
                >
                    <find-space-item
                        *ngFor="let space of spaces$ | async"
                        class="w-[640px] max-w-[calc(100%-2rem)] mx-auto"
                        [space]="space"
                        [multiple]="multiple"
                        [(book)]="book_space[space.id]"
                        (bookChange)="handleBookEvent(space, $event)"
                    ></find-space-item>
                    <p class="p-4 text-center opacity-60">
                        End of available spaces list
                    </p>
                </ng-container>
            </ng-container>

            <ng-template #load_state>
                <div
                    class="h-full w-full flex flex-col items-center justify-center space-y-2"
                >
                    <mat-spinner [diameter]="32"></mat-spinner>
                    <p>Retrieving available spaces...</p>
                </div>
            </ng-template>
            <ng-template #empty_state>
                <div
                    class="h-full w-full flex flex-col items-center justify-center space-y-2 p-8 text-center"
                >
                    <p>
                        No available spaces for selected time, capacity or
                        level(s)
                    </p>
                </div>
            </ng-template>
        </div>
        <section>
            <button
                mat-button
                type="submit"
                (click)="confirm()"
                class="bg-secondary border-secondary w-[460px] my-3"
            >
                <span class="">Confirm</span>
            </button>
        </section>
    </div>
</div>
