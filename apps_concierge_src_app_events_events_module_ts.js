"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_events_events_module_ts"],{22732:(oe,I,a)=>{a.r(I),a.d(I,{EventsModule:()=>At});var e=a(68559),B=a(45189),J=a(96843),v=a(26842);const A=["app-events",""];let S=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["","app-events",""]],attrs:A,decls:5,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"relative","flex","flex-col","flex-1","w-1/2","h-full"]],template:function(n,o){1&n&&(e.nrm(0,"app-topbar"),e.j41(1,"div",0),e.nrm(2,"app-sidebar"),e.j41(3,"main",1),e.nrm(4,"router-outlet"),e.k0s()())},dependencies:[B.S,J.c,v.n3],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=events.component.ts-angular-inline--145.css.map*/"]})}return i})();var p=a(60316),f=a(34456),w=a(40363),h=a(89204),d=a(82333),E=a(57915),W=a(12185),H=a(67450),D=a(27419),Z=a(13264),K=a(90521),se=a(42175),ae=a(8627),re=a(71963),y=a(35443),C=a(7841),L=a(12587);let F=(()=>{class i extends d.Tv{changed(){this._changed.next(Date.now())}get period(){return this._options.getValue()?.period}constructor(t,n,o,s){super(),this._settings=t,this._org=n,this._dialog=o,this._router=s,this._options=new K.t({period:"week"}),this._changed=new K.t(0),this.event_list=(0,se.zV)([this._org.active_building,this._options,this._changed]).pipe((0,ae.p)(([l])=>!!l),(0,re.n)(([l,c])=>(0,E.tj)({period_start:(0,H.A)((0,D.A)(Math.max(Date.now(),c.date))),period_end:(0,H.A)((0,Z.A)(c.end||c.date||Date.now())),type:"group-event",zones:c.zone_ids?.join(",")||l.id})),(0,y.T)(l=>l.sort((c,m)=>c.date-m.date)),(0,C.t)(1)),this.options=this._options.asObservable()}setOptions(t){this._options.next({...this._options.value,...t})}viewEvent(t){var n=this;const o=this._dialog.open(E.E2,{data:{booking:t,concierge:!0}});this.subscription(`edit:${t.id}`,o.componentInstance.edit.subscribe(()=>{this._router.navigate(["/entertainment","events","manage",t.id])})),this.subscription(`remove:${t.id}`,o.componentInstance.remove.subscribe((0,h.A)(function*(){yield n.removeEvent(t),o.close()})))}removeEvent(t){var n=this;return(0,h.A)(function*(){const o=yield(0,d.GE)({title:"Delete Event",content:`Are you sure you want to delete the event "${t.title}"?`,icon:{content:"delete"},confirm_text:"Delete"},n._dialog);"done"===o.reason&&(o.loading("Deleting event..."),yield(0,E.UN)(t.id).toPromise().catch(s=>{throw(0,d.UG)(s),o.close(),s}),o.close(),(0,d.VX)("Successfully deleted event."),n._changed.next(Date.now()))})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.KVO(d.h$),e.KVO(W.yb),e.KVO(L.bZ),e.KVO(v.Ix))};static#t=this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var P=a(20786),M=a(68266),x=a(88402),Q=a(61947),Y=a(69935),_=a(83866),le=a(6109),R=a(33602),$=a(24950),q=a(25175),b=a(85060),V=a(69434),k=a(31034),de=a(12993),X=a(22238),ce=a(93208),me=a(47249),pe=a(23666),ue=a(56062),ve=a(22011);const fe=()=>["date","level","room","interested","attending","status","permissions","actions"],_e=()=>["Event","Level","Room","Interested","Attending","Status","Published"," "],ge=()=>["24r","flex","10r","6r","6r","8r","5r","3.5r"],he=(i,r,t,n,o,s,l,c)=>({date:i,level:r,room:t,interested:n,attending:o,status:s,permissions:l,actions:c}),be=i=>["/entertainment","events","manage",i];function Ee(i,r){if(1&i&&e.nrm(0,"img",21),2&i){const t=e.XpG().row;e.Y8G("source",t.images[0])}}function ye(i,r){if(1&i&&(e.j41(0,"div",11)(1,"div",12)(2,"div",13),e.EFF(3),e.nI1(4,"date"),e.k0s(),e.j41(5,"div",14),e.EFF(6),e.nI1(7,"date"),e.k0s()(),e.j41(8,"div",15),e.DNE(9,Ee,1,1,"img",16),e.k0s(),e.j41(10,"div",17)(11,"div",18),e.EFF(12),e.k0s(),e.j41(13,"div",19),e.EFF(14),e.nI1(15,"date"),e.nI1(16,"date"),e.k0s(),e.j41(17,"div",20),e.EFF(18),e.nI1(19,"space"),e.nI1(20,"async"),e.nI1(21,"building"),e.k0s()()()),2&i){let t;const n=r.row,o=e.XpG();e.R7$(3),e.SpI(" ",e.i5U(4,7,n.date,"MMM")," "),e.R7$(3),e.SpI(" ",e.i5U(7,10,n.date,"d")," "),e.R7$(3),e.Y8G("ngIf",null==n.images?null:n.images.length),e.R7$(3),e.JRh(n.title),e.R7$(2),e.Lme(" ",e.i5U(15,13,n.date,"EEEE, "+o.time_format)," \u2013 ",e.i5U(16,16,n.date+60*n.duration*1e3,o.time_format+" (z)")," "),e.R7$(4),e.SpI(" ",null==(t=e.bMT(21,23,null==(t=e.bMT(20,21,e.bMT(19,19,null==n.linked_event?null:n.linked_event.system_id)))?null:t.zones))?null:t.address," ")}}function xe(i,r){1&i&&(e.j41(0,"span",23),e.EFF(1," No Level "),e.k0s())}function Fe(i,r){if(1&i&&(e.EFF(0),e.nI1(1,"space"),e.nI1(2,"async"),e.nI1(3,"level"),e.DNE(4,xe,2,0,"span",22)),2&i){let t;const n=r.row;e.SpI(" ",null==(t=e.bMT(3,6,null==(t=e.bMT(2,4,e.bMT(1,2,null==n.linked_event?null:n.linked_event.system_id)))?null:t.zones))?null:t.display_name," "),e.R7$(4),e.Y8G("ngIf",!(null!=n.linked_event&&n.linked_event.system_id))}}function ke(i,r){1&i&&(e.j41(0,"span",23),e.EFF(1," No Room "),e.k0s())}function Me(i,r){if(1&i&&(e.EFF(0),e.nI1(1,"space"),e.nI1(2,"async"),e.DNE(3,ke,2,0,"span",22)),2&i){let t;const n=r.row;e.SpI(" ",null==(t=e.bMT(2,4,e.bMT(1,2,null==n.linked_event?null:n.linked_event.system_id)))?null:t.display_name," "),e.R7$(3),e.Y8G("ngIf",!(null!=n.linked_event&&n.linked_event.system_id))}}function je(i,r){if(1&i&&(e.j41(0,"div",25),e.nrm(1,"attendee-list",26),e.k0s()),2&i){const t=e.XpG().row;e.R7$(),e.Y8G("list",t.attendees)("host",t.user_email)("hide_close",!0)("custom_title","Interested")}}function Te(i,r){if(1&i&&(e.j41(0,"button",24),e.EFF(1),e.k0s(),e.DNE(2,je,2,4,"ng-template",null,8,e.C5r)),2&i){const t=r.row,n=e.sdS(3);e.Y8G("content",n)("disabled",!(null!=t.attendees&&t.attendees.length)),e.R7$(),e.SpI(" ",(null==t.attendees?null:t.attendees.length)||0," ")}}function Ie(i,r){if(1&i&&(e.j41(0,"div",25),e.nrm(1,"attendee-list",27),e.k0s()),2&i){const t=e.XpG().row,n=e.XpG();e.R7$(),e.Y8G("list",n.checkedInList(t.attendees))("host",t.user_email)("hide_close",!0)}}function we(i,r){if(1&i&&(e.j41(0,"button",24),e.EFF(1),e.k0s(),e.DNE(2,Ie,2,3,"ng-template",null,8,e.C5r)),2&i){const t=r.row,n=e.sdS(3),o=e.XpG();e.Y8G("content",n)("disabled",!o.checkedInCount(t.attendees)),e.R7$(),e.SpI(" ",o.checkedInCount(t.attendees)," ")}}function Ce(i,r){1&i&&(e.j41(0,"div",29)(1,"app-icon"),e.EFF(2,"done"),e.k0s()())}function Re(i,r){if(1&i&&e.DNE(0,Ce,3,0,"div",28),2&i){const t=r.row;e.Y8G("ngIf","OPEN"===t.permission||"open"===t.permission)}}function $e(i,r){if(1&i&&(e.j41(0,"div",30),e.EFF(1),e.k0s()),2&i){const t=r.row;e.AVh("bg-success","done"!==t.state&&"in_progress"!==t.state)("text-success-content","done"!==t.state&&"in_progress"!==t.state)("bg-warning","in_progress"===t.state)("text-warning-content","in_progress"===t.state)("bg-base-200","done"===t.state)("text-base-content","done"===t.state),e.R7$(),e.SpI(" ","done"===t.state?"Done":"in_progress"===t.state?"In Progress":"Active"," ")}}function Ve(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",31)(1,"button",32)(2,"app-icon"),e.EFF(3,"more_vert"),e.k0s()()(),e.j41(4,"mat-menu",null,9)(6,"button",33)(7,"div",11)(8,"app-icon",34),e.EFF(9," confirmation_number "),e.k0s(),e.j41(10,"div",35),e.EFF(11,"Promote Event"),e.k0s()()(),e.j41(12,"button",36),e.bIt("click",function(){const o=e.eBV(t).row,s=e.XpG();return e.Njj(s.viewEvent(o))}),e.j41(13,"div",11)(14,"app-icon",34),e.EFF(15,"visibility"),e.k0s(),e.j41(16,"div",35),e.EFF(17,"View Event"),e.k0s()()(),e.j41(18,"a",37)(19,"div",11)(20,"app-icon",34),e.EFF(21,"edit"),e.k0s(),e.j41(22,"div",35),e.EFF(23,"Edit Event"),e.k0s()()(),e.j41(24,"button",33)(25,"div",11)(26,"app-icon",34),e.EFF(27,"content_copy"),e.k0s(),e.j41(28,"div",35),e.EFF(29,"Copy URL"),e.k0s()()(),e.j41(30,"button",36),e.bIt("click",function(){const o=e.eBV(t).row,s=e.XpG();return e.Njj(s.removeEvent(o))}),e.j41(31,"div",11)(32,"app-icon",38),e.EFF(33,"delete"),e.k0s(),e.j41(34,"div",35),e.EFF(35,"Delete Event"),e.k0s()()()()}if(2&i){const t=r.row,n=e.sdS(5);e.R7$(),e.Y8G("matMenuTriggerFor",n)("disabled","done"===t.state),e.R7$(5),e.Y8G("disabled",!0),e.R7$(12),e.Y8G("routerLink",e.eq3(5,be,null==t?null:t.id)),e.R7$(6),e.Y8G("disabled",!0)}}let Ge=(()=>{class i{get time_format(){return this._settings.time_format}constructor(t,n){this._settings=t,this._state=n,this.event_list=this._state.event_list,this.viewEvent=o=>this._state.viewEvent(o),this.removeEvent=o=>this._state.removeEvent(o)}checkedInCount(t){return t?.length?t.filter(n=>n.checked_in).length:0}checkedInList(t){return t?.length?t.filter(n=>n.checked_in):[]}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(d.h$),e.rXU(F))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["event-listing"]],decls:17,vars:17,consts:[["event_template",""],["level_template",""],["room_template",""],["interested_template",""],["attending_template",""],["published_template",""],["status_template",""],["actions_template",""],["view_attendees",""],["menu","matMenu"],[1,"min-w-[72rem]","block",3,"dataSource","columns","display_column","column_size","template"],[1,"flex","items-center","space-x-2"],["date","",1,"flex","flex-col","items-center","leading-tight","w-8"],["month","",1,"text-sm","font-medium","relative","top-0.5","opacity-60"],["day","",1,"text-2xl","font-light","relative","-top-0.5"],[1,"flex","items-center","justify-center","h-12","w-12","rounded","overflow-hidden","bg-base-200"],["auth","","class","min-h-full min-w-full",3,"source",4,"ngIf"],["details","",1,"flex","flex-col"],[1,"text-sm"],[1,"text-xs","opacity-40"],[1,"text-xs"],["auth","",1,"min-h-full","min-w-full",3,"source"],["class","opacity-30",4,"ngIf"],[1,"opacity-30"],["matRipple","","customTooltip","",1,"px-2","rounded","h-full","w-full","flex","items-center","justify-center",3,"content","disabled"],[1,"relative","w-[20rem]","h-[28rem]","overflow-auto","bg-white","rounded","shadow"],[3,"list","host","hide_close","custom_title"],[3,"list","host","hide_close"],["class","rounded h-8 w-8 flex items-center justify-center text-2xl bg-success text-success-content mx-auto",4,"ngIf"],[1,"rounded","h-8","w-8","flex","items-center","justify-center","text-2xl","bg-success","text-success-content","mx-auto"],[1,"px-4","py-1","rounded-full"],[1,"w-full","flex","items-center","justify-end","space-x-2"],["icon","","matRipple","",3,"matMenuTriggerFor","disabled"],["mat-menu-item","",3,"disabled"],[1,"text-2xl"],[1,"mr-2"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"routerLink"],[1,"text-2xl","text-error"]],template:function(n,o){if(1&n&&(e.nrm(0,"custom-table",10),e.DNE(1,ye,22,25,"ng-template",null,0,e.C5r)(3,Fe,5,8,"ng-template",null,1,e.C5r)(5,Me,4,6,"ng-template",null,2,e.C5r)(7,Te,4,3,"ng-template",null,3,e.C5r)(9,we,4,3,"ng-template",null,4,e.C5r)(11,Re,1,1,"ng-template",null,5,e.C5r)(13,$e,2,13,"ng-template",null,6,e.C5r)(15,Ve,36,7,"ng-template",null,7,e.C5r)),2&n){const s=e.sdS(2),l=e.sdS(4),c=e.sdS(6),m=e.sdS(8),u=e.sdS(10),g=e.sdS(12),N=e.sdS(14),St=e.sdS(16);e.Y8G("dataSource",o.event_list)("columns",e.lJ4(5,fe))("display_column",e.lJ4(6,_e))("column_size",e.lJ4(7,ge))("template",e.lV(8,he,s,l,c,m,u,N,g,St))}},dependencies:[p.bT,k.kk,k.fb,k.Cp,b.r6,V.R,de.r,X.I,ce.U,me.I,v.Wk,p.Jj,p.vh,pe.D,ue.b,ve.J]})}return i})();var Oe=a(46247),U=a(89273),ee=a(93736);const Ne=()=>[];function Ae(i,r){if(1&i&&(e.j41(0,"div",12)(1,"div",13),e.EFF(2),e.k0s()()),2&i){const t=r.$implicit,n=r.index;e.R7$(2),e.Lme(" ",t," ",n>=12?"PM":"AM"," ")}}function Se(i,r){if(1&i&&(e.j41(0,"div",14)(1,"div",15),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.j41(4,"div"),e.EFF(5),e.nI1(6,"date"),e.k0s()()),2&i){const t=r.$implicit;e.R7$(2),e.SpI(" ",e.i5U(3,2,t,"EEEE")," "),e.R7$(3),e.JRh(e.i5U(6,5,t,"d"))}}function De(i,r){1&i&&e.nrm(0,"div",16)}function Le(i,r){if(1&i&&(e.j41(0,"div",24),e.nrm(1,"group-event-card",25),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Y8G("event",t)}}function Pe(i,r){if(1&i){const t=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.viewEvent(o))}),e.nrm(1,"div",21),e.j41(2,"div",22),e.EFF(3),e.nI1(4,"date"),e.k0s(),e.nrm(5,"div",23),e.DNE(6,Le,2,1,"ng-template",null,0,e.C5r),e.k0s()}if(2&i){const t=r.$implicit,n=e.sdS(7);e.xc7("top",100*t.offset+"%")("height",100*t.length+"%"),e.R7$(3),e.Lme(" ",e.i5U(4,8,t.date,"shortTime")," \u2014 ",t.title," "),e.R7$(2),e.Y8G("content",n)("hover",!0)}}function Ye(i,r){if(1&i&&(e.j41(0,"div",26),e.nrm(1,"div",27),e.k0s()),2&i){const t=e.XpG(2);e.xc7("top",100*t.now_offset+"%")}}function Xe(i,r){if(1&i&&(e.j41(0,"div",17),e.DNE(1,Pe,8,11,"button",18),e.nI1(2,"async"),e.DNE(3,Ye,2,2,"div",19),e.k0s()),2&i){const t=r.$implicit,n=r.index,o=e.XpG();e.xc7("transform","translateX("+100*n+"%)"),e.R7$(),e.Y8G("ngForOf",e.bMT(2,4,o.event_day_map)[o.dateString(t)]||e.lJ4(6,Ne)),e.R7$(2),e.Y8G("ngIf",o.isCurrentDay(t))}}let Ue=(()=>{class i extends d.Tv{dateString(t){return t?(0,_.A)(t,"yyyy-MM-dd"):""}isCurrentDay(t){return!!t&&(0,_.A)(Date.now(),"yyyy-MM-dd")===(0,_.A)(t,"yyyy-MM-dd")}get now(){return(0,Oe.A)(Date.now()).valueOf()}get now_offset(){const t=new Date(this.now);return(60*t.getHours()+t.getMinutes())/1440}constructor(t,n,o){super(),this._state=t,this._dialog=n,this._router=o,this.days=new Array(7).fill(0).map((s,l)=>l+1),this.hours=new Array(24).fill(0).map((s,l)=>l%12?l%12:12),this.event_list=this._state.event_list,this.event_day_map=this.event_list.pipe((0,y.T)(s=>{const l={};for(const c of s){const m=(0,_.A)(c.date,"yyyy-MM-dd");l[m]||(l[m]=[]);const u=new Date(c.date);l[m].push({...c,offset:(60*u.getHours()+u.getMinutes())/1440,length:c.duration/1440})}return l}),(0,U.Z)({}),(0,C.t)(1)),this.viewEvent=s=>this._state.viewEvent(s)}ngOnInit(){this.subscription("date",this._state.options.subscribe(({date:t})=>{t&&(this.days=this.days.map((n,o)=>(0,x.A)(t,o).valueOf()))}))}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(F),e.rXU(L.bZ),e.rXU(v.Ix))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["event-week-view"]],features:[e.Vt3],decls:13,vars:8,consts:[["event_card",""],[1,"absolute","inset-0","overflow-auto","flex"],[1,"sticky","left-0","w-24","min-h-full","flex","flex-col","items-end","z-20","bg-base-100"],["header","",1,"sticky","top-0","h-16","min-h-16","flex","justify-end","z-10"],[1,"bg-base-100","pt-6","h-10"],[1,"opacity-30","text-xs","px-2"],["class","relative min-h-10 w-full flex-1 bg-base-100",4,"ngFor","ngForOf"],[1,"relative","min-w-[84rem]","min-h-full","z-10"],["header","",1,"sticky","flex","top-0","h-16","min-h-16","border-b","border-base-200","bg-base-100","z-10"],["date","","class","flex flex-col items-center justify-center p-4 min-w-48 flex-1 border-r border-base-200",4,"ngFor","ngForOf"],["class","relative flex min-h-10 min-w-[84rem] flex-1 border-x border-b border-base-200 pointer-events-none",4,"ngFor","ngForOf"],["date","","class","absolute top-16 left-0 w-[calc(100%/7)] h-[60rem] flex-1 border-r border-base-200 pointer-events-none",3,"transform",4,"ngFor","ngForOf"],[1,"relative","min-h-10","w-full","flex-1","bg-base-100"],["hour","",1,"absolute","top-0","right-1","-translate-y-1/2","whitespace-nowrap","text-xs","opacity-60"],["date","",1,"flex","flex-col","items-center","justify-center","p-4","min-w-48","flex-1","border-r","border-base-200"],[1,"text-sm","opacity-60"],[1,"relative","flex","min-h-10","min-w-[84rem]","flex-1","border-x","border-b","border-base-200","pointer-events-none"],["date","",1,"absolute","top-16","left-0","w-[calc(100%/7)]","h-[60rem]","flex-1","border-r","border-base-200","pointer-events-none"],["matRipple","","class","absolute inset-x-1 bg-base-100 rounded border border-base-200 hover:border-info shadow pl-3 pr-2 py-1 overflow-hidden pointer-events-auto",3,"top","height","click",4,"ngFor","ngForOf"],["now","","class","absolute inset-x-0 h-0 border-y-2 border-base-content",3,"top",4,"ngIf"],["matRipple","",1,"absolute","inset-x-1","bg-base-100","rounded","border","border-base-200","hover:border-info","shadow","pl-3","pr-2","py-1","overflow-hidden","pointer-events-auto",3,"click"],[1,"absolute","left-0","inset-y-0","bg-info","w-1.5"],[1,"text-sm","opacity-60","h-full","text-left"],["customTooltip","","xPosition","center","yPosition","bottom",1,"absolute","inset-0",3,"content","hover"],[1,"p-2","pointer-events-none"],[3,"event"],["now","",1,"absolute","inset-x-0","h-0","border-y-2","border-base-content"],[1,"absolute","left-0","top-0","-translate-x-1/2","-translate-y-1/2","h-4","w-4","rounded-full","bg-base-content"]],template:function(n,o){1&n&&(e.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5),e.EFF(5),e.nI1(6,"date"),e.k0s()()(),e.DNE(7,Ae,3,2,"div",6),e.k0s(),e.j41(8,"div",7)(9,"div",8),e.DNE(10,Se,7,8,"div",9),e.k0s(),e.DNE(11,De,1,0,"div",10)(12,Xe,4,7,"div",11),e.k0s()()),2&n&&(e.R7$(5),e.SpI(" ",e.i5U(6,5,o.now,"zzzz")," "),e.R7$(2),e.Y8G("ngForOf",o.hours),e.R7$(3),e.Y8G("ngForOf",o.days),e.R7$(),e.Y8G("ngForOf",o.hours),e.R7$(),e.Y8G("ngForOf",o.days))},dependencies:[p.Sq,p.bT,b.r6,X.I,ee.T,p.Jj,p.vh]})}return i})();var ze=a(26078),Be=a(3330),Je=a(80640);const G=()=>[];function We(i,r){if(1&i&&(e.j41(0,"div",6),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const t=r.$implicit;e.R7$(),e.SpI(" ",e.i5U(2,1,t,"EEEE")," ")}}function He(i,r){if(1&i&&(e.j41(0,"div",16),e.nrm(1,"group-event-card",17),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Y8G("event",t)}}function Ze(i,r){if(1&i){const t=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.viewEvent(o))}),e.nrm(1,"div",13),e.j41(2,"div",14),e.EFF(3),e.nI1(4,"date"),e.k0s(),e.nrm(5,"div",15),e.DNE(6,He,2,1,"ng-template",null,1,e.C5r),e.k0s()}if(2&i){const t=r.$implicit,n=e.sdS(7);e.R7$(3),e.Lme(" ",e.i5U(4,4,t.date,"shortTime")," \u2014 ",t.title," "),e.R7$(2),e.Y8G("content",n)("hover",!0)}}function Ke(i,r){if(1&i&&(e.j41(0,"button",18),e.EFF(1),e.nI1(2,"async"),e.k0s()),2&i){const t=e.XpG().$implicit,n=e.sdS(10),o=e.XpG();e.Y8G("matMenuTriggerFor",n),e.R7$(),e.SpI(" ",(e.bMT(2,2,o.event_day_map)[o.dateString(t.id)]||e.lJ4(4,G)).length-3," more event(s) ")}}function Qe(i,r){if(1&i){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){const o=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.viewEvent(o))}),e.j41(1,"div",20)(2,"div",21),e.EFF(3),e.k0s(),e.j41(4,"div",22),e.EFF(5),e.nI1(6,"date"),e.k0s()()()}if(2&i){const t=r.$implicit;e.R7$(3),e.JRh(t.title),e.R7$(2),e.SpI(" ",e.i5U(6,2,t.date,"shortTime")," ")}}function qe(i,r){if(1&i&&(e.j41(0,"div",7)(1,"div",8),e.EFF(2),e.nI1(3,"date"),e.k0s(),e.DNE(4,Ze,8,7,"button",9),e.nI1(5,"async"),e.nI1(6,"slice"),e.DNE(7,Ke,3,5,"button",10),e.nI1(8,"async"),e.j41(9,"mat-menu",null,0),e.DNE(11,Qe,7,5,"button",11),e.nI1(12,"async"),e.nI1(13,"slice"),e.k0s()()),2&i){const t=r.$implicit,n=e.XpG();e.R7$(),e.AVh("opacity-30",!t.is_month)("bg-secondary",t.is_today)("text-secondary-content",t.is_today),e.R7$(),e.SpI(" ",e.i5U(3,10,t.id,"d")," "),e.R7$(2),e.Y8G("ngForOf",e.brH(6,15,e.bMT(5,13,n.event_day_map)[n.dateString(t.id)]||e.lJ4(26,G),0,3)),e.R7$(3),e.Y8G("ngIf",(e.bMT(8,19,n.event_day_map)[n.dateString(t.id)]||e.lJ4(27,G)).length>3),e.R7$(4),e.Y8G("ngForOf",e.i5U(13,23,e.bMT(12,21,n.event_day_map)[n.dateString(t.id)]||e.lJ4(28,G),3))}}let et=(()=>{class i extends d.Tv{dateString(t){return t?(0,_.A)(t,"yyyy-MM-dd"):""}get offset_weekday(){return this._settings.get("app.week_start")||0}constructor(t,n,o,s){super(),this._state=t,this._settings=n,this._dialog=o,this._router=s,this.month=(0,D.A)(Date.now()).valueOf(),this.weekdays=[],this.month_days=[],this.event_list=this._state.event_list,this.event_day_map=this.event_list.pipe((0,y.T)(l=>{const c={};for(const m of l){const u=(0,_.A)(m.date,"yyyy-MM-dd");c[u]||(c[u]=[]);const g=new Date(m.date);c[u].push({...m,offset:(60*g.getHours()+g.getMinutes())/1440,length:m.duration/1440})}return c}),(0,U.Z)({}),(0,C.t)(1)),this.viewEvent=l=>this._state.viewEvent(l)}ngOnInit(){this.subscription("date",this._state.options.subscribe(({date:t})=>{this.month=t,this._setMonthDays(),this._setWeekdays()})),this._setMonthDays(),this._setWeekdays()}_setMonthDays(){const t=(0,Y.A)((0,Q.A)(this.month),{weekStartsOn:this.offset_weekday});this.month_days=Array.from(Array(42).keys()).map(n=>{const o=(0,x.A)(t,n).valueOf();return{id:o,is_today:(0,ze.A)(o,Date.now()),is_month:(0,Be.A)(o,this.month)}})}_setWeekdays(){const t=(0,Y.A)(Date.now(),{weekStartsOn:this.offset_weekday});this.weekdays=Array.from(Array(7).keys()).map(n=>(0,x.A)(t,n))}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(F),e.rXU(d.h$),e.rXU(L.bZ),e.rXU(v.Ix))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["event-month-view"]],features:[e.Vt3],decls:4,vars:2,consts:[["menu","matMenu"],["event_card",""],[1,"absolute","inset-0","overflow-auto"],[1,"grid","grid-cols-7","min-w-full","w-[80rem]","min-h-full","h-[56rem]","m-2","border-b","border-base-200"],["weekday","","class","relative flex items-center justify-center text-sm opacity-60 p-2 h-12",4,"ngFor","ngForOf"],["monthday","","class","relative border border-base-200 flex flex-col space-y-1",4,"ngFor","ngForOf"],["weekday","",1,"relative","flex","items-center","justify-center","text-sm","opacity-60","p-2","h-12"],["monthday","",1,"relative","border","border-base-200","flex","flex-col","space-y-1"],[1,"rounded-full","w-8","h-8","flex","items-center","justify-center","mt-1","ml-1"],["matRipple","","class","relative w-[calc(100%-0.5rem)] h-7 bg-base-100 rounded border border-base-200 hover:border-info shadow pl-3 pr-2 py-1 overflow-hidden mx-1",3,"click",4,"ngFor","ngForOf"],["matRipple","","matTooltip","More events","class","relative w-[calc(100%-0.5rem)] h-7 rounded pl-3 pr-2 py-1 overflow-hidden mx-1 underline text-sm",3,"matMenuTriggerFor",4,"ngIf"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["matRipple","",1,"relative","w-[calc(100%-0.5rem)]","h-7","bg-base-100","rounded","border","border-base-200","hover:border-info","shadow","pl-3","pr-2","py-1","overflow-hidden","mx-1",3,"click"],[1,"absolute","left-0","inset-y-0","bg-info","w-1.5"],[1,"text-sm","opacity-60","h-full","text-left","truncate"],["customTooltip","","xPosition","center","yPosition","bottom",1,"absolute","inset-0",3,"content","hover"],[1,"p-2","pointer-events-none"],[3,"event"],["matRipple","","matTooltip","More events",1,"relative","w-[calc(100%-0.5rem)]","h-7","rounded","pl-3","pr-2","py-1","overflow-hidden","mx-1","underline","text-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-4"],[1,"flex-1"],[1,"text-xs","opacity-60","py-1","px-2","rounded","bg-base-200","text-base-content"]],template:function(n,o){1&n&&(e.j41(0,"div",2)(1,"div",3),e.DNE(2,We,3,4,"div",4)(3,qe,14,29,"div",5),e.k0s()()),2&n&&(e.R7$(2),e.Y8G("ngForOf",o.weekdays),e.R7$(),e.Y8G("ngForOf",o.month_days))},dependencies:[p.Sq,p.bT,k.kk,k.fb,k.Cp,Je.oV,b.r6,X.I,ee.T,p.Jj,p.P9,p.vh],styles:[".grid[_ngcontent-%COMP%]{grid-template-rows:3rem repeat(6,minmax(0,1fr))}\n\n/*# sourceMappingURL=event-month-view.component.ts-angular-inline--147.css.map*/"]})}return i})();function tt(i,r){if(1&i&&(e.j41(0,"span",12),e.EFF(1),e.nI1(2,"async"),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.JRh("week"===e.bMT(2,1,t.period)?"This Week":"This Month")}}function nt(i,r){1&i&&e.nrm(0,"event-week-view")}function it(i,r){1&i&&e.nrm(0,"event-month-view")}let ot=(()=>{class i{get time_format(){return this._settings.time_format}constructor(t,n,o,s){this._settings=t,this._state=n,this._router=o,this._route=s,this.period=this._state.options.pipe((0,y.T)(l=>l.period)),this.options=this._state.options,this.is_today=this.options.pipe((0,y.T)(l=>l.date<=Date.now()&&l.end>Date.now())),this.event_list=this._state.event_list,this.event_day_map=this.event_list.pipe((0,y.T)(l=>{const c={};for(const m of l){const u=(0,_.A)(m.date,"yyyy-MM-dd");c[u]||(c[u]=[]),c[u].push(m)}return c}),(0,C.t)(1))}setPeriod(t){this._state.setOptions({period:t}),this._router.navigate([],{relativeTo:this._route,queryParams:{period:t},queryParamsHandling:"merge"})}nextPeriod(){var t=this;return(0,h.A)(function*(){const{date:n,period:o}=yield t.options.pipe((0,R.s)(1)).toPromise();t._router.navigate([],{relativeTo:t._route,queryParams:{range:"week"===o?(0,P.A)(n,1).valueOf():(0,M.A)(n,1).valueOf()},queryParamsHandling:"merge"})})()}previousPeriod(){var t=this;return(0,h.A)(function*(){const{date:n,period:o}=yield t.options.pipe((0,R.s)(1)).toPromise();t._router.navigate([],{relativeTo:t._route,queryParams:{range:"week"===o?(0,P.A)(n,-1).valueOf():(0,M.A)(n,-1).valueOf()},queryParamsHandling:"merge"})})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(d.h$),e.rXU(F),e.rXU(v.Ix),e.rXU(v.nX))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["event-calendar"]],decls:28,vars:21,consts:[["month_calendar",""],[1,"flex","items-center","border-y","border-base-200","w-full"],[1,"flex-1","px-2","py-4"],["class","text-info text-xs",4,"ngIf"],[1,"flex-2","flex","items-center","justify-center","space-x-2"],[1,"font-medium","pl-4"],["icon","","matRipple","",3,"click"],[1,"flex-1","flex","items-center","justify-end","space-x-2","py-2"],["btn","","matRipple","",1,"rounded-3xl",3,"click"],[1,"w-full","h-4"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],[1,"text-info","text-xs"]],template:function(n,o){if(1&n){const s=e.RV6();e.j41(0,"div",1)(1,"div",2),e.DNE(2,tt,3,3,"span",3),e.nI1(3,"async"),e.k0s(),e.j41(4,"div",4)(5,"div",5),e.EFF(6),e.nI1(7,"async"),e.nI1(8,"date"),e.k0s(),e.j41(9,"button",6),e.bIt("click",function(){return e.eBV(s),e.Njj(o.previousPeriod())}),e.j41(10,"app-icon"),e.EFF(11,"chevron_left"),e.k0s()(),e.j41(12,"button",6),e.bIt("click",function(){return e.eBV(s),e.Njj(o.nextPeriod())}),e.j41(13,"app-icon"),e.EFF(14,"chevron_right"),e.k0s()()(),e.j41(15,"div",7)(16,"button",8),e.nI1(17,"async"),e.bIt("click",function(){return e.eBV(s),e.Njj(o.setPeriod("week"))}),e.EFF(18," Week "),e.k0s(),e.j41(19,"button",8),e.nI1(20,"async"),e.bIt("click",function(){return e.eBV(s),e.Njj(o.setPeriod("month"))}),e.EFF(21," Month "),e.k0s()()(),e.nrm(22,"div",9),e.j41(23,"div",10),e.DNE(24,nt,1,0,"event-week-view",11),e.nI1(25,"async"),e.DNE(26,it,1,0,"ng-template",null,0,e.C5r),e.k0s()}if(2&n){let s;const l=e.sdS(27);e.R7$(2),e.Y8G("ngIf",e.bMT(3,8,o.is_today)),e.R7$(4),e.SpI(" ",e.i5U(8,12,null==(s=e.bMT(7,10,o.options))?null:s.date,"MMM yyyy")," "),e.R7$(10),e.AVh("inverse","week"!==e.bMT(17,15,o.period)),e.R7$(3),e.AVh("inverse","month"!==e.bMT(20,17,o.period)),e.R7$(5),e.Y8G("ngIf","month"!==e.bMT(25,19,o.period))("ngIfElse",l)}},dependencies:[p.bT,b.r6,V.R,Ue,et,p.Jj,p.vh],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}\n\n/*# sourceMappingURL=event-calendar.component.ts-angular-inline--148.css.map*/"]})}return i})();const st=()=>["/entertainment","events","manage"];function at(i,r){if(1&i&&(e.j41(0,"mat-option",22),e.EFF(1),e.k0s()),2&i){const t=r.$implicit;e.Y8G("value",t.id),e.R7$(),e.SpI(" ",t.display," ")}}function rt(i,r){1&i&&e.nrm(0,"event-listing")}function lt(i,r){if(1&i&&(e.nrm(0,"event-calendar",23),e.nI1(1,"async")),2&i){const t=e.XpG();e.Y8G("period",e.bMT(1,1,t.period))}}let dt=(()=>{class i extends d.Tv{constructor(t,n,o,s){super(),this._settings=t,this._state=n,this._router=o,this._route=s,this.period=this._state.options.pipe((0,y.T)(l=>l.period),(0,le.F)()),this.view="list",this.period_list=[]}ngOnInit(){this.subscription("period",this.period.subscribe(()=>{this._generatePeriods(),this._initPeriod()})),this._generatePeriods(),this._initPeriod(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{t.has("view")&&(this.view=t.get("view")),t.has("period")&&t.get("period")!==this._state.period&&this.setPeriodType(t.get("period"),!1),this._generatePeriods(),t.has("range")&&this.timeout("update",()=>{const n=parseInt(t.get("range"),10),o=this.period_list.find(s=>n>=s.start&&n<s.end)||this.period_list[0]||{start:n,end:"week"===this._state.period?(0,P.A)(n,1).valueOf():(0,M.A)(n,1).valueOf()};this.selected_range=o.id||n,this._state.setOptions({date:o.start,end:o.end}),this.setPeriod(this.selected_range)})}))}setView(t){this.view=t,this._router.navigate([],{relativeTo:this._route,queryParams:{view:t},queryParamsHandling:"merge"})}setPeriodType(t,n=!0){this._state.setOptions({period:t}),n&&this._router.navigate([],{relativeTo:this._route,queryParams:{period:t},queryParamsHandling:"merge"})}setPeriod(t){this.timeout("set_period",()=>{const n=this.period_list.find(l=>t>=l.start&&t<l.end)||this.period_list[0];if(!n)return;this.selected_range=n.id;const{start:o,end:s}=n;this._state.setOptions({date:o,end:s}),this._router.navigate([],{relativeTo:this._route,queryParams:{range:t},queryParamsHandling:"merge"})})}_generatePeriods(){var t=this;this.timeout("generate_periods",(0,h.A)(function*(){const n=[],o=yield t.period.pipe((0,R.s)(1)).toPromise();let s=Date.now();const l=(0,x.A)(s,360).valueOf(),c=t._settings.get("app.week_start")||0;for("month"===o?s=(0,Q.A)(s).valueOf():"week"===o&&(s=(0,Y.A)(s,{weekStartsOn:c}).valueOf());s<l;)if("week"===o){const m=(0,Z.A)((0,x.A)(s,6)).valueOf();n.push({id:s,start:s,end:m,display:`${(0,_.A)(Math.max(Date.now(),s),"EEE, do MMM")} \u2013 ${(0,_.A)(m,"do MMM")}`}),s=(0,x.A)(s,7).valueOf()}else{if("month"!==o)break;{const m=(0,x.A)((0,M.A)(s,1),-1).valueOf();n.push({id:s,start:s,end:m,display:`${(0,_.A)(s,"MMMM yyyy")}`}),s=(0,M.A)(s,1).valueOf()}}t.period_list=n}))}_initPeriod(){this.timeout("update",()=>{this.period_list.length&&(this.setPeriod(this.period_list[0].id),this.selected_range=this.period_list[0].id)},350)}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(d.h$),e.rXU(F),e.rXU(v.Ix),e.rXU(v.nX))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-event-list"]],features:[e.Vt3],decls:37,vars:15,consts:[[1,"absolute","inset-0","flex","flex-col"],[1,"flex","items-center","justify-between","p-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"routerLink"],[1,"ml-2"],[1,"text-2xl"],["filters","",1,"flex","items-center","px-8","space-x-2","pb-4"],["btn","","matRipple","",1,"rounded-3xl",3,"click"],[1,"flex","items-center","space-x-2"],[1,"text-xl"],[1,"pr-2"],[1,"h-full","px-2"],[1,"w-px","h-full","bg-base-300"],["appearance","outline",1,"w-32","no-subscript"],[3,"ngModelChange","ngModel"],["value","week"],["value","month"],["appearance","outline",1,"w-64","no-subscript"],[3,"value",4,"ngFor","ngForOf"],[1,"h-1/2","flex-1","w-full","px-8","overflow-auto","relative"],[4,"ngIf"],[3,"period",4,"ngIf"],[3,"value"],[3,"period"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"h2",2),e.EFF(3,"Events"),e.k0s(),e.j41(4,"a",3)(5,"div",4),e.EFF(6,"Create Event"),e.k0s(),e.j41(7,"app-icon",5),e.EFF(8,"chevron_right"),e.k0s()()(),e.j41(9,"div",6)(10,"button",7),e.bIt("click",function(){return o.setView("list")}),e.j41(11,"div",8)(12,"app-icon",9),e.EFF(13,"list"),e.k0s(),e.j41(14,"div",10),e.EFF(15,"List"),e.k0s()()(),e.j41(16,"button",7),e.bIt("click",function(){return o.setView("calendar")}),e.j41(17,"div",8)(18,"app-icon",9),e.EFF(19,"event"),e.k0s(),e.j41(20,"div",10),e.EFF(21,"Calendar"),e.k0s()()(),e.j41(22,"div",11),e.nrm(23,"div",12),e.k0s(),e.j41(24,"mat-form-field",13)(25,"mat-select",14),e.nI1(26,"async"),e.bIt("ngModelChange",function(l){return o.setPeriodType(l)}),e.j41(27,"mat-option",15),e.EFF(28,"Week"),e.k0s(),e.j41(29,"mat-option",16),e.EFF(30,"Month"),e.k0s()()(),e.j41(31,"mat-form-field",17)(32,"mat-select",14),e.mxI("ngModelChange",function(l){return e.DH7(o.selected_range,l)||(o.selected_range=l),l}),e.bIt("ngModelChange",function(l){return o.setPeriod(l)}),e.DNE(33,at,2,2,"mat-option",18),e.k0s()()(),e.j41(34,"div",19),e.DNE(35,rt,1,0,"event-listing",20)(36,lt,2,3,"event-calendar",21),e.k0s()()),2&n&&(e.R7$(4),e.Y8G("routerLink",e.lJ4(14,st)),e.R7$(6),e.AVh("inverse","list"!==o.view),e.R7$(6),e.AVh("inverse","calendar"!==o.view),e.R7$(9),e.Y8G("ngModel",e.bMT(26,12,o.period)),e.R7$(7),e.R50("ngModel",o.selected_range),e.R7$(),e.Y8G("ngForOf",o.period_list),e.R7$(),e.AVh("mb-4","list"===o.view),e.R7$(),e.Y8G("ngIf","list"===o.view),e.R7$(),e.Y8G("ngIf","calendar"===o.view))},dependencies:[p.Sq,p.bT,f.BC,f.vS,$.rl,q.VO,b.wT,b.r6,V.R,v.Wk,Ge,ot,p.Jj],styles:["[_nghost-%COMP%]{flex:1}\n\n/*# sourceMappingURL=events-list.component.ts-angular-inline--146.css.map*/"]})}return i})();var z=a(74879),ct=a(57871),mt=a(80433),pt=a(5689),j=a(68113),ut=a(68390),vt=a(87984),ft=a(97024),_t=a(41134),te=a(79771),gt=a(19608),ht=a(81413),bt=a(18e3),Et=a(81772),yt=a(56864),O=a(12772),xt=a(597);const ne=()=>["/entertainment","events"],T=()=>({standalone:!0});function Ft(i,r){if(1&i){const t=e.RV6();e.j41(0,"mat-chip-row",47),e.bIt("removed",function(){const o=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.removeTag(o))}),e.EFF(1),e.j41(2,"app-icon",48),e.EFF(3,"close"),e.k0s()()}if(2&i){const t=r.$implicit;e.Y8G("selectable",!0)("removable",!0),e.R7$(),e.SpI(" ",t," ")}}function kt(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",49)(1,"div",50)(2,"label",51),e.EFF(3),e.nI1(4,"translate"),e.j41(5,"span"),e.EFF(6,"*"),e.k0s()(),e.j41(7,"a-time-field",52),e.bIt("ngModelChange",function(o){e.eBV(t);const s=e.XpG(2);return e.Njj(s.form.patchValue({date:o}))}),e.k0s()(),e.j41(8,"div",50)(9,"label",53),e.EFF(10),e.nI1(11,"translate"),e.j41(12,"span"),e.EFF(13,"*"),e.k0s()(),e.j41(14,"a-time-field",54),e.bIt("ngModelChange",function(o){e.eBV(t);const s=e.XpG(2);return e.Njj(s.form.patchValue({date_end:o}))}),e.k0s()()()}if(2&i){let t;const n=e.XpG(2);e.R7$(3),e.SpI(" ",e.bMT(4,10,"FORM.START_TIME")," "),e.R7$(4),e.Y8G("ngModel",n.form.getRawValue().date)("ngModelOptions",e.lJ4(14,T))("use_24hr",n.use_24hr),e.R7$(3),e.SpI(" ",e.bMT(11,12,"FORM.END_TIME"),""),e.R7$(4),e.Y8G("ngModel",n.form.value.date_end||n.form.value.date+60*n.form.value.duration*1e3)("ngModelOptions",e.lJ4(15,T))("from",(null==n.form||null==(t=n.form.getRawValue())?null:t.date)+18e5)("use_24hr",n.use_24hr)("extra_info_fn",n.duration_info)}}function Mt(i,r){if(1&i&&(e.j41(0,"mat-option",55),e.EFF(1),e.k0s()),2&i){const t=r.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t," ")}}function jt(i,r){1&i&&(e.j41(0,"mat-option",56),e.EFF(1," No matching timezones "),e.k0s()),2&i&&e.Y8G("disabled",!0)}function Tt(i,r){if(1&i&&(e.j41(0,"mat-option",55),e.EFF(1),e.k0s()),2&i){const t=r.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.display_name||t.name," ")}}function It(i,r){if(1&i&&(e.j41(0,"mat-option",55),e.EFF(1),e.k0s()),2&i){const t=r.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.display_name||t.name," ")}}function wt(i,r){if(1&i&&(e.j41(0,"mat-option",55),e.EFF(1),e.k0s()),2&i){const t=r.$implicit;e.Y8G("value",t.id),e.R7$(),e.SpI(" ",t.display_name||t.name," ")}}function Ct(i,r){if(1&i){const t=e.RV6();e.qex(0),e.j41(1,"label",57),e.EFF(2,"Building Location"),e.k0s(),e.j41(3,"mat-form-field",32)(4,"mat-select",58),e.bIt("ngModelChange",function(o){e.eBV(t);const s=e.XpG(2);return s.form.controls.zones.setValue([o.parent_id,o.id]),e.Njj(s.setBuilding(o))}),e.DNE(5,Tt,2,2,"mat-option",35),e.nI1(6,"async"),e.k0s()(),e.j41(7,"div",59)(8,"div",60)(9,"label",61),e.EFF(10,"Level"),e.k0s(),e.j41(11,"mat-form-field",32)(12,"mat-select",62),e.bIt("ngModelChange",function(o){e.eBV(t);const s=e.XpG(2);return e.Njj(s.setLevel(o))}),e.DNE(13,It,2,2,"mat-option",35),e.nI1(14,"async"),e.k0s()()(),e.j41(15,"div",63)(16,"label",61),e.EFF(17,"Room"),e.k0s(),e.j41(18,"mat-form-field",32)(19,"mat-select",64),e.nI1(20,"async"),e.j41(21,"mat-option")(22,"i"),e.EFF(23,"None"),e.k0s()(),e.DNE(24,wt,2,2,"mat-option",35),e.nI1(25,"async"),e.k0s()()()(),e.bVm()}if(2&i){let t;const n=e.XpG(2);e.R7$(4),e.Y8G("ngModel",n.building_zone)("ngModelOptions",e.lJ4(16,T)),e.R7$(),e.Y8G("ngForOf",e.bMT(6,8,n.building_list)),e.R7$(7),e.Y8G("ngModel",n.level_zone)("ngModelOptions",e.lJ4(17,T)),e.R7$(),e.Y8G("ngForOf",e.bMT(14,10,n.active_levels)),e.R7$(6),e.Y8G("disabled",0===(null==(t=e.bMT(20,12,n.available_spaces))?null:t.length)),e.R7$(5),e.Y8G("ngForOf",e.bMT(25,14,n.available_spaces))}}function Rt(i,r){if(1&i){const t=e.RV6();e.j41(0,"div",5)(1,"a",6)(2,"app-icon"),e.EFF(3,"close"),e.k0s()(),e.j41(4,"form",7)(5,"h3",8),e.EFF(6),e.k0s(),e.j41(7,"section",9)(8,"label",10),e.EFF(9,"Event Title"),e.j41(10,"span"),e.EFF(11,"*"),e.k0s()(),e.qex(12),e.j41(13,"mat-form-field",11),e.nrm(14,"input",12),e.j41(15,"mat-error"),e.EFF(16),e.nI1(17,"translate"),e.k0s()(),e.j41(18,"label",13),e.EFF(19,"Organiser"),e.j41(20,"span"),e.EFF(21,"*"),e.k0s()(),e.nrm(22,"a-user-search-field",14),e.j41(23,"label",15),e.EFF(24,"Tags"),e.k0s(),e.j41(25,"mat-form-field",16)(26,"mat-chip-grid",17,1),e.DNE(28,Ft,4,3,"mat-chip-row",18),e.j41(29,"input",19),e.bIt("matChipInputTokenEnd",function(o){e.eBV(t);const s=e.XpG();return e.Njj(s.addTag(o))}),e.k0s()()(),e.j41(30,"div",20)(31,"mat-checkbox",21),e.EFF(32," Featured "),e.k0s(),e.j41(33,"mat-checkbox",22),e.bIt("ngModelChange",function(o){e.eBV(t);const s=e.XpG();return e.Njj(s.form.patchValue({permission:o?"OPEN":"PRIVATE"}))}),e.EFF(34," Publish "),e.k0s()(),e.bVm(),e.nrm(35,"div",23),e.j41(36,"h3",8),e.EFF(37,"Date and Time"),e.k0s(),e.qex(38),e.j41(39,"div",24)(40,"div",25)(41,"label",26),e.EFF(42),e.nI1(43,"translate"),e.j41(44,"span"),e.EFF(45,"*"),e.k0s()(),e.j41(46,"a-date-field",27),e.EFF(47),e.nI1(48,"translate"),e.k0s()(),e.j41(49,"div",25)(50,"label",26),e.EFF(51),e.nI1(52,"translate"),e.j41(53,"span"),e.EFF(54,"*"),e.k0s()(),e.j41(55,"a-date-field",28),e.EFF(56),e.nI1(57,"translate"),e.k0s()()(),e.DNE(58,kt,15,16,"div",29),e.j41(59,"div",30)(60,"label",31),e.pXf(61,3),e.k0s(),e.j41(62,"mat-form-field",32)(63,"app-icon",33),e.EFF(64," search "),e.k0s(),e.nrm(65,"input",34),e.k0s(),e.j41(66,"mat-autocomplete",null,2),e.DNE(68,Mt,2,2,"mat-option",35)(69,jt,2,1,"mat-option",36),e.k0s()(),e.bVm(),e.nrm(70,"div",23),e.j41(71,"h3",8),e.EFF(72,"Location"),e.k0s(),e.qex(73),e.j41(74,"div",37)(75,"button",38),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.form.patchValue({attendance_type:"ONSITE"}))}),e.j41(76,"app-icon",39),e.EFF(77,"domain"),e.k0s(),e.j41(78,"div",40),e.EFF(79,"On Premise"),e.k0s()(),e.j41(80,"button",38),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.form.patchValue({attendance_type:"ONLINE"}))}),e.j41(81,"app-icon",39),e.EFF(82,"laptop_mac"),e.k0s(),e.j41(83,"div",40),e.EFF(84,"Online Only"),e.k0s()(),e.j41(85,"button",38),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.form.patchValue({attendance_type:"ANY"}))}),e.j41(86,"app-icon",39),e.EFF(87,"add"),e.k0s(),e.j41(88,"div",40),e.EFF(89,"Both"),e.k0s()()(),e.DNE(90,Ct,26,18,"ng-container",41),e.bVm(),e.nrm(91,"div",23),e.j41(92,"h3",8),e.EFF(93,"Event Information"),e.k0s(),e.qex(94),e.j41(95,"label",10),e.EFF(96,"Event Description"),e.k0s(),e.nrm(97,"rich-text-input",42),e.j41(98,"label",15),e.EFF(99,"Images"),e.k0s(),e.nrm(100,"image-list-field",43),e.bVm(),e.k0s(),e.j41(101,"div",44)(102,"a",45),e.EFF(103," Cancel "),e.k0s(),e.j41(104,"button",46),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.save())}),e.EFF(105," Save "),e.k0s()()()()}if(2&i){const t=e.sdS(27),n=e.sdS(67),o=e.XpG();e.R7$(),e.Y8G("routerLink",e.lJ4(41,ne)),e.R7$(3),e.Y8G("formGroup",o.form),e.R7$(2),e.SpI(" ",o.form.value.id?"Edit":"New"," Group Event "),e.R7$(10),e.SpI(" ",e.bMT(17,31,"FORM.TITLE_ERROR")," "),e.R7$(12),e.Y8G("ngForOf",o.tag_list),e.R7$(),e.Y8G("matChipInputFor",t)("matChipInputSeparatorKeyCodes",o.separators)("matChipInputAddOnBlur",!0),e.R7$(4),e.Y8G("ngModel","OPEN"===o.form.value.permission)("ngModelOptions",e.lJ4(42,T)),e.R7$(9),e.SpI(" ",e.bMT(43,33,"FORM.DATE"),""),e.R7$(4),e.Y8G("to",o.end_date),e.R7$(),e.SpI(" ",e.bMT(48,35,"FORM.DATE_ERROR")," "),e.R7$(4),e.SpI(" ",e.bMT(52,37,"FORM.END_DATE"),""),e.R7$(4),e.Y8G("from",o.start_date)("to",o.end_date),e.R7$(),e.SpI(" ",e.bMT(57,39,"FORM.DATE_ERROR")," "),e.R7$(2),e.Y8G("ngIf",!o.form.value.all_day),e.R7$(7),e.Y8G("matAutocomplete",n),e.R7$(3),e.Y8G("ngForOf",o.filtered_timezones),e.R7$(),e.Y8G("ngIf",!o.timezones.length),e.R7$(6),e.AVh("inverse",!1)("inverse","ONSITE"!==o.form.value.attendance_type),e.R7$(5),e.AVh("inverse","ONLINE"!==o.form.value.attendance_type),e.R7$(5),e.AVh("inverse","ANY"!==o.form.value.attendance_type),e.R7$(5),e.Y8G("ngIf","ONLINE"!==o.form.value.attendance_type),e.R7$(12),e.Y8G("routerLink",e.lJ4(43,ne))}}function $t(i,r){1&i&&(e.j41(0,"div",65),e.nrm(1,"mat-spinner",66),e.j41(2,"p"),e.EFF(3,"Saving event..."),e.k0s()())}const Vt=[];let ie=(()=>{class i extends d.Tv{get tag_list(){return this.form.getRawValue().tags||Vt}get max_duration(){return this._settings.get("app.events.max_duration")||480}get use_24hr(){return this._settings.get("app.use_24_hour_time")}get building_zone(){const t=this.form.getRawValue().zones||[];return this._org.buildings.find(o=>t.includes(o.id))||this._org.building}get level_zone(){const t=this.form.getRawValue().zones;return this._org.levelWithID(t)}constructor(t,n,o,s,l,c,m){super(),this._form_state=t,this._event_form=n,this._state=o,this._route=s,this._router=l,this._org=c,this._settings=m,this.loading=!1,this.timezones=[],this.filtered_timezones=[],this.form=this._form_state.form,this.separators=[z.Fm,z.KE,z.t6],this.building_list=this._org.building_list,this.active_levels=this._org.active_levels,this.available_spaces=this._event_form.available_spaces,this.duration_info=u=>{const g=this.form.getRawValue().date;if((0,_.A)(g,"yyyy-MM-dd")!==(0,_.A)(u,"yyyy-MM-dd"))return"";const N=(0,mt.A)(u,g);return` (${(0,pt.A)({hours:Math.floor(N/60),minutes:N%60})})`}}ngOnInit(){var t=this;return(0,h.A)(function*(){yield t._org.initialised.pipe((0,ct.$)(n=>n)).toPromise(),t._form_state.setOptions({type:"group-event"}),t.form.patchValue({booking_type:"group-event",asset_id:`${(0,d.Ny)()?.name||(0,d.Ny)()?.email} [${(0,d.DU)(4)}]`,permission:"OPEN",zones:(0,d.Am)([t._org.organisation.id,t._org.building.id,t._org.building.parent_id]),location:t._org.building.address||t._org.building.display_name,user:(0,d.Ny)(),attendance_type:"ONSITE"}),t.subscription("route.params",t._route.paramMap.subscribe(function(){var n=(0,h.A)(function*(o){if(o.has("id")){const s=yield(0,E.DO)(o.get("id")).toPromise();if(!s)return t._router.navigate(["/entertainment","events"]);t._form_state.newForm(s),console.log("Booking:",s.tags),s.linked_event&&(t._event_form.newForm(new j.LR(s.linked_event)),t.form.patchValue({secondary_resource:s.linked_event.system_id})),t.form.patchValue({tags:s.tags,user:new ut.Gp({id:s.user_id,email:s.user_email,name:s.user_name})})}});return function(o){return n.apply(this,arguments)}}())),t.subscription("form_change",t.form.valueChanges.pipe((0,U.Z)(t.form.value)).subscribe(()=>{t._event_form.form.patchValue(t.form.value),t._event_form.setOptions({zone_ids:[t.level_zone?.id||t.building_zone?.id]})})),t.subscription("organiser_change",t.form.controls.user.valueChanges.subscribe(n=>{const o=n?.name||n?.email,s=(o?`${o} [${(0,d.DU)(4)}]`:"")||t.form.getRawValue().asset_id;t.form.patchValue({asset_id:s})})),t._updateTimezoneList(),t.subscription("tz-change",t.form.valueChanges.subscribe(()=>t._updateTimezoneList()))})()}setBuilding(t){this._org.building=t}setLevel(t){const n=(0,d.Am)([this._org.organisation.id,this._org.building.parent_id,this._org.building.id,t.id]);this.form.controls.zones.setValue(n)}addTag(t){if(!this.form||!this.form.controls.tags)return;const n=t.chipInput.inputElement,o=t.value,s=this.tag_list;(o||"").trim()&&(s.push(o),this.form.controls.tags.setValue(s)),n&&(n.value="")}removeTag(t){if(!this.form||!this.form.controls.tags)return;const n=this.tag_list,o=n.indexOf(t);o>=0&&(n.splice(o,1),this.form.controls.tags.setValue(n))}save(){var t=this;return(0,h.A)(function*(){if(t.form.markAllAsTouched(),!t.form.valid)return(0,d.UG)(`Some form fields are invalid. [${(0,d.F7)(t.form)}]`);t.loading=!0;const n=t._form_state.booking;if(n?.id&&(n.linked_event||t.form.getRawValue().secondary_resource)&&(n.linked_event&&(yield(0,j.Nn)(n.linked_event.event_id).toPromise().catch(l=>{throw(0,d.UG)(l),t.loading=!1,l})),yield(0,E.UN)(n.id).toPromise().catch(l=>{throw(0,d.UG)(l),t.loading=!1,l}),t._form_state.form.patchValue({id:null})),t.form.getRawValue().secondary_resource){const c=(yield t.available_spaces.pipe((0,R.s)(1)).toPromise()).find(g=>g.id===t.form.getRawValue().secondary_resource),m={...t.form.getRawValue()};delete m.id,console.log("Event value:",m),t._event_form.form.patchValue({...m,id:null,resources:[c]});const u=yield t._event_form.postForm().catch(g=>{throw(0,d.UG)(g),t.loading=!1,g});if(console.log("Event:",u),!u)return;t.form.patchValue({ical_uid:u.ical_uid,event_id:u.id,location:c.display_name||c.name})}t.form.patchValue({asset_name:""}),t.form.getRawValue().description||t.form.patchValue({description:" "});const o=t.form.getRawValue().date,s=yield t._form_state.postForm().catch(function(){var l=(0,h.A)(function*(c){(0,d.UG)(c),t.form.getRawValue().event_id&&(yield(0,j.Nn)(t.form.getRawValue().event_id).toPromise())});return function(c){return l.apply(this,arguments)}}());t._state.changed(),t.loading=!1,s&&t._router.navigate(["/entertainment","events"],{queryParams:{range:(0,D.A)(o).valueOf()}})})()}_updateTimezoneList(){const t=this.form?.value?.timezone||"";this.timezones=d.Rd,this.filtered_timezones=this.timezones.filter(n=>n.toLowerCase().includes(t.toLowerCase()))}static#e=this.\u0275fac=function(n){return new(n||i)(e.rXU(E.nx),e.rXU(j.Ws),e.rXU(F),e.rXU(v.nX),e.rXU(v.Ix),e.rXU(W.yb),e.rXU(d.h$))};static#t=this.\u0275cmp=e.VBU({type:i,selectors:[["app-event-manage"]],features:[e.Vt3],decls:3,vars:2,consts:()=>{let t;return t=$localize`:@@displayNameLabel␟23ba0a48c17b76008ce17f71f2ab2243ed7d8026␟3213117795366291168: Timezone: `,[["load_state",""],["chipList",""],["auto","matAutocomplete"],t,["class","absolute inset-0 bg-base-100 overflow-auto",4,"ngIf","ngIfElse"],[1,"absolute","inset-0","bg-base-100","overflow-auto"],["icon","","matRipple","",1,"sticky","top-2","right-2","ml-auto",3,"routerLink"],[1,"flex","flex-col","w-[40rem]","max-w-full","mx-auto","px-4",3,"formGroup"],[1,"py-4","text-2xl","font-medium"],[1,"flex","flex-col","space-y-2"],["for","title"],["appearance","outline",1,"w-full"],["matInput","","name","title","formControlName","title","placeholder","e.g. Team Meeting"],["for","host"],["name","host","formControlName","user",1,"block","mb-4"],["for","tags"],["appearance","outline",1,"no-subscript"],["aria-label","Event Tags"],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","Add new tags relevant to this event...",3,"matChipInputTokenEnd","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur"],[1,"py-4","flex","items-center","space-x-8"],["formControlName","featured"],[3,"ngModelChange","ngModel","ngModelOptions"],[1,"w-full","h-px","bg-base-200"],[1,"flex","items-center","flex-wrap","sm:space-x-2"],[1,"flex-1","min-w-[256px]","relative"],["for","date"],["name","date","formControlName","date",3,"to"],["name","date","formControlName","date_end",3,"from","to"],["class","flex items-center space-x-2",4,"ngIf"],[1,"flex","flex-col"],["for","display-name"],["appearance","outline"],["matPrefix","",1,"text-2xl"],["matInput","","formControlName","timezone","placeholder","Timezone",3,"matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],[1,"flex","items-center","space-x-2","pb-2"],["btn","","matRipple","",1,"flex-1",3,"click"],[1,"text-2xl"],[1,"mx-2"],[4,"ngIf"],["formControlName","description"],["formControlName","images"],[1,"flex","justify-end","space-x-2","sticky","bottom-0","w-full","bg-base-100","py-4"],["btn","","matRipple","",1,"inverse","w-32",3,"routerLink"],["btn","","matRipple","",1,"w-32",3,"click"],[3,"removed","selectable","removable"],["matChipRemove",""],[1,"flex","items-center","space-x-2"],[1,"flex-1","w-1/3"],["for","start-time"],["name","start-time",3,"ngModelChange","ngModel","ngModelOptions","use_24hr"],["for","end-time"],["name","end-time",3,"ngModelChange","ngModel","ngModelOptions","from","use_24hr","extra_info_fn"],[3,"value"],[3,"disabled"],["for","location"],["placeholder","Select Building",3,"ngModelChange","ngModel","ngModelOptions"],[1,"flex","space-x-2"],[1,"flex","flex-col","flex-[2]"],["for","level"],["placeholder","Select Level",3,"ngModelChange","ngModel","ngModelOptions"],[1,"flex","flex-col","flex-[3]"],["formControlName","secondary_resource","placeholder","Select Room",3,"disabled"],[1,"absolute","inset-0","bg-base-100","flex","flex-col","items-center","justify-center","space-y-4"],["diameter","48"]]},template:function(n,o){if(1&n&&e.DNE(0,Rt,106,44,"div",4)(1,$t,4,0,"ng-template",null,0,e.C5r),2&n){const s=e.sdS(2);e.Y8G("ngIf",!o.loading)("ngIfElse",s)}},dependencies:[p.Sq,p.bT,f.qT,f.me,f.BC,f.cb,f.vS,$.rl,$.TL,$.JW,vt.fg,q.VO,b.wT,ft.So,_t.LG,te.$3,te.pN,b.r6,f.j4,f.JD,gt.G,ht.t,bt.$,Et.d,yt.$,V.R,O.HW,O.D7,O.Zv,O.jH,v.Wk,p.Jj,xt.D9]})}return i})();var Gt=a(22168),Ot=a(63046);const Nt=[{path:"",component:S,children:[{path:"",component:dt}]},{path:"manage",component:ie},{path:"manage/:id",component:ie},{path:"**",redirectTo:""}];let At=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.$C({type:i});static#n=this.\u0275inj=e.G2t({imports:[p.MD,f.YN,w.r,Gt.lx,E.SG,j.jX,Ot.cQ,v.iI.forChild(Nt)]})}return i})()},68390:(oe,I,a)=>{a.d(I,{g8:()=>A,kR:()=>e.k,Gp:()=>S.Gp,N8:()=>w.N8,SZ:()=>w.SZ,is:()=>f.is});var e=a(11081),v=(a(11543),a(7282),a(67450));class A{constructor(d={}){this.type=d.type||d.location||"other",this.position=d.position||d.map_id||d.asset_id||{x:d.x/d.map_width||0,y:d.y/d.map_height||0},this.variance=d.variance||0,this.last_seen=d.last_seen||(0,v.A)(new Date),this.level=d.level,this.building=d.building,this.at_location=!!d.at_location,this.coordinates_from=d.coordinates_from||"top-left"}}var S=a(93693),f=(a(24129),a(86039)),w=a(2372)}}]);
//# sourceMappingURL=apps_concierge_src_app_events_events_module_ts.js.map