"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_events_events_module_ts"],{15696:(ie,C,a)=>{a.r(C),a.d(C,{EventsModule:()=>It});var e=a(29039),S=a(33005),G=a(19842),_=a(92649);const I=["app-events",""];let Q=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["","app-events",""]],attrs:I,decls:5,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"relative","flex","flex-col","flex-1","w-1/2","h-full"]],template:function(n,i){1&n&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1),e._UZ(4,"router-outlet"),e.qZA()())},dependencies:[S.O,G.u,_.lC],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=events.component.ts-angular-inline--145.css.map*/"]})}return o})();var m=a(26575),g=a(28849),O=a(97910),h=a(71670),c=a(34592),Z=a(78466),$=a(93121),W=a(67343),R=a(57016),H=a(4512),K=a(70462),se=a(28159),ae=a(85046),re=a(36520),y=a(47422),U=a(680),V=a(17401);let b=(()=>{class o extends c.cx{changed(){this._changed.next(Date.now())}get period(){return this._options.getValue()?.period}constructor(t,n,i,s){super(),this._settings=t,this._org=n,this._dialog=i,this._router=s,this._options=new K.X({period:"week"}),this._changed=new K.X(0),this.event_list=(0,se.aj)([this._org.active_building,this._options,this._changed]).pipe((0,ae.h)(([r])=>!!r),(0,re.w)(([r,d])=>(0,Z.F2)({period_start:(0,W.Z)((0,R.Z)(Math.max(Date.now(),d.date))),period_end:(0,W.Z)((0,H.Z)(d.end||d.date||Date.now())),type:"group-event",zones:d.zone_ids?.join(",")||r.id})),(0,y.U)(r=>r.sort((d,p)=>d.date-p.date)),(0,U.d)(1)),this.options=this._options.asObservable()}setOptions(t){this._options.next({...this._options.value,...t})}viewEvent(t){var n=this;const i=this._dialog.open(Z.Er,{data:{booking:t,concierge:!0}});this.subscription(`edit:${t.id}`,i.componentInstance.edit.subscribe(()=>{this._router.navigate(["/entertainment","events","manage",t.id])})),this.subscription(`remove:${t.id}`,i.componentInstance.remove.subscribe((0,h.Z)(function*(){yield n.removeEvent(t),i.close()})))}removeEvent(t){var n=this;return(0,h.Z)(function*(){const i=yield(0,c._5)({title:"Delete Event",content:`Are you sure you want to delete the event "${t.title}"?`,icon:{content:"delete"},confirm_text:"Delete"},n._dialog);"done"===i.reason&&(i.loading("Deleting event..."),yield(0,Z.pv)(t.id).toPromise().catch(s=>{throw(0,c.cB)(s),i.close(),s}),i.close(),(0,c.t5)("Successfully deleted event."),n._changed.next(Date.now()))})()}static#e=this.\u0275fac=function(n){return new(n||o)(e.LFG(c.gb),e.LFG($.w7),e.LFG(V.uw),e.LFG(_.F0))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var q=a(75930),M=a(81435),T=a(65822),B=a(2848),j=a(97929),v=a(14884),le=a(45083),L=a(46939),N=a(71268),X=a(96355),x=a(10257),J=a(94888),w=a(78128),ce=a(27442),D=a(33884),de=a(78075),pe=a(70828),me=a(6612),ue=a(3085),_e=a(60942);function ge(o,l){if(1&o&&e._UZ(0,"img",19),2&o){const t=e.oxw().row;e.Q6J("source",t.images[0])}}function ve(o,l){if(1&o&&(e.TgZ(0,"div",9)(1,"div",10)(2,"div",11),e._uU(3),e.ALo(4,"date"),e.qZA(),e.TgZ(5,"div",12),e._uU(6),e.ALo(7,"date"),e.qZA()(),e.TgZ(8,"div",13),e.YNc(9,ge,1,1,"img",14),e.qZA(),e.TgZ(10,"div",15)(11,"div",16),e._uU(12),e.qZA(),e.TgZ(13,"div",17),e._uU(14),e.ALo(15,"date"),e.ALo(16,"date"),e.qZA(),e.TgZ(17,"div",18),e._uU(18),e.ALo(19,"building"),e.ALo(20,"async"),e.ALo(21,"space"),e.qZA()()()),2&o){const t=l.row,n=e.oxw();let i;e.xp6(3),e.hij(" ",e.xi3(4,7,t.date,"MMM")," "),e.xp6(3),e.hij(" ",e.xi3(7,10,t.date,"d")," "),e.xp6(3),e.Q6J("ngIf",null==t.images?null:t.images.length),e.xp6(3),e.Oqu(t.title),e.xp6(2),e.AsE(" ",e.xi3(15,13,t.date,"EEEE, "+n.time_format)," \u2013 ",e.xi3(16,16,t.date+60*t.duration*1e3,n.time_format+" (z)")," "),e.xp6(4),e.hij(" ",null==(i=e.lcZ(19,19,null==(i=e.lcZ(20,21,e.lcZ(21,23,null==t.linked_event?null:t.linked_event.system_id)))?null:i.zones))?null:i.address," ")}}function fe(o,l){1&o&&(e.TgZ(0,"span",21),e._uU(1," No Level "),e.qZA())}function he(o,l){if(1&o&&(e._uU(0),e.ALo(1,"level"),e.ALo(2,"async"),e.ALo(3,"space"),e.YNc(4,fe,2,0,"span",20)),2&o){const t=l.row;let n;e.hij(" ",null==(n=e.lcZ(1,2,null==(n=e.lcZ(2,4,e.lcZ(3,6,null==t.linked_event?null:t.linked_event.system_id)))?null:n.zones))?null:n.display_name," "),e.xp6(4),e.Q6J("ngIf",!(null!=t.linked_event&&t.linked_event.system_id))}}function xe(o,l){1&o&&(e.TgZ(0,"span",21),e._uU(1," No Room "),e.qZA())}function Ze(o,l){if(1&o&&(e._uU(0),e.ALo(1,"async"),e.ALo(2,"space"),e.YNc(3,xe,2,0,"span",20)),2&o){const t=l.row;let n;e.hij(" ",null==(n=e.lcZ(1,2,e.lcZ(2,4,null==t.linked_event?null:t.linked_event.system_id)))?null:n.display_name," "),e.xp6(3),e.Q6J("ngIf",!(null!=t.linked_event&&t.linked_event.system_id))}}function ye(o,l){if(1&o&&(e.TgZ(0,"div",24),e._UZ(1,"attendee-list",25),e.qZA()),2&o){const t=e.oxw().row;e.xp6(),e.Q6J("list",t.attendees)("host",t.user_email)("hide_close",!0)("custom_title","Interested")}}function Te(o,l){if(1&o&&(e.TgZ(0,"button",22),e._uU(1),e.qZA(),e.YNc(2,ye,2,4,"ng-template",null,23,e.W1O)),2&o){const t=l.row,n=e.MAs(3);e.Q6J("content",n)("disabled",!(null!=t.attendees&&t.attendees.length)),e.xp6(),e.hij(" ",(null==t.attendees?null:t.attendees.length)||0," ")}}function be(o,l){if(1&o&&(e.TgZ(0,"div",24),e._UZ(1,"attendee-list",26),e.qZA()),2&o){const t=e.oxw().row,n=e.oxw();e.xp6(),e.Q6J("list",n.checkedInList(t.attendees))("host",t.user_email)("hide_close",!0)}}function we(o,l){if(1&o&&(e.TgZ(0,"button",22),e._uU(1),e.qZA(),e.YNc(2,be,2,3,"ng-template",null,23,e.W1O)),2&o){const t=l.row,n=e.MAs(3),i=e.oxw();e.Q6J("content",n)("disabled",!i.checkedInCount(t.attendees)),e.xp6(),e.hij(" ",i.checkedInCount(t.attendees)," ")}}function Me(o,l){1&o&&(e.TgZ(0,"div",28)(1,"app-icon"),e._uU(2,"done"),e.qZA()())}function Ae(o,l){if(1&o&&e.YNc(0,Me,3,0,"div",27),2&o){const t=l.row;e.Q6J("ngIf","OPEN"===t.permission||"open"===t.permission)}}function Ee(o,l){if(1&o&&(e.TgZ(0,"div",29),e._uU(1),e.qZA()),2&o){const t=l.row;e.ekj("bg-success","done"!==t.state&&"in_progress"!==t.state)("text-success-content","done"!==t.state&&"in_progress"!==t.state)("bg-warning","in_progress"===t.state)("text-warning-content","in_progress"===t.state)("bg-base-200","done"===t.state)("text-base-content","done"===t.state),e.xp6(),e.hij(" ","done"===t.state?"Done":"in_progress"===t.state?"In Progress":"Active"," ")}}const Ce=o=>["/entertainment","events","manage",o];function Oe(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",30)(1,"button",31)(2,"app-icon"),e._uU(3,"more_vert"),e.qZA()()(),e.TgZ(4,"mat-menu",null,32)(6,"button",33)(7,"div",9)(8,"app-icon",34),e._uU(9," confirmation_number "),e.qZA(),e.TgZ(10,"div",35),e._uU(11,"Promote Event"),e.qZA()()(),e.TgZ(12,"button",36),e.NdJ("click",function(){const s=e.CHM(t).row,r=e.oxw();return e.KtG(r.viewEvent(s))}),e.TgZ(13,"div",9)(14,"app-icon",34),e._uU(15,"visibility"),e.qZA(),e.TgZ(16,"div",35),e._uU(17,"View Event"),e.qZA()()(),e.TgZ(18,"a",37)(19,"div",9)(20,"app-icon",34),e._uU(21,"edit"),e.qZA(),e.TgZ(22,"div",35),e._uU(23,"Edit Event"),e.qZA()()(),e.TgZ(24,"button",33)(25,"div",9)(26,"app-icon",34),e._uU(27,"content_copy"),e.qZA(),e.TgZ(28,"div",35),e._uU(29,"Copy URL"),e.qZA()()(),e.TgZ(30,"button",36),e.NdJ("click",function(){const s=e.CHM(t).row,r=e.oxw();return e.KtG(r.removeEvent(s))}),e.TgZ(31,"div",9)(32,"app-icon",38),e._uU(33,"delete"),e.qZA(),e.TgZ(34,"div",35),e._uU(35,"Delete Event"),e.qZA()()()()}if(2&o){const t=l.row,n=e.MAs(5);e.xp6(),e.Q6J("matMenuTriggerFor",n)("disabled","done"===t.state),e.xp6(5),e.Q6J("disabled",!0),e.xp6(12),e.Q6J("routerLink",e.VKq(5,Ce,null==t?null:t.id)),e.xp6(6),e.Q6J("disabled",!0)}}const Ue=()=>["date","level","room","interested","attending","status","permissions","actions"],Le=()=>["Event","Level","Room","Interested","Attending","Status","Published"," "],Ne=()=>["24r","flex","10r","6r","6r","8r","5r","3.5r"],Je=(o,l,t,n,i,s,r,d)=>({date:o,level:l,room:t,interested:n,attending:i,status:s,permissions:r,actions:d});let ke=(()=>{class o{get time_format(){return this._settings.time_format}constructor(t,n){this._settings=t,this._state=n,this.event_list=this._state.event_list,this.viewEvent=i=>this._state.viewEvent(i),this.removeEvent=i=>this._state.removeEvent(i)}checkedInCount(t){return t?.length?t.filter(n=>n.checked_in).length:0}checkedInList(t){return t?.length?t.filter(n=>n.checked_in):[]}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(c.gb),e.Y36(b))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["event-listing"]],decls:17,vars:17,consts:[[1,"min-w-[72rem]","block",3,"dataSource","columns","display_column","column_size","template"],["event_template",""],["level_template",""],["room_template",""],["interested_template",""],["attending_template",""],["published_template",""],["status_template",""],["actions_template",""],[1,"flex","items-center","space-x-2"],["date","",1,"flex","flex-col","items-center","leading-tight","w-8"],["month","",1,"text-sm","font-medium","relative","top-0.5","opacity-60"],["day","",1,"text-2xl","font-light","relative","-top-0.5"],[1,"flex","items-center","justify-center","h-12","w-12","rounded","overflow-hidden","bg-base-200"],["auth","","class","min-h-full min-w-full",3,"source",4,"ngIf"],["details","",1,"flex","flex-col"],[1,"text-sm"],[1,"text-xs","opacity-40"],[1,"text-xs"],["auth","",1,"min-h-full","min-w-full",3,"source"],["class","opacity-30",4,"ngIf"],[1,"opacity-30"],["matRipple","","customTooltip","",1,"px-2","rounded","h-full","w-full","flex","items-center","justify-center",3,"content","disabled"],["view_attendees",""],[1,"relative","w-[20rem]","h-[28rem]","overflow-auto","bg-white","rounded","shadow"],[3,"list","host","hide_close","custom_title"],[3,"list","host","hide_close"],["class","rounded h-8 w-8 flex items-center justify-center text-2xl bg-success text-success-content mx-auto",4,"ngIf"],[1,"rounded","h-8","w-8","flex","items-center","justify-center","text-2xl","bg-success","text-success-content","mx-auto"],[1,"px-4","py-1","rounded-full"],[1,"w-full","flex","items-center","justify-end","space-x-2"],["icon","","matRipple","",3,"matMenuTriggerFor","disabled"],["menu","matMenu"],["mat-menu-item","",3,"disabled"],[1,"text-2xl"],[1,"mr-2"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"routerLink"],[1,"text-2xl","text-error"]],template:function(n,i){if(1&n&&(e._UZ(0,"custom-table",0),e.YNc(1,ve,22,25,"ng-template",null,1,e.W1O)(3,he,5,8,"ng-template",null,2,e.W1O)(5,Ze,4,6,"ng-template",null,3,e.W1O)(7,Te,4,3,"ng-template",null,4,e.W1O)(9,we,4,3,"ng-template",null,5,e.W1O)(11,Ae,1,1,"ng-template",null,6,e.W1O)(13,Ee,2,13,"ng-template",null,7,e.W1O)(15,Oe,36,7,"ng-template",null,8,e.W1O)),2&n){const s=e.MAs(2),r=e.MAs(4),d=e.MAs(6),p=e.MAs(8),u=e.MAs(10),f=e.MAs(12),P=e.MAs(14),Qt=e.MAs(16);e.Q6J("dataSource",i.event_list)("columns",e.DdM(5,Ue))("display_column",e.DdM(6,Le))("column_size",e.DdM(7,Ne))("template",e.qlk(8,Je,s,r,d,p,u,P,f,Qt))}},dependencies:[m.O5,w.VK,w.OP,w.p6,x.wG,J.o,ce.C,D.X,de.A,pe.r,_.rH,m.Ov,m.uU,me.M,ue.a,_e.X]})}return o})();var Fe=a(55702),Y=a(1062),ee=a(32522);function Pe(o,l){if(1&o&&(e.TgZ(0,"div",11)(1,"div",12),e._uU(2),e.qZA()()),2&o){const t=l.$implicit,n=l.index;e.xp6(2),e.AsE(" ",t," ",n>=12?"PM":"AM"," ")}}function Ie(o,l){if(1&o&&(e.TgZ(0,"div",13)(1,"div",14),e._uU(2),e.ALo(3,"date"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"date"),e.qZA()()),2&o){const t=l.$implicit;e.xp6(2),e.hij(" ",e.xi3(3,2,t,"EEEE")," "),e.xp6(3),e.Oqu(e.xi3(6,5,t,"d"))}}function Qe(o,l){1&o&&e._UZ(0,"div",15)}function Re(o,l){if(1&o&&(e.TgZ(0,"div",24),e._UZ(1,"group-event-card",25),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(),e.Q6J("event",t)}}function Ve(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw(2);return e.KtG(r.viewEvent(s))}),e._UZ(1,"div",20),e.TgZ(2,"div",21),e._uU(3),e.ALo(4,"date"),e.qZA(),e._UZ(5,"div",22),e.YNc(6,Re,2,1,"ng-template",null,23,e.W1O),e.qZA()}if(2&o){const t=l.$implicit,n=e.MAs(7);e.Udp("top",100*t.offset+"%")("height",100*t.length+"%"),e.xp6(3),e.AsE(" ",e.xi3(4,8,t.date,"shortTime")," \u2014 ",t.title," "),e.xp6(2),e.Q6J("content",n)("hover",!0)}}function qe(o,l){if(1&o&&(e.TgZ(0,"div",26),e._UZ(1,"div",27),e.qZA()),2&o){const t=e.oxw(2);e.Udp("top",100*t.now_offset+"%")}}const je=()=>[];function De(o,l){if(1&o&&(e.TgZ(0,"div",16),e.YNc(1,Ve,8,11,"button",17),e.ALo(2,"async"),e.YNc(3,qe,2,2,"div",18),e.qZA()),2&o){const t=l.$implicit,n=l.index,i=e.oxw();e.Udp("transform","translateX("+100*n+"%)"),e.xp6(),e.Q6J("ngForOf",e.lcZ(2,4,i.event_day_map)[i.dateString(t)]||e.DdM(6,je)),e.xp6(2),e.Q6J("ngIf",i.isCurrentDay(t))}}let Ye=(()=>{class o extends c.cx{dateString(t){return t?(0,v.Z)(t,"yyyy-MM-dd"):""}isCurrentDay(t){return!!t&&(0,v.Z)(Date.now(),"yyyy-MM-dd")===(0,v.Z)(t,"yyyy-MM-dd")}get now(){return(0,Fe.Z)(Date.now()).valueOf()}get now_offset(){const t=new Date(this.now);return(60*t.getHours()+t.getMinutes())/1440}constructor(t,n,i){super(),this._state=t,this._dialog=n,this._router=i,this.days=new Array(7).fill(0).map((s,r)=>r+1),this.hours=new Array(24).fill(0).map((s,r)=>r%12?r%12:12),this.event_list=this._state.event_list,this.event_day_map=this.event_list.pipe((0,y.U)(s=>{const r={};for(const d of s){const p=(0,v.Z)(d.date,"yyyy-MM-dd");r[p]||(r[p]=[]);const u=new Date(d.date);r[p].push({...d,offset:(60*u.getHours()+u.getMinutes())/1440,length:d.duration/1440})}return r}),(0,Y.O)({}),(0,U.d)(1)),this.viewEvent=s=>this._state.viewEvent(s)}ngOnInit(){this.subscription("date",this._state.options.subscribe(({date:t})=>{t&&(this.days=this.days.map((n,i)=>(0,T.Z)(t,i).valueOf()))}))}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(b),e.Y36(V.uw),e.Y36(_.F0))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["event-week-view"]],features:[e.qOj],decls:13,vars:8,consts:[[1,"absolute","inset-0","overflow-auto","flex"],[1,"sticky","left-0","w-24","min-h-full","flex","flex-col","items-end","z-20","bg-base-100"],["header","",1,"sticky","top-0","h-16","min-h-16","flex","justify-end","z-10"],[1,"bg-base-100","pt-6","h-10"],[1,"opacity-30","text-xs","px-2"],["class","relative min-h-10 w-full flex-1 bg-base-100",4,"ngFor","ngForOf"],[1,"relative","min-w-[84rem]","min-h-full","z-10"],["header","",1,"sticky","flex","top-0","h-16","min-h-16","border-b","border-base-200","bg-base-100","z-10"],["date","","class","flex flex-col items-center justify-center p-4 min-w-48 flex-1 border-r border-base-200",4,"ngFor","ngForOf"],["class","relative flex min-h-10 min-w-[84rem] flex-1 border-x border-b border-base-200 pointer-events-none",4,"ngFor","ngForOf"],["date","","class","absolute top-16 left-0 w-[calc(100%/7)] h-[60rem] flex-1 border-r border-base-200 pointer-events-none",3,"transform",4,"ngFor","ngForOf"],[1,"relative","min-h-10","w-full","flex-1","bg-base-100"],["hour","",1,"absolute","top-0","right-1","-translate-y-1/2","whitespace-nowrap","text-xs","opacity-60"],["date","",1,"flex","flex-col","items-center","justify-center","p-4","min-w-48","flex-1","border-r","border-base-200"],[1,"text-sm","opacity-60"],[1,"relative","flex","min-h-10","min-w-[84rem]","flex-1","border-x","border-b","border-base-200","pointer-events-none"],["date","",1,"absolute","top-16","left-0","w-[calc(100%/7)]","h-[60rem]","flex-1","border-r","border-base-200","pointer-events-none"],["matRipple","","class","absolute inset-x-1 bg-base-100 rounded border border-base-200 hover:border-info shadow pl-3 pr-2 py-1 overflow-hidden pointer-events-auto",3,"top","height","click",4,"ngFor","ngForOf"],["now","","class","absolute inset-x-0 h-0 border-y-2 border-base-content",3,"top",4,"ngIf"],["matRipple","",1,"absolute","inset-x-1","bg-base-100","rounded","border","border-base-200","hover:border-info","shadow","pl-3","pr-2","py-1","overflow-hidden","pointer-events-auto",3,"click"],[1,"absolute","left-0","inset-y-0","bg-info","w-1.5"],[1,"text-sm","opacity-60","h-full","text-left"],["customTooltip","","xPosition","center","yPosition","bottom",1,"absolute","inset-0",3,"content","hover"],["event_card",""],[1,"p-2","pointer-events-none"],[3,"event"],["now","",1,"absolute","inset-x-0","h-0","border-y-2","border-base-content"],[1,"absolute","left-0","top-0","-translate-x-1/2","-translate-y-1/2","h-4","w-4","rounded-full","bg-base-content"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e._uU(5),e.ALo(6,"date"),e.qZA()()(),e.YNc(7,Pe,3,2,"div",5),e.qZA(),e.TgZ(8,"div",6)(9,"div",7),e.YNc(10,Ie,7,8,"div",8),e.qZA(),e.YNc(11,Qe,1,0,"div",9)(12,De,4,7,"div",10),e.qZA()()),2&n&&(e.xp6(5),e.hij(" ",e.xi3(6,5,i.now,"zzzz")," "),e.xp6(2),e.Q6J("ngForOf",i.hours),e.xp6(3),e.Q6J("ngForOf",i.days),e.xp6(),e.Q6J("ngForOf",i.hours),e.xp6(),e.Q6J("ngForOf",i.days))},dependencies:[m.sg,m.O5,x.wG,D.X,ee.z,m.Ov,m.uU]})}return o})();var ze=a(77393),Se=a(52665),Ge=a(60702);function $e(o,l){if(1&o&&(e.TgZ(0,"div",4),e._uU(1),e.ALo(2,"date"),e.qZA()),2&o){const t=l.$implicit;e.xp6(),e.hij(" ",e.xi3(2,1,t,"EEEE")," ")}}function We(o,l){if(1&o&&(e.TgZ(0,"div",16),e._UZ(1,"group-event-card",17),e.qZA()),2&o){const t=e.oxw().$implicit;e.xp6(),e.Q6J("event",t)}}function He(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"button",11),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw(2);return e.KtG(r.viewEvent(s))}),e._UZ(1,"div",12),e.TgZ(2,"div",13),e._uU(3),e.ALo(4,"date"),e.qZA(),e._UZ(5,"div",14),e.YNc(6,We,2,1,"ng-template",null,15,e.W1O),e.qZA()}if(2&o){const t=l.$implicit,n=e.MAs(7);e.xp6(3),e.AsE(" ",e.xi3(4,4,t.date,"shortTime")," \u2014 ",t.title," "),e.xp6(2),e.Q6J("content",n)("hover",!0)}}const k=()=>[];function Ke(o,l){if(1&o&&(e.TgZ(0,"button",18),e._uU(1),e.ALo(2,"async"),e.qZA()),2&o){const t=e.oxw().$implicit,n=e.MAs(10),i=e.oxw();e.Q6J("matMenuTriggerFor",n),e.xp6(),e.hij(" ",(e.lcZ(2,2,i.event_day_map)[i.dateString(t.id)]||e.DdM(4,k)).length-3," more event(s) ")}}function Be(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"button",19),e.NdJ("click",function(){const s=e.CHM(t).$implicit,r=e.oxw(2);return e.KtG(r.viewEvent(s))}),e.TgZ(1,"div",20)(2,"div",21),e._uU(3),e.qZA(),e.TgZ(4,"div",22),e._uU(5),e.ALo(6,"date"),e.qZA()()()}if(2&o){const t=l.$implicit;e.xp6(3),e.Oqu(t.title),e.xp6(2),e.hij(" ",e.xi3(6,2,t.date,"shortTime")," ")}}function Xe(o,l){if(1&o&&(e.TgZ(0,"div",5)(1,"div",6),e._uU(2),e.ALo(3,"date"),e.qZA(),e.YNc(4,He,8,7,"button",7),e.ALo(5,"slice"),e.ALo(6,"async"),e.YNc(7,Ke,3,5,"button",8),e.ALo(8,"async"),e.TgZ(9,"mat-menu",null,9),e.YNc(11,Be,7,5,"button",10),e.ALo(12,"slice"),e.ALo(13,"async"),e.qZA()()),2&o){const t=l.$implicit,n=e.oxw();e.xp6(),e.ekj("opacity-30",!t.is_month)("bg-secondary",t.is_today)("text-secondary-content",t.is_today),e.xp6(),e.hij(" ",e.xi3(3,10,t.id,"d")," "),e.xp6(2),e.Q6J("ngForOf",e.Dn7(5,13,e.lcZ(6,17,n.event_day_map)[n.dateString(t.id)]||e.DdM(26,k),0,3)),e.xp6(3),e.Q6J("ngIf",(e.lcZ(8,19,n.event_day_map)[n.dateString(t.id)]||e.DdM(27,k)).length>3),e.xp6(4),e.Q6J("ngForOf",e.xi3(12,21,e.lcZ(13,24,n.event_day_map)[n.dateString(t.id)]||e.DdM(28,k),3))}}let et=(()=>{class o extends c.cx{dateString(t){return t?(0,v.Z)(t,"yyyy-MM-dd"):""}get offset_weekday(){return this._settings.get("app.week_start")||0}constructor(t,n,i,s){super(),this._state=t,this._settings=n,this._dialog=i,this._router=s,this.month=(0,R.Z)(Date.now()).valueOf(),this.weekdays=[],this.month_days=[],this.event_list=this._state.event_list,this.event_day_map=this.event_list.pipe((0,y.U)(r=>{const d={};for(const p of r){const u=(0,v.Z)(p.date,"yyyy-MM-dd");d[u]||(d[u]=[]);const f=new Date(p.date);d[u].push({...p,offset:(60*f.getHours()+f.getMinutes())/1440,length:p.duration/1440})}return d}),(0,Y.O)({}),(0,U.d)(1)),this.viewEvent=r=>this._state.viewEvent(r)}ngOnInit(){this.subscription("date",this._state.options.subscribe(({date:t})=>{this.month=t,this._setMonthDays(),this._setWeekdays()})),this._setMonthDays(),this._setWeekdays()}_setMonthDays(){const t=(0,j.Z)((0,B.Z)(this.month),{weekStartsOn:this.offset_weekday});this.month_days=Array.from(Array(42).keys()).map(n=>{const i=(0,T.Z)(t,n).valueOf();return{id:i,is_today:(0,ze.Z)(i,Date.now()),is_month:(0,Se.Z)(i,this.month)}})}_setWeekdays(){const t=(0,j.Z)(Date.now(),{weekStartsOn:this.offset_weekday});this.weekdays=Array.from(Array(7).keys()).map(n=>(0,T.Z)(t,n))}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(b),e.Y36(c.gb),e.Y36(V.uw),e.Y36(_.F0))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["event-month-view"]],features:[e.qOj],decls:4,vars:2,consts:[[1,"absolute","inset-0","overflow-auto"],[1,"grid","grid-cols-7","min-w-full","w-[80rem]","min-h-full","h-[56rem]","m-2","border-b","border-base-200"],["weekday","","class","relative flex items-center justify-center text-sm opacity-60 p-2 h-12",4,"ngFor","ngForOf"],["monthday","","class","relative border border-base-200 flex flex-col space-y-1",4,"ngFor","ngForOf"],["weekday","",1,"relative","flex","items-center","justify-center","text-sm","opacity-60","p-2","h-12"],["monthday","",1,"relative","border","border-base-200","flex","flex-col","space-y-1"],[1,"rounded-full","w-8","h-8","flex","items-center","justify-center","mt-1","ml-1"],["matRipple","","class","relative w-[calc(100%-0.5rem)] h-7 bg-base-100 rounded border border-base-200 hover:border-info shadow pl-3 pr-2 py-1 overflow-hidden mx-1",3,"click",4,"ngFor","ngForOf"],["matRipple","","matTooltip","More events","class","relative w-[calc(100%-0.5rem)] h-7 rounded pl-3 pr-2 py-1 overflow-hidden mx-1 underline text-sm",3,"matMenuTriggerFor",4,"ngIf"],["menu","matMenu"],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["matRipple","",1,"relative","w-[calc(100%-0.5rem)]","h-7","bg-base-100","rounded","border","border-base-200","hover:border-info","shadow","pl-3","pr-2","py-1","overflow-hidden","mx-1",3,"click"],[1,"absolute","left-0","inset-y-0","bg-info","w-1.5"],[1,"text-sm","opacity-60","h-full","text-left","truncate"],["customTooltip","","xPosition","center","yPosition","bottom",1,"absolute","inset-0",3,"content","hover"],["event_card",""],[1,"p-2","pointer-events-none"],[3,"event"],["matRipple","","matTooltip","More events",1,"relative","w-[calc(100%-0.5rem)]","h-7","rounded","pl-3","pr-2","py-1","overflow-hidden","mx-1","underline","text-sm",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-4"],[1,"flex-1"],[1,"text-xs","opacity-60","py-1","px-2","rounded","bg-base-200","text-base-content"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,$e,3,4,"div",2)(3,Xe,14,29,"div",3),e.qZA()()),2&n&&(e.xp6(2),e.Q6J("ngForOf",i.weekdays),e.xp6(),e.Q6J("ngForOf",i.month_days))},dependencies:[m.sg,m.O5,w.VK,w.OP,w.p6,Ge.gM,x.wG,D.X,ee.z,m.Ov,m.OU,m.uU],styles:[".grid[_ngcontent-%COMP%]{grid-template-rows:3rem repeat(6,minmax(0,1fr))}\n\n/*# sourceMappingURL=event-month-view.component.ts-angular-inline--147.css.map*/"]})}return o})();function tt(o,l){if(1&o&&(e.TgZ(0,"span",12),e._uU(1),e.ALo(2,"async"),e.qZA()),2&o){const t=e.oxw();e.xp6(),e.Oqu("week"===e.lcZ(2,1,t.period)?"This Week":"This Month")}}function nt(o,l){1&o&&e._UZ(0,"event-week-view")}function ot(o,l){1&o&&e._UZ(0,"event-month-view")}let it=(()=>{class o{get time_format(){return this._settings.time_format}constructor(t,n,i,s){this._settings=t,this._state=n,this._router=i,this._route=s,this.period=this._state.options.pipe((0,y.U)(r=>r.period)),this.options=this._state.options,this.is_today=this.options.pipe((0,y.U)(r=>r.date<=Date.now()&&r.end>Date.now())),this.event_list=this._state.event_list,this.event_day_map=this.event_list.pipe((0,y.U)(r=>{const d={};for(const p of r){const u=(0,v.Z)(p.date,"yyyy-MM-dd");d[u]||(d[u]=[]),d[u].push(p)}return d}),(0,U.d)(1))}setPeriod(t){this._state.setOptions({period:t}),this._router.navigate([],{relativeTo:this._route,queryParams:{period:t},queryParamsHandling:"merge"})}nextPeriod(){var t=this;return(0,h.Z)(function*(){const{date:n,period:i}=yield t.options.pipe((0,L.q)(1)).toPromise();t._router.navigate([],{relativeTo:t._route,queryParams:{range:"week"===i?(0,q.Z)(n,1).valueOf():(0,M.Z)(n,1).valueOf()},queryParamsHandling:"merge"})})()}previousPeriod(){var t=this;return(0,h.Z)(function*(){const{date:n,period:i}=yield t.options.pipe((0,L.q)(1)).toPromise();t._router.navigate([],{relativeTo:t._route,queryParams:{range:"week"===i?(0,q.Z)(n,-1).valueOf():(0,M.Z)(n,-1).valueOf()},queryParamsHandling:"merge"})})()}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(c.gb),e.Y36(b),e.Y36(_.F0),e.Y36(_.gz))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["event-calendar"]],decls:28,vars:21,consts:[[1,"flex","items-center","border-y","border-base-200","w-full"],[1,"flex-1","px-2","py-4"],["class","text-info text-xs",4,"ngIf"],[1,"flex-2","flex","items-center","justify-center","space-x-2"],[1,"font-medium","pl-4"],["icon","","matRipple","",3,"click"],[1,"flex-1","flex","items-center","justify-end","space-x-2","py-2"],["btn","","matRipple","",1,"rounded-3xl",3,"click"],[1,"w-full","h-4"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["month_calendar",""],[1,"text-info","text-xs"]],template:function(n,i){if(1&n&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,tt,3,3,"span",2),e.ALo(3,"async"),e.qZA(),e.TgZ(4,"div",3)(5,"div",4),e._uU(6),e.ALo(7,"date"),e.ALo(8,"async"),e.qZA(),e.TgZ(9,"button",5),e.NdJ("click",function(){return i.previousPeriod()}),e.TgZ(10,"app-icon"),e._uU(11,"chevron_left"),e.qZA()(),e.TgZ(12,"button",5),e.NdJ("click",function(){return i.nextPeriod()}),e.TgZ(13,"app-icon"),e._uU(14,"chevron_right"),e.qZA()()(),e.TgZ(15,"div",6)(16,"button",7),e.NdJ("click",function(){return i.setPeriod("week")}),e.ALo(17,"async"),e._uU(18," Week "),e.qZA(),e.TgZ(19,"button",7),e.NdJ("click",function(){return i.setPeriod("month")}),e.ALo(20,"async"),e._uU(21," Month "),e.qZA()()(),e._UZ(22,"div",8),e.TgZ(23,"div",9),e.YNc(24,nt,1,0,"event-week-view",10),e.ALo(25,"async"),e.YNc(26,ot,1,0,"ng-template",null,11,e.W1O),e.qZA()),2&n){const s=e.MAs(27);let r;e.xp6(2),e.Q6J("ngIf",e.lcZ(3,8,i.is_today)),e.xp6(4),e.hij(" ",e.xi3(7,10,null==(r=e.lcZ(8,13,i.options))?null:r.date,"MMM yyyy")," "),e.xp6(10),e.ekj("inverse","week"!==e.lcZ(17,15,i.period)),e.xp6(3),e.ekj("inverse","month"!==e.lcZ(20,17,i.period)),e.xp6(5),e.Q6J("ngIf","month"!==e.lcZ(25,19,i.period))("ngIfElse",s)}},dependencies:[m.O5,x.wG,J.o,Ye,et,m.Ov,m.uU],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}\n\n/*# sourceMappingURL=event-calendar.component.ts-angular-inline--148.css.map*/"]})}return o})();function st(o,l){if(1&o&&(e.TgZ(0,"mat-option",22),e._uU(1),e.qZA()),2&o){const t=l.$implicit;e.Q6J("value",t.id),e.xp6(),e.hij(" ",t.display," ")}}function at(o,l){1&o&&e._UZ(0,"event-listing")}function rt(o,l){if(1&o&&(e._UZ(0,"event-calendar",23),e.ALo(1,"async")),2&o){const t=e.oxw();e.Q6J("period",e.lcZ(1,1,t.period))}}const lt=()=>["/entertainment","events","manage"];let ct=(()=>{class o extends c.cx{constructor(t,n,i,s){super(),this._settings=t,this._state=n,this._router=i,this._route=s,this.period=this._state.options.pipe((0,y.U)(r=>r.period),(0,le.x)()),this.view="list",this.period_list=[]}ngOnInit(){this.subscription("period",this.period.subscribe(()=>{this._generatePeriods(),this._initPeriod()})),this._generatePeriods(),this._initPeriod(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{t.has("view")&&(this.view=t.get("view")),t.has("period")&&t.get("period")!==this._state.period&&this.setPeriodType(t.get("period"),!1),this._generatePeriods(),t.has("range")&&this.timeout("update",()=>{const n=parseInt(t.get("range"),10),i=this.period_list.find(s=>n>=s.start&&n<s.end)||this.period_list[0]||{start:n,end:"week"===this._state.period?(0,q.Z)(n,1).valueOf():(0,M.Z)(n,1).valueOf()};this.selected_range=i.id||n,this._state.setOptions({date:i.start,end:i.end}),this.setPeriod(this.selected_range)})}))}setView(t){this.view=t,this._router.navigate([],{relativeTo:this._route,queryParams:{view:t},queryParamsHandling:"merge"})}setPeriodType(t,n=!0){this._state.setOptions({period:t}),n&&this._router.navigate([],{relativeTo:this._route,queryParams:{period:t},queryParamsHandling:"merge"})}setPeriod(t){this.timeout("set_period",()=>{const n=this.period_list.find(r=>t>=r.start&&t<r.end)||this.period_list[0];if(!n)return;this.selected_range=n.id;const{start:i,end:s}=n;this._state.setOptions({date:i,end:s}),this._router.navigate([],{relativeTo:this._route,queryParams:{range:t},queryParamsHandling:"merge"})})}_generatePeriods(){var t=this;this.timeout("generate_periods",(0,h.Z)(function*(){const n=[],i=yield t.period.pipe((0,L.q)(1)).toPromise();let s=Date.now();const r=(0,T.Z)(s,360).valueOf(),d=t._settings.get("app.week_start")||0;for("month"===i?s=(0,B.Z)(s).valueOf():"week"===i&&(s=(0,j.Z)(s,{weekStartsOn:d}).valueOf());s<r;)if("week"===i){const p=(0,H.Z)((0,T.Z)(s,6)).valueOf();n.push({id:s,start:s,end:p,display:`${(0,v.Z)(Math.max(Date.now(),s),"EEE, do MMM")} \u2013 ${(0,v.Z)(p,"do MMM")}`}),s=(0,T.Z)(s,7).valueOf()}else{if("month"!==i)break;{const p=(0,T.Z)((0,M.Z)(s,1),-1).valueOf();n.push({id:s,start:s,end:p,display:`${(0,v.Z)(s,"MMMM yyyy")}`}),s=(0,M.Z)(s,1).valueOf()}}t.period_list=n}))}_initPeriod(){this.timeout("update",()=>{this.period_list.length&&(this.setPeriod(this.period_list[0].id),this.selected_range=this.period_list[0].id)},350)}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(c.gb),e.Y36(b),e.Y36(_.F0),e.Y36(_.gz))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-event-list"]],features:[e.qOj],decls:37,vars:15,consts:[[1,"absolute","inset-0","flex","flex-col"],[1,"flex","items-center","justify-between","p-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"routerLink"],[1,"ml-2"],[1,"text-2xl"],["filters","",1,"flex","items-center","px-8","space-x-2","pb-4"],["btn","","matRipple","",1,"rounded-3xl",3,"click"],[1,"flex","items-center","space-x-2"],[1,"text-xl"],[1,"pr-2"],[1,"h-full","px-2"],[1,"w-px","h-full","bg-base-300"],["appearance","outline",1,"w-32","no-subscript"],[3,"ngModel","ngModelChange"],["value","week"],["value","month"],["appearance","outline",1,"w-64","no-subscript"],[3,"value",4,"ngFor","ngForOf"],[1,"h-1/2","flex-1","w-full","px-8","overflow-auto","relative"],[4,"ngIf"],[3,"period",4,"ngIf"],[3,"value"],[3,"period"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),e._uU(3,"Events"),e.qZA(),e.TgZ(4,"a",3)(5,"div",4),e._uU(6,"Create Event"),e.qZA(),e.TgZ(7,"app-icon",5),e._uU(8,"chevron_right"),e.qZA()()(),e.TgZ(9,"div",6)(10,"button",7),e.NdJ("click",function(){return i.setView("list")}),e.TgZ(11,"div",8)(12,"app-icon",9),e._uU(13,"list"),e.qZA(),e.TgZ(14,"div",10),e._uU(15,"List"),e.qZA()()(),e.TgZ(16,"button",7),e.NdJ("click",function(){return i.setView("calendar")}),e.TgZ(17,"div",8)(18,"app-icon",9),e._uU(19,"event"),e.qZA(),e.TgZ(20,"div",10),e._uU(21,"Calendar"),e.qZA()()(),e.TgZ(22,"div",11),e._UZ(23,"div",12),e.qZA(),e.TgZ(24,"mat-form-field",13)(25,"mat-select",14),e.NdJ("ngModelChange",function(r){return i.setPeriodType(r)}),e.ALo(26,"async"),e.TgZ(27,"mat-option",15),e._uU(28,"Week"),e.qZA(),e.TgZ(29,"mat-option",16),e._uU(30,"Month"),e.qZA()()(),e.TgZ(31,"mat-form-field",17)(32,"mat-select",14),e.NdJ("ngModelChange",function(r){return i.selected_range=r})("ngModelChange",function(r){return i.setPeriod(r)}),e.YNc(33,st,2,2,"mat-option",18),e.qZA()()(),e.TgZ(34,"div",19),e.YNc(35,at,1,0,"event-listing",20)(36,rt,2,3,"event-calendar",21),e.qZA()()),2&n&&(e.xp6(4),e.Q6J("routerLink",e.DdM(14,lt)),e.xp6(6),e.ekj("inverse","list"!==i.view),e.xp6(6),e.ekj("inverse","calendar"!==i.view),e.xp6(9),e.Q6J("ngModel",e.lcZ(26,12,i.period)),e.xp6(7),e.Q6J("ngModel",i.selected_range),e.xp6(),e.Q6J("ngForOf",i.period_list),e.xp6(),e.ekj("mb-4","list"===i.view),e.xp6(),e.Q6J("ngIf","list"===i.view),e.xp6(),e.Q6J("ngIf","calendar"===i.view))},dependencies:[m.sg,m.O5,g.JJ,g.On,N.KE,X.gD,x.ey,x.wG,J.o,_.rH,ke,it,m.Ov],styles:["[_nghost-%COMP%]{flex:1}\n\n/*# sourceMappingURL=events-list.component.ts-angular-inline--146.css.map*/"]})}return o})();var z=a(30554),dt=a(17627),pt=a(29737),mt=a(6324),A=a(91781),ut=a(59524),_t=a(99674),gt=a(56658),vt=a(33910),te=a(99892),ft=a(46362),ht=a(59590),xt=a(20576),Zt=a(53313),yt=a(64035),F=a(21757),Tt=a(21916);function bt(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"mat-chip-row",47),e.NdJ("removed",function(){const s=e.CHM(t).$implicit,r=e.oxw(2);return e.KtG(r.removeTag(s))}),e._uU(1),e.TgZ(2,"app-icon",48),e._uU(3,"close"),e.qZA()()}if(2&o){const t=l.$implicit;e.Q6J("selectable",!0)("removable",!0),e.xp6(),e.hij(" ",t," ")}}const E=()=>({standalone:!0});function wt(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",49)(1,"div",50)(2,"label",51),e._uU(3),e.ALo(4,"translate"),e.TgZ(5,"span"),e._uU(6,"*"),e.qZA()(),e.TgZ(7,"a-time-field",52),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.form.patchValue({date:i}))}),e.qZA()(),e.TgZ(8,"div",50)(9,"label",53),e._uU(10),e.ALo(11,"translate"),e.TgZ(12,"span"),e._uU(13,"*"),e.qZA()(),e.TgZ(14,"a-time-field",54),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.form.patchValue({date_end:i}))}),e.qZA()()()}if(2&o){const t=e.oxw(2);let n;e.xp6(3),e.hij(" ",e.lcZ(4,10,"FORM.START_TIME")," "),e.xp6(4),e.Q6J("ngModel",t.form.getRawValue().date)("ngModelOptions",e.DdM(14,E))("use_24hr",t.use_24hr),e.xp6(3),e.hij(" ",e.lcZ(11,12,"FORM.END_TIME"),""),e.xp6(4),e.Q6J("ngModel",t.form.value.date_end||t.form.value.date+60*t.form.value.duration*1e3)("ngModelOptions",e.DdM(15,E))("from",(null==t.form||null==(n=t.form.getRawValue())?null:n.date)+18e5)("use_24hr",t.use_24hr)("extra_info_fn",t.duration_info)}}function Mt(o,l){if(1&o&&(e.TgZ(0,"mat-option",55),e._uU(1),e.qZA()),2&o){const t=l.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t," ")}}function At(o,l){1&o&&(e.TgZ(0,"mat-option",56),e._uU(1," No matching timezones "),e.qZA()),2&o&&e.Q6J("disabled",!0)}function Et(o,l){if(1&o&&(e.TgZ(0,"mat-option",55),e._uU(1),e.qZA()),2&o){const t=l.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function Ct(o,l){if(1&o&&(e.TgZ(0,"mat-option",55),e._uU(1),e.qZA()),2&o){const t=l.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function Ot(o,l){if(1&o&&(e.TgZ(0,"mat-option",55),e._uU(1),e.qZA()),2&o){const t=l.$implicit;e.Q6J("value",t.id),e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function Ut(o,l){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"label",57),e._uU(2,"Building Location"),e.qZA(),e.TgZ(3,"mat-form-field",31)(4,"mat-select",58),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return s.form.controls.zones.setValue([i.parent_id,i.id]),e.KtG(s.setBuilding(i))}),e.YNc(5,Et,2,2,"mat-option",35),e.ALo(6,"async"),e.qZA()(),e.TgZ(7,"div",59)(8,"div",60)(9,"label",61),e._uU(10,"Level"),e.qZA(),e.TgZ(11,"mat-form-field",31)(12,"mat-select",62),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw(2);return e.KtG(s.setLevel(i))}),e.YNc(13,Ct,2,2,"mat-option",35),e.ALo(14,"async"),e.qZA()()(),e.TgZ(15,"div",63)(16,"label",61),e._uU(17,"Room"),e.qZA(),e.TgZ(18,"mat-form-field",31)(19,"mat-select",64),e.ALo(20,"async"),e.TgZ(21,"mat-option")(22,"i"),e._uU(23,"None"),e.qZA()(),e.YNc(24,Ot,2,2,"mat-option",35),e.ALo(25,"async"),e.qZA()()()(),e.BQk()}if(2&o){const t=e.oxw(2);let n;e.xp6(4),e.Q6J("ngModel",t.building_zone)("ngModelOptions",e.DdM(16,E)),e.xp6(),e.Q6J("ngForOf",e.lcZ(6,8,t.building_list)),e.xp6(7),e.Q6J("ngModel",t.level_zone)("ngModelOptions",e.DdM(17,E)),e.xp6(),e.Q6J("ngForOf",e.lcZ(14,10,t.active_levels)),e.xp6(6),e.Q6J("disabled",0===(null==(n=e.lcZ(20,12,t.available_spaces))?null:n.length)),e.xp6(5),e.Q6J("ngForOf",e.lcZ(25,14,t.available_spaces))}}const ne=()=>["/entertainment","events"];function Lt(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"div",2)(1,"a",3)(2,"app-icon"),e._uU(3,"close"),e.qZA()(),e.TgZ(4,"form",4)(5,"h3",5),e._uU(6),e.qZA(),e.TgZ(7,"section",6)(8,"label",7),e._uU(9,"Event Title"),e.TgZ(10,"span"),e._uU(11,"*"),e.qZA()(),e.ynx(12),e.TgZ(13,"mat-form-field",8),e._UZ(14,"input",9),e.TgZ(15,"mat-error"),e._uU(16),e.ALo(17,"translate"),e.qZA()(),e.TgZ(18,"label",10),e._uU(19,"Organiser"),e.TgZ(20,"span"),e._uU(21,"*"),e.qZA()(),e._UZ(22,"a-user-search-field",11),e.TgZ(23,"label",12),e._uU(24,"Tags"),e.qZA(),e.TgZ(25,"mat-form-field",13)(26,"mat-chip-grid",14,15),e.YNc(28,bt,4,3,"mat-chip-row",16),e.TgZ(29,"input",17),e.NdJ("matChipInputTokenEnd",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.addTag(i))}),e.qZA()()(),e.TgZ(30,"div",18)(31,"mat-checkbox",19),e._uU(32," Featured "),e.qZA(),e.TgZ(33,"mat-checkbox",20),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.form.patchValue({permission:i?"OPEN":"PRIVATE"}))}),e._uU(34," Publish "),e.qZA()(),e.BQk(),e._UZ(35,"div",21),e.TgZ(36,"h3",5),e._uU(37,"Date and Time"),e.qZA(),e.ynx(38),e.TgZ(39,"div",22)(40,"div",23)(41,"label",24),e._uU(42),e.ALo(43,"translate"),e.TgZ(44,"span"),e._uU(45,"*"),e.qZA()(),e.TgZ(46,"a-date-field",25),e._uU(47),e.ALo(48,"translate"),e.qZA()(),e.TgZ(49,"div",23)(50,"label",24),e._uU(51),e.ALo(52,"translate"),e.TgZ(53,"span"),e._uU(54,"*"),e.qZA()(),e.TgZ(55,"a-date-field",26),e._uU(56),e.ALo(57,"translate"),e.qZA()()(),e.YNc(58,wt,15,16,"div",27),e.TgZ(59,"div",28)(60,"label",29),e.SDv(61,30),e.qZA(),e.TgZ(62,"mat-form-field",31)(63,"app-icon",32),e._uU(64," search "),e.qZA(),e._UZ(65,"input",33),e.qZA(),e.TgZ(66,"mat-autocomplete",null,34),e.YNc(68,Mt,2,2,"mat-option",35)(69,At,2,1,"mat-option",36),e.qZA()(),e.BQk(),e._UZ(70,"div",21),e.TgZ(71,"h3",5),e._uU(72,"Location"),e.qZA(),e.ynx(73),e.TgZ(74,"div",37)(75,"button",38),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.form.patchValue({attendance_type:"ONSITE"}))}),e.TgZ(76,"app-icon",39),e._uU(77,"domain"),e.qZA(),e.TgZ(78,"div",40),e._uU(79,"On Premise"),e.qZA()(),e.TgZ(80,"button",38),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.form.patchValue({attendance_type:"ONLINE"}))}),e.TgZ(81,"app-icon",39),e._uU(82,"laptop_mac"),e.qZA(),e.TgZ(83,"div",40),e._uU(84,"Online Only"),e.qZA()(),e.TgZ(85,"button",38),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.form.patchValue({attendance_type:"ANY"}))}),e.TgZ(86,"app-icon",39),e._uU(87,"add"),e.qZA(),e.TgZ(88,"div",40),e._uU(89,"Both"),e.qZA()()(),e.YNc(90,Ut,26,18,"ng-container",41),e.BQk(),e._UZ(91,"div",21),e.TgZ(92,"h3",5),e._uU(93,"Event Information"),e.qZA(),e.ynx(94),e.TgZ(95,"label",7),e._uU(96,"Event Description"),e.qZA(),e._UZ(97,"rich-text-input",42),e.TgZ(98,"label",12),e._uU(99,"Images"),e.qZA(),e._UZ(100,"image-list-field",43),e.BQk(),e.qZA(),e.TgZ(101,"div",44)(102,"a",45),e._uU(103," Cancel "),e.qZA(),e.TgZ(104,"button",46),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.save())}),e._uU(105," Save "),e.qZA()()()()}if(2&o){const t=e.MAs(27),n=e.MAs(67),i=e.oxw();e.xp6(),e.Q6J("routerLink",e.DdM(41,ne)),e.xp6(3),e.Q6J("formGroup",i.form),e.xp6(2),e.hij(" ",i.form.value.id?"Edit":"New"," Group Event "),e.xp6(10),e.hij(" ",e.lcZ(17,31,"FORM.TITLE_ERROR")," "),e.xp6(12),e.Q6J("ngForOf",i.tag_list),e.xp6(),e.Q6J("matChipInputFor",t)("matChipInputSeparatorKeyCodes",i.separators)("matChipInputAddOnBlur",!0),e.xp6(4),e.Q6J("ngModel","OPEN"===i.form.value.permission)("ngModelOptions",e.DdM(42,E)),e.xp6(9),e.hij(" ",e.lcZ(43,33,"FORM.DATE"),""),e.xp6(4),e.Q6J("to",i.end_date),e.xp6(),e.hij(" ",e.lcZ(48,35,"FORM.DATE_ERROR")," "),e.xp6(4),e.hij(" ",e.lcZ(52,37,"FORM.END_DATE"),""),e.xp6(4),e.Q6J("from",i.start_date)("to",i.end_date),e.xp6(),e.hij(" ",e.lcZ(57,39,"FORM.DATE_ERROR")," "),e.xp6(2),e.Q6J("ngIf",!i.form.value.all_day),e.xp6(7),e.Q6J("matAutocomplete",n),e.xp6(3),e.Q6J("ngForOf",i.filtered_timezones),e.xp6(),e.Q6J("ngIf",!i.timezones.length),e.xp6(6),e.ekj("inverse",!1)("inverse","ONSITE"!==i.form.value.attendance_type),e.xp6(5),e.ekj("inverse","ONLINE"!==i.form.value.attendance_type),e.xp6(5),e.ekj("inverse","ANY"!==i.form.value.attendance_type),e.xp6(5),e.Q6J("ngIf","ONLINE"!==i.form.value.attendance_type),e.xp6(12),e.Q6J("routerLink",e.DdM(43,ne))}}function Nt(o,l){1&o&&(e.TgZ(0,"div",65),e._UZ(1,"mat-spinner",66),e.TgZ(2,"p"),e._uU(3,"Saving event..."),e.qZA()())}const Jt=[];let oe=(()=>{class o extends c.cx{get tag_list(){return this.form.getRawValue().tags||Jt}get max_duration(){return this._settings.get("app.events.max_duration")||480}get use_24hr(){return this._settings.get("app.use_24_hour_time")}get building_zone(){const t=this.form.getRawValue().zones||[];return this._org.buildings.find(i=>t.includes(i.id))||this._org.building}get level_zone(){const t=this.form.getRawValue().zones;return this._org.levelWithID(t)}constructor(t,n,i,s,r,d,p){super(),this._form_state=t,this._event_form=n,this._state=i,this._route=s,this._router=r,this._org=d,this._settings=p,this.loading=!1,this.timezones=[],this.filtered_timezones=[],this.form=this._form_state.form,this.separators=[z.K5,z.OC,z.L_],this.building_list=this._org.building_list,this.active_levels=this._org.active_levels,this.available_spaces=this._event_form.available_spaces,this.duration_info=u=>{const f=this.form.getRawValue().date;if((0,v.Z)(f,"yyyy-MM-dd")!==(0,v.Z)(u,"yyyy-MM-dd"))return"";const P=(0,pt.Z)(u,f);return` (${(0,mt.Z)({hours:Math.floor(P/60),minutes:P%60})})`}}ngOnInit(){var t=this;return(0,h.Z)(function*(){yield t._org.initialised.pipe((0,dt.P)(n=>n)).toPromise(),t._form_state.setOptions({type:"group-event"}),t.form.patchValue({booking_type:"group-event",asset_id:`${(0,c.ar)()?.name||(0,c.ar)()?.email} [${(0,c.O1)(4)}]`,permission:"OPEN",zones:(0,c.Tw)([t._org.organisation.id,t._org.building.id,t._org.building.parent_id]),location:t._org.building.address||t._org.building.display_name,user:(0,c.ar)(),attendance_type:"ONSITE"}),t.subscription("route.params",t._route.paramMap.subscribe(function(){var n=(0,h.Z)(function*(i){if(i.has("id")){const s=yield(0,Z.Fo)(i.get("id")).toPromise();if(!s)return t._router.navigate(["/entertainment","events"]);t._form_state.newForm(s),console.log("Booking:",s.tags),s.linked_event&&(t._event_form.newForm(new A.ym(s.linked_event)),t.form.patchValue({secondary_resource:s.linked_event.system_id})),t.form.patchValue({tags:s.tags,user:new ut.mO({id:s.user_id,email:s.user_email,name:s.user_name})})}});return function(i){return n.apply(this,arguments)}}())),t.subscription("form_change",t.form.valueChanges.pipe((0,Y.O)(t.form.value)).subscribe(()=>{t._event_form.form.patchValue(t.form.value),t._event_form.setOptions({zone_ids:[t.level_zone?.id||t.building_zone?.id]})})),t.subscription("organiser_change",t.form.controls.user.valueChanges.subscribe(n=>{const i=n?.name||n?.email,s=(i?`${i} [${(0,c.O1)(4)}]`:"")||t.form.getRawValue().asset_id;t.form.patchValue({asset_id:s})})),t._updateTimezoneList(),t.subscription("tz-change",t.form.valueChanges.subscribe(()=>t._updateTimezoneList()))})()}setBuilding(t){this._org.building=t}setLevel(t){const n=(0,c.Tw)([this._org.organisation.id,this._org.building.parent_id,this._org.building.id,t.id]);this.form.controls.zones.setValue(n)}addTag(t){if(!this.form||!this.form.controls.tags)return;const n=t.chipInput.inputElement,i=t.value,s=this.tag_list;(i||"").trim()&&(s.push(i),this.form.controls.tags.setValue(s)),n&&(n.value="")}removeTag(t){if(!this.form||!this.form.controls.tags)return;const n=this.tag_list,i=n.indexOf(t);i>=0&&(n.splice(i,1),this.form.controls.tags.setValue(n))}save(){var t=this;return(0,h.Z)(function*(){if(t.form.markAllAsTouched(),!t.form.valid)return(0,c.cB)(`Some form fields are invalid. [${(0,c.RD)(t.form)}]`);t.loading=!0;const n=t._form_state.booking;if(n?.id&&(n.linked_event||t.form.getRawValue().secondary_resource)&&(n.linked_event&&(yield(0,A.xC)(n.linked_event.event_id).toPromise().catch(r=>{throw(0,c.cB)(r),t.loading=!1,r})),yield(0,Z.pv)(n.id).toPromise().catch(r=>{throw(0,c.cB)(r),t.loading=!1,r}),t._form_state.form.patchValue({id:null})),t.form.getRawValue().secondary_resource){const d=(yield t.available_spaces.pipe((0,L.q)(1)).toPromise()).find(f=>f.id===t.form.getRawValue().secondary_resource),p={...t.form.getRawValue()};delete p.id,console.log("Event value:",p),t._event_form.form.patchValue({...p,id:null,resources:[d]});const u=yield t._event_form.postForm().catch(f=>{throw(0,c.cB)(f),t.loading=!1,f});if(console.log("Event:",u),!u)return;t.form.patchValue({ical_uid:u.ical_uid,event_id:u.id,location:d.display_name||d.name})}t.form.getRawValue().description||t.form.patchValue({description:" "});const i=t.form.getRawValue().date,s=yield t._form_state.postForm().catch(function(){var r=(0,h.Z)(function*(d){(0,c.cB)(d),t.form.getRawValue().event_id&&(yield(0,A.xC)(t.form.getRawValue().event_id).toPromise())});return function(d){return r.apply(this,arguments)}}());t._state.changed(),t.loading=!1,s&&t._router.navigate(["/entertainment","events"],{queryParams:{range:(0,R.Z)(i).valueOf()}})})()}_updateTimezoneList(){const t=this.form?.value?.timezone||"";this.timezones=c.sM,this.filtered_timezones=this.timezones.filter(n=>n.toLowerCase().includes(t.toLowerCase()))}static#e=this.\u0275fac=function(n){return new(n||o)(e.Y36(Z.fy),e.Y36(A.MH),e.Y36(b),e.Y36(_.gz),e.Y36(_.F0),e.Y36($.w7),e.Y36(c.gb))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-event-manage"]],features:[e.qOj],decls:3,vars:2,consts:()=>{let t;return t=$localize`:@@displayNameLabel␟23ba0a48c17b76008ce17f71f2ab2243ed7d8026␟3213117795366291168: Timezone: `,[["class","absolute inset-0 bg-base-100 overflow-auto",4,"ngIf","ngIfElse"],["load_state",""],[1,"absolute","inset-0","bg-base-100","overflow-auto"],["icon","","matRipple","",1,"sticky","top-2","right-2","ml-auto",3,"routerLink"],[1,"flex","flex-col","w-[40rem]","max-w-full","mx-auto","px-4",3,"formGroup"],[1,"py-4","text-2xl","font-medium"],[1,"flex","flex-col","space-y-2"],["for","title"],["appearance","outline",1,"w-full"],["matInput","","name","title","formControlName","title","placeholder","e.g. Team Meeting"],["for","host"],["name","host","formControlName","user",1,"block"],["for","tags"],["appearance","outline",1,"no-subscript"],["aria-label","Event Tags"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["placeholder","Add new tags relevant to this event...",3,"matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],[1,"py-4","flex","items-center","space-x-8"],["formControlName","featured"],[3,"ngModel","ngModelOptions","ngModelChange"],[1,"w-full","h-px","bg-base-200"],[1,"flex","items-center","flex-wrap","sm:space-x-2"],[1,"flex-1","min-w-[256px]","relative"],["for","date"],["name","date","formControlName","date",3,"to"],["name","date","formControlName","date_end",3,"from","to"],["class","flex items-center space-x-2",4,"ngIf"],[1,"flex","flex-col"],["for","display-name"],t,["appearance","outline"],["matPrefix","",1,"text-2xl"],["matInput","","formControlName","timezone","placeholder","Timezone",3,"matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],[1,"flex","items-center","space-x-2","pb-2"],["btn","","matRipple","",1,"flex-1",3,"click"],[1,"text-2xl"],[1,"mx-2"],[4,"ngIf"],["formControlName","description"],["formControlName","images"],[1,"flex","justify-end","space-x-2","sticky","bottom-0","w-full","bg-base-100","py-4"],["btn","","matRipple","",1,"inverse","w-32",3,"routerLink"],["btn","","matRipple","",1,"w-32",3,"click"],[3,"selectable","removable","removed"],["matChipRemove",""],[1,"flex","items-center","space-x-2"],[1,"flex-1","w-1/3"],["for","start-time"],["name","start-time",3,"ngModel","ngModelOptions","use_24hr","ngModelChange"],["for","end-time"],["name","end-time",3,"ngModel","ngModelOptions","from","use_24hr","extra_info_fn","ngModelChange"],[3,"value"],[3,"disabled"],["for","location"],["placeholder","Select Building",3,"ngModel","ngModelOptions","ngModelChange"],[1,"flex","space-x-2"],[1,"flex","flex-col","flex-[2]"],["for","level"],["placeholder","Select Level",3,"ngModel","ngModelOptions","ngModelChange"],[1,"flex","flex-col","flex-[3]"],["formControlName","secondary_resource","placeholder","Select Room",3,"disabled"],[1,"absolute","inset-0","bg-base-100","flex","flex-col","items-center","justify-center","space-y-4"],["diameter","48"]]},template:function(n,i){if(1&n&&e.YNc(0,Lt,106,44,"div",0)(1,Nt,4,0,"ng-template",null,1,e.W1O),2&n){const s=e.MAs(2);e.Q6J("ngIf",!i.loading)("ngIfElse",s)}},dependencies:[m.sg,m.O5,g._Y,g.Fj,g.JJ,g.JL,g.On,N.KE,N.TO,N.qo,_t.Nt,X.gD,x.ey,gt.oG,vt.Ou,te.XC,te.ZL,x.wG,g.sg,g.u,ft.Q,ht.N,xt.d,Zt.n,yt.h,J.o,F.RA,F.oH,F.qH,F.z3,_.rH,m.Ov,Tt.X$]})}return o})();var kt=a(46514),Ft=a(39304);const Pt=[{path:"",component:Q,children:[{path:"",component:ct}]},{path:"manage",component:oe},{path:"manage/:id",component:oe},{path:"**",redirectTo:""}];let It=(()=>{class o{static#e=this.\u0275fac=function(n){return new(n||o)};static#t=this.\u0275mod=e.oAB({type:o});static#n=this.\u0275inj=e.cJS({imports:[m.ez,g.u5,O.v,kt.YR,Z.EP,A.cn,Ft.W9,_.Bz.forChild(Pt)]})}return o})()},59524:(ie,C,a)=>{a.d(C,{Y:()=>I,PP:()=>e.P,mO:()=>Q.mO,VE:()=>O.VE,w0:()=>O.w0,sF:()=>g.sF});var e=a(43211),_=(a(86755),a(80882),a(67343));class I{constructor(c={}){this.type=c.type||c.location||"other",this.position=c.position||c.map_id||c.asset_id||{x:c.x/c.map_width||0,y:c.y/c.map_height||0},this.variance=c.variance||0,this.last_seen=c.last_seen||(0,_.Z)(new Date),this.level=c.level,this.building=c.building,this.at_location=!!c.at_location,this.coordinates_from=c.coordinates_from||"top-left"}}var Q=a(223),g=(a(11451),a(38125)),O=a(48675)}}]);
//# sourceMappingURL=apps_concierge_src_app_events_events_module_ts.js.map