"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["default-libs_users_src_lib_users_module_ts"],{44621:(X,F,i)=>{i.d(F,{X:()=>S});var c=i(12587),v=i(77375),M=i(31257),x=i(99908),b=i(33240),p=i(56441),w=i(58700);function g(s){return(0,w.a)(1e3*s)}var O=i(1874),f=i(49675),d=i(96576),_=i(90521),j=i(42175),r=i(71536),I=i(19803),T=i(71963),U=i(29314),D=i(35443),E=i(34702),A=i(7841),t=i(7404);const P=["container"],R=()=>[];function B(s,u){if(1&s&&(t.j41(0,"div",32),t.EFF(1),t.k0s()),2&s){const e=u.index,n=t.XpG();t.xc7("left",-n.offset_x+"px"),t.BMQ("disabled",n.today&&n.current_hour>e),t.R7$(),t.Lme(" ",e%12==0?"12":e%12,"",e>=12?"pm":"am"," ")}}function $(s,u){if(1&s){const e=t.RV6();t.j41(0,"div",33),t.nrm(1,"a-user-avatar",12),t.j41(2,"div",34),t.EFF(3),t.k0s(),t.j41(4,"button",35),t.bIt("click",function(){const o=t.eBV(e).$implicit,a=t.XpG();return t.Njj(a.removeUser(o))}),t.j41(5,"app-icon"),t.EFF(6,"close"),t.k0s()()()}if(2&s){const e=u.$implicit,n=t.XpG();t.xc7("top",-n.offset_y+"px"),t.R7$(),t.Y8G("user",e),t.R7$(2),t.SpI(" ",e.name||n.host.email," ")}}function N(s,u){if(1&s&&t.nrm(0,"div",36),2&s){const e=u.index,n=t.XpG();t.xc7("left",-(n.offset_x+1)+"px"),t.BMQ("disabled",n.today&&n.current_hour>e)}}function G(s,u){if(1&s&&(t.j41(0,"div",37),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.SpI(" ",t.i5U(2,1,e.date,"shortTime")," ")}}function h(s,u){if(1&s&&(t.nrm(0,"user-availability-list",25),t.nI1(1,"async"),t.nI1(2,"async")),2&s){const e=u.$implicit,n=t.XpG();t.Y8G("user",e)("date",n.date)("availability",t.bMT(1,3,n.availability)?t.bMT(2,5,n.availability)[e.email.toLowerCase()]:t.lJ4(7,R))}}let S=(()=>{class s extends v.Tv{get today(){return(0,M.r)(this.date,Date.now())}get current_hour(){return(new Date).getHours()}get selection_left(){const e=new Date(this.date);return 5*(e.getHours()+e.getMinutes()/60)}get selection_width(){return this.duration/60*5}constructor(e,n,o){super(),this._data=e,this._renderer=n,this._dialog_ref=o,this.users=new _.t([]),this.search="",this.date=this._data.date||Date.now(),this.duration=this._data.duration||60,this.offset_y=0,this.offset_x=0,this.host=this._data.host,this.hours=new Array(24).fill(0),this.on_change=new _.t(0),this.availability=(0,j.zV)([this.users,this.on_change]).pipe((0,I.B)(300),(0,T.n)(([a])=>(0,d.f6)({calendars:[this.host.email,...a.map(m=>m.email.toLowerCase())].join(","),period_start:(0,x._)((0,b.o)(this.date)),period_end:(0,x._)((0,p.D)(this.date))}).pipe((0,U.W)(()=>(0,r.of)([])))),(0,D.T)(a=>{const m={};for(const l of a)m[l.id.toLowerCase()]=l.availability.filter(C=>"busy"===C.status).map(C=>{const V=g(C.starts_at),L=(0,O.o)(g(C.ends_at),g(C.starts_at));return{date:V,duration:L,start:(V.getHours()+V.getMinutes()/60)/24*100,size:L/60/24*100}});return m}),(0,E.U)({}),(0,A.t)(1)),this.move_time=!1,this._start_time=0,this._move_last=0,this._move_size=1920,this.users.next([...this._data.users])}addUser(e){this.users.next([...this.users.getValue().filter(n=>n.email!==e.email),e]),this.user=null}removeUser(e){this.users.next(this.users.getValue().filter(n=>n.email!==e.email)),this.user=null}closeAndUpdate(){this._dialog_ref.close(!0)}ngAfterViewInit(){const e=new Date(this.date);this.timeout("init",()=>{const n=this._container_el.nativeElement.querySelector(`[hour="${e.getHours()}"]`);if(n){const o=this._container_el.nativeElement.getBoundingClientRect(),a=n.getBoundingClientRect();this._container_el.nativeElement.scrollTo(a.left-128-o.left,0)}this.onScroll()},300)}onScroll(){this.offset_x=this._container_el.nativeElement.scrollLeft,this.offset_y=this._container_el.nativeElement.scrollTop}startMovePeriod(e){e.preventDefault(),e.stopPropagation(),this._move_last=e instanceof MouseEvent?e.clientX:e.touches[0].clientX,this.move_time=!0,this._start_time=this.date,e instanceof MouseEvent?this.subscription("on_move",this._renderer.listen("window","mousemove",n=>this._onMovePeriod(n))):this.subscription("on_move",this._renderer.listen("window","touchmove",n=>this._onMovePeriod(n))),e instanceof MouseEvent?this.subscription("on_move_end",this._renderer.listen("window","mouseup",()=>this._onMoveEnd())):this.subscription("on_move_end",this._renderer.listen("window","touchend",()=>this._onMoveEnd()))}startMoveDuration(e){e.preventDefault(),e.stopPropagation(),this._move_last=e instanceof MouseEvent?e.clientX:e.touches[0].clientX,this._start_time=this.duration,e instanceof MouseEvent?this.subscription("on_move",this._renderer.listen("window","mousemove",n=>this._onMoveDuration(n))):this.subscription("on_move",this._renderer.listen("window","touchmove",n=>this._onMoveDuration(n))),e instanceof MouseEvent?this.subscription("on_move_end",this._renderer.listen("window","mouseup",()=>this._onMoveEnd())):this.subscription("on_move_end",this._renderer.listen("window","touchend",()=>this._onMoveEnd()))}_onMovePeriod(e){const n=this._move_last-(e instanceof MouseEvent?e.clientX:e.touches[0].clientX),a=(n>0?-1:1)*Math.floor(Math.abs(n/this._move_size*24*60)/5)*5;if(a){const m=this.date;this.date=(0,f.z)(this._start_time,a).valueOf(),this.date<Date.now()&&(this.date=m)}}_onMoveDuration(e){const n=this._move_last-(e instanceof MouseEvent?e.clientX:e.touches[0].clientX),a=(n>0?-1:1)*Math.floor(Math.abs(n/this._move_size*24*60)/5)*5;a&&(this.duration=Math.max(30,this._start_time+a))}_onMoveEnd(){this.unsub("on_move"),this.unsub("on_move_end"),this._move_last=0,this.move_time=!1}static#t=this.\u0275fac=function(n){return new(n||s)(t.rXU(c.Vh),t.rXU(t.sFG),t.rXU(c.CP))};static#e=this.\u0275cmp=t.VBU({type:s,selectors:[["find-availability-modal"]],viewQuery:function(n,o){if(1&n&&t.GBs(P,7),2&n){let a;t.mGM(a=t.lsd())&&(o._container_el=a.first)}},features:[t.Vt3],decls:45,vars:31,consts:[["container",""],[1,"relative","flex","items-center","justify-center","p-4"],[1,"text-center"],["icon","","matRipple","","mat-dialog-close","",1,"absolute","top-1/2","left-1","-translate-y-1/2"],[1,"flex","flex-col","h-[calc(100vh-7rem)]","sm:h-[65vh]","overflow-hidden"],[1,"w-full","flex","flex-col","sm:flex-row","space-y-2","sm:space-y-0","sm:space-x-2","p-2"],[1,"max-h-[3.25rem]","flex-1",3,"ngModelChange","ngModel"],[1,"grid","flex-1","h-1/2","w-full","border-t","border-base-200","relative","overflow-hidden","divide-x","divide-y","divide-base-200","max-w-[100vw]","sm:max-w-[80vw]"],["times","",1,"col-start-2","h-10","flex","overflow-hidden","border-l","border-base-200"],["hour","","class","relative border-r border-base-200 h-10 min-w-[5rem] p-2",3,"left",4,"ngFor","ngForOf"],["users","",1,"row-start-2","w-24","overflow-hidden"],["host","",1,"flex","flex-col","items-center","justify-center","h-32","w-24","relative","border-b","border-base-200","py-2"],[1,"text-2xl",3,"user"],[1,"text-xs","break-words","overflow-hidden","max-w-full","px-2","text-center"],["person","","class","flex flex-col items-center justify-center h-32 w-24 relative border-b border-base-200 py-2",3,"top",4,"ngFor","ngForOf"],["blocks","",1,"relative","row-start-2","overflow-hidden"],["fixed","",1,"absolute","inset-0","flex","overflow-hidden"],["divider","","class","relative h-full min-w-[5rem] border-l border-base-200",3,"left",4,"ngFor","ngForOf"],["selection","",1,"absolute","inset-y-0","!border-x-2","!border-info","z-20","cursor-grab","active:cursor-grabbing",3,"mousedown","touchstart"],[1,"absolute","inset-0","bg-info","opacity-30"],["handle","",1,"absolute","top-1/2","-left-px","-translate-x-1/2","-translate-y-1/2","h-3","w-3","rounded-full","bg-info"],["handle","",1,"absolute","top-1/2","-right-px","translate-x-1/2","-translate-y-1/2","h-3","w-3","rounded-full","bg-info","hover:h-4","hover:w-4","active:bg-secondary",3,"mousedown","touchstart"],[1,"bg-base-100","border","border-base-200","p-2","absolute","top-2","left-1/2","-translate-x-1/2","shadow","text-xs","whitespace-nowrap","rounded"],["class","bg-base-100 border border-base-200 p-2 absolute top-12 left-1/2 -translate-x-1/2 shadow text-xs whitespace-nowrap rounded",4,"ngIf"],["scroll","",1,"absolute","inset-0","overflow-auto",3,"scroll"],[1,"pointer-events-none",3,"user","date","availability"],["class","pointer-events-none",3,"user","date","availability",4,"ngFor","ngForOf"],[1,"flex","items-center","justify-between","p-2","border-t","border-base-200","w-full"],["btn","","matRipple","",1,"clear","text-secondary",3,"mat-dialog-close"],[1,"flex","items-center"],[1,"text-xl"],[1,"mr-1","underline"],["hour","",1,"relative","border-r","border-base-200","h-10","min-w-[5rem]","p-2"],["person","",1,"flex","flex-col","items-center","justify-center","h-32","w-24","relative","border-b","border-base-200","py-2"],[1,"text-xs","break-words","max-w-full","px-2","text-center"],["icon","",1,"absolute","-top-1","-left-1",3,"click"],["divider","",1,"relative","h-full","min-w-[5rem]","border-l","border-base-200"],[1,"bg-base-100","border","border-base-200","p-2","absolute","top-12","left-1/2","-translate-x-1/2","shadow","text-xs","whitespace-nowrap","rounded"]],template:function(n,o){if(1&n){const a=t.RV6();t.j41(0,"header",1)(1,"h2",2),t.EFF(2,"Find Availability"),t.k0s(),t.j41(3,"button",3)(4,"app-icon"),t.EFF(5,"close"),t.k0s()()(),t.j41(6,"main",4)(7,"div",5)(8,"a-date-field",6),t.mxI("ngModelChange",function(l){return t.eBV(a),t.DH7(o.date,l)||(o.date=l),t.Njj(l)}),t.bIt("ngModelChange",function(){return t.eBV(a),t.Njj(o.on_change.next(o.on_change.getValue()+1))}),t.k0s(),t.j41(9,"a-user-search-field",6),t.mxI("ngModelChange",function(l){return t.eBV(a),t.DH7(o.user,l)||(o.user=l),t.Njj(l)}),t.bIt("ngModelChange",function(l){return t.eBV(a),t.Njj(o.addUser(l))}),t.k0s()(),t.j41(10,"div",7)(11,"div",8),t.DNE(12,B,2,5,"div",9),t.k0s(),t.j41(13,"div",10)(14,"div",11),t.nrm(15,"a-user-avatar",12),t.j41(16,"div",13),t.EFF(17),t.k0s()(),t.DNE(18,$,7,4,"div",14),t.nI1(19,"async"),t.k0s(),t.j41(20,"div",15)(21,"div",16),t.DNE(22,N,1,3,"div",17),t.j41(23,"div",18),t.bIt("mousedown",function(l){return t.eBV(a),t.Njj(o.startMovePeriod(l))})("touchstart",function(l){return t.eBV(a),t.Njj(o.startMovePeriod(l))}),t.nrm(24,"div",19)(25,"div",20),t.j41(26,"div",21),t.bIt("mousedown",function(l){return t.eBV(a),t.Njj(o.startMoveDuration(l))})("touchstart",function(l){return t.eBV(a),t.Njj(o.startMoveDuration(l))}),t.k0s(),t.j41(27,"div",22),t.EFF(28),t.nI1(29,"duration"),t.k0s(),t.DNE(30,G,3,4,"div",23),t.k0s()(),t.j41(31,"div",24,0),t.bIt("scroll",function(){return t.eBV(a),t.Njj(o.onScroll())}),t.nrm(33,"user-availability-list",25),t.nI1(34,"async"),t.nI1(35,"async"),t.DNE(36,h,3,8,"user-availability-list",26),t.nI1(37,"async"),t.k0s()()()(),t.j41(38,"footer",27)(39,"button",28)(40,"div",29)(41,"app-icon",30),t.EFF(42,"arrow_back"),t.k0s(),t.j41(43,"div",31),t.EFF(44,"Back to form"),t.k0s()()()()}2&n&&(t.R7$(8),t.R50("ngModel",o.date),t.R7$(),t.R50("ngModel",o.user),t.R7$(3),t.Y8G("ngForOf",o.hours),t.R7$(2),t.xc7("top",-o.offset_y+"px"),t.R7$(),t.Y8G("user",o.host),t.R7$(2),t.SpI(" ",o.host.name||o.host.email," "),t.R7$(),t.Y8G("ngForOf",t.bMT(19,20,o.users)),t.R7$(4),t.Y8G("ngForOf",o.hours),t.R7$(),t.xc7("left","calc("+o.selection_left+"rem - "+o.offset_x+"px)")("width",o.selection_width+"rem"),t.R7$(5),t.SpI(" ",t.bMT(29,22,o.duration)," "),t.R7$(2),t.Y8G("ngIf",o.move_time),t.R7$(3),t.Y8G("user",o.host)("date",o.date)("availability",t.bMT(34,24,o.availability)?t.bMT(35,26,o.availability)[o.host.email]:t.lJ4(30,R)),t.R7$(3),t.Y8G("ngForOf",t.bMT(37,28,o.users)),t.R7$(3),t.Y8G("mat-dialog-close",!0))},styles:[".grid[_ngcontent-%COMP%]{grid-template-columns:6rem 1fr;grid-template-rows:2.5rem minmax(0,1fr)}[disabled=true][_ngcontent-%COMP%], [disabled=true][_ngcontent-%COMP%]   [header][_ngcontent-%COMP%]{background:var(--b3)!important;pointer-events:none}[disabled=true][_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{opacity:.3}\n\n/*# sourceMappingURL=find-availability-modal.component.ts-angular-inline--11.css.map*/"]})}return s})()},89577:(X,F,i)=>{i.d(F,{a:()=>g});var c=i(89204),v=i(86039),M=i(2372),x=i(93693),b=i(7404);const p=[],w=new x.KJ;let g=(()=>{class y{transform(f){return(0,c.A)(function*(){if(!f)return w;let d=p.find(({id:_,email:j})=>_===f||j===f);return d||(d=yield(0,M.SZ)(f).toPromise().catch(()=>null),d||(d=yield(0,v.qc)(f).toPromise().catch(()=>null),d)?(p.push(d),d):w)})()}static#t=this.\u0275fac=function(d){return new(d||y)};static#e=this.\u0275pipe=b.EJ8({name:"user",type:y,pure:!0})}return y})()},73850:(X,F,i)=>{i.d(F,{k:()=>G});var c=i(60316),v=i(34456),M=i(41134),x=i(31034),b=i(12587),p=i(97024),w=i(24558),g=i(481),d=(i(11543),i(7111),i(89577),i(43022)),_=i(44621),r=(i(93693),i(7404));function I(h,S){if(1&h&&(r.j41(0,"div",2)(1,"div",3),r.EFF(2),r.nI1(3,"date"),r.nI1(4,"date"),r.k0s()()),2&h){const s=S.$implicit;r.xc7("left",s.start+"%")("width",s.size+"%"),r.R7$(2),r.Lme(" ",r.i5U(3,6,s.date,"shortTime")," - ",r.i5U(4,9,s.date.valueOf()+60*s.duration*1e3,"shortTime")," ")}}let T=(()=>{class h{constructor(){this.availability=[],this.date=Date.now()}static#t=this.\u0275fac=function(u){return new(u||h)};static#e=this.\u0275cmp=r.VBU({type:h,selectors:[["user-availability-list"]],inputs:{user:"user",availability:"availability",date:"date"},decls:2,vars:1,consts:[[1,"relative","w-[120rem]","h-32","inset-y-0","border-b","border-base-200"],["event","","class","absolute inset-y-0 bg-error text-white p-2 overflow-hidden border border-red-700 rounded",3,"left","width",4,"ngFor","ngForOf"],["event","",1,"absolute","inset-y-0","bg-error","text-white","p-2","overflow-hidden","border","border-red-700","rounded"],[1,"text-xs","max-w-full"]],template:function(u,e){1&u&&(r.j41(0,"div",0),r.DNE(1,I,5,12,"div",1),r.k0s()),2&u&&(r.R7$(),r.Y8G("ngForOf",e.availability))},dependencies:[c.Sq,c.vh],styles:["[_nghost-%COMP%]{display:block}\n\n/*# sourceMappingURL=user-availability.component.ts-angular-inline--10.css.map*/"]})}return h})();var U=i(81413),D=i(69434),E=i(85060),A=i(24950),t=i(25175),P=i(19608),R=i(18e3),B=i(23574),$=i(17022);let G=(()=>{class h{static#t=this.\u0275fac=function(u){return new(u||h)};static#e=this.\u0275mod=r.$C({type:h});static#i=this.\u0275inj=r.G2t({imports:[c.MD,v.YN,v.X1,b.hM,g.c,w.h,p.g7,M.D6,x.Cn]})}return h})();r.wjB(d.$,[c.Sq,c.bT,v.BC,v.vS,b.tx,U.t,D.R,E.wT,A.rl,t.VO,E.r6,M.LG,p.So],[c.vh]),r.wjB(_.X,[c.Sq,c.bT,v.BC,v.vS,b.tx,P.G,R.$,D.R,B.a,E.r6,T],[c.Jj,c.vh,$.b])}}]);
//# sourceMappingURL=default-libs_users_src_lib_users_module_ts.js.map