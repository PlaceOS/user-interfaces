(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{EA6B:function(e,t,s){"use strict";s.d(t,"b",(function(){return v})),s.d(t,"a",(function(){return p}));var n=s("C05f"),r=s("TLy2"),a=s("wqq/"),i=s("jOdJ"),o=s("WPBw"),c=s("SQLt"),l=s("D8Xy"),u=s("KuCG"),h=s("20lr"),f=s("eZII"),b=s("mjT4"),g=s("EM62"),m=s("7JBE"),d=s("dJst"),_=s("OZ4H");function v(){sessionStorage.removeItem("PLACEOS.event"),sessionStorage.removeItem("PLACEOS.event_form"),localStorage.removeItem("PLACEOS.event_filters")}let p=(()=>{class e extends h.b{constructor(e,t,s){super(),this._calendar=e,this._org=t,this._dialog=s,this._event=new n.a(null),this._form=new n.a(null),this._filters=new n.a({}),this._loading_spaces=new n.a(!1),this._loading_event=new n.a(!1),this.event=this._event.asObservable(),this.form=this._form.asObservable(),this.filters=this._filters.asObservable(),this.loading_spaces=this._loading_spaces.asObservable(),this.loading_event=this._loading_event.asObservable(),this.spaces=this._filters.pipe(Object(r.a)(e=>{var t,s;this._loading_spaces.next(!0);const n=this._form.getValue().value;n.date||(n.date=(new Date).valueOf());const r=Math.floor(new Date(n.date).valueOf()/1e3),a=Math.floor(Object(o.a)(new Date(n.date),n.duration||60).valueOf()/1e3),i=(null===(t=null==e?void 0:e.zones)||void 0===t?void 0:t.length)?e.zones:[null===(s=this._org.building)||void 0===s?void 0:s.id];return this._calendar.freeBusy({zone_ids:i.join(","),period_start:r,period_end:a}).toPromise().then(t=>(this._loading_spaces.next(!1),t.filter(t=>!e.capacity||e.capacity>=t.capacity)))}),Object(a.a)()),this.clearState=()=>v(),this.setEvent(new f.a({date:Object(c.a)(Object(o.a)(new Date,2),{nearestTo:5}).valueOf()}))}get event_form(){return this._form.getValue()}get event_filters(){return this._filters.getValue()}get is_future_date(){var e,t;const s=(null===(t=null===(e=this._form.getValue())||void 0===e?void 0:e.controls)||void 0===t?void 0:t.date.value)||(new Date).valueOf();return Object(l.a)(new Date(s),Object(u.a)(new Date))}setEvent(e){this._event.next(e);const t=Object(f.b)(e);this._form.next(t),this.subscription("form_change",()=>this.storeState())}setValue(e,t){const s=this._form.getValue();s&&s.controls[e]&&s.controls[e].setValue(t)}newAttendee(){const e=this._dialog.open(b.b,{width:"auto",height:"auto",data:{}}),t=this._form.getValue();e.componentInstance.event.pipe(Object(i.a)(e=>"done"===e.reason)).subscribe(s=>{const n=t.controls.attendees.value||[];n.push(s.metadata),t.controls.attendees.setValue(Object(h.y)(n,"email")),e.close()})}clearForm(){this.setEvent(this._event.getValue()),this._filters.next({})}updateFilters(e){this._filters.next(e)}storeState(){const e=this._form.getValue();sessionStorage.setItem("PLACEOS.event",JSON.stringify(this._event.getValue().toJSON())),sessionStorage.setItem("PLACEOS.event_form",JSON.stringify(e.value)),localStorage.setItem("PLACEOS.event_filters",JSON.stringify(this._filters.getValue()))}loadState(){const e=sessionStorage.getItem("PLACEOS.event")||"{}";e&&this._event.next(new f.a(JSON.parse(e)));const t=sessionStorage.getItem("PLACEOS.event_form");if(t){const e=Object(f.b)(this._event.getValue());e.patchValue(JSON.parse(t)),this._form.next(e)}const s=localStorage.getItem("PLACEOS.event_filters");s&&this._filters.next(JSON.parse(s))}save(){const e=this._form.getValue();if(e.markAllAsTouched(),e.controls.organiser.value&&e.controls.host.value||e.patchValue({organiser:Object(h.h)(),host:Object(h.h)().email}),e.controls.title.value||e.patchValue({title:Object(h.h)().email}),!e.valid){const t=[];for(const s in e.controls)e.controls[s].invalid&&t.push(s);return Promise.reject(Object(h.m)(`Some form fields are not valid: [${t.join(", ")}]`))}this._loading_event.next(!0);const t=new f.a(Object.assign(Object.assign({},this._event.getValue()),this._form.getValue().value));return Object(f.e)(t).toPromise().then(()=>this._loading_event.next(!1),()=>this._loading_event.next(!1))}}return e.\u0275fac=function(t){return new(t||e)(g.dc(m.a),g.dc(d.c),g.dc(_.b))},e.\u0275prov=g.Mb({token:e,factory:e.\u0275fac}),e})()},KlkT:function(e,t,s){"use strict";s.r(t),s.d(t,"DirectoryModule",(function(){return J}));var n=s("2kYt"),r=s("sEIs"),a=s("R3Ii"),i=s("ZTXN"),o=s("mWib"),c=s("Ohay"),l=s("TLy2"),u=s("YtkY"),h=s("20lr"),f=s("mjT4"),b=s("EA6B"),g=s("EM62"),m=s("e81E"),d=s("e4ff"),_=s("C9Ki"),v=s("d4mj"),p=s("PBFl"),O=s("/ILR"),w=s("81Qw");function x(e,t){if(1&e&&g.Rb(0,"a-user-avatar",9),2&e){const e=g.kc(2);g.rc("user",e.user)}}function E(e,t){if(1&e){const e=g.Xb();g.Wb(0,"a",10),g.gc("click",(function(){return g.Bc(e),g.kc(2).sendCallEvent()})),g.lc(1,"safe"),g.Oc(2," Call "),g.Vb()}if(2&e){const e=g.kc(2);g.rc("href",g.nc(1,1,"tel:"+e.user.phone,"url"),g.Dc)}}const y=function(){return["/explore"]},V=function(e){return{user:e}};function j(e,t){if(1&e){const e=g.Xb();g.Wb(0,"div",1),g.Mc(1,x,1,1,"a-user-avatar",2),g.Wb(2,"div",3),g.Wb(3,"div",4),g.Oc(4),g.Vb(),g.Wb(5,"a",5),g.lc(6,"safe"),g.Oc(7),g.Vb(),g.Vb(),g.Wb(8,"div",6),g.Wb(9,"a",7),g.gc("click",(function(){return g.Bc(e),g.kc().sendLocateEvent()})),g.Oc(10," Locate "),g.Vb(),g.Mc(11,E,3,4,"a",8),g.Vb(),g.Vb()}if(2&e){const e=g.kc();g.Ib("with-image",e.show_image),g.Eb(1),g.rc("ngIf",e.show_image),g.Eb(3),g.Pc(e.user.name),g.Eb(1),g.rc("href",g.nc(6,9,"mailto:"+e.user.email,"url"),g.Dc),g.Eb(2),g.Qc(" ",e.user.email," "),g.Eb(2),g.rc("routerLink",g.uc(12,y))("queryParams",g.vc(13,V,e.user.email)),g.Eb(2),g.rc("ngIf",e.user.phone)}}let S=(()=>{class e{constructor(e){this._settings=e}get show_image(){return this._settings.get("app.directory.show_avatars")}sendLocateEvent(){}sendCallEvent(){}}return e.\u0275fac=function(t){return new(t||e)(g.Qb(h.e))},e.\u0275cmp=g.Kb({type:e,selectors:[["a-directory-user-list-item"]],inputs:{user:"user"},decls:1,vars:1,consts:[["class","flex flex-wrap items-center sm:space-x-4 bg-white hover:bg-gray-100 overflow-hidden p-4 mb-2",3,"with-image",4,"ngIf"],[1,"flex","flex-wrap","items-center","sm:space-x-4","bg-white","hover:bg-gray-100","overflow-hidden","p-4","mb-2"],[3,"user",4,"ngIf"],[1,"flex","flex-col","flex-1","w-1/2","ml-4","sm:ml-0"],[1,"name"],["name","email",1,"text-sm","underline",3,"href"],[1,"flex","w-full","sm:w-auto","sm:flex-col","items-center","space-x-2","sm:space-x-0","sm:space-y-2","mt-4","sm:mt-0"],["mat-button","","button","","name","locate",1,"w-32","flex-1","sm:flex-none",3,"routerLink","queryParams","click"],["mat-button","","button","","class","w-32 flex-1 sm:flex-nones","name","call",3,"href","click",4,"ngIf"],[3,"user"],["mat-button","","button","","name","call",1,"w-32","flex-1","sm:flex-nones",3,"href","click"]],template:function(e,t){1&e&&g.Mc(0,j,12,15,"div",0),2&e&&g.rc("ngIf",t.user)},directives:[n.o,p.a,r.f,O.a],pipes:[w.b],styles:[""]}),e})();var I=s("0/Ep");function C(e,t){1&e&&g.Rb(0,"a-directory-user-list-item",11),2&e&&g.rc("user",t.$implicit)}function k(e,t){if(1&e&&(g.Ub(0),g.Wb(1,"div",9),g.Oc(2),g.Vb(),g.Mc(3,C,1,1,"a-directory-user-list-item",10),g.Tb()),2&e){const e=g.kc().$implicit,t=g.kc(2);g.Eb(2),g.Pc(e),g.Eb(1),g.rc("ngForOf",t.groupedUsers[e])}}function P(e,t){if(1&e&&(g.Ub(0),g.Mc(1,k,4,2,"ng-container",8),g.Tb()),2&e){const e=t.$implicit,s=g.kc(2);g.Eb(1),g.rc("ngIf",s.groupedUsers[e].length)}}function W(e,t){if(1&e&&(g.Ub(0),g.Mc(1,P,2,1,"ng-container",7),g.Tb()),2&e){const e=g.kc();g.Eb(1),g.rc("ngForOf",e.letters)}}function L(e,t){if(1&e&&(g.Wb(0,"div",12),g.Wb(1,"app-icon",13),g.Oc(2),g.Vb(),g.Wb(3,"div",14),g.Oc(4),g.Vb(),g.Vb()),2&e){const e=g.kc();g.Eb(2),g.Pc(e.search_str&&e.search_str.length>=e.min_search_length?"close":"arrow_upward"),g.Eb(2),g.Qc(" ",e.search_str&&e.search_str.length>=e.min_search_length?' No matches for "'+e.search_str+'"':"Type above to search for users"," ")}}const M="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),A=[{path:"",component:(()=>{class e extends h.b{constructor(e){super(),this._settings=e,this.user_list=[],this.search$=new i.b,this.groupedUsers={}}get min_search_length(){const e=this._settings.get("app.directory.min_search_length");return"number"==typeof e&&e>=0?e:3}ngOnInit(){this.search_results$=this.search$.pipe(Object(o.a)(400),Object(c.a)(),Object(l.a)(e=>(this.loading=!0,e.length>=this.min_search_length?Object(f.f)(e).toPromise().catch(()=>[]):Promise.resolve(this.user_list||[]))),Object(u.a)(e=>(this.loading=!1,e))),this.subscription("search_results",this.search_results$.subscribe(e=>{this.user_list=e,this.buildGroups(this.user_list)})),this.search$.next(""),Object(b.b)()}get letters(){return M}buildGroups(e){const t=e.sort((e,t)=>e.name.localeCompare(t.name));for(const s of this.letters)this.groupedUsers[s]=t.filter(e=>e.name.startsWith(s))}}return e.\u0275fac=function(t){return new(t||e)(g.Qb(h.e))},e.\u0275cmp=g.Kb({type:e,selectors:[["a-directory-user-list"]],features:[g.Bb],decls:9,vars:7,consts:[[3,"menu","menuChange"],[1,"w-full","flex","items-center","justify-center","p-2"],["placeholder","Search for a person...",3,"value","loading","autofocus","valueChange"],[1,"flex-1","h-1/2","w-full"],[4,"ngIf","ngIfElse"],["empty_state",""],[3,"show","showChange"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"py-2","px-4","font-medium"],[3,"user",4,"ngFor","ngForOf"],[3,"user"],[1,"flex","flex-col","items-center","p-8"],[1,"text-5xl"],[1,"text"]],template:function(e,t){if(1&e&&(g.Wb(0,"a-topbar-header",0),g.gc("menuChange",(function(e){return t.show_menu=e})),g.Vb(),g.Wb(1,"div",1),g.Wb(2,"a-searchbar",2),g.gc("valueChange",(function(e){return t.search_str=e}))("valueChange",(function(e){return t.search$.next(e)})),g.Vb(),g.Vb(),g.Wb(3,"main",3),g.Mc(4,W,2,1,"ng-container",4),g.Vb(),g.Rb(5,"a-footer-menu"),g.Mc(6,L,5,2,"ng-template",null,5,g.Nc),g.Wb(8,"a-overlay-menu",6),g.gc("showChange",(function(e){return t.show_menu=e})),g.Vb()),2&e){const e=g.yc(7);g.rc("menu",t.show_menu),g.Eb(2),g.rc("value",t.search_str)("loading",t.loading)("autofocus",!0),g.Eb(2),g.rc("ngIf",t.groupedUsers&&t.user_list.length)("ngIfElse",e),g.Eb(4),g.rc("show",t.show_menu)}},directives:[m.a,d.a,n.o,_.a,v.a,n.n,S,I.a],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                height: 100%;\n                width: 100%;\n            }"]}),e})()}];let J=(()=>{class e{}return e.\u0275mod=g.Ob({type:e}),e.\u0275inj=g.Nb({factory:function(t){return new(t||e)},imports:[[n.c,r.g.forChild(A),a.a]]}),e})()}}]);
//# sourceMappingURL=directory-directory-module.6cfcdff37943285c7823.js.map