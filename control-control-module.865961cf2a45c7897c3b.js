(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{EA6B:function(t,e,n){"use strict";n.d(e,"b",(function(){return f})),n.d(e,"a",(function(){return b}));var o=n("C05f"),i=n("TLy2"),a=n("jOdJ"),s=n("WPBw"),c=n("SQLt"),r=n("D8Xy"),l=n("KuCG"),g=n("20lr"),d=n("eZII"),h=n("mjT4"),m=n("EM62"),u=n("7JBE"),_=n("dJst"),p=n("OZ4H");function f(){sessionStorage.removeItem("PLACEOS.event"),sessionStorage.removeItem("PLACEOS.event_form"),localStorage.removeItem("PLACEOS.event_filters")}let b=(()=>{class t extends g.c{constructor(t,e,n,a,r){super(),this._events=t,this._calendar=e,this._org=n,this._staff=a,this._dialog=r,this._event=new o.a(null),this._form=new o.a(null),this._filters=new o.a({}),this._loading_spaces=new o.a(!1),this._loading_event=new o.a(!1),this.event=this._event.asObservable(),this.form=this._form.asObservable(),this.filters=this._filters.asObservable(),this.loading_spaces=this._loading_spaces.asObservable(),this.loading_event=this._loading_event.asObservable(),this.spaces=this._filters.pipe(Object(i.a)(t=>{var e,n;this._loading_spaces.next(!0);const o=this._form.getValue().value,i=Math.floor(new Date(o.date).valueOf()/1e3),a=Math.floor(Object(s.a)(new Date(o.date),o.duration||60).valueOf()/1e3),c=(null===(e=null==t?void 0:t.zones)||void 0===e?void 0:e.length)?t.zones:[null===(n=this._org.building)||void 0===n?void 0:n.id];return this._calendar.availability({zone_ids:c.join(","),period_start:i,period_end:a}).then(e=>(this._loading_spaces.next(!1),e.filter(e=>!t.capacity||t.capacity>=e.capacity)))})),this.clearState=()=>f(),this.setEvent(new d.a({date:Object(c.a)(Object(s.a)(new Date,2),{nearestTo:5}).valueOf()}))}get event_form(){return this._form.getValue()}get event_filters(){return this._filters.getValue()}get is_future_date(){var t,e;const n=(null===(e=null===(t=this._form.getValue())||void 0===t?void 0:t.controls)||void 0===e?void 0:e.date.value)||(new Date).valueOf();return Object(r.a)(new Date(n),Object(l.a)(new Date))}setEvent(t){this._event.next(t);const e=Object(d.c)(t);this._form.next(e),this.subscription("form_change",()=>this.storeState())}setValue(t,e){const n=this._form.getValue();n&&n.controls[t]&&n.controls[t].setValue(e)}newAttendee(){const t=this._dialog.open(h.b,{width:"auto",height:"auto",data:{}}),e=this._form.getValue();t.componentInstance.event.pipe(Object(a.a)(t=>"done"===t.reason)).subscribe(n=>{const o=e.controls.attendees.value||[];o.push(n.metadata),e.controls.attendees.setValue(Object(g.w)(o,"email")),t.close()})}clearForm(){this.setEvent(this._event.getValue()),this._filters.next({})}updateFilters(t){this._filters.next(t)}storeState(){const t=this._form.getValue();sessionStorage.setItem("PLACEOS.event",JSON.stringify(this._event.getValue().toJSON())),sessionStorage.setItem("PLACEOS.event_form",JSON.stringify(t.value)),localStorage.setItem("PLACEOS.event_filters",JSON.stringify(this._filters.getValue()))}loadState(){const t=sessionStorage.getItem("PLACEOS.event")||"{}";t&&this._event.next(new d.a(JSON.parse(t))),console.log("Event:",this._event.getValue());const e=sessionStorage.getItem("PLACEOS.event_form");if(e){const t=Object(d.c)(this._event.getValue());t.patchValue(JSON.parse(e)),this._form.next(t)}const n=localStorage.getItem("PLACEOS.event_filters");n&&this._filters.next(JSON.parse(n))}save(){const t=this._form.getValue();if(t.markAllAsTouched(),t.controls.organiser.value&&t.controls.host.value||t.patchValue({organiser:this._staff.current,host:this._staff.current.email}),t.controls.title.value||t.patchValue({title:this._staff.current.email}),!t.valid){const e=[];for(const n in t.controls)t.controls[n].invalid&&e.push(n);return Promise.reject(Object(g.l)(`Some form fields are not valid: [${e.join(", ")}]`))}this._loading_event.next(!0);const e=new d.a(Object.assign(Object.assign({},this._event.getValue().toJSON()),this._form.getValue().value));return this._events.save(e).then(()=>this._loading_event.next(!1),()=>this._loading_event.next(!1))}}return t.\u0275fac=function(e){return new(e||t)(m.cc(d.b),m.cc(u.a),m.cc(_.c),m.cc(h.d),m.cc(p.b))},t.\u0275prov=m.Lb({token:t,factory:t.\u0275fac}),t})()},dgxB:function(t,e,n){"use strict";n.r(e),n.d(e,"ControlModule",(function(){return U}));var o=n("2kYt"),i=n("sEIs"),a=n("20lr"),s=n("EA6B"),c=n("EM62"),r=n("e81E"),l=n("jOdJ"),g=n("6CBO"),d=n("dJst"),h=n("ek5h"),m=n("ukpX"),u=n("PBFl"),_=n("81Qw");function p(t,e){if(1&t&&c.Qb(0,"div",13),2&t){const t=c.jc(2);c.Ic("background-image","url("+t.space.image+")")}}const f=function(){return{type:"icon",class:"material-icons",content:"account_circle"}},b=function(){return["/explore"]},v=function(t){return{space:t}};function O(t,e){if(1&t&&(c.Vb(0,"div",1),c.Vb(1,"div",2),c.Lc(2,p,1,2,"div",3),c.Qb(3,"div",4),c.Vb(4,"div",5),c.Nc(5),c.Ub(),c.Vb(6,"div",6),c.Vb(7,"div",7),c.Nc(8),c.Ub(),c.Vb(9,"div",8),c.Qb(10,"app-icon",9),c.Nc(11),c.Ub(),c.Ub(),c.Ub(),c.Vb(12,"div",10),c.Vb(13,"a",11),c.Nc(14," Find "),c.Ub(),c.Vb(15,"a",12),c.kc(16,"safe"),c.Nc(17," Control "),c.Ub(),c.Ub(),c.Ub()),2&t){const t=c.jc();c.Hb("with-image",t.show_image),c.Db(2),c.qc("ngIf",t.show_image&&t.space.image),c.Db(3),c.Oc(t.space.name),c.Db(3),c.Oc(t.location),c.Db(2),c.qc("icon",c.tc(13,f)),c.Db(1),c.Pc(" ",t.space.capacity||"0"," "),c.Db(2),c.qc("routerLink",c.tc(14,b))("queryParams",c.uc(15,v,t.space.id)),c.Db(2),c.qc("href",c.mc(16,10,t.space.support_url,"url"),c.Cc)}}let w=(()=>{class t{constructor(t,e){this._settings=t,this._org=e}get show_image(){return this._settings.get("app.space_display.show_images")}get location(){if(!this.space)return"Unable to determine location";const t=this.space.level,e=this._org.buildings.find(e=>e.id===t.parent_id);return`${e?e.name+", ":""}${t.name}`}}return t.\u0275fac=function(e){return new(e||t)(c.Pb(a.f),c.Pb(d.c))},t.\u0275cmp=c.Jb({type:t,selectors:[["a-control-space-list-item"]],inputs:{space:"space"},decls:1,vars:1,consts:[["class","space-details",3,"with-image",4,"ngIf"],[1,"space-details"],[1,"details"],["class","image",3,"background-image",4,"ngIf"],[1,"overlay"],[1,"name"],[1,"info"],[1,"location"],[1,"capacity"],[3,"icon"],[1,"actions"],["mat-button","","color","primary","button","",3,"routerLink","queryParams"],["mat-button","","color","primary","button","",3,"href"],[1,"image"]],template:function(t,e){1&t&&c.Lc(0,O,18,17,"div",0),2&t&&c.qc("ngIf",e.space)},directives:[o.o,m.a,u.a,i.f],pipes:[_.b],styles:[".space-details[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;width:768px;max-width:calc(100vw - 2em);margin:.5em auto;background-color:#fff;flex-wrap:wrap;border-radius:4px;overflow:hidden;--tw-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);transition:box-shadow .2s,top .2s;top:0}.space-details[_ngcontent-%COMP%], .space-details[_ngcontent-%COMP%]:hover{box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow)}.space-details[_ngcontent-%COMP%]:hover{--tw-shadow:0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);top:-2px}.space-details[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{display:none}.with-image[_ngcontent-%COMP%]{padding-top:0;width:480px}.with-image[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{display:initial;background-color:rgba(var(--font-dark),.65);color:var(--font-light);transition:opacity .2s}.with-image[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%], .with-image[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0}.with-image[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{overflow:hidden;background-position:50%;background-size:cover}.with-image[_ngcontent-%COMP%]:hover   .details[_ngcontent-%COMP%]   .capacity[_ngcontent-%COMP%], .with-image[_ngcontent-%COMP%]:hover   .details[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%], .with-image[_ngcontent-%COMP%]:hover   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{filter:drop-shadow(0 0 2px black);color:#fff}.with-image[_ngcontent-%COMP%]:hover   .details[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{opacity:0}.with-image[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{position:relative;height:6em;width:24em;margin:0 auto 0 0;max-width:24em;overflow:hidden}.with-image[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .capacity[_ngcontent-%COMP%], .with-image[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%], .with-image[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{transition:filter .2s}@media screen and (max-width:639px){.with-image[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{height:12em}}.with-image[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{position:absolute;bottom:2em;color:var(--font-light)}.with-image[_ngcontent-%COMP%]   .info[_ngcontent-%COMP%]{position:absolute;bottom:1em;color:hsla(0,0%,100%,.65);width:calc(100% - 2em)}.details[_ngcontent-%COMP%]{flex:1;min-width:50%;padding:.5em 1em}@media screen and (max-width:639px){.details[_ngcontent-%COMP%]{border-bottom:1px solid #ccc;padding:1em;margin-bottom:.5em;min-width:99%}}.info[_ngcontent-%COMP%]{display:flex;align-items:center;color:rgba(var(--font-dark),.65)}.name[_ngcontent-%COMP%]{font-size:1.2em}.location[_ngcontent-%COMP%]{font-size:.8em;flex:1;min-width:50%}.actions[_ngcontent-%COMP%], .capacity[_ngcontent-%COMP%]{display:flex;align-items:center}.actions[_ngcontent-%COMP%]{justify-content:center;flex-direction:column}@media screen and (max-width:639px){.actions[_ngcontent-%COMP%]{flex-direction:row;flex:1;margin-bottom:.5em}}a[_ngcontent-%COMP%]{width:8em;margin:.5em .5em 0}a[_ngcontent-%COMP%]:last-child{margin-bottom:.5em}@media screen and (max-width:639px){a[_ngcontent-%COMP%]{width:12em;margin:.5em}}"]}),t})();function C(t,e){if(1&t&&(c.Vb(0,"div",7),c.Qb(1,"a-control-space-list-item",8),c.Ub()),2&t){const t=e.$implicit;c.Db(1),c.qc("space",t)}}function P(t,e){if(1&t&&(c.Vb(0,"div",5),c.Lc(1,C,2,1,"div",6),c.Ub()),2&t){const t=c.jc();c.Db(1),c.qc("ngForOf",t.filtered_list)}}const M=function(){return{type:"icon",class:"material-icons",content:"close"}};function x(t,e){if(1&t&&(c.Vb(0,"div",5),c.Vb(1,"div",9),c.Vb(2,"div",10),c.Qb(3,"app-icon",11),c.Ub(),c.Vb(4,"div",12),c.Nc(5),c.Ub(),c.Ub(),c.Ub()),2&t){const t=c.jc();c.Db(3),c.qc("icon",c.tc(2,M)),c.Db(2),c.Pc(" ",t.search_str?' No matches for "'+t.search_str+'"':"No controllable spaces"," ")}}let y=(()=>{class t extends a.c{constructor(t,e){super(),this._spaces=t,this._org=e,this.space_list=[]}ngOnInit(){this._spaces.initialised.pipe(Object(l.a)(t=>t)).subscribe(()=>{this.space_list=this._spaces.filter(t=>!!t.support_url),this.space_list.sort((t,e)=>{const n=this._org.buildings.find(e=>e.id===t.level.parent_id),o=(t.name||"").toLowerCase(),i=((t.level?t.level.name:"")||"").toLowerCase(),a=((n?n.name:"")||"").toLowerCase(),s=this._org.buildings.find(t=>t.id===e.level.parent_id),c=(e.name||"").toLowerCase(),r=((e.level?e.level.name:"")||"").toLowerCase(),l=((s?s.name:"")||"").toLowerCase();return a.localeCompare(l)||i.localeCompare(r)||o.localeCompare(c)})})}get filtered_list(){const t=(this.search_str||"").toLowerCase();return(this.space_list||[]).filter(e=>{const n=this._org.buildings.find(t=>t.id===e.level.parent_id),o=(e.name||"").toLowerCase(),i=((e.level?e.level.name:"")||"").toLowerCase(),a=((n?n.name:"")||"").toLowerCase();return o.indexOf(t)>=0||i&&i.indexOf(t)>=0||a&&a.indexOf(t)>=0})}}return t.\u0275fac=function(e){return new(e||t)(c.Pb(g.d),c.Pb(d.c))},t.\u0275cmp=c.Jb({type:t,selectors:[["a-control-space-list"]],features:[c.Ab],decls:6,vars:5,consts:[[1,"control-list"],[1,"filter"],[3,"value","loading","autofocus","valueChange"],["class","list",4,"ngIf","ngIfElse"],["empty_state",""],[1,"list"],["class","item",4,"ngFor","ngForOf"],[1,"item"],[3,"space"],[1,"info-block"],[1,"icon"],[3,"icon"],[1,"text"]],template:function(t,e){if(1&t&&(c.Vb(0,"div",0),c.Vb(1,"div",1),c.Vb(2,"a-searchbar",2),c.fc("valueChange",(function(t){return e.search_str=t})),c.Ub(),c.Ub(),c.Lc(3,P,2,1,"div",3),c.Ub(),c.Lc(4,x,6,3,"ng-template",null,4,c.Mc)),2&t){const t=c.xc(5);c.Db(2),c.qc("value",e.search_str)("loading",e.loading)("autofocus",!0),c.Db(1),c.qc("ngIf",e.filtered_list.length)("ngIfElse",t)}},directives:[h.a,o.o,o.n,w,m.a],styles:[".control-list[_ngcontent-%COMP%], [_nghost-%COMP%]{height:100%;width:100%}.filter[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10}.control-list[_ngcontent-%COMP%]{position:relative;overflow:auto;background-color:var(--bg)}"]}),t})();var V=n("C9Ki"),S=n("d4mj");let L=(()=>{class t extends a.c{constructor(t){super(),this._settings=t}ngOnInit(){this._settings.title="Control",Object(s.b)()}}return t.\u0275fac=function(e){return new(e||t)(c.Pb(a.f))},t.\u0275cmp=c.Jb({type:t,selectors:[["app-control"]],features:[c.Ab],decls:8,vars:2,consts:[[1,"control","page"],[1,"header"],[3,"menu","menuChange"],[1,"body"],[1,"footer"],[3,"show","showChange"]],template:function(t,e){1&t&&(c.Vb(0,"div",0),c.Vb(1,"header",1),c.Vb(2,"a-topbar-header",2),c.fc("menuChange",(function(t){return e.show_menu=t})),c.Ub(),c.Ub(),c.Vb(3,"main",3),c.Qb(4,"a-control-space-list"),c.Ub(),c.Vb(5,"footer",4),c.Qb(6,"a-footer-menu"),c.Ub(),c.Ub(),c.Vb(7,"a-overlay-menu",5),c.fc("showChange",(function(t){return e.show_menu=t})),c.Ub()),2&t&&(c.Db(2),c.qc("menu",e.show_menu),c.Db(5),c.qc("show",e.show_menu))},directives:[r.a,y,V.a,S.a],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;align-items:center;flex-direction:column}.page[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{width:100%}.body[_ngcontent-%COMP%]{min-width:50%;flex:1;z-index:0;min-height:50%}"]}),t})();var j=n("R3Ii");const I=[{path:"",component:L}];let U=(()=>{class t{}return t.\u0275mod=c.Nb({type:t}),t.\u0275inj=c.Mb({factory:function(e){return new(e||t)},imports:[[o.c,i.g.forChild(I),j.a]]}),t})()}}]);
//# sourceMappingURL=control-control-module.865961cf2a45c7897c3b.js.map