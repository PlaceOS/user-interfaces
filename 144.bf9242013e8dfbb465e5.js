(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([[144],{8144:(t,e,n)=>{"use strict";n.r(e),n.d(e,{ReportsModule:()=>Qt});var s=n(1511),o=n(6073),i=n(6898),a=n(787),l=n(3005),c=n(2619),r=n(1490),u=n(4762),d=n(3530),p=n(3206),g=n(9294),h=n(8908),f=n(2547),_=n(7022),Z=n(205),m=n(8125),v=n(5090),y=n(7953),A=n(6280),x=864e5;function b(t,e){(0,A.Z)(2,arguments);var n=(0,Z.Z)(t),s=(0,Z.Z)(e),o=n.getTime()-(0,y.Z)(n),i=s.getTime()-(0,y.Z)(s);return Math.round((o-i)/x)}function q(t,e){var n=t.getFullYear()-e.getFullYear()||t.getMonth()-e.getMonth()||t.getDate()-e.getDate()||t.getHours()-e.getHours()||t.getMinutes()-e.getMinutes()||t.getSeconds()-e.getSeconds()||t.getMilliseconds()-e.getMilliseconds();return n<0?-1:n>0?1:n}function T(t,e){(0,A.Z)(2,arguments);var n=(0,v.Z)(t),s=(0,v.Z)(e),o=q(n,s),i=Math.abs(b(n,s));n.setDate(n.getDate()-o*i);var a=q(n,s)===-o,l=o*(i-a);return 0===l?0:l}var U=n(4441),w=n(5959),k=n(8512),O=n(878),M=n(3080),D=n(7701),J=n(4689),z=n(7727),L=n(9996),C=n(8303);let Q=(()=>{class t{constructor(t){this._org=t,this._generate=new w.xQ,this._loading=new k.X(""),this._active_bookings=new k.X([]),this._options=new k.X({start:new Date,end:new Date}),this._bookings_list=this._generate.pipe((0,D.b)(500),(0,J.w)(t=>{var e;const n=this._options.getValue();if(this._loading.next("Loading report details..."),!(null==n?void 0:n.type)&&!(null===(e=null==n?void 0:n.zones)||void 0===e?void 0:e.length))return(0,O.of)([]);const s=(0,Z.Z)((null==n?void 0:n.start)?new Date(n.start):new Date).valueOf(),o=(0,m.Z)((null==n?void 0:n.end)?new Date(n.end):s).valueOf(),i=(null==n?void 0:n.zones)?n.zones.filter(t=>"All"!==t).join(","):"",a={period_start:Math.floor(s/1e3),period_end:Math.floor(o/1e3)};return"desks"===n.type?(0,f.F2)(Object.assign(Object.assign({},a),{zones:i,type:"desk"})):(0,_.u$)(Object.assign(Object.assign({},a),{zone_ids:i}))}),(0,z.K)(t=>[]),(0,L.U)(t=>(this._loading.next(""),(null==t?void 0:t.length)||(0,p.cB)("No bookings for the selected levels and period"),this._active_bookings.next(t||[]),t)),(0,C.d)()),this.loading=this._loading.asObservable(),this.options=this._options.asObservable(),this.bookings=this._active_bookings.asObservable(),this.counts=this._options.pipe((0,D.b)(500),(0,J.w)(t=>{const e=(t.zones||[]).filter(t=>-1!==t&&"All"!==t);return Promise.all(e.map(t=>(0,h.rlq)(t,{name:"desks"}).pipe((0,L.U)(e=>[t,e.details.length])).toPromise()))}),(0,z.K)(t=>[]),(0,L.U)(t=>{const e={};return this._active_bookings.next([]),t.forEach(([t,n])=>e[t]=n),e}),(0,C.d)()),this.stats=(0,M.aj)([this.counts,this.bookings]).pipe((0,L.U)(([t,e])=>e[0]instanceof _.ym?function(t,e=8){const n=t.reduce((t,e)=>t+e.attendees.length,0),s=t.reduce((t,e)=>{var n;return t+(null===(n=e.system)||void 0===n?void 0:n.capacity)},0),o=t.reduce((t,e)=>t+e.duration,0)/(60*e),i=n/s;return{count:t.length,avg_length:t.reduce((t,e)=>t+e.duration,0)/t.length,efficiency:(o+i)/2,total_users:n,total_capacity:s,occupancy:i,utilisation:o,events:t}}(e,8*this.duration):function(t,e=1,n={}){const s=Object.keys(n).reduce((t,e)=>t+(n[e]||0),0);return{total:s,count:t.length,utilisation:t.length/s,events:t}}(e||[],this.duration,t))),this._bookings_list.subscribe(t=>t)}get duration(){const t=this._options.getValue();return Math.abs(T(t.start,t.end))}generateReport(){this._generate.next((new Date).valueOf())}setOptions(t){var e,n,s,o,i,a,l;(null===(e=t.zones)||void 0===e?void 0:e.includes("All"))?t.zones=["All",...this._org.levelsForBuilding(this._org.building).map(t=>t.id)]:t.zones&&(null===(s=null===(n=this._options.getValue())||void 0===n?void 0:n.zones)||void 0===s?void 0:s.includes("All"))&&(t.zones=[]),(null===(o=t.start)||void 0===o?void 0:o.valueOf())!==(null===(i=this._options.getValue().start)||void 0===i?void 0:i.valueOf())&&(null===(a=t.end)||void 0===a?void 0:a.valueOf())!==(null===(l=this._options.getValue().end)||void 0===l?void 0:l.valueOf())&&this._options.next(Object.assign(Object.assign({},this._options.getValue()),t))}downloadReport(){const t=this._options.getValue(),e=this._active_bookings.getValue();(0,p.Sv)(`report+${t.type}+${(0,U.Z)(t.start,"yyyy-MM-dd")}+${(0,U.Z)(t.end,"yyyy-MM-dd")}.csv`,(0,p.o3)(e.map(t=>{const e=t.toJSON();return delete e.zones,delete e.server_names,e})))}}return t.\u0275fac=function(e){return new(e||t)(c.LFG(g.w7))},t.\u0275prov=c.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Y=n(6283),j=n(4786),S=n(1522),N=n(5812),I=n(5980),P=n(7806);function R(t,e){if(1&t&&(c.TgZ(0,"mat-option",13),c._uU(1),c.qZA()),2&t){const t=e.$implicit;c.Q6J("value",t.id),c.xp6(1),c.hij(" ",t.display_name||t.name," ")}}function E(t,e){1&t&&c._UZ(0,"mat-spinner",14),2&t&&c.Q6J("diameter",32)}function F(t,e){1&t&&(c.TgZ(0,"p"),c._uU(1,"Generate Report"),c.qZA())}let B=(()=>{class t extends p.KG{constructor(t,e,n){super(),this._state=t,this._org=e,this._route=n,this.zones=[],this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(t=>`${t.id}`),this.levels=this._org.active_levels,this.loading=this._state.loading,this.bookings=this._state.bookings,this.options=this._state.options,this.generateReport=()=>this._state.generateReport(),this.downloadReport=()=>this._state.downloadReport(),this.setStartDate=t=>this._state.setOptions({start:new Date(t)}),this.setEndDate=t=>this._state.setOptions({end:new Date(t)}),this.setZones=t=>this._state.setOptions({zones:t})}ngOnInit(){return(0,u.mG)(this,void 0,void 0,function*(){yield this._org.initialised.pipe((0,d.P)(t=>t)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{if(t.has("zone_ids")){const e=t.get("zone_ids").split(",");if(e.length){const t=this._org.levelWithID(e);if(!t)return;this._org.building=this._org.buildings.find(e=>e.id===t.parent_id),this.setZones(e)}}}))})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(Q),c.Y36(g.w7),c.Y36(i.gz))},t.\u0275cmp=c.Xpm({type:t,selectors:[["reports-options"]],features:[c.qOj],decls:27,vars:28,consts:[["appearance","outline",1,"w-48"],["multiple","","placeholder","Select Levels...",3,"ngModel","ngModelChange"],["value","All"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-64"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["mat-button","",1,"ml-4",3,"disabled","click"],[3,"diameter",4,"ngIf"],[4,"ngIf"],[3,"value"],[3,"diameter"]],template:function(t,e){if(1&t&&(c.TgZ(0,"mat-form-field",0),c.TgZ(1,"mat-select",1),c.NdJ("ngModelChange",function(t){return e.setZones(t)}),c.ALo(2,"async"),c.TgZ(3,"mat-option",2),c._uU(4,"All Levels"),c.qZA(),c.YNc(5,R,2,2,"mat-option",3),c.ALo(6,"async"),c.qZA(),c.qZA(),c.TgZ(7,"mat-form-field",4),c.TgZ(8,"mat-date-range-input",5),c.TgZ(9,"input",6),c.NdJ("ngModelChange",function(t){return t?e.setStartDate(t):""}),c.ALo(10,"async"),c.qZA(),c.TgZ(11,"input",7),c.NdJ("ngModelChange",function(t){return t?e.setEndDate(t):""}),c.ALo(12,"async"),c.qZA(),c.qZA(),c._UZ(13,"mat-datepicker-toggle",8),c._UZ(14,"mat-date-range-picker",null,9),c.qZA(),c.TgZ(16,"button",10),c.NdJ("click",function(){return e.generateReport()}),c.ALo(17,"async"),c.ALo(18,"async"),c.YNc(19,E,1,1,"mat-spinner",11),c.ALo(20,"async"),c.YNc(21,F,2,0,"p",12),c.ALo(22,"async"),c.qZA(),c.TgZ(23,"button",10),c.NdJ("click",function(){return e.downloadReport()}),c.ALo(24,"async"),c.TgZ(25,"p"),c._uU(26,"Download Report"),c.qZA(),c.qZA()),2&t){const t=c.MAs(15);let n,s,o,i,a;c.xp6(1),c.Q6J("ngModel",null==(n=c.lcZ(2,10,e.options))?null:n.zones),c.xp6(4),c.Q6J("ngForOf",c.lcZ(6,12,e.levels)),c.xp6(3),c.Q6J("rangePicker",t),c.xp6(1),c.Q6J("ngModel",null==(s=c.lcZ(10,14,e.options))?null:s.start),c.xp6(2),c.Q6J("ngModel",null==(o=c.lcZ(12,16,e.options))?null:o.end),c.xp6(2),c.Q6J("for",t),c.xp6(3),c.Q6J("disabled",!!c.lcZ(17,18,e.loading)||!(null!=(i=c.lcZ(18,20,e.options))&&null!=i.zones&&i.zones.length)),c.xp6(3),c.Q6J("ngIf",c.lcZ(20,22,e.loading)),c.xp6(2),c.Q6J("ngIf",!c.lcZ(22,24,e.loading)),c.xp6(2),c.Q6J("disabled",!(null!=(a=c.lcZ(24,26,e.bookings))&&a.length))}},directives:[Y.KE,j.gD,o.JJ,o.On,S.ey,s.sg,N.wx,N.zY,o.Fj,N.By,N.nW,Y.R9,N._g,I.lW,s.O5,P.$g],pipes:[s.Ov],styles:["[_nghost-%COMP%]{display:flex;align-items:center;background-color:#fff;height:5em;padding:0 1em}button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;margin-left:1em}mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:5.5em;white-space:normal;line-height:1.2em}"]}),t})();var X=n(1548);const W=function(){return["/reports","desks"]},V=function(){return["/reports","spaces"]};let G=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.Xpm({type:t,selectors:[["reports-menu"],["","reports-menu",""]],decls:20,vars:4,consts:[["matRipple","",1,"h-64","w-64","m-4","p-4","flex","flex-col","items-center","justify-center","bg-white","rounded","shadow","hover:bg-gray-100",3,"routerLink"],[1,"text-8xl"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center"],[1,"ml-2"]],template:function(t,e){1&t&&(c.TgZ(0,"a",0),c.TgZ(1,"app-icon",1),c._uU(2,"room"),c.qZA(),c.TgZ(3,"h3",2),c._uU(4,"Desks"),c.qZA(),c.TgZ(5,"div",3),c.TgZ(6,"p"),c._uU(7,"View Report"),c.qZA(),c.TgZ(8,"app-icon",4),c._uU(9,"chevron_right"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(10,"a",0),c.TgZ(11,"app-icon",1),c._uU(12,"meeting_room"),c.qZA(),c.TgZ(13,"h3",2),c._uU(14,"Rooms"),c.qZA(),c.TgZ(15,"div",3),c.TgZ(16,"p"),c._uU(17,"View Report"),c.qZA(),c.TgZ(18,"app-icon",4),c._uU(19,"chevron_right"),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.Q6J("routerLink",c.DdM(2,W)),c.xp6(10),c.Q6J("routerLink",c.DdM(3,V)))},directives:[i.yS,S.wG,X.o],styles:["[_nghost-%COMP%]{display:flex;align-items:center;justify-content:center;background:var(--bg)}"]}),t})();const $=["app-reports",""];function K(t,e){1&t&&c._UZ(0,"div",4)}let H=(()=>{class t{constructor(t){this._router=t}get path(){const t=this._router.url.split("/");return t[t.length-1]}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(i.F0))},t.\u0275cmp=c.Xpm({type:t,selectors:[["","app-reports",""]],attrs:$,decls:6,vars:1,consts:[[1,"h-full"],[1,"relative","overflow-hidden","flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex-1","h-1/2","w-full","overflow-auto"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(t,e){1&t&&(c._UZ(0,"sidebar",0),c.TgZ(1,"main",1),c._UZ(2,"reports-options"),c.TgZ(3,"div",2),c._UZ(4,"router-outlet"),c.qZA(),c.YNc(5,K,1,0,"div",3),c.qZA()),2&t&&(c.xp6(5),c.Q6J("ngIf","reports"===e.path))},directives:[r.k,B,i.lC,s.O5,G],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;background:var(--bg)}"]}),t})();var tt=n(7209),et=n(4587),nt=n(8276);let st=(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe((0,L.U)(t=>t.count||0)),this.avg_length=this._state.stats.pipe((0,L.U)(t=>(0,nt.Z)({minutes:t.avg_length||0}))),this.efficiency=this._state.stats.pipe((0,L.U)(t=>(100*(t.efficiency||0)).toFixed(1))),this.total_users=this._state.stats.pipe((0,L.U)(t=>t.total_users||0)),this.total_capacity=this._state.stats.pipe((0,L.U)(t=>t.total_capacity||0)),this.occupancy=this._state.stats.pipe((0,L.U)(t=>(100*(t.occupancy||0)).toFixed(1))),this.utilisation=this._state.stats.pipe((0,L.U)(t=>(100*(t.utilisation||0)).toFixed(1)))}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(Q))},t.\u0275cmp=c.Xpm({type:t,selectors:[["report-spaces-overall"]],decls:44,vars:21,consts:[[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"flex-1","flex","flex-col","items-center","justify-center"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h3"),c._uU(3,"Total Bookings"),c.qZA(),c.TgZ(4,"p"),c._uU(5),c.ALo(6,"async"),c.qZA(),c.qZA(),c.TgZ(7,"div",1),c.TgZ(8,"h3"),c._uU(9,"Average Bookings Length"),c.qZA(),c.TgZ(10,"p"),c._uU(11),c.ALo(12,"async"),c.qZA(),c.qZA(),c.qZA(),c.TgZ(13,"div",0),c.TgZ(14,"div",2),c.TgZ(15,"h3"),c._uU(16,"Overall Efficiency"),c.qZA(),c.TgZ(17,"p"),c._uU(18),c.ALo(19,"async"),c.qZA(),c.qZA(),c.TgZ(20,"div",2),c.TgZ(21,"h3"),c._uU(22,"Occupancy"),c.qZA(),c.TgZ(23,"p"),c._uU(24),c.ALo(25,"async"),c.qZA(),c.qZA(),c.TgZ(26,"div",2),c.TgZ(27,"h3"),c._uU(28,"Total Attendees"),c.qZA(),c.TgZ(29,"p"),c._uU(30),c.ALo(31,"async"),c.qZA(),c.qZA(),c.TgZ(32,"div",2),c.TgZ(33,"h3"),c._uU(34,"Total Capacity"),c.qZA(),c.TgZ(35,"p"),c._uU(36),c.ALo(37,"async"),c.qZA(),c.qZA(),c.TgZ(38,"div",2),c.TgZ(39,"h3"),c._uU(40,"Utilisation"),c.qZA(),c.TgZ(41,"p"),c._uU(42),c.ALo(43,"async"),c.qZA(),c.qZA(),c.qZA()),2&t&&(c.xp6(5),c.Oqu(c.lcZ(6,7,e.total_count)||0),c.xp6(6),c.Oqu(c.lcZ(12,9,e.avg_length)||"None"),c.xp6(7),c.hij("",c.lcZ(19,11,e.efficiency)||0,"%"),c.xp6(6),c.hij("",c.lcZ(25,13,e.occupancy)||0,"%"),c.xp6(6),c.Oqu(c.lcZ(31,15,e.total_users)||0),c.xp6(6),c.Oqu(c.lcZ(37,17,e.total_capacity)||0),c.xp6(6),c.hij("",c.lcZ(43,19,e.utilisation)||0,"%"))},pipes:[s.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}"]}),t})();var ot=n(611),it=n(1657);const at=function(){return["name","capacity","count","utilisation","avg_attendees","occupancy"]},lt=function(){return["Name","Capacity","Meeting Count","Utilisation","Avg. Attendees","Occupancy"]},ct=function(){return["flex"]};let rt=(()=>{class t{constructor(t){this._reports=t,this.space_list=(0,M.aj)([this._reports.stats,this._reports.options]).pipe((0,D.b)(300),(0,L.U)(([t,{start:e,end:n}])=>{let s=[];for(const i of t.events){const t=i.resources||[];for(const e of t){s.find(t=>t.id===e.id)||s.push({id:e.id,name:e.display_name||e.name,capacity:e.capacity||1,count:0,attendees:0,avg_attendees:0,usage:0,utilisation:0,occupancy:0});const t=s.find(t=>t.id===e.id);t.count+=1,t.usage+=i.duration,t.attendees+=i.attendees.length}}const o=T(n,e);for(const i of s)i.avg_attendees=i.attendees/i.count,i.utilisation=i.usage/60/8/o,i.occupancy=i.avg_attendees/i.capacity;return s})),this.download=()=>(0,u.mG)(this,void 0,void 0,function*(){const t=yield this.space_list.pipe((0,ot.q)(1)).toPromise();(0,p.Sv)("report-spaces-usage.csv",(0,p.o3)(t))})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(Q))},t.\u0275cmp=c.Xpm({type:t,selectors:[["report-spaces-space-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h3",2),c._uU(3,"Space Utilisation"),c.qZA(),c.TgZ(4,"button",3),c.NdJ("click",function(){return e.download()}),c.TgZ(5,"app-icon"),c._uU(6,"download"),c.qZA(),c.qZA(),c.qZA(),c._UZ(7,"custom-table",4),c.qZA()),2&t&&(c.xp6(7),c.Q6J("dataSource",e.space_list)("pagination",!0)("columns",c.DdM(5,at))("display_column",c.DdM(6,lt))("column_size",c.DdM(7,ct)))},directives:[I.lW,X.o,it.C],styles:[""]}),t})();const ut=function(){return["name","capacity","count","avg_attendees","occupancy"]},dt=function(){return["Name","Capacity","Meeting Count","Avg. Attendees","Occupancy"]},pt=function(){return["flex"]};let gt=(()=>{class t{constructor(t){this._reports=t,this.user_list=(0,M.aj)([this._reports.stats]).pipe((0,D.b)(300),(0,L.U)(([t])=>{let e=[];for(const n of t.events){const t=n.attendees||[],s=n.resources.reduce((t,e)=>t+e.capacity,0)||1;for(const o of t){e.find(t=>t.email===o.email)||e.push({id:o.email,name:o.name,capacity:s,count:0,attendees:0,avg_attendees:0,occupancy:0});const t=e.find(t=>t.id===o.email);t.count+=1,t.attendees+=n.attendees.length}}for(const n of e)n.avg_attendees=n.attendees/n.count,n.occupancy=n.avg_attendees/n.capacity;return e}),(0,C.d)(1)),this.download=()=>(0,u.mG)(this,void 0,void 0,function*(){const t=yield this.user_list.pipe((0,ot.q)(1)).toPromise();(0,p.Sv)("report-space-attendee-usage.csv",(0,p.o3)(t))})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(Q))},t.\u0275cmp=c.Xpm({type:t,selectors:[["report-spaces-user-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h3",2),c._uU(3,"Staff Utilisation"),c.qZA(),c.TgZ(4,"button",3),c.NdJ("click",function(){return e.download()}),c.TgZ(5,"app-icon"),c._uU(6,"download"),c.qZA(),c.qZA(),c.qZA(),c._UZ(7,"custom-table",4),c.qZA()),2&t&&(c.xp6(7),c.Q6J("dataSource",e.user_list)("pagination",!0)("columns",c.DdM(5,ut))("display_column",c.DdM(6,dt))("column_size",c.DdM(7,pt)))},directives:[I.lW,X.o,it.C],styles:[""]}),t})();const ht=["report-spaces",""];function ft(t,e){1&t&&(c.ynx(0),c._UZ(1,"report-spaces-overall"),c._UZ(2,"report-spaces-space-listing"),c._UZ(3,"report-spaces-user-listing"),c.BQk())}function _t(t,e){if(1&t&&(c.ynx(0),c.YNc(1,ft,4,0,"ng-container",0),c.ALo(2,"async"),c.BQk()),2&t){const t=c.oxw(),e=c.MAs(5);c.xp6(1),c.Q6J("ngIf",c.lcZ(2,2,t.total_count))("ngIfElse",e)}}function Zt(t,e){1&t&&(c.TgZ(0,"div",3),c._UZ(1,"mat-spinner",4),c.TgZ(2,"p",5),c._uU(3,"Loading report data..."),c.qZA(),c.qZA()),2&t&&(c.xp6(1),c.Q6J("diameter",32))}function mt(t,e){1&t&&(c.TgZ(0,"div",3),c.TgZ(1,"p",5),c._uU(2," Select levels and time period to generate a report. "),c.qZA(),c.qZA())}let vt=(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe((0,L.U)(t=>t.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(Q))},t.\u0275cmp=c.Xpm({type:t,selectors:[["","report-spaces",""]],attrs:ht,decls:6,vars:4,consts:[[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(t,e){if(1&t&&(c.YNc(0,_t,3,4,"ng-container",0),c.ALo(1,"async"),c.YNc(2,Zt,4,1,"ng-template",null,1,c.W1O),c.YNc(4,mt,3,0,"ng-template",null,2,c.W1O)),2&t){const t=c.MAs(3);c.Q6J("ngIf",!c.lcZ(1,2,e.loading))("ngIfElse",t)}},directives:[s.O5,st,rt,gt,P.$g],pipes:[s.Ov],styles:[""]}),t})();var yt=n(9310),At=n(3848);const xt=function(){return["date","usage","approved","count","utilisation"]},bt=function(){return["Date","Used Desks","Approved Bookings","Total Requests","Utilisation"]},qt=function(){return["flex"]};let Tt=(()=>{class t{constructor(t){this._state=t,this.day_list=(0,M.aj)([this._state.options,this._state.stats]).pipe((0,L.U)(([t,e])=>{const{start:n,end:s}=t;let o=n;const i=[];for(;(0,yt.Z)(o,s);){const t=(0,Z.Z)(o).valueOf(),n=(0,m.Z)(t).valueOf(),s=e.events.filter(e=>(0,p.MZ)(t,n,e.date,e.date+60*e.duration*1e3));i.push({date:t,total:e.total,free:e.total-s.length,approved:s.reduce((t,e)=>t+(e.approved?1:0),0),count:s.length,utilisation:(s.length/e.total*100).toFixed(1)}),o=(0,At.Z)(o,1)}return i}),(0,C.d)(1)),this.download=()=>(0,u.mG)(this,void 0,void 0,function*(){let t=yield this.day_list.pipe((0,ot.q)(1)).toPromise();t=t.map(t=>Object.assign(Object.assign({},t),{date:(0,U.Z)(t.date,"MMMM d, y(EEE)")})),(0,p.Sv)("desks-usage.csv",(0,p.o3)(t))})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(Q))},t.\u0275cmp=c.Xpm({type:t,selectors:[["report-desks-overall-list"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h3",2),c._uU(3,"Daily Utilisation"),c.qZA(),c.TgZ(4,"button",3),c.NdJ("click",function(){return e.download()}),c.TgZ(5,"app-icon"),c._uU(6,"download"),c.qZA(),c.qZA(),c.qZA(),c._UZ(7,"custom-table",4),c.qZA()),2&t&&(c.xp6(7),c.Q6J("dataSource",e.day_list)("pagination",!0)("columns",c.DdM(5,xt))("display_column",c.DdM(6,bt))("column_size",c.DdM(7,qt)))},directives:[I.lW,X.o,it.C],encapsulation:2}),t})();const Ut=function(){return["name","avg_usage","approved","count","utilisation"]},wt=function(){return["Level","Avg. Used Desks","Approved Bookings","Total Requests","Utilisation"]},kt=function(){return["flex"]};let Ot=(()=>{class t{constructor(t,e){this._state=t,this._org=e,this.level_list=(0,M.aj)([this._state.options,this._state.stats,this._state.counts]).pipe((0,L.U)(([t,e,n])=>{const{start:s,end:o,zones:i}=t,a=T(o,s),l=[];for(const c of i){if("All"===c)continue;const t=this._org.levelWithID([c]),s=n[c]||0,o=e.events.filter(t=>t.zones.includes(c));let i=(s*a-o.length)/a;i%1!=0&&(i=i.toFixed(2)),l.push({name:(null==t?void 0:t.display_name)||(null==t?void 0:t.name),free:i,total:s,count:o.length,utilisation:(o.length/(s*a)*100||0).toFixed(2)})}return l}),(0,C.d)(1)),this.download=()=>(0,u.mG)(this,void 0,void 0,function*(){let t=yield this.level_list.pipe((0,ot.q)(1)).toPromise();(0,p.Sv)("desks-levels-usage.csv",(0,p.o3)(t))})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(Q),c.Y36(g.w7))},t.\u0275cmp=c.Xpm({type:t,selectors:[["report-desks-levels-list"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","shadow","overflow-hidden"],[1,"border-b","border-gray-300","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["mat-icon-button","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size"]],template:function(t,e){1&t&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h3",2),c._uU(3,"Level Utilisation"),c.qZA(),c.TgZ(4,"button",3),c.NdJ("click",function(){return e.download()}),c.TgZ(5,"app-icon"),c._uU(6,"download"),c.qZA(),c.qZA(),c.qZA(),c._UZ(7,"custom-table",4),c.qZA()),2&t&&(c.xp6(7),c.Q6J("dataSource",e.level_list)("pagination",!0)("columns",c.DdM(5,Ut))("display_column",c.DdM(6,wt))("column_size",c.DdM(7,kt)))},directives:[I.lW,X.o,it.C],encapsulation:2}),t})();const Mt=["report-desks",""];function Dt(t,e){if(1&t&&(c.ynx(0),c.TgZ(1,"div",3),c.TgZ(2,"div",4),c.TgZ(3,"h3"),c._uU(4,"Total Bookings"),c.qZA(),c.TgZ(5,"p"),c._uU(6),c.ALo(7,"async"),c.qZA(),c.qZA(),c.TgZ(8,"div",4),c.TgZ(9,"h3"),c._uU(10,"Utilisation"),c.qZA(),c.TgZ(11,"p"),c._uU(12),c.ALo(13,"async"),c.qZA(),c.qZA(),c.qZA(),c._UZ(14,"report-desks-overall-list"),c._UZ(15,"report-desks-levels-list"),c.BQk()),2&t){const t=c.oxw(2);c.xp6(6),c.Oqu(c.lcZ(7,2,t.total_count)||0),c.xp6(6),c.hij("",c.lcZ(13,4,t.utilisation)||0,"%")}}function Jt(t,e){if(1&t&&(c.ynx(0),c.YNc(1,Dt,16,6,"ng-container",0),c.ALo(2,"async"),c.BQk()),2&t){const t=c.oxw(),e=c.MAs(5);c.xp6(1),c.Q6J("ngIf",c.lcZ(2,2,t.total_count))("ngIfElse",e)}}function zt(t,e){1&t&&(c.TgZ(0,"div",5),c._UZ(1,"mat-spinner",6),c.TgZ(2,"p",7),c._uU(3,"Loading report data..."),c.qZA(),c.qZA()),2&t&&(c.xp6(1),c.Q6J("diameter",32))}function Lt(t,e){1&t&&(c.TgZ(0,"div",5),c.TgZ(1,"p",7),c._uU(2," Select levels and time period to generate a report. "),c.qZA(),c.qZA())}const Ct=[{path:"",component:H,children:[{path:""},{path:"spaces",component:vt},{path:"desks",component:(()=>{class t{constructor(t){this._state=t,this.total_count=this._state.stats.pipe((0,L.U)(t=>t.count||0)),this.utilisation=this._state.stats.pipe((0,L.U)(t=>(100*(t.utilisation||0)).toFixed(1))),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"desks"})}}return t.\u0275fac=function(e){return new(e||t)(c.Y36(Q))},t.\u0275cmp=c.Xpm({type:t,selectors:[["","report-desks",""]],attrs:Mt,decls:6,vars:4,consts:[[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(t,e){if(1&t&&(c.YNc(0,Jt,3,4,"ng-container",0),c.ALo(1,"async"),c.YNc(2,zt,4,1,"ng-template",null,1,c.W1O),c.YNc(4,Lt,3,0,"ng-template",null,2,c.W1O)),2&t){const t=c.MAs(3);c.Q6J("ngIf",!c.lcZ(1,2,e.loading))("ngIfElse",t)}},directives:[s.O5,Tt,Ot,P.$g],pipes:[s.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}"]}),t})()},{path:"**",redirectTo:"desks"}]}];let Qt=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.oAB({type:t}),t.\u0275inj=c.cJS({imports:[[s.ez,o.u5,a.v,tt.YR,et.PP,l.TU,i.Bz.forChild(Ct)]]}),t})()}}]);