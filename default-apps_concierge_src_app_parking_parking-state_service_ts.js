"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["default-apps_concierge_src_app_parking_parking-state_service_ts"],{96685:(G,y,a)=>{a.d(y,{U:()=>d});var n=a(89204),t=a(34456),m=a(12587),T=a(57915),p=a(77375),M=a(56441),O=a(28797),e=a(7404),A=a(60316),k=a(24950),C=a(87984),U=a(97024),I=a(41134),R=a(85060),F=a(19608),x=a(83476),B=a(81413),h=a(18e3),g=a(69434),f=a(24844);const l=()=>({standalone:!0});function E(_,r){1&_&&(e.j41(0,"button",10)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function D(_,r){1&_&&(e.j41(0,"div",30),e.nrm(1,"a-user-search-field",31),e.k0s())}function b(_,r){1&_&&(e.j41(0,"mat-checkbox",32),e.pXf(1,1),e.k0s())}function j(_,r){if(1&_){const o=e.RV6();e.j41(0,"div",13)(1,"div",33)(2,"label",34),e.PLo(3,2),e.nrm(4,"span"),e.YFu(),e.k0s(),e.j41(5,"a-time-field",35),e.bIt("ngModelChange",function(c){e.eBV(o);const u=e.XpG(2);return e.Njj(u.form.patchValue({date:c}))}),e.k0s()(),e.j41(6,"div",36)(7,"label",37),e.PLo(8,3),e.nrm(9,"span"),e.YFu(),e.k0s(),e.nrm(10,"a-duration-field",38),e.k0s()()}if(2&_){const o=e.XpG(2);e.R7$(5),e.Y8G("ngModel",o.form.value.date)("ngModelOptions",e.lJ4(6,l))("use_24hr",o.use_24hr),e.R7$(5),e.Y8G("time",null==o.form||null==o.form.value?null:o.form.value.date)("max",o.max_duration)("use_24hr",o.use_24hr)}}function S(_,r){1&_&&(e.j41(0,"span"),e.EFF(1,"*"),e.k0s())}function N(_,r){if(1&_&&(e.j41(0,"main",11),e.DNE(1,D,2,0,"div",12),e.j41(2,"div",13)(3,"div",14)(4,"label",15),e.EFF(5,"Name"),e.k0s(),e.j41(6,"mat-form-field",16),e.nrm(7,"input",17),e.j41(8,"mat-error"),e.EFF(9,"A name is required"),e.k0s()()(),e.j41(10,"div",14)(11,"label",18),e.EFF(12,"Email"),e.k0s(),e.j41(13,"mat-form-field",16),e.nrm(14,"input",19),e.j41(15,"mat-error"),e.EFF(16,"An email is required"),e.k0s()()()(),e.j41(17,"div",20)(18,"label",21),e.EFF(19,"Date"),e.k0s(),e.nrm(20,"a-date-field",22),e.DNE(21,b,2,0,"mat-checkbox",23),e.k0s(),e.DNE(22,j,11,7,"div",24),e.j41(23,"label",25),e.EFF(24,"Parking Space"),e.k0s(),e.nrm(25,"parking-space-list-field",26),e.j41(26,"label",27),e.EFF(27," Plate Number"),e.DNE(28,S,2,0,"span",28),e.k0s(),e.j41(29,"mat-form-field",16),e.nrm(30,"input",29),e.j41(31,"mat-error"),e.EFF(32,"A plate number is required"),e.k0s()()()),2&_){const o=e.XpG();e.Y8G("formGroup",o.form),e.R7$(),e.Y8G("ngIf",!o.user),e.R7$(20),e.Y8G("ngIf",o.allow_all_day),e.R7$(),e.Y8G("ngIf",!o.form.value.all_day),e.R7$(6),e.Y8G("ngIf",o.user)}}function $(_,r){if(1&_){const o=e.RV6();e.j41(0,"footer",39)(1,"button",40),e.EFF(2," Cancel "),e.k0s(),e.j41(3,"button",41),e.bIt("click",function(){e.eBV(o);const c=e.XpG();return e.Njj(c.postForm())}),e.EFF(4," Save "),e.k0s()()}}function i(_,r){1&_&&(e.j41(0,"main",42),e.nrm(1,"mat-spinner",43),e.j41(2,"p"),e.EFF(3,"Saving parking reservation..."),e.k0s()())}let d=(()=>{class _ extends p.Tv{get id(){return this.form.value.id}get end_date(){return(0,M.D)((0,O.f)(Date.now(),this._settings.get("app.parking.available_period")||7))}get max_duration(){return this._settings.get("app.bookings.max_duration")||480}get allow_all_day(){return this._settings.get("app.parking.allow_all_day")||!0}get use_24hr(){return this._settings.get("app.use_24_hour_time")}constructor(o,s,c,u){super(),this._data=o,this._booking_form=s,this._dialog_ref=c,this._settings=u,this.loading=!1,this.user=this._data.user,this.date=this._data.date,this.form=this._booking_form.form}ngOnInit(){this._booking_form.newForm(this._data.booking),this._booking_form.setOptions({type:"parking"}),this.subscription("user_changes",this.form.controls.user.valueChanges.subscribe(o=>{o&&this.form.patchValue({user_name:o.name,user_email:o.email,attendees:[o]})})),this.form.patchValue({all_day:!0,booking_type:"parking"}),this.form.value.user||this.form.patchValue({user:this._data.booking?.attendees[0]||(0,p.Ny)()}),this._data.user&&(this.form.patchValue({user_email:this._data.user.email,user_name:this._data.user.name,attendees:[this._data.user]}),this.form.controls.plate_number.setValidators([t.k0.required]),this.form.controls.user_name.disable(),this.form.controls.user_email.disable()),this._data.level&&this._booking_form.setOptions({zone_id:this._data.level.id}),this._data.link_id&&this.form.patchValue({parent_id:this._data.link_id}),this._data.space&&this.form.patchValue({resources:[this._data.space]}),this._data.date&&(this.timeout("init_date",()=>{this.form.patchValue({date:this._data.date}),this._data.allow_time_changes||this.form.get("date").disable()},300),this._data.allow_time_changes||this.subscription("form_change",this.form.valueChanges.subscribe(o=>{this.timeout("disable_date",()=>this.form.get("date").disable({emitEvent:!1}),50)})))}postForm(){var o=this;return(0,n.A)(function*(){if(o.form.markAllAsTouched(),o.form.updateValueAndValidity(),!o.form.valid)return;o.loading=!0;const s=o.form.value.id;o.form.patchValue({user_id:void 0});const c=yield o._booking_form.postForm().catch(u=>{throw o.loading=!1,o.form.controls.plate_number.setValidators([]),(0,p.UG)(u),u});o.form.controls.plate_number.setValidators([]),(0,p.VX)(`Successfully ${s?"updated":"created"} parking reservation`),o._dialog_ref.close(c.id)})()}static#e=this.\u0275fac=function(s){return new(s||_)(e.rXU(m.Vh),e.rXU(T.nx),e.rXU(m.CP),e.rXU(p.h$))};static#t=this.\u0275cmp=e.VBU({type:_,selectors:[["parking-booking-modal"]],features:[e.Vt3],decls:9,vars:5,consts:()=>{let o,s,c;return o=$localize`:␟d7f43e20f3a729fa3de32bc7a1f709ccd722eae5␟835486935962207481: All Day `,s=$localize`:␟34a7595cdc15925514038224946986bfd90dc0ed␟3039786638368843634:Start Time${"\ufffd#4\ufffd"}:START_TAG_SPAN:*${"\ufffd/#4\ufffd"}:CLOSE_TAG_SPAN:`,c=$localize`:␟85d5c3a89bab9a7475a7db095089e161586cb7a1␟5960185837188220843:End Time${"\ufffd#9\ufffd"}:START_TAG_SPAN:*${"\ufffd/#9\ufffd"}:CLOSE_TAG_SPAN:`,[["load_state",""],o,s,c,[1,"w-[32rem]"],[1,"flex","items-center","justify-between","px-2","w-full"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col max-h-[65vh] overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex items-center justify-end space-x-2 p-2 border-t border-base-200",4,"ngIf"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","flex","flex-col","max-h-[65vh]","overflow-auto",3,"formGroup"],["class","flex items-center space-x-2 mb-4",4,"ngIf"],[1,"flex","items-center","space-x-2"],[1,"flex-1"],["for","user-name"],["appearance","outline",1,"w-full"],["matInput","","name","user-name","formControlName","user_name","placeholder","Name"],["for","email"],["matInput","","name","email","formControlName","user_email","placeholder","Email"],[1,"relative"],["for","date"],["formControlName","date"],["formControlName","all_day","class","absolute -top-2 right-0",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],["for","parking-space"],["name","parking-space","formControlName","resources",1,"mb-2"],["for","plate-number"],[4,"ngIf"],["matInput","","name","plate-number","formControlName","plate_number","placeholder","Plate Number"],[1,"flex","items-center","space-x-2","mb-4"],["name","user","formControlName","user",1,"flex-1"],["formControlName","all_day",1,"absolute","-top-2","right-0"],[1,"flex-1","w-1/3"],["for","start-time"],["name","start-time",3,"ngModelChange","ngModel","ngModelOptions","use_24hr"],[1,"flex-1","w-1/3","relative"],["for","end-time"],["name","end-time","formControlName","duration",3,"time","max","use_24hr"],[1,"flex","items-center","justify-end","space-x-2","p-2","border-t","border-base-200"],["btn","","matRipple","","mat-dialog-close","",1,"w-32","inverse"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"p-8","flex","flex-col","items-center","justify-center","user-y-2"],["diameter","32"]]},template:function(s,c){if(1&s&&(e.j41(0,"div",4)(1,"header",5)(2,"h2",6),e.EFF(3),e.k0s(),e.DNE(4,E,3,0,"button",7),e.k0s(),e.DNE(5,N,33,5,"main",8)(6,$,5,0,"footer",9),e.k0s(),e.DNE(7,i,4,0,"ng-template",null,0,e.C5r)),2&s){const u=e.sdS(8);e.R7$(3),e.SpI(" ",c.id?"Edit":"New"," Parking Reservation "),e.R7$(),e.Y8G("ngIf",!c.loading),e.R7$(),e.Y8G("ngIf",!c.loading)("ngIfElse",u),e.R7$(),e.Y8G("ngIf",!c.loading)}},dependencies:[A.bT,k.rl,k.TL,C.fg,U.So,I.LG,m.tx,R.r6,t.me,t.BC,t.cb,t.vS,t.j4,t.JD,F.G,x.y,B.t,h.$,g.R,f.I]})}return _})()},34836:(G,y,a)=>{a.d(y,{D:()=>B});var n=a(89204),t=a(7404),m=a(34456),T=a(12587),p=a(68390),M=a(60316),O=a(24950),e=a(87984),A=a(80640),k=a(41134),C=a(85060),U=a(18e3),I=a(69434);function R(h,g){1&h&&(t.j41(0,"button",6)(1,"app-icon"),t.EFF(2,"close"),t.k0s()())}function F(h,g){if(1&h){const f=t.RV6();t.j41(0,"main",7)(1,"label",8),t.EFF(2,"Parking Space Name/Bay Number"),t.k0s(),t.j41(3,"mat-form-field",9),t.nrm(4,"input",10),t.j41(5,"mat-error"),t.EFF(6,"A name is required for parking spaces"),t.k0s()(),t.j41(7,"label",11),t.EFF(8,"Map ID"),t.k0s(),t.j41(9,"mat-form-field",9),t.nrm(10,"input",12),t.j41(11,"mat-error"),t.EFF(12," A map ID is required for parking spaces "),t.k0s()(),t.j41(13,"label",13),t.EFF(14,"Assigned User"),t.k0s(),t.j41(15,"div",14),t.nrm(16,"a-user-search-field",15),t.j41(17,"button",16),t.bIt("click",function(){t.eBV(f);const E=t.XpG();return t.Njj(E.form.patchValue({assigned_user:null,assigned_to:null,assigned_name:null}))}),t.j41(18,"app-icon",17),t.EFF(19," person_cancel "),t.k0s()()(),t.j41(20,"label",18),t.EFF(21,"Notes"),t.k0s(),t.j41(22,"mat-form-field",9),t.nrm(23,"textarea",19),t.k0s(),t.j41(24,"div",20)(25,"button",21),t.EFF(26," Cancel "),t.k0s(),t.j41(27,"button",22),t.bIt("click",function(){t.eBV(f);const E=t.XpG();return t.Njj(E.postForm())}),t.EFF(28," Save "),t.k0s()()()}if(2&h){const f=t.XpG();t.Y8G("formGroup",f.form)}}function x(h,g){1&h&&(t.j41(0,"main",23),t.nrm(1,"mat-spinner",24),t.j41(2,"p"),t.EFF(3,"Saving parking space details..."),t.k0s()())}let B=(()=>{class h{get id(){return this._data?.id||""}constructor(f,l){this._data=f,this._dialog_ref=l,this.event=new t.bkB,this.form=new m.gE({id:new m.MJ(""),name:new m.MJ("",[m.k0.required]),map_id:new m.MJ("",[m.k0.required]),assigned_user:new m.MJ(null),assigned_to:new m.MJ(""),assigned_name:new m.MJ(""),notes:new m.MJ(""),map_rotation:new m.MJ(0)}),f&&this.form.patchValue(f)}ngOnInit(){var f=this;return(0,n.A)(function*(){if(f._data.assigned_to){const l=yield(0,p.SZ)(f._data.assigned_to).toPromise();l&&f.form.patchValue({assigned_user:l,assigned_to:l.email,assigned_name:l.name})}})()}postForm(){if(!this.form.valid)return;this.loading=!0;const f={...this.form.getRawValue()};f.assigned_user&&(f.assigned_to=f.assigned_user.email,f.assigned_name=f.assigned_user.name,delete f.assigned_user),this._dialog_ref.disableClose=!0,this.event.emit({reason:"done",metadata:f})}static#e=this.\u0275fac=function(l){return new(l||h)(t.rXU(T.Vh),t.rXU(T.CP))};static#t=this.\u0275cmp=t.VBU({type:h,selectors:[["parking-space-modal"]],outputs:{event:"event"},decls:8,vars:4,consts:[["load_state",""],[1,"w-[28rem]"],[1,"flex","items-center","justify-between","px-2","w-full"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col",3,"formGroup",4,"ngIf","ngIfElse"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","flex","flex-col",3,"formGroup"],["for","name"],["appearance","outline"],["matInput","","name","name","formControlName","name"],["for","map-id"],["matInput","","name","map-id","formControlName","map_id"],["for","user"],[1,"flex","items-center","space-x-2","mb-4"],["name","user","formControlName","assigned_user",1,"flex-1"],["icon","","matRipple","","matTooltip","Clear Assigned User",1,"h-12","w-12","min-w-12","rounded","bg-secondary","text-secondary-content",3,"click"],["className","material-symbols-outlined"],["for","notes"],["matInput","","name","notes","formControlName","notes"],[1,"flex","items-center","justify-center","space-x-2"],["btn","","matRipple","","mat-dialog-close","",1,"w-32","inverse"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"]],template:function(l,E){if(1&l&&(t.j41(0,"div",1)(1,"header",2)(2,"h2",3),t.EFF(3),t.k0s(),t.DNE(4,R,3,0,"button",4),t.k0s(),t.DNE(5,F,29,1,"main",5),t.k0s(),t.DNE(6,x,4,0,"ng-template",null,0,t.C5r)),2&l){const D=t.sdS(7);t.R7$(3),t.SpI("",E.id?"Edit":"New"," Parking Space"),t.R7$(),t.Y8G("ngIf",!E.loading),t.R7$(),t.Y8G("ngIf",!E.loading)("ngIfElse",D)}},dependencies:[M.bT,O.rl,O.TL,e.fg,A.oV,k.LG,T.tx,C.r6,m.me,m.BC,m.cb,m.j4,m.JD,U.$,I.R]})}return h})()},28007:(G,y,a)=>{a.d(y,{X:()=>S});var n=a(89204),t=a(57915),m=a(77375),T=a(12185),p=a(3998),M=a(99908),O=a(33240),e=a(56441),A=a(10764),k=a(90521),C=a(42175),U=a(71536),I=a(35443),R=a(71963),F=a(66e3),x=a(7841),B=a(8627),h=a(19803),g=a(57871),f=a(33602),l=a(34836),E=a(6233),D=a(96685),b=a(7404),j=a(12587);let S=(()=>{class N extends m.Tv{constructor(i,d,_){super(),this._org=i,this._dialog=d,this._settings=_,this._poll=new k.t(0),this._change=new k.t(0),this._options=new k.t({date:Date.now(),search:"",zones:[]}),this._loading=new k.t([]),this.levels=(0,C.zV)([this._org.active_region,this._org.active_building]).pipe((0,I.T)(([r,o])=>{const s=this._org.levels.filter(c=>c.tags.includes("parking"));if(this._settings.get("app.use_region")){const c=this._org.buildingsForRegion(),u=c.map(P=>P.id),v=s.filter(P=>u.includes(P.parent_id));return v.map(P=>({...P,display_name:`${c.find(L=>L.id===P.parent_id)?.display_name} - ${P.display_name}`})),v}return s.filter(c=>c.parent_id===o.id)})),this.spaces=(0,C.zV)([this.levels,this._options,this._change]).pipe((0,R.n)(([r,o])=>o.zones[0]||r[0]?.id?(this._loading.next([...this._loading.getValue(),"spaces"]),(0,p.bpY)(o.zones[0]||r[0]?.id,"parking-spaces").pipe((0,I.T)(({details:s})=>(s instanceof Array?s:[]).map(c=>({...c,zone_id:o.zones[0]||r[0]?.id}))))):(0,U.of)([])),(0,F.M)(()=>this._loading.next(this._loading.getValue().filter(r=>"spaces"!==r))),(0,x.t)(1)),this.users=(0,C.zV)([this._org.active_building,this._change]).pipe((0,B.p)(([r])=>!!r?.id),(0,R.n)(([r])=>(this._loading.next([...this._loading.getValue(),"users"]),(0,p.bpY)(r.id,"parking-users"))),(0,I.T)(r=>r.details instanceof Array?r.details:[]),(0,F.M)(()=>this._loading.next(this._loading.getValue().filter(r=>"users"!==r))),(0,x.t)(1)),this.bookings=(0,C.zV)([this._org.active_building,this._options,this.users,this._poll,this._change]).pipe((0,h.B)(500),(0,R.n)(([r,o,s])=>(this._loading.next([...this._loading.getValue(),"bookings"]),(0,t.tj)({period_start:(0,M._)((0,O.o)(o.date)),period_end:(0,M._)((0,e.D)(o.date)),type:"parking",zones:o.zones?.length?o.zones.join(","):(this._settings.get("app.use_region")?this._org.region?.id:"")||r?.id,include_checked_out:!0}).pipe((0,I.T)(c=>{for(const u of c){const v=s.find(P=>P.email.toLowerCase()===u.user_email.toLowerCase());v&&(u.extension_data.plate_number=u.extension_data.plate_number||v.plate_number)}return c})))),(0,F.M)(()=>this._loading.next(this._loading.getValue().filter(r=>"bookings"!==r))),(0,x.t)(1)),this.options=this._options.asObservable(),this.loading=this._loading.asObservable()}setOptions(i){this._options.next({...this._options.getValue(),...i})}startPolling(i=12e4){return this._poll.next(Date.now()),this.interval("poll",()=>this._poll.next(Date.now()),i),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}editSpace(i={}){var d=this;return(0,n.A)(function*(){const _=d._dialog.open(l.D,{data:i}),r=yield Promise.race([_.afterClosed().toPromise(),_.componentInstance.event.pipe((0,g.$)(P=>"done"===P.reason)).toPromise()]);if("done"!==r?.reason)return;const o=d._options.getValue().zones[0]||i.zone_id||d._org.levelsForBuilding()[0]?.id,s={...r.metadata,zone:o,id:r.metadata.id||`parking-${o}.${(0,m.HO)(999999)}`},c=yield d.spaces.pipe((0,f.s)(1)).toPromise(),u=c.findIndex(P=>P.id===s.id);if(i.assigned_to&&i.assigned_to!==s.assigned_to){const L=(yield(0,t.tj)({period_start:(0,M._)((0,O.o)(Date.now())),period_end:(0,M._)((0,e.D)(Date.now())),type:"parking",email:s.assigned_to,include_checked_out:!0}).toPromise()).filter(K=>K.asset_id===i.id);yield Promise.all(L.map(K=>(0,t.UN)(K.id).toPromise()))}i.assigned_to!==s.assigned_to&&s.assigned_to&&(yield(0,t.X0)(new t.Qr({user_id:s.assigned_to,user_email:s.assigned_to,booking_start:(0,M._)((0,O.o)(Date.now())),booking_end:(0,M._)((0,e.D)(Date.now())),type:"parking",booking_type:"parking",asset_id:s.id,asset_name:s.name,recurrence_type:"daily",recurrence_days:t.WS.MONDAY|t.WS.TUESDAY|t.WS.WEDNESDAY|t.WS.THURSDAY|t.WS.FRIDAY,zones:(0,m.Am)([d._org.organisation.id,d._org.region?.id,d._org.building?.id,s.zone_id||s.zone?.id||s.zone]),extension_data:{asset_name:s.name}})).toPromise()),u>=0?c[u]=s:c.push(s);const v=c;yield(0,p.D58)(o,{name:"parking-spaces",details:v,description:"List of available parking spaces"}).toPromise(),d._change.next(Date.now()),_.close()})()}removeSpace(i){var d=this;return(0,n.A)(function*(){const _=yield(0,m.GE)({title:"Remove Parking Space",content:`Are you sure you wish to remove the parking space "${i.name}"?`,icon:{content:"delete"}},d._dialog);if("done"!==_?.reason)return;_.loading("Removing parking space...");const r=d._options.getValue().zones[0],o=yield d.spaces.pipe((0,f.s)(1)).toPromise();yield(0,p.D58)(r,{name:"parking-spaces",details:o.filter(s=>s.id!==i.id),description:"List of available parking spaces"}).toPromise(),_.close()})()}editUser(i){var d=this;return(0,n.A)(function*(){const _=d._dialog.open(E.K,{data:i}),r=yield Promise.race([_.afterClosed().toPromise(),_.componentInstance.event.pipe((0,g.$)(v=>"done"===v.reason)).toPromise()]);if("done"!==r?.reason)return;const o=d._org.building.id,s={...r.metadata,id:r.metadata.id||`P:USR-${(0,m.HO)(999999)}`};"user"in s&&delete s.user;const c=yield d.users.pipe((0,f.s)(1)).toPromise(),u=c.findIndex(v=>v.id===s.id);u>=0?c[u]=s:c.push(s),yield(0,p.D58)(o,{name:"parking-users",details:c,description:"List of available parking users"}).toPromise(),d._change.next(Date.now()),_.close()})()}removeUser(i){var d=this;return(0,n.A)(function*(){const _=yield(0,m.GE)({title:"Remove Parking User",content:`Are you sure you wish to remove the parking user "${i.name}"?`,icon:{content:"delete"}},d._dialog);if("done"!==_?.reason)return;_.loading("Removing parking user...");const r=d._org.building.id,o=yield d.users.pipe((0,f.s)(1)).toPromise();yield(0,p.D58)(r,{name:"parking-users",details:o.filter(s=>s.id!==i.id),description:"List of available parking users"}).toPromise(),_.close(),d._change.next(Date.now())})()}editReservation(i,{user:d,link_id:_,date:r,space:o,allow_time_changes:s,external_user:c}={}){var u=this;return new Promise(function(){var v=(0,n.A)(function*(P){const L=yield u.levels.pipe((0,f.s)(1)).toPromise(),K=yield u.spaces.pipe((0,f.s)(1)).toPromise();!o&&i?.asset_id&&(o=K.find(W=>W.id===i.asset_id)),u._dialog.open(D.U,{data:{booking:i,user:d,link_id:_,date:r,level:L[0],space:o,allow_time_changes:s,external_user:c}}).afterClosed().subscribe(W=>{P(W),u._poll.next(Date.now())})});return function(P){return v.apply(this,arguments)}}())}setBookingCheckinState(i,d=!0){var _=this;return(0,n.A)(function*(){const o=yield(i.instance?(0,t.eW)(i.id,i.instance,d):(0,t.Z$)(i.id,d)).toPromise().catch(s=>"failed");"failed"===o?(0,m.UG)("Error setting checkin state of parking booking"):(0,m.VX)(`${d?"Checked in to":"Checked out of"} parking reservation for ${i.user_name} on ${(0,A.GP)(i.date,"MMM Do")}.`),"failed"!==o&&_._change.next(Date.now())})()}approveBooking(i){var d=this;return(0,n.A)(function*(){const r=yield(i.instance?(0,t.wk)(i.id,i.instance):(0,t.DD)(i.id)).toPromise().catch(o=>"failed");"failed"===r?(0,m.UG)("Error approving in parking booking"):(0,m.VX)(`Approved parking reservation for ${i.user_name} on ${(0,A.GP)(i.date,"MMM Do")}.`),"failed"!==r&&d._change.next(Date.now())})()}rejectBooking(i){var d=this;return(0,n.A)(function*(){const r=yield(i.instance?(0,t.U)(i.id,i.instance):(0,t.vB)(i.id)).toPromise().catch(o=>"failed");"failed"===r?(0,m.UG)("Error rejecting in parking booking"):(0,m.VX)(`Rejected parking reservation for ${i.user_name} on ${(0,A.GP)(i.date,"MMM dd")}.`),"failed"!==r&&d._change.next(Date.now())})()}static#e=this.\u0275fac=function(d){return new(d||N)(b.KVO(T.yb),b.KVO(j.bZ),b.KVO(m.h$))};static#t=this.\u0275prov=b.jDH({token:N,factory:N.\u0275fac,providedIn:"root"})}return N})()},6233:(G,y,a)=>{a.d(y,{K:()=>h});var n=a(7404),t=a(34456),m=a(12587),T=a(77375),p=a(60316),M=a(24950),O=a(87984),e=a(97024),A=a(80640),k=a(41134),C=a(85060),U=a(18e3),I=a(69434);function R(g,f){1&g&&(n.j41(0,"button",8)(1,"app-icon"),n.EFF(2,"close"),n.k0s()())}function F(g,f){if(1&g){const l=n.RV6();n.j41(0,"main",9)(1,"div",10),n.nrm(2,"a-user-search-field",11),n.j41(3,"button",12),n.bIt("click",function(){n.eBV(l);const D=n.XpG();return n.Njj(D.form.patchValue({user:null,email:null,name:null,phone:null}))}),n.j41(4,"app-icon",13),n.EFF(5," person_cancel "),n.k0s()()(),n.j41(6,"label",14),n.EFF(7,"Name"),n.k0s(),n.j41(8,"mat-form-field",15),n.nrm(9,"input",16),n.j41(10,"mat-error"),n.EFF(11,"A name is required"),n.k0s()(),n.j41(12,"label",17),n.EFF(13,"Email"),n.k0s(),n.j41(14,"mat-form-field",15),n.nrm(15,"input",18),n.j41(16,"mat-error"),n.EFF(17,"An email is required"),n.k0s()(),n.j41(18,"div",19)(19,"div",20)(20,"label",21),n.EFF(21,"Car Number Plate"),n.k0s(),n.j41(22,"mat-form-field",22),n.nrm(23,"input",23),n.k0s()(),n.j41(24,"div",20)(25,"label",24),n.EFF(26,"Car Colour"),n.k0s(),n.j41(27,"mat-form-field",22),n.nrm(28,"input",25),n.k0s()()(),n.j41(29,"label",26),n.EFF(30,"Notes"),n.k0s(),n.j41(31,"mat-form-field",15),n.nrm(32,"textarea",27),n.k0s(),n.j41(33,"div",28)(34,"mat-checkbox",29),n.pXf(35,1),n.k0s()()()}if(2&g){const l=n.XpG();n.Y8G("formGroup",l.form)}}function x(g,f){if(1&g){const l=n.RV6();n.j41(0,"footer",30)(1,"button",31),n.EFF(2," Cancel "),n.k0s(),n.j41(3,"button",32),n.bIt("click",function(){n.eBV(l);const D=n.XpG();return n.Njj(D.postForm())}),n.EFF(4," Save "),n.k0s()()}}function B(g,f){1&g&&(n.j41(0,"main",33),n.nrm(1,"mat-spinner",34),n.j41(2,"p"),n.EFF(3,"Saving parking user details..."),n.k0s()())}let h=(()=>{class g extends T.Tv{get id(){return this._data?.id||""}constructor(l,E){super(),this._data=l,this._dialog_ref=E,this.event=new n.bkB,this.loading=!1,this.form=new t.gE({id:new t.MJ(""),user:new t.MJ(null),name:new t.MJ("",[t.k0.required]),email:new t.MJ("",[t.k0.required]),plate_number:new t.MJ(""),car_color:new t.MJ(""),notes:new t.MJ(""),deny:new t.MJ(!1)}),l&&this.form.patchValue(l)}ngOnInit(){this.subscription("user",this.form.valueChanges.subscribe(l=>{l.user&&this.form.patchValue({email:l.user.email,name:l.user.name})}))}postForm(){if(!this.form.valid)return;this.loading=!0;const l=this.form.value;l.user&&(l.email=l.user.email,l.name=l.user.name),this._dialog_ref.disableClose=!0,this.event.emit({reason:"done",metadata:l})}static#e=this.\u0275fac=function(E){return new(E||g)(n.rXU(m.Vh),n.rXU(m.CP))};static#t=this.\u0275cmp=n.VBU({type:g,selectors:[["parking-user-modal"]],outputs:{event:"event"},features:[n.Vt3],decls:9,vars:5,consts:()=>{let l;return l=$localize`:@@deny␟52641a66d27267c758ce08ae66f779767c90552f␟5404152440006125242: Deny User Parking Access `,[["load_state",""],l,[1,"w-[28rem]"],[1,"flex","items-center","justify-between","px-2","w-full"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col max-h-[65vh] overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex items-center justify-end space-x-2 p-2 border-t border-base-200",4,"ngIf"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","flex","flex-col","max-h-[65vh]","overflow-auto",3,"formGroup"],[1,"flex","items-center","space-x-2","mb-4"],["name","user","formControlName","user",1,"flex-1"],["icon","","matRipple","","matTooltip","Clear Selected User",1,"h-12","w-12","min-w-12","rounded","bg-secondary","text-secondary-content",3,"click"],["className","material-symbols-outlined"],["for","name"],["appearance","outline"],["matInput","","name","name","formControlName","name","placeholder","Name"],["for","email"],["matInput","","name","email","formControlName","email","placeholder","Email"],[1,"flex","items-center","space-x-2"],[1,"flex-1","w-1/3"],["for","plate-number"],["appearance","outline",1,"w-full"],["matInput","","name","plate-number","formControlName","plate_number","placeholder","Car Plate Number"],["for","car-color"],["matInput","","name","car-color","formControlName","car_color","placeholder","Car Colour"],["for","notes"],["matInput","","name","notes","formControlName","notes","placeholder","User's Notes"],[1,"px-2","pb-2"],["name","deny","formControlName","deny"],[1,"flex","items-center","justify-end","space-x-2","p-2","border-t","border-base-200"],["btn","","matRipple","","mat-dialog-close","",1,"w-32","inverse"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"p-8","flex","flex-col","items-center","justify-center","user-y-2"],["diameter","32"]]},template:function(E,D){if(1&E&&(n.j41(0,"div",2)(1,"header",3)(2,"h2",4),n.EFF(3),n.k0s(),n.DNE(4,R,3,0,"button",5),n.k0s(),n.DNE(5,F,36,1,"main",6)(6,x,5,0,"footer",7),n.k0s(),n.DNE(7,B,4,0,"ng-template",null,0,n.C5r)),2&E){const b=n.sdS(8);n.R7$(3),n.SpI("",D.id?"Edit":"New"," Parking User"),n.R7$(),n.Y8G("ngIf",!D.loading),n.R7$(),n.Y8G("ngIf",!D.loading)("ngIfElse",b),n.R7$(),n.Y8G("ngIf",!D.loading)}},dependencies:[p.bT,M.rl,M.TL,O.fg,e.So,A.oV,k.LG,m.tx,C.r6,t.me,t.BC,t.cb,t.j4,t.JD,U.$,I.R]})}return g})()},57915:(G,y,a)=>{a.d(y,{Qr:()=>m.Qr,nx:()=>t.n,me:()=>m.me,WS:()=>m.WS,SG:()=>n.S,DD:()=>p.DD,wk:()=>p.wk,Z$:()=>p.Z$,eW:()=>p.eW,u3:()=>p.u3,tj:()=>p.tj,WE:()=>p.WE,vB:()=>p.vB,U:()=>p.U,UN:()=>p.UN,X0:()=>p.X0,DO:()=>p.DO,vq:()=>p.vq,MV:()=>p.MV});var n=a(49478),t=a(18379),m=a(53857),p=(a(17141),a(18026));a(77375),a(45762),a(3367),a(67254),a(98796),a(1781),a(27547),a(67642),a(1593)}}]);
//# sourceMappingURL=default-apps_concierge_src_app_parking_parking-state_service_ts.js.map