"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_parking_parking_module_ts"],{23:(se,M,a)=>{a.r(M),a.d(M,{AppParkingModule:()=>qe});var u=a(316),c=a(4456),C=a(6354),w=a(8223),d=a(6842),H=a(3046),W=a(363),h=a(9204),S=a(7915),g=a(2333),z=a(2185),T=a(3998),U=a(9908),Z=a(3240),Q=a(6441),N=a(6671),v=a(521),k=a(2175),B=a(1536),b=a(5443),P=a(1963),I=a(6e3),F=a(7841),$=a(8627),L=a(9803),R=a(7871),x=a(3602),e=a(8559),f=a(2587),D=a(4950),oe=a(7984),ie=a(1134),E=a(5060),ae=a(8e3),V=a(9434);function re(n,l){1&n&&(e.j41(0,"button",6)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function le(n,l){if(1&n){const t=e.RV6();e.j41(0,"main",7)(1,"label",8),e.EFF(2,"Parking Space Name/Bay Number"),e.k0s(),e.j41(3,"mat-form-field",9),e.nrm(4,"input",10),e.j41(5,"mat-error"),e.EFF(6,"A name is required for parking spaces"),e.k0s()(),e.j41(7,"label",11),e.EFF(8,"Map ID"),e.k0s(),e.j41(9,"mat-form-field",9),e.nrm(10,"input",12),e.j41(11,"mat-error"),e.EFF(12," A map ID is required for parking spaces "),e.k0s()(),e.j41(13,"label",13),e.EFF(14,"Assigned User"),e.k0s(),e.j41(15,"div",14),e.nrm(16,"a-user-search-field",15),e.j41(17,"button",16),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.form.patchValue({assigned_user:null,assigned_to:null,assigned_name:null}))}),e.EFF(18," Clear "),e.k0s()(),e.j41(19,"label",17),e.EFF(20,"Notes"),e.k0s(),e.j41(21,"mat-form-field",9),e.nrm(22,"textarea",18),e.k0s(),e.j41(23,"label",19),e.EFF(24,"Map Rotation"),e.k0s(),e.j41(25,"mat-form-field",9),e.nrm(26,"textarea",20),e.k0s(),e.j41(27,"div",21)(28,"button",22),e.EFF(29," Cancel "),e.k0s(),e.j41(30,"button",23),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.postForm())}),e.EFF(31," Save "),e.k0s()()()}if(2&n){const t=e.XpG();e.Y8G("formGroup",t.form)}}function ce(n,l){1&n&&(e.j41(0,"main",24),e.nrm(1,"mat-spinner",25),e.j41(2,"p"),e.EFF(3,"Saving parking space details..."),e.k0s()())}let K=(()=>{class n{get id(){return this._data?.id||""}constructor(t,s){this._data=t,this._dialog_ref=s,this.event=new e.bkB,this.form=new c.gE({id:new c.MJ(""),name:new c.MJ("",[c.k0.required]),map_id:new c.MJ("",[c.k0.required]),assigned_user:new c.MJ(null),assigned_to:new c.MJ(""),assigned_name:new c.MJ(""),notes:new c.MJ(""),map_rotation:new c.MJ(0)}),t&&this.form.patchValue(t)}postForm(){if(!this.form.valid)return;this.loading=!0;const t=this.form.value;t.assigned_user&&(t.assigned_to=t.assigned_user.email,t.assigned_name=t.assigned_user.name),this._dialog_ref.disableClose=!0,this.event.emit({reason:"done",metadata:t})}static#e=this.\u0275fac=function(s){return new(s||n)(e.rXU(f.Vh),e.rXU(f.CP))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["parking-space-modal"]],outputs:{event:"event"},decls:8,vars:4,consts:[["load_state",""],[1,"w-[28rem]"],[1,"flex","items-center","justify-between","px-2","w-full"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col",3,"formGroup",4,"ngIf","ngIfElse"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","flex","flex-col",3,"formGroup"],["for","name"],["appearance","outline"],["matInput","","name","name","formControlName","name"],["for","map-id"],["matInput","","name","map-id","formControlName","map_id"],["for","user"],[1,"flex","items-center","space-x-2"],["name","user","formControlName","assigned_user",1,"mb-4"],["btn","","matRipple","",1,"mb-5",3,"click"],["for","notes"],["matInput","","name","notes","formControlName","notes"],["for","map-rotation"],["matInput","","name","map-rotation","formControlName","map_rotation"],[1,"flex","items-center","justify-center","space-x-2"],["btn","","matRipple","","mat-dialog-close","",1,"w-32","inverse"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"]],template:function(s,o){if(1&s&&(e.j41(0,"div",1)(1,"header",2)(2,"h2",3),e.EFF(3),e.k0s(),e.DNE(4,re,3,0,"button",4),e.k0s(),e.DNE(5,le,32,1,"main",5),e.k0s(),e.DNE(6,ce,4,0,"ng-template",null,0,e.C5r)),2&s){const i=e.sdS(7);e.R7$(3),e.SpI("",o.id?"Edit":"New"," Parking Space"),e.R7$(),e.Y8G("ngIf",!o.loading),e.R7$(),e.Y8G("ngIf",!o.loading)("ngIfElse",i)}},dependencies:[u.bT,D.rl,D.TL,oe.fg,ie.LG,f.tx,E.r6,c.me,c.BC,c.cb,c.j4,c.JD,ae.$,V.R]})}return n})(),j=(()=>{class n extends g.Tv{constructor(t,s,o){super(),this._org=t,this._dialog=s,this._settings=o,this._poll=new v.t(0),this._change=new v.t(0),this._options=new v.t({date:Date.now(),search:"",zones:[]}),this._loading=new v.t([]),this.levels=(0,k.zV)([this._org.active_region,this._org.active_building]).pipe((0,b.T)(([i,r])=>{const p=this._org.levels.filter(m=>m.tags.includes("parking"));if(this._settings.get("app.use_region")){const m=this._org.buildingsForRegion(),y=m.map(_=>_.id),G=p.filter(_=>y.includes(_.parent_id));return G.map(_=>({..._,display_name:`${m.find(et=>et.id===_.parent_id)?.display_name} - ${_.display_name}`})),G}return p.filter(m=>m.parent_id===r.id)})),this.spaces=(0,k.zV)([this.levels,this._options,this._change]).pipe((0,P.n)(([i,r])=>r.zones[0]||i[0]?.id?(this._loading.next([...this._loading.getValue(),"spaces"]),(0,T.bpY)(r.zones[0]||i[0]?.id,"parking-spaces")):(0,B.of)({details:[]})),(0,b.T)(i=>i.details instanceof Array?i.details:[]),(0,I.M)(()=>this._loading.next(this._loading.getValue().filter(i=>"spaces"!==i))),(0,F.t)(1)),this.users=(0,k.zV)([this._org.active_building,this._change]).pipe((0,$.p)(([i])=>!!i?.id),(0,P.n)(([i])=>(this._loading.next([...this._loading.getValue(),"users"]),(0,T.bpY)(i.id,"parking-users"))),(0,b.T)(i=>i.details instanceof Array?i.details:[]),(0,I.M)(()=>this._loading.next(this._loading.getValue().filter(i=>"users"!==i))),(0,F.t)(1)),this.bookings=(0,k.zV)([this._org.active_building,this._options,this._poll]).pipe((0,L.B)(500),(0,P.n)(([i,r])=>(this._loading.next([...this._loading.getValue(),"bookings"]),(0,S.tj)({period_start:(0,U._)((0,Z.o)(r.date)),period_end:(0,U._)((0,Q.D)(r.date)),type:"parking",zones:r.zones?.length?r.zones.join(","):(this._settings.get("app.use_region")?this._org.region?.id:"")||i?.id}))),(0,I.M)(()=>this._loading.next(this._loading.getValue().filter(i=>"bookings"!==i))),(0,F.t)(1)),this.options=this._options.asObservable(),this.loading=this._loading.asObservable()}setOptions(t){this._options.next({...this._options.getValue(),...t})}startPolling(t=5e3){return this._poll.next(Date.now()),this.interval("poll",()=>this._poll.next(Date.now()),t),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}editSpace(t){var s=this;return(0,h.A)(function*(){const o=s._dialog.open(K,{data:t}),i=yield Promise.race([o.afterClosed().toPromise(),o.componentInstance.event.pipe((0,R.$)(_=>"done"===_.reason)).toPromise()]);if("done"!==i?.reason)return;const r=s._options.getValue().zones[0],p={...i.metadata,id:i.metadata.id||`parking-${r}.${(0,g.HO)(999999)}`},m=yield s.spaces.pipe((0,x.s)(1)).toPromise(),y=m.findIndex(_=>_.id===p.id);y>=0?m[y]=p:m.push(p);const G=m;yield(0,T.D58)(r,{name:"parking-spaces",details:G,description:"List of available parking spaces"}).toPromise(),s._change.next(Date.now()),o.close()})()}removeSpace(t){var s=this;return(0,h.A)(function*(){const o=yield(0,g.GE)({title:"Remove Parking Space",content:`Are you sure you wish to remove the parking space "${t.name}"?`,icon:{content:"delete"}},s._dialog);if("done"!==o?.reason)return;o.loading("Removing parking space...");const i=s._options.getValue().zones[0],r=yield s.spaces.pipe((0,x.s)(1)).toPromise();yield(0,T.D58)(i,{name:"parking-spaces",details:r.filter(p=>p.id!==t.id),description:"List of available parking spaces"}).toPromise(),o.close()})()}saveUsers(t){return(0,h.A)(function*(){})()}approveBooking(t){return(0,h.A)(function*(){"failed"===(yield(0,S.DD)(t.id).toPromise().catch(o=>"failed"))?(0,g.UG)("Error approving in desk booking"):(0,g.VX)(`Approved parking reservation for ${t.user_name} on ${(0,N.GP)(t.date,"MMM Do")}.`)})()}rejectBooking(t){return(0,h.A)(function*(){"failed"===(yield(0,S.vB)(t.id).toPromise().catch(o=>"failed"))?(0,g.UG)("Error rejecting in desk booking"):(0,g.VX)(`Rejected parking reservation for ${t.user_name} on ${(0,N.GP)(t.date,"MMM Do")}.`)})()}static#e=this.\u0275fac=function(s){return new(s||n)(e.KVO(z.yb),e.KVO(f.bZ),e.KVO(g.h$))};static#t=this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var q=a(640),O=a(2993);const pe=()=>["asset_name","booked_by_name","user_name","plate_number","status","actions"],de=()=>["Bay No.","Reserved By","Reserved For","Car Plate #","Status"," "],me=()=>["6r","flex","14r","8r","6r","6r"],ue=(n,l,t)=>({plate_number:n,actions:l,status:t});function ge(n,l){if(1&n&&e.EFF(0),2&n){const t=l.row;e.SpI(" ",null==t||null==t.extension_data?null:t.extension_data.plate_number," ")}}function _e(n,l){if(1&n&&(e.j41(0,"span",5),e.EFF(1),e.k0s()),2&n){const t=l.data;e.AVh("bg-success","approved"===t)("bg-warning","tentative"===t)("bg-error","cancelled"===t||"declined"===t)("text-success-content","approved"===t)("text-warning-content","tentative"===t)("text-error-content","cancelled"===t||"declined"===t),e.R7$(),e.SpI(" ",t," ")}}function fe(n,l){if(1&n){const t=e.RV6();e.j41(0,"div",6)(1,"button",7),e.bIt("click",function(){const o=e.eBV(t).row,i=e.XpG();return e.Njj(i.reject(o))}),e.j41(2,"app-icon"),e.EFF(3,"event_busy"),e.k0s()(),e.j41(4,"button",8),e.bIt("click",function(){const o=e.eBV(t).row,i=e.XpG();return e.Njj(i.approve(o))}),e.j41(5,"app-icon"),e.EFF(6,"event_available"),e.k0s()()()}}function he(n,l){1&n&&e.nrm(0,"mat-progress-bar",9)}let X=(()=>{class n{constructor(t){this._state=t,this.events=this._state.bookings,this.options=this._state.options,this.loading=this._state.loading,this.reject=s=>this._state.rejectBooking(s),this.approve=s=>this._state.approveBooking(s)}static#e=this.\u0275fac=function(s){return new(s||n)(e.rXU(j))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["parking-bookings-list"]],decls:11,vars:22,consts:[["plate_template",""],["status_template",""],["action_template",""],[1,"block","min-w-[60rem]",3,"dataSource","columns","display_column","filter","column_size","template"],["class","absolute bottom-0 inset-x-0",4,"ngIf"],[1,"capitalize","px-2","py-1","rounded","border","border-base-200"],[1,"w-full","flex","items-center","justify-end"],["icon","","matTooltip","Reject Parking Reservation",3,"click"],["icon","","matTooltip","Approve Parking Reservation",3,"click"],[1,"absolute","bottom-0","inset-x-0"]],template:function(s,o){if(1&s&&(e.nrm(0,"custom-table",3),e.nI1(1,"async"),e.nI1(2,"async"),e.DNE(3,ge,1,1,"ng-template",null,0,e.C5r)(5,_e,2,13,"ng-template",null,1,e.C5r)(7,fe,7,0,"ng-template",null,2,e.C5r)(9,he,1,0,"mat-progress-bar",4),e.nI1(10,"async")),2&s){let i,r;const p=e.sdS(4),m=e.sdS(6),y=e.sdS(8);e.AVh("opacity-50",null==(i=e.bMT(1,9,o.loading))?null:i.includes("bookings")),e.Y8G("dataSource",o.events)("columns",e.lJ4(15,pe))("display_column",e.lJ4(16,de))("filter",e.bMT(2,11,o.options).search)("column_size",e.lJ4(17,me))("template",e.sMw(18,ue,p,y,m)),e.R7$(9),e.Y8G("ngIf",null==(r=e.bMT(10,13,o.loading))?null:r.includes("bookings"))}},dependencies:[u.bT,q.oV,C.HM,V.R,O.r,u.Jj],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%;overflow:auto}\n\n/*# sourceMappingURL=parking-bookings-list.component.ts-angular-inline--161.css.map*/"]})}return n})();const ve=()=>["name","map_id","assigned_to","notes","actions"],ke=()=>["Bay No.","Map ID","Assigned","Notes"," "],be=()=>["8r","10r","14r","flex","10r"],ye=(n,l)=>({map_id:n,actions:l});function xe(n,l){if(1&n&&(e.j41(0,"span",6),e.EFF(1),e.k0s()),2&n){const t=l.data;e.R7$(),e.JRh(t)}}function je(n,l){if(1&n){const t=e.RV6();e.j41(0,"div",7)(1,"button",8),e.bIt("click",function(){const o=e.eBV(t).row,i=e.XpG();return e.Njj(i.editSpace(o))}),e.j41(2,"app-icon"),e.EFF(3,"edit"),e.k0s()(),e.j41(4,"button",8),e.bIt("click",function(){const o=e.eBV(t).row,i=e.XpG();return e.Njj(i.removeSpace(o))}),e.j41(5,"app-icon"),e.EFF(6,"delete"),e.k0s()()()}}function Ce(n,l){1&n&&e.nrm(0,"mat-progress-bar",9)}let J=(()=>{class n{constructor(t){this._state=t,this.spaces=this._state.spaces,this.options=this._state.options,this.loading=this._state.loading,this.editSpace=s=>this._state.editSpace(s),this.removeSpace=s=>this._state.removeSpace(s)}static#e=this.\u0275fac=function(s){return new(s||n)(e.rXU(j))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["parking-space-list"]],decls:13,vars:21,consts:[["id_template",""],["action_template",""],[1,"h-full","w-full","overflow-auto"],[1,"block","min-w-[56rem]",3,"dataSource","columns","display_column","column_size","template","filter"],["class","absolute bottom-0 inset-x-0",4,"ngIf"],["btn","","icon","","matRipple","",1,"absolute","bottom-2","left-2","bg-secondary","text-secondary-content",3,"click"],[1,"font-mono","text-sm"],[1,"w-full","flex","items-center","justify-end"],["icon","",3,"click"],[1,"absolute","bottom-0","inset-x-0"]],template:function(s,o){if(1&s){const i=e.RV6();e.j41(0,"div",2),e.nrm(1,"custom-table",3),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,xe,2,1,"ng-template",null,0,e.C5r)(6,je,7,0,"ng-template",null,1,e.C5r)(8,Ce,1,0,"mat-progress-bar",4),e.nI1(9,"async"),e.k0s(),e.j41(10,"button",5),e.bIt("click",function(){return e.eBV(i),e.Njj(o.editSpace())}),e.j41(11,"app-icon"),e.EFF(12,"add"),e.k0s()()}if(2&s){let i,r;const p=e.sdS(5),m=e.sdS(7);e.R7$(),e.AVh("opacity-50",null==(i=e.bMT(2,9,o.loading))?null:i.includes("spaces")),e.Y8G("dataSource",o.spaces)("columns",e.lJ4(15,ve))("display_column",e.lJ4(16,ke))("column_size",e.lJ4(17,be))("template",e.l_i(18,ye,p,m))("filter",e.bMT(3,11,o.options).search),e.R7$(7),e.Y8G("ngIf",null==(r=e.bMT(9,13,o.loading))?null:r.includes("spaces"))}},dependencies:[u.bT,C.HM,E.r6,V.R,O.r,u.Jj],encapsulation:2})}return n})();var Te=a(4584),Pe=a(2236),Ie=a(5175),Fe=a(6062);function Me(n,l){if(1&n&&(e.j41(0,"div",13),e.EFF(1),e.nI1(2,"building"),e.j41(3,"span",14),e.EFF(4," - "),e.k0s()()),2&n){let t;const s=e.XpG().$implicit;e.R7$(),e.SpI(" ",null==(t=e.bMT(2,1,s.parent_id))?null:t.display_name," ")}}function we(n,l){if(1&n&&(e.j41(0,"mat-option",10)(1,"div",11),e.DNE(2,Me,5,3,"div",12),e.j41(3,"div"),e.EFF(4),e.k0s()()()),2&n){const t=l.$implicit,s=e.XpG();e.Y8G("value",t.id),e.R7$(2),e.Y8G("ngIf",s.use_region),e.R7$(2),e.JRh(t.display_name||t.name)}}function Se(n,l){if(1&n){const t=e.RV6();e.j41(0,"date-options",15),e.bIt("dateChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.setDate(o))}),e.k0s()}}let Y=(()=>{class n extends g.Tv{get use_region(){return!!this._settings.get("app.use_region")}constructor(t,s,o,i,r){super(),this._state=t,this._org=s,this._route=o,this._router=i,this._settings=r,this.manage=!1,this.zones=[],this.levels=this._state.levels,this.options=this._state.options,this.setDate=p=>this._state.setOptions({date:p}),this.setSearch=p=>this._state.setOptions({search:p}),this.updateZones=p=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:p.join(",")}}),this._state.setOptions({zones:p})}}ngOnInit(){var t=this;return(0,h.A)(function*(){yield t._org.initialised.pipe((0,R.$)(s=>s)).toPromise(),t.subscription("route.query",t._route.queryParamMap.subscribe(s=>{if(s.has("zone_ids")){const o=s.get("zone_ids").split(",");if(o.length){const i=t._org.levelWithID(o);if(t.zones=o,!i)return;t._org.building=t._org.buildings.find(r=>r.id===i.parent_id)}}})),t.subscription("levels",t._state.levels.subscribe(s=>{t.use_region||(t.zones=t.zones.filter(o=>s.find(i=>i.id===o)),!t.zones.length&&s.length&&t.zones.push(s[0].id),t.updateZones(t.zones))})),t.manage=!t._router.url.includes("events")})()}newReservation(){}static#e=this.\u0275fac=function(s){return new(s||n)(e.rXU(j),e.rXU(z.yb),e.rXU(d.nX),e.rXU(d.Ix),e.rXU(g.h$))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["parking-topbar"]],features:[e.Vt3],decls:13,vars:9,consts:[[1,"flex","items-center","w-full","pt-4","pb-2","px-8","space-x-2"],[1,"text-2xl","font-medium"],[1,"flex-1","w-px"],[1,"mr-2",3,"modelChange","model"],[1,"flex","items-center","bg-base-100","px-8","h-20"],["appearance","outline",1,"w-60"],["placeholder","All Levels","multiple","",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"flex-1","w-0"],[3,"dateChange",4,"ngIf"],[3,"value"],[1,"flex","flex-col-reverse"],["class","text-xs opacity-30",4,"ngIf"],[1,"text-xs","opacity-30"],[1,"opacity-0"],[3,"dateChange"]],template:function(s,o){if(1&s&&(e.j41(0,"div",0)(1,"h2",1),e.EFF(2),e.k0s(),e.nrm(3,"div",2),e.j41(4,"searchbar",3),e.nI1(5,"async"),e.bIt("modelChange",function(r){return o.setSearch(r)}),e.k0s()(),e.j41(6,"div",4)(7,"mat-form-field",5)(8,"mat-select",6),e.mxI("ngModelChange",function(r){return e.DH7(o.zones,r)||(o.zones=r),r}),e.bIt("ngModelChange",function(r){return o.updateZones(r)}),e.DNE(9,we,5,3,"mat-option",7),e.nI1(10,"async"),e.k0s()(),e.nrm(11,"div",8),e.DNE(12,Se,1,0,"date-options",9),e.k0s()),2&s){let i;e.R7$(2),e.SpI(" ",o.manage?"Manage Parking":"Parking"," "),e.R7$(2),e.Y8G("model",null==(i=e.bMT(5,5,o.options))?null:i.search),e.R7$(4),e.R50("ngModel",o.zones),e.R7$(),e.Y8G("ngForOf",e.bMT(10,7,o.levels)),e.R7$(3),e.Y8G("ngIf",!o.manage)}},dependencies:[u.Sq,u.bT,Te.o,Pe.x,D.rl,Ie.VO,E.wT,c.BC,c.vS,u.Jj,Fe.b],styles:["button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=parking-topbar.component.ts-angular-inline--162.css.map*/"]})}return n})();var Re=a(4605);const De=()=>["/parking","events"],Ee=()=>["/parking","spaces"];function Ve(n,l){1&n&&(e.j41(0,"div",6),e.nrm(1,"div",7),e.j41(2,"p"),e.EFF(3,"No parking floors for the currently selected building"),e.k0s()())}let ee=(()=>{class n extends g.Tv{constructor(t,s){super(),this._state=t,this._router=s,this.levels=this._state.levels,this.path=""}ngOnInit(){this._state.startPolling(),this.subscription("router.events",this._router.events.subscribe(s=>{if(s instanceof d.wF){const o=this._router.url?.split("/")||[""];this.path=o[t.length-1].split("?")[0]}}));const t=this._router.url?.split("/")||[""];this.path=t[t.length-1].split("?")[0]}static#e=this.\u0275fac=function(s){return new(s||n)(e.rXU(j),e.rXU(d.Ix))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-parking"]],features:[e.Vt3],decls:13,vars:9,consts:[[1,"relative","overflow-hidden","bg-base-100"],[1,"dark"],["mat-tab-nav-bar",""],["mat-tab-link","","queryParamsHandling","merge",3,"routerLink","active"],[1,"flex-1","h-1/2","w-full","relative","overflow-auto","px-4"],["class","absolute inset-0 flex flex-col items-center justify-center z-50",4,"ngIf"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","z-50"],[1,"absolute","inset-0","bg-base-100","opacity-50","z-0"]],template:function(s,o){if(1&s&&(e.nrm(0,"sidebar"),e.j41(1,"main",0),e.nrm(2,"parking-topbar"),e.j41(3,"div",1)(4,"nav",2)(5,"a",3),e.EFF(6," Bookings "),e.k0s(),e.j41(7,"a",3),e.EFF(8," Manage Spaces "),e.k0s()()(),e.j41(9,"div",4),e.nrm(10,"router-outlet"),e.k0s(),e.DNE(11,Ve,4,0,"div",5),e.nI1(12,"async"),e.k0s()),2&s){let i;e.R7$(5),e.Y8G("routerLink",e.lJ4(7,De))("active","events"===o.path),e.R7$(2),e.Y8G("routerLink",e.lJ4(8,Ee))("active","spaces"===o.path),e.R7$(4),e.Y8G("ngIf",!(null!=(i=e.bMT(12,5,o.levels))&&i.length))}},dependencies:[u.bT,Re.k,w.Bu,w.Ql,d.n3,d.Wk,Y,u.Jj],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=parking.component.ts-angular-inline--163.css.map*/"]})}return n})();var Ge=a(5189),ze=a(6843);function Ue(n,l){1&n&&(e.j41(0,"div",4),e.nrm(1,"div",5),e.j41(2,"p",6),e.EFF(3," No parking floors for the currently selected building "),e.k0s()())}let te=(()=>{class n extends g.Tv{constructor(t,s){super(),this._state=t,this._router=s,this.levels=this._state.levels,this.path=""}ngOnInit(){this._state.startPolling(),this.subscription("router.events",this._router.events.subscribe(s=>{if(s instanceof d.wF){const o=this._router.url?.split("/")||[""];this.path=o[t.length-1].split("?")[0]}}));const t=this._router.url?.split("/")||[""];this.path=t[t.length-1].split("?")[0]}static#e=this.\u0275fac=function(s){return new(s||n)(e.rXU(j),e.rXU(d.Ix))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["app-new-parking"]],features:[e.Vt3],decls:9,vars:3,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full","relative"],[1,"relative","flex-1","h-1/2","w-full","overflow-auto","px-8"],["class","absolute inset-0 flex flex-col items-center justify-center z-50",4,"ngIf"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","z-50"],[1,"absolute","inset-0","bg-base-100","opacity-80","z-0"],[1,"z-10","opacity-60"]],template:function(s,o){if(1&s&&(e.nrm(0,"app-topbar"),e.j41(1,"div",0),e.nrm(2,"app-sidebar"),e.j41(3,"main",1),e.nrm(4,"parking-topbar"),e.j41(5,"div",2),e.nrm(6,"router-outlet"),e.k0s(),e.DNE(7,Ue,4,0,"div",3),e.nI1(8,"async"),e.k0s()()),2&s){let i;e.R7$(7),e.Y8G("ngIf",!(null!=(i=e.bMT(8,1,o.levels))&&i.length))}},dependencies:[u.bT,Ge.S,ze.c,d.n3,Y,u.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=new-parking.component.ts-angular-inline--164.css.map*/"]})}return n})();const Ne=()=>["email","transponder","designation","car_model","car_colour","plate_number","phone","notes","actions"],Be=()=>["","","","","","","",""," "],$e=()=>["14r","10r","10r","10r","10r","10r","10r","flex"],Le=(n,l,t,s,o,i,r,p,m,y)=>({email:n,name:l,transponder:t,designation:s,car_model:o,car_colour:i,plate_number:r,phone:p,notes:m,actions:y});function Oe(n,l){if(1&n){const t=e.RV6();e.j41(0,"input",6),e.bIt("ngModelChange",function(o){const i=e.eBV(t);return e.Njj(i.row.get(i.key).setValue(o))}),e.k0s()}if(2&n){const o=l.name;e.Y8G("ngModel",l.row.value[l.key])("placeholder",o)}}function Xe(n,l){if(1&n&&(e.j41(0,"app-icon"),e.EFF(1," warning "),e.k0s()),2&n){const t=e.XpG().row,s=e.XpG();e.AVh("text-red-600",s.deletion.has(t.value.id))("text-yellow-400",!s.deletion.has(t.value.id))}}function Je(n,l){if(1&n){const t=e.RV6();e.j41(0,"button",11),e.bIt("click",function(){e.eBV(t);const o=e.XpG().row,i=e.XpG();return e.Njj(i.markForDelete(o.value.id))}),e.j41(1,"app-icon"),e.EFF(2,"delete"),e.k0s()()}if(2&n){const t=e.XpG().row,s=e.XpG();e.Y8G("matTooltip",s.isNew(t.value.id)?"Remove New User":"Mark for Deletion")}}function Ye(n,l){if(1&n){const t=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.clearChanges(o.id))}),e.j41(1,"app-icon"),e.EFF(2,"clear_all"),e.k0s()()}}function Ae(n,l){if(1&n&&(e.j41(0,"div",7),e.DNE(1,Xe,2,4,"app-icon",8)(2,Je,3,1,"button",9)(3,Ye,3,0,"button",10),e.k0s()),2&n){const t=l.row,s=e.XpG();e.R7$(),e.Y8G("ngIf",s.deletion.has(t.value.id)||t.dirty||s.isNew(t.value.id)),e.R7$(),e.Y8G("ngIf",!s.deletion.has(t.value.id)),e.R7$(),e.Y8G("ngIf",s.deletion.has(t.value.id)||t.dirty)}}function He(n,l){if(1&n&&(e.j41(0,"div",16)(1,"app-icon",17),e.EFF(2,"warning"),e.k0s(),e.j41(3,"div"),e.EFF(4),e.k0s()()),2&n){const t=e.XpG(2);e.R7$(4),e.SpI("",t.deletion.entries.length," users pending deletion")}}function We(n,l){if(1&n&&(e.j41(0,"div",16)(1,"app-icon",18),e.EFF(2,"warning"),e.k0s(),e.j41(3,"div"),e.EFF(4),e.nI1(5,"async"),e.k0s()()),2&n){const t=e.XpG(2);e.R7$(4),e.SpI(" ",e.bMT(5,1,t.new_items).length," new users pending save ")}}function Ze(n,l){if(1&n&&(e.j41(0,"div",16)(1,"app-icon",18),e.EFF(2,"warning"),e.k0s(),e.j41(3,"div"),e.EFF(4),e.nI1(5,"async"),e.k0s()()),2&n){const t=e.XpG(2);e.R7$(4),e.SpI("",e.bMT(5,1,t.change_count)," users with pending changes")}}function Qe(n,l){if(1&n&&(e.j41(0,"div",13),e.DNE(1,He,5,1,"div",14)(2,We,6,3,"div",14),e.nI1(3,"async"),e.DNE(4,Ze,6,3,"div",14),e.nI1(5,"async"),e.j41(6,"button",15),e.EFF(7,"Save Changes"),e.k0s()()),2&n){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.deletion.entries.length),e.R7$(),e.Y8G("ngIf",e.bMT(3,3,t.new_items).length),e.R7$(2),e.Y8G("ngIf",e.bMT(5,5,t.change_count))}}const ne=n=>new c.gE({id:new c.MJ(n.id||""),email:new c.MJ(n.email||""),name:new c.MJ(n.name||""),transponder:new c.MJ(n.transponder||""),designation:new c.MJ(n.designation||""),car_model:new c.MJ(n.car_model||""),car_colour:new c.MJ(n.car_colour||""),plate_number:new c.MJ(n.plate_number||""),phone:new c.MJ(n.phone||""),notes:new c.MJ(n.notes||"")});let A=(()=>{class n{isNew(t){return!!this.new_items.getValue().find(s=>s.value.id===t)}constructor(t){this._state=t,this.options=this._state.options,this.loading=this._state.loading,this.forms=this._state.users.pipe((0,b.T)(s=>s.map(o=>ne(o)))),this.new_items=new v.t([]),this.user_list=(0,k.zV)([this.forms,this.new_items]).pipe((0,b.T)(([s,o])=>[...s,...o])),this.change_count=this.user_list.pipe((0,b.T)(s=>s.filter(o=>o.dirty||!this.isNew(o.value.id)).length)),this.deletion=new Set}markForDelete(t){this.isNew(t)?this.new_items.next(this.new_items.getValue().filter(s=>s.value.id!==t)):this.deletion.add(t)}clearChanges(t){var s=this;return(0,h.A)(function*(){if(s.isNew(t)){const i=s.new_items.getValue().find(r=>r.value.id===t);i&&i.reset({id:t})}else{const o=yield s.user_list.pipe((0,x.s)(1)).toPromise(),i=yield s._state.users.pipe((0,x.s)(1)).toPromise(),r=o.find(m=>m.value.id===t),p=i.find(m=>m.id===t);r&&p&&r.reset(p)}})()}newUser(){const t=ne({id:`parking-${(0,g.HO)(99999999,1e7)}`});this.new_items.next([...this.new_items.getValue(),t])}saveChanges(){var t=this;return(0,h.A)(function*(){const o=(yield t.user_list.pipe((0,x.s)(1)).toPromise()).map(i=>i.value).filter(i=>!t.deletion.has(i.id));yield t._state.saveUsers(o)})()}static#e=this.\u0275fac=function(s){return new(s||n)(e.rXU(j))};static#t=this.\u0275cmp=e.VBU({type:n,selectors:[["parking-users-list"]],decls:14,vars:31,consts:[["text_input_template",""],["action_template",""],[1,"absolute","inset-0","overflow-auto","px-2"],[1,"block","min-w-[96rem]",3,"dataSource","columns","display_column","column_size","template","filter"],["btn","","icon","","matRipple","",1,"absolute","bottom-2","left-2","bg-primary","text-white",3,"click"],["class","absolute bottom-2 right-2 bg-base-100 border border-base-200 p-2 text-base rounded shadow space-y-2",4,"ngIf"],[1,"relative","-top-px","border-none","px-2","py-4","-m-2","text-base","w-full","!outline-none","focus:border-b","border-blue-600",3,"ngModelChange","ngModel","placeholder"],[1,"w-full","flex","items-center","justify-end"],[3,"text-red-600","text-yellow-400",4,"ngIf"],["btn","","icon","",3,"matTooltip","click",4,"ngIf"],["btn","","icon","","matTooltip","Clear Changes",3,"click",4,"ngIf"],["btn","","icon","",3,"click","matTooltip"],["btn","","icon","","matTooltip","Clear Changes",3,"click"],[1,"absolute","bottom-2","right-2","bg-base-100","border","border-base-200","p-2","text-base","rounded","shadow","space-y-2"],["class","flex items-center space-x-2 p-2",4,"ngIf"],["btn","",1,"w-full"],[1,"flex","items-center","space-x-2","p-2"],[1,"text-red-600","text-2xl"],[1,"text-yellow-400","text-2xl"]],template:function(s,o){if(1&s){const i=e.RV6();e.j41(0,"div",2),e.nrm(1,"custom-table",3),e.nI1(2,"async"),e.nI1(3,"async"),e.DNE(4,Oe,1,2,"ng-template",null,0,e.C5r)(6,Ae,4,3,"ng-template",null,1,e.C5r),e.k0s(),e.j41(8,"button",4),e.bIt("click",function(){return e.eBV(i),e.Njj(o.newUser())}),e.j41(9,"app-icon"),e.EFF(10,"add"),e.k0s()(),e.DNE(11,Qe,8,7,"div",5),e.nI1(12,"async"),e.nI1(13,"async")}if(2&s){let i;const r=e.sdS(5),p=e.sdS(7);e.R7$(),e.AVh("opacity-50",null==(i=e.bMT(2,9,o.loading))?null:i.includes("users")),e.Y8G("dataSource",o.user_list)("columns",e.lJ4(17,Ne))("display_column",e.lJ4(18,Be))("column_size",e.lJ4(19,$e))("template",e.zJS(20,Le,[r,r,r,r,r,r,r,r,r,p]))("filter",e.bMT(3,11,o.options).search),e.R7$(10),e.Y8G("ngIf",o.deletion.entries.length||e.bMT(12,13,o.change_count)||e.bMT(13,15,o.new_items).length)}},dependencies:[u.bT,q.oV,E.r6,c.me,c.BC,c.vS,V.R,O.r,u.Jj]})}return n})();const Ke=[{path:"new",component:te,children:[{path:"events",component:X},{path:"users",component:A},{path:"manage",component:J},{path:"**",redirectTo:"events"}]},{path:"",component:ee,children:[{path:"events",component:X},{path:"users",component:A},{path:"manage",component:J},{path:"**",redirectTo:"events"}]},{path:"**",redirectTo:""}];let qe=(()=>{class n{static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275mod=e.$C({type:n});static#n=this.\u0275inj=e.G2t({imports:[u.MD,W.r,c.YN,c.X1,H.cQ,w.RI,C.PO,d.iI.forChild(Ke)]})}return n})()},7915:(se,M,a)=>{a.d(M,{Qr:()=>C.Q,nx:()=>c.n,SG:()=>u.S,DD:()=>d.DD,Z$:()=>d.Z$,u3:()=>d.u3,tj:()=>d.tj,WE:()=>d.WE,vB:()=>d.vB,X0:()=>d.X0,tl:()=>d.tl,DO:()=>d.DO,vq:()=>d.vq});var u=a(4148),c=a(8379),C=a(3857),d=(a(7141),a(8026));a(2333),a(5762),a(3367),a(7254),a(8796),a(1781),a(7547),a(7642)}}]);
//# sourceMappingURL=apps_concierge_src_app_parking_parking_module_ts.js.map