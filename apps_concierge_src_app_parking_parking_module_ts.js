"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_parking_parking_module_ts"],{75961:(Kt,F,a)=>{a.r(F),a.d(F,{AppParkingModule:()=>Et});var m=a(26575),l=a(28849),C=a(78173),U=a(60989),u=a(92649),X=a(39304),H=a(97910),_=a(71670),P=a(78466),d=a(22798),Y=a(93121),b=a(47298),D=a(67343),W=a(57016),$=a(4512),q=a(14884),x=a(70462),k=a(28159),f=a(47422),Q=a(85046),A=a(36520),M=a(15746),N=a(680),tt=a(95933),B=a(17627),Z=a(46939),t=a(29039),T=a(17401),I=a(71268),et=a(99674),nt=a(33910),w=a(10257),st=a(20576),y=a(94888);function ot(s,c){1&s&&(t.TgZ(0,"button",6)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function it(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"main",7)(1,"label",8),t._uU(2,"Parking Space Name/Bay Number"),t.qZA(),t.TgZ(3,"mat-form-field",9),t._UZ(4,"input",10),t.TgZ(5,"mat-error"),t._uU(6,"A name is required for parking spaces"),t.qZA()(),t.TgZ(7,"label",11),t._uU(8,"Map ID"),t.qZA(),t.TgZ(9,"mat-form-field",9),t._UZ(10,"input",12),t.TgZ(11,"mat-error"),t._uU(12," A map ID is required for parking spaces "),t.qZA()(),t.TgZ(13,"label",13),t._uU(14,"Assigned User"),t.qZA(),t.TgZ(15,"div",14),t._UZ(16,"a-user-search-field",15),t.TgZ(17,"button",16),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.form.patchValue({assigned_user:null,assigned_to:null,assigned_name:null}))}),t._uU(18," Clear "),t.qZA()(),t.TgZ(19,"label",17),t._uU(20,"Notes"),t.qZA(),t.TgZ(21,"mat-form-field",9),t._UZ(22,"textarea",18),t.qZA(),t.TgZ(23,"label",19),t._uU(24,"Map Rotation"),t.qZA(),t.TgZ(25,"mat-form-field",9),t._UZ(26,"textarea",20),t.qZA(),t.TgZ(27,"div",21)(28,"button",22),t._uU(29," Cancel "),t.qZA(),t.TgZ(30,"button",23),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.postForm())}),t._uU(31," Save "),t.qZA()()()}if(2&s){const e=t.oxw();t.Q6J("formGroup",e.form)}}function at(s,c){1&s&&(t.TgZ(0,"main",24),t._UZ(1,"mat-spinner",25),t.TgZ(2,"p"),t._uU(3,"Saving parking space details..."),t.qZA()())}let R=(()=>{class s{get id(){return this._data?.id||""}constructor(e,n){this._data=e,this._dialog_ref=n,this.event=new t.vpe,this.form=new l.cw({id:new l.NI(""),name:new l.NI("",[l.kI.required]),map_id:new l.NI("",[l.kI.required]),assigned_user:new l.NI(null),assigned_to:new l.NI(""),assigned_name:new l.NI(""),notes:new l.NI(""),map_rotation:new l.NI(0)}),e&&this.form.patchValue(e)}postForm(){if(!this.form.valid)return;this.loading=!0;const e=this.form.value;e.assigned_user&&(e.assigned_to=e.assigned_user.email,e.assigned_name=e.assigned_user.name),this._dialog_ref.disableClose=!0,this.event.emit({reason:"done",metadata:e})}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(T.WI),t.Y36(T.so))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["parking-space-modal"]],outputs:{event:"event"},decls:8,vars:4,consts:[[1,"w-[28rem]"],[1,"flex","items-center","justify-between","px-2","w-full"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col",3,"formGroup",4,"ngIf","ngIfElse"],["load_state",""],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","flex","flex-col",3,"formGroup"],["for","name"],["appearance","outline"],["matInput","","name","name","formControlName","name"],["for","map-id"],["matInput","","name","map-id","formControlName","map_id"],["for","user"],[1,"flex","items-center","space-x-2"],["name","user","formControlName","assigned_user"],["btn","","matRipple","",1,"mb-5",3,"click"],["for","notes"],["matInput","","name","notes","formControlName","notes"],["for","map-rotation"],["matInput","","name","map-rotation","formControlName","map_rotation"],[1,"flex","items-center","justify-center","space-x-2"],["btn","","matRipple","","mat-dialog-close","",1,"w-32","inverse"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0)(1,"header",1)(2,"h2",2),t._uU(3),t.qZA(),t.YNc(4,ot,3,0,"button",3),t.qZA(),t.YNc(5,it,32,1,"main",4),t.qZA(),t.YNc(6,at,4,0,"ng-template",null,5,t.W1O)),2&n){const i=t.MAs(7);t.xp6(3),t.hij("",o.id?"Edit":"New"," Parking Space"),t.xp6(1),t.Q6J("ngIf",!o.loading),t.xp6(1),t.Q6J("ngIf",!o.loading)("ngIfElse",i)}},dependencies:[m.O5,I.KE,I.TO,et.Nt,nt.Ou,T.ZT,w.wG,l.Fj,l.JJ,l.JL,l.sg,l.u,st.d,y.o]})}return s})(),v=(()=>{class s extends d.cx{constructor(e,n){super(),this._org=e,this._dialog=n,this._poll=new x.X(0),this._change=new x.X(0),this._options=new x.X({date:Date.now(),search:"",zones:[]}),this._loading=new x.X([]),this.levels=this._org.active_levels.pipe((0,f.U)(o=>o.filter(i=>i.tags.includes("parking")))),this.spaces=(0,k.aj)([this.levels,this._options,this._change]).pipe((0,Q.h)(([o,i])=>!(!i.zones[0]&&!o[0]?.id)),(0,A.w)(([o,i])=>(this._loading.next([...this._loading.getValue(),"spaces"]),(0,b.rlq)(i.zones[0]||o[0]?.id,"parking-spaces"))),(0,f.U)(o=>o.details instanceof Array?o.details:[]),(0,M.b)(()=>this._loading.next(this._loading.getValue().filter(o=>"spaces"!==o))),(0,N.d)(1)),this.users=(0,k.aj)([this._org.active_building,this._change]).pipe((0,Q.h)(([o])=>!!o?.id),(0,A.w)(([o])=>(this._loading.next([...this._loading.getValue(),"users"]),(0,b.rlq)(o.id,"parking-users"))),(0,f.U)(o=>o.details instanceof Array?o.details:[]),(0,M.b)(()=>this._loading.next(this._loading.getValue().filter(o=>"users"!==o))),(0,N.d)(1)),this.bookings=(0,k.aj)([this._org.active_building,this._options,this._poll]).pipe((0,tt.b)(500),(0,A.w)(([o,i])=>(this._loading.next([...this._loading.getValue(),"bookings"]),(0,P.F2)({period_start:(0,D.Z)((0,W.Z)(i.date)),period_end:(0,D.Z)((0,$.Z)(i.date)),type:"parking",zones:i.zones?.length?i.zones.join(","):o?.id}))),(0,M.b)(()=>this._loading.next(this._loading.getValue().filter(o=>"bookings"!==o))),(0,N.d)(1)),this.options=this._options.asObservable(),this.loading=this._loading.asObservable()}setOptions(e){this._options.next({...this._options.getValue(),...e})}startPolling(e=5e3){return this._poll.next(Date.now()),this.interval("poll",()=>this._poll.next(Date.now()),e),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}editSpace(e){var n=this;return(0,_.Z)(function*(){const o=n._dialog.open(R,{data:e}),i=yield Promise.race([o.afterClosed().toPromise(),o.componentInstance.event.pipe((0,B.P)(z=>"done"===z.reason)).toPromise()]);if("done"!==i?.reason)return;const r=n._options.getValue().zones[0],p={...i.metadata,id:i.metadata.id||`parking-${r}.${(0,d.Iy)(999999)}`},g=yield n.spaces.pipe((0,Z.q)(1)).toPromise(),h=g.findIndex(z=>z.id===p.id);h>=0?g[h]=p:g.push(p);const Vt=g;yield(0,b.Ymr)(r,{name:"parking-spaces",details:Vt,description:"List of available parking spaces"}).toPromise(),n._change.next(Date.now()),o.close()})()}removeSpace(e){var n=this;return(0,_.Z)(function*(){const o=yield(0,d._5)({title:"Remove Parking Space",content:`Are you sure you wish to remove the parking space "${e.name}"?`,icon:{content:"delete"}},n._dialog);if("done"!==o?.reason)return;o.loading("Removing parking space...");const i=n._options.getValue().zones[0],r=yield n.spaces.pipe((0,Z.q)(1)).toPromise();yield(0,b.Ymr)(i,{name:"parking-spaces",details:r.filter(p=>p.id!==e.id),description:"List of available parking spaces"}).toPromise(),o.close()})()}saveUsers(e){return(0,_.Z)(function*(){})()}approveBooking(e){return(0,_.Z)(function*(){"failed"===(yield(0,P.jT)(e.id).toPromise().catch(o=>"failed"))?(0,d.cB)("Error approving in desk booking"):(0,d.t5)(`Approved parking reservation for ${e.user_name} on ${(0,q.Z)(e.date,"MMM Do")}.`)})()}rejectBooking(e){return(0,_.Z)(function*(){"failed"===(yield(0,P.FP)(e.id).toPromise().catch(o=>"failed"))?(0,d.cB)("Error rejecting in desk booking"):(0,d.t5)(`Rejected parking reservation for ${e.user_name} on ${(0,q.Z)(e.date,"MMM Do")}.`)})()}static#t=this.\u0275fac=function(n){return new(n||s)(t.LFG(Y.w7),t.LFG(T.uw))};static#e=this.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var G=a(60702),L=a(27442);function rt(s,c){if(1&s&&t._uU(0),2&s){const e=c.row;t.hij(" ",null==e||null==e.extension_data?null:e.extension_data.plate_number," ")}}function lt(s,c){if(1&s&&(t.TgZ(0,"span",5),t._uU(1),t.qZA()),2&s){const e=c.data;t.ekj("bg-success","approved"===e)("bg-warning","tentative"===e)("bg-error","cancelled"===e||"declined"===e)("text-success-content","approved"===e)("text-warning-content","tentative"===e)("text-error-content","cancelled"===e||"declined"===e),t.xp6(1),t.hij(" ",e," ")}}function ct(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"div",6)(1,"button",7),t.NdJ("click",function(){const i=t.CHM(e).row,r=t.oxw();return t.KtG(r.reject(i))}),t.TgZ(2,"app-icon"),t._uU(3,"event_busy"),t.qZA()(),t.TgZ(4,"button",8),t.NdJ("click",function(){const i=t.CHM(e).row,r=t.oxw();return t.KtG(r.approve(i))}),t.TgZ(5,"app-icon"),t._uU(6,"event_available"),t.qZA()()()}}function pt(s,c){1&s&&t._UZ(0,"mat-progress-bar",9)}const mt=()=>["asset_name","booked_by_name","user_name","plate_number","status","actions"],gt=()=>["Bay No.","Reserved By","Reserved For","Car Plate #","Status"," "],dt=()=>["6r","flex","14r","8r","6r","6r"],ut=(s,c,e)=>({plate_number:s,actions:c,status:e});let O=(()=>{class s{constructor(e){this._state=e,this.events=this._state.bookings,this.options=this._state.options,this.loading=this._state.loading,this.reject=n=>this._state.rejectBooking(n),this.approve=n=>this._state.approveBooking(n)}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(v))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["parking-bookings-list"]],decls:11,vars:22,consts:[[1,"block","min-w-[60rem]",3,"dataSource","columns","display_column","filter","column_size","template"],["plate_template",""],["status_template",""],["action_template",""],["class","absolute bottom-0 inset-x-0",4,"ngIf"],[1,"capitalize","px-2","py-1","rounded","border","border-base-200"],[1,"w-full","flex","items-center","justify-end"],["icon","","matTooltip","Reject Parking Reservation",3,"click"],["icon","","matTooltip","Approve Parking Reservation",3,"click"],[1,"absolute","bottom-0","inset-x-0"]],template:function(n,o){if(1&n&&(t._UZ(0,"custom-table",0),t.ALo(1,"async"),t.ALo(2,"async"),t.YNc(3,rt,1,1,"ng-template",null,1,t.W1O)(5,lt,2,13,"ng-template",null,2,t.W1O)(7,ct,7,0,"ng-template",null,3,t.W1O)(9,pt,1,0,"mat-progress-bar",4),t.ALo(10,"async")),2&n){const i=t.MAs(4),r=t.MAs(6),p=t.MAs(8);let g,h;t.ekj("opacity-50",null==(g=t.lcZ(1,9,o.loading))?null:g.includes("bookings")),t.Q6J("dataSource",o.events)("columns",t.DdM(15,mt))("display_column",t.DdM(16,gt))("filter",t.lcZ(2,11,o.options).search)("column_size",t.DdM(17,dt))("template",t.kEZ(18,ut,i,p,r)),t.xp6(9),t.Q6J("ngIf",null==(h=t.lcZ(10,13,o.loading))?null:h.includes("bookings"))}},dependencies:[m.O5,G.gM,C.pW,y.o,L.C,m.Ov],styles:["[_nghost-%COMP%]{display:block;width:100%;height:100%;overflow:auto}\n\n/*# sourceMappingURL=parking-bookings-list.component.ts-angular-inline--160.css.map*/"]})}return s})();function _t(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"div",5)(1,"button",6),t.NdJ("click",function(){const i=t.CHM(e).row,r=t.oxw();return t.KtG(r.editSpace(i))}),t.TgZ(2,"app-icon"),t._uU(3,"edit"),t.qZA()(),t.TgZ(4,"button",6),t.NdJ("click",function(){const i=t.CHM(e).row,r=t.oxw();return t.KtG(r.removeSpace(i))}),t.TgZ(5,"app-icon"),t._uU(6,"delete"),t.qZA()()()}}function ht(s,c){1&s&&t._UZ(0,"mat-progress-bar",7)}const ft=()=>["name","map_id","assigned_to","notes","actions"],vt=()=>["Bay No.","Map ID","Assigned","Notes"," "],xt=()=>["8r","10r","14r","flex","10r"],Zt=s=>({actions:s});let J=(()=>{class s{constructor(e){this._state=e,this.spaces=this._state.spaces,this.options=this._state.options,this.loading=this._state.loading,this.editSpace=n=>this._state.editSpace(n),this.removeSpace=n=>this._state.removeSpace(n)}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(v))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["parking-space-list"]],decls:11,vars:20,consts:[[1,"absolute","inset-0","overflow-auto","px-2"],[1,"block","min-w-[56rem]",3,"dataSource","columns","display_column","column_size","template","filter"],["action_template",""],["class","absolute bottom-0 inset-x-0",4,"ngIf"],["btn","","icon","","matRipple","",1,"absolute","bottom-2","left-2","bg-secondary","text-secondary-content",3,"click"],[1,"w-full","flex","items-center","justify-end"],["icon","",3,"click"],[1,"absolute","bottom-0","inset-x-0"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0),t._UZ(1,"custom-table",1),t.ALo(2,"async"),t.ALo(3,"async"),t.YNc(4,_t,7,0,"ng-template",null,2,t.W1O)(6,ht,1,0,"mat-progress-bar",3),t.ALo(7,"async"),t.qZA(),t.TgZ(8,"button",4),t.NdJ("click",function(){return o.editSpace()}),t.TgZ(9,"app-icon"),t._uU(10,"add"),t.qZA()()),2&n){const i=t.MAs(5);let r,p;t.xp6(1),t.ekj("opacity-50",null==(r=t.lcZ(2,9,o.loading))?null:r.includes("spaces")),t.Q6J("dataSource",o.spaces)("columns",t.DdM(15,ft))("display_column",t.DdM(16,vt))("column_size",t.DdM(17,xt))("template",t.VKq(18,Zt,i))("filter",t.lcZ(3,11,o.options).search),t.xp6(5),t.Q6J("ngIf",null==(p=t.lcZ(7,13,o.loading))?null:p.includes("spaces"))}},dependencies:[m.O5,C.pW,w.wG,y.o,L.C,m.Ov],encapsulation:2})}return s})();var bt=a(11771),kt=a(97338),Tt=a(96355);function wt(s,c){if(1&s&&(t.TgZ(0,"mat-option",7),t._uU(1),t.qZA()),2&s){const e=c.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.display_name||e.name," ")}}function yt(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"date-options",8),t.NdJ("dateChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.setDate(o))}),t.qZA()}}let j=(()=>{class s extends d.cx{constructor(e,n,o,i){super(),this._state=e,this._org=n,this._route=o,this._router=i,this.manage=!1,this.zones=[],this.levels=this._state.levels,this.options=this._state.options,this.setDate=r=>this._state.setOptions({date:r}),this.setSearch=r=>this._state.setOptions({search:r}),this.updateZones=r=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:r.join(",")}}),this._state.setOptions({zones:r})}}ngOnInit(){var e=this;return(0,_.Z)(function*(){yield e._org.initialised.pipe((0,B.P)(n=>n)).toPromise(),e.subscription("route.query",e._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const o=n.get("zone_ids").split(",");if(o.length){const i=e._org.levelWithID(o);if(e.zones=o,!i)return;e._org.building=e._org.buildings.find(r=>r.id===i.parent_id)}}})),e.subscription("levels",e._state.levels.subscribe(n=>{e.zones=e.zones.filter(o=>n.find(i=>i.id===o)),!e.zones.length&&n.length&&e.zones.push(n[0].id),e.updateZones(e.zones)})),e.manage=!e._router.url.includes("events")})()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(v),t.Y36(Y.w7),t.Y36(u.gz),t.Y36(u.F0))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["parking-topbar"]],features:[t.qOj],decls:8,vars:5,consts:[[1,"flex","items-center","bg-base-100","px-2","h-20"],["appearance","outline"],["placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"flex-1","w-0"],[1,"mr-2",3,"modelChange"],[3,"dateChange",4,"ngIf"],[3,"value"],[3,"dateChange"]],template:function(n,o){1&n&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(r){return o.updateZones([r]),o.zones=[r]}),t.YNc(3,wt,2,2,"mat-option",3),t.ALo(4,"async"),t.qZA()(),t._UZ(5,"div",4),t.TgZ(6,"searchbar",5),t.NdJ("modelChange",function(r){return o.setSearch(r)}),t.qZA(),t.YNc(7,yt,1,0,"date-options",6),t.qZA()),2&n&&(t.xp6(2),t.Q6J("ngModel",o.zones[0]),t.xp6(1),t.Q6J("ngForOf",t.lcZ(4,3,o.levels)),t.xp6(4),t.Q6J("ngIf",!o.manage))},dependencies:[m.sg,m.O5,bt.E,kt.U,I.KE,Tt.gD,w.ey,l.JJ,l.On,m.Ov],styles:["button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=parking-topbar.component.ts-angular-inline--161.css.map*/"]})}return s})();var Ct=a(42349);function Ut(s,c){1&s&&(t.TgZ(0,"div",6),t._UZ(1,"div",7),t.TgZ(2,"p"),t._uU(3,"No parking floors for the currently selected building"),t.qZA()())}const Pt=()=>["/parking","events"],At=()=>["/parking","spaces"];let E=(()=>{class s extends d.cx{constructor(e,n){super(),this._state=e,this._router=n,this.levels=this._state.levels,this.path=""}ngOnInit(){this._state.startPolling(),this.subscription("router.events",this._router.events.subscribe(n=>{if(n instanceof u.m2){const o=this._router.url?.split("/")||[""];this.path=o[e.length-1].split("?")[0]}}));const e=this._router.url?.split("/")||[""];this.path=e[e.length-1].split("?")[0]}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(v),t.Y36(u.F0))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-parking"]],features:[t.qOj],decls:13,vars:9,consts:[[1,"relative","overflow-hidden","bg-base-100"],[1,"dark"],["mat-tab-nav-bar",""],["mat-tab-link","","queryParamsHandling","merge",3,"routerLink","active"],[1,"flex-1","h-1/2","w-full","relative","overflow-auto","px-4"],["class","absolute inset-0 flex flex-col items-center justify-center z-50",4,"ngIf"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","z-50"],[1,"absolute","inset-0","bg-base-100","opacity-50","z-0"]],template:function(n,o){if(1&n&&(t._UZ(0,"sidebar"),t.TgZ(1,"main",0),t._UZ(2,"parking-topbar"),t.TgZ(3,"div",1)(4,"nav",2)(5,"a",3),t._uU(6," Bookings "),t.qZA(),t.TgZ(7,"a",3),t._uU(8," Manage Spaces "),t.qZA()()(),t.TgZ(9,"div",4),t._UZ(10,"router-outlet"),t.qZA(),t.YNc(11,Ut,4,0,"div",5),t.ALo(12,"async"),t.qZA()),2&n){let i;t.xp6(5),t.Q6J("routerLink",t.DdM(7,Pt))("active","events"===o.path),t.xp6(2),t.Q6J("routerLink",t.DdM(8,At))("active","spaces"===o.path),t.xp6(4),t.Q6J("ngIf",!(null!=(i=t.lcZ(12,5,o.levels))&&i.length))}},dependencies:[m.O5,Ct.k,U.BU,U.Nj,u.lC,u.rH,j,m.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=parking.component.ts-angular-inline--162.css.map*/"]})}return s})();var Mt=a(33005),Nt=a(19842);function It(s,c){1&s&&(t.TgZ(0,"div",4)(1,"p"),t._uU(2,"No parking floors for the currently selected building"),t.qZA()())}let V=(()=>{class s extends d.cx{constructor(e,n){super(),this._state=e,this._router=n,this.levels=this._state.levels,this.path=""}ngOnInit(){this._state.startPolling(),this.subscription("router.events",this._router.events.subscribe(n=>{if(n instanceof u.m2){const o=this._router.url?.split("/")||[""];this.path=o[e.length-1].split("?")[0]}}));const e=this._router.url?.split("/")||[""];this.path=e[e.length-1].split("?")[0]}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(v),t.Y36(u.F0))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["app-new-parking"]],features:[t.qOj],decls:9,vars:3,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full","relative"],[1,"flex-1","h-1/2","w-full","relative","overflow-auto","px-2"],["class","absolute inset-0 bg-base-100/80/20 flex flex-col items-center justify-center z-50",4,"ngIf"],[1,"absolute","inset-0","bg-base-100/80/20","flex","flex-col","items-center","justify-center","z-50"]],template:function(n,o){if(1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1),t._UZ(4,"parking-topbar"),t.TgZ(5,"div",2),t._UZ(6,"router-outlet"),t.qZA(),t.YNc(7,It,3,0,"div",3),t.ALo(8,"async"),t.qZA()()),2&n){let i;t.xp6(7),t.Q6J("ngIf",!(null!=(i=t.lcZ(8,1,o.levels))&&i.length))}},dependencies:[m.O5,Mt.O,Nt.u,u.lC,j,m.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=new-parking.component.ts-angular-inline--163.css.map*/"]})}return s})();function Lt(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"input",6),t.NdJ("ngModelChange",function(o){const i=t.CHM(e);return t.KtG(i.row.get(i.key).setValue(o))}),t.qZA()}if(2&s){const o=c.name;t.Q6J("ngModel",c.row.value[c.key])("placeholder",o)}}function Ot(s,c){if(1&s&&(t.TgZ(0,"app-icon"),t._uU(1," warning "),t.qZA()),2&s){const e=t.oxw().row,n=t.oxw();t.ekj("text-red-600",n.deletion.has(e.value.id))("text-yellow-400",!n.deletion.has(e.value.id))}}function Jt(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().row,i=t.oxw();return t.KtG(i.markForDelete(o.value.id))}),t.TgZ(1,"app-icon"),t._uU(2,"delete"),t.qZA()()}if(2&s){const e=t.oxw().row,n=t.oxw();t.Q6J("matTooltip",n.isNew(e.value.id)?"Remove New User":"Mark for Deletion")}}function jt(s,c){if(1&s){const e=t.EpF();t.TgZ(0,"button",12),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.clearChanges(o.id))}),t.TgZ(1,"app-icon"),t._uU(2,"clear_all"),t.qZA()()}}function St(s,c){if(1&s&&(t.TgZ(0,"div",7),t.YNc(1,Ot,2,4,"app-icon",8)(2,Jt,3,1,"button",9)(3,jt,3,0,"button",10),t.qZA()),2&s){const e=c.row,n=t.oxw();t.xp6(1),t.Q6J("ngIf",n.deletion.has(e.value.id)||e.dirty||n.isNew(e.value.id)),t.xp6(1),t.Q6J("ngIf",!n.deletion.has(e.value.id)),t.xp6(1),t.Q6J("ngIf",n.deletion.has(e.value.id)||e.dirty)}}function zt(s,c){if(1&s&&(t.TgZ(0,"div",16)(1,"app-icon",17),t._uU(2,"warning"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.qZA()()),2&s){const e=t.oxw(2);t.xp6(4),t.hij("",e.deletion.entries.length," users pending deletion")}}function Ft(s,c){if(1&s&&(t.TgZ(0,"div",16)(1,"app-icon",18),t._uU(2,"warning"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.ALo(5,"async"),t.qZA()()),2&s){const e=t.oxw(2);t.xp6(4),t.hij(" ",t.lcZ(5,1,e.new_items).length," new users pending save ")}}function Yt(s,c){if(1&s&&(t.TgZ(0,"div",16)(1,"app-icon",18),t._uU(2,"warning"),t.qZA(),t.TgZ(3,"div"),t._uU(4),t.ALo(5,"async"),t.qZA()()),2&s){const e=t.oxw(2);t.xp6(4),t.hij("",t.lcZ(5,1,e.change_count)," users with pending changes")}}function Dt(s,c){if(1&s&&(t.TgZ(0,"div",13),t.YNc(1,zt,5,1,"div",14)(2,Ft,6,3,"div",14),t.ALo(3,"async"),t.YNc(4,Yt,6,3,"div",14),t.ALo(5,"async"),t.TgZ(6,"button",15),t._uU(7,"Save Changes"),t.qZA()()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.deletion.entries.length),t.xp6(1),t.Q6J("ngIf",t.lcZ(3,3,e.new_items).length),t.xp6(2),t.Q6J("ngIf",t.lcZ(5,5,e.change_count))}}const qt=()=>["email","transponder","designation","car_model","car_colour","plate_number","phone","notes","actions"],Qt=()=>["","","","","","","",""," "],Bt=()=>["14r","10r","10r","10r","10r","10r","10r","flex"],Rt=(s,c,e,n,o,i,r,p,g,h)=>({email:s,name:c,transponder:e,designation:n,car_model:o,car_colour:i,plate_number:r,phone:p,notes:g,actions:h}),K=s=>new l.cw({id:new l.NI(s.id||""),email:new l.NI(s.email||""),name:new l.NI(s.name||""),transponder:new l.NI(s.transponder||""),designation:new l.NI(s.designation||""),car_model:new l.NI(s.car_model||""),car_colour:new l.NI(s.car_colour||""),plate_number:new l.NI(s.plate_number||""),phone:new l.NI(s.phone||""),notes:new l.NI(s.notes||"")});let S=(()=>{class s{isNew(e){return!!this.new_items.getValue().find(n=>n.value.id===e)}constructor(e){this._state=e,this.options=this._state.options,this.loading=this._state.loading,this.forms=this._state.users.pipe((0,f.U)(n=>n.map(o=>K(o)))),this.new_items=new x.X([]),this.user_list=(0,k.aj)([this.forms,this.new_items]).pipe((0,f.U)(([n,o])=>[...n,...o])),this.change_count=this.user_list.pipe((0,f.U)(n=>n.filter(o=>o.dirty||!this.isNew(o.value.id)).length)),this.deletion=new Set}markForDelete(e){this.isNew(e)?this.new_items.next(this.new_items.getValue().filter(n=>n.value.id!==e)):this.deletion.add(e)}clearChanges(e){var n=this;return(0,_.Z)(function*(){if(n.isNew(e)){const i=n.new_items.getValue().find(r=>r.value.id===e);i&&i.reset({id:e})}else{const o=yield n.user_list.pipe((0,Z.q)(1)).toPromise(),i=yield n._state.users.pipe((0,Z.q)(1)).toPromise(),r=o.find(g=>g.value.id===e),p=i.find(g=>g.id===e);r&&p&&r.reset(p)}})()}newUser(){const e=K({id:`parking-${(0,d.Iy)(99999999,1e7)}`});this.new_items.next([...this.new_items.getValue(),e])}saveChanges(){var e=this;return(0,_.Z)(function*(){const o=(yield e.user_list.pipe((0,Z.q)(1)).toPromise()).map(i=>i.value).filter(i=>!e.deletion.has(i.id));yield e._state.saveUsers(o)})()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(v))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["parking-users-list"]],decls:14,vars:31,consts:[[1,"absolute","inset-0","overflow-auto","px-2"],[1,"block","min-w-[96rem]",3,"dataSource","columns","display_column","column_size","template","filter"],["text_input_template",""],["action_template",""],["btn","","icon","","matRipple","",1,"absolute","bottom-2","left-2","bg-primary","text-white",3,"click"],["class","absolute bottom-2 right-2 bg-base-100 border border-base-200 p-2 text-base rounded shadow space-y-2",4,"ngIf"],[1,"relative","-top-px","border-none","px-2","py-4","-m-2","text-base","w-full","!outline-none","focus:border-b","border-blue-600",3,"ngModel","placeholder","ngModelChange"],[1,"w-full","flex","items-center","justify-end"],[3,"text-red-600","text-yellow-400",4,"ngIf"],["btn","","icon","",3,"matTooltip","click",4,"ngIf"],["btn","","icon","","matTooltip","Clear Changes",3,"click",4,"ngIf"],["btn","","icon","",3,"matTooltip","click"],["btn","","icon","","matTooltip","Clear Changes",3,"click"],[1,"absolute","bottom-2","right-2","bg-base-100","border","border-base-200","p-2","text-base","rounded","shadow","space-y-2"],["class","flex items-center space-x-2 p-2",4,"ngIf"],["btn","",1,"w-full"],[1,"flex","items-center","space-x-2","p-2"],[1,"text-red-600","text-2xl"],[1,"text-yellow-400","text-2xl"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0),t._UZ(1,"custom-table",1),t.ALo(2,"async"),t.ALo(3,"async"),t.YNc(4,Lt,1,2,"ng-template",null,2,t.W1O)(6,St,4,3,"ng-template",null,3,t.W1O),t.qZA(),t.TgZ(8,"button",4),t.NdJ("click",function(){return o.newUser()}),t.TgZ(9,"app-icon"),t._uU(10,"add"),t.qZA()(),t.YNc(11,Dt,8,7,"div",5),t.ALo(12,"async"),t.ALo(13,"async")),2&n){const i=t.MAs(5),r=t.MAs(7);let p;t.xp6(1),t.ekj("opacity-50",null==(p=t.lcZ(2,9,o.loading))?null:p.includes("users")),t.Q6J("dataSource",o.user_list)("columns",t.DdM(17,qt))("display_column",t.DdM(18,Qt))("column_size",t.DdM(19,Bt))("template",t.rFY(20,Rt,[i,i,i,i,i,i,i,i,i,r]))("filter",t.lcZ(3,11,o.options).search),t.xp6(10),t.Q6J("ngIf",o.deletion.entries.length||t.lcZ(12,13,o.change_count)||t.lcZ(13,15,o.new_items).length)}},dependencies:[m.O5,G.gM,w.wG,l.Fj,l.JJ,l.On,y.o,L.C,m.Ov]})}return s})();const Gt=[{path:"new",component:V,children:[{path:"events",component:O},{path:"users",component:S},{path:"manage",component:J},{path:"**",redirectTo:"events"}]},{path:"",component:E,children:[{path:"events",component:O},{path:"users",component:S},{path:"manage",component:J},{path:"**",redirectTo:"events"}]},{path:"**",redirectTo:""}];let Et=(()=>{class s{static#t=this.\u0275fac=function(n){return new(n||s)};static#e=this.\u0275mod=t.oAB({type:s});static#n=this.\u0275inj=t.cJS({imports:[m.ez,H.v,l.u5,l.UX,X.W9,U.Nh,C.Cv,u.Bz.forChild(Gt)]})}return s})()}}]);
//# sourceMappingURL=apps_concierge_src_app_parking_parking_module_ts.js.map