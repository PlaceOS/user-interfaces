"use strict";(self.webpackChunkvisitor_kiosk=self.webpackChunkvisitor_kiosk||[]).push([["apps_visitor-kiosk_src_app_explore_explore_module_ts"],{6152:(Ft,ne,_)=>{_.r(ne),_.d(ne,{AppExploreModule:()=>Xt});var x=_(6477),w=_(854),f=_(9542),W=_(3689),ie=_(4291),ye=_(2778),Oe=_(2035),Te=_(3243),Le=_(4317),b=_(1670),m=_(337),J=_(5670),z=_(3174),P=_(6667),e=_(9445),B=_(7728),Me=_(8750),Se=_(6508);function Ze(s,c){if(1&s&&(e.TgZ(0,"mat-option",6),e._uU(1),e.qZA()),2&s){const t=c.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function Ie(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"mat-form-field",3)(1,"mat-select",4),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.setBuilding(n))}),e.ALo(2,"async"),e.YNc(3,Ze,2,2,"mat-option",5),e.ALo(4,"async"),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngModel",e.lcZ(2,2,t.building)),e.xp6(2),e.Q6J("ngForOf",e.lcZ(4,4,t.buildings))}}function we(s,c){if(1&s&&(e.TgZ(0,"mat-option",6),e._uU(1),e.qZA()),2&s){const t=c.$implicit;e.Q6J("value",t),e.xp6(1),e.hij(" ",t.display_name||t.name," ")}}function Pe(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"mat-form-field",7),e.ALo(1,"async"),e.TgZ(2,"mat-select",8),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.setLevel(n))}),e.ALo(3,"async"),e.YNc(4,we,2,2,"mat-option",5),e.ALo(5,"async"),e.qZA()()}if(2&s){const t=e.oxw();let o;e.uIk("has-bld",(null==(o=e.lcZ(1,3,t.buildings))?null:o.length)>1),e.xp6(2),e.Q6J("ngModel",e.lcZ(3,5,t.level)),e.xp6(2),e.Q6J("ngForOf",e.lcZ(5,7,t.levels))}}let ae=(()=>{class s extends m.cx{constructor(t,o,n,a){super(),this._org=t,this._state=o,this._router=n,this._route=a,this.buildings=this._org.active_buildings,this.building=this._org.active_building,this.levels=this._org.active_levels,this.level=this._state.level,this.setLevel=r=>{this._state.setFeatures("_located",[]),this.timeout("set_level",()=>this._router.navigate([],{relativeTo:this._route,queryParams:{zone:r.id}}),201)},this.setBuilding=r=>this._org.building=r}ngOnInit(){var t=this;return(0,b.Z)(function*(){yield t._org.initialised.pipe((0,J.P)(o=>o)).toPromise(),t.subscription("route.query",t._route.queryParamMap.subscribe(o=>o.has("zone")?t._state.setLevel(o.get("zone")):""))})()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(z.w),e.Y36(P.c),e.Y36(w.F0),e.Y36(w.gz))},s.\u0275cmp=e.Xpm({type:s,selectors:[["explore-map-controls"]],features:[e.qOj],decls:5,vars:6,consts:function(){let c,t;return c=$localize`:␟dea1f8bc2b32584fadf07ef815709b946d3726ff␟1533056789917995243:Select Building...`,t=$localize`:␟025373b97845a8c2b54d2eb17d9c479f64207b11␟7854898325453225869:Select Level...`,[[1,"flex","space-x-2","w-full"],["overlay","","buildings","","class","flex-1 min-w-[10.5rem]","has-bld","true","appearance","outline",4,"ngIf"],["overlay","","levels","","class","flex-1 min-w-[10.25rem]","appearance","outline",4,"ngIf"],["overlay","","buildings","","has-bld","true","appearance","outline",1,"flex-1","min-w-[10.5rem]"],["placeholder",c,3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["overlay","","levels","","appearance","outline",1,"flex-1","min-w-[10.25rem]"],["placeholder",t,3,"ngModel","ngModelChange"]]},template:function(t,o){if(1&t&&(e.TgZ(0,"div",0),e.YNc(1,Ie,5,6,"mat-form-field",1),e.ALo(2,"async"),e.YNc(3,Pe,6,9,"mat-form-field",2),e.ALo(4,"async"),e.qZA()),2&t){let n,a;e.xp6(1),e.Q6J("ngIf",(null==(n=e.lcZ(2,2,o.buildings))?null:n.length)>1),e.xp6(2),e.Q6J("ngIf",null==(a=e.lcZ(4,4,o.levels))?null:a.length)}},dependencies:[x.sg,x.O5,B.ey,Me.KE,Se.gD,f.JJ,f.On,x.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.5rem}mat-form-field[has-bld=true][_ngcontent-%COMP%]{max-width:calc(50vw - 2.5rem)}[full][_nghost-%COMP%]   mat-form-field[_ngcontent-%COMP%]{max-width:calc(50% - 2.5rem)}\n/*# sourceMappingURL=explore-map-control.component.ts-angular-inline--68.css.map*/"]}),s})();var y=_(7502),Ne=_(3910),re=_(5533),ke=_(73),ee=_(4702),Re=_(3159),le=_(6198),D=_(6888),E=(_(4922),_(6942)),Ae=_(9627),Y=_(5306);function $e(s,c){if(1&s&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"thermostat"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&s){const t=e.oxw();e.xp6(4),e.hij("",t.temp,"\u02daF")}}function Xe(s,c){if(1&s&&(e.TgZ(0,"div",3)(1,"app-icon"),e._uU(2,"opacity"),e.qZA(),e.TgZ(3,"div",4),e._uU(4),e.qZA()()),2&s){const t=e.oxw();e.xp6(4),e.hij("",t.humidity,"%")}}function Fe(s,c){1&s&&(e.TgZ(0,"div",5)(1,"app-icon",6),e._uU(2,"error"),e.qZA()())}let ce=(()=>{class s{constructor(t){this._details=t,this.temp=this._details.temp||0,this.humidity=this._details.humidity||0}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(W.ui))},s.\u0275cmp=e.Xpm({type:s,selectors:[["explore-sensor-info"]],decls:4,vars:3,consts:[[1,"absolute","center","bg-white","rounded-lg","border","border-gray-300","p-2","text-xl"],["class","flex items-center space-x-2 whitespace-nowrap pr-2",4,"ngIf"],["class","absolute top-0 right-0 rounded-full translate-x-1/2 -translate-y-1/2 bg-white border border-gray-300",4,"ngIf"],[1,"flex","items-center","space-x-2","whitespace-nowrap","pr-2"],[1,""],[1,"absolute","top-0","right-0","rounded-full","translate-x-1/2","-translate-y-1/2","bg-white","border","border-gray-300"],[1,"text-error","text-xl"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0),e.YNc(1,$e,5,1,"div",1),e.YNc(2,Xe,5,1,"div",1),e.YNc(3,Fe,3,0,"div",2),e.qZA()),2&t&&(e.xp6(1),e.Q6J("ngIf",o.temp),e.xp6(1),e.Q6J("ngIf",o.humidity),e.xp6(1),e.Q6J("ngIf",o.temp>82))},dependencies:[x.O5,Y.o]}),s})(),_e=(()=>{class s extends m.cx{constructor(t,o,n){super(),this._state=t,this._org=o,this._settings=n,this._statuses={},this._location={},this._capacity={},this._draw={},this._points={},this._features=[],this._bind=this._state.level.pipe((0,E.U)(a=>{if(!a)return;this._statuses={};let r=this._org.binding("area_management");if(!r)return;const i=(0,y.rTZ)(r,"AreaManagement").binding(`${a.id}:areas`);this.subscription("zones",i.listen().subscribe(l=>this.parseData(l))),this.subscription("binding",i.bind())})),this.init()}init(){var t=this;return(0,b.Z)(function*(){yield t._org.initialised.pipe((0,J.P)(n=>n)).toPromise();const o=yield Promise.all(t._org.levels.map(n=>(0,y.rlq)(n.id,"map_regions").toPromise()));for(const n of o){const a=n?.details?.areas;if(a)for(const r of a){const{capacity:i,hide_label:l,label_location:u,draw_polygon:p}=r.properties||{},{coordinates:d}=r.geometry||{};t._capacity[r.id]=i||100,t._location[r.id]=!1===l?u||(d?.length?pe(d):null):null,t._draw[r.id]=!!p||t._settings.get("app.explore.use_zone_polygons"),t._points[r.id]=d||[]}}t.updateStatus(),t.subscription("bind",t._bind.subscribe())})()}parseData(t){const o=t?.value||[],n=[],a=[];for(const r of o){const i=r.count/(this._capacity[r.area_id]||100);if(this._statuses[r.area_id]=i<.4?"free":i<.75?"pending":"busy",!this._location[r.area_id])continue;let l="";r.count&&(l+=`${r.count||0} User Device${1===r.count?"":"s"}\n`),r.temperature&&(l+=`Temperature: ${r.temperature} \u02daC\n`),r.people_count>0&&(l+=`${r.people_count_sum} ${1===r.people_count_sum?"Person":"People"}\n`),r.humidity&&(l+=`Humidity: ${r.humidity}%\n`),r.queue_size&&(l+=`Queue Size: ${r.queue_size}%\n`),r.counter&&(l+=`Count: ${r.counter}\n`),n.push({location:this._location[r.area_id],content:l,z_index:100}),this._settings.get("app.explore.show_simple_sensor_info")&&(r.temperature||r.humidity)&&a.push({location:this._location[r.area_id],content:ce,data:{temp:r.temperature,humidity:r.humidity},z_index:98})}this._features=a,this._settings.get("app.explore.show_simple_sensor_info")||this._state.setLabels("zones",n),this.updateStatus()}updateStatus(){const t={},o=[],n=this._settings.get("app.explore.colors")||{};for(const a in this._statuses){const r=n[`zone-${this._statuses[a]}`]||n[`${this._statuses[a]}`]||D.y[`${this._statuses[a]}`];this._draw[a]?o.push({track_id:`zone:${a}`,location:pe(this._points[a]),content:Ae.i,data:{color:r,points:this._points[a]},z_index:10}):t[`#${a}`]={fill:r,opacity:.6}}this._state.setFeatures("zones",[...o,this._features]),this._state.setStyles("zones",t)}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(P.c),e.LFG(z.w),e.LFG(m.gb))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac}),s})();function pe(s){const c=(s||[]).reduce((t,[o,n])=>({x_min:o<t.x_min?o:t.x_min,x_max:o>t.x_max?o:t.x_max,y_min:n<t.y_min?n:t.y_min,y_max:n>t.y_max?n:t.y_max}),{x_min:100,x_max:-100,y_min:100,y_max:-100});return{x:c.x_min+(c.x_max-c.x_min)/2,y:c.y_min+(c.y_max-c.y_min)/2}}var N=_(3200),k=_(1810),G=_(9377),Q=_(312),T=_(4505),A=_(4139),L=_(7716),$=_(823),S=_(9095),U=_(7418),I=_(9128),K=_(9151),j=_(8759),de=_(8929),ze=_(9502),V=_(7486),Be=_(2306),De=_(1022),Ue=_(7303),Je=_(9697);function Ye(s,c){if(1&s&&(e.TgZ(0,"div",7)(1,"div",13)(2,"label"),e._uU(3,"Resource:"),e.qZA(),e.TgZ(4,"div",14),e._uU(5),e.qZA()()()),2&s){const t=e.oxw(2);e.xp6(5),e.hij(" ",t.resource.name||t.resource.map_id||"Unknown Resource"," ")}}function Ge(s,c){1&s&&(e.TgZ(0,"div",7)(1,"div",8)(2,"label"),e._uU(3,"Host"),e.qZA(),e._UZ(4,"a-user-search-field",15),e.qZA()())}const je=function(){return{standalone:!0}};function Ve(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"main",5),e.YNc(1,Ye,6,1,"div",6),e.YNc(2,Ge,5,0,"div",6),e.TgZ(3,"div",7)(4,"div",8)(5,"label"),e._uU(6,"Date"),e.qZA(),e.TgZ(7,"a-date-field",9),e._uU(8," Date and time must be in the future "),e.qZA()()(),e.TgZ(9,"div",7)(10,"div",10)(11,"label"),e._uU(12,"Start Time"),e.qZA(),e.TgZ(13,"a-time-field",11),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.form.patchValue({date:n}))}),e.qZA()(),e.TgZ(14,"div",10)(15,"label"),e._uU(16,"End Time"),e.qZA(),e._UZ(17,"a-duration-field",12),e.qZA()()()}if(2&s){const t=e.oxw();let o;e.Q6J("formGroup",t.form),e.xp6(1),e.Q6J("ngIf",t.resource),e.xp6(1),e.Q6J("ngIf",t.host),e.xp6(5),e.Q6J("to",t.book_until),e.xp6(6),e.Q6J("ngModel",t.form.value.date)("ngModelOptions",e.DdM(12,je))("use_24hr",t.use_24hr_time),e.xp6(4),e.Q6J("time",null==(o=t.form.get("date"))?null:o.value)("max",720)("min",60)("step",60)("use_24hr",t.use_24hr_time)}}let te=(()=>{class s{get use_24hr_time(){return this._settings.get("app.use_24_hour_time")}constructor(t,o){this._data=t,this._settings=o,this.host=this._data.host,this.form=new f.cw({user:new f.NI(this._data.user),date:new f.NI(this._data.date),duration:new f.NI(this._data.duration)}),this.book_until=this._data.until,this.resource=this._data.resource}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(V.WI),e.Y36(m.gb))},s.\u0275cmp=e.Xpm({type:s,selectors:[["set-datetime-modal"]],decls:10,vars:2,consts:[["classs","flex items-center justify-between"],["icon","","mat-dialog-close",""],["class","w-[24rem] max-w-[85vw] pt-4",3,"formGroup",4,"ngIf"],[1,"w-full","p-2","border-t","border-gray-200","flex","items-center","justify-center"],["btn","","matRipple","",1,"w-32",3,"mat-dialog-close"],[1,"w-[24rem]","max-w-[85vw]","pt-4",3,"formGroup"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModel","ngModelOptions","use_24hr","ngModelChange"],["formControlName","duration",3,"time","max","min","step","use_24hr"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4","mb-2"],[1,"px-4","py-3","border","border-gray-200","rounded","w-full","mb-4"],["formControlName","user"]],template:function(t,o){1&t&&(e.TgZ(0,"header",0)(1,"h2"),e._uU(2,"Set date and time"),e.qZA(),e.TgZ(3,"button",1)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.YNc(6,Ve,18,13,"main",2),e.TgZ(7,"footer",3)(8,"button",4),e._uU(9," Continue "),e.qZA()()),2&t&&(e.xp6(6),e.Q6J("ngIf",o.form),e.xp6(2),e.Q6J("mat-dialog-close",o.form.value))},dependencies:[x.O5,Y.o,B.wG,V.ZT,f.JJ,f.JL,f.On,f.sg,f.u,Be.Q,De.B,Ue.N,Je.d]}),s})();var ue=_(1838),Qe=_(8305),Ke=_(8987),me=_(9136),He=_(3970);const qe=["explore-device-info",""];function We(s,c){if(1&s&&(e.TgZ(0,"p",17)(1,"label"),e.SDv(2,18),e.qZA(),e._uU(3),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.mac," ")}}function et(s,c){if(1&s&&(e.TgZ(0,"p",19)(1,"label"),e.SDv(2,20),e.qZA(),e._uU(3),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.manufacturer," ")}}function tt(s,c){if(1&s&&(e.TgZ(0,"p",21)(1,"label"),e.SDv(2,22),e.qZA(),e._uU(3),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.os," ")}}function ot(s,c){if(1&s&&(e.TgZ(0,"p",23)(1,"label"),e.SDv(2,24),e.qZA(),e._uU(3),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.ssid," ")}}function st(s,c){if(1&s&&(e.TgZ(0,"p",25)(1,"label"),e.SDv(2,26),e.qZA(),e._uU(3),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.hij(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username," ")}}function nt(s,c){if(1&s&&(e.TgZ(0,"p",27)(1,"label"),e.SDv(2,28),e.qZA(),e._uU(3),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.hij(" ",t.user.type," ")}}function it(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"div",6),e.NdJ("mouseleave",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.close())}),e._UZ(1,"div",7),e.TgZ(2,"div",8),e.YNc(3,We,4,1,"p",9),e.TgZ(4,"p")(5,"label"),e.SDv(6,10),e.qZA(),e._uU(7),e.qZA(),e.TgZ(8,"p")(9,"label"),e.SDv(10,11),e.qZA(),e._uU(11),e.qZA(),e.YNc(12,et,4,1,"p",12),e.YNc(13,tt,4,1,"p",13),e.YNc(14,ot,4,1,"p",14),e.YNc(15,st,4,1,"p",15),e.YNc(16,nt,4,1,"p",16),e.qZA()()}if(2&s){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.mac&&!t.hide_fields.includes("mac")),e.xp6(4),e.hij(" ",t.variance,"m"),e.xp6(4),e.hij(" ",t.last_seen,""),e.xp6(1),e.Q6J("ngIf",t.manufacturer&&!t.hide_fields.includes("manufacturer")),e.xp6(1),e.Q6J("ngIf",t.os&&!t.hide_fields.includes("os")),e.xp6(1),e.Q6J("ngIf",t.ssid&&!t.hide_fields.includes("ssid")),e.xp6(1),e.Q6J("ngIf",t.username&&!t.hide_fields.includes("username")),e.xp6(1),e.Q6J("ngIf",t.user&&!t.hide_fields.includes("user"))}}const at=[];let ge=(()=>{class s extends m.cx{get hide_fields(){return this._settings.get("app.explore.hide_device_fields")||at}get last_seen(){return(0,Qe.Z)(1e3*(this._details.last_seen||0),{addSuffix:!0})}get diameter(){return 100*this._details.variance*this.zoom}get distance(){return Math.abs((0,Ke.Z)(1e3*(this._details.last_seen||0),new Date))}get distance_color(){return this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"}constructor(t,o,n){super(),this._details=t,this._settings=o,this._element=n,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance?.toFixed(2),this.bg_color=this._details.bg_color||this.distance_color,this.zoom=1}ngOnInit(t=0){t>10||setTimeout(()=>{const o=this._element.nativeElement.parentElement?.parentElement;if(!o)return this.ngOnInit(++t);const n_y=parseInt(o.style.top,10)/100,n_x=parseInt(o.style.left,10)/100;this.y_pos=n_y>=.5?"bottom":"top",this.x_pos=n_x>=.5?"end":"start",this.subscription("zoom",this._details.zoom$.subscribe(a=>this.zoom=a))},200)}loadUser(){var t=this;return(0,b.Z)(function*(){if(t.username)return;const o=(0,y.rTZ)(t._details.system,"LocationServices");if(!o)return;t.username="Loading...";const n=yield o.execute("check_ownership_of",[t.mac]).catch(a=>null);t.username=n&&n.assigned_to?n.assigned_to:""})()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(me.u),e.Y36(m.gb),e.Y36(e.SBq))},s.\u0275cmp=e.Xpm({type:s,selectors:[["","explore-device-info",""]],features:[e.qOj],attrs:qe,decls:7,vars:9,consts:function(){let c,t,o,n,a,r,i,l;return c=$localize`:␟4e79bc7b2a23c2e4e80d256c8167411cf124bd20␟1921442792032576180:Accuracy:`,t=$localize`:␟1c564bebf178f9c70f2c66a80393137bfa0d2ea8␟5291488112436395082:Last Seen:`,o=$localize`:␟14802d5580219b4522c9c50e1a9f401aee191e1e␟5080596488336446120:MAC:`,n=$localize`:␟a082daef9c0b66268ce56dfa8d96d47a04d2c4b1␟6296767522110275448:Manufacturer:`,a=$localize`:␟5544405b325c518c94412239610d44250d5a223a␟2346706060395913038:OS:`,r=$localize`:␟afd0fc7b37f54299537ba2abc9babf749adf383e␟4345272263810420547:SSID:`,i=$localize`:␟67fc3fe0566f8700b84a908c35497759db78addc␟140822705245800362:Username:`,l=$localize`:␟e78c0d60ac39787f62c9159646fe0b3c1ed55a1d␟2736556170366900089:Type:`,[["name","radius",1,"radius","absolute","center","bg-blue-600","bg-opacity-25","border-8","border-dashed","border-blue-600","rounded-full"],["shadow","",1,"absolute","center","bg-black/40","h-8","w-8","rounded-full"],["name","dot",1,"h-3","w-3","absolute","center","rounded-full","shadow","border-2","border-white"],["dot",""],["customTooltip","",1,"absolute","inset-0","pointer-events-auto",3,"content","backdrop","xPosition","yPosition","hover","mouseenter"],["device_tooltip",""],["name","device-info",1,"w-64","rounded","bg-white","dark:bg-neutral-800","p-4","top-0","left-0","shadow","pointer-events-none","mx-2",3,"mouseleave"],[1,"arrow"],[1,"details"],["class","break-words",4,"ngIf"],c,t,["type","",4,"ngIf"],["os","",4,"ngIf"],["ssid","",4,"ngIf"],["username","",4,"ngIf"],["user","",4,"ngIf"],[1,"break-words"],o,["type",""],n,["os",""],a,["ssid",""],r,["username",""],i,["user",""],l]},template:function(t,o){if(1&t&&(e._UZ(0,"div",0)(1,"div",1)(2,"div",2,3),e.TgZ(4,"div",4),e.NdJ("mouseenter",function(){return o.loadUser()}),e.qZA(),e.YNc(5,it,17,8,"ng-template",null,5,e.W1O)),2&t){const n=e.MAs(6);e.Akn("height: "+o.diameter+"%; width: "+o.diameter+"%;"),e.xp6(2),e.Udp("background-color",o.bg_color),e.xp6(2),e.Q6J("content",n)("backdrop",!1)("xPosition",o.x_pos)("yPosition",o.y_pos)("hover",!0)}},dependencies:[x.O5,He.X],styles:["[_nghost-%COMP%]{pointer-events:auto}[_nghost-%COMP%] > [name=dot][_ngcontent-%COMP%]{background-color:#616161}[_nghost-%COMP%]:hover > [name=radius][_ngcontent-%COMP%]{opacity:1}[name=radius][_ngcontent-%COMP%]{opacity:0;transition:opacity .2s;pointer-events:none}\n/*# sourceMappingURL=explore-device-info.component.ts-angular-inline--69.css.map*/"]}),s})();var H=_(354);let he=(()=>{class s extends m.cx{constructor(t,o,n,a,r){super(),this._state=t,this._org=o,this._settings=n,this._bookings=a,this._dialog=r,this._in_use=new T.X([]),this._options=new T.X({}),this._presence=new T.X([]),this._signs_of_life=new T.X([]),this._statuses={},this._users={},this._departments={},this._checked_in=new T.X([]),this.restrictions=this._org.active_building.pipe((0,$.b)(50),(0,S.w)(()=>(0,y.rlq)(this._org.building.id,"desk_restrictions").pipe((0,U.K)(()=>(0,A.of)({details:[]})))),(0,E.U)(i=>i?.details instanceof Array?i.details:[]),(0,I.d)(1)),this.desk_list=this._state.level.pipe((0,$.b)(50),(0,S.w)(i=>(0,y.rlq)(i.id,"desks").pipe((0,U.K)(()=>(0,A.of)({details:[]})),(0,E.U)(l=>(l?.details instanceof Array?l.details:[]).map(u=>new ze.n({...u,zone:i}))))),(0,U.K)(i=>[]),(0,I.d)(1)),this._bind=this._state.level.pipe((0,$.b)(300),(0,K.h)(i=>!!i),(0,j.b)(i=>{this._statuses={};const l=this._org.binding("area_management");if(!l)return;let u=(0,y.rTZ)(l,"AreaManagement")?.binding(i.id);u&&(this.subscription("lvl-in_use",u.listen().subscribe(p=>this.processBindingChange(p||{},l))),this.subscription("lvl-in_use_bind",u.bind()))})),this._booking_list=(0,L.aj)([this._options,this._state.level]).pipe((0,K.h)(([i,l])=>(i.use_api||i.date>(0,N.Z)(Date.now()).valueOf())&&!!l),(0,S.w)(([i,l])=>(0,H.F2)({type:"desk",period_start:(0,k.Z)((0,G.Z)(i.date||Date.now())),period_end:(0,k.Z)((0,N.Z)(i.date||Date.now())),zones:l.id})),(0,$.b)(200),(0,j.b)(i=>{this._in_use.next(i.map(l=>l.asset_id)),this._checked_in.next(i.filter(l=>l.checked_in).map(l=>l.asset_id))}),(0,I.d)(1)),this._state_change=(0,L.aj)([this.desk_list,this._in_use,this._presence,this._checked_in,this._signs_of_life,this.restrictions,this._options]).pipe((0,$.b)(50),(0,E.U)(([i,l,u,p,d,h])=>{this._statuses={};for(const{id:v,bookable:g}of i){const M=l.some(C=>v===C),R=u.some(C=>v===C),Z=d.some(C=>v===C),X=p.some(C=>v===C)||M&&this._settings.get("app.desk.auto_checkin"),F=h.filter(C=>C.items?.includes(v)||C.assets?.includes(v)).find(({start:C,end:q})=>Date.now()>=C&&Date.now()<q);this._statuses[v]=g&&!F?M||R||X?R||X?"busy":"pending":Z?"signs-of-life":"free":"not-bookable"}this.processDesks(i)})),this.init()}init(){var t=this;return(0,b.Z)(function*(){yield t._org.initialised.pipe((0,J.P)(o=>o)).toPromise(),t.setOptions({enable_booking:!1!==t._settings.get("app.desks.enable_maps")}),t.subscription("bookings",t._booking_list.subscribe()),t.subscription("bind",t._bind.subscribe()),t.subscription("restrictions",t.restrictions.subscribe()),t.subscription("changes",t._state_change.subscribe()),t.subscription("desks",t.desk_list.subscribe(o=>t.processDesks(o)))})()}setOptions(t){this._options.next({...this._options.getValue(),...t})}processBindingChange({value:t},o){const n=(t||[]).filter(l=>!["desk","booking"].includes(l.location)),a=(t||[]).filter(l=>"desk"===l.location||"booking"===l.location&&"desk"===l.type);(this._options.getValue().date||Date.now())<=(0,N.Z)(Date.now()).valueOf()&&!this._options.getValue().use_api&&(this._in_use.next(a.filter(l=>"booking"===l.location).map(l=>l.map_id||l.asset_id)),this._checked_in.next(a.filter(l=>"booking"===l.location&&l.checked_in).map(l=>l.map_id||l.asset_id)),this._presence.next(a.filter(l=>l.at_location).map(l=>l.map_id||l.asset_id)),this._signs_of_life.next(a.filter(l=>l.signs_of_life).map(l=>l.map_id||l.asset_id)));const i=this._settings.get("app.department_map")||{};for(const l of a)this._users[l.map_id||l.asset_id]=l.staff_name,this._departments[l.map_id||l.asset_id]=i[l.department]||"";this.processDevices(n,o),this.timeout("update",()=>this.updateStatus(),100)}updateStatus(){const t={},o=this._settings.get("app.explore.colors")||{};for(const n in this._statuses)this._statuses[n]&&(t[`#${n}`]={fill:o[`desk-${this._statuses[n]}`]||o[`${this._statuses[n]}`]||D.y[`${this._statuses[n]}`]});this._state.setStyles("desks",t)}processDevices(t,o){const n=[];for(const a of t){const r=a.x/a.map_width,i=a.y/a.map_height;n.push({track_id:`device:hover:${r},${i}`,location:{x:a.coordinates_from?.includes("right")?1-r:r,y:a.coordinates_from?.includes("bottom")?1-i:i},content:ge,z_index:20,data:{...a,system:o}})}this._state.setFeatures("devices",n)}processDesks(t){var o=this;const n=[],a=[],r=this._options.getValue();for(const i of t){if(n.push({track_id:`desk:hover:${i.map_id||i.id}`,location:i.id,content:ue.c,full_size:!0,no_scale:!0,data:{id:i.map_id||i.id,map_id:i.name,name:i.name||i.map_id,user:this._users[i.map_id]||i.staff_name,status:this._statuses[i.map_id],department:this._departments[i.map_id]||""},z_index:20}),!i.bookable)continue;const l=function(){var u=(0,b.Z)(function*(){if("free"!==o._statuses[i.id])return(0,m.cB)(`${i.name||"Desk"} is unavailable at this time.`);if(i.groups?.length&&!i.groups.find(g=>(0,m.ar)().groups.includes(g)))return(0,m.cB)(`You are not allowed to book ${i.name}.`);o._bookings.newForm(),o._bookings.setOptions({type:"desk"}),r.date&&(o._bookings.form.patchValue({date:r.date}),o._bookings.form.patchValue({all_day:!!r.all_day}));let{date:p,duration:d,user:h}=yield o._setBookingTime(o._bookings.form.value.date,o._bookings.form.value.duration,o._options.getValue()?.custom??!1,i);h=h||r.host||(0,m.ar)();const v=h?.email;o._bookings.form.patchValue({resources:[i],asset_id:i.id,asset_name:i.name,date:p,duration:r.all_day?720:d,map_id:i?.map_id||i?.id,description:i.name,user:h,user_email:v,booking_type:"desk",zones:i.zone?[i.zone?.parent_id,i.zone?.id]:[]}),yield o._bookings.confirmPost().catch(g=>{throw console.log(g),(0,m.cB)(`Failed to book desk ${i.name||i.id}. ${g.message||g.error||g}`),g}),o._users[i.map_id]=(r.host||(0,m.ar)())?.name,(0,m.t5)(`Successfully booked desk ${i.name||i.id}`)});return function(){return u.apply(this,arguments)}}();a.push({id:i.id,action:"click",priority:10,callback:l}),a.push({id:i.id,action:"touchend",priority:10,callback:l})}this._state.setActions("desks",this._options.getValue().enable_booking?a:[]),this._state.setFeatures("desks",n),this.timeout("update",()=>this.updateStatus(),100)}_setBookingTime(t,o,n=!1,a=null){var r=this;return(0,b.Z)(function*(){let i=null;if(r._settings.get("app.desks.allow_time_changes")){const l=(0,N.Z)((0,Q.Z)(Date.now(),r._settings.get("app.desks.available_period")||90)),p=yield r._dialog.open(te,{data:{date:t,duration:o,until:l,host:n,resource:a}}).afterClosed().toPromise();if(!p)throw"User cancelled";t=p.date,o=p.duration,i=p.user}return{date:t,duration:o,user:i}})()}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(P.c),e.LFG(z.w),e.LFG(m.gb),e.LFG(de.f),e.LFG(V.uw))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac}),s})();var rt=_(5845),lt=_(4350);let fe=(()=>{class s extends m.cx{constructor(t,o,n,a,r){super(),this._org=t,this._state=o,this._settings=n,this._bookings=a,this._dialog=r,this._options=new T.X({date:(0,G.Z)(Date.now()).valueOf()}),this._poll=new T.X(0),this.options=this._options.asObservable(),this.levels=this._org.active_levels.pipe((0,E.U)(i=>i.filter(l=>l.tags.includes("parking")))),this.events=(0,L.aj)([this._org.active_building,this._options,this._poll]).pipe((0,S.w)(([i,l])=>(0,H.F2)({period_start:(0,k.Z)((0,G.Z)(l.date)),period_end:(0,k.Z)((0,N.Z)(l.date)),type:"parking",zones:i?.id})),(0,I.d)(1)),this.existing_event=(0,L.aj)([this._options]).pipe((0,S.w)(([i])=>(0,H.F2)({period_start:(0,k.Z)((0,G.Z)(i.date)),period_end:(0,k.Z)((0,N.Z)(i.date)),type:"parking",email:i?.user||(0,m.ar)()?.email})),(0,I.d)(1)),this.week_events=(0,L.aj)([this._org.active_building,this._options]).pipe((0,S.w)(([i,l])=>(0,H.F2)({period_start:(0,k.Z)((0,G.Z)(l.date)),period_end:(0,k.Z)((0,Q.Z)((0,N.Z)(l.date),6)),type:"parking",zones:i?.id})),(0,I.d)(1)),this.spaces=this.levels.pipe((0,S.w)(i=>(0,lt.D)(i.map(l=>(0,y.rlq)(l.id,"parking-spaces").pipe((0,E.U)(u=>u.details.map(p=>({...p,zone_id:l.id}))))))),(0,E.U)(i=>(0,m.xH)(i)),(0,I.d)(1)),this.available_spaces=(0,L.aj)([this.events,this.spaces,this._state.level]).pipe((0,E.U)(([i,l,u])=>l.filter(p=>p.zone_id===u?.id&&!i.find(d=>d.asset_id===p.id)))),this.week_availablility=(0,L.aj)([this.week_events,this.spaces,this._options]).pipe((0,E.U)(([i,l,{date:u}])=>{const p={};for(let d=0;d<7;d++){const h=(0,Q.Z)(u,d),v=i.filter(g=>(0,rt.Z)(h,g.date));p[h.valueOf()]=l.filter(g=>!v.find(M=>M.asset_id===g.id)).length}return p})),this.subscription("spaces",(0,L.aj)([this.spaces,this.available_spaces]).subscribe(([i,l])=>this._updateParkingSpaces(i,l))),this.setOptions({enable_booking:!1!==this._settings.get("app.parking.enable_maps")}),this.interval("poll",()=>this._poll.next(Date.now()),1e4)}setOptions(t){this._options.next({...this._options.getValue(),...t})}_updateParkingSpaces(t,o){var n=this;const a={},r=[],i=[],l=this._settings.get("app.explore.colors")||{},u=this._options.getValue();for(const p of t){const d=!!o.find(g=>g.id===p.id),h=d?"free":"busy";if(a[`#${p.map_id}`]={fill:l[`parking-${h}`]||l[`${h}`]||D.y[`${h}`],opacity:.6},!d)continue;r.push({zoom_level:2,location:`${p.map_id}`,content:`${p.name}\nFree`});const v=function(){var g=(0,b.Z)(function*(){if("free"!==h)return(0,m.cB)(`${p.name||"Parking Space"} is unavailable at this time.`);if(p.groups?.length&&!p.groups.find(O=>(0,m.ar)().groups.includes(O)))return(0,m.cB)(`You are not allowed to book ${p.name}.`);n._bookings.newForm(),n._bookings.setOptions({type:"parking"}),u.date&&(n._bookings.form.patchValue({date:u.date}),n._bookings.form.patchValue({all_day:!!u.all_day}));let{date:M,duration:R,user:Z}=yield n._setBookingTime(n._bookings.form.value.date,n._bookings.form.value.duration,n._options.getValue()?.custom??!1,p);Z=Z||u.host||(0,m.ar)();const X=Z?.email;n._bookings.form.patchValue({resources:[p],asset_id:p.id,asset_name:p.name,date:M,duration:u.all_day?720:R,map_id:p?.map_id||p?.id,description:p.name,user:Z,user_email:X,booking_type:"parking",zones:p.zone?[p.zone?.parent_id,p.zone?.id]:[]}),yield n._bookings.confirmPost().catch(O=>{throw console.log(O),(0,m.cB)(`Failed to book parking space ${p.name||p.id}. ${O.message||O.error||O}`),O}),(0,m.t5)(`Successfully booked parking space ${p.name||p.id}`)});return function(){return g.apply(this,arguments)}}();i.push({id:p.id,action:"click",priority:10,callback:v})}this._state.setActions("parking",u.enable_booking?i:[]),this._state.setStyles("parking",a),this._state.setLabels("parking",r)}_setBookingTime(t,o,n=!1,a=null){var r=this;return(0,b.Z)(function*(){let i=null;if(r._settings.get("app.parking.allow_time_changes")){const l=(0,N.Z)((0,Q.Z)(Date.now(),r._settings.get("app.parking.available_period")||90)),p=yield r._dialog.open(te,{data:{date:t,duration:o,until:l,host:n,resource:a}}).afterClosed().toPromise();if(!p)throw"User cancelled";t=p.date,o=p.duration,i=p.user}return{date:t,duration:o,user:i}})()}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(z.w),e.LFG(P.c),e.LFG(m.gb),e.LFG(de.f),e.LFG(V.uw))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac}),s})();var ct=_(7121),oe=_(5912),ve=_(437);let xe=(()=>{class s extends m.cx{constructor(t,o,n,a){super(),this._lockers=t,this._explore=o,this._org=n,this._settings=a,this._status=new T.X([]),this.lockers$=this._lockers.filtered_lockers$,this.status=(0,L.aj)([this._org.active_building,this._explore.level]).pipe((0,E.U)(([r,i])=>{if(!i)return[];const l=this._org.binding("area_management");if(!l)return(0,A.of)({});let u=(0,y.rTZ)(l,"AreaManagement").binding(i.id);this.subscription("lvl-in_use",u.listen().subscribe(p=>this._status.next(p?.value?.filter(d=>"locker"===d.location)||[]))),this.subscription("lvl-in_use_bind",u.bind())})),this.locker_status=(0,L.aj)([this._explore.level,this._lockers.lockers_banks$,this.lockers$,this._status]).pipe((0,E.U)(([r,i,l,u])=>{if(!r)return[];const p=[],d={},h=this._settings.get("app.explore.colors")||{},v=(0,m.Tw)(i.filter(g=>g.level_id===r.id).map(g=>g.id));for(const g of v){const M=l.filter(F=>F.bank_id===g);let R=0;for(const F of M)R+=u.find(q=>q.locker_id===F.id&&q.allocated)?1:0;const Z=i.find(F=>F.id===g);p.push({location:Z.map_id,content:ve.D,full_size:!0,no_scale:!0,z_index:20,data:{bank:Z,lockers:l,in_use_count:R,locker_count:M.length,system:this._org.binding("area_management")}});const X=R/M.length,O=X>.8?"busy":X>.3?"pending":"free";d[`#${Z.map_id}`]={fill:h[`lockers-${O}`]||h[`${O}`]||D.y[`${O}`]}}this._explore.setStyles("lockers",d),this._explore.setFeatures("lockers",p)})),this.subscription("level",this._explore.level.pipe((0,K.h)(r=>!!r)).subscribe(r=>this._lockers.setLevel(r.id))),this.subscription("status",this.status.subscribe()),this.subscription("locker_status",this.locker_status.subscribe())}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(ct.A),e.LFG(P.c),e.LFG(oe.w7),e.LFG(m.gb))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var _t=_(2423);let Ee=(()=>{class s{constructor(t){this._state=t,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(P.c))},s.\u0275cmp=e.Xpm({type:s,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:function(){let c,t,o;return c=$localize`:␟34fb6028a6630cf3a7308084b31e86e89d057965␟1470758907984185227:Zoom In`,t=$localize`:␟677ce9c57b5558cb10f0b39327d5a965bfb21dc5␟1356460275822781324:Zoom Out`,o=$localize`:␟77981432124895c410e5b9157b3deb948831ffc6␟5016012668378976433:Reset Zoom & Center`,[["z-in","","icon","","matRipple","","matTooltip",c,1,"bg-white","dark:bg-neutral-800",3,"click"],["z-out","","icon","","matRipple","","matTooltip",t,1,"bg-white","dark:bg-neutral-800",3,"click"],["reset","","icon","","matRipple","","matTooltip",o,1,"bg-white","dark:bg-neutral-800",3,"click"]]},template:function(t,o){1&t&&(e.TgZ(0,"button",0),e.NdJ("click",function(){return o.zoomIn()}),e.TgZ(1,"app-icon"),e._uU(2,"add"),e.qZA()(),e.TgZ(3,"button",1),e.NdJ("click",function(){return o.zoomOut()}),e.TgZ(4,"app-icon"),e._uU(5,"remove"),e.qZA()(),e.TgZ(6,"button",2),e.NdJ("click",function(){return o.reset()}),e.TgZ(7,"app-icon"),e._uU(8,"autorenew"),e.qZA()())},dependencies:[Y.o,B.wG,_t.gM],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}button[_ngcontent-%COMP%]{border:1px solid #9998;border-radius:0}button[_ngcontent-%COMP%]:first-child{border-radius:.25rem .25rem 0 0;border-bottom:none}button[_ngcontent-%COMP%]:last-child{border-radius:0 0 .25rem .25rem;border-top:none}\n/*# sourceMappingURL=explore-zoom-control.component.ts-angular-inline--72.css.map*/"]}),s})();function pt(s,c){if(1&s){const t=e.EpF();e.TgZ(0,"div",5)(1,"mat-slide-toggle",6),e.NdJ("ngModelChange",function(n){e.CHM(t);const a=e.oxw();return e.KtG(a.toggleZones(n))}),e.ALo(2,"async"),e.qZA(),e.TgZ(3,"label",7),e.SDv(4,8),e.qZA()()}if(2&s){const t=e.oxw();let o;e.xp6(1),e.Q6J("ngModel",!(null!=(o=e.lcZ(2,1,t.options))&&null!=o.disable&&o.disable.includes("zones")))}}function dt(s,c){if(1&s&&(e.TgZ(0,"div",5),e._UZ(1,"div",13),e.TgZ(2,"div",14),e._uU(3),e.qZA()()),2&s){const t=c.$implicit;e.xp6(1),e.Udp("background-color",t[1]),e.xp6(2),e.Oqu(t[0])}}function ut(s,c){if(1&s&&(e.TgZ(0,"div",9)(1,"h3",10),e.SDv(2,11),e.qZA(),e.YNc(3,dt,4,3,"div",12),e.qZA()),2&s){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.legend)}}const mt=[];let be=(()=>{class s extends m.cx{toggleZones(t){var o=this;return(0,b.Z)(function*(){const n=yield o.options.pipe((0,Ne.q)(1)).toPromise(),a=t?n.disable?.filter(r=>"zones"!==r&&"devices"!==r)||[]:(0,m.Tw)([...n.disable||[],"zones","devices"]);o.setOptions({disable:a})})()}get show_legend(){return!!this._settings.get("app.explore.show_legend")}get hide_zones(){return!!this._settings.get("app.explore.hide_zones")}get legend(){return this._settings.get("app.explore.legend")||mt}constructor(t,o,n,a,r,i,l,u,p,d,h,v){super(),this._state=t,this._s=o,this._desks=n,this._zones=a,this._parking=r,this._lockers=i,this._route=l,this._router=u,this._spaces=p,this._org=d,this._settings=h,this._space_pipe=v,this.url=this._state.map_url,this.styles=this._state.map_styles,this.positions=this._state.map_positions,this.features=this._state.map_features,this.actions=this._state.map_actions,this.labels=this._state.map_labels,this.options=this._state.options,this.message=this._state.message,this.setOptions=g=>this._state.setOptions(g)}ngOnInit(){var t=this;return(0,b.Z)(function*(){t._state.reset(),yield t._spaces.initialised.pipe((0,J.P)(o=>o)).toPromise(),t.toggleZones(!1),t.subscription("route.query",t._route.queryParamMap.subscribe(function(){var o=(0,b.Z)(function*(n){if((n.has("level")||n.has("zone"))&&t._state.setLevel(n.get("level")||n.get("zone")),t._state.setFeatures("_located",[]),n.has("space"))t.locateSpace(n.get("space"));else if(n.has("user")){let a=t._settings.value("last_search");if((!a||n.get("user")!==a.email)&&(a=null,a=yield(0,re.w0)(n.get("user")).toPromise()),!a)return(0,m.cB)(`Unable to user details for ${n.get("user")}`);t.locateUser(a instanceof Array?a[0]:a).catch(r=>{(0,m.cB)(`Unable to locate ${n.get("user")}`),t._router.navigate([],{relativeTo:t._route,queryParams:{}})})}else n.has("locate")?t._locateFeature(n.get("locate"),n.get("name")):t.timeout("update_location",()=>{t._state.setFeatures("_located",[])})});return function(n){return o.apply(this,arguments)}}()))})()}updateZoom(t){this._state.setPositions(t,this._state.positions.center)}updateCenter(t){this._state.setPositions(this._state.positions.zoom,t)}_locateFeature(t,o=""){const n=t.includes(","),a=t.split(","),r={track_id:`locate-${t}`,location:n?{x:parseFloat(a[0]),y:parseFloat(a[1])}:t,content:ee.q,z_index:99,data:{message:o}};this.timeout("update_location",()=>this._state.setFeatures("_located",[r]))}locateSpace(t){var o=this;return(0,b.Z)(function*(){const n=yield o._space_pipe.transform(t);if(!n)return(0,m.cB)("Unable to load space details.");o._state.setLevel(o._org.levelWithID(n.zones)?.id);const a={track_id:`locate-${n.id}`,location:n.map_id,content:ee.q,z_index:99,data:{message:`${n.display_name||n.name} is here`}};o.timeout("update_location",()=>o._state.setFeatures("_located",[a]))})()}locateUser(t){var o=this;return(0,b.Z)(function*(){let n=o._org.binding("location_services");if(!n)throw"Location services is not setup for this application.";"string"==typeof n&&(n={system_id:n,module:"LocationServices",priority:[]});const r=(yield(0,y.rTZ)(n.system_id,n.module).execute("locate_user",[t.email,t.username||t.id])).map(p=>new re.Y(p));if(r.sort((p,d)=>n.priority.indexOf(p.type)-n.priority.indexOf(d.type)),!r?.length)throw"No locations for the given user";o._state.setLevel(o._org.levelWithID([r[0]?.level])?.id);const i=r[0].position,{coordinates_from:l}=r[0],u={track_id:`locate-${t.id}`,location:"wireless"===r[0].type?{x:l?.includes("right")?1-i.x:i.x,y:l?.includes("bottom")?1-i.y:i.y}:i,content:"wireless"===r[0].type?Re.n:ee.q,z_index:99,data:{message:`${t.name} is here`,radius:r[0].variance,last_seen:r[0].last_seen}};o.timeout("update_location",()=>{o._state.setFeatures("_located",[u])})})()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(P.c),e.Y36(D.a),e.Y36(he),e.Y36(_e),e.Y36(fe),e.Y36(xe),e.Y36(w.gz),e.Y36(w.F0),e.Y36(ke.s),e.Y36(z.w),e.Y36(m.gb),e.Y36(le.X))},s.\u0275cmp=e.Xpm({type:s,selectors:[["explore-map-view"]],features:[e._Bn([he,D.a,_e,fe,xe,le.X]),e.qOj],decls:13,vars:23,consts:function(){let c,t;return c=$localize`:␟dab9a30ea9f109a7395ec84fe144c4f70d50c32d␟4377629928032707348:Zones`,t=$localize`:␟5c5419db944ed6a96f9515a2ac0ee390ec8cf3b5␟7297822327994766046:Legend`,[[3,"src","zoom","center","styles","features","actions","labels","zoomChange","centerChange"],[1,"absolute","bottom-2","right-2"],["controls","",1,"absolute","top-2","left-2","max-w-[calc(100vw-1rem)]","bg-white","dark:bg-neutral-800","border","border-gray-200","dark:border-neutral-500","rounded","p-2","space-y-2","overflow-hidden"],["class","flex items-center space-x-2",4,"ngIf"],["legend","","class","absolute bottom-2 left-2 p-2 rounded bg-white dark:bg-neutral-800 border border-gray-300",4,"ngIf"],[1,"flex","items-center","space-x-2"],["name","zones",1,"ml-2",3,"ngModel","ngModelChange"],["for","zones",1,"mb-0"],c,["legend","",1,"absolute","bottom-2","left-2","p-2","rounded","bg-white","dark:bg-neutral-800","border","border-gray-300"],[1,"mb-2","font-medium"],t,["class","flex items-center space-x-2",4,"ngFor","ngForOf"],[1,"w-3","h-3","rounded-full","border","border-gray-400"],[1,"text-sm"]]},template:function(t,o){if(1&t&&(e.TgZ(0,"i-map",0),e.NdJ("zoomChange",function(a){return o.updateZoom(a)})("centerChange",function(a){return o.updateCenter(a)}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async"),e.qZA(),e._UZ(8,"explore-zoom-controls",1),e.TgZ(9,"div",2),e._UZ(10,"explore-map-controls"),e.YNc(11,pt,5,3,"div",3),e.qZA(),e.YNc(12,ut,4,1,"div",4)),2&t){let n,a;e.Q6J("src",e.lcZ(1,9,o.url))("zoom",null==(n=e.lcZ(2,11,o.positions))?null:n.zoom)("center",null==(a=e.lcZ(3,13,o.positions))?null:a.center)("styles",e.lcZ(4,15,o.styles))("features",e.lcZ(5,17,o.features))("actions",e.lcZ(6,19,o.actions))("labels",e.lcZ(7,21,o.labels)),e.xp6(11),e.Q6J("ngIf",o.hide_zones),e.xp6(1),e.Q6J("ngIf",o.show_legend&&o.legend.length)}},dependencies:[x.sg,x.O5,me.p,ie.Rr,f.JJ,f.On,ae,Ee,x.Ov],styles:["[_nghost-%COMP%]{height:100%;width:100%}[zones][_ngcontent-%COMP%]{top:3.5rem}\n/*# sourceMappingURL=explore-map-view.component.ts-angular-inline--70.css.map*/"]}),s})();_(656),_(9012),_(4618),_(2556),_(5312),_(9275),_(1718),_(7801),_(3905);let It=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[x.ez,W.Kk,f.u5,f.UX,ie.rP,ye.U8,Oe.eL,Te.W,Le.E]}),s})();var wt=_(2886),Pt=_(3925);function Nt(s,c){if(1&s&&(e.TgZ(0,"div",9),e._uU(1),e.qZA()),2&s){const t=c.$implicit;e.Udp("background-color",t.colour),e.ekj("dark",t.dark),e.xp6(1),e.hij(" ",t.name," ")}}function kt(s,c){if(1&s&&(e.TgZ(0,"div",10),e._UZ(1,"app-icon",11),e.TgZ(2,"div",12),e._uU(3),e.qZA()()),2&s){const t=c.$implicit;e.xp6(1),e.Q6J("icon",t.icon),e.xp6(2),e.hij(" ",t.name," ")}}let Rt=(()=>{class s{constructor(){this.colours=[{id:"in-use",name:"In Use",colour:"#C52A1A",dark:!0},{id:"available",name:"Available",colour:"#22992E",dark:!0},{id:"not-bookable",name:"Not Bookable",colour:"#7D7D7D",dark:!0},{id:"collab",name:"Collaborative",colour:"#FED769"},{id:"focus",name:"Focus",colour:"#F5A478"}],this.icon_list=[{id:"",name:"Lifts Up/Down",icon:{type:"img",src:"assets/img/lift.svg"}},{id:"",name:"Fire Extinguisher",icon:{type:"img",src:"assets/img/fireExt.svg"}},{id:"",name:"First Aid & AED",icon:{type:"img",src:"assets/img/aid.svg"}},{id:"",name:"Cafe/Service",icon:{type:"img",src:"assets/img/Cafe.svg"}},{id:"",name:"Mail/Noticeboard",icon:{type:"img",src:"assets/img/mail.svg"}},{id:"",name:"Restrooms M/F",icon:{type:"img",src:"assets/img/Restrooms.svg"}},{id:"",name:"Map Kiosk",icon:{type:"img",src:"assets/img/kiosk.svg"}},{id:"",name:"Screen",icon:{type:"img",src:"assets/img/Screen.svg"}},{id:"",name:"Projector",icon:{type:"img",src:"assets/img/Projector.svg"}},{id:"",name:"Showers",icon:{type:"img",src:"assets/img/shower.svg"}},{id:"",name:"Chairs",icon:{type:"img",src:"assets/img/chair.svg"}},{id:"",name:"Chairs",icon:{type:"img",src:"assets/img/chair2.svg"}},{id:"",name:"Chairs/Couch",icon:{type:"img",src:"assets/img/couch.svg"}},{id:"",name:"Chairs/Couch",icon:{type:"img",src:"assets/img/couch2.svg"}},{id:"",name:"Tables",icon:{type:"img",src:"assets/img/Table1.svg"}},{id:"",name:"Tables",icon:{type:"img",src:"assets/img/Table2.svg"}},{id:"",name:"Tables",icon:{type:"img",src:"assets/img/Table3.svg"}},{id:"",name:"Tables",icon:{type:"img",src:"assets/img/Table4.svg"}},{id:"",name:"Tables",icon:{type:"img",src:"assets/img/Table5.svg"}},{id:"",name:"Tables",icon:{type:"img",src:"assets/img/Table6.svg"}},{id:"",name:"Tables",icon:{type:"img",src:"assets/img/Table7.svg"}},{id:"",name:"Funzone Games",icon:{type:"img",src:"assets/img/Tennis.svg"}},{id:"",name:"Concierge Pods",icon:{type:"img",src:"assets/img/Pod.svg"}},{id:"",name:"Phone Booths",icon:{type:"img",src:"assets/img/booth.svg"}}]}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["a-footer-legend"]],decls:12,vars:4,consts:[[1,"relative","bg-white","shadow","w-full"],[1,"absolute","top-0","left-1/2","transform","-translate-y-full","-translate-x-1/2","px-2","pt-2","overflow-hidden"],["matRipple","",1,"flex","items-center","justify-center","bg-white","shadow","rounded-t","w-32","h-8","border-none","text-black",3,"click"],[1,"flex","items-center","px-2","py-1","text-xl"],[1,"flex-1"],[1,"flex","items-center","justify-center","p-2","border","border-gray-100","space-x-2"],["class","colour px-4 py-2 rounded shadow flex-1 text-center",3,"dark","background-color",4,"ngFor","ngForOf"],["icon-legend","",1,"flex","justify-center","flex-wrap","h-0","w-full","border","border-gray-100","overflow-auto","max-h-[25vh]"],["class","flex flex-col items-center justify-center h-[12.4vw] w-[12.4vw] text-[2vw] border border-gray-100 flex-grow",4,"ngFor","ngForOf"],[1,"colour","px-4","py-2","rounded","shadow","flex-1","text-center"],[1,"flex","flex-col","items-center","justify-center","h-[12.4vw]","w-[12.4vw]","text-[2vw]","border","border-gray-100","flex-grow"],[1,"text-[3em]",3,"icon"],[1,"text-[0.625em]","font-normal"]],template:function(t,o){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"button",2),e.NdJ("click",function(){return o.show=!o.show}),e.TgZ(3,"app-icon"),e._uU(4,"keyboard_arrow_up"),e.qZA()()(),e.TgZ(5,"div",3)(6,"div",4),e._uU(7,"Keys"),e.qZA()(),e.TgZ(8,"div",5),e.YNc(9,Nt,2,5,"div",6),e.qZA(),e.TgZ(10,"div",7),e.YNc(11,kt,4,2,"div",8),e.qZA()()),2&t&&(e.xp6(9),e.Q6J("ngForOf",o.colours),e.xp6(1),e.ekj("show",o.show),e.xp6(1),e.Q6J("ngForOf",o.icon_list))},dependencies:[x.sg,Y.o,B.wG],styles:["[_nghost-%COMP%]{width:100%;z-index:10;font-size:1.25em}.colour.dark[_ngcontent-%COMP%]{color:#fff}[icon-legend][_ngcontent-%COMP%]{transition:height .2s}[icon-legend].show[_ngcontent-%COMP%]{height:37.5vw!important}\n/*# sourceMappingURL=footer-legend.component.ts-angular-inline--74.css.map*/"]}),s})(),Ce=(()=>{class s extends m.cx{constructor(t,o,n,a,r){super(),this._org=t,this._settings=o,this._state=n,this._router=a,this._dialog=r,this.reset_delay=180,this.onMouse=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay),this.onTouch=()=>this.timeout("reset",()=>this.resetKiosk(),1e3*this.reset_delay)}ngOnInit(){this._settings.title="Explore",this.reset_delay=this._settings.get("app.inactivity_timeout_secs")||180;const t=localStorage?.getItem("KIOSK.level");t?(this._state.setLevel(t),this.onMouse()):this._router.navigate(["/bootstrap"])}get emergency_phone(){const t=localStorage.getItem("KIOSK.level"),o=this._org.levelWithID([t]);if(!o)return;const n=this._org.buildings.find(a=>a.id===o.parent_id);return n?n.phone_numbers.emergency||"":void 0}resetKiosk(){(0,m.cM)("EXPLORE","Refreshing kiosk..."),document.activeElement?.blur&&document.activeElement?.blur();const t=localStorage.getItem("KIOSK.level");this._state.setPositions(1,{x:.5,y:.5}),t&&this._state.setLevel(t),this._dialog.closeAll(),this._settings.post("KIOSK.reset",Date.now())}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(oe.w7),e.Y36(m.gb),e.Y36(P.c),e.Y36(w.F0),e.Y36(V.uw))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-explore"]],hostBindings:function(t,o){1&t&&e.NdJ("mousedown",function(){return o.onMouse()},!1,e.Jf7)("touchstart",function(){return o.onTouch()},!1,e.Jf7)},features:[e.qOj],decls:6,vars:0,consts:[[1,"flex","flex-1","w-full","relative"],[1,"flex","w-full"]],template:function(t,o){1&t&&(e.TgZ(0,"header"),e._UZ(1,"a-topbar-header"),e.qZA(),e.TgZ(2,"main",0),e._UZ(3,"explore-map-view"),e.qZA(),e.TgZ(4,"footer",1),e._UZ(5,"a-footer-legend"),e.qZA())},dependencies:[Pt.B,be,Rt],styles:["[_nghost-%COMP%]{position:absolute;inset:0;overflow:hidden;display:flex;flex-direction:column;background:#eee}\n/*# sourceMappingURL=explore.component.ts-angular-inline--73.css.map*/"]}),s})();var At=_(2487);const $t=[{path:"",component:Ce},{path:":search_type",component:Ce}];let Xt=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[x.ez,w.Bz.forChild($t),W.Kk,wt.YR,At.q,f.u5,It]}),s})()}}]);
//# sourceMappingURL=apps_visitor-kiosk_src_app_explore_explore_module_ts.js.map