"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["common"],{20631:(L,R,t)=>{t.d(R,{v:()=>j});var E=t(89204),p=t(3998),D=t(90521),h=t(71536),M=t(33119),P=t(42175),O=t(19803),A=t(71963),d=t(35443),u=t(29314),v=t(7841),x=t(66e3),C=t(6109),W=t(22508),T=t(67450),U=t(27419),K=t(13264),k=t(83866),c=t(57915),r=t(82333),m=t(12185),f=(t(83259),t(68559)),I=t(12587);let j=(()=>{class a extends r.Tv{get new_desk_count(){return this._new_desks.getValue()?.length||0}nextPage(){this._call_next_page.next(`NEXT_${Date.now()}`)}constructor(e,o,_){super(),this._org=e,this._dialog=o,this._settings=_,this._filters=new D.t({}),this._new_desks=new D.t([]),this._desk_bookings=[],this._loading=new D.t(!1),this.new_desks=this._new_desks.asObservable(),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,O.B)(500),(0,A.n)(s=>{const i=s.zones||[];return i&&!i.includes("All")?(0,p.bpY)(i[0],"desks").pipe((0,d.T)(n=>n.details instanceof Array?n.details:[]),(0,u.W)(n=>(0,h.of)([]))):(0,p.WsZ)(this._org.building?.id,{name:"desks"}).pipe((0,d.T)(n=>n.map(g=>g.metadata?.desks?.details||[]).reduce((g,l)=>[...g,...l],[])),(0,u.W)(n=>(0,h.of)([])))}),(0,d.T)(s=>(s instanceof Array||(s=[]),s.sort((i,n)=>i.name?.localeCompare(n.name)),s.map(i=>new m.gB({...i,qr_code:""})))),(0,v.t)(1)),this._next_page=new M.B7,this._call_next_page=new M.B7,this._all_zones_keys=["All",-1,"-1"],this.setup_paging=(0,P.zV)([this._filters,this._org.initialised]).pipe((0,O.B)(500),(0,x.M)(([s,i])=>{if(!i)return;const n=s.date||Date.now(),g=!s.zones||s.zones.some(l=>this._all_zones_keys.includes(l))?this._settings.get("app.use_region")?this._org.buildingsForRegion().map(l=>l.id):[this._org.building.id]:s.zones;this._next_page.next(()=>(0,c.WE)({period_start:(0,T.A)((0,U.A)(n)),period_end:(0,T.A)((0,K.A)(n)),type:"desk",zones:g.join(","),include_checked_out:!0}).pipe((0,u.W)(l=>(0,h.of)({data:[],total:0,next:null})))),this._call_next_page.next(`RESET_${Date.now()}`)})),this.paged_bookings=(0,P.zV)([this._next_page,this._call_next_page]).pipe((0,C.F)((s,i)=>s[1]===i[1]),(0,A.n)(([s,i])=>(this._loading.next(!0),s?i.includes("RESET")?s().pipe((0,d.T)(n=>({...n,reset:!0})),(0,u.W)(n=>(0,h.of)({data:[],total:0,next:null}))):s().pipe((0,d.T)(n=>({...n,reset:!1})),(0,u.W)(n=>(0,h.of)({data:[],total:0,next:null}))):(0,h.of)({data:[],total:0,next:null,reset:i.includes("RESET")}))),(0,W.S)((s,{data:i,total:n,next:g,reset:l})=>{const B=i;return this._next_page.next(g),l?{list:B,total:n}:{list:[...s.list,...B],total:n}},{list:[],total:0}),(0,x.M)(s=>this._loading.next(!1)),(0,v.t)(1)),this.has_more_pages=this.paged_bookings.pipe((0,d.T)(s=>s.list.length<s.total)),this.bookings=this.paged_bookings.pipe((0,d.T)(s=>s.list)),this.setup_paging.subscribe()}setFilters(e){e.zones?.includes("All")?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(o=>o.id)]:e.zones&&this._filters.getValue()?.zones?.includes("All")&&(e.zones=[]),this._filters.next({...this._filters.getValue(),...e})}refresh(){this._loading.next(!0),this.timeout("poll",()=>this.setFilters(this._filters.getValue()))}addDesks(e){this._new_desks.next(this._new_desks.getValue().concat(e))}removeNewDesk(e){this._filters.next(this._filters.getValue()),this._new_desks.next(this._new_desks.getValue().filter(o=>o.id!==e.id))}clearNewDesks(){this._filters.next(this._filters.getValue()),this._new_desks.next([])}checkinDesk(e,o=!0){return(0,E.A)(function*(){const _=yield(0,c.Z$)(e.id,o??!0).toPromise().catch(s=>({failed:!0,error:s}));if(_.failed)throw(0,r.UG)(_.error?`Error: ${_.error}`:`Error checking ${o?"in":"out"} desk booking`),_.error;(0,r.VX)(`Checked ${o?"in":"out"} ${e.user_name}.`)})()}approveDesk(e){return(0,E.A)(function*(){if("failed"===(yield(0,c.DD)(e.id).toPromise().catch(_=>"failed")))return(0,r.UG)("Error approving in desk booking");(0,r.VX)(`Approved desk booking for ${e.user_name} on ${(0,k.A)(e.date,"MMM do")}.`),e.approved=!0,e.rejected=!1})()}rejectDesk(e){return(0,E.A)(function*(){if("failed"===(yield(0,c.vB)(e.id).toPromise().catch(_=>"failed")))return(0,r.UG)("Error rejecting in desk booking");(0,r.VX)(`Rejected desk booking for ${e.user_name} on ${(0,k.A)(e.date,"MMM do")}.`),e.approved=!1,e.rejected=!0})()}giveAccess(e){var o=this;return(0,E.A)(function*(){const _=yield(0,c.X0)(new c.Qr({...e,access:!0})).toPromise().catch(s=>"failed");if("failed"===_)return(0,r.UG)("Error giving building access booking host");(0,r.VX)(`Successfully gave building access to ${e.user_name} for desk booking.`),o._desk_bookings=[...o._desk_bookings,_]})()}rejectAllDesks(){var e=this;return(0,E.A)(function*(){const o=e._desk_bookings||[];if(o.length<=0)return(0,r.uA)("No desks to reject for the selected date");const _=yield(0,r.GE)({title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}},e._dialog);"done"===_.reason&&(_.loading("Rejecting all desks for selected date..."),yield Promise.all(o.map(s=>(0,c.vB)(s.id).toPromise())),(0,r.VX)("Successfully rejected all desk bookings for selected date."),_.close())})()}static#e=this.\u0275fac=function(o){return new(o||a)(f.KVO(m.yb),f.KVO(I.bZ),f.KVO(r.h$))};static#s=this.\u0275prov=f.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()}}]);
//# sourceMappingURL=common.js.map