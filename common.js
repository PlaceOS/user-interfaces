"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["common"],{34381:(L,P,e)=>{e.d(P,{H:()=>B});var c=e(71670),D=e(47298),m=e(70462),f=e(9681),a=e(32484),O=e(28159),M=e(95933),x=e(36520),_=e(47422),u=e(58175),y=e(680),C=e(15746),I=e(45083),U=e(36932),T=e(67343),R=e(57016),E=e(4512),g=e(14884),l=e(78466),r=e(22798),v=e(93121),p=(e(89680),e(29039)),A=e(17401);let B=(()=>{class d extends r.cx{get new_desk_count(){return this._new_desks.getValue()?.length||0}nextPage(){this._call_next_page.next(`NEXT_${Date.now()}`)}constructor(s,n){super(),this._org=s,this._dialog=n,this._filters=new m.X({}),this._new_desks=new m.X([]),this._desk_bookings=[],this._loading=new m.X(!1),this.new_desks=this._new_desks.asObservable(),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,M.b)(500),(0,x.w)(t=>{const o=t.zones||[];return o&&!o.includes("All")?(0,D.rlq)(o[0],"desks").pipe((0,_.U)(i=>i.details instanceof Array?i.details:[]),(0,u.K)(i=>(0,f.of)([]))):(0,D.BW_)(this._org.building?.id,{name:"desks"}).pipe((0,_.U)(i=>i.map(h=>h.metadata?.desks?.details||[]).reduce((h,k)=>[...h,...k],[])),(0,u.K)(i=>(0,f.of)([])))}),(0,_.U)(t=>(t instanceof Array||(t=[]),t.sort((o,i)=>o.name?.localeCompare(i.name)),t.map(o=>new v.nk({...o,qr_code:""})))),(0,y.d)(1)),this._next_page=new a.xQ,this._call_next_page=new a.xQ,this._all_zones_keys=["All",-1,"-1"],this.setup_paging=(0,O.aj)([this._filters,this._org.initialised]).pipe((0,M.b)(500),(0,C.b)(([t,o])=>{if(!o)return;const i=t.date||Date.now(),h=!t.zones||t.zones.some(k=>this._all_zones_keys.includes(k))?[this._org.building.id]:t.zones;this._next_page.next(()=>(0,l.pS)({period_start:(0,T.Z)((0,R.Z)(i)),period_end:(0,T.Z)((0,E.Z)(i)),type:"desk",zones:h.join(","),include_checked_out:!0}).pipe((0,u.K)(k=>(0,f.of)({data:[],total:0,next:null})))),this._call_next_page.next(`RESET_${Date.now()}`)})),this.paged_bookings=(0,O.aj)([this._next_page,this._call_next_page]).pipe((0,I.x)((t,o)=>t[1]===o[1]),(0,x.w)(([t,o])=>(this._loading.next(!0),t?o.includes("RESET")?t().pipe((0,_.U)(i=>({...i,reset:!0})),(0,u.K)(i=>(0,f.of)({data:[],total:0,next:null}))):t().pipe((0,_.U)(i=>({...i,reset:!1})),(0,u.K)(i=>(0,f.of)({data:[],total:0,next:null}))):(0,f.of)({data:[],total:0,next:null,reset:o.includes("RESET")}))),(0,U.R)((t,{data:o,total:i,next:h,reset:k})=>{const W=o;return this._next_page.next(h),k?{list:W,total:i}:{list:[...t.list,...W],total:i}},{list:[],total:0}),(0,C.b)(t=>this._loading.next(!1)),(0,y.d)(1)),this.has_more_pages=this.paged_bookings.pipe((0,_.U)(t=>t.list.length<t.total)),this.bookings=this.paged_bookings.pipe((0,_.U)(t=>t.list)),this.setup_paging.subscribe()}setFilters(s){s.zones?.includes("All")?s.zones=["All",...this._org.levelsForBuilding(this._org.building).map(n=>n.id)]:s.zones&&this._filters.getValue()?.zones?.includes("All")&&(s.zones=[]),this._filters.next({...this._filters.getValue(),...s})}refresh(){this._loading.next(!0),this.timeout("poll",()=>this.setFilters(this._filters.getValue()))}addDesks(s){this._new_desks.next(this._new_desks.getValue().concat(s))}removeNewDesk(s){this._filters.next(this._filters.getValue()),this._new_desks.next(this._new_desks.getValue().filter(n=>n.id!==s.id))}clearNewDesks(){this._filters.next(this._filters.getValue()),this._new_desks.next([])}checkinDesk(s,n=!0){return(0,c.Z)(function*(){const t=yield(0,l.FD)(s.id,n??!0).toPromise().catch(o=>({failed:!0,error:o}));if(t.failed)throw(0,r.cB)(t.error?`Error: ${t.error}`:`Error checking ${n?"in":"out"} desk booking`),t.error;(0,r.t5)(`Checked ${n?"in":"out"} ${s.user_name}.`)})()}approveDesk(s){return(0,c.Z)(function*(){if("failed"===(yield(0,l.jT)(s.id).toPromise().catch(t=>"failed")))return(0,r.cB)("Error approving in desk booking");(0,r.t5)(`Approved desk booking for ${s.user_name} on ${(0,g.Z)(s.date,"MMM do")}.`),s.approved=!0,s.rejected=!1})()}rejectDesk(s){return(0,c.Z)(function*(){if("failed"===(yield(0,l.FP)(s.id).toPromise().catch(t=>"failed")))return(0,r.cB)("Error rejecting in desk booking");(0,r.t5)(`Rejected desk booking for ${s.user_name} on ${(0,g.Z)(s.date,"MMM do")}.`),s.approved=!1,s.rejected=!0})()}giveAccess(s){var n=this;return(0,c.Z)(function*(){const t=yield(0,l.km)(new l.$N({...s,access:!0})).toPromise().catch(o=>"failed");if("failed"===t)return(0,r.cB)("Error giving building access booking host");(0,r.t5)(`Successfully gave building access to ${s.user_name} for desk booking.`),n._desk_bookings=[...n._desk_bookings,t]})()}rejectAllDesks(){var s=this;return(0,c.Z)(function*(){const n=s._desk_bookings||[];if(n.length<=0)return(0,r.QD)("No desks to reject for the selected date");const t=yield(0,r._5)({title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}},s._dialog);"done"===t.reason&&(t.loading("Rejecting all desks for selected date..."),yield Promise.all(n.map(o=>(0,l.FP)(o.id).toPromise())),(0,r.t5)("Successfully rejected all desk bookings for selected date."),t.close())})()}static#e=this.\u0275fac=function(n){return new(n||d)(p.LFG(v.w7),p.LFG(A.uw))};static#s=this.\u0275prov=p.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},78466:(L,P,e)=>{e.d(P,{$N:()=>m.$,fy:()=>D.f,EP:()=>c.E,jT:()=>a.jT,FD:()=>a.FD,NP:()=>a.NP,F2:()=>a.F2,pS:()=>a.pS,FP:()=>a.FP,km:()=>a.km,Fo:()=>a.Fo,Wp:()=>a.Wp});var c=e(1290),D=e(63863),m=e(86049),a=(e(99645),e(25183));e(22798),e(54955),e(921),e(29165),e(61635),e(55713),e(39861),e(65033)}}]);
//# sourceMappingURL=common.js.map