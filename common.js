"use strict";(self.webpackChunkworkplace=self.webpackChunkworkplace||[]).push([["common"],{7625:(T,C,t)=>{t.d(C,{I:()=>n});var U=t(1670),P=t(9638),c=t(232),u=t(1299),E=t(1810),K=t(9377),I=t(3200),M=t(4505),v=t(7716),g=t(8759),l=t(9095),f=t(6942),y=t(7418),_=t(9128),x=t(9676);let n=(()=>{class i extends c.KG{constructor(r){super(),this._settings=r,this._poll=new M.X(0),this._loading=new M.X(!1),this._filters=new M.X({shown_types:["event","desk","parking"]}),this._date=new M.X(Date.now()),this._update=(0,v.aj)([this._date,this._poll]).pipe((0,g.b)(s=>this._loading.next(!0))),this.events=this._update.pipe((0,l.w)(([s])=>{const a={period_start:(0,E.Z)((0,K.Z)(s)),period_end:(0,E.Z)((0,I.Z)(s))};return this._settings.get("app.no_user_calendar")?(0,P.F2)({...a,type:"room"}).pipe((0,f.U)(e=>e.map(D=>(0,u.Yd)(D))),(0,y.K)(e=>[])):(0,u.u$)({...a}).pipe((0,y.K)(e=>[]))}),(0,g.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,_.d)(1)),this.desks=this._update.pipe((0,l.w)(([s])=>(0,P.F2)({period_start:(0,E.Z)((0,K.Z)(s)),period_end:(0,E.Z)((0,I.Z)(s)),type:"desk"}).pipe((0,y.K)(a=>(console.error(a),[])))),(0,g.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,_.d)(1)),this.parking=this._update.pipe((0,l.w)(([s])=>(0,P.F2)({period_start:(0,E.Z)((0,K.Z)(s)),period_end:(0,E.Z)((0,I.Z)(s)),type:"parking"}).pipe((0,y.K)(a=>[]))),(0,g.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,_.d)(1)),this.bookings=(0,v.aj)([this.events,this.desks,this.parking]).pipe((0,g.b)(s=>console.log("Data:",s)),(0,f.U)(([s,a,e])=>[...s,...a,...e].sort((D,o)=>D.date-o.date))),this.filtered_bookings=(0,v.aj)([this.bookings,this._filters]).pipe((0,f.U)(([s,a])=>s.filter(e=>e instanceof u.ym&&a?.shown_types?.includes("event")||a?.shown_types?.includes(e.booking_type)))),this.filters=this._filters.asObservable(),this.date=this._date.asObservable(),this.loading=this._loading.asObservable()}startPolling(r=15e3){return this.interval("poll",()=>this._poll.next(Date.now()),r),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setDate(r){this._date.next(r)}toggleType(r,s=!1){var a=this;return(0,U.Z)(function*(){const e=a._filters.getValue()||{shown_types:[]},{shown_types:D}=e;D&&(D.includes(r)||s)?a._filters.next({...e,shown_types:D.filter(o=>o!==r)}):a._filters.next({...e,shown_types:[...D,r]}),console.log("Filters:",a._filters.getValue())})()}}return i.\u0275fac=function(r){return new(r||i)(x.LFG(c.gb))},i.\u0275prov=x.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},8676:(T,C,t)=>{t.d(C,{I:()=>a});var U=t(9638),P=t(9434),c=t(232),u=t(1299),E=t(1810),K=t(9377),I=t(312),M=t(3200),v=t(4505),g=t(1942),l=t(7716),f=t(4350),y=t(9095),_=t(9128),x=t(823),n=t(522),i=t(6942),p=t(7418),r=t(8759),s=t(9676);let a=(()=>{class e extends c.KG{constructor(o){super(),this._settings=o,this._poll=new v.X(0),this._options=new v.X({start:Date.now()}),this._loading=new v.X(""),this._schedule=new v.X([]),this.options=this._options.asObservable(),this.loading=this._loading.asObservable(),this.schedule=this._loading.asObservable(),this.calendars=(0,g.H)(1e3).pipe((0,y.w)(d=>(0,P.yJ)()),(0,_.d)(1)),this.events=(0,l.aj)([this._options,this._poll]).pipe((0,x.b)(1e3),(0,n.zg)(([d])=>{this._loading.next("Loading schedule...");const O={period_start:(0,E.Z)((0,K.Z)(d.start)),period_end:(0,E.Z)((0,I.Z)((0,M.Z)(d.start),6))};return d.calendar&&(O.calendar=d.calendar),this._schedule.next(this._schedule.getValue().filter(h=>!(0,c.MZ)(1e3*O.period_start,1e3*O.period_end,h.date,h.date+60*h.duration*1e3))),(0,f.D)([!0===this._settings.get("app.no_user_calendar")?(0,U.F2)({...O,type:"room"}).pipe((0,i.U)(h=>h.map(L=>(0,u.Yd)(L)))):(0,u.u$)({...O}),(0,U.F2)({...O,type:"desk"}),(0,U.F2)({...O,type:"parking"})]).pipe((0,p.K)(h=>[]))}),(0,i.U)(([d,O])=>{const h=[...this._schedule.getValue(),...d,...O.filter(L=>"declined"!==L.status)].sort((L,B)=>L.date-B.date);return this._schedule.next((0,c.Tw)(h,"id")),h}),(0,p.K)(d=>[]),(0,r.b)(d=>this._loading.next("")),(0,_.d)(1))}startPolling(o=15e3){this.interval("poll",()=>this._poll.next(Date.now()),o)}stopPolling(){this.clearInterval("poll")}setOptions(o){this._options.next({...this._options.getValue(),...o})}}return e.\u0275fac=function(o){return new(o||e)(s.LFG(c.gb))},e.\u0275prov=s.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},9434:(T,C,t)=>{t.d(C,{ot:()=>y,yJ:()=>l.yJ}),t(4603);var P=t(1670),c=t(4505),u=t(5670),E=t(1810),K=t(9377),I=t(3200),M=t(2317),v=t(232),g=t(6221),l=t(6217),f=t(9676);let y=(()=>{class _ extends v.KG{constructor(n,i){super(),this._org=n,this._settings=i,this._calendars=new c.X([]),this.calendar_list=this._calendars.asObservable(),this.query=()=>(0,l.yJ)(),this.freeBusy=p=>(0,l.tS)(p,this._org),this.availability=p=>(0,l.v7)(p),this._org.initialised.pipe((0,u.P)(p=>p)).subscribe(()=>this.init())}init(){var n=this;return(0,P.Z)(function*(){n._settings.get("app.no_user_calendar")||(yield n.load().catch(i=>(0,v.cB)("Error loading calendars data")),n._initialised.next(!0))})()}get calendars(){return this._calendars.getValue()}getFreeBusyDate(n,i){return(0,l.tS)({period_start:(0,E.Z)((0,K.Z)(n)),period_end:(0,E.Z)((0,I.Z)(n)),calendars:i},this._org)}checkSpacesAvailability(n,i,p,r){return(0,P.Z)(function*(){const s=yield(0,l.v7)({period_start:i,period_end:p,system_ids:n.join(",")}).toPromise(),a=new Date(r?.date).valueOf(),e=(0,M.Z)(a,r?.duration).valueOf();return!!s.every(o=>{const d=o.availability;if(r&&o.id===r.system?.email){const O=d.findIndex(h=>h.date>=a&&(0,M.Z)(h.date,h.duration).valueOf()<=e);-1!==O&&d.splice(O,1)}return!d.length})})()}load(){var n=this;return(0,P.Z)(function*(){n._calendars.next(yield(0,l.yJ)().toPromise())})()}}return _.\u0275fac=function(n){return new(n||_)(f.LFG(g.w7),f.LFG(v.gb))},_.\u0275prov=f.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()}}]);
//# sourceMappingURL=common.js.map