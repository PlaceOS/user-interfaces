"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["common"],{1578:(H,G,n)=>{n.d(G,{v:()=>Z});var u=n(9204),x=n(3998),j=n(521),E=n(2175),h=n(1536),D=n(3119),y=n(9803),b=n(1963),p=n(5443),k=n(9314),C=n(7841),A=n(6e3),I=n(6109),P=n(2508),M=n(3602),B=n(7871),T=n(9908),N=n(3240),S=n(6441),z=n(6671),g=n(7915),d=n(2333),V=n(2185),e=(n(3259),n(8559)),c=n(4456),F=n(2587),X=n(316),R=n(4950),U=n(7984),O=n(1134),w=n(5060),J=n(212),W=n(9434);function L(l,$){1&l&&(e.j41(0,"button",6)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function Y(l,$){if(1&l){const t=e.RV6();e.j41(0,"main",7)(1,"div",8)(2,"div",9)(3,"label",10),e.EFF(4,"Desk Name"),e.j41(5,"span"),e.EFF(6,"*"),e.k0s()(),e.j41(7,"mat-form-field",11),e.nrm(8,"input",12),e.j41(9,"mat-error"),e.EFF(10,"A name is required for desks"),e.k0s()()(),e.j41(11,"div",9)(12,"label",13),e.EFF(13,"Map ID"),e.j41(14,"span"),e.EFF(15,"*"),e.k0s()(),e.j41(16,"mat-form-field",11),e.nrm(17,"input",14),e.j41(18,"mat-error"),e.EFF(19," A Map ID is required for desks "),e.k0s()()()(),e.j41(20,"label",15),e.EFF(21,"Groups"),e.k0s(),e.nrm(22,"item-list-field",16),e.j41(23,"label",15),e.EFF(24,"Features"),e.k0s(),e.nrm(25,"item-list-field",17),e.j41(26,"label",15),e.EFF(27,"Notes"),e.k0s(),e.j41(28,"mat-form-field",18),e.nrm(29,"textarea",19),e.k0s(),e.j41(30,"div",20)(31,"button",21),e.EFF(32," Cancel "),e.k0s(),e.j41(33,"button",22),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.postForm())}),e.EFF(34," Save "),e.k0s()()()}if(2&l){const t=e.XpG();e.Y8G("formGroup",t.form)}}function K(l,$){1&l&&(e.j41(0,"main",23),e.nrm(1,"mat-spinner",24),e.j41(2,"p"),e.EFF(3,"Saving desk details..."),e.k0s()())}let Q=(()=>{class l{get id(){return this._data?.desk?.id||""}constructor(t,o){this._data=t,this._dialog_ref=o,this.event=new e.bkB,this.form=new c.gE({id:new c.MJ(""),name:new c.MJ("",[c.k0.required]),map_id:new c.MJ("",[c.k0.required]),groups:new c.MJ([]),features:new c.MJ([]),notes:new c.MJ("")}),t?.desk&&this.form.patchValue(t.desk)}postForm(){if(!this.form.valid)return;this.loading=!0;const t=this.form.value;this._dialog_ref.disableClose=!0,this.event.emit({reason:"done",metadata:t})}static#e=this.\u0275fac=function(o){return new(o||l)(e.rXU(F.Vh),e.rXU(F.CP))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["desk-modal"]],outputs:{event:"event"},decls:8,vars:4,consts:[["load_state",""],[1,"w-[28rem]"],[1,"flex","items-center","justify-between","px-2","w-full"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col",3,"formGroup",4,"ngIf","ngIfElse"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","flex","flex-col",3,"formGroup"],[1,"flex","space-x-2"],[1,"flex-1","w-1/3"],["for","name"],["appearance","outline",1,"w-full"],["matInput","","name","name","formControlName","name","placeholder","e.g. Office Desk"],["for","map-id"],["matInput","","name","map-id","formControlName","map_id","placeholder","e.g. table-01.012"],["for","notes"],["placeholder","Add user groups...","formControlName","groups",1,"w-full"],["placeholder","Add features...","formControlName","features",1,"w-full"],["appearance","outline"],["matInput","","name","notes","formControlName","notes"],[1,"flex","items-center","justify-end","space-x-2"],["btn","","matRipple","","mat-dialog-close","",1,"w-32","inverse"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"]],template:function(o,i){if(1&o&&(e.j41(0,"div",1)(1,"header",2)(2,"h2",3),e.EFF(3),e.k0s(),e.DNE(4,L,3,0,"button",4),e.k0s(),e.DNE(5,Y,35,1,"main",5),e.k0s(),e.DNE(6,K,4,0,"ng-template",null,0,e.C5r)),2&o){const s=e.sdS(7);e.R7$(3),e.SpI("",i.id?"Edit":"New"," Desk"),e.R7$(),e.Y8G("ngIf",!i.loading),e.R7$(),e.Y8G("ngIf",!i.loading)("ngIfElse",s)}},dependencies:[X.bT,c.me,c.BC,c.cb,c.j4,c.JD,R.rl,R.TL,U.fg,O.LG,F.tx,w.r6,J.DR,W.R]})}return l})(),Z=(()=>{class l extends d.Tv{nextPage(){this._call_next_page.next(`NEXT_${Date.now()}`)}constructor(t,o,i){super(),this._org=t,this._dialog=o,this._settings=i,this._filters=new j.t({}),this._desk_bookings=[],this._loading=new j.t(!1),this._change=new j.t(0),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=(0,E.zV)([this._filters,this._change]).pipe((0,y.B)(500),(0,b.n)(([s])=>{const r=s.zones||[];return r&&!r.includes("All")?(0,x.bpY)(r[0],"desks").pipe((0,p.T)(a=>a.details instanceof Array?a.details:[]),(0,k.W)(a=>(0,h.of)([]))):(0,x.WsZ)(this._org.building?.id,{name:"desks"}).pipe((0,p.T)(a=>a.map(f=>f.metadata?.desks?.details||[]).reduce((f,m)=>[...f,...m],[])),(0,k.W)(a=>(0,h.of)([])))}),(0,p.T)(s=>(s instanceof Array||(s=[]),s.sort((r,a)=>r.name?.localeCompare(a.name)),s.map(r=>new V.gB({...r,qr_code:""})))),(0,C.t)(1)),this._next_page=new D.B7,this._call_next_page=new D.B7,this._all_zones_keys=["All",-1,"-1"],this.setup_paging=(0,E.zV)([this._filters,this._org.initialised]).pipe((0,y.B)(500),(0,A.M)(([s,r])=>{if(!r)return;const a=s.date||Date.now(),f=!s.zones||s.zones.some(m=>this._all_zones_keys.includes(m))?this._settings.get("app.use_region")?this._org.buildingsForRegion().map(m=>m.id):[this._org.building.id]:s.zones;this._next_page.next(()=>(0,g.WE)({period_start:(0,T._)((0,N.o)(a)),period_end:(0,T._)((0,S.D)(a)),type:"desk",zones:f.join(","),include_checked_out:!0}).pipe((0,k.W)(m=>(0,h.of)({data:[],total:0,next:null})))),this._call_next_page.next(`RESET_${Date.now()}`)})),this.paged_bookings=(0,E.zV)([this._next_page,this._call_next_page]).pipe((0,I.F)((s,r)=>s[1]===r[1]),(0,b.n)(([s,r])=>(this._loading.next(!0),s?r.includes("RESET")?s().pipe((0,p.T)(a=>({...a,reset:!0})),(0,k.W)(a=>(0,h.of)({data:[],total:0,next:null}))):s().pipe((0,p.T)(a=>({...a,reset:!1})),(0,k.W)(a=>(0,h.of)({data:[],total:0,next:null}))):(0,h.of)({data:[],total:0,next:null,reset:r.includes("RESET")}))),(0,P.S)((s,{data:r,total:a,next:f,reset:m})=>{const v=r;return this._next_page.next(f),m?{list:v,total:a}:{list:[...s.list,...v],total:a}},{list:[],total:0}),(0,A.M)(s=>this._loading.next(!1)),(0,C.t)(1)),this.has_more_pages=this.paged_bookings.pipe((0,p.T)(s=>s.list.length<s.total)),this.bookings=this.paged_bookings.pipe((0,p.T)(s=>s.list)),this.setup_paging.subscribe()}setFilters(t){t.zones?.includes("All")?t.zones=["All",...this._org.levelsForBuilding(this._org.building).map(o=>o.id)]:t.zones&&this._filters.getValue()?.zones?.includes("All")&&(t.zones=[]),this._filters.next({...this._filters.getValue(),...t})}refresh(){this._loading.next(!0),this.timeout("poll",()=>this.setFilters(this._filters.getValue()))}addDesks(t){var o=this;return(0,u.A)(function*(){const i=o._filters.getValue().zones[0],s=yield o.desks.pipe((0,M.s)(1)).toPromise();for(const r of t){const a=s.findIndex(f=>f.id===r.id);a>=0?s[a]=r:s.push(r)}yield(0,x.D58)(i,{name:"desks",details:s,description:"List of available desks"}).toPromise(),o._change.next(Date.now())})()}editDesk(t){var o=this;return(0,u.A)(function*(){const i=o._dialog.open(Q,{data:{desk:t}}),s=yield Promise.race([i.afterClosed().toPromise(),i.componentInstance.event.pipe((0,B.$)(v=>"done"===v.reason)).toPromise()]);if("done"!==s?.reason)return;const r=o._filters.getValue().zones[0],a={...s.metadata,id:s.metadata.id||`parking-${r}.${(0,d.HO)(999999)}`},f=yield o.desks.pipe((0,M.s)(1)).toPromise(),m=f.findIndex(v=>v.id===a.id);m>=0?f[m]=a:f.push(a),yield(0,x.D58)(r,{name:"desks",details:f,description:"List of available desks"}).toPromise(),o._change.next(Date.now()),i.close()})()}checkinDesk(t,o=!0){return(0,u.A)(function*(){const i=yield(0,g.Z$)(t.id,o??!0).toPromise().catch(s=>({failed:!0,error:s}));if(i.failed)throw(0,d.UG)(i.error?`Error: ${i.error}`:`Error checking ${o?"in":"out"} desk booking`),i.error;(0,d.VX)(`Checked ${o?"in":"out"} ${t.user_name}.`)})()}approveDesk(t){return(0,u.A)(function*(){if("failed"===(yield(0,g.DD)(t.id).toPromise().catch(i=>"failed")))return(0,d.UG)("Error approving in desk booking");(0,d.VX)(`Approved desk booking for ${t.user_name} on ${(0,z.GP)(t.date,"MMM do")}.`),t.approved=!0,t.rejected=!1})()}rejectDesk(t){return(0,u.A)(function*(){if("failed"===(yield(0,g.vB)(t.id).toPromise().catch(i=>"failed")))return(0,d.UG)("Error rejecting in desk booking");(0,d.VX)(`Rejected desk booking for ${t.user_name} on ${(0,z.GP)(t.date,"MMM do")}.`),t.approved=!1,t.rejected=!0})()}giveAccess(t){var o=this;return(0,u.A)(function*(){const i=yield(0,g.X0)(new g.Qr({...t,access:!0})).toPromise().catch(s=>"failed");if("failed"===i)return(0,d.UG)("Error giving building access booking host");(0,d.VX)(`Successfully gave building access to ${t.user_name} for desk booking.`),o._desk_bookings=[...o._desk_bookings,i]})()}rejectAllDesks(){var t=this;return(0,u.A)(function*(){const o=t._desk_bookings||[];if(o.length<=0)return(0,d.uA)("No desks to reject for the selected date");const i=yield(0,d.GE)({title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}},t._dialog);"done"===i.reason&&(i.loading("Rejecting all desks for selected date..."),yield Promise.all(o.map(s=>(0,g.vB)(s.id).toPromise())),(0,d.VX)("Successfully rejected all desk bookings for selected date."),i.close())})()}static#e=this.\u0275fac=function(o){return new(o||l)(e.KVO(V.yb),e.KVO(F.bZ),e.KVO(d.h$))};static#t=this.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})()}}]);
//# sourceMappingURL=common.js.map