"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["common"],{9519:(R,k,o)=>{o.d(k,{H:()=>C});var d=o(4929),g=o(4505),u=o(823),E=o(9095),c=o(6942),M=o(7418),O=o(9128),m=o(5670),p=o(9377),b=o(3200),f=o(5148),_=o(4099),l=o(3294),D=o(3499),P=o(3619),A=o(5767),j=o(6168),h=o(3184),B=o(5758);let C=(()=>{class r extends l.KG{constructor(e,i){super(),this._org=e,this._dialog=i,this._filters=new g.X({}),this._new_desks=new g.X([]),this._desk_bookings=[],this._desks=[],this._loading=new g.X(!1),this.new_desks=this._new_desks.asObservable(),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,u.b)(500),(0,E.w)(s=>{var t;const n=s.zones||[];return n.includes("All")?(0,D.BW_)(null===(t=this._org.building)||void 0===t?void 0:t.id,{name:"desks"}).pipe((0,c.U)(a=>a.map(v=>v.metadata.desks.details).reduce((v,U)=>[...v,...U],[]))):(0,D.rlq)(n[0],"desks").pipe((0,c.U)(a=>a.details))}),(0,M.K)(s=>[]),(0,c.U)(s=>(s instanceof Array||(s=[]),s.sort((t,n)=>t.name.localeCompare(n.name)),this._desks=s.map(t=>new P.nk(Object.assign(Object.assign({},t),{qr_code:""}))),this._desks)),(0,O.d)(1)),this.bookings=this._filters.pipe((0,u.b)(500),(0,E.w)(s=>{this._loading.next(!0);const t=s.date?new Date(s.date):new Date;let n=(s.zones||[]).filter(a=>-1!==a&&"-1"!==a&&"All"!==a);return(null==n?void 0:n.length)||(n=this._org.levelsForBuilding(this._org.building).map(a=>a.id)),(0,_.F2)({period_start:Math.floor((0,p.Z)(t).valueOf()/1e3),period_end:Math.floor((0,b.Z)(t).valueOf()/1e3),type:"desk",zones:(n||[]).join(",")})}),(0,c.U)(s=>(s.sort((t,n)=>t.date-n.date),this._desk_bookings=s.map(t=>new _.$N(Object.assign(Object.assign({},t),{extension_data:Object.assign(Object.assign({},t.extension_data),{checkin_qr_code:(0,j.w)(`/workplace/#/book/code?checkin=${encodeURIComponent(t.asset_id)}`)})}))),this._loading.next(!1),s)),(0,O.d)(1))}get new_desk_count(){var e;return(null===(e=this._new_desks.getValue())||void 0===e?void 0:e.length)||0}setFilters(e){var i,s,t;(null===(i=e.zones)||void 0===i?void 0:i.includes("All"))?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(n=>n.id)]:e.zones&&(null===(t=null===(s=this._filters.getValue())||void 0===s?void 0:s.zones)||void 0===t?void 0:t.includes("All"))&&(e.zones=[]),console.warn("Filters:",e),this._filters.next(Object.assign(Object.assign({},this._filters.getValue()),e))}startPolling(e=3e4){this.interval("poll",()=>this.setFilters(this._filters.getValue()),e)}stopPolling(){this.clearInterval("poll")}addDesks(e){this._new_desks.next(this._new_desks.getValue().concat(e))}clearNewDesks(){this._new_desks.next([])}checkinDesk(e){return(0,d.mG)(this,void 0,void 0,function*(){"failed"===(yield(0,_.FD)(e.id,!0).toPromise().catch(s=>"failed"))?(0,l.cB)("Error checking in desk booking"):(0,l.t5)(`Checked in ${e.user_name}.`)})}approveDesk(e){return(0,d.mG)(this,void 0,void 0,function*(){"failed"===(yield(0,_.jT)(e.id).toPromise().catch(s=>"failed"))?(0,l.cB)("Error approving in desk booking"):(0,l.t5)(`Approved desk booking for ${e.user_name} on ${(0,f.Z)(e.date,"MMM do")}.`)})}rejectDesk(e){return(0,d.mG)(this,void 0,void 0,function*(){"failed"===(yield(0,_.FP)(e.id).toPromise().catch(s=>"failed"))?(0,l.cB)("Error rejecting in desk booking"):(0,l.t5)(`Rejected desk booking for ${e.user_name} on ${(0,f.Z)(e.date,"MMM do")}.`)})}giveAccess(e){return(0,d.mG)(this,void 0,void 0,function*(){const i=yield(0,_.km)(new _.$N(Object.assign(Object.assign({},e),{access:!0}))).toPromise().catch(s=>"failed");if("failed"===i)return(0,l.cB)("Error giving building access booking host");(0,l.t5)(`Successfully gave building access to ${e.user_name} for desk booking.`),this._desk_bookings=[...this._desk_bookings,i]})}rejectAllDesks(){return(0,d.mG)(this,void 0,void 0,function*(){const e=this._desk_bookings||[];if(e.length>0){const i=this._dialog.open(A.z5,{data:{title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}}});return new Promise((s,t)=>{let n=!1;i.componentInstance.event.pipe((0,m.P)(a=>"done"===a.reason)).subscribe(()=>(0,d.mG)(this,void 0,void 0,function*(){i.componentInstance.loading="Rejecting all desks for selected date...",n=!0,yield Promise.all(e.map(a=>(0,_.FP)(a.id).toPromise())),s(""),(0,l.t5)("Successfull rejected all desk bookings for selected date."),i.close()})),i.afterClosed().toPromise().then(()=>{n||t()})})}(0,l.QD)("No desks to reject for the selected date")})}}return r.\u0275fac=function(e){return new(e||r)(h.LFG(P.w7),h.LFG(B.uw))},r.\u0275prov=h.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()}}]);
//# sourceMappingURL=common.js.map