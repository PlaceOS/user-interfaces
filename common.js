(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([["common"],{2693:(e,s,i)=>{"use strict";i.d(s,{H:()=>j});var t=i(4762),o=i(8512),n=i(7701),l=i(4689),d=i(9996),a=i(7727),r=i(8303),c=i(3530),g=i(205),h=i(8125),k=i(4441),u=i(6839),f=i(6687),_=i(6817),p=i(1496),b=i(2347),v=i(2892),m=i(1572),w=i(4608);let j=(()=>{class e extends f.KG{constructor(e,s){super(),this._org=e,this._dialog=s,this._filters=new o.X({}),this._desk_bookings=[],this._desks=[],this._loading=new o.X(!1),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,n.b)(500),(0,l.w)(e=>{var s;const i=e.zones||[];return i.includes("All")?(0,_.BW_)(null===(s=this._org.building)||void 0===s?void 0:s.id,{name:"desks"}).pipe((0,d.U)(e=>e.map(e=>e.metadata.desks.details).reduce((e,s)=>[...e,...s],[]))):(0,_.rlq)(i[0],"desks").pipe((0,d.U)(e=>e.details))}),(0,a.K)(e=>[]),(0,d.U)(e=>(e instanceof Array||(e=[]),e.sort((e,s)=>e.name.localeCompare(s.name)),this._desks=e.map(e=>new p.nk(Object.assign(Object.assign({},e),{qr_code:(0,v.w)(`/workplace/#/book/code?checkin=${encodeURIComponent(e.id)}`)}))),this._desks)),(0,r.d)()),this.bookings=this._filters.pipe((0,n.b)(500),(0,l.w)(e=>{this._loading.next(!0);const s=e.date?new Date(e.date):new Date;let i=(e.zones||[]).filter(e=>-1!==e&&"-1"!==e&&"All"!==e);return(null==i?void 0:i.length)||(i=this._org.levelsForBuilding(this._org.building).map(e=>e.id)),(0,u.F2)({period_start:Math.floor((0,g.Z)(s).valueOf()/1e3),period_end:Math.floor((0,h.Z)(s).valueOf()/1e3),type:"desk",zones:(i||[]).join(",")})}),(0,d.U)(e=>(e.sort((e,s)=>e.date-s.date),this._desk_bookings=e.map(e=>new u.$N(Object.assign(Object.assign({},e),{extension_data:Object.assign(Object.assign({},e.extension_data),{checkin_qr_code:(0,v.w)(`/workplace/#/book/code?checkin=${encodeURIComponent(e.asset_id)}`)})}))),this._loading.next(!1),e)),(0,r.d)())}setFilters(e){var s,i,t;(null===(s=e.zones)||void 0===s?void 0:s.includes("All"))?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(e=>e.id)]:e.zones&&(null===(t=null===(i=this._filters.getValue())||void 0===i?void 0:i.zones)||void 0===t?void 0:t.includes("All"))&&(e.zones=[]),console.warn("Filters:",e),this._filters.next(Object.assign(Object.assign({},this._filters.getValue()),e))}startPolling(e=3e4){this.interval("poll",()=>this.setFilters(this._filters.getValue()),e)}stopPolling(){this.clearInterval("poll")}checkinDesk(e){return(0,t.mG)(this,void 0,void 0,function*(){"failed"===(yield(0,u.FD)(e.id,!0).toPromise().catch(e=>"failed"))?(0,f.cB)("Error checking in desk booking"):(0,f.t5)(`Checked in ${e.user_name}.`)})}approveDesk(e){return(0,t.mG)(this,void 0,void 0,function*(){"failed"===(yield(0,u.jT)(e.id).toPromise().catch(e=>"failed"))?(0,f.cB)("Error approving in desk booking"):(0,f.t5)(`Approved desk booking for ${e.user_name} on ${(0,k.Z)(e.date,"MMM Do")}.`)})}rejectDesk(e){return(0,t.mG)(this,void 0,void 0,function*(){"failed"===(yield(0,u.FP)(e.id).toPromise().catch(e=>"failed"))?(0,f.cB)("Error rejecting in desk booking"):(0,f.t5)(`Rejected desk booking for ${e.user_name} on ${(0,k.Z)(e.date,"MMM Do")}.`)})}giveAccess(e){return(0,t.mG)(this,void 0,void 0,function*(){const s=yield(0,u.km)(new u.$N(Object.assign(Object.assign({},e),{access:!0}))).toPromise().catch(e=>"failed");if("failed"===s)return(0,f.cB)("Error giving building access booking host");(0,f.t5)(`Successfully gave building access to ${e.user_name} for desk booking.`),this._desk_bookings=[...this._desk_bookings,s]})}rejectAllDesks(){return(0,t.mG)(this,void 0,void 0,function*(){const e=this._desk_bookings||[];if(e.length>0){const s=this._dialog.open(b.z5,{data:{title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}}});return new Promise((i,o)=>{let n=!1;s.componentInstance.event.pipe((0,c.P)(e=>"done"===e.reason)).subscribe(()=>(0,t.mG)(this,void 0,void 0,function*(){s.componentInstance.loading="Rejecting all desks for selected date...",n=!0,yield Promise.all(e.map(e=>(0,u.FP)(e.id).toPromise())),i(""),(0,f.t5)("Successfull rejected all desk bookings for selected date."),s.close()})),s.afterClosed().toPromise().then(()=>{n||o()})})}(0,f.QD)("No desks to reject for the selected date")})}}return e.\u0275fac=function(s){return new(s||e)(m.LFG(p.w7),m.LFG(w.uw))},e.\u0275prov=m.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);
//# sourceMappingURL=common.js.map