"use strict";(self.webpackChunkworkplace=self.webpackChunkworkplace||[]).push([["common"],{7625:(T,C,t)=>{t.d(C,{I:()=>n});var x=t(1670),P=t(9638),c=t(232),y=t(1299),_=t(1810),K=t(9377),I=t(3200),M=t(4505),v=t(7716),g=t(8759),l=t(9095),u=t(6942),f=t(7418),d=t(9128),U=t(9676);let n=(()=>{class r extends c.KG{constructor(i){super(),this._settings=i,this._poll=new M.X(0),this._loading=new M.X(!1),this._filters=new M.X({shown_types:["event","desk","parking","visitor"]}),this._date=new M.X(Date.now()),this._update=(0,v.aj)([this._date,this._poll]).pipe((0,g.b)(s=>this._loading.next(!0))),this.events=this._update.pipe((0,l.w)(([s])=>{const e={period_start:(0,_.Z)((0,K.Z)(s)),period_end:(0,_.Z)((0,I.Z)(s))};return this._settings.get("app.no_user_calendar")?(0,P.F2)({...e,type:"room"}).pipe((0,u.U)(a=>a.map(D=>(0,y.Yd)(D))),(0,f.K)(a=>[])):(0,y.u$)({...e}).pipe((0,f.K)(a=>[]))}),(0,g.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,d.d)(1)),this.visitors=this._update.pipe((0,l.w)(([s])=>(0,P.F2)({period_start:(0,_.Z)((0,K.Z)(s)),period_end:(0,_.Z)((0,I.Z)(s)),type:"visitor"}).pipe((0,f.K)(e=>(console.error(e),[])))),(0,g.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,d.d)(1)),this.desks=this._update.pipe((0,l.w)(([s])=>(0,P.F2)({period_start:(0,_.Z)((0,K.Z)(s)),period_end:(0,_.Z)((0,I.Z)(s)),type:"desk"}).pipe((0,f.K)(e=>(console.error(e),[])))),(0,g.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,d.d)(1)),this.parking=this._update.pipe((0,l.w)(([s])=>(0,P.F2)({period_start:(0,_.Z)((0,K.Z)(s)),period_end:(0,_.Z)((0,I.Z)(s)),type:"parking"}).pipe((0,f.K)(e=>[]))),(0,g.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,d.d)(1)),this.bookings=(0,v.aj)([this.events,this.visitors,this.desks,this.parking]).pipe((0,u.U)(([s,e,a,D])=>[...s,...e,...a,...D].sort((h,o)=>h.date-o.date))),this.filtered_bookings=(0,v.aj)([this.bookings,this._filters]).pipe((0,u.U)(([s,e])=>s.filter(a=>a instanceof y.ym&&e?.shown_types?.includes("event")||e?.shown_types?.includes(a.booking_type)))),this.filters=this._filters.asObservable(),this.date=this._date.asObservable(),this.loading=this._loading.asObservable()}startPolling(i=15e3){return this.interval("poll",()=>this._poll.next(Date.now()),i),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setDate(i){this._date.next(i)}toggleType(i,s=!1){var e=this;return(0,x.Z)(function*(){const a=e._filters.getValue()||{shown_types:[]},{shown_types:D}=a;D&&(D.includes(i)||s)?e._filters.next({...a,shown_types:D.filter(h=>h!==i)}):e._filters.next({...a,shown_types:[...D,i]})})()}}return r.\u0275fac=function(i){return new(i||r)(U.LFG(c.gb))},r.\u0275prov=U.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()},8676:(T,C,t)=>{t.d(C,{I:()=>e});var x=t(9638),P=t(9434),c=t(232),y=t(1299),_=t(1810),K=t(9377),I=t(312),M=t(3200),v=t(4505),g=t(1942),l=t(7716),u=t(4350),f=t(9095),d=t(9128),U=t(823),n=t(522),r=t(6942),p=t(7418),i=t(8759),s=t(9676);let e=(()=>{class a extends c.KG{constructor(h){super(),this._settings=h,this._poll=new v.X(0),this._options=new v.X({start:Date.now()}),this._loading=new v.X(""),this._schedule=new v.X([]),this.options=this._options.asObservable(),this.loading=this._loading.asObservable(),this.schedule=this._loading.asObservable(),this.calendars=(0,g.H)(1e3).pipe((0,f.w)(o=>(0,P.yJ)()),(0,d.d)(1)),this.events=(0,l.aj)([this._options,this._poll]).pipe((0,U.b)(1e3),(0,n.zg)(([o])=>{this._loading.next("Loading schedule...");const O={period_start:(0,_.Z)((0,K.Z)(o.start)),period_end:(0,_.Z)((0,I.Z)((0,M.Z)(o.start),6))};return o.calendar&&(O.calendar=o.calendar),this._schedule.next(this._schedule.getValue().filter(E=>!(0,c.MZ)(1e3*O.period_start,1e3*O.period_end,E.date,E.date+60*E.duration*1e3))),(0,u.D)([!0===this._settings.get("app.no_user_calendar")?(0,x.F2)({...O,type:"room"}).pipe((0,r.U)(E=>E.map(L=>(0,y.Yd)(L)))):(0,y.u$)({...O}),(0,x.F2)({...O,type:"desk"}),(0,x.F2)({...O,type:"parking"})]).pipe((0,p.K)(E=>[]))}),(0,r.U)(([o,O])=>{const E=[...this._schedule.getValue(),...o,...O.filter(L=>"declined"!==L.status)].sort((L,B)=>L.date-B.date);return this._schedule.next((0,c.Tw)(E,"id")),E}),(0,p.K)(o=>[]),(0,i.b)(o=>this._loading.next("")),(0,d.d)(1))}startPolling(h=15e3){this.interval("poll",()=>this._poll.next(Date.now()),h)}stopPolling(){this.clearInterval("poll")}setOptions(h){this._options.next({...this._options.getValue(),...h})}}return a.\u0275fac=function(h){return new(h||a)(s.LFG(c.gb))},a.\u0275prov=s.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},9434:(T,C,t)=>{t.d(C,{ot:()=>f,yJ:()=>l.yJ}),t(4603);var P=t(1670),c=t(4505),y=t(5670),_=t(1810),K=t(9377),I=t(3200),M=t(2317),v=t(232),g=t(6221),l=t(6217),u=t(9676);let f=(()=>{class d extends v.KG{constructor(n,r){super(),this._org=n,this._settings=r,this._calendars=new c.X([]),this.calendar_list=this._calendars.asObservable(),this.query=()=>(0,l.yJ)(),this.freeBusy=p=>(0,l.tS)(p,this._org),this.availability=p=>(0,l.v7)(p),this._org.initialised.pipe((0,y.P)(p=>p)).subscribe(()=>this.init())}init(){var n=this;return(0,P.Z)(function*(){n._settings.get("app.no_user_calendar")||(yield n.load().catch(r=>(0,v.cB)("Error loading calendars data")),n._initialised.next(!0))})()}get calendars(){return this._calendars.getValue()}getFreeBusyDate(n,r){return(0,l.tS)({period_start:(0,_.Z)((0,K.Z)(n)),period_end:(0,_.Z)((0,I.Z)(n)),calendars:r},this._org)}checkSpacesAvailability(n,r,p,i){return(0,P.Z)(function*(){const s=yield(0,l.v7)({period_start:r,period_end:p,system_ids:n.join(",")}).toPromise(),e=new Date(i?.date).valueOf(),a=(0,M.Z)(e,i?.duration).valueOf();return!!s.every(h=>{const o=h.availability;if(i&&h.id===i.system?.email){const O=o.findIndex(E=>E.date>=e&&(0,M.Z)(E.date,E.duration).valueOf()<=a);-1!==O&&o.splice(O,1)}return!o.length})})()}load(){var n=this;return(0,P.Z)(function*(){n._calendars.next(yield(0,l.yJ)().toPromise())})()}}return d.\u0275fac=function(n){return new(n||d)(u.LFG(g.w7),u.LFG(v.gb))},d.\u0275prov=u.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()}}]);
//# sourceMappingURL=common.js.map