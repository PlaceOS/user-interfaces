"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["common"],{9519:(b,P,e)=>{e.d(P,{H:()=>A});var c=e(1670),p=e(2182),f=e(4505),O=e(2218),a=e(7716),h=e(4139),M=e(823),x=e(9095),_=e(6942),k=e(7418),y=e(9128),C=e(8759),U=e(3298),R=e(2647),T=e(1810),B=e(9377),m=e(3200),D=e(1535),l=e(5375),i=e(9743),v=e(5912),E=(e(6168),e(6839)),I=e(7486);let A=(()=>{class d extends i.cx{get new_desk_count(){return this._new_desks.getValue()?.length||0}nextPage(){this._call_next_page.next(`NEXT_${Date.now()}`)}constructor(t,r){super(),this._org=t,this._dialog=r,this._filters=new f.X({}),this._new_desks=new f.X([]),this._desk_bookings=[],this._loading=new f.X(!1),this.new_desks=this._new_desks.asObservable(),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,M.b)(500),(0,x.w)(s=>{const o=s.zones||[];return o&&!o.includes("All")?(0,p.rlq)(o[0],"desks").pipe((0,_.U)(n=>n.details)):(0,p.BW_)(this._org.building?.id,{name:"desks"}).pipe((0,_.U)(n=>n.map(u=>u.metadata.desks.details).reduce((u,g)=>[...u,...g],[])))}),(0,k.K)(s=>[]),(0,_.U)(s=>(s instanceof Array||(s=[]),s.sort((o,n)=>o.name?.localeCompare(n.name)),s.map(o=>new v.nk({...o,qr_code:""})))),(0,y.d)(1)),this._next_page=new O.xQ,this._call_next_page=new O.xQ,this._all_zones_keys=["All",-1,"-1"],this.setup_paging=(0,a.aj)([this._filters,this._org.initialised]).pipe((0,M.b)(500),(0,C.b)(([s,o])=>{if(!o)return;const n=s.date||Date.now(),u=!s.zones||s.zones.some(g=>this._all_zones_keys.includes(g))?[this._org.building.id]:s.zones;this._next_page.next(()=>(0,l.pS)({period_start:(0,T.Z)((0,B.Z)(n)),period_end:(0,T.Z)((0,m.Z)(n)),type:"desk",zones:u.join(","),include_checked_out:!0}).pipe((0,k.K)(g=>(0,h.of)({data:[],total:0,next:null})))),this._call_next_page.next(`RESET_${Date.now()}`)})),this.paged_bookings=(0,a.aj)([this._next_page,this._call_next_page]).pipe((0,U.x)((s,o)=>s[1]===o[1]),(0,x.w)(([s,o])=>(this._loading.next(!0),s?o.includes("RESET")?s().pipe((0,_.U)(n=>({...n,reset:!0})),(0,k.K)(n=>(0,h.of)({data:[],total:0,next:null}))):s().pipe((0,_.U)(n=>({...n,reset:!1})),(0,k.K)(n=>(0,h.of)({data:[],total:0,next:null}))):(0,h.of)({data:[],total:0,next:null,reset:o.includes("RESET")}))),(0,R.R)((s,{data:o,total:n,next:u,reset:g})=>{const L=o;return this._next_page.next(u),g?{list:L,total:n}:{list:[...s.list,...L],total:n}},{list:[],total:0}),(0,C.b)(s=>this._loading.next(!1)),(0,y.d)(1)),this.has_more_pages=this.paged_bookings.pipe((0,_.U)(s=>s.list.length<s.total)),this.bookings=this.paged_bookings.pipe((0,_.U)(s=>s.list)),this.setup_paging.subscribe()}setFilters(t){t.zones?.includes("All")?t.zones=["All",...this._org.levelsForBuilding(this._org.building).map(r=>r.id)]:t.zones&&this._filters.getValue()?.zones?.includes("All")&&(t.zones=[]),this._filters.next({...this._filters.getValue(),...t})}refresh(){this._loading.next(!0),this.timeout("poll",()=>this.setFilters(this._filters.getValue()))}addDesks(t){this._new_desks.next(this._new_desks.getValue().concat(t))}clearNewDesks(){this._filters.next(this._filters.getValue()),this._new_desks.next([])}checkinDesk(t,r=!0){return(0,c.Z)(function*(){console.log("Check-in:",t);const s=yield(0,l.FD)(t.id,r??!0).toPromise().catch(o=>({failed:!0,error:o}));if(s.failed)throw(0,i.cB)(s.error?`Error: ${s.error}`:`Error checking ${r?"in":"out"} desk booking`),s.error;(0,i.t5)(`Checked ${r?"in":"out"} ${t.user_name}.`)})()}approveDesk(t){return(0,c.Z)(function*(){if("failed"===(yield(0,l.jT)(t.id).toPromise().catch(s=>"failed")))return(0,i.cB)("Error approving in desk booking");(0,i.t5)(`Approved desk booking for ${t.user_name} on ${(0,D.Z)(t.date,"MMM do")}.`),t.approved=!0,t.rejected=!1})()}rejectDesk(t){return(0,c.Z)(function*(){if("failed"===(yield(0,l.FP)(t.id).toPromise().catch(s=>"failed")))return(0,i.cB)("Error rejecting in desk booking");(0,i.t5)(`Rejected desk booking for ${t.user_name} on ${(0,D.Z)(t.date,"MMM do")}.`),t.approved=!1,t.rejected=!0})()}giveAccess(t){var r=this;return(0,c.Z)(function*(){const s=yield(0,l.km)(new l.$N({...t,access:!0})).toPromise().catch(o=>"failed");if("failed"===s)return(0,i.cB)("Error giving building access booking host");(0,i.t5)(`Successfully gave building access to ${t.user_name} for desk booking.`),r._desk_bookings=[...r._desk_bookings,s]})()}rejectAllDesks(){var t=this;return(0,c.Z)(function*(){const r=t._desk_bookings||[];if(r.length<=0)return(0,i.QD)("No desks to reject for the selected date");const s=yield(0,i._5)({title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}},t._dialog);"done"===s.reason&&(s.loading("Rejecting all desks for selected date..."),yield Promise.all(r.map(o=>(0,l.FP)(o.id).toPromise())),(0,i.t5)("Successfully rejected all desk bookings for selected date."),s.close())})()}}return d.\u0275fac=function(t){return new(t||d)(E.LFG(v.w7),E.LFG(I.uw))},d.\u0275prov=E.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},5375:(b,P,e)=>{e.d(P,{$N:()=>f.$,fy:()=>p.f,EP:()=>c.E,jT:()=>a.jT,FD:()=>a.FD,ad:()=>a.ad,NP:()=>a.NP,F2:()=>a.F2,pS:()=>a.pS,FP:()=>a.FP,km:()=>a.km,Fo:()=>a.Fo,Wp:()=>a.Wp});var c=e(5554),p=e(8929),f=e(6962),a=(e(1980),e(354));e(9743),e(3174),e(6165),e(4282),e(7121),e(8883),e(4088),e(7304)}}]);
//# sourceMappingURL=common.js.map