"use strict";(self.webpackChunkworkplace=self.webpackChunkworkplace||[]).push([["common"],{8676:(x,h,t)=>{t.d(h,{I:()=>B});var d=t(3070),p=t(9434),E=t(4549),i=t(2995),O=t(1810),v=t(9377),K=t(312),c=t(3200),r=t(4505),I=t(1942),C=t(7716),L=t(4350),U=t(9095),D=t(9128),T=t(823),g=t(522),P=t(6942),n=t(7418),A=t(8759),M=t(9676);let B=(()=>{class o extends E.KG{constructor(e){super(),this._settings=e,this._poll=new r.X(0),this._options=new r.X({start:Date.now()}),this._loading=new r.X(""),this._schedule=new r.X([]),this.options=this._options.asObservable(),this.loading=this._loading.asObservable(),this.schedule=this._loading.asObservable(),this.calendars=(0,I.H)(1e3).pipe((0,U.w)(_=>(0,p.yJ)()),(0,D.d)(1)),this.events=(0,C.aj)([this._options,this._poll]).pipe((0,T.b)(1e3),(0,g.zg)(([_])=>{this._loading.next("Loading schedule...");const a={period_start:(0,O.Z)((0,v.Z)(_.start)),period_end:(0,O.Z)((0,K.Z)((0,c.Z)(_.start),6))};return _.calendar&&(a.calendar=_.calendar),this._schedule.next(this._schedule.getValue().filter(s=>!(0,E.MZ)(1e3*a.period_start,1e3*a.period_end,s.date,s.date+60*s.duration*1e3))),(0,L.D)([this._settings.get("app.no_user_calendar")?(0,d.F2)({...a,type:"room"}).pipe((0,P.U)(s=>s.map(l=>(0,i.Yd)(l))),(0,n.K)(s=>[])):(0,i.u$)({...a}).pipe((0,n.K)(s=>[])),(0,d.F2)({...a,type:"desk"}).pipe((0,n.K)(s=>[])),(0,d.F2)({...a,type:"parking"}).pipe((0,n.K)(s=>[]))])}),(0,P.U)(([_,a])=>{const s=[...this._schedule.getValue(),..._,...a.filter(l=>"declined"!==l.status)].sort((l,W)=>l.date-W.date);return this._schedule.next((0,E.Tw)(s,"id")),s}),(0,n.K)(_=>[]),(0,A.b)(_=>this._loading.next("")),(0,D.d)(1))}startPolling(e=15e3){this.interval("poll",()=>this._poll.next(Date.now()),e)}stopPolling(){this.clearInterval("poll")}setOptions(e){this._options.next({...this._options.getValue(),...e})}}return o.\u0275fac=function(e){return new(e||o)(M.LFG(E.gb))},o.\u0275prov=M.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})()}}]);
//# sourceMappingURL=common.js.map