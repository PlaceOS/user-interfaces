"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["common"],{34381:(L,B,t)=>{t.d(B,{H:()=>I});var E=t(71670),D=t(47298),g=t(70462),c=t(9681),P=t(32484),p=t(28159),M=t(95933),O=t(36520),a=t(47422),u=t(58175),x=t(680),v=t(15746),C=t(45083),U=t(36932),k=t(67343),T=t(57016),K=t(4512),m=t(14884),l=t(78466),_=t(34592),A=t(93121),f=(t(89680),t(29039)),j=t(17401);let I=(()=>{class r extends _.cx{get new_desk_count(){return this._new_desks.getValue()?.length||0}nextPage(){this._call_next_page.next(`NEXT_${Date.now()}`)}constructor(s,i){super(),this._org=s,this._dialog=i,this._filters=new g.X({}),this._new_desks=new g.X([]),this._desk_bookings=[],this._loading=new g.X(!1),this.new_desks=this._new_desks.asObservable(),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,M.b)(500),(0,O.w)(e=>{const n=e.zones||[];return n&&!n.includes("All")?(0,D.rlq)(n[0],"desks").pipe((0,a.U)(o=>o.details instanceof Array?o.details:[]),(0,u.K)(o=>(0,c.of)([]))):(0,D.BW_)(this._org.building?.id,{name:"desks"}).pipe((0,a.U)(o=>o.map(d=>d.metadata?.desks?.details||[]).reduce((d,h)=>[...d,...h],[])),(0,u.K)(o=>(0,c.of)([])))}),(0,a.U)(e=>(e instanceof Array||(e=[]),e.sort((n,o)=>n.name?.localeCompare(o.name)),e.map(n=>new A.nk({...n,qr_code:""})))),(0,x.d)(1)),this._next_page=new P.xQ,this._call_next_page=new P.xQ,this._all_zones_keys=["All",-1,"-1"],this.setup_paging=(0,p.aj)([this._filters,this._org.initialised]).pipe((0,M.b)(500),(0,v.b)(([e,n])=>{if(!n)return;const o=e.date||Date.now(),d=!e.zones||e.zones.some(h=>this._all_zones_keys.includes(h))?[this._org.building.id]:e.zones;this._next_page.next(()=>(0,l.pS)({period_start:(0,k.Z)((0,T.Z)(o)),period_end:(0,k.Z)((0,K.Z)(o)),type:"desk",zones:d.join(","),include_checked_out:!0}).pipe((0,u.K)(h=>(0,c.of)({data:[],total:0,next:null})))),this._call_next_page.next(`RESET_${Date.now()}`)})),this.paged_bookings=(0,p.aj)([this._next_page,this._call_next_page]).pipe((0,C.x)((e,n)=>e[1]===n[1]),(0,O.w)(([e,n])=>(this._loading.next(!0),e?n.includes("RESET")?e().pipe((0,a.U)(o=>({...o,reset:!0})),(0,u.K)(o=>(0,c.of)({data:[],total:0,next:null}))):e().pipe((0,a.U)(o=>({...o,reset:!1})),(0,u.K)(o=>(0,c.of)({data:[],total:0,next:null}))):(0,c.of)({data:[],total:0,next:null,reset:n.includes("RESET")}))),(0,U.R)((e,{data:n,total:o,next:d,reset:h})=>{const R=n;return this._next_page.next(d),h?{list:R,total:o}:{list:[...e.list,...R],total:o}},{list:[],total:0}),(0,v.b)(e=>this._loading.next(!1)),(0,x.d)(1)),this.has_more_pages=this.paged_bookings.pipe((0,a.U)(e=>e.list.length<e.total)),this.bookings=this.paged_bookings.pipe((0,a.U)(e=>e.list)),this.setup_paging.subscribe()}setFilters(s){s.zones?.includes("All")?s.zones=["All",...this._org.levelsForBuilding(this._org.building).map(i=>i.id)]:s.zones&&this._filters.getValue()?.zones?.includes("All")&&(s.zones=[]),this._filters.next({...this._filters.getValue(),...s})}refresh(){this._loading.next(!0),this.timeout("poll",()=>this.setFilters(this._filters.getValue()))}addDesks(s){this._new_desks.next(this._new_desks.getValue().concat(s))}removeNewDesk(s){this._filters.next(this._filters.getValue()),this._new_desks.next(this._new_desks.getValue().filter(i=>i.id!==s.id))}clearNewDesks(){this._filters.next(this._filters.getValue()),this._new_desks.next([])}checkinDesk(s,i=!0){return(0,E.Z)(function*(){const e=yield(0,l.FD)(s.id,i??!0).toPromise().catch(n=>({failed:!0,error:n}));if(e.failed)throw(0,_.cB)(e.error?`Error: ${e.error}`:`Error checking ${i?"in":"out"} desk booking`),e.error;(0,_.t5)(`Checked ${i?"in":"out"} ${s.user_name}.`)})()}approveDesk(s){return(0,E.Z)(function*(){if("failed"===(yield(0,l.jT)(s.id).toPromise().catch(e=>"failed")))return(0,_.cB)("Error approving in desk booking");(0,_.t5)(`Approved desk booking for ${s.user_name} on ${(0,m.Z)(s.date,"MMM do")}.`),s.approved=!0,s.rejected=!1})()}rejectDesk(s){return(0,E.Z)(function*(){if("failed"===(yield(0,l.FP)(s.id).toPromise().catch(e=>"failed")))return(0,_.cB)("Error rejecting in desk booking");(0,_.t5)(`Rejected desk booking for ${s.user_name} on ${(0,m.Z)(s.date,"MMM do")}.`),s.approved=!1,s.rejected=!0})()}giveAccess(s){var i=this;return(0,E.Z)(function*(){const e=yield(0,l.km)(new l.$N({...s,access:!0})).toPromise().catch(n=>"failed");if("failed"===e)return(0,_.cB)("Error giving building access booking host");(0,_.t5)(`Successfully gave building access to ${s.user_name} for desk booking.`),i._desk_bookings=[...i._desk_bookings,e]})()}rejectAllDesks(){var s=this;return(0,E.Z)(function*(){const i=s._desk_bookings||[];if(i.length<=0)return(0,_.QD)("No desks to reject for the selected date");const e=yield(0,_._5)({title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}},s._dialog);"done"===e.reason&&(e.loading("Rejecting all desks for selected date..."),yield Promise.all(i.map(n=>(0,l.FP)(n.id).toPromise())),(0,_.t5)("Successfully rejected all desk bookings for selected date."),e.close())})()}static#e=this.\u0275fac=function(i){return new(i||r)(f.LFG(A.w7),f.LFG(j.uw))};static#s=this.\u0275prov=f.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})()}}]);
//# sourceMappingURL=common.js.map