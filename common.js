"use strict";(self.webpackChunkworkplace=self.webpackChunkworkplace||[]).push([["common"],{7625:(A,C,t)=>{t.d(C,{I:()=>L});var x=t(1670),O=t(9638),D=t(232),g=t(1299),l=t(1810),f=t(9377),P=t(3200),u=t(4505),E=t(7716),v=t(8759),y=t(9095),I=t(6942),M=t(7418),o=t(9128),K=t(9676);let L=(()=>{class i extends D.KG{constructor(a){super(),this._settings=a,this._poll=new u.X(0),this._loading=new u.X(!1),this._filters=new u.X({shown_types:["event","desk","parking","visitor"]}),this._date=new u.X(Date.now()),this._update=(0,E.aj)([this._date,this._poll]).pipe((0,v.b)(e=>this._loading.next(!0))),this.events=this._update.pipe((0,y.w)(([e])=>{const s={period_start:(0,l.Z)((0,f.Z)(e)),period_end:(0,l.Z)((0,P.Z)(e))};return this._settings.get("app.no_user_calendar")?(0,O.F2)({...s,type:"room"}).pipe((0,I.U)(n=>n.map(d=>(0,g.Yd)(d))),(0,M.K)(n=>[])):(0,g.u$)({...s}).pipe((0,M.K)(n=>[]))}),(0,v.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,o.d)(1)),this.visitors=this._update.pipe((0,y.w)(([e])=>(0,O.F2)({period_start:(0,l.Z)((0,f.Z)(e)),period_end:(0,l.Z)((0,P.Z)(e)),type:"visitor"}).pipe((0,M.K)(s=>(console.error(s),[])))),(0,v.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,o.d)(1)),this.desks=this._update.pipe((0,y.w)(([e])=>(0,O.F2)({period_start:(0,l.Z)((0,f.Z)(e)),period_end:(0,l.Z)((0,P.Z)(e)),type:"desk"}).pipe((0,M.K)(s=>(console.error(s),[])))),(0,v.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,o.d)(1)),this.parking=this._update.pipe((0,y.w)(([e])=>(0,O.F2)({period_start:(0,l.Z)((0,f.Z)(e)),period_end:(0,l.Z)((0,P.Z)(e)),type:"parking"}).pipe((0,M.K)(s=>[]))),(0,v.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,o.d)(1)),this.bookings=(0,E.aj)([this.events,this.visitors,this.desks,this.parking]).pipe((0,I.U)(([e,s,n,d])=>[...e,...s,...n,...d].sort((r,_)=>r.date-_.date))),this.filtered_bookings=(0,E.aj)([this.bookings,this._filters]).pipe((0,I.U)(([e,s])=>e.filter(n=>n instanceof g.ym&&s?.shown_types?.includes("event")||s?.shown_types?.includes(n.booking_type)))),this.filters=this._filters.asObservable(),this.date=this._date.asObservable(),this.loading=this._loading.asObservable()}startPolling(a=15e3){return this.interval("poll",()=>this._poll.next(Date.now()),a),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setDate(a){this._date.next(a)}removeItem(a){this._poll.next(Date.now())}toggleType(a,e=!1){var s=this;return(0,x.Z)(function*(){const n=s._filters.getValue()||{shown_types:[]},{shown_types:d}=n;d&&(d.includes(a)||e)?s._filters.next({...n,shown_types:d.filter(r=>r!==a)}):s._filters.next({...n,shown_types:[...d,a]})})()}}return i.\u0275fac=function(a){return new(a||i)(K.LFG(D.gb))},i.\u0275prov=K.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()},8676:(A,C,t)=>{t.d(C,{I:()=>s});var x=t(9638),O=t(9434),D=t(232),g=t(1299),l=t(1810),f=t(9377),P=t(312),u=t(3200),E=t(4505),v=t(1942),y=t(7716),I=t(4350),M=t(9095),o=t(9128),K=t(823),L=t(522),i=t(6942),U=t(7418),a=t(8759),e=t(9676);let s=(()=>{class n extends D.KG{constructor(r){super(),this._settings=r,this._poll=new E.X(0),this._options=new E.X({start:Date.now()}),this._loading=new E.X(""),this._schedule=new E.X([]),this.options=this._options.asObservable(),this.loading=this._loading.asObservable(),this.schedule=this._loading.asObservable(),this.calendars=(0,v.H)(1e3).pipe((0,M.w)(_=>(0,O.yJ)()),(0,o.d)(1)),this.events=(0,y.aj)([this._options,this._poll]).pipe((0,K.b)(1e3),(0,L.zg)(([_])=>{this._loading.next("Loading schedule...");const p={period_start:(0,l.Z)((0,f.Z)(_.start)),period_end:(0,l.Z)((0,P.Z)((0,u.Z)(_.start),6))};return _.calendar&&(p.calendar=_.calendar),this._schedule.next(this._schedule.getValue().filter(h=>!(0,D.MZ)(1e3*p.period_start,1e3*p.period_end,h.date,h.date+60*h.duration*1e3))),(0,I.D)([!0===this._settings.get("app.no_user_calendar")?(0,x.F2)({...p,type:"room"}).pipe((0,i.U)(h=>h.map(c=>(0,g.Yd)(c)))):(0,g.u$)({...p}),(0,x.F2)({...p,type:"desk"}),(0,x.F2)({...p,type:"parking"})]).pipe((0,U.K)(h=>[]))}),(0,i.U)(([_,p])=>{const h=[...this._schedule.getValue(),..._,...p.filter(c=>"declined"!==c.status)].sort((c,T)=>c.date-T.date);return this._schedule.next((0,D.Tw)(h,"id")),h}),(0,U.K)(_=>[]),(0,a.b)(_=>this._loading.next("")),(0,o.d)(1))}startPolling(r=15e3){this.interval("poll",()=>this._poll.next(Date.now()),r)}stopPolling(){this.clearInterval("poll")}setOptions(r){this._options.next({...this._options.getValue(),...r})}}return n.\u0275fac=function(r){return new(r||n)(e.LFG(D.gb))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})()},9434:(A,C,t)=>{t.d(C,{ot:()=>L,yJ:()=>o.yJ}),t(4603);var O=t(1670),D=t(4505),g=t(8759),l=t(9128),f=t(5670),P=t(1810),u=t(9377),E=t(3200),v=t(2317),y=t(8939),I=t(719),M=t(565),o=t(6217),K=t(9676);let L=(()=>{class i extends y.K{constructor(a,e){super(),this._org=a,this._settings=e,this._calendars=new D.X([]),this.calendar_list=(0,o.yJ)().pipe((0,g.b)(s=>this._calendars.next(s)),(0,l.d)(1)),this.query=()=>(0,o.yJ)(),this.freeBusy=s=>(0,o.tS)(s,this._org),this.availability=s=>(0,o.v7)(s),this._org.initialised.pipe((0,f.P)(s=>s)).subscribe(()=>this.init())}init(){var a=this;return(0,O.Z)(function*(){a._settings.get("app.no_user_calendar")||a._initialised.next(!0)})()}get calendars(){return this._calendars.getValue()}getFreeBusyDate(a,e){return(0,o.tS)({period_start:(0,P.Z)((0,u.Z)(a)),period_end:(0,P.Z)((0,E.Z)(a)),calendars:e},this._org)}checkSpacesAvailability(a,e,s,n){return(0,O.Z)(function*(){const d=yield(0,o.v7)({period_start:e,period_end:s,system_ids:a.join(",")}).toPromise(),r=new Date(n?.date).valueOf(),_=(0,v.Z)(r,n?.duration).valueOf();return!!d.every(h=>{const c=h.availability;if(n&&h.id===n.system?.email){const T=c.findIndex(B=>B.date>=r&&(0,v.Z)(B.date,B.duration).valueOf()<=_);-1!==T&&c.splice(T,1)}return!c.length})})()}}return i.\u0275fac=function(a){return new(a||i)(K.LFG(M.w),K.LFG(I.g))},i.\u0275prov=K.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})()}}]);
//# sourceMappingURL=common.js.map