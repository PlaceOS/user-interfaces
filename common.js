"use strict";(self.webpackChunkworkplace=self.webpackChunkworkplace||[]).push([["common"],{7625:(B,u,t)=>{t.d(u,{I:()=>A});var g=t(1670),c=t(3070),p=t(4549),O=t(1187),i=t(1810),K=t(9377),f=t(3200),D=t(4505),h=t(7716),P=t(8759),I=t(9095),U=t(6942),M=t(7418),v=t(9128),T=t(9676);let A=(()=>{class r extends p.KG{constructor(o){super(),this._settings=o,this._poll=new D.X(0),this._loading=new D.X(!1),this._filters=new D.X({shown_types:["event","desk","parking"]}),this._date=new D.X(Date.now()),this._update=(0,h.aj)([this._date,this._poll]).pipe((0,P.b)(_=>this._loading.next(!0))),this.events=this._update.pipe((0,I.w)(([_])=>{const e={period_start:(0,i.Z)((0,K.Z)(_)),period_end:(0,i.Z)((0,f.Z)(_))};return this._settings.get("app.no_user_calendar")?(0,c.F2)({...e,type:"room"}).pipe((0,U.U)(s=>s.map(a=>(0,O.Yd)(a))),(0,M.K)(s=>[])):(0,O.u$)({...e}).pipe((0,M.K)(s=>[]))}),(0,P.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.desks=this._update.pipe((0,I.w)(([_])=>(0,c.F2)({period_start:(0,i.Z)((0,K.Z)(_)),period_end:(0,i.Z)((0,f.Z)(_)),type:"desk"}).pipe((0,M.K)(e=>[]))),(0,P.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.parking=this._update.pipe((0,I.w)(([_])=>(0,c.F2)({period_start:(0,i.Z)((0,K.Z)(_)),period_end:(0,i.Z)((0,f.Z)(_)),type:"parking"}).pipe((0,M.K)(e=>[]))),(0,P.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.bookings=(0,h.aj)([this.events,this.desks,this.parking]).pipe((0,U.U)(([_,e,s])=>[..._,...e,...s].sort((a,n)=>a.date-n.date))),this.filtered_bookings=(0,h.aj)([this.bookings,this._filters]).pipe((0,U.U)(([_,e])=>_.filter(s=>s instanceof O.ym&&e?.shown_types?.includes("event")||e?.shown_types?.includes(s.type)))),this.filters=this._filters.asObservable(),this.date=this._date.asObservable(),this.loading=this._loading.asObservable()}startPolling(o=15e3){return this.interval("poll",()=>this._poll.next(Date.now()),o),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setDate(o){this._date.next(o)}toggleType(o,_=!1){var e=this;return(0,g.Z)(function*(){const s=e._filters.getValue()||{shown_types:[]},{shown_types:a}=s;a&&(a.includes(o)||_)?e._filters.next({...s,shown_types:a.filter(n=>n!==o)}):e._filters.next({...s,shown_types:[...a,o]}),console.log("Filters:",e._filters.getValue())})()}}return r.\u0275fac=function(o){return new(o||r)(T.LFG(p.gb))},r.\u0275prov=T.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()},8676:(B,u,t)=>{t.d(u,{I:()=>e});var g=t(3070),c=t(9434),p=t(4549),O=t(1187),i=t(1810),K=t(9377),f=t(312),D=t(3200),h=t(4505),P=t(1942),I=t(7716),U=t(4350),M=t(9095),v=t(9128),T=t(823),A=t(522),r=t(6942),C=t(7418),o=t(8759),_=t(9676);let e=(()=>{class s extends p.KG{constructor(n){super(),this._settings=n,this._poll=new h.X(0),this._options=new h.X({start:Date.now()}),this._loading=new h.X(""),this._schedule=new h.X([]),this.options=this._options.asObservable(),this.loading=this._loading.asObservable(),this.schedule=this._loading.asObservable(),this.calendars=(0,P.H)(1e3).pipe((0,M.w)(l=>(0,c.yJ)()),(0,v.d)(1)),this.events=(0,I.aj)([this._options,this._poll]).pipe((0,T.b)(1e3),(0,A.zg)(([l])=>{this._loading.next("Loading schedule...");const d={period_start:(0,i.Z)((0,K.Z)(l.start)),period_end:(0,i.Z)((0,f.Z)((0,D.Z)(l.start),6))};return l.calendar&&(d.calendar=l.calendar),this._schedule.next(this._schedule.getValue().filter(E=>!(0,p.MZ)(1e3*d.period_start,1e3*d.period_end,E.date,E.date+60*E.duration*1e3))),(0,U.D)([!0===this._settings.get("app.no_user_calendar")?(0,g.F2)({...d,type:"room"}).pipe((0,r.U)(E=>E.map(L=>(0,O.Yd)(L)))):(0,O.u$)({...d}),(0,g.F2)({...d,type:"desk"}),(0,g.F2)({...d,type:"parking"})]).pipe((0,C.K)(E=>[]))}),(0,r.U)(([l,d])=>{const E=[...this._schedule.getValue(),...l,...d.filter(L=>"declined"!==L.status)].sort((L,R)=>L.date-R.date);return this._schedule.next((0,p.Tw)(E,"id")),E}),(0,C.K)(l=>[]),(0,o.b)(l=>this._loading.next("")),(0,v.d)(1))}startPolling(n=15e3){this.interval("poll",()=>this._poll.next(Date.now()),n)}stopPolling(){this.clearInterval("poll")}setOptions(n){this._options.next({...this._options.getValue(),...n})}}return s.\u0275fac=function(n){return new(n||s)(_.LFG(p.gb))},s.\u0275prov=_.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()}}]);
//# sourceMappingURL=common.js.map