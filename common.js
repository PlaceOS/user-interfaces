"use strict";(self.webpackChunkworkplace=self.webpackChunkworkplace||[]).push([["common"],{7625:(B,C,t)=>{t.d(C,{I:()=>A});var g=t(1670),c=t(3070),p=t(232),O=t(1187),i=t(1810),K=t(9377),f=t(3200),P=t(4505),h=t(7716),D=t(8759),I=t(9095),U=t(6942),M=t(7418),v=t(9128),T=t(9676);let A=(()=>{class r extends p.KG{constructor(o){super(),this._settings=o,this._poll=new P.X(0),this._loading=new P.X(!1),this._filters=new P.X({shown_types:["event","desk","parking"]}),this._date=new P.X(Date.now()),this._update=(0,h.aj)([this._date,this._poll]).pipe((0,D.b)(s=>this._loading.next(!0))),this.events=this._update.pipe((0,I.w)(([s])=>{const e={period_start:(0,i.Z)((0,K.Z)(s)),period_end:(0,i.Z)((0,f.Z)(s))};return this._settings.get("app.no_user_calendar")?(0,c.F2)({...e,type:"room"}).pipe((0,U.U)(_=>_.map(a=>(0,O.Yd)(a))),(0,M.K)(_=>[])):(0,O.u$)({...e}).pipe((0,M.K)(_=>[]))}),(0,D.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.desks=this._update.pipe((0,I.w)(([s])=>(0,c.F2)({period_start:(0,i.Z)((0,K.Z)(s)),period_end:(0,i.Z)((0,f.Z)(s)),type:"desk"}).pipe((0,M.K)(e=>(console.error(e),[])))),(0,D.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.parking=this._update.pipe((0,I.w)(([s])=>(0,c.F2)({period_start:(0,i.Z)((0,K.Z)(s)),period_end:(0,i.Z)((0,f.Z)(s)),type:"parking"}).pipe((0,M.K)(e=>[]))),(0,D.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.bookings=(0,h.aj)([this.events,this.desks,this.parking]).pipe((0,D.b)(s=>console.log("Data:",s)),(0,U.U)(([s,e,_])=>[...s,...e,..._].sort((a,n)=>a.date-n.date))),this.filtered_bookings=(0,h.aj)([this.bookings,this._filters]).pipe((0,U.U)(([s,e])=>s.filter(_=>_ instanceof O.ym&&e?.shown_types?.includes("event")||e?.shown_types?.includes(_.booking_type)))),this.filters=this._filters.asObservable(),this.date=this._date.asObservable(),this.loading=this._loading.asObservable()}startPolling(o=15e3){return this.interval("poll",()=>this._poll.next(Date.now()),o),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setDate(o){this._date.next(o)}toggleType(o,s=!1){var e=this;return(0,g.Z)(function*(){const _=e._filters.getValue()||{shown_types:[]},{shown_types:a}=_;a&&(a.includes(o)||s)?e._filters.next({..._,shown_types:a.filter(n=>n!==o)}):e._filters.next({..._,shown_types:[...a,o]}),console.log("Filters:",e._filters.getValue())})()}}return r.\u0275fac=function(o){return new(o||r)(T.LFG(p.gb))},r.\u0275prov=T.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})()},8676:(B,C,t)=>{t.d(C,{I:()=>e});var g=t(3070),c=t(9434),p=t(232),O=t(1187),i=t(1810),K=t(9377),f=t(312),P=t(3200),h=t(4505),D=t(1942),I=t(7716),U=t(4350),M=t(9095),v=t(9128),T=t(823),A=t(522),r=t(6942),u=t(7418),o=t(8759),s=t(9676);let e=(()=>{class _ extends p.KG{constructor(n){super(),this._settings=n,this._poll=new h.X(0),this._options=new h.X({start:Date.now()}),this._loading=new h.X(""),this._schedule=new h.X([]),this.options=this._options.asObservable(),this.loading=this._loading.asObservable(),this.schedule=this._loading.asObservable(),this.calendars=(0,D.H)(1e3).pipe((0,M.w)(l=>(0,c.yJ)()),(0,v.d)(1)),this.events=(0,I.aj)([this._options,this._poll]).pipe((0,T.b)(1e3),(0,A.zg)(([l])=>{this._loading.next("Loading schedule...");const d={period_start:(0,i.Z)((0,K.Z)(l.start)),period_end:(0,i.Z)((0,f.Z)((0,P.Z)(l.start),6))};return l.calendar&&(d.calendar=l.calendar),this._schedule.next(this._schedule.getValue().filter(E=>!(0,p.MZ)(1e3*d.period_start,1e3*d.period_end,E.date,E.date+60*E.duration*1e3))),(0,U.D)([!0===this._settings.get("app.no_user_calendar")?(0,g.F2)({...d,type:"room"}).pipe((0,r.U)(E=>E.map(L=>(0,O.Yd)(L)))):(0,O.u$)({...d}),(0,g.F2)({...d,type:"desk"}),(0,g.F2)({...d,type:"parking"})]).pipe((0,u.K)(E=>[]))}),(0,r.U)(([l,d])=>{const E=[...this._schedule.getValue(),...l,...d.filter(L=>"declined"!==L.status)].sort((L,R)=>L.date-R.date);return this._schedule.next((0,p.Tw)(E,"id")),E}),(0,u.K)(l=>[]),(0,o.b)(l=>this._loading.next("")),(0,v.d)(1))}startPolling(n=15e3){this.interval("poll",()=>this._poll.next(Date.now()),n)}stopPolling(){this.clearInterval("poll")}setOptions(n){this._options.next({...this._options.getValue(),...n})}}return _.\u0275fac=function(n){return new(n||_)(s.LFG(p.gb))},_.\u0275prov=s.Yz7({token:_,factory:_.\u0275fac,providedIn:"root"}),_})()}}]);
//# sourceMappingURL=common.js.map