"use strict";(self.webpackChunkworkplace=self.webpackChunkworkplace||[]).push([["common"],{7625:(B,L,t)=>{t.d(L,{I:()=>P});var U=t(1670),M=t(9638),c=t(232),u=t(1299),o=t(1810),y=t(9377),g=t(3200),K=t(4505),O=t(7716),D=t(8759),f=t(9095),x=t(6942),r=t(7418),v=t(9128),C=t(9676);let P=(()=>{class p extends c.KG{constructor(n){super(),this._settings=n,this._poll=new K.X(0),this._loading=new K.X(!1),this._filters=new K.X({shown_types:["event","desk","parking","visitor"]}),this._date=new K.X(Date.now()),this._update=(0,O.aj)([this._date,this._poll]).pipe((0,D.b)(s=>this._loading.next(!0))),this.events=this._update.pipe((0,f.w)(([s])=>{const e={period_start:(0,o.Z)((0,y.Z)(s)),period_end:(0,o.Z)((0,g.Z)(s))};return this._settings.get("app.no_user_calendar")?(0,M.F2)({...e,type:"room"}).pipe((0,x.U)(a=>a.map(l=>(0,u.Yd)(l))),(0,r.K)(a=>[])):(0,u.u$)({...e}).pipe((0,r.K)(a=>[]))}),(0,D.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.visitors=this._update.pipe((0,f.w)(([s])=>(0,M.F2)({period_start:(0,o.Z)((0,y.Z)(s)),period_end:(0,o.Z)((0,g.Z)(s)),type:"visitor"}).pipe((0,r.K)(e=>(console.error(e),[])))),(0,D.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.desks=this._update.pipe((0,f.w)(([s])=>(0,M.F2)({period_start:(0,o.Z)((0,y.Z)(s)),period_end:(0,o.Z)((0,g.Z)(s)),type:"desk"}).pipe((0,r.K)(e=>(console.error(e),[])))),(0,D.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.parking=this._update.pipe((0,f.w)(([s])=>(0,M.F2)({period_start:(0,o.Z)((0,y.Z)(s)),period_end:(0,o.Z)((0,g.Z)(s)),type:"parking"}).pipe((0,r.K)(e=>[]))),(0,D.b)(()=>this.timeout("end_loading",()=>this._loading.next(!1))),(0,v.d)(1)),this.bookings=(0,O.aj)([this.events,this.visitors,this.desks,this.parking]).pipe((0,x.U)(([s,e,a,l])=>[...s,...e,...a,...l].sort((_,h)=>_.date-h.date))),this.filtered_bookings=(0,O.aj)([this.bookings,this._filters]).pipe((0,x.U)(([s,e])=>s.filter(a=>a instanceof u.ym&&e?.shown_types?.includes("event")||e?.shown_types?.includes(a.booking_type)))),this.filters=this._filters.asObservable(),this.date=this._date.asObservable(),this.loading=this._loading.asObservable()}startPolling(n=15e3){return this.interval("poll",()=>this._poll.next(Date.now()),n),()=>this.stopPolling()}stopPolling(){this.clearInterval("poll")}setDate(n){this._date.next(n)}toggleType(n,s=!1){var e=this;return(0,U.Z)(function*(){const a=e._filters.getValue()||{shown_types:[]},{shown_types:l}=a;l&&(l.includes(n)||s)?e._filters.next({...a,shown_types:l.filter(_=>_!==n)}):e._filters.next({...a,shown_types:[...l,n]})})()}}return p.\u0275fac=function(n){return new(n||p)(C.LFG(c.gb))},p.\u0275prov=C.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})()},8676:(B,L,t)=>{t.d(L,{I:()=>e});var U=t(9638),M=t(9434),c=t(232),u=t(1299),o=t(1810),y=t(9377),g=t(312),K=t(3200),O=t(4505),D=t(1942),f=t(7716),x=t(4350),r=t(9095),v=t(9128),C=t(823),P=t(522),p=t(6942),i=t(7418),n=t(8759),s=t(9676);let e=(()=>{class a extends c.KG{constructor(_){super(),this._settings=_,this._poll=new O.X(0),this._options=new O.X({start:Date.now()}),this._loading=new O.X(""),this._schedule=new O.X([]),this.options=this._options.asObservable(),this.loading=this._loading.asObservable(),this.schedule=this._loading.asObservable(),this.calendars=(0,D.H)(1e3).pipe((0,r.w)(h=>(0,M.yJ)()),(0,v.d)(1)),this.events=(0,f.aj)([this._options,this._poll]).pipe((0,C.b)(1e3),(0,P.zg)(([h])=>{this._loading.next("Loading schedule...");const E={period_start:(0,o.Z)((0,y.Z)(h.start)),period_end:(0,o.Z)((0,g.Z)((0,K.Z)(h.start),6))};return h.calendar&&(E.calendar=h.calendar),this._schedule.next(this._schedule.getValue().filter(d=>!(0,c.MZ)(1e3*E.period_start,1e3*E.period_end,d.date,d.date+60*d.duration*1e3))),(0,x.D)([!0===this._settings.get("app.no_user_calendar")?(0,U.F2)({...E,type:"room"}).pipe((0,p.U)(d=>d.map(I=>(0,u.Yd)(I)))):(0,u.u$)({...E}),(0,U.F2)({...E,type:"desk"}),(0,U.F2)({...E,type:"parking"})]).pipe((0,i.K)(d=>[]))}),(0,p.U)(([h,E])=>{const d=[...this._schedule.getValue(),...h,...E.filter(I=>"declined"!==I.status)].sort((I,T)=>I.date-T.date);return this._schedule.next((0,c.Tw)(d,"id")),d}),(0,i.K)(h=>[]),(0,n.b)(h=>this._loading.next("")),(0,v.d)(1))}startPolling(_=15e3){this.interval("poll",()=>this._poll.next(Date.now()),_)}stopPolling(){this.clearInterval("poll")}setOptions(_){this._options.next({...this._options.getValue(),..._})}}return a.\u0275fac=function(_){return new(_||a)(s.LFG(c.gb))},a.\u0275prov=s.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},9434:(B,L,t)=>{t.d(L,{ot:()=>C,yJ:()=>r.yJ}),t(4603);var M=t(1670),c=t(4505),u=t(8759),o=t(9128),y=t(5670),g=t(1810),K=t(9377),O=t(3200),D=t(2317),f=t(232),x=t(6221),r=t(6217),v=t(9676);let C=(()=>{class P extends f.KG{constructor(i,n){super(),this._org=i,this._settings=n,this._calendars=new c.X([]),this.calendar_list=(0,r.yJ)().pipe((0,u.b)(s=>this._calendars.next(s)),(0,o.d)(1)),this.query=()=>(0,r.yJ)(),this.freeBusy=s=>(0,r.tS)(s,this._org),this.availability=s=>(0,r.v7)(s),this._org.initialised.pipe((0,y.P)(s=>s)).subscribe(()=>this.init())}init(){var i=this;return(0,M.Z)(function*(){i._settings.get("app.no_user_calendar")||i._initialised.next(!0)})()}get calendars(){return this._calendars.getValue()}getFreeBusyDate(i,n){return(0,r.tS)({period_start:(0,g.Z)((0,K.Z)(i)),period_end:(0,g.Z)((0,O.Z)(i)),calendars:n},this._org)}checkSpacesAvailability(i,n,s,e){return(0,M.Z)(function*(){const a=yield(0,r.v7)({period_start:n,period_end:s,system_ids:i.join(",")}).toPromise(),l=new Date(e?.date).valueOf(),_=(0,D.Z)(l,e?.duration).valueOf();return!!a.every(E=>{const d=E.availability;if(e&&E.id===e.system?.email){const I=d.findIndex(T=>T.date>=l&&(0,D.Z)(T.date,T.duration).valueOf()<=_);-1!==I&&d.splice(I,1)}return!d.length})})()}}return P.\u0275fac=function(i){return new(i||P)(v.LFG(x.w7),v.LFG(f.gb))},P.\u0275prov=v.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"}),P})()}}]);
//# sourceMappingURL=common.js.map