"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["common"],{9519:(b,O,t)=>{t.d(O,{H:()=>U});var l=t(1670),g=t(4505),E=t(823),f=t(9095),h=t(6942),v=t(7418),D=t(9128),m=t(5670),p=t(9377),A=t(3200),P=t(5148),r=t(9669),a=t(9112),k=t(3690),M=t(3619),B=t(2921),C=t(6168),u=t(2560),I=t(1484);let U=(()=>{class c extends a.KG{constructor(e,i){super(),this._org=e,this._dialog=i,this._filters=new g.X({}),this._new_desks=new g.X([]),this._desk_bookings=[],this._desks=[],this._loading=new g.X(!1),this.new_desks=this._new_desks.asObservable(),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,E.b)(500),(0,f.w)(s=>{const o=s.zones||[];return o.includes("All")?(0,k.BW_)(this._org.building?.id,{name:"desks"}).pipe((0,h.U)(n=>n.map(_=>_.metadata.desks.details).reduce((_,d)=>[..._,...d],[]))):(0,k.rlq)(o[0],"desks").pipe((0,h.U)(n=>n.details))}),(0,v.K)(s=>[]),(0,h.U)(s=>(s instanceof Array||(s=[]),s.sort((o,n)=>o.name.localeCompare(n.name)),this._desks=s.map(o=>new M.nk({...o,qr_code:""})),this._desks)),(0,D.d)(1)),this.bookings=this._filters.pipe((0,E.b)(500),(0,f.w)(s=>{this._loading.next(!0);const o=s.date?new Date(s.date):new Date;let n=(s.zones||[]).filter(_=>-1!==_&&"-1"!==_&&"All"!==_);return n?.length||(n=this._org.levelsForBuilding(this._org.building).map(_=>_.id)),(0,r.F2)({period_start:Math.floor((0,p.Z)(o).valueOf()/1e3),period_end:Math.floor((0,A.Z)(o).valueOf()/1e3),type:"desk",zones:(n||[]).join(",")})}),(0,h.U)(s=>(s.sort((o,n)=>o.date-n.date),this._desk_bookings=s.map(o=>new r.$N({...o,extension_data:{...o.extension_data,checkin_qr_code:(0,C.w)(`/workplace/#/book/code?checkin=${encodeURIComponent(o.asset_id)}`)}})),this._loading.next(!1),s)),(0,D.d)(1))}get new_desk_count(){return this._new_desks.getValue()?.length||0}setFilters(e){e.zones?.includes("All")?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(i=>i.id)]:e.zones&&this._filters.getValue()?.zones?.includes("All")&&(e.zones=[]),this._filters.next({...this._filters.getValue(),...e})}startPolling(e=3e4){this.interval("poll",()=>this.setFilters(this._filters.getValue()),e)}stopPolling(){this.clearInterval("poll")}addDesks(e){this._new_desks.next(this._new_desks.getValue().concat(e))}clearNewDesks(){this._new_desks.next([])}checkinDesk(e){return(0,l.Z)(function*(){"failed"===(yield(0,r.FD)(e.id,!0).toPromise().catch(s=>"failed"))?(0,a.cB)("Error checking in desk booking"):(0,a.t5)(`Checked in ${e.user_name}.`)})()}approveDesk(e){return(0,l.Z)(function*(){"failed"===(yield(0,r.jT)(e.id).toPromise().catch(s=>"failed"))?(0,a.cB)("Error approving in desk booking"):(0,a.t5)(`Approved desk booking for ${e.user_name} on ${(0,P.Z)(e.date,"MMM do")}.`)})()}rejectDesk(e){return(0,l.Z)(function*(){"failed"===(yield(0,r.FP)(e.id).toPromise().catch(s=>"failed"))?(0,a.cB)("Error rejecting in desk booking"):(0,a.t5)(`Rejected desk booking for ${e.user_name} on ${(0,P.Z)(e.date,"MMM do")}.`)})()}giveAccess(e){var i=this;return(0,l.Z)(function*(){const s=yield(0,r.km)(new r.$N({...e,access:!0})).toPromise().catch(o=>"failed");if("failed"===s)return(0,a.cB)("Error giving building access booking host");(0,a.t5)(`Successfully gave building access to ${e.user_name} for desk booking.`),i._desk_bookings=[...i._desk_bookings,s]})()}rejectAllDesks(){var e=this;return(0,l.Z)(function*(){const i=e._desk_bookings||[];if(i.length>0){const s=e._dialog.open(B.z5,{data:{title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}}});return new Promise((o,n)=>{let _=!1;s.componentInstance.event.pipe((0,m.P)(d=>"done"===d.reason)).subscribe((0,l.Z)(function*(){s.componentInstance.loading="Rejecting all desks for selected date...",_=!0,yield Promise.all(i.map(d=>(0,r.FP)(d.id).toPromise())),o(""),(0,a.t5)("Successfull rejected all desk bookings for selected date."),s.close()})),s.afterClosed().toPromise().then(()=>{_||n()})})}(0,a.QD)("No desks to reject for the selected date")})()}}return c.\u0275fac=function(e){return new(e||c)(u.LFG(M.w7),u.LFG(I.uw))},c.\u0275prov=u.Yz7({token:c,factory:c.\u0275fac,providedIn:"root"}),c})()}}]);
//# sourceMappingURL=common.js.map