"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["common"],{9519:(b,P,s)=>{s.d(P,{H:()=>A});var c=s(1670),v=s(2182),g=s(4505),O=s(2218),a=s(7716),h=s(4139),M=s(823),x=s(9095),_=s(6942),k=s(7418),y=s(9128),C=s(8759),U=s(3298),R=s(2647),T=s(1810),B=s(9377),m=s(3200),D=s(1535),l=s(5375),r=s(9743),p=s(5912),E=(s(6168),s(6839)),I=s(7486);let A=(()=>{class d extends r.cx{get new_desk_count(){return this._new_desks.getValue()?.length||0}nextPage(){this._call_next_page.next(`NEXT_${Date.now()}`)}constructor(e,n){super(),this._org=e,this._dialog=n,this._filters=new g.X({}),this._new_desks=new g.X([]),this._desk_bookings=[],this._loading=new g.X(!1),this.new_desks=this._new_desks.asObservable(),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.desks=this._filters.pipe((0,M.b)(500),(0,x.w)(t=>{const o=t.zones||[];return o&&!o.includes("All")?(0,v.rlq)(o[0],"desks").pipe((0,_.U)(i=>i.details)):(0,v.BW_)(this._org.building?.id,{name:"desks"}).pipe((0,_.U)(i=>i.map(u=>u.metadata.desks.details).reduce((u,f)=>[...u,...f],[])))}),(0,k.K)(t=>[]),(0,_.U)(t=>(t instanceof Array||(t=[]),t.sort((o,i)=>o.name?.localeCompare(i.name)),t.map(o=>new p.nk({...o,qr_code:""})))),(0,y.d)(1)),this._next_page=new O.xQ,this._call_next_page=new O.xQ,this._all_zones_keys=["All",-1,"-1"],this.setup_paging=(0,a.aj)([this._filters,this._org.initialised]).pipe((0,M.b)(500),(0,C.b)(([t,o])=>{if(!o)return;const i=t.date||Date.now(),u=!t.zones||t.zones.some(f=>this._all_zones_keys.includes(f))?[this._org.building.id]:t.zones;this._next_page.next(()=>(0,l.pS)({period_start:(0,T.Z)((0,B.Z)(i)),period_end:(0,T.Z)((0,m.Z)(i)),type:"desk",zones:u.join(","),include_checked_out:!0}).pipe((0,k.K)(f=>(0,h.of)({data:[],total:0,next:null})))),this._call_next_page.next(`RESET_${Date.now()}`)})),this.paged_bookings=(0,a.aj)([this._next_page,this._call_next_page]).pipe((0,U.x)((t,o)=>t[1]===o[1]),(0,x.w)(([t,o])=>(this._loading.next(!0),t?o.includes("RESET")?t().pipe((0,_.U)(i=>({...i,reset:!0})),(0,k.K)(i=>(0,h.of)({data:[],total:0,next:null}))):t().pipe((0,_.U)(i=>({...i,reset:!1})),(0,k.K)(i=>(0,h.of)({data:[],total:0,next:null}))):(0,h.of)({data:[],total:0,next:null,reset:o.includes("RESET")}))),(0,R.R)((t,{data:o,total:i,next:u,reset:f})=>{const L=o;return this._next_page.next(u),f?{list:L,total:i}:{list:[...t.list,...L],total:i}},{list:[],total:0}),(0,C.b)(t=>this._loading.next(!1)),(0,y.d)(1)),this.has_more_pages=this.paged_bookings.pipe((0,_.U)(t=>t.list.length<t.total)),this.bookings=this.paged_bookings.pipe((0,_.U)(t=>t.list)),this.setup_paging.subscribe()}setFilters(e){e.zones?.includes("All")?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(n=>n.id)]:e.zones&&this._filters.getValue()?.zones?.includes("All")&&(e.zones=[]),this._filters.next({...this._filters.getValue(),...e})}refresh(){this._loading.next(!0),this.timeout("poll",()=>this.setFilters(this._filters.getValue()))}addDesks(e){this._new_desks.next(this._new_desks.getValue().concat(e))}removeNewDesk(e){this._filters.next(this._filters.getValue()),this._new_desks.next(this._new_desks.getValue().filter(n=>n.id!==e.id))}clearNewDesks(){this._filters.next(this._filters.getValue()),this._new_desks.next([])}checkinDesk(e,n=!0){return(0,c.Z)(function*(){console.log("Check-in:",e);const t=yield(0,l.FD)(e.id,n??!0).toPromise().catch(o=>({failed:!0,error:o}));if(t.failed)throw(0,r.cB)(t.error?`Error: ${t.error}`:`Error checking ${n?"in":"out"} desk booking`),t.error;(0,r.t5)(`Checked ${n?"in":"out"} ${e.user_name}.`)})()}approveDesk(e){return(0,c.Z)(function*(){if("failed"===(yield(0,l.jT)(e.id).toPromise().catch(t=>"failed")))return(0,r.cB)("Error approving in desk booking");(0,r.t5)(`Approved desk booking for ${e.user_name} on ${(0,D.Z)(e.date,"MMM do")}.`),e.approved=!0,e.rejected=!1})()}rejectDesk(e){return(0,c.Z)(function*(){if("failed"===(yield(0,l.FP)(e.id).toPromise().catch(t=>"failed")))return(0,r.cB)("Error rejecting in desk booking");(0,r.t5)(`Rejected desk booking for ${e.user_name} on ${(0,D.Z)(e.date,"MMM do")}.`),e.approved=!1,e.rejected=!0})()}giveAccess(e){var n=this;return(0,c.Z)(function*(){const t=yield(0,l.km)(new l.$N({...e,access:!0})).toPromise().catch(o=>"failed");if("failed"===t)return(0,r.cB)("Error giving building access booking host");(0,r.t5)(`Successfully gave building access to ${e.user_name} for desk booking.`),n._desk_bookings=[...n._desk_bookings,t]})()}rejectAllDesks(){var e=this;return(0,c.Z)(function*(){const n=e._desk_bookings||[];if(n.length<=0)return(0,r.QD)("No desks to reject for the selected date");const t=yield(0,r._5)({title:"Cancel all desk bookings",content:"Are you sure you want to cancel all bookings for the selected date?",icon:{type:"icon",class:"material-icons",content:"delete"}},e._dialog);"done"===t.reason&&(t.loading("Rejecting all desks for selected date..."),yield Promise.all(n.map(o=>(0,l.FP)(o.id).toPromise())),(0,r.t5)("Successfully rejected all desk bookings for selected date."),t.close())})()}}return d.\u0275fac=function(e){return new(e||d)(E.LFG(p.w7),E.LFG(I.uw))},d.\u0275prov=E.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"}),d})()},5375:(b,P,s)=>{s.d(P,{$N:()=>g.$,fy:()=>v.f,EP:()=>c.E,jT:()=>a.jT,FD:()=>a.FD,NP:()=>a.NP,F2:()=>a.F2,pS:()=>a.pS,FP:()=>a.FP,km:()=>a.km,Fo:()=>a.Fo,Wp:()=>a.Wp});var c=s(5554),v=s(8929),g=s(6962),a=(s(1980),s(354));s(9743),s(3174),s(6165),s(4282),s(7121),s(8883),s(4088),s(7304)}}]);
//# sourceMappingURL=common.js.map