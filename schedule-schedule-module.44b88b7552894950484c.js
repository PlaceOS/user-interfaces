(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{L0xO:function(t,e,n){"use strict";n.r(e),n.d(e,"ScheduleModule",(function(){return Ut}));var i=n("2kYt"),c=n("nIj0"),o=n("qvOF"),a=n("sEIs"),s=n("20lr"),r=n("EM62"),d=n("d4mj"),l=n("D57K"),g=n("HM3f"),b=n("eZII"),u=n("Rc+I"),h=n("05Mk"),f=n("OZ4H"),p=n("e81E"),m=n("PBFl"),_=n("ukpX"),v=n("C9Ki"),M=n("csyo"),O=n("6CBO"),C=n("ceWj"),P=n("BQ33");function y(t,e){if(1&t){const t=r.Wb();r.Vb(0,"button",14),r.fc("click",(function(){return r.Ac(t),r.jc(2).showSpace()})),r.Nc(1,"View"),r.Ub()}}const w=function(){return{type:"icon",class:"material-icons",content:"delete_forever"}},k=function(){return{type:"icon",class:"material-icons",content:"perm_identity"}},x=function(){return{type:"icon",class:"material-icons",content:"schedule"}},D=function(){return{type:"icon",class:"material-icons",content:"place"}};function U(t,e){if(1&t){const t=r.Wb();r.Vb(0,"div",1),r.Vb(1,"div",2),r.Vb(2,"div",3),r.Nc(3),r.Ub(),r.Vb(4,"div",4),r.Vb(5,"button",5),r.fc("click",(function(){return r.Ac(t),r.jc().cancel()})),r.Qb(6,"app-icon",6),r.Ub(),r.Ub(),r.Ub(),r.Vb(7,"div",7),r.Vb(8,"div",8),r.Vb(9,"div",9),r.Vb(10,"div",10),r.Qb(11,"app-icon",11),r.Ub(),r.Vb(12,"div",12),r.Nc(13),r.Ub(),r.Ub(),r.Vb(14,"div",9),r.Vb(15,"div",10),r.Qb(16,"app-icon",11),r.Ub(),r.Vb(17,"div",12),r.Nc(18),r.Ub(),r.Ub(),r.Vb(19,"div",9),r.Vb(20,"div",10),r.Qb(21,"app-icon",11),r.Ub(),r.Vb(22,"div",12),r.Nc(23),r.Ub(),r.Lc(24,y,2,0,"button",13),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&t){const t=r.jc();r.Db(3),r.Oc(t.item.title||"No Title"),r.Db(3),r.qc("icon",r.tc(9,w)),r.Db(5),r.qc("icon",r.tc(10,k)),r.Db(2),r.Oc(t.item.user_name),r.Db(3),r.qc("icon",r.tc(11,x)),r.Db(2),r.Oc(t.when),r.Db(3),r.qc("icon",r.tc(12,D)),r.Db(2),r.Oc(t.item.description),r.Db(1),r.qc("ngIf",t.item.asset_id)}}let V=(()=>{class t extends s.c{constructor(t,e,n){super(),this._dialog=t,this._router=e,this._events=n,this.loading=new r.o}get when(){if(!this.item)return"Unable to determine.";const t=P(this.item.date),e=t.add(this.item.duration||60,"m");return this.item.all_day||this.item.duration>1380?t.format("DD MMM YYYY")+" - All Day":t.isSame(e,"d")?`${t.format("DD MMM YYYY, h:mm A")} - ${e.format("h:mm A")}`:`${t.format("DD MMM YYYY, h:mm A")} - ${e.format("DD MMM YYYY, h:mm A")}`}cancel(){this.confirmDelete()}showSpace(){const t=new O.b({name:"Desk Booking",map_id:this.item.asset_id,zones:this.item.zones});this._dialog.open(C.a,{width:"32em",maxWidth:"95vw",maxHeight:"95vh",data:{space:t}})}confirmDelete(){this._dialog.open(u.c,{data:{title:"Cancel Meeting",content:"Are you sure you want to cancel this desk booking ?",okText:"I'm sure",cancelText:"No"}}).afterClosed().subscribe(t=>{t&&this.deleteBooking()})}deleteBooking(){return Object(l.a)(this,void 0,void 0,(function*(){this.loading.emit("Cancelling booking..."),yield this._events.delete(this.item.id).then(()=>{}).catch(()=>{}),this._router.navigate(["schedule"]),this.loading.emit("")}))}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(f.b),r.Pb(a.d),r.Pb(b.b))},t.\u0275cmp=r.Jb({type:t,selectors:[["schedule-booking-details"]],inputs:{item:"item"},outputs:{loading:"loading"},features:[r.Ab],decls:1,vars:1,consts:[["class","booking-details",4,"ngIf"],[1,"booking-details"],[1,"header"],[1,"title"],[1,"icons"],["mat-fab","","color","primary",3,"click"],["name","cancel",3,"icon"],[1,"row"],[1,"booking"],[1,"field"],[1,"icon"],[3,"icon"],[1,"value"],["mat-button","",3,"click",4,"ngIf"],["mat-button","",3,"click"]],template:function(t,e){1&t&&r.Lc(0,U,25,13,"div",0),2&t&&r.qc("ngIf",e.item)},directives:[i.n,m.b,_.a],styles:['.header[_ngcontent-%COMP%]{padding:1em 0;width:100%}.header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:1.1em;font-weight:600;margin-bottom:.5em}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:.5em}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.5em}.row[_ngcontent-%COMP%]{display:flex;justify-content:center}.booking[_ngcontent-%COMP%]{background-color:#fff;--tw-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow)}button[_ngcontent-%COMP%]{color:var(--primary)}.field[_ngcontent-%COMP%]{position:relative;padding:1em;display:flex;align-items:center}.field[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{font-size:2em;margin-right:.2em}.field[_ngcontent-%COMP%]   .value[_ngcontent-%COMP%]{flex:1}.field[_ngcontent-%COMP%]:after{content:"";position:absolute;top:100%;right:0;bottom:-2px;left:0;height:2px;z-index:1;border-radius:inherit;background:linear-gradient(270deg,var(--bg) calc(100% - 3em),transparent 3em)}.field[_ngcontent-%COMP%]:last-of-type:after{content:unset}']}),t})();var q=n("mjT4"),S=n("XTcU");const j=function(){return{type:"icon",class:"material-icons",content:"delete_forever"}};function I(t,e){if(1&t){const t=r.Wb();r.Vb(0,"button",8),r.fc("click",(function(){return r.Ac(t),r.jc(3).cancelBooking()})),r.Qb(1,"app-icon",12),r.Ub()}2&t&&(r.Db(1),r.qc("icon",r.tc(1,j)))}const L=function(){return{type:"icon",class:"material-icons",content:"edit"}},A=function(){return{type:"icon",class:"material-icons",content:"control_point_duplicate"}};function N(t,e){if(1&t){const t=r.Wb();r.Vb(0,"div",7),r.Vb(1,"button",8),r.fc("click",(function(){return r.Ac(t),r.jc(2).edit()})),r.Qb(2,"app-icon",9),r.Ub(),r.Lc(3,I,2,2,"button",10),r.Vb(4,"button",8),r.fc("click",(function(){return r.Ac(t),r.jc(2).duplicate()})),r.Qb(5,"app-icon",11),r.Ub(),r.Ub()}if(2&t){const t=r.jc(2);r.Db(2),r.qc("icon",r.tc(3,L)),r.Db(1),r.qc("ngIf",t.can_cancel),r.Db(2),r.qc("icon",r.tc(4,A))}}function Q(t,e){if(1&t&&(r.Vb(0,"div",1),r.Vb(1,"div",2),r.Vb(2,"div",3),r.Nc(3),r.Ub(),r.Lc(4,N,6,5,"div",4),r.Ub(),r.Vb(5,"div",5),r.Qb(6,"schedule-event-view",6),r.Ub(),r.Ub()),2&t){const t=r.jc();r.Db(3),r.Oc(t.item.title||"No Title"),r.Db(1),r.qc("ngIf",t.can_edit),r.Db(2),r.qc("event",t.item)}}let Y=(()=>{class t extends s.c{constructor(t,e){super(),this._users=t,this._router=e,this.event=new r.o,this.loading=new r.o,this.last_start={}}get spaces(){return this.item.resources}get organiser(){return this.item.creator||this._users.current.name}get can_edit(){return this.item.creator===this._users.current.email&&"done"!==this.status}get can_cancel(){return this.can_edit&&"future"===this.status}get status(){if(this.item){const t=P(),e=P(this.item.date);if(t.isBefore(e.subtract(15,"m"),"m"))return"future";if(t.isBefore(e,"m"))return"upcoming";if(t.isBefore(e.add(15,"m"),"m"))return"started";if(t.isBefore(e.add(this.item.duration,"m"),"m"))return"in_progress"}return"done"}get is_checked_in(){return this.spaces.reduce((t,e)=>t&&this.item.date<=(this.last_start[e.id]||0),!0)}get can_control(){return this.spaces.length>0&&"future"!==this.status&&"done"!==this.status}get can_checkin(){return this.spaces.length>0&&("upcoming"===this.status||"started"===this.status)}edit(){this.event.emit({type:"edit"})}checkin(){this.checked_in=!this.checked_in}duplicate(){if(localStorage){const t=new h.a(Object.assign(Object.assign({},this.item),{id:""}));localStorage.setItem("STAFF.booking_form",JSON.stringify(t))}this._router.navigate(["/book"])}cancelBooking(){this.event.emit({type:"cancel_booking"})}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(q.d),r.Pb(a.d))},t.\u0275cmp=r.Jb({type:t,selectors:[["schedule-event-details"]],inputs:{item:"item"},outputs:{event:"event",loading:"loading"},features:[r.Ab],decls:1,vars:1,consts:[["class","event-details",4,"ngIf"],[1,"event-details"],[1,"header"],[1,"title"],["class","icons",4,"ngIf"],[1,"event"],[3,"event"],[1,"icons"],["mat-fab","","color","primary",3,"click"],["name","edit",3,"icon"],["mat-fab","","color","primary",3,"click",4,"ngIf"],["name","duplicate",3,"icon"],["name","cancel",3,"icon"]],template:function(t,e){1&t&&r.Lc(0,Q,7,3,"div",0),2&t&&r.qc("ngIf",e.item)},directives:[i.n,S.a,m.b,_.a],styles:[".header[_ngcontent-%COMP%]{padding:1em 0;width:100%}.header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{width:100%;text-align:center;font-size:1.1em;font-weight:600;margin-bottom:.5em}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:.5em}.header[_ngcontent-%COMP%]   .icons[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{font-size:1.5em}.event[_ngcontent-%COMP%]{display:flex;justify-content:center}"]}),t})();function z(t,e){if(1&t&&(r.Tb(0),r.Vb(1,"div",13),r.Vb(2,"div",14),r.Qb(3,"mat-spinner",15),r.Ub(),r.Vb(4,"div",16),r.Nc(5),r.Ub(),r.Ub(),r.Sb()),2&t){const t=r.jc();r.Db(5),r.Pc(" ",t.loading," ")}}function F(t,e){if(1&t){const t=r.Wb();r.Vb(0,"schedule-booking-details",21),r.fc("loading",(function(e){return r.Ac(t),r.jc(2).loading=e})),r.Ub()}if(2&t){const t=r.jc(2);r.qc("item",t.event)}}function T(t,e){if(1&t){const t=r.Wb();r.Vb(0,"schedule-event-details",22),r.fc("event",(function(e){return r.Ac(t),r.jc(2).onChange(e)}))("loading",(function(e){return r.Ac(t),r.jc(2).loading=e})),r.Ub()}if(2&t){const t=r.jc(2);r.qc("item",t.event)}}function E(t,e){if(1&t&&(r.Vb(0,"div",17),r.Tb(1,18),r.Lc(2,F,1,1,"schedule-booking-details",19),r.Lc(3,T,1,1,"schedule-event-details",20),r.Sb(),r.Ub()),2&t){const t=r.jc();r.qc("hidden",t.loading),r.Db(1),r.qc("ngSwitch",t.type),r.Db(1),r.qc("ngSwitchCase","booking")}}const B=function(){return{tye:"icon",class:"material-icons",content:"keyboard_backspace"}};let J=(()=>{class t extends s.c{constructor(t,e,n,i,c,o){super(),this._bookings=t,this._events=e,this._router=n,this._route=i,this._dialog=c,this._location=o,this.menu=new r.o(!1)}ngOnInit(){this.subscription("route.params",Object(g.b)([this._route.paramMap,this._route.queryParamMap]).subscribe(([t,e])=>{t.has("id")&&(this.id=t.get("id")),e.has("calendar")&&(this.calendar=e.get("calendar")),e.has("type")&&(this.type=e.get("type")),this.id&&this.loadEvent()}))}back(){this.editing?this.onChange({type:"cancel_edit"}):this._location.back()}loadEvent(){return Object(l.a)(this,void 0,void 0,(function*(){if(this.deleting)return;let t;this.loading="Loading booking data...";try{switch(this.type){case"booking":t=yield this._bookings.show(this.id);break;default:t=yield this._events.show(this.id,{calendar:this.calendar})}this.loading="",this.event=t}catch(e){this.loading="",this._router.navigate(["/schedule"])}}))}deleteEvent(){return Object(l.a)(this,void 0,void 0,(function*(){if(this.event&&!this.loading){this.loading="Cancelling meeting...";const{id:t}=this.event;this.deleting=!0,yield this._events.delete(t,{calendar:this.event.calendar}).catch(()=>{}),this._router.navigate(["/schedule"]),this.event=null,this.loading="",this.deleting=!1}}))}confirmDelete(){this._dialog.open(u.c,{data:{title:"Cancel Meeting",content:"Are you sure you want to cancel this meeting: "+this.event.title,okText:"I'm sure",cancelText:"No"}}).afterClosed().subscribe(t=>{t&&this.deleteEvent()})}onChange(t){if("edit"===t.type){if(localStorage){const t=new b.a(Object.assign({},this.event));localStorage.setItem("STAFF.booking_form",JSON.stringify(t))}this._router.navigate(["/book","spaces"])}else"view"===t.type||"cancel_edit"===t.type?this.editing=!1:"cancel_booking"===t.type&&(this.editing=!1,this.confirmDelete())}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(h.b),r.Pb(b.b),r.Pb(a.d),r.Pb(a.a),r.Pb(f.b),r.Pb(i.i))},t.\u0275cmp=r.Jb({type:t,selectors:[["schedule-view-event"]],outputs:{menu:"menu"},features:[r.Ab],decls:15,vars:8,consts:[[1,"event","page"],[1,"header"],[3,"menuChange"],[1,"actions"],[1,"back"],["mat-button","",3,"click"],[1,"row"],[3,"icon"],[1,"search"],[1,"body"],[4,"ngIf"],[3,"hidden",4,"ngIf"],[1,"footer"],[1,"no-item","center"],[1,"icon"],["diameter","100"],[1,"text"],[3,"hidden"],[3,"ngSwitch"],[3,"item","loading",4,"ngSwitchCase"],[3,"item","event","loading",4,"ngSwitchDefault"],[3,"item","loading"],[3,"item","event","loading"]],template:function(t,e){1&t&&(r.Vb(0,"div",0),r.Vb(1,"header",1),r.Vb(2,"a-topbar-header",2),r.fc("menuChange",(function(t){return e.menu.emit(t)})),r.Ub(),r.Ub(),r.Vb(3,"div",3),r.Vb(4,"div",4),r.Vb(5,"button",5),r.fc("click",(function(){return e.back()})),r.Vb(6,"div",6),r.Qb(7,"app-icon",7),r.Nc(8," Back "),r.Ub(),r.Ub(),r.Ub(),r.Qb(9,"div",8),r.Ub(),r.Vb(10,"main",9),r.Lc(11,z,6,1,"ng-container",10),r.Lc(12,E,4,3,"div",11),r.Ub(),r.Vb(13,"footer",12),r.Qb(14,"a-footer-menu"),r.Ub(),r.Ub()),2&t&&(r.Db(3),r.Hb("blank",!1)("has-back",!0),r.Db(4),r.qc("icon",r.tc(7,B)),r.Db(4),r.qc("ngIf",e.loading),r.Db(1),r.qc("ngIf",e.event))},directives:[p.a,m.b,_.a,i.n,v.a,M.b,i.p,i.q,i.r,V,Y],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;background:#f0f0f0}.page[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{flex:1;overflow:auto}.page[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{height:3.5em}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{background:#fff;display:flex;align-items:center;flex-wrap:wrap}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:none}.page[_ngcontent-%COMP%]   .actions.has-back[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block}.page[_ngcontent-%COMP%]   .actions.has-back[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{margin-left:.5em;font-size:1.5em}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{height:100%}.page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]{background:transparent}.page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%], .page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{display:none}.page[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]{height:3.5em;background:#fff}.event.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{position:relative}.icon[_ngcontent-%COMP%]{display:flex;justify-content:center}"]}),t})();var W=n("Jb3d"),$=n("jOdJ"),H=n("7JBE"),R=n("29Wa"),X=n("R7+U"),K=n("mFH5"),Z=n("Cd2c"),G=n("gcUQ"),tt=n("fQIa"),et=n("66mq");const nt=function(){return{type:"icon",class:"material-icons",content:"radio_button_checked"}};function it(t,e){1&t&&r.Qb(0,"app-icon",7),2&t&&r.qc("icon",r.tc(1,nt))}function ct(t,e){if(1&t&&(r.Vb(0,"div",5),r.Lc(1,it,1,2,"app-icon",6),r.Nc(2),r.Ub()),2&t){const t=r.jc(2);r.Db(1),r.qc("ngIf",!!t.event.is_today),r.Db(1),r.Pc(" ",t.event.title," ")}}function ot(t,e){if(1&t&&(r.Vb(0,"div",8),r.Nc(1),r.Ub()),2&t){const t=r.jc(2);r.Db(1),r.Pc(" ",t.event.title," ")}}const at=function(){return{type:"icon",class:"material-icons",content:"cancel"}};function st(t,e){1&t&&r.Qb(0,"app-icon",7),2&t&&r.qc("icon",r.tc(1,at))}const rt=function(){return{type:"icon",class:"material-icons",content:"forum"}};function dt(t,e){1&t&&r.Qb(0,"app-icon",7),2&t&&r.qc("icon",r.tc(1,rt))}function lt(t,e){1&t&&(r.Vb(0,"label"),r.Nc(1,"(Cancelled)"),r.Ub())}const gt=function(){return{type:"icon",class:"material-icons",content:"place"}};function bt(t,e){1&t&&r.Qb(0,"app-icon",7),2&t&&r.qc("icon",r.tc(1,gt))}function ut(t,e){if(1&t){const t=r.Wb();r.Vb(0,"div",9),r.fc("click",(function(){r.Ac(t);const e=r.jc(2);return e.view(e.event)})),r.Vb(1,"div",10),r.Vb(2,"div",11),r.Lc(3,st,1,2,"app-icon",12),r.Lc(4,dt,1,2,"app-icon",13),r.Ub(),r.Vb(5,"div"),r.Nc(6),r.Ub(),r.Lc(7,lt,2,0,"label",14),r.Ub(),r.Vb(8,"div",15),r.Vb(9,"div",16),r.Nc(10),r.Ub(),r.Vb(11,"div",17),r.Lc(12,bt,1,2,"app-icon",6),r.Vb(13,"div",18),r.Nc(14),r.Ub(),r.Ub(),r.Ub(),r.Ub()}if(2&t){const t=r.jc(2);r.Db(1),r.Hb("done",t.is_done),r.qc("ngClass","time "+t.status),r.Db(1),r.qc("ngSwitch",t.event.status),r.Db(1),r.qc("ngSwitchCase","cancelled"),r.Db(3),r.Oc(t.time),r.Db(1),r.qc("ngIf","cancelled"===t.event.status),r.Db(3),r.Oc(t.event.title),r.Db(2),r.qc("ngIf",!!t.location),r.Db(2),r.Oc(t.location||"No location")}}function ht(t,e){if(1&t&&(r.Vb(0,"div",1),r.Lc(1,ct,3,2,"div",2),r.Lc(2,ot,2,1,"div",3),r.Lc(3,ut,15,10,"div",4),r.Ub()),2&t){const t=r.jc();r.qc("ngSwitch",t.event.type),r.Db(1),r.qc("ngSwitchCase","date"),r.Db(1),r.qc("ngSwitchCase","empty")}}let ft=(()=>{class t extends s.c{constructor(t,e){super(),this._bookings=t,this._router=e}get isFuture(){return P(this.event.date).isAfter(P(),"m")}get status(){return this.event.status}get is_done(){return this.event.is_done}get location(){return this.event&&"date"!==this.event.type&&"empty"!==this.event.type?this.event.location:"No location"}get type_image(){return this.event&&"date"!==this.event.type&&"empty"!==this.event.type?this.event.has_visitors?"external":"book_room":"block"}get time(){return this.event&&"date"!==this.event.type&&"empty"!==this.event.type?this.event.all_day||this.event.duration>1380?"All Day":P(this.event.date).format("h:mm A"):""}view(){const t=Object(s.v)({calendar:this.event.calendar,type:this.event.type});this._router.navigateByUrl(`/schedule/view/${this.event.id}?${t}`)}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(h.b),r.Pb(a.d))},t.\u0275cmp=r.Jb({type:t,selectors:[["schedule-event-item"]],inputs:{event:"event"},features:[r.Ab],decls:1,vars:1,consts:[["class","item",3,"ngSwitch",4,"ngIf"],[1,"item",3,"ngSwitch"],["class","date",4,"ngSwitchCase"],["class","empty",4,"ngSwitchCase"],["class","event",3,"click",4,"ngSwitchDefault"],[1,"date"],[3,"icon",4,"ngIf"],[3,"icon"],[1,"empty"],[1,"event",3,"click"],[3,"ngClass"],[1,"icon",3,"ngSwitch"],[3,"icon",4,"ngSwitchCase"],[3,"icon",4,"ngSwitchDefault"],[4,"ngIf"],[1,"details"],[1,"title"],[1,"location"],[1,"text"]],template:function(t,e){1&t&&r.Lc(0,ht,4,3,"div",0),2&t&&r.qc("ngIf",e.event)},directives:[i.n,i.p,i.q,i.r,_.a,i.k],styles:[".item[_ngcontent-%COMP%]{justify-content:flex-start;width:100%;margin-top:1px}.empty[_ngcontent-%COMP%], .item[_ngcontent-%COMP%]{display:flex;align-items:center}.empty[_ngcontent-%COMP%]{height:3em;font-size:1.6em;color:rgba(0,0,0,.35);padding-left:1em}.date[_ngcontent-%COMP%]{display:flex;font-size:1.2em;margin:1em 0 .5em}.event[_ngcontent-%COMP%]{height:5em;width:100%;background:#fff;cursor:pointer}.event[_ngcontent-%COMP%], .event[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{display:flex;align-items:center}.event[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{height:100%;width:5em;flex-direction:column;justify-content:center}.event[_ngcontent-%COMP%]   .time.done[_ngcontent-%COMP%]{background:rgba(0,0,0,.35)}.event[_ngcontent-%COMP%]   .time.cancelled[_ngcontent-%COMP%]{background:var(--secondary);color:#fff}.event[_ngcontent-%COMP%]   .time.confirmed[_ngcontent-%COMP%]{background:var(--success)}.event[_ngcontent-%COMP%]   .time.tentative[_ngcontent-%COMP%]{background:var(--pending)}.event[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]{flex:1;padding-left:.5em}.event[_ngcontent-%COMP%]   .details[_ngcontent-%COMP%]   .location[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin-top:.5em}"]}),t})();const pt=["dateMenu"];function mt(t,e){if(1&t&&(r.Vb(0,"mat-option",27),r.Nc(1),r.Ub()),2&t){const t=e.$implicit;r.qc("value",t.id),r.Db(1),r.Pc(" ",t.summary," ")}}function _t(t,e){if(1&t&&(r.Vb(0,"div",9),r.Qb(1,"div",28),r.Nc(2),r.Ub()),2&t){const t=e.$implicit;r.Db(1),r.Ic("background-color",t.color),r.Db(1),r.Pc(" ",t.name," ")}}function vt(t,e){1&t&&r.Qb(0,"mat-progress-bar",29)}function Mt(t,e){if(1&t&&r.Qb(0,"schedule-event-item",30),2&t){const t=e.$implicit;r.rc("id",e.index),r.qc("event",t)}}function Ot(t,e){1&t&&r.Qb(0,"mat-progress-bar",29)}const Ct=function(){return{class:"material-icons",content:"event"}};let Pt=(()=>{class t extends s.c{constructor(t,e,n,i,c,o,a){super(),this._settings=t,this._events=e,this._spaces=n,this._calendars=i,this._bookings=c,this._route=o,this._router=a,this.event_list=new r.o,this.events=[],this.shown_offset=7,this.date_offset=0,this.from=P().valueOf(),this.legend_list=[],this.menu=new r.o}ngOnInit(){this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{t.has("email")&&(this.calendar=t.get("email"))})),this._spaces.initialised.pipe(Object($.a)(t=>t)).subscribe(()=>{this._calendars.initialised.pipe(Object($.a)(t=>t)).subscribe(t=>{var e,n;this.calendar_list=this._calendars.calendars,this.calendar||(this.calendar=(null===(e=this.calendar_list.find(t=>t.primary))||void 0===e?void 0:e.id)||(null===(n=this.calendar_list[0])||void 0===n?void 0:n.id)),this.updateList(),this.interval("update_events",()=>this.updateList(),1e5)})}),this.legend_list=this._settings.get("app.schedule.legend")}updateList(){return Object(l.a)(this,void 0,void 0,(function*(){this.loading=!0;const t=P().add(this.date_offset,"d").startOf("d"),e=t.add(7,"d").endOf("d");let n;n="desks"===this.calendar?yield this._bookings.query({period_start:t.unix(),period_end:e.unix(),type:"desk",user:"current"}):yield this._events.query({calendars:this.calendar,period_start:t.unix(),period_end:e.unix()});const i=n,c=this.events.filter(n=>{const i=P(n.date);return"date"!==n.type&&"empty"!==n.type&&(i.isBefore(t,"s")||i.isAfter(e,"s"))});this.events=this.processEvents(i,c);const o=this.events.filter(t=>"date"!==t.type&&"empty"!==t.type);this.event_list.emit(o.map(t=>({id:t.id,date:t.date}))),this.timeout("scroll_to",()=>this.scrollTo()),this.loading=!1}))}processEvents(t,e=[]){let n=[];P();let i=P().startOf("d");const c=i.add(this.date_offset+this.shown_offset,"d").endOf("d");for(;i.isBefore(c);i=i.add(1,"d")){const c=i.format("YYYY-MM-DD");n.push({id:c,type:"date",title:i.format("dddd, DD MMM"),date:i.valueOf()});const o=t=>P(t.date).isSame(i,"d"),a=t.filter(o),s=e.filter(o);a.length||s.length?n=n.concat(a).concat(s):n.push({id:c+"-empty",type:"empty",title:"No items for "+i.format("dddd, DD MMM"),date:i.valueOf()+1})}return n.sort((t,e)=>t.date-e.date),Object(s.w)(n,"id")}onScroll(){!this.event_promise&&this.calendar_list&&(this.date_offset=this.date_offset+7,this.updateList())}updateDate(t){const e=P(t);this.date_offset=e.diff(P(),"d")-1,this.shown_offset=Math.max(this.shown_offset,this.date_offset+3),this.scroll_to=e.format("YYYY-MM-DD"),delete this.event_promise,this.updateList()}scrollTo(){if(this.scroll_to){const t=this.events.findIndex(t=>t.id===this.scroll_to);t>-1&&document.getElementById(""+t).scrollIntoView({behavior:"smooth"}),this.scroll_to=""}}onCalendarChange(){this.events=[],this.date_offset=0,this.date=P().valueOf(),this.updateList(),this._router.navigate(["/schedule"],{queryParams:{email:this.calendar},queryParamsHandling:"merge"})}closeDatePicker(){this.trigger.closeMenu()}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(s.f),r.Pb(b.b),r.Pb(O.d),r.Pb(H.a),r.Pb(h.b),r.Pb(a.a),r.Pb(a.d))},t.\u0275cmp=r.Jb({type:t,selectors:[["schedule-event-list"]],viewQuery:function(t,e){if(1&t&&r.Rc(pt,!0,W.d),2&t){let t;r.wc(t=r.gc())&&(e.trigger=t.first)}},outputs:{event_list:"eventList",menu:"menu"},features:[r.Ab],decls:34,vars:12,consts:[[1,"schedule","page"],[1,"header"],[3,"menuChange"],[1,"actions"],[1,"calendars"],["appearance","outline"],["name","calendars",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["value","desks"],[1,"legend"],["mat-button","",1,"clear",3,"matMenuTriggerFor"],["legend","matMenu"],["class","legend",4,"ngFor","ngForOf"],[1,"date"],["mat-icon-button","",1,"relative"],["dateMenu",""],[3,"icon"],["matInput","",1,"opacity-0","absolute","inset-0",3,"ngModel","matDatepicker","ngModelChange"],["matSuffix","",1,"opacity-0","absolute","inset-0",3,"for"],["picker",""],[1,"body"],[1,"event-list"],[1,"progress"],["mode","indeterminate",4,"ngIf"],[3,"scrolled"],[3,"id","event",4,"ngFor","ngForOf"],[1,"footer"],[3,"value"],[1,"color"],["mode","indeterminate"],[3,"id","event"]],template:function(t,e){if(1&t&&(r.Vb(0,"div",0),r.Vb(1,"header",1),r.Vb(2,"a-topbar-header",2),r.fc("menuChange",(function(t){return e.menu.emit(t)})),r.Ub(),r.Ub(),r.Vb(3,"div",3),r.Vb(4,"div",4),r.Vb(5,"mat-form-field",5),r.Vb(6,"mat-select",6),r.fc("ngModelChange",(function(t){return e.calendar=t}))("ngModelChange",(function(){return e.onCalendarChange()})),r.Lc(7,mt,2,2,"mat-option",7),r.Vb(8,"mat-option",8),r.Nc(9,"Desks"),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Vb(10,"div",9),r.Vb(11,"button",10),r.Nc(12," Legend "),r.Ub(),r.Vb(13,"mat-menu",null,11),r.Lc(15,_t,3,3,"div",12),r.Ub(),r.Ub(),r.Vb(16,"div",13),r.Vb(17,"button",14,15),r.Qb(19,"app-icon",16),r.Vb(20,"input",17),r.fc("ngModelChange",(function(t){return e.updateDate(t)})),r.Ub(),r.Qb(21,"mat-datepicker-toggle",18),r.Ub(),r.Qb(22,"mat-datepicker",null,19),r.Ub(),r.Ub(),r.Vb(24,"main",20),r.Vb(25,"div",21),r.Vb(26,"div",22),r.Lc(27,vt,1,0,"mat-progress-bar",23),r.Ub(),r.Vb(28,"div",20),r.Vb(29,"a-infinite-scroll",24),r.fc("scrolled",(function(){return e.onScroll()})),r.Lc(30,Mt,1,2,"schedule-event-item",25),r.Lc(31,Ot,1,0,"mat-progress-bar",23),r.Ub(),r.Ub(),r.Ub(),r.Ub(),r.Vb(32,"footer",26),r.Qb(33,"a-footer-menu"),r.Ub(),r.Ub()),2&t){const t=r.xc(14),n=r.xc(23);r.Db(6),r.qc("ngModel",e.calendar),r.Db(1),r.qc("ngForOf",e.calendar_list),r.Db(4),r.qc("matMenuTriggerFor",t),r.Db(4),r.qc("ngForOf",e.legend_list),r.Db(4),r.qc("icon",r.tc(11,Ct)),r.Db(1),r.qc("ngModel",e.date)("matDatepicker",n),r.Db(1),r.qc("for",n),r.Db(6),r.qc("ngIf",e.loading),r.Db(3),r.qc("ngForOf",e.events),r.Db(1),r.qc("ngIf",e.loading&&e.events.length>0)}},directives:[p.a,R.c,X.a,c.l,c.o,i.m,K.i,m.b,W.d,W.a,_.a,Z.b,c.c,G.b,G.d,R.g,G.a,i.n,tt.a,v.a,et.a,ft],styles:[".page[_ngcontent-%COMP%]{position:absolute;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;background:#f0f0f0}.page[_ngcontent-%COMP%]   main[_ngcontent-%COMP%]{flex:1;overflow:auto}.page[_ngcontent-%COMP%]   header[_ngcontent-%COMP%]{height:3.5em}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]{background:#fff;display:flex;align-items:center;flex-wrap:wrap}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .row[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:none}.page[_ngcontent-%COMP%]   .actions.has-back[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:block}.page[_ngcontent-%COMP%]   .actions.has-back[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]   app-icon[_ngcontent-%COMP%]{margin-left:.5em;font-size:1.5em}.page[_ngcontent-%COMP%]   .actions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{height:100%}.page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]{background:transparent}.page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%], .page[_ngcontent-%COMP%]   .actions.blank[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{display:none}.page[_ngcontent-%COMP%]   footer[_ngcontent-%COMP%]{height:3.5em;background:#fff}.actions[_ngcontent-%COMP%]{justify-content:flex-end}.actions[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{position:relative}.actions[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%], .actions[_ngcontent-%COMP%]   .legend[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{height:100%}.calendars[_ngcontent-%COMP%]{margin-left:.5em;flex:1;height:4em}.calendars[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:15em}.event-list[_ngcontent-%COMP%]{height:100%;width:100%;position:relative}.event-list[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{padding:0 1em}.event-list[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   a-infinite-scroll[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]:last-child{height:2px}.tooltip[_ngcontent-%COMP%]{position:absolute;top:100%;right:-.25em;background-color:#fff;padding:.5em;border-radius:4px;--tw-shadow:0 1px 3px 0 rgba(0,0,0,0.1),0 1px 2px 0 rgba(0,0,0,0.06);box-shadow:var(--tw-ring-offset-shadow,0 0 transparent),var(--tw-ring-shadow,0 0 transparent),var(--tw-shadow);z-index:999;color:var(--font-dark)}@media screen and (max-width:639px){.date-picker[_ngcontent-%COMP%]{font-size:.8em}}"]}),t})();function yt(t,e){if(1&t){const t=r.Wb();r.Tb(0),r.Vb(1,"schedule-view-event",4),r.fc("menu",(function(e){return r.Ac(t),r.jc().show_menu=e})),r.Ub(),r.Sb()}}function wt(t,e){if(1&t){const t=r.Wb();r.Tb(0),r.Vb(1,"schedule-event-list",5),r.fc("menu",(function(e){return r.Ac(t),r.jc().show_menu=e}))("eventList",(function(e){return r.Ac(t),r.jc().updateEvents(e)})),r.Ub(),r.Sb()}}let kt=(()=>{class t extends s.c{constructor(t,e){super(),this._route=t,this._settings=e,this.show_menu=!1}ngOnInit(){this._settings.post("navTitle","My Day"),this.subscription("route.route",this._route.paramMap.subscribe(t=>{t.has("page")&&(this.page=t.get("page"))})),this.loadEvents()}updateEvents(t){this.events=t,this.saveEvents()}saveEvents(){localStorage&&localStorage.setItem("STAFF.events",JSON.stringify(this.events||[]))}loadEvents(){if(localStorage){const t=localStorage.getItem("STAFF.events");this.events=JSON.parse(t||"[]")}}}return t.\u0275fac=function(e){return new(e||t)(r.Pb(a.a),r.Pb(s.f))},t.\u0275cmp=r.Jb({type:t,selectors:[["app-schedule"]],features:[r.Ab],decls:4,vars:3,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"show","showChange"],[3,"menu"],[3,"menu","eventList"]],template:function(t,e){1&t&&(r.Tb(0,0),r.Lc(1,yt,2,0,"ng-container",1),r.Lc(2,wt,2,0,"ng-container",2),r.Sb(),r.Vb(3,"a-overlay-menu",3),r.fc("showChange",(function(t){return e.show_menu=t})),r.Ub()),2&t&&(r.qc("ngSwitch",e.page),r.Db(1),r.qc("ngSwitchCase","view"),r.Db(2),r.qc("show",e.show_menu))},directives:[i.p,i.q,i.r,d.a,J,Pt],styles:[".shell[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;background-color:#f0f0f0}.view[_ngcontent-%COMP%]{z-index:1}.loading-block[_ngcontent-%COMP%]{position:fixed;top:0;left:0;right:0;bottom:0;font-size:.9em;background-color:#f0f0f0;background-image:url(\"data:image/svg+xml,%3Csvg width='64' height='64' viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 16c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zm33.414-6l5.95-5.95L45.95.636 40 6.586 34.05.636 32.636 2.05 38.586 8l-5.95 5.95 1.414 1.414L40 9.414l5.95 5.95 1.414-1.414L41.414 8zM40 48c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm0-2c3.314 0 6-2.686 6-6s-2.686-6-6-6-6 2.686-6 6 2.686 6 6 6zM9.414 40l5.95-5.95-1.414-1.414L8 38.586l-5.95-5.95L.636 34.05 6.586 40l-5.95 5.95 1.414 1.414L8 41.414l5.95 5.95 1.414-1.414L9.414 40z' fill='%23ad1457' fill-opacity='0.2' fill-rule='evenodd'/%3E%3C/svg%3E\");z-index:2;overflow:auto;z-index:9999}.info-block[_ngcontent-%COMP%]{position:absolute;top:1em;left:50%;transform:translateX(-50%);margin:0;background-color:#fff;border-radius:4px;box-shadow:0 1px 3px 0 rgba(0,0,0,.2),0 1px 1px 0 rgba(0,0,0,.14),0 2px 1px -1px rgba(0,0,0,.12);padding:1em;max-width:calc(100vw - 2em)}img[_ngcontent-%COMP%]{max-height:60px;max-width:240px}.item[_ngcontent-%COMP%]{display:flex;align-items:center;padding:.25em .5em .25em 1em;width:100%}.item[_ngcontent-%COMP%]:nth-child(odd){background-color:rgba(0,0,0,.05);border-radius:8px}.message[_ngcontent-%COMP%]{padding-right:.5em;width:20em;max-width:calc(100vw - 5em)}.success[_ngcontent-%COMP%]{color:var(--success)}.failure[_ngcontent-%COMP%]{color:var(--error)}"]}),t})();const xt=[{path:"",component:kt},{path:":page",component:kt},{path:":page/:id",component:kt},{path:"**",redirectTo:""}];var Dt=n("R3Ii");let Ut=(()=>{class t{}return t.\u0275mod=r.Nb({type:t}),t.\u0275inj=r.Mb({factory:function(e){return new(e||t)},imports:[[i.c,c.h,c.p,a.g.forChild(xt),Dt.a,o.c]]}),t})()}}]);
//# sourceMappingURL=schedule-schedule-module.44b88b7552894950484c.js.map