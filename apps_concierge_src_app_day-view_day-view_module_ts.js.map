{"version":3,"mappings":"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","names":["i0","DayviewTopbarComponent","BaseClass","constructor","_state","_org","_route","_router","super","this","id","name","types","map","i","active_levels","options","d","setDate","newBooking","z","navigate","relativeTo","queryParams","zone_ids","join","setZones","setFilters","hide_type","reduce","list","item","includes","push","updateUIOptions","setUIOptions","ngOnInit","initialised","pipe","first","_","toPromise","subscription","queryParamMap","subscribe","params","has","zones","get","split","length","level","levelWithID","building","buildings","find","bld","parent_id","levels","filter","zone","lvl","updateZones","updateTypes","type_list","selectors","ctx","ctx_r6","DAY_IN_MINUTES","DayviewEventComponent","e","setEvent","time","date","Date","event","format","addMinutes","duration","type","guests","status","ngOnChanges","changes","start","startOfDay","diff","differenceInMinutes","top","height","overflow_top","ext","overflow_height","DayviewSpaceComponent","filtered","bookings","bkn","resources","space","email","HOUR_BLOCKS","Array","fill","idx","DayviewTimelineComponent","_spaces","x","y","loading","combineLatest","active_building","spaces","p","startPolling","ngOnDestroy","stopPolling","onScroll","requestAnimationFrame","scroll","srcElement","scrollLeft","scrollTop","DayViewComponent","_settings","links","route","ROUTES","path","component","DayViewModule","CommonModule","FormsModule","UIModule","SharedSpacesModule","SharedUsersModule","RouterModule"],"sources":["./apps/concierge/src/app/day-view/dayview-topbar.component.ts","./apps/concierge/src/app/day-view/dayview-event.component.ts","./apps/concierge/src/app/day-view/dayview-space.component.ts","./apps/concierge/src/app/day-view/dayview-timeline.component.ts","./apps/concierge/src/app/day-view/day-view.component.ts","./apps/concierge/src/app/day-view/day-view.module.ts"],"sourcesContent":["import { Component } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { first } from 'rxjs/operators';\n\nimport { BaseClass, Identity } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { BookingUIOptions, EventsStateService } from './events-state.service';\n\n@Component({\n    selector: 'dayview-topbar',\n    template: `\n        <button mat-button new class=\"w-12 xl:w-auto\" (click)=\"newBooking()\">\n            <div class=\"flex items-center\">\n                <app-icon\n                    class=\"mr-2\"\n                    [icon]=\"{ class: 'material-icons', content: 'add' }\"\n                ></app-icon>\n                <div class=\"hidden lg:block\">New Booking</div>\n            </div>\n        </button>\n        <mat-form-field appearance=\"outline\">\n            <mat-select\n                multiple\n                [(ngModel)]=\"zones\"\n                (ngModelChange)=\"updateZones($event)\"\n                placeholder=\"All Levels\"\n            >\n                <mat-option\n                    *ngFor=\"let level of levels | async\"\n                    [value]=\"level.id\"\n                >\n                    {{ level.display_name || level.name }}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n        <mat-form-field appearance=\"outline\">\n            <mat-select\n                multiple\n                [(ngModel)]=\"type_list\"\n                (ngModelChange)=\"updateTypes($event)\"\n                placeholder=\"No Events\"\n            >\n                <mat-select-trigger>Legend</mat-select-trigger>\n                <mat-option *ngFor=\"let type of types\" [value]=\"type.id\">\n                    {{ type.name }}\n                </mat-option>\n            </mat-select>\n        </mat-form-field>\n        <mat-slide-toggle\n            class=\"m-2\"\n            [ngModel]=\"(ui_options | async)?.show_overflow\"\n            (ngModelChange)=\"updateUIOptions({ show_overflow: $event })\"\n            ><div class=\"text-xs\">Setup / Breakdown</div></mat-slide-toggle\n        >\n        <mat-slide-toggle\n            class=\"m-2\"\n            [ngModel]=\"(ui_options | async)?.show_cleaning\"\n            (ngModelChange)=\"updateUIOptions({ show_cleaning: $event })\"\n            ><div class=\"text-xs\">Cleaners View</div></mat-slide-toggle\n        >\n        <div class=\"flex-1 w-0\"></div>\n        <!-- <searchbar class=\"mr-2\"></searchbar> -->\n        <date-options (dateChange)=\"setDate($event)\"></date-options>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                align-items: center;\n                background-color: #fff;\n                height: 5em;\n                padding: 0 1em;\n            }\n\n            button {\n                min-width: 0;\n                padding: 0 0.85rem;\n            }\n\n            mat-form-field {\n                height: 3.25em;\n                width: 8em;\n                margin-left: 1em;\n            }\n\n            mat-slide-toggle div {\n                width: 5.5em;\n                white-space: initial;\n                line-height: 1.2em;\n            }\n        `,\n    ],\n})\nexport class DayviewTopbarComponent extends BaseClass {\n    /** List of selected levels */\n    public zones: string[] = [];\n\n    public readonly types: Identity[] = [\n        { id: 'internal', name: 'Internal' },\n        { id: 'external', name: 'External' },\n        { id: 'cancelled', name: 'Cancelled' },\n    ];\n    /** List of selected types */\n    public type_list: string[] = this.types.map((i) => `${i.id}`);\n    /** List of levels for the active building */\n    public readonly levels = this._org.active_levels;\n    /** List of levels for the active building */\n    public readonly ui_options = this._state.options;\n    /** Set filtered date */\n    public readonly setDate = (d) => this._state.setDate(d);\n    /**  */\n    public readonly newBooking = (d?) => this._state.newBooking(d);\n    /** List of levels for the active building */\n    public readonly updateZones = (z) => {\n        this._router.navigate([], {\n            relativeTo: this._route,\n            queryParams: { zone_ids: z.join(',') },\n        });\n        this._state.setZones(z);\n    };\n    /** List of levels for the active building */\n    public readonly updateTypes = (types) =>\n        this._state.setFilters({\n            hide_type: this.types.reduce((list, item) => {\n                !types.includes(item.id) ? list.push(item) : '';\n                return list;\n            }, []),\n        });\n\n    public updateUIOptions(options: BookingUIOptions) {\n        this._state.setUIOptions(options);\n    }\n\n    constructor(\n        private _state: EventsStateService,\n        private _org: OrganisationService,\n        private _route: ActivatedRoute,\n        private _router: Router\n    ) {\n        super();\n    }\n\n    public async ngOnInit() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.subscription(\n            'route.query',\n            this._route.queryParamMap.subscribe((params) => {\n                if (params.has('zone_ids')) {\n                    const zones = params.get('zone_ids').split(',');\n                    if (zones.length) {\n                        this.zones = zones;\n                        const level = this._org.levelWithID(zones);\n                        if (!level) return;\n                        this._org.building = this._org.buildings.find(\n                            (bld) => bld.id === level.parent_id\n                        );\n                    }\n                }\n            })\n        );\n        this.subscription(\n            'levels',\n            this._org.active_levels.subscribe((levels) => {\n                this.zones = this.zones.filter((zone) =>\n                    levels.find((lvl) => lvl.id === zone)\n                );\n                if (!this.zones.length && levels.length) {\n                    this.zones.push(levels[0].id);\n                }\n                this.updateZones(this.zones);\n            })\n        );\n        this.updateTypes(this.type_list);\n    }\n}\n","import { Component, Input, OnChanges, SimpleChanges } from '@angular/core';\nimport { startOfDay, differenceInMinutes, format, addMinutes } from 'date-fns';\n\nimport { CalendarEvent } from '@placeos/events';\nimport { EventsStateService } from './events-state.service';\n\nconst DAY_IN_MINUTES = 24 * 60;\n\n@Component({\n    selector: 'dayview-event',\n    template: `\n        <div\n            *ngIf=\"(ui_options | async)?.show_overflow\"\n            [class]=\"\n                'overflow-block absolute rounded overflow-hidden w-full ' + type\n            \"\n            [style.top]=\"overflow_top * 100 + '%'\"\n            [style.height]=\"overflow_height * 100 + '%'\"\n        ></div>\n        <div\n            event\n            matRipple\n            [class]=\"\n                'absolute rounded overflow-hidden text-sm border border-gray-200 shadow-sm z-10 hover:z-30 ' +\n                type\n            \"\n            *ngIf=\"event\"\n            [style.top]=\"top * 100 + '%'\"\n            [style.height]=\"height * 100 + '%'\"\n            (click)=\"view(event)\"\n        >\n            <div class=\"px-2 py-1 font-medium\">{{ event.organiser?.name }}</div>\n            <div class=\"py-1 flex items-center\" *ngIf=\"event.duration > 30\">\n                <app-icon class=\"mx-2\">title</app-icon>\n                {{ event.title }}\n            </div>\n            <div class=\"py-1 flex items-center\" *ngIf=\"event.duration > 60\">\n                <app-icon class=\"mx-2\">schedule</app-icon>\n                {{ time }}\n            </div>\n            <div class=\"py-1 flex items-center\" *ngIf=\"event.duration > 90\">\n                <app-icon class=\"mx-2\">people</app-icon>\n                {{ event.attendees.length }} Attendee{{\n                    event.attendees.length === 1 ? '' : 's'\n                }}\n            </div>\n        </div>\n        <div\n            *ngIf=\"event && (ui_options | async)?.show_cleaning\"\n            cleaning\n            class=\"absolute rounded overflow-hidden flex w-full shadow p-2 bg-white z-20\"\n            [style.top]=\"top * 100 + '%'\"\n            [style.height]=\"height * 100 + '%'\"\n        >\n            <div\n                [class]=\"\n                    'icon flex items-center justify-center mr-2 text-3xl rounded h-12 w-12 text-pending ' +\n                    event.ext('cleaning_status')\n                \"\n            >\n                <app-icon>{{\n                    event.ext('cleaning_status') === 'done' ? 'done' : 'warning'\n                }}</app-icon>\n            </div>\n            <div class=\"flex-1 w-1/2\">\n                {{\n                    event.ext('cleaning_status') === 'done'\n                        ? 'Finished'\n                        : 'Scheduled to'\n                }}\n                clean at\n                {{\n                    event.ext('cleaning_time') || event.event_end * 1000\n                        | date: 'shortTime'\n                }}\n            </div>\n        </div>\n    `,\n    styles: [\n        `\n            [event] {\n                background-color: #ccc;\n                width: 12rem;\n                z-index: 100;\n                transition: box-shadow 200ms;\n            }\n\n            [event]:hover {\n                box-shadow: 0 1px 3px 1px rgba(0, 0, 0, 0.2),\n                    0 1px 1px 0 rgba(0, 0, 0, 0.14),\n                    0 2px 1px -1px rgba(0, 0, 0, 0.12) !important;\n                cursor: pointer;\n            }\n\n            .overflow-block {\n                opacity: 0.3;\n                width: 12rem;\n            }\n\n            .internal {\n                background-color: #1565c0;\n                color: #fff;\n            }\n\n            .icon {\n                background-color: #f0f0f0;\n            }\n\n            .icon.done {\n                color: #21a453;\n            }\n\n            .external {\n                background-color: #ad1457;\n                color: #fff;\n            }\n\n            .cancelled {\n                background-color: #ccc;\n            }\n        `,\n    ],\n})\nexport class DayviewEventComponent implements OnChanges {\n    /** Event to display */\n    @Input() public event: CalendarEvent;\n    /** Top position for the event */\n    public top = -999;\n    /** Height of the event on the calendar */\n    public height = 0;\n    /** Top position for the event */\n    public overflow_top = -999;\n    /** Height of the event on the calendar */\n    public overflow_height = 0;\n\n    public readonly ui_options = this._state.options;\n\n    public readonly view = (e) => this._state.setEvent(e);\n\n    public get time() {\n        const date = new Date(this.event.date);\n        return (\n            format(date, 'h:mm a') +\n            ' - ' +\n            format(addMinutes(date, this.event.duration), 'h:mm a')\n        );\n    }\n\n    public get type() {\n        return this.event.guests.length\n            ? 'external'\n            : this.event.status === 'declined'\n            ? 'cancelled'\n            : 'internal';\n    }\n\n    constructor(private _state: EventsStateService) {}\n\n    public ngOnChanges(changes: SimpleChanges) {\n        if (changes.event && this.event) {\n            const start = startOfDay(new Date(this.event.date));\n            const diff = differenceInMinutes(new Date(this.event.date), start);\n            this.top = diff / DAY_IN_MINUTES;\n            this.height = this.event.duration / DAY_IN_MINUTES;\n            this.overflow_top =\n                (diff - this.event.ext('setup')) / DAY_IN_MINUTES;\n            this.overflow_height =\n                (this.event.duration +\n                    this.event.ext('setup') +\n                    this.event.ext('breakdown')) /\n                DAY_IN_MINUTES;\n        }\n    }\n}\n","import { Component, Input, OnInit } from '@angular/core';\nimport { map } from 'rxjs/operators';\n\nimport { CalendarEvent } from '@placeos/events';\nimport { Space } from '@placeos/spaces';\nimport { EventsStateService } from './events-state.service';\nimport { BaseClass } from '@placeos/common';\n\n@Component({\n    selector: 'dayview-space',\n    template: `\n        <ng-container *ngIf=\"space\">\n            <dayview-event\n                *ngFor=\"let event of events | async\"\n                [event]=\"event\"\n            ></dayview-event>\n        </ng-container>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n                border-right: 1px solid rgba(0, 0, 0, 0.1);\n            }\n        `,\n    ],\n})\nexport class DayviewSpaceComponent extends BaseClass implements OnInit {\n    /** Space to display events for */\n    @Input() public space: Space;\n\n    public shown_event: CalendarEvent;\n    /** List of events for the selected space */\n    public readonly events = this._state.filtered.pipe(\n        map((bookings) =>\n            bookings.filter((bkn) =>\n                bkn.resources.find((space) => this.space.email === space.email)\n            )\n        )\n    );\n\n    constructor(private _state: EventsStateService) {\n        super();\n    }\n\n    public ngOnInit(): void {\n        this.subscription('events', this._state.filtered.subscribe());\n    }\n}\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { combineLatest } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nimport { BaseClass } from '@placeos/common';\nimport { OrganisationService } from '@placeos/organisation';\nimport { SpacesService } from '@placeos/spaces';\nimport { EventsStateService } from './events-state.service';\n\nconst HOUR_BLOCKS = new Array(24).fill(0).map((_, idx) => {\n    return (idx % 12 === 0 ? 12 : idx % 12) + (idx >= 12 ? ' PM' : ' AM');\n});\n\n@Component({\n    selector: 'dayview-timeline',\n    template: `\n        <div class=\"absolute inset-0 flex\">\n            <div class=\"time h-full w-24 overflow-hidden bg relative\">\n                <div header class=\"relative h-16 z-50\">\n                    <div\n                        class=\"bg absolute top-0 left-0 right-0 bottom-8\"\n                    ></div>\n                </div>\n                <div\n                    *ngFor=\"let time of blocks\"\n                    change-transform\n                    class=\"relative h-16 border-r border-gray-300 z-10\"\n                    [style.transform]=\"'translateY(-' + scroll.y + 'px)'\"\n                >\n                    <div\n                        class=\"absolute text-center w-full text-xs top-0 transform -translate-y-1/2 opacity-40\"\n                    >\n                        {{ time }}\n                    </div>\n                    <div\n                        class=\"absolute h-px w-2 top-0 right-0 bg-gray-300\"\n                    ></div>\n                </div>\n                <div class=\"absolute h-8 w-px top-8 right-0 bg-gray-300\"></div>\n            </div>\n            <div class=\"h-full flex-1 flex flex-col w-1/2\">\n                <div\n                    header\n                    class=\"flex relative overflow-hidden border-b border-gray-300 border-opacity-50 bg h-16 w-full\"\n                >\n                    <div\n                        *ngFor=\"let space of space_list | async\"\n                        change-transform\n                        class=\"relative h-16 w-48 min-w-[12rem]\"\n                        [style.transform]=\"'translateX(-' + scroll.x + 'px)'\"\n                    >\n                        <div\n                            bar\n                            class=\"absolute h-8 w-px bottom-0 -left-px bg-gray-300\"\n                        ></div>\n                        <div class=\"name m-2 text-center\">\n                            {{ space.display_name || space.name }}\n                        </div>\n                    </div>\n                </div>\n                <div\n                    #scroll_el\n                    content\n                    class=\"relative flex flex-1 overflow-auto\"\n                    (scroll)=\"onScroll($event)\"\n                >\n                    <dayview-space\n                        *ngFor=\"let space of space_list | async\"\n                        [space]=\"space\"\n                        class=\"w-48 min-w-[12rem] h-[96rem]\"\n                    ></dayview-space>\n                    <div\n                        *ngFor=\"let time of blocks; let i = index\"\n                        class=\"absolute bg-gray-300 h-px min-w-full left-0\"\n                        [style.width]=\"(space_list | async).length * 12 + 'rem'\"\n                        [style.top]=\"i * 4 + 'rem'\"\n                    ></div>\n                </div>\n            </div>\n            <mat-progress-bar\n                *ngIf=\"loading | async\"\n                mode=\"indeterminate\"\n                class=\"absolute bottom-0 left-0 right-0\"\n            ></mat-progress-bar>\n            <view-event-details\n                *ngIf=\"event | async\"\n                [event]=\"event | async\"\n            ></view-event-details>\n        </div>\n    `,\n    styles: [\n        `\n            :host {\n                position: relative;\n                height: 100%;\n                width: 100%;\n            }\n\n            .bg {\n                background-color: #ecf1f5;\n            }\n\n            [change-transform] {\n                will-change: transform;\n            }\n        `,\n    ],\n})\nexport class DayviewTimelineComponent\n    extends BaseClass\n    implements OnInit, OnDestroy {\n    /** Time blocks to display */\n    public readonly blocks: string[] = HOUR_BLOCKS;\n    /** Current scroll position of the content */\n    public scroll: { x: number; y: number } = { x: 0, y: 0 };\n    /** Whether event data is loading */\n    public readonly loading = this._state.loading;\n    /** Whether event data is loading */\n    public readonly event = this._state.event;\n    /** List of spaces to display */\n    public readonly space_list = combineLatest([\n        this._org.active_building,\n        this._spaces.list,\n        this._state.zones,\n    ]).pipe(\n        map(\n            ([bld, spaces, zones]) =>\n                spaces.filter(\n                    (space) =>\n                        space.zones.includes(bld.id) &&\n                        (!zones?.length ||\n                            space.zones.find((z) => zones.includes(z)))\n                ) || []\n        )\n    );\n\n    constructor(\n        private _org: OrganisationService,\n        private _spaces: SpacesService,\n        private _state: EventsStateService\n    ) {\n        super();\n    }\n\n    public ngOnInit() {\n        this._state.startPolling();\n    }\n\n    public ngOnDestroy() {\n        this._state.stopPolling();\n    }\n\n    public onScroll(e) {\n        requestAnimationFrame(\n            () =>\n                (this.scroll = {\n                    x: e.srcElement.scrollLeft,\n                    y: e.srcElement.scrollTop,\n                })\n        );\n    }\n}\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { ApplicationLinkInternal, SettingsService } from '@placeos/common';\n\n@Component({\n    selector: '[app-dayview]',\n    template: `\n        <sidebar class=\"h-full\"></sidebar>\n        <main\n            class=\"relative overflow-hidden flex flex-col flex-1 w-1/2 h-full\"\n        >\n            <dayview-topbar></dayview-topbar>\n            <dayview-timeline></dayview-timeline>\n        </main>\n    `,\n    styles: [\n        `\n            :host {\n                display: flex;\n                height: 100%;\n                width: 100%;\n                background: var(--bg);\n            }\n        `,\n    ],\n})\nexport class DayViewComponent implements OnInit {\n\n    public get links(): ApplicationLinkInternal[] {\n        return this._settings.get('app.general.menu') || [];\n    }\n\n    constructor(private _settings: SettingsService, private _router: Router) {}\n\n    public ngOnInit() {\n        if (!this.links.find(_ => _.route.includes('day-view'))) {\n            this._router.navigate([`/${this.links[0].route}`]);\n        }\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { RouterModule, Route } from '@angular/router';\n\nimport { UIModule } from '../ui/ui.module';\n\nimport { DayViewComponent } from './day-view.component';\nimport { DayviewTopbarComponent } from './dayview-topbar.component';\nimport { DayviewTimelineComponent } from './dayview-timeline.component';\nimport { DayviewSpaceComponent } from './dayview-space.component';\nimport { DayviewEventComponent } from './dayview-event.component';\n\nimport { BookingModalComponent } from './booking-modal.component';\nimport { EventFormComponent } from './event-form.component';\nimport { SharedSpacesModule } from '@placeos/spaces';\nimport { SharedUsersModule } from '@placeos/users';\n\nconst ROUTES: Route[] = [{ path: '', component: DayViewComponent }];\n\n@NgModule({\n    declarations: [\n        DayViewComponent,\n        DayviewTopbarComponent,\n        DayviewTimelineComponent,\n        DayviewSpaceComponent,\n        DayviewEventComponent,\n\n        BookingModalComponent,\n        EventFormComponent\n    ],\n    imports: [CommonModule, FormsModule, UIModule, SharedSpacesModule, SharedUsersModule, RouterModule.forChild(ROUTES)],\n})\nexport class DayViewModule {}\n"],"sourceRoot":"webpack:///","file":"apps_concierge_src_app_day-view_day-view_module_ts.js"}