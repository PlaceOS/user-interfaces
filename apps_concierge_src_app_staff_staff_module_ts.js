"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_staff_staff_module_ts"],{606:(Gt,Q,l)=>{l.r(Q),l.d(Q,{COMPONENTS:()=>kt,StaffModule:()=>qt});var f=l(6575),r=l(8849),O=l(2649),m=l(1670),$=l(8377),u=l(462),v=l(8159),y=l(8466),g=l(7422),A=l(6520),U=l(680),L=l(7343),H=l(7016),Y=l(4512),p=l(7109),T=l(3121),t=l(9039);let C=(()=>{class o extends p.cx{constructor(e){var n;super(),n=this,this._org=e,this._onsite={},this._events={},this._filters=new u.X({}),this._search=new u.X(""),this._loading=new u.X(!1),this._users=new u.X([]),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.users=this._filters.asObservable(),this.filtered_users=(0,v.aj)([this._search,this._users,this._filters]).pipe((0,g.U)(s=>{const[i,a,d]=s;return a.filter(x=>(!i||x.name.toLowerCase().includes(i)||x.email.toLowerCase().includes(i))&&(!d.only_onsite||this._onsite[x.email]))})),this.user_events=(0,v.aj)([this._filters]).pipe((0,A.w)(function(){var s=(0,m.Z)(function*(i){n._loading.next(!0);const a=yield(0,y.F2)({period_start:(0,L.Z)((0,H.Z)(Date.now())),period_end:(0,L.Z)((0,Y.Z)(Date.now())),type:"staff"}).toPromise(),d={},x=(new Date).valueOf();for(const _ of a)(0,p.MZ)(x,x,_.date,_.date+60*_.duration*1e3)&&(d[_.asset_id]=_.checked_in,n._events[_.asset_id]=_);return n._onsite=d,n._loading.next(!1),d});return function(i){return s.apply(this,arguments)}}()),(0,U.d)()),this.loadUsers(),this.user_events.subscribe()}setFilters(e){this._filters.next({...this._filters.getValue(),...e})}setSearchString(e){this._search.next(e)}startPolling(e=3e4){this.setFilters(this._filters.getValue()),this.interval("poll",()=>this.setFilters(this._filters.getValue()),e)}stopPolling(){this.clearInterval("poll")}checkin(e){var n=this;return(0,m.Z)(function*(){const s=yield(0,y.km)({booking_start:Math.floor((new Date).valueOf()/1e3),booking_end:Math.floor((0,Y.Z)(new Date).valueOf()/1e3),asset_id:e.email,title:"Checked-in Onsite",description:n._org.building.display_name||n._org.building.name,zones:[n._org.building.id],booking_type:"staff"}).toPromise();yield(0,y.FD)(s.id,!0).toPromise(),n._events[e.email]=s,n._onsite[e.email]=!0})()}checkout(e){var n=this;return(0,m.Z)(function*(){const s=n._events[e.email];if(s){const i=yield(0,y.km)({...s.toJSON(),booking_end:Math.floor((new Date).valueOf()/1e3)}).toPromise();yield(0,y.FD)(i.id,!1).toPromise(),n._events[e.email]=i,n._onsite[e.email]=!1}})()}loadUsers(){var e=this;return(0,m.Z)(function*(){const n=yield(0,$.VE)("").toPromise();n.sort((s,i)=>s.name.localeCompare(i.name)),e._users.next(n)})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.LFG(T.w7))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var W=l(2349),S=l(8173),K=l(7627),B=l(6410),b=l(1268),J=l(162),h=l(257),V=l(9293);function tt(o,c){if(1&o&&(t.TgZ(0,"mat-option",8),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.display_name||e.name," ")}}let N=(()=>{class o extends p.cx{constructor(e,n,s,i){super(),this._state=e,this._org=n,this._route=s,this._router=i,this.zones=[],this.levels=this._org.active_levels,this.filters=this._state.filters,this.setDate=a=>this._state.setFilters({date:a}),this.setFilters=a=>this._state.setFilters(a),this.setSearch=a=>this._state.setSearchString(a),this.updateZones=a=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:a.join(",")}}),this._state.setFilters({zones:a})}}ngOnInit(){var e=this;return(0,m.Z)(function*(){yield e._org.initialised.pipe((0,K.P)(n=>n)).toPromise(),e.subscription("route.query",e._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const s=n.get("zone_ids").split(",");if(s.length){const i=e._org.levelWithID(s);if(!i)return;e._org.building=e._org.buildings.find(a=>a.id===i.parent_id),e.zones=s}}})),e.subscription("levels",e._org.active_levels.subscribe(n=>{e.zones=e.zones.filter(s=>n.find(i=>i.id===s)),!e.zones.length&&n.length&&e.zones.push(n[0].id),e.updateZones(e.zones)})),e.setSearch("")})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(C),t.Y36(T.w7),t.Y36(O.gz),t.Y36(O.F0))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["staff-topbar"]],features:[t.qOj],decls:11,vars:7,consts:[[1,"flex","items-center","bg-base-100","h-20","px-4","border-b","border-base-200","space-x-2"],["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"m-2",3,"ngModel","ngModelChange"],[1,"text-xs"],[1,"flex-1","w-2"],[1,"mr-2",3,"modelChange"],[3,"value"]],template:function(n,s){if(1&n&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(a){return s.zones=a})("ngModelChange",function(a){return s.updateZones(a)}),t.YNc(3,tt,2,2,"mat-option",3),t.ALo(4,"async"),t.qZA()(),t.TgZ(5,"mat-slide-toggle",4),t.NdJ("ngModelChange",function(a){return s.setFilters({only_onsite:a})}),t.ALo(6,"async"),t.TgZ(7,"div",5),t._uU(8,"Onsite Only"),t.qZA()(),t._UZ(9,"div",6),t.TgZ(10,"searchbar",7),t.NdJ("modelChange",function(a){return s.setSearch(a)}),t.qZA()()),2&n){let i;t.xp6(2),t.Q6J("ngModel",s.zones),t.xp6(1),t.Q6J("ngForOf",t.lcZ(4,3,s.levels)),t.xp6(2),t.Q6J("ngModel",null==(i=t.lcZ(6,5,s.filters))?null:i.only_onsite)}},dependencies:[f.sg,r.JJ,r.On,B.U,b.KE,J.gD,h.ey,V.Rr,f.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=staff-topbar.component.ts-angular-inline--145.css.map*/"]})}return o})();var et=l(702),nt=l(4702),E=l(4888),ot=l(2882);function st(o,c){1&o&&(t.TgZ(0,"div",11),t._uU(1,"Onsite"),t.qZA())}function it(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",1),t._UZ(1,"a-user-avatar",2),t.TgZ(2,"div",3)(3,"div",4),t._uU(4),t.qZA(),t.TgZ(5,"div",5),t._uU(6),t.qZA()(),t.YNc(7,st,2,0,"div",6),t.TgZ(8,"div",7)(9,"action-icon",8),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.onsite?s.checkout():s.checkin())}),t.qZA(),t.TgZ(10,"a",9)(11,"app-icon"),t._uU(12,"email"),t.qZA()(),t.TgZ(13,"a",10)(14,"app-icon"),t._uU(15,"call"),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("user",e.user),t.xp6(3),t.Oqu(null==e.user?null:e.user.name),t.xp6(2),t.hij(" ",null==e.user?null:e.user.email," "),t.xp6(1),t.Q6J("ngIf",e.onsite),t.xp6(2),t.Q6J("matTooltip",e.onsite?"Checkout Staff":"Checkin Staff")("loading",e.loading)("content",e.onsite?"event_busy":"event_available"),t.xp6(1),t.Q6J("href","mailto:"+(null==e.user?null:e.user.email),t.LSH),t.uIk("disabled",!(null!=e.user&&e.user.email)),t.xp6(3),t.Q6J("href","tel:"+(null==e.user?null:e.user.phone),t.LSH),t.uIk("disabled",!(null!=e.user&&e.user.phone))}}let P=(()=>{class o{constructor(e){var n=this;this._state=e,this.checkin=(0,m.Z)(function*(){n.loading=!0,yield n._state.checkin(n.user).catch(s=>(0,p.cB)("Error checking in Staff member")),n.loading=!1}),this.checkout=(0,m.Z)(function*(){n.loading=!0,yield n._state.checkout(n.user).catch(s=>(0,p.cB)("Error checking out Staff member")),n.loading=!1})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(C))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["staff-details"]],inputs:{user:"user",onsite:"onsite"},decls:1,vars:1,consts:[["class","w-full flex items-center px-4 py-2 bg-base-100 border-b border-base-200 hover:opacity-80","details","",4,"ngIf"],["details","",1,"w-full","flex","items-center","px-4","py-2","bg-base-100","border-b","border-base-200","hover:opacity-80"],[3,"user"],[1,"flex","flex-col","flex-1"],[1,"px-2"],[1,"px-2","text-xs","text-opacity-50"],["class","text-xs opacity-50 px-4",4,"ngIf"],[1,"flex","items-center"],[3,"matTooltip","loading","content","click"],["icon","","matRipple","","matTooltip","Email Staff",3,"href"],["icon","","matRipple","","matTooltip","Phone Staff",3,"href"],[1,"text-xs","opacity-50","px-4"]],template:function(n,s){1&n&&t.YNc(0,it,16,11,"div",0),2&n&&t.Q6J("ngIf",s.user)},dependencies:[f.O5,et.gM,h.wG,nt.m,E.o,ot.k]})}return o})();const at=["container"];function lt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",7),t.NdJ("click",function(){const i=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.scrollTo(i))}),t.ALo(1,"async"),t._uU(2),t.qZA()}if(2&o){const e=c.$implicit,n=t.oxw();t.ekj("disabled",t.lcZ(1,5,n.user_list)[e].length<=0)("active",e===n.active_group),t.xp6(2),t.hij(" ",e," ")}}function ct(o,c){if(1&o&&(t._UZ(0,"staff-details",12),t.ALo(1,"async"),t.ALo(2,"async")),2&o){const e=c.$implicit,n=c.index,s=t.oxw(2).$implicit,i=t.oxw(2);t.Q6J("id","letter-"+s+"-"+n)("user",e)("onsite",!!t.lcZ(1,3,i.events)&&t.lcZ(2,5,i.events)[e.email])}}function rt(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"div",10),t._uU(2),t.qZA(),t.YNc(3,ct,3,7,"staff-details",11),t.ALo(4,"async"),t.BQk()),2&o){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("id","letter-"+("#"===e?"0":e)),t.xp6(1),t.hij(" ",e," "),t.xp6(1),t.Q6J("ngForOf",t.lcZ(4,3,n.user_list)[e])}}function ft(o,c){if(1&o&&(t.ynx(0),t.YNc(1,rt,5,5,"ng-container",9),t.ALo(2,"async"),t.BQk()),2&o){const e=c.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,1,n.user_list)[e].length)}}function mt(o,c){if(1&o&&(t.ynx(0),t.YNc(1,ft,3,3,"ng-container",8),t.BQk()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.groups)}}function pt(o,c){1&o&&t._UZ(0,"mat-progress-bar",13)}function dt(o,c){1&o&&(t.TgZ(0,"div",14)(1,"p"),t._uU(2,"No matching staff members"),t.qZA()())}const M="#abcdefghijklmnopqrstuvwxyz".split("");let F=(()=>{class o extends p.cx{constructor(e){super(),this._state=e,this.active_group="#",this.groups=M,this.events=this._state.user_events,this.loading=this._state.loading,this.user_count=this._state.filtered_users.pipe((0,g.U)(n=>n.length)),this.user_list=this._state.filtered_users.pipe((0,g.U)(n=>{const s={};for(const i of M)s[i]=(n||[]).filter(a=>a.name.toLowerCase()[0].startsWith(i)||"#"===i&&!M.includes(a.name.toLowerCase()[0]));return this.timeout("scroll",()=>this.onScroll({}),30),s}))}onScroll(e){const n=this._el.nativeElement.scrollTop;for(const s of M){const i=document.querySelector(`#letter-${"#"===s?"0":s}`);if(i){if(i.offsetTop-n>0)break;this.active_group=s}}}scrollTo(e){const n=document.querySelector(`#letter-${e}-0`);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),this.active_group=e)}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(C))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["staff-listings"]],viewQuery:function(n,s){if(1&n&&t.Gf(at,5),2&n){let i;t.iGM(i=t.CRH())&&(s._el=i.first)}},features:[t.qOj],decls:10,vars:8,consts:[[1,"w-full","p-2","flex","items-center","justify-center"],["letter","","class","capitalize h-6 w-6 flex items-center justify-center text-xs cursor-pointer",3,"disabled","active","click",4,"ngFor","ngForOf"],[1,"flex-1","overflow-auto","w-full","relative","bg-base-200",2,"height","50%",3,"scroll"],["container",""],[4,"ngIf","ngIfElse"],["mode","indeterminate",4,"ngIf"],["empty_state",""],["letter","",1,"capitalize","h-6","w-6","flex","items-center","justify-center","text-xs","cursor-pointer",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],["group","",1,"capitalize","bg-base-200","border-b","text-sm","font-medium","sticky","top-0","z-10",3,"id"],[3,"id","user","onsite",4,"ngFor","ngForOf"],[3,"id","user","onsite"],["mode","indeterminate"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center"]],template:function(n,s){if(1&n&&(t.TgZ(0,"div",0),t.YNc(1,lt,3,7,"div",1),t.qZA(),t.TgZ(2,"div",2,3),t.NdJ("scroll",function(a){return s.onScroll(a)}),t.YNc(4,mt,2,1,"ng-container",4),t.ALo(5,"async"),t.qZA(),t.YNc(6,pt,1,0,"mat-progress-bar",5),t.ALo(7,"async"),t.YNc(8,dt,3,0,"ng-template",null,6,t.W1O)),2&n){const i=t.MAs(9);t.xp6(1),t.Q6J("ngForOf",s.groups),t.xp6(3),t.Q6J("ngIf",t.lcZ(5,4,s.user_count))("ngIfElse",i),t.xp6(2),t.Q6J("ngIf",t.lcZ(7,6,s.loading))}},dependencies:[f.sg,f.O5,S.pW,P,f.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:50%}[letter][_ngcontent-%COMP%]{transition:font-size .2s,color .2s}[group][_ngcontent-%COMP%]{border-color:#ccc;padding:.5rem 1.65rem}.disabled[_ngcontent-%COMP%]{opacity:.2;pointer-events:none}.active[_ngcontent-%COMP%]{font-size:1.25rem;opacity:1;color:#d81b60}\n\n/*# sourceMappingURL=staff-listing.component.ts-angular-inline--146.css.map*/"]})}return o})();const gt=["app-staff",""];function ut(o,c){1&o&&t._UZ(0,"mat-progress-bar",4)}let j=(()=>{class o{constructor(e){this._state=e,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(C))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","app-staff",""]],attrs:gt,decls:6,vars:3,consts:[[1,"relative","overflow-hidden","flex-1","flex","flex-col"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(n,s){1&n&&(t._UZ(0,"sidebar"),t.TgZ(1,"main",0),t._UZ(2,"staff-topbar",1)(3,"staff-listings",2),t.YNc(4,ut,1,0,"mat-progress-bar",3),t.ALo(5,"async"),t.qZA()),2&n&&(t.xp6(4),t.Q6J("ngIf",t.lcZ(5,1,s.loading)))},dependencies:[f.O5,W.k,S.pW,N,F,f.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;background:var(--b1)}\n\n/*# sourceMappingURL=staff.component.ts-angular-inline--144.css.map*/"]})}return o})();var _t=l(7910),D=l(3005),R=l(9842);const ht=["app-new-staff",""];function xt(o,c){1&o&&t._UZ(0,"mat-progress-bar",5)}let z=(()=>{class o{constructor(e){this._state=e,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(C))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","app-new-staff",""]],attrs:ht,decls:8,vars:3,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(n,s){1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1),t._UZ(4,"staff-topbar",2)(5,"staff-listings",3),t.YNc(6,xt,1,0,"mat-progress-bar",4),t.ALo(7,"async"),t.qZA()()),2&n&&(t.xp6(6),t.Q6J("ngIf",t.lcZ(7,1,s.loading)))},dependencies:[f.O5,D.O,R.u,S.pW,N,F,f.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=new-staff.component.ts-angular-inline--147.css.map*/"]})}return o})();var Z=l(7298),k=l(5046),I=l(6939),w=l(7401),vt=l(1862),q=l(9674),yt=l(3910),Ct=l(576),Zt=l(3884);function Tt(o,c){1&o&&(t.TgZ(0,"button",6)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function bt(o,c){if(1&o&&(t.TgZ(0,"mat-option",25),t._uU(1),t.qZA()),2&o){const e=t.oxw().$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function Mt(o,c){if(1&o&&(t.ynx(0),t.YNc(1,bt,2,2,"mat-option",24),t.BQk()),2&o){const e=c.$implicit;t.xp6(1),t.Q6J("ngIf",e)}}const wt=()=>({standalone:!0}),Ot=()=>[];function At(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"main",7)(1,"form",8)(2,"a-user-search-field",9),t.NdJ("ngModelChange",function(s){t.CHM(e);const i=t.oxw();return t.KtG(i.setUser(s))}),t.qZA(),t.TgZ(3,"div",10)(4,"label",11),t._uU(5,"Name:"),t.qZA(),t.TgZ(6,"mat-form-field",12),t._UZ(7,"input",13),t.qZA()(),t.TgZ(8,"div",14)(9,"div",15)(10,"label",16),t._uU(11,"Email:"),t.qZA(),t.TgZ(12,"mat-form-field",12),t._UZ(13,"input",17),t.qZA()(),t.TgZ(14,"div",15)(15,"label",16),t._uU(16,"Phone:"),t.qZA(),t.TgZ(17,"mat-form-field",12),t._UZ(18,"input",18),t.qZA()()(),t.TgZ(19,"div",10)(20,"label",16),t._uU(21,"Roles:"),t.qZA(),t.TgZ(22,"div",14)(23,"mat-form-field",19)(24,"mat-select",20),t.YNc(25,Mt,2,1,"ng-container",21),t.ALo(26,"async"),t.qZA()(),t.TgZ(27,"button",22)(28,"app-icon"),t._uU(29,"add"),t.qZA(),t.TgZ(30,"div",23),t._uU(31,"Add New Role"),t.qZA()()()()()()}if(2&o){const e=t.oxw(),n=t.MAs(10);let s;t.xp6(1),t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("ngModelOptions",t.DdM(6,wt)),t.xp6(23),t.Q6J("ngForOf",(null==(s=t.lcZ(26,4,e.data))?null:s.roles)||t.DdM(7,Ot)),t.xp6(2),t.Q6J("content",n)}}function Ut(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"footer",26)(1,"button",27),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.save())}),t._uU(2,"Save"),t.qZA()()}}function St(o,c){1&o&&(t.TgZ(0,"main",28),t._UZ(1,"mat-spinner",29),t.TgZ(2,"p"),t._uU(3,"Saving contact details..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",48))}function Jt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",30)(1,"mat-form-field",12)(2,"input",31),t.NdJ("ngModelChange",function(s){t.CHM(e);const i=t.oxw();return t.KtG(i.role_name=s)}),t.qZA()(),t.TgZ(3,"button",32),t.NdJ("click",function(){t.CHM(e);const s=t.oxw();return t.KtG(s.addRole())}),t._uU(4," Save Role "),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.role_name)}}let G=(()=>{class o{constructor(e,n,s){this._data=e,this._dialog_ref=n,this._org=s,this._changes=new u.X(0),this.loading=!1,this.contact=this._data,this.data=(0,v.aj)([this._org.active_building,this._changes]).pipe((0,k.h)(([i])=>!!i),(0,A.w)(([i])=>(0,Z.rlq)(i.id,"emergency_contacts")),(0,g.U)(({details:i})=>i||{roles:[],contacts:[]}),(0,U.d)(1)),this.form=new r.cw({id:new r.NI(this._data?.id||`ecntct-${(0,p.O1)(8)}`),name:new r.NI(this._data?.name||""),email:new r.NI(this._data?.email||""),phone:new r.NI(this._data?.phone||""),roles:new r.NI(this._data?.roles||[])})}addRole(){var e=this;return(0,m.Z)(function*(){if(!e.role_name)return;e._tooltip.close(),e.loading=!0,e._dialog_ref.disableClose=!0;const n=yield e.data.pipe((0,I.q)(1)).toPromise();yield(0,Z.Ymr)(e._org.building.id,{name:"emergency_contacts",description:"Emergency Contacts",details:{roles:[...n.roles,e.role_name].filter(s=>!!s),contacts:n.contacts}}).toPromise(),e._changes.next(0),e.form.patchValue({roles:[...e.form.value.roles,e.role_name]}),e.role_name="",e.loading=!1,e._dialog_ref.disableClose=!1})()}setUser(e){this.form.patchValue({name:e?.name,email:e?.email,phone:e?.phone})}save(){var e=this;return(0,m.Z)(function*(){e.loading=!0,e._dialog_ref.disableClose=!0;const n=yield e.data.pipe((0,I.q)(1)).toPromise(),i=[...(n?.contacts||[]).filter(a=>a.id!==e.contact?.id),e.form.value].sort((a,d)=>a.name.localeCompare(d.name));yield(0,Z.Ymr)(e._org.building.id,{name:"emergency_contacts",description:"Emergency Contacts",details:{roles:n.roles,contacts:i}}).toPromise(),e._dialog_ref.disableClose=!0,(0,p.t5)("Successfully updated emergency contacts."),e.loading=!1,e._dialog_ref.close()})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(w.WI),t.Y36(w.so),t.Y36(T.w7))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["emergency-contact-modal"]],viewQuery:function(n,s){if(1&n&&t.Gf(vt.Xo,5),2&n){let i;t.iGM(i=t.CRH())&&(s._tooltip=i.first)}},decls:11,vars:5,consts:[[1,"flex-1","w-0"],["icon","","mat-dialog-close","",4,"ngIf"],["class","p-4 w-[36rem]",4,"ngIf","ngIfElse"],["class","flex justify-center items-center p-2 border-t border-base-200",4,"ngIf"],["load_state",""],["role_form",""],["icon","","mat-dialog-close",""],[1,"p-4","w-[36rem]"],[1,"space-y-4",3,"formGroup"],["ngModel","",3,"ngModelOptions","ngModelChange"],[1,"flex","flex-col"],["for","name"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Full name"],[1,"flex","items-center","space-x-2"],[1,"flex","flex-col","flex-1"],["for","email"],["matInput","","formControlName","email","type","email","placeholder","Email address"],["matInput","","formControlName","phone","type","tel","placeholder","Emergency contact number"],["appearance","outline",1,"no-subscript","flex-1"],["multiple","","formControlName","roles","placeholder","Select roles"],[4,"ngFor","ngForOf"],["btn","","matRipple","","customTooltip","",1,"space-x-2",3,"content"],[1,"pr-2"],[3,"value",4,"ngIf"],[3,"value"],[1,"flex","justify-center","items-center","p-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-32",3,"click"],["loading","",1,"h-64","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"],[1,"bg-base-100","p-4","rounded"],["matInput","","placeholder","Role name",3,"ngModel","ngModelChange"],["btn","","matRipple","",1,"w-full",3,"click"]],template:function(n,s){if(1&n&&(t.TgZ(0,"header")(1,"h2"),t._uU(2),t.qZA(),t._UZ(3,"div",0),t.YNc(4,Tt,3,0,"button",1),t.qZA(),t.YNc(5,At,32,8,"main",2)(6,Ut,3,0,"footer",3)(7,St,4,1,"ng-template",null,4,t.W1O)(9,Jt,5,1,"ng-template",null,5,t.W1O)),2&n){const i=t.MAs(8);t.xp6(2),t.hij("",s.contact?"Edit":"New"," Emergency Contact"),t.xp6(2),t.Q6J("ngIf",!s.loading),t.xp6(1),t.Q6J("ngIf",!s.loading)("ngIfElse",i),t.xp6(1),t.Q6J("ngIf",!s.loading)}},dependencies:[f.sg,f.O5,r._Y,r.Fj,r.JJ,r.JL,r.On,b.KE,q.Nt,J.gD,h.ey,yt.Ou,w.ZT,h.wG,r.sg,r.u,Ct.d,E.o,Zt.X,f.Ov]})}return o})();var Nt=l(7442);const Et=["app-emergency-contacts",""];function Ft(o,c){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function It(o,c){if(1&o&&(t.TgZ(0,"span",22),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.xp6(1),t.hij(" ",e," ")}}function Qt(o,c){1&o&&t.YNc(0,It,2,1,"span",21),2&o&&t.Q6J("ngForOf",c.data)}function Lt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"div",23)(1,"button",24),t.NdJ("click",function(){const i=t.CHM(e).row,a=t.oxw();return t.KtG(a.editContact(i))}),t.TgZ(2,"app-icon"),t._uU(3,"edit"),t.qZA()(),t.TgZ(4,"button",24),t.NdJ("click",function(){const i=t.CHM(e).row,a=t.oxw();return t.KtG(a.removeContact(i))}),t.TgZ(5,"app-icon"),t._uU(6,"delete"),t.qZA()()()}}const Yt=()=>[],Pt=()=>["email","name","roles","actions"],jt=()=>["Email","Name","Roles"," "],Dt=()=>["flex","12r","16r","7r"],Rt=(o,c)=>({roles:o,actions:c});let X=(()=>{class o{constructor(e,n){this._org=e,this._dialog=n,this._change=new u.X(0),this.search="",this.role_filter=new u.X(""),this.data=(0,v.aj)([this._org.active_building,this._change]).pipe((0,k.h)(([s])=>!!s),(0,A.w)(([s])=>(0,Z.rlq)(s.id,"emergency_contacts")),(0,g.U)(({details:s})=>s||{roles:[],contacts:[]}),(0,U.d)(1)),this.roles=this.data.pipe((0,g.U)(s=>s?.roles||[])),this.contacts=this.data.pipe((0,g.U)(s=>s?.contacts||[])),this.filtered_contacts=(0,v.aj)([this.contacts,this.role_filter]).pipe((0,g.U)(([s,i])=>s.filter(a=>!i||a.roles.includes(i))))}ngOnInit(){}editContact(e){this._dialog.open(G,{data:e}).afterClosed().subscribe(()=>this._change.next(Date.now()))}removeContact(e){var n=this;return(0,m.Z)(function*(){const s=yield(0,p._5)({title:"Remove Emergency Contact",content:`Are you sure you want to remove ${e.name} from the emergency contacts?`,icon:{content:"delete"}},n._dialog);if("done"!==s.reason)return;s.loading("Removing contact...");const i=yield n.data.pipe((0,I.q)(1)).toPromise(),a=(i?.contacts||[]).filter(d=>d.id!==e.id);yield(0,Z.Ymr)(n._org.building.id,{name:"emergency_contacts",description:"Emergency Contacts",details:{roles:i.roles,contacts:a}}).toPromise(),s.close(),n._change.next(Date.now()),(0,p.t5)("Successfully removed emergency contact.")})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(T.w7),t.Y36(w.uw))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","app-emergency-contacts",""]],attrs:Et,decls:31,vars:19,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],["topbar","",1,"px-8","py-4","flex","flex-col"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-medium"],[1,"flex","items-center","space-x-2"],["appearance","outline",1,"no-subscript"],["matPrefix","",1,"text-2xl"],["matInput","","placeholder","Filter contacts...",3,"ngModel","ngModelChange"],["btn","","matRipple","",1,"space-x-2",3,"click"],[1,"text-2xl"],[1,"pr-2"],[1,"flex","items-center","py-2","mt-2"],["placeholder","All Roles",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"w-full","h-1/2","flex-1","overflow-auto","px-8"],[1,"min-w-[40rem]","block",3,"dataSource","filter","columns","display_column","column_size","template","empty"],["roles_template",""],["actions_template",""],[3,"value"],["class","m-1 py-1 px-2 rounded-2xl text-xs font-mono bg-info text-info-content",4,"ngFor","ngForOf"],[1,"m-1","py-1","px-2","rounded-2xl","text-xs","font-mono","bg-info","text-info-content"],[1,"flex","items-center","justify-end","w-full","space-x-2"],["icon","","matRipple","",3,"click"]],template:function(n,s){if(1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1)(4,"section",2)(5,"div",3)(6,"h2",4),t._uU(7,"Emergency Contacts"),t.qZA(),t.TgZ(8,"div",5)(9,"mat-form-field",6)(10,"app-icon",7),t._uU(11," search "),t.qZA(),t.TgZ(12,"input",8),t.NdJ("ngModelChange",function(a){return s.search=a}),t.qZA()(),t.TgZ(13,"button",9),t.NdJ("click",function(){return s.editContact()}),t.TgZ(14,"app-icon",10),t._uU(15,"add"),t.qZA(),t.TgZ(16,"div",11),t._uU(17,"Add Contact"),t.qZA()()()(),t.TgZ(18,"div",12)(19,"mat-form-field",6)(20,"mat-select",13),t.NdJ("ngModelChange",function(a){return s.role_filter.next(a)}),t.TgZ(21,"mat-option",14),t._uU(22,"All Roles"),t.qZA(),t.YNc(23,Ft,2,2,"mat-option",15),t.ALo(24,"async"),t.qZA()()()(),t.TgZ(25,"section",16),t._UZ(26,"custom-table",17),t.YNc(27,Qt,1,1,"ng-template",null,18,t.W1O)(29,Lt,7,0,"ng-template",null,19,t.W1O),t.qZA()()()),2&n){const i=t.MAs(28),a=t.MAs(30);t.xp6(12),t.Q6J("ngModel",s.search),t.xp6(8),t.Q6J("ngModel",s.role_filter.getValue()),t.xp6(3),t.Q6J("ngForOf",t.lcZ(24,10,s.roles)||t.DdM(12,Yt)),t.xp6(3),t.Q6J("dataSource",s.filtered_contacts)("filter",s.search)("columns",t.DdM(13,Pt))("display_column",t.DdM(14,jt))("column_size",t.DdM(15,Dt))("template",t.WLB(16,Rt,i,a))("empty",s.search?"No matching contacts":"No emergency contacts for this building")}},dependencies:[f.sg,r.Fj,r.JJ,r.On,D.O,R.u,b.KE,b.qo,q.Nt,J.gD,h.ey,h.wG,E.o,Nt.C,f.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=emergency-contacts.component.ts-angular-inline--148.css.map*/"]})}return o})();const zt=[{path:"",component:j},{path:"new",component:z},{path:"emergency-contacts",component:X}],kt=[z,j,N,F,P,X,G];let qt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[f.ez,r.u5,_t.v,O.Bz.forChild(zt)]})}return o})()}}]);
//# sourceMappingURL=apps_concierge_src_app_staff_staff_module_ts.js.map