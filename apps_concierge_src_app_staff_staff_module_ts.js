"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_staff_staff_module_ts"],{10789:(V,U,l)=>{l.r(U),l.d(U,{COMPONENTS:()=>Wt,StaffModule:()=>Bt});var m=l(26575),r=l(28849),J=l(92649),f=l(71670),S=l(59524),u=l(70462),v=l(28159),x=l(78466),d=l(47422),b=l(36520),p=l(680),P=l(67343),tt=l(57016),j=l(4512),_=l(34592),M=l(93121),t=l(29039);let w=(()=>{class i extends _.cx{constructor(e){var n;super(),n=this,this._org=e,this._onsite={},this._events={},this._filters=new u.X({}),this._search=new u.X(""),this._loading=new u.X(!1),this._users=new u.X([]),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.users=this._filters.asObservable(),this.filtered_users=(0,v.aj)([this._search,this._users,this._filters]).pipe((0,d.U)(o=>{const[s,a,g]=o;return a.filter(T=>(!s||T.name.toLowerCase().includes(s)||T.email.toLowerCase().includes(s))&&(!g.only_onsite||this._onsite[T.email]))})),this.user_events=(0,v.aj)([this._filters]).pipe((0,b.w)(function(){var o=(0,f.Z)(function*(s){n._loading.next(!0);const a=yield(0,x.F2)({period_start:(0,P.Z)((0,tt.Z)(Date.now())),period_end:(0,P.Z)((0,j.Z)(Date.now())),type:"staff"}).toPromise(),g={},T=(new Date).valueOf();for(const C of a)(0,_.MZ)(T,T,C.date,C.date+60*C.duration*1e3)&&(g[C.asset_id]=C.checked_in,n._events[C.asset_id]=C);return n._onsite=g,n._loading.next(!1),g});return function(s){return o.apply(this,arguments)}}()),(0,p.d)()),this.loadUsers(),this.user_events.subscribe()}setFilters(e){this._filters.next({...this._filters.getValue(),...e})}setSearchString(e){this._search.next(e)}startPolling(e=3e4){this.setFilters(this._filters.getValue()),this.interval("poll",()=>this.setFilters(this._filters.getValue()),e)}stopPolling(){this.clearInterval("poll")}checkin(e){var n=this;return(0,f.Z)(function*(){const o=yield(0,x.km)({booking_start:Math.floor((new Date).valueOf()/1e3),booking_end:Math.floor((0,j.Z)(new Date).valueOf()/1e3),asset_id:e.email,title:"Checked-in Onsite",description:n._org.building.display_name||n._org.building.name,zones:[n._org.building.id],booking_type:"staff"}).toPromise();yield(0,x.FD)(o.id,!0).toPromise(),n._events[e.email]=o,n._onsite[e.email]=!0})()}checkout(e){var n=this;return(0,f.Z)(function*(){const o=n._events[e.email];if(o){const s=yield(0,x.km)({...o.toJSON(),booking_end:Math.floor((new Date).valueOf()/1e3)}).toPromise();yield(0,x.FD)(s.id,!1).toPromise(),n._events[e.email]=s,n._onsite[e.email]=!1}})()}loadUsers(){var e=this;return(0,f.Z)(function*(){const n=yield(0,S.VE)("").toPromise();n.sort((o,s)=>o.name.localeCompare(s.name)),e._users.next(n)})()}static#t=this.\u0275fac=function(n){return new(n||i)(t.LFG(M.w7))};static#e=this.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var et=l(42349),F=l(78173),nt=l(17627),ot=l(97338),A=l(71268),R=l(96355),y=l(10257),it=l(59293);function st(i,c){if(1&i&&(t.TgZ(0,"mat-option",8),t._uU(1),t.qZA()),2&i){const e=c.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.display_name||e.name," ")}}let Q=(()=>{class i extends _.cx{constructor(e,n,o,s){super(),this._state=e,this._org=n,this._route=o,this._router=s,this.zones=[],this.levels=this._org.active_levels,this.filters=this._state.filters,this.setDate=a=>this._state.setFilters({date:a}),this.setFilters=a=>this._state.setFilters(a),this.setSearch=a=>this._state.setSearchString(a),this.updateZones=a=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:a.join(",")}}),this._state.setFilters({zones:a})}}ngOnInit(){var e=this;return(0,f.Z)(function*(){yield e._org.initialised.pipe((0,nt.P)(n=>n)).toPromise(),e.subscription("route.query",e._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const o=n.get("zone_ids").split(",");if(o.length){const s=e._org.levelWithID(o);if(!s)return;e._org.building=e._org.buildings.find(a=>a.id===s.parent_id),e.zones=o}}})),e.subscription("levels",e._org.active_levels.subscribe(n=>{e.zones=e.zones.filter(o=>n.find(s=>s.id===o)),!e.zones.length&&n.length&&e.zones.push(n[0].id),e.updateZones(e.zones)})),e.setSearch("")})()}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(w),t.Y36(M.w7),t.Y36(J.gz),t.Y36(J.F0))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["staff-topbar"]],features:[t.qOj],decls:11,vars:7,consts:[[1,"flex","items-center","bg-base-100","h-20","px-4","border-b","border-base-200","space-x-2"],["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"m-2",3,"ngModel","ngModelChange"],[1,"text-xs"],[1,"flex-1","w-2"],[1,"mr-2",3,"modelChange"],[3,"value"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(a){return o.zones=a})("ngModelChange",function(a){return o.updateZones(a)}),t.YNc(3,st,2,2,"mat-option",3),t.ALo(4,"async"),t.qZA()(),t.TgZ(5,"mat-slide-toggle",4),t.NdJ("ngModelChange",function(a){return o.setFilters({only_onsite:a})}),t.ALo(6,"async"),t.TgZ(7,"div",5),t._uU(8,"Onsite Only"),t.qZA()(),t._UZ(9,"div",6),t.TgZ(10,"searchbar",7),t.NdJ("modelChange",function(a){return o.setSearch(a)}),t.qZA()()),2&n){let s;t.xp6(2),t.Q6J("ngModel",o.zones),t.xp6(),t.Q6J("ngForOf",t.lcZ(4,3,o.levels)),t.xp6(2),t.Q6J("ngModel",null==(s=t.lcZ(6,5,o.filters))?null:s.only_onsite)}},dependencies:[m.sg,r.JJ,r.On,ot.U,A.KE,R.gD,y.ey,it.Rr,m.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=staff-topbar.component.ts-angular-inline--150.css.map*/"]})}return i})();var k=l(60702),at=l(24702),N=l(94888),lt=l(32882);function ct(i,c){1&i&&(t.TgZ(0,"div",11),t._uU(1,"Onsite"),t.qZA())}function rt(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",1),t._UZ(1,"a-user-avatar",2),t.TgZ(2,"div",3)(3,"div",4),t._uU(4),t.qZA(),t.TgZ(5,"div",5),t._uU(6),t.qZA()(),t.YNc(7,ct,2,0,"div",6),t.TgZ(8,"div",7)(9,"action-icon",8),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.onsite?o.checkout():o.checkin())}),t.qZA(),t.TgZ(10,"a",9)(11,"app-icon"),t._uU(12,"email"),t.qZA()(),t.TgZ(13,"a",10)(14,"app-icon"),t._uU(15,"call"),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(),t.Q6J("user",e.user),t.xp6(3),t.Oqu(null==e.user?null:e.user.name),t.xp6(2),t.hij(" ",null==e.user?null:e.user.email," "),t.xp6(),t.Q6J("ngIf",e.onsite),t.xp6(2),t.Q6J("matTooltip",e.onsite?"Checkout Staff":"Checkin Staff")("loading",e.loading)("content",e.onsite?"event_busy":"event_available"),t.xp6(),t.Q6J("href","mailto:"+(null==e.user?null:e.user.email),t.LSH),t.uIk("disabled",!(null!=e.user&&e.user.email)),t.xp6(3),t.Q6J("href","tel:"+(null==e.user?null:e.user.phone),t.LSH),t.uIk("disabled",!(null!=e.user&&e.user.phone))}}let z=(()=>{class i{constructor(e){var n=this;this._state=e,this.checkin=(0,f.Z)(function*(){n.loading=!0,yield n._state.checkin(n.user).catch(o=>(0,_.cB)("Error checking in Staff member")),n.loading=!1}),this.checkout=(0,f.Z)(function*(){n.loading=!0,yield n._state.checkout(n.user).catch(o=>(0,_.cB)("Error checking out Staff member")),n.loading=!1})}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["staff-details"]],inputs:{user:"user",onsite:"onsite"},decls:1,vars:1,consts:[["class","w-full flex items-center px-4 py-2 bg-base-100 border-b border-base-200 hover:opacity-80","details","",4,"ngIf"],["details","",1,"w-full","flex","items-center","px-4","py-2","bg-base-100","border-b","border-base-200","hover:opacity-80"],[3,"user"],[1,"flex","flex-col","flex-1"],[1,"px-2"],[1,"px-2","text-xs","text-opacity-50"],["class","text-xs opacity-50 px-4",4,"ngIf"],[1,"flex","items-center"],[3,"matTooltip","loading","content","click"],["icon","","matRipple","","matTooltip","Email Staff",3,"href"],["icon","","matRipple","","matTooltip","Phone Staff",3,"href"],[1,"text-xs","opacity-50","px-4"]],template:function(n,o){1&n&&t.YNc(0,rt,16,11,"div",0),2&n&&t.Q6J("ngIf",o.user)},dependencies:[m.O5,k.gM,y.wG,at.m,N.o,lt.k]})}return i})();const mt=["container"];function pt(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",7),t.NdJ("click",function(){const s=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.scrollTo(s))}),t.ALo(1,"async"),t._uU(2),t.qZA()}if(2&i){const e=c.$implicit,n=t.oxw();t.ekj("disabled",t.lcZ(1,5,n.user_list)[e].length<=0)("active",e===n.active_group),t.xp6(2),t.hij(" ",e," ")}}function ft(i,c){if(1&i&&(t._UZ(0,"staff-details",12),t.ALo(1,"async"),t.ALo(2,"async")),2&i){const e=c.$implicit,n=c.index,o=t.oxw(2).$implicit,s=t.oxw(2);t.Q6J("id","letter-"+o+"-"+n)("user",e)("onsite",!!t.lcZ(1,3,s.events)&&t.lcZ(2,5,s.events)[e.email])}}function dt(i,c){if(1&i&&(t.ynx(0),t.TgZ(1,"div",10),t._uU(2),t.qZA(),t.YNc(3,ft,3,7,"staff-details",11),t.ALo(4,"async"),t.BQk()),2&i){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(),t.Q6J("id","letter-"+("#"===e?"0":e)),t.xp6(),t.hij(" ",e," "),t.xp6(),t.Q6J("ngForOf",t.lcZ(4,3,n.user_list)[e])}}function gt(i,c){if(1&i&&(t.ynx(0),t.YNc(1,dt,5,5,"ng-container",9),t.ALo(2,"async"),t.BQk()),2&i){const e=c.$implicit,n=t.oxw(2);t.xp6(),t.Q6J("ngIf",t.lcZ(2,1,n.user_list)[e].length)}}function ut(i,c){if(1&i&&(t.ynx(0),t.YNc(1,gt,3,3,"ng-container",8),t.BQk()),2&i){const e=t.oxw();t.xp6(),t.Q6J("ngForOf",e.groups)}}function _t(i,c){1&i&&t._UZ(0,"mat-progress-bar",13)}function ht(i,c){1&i&&(t.TgZ(0,"div",14)(1,"p"),t._uU(2,"No matching staff members"),t.qZA()())}const E="#abcdefghijklmnopqrstuvwxyz".split("");let I=(()=>{class i extends _.cx{constructor(e){super(),this._state=e,this.active_group="#",this.groups=E,this.events=this._state.user_events,this.loading=this._state.loading,this.user_count=this._state.filtered_users.pipe((0,d.U)(n=>n.length)),this.user_list=this._state.filtered_users.pipe((0,d.U)(n=>{const o={};for(const s of E)o[s]=(n||[]).filter(a=>a.name.toLowerCase()[0].startsWith(s)||"#"===s&&!E.includes(a.name.toLowerCase()[0]));return this.timeout("scroll",()=>this.onScroll({}),30),o}))}onScroll(e){const n=this._el.nativeElement.scrollTop;for(const o of E){const s=document.querySelector(`#letter-${"#"===o?"0":o}`);if(s){if(s.offsetTop-n>0)break;this.active_group=o}}}scrollTo(e){const n=document.querySelector(`#letter-${e}-0`);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),this.active_group=e)}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["staff-listings"]],viewQuery:function(n,o){if(1&n&&t.Gf(mt,5),2&n){let s;t.iGM(s=t.CRH())&&(o._el=s.first)}},features:[t.qOj],decls:10,vars:8,consts:[[1,"w-full","p-2","flex","items-center","justify-center"],["letter","","class","capitalize h-6 w-6 flex items-center justify-center text-xs cursor-pointer",3,"disabled","active","click",4,"ngFor","ngForOf"],[1,"flex-1","overflow-auto","w-full","relative","bg-base-200",2,"height","50%",3,"scroll"],["container",""],[4,"ngIf","ngIfElse"],["mode","indeterminate",4,"ngIf"],["empty_state",""],["letter","",1,"capitalize","h-6","w-6","flex","items-center","justify-center","text-xs","cursor-pointer",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],["group","",1,"capitalize","bg-base-200","border-b","text-sm","font-medium","sticky","top-0","z-10",3,"id"],[3,"id","user","onsite",4,"ngFor","ngForOf"],[3,"id","user","onsite"],["mode","indeterminate"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center"]],template:function(n,o){if(1&n&&(t.TgZ(0,"div",0),t.YNc(1,pt,3,7,"div",1),t.qZA(),t.TgZ(2,"div",2,3),t.NdJ("scroll",function(a){return o.onScroll(a)}),t.YNc(4,ut,2,1,"ng-container",4),t.ALo(5,"async"),t.qZA(),t.YNc(6,_t,1,0,"mat-progress-bar",5),t.ALo(7,"async"),t.YNc(8,ht,3,0,"ng-template",null,6,t.W1O)),2&n){const s=t.MAs(9);t.xp6(),t.Q6J("ngForOf",o.groups),t.xp6(3),t.Q6J("ngIf",t.lcZ(5,4,o.user_count))("ngIfElse",s),t.xp6(2),t.Q6J("ngIf",t.lcZ(7,6,o.loading))}},dependencies:[m.sg,m.O5,F.pW,z,m.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:50%}[letter][_ngcontent-%COMP%]{transition:font-size .2s,color .2s}[group][_ngcontent-%COMP%]{border-color:#ccc;padding:.5rem 1.65rem}.disabled[_ngcontent-%COMP%]{opacity:.2;pointer-events:none}.active[_ngcontent-%COMP%]{font-size:1.25rem;opacity:1;color:#d81b60}\n\n/*# sourceMappingURL=staff-listing.component.ts-angular-inline--151.css.map*/"]})}return i})();const vt=["app-staff",""];function xt(i,c){1&i&&t._UZ(0,"mat-progress-bar",4)}let D=(()=>{class i{constructor(e){this._state=e,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["","app-staff",""]],attrs:vt,decls:6,vars:3,consts:[[1,"relative","overflow-hidden","flex-1","flex","flex-col"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(n,o){1&n&&(t._UZ(0,"sidebar"),t.TgZ(1,"main",0),t._UZ(2,"staff-topbar",1)(3,"staff-listings",2),t.YNc(4,xt,1,0,"mat-progress-bar",3),t.ALo(5,"async"),t.qZA()),2&n&&(t.xp6(4),t.Q6J("ngIf",t.lcZ(5,1,o.loading)))},dependencies:[m.O5,et.k,F.pW,Q,I,m.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;background:var(--b1)}\n\n/*# sourceMappingURL=staff.component.ts-angular-inline--149.css.map*/"]})}return i})();var yt=l(97910),q=l(33005),G=l(19842);const Ct=["app-new-staff",""];function Zt(i,c){1&i&&t._UZ(0,"mat-progress-bar",5)}let X=(()=>{class i{constructor(e){this._state=e,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["","app-new-staff",""]],attrs:Ct,decls:8,vars:3,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(n,o){1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1),t._UZ(4,"staff-topbar",2)(5,"staff-listings",3),t.YNc(6,Zt,1,0,"mat-progress-bar",4),t.ALo(7,"async"),t.qZA()()),2&n&&(t.xp6(6),t.Q6J("ngIf",t.lcZ(7,1,o.loading)))},dependencies:[m.O5,q.O,G.u,F.pW,Q,I,m.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=new-staff.component.ts-angular-inline--152.css.map*/"]})}return i})();var h=l(47298),L=l(85046),O=l(46939),Z=l(17401),$=l(11862),Y=l(99674),Tt=l(33910),bt=l(20576),H=l(33884);function Mt(i,c){1&i&&(t.TgZ(0,"button",6)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function wt(i,c){if(1&i&&(t.TgZ(0,"mat-option",27),t._uU(1),t.qZA()),2&i){const e=c.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.display_name||e.name," ")}}function At(i,c){if(1&i&&(t.TgZ(0,"mat-option",27),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit;t.Q6J("value",e),t.xp6(),t.hij(" ",e," ")}}function Ot(i,c){if(1&i&&(t.ynx(0),t.YNc(1,At,2,2,"mat-option",28),t.BQk()),2&i){const e=c.$implicit;t.xp6(),t.Q6J("ngIf",e)}}const Ut=()=>({standalone:!0}),Jt=()=>[];function Nt(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"main",7)(1,"form",8)(2,"a-user-search-field",9),t.NdJ("ngModelChange",function(o){t.CHM(e);const s=t.oxw();return t.KtG(s.setUser(o))}),t.qZA(),t.TgZ(3,"div",10)(4,"label",11),t._uU(5,"Name:"),t.qZA(),t.TgZ(6,"mat-form-field",12),t._UZ(7,"input",13),t.qZA()(),t.TgZ(8,"div",14)(9,"div",15)(10,"label",16),t._uU(11,"Email:"),t.qZA(),t.TgZ(12,"mat-form-field",12),t._UZ(13,"input",17),t.qZA()(),t.TgZ(14,"div",15)(15,"label",16),t._uU(16,"Phone:"),t.qZA(),t.TgZ(17,"mat-form-field",12),t._UZ(18,"input",18),t.qZA()()(),t.TgZ(19,"div",10)(20,"label",11),t._uU(21,"Level:"),t.qZA(),t.TgZ(22,"mat-form-field",12)(23,"mat-select",19)(24,"mat-option",20),t._uU(25,"All Levels"),t.qZA(),t.YNc(26,wt,2,2,"mat-option",21),t.ALo(27,"async"),t.qZA()()(),t.TgZ(28,"div",10)(29,"label",16),t._uU(30,"Roles:"),t.qZA(),t.TgZ(31,"div",14)(32,"mat-form-field",22)(33,"mat-select",23),t.YNc(34,Ot,2,1,"ng-container",24),t.ALo(35,"async"),t.qZA()(),t.TgZ(36,"button",25)(37,"app-icon"),t._uU(38,"add"),t.qZA(),t.TgZ(39,"div",26),t._uU(40,"Add New Role"),t.qZA()()()()()()}if(2&i){const e=t.oxw(),n=t.MAs(10);let o;t.xp6(),t.Q6J("formGroup",e.form),t.xp6(),t.Q6J("ngModelOptions",t.DdM(9,Ut)),t.xp6(24),t.Q6J("ngForOf",t.lcZ(27,5,e.levels)),t.xp6(8),t.Q6J("ngForOf",(null==(o=t.lcZ(35,7,e.data))?null:o.roles)||t.DdM(10,Jt)),t.xp6(2),t.Q6J("content",n)}}function Et(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"footer",29)(1,"button",30),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.save())}),t._uU(2,"Save"),t.qZA()()}}function St(i,c){1&i&&(t.TgZ(0,"main",31),t._UZ(1,"mat-spinner",32),t.TgZ(2,"p"),t._uU(3,"Saving contact details..."),t.qZA()()),2&i&&(t.xp6(),t.Q6J("diameter",48))}function Ft(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",33)(1,"mat-form-field",12)(2,"input",34),t.NdJ("ngModelChange",function(o){t.CHM(e);const s=t.oxw();return t.KtG(s.role_name=o)}),t.qZA()(),t.TgZ(3,"button",35),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.addRole())}),t._uU(4," Save Role "),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.role_name)}}let K=(()=>{class i{constructor(e,n,o){this._data=e,this._dialog_ref=n,this._org=o,this._changes=new u.X(0),this.loading=!1,this.contact=this._data,this.data=(0,v.aj)([this._org.active_building,this._changes]).pipe((0,L.h)(([s])=>!!s),(0,b.w)(([s])=>(0,h.rlq)(s.id,"emergency_contacts")),(0,d.U)(({details:s})=>s||{roles:[],contacts:[]}),(0,p.d)(1)),this.form=new r.cw({id:new r.NI(this._data?.id||`ecntct-${(0,_.O1)(8)}`),name:new r.NI(this._data?.name||""),email:new r.NI(this._data?.email||""),phone:new r.NI(this._data?.phone||""),zone:new r.NI(this._data?.zone||""),roles:new r.NI(this._data?.roles||[])}),this.levels=this._org.active_levels}addRole(){var e=this;return(0,f.Z)(function*(){if(!e.role_name)return;e._tooltip.close(),e.loading=!0,e._dialog_ref.disableClose=!0;const n=yield e.data.pipe((0,O.q)(1)).toPromise();yield(0,h.Ymr)(e._org.building.id,{name:"emergency_contacts",description:"Emergency Contacts",details:{roles:[...n.roles||[],e.role_name].filter(o=>!!o),contacts:n.contacts}}).toPromise(),e._changes.next(0),e.form.patchValue({roles:[...e.form.value.roles||[],e.role_name]}),e.role_name="",e.loading=!1,e._dialog_ref.disableClose=!1})()}setUser(e){this.form.patchValue({name:e?.name,email:e?.email,phone:e?.phone})}save(){var e=this;return(0,f.Z)(function*(){e.loading=!0,e._dialog_ref.disableClose=!0;const n=yield e.data.pipe((0,O.q)(1)).toPromise(),s=[...(n?.contacts||[]).filter(a=>a.id!==e.contact?.id),e.form.value].sort((a,g)=>a.name.localeCompare(g.name));yield(0,h.Ymr)(e._org.building.id,{name:"emergency_contacts",description:"Emergency Contacts",details:{roles:n.roles||[],contacts:s}}).toPromise(),e._dialog_ref.disableClose=!0,(0,_.t5)("Successfully updated emergency contacts."),e.loading=!1,e._dialog_ref.close()})()}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(Z.WI),t.Y36(Z.so),t.Y36(M.w7))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["emergency-contact-modal"]],viewQuery:function(n,o){if(1&n&&t.Gf($.Xo,5),2&n){let s;t.iGM(s=t.CRH())&&(o._tooltip=s.first)}},decls:11,vars:5,consts:[[1,"flex-1","w-0"],["icon","","mat-dialog-close","",4,"ngIf"],["class","p-4 w-[36rem]",4,"ngIf","ngIfElse"],["class","flex justify-center items-center p-2 border-t border-base-200",4,"ngIf"],["load_state",""],["role_form",""],["icon","","mat-dialog-close",""],[1,"p-4","w-[36rem]"],[1,"space-y-4",3,"formGroup"],["ngModel","",3,"ngModelOptions","ngModelChange"],[1,"flex","flex-col"],["for","name"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Full name"],[1,"flex","items-center","space-x-2"],[1,"flex","flex-col","flex-1"],["for","email"],["matInput","","formControlName","email","type","email","placeholder","Email address"],["matInput","","formControlName","phone","type","tel","placeholder","Emergency contact number"],["formControlName","zone","placeholder","All Levels"],["value",""],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"no-subscript","flex-1"],["multiple","","formControlName","roles","placeholder","Select roles"],[4,"ngFor","ngForOf"],["btn","","matRipple","","customTooltip","",1,"space-x-2",3,"content"],[1,"pr-2"],[3,"value"],[3,"value",4,"ngIf"],[1,"flex","justify-center","items-center","p-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-32",3,"click"],["loading","",1,"h-64","flex","flex-col","items-center","justify-center"],[1,"mb-4",3,"diameter"],[1,"bg-base-100","p-4","rounded"],["matInput","","placeholder","Role name",3,"ngModel","ngModelChange"],["btn","","matRipple","",1,"w-full",3,"click"]],template:function(n,o){if(1&n&&(t.TgZ(0,"header")(1,"h2"),t._uU(2),t.qZA(),t._UZ(3,"div",0),t.YNc(4,Mt,3,0,"button",1),t.qZA(),t.YNc(5,Nt,41,11,"main",2)(6,Et,3,0,"footer",3)(7,St,4,1,"ng-template",null,4,t.W1O)(9,Ft,5,1,"ng-template",null,5,t.W1O)),2&n){const s=t.MAs(8);t.xp6(2),t.hij("",o.contact?"Edit":"New"," Emergency Contact"),t.xp6(2),t.Q6J("ngIf",!o.loading),t.xp6(),t.Q6J("ngIf",!o.loading)("ngIfElse",s),t.xp6(),t.Q6J("ngIf",!o.loading)}},dependencies:[m.sg,m.O5,r._Y,r.Fj,r.JJ,r.JL,r.On,A.KE,Y.Nt,R.gD,y.ey,Tt.Ou,Z.ZT,y.wG,r.sg,r.u,bt.d,N.o,H.X,m.Ov]})}return i})();function Rt(i,c){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",6)(2,"div",7),t._uU(3),t.qZA(),t.TgZ(4,"button",8),t.NdJ("click",function(){const s=t.CHM(e).$implicit,a=t.oxw();return a.active=s,t.KtG(a.role_name=s)}),t.TgZ(5,"app-icon"),t._uU(6,"edit"),t.qZA()(),t.TgZ(7,"button",9),t.NdJ("click",function(){const s=t.CHM(e).$implicit,a=t.oxw();return t.KtG(a.removeRole(s))}),t.TgZ(8,"app-icon"),t._uU(9,"delete"),t.qZA()()(),t.BQk()}if(2&i){const e=c.$implicit;t.oxw();const n=t.MAs(15);t.xp6(3),t.Oqu(e),t.xp6(),t.Q6J("content",n)}}function Qt(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",10)(1,"mat-form-field",11)(2,"input",12),t.NdJ("ngModelChange",function(o){t.CHM(e);const s=t.oxw();return t.KtG(s.role_name=o)}),t.qZA()(),t.TgZ(3,"button",13),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.updateRoles())}),t._uU(4," Save Role "),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.role_name)}}let W=(()=>{class i{removeRole(e){var n=this;return(0,f.Z)(function*(){if(!e)return;n.loading=!0,n._dialog_ref.disableClose=!0;const o=yield n.data.pipe((0,O.q)(1)).toPromise();yield(0,h.Ymr)(n._org.building.id,{name:"emergency_contacts",description:"Emergency Contacts",details:{roles:[...o.roles.filter(s=>s!==e)].filter(s=>!!s).sort((s,a)=>s.localeCompare(a)),contacts:o.contacts.map(s=>({...s,roles:s.roles.filter(a=>a!==e)}))}}).toPromise(),n._changes.next(0),n.loading=!1,n._dialog_ref.disableClose=!1})()}updateRoles(){var e=this;return(0,f.Z)(function*(){if(!e.role_name)return;e.loading=!0,e._tooltip.close(),e._dialog_ref.disableClose=!0;const n=yield e.data.pipe((0,O.q)(1)).toPromise();yield(0,h.Ymr)(e._org.building.id,{name:"emergency_contacts",description:"Emergency Contacts",details:{roles:[...n.roles.filter(o=>o!==e.active),e.role_name].filter(o=>!!o).sort((o,s)=>o.localeCompare(s)),contacts:n.contacts}}).toPromise(),e._changes.next(0),e.role_name="",e.active="",e.loading=!1,e._dialog_ref.disableClose=!1})()}constructor(e,n){this._org=e,this._dialog_ref=n,this._changes=new u.X(0),this.loading=!1,this.data=(0,v.aj)([this._org.active_building,this._changes]).pipe((0,L.h)(([o])=>!!o),(0,b.w)(([o])=>(0,h.rlq)(o.id,"emergency_contacts")),(0,d.U)(({details:o})=>o||{roles:[],contacts:[]}),(0,p.d)(1)),this.roles=this.data.pipe((0,d.U)(o=>o.roles))}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(M.w7),t.Y36(Z.so))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["role-management-modal"]],viewQuery:function(n,o){if(1&n&&t.Gf($.Xo,5),2&n){let s;t.iGM(s=t.CRH())&&(o._tooltip=s.first)}},decls:16,vars:4,consts:[["btn","","icon","","matRipple","","mat-dialog-close",""],[1,"overflow-y-auto","min-w-[20rem]","divide-y","divide-base-200","max-h-[65vh]"],["btn","","matRipple","","customTooltip","",1,"flex","items-center","justify-center","space-x-2","w-[calc(100%-1rem)]","m-2",3,"content","click"],[1,"truncate"],[4,"ngFor","ngForOf"],["role_form",""],[1,"flex","items-center","space-x-2","hover:bg-base-200:bg-base-300","p-2"],[1,"flex-1","truncate"],["btn","","icon","","matRipple","","customTooltip","",3,"content","click"],["btn","","icon","","matRipple","",3,"click"],[1,"bg-base-100","p-4","rounded"],["appearance","outline"],["matInput","","placeholder","Role name",3,"ngModel","ngModelChange"],["btn","","matRipple","",1,"w-full",3,"click"]],template:function(n,o){if(1&n&&(t.TgZ(0,"header")(1,"h2"),t._uU(2,"Manage Roles"),t.qZA(),t.TgZ(3,"button",0)(4,"app-icon"),t._uU(5,"close"),t.qZA()()(),t.TgZ(6,"main",1)(7,"button",2),t.NdJ("click",function(){return o.active="",o.role_name=""}),t.TgZ(8,"div",3),t._uU(9,"New Role"),t.qZA(),t.TgZ(10,"app-icon"),t._uU(11,"add"),t.qZA()(),t.YNc(12,Rt,10,2,"ng-container",4),t.ALo(13,"async"),t.qZA(),t.YNc(14,Qt,5,1,"ng-template",null,5,t.W1O)),2&n){const s=t.MAs(15);t.xp6(7),t.Q6J("content",s),t.xp6(5),t.Q6J("ngForOf",t.lcZ(13,2,o.roles))}},dependencies:[m.sg,r.Fj,r.JJ,r.On,A.KE,Y.Nt,Z.ZT,y.wG,N.o,H.X,m.Ov]})}return i})();var It=l(27442),Lt=l(6612);const Yt=["app-emergency-contacts",""];function Pt(i,c){if(1&i&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&i){const e=c.$implicit;t.Q6J("value",e),t.xp6(),t.hij(" ",e," ")}}function jt(i,c){if(1&i&&(t.TgZ(0,"span",24),t._uU(1),t.qZA()),2&i){const e=c.$implicit;t.xp6(),t.hij(" ",e," ")}}function kt(i,c){1&i&&t.YNc(0,jt,2,1,"span",23),2&i&&t.Q6J("ngForOf",c.data)}function zt(i,c){if(1&i&&(t._uU(0),t.ALo(1,"level")),2&i){const e=c.data;let n;t.hij(" ",e?null==(n=t.lcZ(1,1,e))?null:n.display_name:"All"," ")}}function Dt(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",25)(1,"button",26),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.editContact(s))}),t.TgZ(2,"app-icon"),t._uU(3,"edit"),t.qZA()(),t.TgZ(4,"button",26),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.removeContact(s))}),t.TgZ(5,"app-icon"),t._uU(6,"delete"),t.qZA()()()}}const qt=()=>[],Gt=()=>["email","name","roles","zone","actions"],Xt=()=>["Email","Name","Roles","Level"," "],$t=()=>["flex","12r","16r","7r"],Ht=(i,c,e)=>({roles:i,zone:c,actions:e});let B=(()=>{class i{constructor(e,n){this._org=e,this._dialog=n,this._change=new u.X(0),this.search="",this.role_filter=new u.X(""),this.data=(0,v.aj)([this._org.active_building,this._change]).pipe((0,L.h)(([o])=>!!o),(0,b.w)(([o])=>(0,h.rlq)(o.id,"emergency_contacts")),(0,d.U)(({details:o})=>o||{roles:[],contacts:[]}),(0,p.d)(1)),this.roles=this.data.pipe((0,d.U)(o=>o?.roles||[])),this.contacts=this.data.pipe((0,d.U)(o=>o?.contacts||[])),this.filtered_contacts=(0,v.aj)([this.contacts,this.role_filter]).pipe((0,d.U)(([o,s])=>o.filter(a=>!s||a.roles.includes(s))))}ngOnInit(){}manageRoles(){this._dialog.open(W,{}).afterClosed().subscribe(()=>this._change.next(Date.now()))}editContact(e){this._dialog.open(K,{data:e}).afterClosed().subscribe(()=>this._change.next(Date.now()))}removeContact(e){var n=this;return(0,f.Z)(function*(){const o=yield(0,_._5)({title:"Remove Emergency Contact",content:`Are you sure you want to remove ${e.name} from the emergency contacts?`,icon:{content:"delete"}},n._dialog);if("done"!==o.reason)return;o.loading("Removing contact...");const s=yield n.data.pipe((0,O.q)(1)).toPromise(),a=(s?.contacts||[]).filter(g=>g.id!==e.id);yield(0,h.Ymr)(n._org.building.id,{name:"emergency_contacts",description:"Emergency Contacts",details:{roles:s.roles,contacts:a}}).toPromise(),o.close(),n._change.next(Date.now()),(0,_.t5)("Successfully removed emergency contact.")})()}static#t=this.\u0275fac=function(n){return new(n||i)(t.Y36(M.w7),t.Y36(Z.uw))};static#e=this.\u0275cmp=t.Xpm({type:i,selectors:[["","app-emergency-contacts",""]],attrs:Yt,decls:37,vars:20,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],["topbar","",1,"px-8","py-4","flex","flex-col"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-medium"],[1,"flex","items-center","space-x-2"],["icon","","matRipple","","matTooltip","Manage Roles",1,"bg-secondary","text-secondary-content","rounded",3,"click"],["btn","","matRipple","",1,"space-x-2",3,"click"],[1,"text-2xl"],[1,"pr-2"],[1,"flex","items-center","justify-between","py-2","mt-2"],["appearance","outline",1,"no-subscript"],["placeholder","All Roles",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["matPrefix","",1,"text-2xl"],["matInput","","placeholder","Filter contacts...",3,"ngModel","ngModelChange"],[1,"w-full","h-1/2","flex-1","overflow-auto","px-8"],[1,"min-w-[40rem]","block",3,"dataSource","filter","columns","display_column","column_size","template","empty"],["roles_template",""],["zone_template",""],["actions_template",""],[3,"value"],["class","m-1 py-1 px-2 rounded-2xl text-xs font-mono bg-info text-info-content",4,"ngFor","ngForOf"],[1,"m-1","py-1","px-2","rounded-2xl","text-xs","font-mono","bg-info","text-info-content"],[1,"flex","items-center","justify-end","w-full","space-x-2"],["icon","","matRipple","",3,"click"]],template:function(n,o){if(1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1)(4,"section",2)(5,"div",3)(6,"h2",4),t._uU(7,"Emergency Contacts"),t.qZA(),t.TgZ(8,"div",5)(9,"button",6),t.NdJ("click",function(){return o.manageRoles()}),t.TgZ(10,"app-icon"),t._uU(11,"list_alt"),t.qZA()(),t.TgZ(12,"button",7),t.NdJ("click",function(){return o.editContact()}),t.TgZ(13,"app-icon",8),t._uU(14,"add"),t.qZA(),t.TgZ(15,"div",9),t._uU(16,"Add Contact"),t.qZA()()()(),t.TgZ(17,"div",10)(18,"mat-form-field",11)(19,"mat-select",12),t.NdJ("ngModelChange",function(a){return o.role_filter.next(a)}),t.TgZ(20,"mat-option",13),t._uU(21,"All Roles"),t.qZA(),t.YNc(22,Pt,2,2,"mat-option",14),t.ALo(23,"async"),t.qZA()(),t.TgZ(24,"div",5)(25,"mat-form-field",11)(26,"app-icon",15),t._uU(27," search "),t.qZA(),t.TgZ(28,"input",16),t.NdJ("ngModelChange",function(a){return o.search=a}),t.qZA()()()()(),t.TgZ(29,"section",17),t._UZ(30,"custom-table",18),t.YNc(31,kt,1,1,"ng-template",null,19,t.W1O)(33,zt,2,3,"ng-template",null,20,t.W1O)(35,Dt,7,0,"ng-template",null,21,t.W1O),t.qZA()()()),2&n){const s=t.MAs(32),a=t.MAs(34),g=t.MAs(36);t.xp6(19),t.Q6J("ngModel",o.role_filter.getValue()),t.xp6(3),t.Q6J("ngForOf",t.lcZ(23,10,o.roles)||t.DdM(12,qt)),t.xp6(6),t.Q6J("ngModel",o.search),t.xp6(2),t.Q6J("dataSource",o.filtered_contacts)("filter",o.search)("columns",t.DdM(13,Gt))("display_column",t.DdM(14,Xt))("column_size",t.DdM(15,$t))("template",t.kEZ(16,Ht,s,a,g))("empty",o.search?"No matching contacts":"No emergency contacts for this building")}},dependencies:[m.sg,r.Fj,r.JJ,r.On,q.O,G.u,A.KE,A.qo,Y.Nt,R.gD,y.ey,k.gM,y.wG,N.o,It.C,m.Ov,Lt.M],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=emergency-contacts.component.ts-angular-inline--153.css.map*/"]})}return i})();const Kt=[{path:"",component:D},{path:"new",component:X},{path:"emergency-contacts",component:B}],Wt=[X,D,Q,I,z,B,K,W];let Bt=(()=>{class i{static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275mod=t.oAB({type:i});static#n=this.\u0275inj=t.cJS({imports:[m.ez,r.u5,yt.v,J.Bz.forChild(Kt)]})}return i})()},59524:(V,U,l)=>{l.d(U,{Y:()=>S,PP:()=>m.P,mO:()=>u.mO,VE:()=>d.VE,w0:()=>d.w0,sF:()=>x.sF});var m=l(43211),f=(l(86755),l(80882),l(67343));class S{constructor(p={}){this.type=p.type||p.location||"other",this.position=p.position||p.map_id||p.asset_id||{x:p.x/p.map_width||0,y:p.y/p.map_height||0},this.variance=p.variance||0,this.last_seen=p.last_seen||(0,f.Z)(new Date),this.level=p.level,this.building=p.building,this.at_location=!!p.at_location,this.coordinates_from=p.coordinates_from||"top-left"}}var u=l(223),x=(l(11451),l(38125)),d=l(48675)}}]);
//# sourceMappingURL=apps_concierge_src_app_staff_staff_module_ts.js.map