"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_staff_staff_module_ts"],{5401:(dt,S,a)=>{a.r(S),a.d(S,{COMPONENTS:()=>gt,StaffModule:()=>mt});var c=a(6575),x=a(8849),y=a(2649),f=a(1670),N=a(8377),_=a(462),O=a(8159),m=a(8466),Z=a(7422),P=a(6520),I=a(680),w=a(7343),Q=a(7016),M=a(4512),u=a(2078),L=a(3121),t=a(1699);let d=(()=>{class s extends u.cx{constructor(e){var n;super(),n=this,this._org=e,this._onsite={},this._events={},this._filters=new _.X({}),this._search=new _.X(""),this._loading=new _.X(!1),this._users=new _.X([]),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.users=this._filters.asObservable(),this.filtered_users=(0,O.aj)([this._search,this._users,this._filters]).pipe((0,Z.U)(i=>{const[o,l,h]=i;return l.filter(g=>(!o||g.name.toLowerCase().includes(o)||g.email.toLowerCase().includes(o))&&(!h.only_onsite||this._onsite[g.email]))})),this.user_events=(0,O.aj)([this._filters]).pipe((0,P.w)(function(){var i=(0,f.Z)(function*(o){n._loading.next(!0);const l=yield(0,m.F2)({period_start:(0,w.Z)((0,Q.Z)(Date.now())),period_end:(0,w.Z)((0,M.Z)(Date.now())),type:"staff"}).toPromise(),h={},g=(new Date).valueOf();for(const p of l)(0,u.MZ)(g,g,p.date,p.date+60*p.duration*1e3)&&(h[p.asset_id]=p.checked_in,n._events[p.asset_id]=p);return n._onsite=h,n._loading.next(!1),h});return function(o){return i.apply(this,arguments)}}()),(0,I.d)()),this.loadUsers(),this.user_events.subscribe()}setFilters(e){this._filters.next({...this._filters.getValue(),...e})}setSearchString(e){this._search.next(e)}startPolling(e=3e4){this.setFilters(this._filters.getValue()),this.interval("poll",()=>this.setFilters(this._filters.getValue()),e)}stopPolling(){this.clearInterval("poll")}checkin(e){var n=this;return(0,f.Z)(function*(){const i=yield(0,m.km)({booking_start:Math.floor((new Date).valueOf()/1e3),booking_end:Math.floor((0,M.Z)(new Date).valueOf()/1e3),asset_id:e.email,title:"Checked-in Onsite",description:n._org.building.display_name||n._org.building.name,zones:[n._org.building.id],booking_type:"staff"}).toPromise();yield(0,m.FD)(i.id,!0).toPromise(),n._events[e.email]=i,n._onsite[e.email]=!0})()}checkout(e){var n=this;return(0,f.Z)(function*(){const i=n._events[e.email];if(i){const o=yield(0,m.km)({...i.toJSON(),booking_end:Math.floor((new Date).valueOf()/1e3)}).toPromise();yield(0,m.FD)(o.id,!1).toPromise(),n._events[e.email]=o,n._onsite[e.email]=!1}})()}loadUsers(){var e=this;return(0,f.Z)(function*(){const n=yield(0,N.VE)("").toPromise();n.sort((i,o)=>i.name.localeCompare(o.name)),e._users.next(n)})()}static#t=this.\u0275fac=function(n){return new(n||s)(t.LFG(L.w7))};static#e=this.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"})}return s})();var z=a(2349),b=a(8173),Y=a(7627),D=a(6410),j=a(1268),k=a(162),F=a(257),E=a(9293);function R(s,r){if(1&s&&(t.TgZ(0,"mat-option",8),t._uU(1),t.qZA()),2&s){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.display_name||e.name," ")}}let C=(()=>{class s extends u.cx{constructor(e,n,i,o){super(),this._state=e,this._org=n,this._route=i,this._router=o,this.zones=[],this.levels=this._org.active_levels,this.filters=this._state.filters,this.setDate=l=>this._state.setFilters({date:l}),this.setFilters=l=>this._state.setFilters(l),this.setSearch=l=>this._state.setSearchString(l),this.updateZones=l=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:l.join(",")}}),this._state.setFilters({zones:l})}}ngOnInit(){var e=this;return(0,f.Z)(function*(){yield e._org.initialised.pipe((0,Y.P)(n=>n)).toPromise(),e.subscription("route.query",e._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const i=n.get("zone_ids").split(",");if(i.length){const o=e._org.levelWithID(i);if(!o)return;e._org.building=e._org.buildings.find(l=>l.id===o.parent_id),e.zones=i}}})),e.subscription("levels",e._org.active_levels.subscribe(n=>{e.zones=e.zones.filter(i=>n.find(o=>o.id===i)),!e.zones.length&&n.length&&e.zones.push(n[0].id),e.updateZones(e.zones)})),e.setSearch("")})()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(d),t.Y36(L.w7),t.Y36(y.gz),t.Y36(y.F0))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["staff-topbar"]],features:[t.qOj],decls:11,vars:7,consts:[[1,"flex","items-center","bg-base-100","h-20","px-4","border-b","border-base-200","space-x-2"],["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"m-2",3,"ngModel","ngModelChange"],[1,"text-xs"],[1,"flex-1","w-2"],[1,"mr-2",3,"modelChange"],[3,"value"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(l){return i.zones=l})("ngModelChange",function(l){return i.updateZones(l)}),t.YNc(3,R,2,2,"mat-option",3),t.ALo(4,"async"),t.qZA()(),t.TgZ(5,"mat-slide-toggle",4),t.NdJ("ngModelChange",function(l){return i.setFilters({only_onsite:l})}),t.ALo(6,"async"),t.TgZ(7,"div",5),t._uU(8,"Onsite Only"),t.qZA()(),t._UZ(9,"div",6),t.TgZ(10,"searchbar",7),t.NdJ("modelChange",function(l){return i.setSearch(l)}),t.qZA()()),2&n){let o;t.xp6(2),t.Q6J("ngModel",i.zones),t.xp6(1),t.Q6J("ngForOf",t.lcZ(4,3,i.levels)),t.xp6(2),t.Q6J("ngModel",null==(o=t.lcZ(6,5,i.filters))?null:o.only_onsite)}},dependencies:[c.sg,x.JJ,x.On,D.U,j.KE,k.gD,F.ey,E.Rr,c.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=staff-topbar.component.ts-angular-inline--145.css.map*/"]})}return s})();var X=a(702),$=a(4702),B=a(4888),G=a(2882);function H(s,r){1&s&&(t.TgZ(0,"div",11),t._uU(1,"Onsite"),t.qZA())}function W(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",1),t._UZ(1,"a-user-avatar",2),t.TgZ(2,"div",3)(3,"div",4),t._uU(4),t.qZA(),t.TgZ(5,"div",5),t._uU(6),t.qZA()(),t.YNc(7,H,2,0,"div",6),t.TgZ(8,"div",7)(9,"action-icon",8),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.onsite?i.checkout():i.checkin())}),t.qZA(),t.TgZ(10,"a",9)(11,"app-icon"),t._uU(12,"email"),t.qZA()(),t.TgZ(13,"a",10)(14,"app-icon"),t._uU(15,"call"),t.qZA()()()()}if(2&s){const e=t.oxw();t.xp6(1),t.Q6J("user",e.user),t.xp6(3),t.Oqu(null==e.user?null:e.user.name),t.xp6(2),t.hij(" ",null==e.user?null:e.user.email," "),t.xp6(1),t.Q6J("ngIf",e.onsite),t.xp6(2),t.Q6J("matTooltip",e.onsite?"Checkout Staff":"Checkin Staff")("loading",e.loading)("content",e.onsite?"event_busy":"event_available"),t.xp6(1),t.Q6J("href","mailto:"+(null==e.user?null:e.user.email),t.LSH),t.uIk("disabled",!(null!=e.user&&e.user.email)),t.xp6(3),t.Q6J("href","tel:"+(null==e.user?null:e.user.phone),t.LSH),t.uIk("disabled",!(null!=e.user&&e.user.phone))}}let U=(()=>{class s{constructor(e){var n=this;this._state=e,this.checkin=(0,f.Z)(function*(){n.loading=!0,yield n._state.checkin(n.user).catch(i=>(0,u.cB)("Error checking in Staff member")),n.loading=!1}),this.checkout=(0,f.Z)(function*(){n.loading=!0,yield n._state.checkout(n.user).catch(i=>(0,u.cB)("Error checking out Staff member")),n.loading=!1})}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(d))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["staff-details"]],inputs:{user:"user",onsite:"onsite"},decls:1,vars:1,consts:[["class","w-full flex items-center px-4 py-2 bg-base-100 border-b border-base-200 hover:opacity-80","details","",4,"ngIf"],["details","",1,"w-full","flex","items-center","px-4","py-2","bg-base-100","border-b","border-base-200","hover:opacity-80"],[3,"user"],[1,"flex","flex-col","flex-1"],[1,"px-2"],[1,"px-2","text-xs","text-opacity-50"],["class","text-xs opacity-50 px-4",4,"ngIf"],[1,"flex","items-center"],[3,"matTooltip","loading","content","click"],["icon","","matRipple","","matTooltip","Email Staff",3,"href"],["icon","","matRipple","","matTooltip","Phone Staff",3,"href"],[1,"text-xs","opacity-50","px-4"]],template:function(n,i){1&n&&t.YNc(0,W,16,11,"div",0),2&n&&t.Q6J("ngIf",i.user)},dependencies:[c.O5,X.gM,F.wG,$.m,B.o,G.k]})}return s})();const V=["container"];function K(s,r){if(1&s){const e=t.EpF();t.TgZ(0,"div",7),t.NdJ("click",function(){const o=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.scrollTo(o))}),t.ALo(1,"async"),t._uU(2),t.qZA()}if(2&s){const e=r.$implicit,n=t.oxw();t.ekj("disabled",t.lcZ(1,5,n.user_list)[e].length<=0)("active",e===n.active_group),t.xp6(2),t.hij(" ",e," ")}}function q(s,r){if(1&s&&(t._UZ(0,"staff-details",12),t.ALo(1,"async"),t.ALo(2,"async")),2&s){const e=r.$implicit,n=r.index,i=t.oxw(2).$implicit,o=t.oxw(2);t.Q6J("id","letter-"+i+"-"+n)("user",e)("onsite",!!t.lcZ(1,3,o.events)&&t.lcZ(2,5,o.events)[e.email])}}function tt(s,r){if(1&s&&(t.ynx(0),t.TgZ(1,"div",10),t._uU(2),t.qZA(),t.YNc(3,q,3,7,"staff-details",11),t.ALo(4,"async"),t.BQk()),2&s){const e=t.oxw().$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("id","letter-"+("#"===e?"0":e)),t.xp6(1),t.hij(" ",e," "),t.xp6(1),t.Q6J("ngForOf",t.lcZ(4,3,n.user_list)[e])}}function et(s,r){if(1&s&&(t.ynx(0),t.YNc(1,tt,5,5,"ng-container",9),t.ALo(2,"async"),t.BQk()),2&s){const e=r.$implicit,n=t.oxw(2);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,1,n.user_list)[e].length)}}function nt(s,r){if(1&s&&(t.ynx(0),t.YNc(1,et,3,3,"ng-container",8),t.BQk()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.groups)}}function st(s,r){1&s&&t._UZ(0,"mat-progress-bar",13)}function it(s,r){1&s&&(t.TgZ(0,"div",14)(1,"p"),t._uU(2,"No matching staff members"),t.qZA()())}const v="#abcdefghijklmnopqrstuvwxyz".split("");let T=(()=>{class s extends u.cx{constructor(e){super(),this._state=e,this.active_group="#",this.groups=v,this.events=this._state.user_events,this.loading=this._state.loading,this.user_count=this._state.filtered_users.pipe((0,Z.U)(n=>n.length)),this.user_list=this._state.filtered_users.pipe((0,Z.U)(n=>{const i={};for(const o of v)i[o]=(n||[]).filter(l=>l.name.toLowerCase()[0].startsWith(o)||"#"===o&&!v.includes(l.name.toLowerCase()[0]));return this.timeout("scroll",()=>this.onScroll({}),30),i}))}onScroll(e){const n=this._el.nativeElement.scrollTop;for(const i of v){const o=document.querySelector(`#letter-${"#"===i?"0":i}`);if(o){if(o.offsetTop-n>0)break;this.active_group=i}}}scrollTo(e){const n=document.querySelector(`#letter-${e}-0`);n&&(n.scrollIntoView({behavior:"smooth",block:"center"}),this.active_group=e)}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(d))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["staff-listings"]],viewQuery:function(n,i){if(1&n&&t.Gf(V,5),2&n){let o;t.iGM(o=t.CRH())&&(i._el=o.first)}},features:[t.qOj],decls:10,vars:8,consts:[[1,"w-full","p-2","flex","items-center","justify-center"],["letter","","class","capitalize h-6 w-6 flex items-center justify-center text-xs cursor-pointer",3,"disabled","active","click",4,"ngFor","ngForOf"],[1,"flex-1","overflow-auto","w-full","relative","bg-base-200",2,"height","50%",3,"scroll"],["container",""],[4,"ngIf","ngIfElse"],["mode","indeterminate",4,"ngIf"],["empty_state",""],["letter","",1,"capitalize","h-6","w-6","flex","items-center","justify-center","text-xs","cursor-pointer",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],["group","",1,"capitalize","bg-base-200","border-b","text-sm","font-medium","sticky","top-0","z-10",3,"id"],[3,"id","user","onsite",4,"ngFor","ngForOf"],[3,"id","user","onsite"],["mode","indeterminate"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center"]],template:function(n,i){if(1&n&&(t.TgZ(0,"div",0),t.YNc(1,K,3,7,"div",1),t.qZA(),t.TgZ(2,"div",2,3),t.NdJ("scroll",function(l){return i.onScroll(l)}),t.YNc(4,nt,2,1,"ng-container",4),t.ALo(5,"async"),t.qZA(),t.YNc(6,st,1,0,"mat-progress-bar",5),t.ALo(7,"async"),t.YNc(8,it,3,0,"ng-template",null,6,t.W1O)),2&n){const o=t.MAs(9);t.xp6(1),t.Q6J("ngForOf",i.groups),t.xp6(3),t.Q6J("ngIf",t.lcZ(5,4,i.user_count))("ngIfElse",o),t.xp6(2),t.Q6J("ngIf",t.lcZ(7,6,i.loading))}},dependencies:[c.sg,c.O5,b.pW,U,c.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;width:100%;height:50%}[letter][_ngcontent-%COMP%]{transition:font-size .2s,color .2s}[group][_ngcontent-%COMP%]{border-color:#ccc;padding:.5rem 1.65rem}.disabled[_ngcontent-%COMP%]{opacity:.2;pointer-events:none}.active[_ngcontent-%COMP%]{font-size:1.25rem;opacity:1;color:#d81b60}\n\n/*# sourceMappingURL=staff-listing.component.ts-angular-inline--146.css.map*/"]})}return s})();const ot=["app-staff",""];function at(s,r){1&s&&t._UZ(0,"mat-progress-bar",4)}let A=(()=>{class s{constructor(e){this._state=e,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(d))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["","app-staff",""]],attrs:ot,decls:6,vars:3,consts:[[1,"relative","overflow-hidden","flex-1","flex","flex-col"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(n,i){1&n&&(t._UZ(0,"sidebar"),t.TgZ(1,"main",0),t._UZ(2,"staff-topbar",1)(3,"staff-listings",2),t.YNc(4,at,1,0,"mat-progress-bar",3),t.ALo(5,"async"),t.qZA()),2&n&&(t.xp6(4),t.Q6J("ngIf",t.lcZ(5,1,i.loading)))},dependencies:[c.O5,z.k,b.pW,C,T,c.Ov],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%;background:var(--b1)}\n\n/*# sourceMappingURL=staff.component.ts-angular-inline--144.css.map*/"]})}return s})();var lt=a(7910),rt=a(3005),ct=a(9842);const ft=["app-new-staff",""];function pt(s,r){1&s&&t._UZ(0,"mat-progress-bar",5)}let J=(()=>{class s{constructor(e){this._state=e,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}static#t=this.\u0275fac=function(n){return new(n||s)(t.Y36(d))};static#e=this.\u0275cmp=t.Xpm({type:s,selectors:[["","app-new-staff",""]],attrs:ft,decls:8,vars:3,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(n,i){1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1),t._UZ(4,"staff-topbar",2)(5,"staff-listings",3),t.YNc(6,pt,1,0,"mat-progress-bar",4),t.ALo(7,"async"),t.qZA()()),2&n&&(t.xp6(6),t.Q6J("ngIf",t.lcZ(7,1,i.loading)))},dependencies:[c.O5,rt.O,ct.u,b.pW,C,T,c.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=new-staff.component.ts-angular-inline--147.css.map*/"]})}return s})();const ut=[{path:"",component:A},{path:"new",component:J}],gt=[J,A,C,T,U];let mt=(()=>{class s{static#t=this.\u0275fac=function(n){return new(n||s)};static#e=this.\u0275mod=t.oAB({type:s});static#n=this.\u0275inj=t.cJS({imports:[c.ez,x.u5,lt.v,y.Bz.forChild(ut)]})}return s})()}}]);
//# sourceMappingURL=apps_concierge_src_app_staff_staff_module_ts.js.map