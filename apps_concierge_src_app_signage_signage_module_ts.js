"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_signage_signage_module_ts"],{72171:(bi,q,p)=>{p.r(q),p.d(q,{COMPONENTS:()=>yi,SignageModule:()=>vi});var h=p(60316),c=p(34456),x=p(26842),F=p(71514),je=p(40363),_=p(89204),g=p(77375),O=p(12185),m=p(3998),j=p(90521),b=p(42175),ee=p(71536),L=p(8627),J=p(19803),E=p(71963),y=p(35443),G=p(7841),te=p(29314),e=p(7404),C=p(12587),N=p(41134),k=p(85060),T=p(69434),X=p(93208);function ke(a,l){if(1&a&&e.nrm(0,"img",10),2&a){const t=e.XpG(2);e.Y8G("source",t.resource.toString())}}function Ce(a,l){if(1&a&&e.nrm(0,"video",11),2&a){const t=e.XpG(2);e.Y8G("source",t.resource.toString())}}function we(a,l){if(1&a&&(e.j41(0,"main",6)(1,"div",7),e.DNE(2,ke,1,1,"img",8)(3,Ce,1,1,"video",9),e.k0s()()),2&a){const t=e.XpG();e.R7$(2),e.Y8G("ngIf","image"===t.type),e.R7$(),e.Y8G("ngIf","video"===t.type)}}function Te(a,l){if(1&a){const t=e.RV6();e.j41(0,"footer",12)(1,"button",13),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.save.emit())}),e.EFF(2," Save Media "),e.k0s()()}}function Me(a,l){if(1&a&&(e.j41(0,"main",14),e.nrm(1,"mat-spinner",15),e.j41(2,"p"),e.EFF(3),e.k0s()()),2&a){const t=e.XpG();e.R7$(),e.Y8G("diameter",32),e.R7$(2),e.JRh(t.loading)}}let Z=(()=>{class a{constructor(t){this._data=t,this.save=new e.bkB,this.loading="",this.resource=this._data.url,this.type=this._data.type,this.name=this._data.name,this.file=this._data.file,this.can_save=!1!==this._data.save}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(C.Vh))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-media-preview-modal"]],outputs:{save:"save"},decls:10,vars:4,consts:[["load_state",""],[1,"flex","items-center","justify-between","p-2","border-b","border-base-300"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close",""],["class","bg-base-200",4,"ngIf","ngIfElse"],["class","p-2 flex items-center justify-end space-x-2 border-t border-base-300",4,"ngIf"],[1,"bg-base-200"],[1,"max-w-[80vw]","max-h-[65vh]","w-[80vw]","h-[65vh]","flex","items-center","justify-center"],["class","w-full h-full object-contain object-center","auth","",3,"source",4,"ngIf"],["class","w-full h-full object-contain object-center","auth","","autoplay","","controls","",3,"source",4,"ngIf"],["auth","",1,"w-full","h-full","object-contain","object-center",3,"source"],["auth","","autoplay","","controls","",1,"w-full","h-full","object-contain","object-center",3,"source"],[1,"p-2","flex","items-center","justify-end","space-x-2","border-t","border-base-300"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-8","w-[28rem]","h-[20rem]","max-w-[80vw]","max-h-[65vh]"],[3,"diameter"]],template:function(n,i){if(1&n&&(e.j41(0,"header",1)(1,"h1",2),e.EFF(2),e.k0s(),e.j41(3,"button",3)(4,"app-icon"),e.EFF(5,"close"),e.k0s()()(),e.DNE(6,we,4,2,"main",4)(7,Te,3,0,"footer",5)(8,Me,4,2,"ng-template",null,0,e.C5r)),2&n){const o=e.sdS(9);e.R7$(2),e.SpI("Preview - ",i.name,""),e.R7$(4),e.Y8G("ngIf",!i.loading)("ngIfElse",o),e.R7$(),e.Y8G("ngIf",i.can_save&&!i.loading)}},dependencies:[h.bT,N.LG,C.tx,k.r6,T.R,X.U]})}return a})();var ie=p(52672),P=p(99908),M=p(24950),D=p(87984),H=p(25175),Ie=p(97024),z=p(80640),ne=p(19608),U=p(64992),Y=p(28975);const Se=["search_input"];function Re(a,l){1&a&&(e.j41(0,"button",6)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function Ee(a,l){if(1&a&&(e.j41(0,"main",7)(1,"label",8),e.EFF(2,"Name"),e.j41(3,"span",9),e.EFF(4,"*"),e.k0s()(),e.j41(5,"mat-form-field",10),e.nrm(6,"input",11),e.j41(7,"mat-error"),e.EFF(8,"Name is required"),e.k0s()(),e.j41(9,"div",12)(10,"mat-checkbox",13),e.EFF(11,"Enabled"),e.k0s(),e.j41(12,"mat-checkbox",14),e.EFF(13," Shuffle Playback "),e.k0s()(),e.j41(14,"div",15)(15,"label",16)(16,"div"),e.EFF(17,"Default Play Time"),e.k0s(),e.j41(18,"app-icon",17),e.EFF(19," info "),e.k0s()(),e.j41(20,"div",18),e.EFF(21),e.nI1(22,"mediaDuration"),e.k0s()(),e.j41(23,"mat-slider",19),e.nrm(24,"input",20),e.k0s(),e.j41(25,"div",21)(26,"div",22)(27,"label",23),e.EFF(28,"Orientation"),e.k0s(),e.j41(29,"mat-form-field",10)(30,"mat-select",24)(31,"mat-option",25),e.EFF(32," Unspecified "),e.k0s(),e.j41(33,"mat-option",26),e.EFF(34,"Landscape"),e.k0s(),e.j41(35,"mat-option",27),e.EFF(36,"Portrait"),e.k0s(),e.j41(37,"mat-option",28),e.EFF(38,"Square"),e.k0s()()()(),e.j41(39,"div",22)(40,"label",29),e.EFF(41,"Animation"),e.k0s(),e.j41(42,"mat-form-field",10)(43,"mat-select",30)(44,"mat-option",31),e.EFF(45,"Cut"),e.k0s(),e.j41(46,"mat-option",31),e.EFF(47,"Cross Fade"),e.k0s(),e.j41(48,"mat-option",31),e.EFF(49,"Slide Top"),e.k0s(),e.j41(50,"mat-option",31),e.EFF(51,"Slide Left"),e.k0s(),e.j41(52,"mat-option",31),e.EFF(53,"Slide Right"),e.k0s(),e.j41(54,"mat-option",31),e.EFF(55,"Slide Bottom"),e.k0s()()()()(),e.j41(56,"label",32),e.EFF(57,"Description"),e.k0s(),e.j41(58,"mat-form-field",10),e.nrm(59,"textarea",33),e.k0s(),e.j41(60,"div",34)(61,"div",22)(62,"label",35),e.EFF(63,"Valid From"),e.k0s(),e.nrm(64,"a-date-field",36),e.k0s(),e.j41(65,"div",22)(66,"label",37),e.EFF(67,"Valid Until"),e.k0s(),e.nrm(68,"a-date-field",38),e.k0s()()()),2&a){const t=e.XpG();e.Y8G("formGroup",t.form),e.R7$(21),e.SpI(" ",e.bMT(22,10,t.form.value.default_duration/1e3)," "),e.R7$(23),e.Y8G("value",1),e.R7$(2),e.Y8G("value",2),e.R7$(2),e.Y8G("value",3),e.R7$(2),e.Y8G("value",4),e.R7$(2),e.Y8G("value",5),e.R7$(2),e.Y8G("value",6),e.R7$(14),e.Y8G("from",t.form.value.valid_from)("disabled",!t.form.value.valid_from)}}function De(a,l){if(1&a){const t=e.RV6();e.j41(0,"footer",39)(1,"button",40),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.savePlaylist())}),e.EFF(2," Save Playlist "),e.k0s()()}}function Ge(a,l){1&a&&(e.j41(0,"main",41),e.nrm(1,"mat-spinner",42),e.j41(2,"p",43),e.EFF(3,"Saving Playlist..."),e.k0s()()),2&a&&(e.R7$(),e.Y8G("diameter",32))}let ae=(()=>{class a{constructor(t={},n,i,o){this._data=t,this._state=n,this._dialog=i,this._dialog_ref=o,this.loading=!1,this.playlist=this._data,this.media=this._state.media,this.search=new j.t(""),this.form=new c.gE({id:new c.MJ(this.playlist.id||""),name:new c.MJ(this.playlist.name||"",[c.k0.required]),description:new c.MJ(this.playlist.description||""),default_animation:new c.MJ(this.playlist.default_animation||ie.f.Cut),orientation:new c.MJ(this.playlist.orientation||"unspecified"),enabled:new c.MJ(this.playlist.enabled),random:new c.MJ(this.playlist.random),default_duration:new c.MJ(Math.max(this.playlist.default_duration||15e3,5e3)),valid_from:new c.MJ(1e3*this.playlist.valid_from),valid_until:new c.MJ(1e3*this.playlist.valid_until)})}savePlaylist(){var t=this;return(0,_.A)(function*(){if(t.form.markAllAsTouched(),t.form.updateValueAndValidity(),t.form.invalid)return;t.loading=!0;const n=t.form.getRawValue(),i=yield t._state.savePlaylist({...n,valid_from:(0,P._)(n.valid_from),valid_until:(0,P._)(n.valid_until)}).catch(o=>{throw(0,g.UG)("Error saving playlist"),t.loading=!1,o});t._dialog_ref.close(i)})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(C.Vh),e.rXU(S),e.rXU(C.bZ),e.rXU(C.CP))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-playlist-modal"]],viewQuery:function(n,i){if(1&n&&e.GBs(Se,5),2&n){let o;e.mGM(o=e.lsd())&&(i.search_input=o.first)}},decls:8,vars:5,consts:[["load_state",""],[1,"flex","items-center","justify-between","border-b","border-base-300"],[1,"p-2","font-medium","text-xl"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col w-[32rem] max-w-[calc(100vw-2rem)]",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-4 flex items-center justify-end space-x-2 border-t border-base-300",4,"ngIf"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","flex","flex-col","w-[32rem]","max-w-[calc(100vw-2rem)]",3,"formGroup"],["for","name"],["required",""],["appearance","outline",1,"w-full"],["matInput","","name","name","placeholder","Name","formControlName","name"],[1,"flex","items-center","space-x-8","mb-4"],["formControlName","enabled"],["formControlName","random"],[1,"flex","items-center","space-x-4"],["for","default-duration",1,"w-auto","min-w-0","m-0","space-x-2","flex","items-center"],["matTooltip","Default length of time to hold images on screen",1,"text-xl"],[1,"text-xs","font-mono"],["min","5000","max","300000","step","1000"],["name","default-duration","matSliderThumb","","formControlName","default_duration"],[1,"flex","space-x-2"],[1,"flex-1"],["for","orientation"],["name","orientation","formControlName","orientation","placeholder","Unspecified"],["value","unspecified"],["value","landscape"],["value","portrait"],["value","square"],["for","animation"],["name","animation","formControlName","default_animation","placeholder","Playlist Default"],[3,"value"],["for","description"],["matInput","","name","description","placeholder","Description","formControlName","description",1,"min-h-32"],[1,"flex","space-x-4"],["for","valid-from"],["name","valid-from","formControlName","valid_from"],["for","valid-until"],["name","valid-until","formControlName","valid_until",3,"from","disabled"],[1,"p-4","flex","items-center","justify-end","space-x-2","border-t","border-base-300"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-8"],[3,"diameter"],[1,"mt-4"]],template:function(n,i){if(1&n&&(e.j41(0,"header",1)(1,"h1",2),e.EFF(2),e.k0s(),e.DNE(3,Re,3,0,"button",3),e.k0s(),e.DNE(4,Ee,69,12,"main",4)(5,De,3,0,"footer",5)(6,Ge,4,1,"ng-template",null,0,e.C5r)),2&n){const o=e.sdS(7);e.R7$(2),e.SpI(" ",i.playlist.id?"Edit":"New"," Playlist "),e.R7$(),e.Y8G("ngIf",!i.loading),e.R7$(),e.Y8G("ngIf",!i.loading)("ngIfElse",o),e.R7$(),e.Y8G("ngIf",!i.loading)}},dependencies:[h.bT,c.me,c.BC,c.cb,M.rl,M.TL,D.fg,H.VO,k.wT,Ie.So,z.oV,N.LG,C.tx,k.r6,c.j4,c.JD,ne.G,T.R,U.IV,U.OU,Y.X]})}return a})();var Pe=p(33240),$e=p(34938),Ve=p(56441);function Le(a,l){1&a&&(e.j41(0,"button",6)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function Ne(a,l){if(1&a&&(e.j41(0,"div",15)(1,"label",33),e.EFF(2,"Start Time"),e.k0s(),e.j41(3,"div",17),e.EFF(4),e.nI1(5,"mediaDuration"),e.k0s()(),e.j41(6,"mat-slider",34),e.nrm(7,"input",35),e.k0s()),2&a){const t=e.XpG(2);e.R7$(4),e.SpI(" ",e.i5U(5,2,t.form.value.start_time/1e3,!0)," "),e.R7$(2),e.Y8G("max",(t.item.video_length||3e5)-1e3)}}function Xe(a,l){if(1&a&&(e.EFF(0),e.nI1(1,"mediaDuration")),2&a){const t=e.XpG(2);e.SpI(" ",e.i5U(1,1,t.form.value.play_time/1e3,!0)," ")}}function ze(a,l){if(1&a&&(e.j41(0,"span",18),e.EFF(1),e.nI1(2,"mediaDuration"),e.k0s()),2&a){const t=e.XpG(2);e.R7$(),e.SpI(" Default (",t.item.video_length?e.bMT(2,1,t.item.video_length/1e3):"",") ")}}function Ue(a,l){if(1&a){const t=e.RV6();e.j41(0,"main",7)(1,"div",8)(2,"button",9),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.preview())}),e.nrm(3,"img",10),e.j41(4,"div",11),e.EFF(5),e.k0s()(),e.j41(6,"label",12),e.EFF(7,"Name"),e.k0s(),e.j41(8,"mat-form-field",13),e.nrm(9,"input",14),e.j41(10,"mat-error"),e.EFF(11,"A name is required"),e.k0s()(),e.DNE(12,Ne,8,5),e.j41(13,"div",15)(14,"label",16),e.EFF(15," Play Time"),e.k0s(),e.j41(16,"div",17),e.DNE(17,Xe,2,4)(18,ze,3,3,"span",18),e.k0s()(),e.j41(19,"mat-slider",19),e.nrm(20,"input",20),e.k0s(),e.j41(21,"label",21),e.EFF(22,"Animation"),e.k0s(),e.j41(23,"mat-form-field",13)(24,"mat-select",22)(25,"mat-option",23),e.EFF(26,"Playlist Default"),e.k0s(),e.j41(27,"mat-option",23),e.EFF(28,"Cut"),e.k0s(),e.j41(29,"mat-option",23),e.EFF(30,"Cross Fade"),e.k0s(),e.j41(31,"mat-option",23),e.EFF(32,"Slide Top"),e.k0s(),e.j41(33,"mat-option",23),e.EFF(34,"Slide Left"),e.k0s(),e.j41(35,"mat-option",23),e.EFF(36,"Slide Right"),e.k0s(),e.j41(37,"mat-option",23),e.EFF(38,"Slide Bottom"),e.k0s()()(),e.j41(39,"label",24),e.EFF(40,"Description"),e.k0s(),e.j41(41,"mat-form-field",25),e.nrm(42,"textarea",26),e.k0s(),e.j41(43,"div",27)(44,"div",28)(45,"label",29),e.EFF(46,"Valid From"),e.k0s(),e.nrm(47,"a-date-field",30),e.k0s(),e.j41(48,"div",28)(49,"label",31),e.EFF(50,"Valid Until"),e.k0s(),e.nrm(51,"a-date-field",32),e.k0s()()()()}if(2&a){const t=e.XpG();e.Y8G("formGroup",t.form),e.R7$(3),e.Y8G("source",t.thumbnail||t.url),e.R7$(2),e.SpI(" ",t.media_type," "),e.R7$(7),e.vxM("video"===t.media_type?12:-1),e.R7$(5),e.vxM(t.form.value.play_time?17:18),e.R7$(2),e.Y8G("min",t.form.value.start_time)("max",t.item.video_length||3e5),e.R7$(6),e.Y8G("value",0),e.R7$(2),e.Y8G("value",1),e.R7$(2),e.Y8G("value",2),e.R7$(2),e.Y8G("value",3),e.R7$(2),e.Y8G("value",4),e.R7$(2),e.Y8G("value",5),e.R7$(2),e.Y8G("value",6),e.R7$(14),e.Y8G("from",t.form.value.valid_from)}}function Ye(a,l){if(1&a){const t=e.RV6();e.j41(0,"footer",36)(1,"button",37),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.saveMedia())}),e.EFF(2," Save "),e.k0s()()}}function Be(a,l){1&a&&(e.j41(0,"main",38),e.nrm(1,"mat-spinner",39),e.j41(2,"p"),e.EFF(3,"Saving media item..."),e.k0s()())}let oe=(()=>{class a{get media_type(){return this.file&&(this.file.type.includes("video")?"video":this.file.type.includes("image")?"image":"")||this.item.media_type}get url(){return this.item.id?this.item.media_url:(this._file_url||(this._file_url=URL.createObjectURL(this.file)),this._file_url)}constructor(t,n){this._data=t,this._dialog_ref=n,this.loading=!1,this.item=this._data.media,this.file=this._data.file,this.thumbnail=this._data.file_thumbnail||this._data.media.thumbnail_url,this.form=new c.gE({name:new c.MJ("",[c.k0.required]),description:new c.MJ(""),animation:new c.MJ(ie.f.Default),start_time:new c.MJ(0),play_time:new c.MJ(null),valid_from:new c.MJ((0,Pe.o)(Date.now()).valueOf()),valid_until:new c.MJ((0,$e.e)((0,Ve.D)(Date.now()),10).valueOf())}),this.preview=()=>this._data.preview({media_url:this.url,media_type:this.media_type,name:this.form.value.name}),this.form.patchValue({...this._data.media,valid_from:1e3*this._data.media.valid_from,valid_until:1e3*this._data.media.valid_until}),this._data.file&&this.form.patchValue({name:this._data.file.name}),this._data.file_metadata&&(this.item.video_length=Math.floor(1e3*this._data.file_metadata[1]))}ngOnDestroy(){this._file_url&&URL.revokeObjectURL(this._file_url)}saveMedia(){var t=this;return(0,_.A)(function*(){if(t.form.markAllAsTouched(),t.form.updateValueAndValidity(),!t.form.valid)return;t.loading=!0,t._dialog_ref.disableClose=!0;const n=t.form.getRawValue(),i={...t.item,...n,valid_from:(0,P._)(new Date(n.valid_from)),valid_until:(0,P._)(n.valid_until)},o=s=>{throw t._dialog_ref.disableClose=!1,t.loading=!1,s};t.item.id?yield(0,m.UZU)(t.item.id,i).toPromise().catch(o):yield t._data.onAdd(t.file,i).catch(o),t._dialog_ref.disableClose=!1,t._dialog_ref.close(),(0,g.VX)("Successfully saved media item.")})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(C.Vh),e.rXU(C.CP))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-media-modal"]],decls:8,vars:5,consts:[["load_state",""],[1,"flex","items-center","justify-between","border-b","border-base-300"],[1,"p-2","text-xl","font-medium"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 max-w-[calc(100vw-2rem)] w-[32rem] max-h-[65vh] overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex justify-end p-4 border-t border-base-300",4,"ngIf"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","max-w-[calc(100vw-2rem)]","w-[32rem]","max-h-[65vh]","overflow-auto",3,"formGroup"],[1,"flex","flex-col"],["matRipple","",1,"relative","w-full","h-48","mx-auto","bg-base-300","rounded-xl","overflow-hidden","mb-4",3,"click"],["auth","",1,"h-full","w-full","object-contain","object-center",3,"source"],[1,"absolute","top-2","left-2","px-2","py-1","rounded","text-xs","bg-base-400","capitalize"],["for","name"],["appearance","outline"],["matInput","","name","name","formControlName","name","placeholder","Media Name"],[1,"flex","items-center","space-x-4"],["for","play-time",1,"w-auto","min-w-0","m-0"],[1,"text-xs","font-mono"],[1,"opacity-30"],["step","100",3,"min","max"],["name","play-time","matSliderThumb","","formControlName","play_time"],["for","animation"],["name","animation","formControlName","animation","placeholder","Playlist Default"],[3,"value"],["for","description"],["appearance","outline",1,"w-full"],["matInput","","name","description","placeholder","Description","formControlName","description",1,"min-h-32"],[1,"flex","space-x-4"],[1,"flex-1"],["for","valid-from"],["name","valid-from","formControlName","valid_from"],["for","valid-until"],["name","valid-until","formControlName","valid_until",3,"from"],["for","start-time",1,"w-auto","min-w-0","m-0"],["min","0","step","100",3,"max"],["name","start-time","matSliderThumb","","formControlName","start_time"],[1,"flex","justify-end","p-4","border-t","border-base-300"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-8","max-w-[calc(100vw-2rem)]","min-h-64","w-[32rem]","space-y-4"],["diameter","32"]],template:function(n,i){if(1&n&&(e.j41(0,"header",1)(1,"h2",2),e.EFF(2),e.k0s(),e.DNE(3,Le,3,0,"button",3),e.k0s(),e.DNE(4,Ue,52,15,"main",4)(5,Ye,3,0,"footer",5)(6,Be,4,0,"ng-template",null,0,e.C5r)),2&n){const o=e.sdS(7);e.R7$(2),e.SpI(" ",i.item.id?"Edit":"New"," Media Item "),e.R7$(),e.Y8G("ngIf",!i.loading),e.R7$(),e.Y8G("ngIf",!i.loading)("ngIfElse",o),e.R7$(),e.Y8G("ngIf",!i.loading)}},dependencies:[h.bT,c.me,c.BC,c.cb,M.rl,M.TL,D.fg,H.VO,k.wT,N.LG,C.tx,k.r6,c.j4,c.JD,ne.G,T.R,X.U,U.IV,U.OU,Y.X]})}return a})();function Ae(a,l){1&a&&(e.j41(0,"button",6)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function Oe(a,l){if(1&a&&(e.j41(0,"main",7)(1,"div",8)(2,"label",9),e.EFF(3,"Name"),e.j41(4,"span",10),e.EFF(5,"*"),e.k0s()(),e.j41(6,"mat-form-field",11),e.nrm(7,"input",12),e.j41(8,"mat-error"),e.EFF(9,"Name is required"),e.k0s()()(),e.j41(10,"div",8)(11,"label",13),e.EFF(12,"Description"),e.k0s(),e.j41(13,"mat-form-field",11),e.nrm(14,"textarea",14),e.k0s()(),e.j41(15,"div",8)(16,"label",15),e.EFF(17,"Orientation"),e.k0s(),e.j41(18,"mat-form-field",11)(19,"mat-select",16)(20,"mat-option",17),e.EFF(21," Unspecified "),e.k0s(),e.j41(22,"mat-option",18),e.EFF(23,"Landscape"),e.k0s(),e.j41(24,"mat-option",19),e.EFF(25,"Portrait"),e.k0s(),e.j41(26,"mat-option",20),e.EFF(27,"Square"),e.k0s()()()()()),2&a){const t=e.XpG();e.Y8G("formGroup",t.form)}}function Je(a,l){if(1&a){const t=e.RV6();e.j41(0,"footer",21)(1,"button",22),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.save())}),e.EFF(2,"Save"),e.k0s()()}}function Ze(a,l){1&a&&(e.j41(0,"main",23),e.nrm(1,"mat-spinner",24),e.j41(2,"p",25),e.EFF(3,"Saving display..."),e.k0s()()),2&a&&(e.R7$(),e.Y8G("diameter",32))}let se=(()=>{class a{constructor(t,n,i){this._data=t,this._dialog_ref=n,this._org=i,this.loading=!1,this.display=this._data.display,this.form=new c.gE({id:new c.MJ(this._data.display?.id||""),name:new c.MJ(this._data.display?.display_name||"",[c.k0.required]),description:new c.MJ(this._data.display?.description||""),orientation:new c.MJ(this._data.display?.orientation||"unspecified")})}save(){var t=this;return(0,_.A)(function*(){if(t.form.markAllAsTouched(),t.form.updateValueAndValidity(),t.form.invalid)return;t.loading=!0;const n=t.form.getRawValue(),i=new m.tYo({...n,name:`SIGNAGE ${n.name}`,display_name:n.name,signage:!0,zones:(0,g.Am)([t._org.organisation.id,t._org.region?.id,t._org.building?.id,...t.display.zones].filter(r=>!!r))}),s=yield(t.display.id?(0,m.Pny)(t.display.id,i):(0,m.tEp)(i)).toPromise();t._dialog_ref.close(s)})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(C.Vh),e.rXU(C.CP),e.rXU(O.yb))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-display-modal"]],decls:8,vars:5,consts:[["load_state",""],[1,"flex","items-center","justify-between","border-b","border-base-300","p-2"],[1,"p-2","font-medium","text-xl"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col w-[32rem] max-w-[calc(100vw-2rem)]",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex justify-end p-4 border-t border-base-200",4,"ngIf"],["icon","","matRipple","","mat-dialog-close",""],[1,"p-4","flex","flex-col","w-[32rem]","max-w-[calc(100vw-2rem)]",3,"formGroup"],[1,"flex","flex-col"],["for","name"],["required",""],["appearance","outline",1,"w-full"],["matInput","","name","name","placeholder","Name","formControlName","name","required",""],["for","description"],["matInput","","name","description","placeholder","Description","formControlName","description",1,"min-h-32"],["for","orientation"],["name","orientation","formControlName","orientation","placeholder","Unspecified"],["value","unspecified"],["value","landscape"],["value","portrait"],["value","square"],[1,"flex","justify-end","p-4","border-t","border-base-200"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-8"],[3,"diameter"],[1,"mt-4"]],template:function(n,i){if(1&n&&(e.j41(0,"header",1)(1,"h1",2),e.EFF(2),e.k0s(),e.DNE(3,Ae,3,0,"button",3),e.k0s(),e.DNE(4,Oe,28,1,"main",4)(5,Je,3,0,"footer",5)(6,Ze,4,1,"ng-template",null,0,e.C5r)),2&n){const o=e.sdS(7);e.R7$(2),e.SpI(" ",i.display.id?"Edit":"New"," Display "),e.R7$(),e.Y8G("ngIf",!i.loading),e.R7$(),e.Y8G("ngIf",!i.loading)("ngIfElse",o),e.R7$(),e.Y8G("ngIf",!i.loading)}},dependencies:[h.bT,c.me,c.BC,c.cb,c.YS,M.rl,M.TL,D.fg,H.VO,k.wT,N.LG,C.tx,k.r6,c.j4,c.JD,T.R]})}return a})(),S=(()=>{class a extends g.Tv{changed(){this._change.next(Date.now())}constructor(t,n,i){super(),this._org=t,this._dialog=n,this._settings=i,this._loading=new j.t(!1),this._change=new j.t(0),this._active_upload=new j.t(null),this.loading=this._loading.asObservable(),this.has_changed=this._change.asObservable(),this.media=(0,b.zV)([this._org.active_building,this._change]).pipe((0,L.p)(([o])=>!!o?.id),(0,J.B)(300),(0,E.n)(([o])=>(0,m.Pof)({limit:2500})),(0,y.T)(o=>o.data.sort((s,r)=>r.created_at-s.created_at)),(0,G.t)(1)),this.playlists=(0,b.zV)([this._org.active_building,this._change]).pipe((0,L.p)(([o])=>!!o?.id),(0,J.B)(300),(0,E.n)(()=>(0,m.oD0)({limit:500})),(0,y.T)(o=>(o.data||[]).sort((s,r)=>s.name.localeCompare(r.name))),(0,G.t)(1)),this.displays=(0,b.zV)([this._org.active_region,this._org.active_building,this._change]).pipe((0,L.p)(([o,s])=>!!s?.id),(0,E.n)(([o,s])=>(0,m.BbB)({zone_id:(this._settings.get("app.use_region")?o?.id:"")||s?.id,limit:500,signage:!0}).pipe((0,y.T)(r=>(r.data||[]).sort((d,u)=>(d.display_name||d.name).localeCompare(u.display_name||u.name)).filter(d=>d.signage)))),(0,G.t)(1)),this.zones=(0,b.zV)([this._org.active_building,this._change]).pipe((0,E.n)(([o])=>(0,m.smM)({limit:250}).pipe((0,te.W)(()=>(0,ee.of)({data:[]})))),(0,y.T)(o=>(o.data||[]).sort((s,r)=>(s.display_name||s.name).localeCompare(r.display_name||r.name))))}editPlaylist(t=new m.xIT({})){return new Promise(n=>{this._dialog.open(ae,{data:t}).afterClosed().subscribe(o=>{this.timeout("changed",()=>this._change.next(Date.now())),n(o)})})}editMedia(t=new m.HN5({}),n,i=""){var o=this;return new Promise(function(){var s=(0,_.A)(function*(r){o._dialog.open(oe,{data:{media:t,file:n,file_metadata:n?yield o._getMediaMetadata(n):["landscape"===t.orientation,0],file_thumbnail:n?yield o._generateThumbnail(n,1024,720):"",playlist_id:i,onAdd:(u,f)=>o.addMedia(u,f),preview:u=>o.previewMedia(u)}}).afterClosed().subscribe(u=>{o.timeout("changed",()=>o._change.next(Date.now())),r(u)})});return function(r){return s.apply(this,arguments)}}())}editDisplay(t=new m.tYo({})){var n=this;return(0,_.A)(function*(){console.log("Edit Display:",t);const o=yield n._dialog.open(se,{data:{display:t}}).afterClosed().toPromise();return n.timeout("changed",()=>n._change.next(Date.now())),o})()}removeDisplay(t){var n=this;return(0,_.A)(function*(){const i=yield(0,g.GE)({title:"Remove Display",content:`\n                Are you sure you wish to remove the display "<strong>${t.display_name}</strong>"?\n                `,icon:{content:"delete"}},n._dialog);"done"===i.reason&&(i.loading("Removing display..."),t.map_id||t.email||t.module_list.length>0?yield(0,m.Pny)(t.id,{signage:!1}).toPromise():yield(0,m.KCc)(t.id).toPromise(),n._change.next(Date.now()),i.close())})()}savePlaylist(t){var n=this;return(0,_.A)(function*(){yield(t.id?(0,m.I_z)(t.id,t):(0,m.yDx)(t)).toPromise(),(0,g.VX)("Successfully saved playlist."),n._change.next(Date.now())})()}removePlaylist(t){var n=this;return(0,_.A)(function*(){!t?.id||"done"!==(yield(0,g.GE)({title:"Remove Playlist",content:`\n            Are you sure you wish to remove the playlist "<strong>${t.name}</strong>"?<br/><br/>`,icon:{content:"delete"}},n._dialog)).reason||(yield(0,m.pIQ)(t.id).toPromise(),(0,g.VX)("Successfully removed playlist."))})()}updatePlaylistMedia(t,n){return(0,_.A)(function*(){yield(0,m.UCT)(t,n).toPromise(),(0,g.VX)("Successfully updated playlist media.")})()}previewMedia(t){this._dialog.open(Z,{data:{url:t.media_url,type:t.media_type,name:t.name,save:!1}})}previewFileFromInput(t,n=""){const i=t.target;if(!i?.files?.length)return;const s=i.files[0];s&&(s.type.includes("image")||s.type.includes("video"))?this.editMedia(void 0,s,n):(0,g.UG)("Invalid file type.")}previewFileMedia(t,n=""){var i=this;const o=URL.createObjectURL(t),s=t.type.includes("image")?"image":"video",r=this._dialog.open(Z,{data:{url:o,type:s,name:t.name,save:!0,file:t}});r.afterClosed().subscribe(()=>URL.revokeObjectURL(o)),r.componentInstance.save.subscribe((0,_.A)(function*(){r.componentInstance.loading="Saving...";const d=yield i.addMedia(t).catch(u=>{throw(0,g.UG)("Error saving media."),r.componentInstance.loading="",u});if(n&&d.id){const f=[...(yield(0,m.$kw)(n).toPromise()).items,d.id];yield(0,m.UCT)(n,f).toPromise()}r.close()}))}addMedia(t,n=new m.HN5({})){var i=this;return(0,_.A)(function*(){const o=R=>new Promise((V,K)=>{let xe=null,Fe=!1;(0,g.QM)(R).subscribe(A=>{xe=A,A.link&&(Fe=!0,V({id:A.upload.id,link:A.link}))},K,()=>Fe?null:V(xe))}),[s,r]=yield i._getMediaMetadata(t),d=yield i._generateThumbnail(t,1280,720).catch(R=>null),u=yield o(t);let f=null;d&&(f=yield o(function He(a,l){const[t,n]=a.split(","),i=t.split(":")[1].split(";")[0],o=atob(n),s=new ArrayBuffer(o.length),r=new Uint8Array(s);for(let d=0;d<o.length;d++)r[d]=o.charCodeAt(d);return new File([r],l,{type:i})}(d,`thumb+${t.name}`)));const I={...new m.HN5({...n,name:n.name||t.name,media_id:u.id,media_uri:u.link,media_type:t.type.includes("image")?"image":"video",orientation:s?"landscape":"portrait",thumbnail_id:f.id})};for(const R in I)I[R]||delete I[R];const $=yield(0,m.OSd)(I).toPromise();return i._active_upload.next(null),i._change.next(Date.now()),$})()}updateMedia(t){return(0,_.A)(function*(){t?.id&&(yield(0,m.UZU)(t.id,t).toPromise())})()}removeMedia(t){var n=this;return(0,_.A)(function*(){if(!t?.id)return;const i=yield(0,g.GE)({title:"Remove Media item",content:`\n                Are you sure you wish to remove the media item "<strong>${t.name}</strong>"?<br/><br/>\n                <i class="text-sm">The item will be removed from all playlists and the files deleted from storage.</i>\n                `,icon:{content:"delete"}},n._dialog);"done"===i.reason&&(i.loading("Removing media..."),yield(0,m.lek)(t.id).toPromise(),n._change.next(Date.now()),i.close())})()}_getMediaMetadata(t){return new Promise(n=>{const i=URL.createObjectURL(t);if(t.type.includes("video")){let o=document.createElement("video");o.src=i.toString(),o.addEventListener("loadedmetadata",()=>{const{videoWidth:s,videoHeight:r}=o;n([s>r,o.duration])}),o.load()}else{let o=new Image;o.onload=()=>n([o.width>o.height,0]),o.src=i.toString()}})}_generateThumbnail(t,n,i){var o=this;return(0,_.A)(function*(){return console.log("File:",t,n,i),t.type.includes("video")?o._generateVideoThumbnail(t,n,i):o._generateImageThumbnail(t,n,i)})()}_generateImageThumbnail(t,n,i){return new Promise((o,s)=>{const r=new Image;r.src=URL.createObjectURL(t),console.log("Image:",r.src),r.onload=()=>{const d=this._generateThumbnailFromResource(r,r.width,r.height,n,i);URL.revokeObjectURL(r.src),o(d)},r.onerror=s})}_generateVideoThumbnail(t,n,i){return new Promise((o,s)=>{const r=document.createElement("video");r.autoplay=!0,r.muted=!0,r.src=URL.createObjectURL(t),r.onloadeddata=()=>{const d=this._generateThumbnailFromResource(r,r.videoWidth,r.videoHeight,n,i);URL.revokeObjectURL(r.src),o(d)},r.onerror=s})}_generateThumbnailFromResource(t,n,i,o,s){const r=document.createElement("canvas"),d=r.getContext("2d");let u=n,f=i;const I=u/f;return u>o&&(u=s,f=u/I),f>s&&(f=o,u=f*I),r.width=u,r.height=f,d.drawImage(t,0,0,u,f),r.toDataURL("image/jpeg")}static#e=this.\u0275fac=function(n){return new(n||a)(e.KVO(O.yb),e.KVO(C.bZ),e.KVO(g.h$))};static#t=this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var We=p(45189),Qe=p(96843),B=p(38223);const Ke=["app-new-staff",""];function qe(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",10),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.newItem(i.active_link))}),e.EFF(1),e.k0s()}if(2&a){const t=e.XpG();e.R7$(),e.SpI(" Add ",t.singular(t.active_link)," ")}}function et(a,l){if(1&a){const t=e.RV6();e.j41(0,"a",11),e.nI1(1,"lowercase"),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.active_link=i)}),e.EFF(2),e.k0s()}if(2&a){const t=l.$implicit,n=e.XpG();e.Y8G("routerLink","/signage/"+e.bMT(1,3,t))("active",n.active_link==t),e.R7$(2),e.SpI(" ",t," ")}}let le=(()=>{class a extends g.Tv{singular(t){return"Media"===t||"Playlists"===t?"Playlist":"Displays"===t?"Display":""}newItem(t){var n=this;return(0,_.A)(function*(){let i=null;switch(t){case"Media":case"Playlists":i=yield n._state.editPlaylist(),i&&n._router.navigate(["/signage/media"],{queryParams:{playlist:i.id}});break;case"Displays":if(i=yield n._state.editDisplay(),!i)return;n._router.navigate(["/signage/displays"],{queryParams:{display:i.id}})}})()}constructor(t,n){super(),this._state=t,this._router=n,this.loading=this._state.loading,this.links=["Media","Displays","Zones"],this.active_link=this.links[0],this.previewFile=i=>this._state.previewFileFromInput(i)}ngOnInit(){this.subscription("route.query",this._router.events.subscribe(t=>{t instanceof x.wF&&(this.active_link=this.links.find(n=>this._router.url.includes(n.toLowerCase())))})),this.active_link=this.links.find(t=>this._router.url.includes(t.toLowerCase()))}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(S),e.rXU(x.Ix))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["","app-new-staff",""]],features:[e.Vt3],attrs:Ke,decls:15,vars:2,consts:[["tabPanel",""],[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"p-8","h-28","flex","items-center","justify-between"],[1,"text-2xl","font-medium"],["btn","","matRipple","","class","w-40",3,"click",4,"ngIf"],[1,"px-8"],["mat-tab-nav-bar","",3,"tabPanel"],["mat-tab-link","",3,"routerLink","active"],[1,"flex-1","h-1/2","overflow-auto","px-8","py-4"],["btn","","matRipple","",1,"w-40",3,"click"],["mat-tab-link","",3,"click","routerLink","active"]],template:function(n,i){if(1&n&&(e.nrm(0,"app-topbar"),e.j41(1,"div",1),e.nrm(2,"app-sidebar"),e.j41(3,"main",2)(4,"div",3)(5,"h2",4),e.EFF(6," Digital Signage Management "),e.k0s(),e.DNE(7,qe,2,1,"button",5),e.k0s(),e.j41(8,"div",6)(9,"nav",7),e.Z7z(10,et,3,5,"a",8,e.fX1),e.k0s()(),e.j41(12,"mat-tab-nav-panel",9,0),e.nrm(14,"router-outlet"),e.k0s()()()),2&n){const o=e.sdS(13);e.R7$(7),e.Y8G("ngIf","Media"===i.active_link||"Displays"===i.active_link),e.R7$(2),e.Y8G("tabPanel",o),e.R7$(),e.Dyx(i.links)}},dependencies:[h.bT,We.S,Qe.c,k.r6,x.n3,x.Wk,B.Bu,B.hQ,B.Ql,h.GH],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=signage.component.ts-angular-inline--192.css.map*/"]})}return a})();var tt=p(57871);let it=(()=>{class a extends g.Tv{constructor(t,n,i,o){super(),this._state=t,this._org=n,this._route=i,this._router=o,this.zones=[],this.levels=this._org.active_levels}ngOnInit(){var t=this;return(0,_.A)(function*(){yield t._org.initialised.pipe((0,tt.$)(n=>n)).toPromise(),t.subscription("route.query",t._route.queryParamMap.subscribe(n=>{if(n.has("zone_ids")){const i=n.get("zone_ids").split(",");if(i.length){const o=t._org.levelWithID(i);if(!o)return;t._org.building=t._org.buildings.find(s=>s.id===o.parent_id),t.zones=i}}})),t.subscription("levels",t._org.active_levels.subscribe(n=>{t.zones=t.zones.filter(i=>n.find(o=>o.id===i)),!t.zones.length&&n.length&&t.zones.push(n[0].id)}))})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(S),e.rXU(O.yb),e.rXU(x.nX),e.rXU(x.Ix))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-topbar"]],features:[e.Vt3],decls:1,vars:0,consts:[[1,"flex","items-center","bg-base-100","h-20","px-4","border-b","border-base-200","space-x-2"]],template:function(n,i){1&n&&e.nrm(0,"div",0)},styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=signage-topbar.component.ts-angular-inline--193.css.map*/"]})}return a})();var re=p(23206),w=p(31034);const nt=(a,l)=>l.id;function at(a,l){1&a&&e.nrm(0,"div",9)}function ot(a,l){1&a&&e.nrm(0,"div",10)}function st(a,l){1&a&&(e.j41(0,"div",24)(1,"app-icon",25),e.EFF(2," add "),e.k0s()())}function lt(a,l){if(1&a&&e.nrm(0,"img",26),2&a){const t=e.XpG().$implicit;e.Y8G("source",t.thumbnail_url)}}function rt(a,l){if(1&a&&(e.j41(0,"div",27),e.EFF(1),e.nI1(2,"mediaDuration"),e.k0s()),2&a){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",e.bMT(2,1,t.play_time/1e3)," ")}}function ct(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",8),e.DNE(1,at,1,0,"div",9)(2,ot,1,0,"div",10)(3,st,3,0,"div",11),e.j41(4,"div",12),e.DNE(5,lt,1,1,"img",13),e.j41(6,"div",14),e.EFF(7),e.k0s(),e.DNE(8,rt,3,3,"div",15),e.k0s(),e.j41(9,"div",16)(10,"div",17),e.EFF(11),e.k0s(),e.j41(12,"button",18)(13,"app-icon"),e.EFF(14,"more_vert"),e.k0s()(),e.j41(15,"mat-menu",null,0)(17,"button",19),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.editItem(i))}),e.j41(18,"div",20)(19,"app-icon",21),e.EFF(20,"edit"),e.k0s(),e.j41(21,"div",22),e.EFF(22,"Edit Media Item"),e.k0s()()(),e.j41(23,"button",19),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.previewItem(i))}),e.j41(24,"div",20)(25,"app-icon",21),e.EFF(26,"visibility"),e.k0s(),e.j41(27,"div",22),e.EFF(28," Preview Media Item "),e.k0s()()(),e.j41(29,"button",19),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.removeItem(i))}),e.j41(30,"div",20)(31,"app-icon",23),e.EFF(32," delete "),e.k0s(),e.j41(33,"div",22),e.EFF(34," Remove Media Item "),e.k0s()()()()()()}if(2&a){const t=l.$implicit,n=e.sdS(16),i=e.XpG(2);e.R7$(),e.vxM(t.valid_from&&i.now<t.valid_from?1:t.valid_until&&i.now>t.valid_until?2:-1),e.R7$(4),e.Y8G("ngIf",t.thumbnail_url),e.R7$(),e.AVh("bg-info","video"===t.media_type)("text-info-content","video"===t.media_type)("bg-warning","image"===t.media_type)("text-warning-content","image"===t.media_type),e.R7$(),e.SpI(" ",t.media_type," "),e.R7$(),e.Y8G("ngIf",t.play_time),e.R7$(2),e.Y8G("matTooltip",t.name),e.R7$(),e.SpI(" ",t.name," "),e.R7$(),e.Y8G("matMenuTriggerFor",n)}}function dt(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",7),e.nI1(1,"async"),e.bIt("cdkDropListDropped",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.drop(i))}),e.Z7z(2,ct,35,15,"div",8,nt),e.nI1(4,"async"),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("cdkDropListData",e.bMT(1,2,t.media))("cdkDropListConnectedTo",t.playlist_ids),e.R7$(2),e.Dyx(e.bMT(4,4,t.media))}}function pt(a,l){1&a&&(e.j41(0,"div",6)(1,"app-icon",28),e.EFF(2,"hide_image"),e.k0s(),e.j41(3,"p"),e.EFF(4,"No media found."),e.k0s()())}let ce=(()=>{class a{get now(){return(0,P._)((0,re.c)(Date.now()))}constructor(t){var n=this;this._state=t,this.playlist_count=0,this.search=new j.t(""),this.media=(0,b.zV)([this.search,this._state.media]).pipe((0,y.T)(([i,o])=>o.filter(s=>s.name.toLowerCase().includes(i.toLowerCase())))),this.playlist_ids=[],this.previewItem=i=>this._state.previewMedia(i),this.editItem=i=>this._state.editMedia(i),this.removeItem=function(){var i=(0,_.A)(function*(o){return n._state.removeMedia(o)});return function(o){return i.apply(this,arguments)}}()}ngOnChanges(t){t.playlist_count&&(this.playlist_ids=new Array(this.playlist_count).fill(0).map((n,i)=>`playlist-${i}`))}drop(t){}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(S))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-media-list"]],inputs:{playlist_count:"playlist_count"},features:[e.OA$],decls:8,vars:4,consts:[["menu","matMenu"],[1,"p-4"],[1,"text-xl","font-medium","text-center","mb-4"],["appearance","outline",1,"w-full","no-subscript"],["matInput","","placeholder","Search...",3,"ngModelChange","ngModel"],["cdkDropList","","id","media-list",1,"grid","w-full","gap-4","md:grid-cols-2","lg:grid-cols-3","p-4",3,"cdkDropListData","cdkDropListConnectedTo"],[1,"flex","flex-col","items-center","justify-center","p-8","space-y-2","opacity-30","mx-auto","flex-1"],["cdkDropList","","id","media-list",1,"grid","w-full","gap-4","md:grid-cols-2","lg:grid-cols-3","p-4",3,"cdkDropListDropped","cdkDropListData","cdkDropListConnectedTo"],["cdkDrag","",1,"relative","bg-base-100","rounded-lg","flex","flex-col","items-center","justify-center","p-3","hover:opacity-80","border","border-base-300"],[1,"absolute","inset-0","z-0","bg-warning","opacity-10","rounded-lg"],[1,"absolute","inset-0","z-0","bg-error","opacity-10","rounded-lg"],["class","min-h-10 min-w-10 border-4 rounded-2xl border-base-400 bg-base-300 border-dashed flex items-center justify-center",4,"cdkDragPlaceholder"],["preview","",1,"relative","w-full","h-36","bg-base-200","rounded-lg","overflow-hidden"],["auth","","class","w-full h-full object-contain rounded-lg",3,"source",4,"ngIf"],[1,"absolute","top-1","left-1","px-2","py-1","text-xs","rounded-lg","capitalize","font-mono"],["class","absolute bottom-1 right-1 px-2 py-1 text-xs rounded-lg bg-info text-info-content capitalize font-mono",4,"ngIf"],[1,"flex","items-center","justify-between","w-full","relative","top-1"],[1,"text-base-content","truncate","flex-1","w-1/2",3,"matTooltip"],["icon","","matRipple","","aria-label","Media Actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"text-2xl"],[1,"pr-2"],[1,"text-2xl","text-error"],[1,"min-h-10","min-w-10","border-4","rounded-2xl","border-base-400","bg-base-300","border-dashed","flex","items-center","justify-center"],[1,"text-2xl","text-base-100"],["auth","",1,"w-full","h-full","object-contain","rounded-lg",3,"source"],[1,"absolute","bottom-1","right-1","px-2","py-1","text-xs","rounded-lg","bg-info","text-info-content","capitalize","font-mono"],[1,"text-6xl"]],template:function(n,i){if(1&n&&(e.j41(0,"div",1)(1,"h3",2),e.EFF(2,"Media"),e.k0s(),e.j41(3,"mat-form-field",3)(4,"input",4),e.bIt("ngModelChange",function(s){return i.search.next(s)}),e.k0s()()(),e.DNE(5,dt,5,6,"div",5),e.nI1(6,"async"),e.DNE(7,pt,5,0,"div",6)),2&n){let o;e.R7$(4),e.Y8G("ngModel",i.search.getValue()),e.R7$(),e.vxM((null==(o=e.bMT(6,2,i.media))?null:o.length)>0?5:7)}},dependencies:[h.bT,c.me,c.BC,c.vS,M.rl,D.fg,w.kk,w.fb,w.Cp,z.oV,k.r6,T.R,X.U,F.O7,F.T1,F.EM,h.Jj,Y.X],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}\n\n/*# sourceMappingURL=signage-media-list.component.ts-angular-inline--194.css.map*/"]})}return a})();var v=p(33602),de=p(89273);function mt(a,l){1&a&&(e.j41(0,"div",19),e.EFF(1," Shuffle ON "),e.k0s())}function ut(a,l){1&a&&e.nrm(0,"div",23)}function _t(a,l){1&a&&e.nrm(0,"div",24)}function gt(a,l){1&a&&(e.j41(0,"div",31)(1,"app-icon",32),e.EFF(2," add "),e.k0s()())}function ft(a,l){if(1&a){const t=e.RV6();e.qex(0),e.j41(1,"div",22),e.DNE(2,ut,1,0,"div",23)(3,_t,1,0,"div",24)(4,gt,3,0,"div",25),e.j41(5,"button",26)(6,"app-icon"),e.EFF(7,"drag_handle"),e.k0s()(),e.j41(8,"div",27),e.nrm(9,"img",28),e.k0s(),e.j41(10,"div",29),e.EFF(11),e.k0s(),e.j41(12,"button",30)(13,"app-icon"),e.EFF(14,"more_vert"),e.k0s()(),e.j41(15,"mat-menu",null,0)(17,"button",4),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.editItem(i))}),e.j41(18,"div",5)(19,"app-icon",6),e.EFF(20," edit "),e.k0s(),e.j41(21,"div",7),e.EFF(22,"Edit Media Item"),e.k0s()()(),e.j41(23,"button",4),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.previewItem(i))}),e.j41(24,"div",5)(25,"app-icon",6),e.EFF(26," visibility "),e.k0s(),e.j41(27,"div",7),e.EFF(28," Preview Media Item "),e.k0s()()(),e.j41(29,"button",4),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.removeItem(i))}),e.j41(30,"div",5)(31,"app-icon",8),e.EFF(32," delete "),e.k0s(),e.j41(33,"div",7),e.EFF(34," Remove Media Item "),e.k0s()()()()(),e.bVm()}if(2&a){const t=l.$implicit,n=e.sdS(16),i=e.XpG(2);e.R7$(2),e.vxM(t.valid_from&&i.now<t.valid_from?2:t.valid_until&&i.now>t.valid_until?3:-1),e.R7$(7),e.Y8G("source",t.thumbnail_url),e.R7$(2),e.SpI(" ",t.name," "),e.R7$(),e.Y8G("matMenuTriggerFor",n)}}function ht(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",20),e.nI1(1,"async"),e.bIt("cdkDropListDropped",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.drop(i))}),e.DNE(2,ft,35,4,"ng-container",21),e.nI1(3,"async"),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("cdkDropListData",e.bMT(1,3,t.media))("cdkDropListConnectedTo",t.playlist_ids),e.R7$(2),e.Y8G("ngForOf",e.bMT(3,5,t.media))}}function yt(a,l){1&a&&(e.j41(0,"div",18)(1,"app-icon",33),e.EFF(2,"hide_image"),e.k0s(),e.j41(3,"p"),e.EFF(4,"No media in playlist."),e.k0s()())}let pe=(()=>{class a{get now(){return(0,P._)((0,re.c)(Date.now()))}constructor(t,n){var i=this;this._state=t,this._router=n,this.playlist="",this.playlist_count=0,this.playlist_ids=[],this._playlist=new j.t(""),this.editPlaylist=(0,_.A)(function*(){const o=yield i.selected_playlist.pipe((0,v.s)(1)).toPromise();i._state.editPlaylist(o)}),this.removeItem=function(){var o=(0,_.A)(function*(s){const d=(yield i._playlist_media.pipe((0,v.s)(1)).toPromise()).items.filter(u=>u!==s.id);yield i._state.updatePlaylistMedia(i.playlist,d),i._playlist.next(i.playlist)});return function(s){return o.apply(this,arguments)}}(),this.previewItem=o=>this._state.previewMedia(o),this.editItem=o=>this._state.editMedia(o),this.removePlaylist=(0,_.A)(function*(){return i._state.removePlaylist(yield i.selected_playlist.pipe((0,v.s)(1)).toPromise())}),this.selected_playlist=(0,b.zV)([this._playlist,this._state.playlists]).pipe((0,y.T)(([o,s])=>{const r=s.find(d=>d.id===o);return r||this._router.navigate(["/signage/media",{}]),r})),this._playlist_media=this._playlist.pipe((0,L.p)(o=>!!o),(0,J.B)(300),(0,E.n)(o=>(0,m.$kw)(o).pipe((0,te.W)(()=>(0,ee.of)({id:"",items:[]})))),(0,G.t)(1)),this.media=(0,b.zV)([this._playlist_media,this._state.media]).pipe((0,y.T)(([o,s])=>o.items.map(r=>s.find(d=>d.id===r)).filter(r=>r)),(0,de.Z)([]))}ngOnChanges(t){t.playlist&&this._playlist.next(this.playlist),t.playlist_count&&(this.playlist_ids=new Array(this.playlist_count).fill(0).map((n,i)=>`playlist-${i}`))}animation_name(t){switch(t){case m.fcj.Cut:return"Cut";case m.fcj.CrossFade:return"Cross Fade";case m.fcj.SlideBottom:return"Slide Bottom";case m.fcj.SlideLeft:return"Slide Left";case m.fcj.SlideRight:return"Slide Right";case m.fcj.SlideTop:return"Slide Top"}return"Default"}drop(t){var n=this;return(0,_.A)(function*(){if(t.previousIndex===t.currentIndex)return;const i=yield n._playlist.pipe((0,v.s)(1)).toPromise(),o=yield n._playlist_media.pipe((0,v.s)(1)).toPromise();if(!i&&o)return;const s=[...o.items];(0,F.HD)(s,t.previousIndex,t.currentIndex),yield n._state.updatePlaylistMedia(i,s),n._playlist.next(n.playlist)})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(S),e.rXU(x.Ix))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-playlist-media-list"]],inputs:{playlist:"playlist",playlist_count:"playlist_count"},features:[e.OA$],decls:50,vars:40,consts:[["menu","matMenu"],[1,"flex","flex-col","space-y-4","relative","p-4","h-full","w-full"],[1,"text-xl","font-medium","text-center"],["icon","","matRipple","",1,"absolute","top-2","right-2","!m-0",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"text-2xl"],[1,"pr-2"],[1,"text-2xl","text-error"],["details","",1,"flex","items-center","flex-wrap"],[1,"ml-2","text-xs","px-2","py-1","m-1","rounded"],["class","ml-2 text-xs px-2 py-1 m-1 rounded bg-secondary text-secondary-content",4,"ngIf"],["matTooltip","Default Transition Animation",1,"text-xs","px-2","py-1","m-1"],[1,"ml-1","uppercase","bg-base-200","px-2","py-1","rounded"],["matTooltip","Default Playback Duration",1,"text-xs","px-2","py-1","m-1"],[1,"ml-1","font-mono","bg-base-200","px-2","py-1","rounded"],["matTooltip","Prefered Orientation",1,"text-xs","px-2","py-1","m-1"],["cdkDropList","","id","playlist-list",1,"flex-1","h-1/2","overflow-auto","flex","flex-col","space-y-2",3,"cdkDropListData","cdkDropListConnectedTo"],[1,"flex","flex-col","items-center","justify-center","p-8","space-y-2","opacity-30","mx-auto","flex-1"],[1,"ml-2","text-xs","px-2","py-1","m-1","rounded","bg-secondary","text-secondary-content"],["cdkDropList","","id","playlist-list",1,"flex-1","h-1/2","overflow-auto","flex","flex-col","space-y-2",3,"cdkDropListDropped","cdkDropListData","cdkDropListConnectedTo"],[4,"ngFor","ngForOf"],["cdkDrag","",1,"relative","w-full","bg-base-100","h-20","rounded-lg","flex","items-center","p-2","space-x-2","border","border-base-300"],[1,"absolute","inset-0","z-0","bg-warning","opacity-10","rounded-lg"],[1,"absolute","inset-0","z-0","bg-error","opacity-10","rounded-lg"],["class","min-h-10 min-w-10 border-4 rounded-2xl border-base-400 bg-base-300 border-dashed flex items-center justify-center",4,"cdkDragPlaceholder"],["matRipple","","cdkDragHandle","","matTooltip","Drag to reorder",1,"flex","items-center","justify-center","w-6","h-full","rounded","hover:bg-base-200"],["preview","",1,"w-[4.5rem]","h-16","bg-base-200","rounded-lg","overflow-hidden"],["auth","",1,"w-full","h-full","object-contain",3,"source"],[1,"text-base-content","truncate","flex-1","w-1/2"],["icon","","matRipple","","aria-label","Media Actions",3,"matMenuTriggerFor"],[1,"min-h-10","min-w-10","border-4","rounded-2xl","border-base-400","bg-base-300","border-dashed","flex","items-center","justify-center"],[1,"text-2xl","text-base-100"],[1,"text-6xl"]],template:function(n,i){if(1&n){const o=e.RV6();e.j41(0,"div",1)(1,"h3",2),e.EFF(2),e.nI1(3,"async"),e.k0s(),e.j41(4,"button",3)(5,"app-icon"),e.EFF(6,"more_vert"),e.k0s()(),e.j41(7,"mat-menu",null,0)(9,"button",4),e.bIt("click",function(){return e.eBV(o),e.Njj(i.editPlaylist())}),e.j41(10,"div",5)(11,"app-icon",6),e.EFF(12,"edit"),e.k0s(),e.j41(13,"div",7),e.EFF(14,"Edit Playlist"),e.k0s()()(),e.j41(15,"button",4),e.bIt("click",function(){return e.eBV(o),e.Njj(i.removePlaylist())}),e.j41(16,"div",5)(17,"app-icon",8),e.EFF(18,"delete"),e.k0s(),e.j41(19,"div",7),e.EFF(20,"Remove Playlist"),e.k0s()()()(),e.j41(21,"div",9)(22,"div",10),e.nI1(23,"async"),e.nI1(24,"async"),e.nI1(25,"async"),e.nI1(26,"async"),e.EFF(27),e.nI1(28,"async"),e.k0s(),e.DNE(29,mt,2,0,"div",11),e.nI1(30,"async"),e.j41(31,"div",12),e.EFF(32," Animation: "),e.j41(33,"span",13),e.EFF(34),e.nI1(35,"async"),e.k0s()(),e.j41(36,"div",14),e.EFF(37," Duration: "),e.j41(38,"span",15),e.EFF(39),e.nI1(40,"async"),e.nI1(41,"mediaDuration"),e.k0s()(),e.j41(42,"div",16),e.EFF(43," Orientation: "),e.j41(44,"span",13),e.EFF(45),e.nI1(46,"async"),e.k0s()()(),e.DNE(47,ht,4,7,"div",17),e.nI1(48,"async"),e.DNE(49,yt,5,0,"div",18),e.k0s()}if(2&n){let o,s,r,d,u,f,I,$,R,V;const K=e.sdS(8);e.R7$(2),e.SpI(" Playlist - ",null==(o=e.bMT(3,16,i.selected_playlist))?null:o.name," "),e.R7$(2),e.Y8G("matMenuTriggerFor",K),e.R7$(18),e.AVh("bg-success",null==(s=e.bMT(23,18,i.selected_playlist))?null:s.enabled)("text-success-content",null==(r=e.bMT(24,20,i.selected_playlist))?null:r.enabled)("bg-error",!(null!=(d=e.bMT(25,22,i.selected_playlist))&&d.enabled))("text-error-content",!(null!=(u=e.bMT(26,24,i.selected_playlist))&&u.enabled)),e.R7$(5),e.SpI(" ",null!=(f=e.bMT(28,26,i.selected_playlist))&&f.enabled?"Enabled":"Disabled"," "),e.R7$(2),e.Y8G("ngIf",null==(I=e.bMT(30,28,i.selected_playlist))?null:I.random),e.R7$(5),e.JRh(i.animation_name(null==($=e.bMT(35,30,i.selected_playlist))?null:$.default_animation)),e.R7$(5),e.JRh(e.bMT(41,34,(null==(R=e.bMT(40,32,i.selected_playlist))?null:R.default_duration)/1e3)),e.R7$(6),e.JRh(null==(V=e.bMT(46,36,i.selected_playlist))?null:V.orientation),e.R7$(2),e.vxM(e.bMT(48,38,i.media).length>0?47:49)}},dependencies:[h.Sq,h.bT,w.kk,w.fb,w.Cp,z.oV,k.r6,T.R,X.U,F.O7,F.T1,F.Fb,F.EM,h.Jj,Y.X],styles:["[_nghost-%COMP%]{height:100%}\n\n/*# sourceMappingURL=signage-playlist-media-list.component.ts-angular-inline--196.css.map*/"]})}return a})();const vt=(a,l)=>l.id,me=()=>[],bt=()=>({playlist:""}),xt=a=>({playlist:a}),Ft=()=>["media-list","playlist-list"];function jt(a,l){if(1&a){const t=e.RV6();e.j41(0,"a",13),e.bIt("cdkDropListDropped",function(i){const o=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.selected_playlist===o.id?"":s.drop(o,i))}),e.j41(1,"div",14),e.EFF(2),e.k0s()()}if(2&a){const t=l.$implicit,n=l.$index,i=e.XpG(2);e.AVh("!bg-secondary",i.selected_playlist===t.id)("text-secondary-content",i.selected_playlist===t.id),e.Y8G("routerLink",e.lJ4(9,me))("queryParams",e.eq3(10,xt,t.id))("id","playlist-"+n)("cdkDropListConnectedTo",e.lJ4(12,Ft)),e.R7$(2),e.SpI(" ",t.name," ")}}function kt(a,l){if(1&a&&(e.Z7z(0,jt,3,13,"a",12,vt),e.nI1(2,"async")),2&a){const t=e.XpG();e.Dyx(e.bMT(2,0,t.playlists))}}function Ct(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(t);const i=e.XpG(2);return e.Njj(i.addPlaylist())}),e.j41(1,"div",20)(2,"app-icon",21),e.EFF(3,"add"),e.k0s(),e.j41(4,"span",22),e.EFF(5,"Add Playlist"),e.k0s()()()}}function wt(a,l){if(1&a&&(e.j41(0,"div",15)(1,"app-icon",16),e.EFF(2,"hide_image"),e.k0s(),e.j41(3,"p",17),e.EFF(4),e.k0s()(),e.DNE(5,Ct,6,0,"button",18)),2&a){const t=e.XpG();e.R7$(4),e.SpI(" ",t.search.getValue()?"No matching playlists found":"No playlists"," "),e.R7$(),e.Y8G("ngIf",!t.search.getValue())}}function Tt(a,l){if(1&a&&(e.nrm(0,"signage-media-list",23),e.nI1(1,"async")),2&a){let t;const n=e.XpG();e.Y8G("playlist_count",null==(t=e.bMT(1,1,n.playlists))?null:t.length)}}function Mt(a,l){if(1&a&&(e.nrm(0,"signage-playlist-media-list",24),e.nI1(1,"async")),2&a){let t;const n=e.XpG();e.Y8G("playlist",n.selected_playlist)("playlist_count",null==(t=e.bMT(1,2,n.playlists))?null:t.length)}}function It(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",25),e.bIt("dragleave",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.hideOverlay(i))})("drop",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.previewFile(i))}),e.nrm(1,"div",26),e.j41(2,"div",27)(3,"app-icon",16),e.EFF(4,"cloud_upload"),e.k0s(),e.j41(5,"p"),e.EFF(6,"Drop Media to upload"),e.k0s()(),e.j41(7,"input",28),e.bIt("change",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.previewFile(i))}),e.k0s()()}}let ue=(()=>{class a extends g.Tv{onEnter(t){this.clearTimeout("hide_overlay"),this.show_dropzone=t?.dataTransfer?.types.includes("Files")}hideOverlay(t){this.show_dropzone&&(t.target instanceof HTMLInputElement||t.preventDefault(),this.timeout("hide_overlay",()=>this.show_dropzone=!1))}constructor(t,n,i){var o;super(),o=this,this._state=t,this._router=n,this._route=i,this.search=new j.t(""),this.loading=this._state.loading,this.playlists=(0,b.zV)([this.search,this._state.playlists]).pipe((0,y.T)(([s,r])=>r.filter(d=>d.name.toLowerCase().includes(s.toLowerCase())))),this.selected_playlist="",this.show_dropzone=!1,this.addPlaylist=(0,_.A)(function*(){const s=yield o._state.editPlaylist();s&&o._router.navigate(["/signage/media",{query:{playlist:s.id}}])}),this.previewMedia=s=>this._state.previewMedia(s),this.previewFile=s=>this._state.previewFileFromInput(s,this.selected_playlist)}ngOnInit(){this.subscription("route.params",this._route.queryParamMap.subscribe(t=>{t.has("playlist")&&(this.selected_playlist=t.get("playlist"))}))}drop(t,n){var i=this;return(0,_.A)(function*(){const o=n.previousContainer.data[n.previousIndex],r=[...(yield(0,m.$kw)(t.id).toPromise()).items,o.id];yield i._state.updatePlaylistMedia(t.id,r)})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(S),e.rXU(x.Ix),e.rXU(x.nX))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-media"]],features:[e.Vt3],decls:17,vars:15,consts:[[1,"relative","h-full","w-full","overflow-visible","flex","space-x-4"],["sidebar","",1,"w-64","h-full","flex","flex-col","space-y-4","py-4","overflow-auto"],[1,"text-xl","font-medium","text-center"],["appearance","outline",1,"w-full","no-subscript"],["matInput","","placeholder","Search...",3,"ngModelChange","ngModel"],["matRipple","",1,"w-full","px-6","rounded-3xl","min-h-12","flex","items-center","hover:bg-base-200",3,"routerLink","queryParams"],[1,"w-full"],[1,"relative","flex-1","w-1/2","h-full","overflow-hidden","rounded-lg","border","border-base-300","shadow",3,"dragover","dragenter","drop"],[1,"h-full","w-full","overflow-auto"],[3,"playlist_count",4,"ngIf"],[3,"playlist","playlist_count",4,"ngIf"],["class","absolute inset-0",3,"dragleave","drop",4,"ngIf"],["matRipple","","cdkDropList","",1,"w-full","px-6","rounded-3xl","h-12","min-h-12","flex","items-center","hover:bg-base-200",3,"!bg-secondary","text-secondary-content","routerLink","queryParams","id","cdkDropListConnectedTo"],["matRipple","","cdkDropList","",1,"w-full","px-6","rounded-3xl","h-12","min-h-12","flex","items-center","hover:bg-base-200",3,"cdkDropListDropped","routerLink","queryParams","id","cdkDropListConnectedTo"],[1,"flex-1"],[1,"flex","flex-col","items-center","justify-center","p-8","space-y-2","opacity-30"],[1,"text-6xl"],[1,"text-center"],["btn","","matRipple","","class","inverse",3,"click",4,"ngIf"],["btn","","matRipple","",1,"inverse",3,"click"],[1,"flex","items-center","justify-center","w-full"],[1,"text-2xl"],[1,"ml-2","mr-4"],[3,"playlist_count"],[3,"playlist","playlist_count"],[1,"absolute","inset-0",3,"dragleave","drop"],[1,"absolute","inset-0","bg-base-content","opacity-60"],[1,"absolute","inset-4","border-4","border-dashed","border-base-300","flex","flex-col","items-center","justify-center","rounded-2xl","text-base-100","space-y-4"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"]],template:function(n,i){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"h3",2),e.EFF(3,"Playlists"),e.k0s(),e.j41(4,"mat-form-field",3)(5,"input",4),e.bIt("ngModelChange",function(s){return i.search.next(s)}),e.k0s()(),e.j41(6,"a",5),e.EFF(7," All Media "),e.k0s(),e.nrm(8,"hr",6),e.DNE(9,kt,3,2),e.nI1(10,"async"),e.DNE(11,wt,6,2),e.k0s(),e.j41(12,"div",7),e.bIt("dragover",function(s){return i.onEnter(s)})("dragenter",function(s){return i.onEnter(s)})("drop",function(s){return i.hideOverlay(s)},!1,e.tSv),e.j41(13,"div",8),e.DNE(14,Tt,2,3,"signage-media-list",9)(15,Mt,2,4,"signage-playlist-media-list",10),e.k0s(),e.DNE(16,It,8,0,"div",11),e.k0s()()),2&n){let o;e.R7$(5),e.Y8G("ngModel",i.search.getValue()),e.R7$(),e.AVh("!bg-secondary",!i.selected_playlist)("text-secondary-content",!i.selected_playlist),e.Y8G("routerLink",e.lJ4(13,me))("queryParams",e.lJ4(14,bt)),e.R7$(3),e.vxM((null==(o=e.bMT(10,11,i.playlists))?null:o.length)>0?9:11),e.R7$(5),e.Y8G("ngIf",!i.selected_playlist),e.R7$(),e.Y8G("ngIf",i.selected_playlist),e.R7$(),e.Y8G("ngIf",i.show_dropzone)}},dependencies:[h.bT,c.me,c.BC,c.vS,M.rl,D.fg,k.r6,T.R,x.Wk,F.O7,ce,pe,h.Jj],styles:["[_nghost-%COMP%]{min-height:100%}\n\n/*# sourceMappingURL=signage-media.component.ts-angular-inline--195.css.map*/"]})}return a})();var St=p(46815),_e=p(66e3);const Rt=a=>({item:a});function Et(a,l){1&a&&e.eu8(0)}function Dt(a,l){if(1&a&&e.DNE(0,Et,1,0,"ng-container",11),2&a){const t=e.XpG().$implicit,n=e.XpG();e.Y8G("ngTemplateOutlet",n.result_template)("ngTemplateOutletContext",e.eq3(2,Rt,t))}}function Gt(a,l){if(1&a&&(e.j41(0,"div",10),e.EFF(1),e.k0s()),2&a){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.name||t," ")}}function Pt(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",9),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG();return e.Njj(o.selected.next(i))}),e.DNE(1,Dt,1,4,"ng-container")(2,Gt,2,1,"div",10),e.k0s()}if(2&a){const t=e.XpG();e.R7$(),e.vxM(t.result_template?1:2)}}function $t(a,l){if(1&a){const t=e.RV6();e.j41(0,"button",12),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.close.next())}),e.j41(1,"div",13),e.EFF(2," No items available to select "),e.k0s()()}}let W=(()=>{class a{constructor(){this.item_list=[],this.selected=new e.bkB,this.close=new e.bkB,this.search=new j.t(""),this._items=new j.t([])}ngOnChanges(t){t.item_list&&this._items.next(this.item_list||[])}static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["search-overlay"]],inputs:{item_list:"item_list",result_template:"result_template"},outputs:{selected:"selected",close:"close"},features:[e.OA$],decls:13,vars:2,consts:[[1,"absolute","inset-0","flex","flex-col","p-8","items-center",3,"click","keydown.esc"],[1,"absolute","inset-0","bg-base-content","opacity-70","z-0"],[1,"relative","mb-4","w-[32rem]","max-w-[calc(100%-2rem)]","mx-auto","z-10",3,"click"],["placeholder","Search...",1,"rounded-[4rem]","text-xl","text-base-content","bg-base-100","border","border-base-300","shadow","pl-14","pr-6","py-4","w-full",3,"ngModelChange","ngModel"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-3xl","pointer-events-none"],[1,"overflow-auto","max-h-[65%]","w-[32rem]","max-w-[calc(100%-2rem)]","mx-auto","rounded","z-10",3,"click"],["matRipple","",1,"w-full","text-left"],["matRipple","",1,"w-full","p-4","text-base-100"],["icon","","matRipple","",1,"absolute","top-10","right-8","text-base-100","text-xl","h-12","w-12"],["matRipple","",1,"w-full","text-left",3,"click"],[1,"p-4","w-full","bg-base-100","hover:bg-base-200","border","border-base-300"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["matRipple","",1,"w-full","p-4","text-base-100",3,"click"],[1,"opacity-30"]],template:function(n,i){1&n&&(e.j41(0,"div",0),e.bIt("click",function(){return i.close.next()})("keydown.esc",function(){return i.close.next()},!1,e.tSv),e.nrm(1,"div",1),e.j41(2,"div",2),e.bIt("click",function(s){return s.stopPropagation()}),e.j41(3,"input",3),e.bIt("ngModelChange",function(s){return i.search.next(s)}),e.k0s(),e.j41(4,"app-icon",4),e.EFF(5," search "),e.k0s()(),e.j41(6,"div",5),e.bIt("click",function(s){return s.stopPropagation()}),e.Z7z(7,Pt,3,1,"button",6,e.fX1),e.DNE(9,$t,3,0,"button",7),e.k0s(),e.j41(10,"button",8)(11,"app-icon"),e.EFF(12,"close"),e.k0s()()()),2&n&&(e.R7$(3),e.Y8G("ngModel",i.search.getValue()),e.R7$(4),e.Dyx(i.item_list),e.R7$(2),e.vxM(null!=i.item_list&&i.item_list.length?-1:9))},dependencies:[h.T3,c.me,c.BC,c.vS,k.r6,T.R]})}return a})();const Vt=["*"],Lt=(a,l)=>l.id,Nt=()=>["/signage","media"],Xt=a=>({playlist:a});function zt(a,l){if(1&a&&(e.j41(0,"div",5),e.EFF(1),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.SpI(" ",t.extra," ")}}function Ut(a,l){1&a&&e.nrm(0,"div",21)}function Yt(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",7),e.DNE(1,Ut,1,0,"div",9),e.j41(2,"button",10)(3,"app-icon"),e.EFF(4,"drag_handle"),e.k0s()(),e.j41(5,"div",11)(6,"div",12),e.EFF(7),e.k0s(),e.j41(8,"div",13),e.EFF(9),e.k0s()(),e.j41(10,"button",14)(11,"app-icon"),e.EFF(12,"more_vert"),e.k0s()(),e.j41(13,"mat-menu",null,0)(15,"a",15)(16,"div",16)(17,"app-icon",17),e.EFF(18," visibility "),e.k0s(),e.j41(19,"div",18),e.EFF(20,"View Playlist"),e.k0s()()(),e.j41(21,"button",19),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.remove.next(i))}),e.j41(22,"div",16)(23,"app-icon",20),e.EFF(24," delete "),e.k0s(),e.j41(25,"div",18),e.EFF(26,"Remove Playlist"),e.k0s()()()()()}if(2&a){const t=l.$implicit,n=e.sdS(14);e.R7$(7),e.SpI(" ",t.name," "),e.R7$(2),e.SpI(" ",t.media_count||0," Media items "),e.R7$(),e.Y8G("matMenuTriggerFor",n),e.R7$(5),e.Y8G("routerLink",e.lJ4(5,Nt))("queryParams",e.eq3(6,Xt,t.id))}}function Bt(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",6),e.bIt("cdkDropListDropped",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.ondrop.next(i))}),e.Z7z(1,Yt,27,8,"div",7,Lt),e.nI1(3,"async"),e.k0s(),e.j41(4,"button",8),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.add.emit())}),e.EFF(5,"Add Playlist"),e.k0s()}if(2&a){const t=e.XpG();e.R7$(),e.Dyx(e.bMT(3,0,t.active_playlists))}}function At(a,l){if(1&a){const t=e.RV6();e.j41(0,"div",4)(1,"div",22)(2,"app-icon",23),e.EFF(3,"hide_image"),e.k0s(),e.j41(4,"p"),e.EFF(5),e.k0s()(),e.j41(6,"button",24),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.add.emit())}),e.EFF(7," Add Playlist "),e.k0s()()}if(2&a){const t=e.XpG();e.R7$(5),e.SpI("No playlists in ",t.name,".")}}let Q=(()=>{class a{constructor(t){this._state=t,this.name="zone",this.extra="",this.add=new e.bkB,this.remove=new e.bkB,this.ondrop=new e.bkB,this._playlist_ids=new j.t([]),this.active_playlists=(0,b.zV)([this._state.playlists,this._playlist_ids,this._state.has_changed]).pipe((0,y.T)(([n,i])=>i.map(o=>n.find(s=>s.id===o))),(0,de.Z)([]))}ngOnChanges(t){t.item&&this._playlist_ids.next(this.item?.playlists||[])}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(S))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-item-playlists"]],inputs:{item:"item",name:"name",extra:"extra"},outputs:{add:"add",remove:"remove",ondrop:"ondrop"},features:[e.OA$],ngContentSelectors:Vt,decls:8,vars:5,consts:[["menu","matMenu"],[1,"flex","items-center","justify-center","space-x-2"],[1,"text-xl","font-medium"],["class","px-2 py-1 text-xs font-mono bg-base-200 rounded-lg uppercase",4,"ngIf"],[1,"flex","flex-col","items-center","justify-center","p-8","space-y-2","mx-auto","flex-1"],[1,"px-2","py-1","text-xs","font-mono","bg-base-200","rounded-lg","uppercase"],["cdkDropList","",1,"flex-1","h-1/2","overflow-auto","flex","flex-col","space-y-2","mt-4",3,"cdkDropListDropped"],["cdkDrag","",1,"w-full","bg-base-100","h-20","rounded-lg","flex","items-center","p-2","space-x-2","border","border-base-300"],["btn","","matRipple","",3,"click"],["class","h-20 w-full border-4 border-dashed border-base-400 bg-base-300 rounded-xl",4,"cdkDragPlaceholder"],["matRipple","","cdkDragHandle","","matTooltip","Drag to reorder",1,"flex","items-center","justify-center","w-6","h-full","rounded","hover:bg-base-200"],[1,"text-base-content","flex-1","w-1/2"],[1,"truncate"],[1,"truncate","text-sm","opacity-30"],["icon","","matRipple","","aria-label","Media Actions",3,"matMenuTriggerFor"],["mat-menu-item","",3,"routerLink","queryParams"],[1,"flex","items-center","space-x-2"],[1,"text-2xl"],[1,"pr-2"],["mat-menu-item","",3,"click"],[1,"text-2xl","text-error"],[1,"h-20","w-full","border-4","border-dashed","border-base-400","bg-base-300","rounded-xl"],[1,"flex","flex-col","items-center","justify-center","opacity-30"],[1,"text-6xl"],["btn","","matRipple","",1,"w-40",3,"click"]],template:function(n,i){1&n&&(e.NAR(),e.j41(0,"div",1)(1,"h3",2),e.EFF(2),e.k0s(),e.DNE(3,zt,2,1,"div",3),e.k0s(),e.SdG(4),e.DNE(5,Bt,6,2),e.nI1(6,"async"),e.DNE(7,At,8,1,"div",4)),2&n&&(e.R7$(2),e.SpI(" ",(null==i.item?null:i.item.display_name)||(null==i.item?null:i.item.name)," "),e.R7$(),e.Y8G("ngIf",i.extra),e.R7$(2),e.vxM(e.bMT(6,3,i.active_playlists).length>0&&i.item?5:7))},dependencies:[h.bT,w.kk,w.fb,w.Cp,z.oV,k.r6,T.R,x.Wk,F.O7,F.T1,F.Fb,F.EM,h.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column}\n\n/*# sourceMappingURL=signage-item-playlists.component.ts-angular-inline--197.css.map*/"]})}return a})();var Ot=p(45312);const ge=(a,l)=>l.id,fe=()=>[],Jt=a=>({display:a}),Zt=(a,l)=>({display:a,trigger:l}),Ht=()=>["/signage","zones"],Wt=a=>({zone:a});function Qt(a,l){if(1&a&&(e.j41(0,"div",13)(1,"div",14),e.nrm(2,"div",15),e.k0s(),e.j41(3,"a",16)(4,"span",17),e.EFF(5),e.k0s()()()),2&a){const t=l.$implicit,n=e.XpG(2).$implicit,i=e.XpG(2);e.R7$(3),e.AVh("!bg-secondary",i.selected_trigger.getValue()===(null==t?null:t.id))("text-secondary-content",i.selected_trigger.getValue()===(null==t?null:t.id)),e.Y8G("routerLink",e.lJ4(7,fe))("queryParams",e.l_i(8,Zt,n.id,null==t?null:t.id)),e.R7$(2),e.JRh((null==t?null:t.display_name)||(null==t?null:t.name)||"Trigger")}}function Kt(a,l){if(1&a&&(e.Z7z(0,Qt,6,11,"div",13,ge),e.nI1(2,"async")),2&a){const t=e.XpG(3);e.Dyx(e.bMT(2,0,t.triggers))}}function qt(a,l){if(1&a&&(e.j41(0,"a",12),e.EFF(1),e.k0s(),e.DNE(2,Kt,3,2),e.nI1(3,"async")),2&a){let t;const n=l.$implicit,i=e.XpG(2);e.AVh("!bg-secondary",i.selected.getValue()===n.id)("text-secondary-content",i.selected.getValue()===n.id),e.Y8G("routerLink",e.lJ4(10,fe))("queryParams",e.eq3(11,Jt,n.id)),e.R7$(),e.SpI(" ",n.display_name||n.name," "),e.R7$(),e.vxM((null==(t=e.bMT(3,8,i.active_display))?null:t.id)!==n.id||i.switching?-1:2)}}function ei(a,l){if(1&a&&(e.j41(0,"div",6),e.Z7z(1,qt,4,13,null,null,ge),e.nI1(3,"async"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.Dyx(e.bMT(3,0,t.displays))}}function ti(a,l){if(1&a&&(e.j41(0,"div",7)(1,"app-icon",18),e.EFF(2,"hide_image"),e.k0s(),e.j41(3,"p",19),e.EFF(4),e.k0s()()),2&a){const t=e.XpG();e.R7$(4),e.SpI(" ",t.search.getValue()?"No matching displays found":"No displays"," ")}}function ii(a,l){if(1&a&&(e.j41(0,"a",30),e.EFF(1),e.nI1(2,"zone"),e.nI1(3,"async"),e.nI1(4,"zone"),e.nI1(5,"async"),e.k0s()),2&a){let t;const n=l.$implicit;e.Y8G("routerLink",e.lJ4(11,Ht))("queryParams",e.eq3(12,Wt,n)),e.R7$(),e.SpI(" ",(null==(t=e.bMT(3,5,e.bMT(2,3,n)))?null:t.display_name)||(null==(t=e.bMT(5,9,e.bMT(4,7,n)))?null:t.name)," ")}}function ni(a,l){if(1&a&&(e.j41(0,"div",29),e.Z7z(1,ii,6,14,"a",30,e.fX1),e.nI1(3,"async"),e.j41(4,"button",31),e.EFF(5," Add Zone "),e.k0s()()),2&a){let t;const n=e.XpG(2);e.R7$(),e.Dyx(null==(t=e.bMT(3,0,n.active_display))?null:t.zones)}}function ai(a,l){if(1&a){const t=e.RV6();e.j41(0,"signage-item-playlists",20),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.nI1(4,"async"),e.nI1(5,"async"),e.bIt("add",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.adding=!0)})("remove",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.removePlaylist(i))})("ondrop",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.drop(i))}),e.DNE(6,ni,6,2,"div",21),e.nI1(7,"async"),e.j41(8,"button",22)(9,"app-icon"),e.EFF(10,"more_vert"),e.k0s()(),e.j41(11,"mat-menu",null,0)(13,"a",23),e.nI1(14,"async"),e.j41(15,"div",24)(16,"app-icon",25),e.EFF(17,"open_in_new"),e.k0s(),e.j41(18,"div",26),e.EFF(19,"Open Signage Player"),e.k0s()()(),e.j41(20,"button",27),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.removeDisplay())}),e.j41(21,"div",24)(22,"app-icon",28),e.EFF(23,"delete"),e.k0s(),e.j41(24,"div",26),e.EFF(25,"Remove Display"),e.k0s()()()()()}if(2&a){let t,n;const i=e.sdS(12),o=e.XpG();e.Y8G("item",e.bMT(1,6,o.active_trigger)||e.bMT(2,8,o.active_display))("name",e.bMT(3,10,o.active_trigger)?"trigger":"display")("extra",e.bMT(4,12,o.active_trigger)?"":null==(t=e.bMT(5,14,o.active_display))?null:t.orientation),e.R7$(6),e.Y8G("ngIf",!e.bMT(7,16,o.active_trigger)),e.R7$(2),e.Y8G("matMenuTriggerFor",i),e.R7$(5),e.Y8G("href",o.signage_path+"/#/signage/"+(null==(n=e.bMT(14,18,o.active_display))?null:n.id),e.B4B)}}function oi(a,l){1&a&&(e.j41(0,"div",10)(1,"app-icon",18),e.EFF(2,"desktop_windows"),e.k0s(),e.j41(3,"p"),e.EFF(4,"Select a display from the left to view playlists"),e.k0s()())}function si(a,l){if(1&a){const t=e.RV6();e.j41(0,"search-overlay",32),e.nI1(1,"async"),e.bIt("selected",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.addPlaylist(i))})("close",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.adding=!1)}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("item_list",e.bMT(1,1,t.playlists))}}let he=(()=>{class a extends g.Tv{get signage_path(){return this._settings.get("app.signage_path")||"/signage"}constructor(t,n,i){var o;super(),o=this,this._state=t,this._route=n,this._settings=i,this.adding=!1,this.switching=!1,this.search=new j.t(""),this.loading=this._state.loading,this.displays=(0,b.zV)([this.search,this._state.displays]).pipe((0,y.T)(([s,r])=>r.filter(d=>d.name.toLowerCase().includes(s.toLowerCase())))),this.selected=new j.t(""),this.selected_trigger=new j.t(""),this.active_display=(0,b.zV)([this.displays,this.selected]).pipe((0,y.T)(([s,r])=>s.find(d=>d.id===r))),this.triggers=this.selected.pipe((0,E.n)(s=>(0,m.xW)(s)),(0,y.T)(s=>s.data),(0,_e.M)(s=>setTimeout(()=>this.switching=!1,200)),(0,G.t)(1)),this.active_trigger=(0,b.zV)([this.triggers,this.selected_trigger,this.selected]).pipe((0,y.T)(([s,r,d])=>s.find(u=>u.id===r&&u.control_system_id===d))),this.playlists=(0,b.zV)([this.active_display,this.active_trigger,this._state.playlists,this._state.has_changed]).pipe((0,y.T)(([s,r,d])=>d.filter(u=>!(r||s)?.playlists.find(f=>u.id===f)))),this.removeDisplay=(0,_.A)(function*(){return o._state.removeDisplay(yield o.active_display.pipe((0,v.s)(1)).toPromise())})}ngOnInit(){this.subscription("route.params",this._route.queryParamMap.subscribe(t=>{this.switching=t.get("display")!==this.selected.getValue(),this.selected.next(t.get("display")||""),this.selected_trigger.next(t.get("trigger")||"")}))}addPlaylist(t){var n=this;return(0,_.A)(function*(){const i=yield n.active_display.pipe((0,v.s)(1)).toPromise(),o=yield n.active_trigger.pipe((0,v.s)(1)).toPromise(),s=o||i,r=[...s.playlists,t.id];yield(o?m.Yjp:m.Pny)(s.id,{playlists:r,version:i.version},"patch").toPromise(),(0,g.VX)("Successfully added playlist to the "+(o?"trigger":"display")),n._state.changed(),n.adding=!1})()}removePlaylist(t){var n=this;return(0,_.A)(function*(){const i=yield n.active_display.pipe((0,v.s)(1)).toPromise(),o=yield n.active_trigger.pipe((0,v.s)(1)).toPromise(),s=o||i,r=s.playlists.filter(u=>t.id!==u);yield(o?m.Yjp:m.Pny)(s.id,{playlists:r,version:i.version},"patch").toPromise(),(0,g.VX)("Successfully removed playlist from "+(o?"trigger":"display")),n._state.changed(),n.adding=!1})()}drop(t){var n=this;return(0,_.A)(function*(){const i=yield n.active_display.pipe((0,v.s)(1)).toPromise(),o=yield n.active_trigger.pipe((0,v.s)(1)).toPromise(),s=o||i,r=s.playlists,d=[...r];(0,F.HD)(d,t.previousIndex,t.currentIndex),s.playlists=d,n._state.changed(),yield(o?m.Yjp:m.Pny)(s.id,{playlists:d,version:i.version},"patch").toPromise().catch(f=>{throw s.playlists=r,n._state.changed(),f}),(0,g.VX)("Successfully re-ordered playlists on "+(o?"trigger":"display")),n._state.changed()})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(S),e.rXU(x.nX),e.rXU(g.h$))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-displays"]],features:[e.Vt3],decls:14,vars:8,consts:[["menu","matMenu"],[1,"relative","h-full","w-full","overflow-visible","flex","space-x-4"],["sidebar","",1,"w-64","h-full","flex","flex-col","space-y-4","py-4"],[1,"text-xl","font-medium","text-center"],["appearance","outline",1,"w-full","no-subscript"],["matInput","","placeholder","Search...",3,"ngModelChange","ngModel"],[1,"h-1/2","flex-1","w-full","overflow-auto","space-y-2"],[1,"flex","flex-col","items-center","justify-center","p-8","space-y-2","opacity-30"],[1,"relative","flex","flex-col","flex-1","w-1/2","h-full","overflow-auto","rounded-lg","border","border-base-300","p-4","shadow","space-y-4"],[1,"flex","flex-col","flex-1",3,"item","name","extra"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2","opacity-30"],[3,"item_list","selected","close",4,"ngIf"],["matRipple","",1,"w-full","px-6","rounded-3xl","min-h-12","flex","items-center","hover:bg-base-200","truncate","z-10",3,"routerLink","queryParams"],[1,"relative","flex","items-center","space-x-2","z-0"],[1,"w-6"],[1,"absolute","h-16","w-4","border-b-2","border-l-2","border-base-300","top-1/2","left-6","-translate-y-full"],["matRipple","",1,"w-1/2","flex-1","px-6","rounded-3xl","min-h-12","flex","items-center","hover:bg-base-200","truncate",3,"routerLink","queryParams"],[1,"max-w-full","truncate"],[1,"text-6xl"],[1,"text-center"],[1,"flex","flex-col","flex-1",3,"add","remove","ondrop","item","name","extra"],["class","flex flex-wrap items-center overflow-auto mt-4",4,"ngIf"],["icon","","matRipple","",1,"absolute","top-2","right-2","!m-0",3,"matMenuTriggerFor"],["mat-menu-item","","target","_blank","ref","noopener noreferrer",3,"href"],[1,"flex","items-center","space-x-2"],[1,"text-2xl"],[1,"pr-2"],["mat-menu-item","",3,"click"],[1,"text-2xl","text-error"],[1,"flex","flex-wrap","items-center","overflow-auto","mt-4"],["matRipple","",1,"px-2","py-1","font-mono","text-xs","bg-base-200","rounded","whitespace-nowrap","m-1",3,"routerLink","queryParams"],["matRipple","",1,"underline","font-mono","text-xs","px-2","py-1","rounded","m-1"],[3,"selected","close","item_list"]],template:function(n,i){if(1&n&&(e.j41(0,"div",1)(1,"div",2)(2,"h3",3),e.EFF(3,"Displays"),e.k0s(),e.j41(4,"mat-form-field",4)(5,"input",5),e.bIt("ngModelChange",function(s){return i.search.next(s)}),e.k0s()(),e.DNE(6,ei,4,2,"div",6),e.nI1(7,"async"),e.DNE(8,ti,5,1,"div",7),e.k0s(),e.j41(9,"div",8),e.DNE(10,ai,26,20,"signage-item-playlists",9),e.nI1(11,"async"),e.DNE(12,oi,5,0,"div",10)(13,si,2,3,"search-overlay",11),e.k0s()()),2&n){let o;e.R7$(5),e.Y8G("ngModel",i.search.getValue()),e.R7$(),e.vxM((null==(o=e.bMT(7,4,i.displays))?null:o.length)>0?6:8),e.R7$(4),e.vxM(e.bMT(11,6,i.active_display)?10:12),e.R7$(3),e.Y8G("ngIf",i.adding)}},dependencies:[h.bT,c.me,c.BC,c.vS,M.rl,D.fg,w.kk,w.fb,w.Cp,k.r6,T.R,x.Wk,W,Q,h.Jj,Ot.l]})}return a})();const ye=(a,l)=>l.id,ve=()=>[],li=a=>({zone:a}),ri=(a,l)=>({zone:a,trigger:l});function ci(a,l){if(1&a&&(e.j41(0,"div",12)(1,"div",13),e.nrm(2,"div",14),e.k0s(),e.j41(3,"a",15),e.EFF(4),e.k0s()()),2&a){const t=l.$implicit,n=e.XpG(2).$implicit,i=e.XpG(2);e.R7$(3),e.AVh("!bg-secondary",i.selected_trigger.getValue()===(null==t?null:t.id))("text-secondary-content",i.selected_trigger.getValue()===(null==t?null:t.id)),e.Y8G("routerLink",e.lJ4(7,ve))("queryParams",e.l_i(8,ri,n.id,null==t?null:t.id)),e.R7$(),e.SpI(" ",(null==t?null:t.display_name)||(null==t?null:t.name)||"Trigger"," ")}}function di(a,l){if(1&a&&(e.Z7z(0,ci,5,11,"div",12,ye),e.nI1(2,"async")),2&a){const t=e.XpG(3);e.Dyx(e.bMT(2,0,t.triggers))}}function pi(a,l){if(1&a&&(e.j41(0,"a",11),e.EFF(1),e.k0s(),e.DNE(2,di,3,2),e.nI1(3,"async")),2&a){let t;const n=l.$implicit,i=e.XpG(2);e.AVh("!bg-secondary",i.selected.getValue()===n.id)("text-secondary-content",i.selected.getValue()===n.id),e.Y8G("routerLink",e.lJ4(10,ve))("queryParams",e.eq3(11,li,n.id)),e.R7$(),e.SpI(" ",n.display_name||n.name," "),e.R7$(),e.vxM((null==(t=e.bMT(3,8,i.active_zone))?null:t.id)!==n.id||i.switching?-1:2)}}function mi(a,l){if(1&a&&(e.j41(0,"div",5),e.Z7z(1,pi,4,13,null,null,ye),e.nI1(3,"async"),e.k0s()),2&a){const t=e.XpG();e.R7$(),e.Dyx(e.bMT(3,0,t.zones))}}function ui(a,l){if(1&a&&(e.j41(0,"div",6)(1,"app-icon",16),e.EFF(2,"hide_image"),e.k0s(),e.j41(3,"p",17),e.EFF(4),e.k0s()()),2&a){const t=e.XpG();e.R7$(4),e.SpI(" ",t.search.getValue()?"No matching zones found":"No zones"," ")}}function _i(a,l){if(1&a){const t=e.RV6();e.j41(0,"signage-item-playlists",18),e.nI1(1,"async"),e.nI1(2,"async"),e.nI1(3,"async"),e.bIt("add",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.adding=!0)})("remove",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.removePlaylist(i))})("ondrop",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.drop(i))}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("item",e.bMT(1,2,t.active_trigger)||e.bMT(2,4,t.active_zone))("name",e.bMT(3,6,t.active_trigger)?"trigger":"zone")}}function gi(a,l){1&a&&(e.j41(0,"div",9)(1,"app-icon",16),e.EFF(2,"desktop_windows"),e.k0s(),e.j41(3,"p"),e.EFF(4,"Select a zone from the left to view playlists"),e.k0s()())}function fi(a,l){if(1&a){const t=e.RV6();e.j41(0,"search-overlay",19),e.nI1(1,"async"),e.bIt("selected",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.addPlaylist(i))})("close",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.adding=!1)}),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("item_list",e.bMT(1,1,t.playlists))}}let be=(()=>{class a extends g.Tv{constructor(t,n){super(),this._state=t,this._route=n,this.adding=!1,this.switching=!1,this.search=new j.t(""),this.loading=this._state.loading,this.zones=(0,b.zV)([this.search,this._state.zones]).pipe((0,y.T)(([i,o])=>o.filter(s=>s.name.toLowerCase().includes(i.toLowerCase())))),this.selected=new j.t(""),this.selected_trigger=new j.t(""),this.active_zone=(0,b.zV)([this.zones,this.selected]).pipe((0,y.T)(([i,o])=>i.find(s=>s.id===o))),this.triggers=this.selected.pipe((0,E.n)(i=>(0,m.cgk)(i)),(0,y.T)(i=>i.data),(0,_e.M)(i=>setTimeout(()=>this.switching=!1,100)),(0,G.t)(1)),this.active_trigger=(0,b.zV)([this.triggers,this.selected_trigger]).pipe((0,y.T)(([i,o])=>i.find(s=>s.id===o))),this.playlists=(0,b.zV)([this.active_zone,this.active_trigger,this._state.playlists,this._state.has_changed]).pipe((0,y.T)(([i,o,s])=>s.filter(r=>!(o||i)?.playlists.find(d=>r.id===d))))}ngOnInit(){this.subscription("route.params",this._route.queryParamMap.subscribe(t=>{this.switching=t.get("zone")!==this.selected.getValue(),this.selected.next(t.get("zone")||""),this.selected_trigger.next(t.get("trigger")||"")}))}addPlaylist(t){var n=this;return(0,_.A)(function*(){const i=yield n.active_zone.pipe((0,v.s)(1)).toPromise(),o=yield n.active_trigger.pipe((0,v.s)(1)).toPromise(),s=o||i,r=[...s.playlists,t.id];yield(o?m.Yjp:m.G5B)(s.id,{playlists:r,version:i.version},"patch").toPromise(),(0,g.VX)("Successfully added playlist to the "+(o?"trigger":"zone")),n._state.changed(),n.adding=!1})()}removePlaylist(t){var n=this;return(0,_.A)(function*(){const i=yield n.active_zone.pipe((0,v.s)(1)).toPromise(),o=yield n.active_trigger.pipe((0,v.s)(1)).toPromise(),s=o||i,r=s.filter(u=>t.id!==u);yield(o?m.Yjp:m.G5B)(s.id,{playlists:r,version:i.version},"patch").toPromise(),(0,g.VX)("Successfully removed playlist from "+(o?"trigger":"zone")),n._state.changed(),n.adding=!1})()}drop(t){var n=this;return(0,_.A)(function*(){const i=yield n.active_zone.pipe((0,v.s)(1)).toPromise(),o=yield n.active_trigger.pipe((0,v.s)(1)).toPromise(),s=o||i,r=s.playlists,d=[...r];(0,F.HD)(d,t.previousIndex,t.currentIndex),s.playlists=d,n._state.changed(),yield(o?m.Yjp:m.G5B)(s.id,{playlists:d,version:i.version},"patch").toPromise().catch(f=>{throw s.playlists=r,n._state.changed(),f}),(0,g.VX)("Successfully re-ordered playlists on "+(o?"trigger":"zone")),n._state.changed()})()}static#e=this.\u0275fac=function(n){return new(n||a)(e.rXU(S),e.rXU(x.nX))};static#t=this.\u0275cmp=e.VBU({type:a,selectors:[["signage-zones"]],features:[e.Vt3],decls:14,vars:8,consts:[[1,"relative","h-full","w-full","overflow-visible","flex","space-x-4"],["sidebar","",1,"w-64","h-full","flex","flex-col","space-y-4","py-4"],[1,"text-xl","font-medium","text-center"],["appearance","outline",1,"w-full","no-subscript"],["matInput","","placeholder","Search...",3,"ngModelChange","ngModel"],[1,"h-1/2","flex-1","w-full","overflow-auto","space-y-2"],[1,"flex","flex-col","items-center","justify-center","p-8","space-y-2","opacity-30"],[1,"relative","flex","flex-col","flex-1","w-1/2","h-full","overflow-auto","rounded-lg","border","border-base-300","p-4","shadow","space-y-4"],[1,"flex","flex-col","flex-1",3,"item","name"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2","opacity-30"],[3,"item_list","selected","close",4,"ngIf"],["matRipple","",1,"w-full","px-6","rounded-3xl","min-h-12","flex","items-center","hover:bg-base-200","truncate","z-10",3,"routerLink","queryParams"],[1,"relative","flex","items-center","space-x-2","z-0"],[1,"w-6"],[1,"absolute","h-16","w-4","border-b-2","border-l-2","border-base-300","top-1/2","left-6","-translate-y-full"],["matRipple","",1,"w-full","px-6","rounded-3xl","min-h-12","flex","items-center","hover:bg-base-200","truncate",3,"routerLink","queryParams"],[1,"text-6xl"],[1,"text-center"],[1,"flex","flex-col","flex-1",3,"add","remove","ondrop","item","name"],[3,"selected","close","item_list"]],template:function(n,i){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"h3",2),e.EFF(3,"Zones"),e.k0s(),e.j41(4,"mat-form-field",3)(5,"input",4),e.bIt("ngModelChange",function(s){return i.search.next(s)}),e.k0s()(),e.DNE(6,mi,4,2,"div",5),e.nI1(7,"async"),e.DNE(8,ui,5,1,"div",6),e.k0s(),e.j41(9,"div",7),e.DNE(10,_i,4,8,"signage-item-playlists",8),e.nI1(11,"async"),e.DNE(12,gi,5,0,"div",9)(13,fi,2,3,"search-overlay",10),e.k0s()()),2&n){let o;e.R7$(5),e.Y8G("ngModel",i.search.getValue()),e.R7$(),e.vxM((null==(o=e.bMT(7,4,i.zones))?null:o.length)>0?6:8),e.R7$(4),e.vxM(e.bMT(11,6,i.active_zone)?10:12),e.R7$(3),e.Y8G("ngIf",i.adding)}},dependencies:[h.bT,c.me,c.BC,c.vS,M.rl,D.fg,k.r6,T.R,x.Wk,W,Q,h.Jj]})}return a})();const hi=[{path:"",component:le,children:[{path:"",redirectTo:"media",pathMatch:"full"},{path:"media",component:ue},{path:"displays",component:he},{path:"zones",component:be},{path:"*",redirectTo:"media",pathMatch:"full"}]}],yi=[le,it,ue,oe,Z,ae,ce,pe,he,se,be,W,Q];let vi=(()=>{class a{static#e=this.\u0275fac=function(n){return new(n||a)};static#t=this.\u0275mod=e.$C({type:a});static#i=this.\u0275inj=e.G2t({imports:[h.MD,c.YN,je.r,St.hI,x.iI.forChild(hi),B.RI,F.ad]})}return a})()}}]);
//# sourceMappingURL=apps_concierge_src_app_signage_signage_module_ts.js.map