"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_signage_signage_module_ts"],{2873:(at,j,r)=>{r.r(j),r.d(j,{COMPONENTS:()=>it,SignageModule:()=>nt});var d=r(6575),m=r(8849),y=r(2649),X=r(7910),v=r(1670),B=r(5985),u=r(7109),L=r(3121),Z=r(7298),A=r(462),_=r(8159),S=r(9681),U=r(5046),P=r(6520),O=r(8175),f=r(7422),ee=r(680),k=r(6939),te=r(4727),ie=r(8257);class ne{constructor(o={}){this.id=o.id||"",this.name=o.name||"",this.description=o.description||"",this.media=o.media||[],this.media_durations=o.media_durations||{}}}class ae{constructor(o={}){this.id=o.id||"",this.name=o.name||"",this.description=o.description||"",this.playlists=o.playlists||[]}}class se{constructor(o={}){this.id=o.id||"",this.name=o.name||"",this.description=o.description||"",this.type=o.type||"image",this.duration=o.duration||15,this.url=o.url||""}}var b=r(7401),e=r(9039),T=r(257),C=r(4888);function oe(n,o){if(1&n&&e._UZ(0,"img",8),2&n){const t=e.oxw();e.Q6J("src",t.resource.toString(),e.LSH)}}function le(n,o){if(1&n&&e._UZ(0,"video",9),2&n){const t=e.oxw();e.Q6J("src",t.resource.toString(),e.LSH)}}function re(n,o){1&n&&(e.TgZ(0,"footer",10)(1,"button",11),e._uU(2,"Save Media"),e.qZA()())}let J=(()=>{class n{constructor(t){this._data=t,this.resource=this._data.url,this.type=this._data.type,this.name=this._data.name,this.can_save=!1!==this._data.save}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(b.WI))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["signage-media-preview-modal"]],decls:11,vars:4,consts:[[1,"flex","items-center","justify-between","p-2","border-b","border-base-300"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close",""],[1,"bg-base-200"],[1,"max-w-[80vw]","max-h-[65vh]","w-[80vw]","h-[65vh]","flex","items-center","justify-center"],["class","max-w-full max-h-full",3,"src",4,"ngIf"],["class","max-w-full max-h-full","autoplay","","controls","",3,"src",4,"ngIf"],["class","p-2 flex items-center justify-end space-x-2 border-t border-base-300",4,"ngIf"],[1,"max-w-full","max-h-full",3,"src"],["autoplay","","controls","",1,"max-w-full","max-h-full",3,"src"],[1,"p-2","flex","items-center","justify-end","space-x-2","border-t","border-base-300"],["btn","","matRipple","",1,"w-32"]],template:function(i,a){1&i&&(e.TgZ(0,"header",0)(1,"h1",1),e._uU(2),e.qZA(),e.TgZ(3,"button",2)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.TgZ(6,"main",3)(7,"div",4),e.YNc(8,oe,1,1,"img",5)(9,le,1,1,"video",6),e.qZA()(),e.YNc(10,re,3,0,"footer",7)),2&i&&(e.xp6(2),e.hij("Preview - ",a.name,""),e.xp6(6),e.Q6J("ngIf","image"===a.type),e.xp6(1),e.Q6J("ngIf","video"===a.type),e.xp6(1),e.Q6J("ngIf",a.can_save))},dependencies:[d.O5,b.ZT,T.wG,C.o]})}return n})();var F=r(1062),R=r(1268),ce=r(9674),de=r(162),Q=r(8128),pe=r(702),z=r(3910),q=r(7442),I=r(1537);const me=["search_input"];function ue(n,o){1&n&&(e.TgZ(0,"button",8)(1,"app-icon"),e._uU(2,"close"),e.qZA()())}function ge(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",26),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw(2);return e.KtG(l.addMedia(s))}),e.TgZ(1,"div",27)(2,"div",28),e._uU(3),e.qZA(),e.TgZ(4,"code",29),e._uU(5),e.qZA(),e.TgZ(6,"code",30),e._uU(7),e.ALo(8,"mediaDuration"),e.qZA()()()}if(2&n){const t=o.$implicit;e.xp6(3),e.Oqu(t.name),e.xp6(2),e.Oqu(t.type),e.xp6(2),e.Oqu(e.lcZ(8,3,t.duration))}}const _e=()=>["_index","name","type","duration","actions"],fe=()=>[" ","Name","Type","Duration"," "],he=()=>["3r","flex","10r","6r","10r"],xe=(n,o)=>({duration:n,actions:o}),Y=()=>({standalone:!0});function ye(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"main",9)(1,"label",10),e._uU(2,"Name"),e.TgZ(3,"span",11),e._uU(4,"*"),e.qZA()(),e.TgZ(5,"mat-form-field",12),e._UZ(6,"input",13),e.qZA(),e.TgZ(7,"label",14),e._uU(8,"Description"),e.qZA(),e.TgZ(9,"mat-form-field",12),e._UZ(10,"textarea",15),e.qZA(),e.TgZ(11,"label",16),e._uU(12,"Media"),e.qZA(),e._UZ(13,"custom-table",17),e.TgZ(14,"button",18),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.focusSearchInput())}),e._uU(15," Add Media "),e.qZA(),e.TgZ(16,"mat-menu",19,20)(18,"mat-form-field",21)(19,"app-icon",22),e._uU(20," search "),e.qZA(),e.TgZ(21,"input",23,24),e.NdJ("ngModelChange",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.search.next(a))}),e.qZA()(),e.YNc(23,ge,9,5,"button",25),e.ALo(24,"slice"),e.ALo(25,"async"),e.qZA()()}if(2&n){const t=e.MAs(17),i=e.oxw(),a=e.MAs(7),s=e.MAs(9);e.Q6J("formGroup",i.form),e.xp6(13),e.Q6J("dataSource",i.media_list)("columns",e.DdM(16,_e))("display_column",e.DdM(17,fe))("column_size",e.DdM(18,he))("template",e.WLB(19,xe,a,s)),e.xp6(1),e.Q6J("matMenuTriggerFor",t),e.xp6(7),e.Q6J("ngModel",i.search.getValue())("ngModelOptions",e.DdM(22,Y)),e.xp6(2),e.Q6J("ngForOf",e.Dn7(24,10,e.lcZ(25,14,i.new_media),0,8))}}function ve(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"footer",31)(1,"button",32),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.savePlaylist())}),e._uU(2," Save Playlist "),e.qZA()()}}function Ze(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",33)(1,"code"),e._uU(2),e.ALo(3,"mediaDuration"),e.qZA()(),e.TgZ(4,"mat-menu",34,35)(6,"mat-form-field",21)(7,"mat-select",36),e.NdJ("ngModelChange",function(a){const l=e.CHM(t).row,c=e.oxw();return e.KtG(c.setDuration(l.id,a))}),e.TgZ(8,"mat-option",37),e._uU(9,"Use Media Default"),e.qZA(),e.TgZ(10,"mat-option",37),e._uU(11,"5 seconds"),e.qZA(),e.TgZ(12,"mat-option",37),e._uU(13,"10 seconds"),e.qZA(),e.TgZ(14,"mat-option",37),e._uU(15,"15 seconds"),e.qZA(),e.TgZ(16,"mat-option",37),e._uU(17,"30 seconds"),e.qZA(),e.TgZ(18,"mat-option",37),e._uU(19,"45 seconds"),e.qZA(),e.TgZ(20,"mat-option",37),e._uU(21,"1 minute"),e.qZA(),e.TgZ(22,"mat-option",37),e._uU(23,"1 minute 15 seconds"),e.qZA(),e.TgZ(24,"mat-option",37),e._uU(25,"1 minute 30 seconds"),e.qZA(),e.TgZ(26,"mat-option",37),e._uU(27,"1 minute 45 seconds"),e.qZA(),e.TgZ(28,"mat-option",37),e._uU(29,"2 minute"),e.qZA(),e.TgZ(30,"mat-option",37),e._uU(31,"2 minute 15 seconds"),e.qZA(),e.TgZ(32,"mat-option",37),e._uU(33,"2 minute 30 seconds"),e.qZA(),e.TgZ(34,"mat-option",37),e._uU(35,"2 minute 45 seconds"),e.qZA(),e.TgZ(36,"mat-option",37),e._uU(37,"3 minute"),e.qZA(),e.TgZ(38,"mat-option",37),e._uU(39,"3 minute 15 seconds"),e.qZA(),e.TgZ(40,"mat-option",37),e._uU(41,"3 minute 30 seconds"),e.qZA(),e.TgZ(42,"mat-option",37),e._uU(43,"3 minute 45 seconds"),e.qZA(),e.TgZ(44,"mat-option",37),e._uU(45,"4 minute"),e.qZA(),e.TgZ(46,"mat-option",37),e._uU(47,"4 minute 15 seconds"),e.qZA(),e.TgZ(48,"mat-option",37),e._uU(49,"4 minute 30 seconds"),e.qZA(),e.TgZ(50,"mat-option",37),e._uU(51,"4 minute 45 seconds"),e.qZA(),e.TgZ(52,"mat-option",37),e._uU(53,"5 minute"),e.qZA()()()()}if(2&n){const t=o.row,i=e.MAs(5),a=e.oxw();e.ekj("pointer-events-none","image"!==t.type),e.Q6J("matMenuTriggerFor",i),e.xp6(1),e.ekj("bg-warning",a.form.value.media_durations[t.id])("text-warning-content",a.form.value.media_durations[t.id]),e.xp6(1),e.hij(" ",e.lcZ(3,33,a.form.value.media_durations[t.id]||t.duration)," "),e.xp6(5),e.Q6J("ngModel",a.form.value.media_durations[t.id]||0)("ngModelOptions",e.DdM(35,Y)),e.xp6(1),e.Q6J("value",0),e.xp6(2),e.Q6J("value",5),e.xp6(2),e.Q6J("value",10),e.xp6(2),e.Q6J("value",15),e.xp6(2),e.Q6J("value",30),e.xp6(2),e.Q6J("value",45),e.xp6(2),e.Q6J("value",60),e.xp6(2),e.Q6J("value",75),e.xp6(2),e.Q6J("value",90),e.xp6(2),e.Q6J("value",105),e.xp6(2),e.Q6J("value",120),e.xp6(2),e.Q6J("value",135),e.xp6(2),e.Q6J("value",150),e.xp6(2),e.Q6J("value",165),e.xp6(2),e.Q6J("value",180),e.xp6(2),e.Q6J("value",195),e.xp6(2),e.Q6J("value",210),e.xp6(2),e.Q6J("value",225),e.xp6(2),e.Q6J("value",240),e.xp6(2),e.Q6J("value",255),e.xp6(2),e.Q6J("value",270),e.xp6(2),e.Q6J("value",285),e.xp6(2),e.Q6J("value",300)}}function be(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",38)(1,"button",39),e.NdJ("click",function(){const s=e.CHM(t).row,l=e.oxw();return e.KtG(l.changeOrder(s,-1))}),e.TgZ(2,"app-icon"),e._uU(3,"arrow_upward"),e.qZA()(),e.TgZ(4,"button",40),e.NdJ("click",function(){const s=e.CHM(t).row,l=e.oxw();return e.KtG(l.changeOrder(s,1))}),e.TgZ(5,"app-icon"),e._uU(6,"arrow_downward"),e.qZA()(),e.TgZ(7,"button",41),e.NdJ("click",function(){const s=e.CHM(t).row,l=e.oxw();return e.KtG(l.previewMedia(s))}),e.TgZ(8,"app-icon"),e._uU(9,"visibility"),e.qZA()(),e.TgZ(10,"button",42),e.NdJ("click",function(){const s=e.CHM(t).row,l=e.oxw();return e.KtG(l.removeMedia(s))}),e.TgZ(11,"app-icon"),e._uU(12,"delete"),e.qZA()()()}if(2&n){const t=o.first,i=o.last;e.xp6(1),e.Q6J("disabled",t),e.xp6(3),e.Q6J("disabled",i)}}function Te(n,o){1&n&&(e.TgZ(0,"main",43),e._UZ(1,"mat-spinner",44),e.TgZ(2,"p",45),e._uU(3,"Saving Playlist..."),e.qZA()()),2&n&&(e.xp6(1),e.Q6J("diameter",32))}let N=(()=>{class n{constructor(t={},i,a,s){this._data=t,this._state=i,this._dialog=a,this._dialog_ref=s,this.loading=!1,this.playlist=this._data,this.media=this._state.media,this.search=new A.X(""),this.form=new m.cw({id:new m.NI(this.playlist.id||""),name:new m.NI(this.playlist.name||"",[m.kI.required]),description:new m.NI(this.playlist.description||""),media:new m.NI(this.playlist.media||[]),media_durations:new m.NI(this.playlist.media_durations||{})}),this.media_list=(0,_.aj)([this.media,this.form.valueChanges.pipe((0,F.O)(this.form.getRawValue()))]).pipe((0,f.U)(([l,{}])=>(this.form.getRawValue().media||[]).map(p=>l.find(g=>g.id===p)||new se({id:p})))),this.new_media=(0,_.aj)([this.media,this.search,this.form.valueChanges.pipe((0,F.O)(this.form.getRawValue()))]).pipe((0,f.U)(([l,c,p])=>l.filter(g=>!this.form.getRawValue().media.includes(g.id)).filter(g=>g.name.toLowerCase().includes(c.toLowerCase()))))}indexOf(t){return this.form.getRawValue().media.indexOf(t)}focusSearchInput(){setTimeout(()=>this.search_input.nativeElement?.focus(),100)}savePlaylist(){var t=this;return(0,v.Z)(function*(){t.form.markAllAsTouched(),t.form.updateValueAndValidity(),!t.form.invalid&&(t.loading=!0,yield t._state.savePlaylist(t.form.getRawValue()).catch(i=>{throw(0,u.cB)("Error saving playlist"),t.loading=!1,i}),t._dialog_ref.close())})()}setDuration(t,i){const{media_durations:a}=this.form.getRawValue(),s={...a};s[t]=i,this.form.patchValue({media_durations:s})}addMedia(t){const{id:i}=t,{media:a}=this.form.getRawValue();this.form.patchValue({media:[...a,i]})}removeMedia(t){const{media:i,media_durations:a}=this.form.getRawValue(),s=i.indexOf(t.id),l=[...i];delete a[t.id],l.splice(s,1),this.form.patchValue({media:l,media_durations:{...a}})}changeOrder(t,i){const{media:a}=this.form.getRawValue(),s=a.indexOf(t.id),l=[...a];l.splice(s,1),l.splice(s+i,0,t.id),this.form.patchValue({media:l})}previewMedia(t){const{url:i,type:a,name:s}=t;this._dialog.open(J,{data:{url:i,type:a,name:s,save:!1}}).afterClosed().subscribe(()=>URL.revokeObjectURL(i))}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(b.WI),e.Y36(h),e.Y36(b.uw),e.Y36(b.so))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["signage-playlist-modal"]],viewQuery:function(i,a){if(1&i&&e.Gf(me,5),2&i){let s;e.iGM(s=e.CRH())&&(a.search_input=s.first)}},decls:12,vars:5,consts:[[1,"flex","items-center","justify-between","p-2","border-b","border-base-300"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-2 flex flex-col",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 flex items-center justify-end space-x-2 border-t border-base-300",4,"ngIf"],["duration_template",""],["actions_template",""],["load_state",""],["icon","","matRipple","","mat-dialog-close",""],[1,"p-2","flex","flex-col",3,"formGroup"],["for","name"],["required",""],["appearance","outline",1,"w-full"],["matInput","","name","name","placeholder","Name","formControlName","name"],["for","description"],["matInput","","name","description","placeholder","Description","formControlName","description"],["for","media"],[1,"block","w-full","mb-2",3,"dataSource","columns","display_column","column_size","template"],["btn","","matRipple","",1,"w-full",3,"matMenuTriggerFor","click"],[1,"w-[32rem]","max-w-[80vw]"],["media_menu","matMenu"],["appearance","outline",1,"w-[calc(100%-1rem)]","mx-2","no-subscript"],["matPrefix","",1,"text-2xl","-left-1"],["matInput","","placeholder","Media Name",3,"ngModel","ngModelOptions","ngModelChange"],["search_input",""],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],[1,"flex","items-center","w-full"],[1,"flex-1","truncate"],[1,"capitalize"],[1,"bg-base-300","text-base-content"],[1,"p-2","flex","items-center","justify-end","space-x-2","border-t","border-base-300"],["btn","","matRipple","",1,"w-32",3,"click"],["matTooltip","Set Custom Duration",3,"matMenuTriggerFor"],[1,"w-[20rem]","max-w-[80vw]"],["duration_menu","matMenu"],[3,"ngModel","ngModelOptions","ngModelChange"],[3,"value"],[1,"w-full","flex","items-center","justify-end"],["icon","","matRipple","","matTooltip","Move Media to previous item",3,"disabled","click"],["icon","","matRipple","","matTooltip","Move Media to next item",3,"disabled","click"],["icon","","matRipple","","matTooltip","Preview Media",3,"click"],["icon","","matRipple","","matTooltip","Remove Media from Playlist",1,"text-error",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-8"],[3,"diameter"],[1,"mt-4"]],template:function(i,a){if(1&i&&(e.TgZ(0,"header",0)(1,"h1",1),e._uU(2),e.qZA(),e.YNc(3,ue,3,0,"button",2),e.qZA(),e.YNc(4,ye,26,23,"main",3)(5,ve,3,0,"footer",4)(6,Ze,54,36,"ng-template",null,5,e.W1O)(8,be,13,2,"ng-template",null,6,e.W1O)(10,Te,4,1,"ng-template",null,7,e.W1O)),2&i){const s=e.MAs(11);e.xp6(2),e.hij("",a.playlist.id?"Edit":"New"," Playlist"),e.xp6(1),e.Q6J("ngIf",!a.loading),e.xp6(1),e.Q6J("ngIf",!a.loading)("ngIfElse",s),e.xp6(1),e.Q6J("ngIf",!a.loading)}},dependencies:[d.sg,d.O5,m.Fj,m.JJ,m.JL,m.On,R.KE,R.qo,ce.Nt,de.gD,T.ey,Q.VK,Q.OP,Q.p6,pe.gM,z.Ou,b.ZT,T.wG,m.sg,m.u,C.o,q.C,d.Ov,d.OU,I.C]})}return n})(),h=(()=>{class n{constructor(t,i){this._org=t,this._dialog=i,this._loading=new A.X(!1),this._change=new A.X(0),this._active_upload=new A.X(null),this.loading=this._loading.asObservable(),this.media=(0,_.aj)([this._org.active_building,this._change]).pipe((0,U.h)(([a])=>!!a?.id),(0,P.w)(([a])=>(0,Z.rlq)(a.id,"signage-media").pipe((0,O.K)(()=>(0,S.of)({})))),(0,f.U)(a=>(a.details instanceof Array?a.details:null)||[{id:"media-0001",name:"Welcome to PlaceOS",description:"This is a sample media file",url:"https://assets-global.website-files.com/6171e55cb416782d0a8e7a4c/6171e8d5fe3ffc10c0c800bc_PlaceOS-Logo-Dark-Alt.png",type:"image",duration:15},{id:"media-0002",name:"Welcome to PlaceOS",description:"This is a sample media file",url:"https://assets-global.website-files.com/6171e55cb416782d0a8e7a4c/6171e8d5fe3ffc10c0c800bc_PlaceOS-Logo-Dark-Alt.png",type:"image",duration:30},{id:"media-0003",name:"Welcome to PlaceOS",description:"This is a sample media file",url:"https://assets-global.website-files.com/6171e55cb416782d0a8e7a4c/6171e8d5fe3ffc10c0c800bc_PlaceOS-Logo-Dark-Alt.png",type:"image",duration:60},{id:"media-0004",name:"Welcome to PlaceOS",description:"This is a sample media file",url:"https://assets-global.website-files.com/6171e55cb416782d0a8e7a4c/6171e8d5fe3ffc10c0c800bc_PlaceOS-Logo-Dark-Alt.png",type:"image",duration:15},{id:"media-0005",name:"Welcome to PlaceOS",description:"This is a sample media file",url:"https://assets-global.website-files.com/6171e55cb416782d0a8e7a4c/6171e8d5fe3ffc10c0c800bc_PlaceOS-Logo-Dark-Alt.png",type:"image",duration:30},{id:"media-0006",name:"Welcome to PlaceOS",description:"This is a sample media file",url:"https://assets-global.website-files.com/6171e55cb416782d0a8e7a4c/6171e8d5fe3ffc10c0c800bc_PlaceOS-Logo-Dark-Alt.png",type:"image",duration:60}]),(0,ee.d)(1)),this.playlists=(0,_.aj)([this._org.active_building,this._change]).pipe((0,U.h)(([a])=>!!a?.id),(0,P.w)(([a])=>(0,Z.rlq)(a.id,"signage-playlists").pipe((0,O.K)(()=>(0,S.of)({})))),(0,f.U)(a=>a.details instanceof Array?a.details:null)),this.displays=(0,_.aj)([this._org.active_building,this._change]).pipe((0,U.h)(([a])=>!!a?.id),(0,P.w)(([a])=>(0,Z.rlq)(a.id,"signage-displays").pipe((0,O.K)(()=>(0,S.of)({})))),(0,f.U)(a=>a.details instanceof Array?a.details:null)),this.zones=(0,_.aj)([this._org.active_building,this._change]).pipe((0,U.h)(([a])=>!!a?.id),(0,P.w)(([a])=>(0,Z.I0G)({parent_id:a.id,tags:"signage",limit:100}).pipe((0,O.K)(()=>(0,S.of)({data:[]})))),(0,f.U)(a=>a.data||[]))}editPlaylist(t=new ne){this._dialog.open(N,{data:t}).afterClosed().subscribe(()=>this._change.next(Date.now()))}savePlaylist(t,i=!1){var a=this;return(0,v.Z)(function*(){const s=a._org.building.id,l=(yield a.playlists.pipe((0,k.q)(1)).toPromise())||[],c=l.findIndex(p=>p.id===t.id);c>=0&&l.splice(c,1),t.id||(t.id=`playlist-${(0,u.O1)(8)}`),i||l.push(t),yield(0,Z.Ymr)(s,{name:"signage-playlists",details:l,description:"Playlists for signage displays"}).toPromise(),(0,u.t5)(`Successfully ${i?"removed":"saved"} playlist.`),a._change.next(Date.now())})()}removePlaylist(t){var i=this;return(0,v.Z)(function*(){yield i.savePlaylist(t,!0)})()}editDisplay(t=new ae){this._dialog.open(N,{data:t}).afterClosed().subscribe(()=>this._change.next(Date.now()))}saveDisplay(t,i=!1){var a=this;return(0,v.Z)(function*(){const s=a._org.building.id,l=yield a.displays.pipe((0,k.q)(1)).toPromise(),c=l.findIndex(p=>p.id===t.id);c>=0&&l.splice(c,1),t.id||(t.id=`display-${(0,u.O1)(8)}`),i||l.push(t),yield(0,Z.Ymr)(s,{name:"signage-displays",details:l,description:"Displays for signage displays"}).toPromise(),(0,u.t5)(`Successfully ${i?"removed":"saved"} display.`),a._change.next(Date.now())})()}removeDisplay(t){var i=this;return(0,v.Z)(function*(){yield i.saveDisplay(t,!0)})()}previewMedia(t){const{url:i,type:a,name:s}=t;this._dialog.open(J,{data:{url:i,type:a,name:s,save:!1}}).afterClosed().subscribe(()=>URL.revokeObjectURL(i))}previewFileMedia(t){const i=URL.createObjectURL(t),a=t.type.includes("image")?"image":"video";this._dialog.open(J,{data:{url:i,type:a,name:t.name,save:!0}}).afterClosed().subscribe(()=>URL.revokeObjectURL(i))}addMedia(t){var i=this;return(0,v.Z)(function*(){const a=yield i._uploadFile(t),s=yield i.media.pipe((0,k.q)(1)).toPromise();s.push({id:`media-${(0,u.O1)(8)}`,name:a.name,description:"",url:a.url,type:t.type.includes("image")?"image":"video",duration:15});const l=i._org.building.id;yield(0,Z.Ymr)(l,{name:"signage-media",details:s,description:"Media for signage displays"}).toPromise(),(0,u.t5)("Successfully added media."),i._active_upload.next(null),i._change.next(Date.now())})()}_uploadFile(t){return new Promise((i,a)=>{const s=new FileReader;s.addEventListener("loadend",l=>{const p=ie.PP(l.target.result,t.type),w=(0,B.IL)([p],{file_name:t.name})[0],x={id:`${(0,u.Iy)(999999999999)}`,name:t.name,progress:0,size:t.size,created_at:Date.now(),url:""};w.status.pipe((0,te.o)(M=>"complete"!==M.status,!0)).subscribe(M=>{w.access_url&&(x.url=w.access_url),x.progress=M.progress,"error"===M.status&&(x.progress=-1,a())},a,()=>i(x)),this._active_upload.next(x)}),s.readAsArrayBuffer(t)})}static#e=this.\u0275fac=function(i){return new(i||n)(e.LFG(L.w7),e.LFG(b.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var we=r(3005),Me=r(9842),D=r(989);const Ce=["app-new-staff",""];function Ae(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",8),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.newItem(a.active_link))}),e._uU(1),e.qZA()}if(2&n){const t=e.oxw();e.xp6(1),e.hij(" Add ",t.singular(t.active_link)," ")}}function Se(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"a",9),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.active_link=s)}),e.ALo(1,"lowercase"),e._uU(2),e.qZA()}if(2&n){const t=o.$implicit,i=e.oxw();e.Q6J("routerLink","/signage/"+e.lcZ(1,3,t))("active",i.active_link==t),e.xp6(2),e.hij(" ",t," ")}}let G=(()=>{class n extends u.cx{singular(t){return t.replace(/s$/,"")}newItem(t){switch(t){case"Playlists":this._state.editPlaylist();break;case"Displays":this._state.editDisplay()}}constructor(t,i){super(),this._state=t,this._router=i,this.loading=this._state.loading,this.links=["Playlists","Media","Displays","Zones","Triggers"],this.active_link=this.links[0]}ngOnInit(){this.subscription("route.query",this._router.events.subscribe(t=>{t instanceof y.m2&&(this.active_link=this.links.find(i=>this._router.url.includes(i.toLowerCase())))})),this.active_link=this.links.find(t=>this._router.url.includes(t.toLowerCase()))}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(h),e.Y36(y.F0))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","app-new-staff",""]],features:[e.qOj],attrs:Ce,decls:14,vars:3,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"p-8","h-28","flex","items-center","justify-between"],[1,"text-2xl","font-medium"],["btn","","matRipple","","class","w-32",3,"click",4,"ngIf"],["mat-tab-nav-bar","",3,"tabPanel"],[1,"flex-1","h-1/2","overflow-auto"],["tabPanel",""],["btn","","matRipple","",1,"w-32",3,"click"],["mat-tab-link","",3,"routerLink","active","click"],["mat-tab-link","",3,"routerLink","active"]],template:function(i,a){if(1&i&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1)(4,"div",2)(5,"h2",3),e._uU(6),e.qZA(),e.YNc(7,Ae,2,1,"button",4),e.qZA(),e.TgZ(8,"nav",5),e.SjG(9,Se,3,5,"a",10,e.x6l),e.qZA(),e.TgZ(11,"mat-tab-nav-panel",6,7),e._UZ(13,"router-outlet"),e.qZA()()()),2&i){const s=e.MAs(12);e.xp6(6),e.hij(" Signage - ",a.active_link," "),e.xp6(1),e.Q6J("ngIf","Media"!==a.active_link),e.xp6(1),e.Q6J("tabPanel",s),e.wJu(9,a.links)}},dependencies:[d.O5,we.O,Me.u,T.wG,y.lC,y.rH,D.BU,D.sW,D.Nj,d.i8],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}\n\n/*# sourceMappingURL=signage.component.ts-angular-inline--186.css.map*/"]})}return n})();var Ue=r(7627);let Pe=(()=>{class n extends u.cx{constructor(t,i,a,s){super(),this._state=t,this._org=i,this._route=a,this._router=s,this.zones=[],this.levels=this._org.active_levels}ngOnInit(){var t=this;return(0,v.Z)(function*(){yield t._org.initialised.pipe((0,Ue.P)(i=>i)).toPromise(),t.subscription("route.query",t._route.queryParamMap.subscribe(i=>{if(i.has("zone_ids")){const a=i.get("zone_ids").split(",");if(a.length){const s=t._org.levelWithID(a);if(!s)return;t._org.building=t._org.buildings.find(l=>l.id===s.parent_id),t.zones=a}}})),t.subscription("levels",t._org.active_levels.subscribe(i=>{t.zones=t.zones.filter(a=>i.find(s=>s.id===a)),!t.zones.length&&i.length&&t.zones.push(i[0].id)}))})()}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(h),e.Y36(L.w7),e.Y36(y.gz),e.Y36(y.F0))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["signage-topbar"]],features:[e.qOj],decls:1,vars:0,consts:[[1,"flex","items-center","bg-base-100","h-20","px-4","border-b","border-base-200","space-x-2"]],template:function(i,a){1&i&&e._UZ(0,"div",0)},styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}\n\n/*# sourceMappingURL=signage-topbar.component.ts-angular-inline--187.css.map*/"]})}return n})();var E=r(8173);function Oe(n,o){1&n&&e._uU(0),2&n&&e.hij(" ",o.row.media.length," Media Item(s) ")}function Je(n,o){if(1&n&&(e.TgZ(0,"code"),e._uU(1),e.ALo(2,"mediaDuration"),e.qZA()),2&n){const t=o.row;e.xp6(1),e.Oqu(e.lcZ(2,1,t.duration))}}function Ie(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){const s=e.CHM(t).row,l=e.oxw();return e.KtG(l.editItem(s))}),e.TgZ(1,"app-icon"),e._uU(2,"edit"),e.qZA()(),e.TgZ(3,"button",6),e.NdJ("click",function(){const s=e.CHM(t).row,l=e.oxw();return e.KtG(l.deleteItem(s))}),e.TgZ(4,"app-icon"),e._uU(5,"delete"),e.qZA()()}}function De(n,o){1&n&&e._UZ(0,"mat-progress-bar",7)}const ke=()=>["name","description","media","duration","actions"],Qe=()=>["Name","Description","Media","Duration"," "],qe=()=>["8r","flex","10r","6r","5r"],Ne=(n,o,t)=>({media:n,duration:o,actions:t});let W=(()=>{class n{constructor(t){this._state=t,this.loading=this._state.loading,this.playlists=this._state.playlists,this.media=this._state.media,this.deleteItem=i=>this._state.removePlaylist(i),this.editItem=i=>this._state.editPlaylist(i),this.playlist_list=(0,_.aj)([this.playlists,this.media]).pipe((0,f.U)(([i,a])=>i.map(s=>({...s,duration:s.media.reduce((l,c)=>l+(s.media_durations[c]||a.find(p=>p.id===c)?.duration||15),0)}))))}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(h))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["signage-playlists"]],decls:9,vars:15,consts:[[1,"block","min-w-[48rem]",3,"dataSource","columns","display_column","column_size","template"],["media_template",""],["duration_template",""],["actions_template",""],["class","absolute inset-x-0 bottom-0","mode","indeterminate",4,"ngIf"],["icon","","matRipple","",3,"click"],["icon","","matRipple","",1,"text-error",3,"click"],["mode","indeterminate",1,"absolute","inset-x-0","bottom-0"]],template:function(i,a){if(1&i&&(e._UZ(0,"custom-table",0),e.YNc(1,Oe,1,1,"ng-template",null,1,e.W1O)(3,Je,3,3,"ng-template",null,2,e.W1O)(5,Ie,6,0,"ng-template",null,3,e.W1O)(7,De,1,0,"mat-progress-bar",4),e.ALo(8,"async")),2&i){const s=e.MAs(2),l=e.MAs(4),c=e.MAs(6);e.Q6J("dataSource",a.playlist_list)("columns",e.DdM(8,ke))("display_column",e.DdM(9,Qe))("column_size",e.DdM(10,qe))("template",e.kEZ(11,Ne,s,l,c)),e.xp6(7),e.Q6J("ngIf",e.lcZ(8,6,a.loading))}},dependencies:[d.O5,E.pW,T.wG,C.o,q.C,d.Ov,I.C]})}return n})();function je(n,o){1&n&&e._uU(0),2&n&&e.hij(" ",o.row.playlists.length," Playlist(s) ")}function Le(n,o){if(1&n&&(e.TgZ(0,"code"),e._uU(1),e.ALo(2,"mediaDuration"),e.qZA()),2&n){const t=o.row;e.xp6(1),e.Oqu(e.lcZ(2,1,t.duration))}}function Fe(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){const s=e.CHM(t).row,l=e.oxw();return e.KtG(l.editItem(s))}),e.TgZ(1,"app-icon"),e._uU(2,"edit"),e.qZA()(),e.TgZ(3,"button",6),e.NdJ("click",function(){const s=e.CHM(t).row,l=e.oxw();return e.KtG(l.deleteItem(s))}),e.TgZ(4,"app-icon"),e._uU(5,"delete"),e.qZA()()}}function Re(n,o){1&n&&e._UZ(0,"mat-progress-bar",7)}const ze=()=>["name","description","playlists","duration","actions"],Ye=()=>["Name","Description","Media","Duration"," "],Ge=()=>["8r","flex","10r","6r","5r"],Ee=(n,o,t)=>({playlists:n,duration:o,actions:t});let K=(()=>{class n{constructor(t){this._state=t,this.loading=this._state.loading,this.displays=this._state.displays,this.playlists=this._state.playlists,this.media=this._state.media,this.deleteItem=i=>this._state.removePlaylist(i),this.editItem=i=>this._state.editPlaylist(i),this.display_list=(0,_.aj)([this.displays,this.playlists,this.media]).pipe((0,f.U)(([i,a,s])=>i.map(l=>({...l,playlists:l.playlists.map(c=>a.find(p=>p.id===c)),duration:l.playlists.reduce((c,p)=>{const g=a.find(w=>w.id===p);return g?c+g.media.reduce((w,x)=>w+(g.media_durations[x]||s.find(M=>M.id===x)?.duration||15),0):c},0)}))))}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(h))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["signage-displays"]],decls:9,vars:15,consts:[[1,"block","min-w-[48rem]",3,"dataSource","columns","display_column","column_size","template"],["playlists_template",""],["duration_template",""],["actions_template",""],["class","absolute inset-x-0 bottom-0","mode","indeterminate",4,"ngIf"],["icon","","matRipple","",3,"click"],["icon","","matRipple","",1,"text-error",3,"click"],["mode","indeterminate",1,"absolute","inset-x-0","bottom-0"]],template:function(i,a){if(1&i&&(e._UZ(0,"custom-table",0),e.YNc(1,je,1,1,"ng-template",null,1,e.W1O)(3,Le,3,3,"ng-template",null,2,e.W1O)(5,Fe,6,0,"ng-template",null,3,e.W1O)(7,Re,1,0,"mat-progress-bar",4),e.ALo(8,"async")),2&i){const s=e.MAs(2),l=e.MAs(4),c=e.MAs(6);e.Q6J("dataSource",a.display_list)("columns",e.DdM(8,ze))("display_column",e.DdM(9,Ye))("column_size",e.DdM(10,Ge))("template",e.kEZ(11,Ee,s,l,c)),e.xp6(7),e.Q6J("ngIf",e.lcZ(8,6,a.loading))}},dependencies:[d.O5,E.pW,T.wG,C.o,q.C,d.Ov,I.C]})}return n})(),H=(()=>{class n{constructor(t){this._state=t,this.loading=this._state.loading}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(h))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["signage-zones"]],decls:0,vars:0,template:function(i,a){}})}return n})(),V=(()=>{class n{constructor(t){this._state=t,this.loading=this._state.loading}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(h))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["signage-triggers"]],decls:0,vars:0,template:function(i,a){}})}return n})();function We(n,o){if(1&n&&(e.TgZ(0,"div",18),e._UZ(1,"div",11),e.TgZ(2,"div",12),e._uU(3),e.ALo(4,"mediaDuration"),e.qZA()()),2&n){const t=e.oxw().$implicit;e.xp6(3),e.hij(" ",e.lcZ(4,1,t.duration)," ")}}function Ke(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",7)(1,"button",8),e.NdJ("click",function(){const s=e.CHM(t).$implicit,l=e.oxw(3);return e.KtG(l.previewMedia(s))}),e._UZ(2,"img",9),e.TgZ(3,"div",10),e._UZ(4,"div",11),e.TgZ(5,"div",12),e._uU(6),e.qZA()(),e.TgZ(7,"div",13),e._UZ(8,"div",11),e.TgZ(9,"div",12),e._uU(10),e.qZA()(),e.YNc(11,We,5,3,"div",14),e.qZA(),e.TgZ(12,"div",15)(13,"div",16),e._uU(14),e.qZA(),e.TgZ(15,"button",17)(16,"app-icon"),e._uU(17,"more_vert"),e.qZA()()()()}if(2&n){const t=o.$implicit,i=e.oxw(3);e.xp6(2),e.Q6J("src",t.url,e.LSH),e.xp6(4),e.hij(" ","image"===t.type?"Image":"Video"," "),e.xp6(4),e.hij(" ",i.count||0," Playlist(s) "),e.xp6(1),e.Q6J("ngIf",t.duration),e.xp6(3),e.hij(" ",t.name," ")}}function He(n,o){if(1&n&&(e.ynx(0),e.TgZ(1,"div",5),e.YNc(2,Ke,18,5,"div",6),e.ALo(3,"async"),e.qZA(),e.BQk()),2&n){const t=e.oxw(2);e.xp6(2),e.Q6J("ngForOf",e.lcZ(3,1,t.media))}}function Ve(n,o){if(1&n&&(e.ynx(0),e.YNc(1,He,4,3,"ng-container",1),e.ALo(2,"async"),e.BQk()),2&n){const t=e.oxw(),i=e.MAs(5);let a;e.xp6(1),e.Q6J("ngIf",null==(a=e.lcZ(2,2,t.media))?null:a.length)("ngIfElse",i)}}function $e(n,o){if(1&n){const t=e.EpF();e.TgZ(0,"div",19),e._UZ(1,"div",20)(2,"div",21),e.TgZ(3,"div",22)(4,"app-icon",23),e._uU(5,"upload"),e.qZA(),e.TgZ(6,"p"),e._uU(7,"Drop file to upload file"),e.qZA()(),e.TgZ(8,"input",24),e.NdJ("change",function(a){e.CHM(t);const s=e.oxw();return e.KtG(s.previewFile(a))}),e.qZA()()}}function Xe(n,o){1&n&&(e.TgZ(0,"div",25)(1,"app-icon",23),e._uU(2,"hide_image"),e.qZA(),e.TgZ(3,"p"),e._uU(4,"No media found."),e.qZA()())}function Be(n,o){1&n&&(e.TgZ(0,"div",26),e._UZ(1,"mat-spinner",27),e.TgZ(2,"p"),e._uU(3,"Loading..."),e.qZA()())}let $=(()=>{class n extends u.cx{onEnter(t){this.show_dropzone=t?.dataTransfer?.types.includes("Files")}hideOverlay(t){t.target instanceof HTMLInputElement||t.preventDefault(),this.timeout("hide_overlay",()=>this.show_dropzone=!1)}constructor(t){super(),this._state=t,this.loading=this._state.loading,this.media=this._state.media,this.show_dropzone=!1,this.previewMedia=i=>this._state.previewMedia(i)}previewFile(t){const i=t.target;if(!i?.files?.length)return;const s=i.files[0];s&&(s.type.includes("image")||s.type.includes("video"))?this._state.previewFileMedia(s):(0,u.cB)("Invalid file type.")}static#e=this.\u0275fac=function(i){return new(i||n)(e.Y36(h))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["signage-media"]],features:[e.qOj],decls:8,vars:5,consts:[[1,"relative","bg-base-200","min-h-full","w-full",3,"dragenter","drop"],[4,"ngIf","ngIfElse"],["class","absolute inset-0",4,"ngIf"],["empty_template",""],["load_template",""],[1,"flex","flex-wrap","items-start","justify-start","w-full","p-2"],["class","m-2 p-2 bg-base-100 rounded-lg overflow-hidden h-[13rem] border border-base-300 shadow",4,"ngFor","ngForOf"],[1,"m-2","p-2","bg-base-100","rounded-lg","overflow-hidden","h-[13rem]","border","border-base-300","shadow"],[1,"w-64","h-36","overflow-hidden","bg-base-200","rounded","m-0","p-0","relative",3,"click"],[1,"object-cover","w-full","h-full",3,"src"],[1,"absolute","top-2","left-2","flex","items-center","justify-center","rounded","overflow-hidden"],[1,"absolute","inset-0","bg-base-content","opacity-60","z-0"],[1,"relative","text-base-100","z-10","px-2","py-1","text-xs"],[1,"absolute","top-2","right-2","flex","items-center","justify-center","rounded","overflow-hidden"],["class","absolute bottom-2 right-2 flex items-center justify-center rounded overflow-hidden",4,"ngIf"],[1,"flex","items-center","justify-between","space-x-2"],[1,"truncate","flex-1","w-1/2","px-2"],["icon","","matRipple",""],[1,"absolute","bottom-2","right-2","flex","items-center","justify-center","rounded","overflow-hidden"],[1,"absolute","inset-0"],[1,"absolute","inset-0","bg-base-200"],[1,"absolute","inset-0","bg-base-content","opacity-70"],[1,"absolute","inset-4","border-4","border-dashed","border-neutral","text-base-100","rounded-xl","flex","flex-col","items-center","justify-center"],[1,"text-8xl"],["type","file",1,"absolute","inset-0","w-full","opacity-0",3,"change"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2","opacity-30"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"]],template:function(i,a){if(1&i&&(e.TgZ(0,"div",0),e.NdJ("dragenter",function(l){return a.onEnter(l)},!1,e.evT)("drop",function(l){return a.hideOverlay(l)},!1,e.evT),e.YNc(1,Ve,3,4,"ng-container",1),e.ALo(2,"async"),e.YNc(3,$e,9,0,"div",2),e.qZA(),e.YNc(4,Xe,5,0,"ng-template",null,3,e.W1O)(6,Be,4,0,"ng-template",null,4,e.W1O)),2&i){const s=e.MAs(7);e.xp6(1),e.Q6J("ngIf",!e.lcZ(2,3,a.loading))("ngIfElse",s),e.xp6(2),e.Q6J("ngIf",a.show_dropzone)}},dependencies:[d.sg,d.O5,z.Ou,T.wG,C.o,d.Ov,I.C],styles:["[_nghost-%COMP%]{min-height:100%}\n\n/*# sourceMappingURL=signage-media.component.ts-angular-inline--188.css.map*/"]})}return n})();var et=r(1862);const tt=[{path:"",component:G,children:[{path:"",redirectTo:"playlists",pathMatch:"full"},{path:"playlists",component:W},{path:"media",component:$},{path:"displays",component:K},{path:"zones",component:H},{path:"triggers",component:V},{path:"*",redirectTo:"playlists",pathMatch:"full"}]}],it=[G,Pe,W,$,K,H,V,J,N];let nt=(()=>{class n{static#e=this.\u0275fac=function(i){return new(i||n)};static#t=this.\u0275mod=e.oAB({type:n});static#i=this.\u0275inj=e.cJS({imports:[d.ez,m.u5,X.v,et.Kk,y.Bz.forChild(tt),D.Nh]})}return n})()}}]);
//# sourceMappingURL=apps_concierge_src_app_signage_signage_module_ts.js.map