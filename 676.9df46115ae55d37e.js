"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[676],{8676:(Te,E,r)=>{r.r(E),r.d(E,{COMPONENTS:()=>Ze,SignageModule:()=>we});var u=r(6814),p=r(6223),b=r(6980),st=r(7910),v=r(5861),g=r(2798),Y=r(3121),M=r(7247),J=r(5125),f=r(2994),I=r(9193),q=r(7734),D=r(5222),k=r(2413),h=r(6124),lt=r(9185),G=r(1418);class z{constructor(l={}){this.id=l.id||"",this.name=l.name||"",this.description=l.description||"",this.media=l.media||[],this.media_durations=l.media_durations||{}}}class rt{constructor(l={}){this.id=l.id||"",this.name=l.name||"",this.description=l.description||"",this.orientation=l.orientation||"landscape",this.playlists=l.playlists||[]}}class ct{constructor(l={}){this.id=l.id||"",this.name=l.name||"",this.description=l.description||"",this.type=l.type||"image",this.duration=l.duration||15,this.orientation=l.orientation||"landscape",this.url=l.url||""}}var t=r(9212),x=r(9347),N=r(5940),Z=r(3680),C=r(4888);function pt(n,l){if(1&n&&t._UZ(0,"img",10),2&n){const e=t.oxw(2);t.Q6J("src",e.resource.toString(),t.LSH)}}function dt(n,l){if(1&n&&t._UZ(0,"video",11),2&n){const e=t.oxw(2);t.Q6J("src",e.resource.toString(),t.LSH)}}function mt(n,l){if(1&n&&(t.TgZ(0,"main",6)(1,"div",7),t.YNc(2,pt,1,1,"img",8)(3,dt,1,1,"video",9),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngIf","image"===e.type),t.xp6(),t.Q6J("ngIf","video"===e.type)}}function ut(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"footer",12)(1,"button",13),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.save.emit())}),t._uU(2," Save Media "),t.qZA()()}}function gt(n,l){if(1&n&&(t.TgZ(0,"main",14),t._UZ(1,"mat-spinner",15),t.TgZ(2,"p"),t._uU(3),t.qZA()()),2&n){const e=t.oxw();t.xp6(),t.Q6J("diameter",32),t.xp6(2),t.Oqu(e.loading)}}let Q=(()=>{class n{constructor(e){this._data=e,this.save=new t.vpe,this.loading="",this.resource=this._data.url,this.type=this._data.type,this.name=this._data.name,this.file=this._data.file,this.can_save=!1!==this._data.save}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(x.WI))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-media-preview-modal"]],outputs:{save:"save"},decls:10,vars:4,consts:[[1,"flex","items-center","justify-between","p-2","border-b","border-base-300"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close",""],["class","bg-base-200",4,"ngIf","ngIfElse"],["class","p-2 flex items-center justify-end space-x-2 border-t border-base-300",4,"ngIf"],["load_state",""],[1,"bg-base-200"],[1,"max-w-[80vw]","max-h-[65vh]","w-[80vw]","h-[65vh]","flex","items-center","justify-center"],["class","max-w-full max-h-full",3,"src",4,"ngIf"],["class","max-w-full max-h-full","autoplay","","controls","",3,"src",4,"ngIf"],[1,"max-w-full","max-h-full",3,"src"],["autoplay","","controls","",1,"max-w-full","max-h-full",3,"src"],[1,"p-2","flex","items-center","justify-end","space-x-2","border-t","border-base-300"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-8","w-[28rem]","h-[20rem]","max-w-[80vw]","max-h-[65vh]"],[3,"diameter"]],template:function(i,a){if(1&i&&(t.TgZ(0,"header",0)(1,"h1",1),t._uU(2),t.qZA(),t.TgZ(3,"button",2)(4,"app-icon"),t._uU(5,"close"),t.qZA()()(),t.YNc(6,mt,4,2,"main",3)(7,ut,3,0,"footer",4)(8,gt,4,2,"ng-template",null,5,t.W1O)),2&i){const o=t.MAs(9);t.xp6(2),t.hij("Preview - ",a.name,""),t.xp6(4),t.Q6J("ngIf",!a.loading)("ngIfElse",o),t.xp6(),t.Q6J("ngIf",a.can_save&&!a.loading)}},dependencies:[u.O5,N.Ou,x.ZT,Z.wG,C.o]})}return n})();var j=r(3075),A=r(4170),K=r(8582),H=r(8525),U=r(7988),V=r(2596),R=r(7442),O=r(1537);const _t=["search_input"];function ft(n,l){1&n&&(t.TgZ(0,"button",8)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function ht(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.addMedia(o))}),t.TgZ(1,"div",27)(2,"div",28),t._uU(3),t.qZA(),t.TgZ(4,"code",29),t._uU(5),t.qZA(),t.TgZ(6,"code",30),t._uU(7),t.ALo(8,"mediaDuration"),t.qZA()()()}if(2&n){const e=l.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(2),t.Oqu(e.type),t.xp6(2),t.Oqu(t.lcZ(8,3,e.duration))}}const xt=()=>["_index","name","type","duration","actions"],yt=()=>[" ","Name","Type","Duration"," "],vt=()=>["3r","flex","10r","6r","10r"],Zt=(n,l)=>({duration:n,actions:l}),W=()=>({standalone:!0});function wt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"main",9)(1,"label",10),t._uU(2,"Name"),t.TgZ(3,"span",11),t._uU(4,"*"),t.qZA()(),t.TgZ(5,"mat-form-field",12),t._UZ(6,"input",13),t.TgZ(7,"mat-error"),t._uU(8,"Name is required"),t.qZA()(),t.TgZ(9,"label",14),t._uU(10,"Description"),t.qZA(),t.TgZ(11,"mat-form-field",12),t._UZ(12,"textarea",15),t.qZA(),t.TgZ(13,"label",16),t._uU(14,"Media"),t.qZA(),t._UZ(15,"custom-table",17),t.TgZ(16,"button",18),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.focusSearchInput())}),t._uU(17," Add Media "),t.qZA(),t.TgZ(18,"mat-menu",19,20)(20,"mat-form-field",21)(21,"app-icon",22),t._uU(22," search "),t.qZA(),t.TgZ(23,"input",23,24),t.NdJ("ngModelChange",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.search.next(a))}),t.qZA()(),t.YNc(25,ht,9,5,"button",25),t.ALo(26,"slice"),t.ALo(27,"async"),t.qZA()()}if(2&n){const e=t.MAs(19),i=t.oxw(),a=t.MAs(7),o=t.MAs(9);t.Q6J("formGroup",i.form),t.xp6(15),t.Q6J("dataSource",i.media_list)("columns",t.DdM(16,xt))("display_column",t.DdM(17,yt))("column_size",t.DdM(18,vt))("template",t.WLB(19,Zt,a,o)),t.xp6(),t.Q6J("matMenuTriggerFor",e),t.xp6(7),t.Q6J("ngModel",i.search.getValue())("ngModelOptions",t.DdM(22,W)),t.xp6(2),t.Q6J("ngForOf",t.Dn7(26,10,t.lcZ(27,14,i.new_media),0,8))}}function Tt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"footer",31)(1,"button",32),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.savePlaylist())}),t._uU(2," Save Playlist "),t.qZA()()}}function bt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",33)(1,"code"),t._uU(2),t.ALo(3,"mediaDuration"),t.qZA()(),t.TgZ(4,"mat-menu",34,35)(6,"mat-form-field",21)(7,"mat-select",36),t.NdJ("ngModelChange",function(a){const s=t.CHM(e).row,c=t.oxw();return t.KtG(c.setDuration(s.id,a))}),t.TgZ(8,"mat-option",37),t._uU(9,"Use Media Default"),t.qZA(),t.TgZ(10,"mat-option",37),t._uU(11,"5 seconds"),t.qZA(),t.TgZ(12,"mat-option",37),t._uU(13,"10 seconds"),t.qZA(),t.TgZ(14,"mat-option",37),t._uU(15,"15 seconds"),t.qZA(),t.TgZ(16,"mat-option",37),t._uU(17,"30 seconds"),t.qZA(),t.TgZ(18,"mat-option",37),t._uU(19,"45 seconds"),t.qZA(),t.TgZ(20,"mat-option",37),t._uU(21,"1 minute"),t.qZA(),t.TgZ(22,"mat-option",37),t._uU(23,"1 minute 15 seconds"),t.qZA(),t.TgZ(24,"mat-option",37),t._uU(25,"1 minute 30 seconds"),t.qZA(),t.TgZ(26,"mat-option",37),t._uU(27,"1 minute 45 seconds"),t.qZA(),t.TgZ(28,"mat-option",37),t._uU(29,"2 minute"),t.qZA(),t.TgZ(30,"mat-option",37),t._uU(31,"2 minute 15 seconds"),t.qZA(),t.TgZ(32,"mat-option",37),t._uU(33,"2 minute 30 seconds"),t.qZA(),t.TgZ(34,"mat-option",37),t._uU(35,"2 minute 45 seconds"),t.qZA(),t.TgZ(36,"mat-option",37),t._uU(37,"3 minute"),t.qZA(),t.TgZ(38,"mat-option",37),t._uU(39,"3 minute 15 seconds"),t.qZA(),t.TgZ(40,"mat-option",37),t._uU(41,"3 minute 30 seconds"),t.qZA(),t.TgZ(42,"mat-option",37),t._uU(43,"3 minute 45 seconds"),t.qZA(),t.TgZ(44,"mat-option",37),t._uU(45,"4 minute"),t.qZA(),t.TgZ(46,"mat-option",37),t._uU(47,"4 minute 15 seconds"),t.qZA(),t.TgZ(48,"mat-option",37),t._uU(49,"4 minute 30 seconds"),t.qZA(),t.TgZ(50,"mat-option",37),t._uU(51,"4 minute 45 seconds"),t.qZA(),t.TgZ(52,"mat-option",37),t._uU(53,"5 minute"),t.qZA()()()()}if(2&n){const e=l.row,i=t.MAs(5),a=t.oxw();t.ekj("pointer-events-none","image"!==e.type),t.Q6J("matMenuTriggerFor",i),t.xp6(),t.ekj("bg-warning",a.form.value.media_durations[e.id])("text-warning-content",a.form.value.media_durations[e.id]),t.xp6(),t.hij(" ",t.lcZ(3,33,a.form.value.media_durations[e.id]||e.duration)," "),t.xp6(5),t.Q6J("ngModel",a.form.value.media_durations[e.id]||0)("ngModelOptions",t.DdM(35,W)),t.xp6(),t.Q6J("value",0),t.xp6(2),t.Q6J("value",5),t.xp6(2),t.Q6J("value",10),t.xp6(2),t.Q6J("value",15),t.xp6(2),t.Q6J("value",30),t.xp6(2),t.Q6J("value",45),t.xp6(2),t.Q6J("value",60),t.xp6(2),t.Q6J("value",75),t.xp6(2),t.Q6J("value",90),t.xp6(2),t.Q6J("value",105),t.xp6(2),t.Q6J("value",120),t.xp6(2),t.Q6J("value",135),t.xp6(2),t.Q6J("value",150),t.xp6(2),t.Q6J("value",165),t.xp6(2),t.Q6J("value",180),t.xp6(2),t.Q6J("value",195),t.xp6(2),t.Q6J("value",210),t.xp6(2),t.Q6J("value",225),t.xp6(2),t.Q6J("value",240),t.xp6(2),t.Q6J("value",255),t.xp6(2),t.Q6J("value",270),t.xp6(2),t.Q6J("value",285),t.xp6(2),t.Q6J("value",300)}}function Mt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",38)(1,"button",39),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.changeOrder(o,-1))}),t.TgZ(2,"app-icon"),t._uU(3,"arrow_upward"),t.qZA()(),t.TgZ(4,"button",40),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.changeOrder(o,1))}),t.TgZ(5,"app-icon"),t._uU(6,"arrow_downward"),t.qZA()(),t.TgZ(7,"button",41),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.previewMedia(o))}),t.TgZ(8,"app-icon"),t._uU(9,"visibility"),t.qZA()(),t.TgZ(10,"button",42),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.removeMedia(o))}),t.TgZ(11,"app-icon"),t._uU(12,"delete"),t.qZA()()()}if(2&n){const e=l.first,i=l.last;t.xp6(),t.Q6J("disabled",e),t.xp6(3),t.Q6J("disabled",i)}}function Ct(n,l){1&n&&(t.TgZ(0,"main",43),t._UZ(1,"mat-spinner",44),t.TgZ(2,"p",45),t._uU(3,"Saving Playlist..."),t.qZA()()),2&n&&(t.xp6(),t.Q6J("diameter",32))}let $=(()=>{class n{constructor(e={},i,a,o){this._data=e,this._state=i,this._dialog=a,this._dialog_ref=o,this.loading=!1,this.playlist=this._data,this.media=this._state.media,this.search=new J.X(""),this.form=new p.cw({id:new p.NI(this.playlist.id||""),name:new p.NI(this.playlist.name||"",[p.kI.required]),description:new p.NI(this.playlist.description||""),media:new p.NI(this.playlist.media||[]),media_durations:new p.NI(this.playlist.media_durations||{})}),this.media_list=(0,f.aj)([this.media,this.form.valueChanges.pipe((0,j.O)(this.form.getRawValue()))]).pipe((0,h.U)(([s,{}])=>(this.form.getRawValue().media||[]).map(d=>s.find(m=>m.id===d)||new ct({id:d})))),this.new_media=(0,f.aj)([this.media,this.search,this.form.valueChanges.pipe((0,j.O)(this.form.getRawValue()))]).pipe((0,h.U)(([s,c,d])=>s.filter(m=>!this.form.getRawValue().media.includes(m.id)).filter(m=>m.name.toLowerCase().includes(c.toLowerCase()))))}indexOf(e){return this.form.getRawValue().media.indexOf(e)}focusSearchInput(){setTimeout(()=>this.search_input.nativeElement?.focus(),100)}savePlaylist(){var e=this;return(0,v.Z)(function*(){e.form.markAllAsTouched(),e.form.updateValueAndValidity(),!e.form.invalid&&(e.loading=!0,yield e._state.savePlaylist(e.form.getRawValue()).catch(i=>{throw(0,g.cB)("Error saving playlist"),e.loading=!1,i}),e._dialog_ref.close())})()}setDuration(e,i){const{media_durations:a}=this.form.getRawValue(),o={...a};o[e]=i,this.form.patchValue({media_durations:o})}addMedia(e){const{id:i}=e,{media:a}=this.form.getRawValue();this.form.patchValue({media:[...a,i]})}removeMedia(e){const{media:i,media_durations:a}=this.form.getRawValue(),o=i.indexOf(e.id),s=[...i];delete a[e.id],s.splice(o,1),this.form.patchValue({media:s,media_durations:{...a}})}changeOrder(e,i){const{media:a}=this.form.getRawValue(),o=a.indexOf(e.id),s=[...a];s.splice(o,1),s.splice(o+i,0,e.id),this.form.patchValue({media:s})}previewMedia(e){const{url:i,type:a,name:o}=e;this._dialog.open(Q,{data:{url:i,type:a,name:o,save:!1}}).afterClosed().subscribe(()=>URL.revokeObjectURL(i))}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(x.WI),t.Y36(w),t.Y36(x.uw),t.Y36(x.so))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-playlist-modal"]],viewQuery:function(i,a){if(1&i&&t.Gf(_t,5),2&i){let o;t.iGM(o=t.CRH())&&(a.search_input=o.first)}},decls:12,vars:5,consts:[[1,"flex","items-center","justify-between","p-2","border-b","border-base-300"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-2 flex flex-col",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 flex items-center justify-end space-x-2 border-t border-base-300",4,"ngIf"],["duration_template",""],["actions_template",""],["load_state",""],["icon","","matRipple","","mat-dialog-close",""],[1,"p-2","flex","flex-col",3,"formGroup"],["for","name"],["required",""],["appearance","outline",1,"w-full"],["matInput","","name","name","placeholder","Name","formControlName","name"],["for","description"],["matInput","","name","description","placeholder","Description","formControlName","description"],["for","media"],[1,"block","w-full","mb-2",3,"dataSource","columns","display_column","column_size","template"],["btn","","matRipple","",1,"w-full",3,"matMenuTriggerFor","click"],[1,"w-[32rem]","max-w-[80vw]"],["media_menu","matMenu"],["appearance","outline",1,"w-[calc(100%-1rem)]","mx-2","no-subscript"],["matPrefix","",1,"text-2xl","-left-1"],["matInput","","placeholder","Media Name",3,"ngModel","ngModelOptions","ngModelChange"],["search_input",""],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],[1,"flex","items-center","w-full"],[1,"flex-1","truncate"],[1,"capitalize"],[1,"bg-base-300","text-base-content"],[1,"p-2","flex","items-center","justify-end","space-x-2","border-t","border-base-300"],["btn","","matRipple","",1,"w-32",3,"click"],["matTooltip","Set Custom Duration",3,"matMenuTriggerFor"],[1,"w-[20rem]","max-w-[80vw]"],["duration_menu","matMenu"],[3,"ngModel","ngModelOptions","ngModelChange"],[3,"value"],[1,"w-full","flex","items-center","justify-end"],["icon","","matRipple","","matTooltip","Move Media to previous item",3,"disabled","click"],["icon","","matRipple","","matTooltip","Move Media to next item",3,"disabled","click"],["icon","","matRipple","","matTooltip","Preview Media",3,"click"],["icon","","matRipple","","matTooltip","Remove Media from Playlist",1,"text-error",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-8"],[3,"diameter"],[1,"mt-4"]],template:function(i,a){if(1&i&&(t.TgZ(0,"header",0)(1,"h1",1),t._uU(2),t.qZA(),t.YNc(3,ft,3,0,"button",2),t.qZA(),t.YNc(4,wt,28,23,"main",3)(5,Tt,3,0,"footer",4)(6,bt,54,36,"ng-template",null,5,t.W1O)(8,Mt,13,2,"ng-template",null,6,t.W1O)(10,Ct,4,1,"ng-template",null,7,t.W1O)),2&i){const o=t.MAs(11);t.xp6(2),t.hij("",a.playlist.id?"Edit":"New"," Playlist"),t.xp6(),t.Q6J("ngIf",!a.loading),t.xp6(),t.Q6J("ngIf",!a.loading)("ngIfElse",o),t.xp6(),t.Q6J("ngIf",!a.loading)}},dependencies:[u.sg,u.O5,p.Fj,p.JJ,p.JL,p.On,A.KE,A.TO,A.qo,K.Nt,H.gD,Z.ey,U.VK,U.OP,U.p6,V.gM,N.Ou,x.ZT,Z.wG,p.sg,p.u,C.o,R.C,u.Ov,u.OU,O.C]})}return n})();var At=r(7927);const Ut=["search_input"];function St(n,l){1&n&&(t.TgZ(0,"button",8)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function Jt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",29),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.addPlaylist(o))}),t.TgZ(1,"div",30)(2,"div",31),t._uU(3),t.qZA(),t.TgZ(4,"code",32),t._uU(5),t.ALo(6,"mediaDuration"),t.qZA()()()}if(2&n){const e=l.$implicit;t.xp6(3),t.Oqu(e.name),t.xp6(2),t.Oqu(t.lcZ(6,2,e.duration))}}const Ot=()=>["_index","name","type","duration","actions"],Pt=()=>[" ","Name","Type","Duration"," "],It=()=>["3r","flex","10r","6r","10r"],qt=(n,l)=>({duration:n,actions:l}),Dt=()=>({standalone:!0});function kt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"main",9)(1,"label",10),t._uU(2,"Name"),t.TgZ(3,"span",11),t._uU(4,"*"),t.qZA()(),t.TgZ(5,"mat-form-field",12),t._UZ(6,"input",13),t.TgZ(7,"mat-error"),t._uU(8,"Name is required"),t.qZA()(),t.TgZ(9,"label",14),t._uU(10,"Description"),t.qZA(),t.TgZ(11,"mat-form-field",12),t._UZ(12,"textarea",15),t.qZA(),t.TgZ(13,"label",14),t._uU(14,"Orientation"),t.TgZ(15,"span",11),t._uU(16,"*"),t.qZA()(),t.TgZ(17,"mat-form-field",12)(18,"mat-select",16)(19,"mat-option",17),t._uU(20,"Landscape"),t.qZA(),t.TgZ(21,"mat-option",18),t._uU(22,"Portrait"),t.qZA()(),t.TgZ(23,"mat-error"),t._uU(24,"Orientation is required"),t.qZA()(),t.TgZ(25,"label",19),t._uU(26,"Playlists"),t.qZA(),t._UZ(27,"custom-table",20),t.TgZ(28,"button",21),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.focusSearchInput())}),t._uU(29," Add Playlist "),t.qZA(),t.TgZ(30,"mat-menu",22,23)(32,"mat-form-field",24)(33,"app-icon",25),t._uU(34," search "),t.qZA(),t.TgZ(35,"input",26,27),t.NdJ("ngModelChange",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.search.next(a))}),t.qZA()(),t.YNc(37,Jt,7,4,"button",28),t.ALo(38,"slice"),t.ALo(39,"async"),t.qZA()()}if(2&n){const e=t.MAs(31),i=t.oxw(),a=t.MAs(9),o=t.MAs(7);t.Q6J("formGroup",i.form),t.xp6(27),t.Q6J("dataSource",i.playlist_list)("columns",t.DdM(16,Ot))("display_column",t.DdM(17,Pt))("column_size",t.DdM(18,It))("template",t.WLB(19,qt,a,o)),t.xp6(),t.Q6J("matMenuTriggerFor",e),t.xp6(7),t.Q6J("ngModel",i.search.getValue())("ngModelOptions",t.DdM(22,Dt)),t.xp6(2),t.Q6J("ngForOf",t.Dn7(38,10,t.lcZ(39,14,i.new_playlists),0,8))}}function Nt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"footer",33)(1,"button",34),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.saveDisplay())}),t._uU(2," Save Display "),t.qZA()()}}function Qt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",35)(1,"button",36),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.changeOrder(o,-1))}),t.TgZ(2,"app-icon"),t._uU(3,"arrow_upward"),t.qZA()(),t.TgZ(4,"button",37),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.changeOrder(o,1))}),t.TgZ(5,"app-icon"),t._uU(6,"arrow_downward"),t.qZA()(),t.TgZ(7,"button",38),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.previewPlaylist(o))}),t.TgZ(8,"app-icon"),t._uU(9,"visibility"),t.qZA()(),t.TgZ(10,"button",39),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.removePlaylist(o))}),t.TgZ(11,"app-icon"),t._uU(12,"delete"),t.qZA()()()}if(2&n){const e=l.first,i=l.last;t.xp6(),t.Q6J("disabled",e),t.xp6(3),t.Q6J("disabled",i)}}function jt(n,l){if(1&n&&(t.TgZ(0,"code",32),t._uU(1),t.ALo(2,"mediaDuration"),t.qZA()),2&n){const e=l.data;t.xp6(),t.hij(" ",t.lcZ(2,1,e)," ")}}function Rt(n,l){1&n&&(t.TgZ(0,"main",40),t._UZ(1,"mat-spinner",41),t.TgZ(2,"p",42),t._uU(3,"Saving Display..."),t.qZA()()),2&n&&(t.xp6(),t.Q6J("diameter",32))}let X=(()=>{class n{constructor(e={},i,a,o){this._data=e,this._state=i,this._dialog=a,this._dialog_ref=o,this.loading=!1,this.display=this._data,this.playlists=(0,f.aj)([this._state.playlists,this._state.media]).pipe((0,h.U)(([s,c])=>s.map(d=>({...d,duration:d.media.reduce((m,T)=>m+(d.media_durations[T]||c.find(({id:y})=>y===T)?.duration||0),0)}))),(0,At.b)(console.log)),this.search=new J.X(""),this.form=new p.cw({id:new p.NI(this.display.id||""),name:new p.NI(this.display.name||"",[p.kI.required]),description:new p.NI(this.display.description||""),orientation:new p.NI(this.display.orientation||"landscape",[p.kI.required]),playlists:new p.NI(this.display.playlists||[])}),this.playlist_list=(0,f.aj)([this.playlists,this.form.valueChanges.pipe((0,j.O)(this.form.getRawValue()))]).pipe((0,h.U)(([s,c])=>(this.form.getRawValue().playlists||[]).map(d=>s.find(m=>m.id===d)||new z({id:d})))),this.new_playlists=(0,f.aj)([this.playlists,this.search,this.form.valueChanges.pipe((0,j.O)(this.form.getRawValue()))]).pipe((0,h.U)(([s,c,d])=>s.filter(m=>!this.form.getRawValue().playlists.includes(m.id)).filter(m=>m.name.toLowerCase().includes(c.toLowerCase()))))}focusSearchInput(){setTimeout(()=>this.search_input.nativeElement?.focus(),100)}saveDisplay(){var e=this;return(0,v.Z)(function*(){e.form.markAllAsTouched(),e.form.updateValueAndValidity(),!e.form.invalid&&(e.loading=!0,yield e._state.saveDisplay(e.form.getRawValue()).catch(i=>{throw(0,g.cB)("Error saving display."),e.loading=!1,i}),e._dialog_ref.close())})()}addPlaylist(e){const{id:i}=e,{playlists:a}=this.form.getRawValue();this.form.patchValue({playlists:[...a,i]})}removePlaylist(e){const{playlists:i}=this.form.getRawValue(),a=i.indexOf(e.id),o=[...i];o.splice(a,1),this.form.patchValue({playlists:o})}changeOrder(e,i){const{playlists:a}=this.form.getRawValue(),o=a.indexOf(e.id),s=[...a];s.splice(o,1),s.splice(o+i,0,e.id),this.form.patchValue({playlists:s})}previewPlaylist(e){}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(x.WI),t.Y36(w),t.Y36(x.uw),t.Y36(x.so))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-display-modal"]],viewQuery:function(i,a){if(1&i&&t.Gf(Ut,5),2&i){let o;t.iGM(o=t.CRH())&&(a.search_input=o.first)}},decls:12,vars:5,consts:[[1,"flex","items-center","justify-between","p-2","border-b","border-base-300"],[1,"px-2"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-2 flex flex-col",3,"formGroup",4,"ngIf","ngIfElse"],["class","p-2 flex items-center justify-end space-x-2 border-t border-base-300",4,"ngIf"],["actions_template",""],["duration_template",""],["load_state",""],["icon","","matRipple","","mat-dialog-close",""],[1,"p-2","flex","flex-col",3,"formGroup"],["for","name"],["required",""],["appearance","outline",1,"w-full"],["matInput","","name","name","placeholder","Name","formControlName","name"],["for","description"],["matInput","","name","description","placeholder","Description","formControlName","description"],["formControlName","orientation"],["value","landscape"],["value","portrait"],["for","media"],[1,"block","w-full","mb-2",3,"dataSource","columns","display_column","column_size","template"],["btn","","matRipple","",1,"w-full",3,"matMenuTriggerFor","click"],[1,"w-[32rem]","max-w-[80vw]"],["media_menu","matMenu"],["appearance","outline",1,"w-[calc(100%-1rem)]","mx-2","no-subscript"],["matPrefix","",1,"text-2xl","-left-1"],["matInput","","placeholder","Media Name",3,"ngModel","ngModelOptions","ngModelChange"],["search_input",""],["mat-menu-item","",3,"click",4,"ngFor","ngForOf"],["mat-menu-item","",3,"click"],[1,"flex","items-center","w-full"],[1,"flex-1","truncate"],[1,"bg-base-300","text-base-content"],[1,"p-2","flex","items-center","justify-end","space-x-2","border-t","border-base-300"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"w-full","flex","items-center","justify-end"],["icon","","matRipple","","matTooltip","Move Playlist to previous item",3,"disabled","click"],["icon","","matRipple","","matTooltip","Move Playlist to next item",3,"disabled","click"],["icon","","matRipple","","matTooltip","Preview Playlist",3,"click"],["icon","","matRipple","","matTooltip","Remove Playlist from Display",1,"text-error",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-8"],[3,"diameter"],[1,"mt-4"]],template:function(i,a){if(1&i&&(t.TgZ(0,"header",0)(1,"h1",1),t._uU(2),t.qZA(),t.YNc(3,St,3,0,"button",2),t.qZA(),t.YNc(4,kt,40,23,"main",3)(5,Nt,3,0,"footer",4)(6,Qt,13,2,"ng-template",null,5,t.W1O)(8,jt,3,3,"ng-template",null,6,t.W1O)(10,Rt,4,1,"ng-template",null,7,t.W1O)),2&i){const o=t.MAs(11);t.xp6(2),t.hij("",a.display.id?"Edit":"New"," Display"),t.xp6(),t.Q6J("ngIf",!a.loading),t.xp6(),t.Q6J("ngIf",!a.loading)("ngIfElse",o),t.xp6(),t.Q6J("ngIf",!a.loading)}},dependencies:[u.sg,u.O5,p.Fj,p.JJ,p.JL,p.On,A.KE,A.TO,A.qo,K.Nt,H.gD,Z.ey,U.VK,U.OP,U.p6,V.gM,N.Ou,x.ZT,Z.wG,p.sg,p.u,C.o,R.C,u.Ov,u.OU,O.C]})}return n})(),w=(()=>{class n{constructor(e,i){this._org=e,this._dialog=i,this._loading=new J.X(!1),this._change=new J.X(0),this._active_upload=new J.X(null),this.loading=this._loading.asObservable(),this.media=(0,f.aj)([this._org.active_building,this._change]).pipe((0,q.h)(([a])=>!!a?.id),(0,D.w)(([a])=>(0,M.rlq)(a.id,"signage-media").pipe((0,k.K)(()=>(0,I.of)({})))),(0,h.U)(a=>(a.details instanceof Array?a.details:null)||[]),(0,lt.d)(1)),this.playlists=(0,f.aj)([this._org.active_building,this._change]).pipe((0,q.h)(([a])=>!!a?.id),(0,D.w)(([a])=>(0,M.rlq)(a.id,"signage-playlists").pipe((0,k.K)(()=>(0,I.of)({})))),(0,h.U)(a=>a.details instanceof Array?a.details:[])),this.displays=(0,f.aj)([this._org.active_building,this._change]).pipe((0,q.h)(([a])=>!!a?.id),(0,D.w)(([a])=>(0,M.rlq)(a.id,"signage-displays").pipe((0,k.K)(()=>(0,I.of)({})))),(0,h.U)(a=>a.details instanceof Array?a.details:[])),this.zones=(0,f.aj)([this._org.active_building,this._change]).pipe((0,q.h)(([a])=>!!a?.id),(0,D.w)(([a])=>(0,M.I0G)({parent_id:a.id,tags:"signage",limit:100}).pipe((0,k.K)(()=>(0,I.of)({data:[]})))),(0,h.U)(a=>a.data||[]))}editPlaylist(e=new z){this._dialog.open($,{data:e}).afterClosed().subscribe(()=>this._change.next(Date.now()))}savePlaylist(e,i=!1){var a=this;return(0,v.Z)(function*(){const o=a._org.building.id,s=(yield a.playlists.pipe((0,G.q)(1)).toPromise())||[],c=s.findIndex(d=>d.id===e.id);c>=0&&s.splice(c,1),e.id||(e.id=`playlist-${(0,g.O1)(8)}`),i||s.push(e),yield(0,M.Ymr)(o,{name:"signage-playlists",details:s,description:"Playlists for signage displays"}).toPromise(),(0,g.t5)(`Successfully ${i?"removed":"saved"} playlist.`),a._change.next(Date.now())})()}removePlaylist(e){var i=this;return(0,v.Z)(function*(){yield i.savePlaylist(e,!0)})()}editDisplay(e=new rt){this._dialog.open(X,{data:e}).afterClosed().subscribe(()=>this._change.next(Date.now()))}saveDisplay(e,i=!1){var a=this;return(0,v.Z)(function*(){const o=a._org.building.id,s=yield a.displays.pipe((0,G.q)(1)).toPromise(),c=s.findIndex(d=>d.id===e.id);c>=0&&s.splice(c,1),e.id||(e.id=`display-${(0,g.O1)(8)}`),i||s.push(e),yield(0,M.Ymr)(o,{name:"signage-displays",details:s,description:"Displays for signage displays"}).toPromise(),(0,g.t5)(`Successfully ${i?"removed":"saved"} display.`),a._change.next(Date.now())})()}removeDisplay(e){var i=this;return(0,v.Z)(function*(){yield i.saveDisplay(e,!0)})()}previewMedia(e){const{url:i,type:a,name:o}=e;this._dialog.open(Q,{data:{url:i,type:a,name:o,save:!1}}).afterClosed().subscribe(()=>URL.revokeObjectURL(i))}previewFileMedia(e){var i=this;const a=URL.createObjectURL(e),o=e.type.includes("image")?"image":"video",s=this._dialog.open(Q,{data:{url:a,type:o,name:e.name,save:!0,file:e}});s.afterClosed().subscribe(()=>URL.revokeObjectURL(a)),s.componentInstance.save.subscribe((0,v.Z)(function*(){s.componentInstance.loading="Saving...",yield i.addMedia(e).catch(c=>{throw(0,g.cB)("Error saving media."),s.componentInstance.loading="",c}),s.close()}))}addMedia(e){var i=this;return(0,v.Z)(function*(){const o=yield new Promise((y,S)=>{let _=null,L=!1;(0,g.cT)(e).subscribe(P=>{_=P,P.link&&(L=!0,y(P.link))},S,()=>L?null:y(_))}),s=yield i.media.pipe((0,G.q)(1)).toPromise(),c=new Promise(y=>{const S=URL.createObjectURL(e);if(e.type.includes("video")){let _=document.createElement("video");_.src=S.toString(),_.addEventListener("loadedmetadata",()=>{const{videoWidth:L,videoHeight:P}=_;y([L>P,m])}),_.load()}else{let _=new Image;_.onload=()=>y([_.width>_.height,0]),_.src=S.toString()}}),[d,m]=yield c;s.push({id:`media-${(0,g.O1)(8)}`,name:e.name,description:"",url:o,type:e.type.includes("image")?"image":"video",orientation:d?"landscape":"portrait",duration:m||15});const T=i._org.building.id;yield(0,M.Ymr)(T,{name:"signage-media",details:s,description:"Media for signage displays"}).toPromise(),i._active_upload.next(null),i._change.next(Date.now())})()}static#t=this.\u0275fac=function(i){return new(i||n)(t.LFG(Y.w7),t.LFG(x.uw))};static#e=this.\u0275prov=t.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var Ft=r(3005),Lt=r(9842),F=r(4104);const Gt=["app-new-staff",""];function Et(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",8),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.newItem(a.active_link))}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(),t.hij(" Add ",e.singular(e.active_link)," ")}}function Yt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"a",9),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.active_link=o)}),t.ALo(1,"lowercase"),t._uU(2),t.qZA()}if(2&n){const e=l.$implicit,i=t.oxw();t.Q6J("routerLink","/signage/"+t.lcZ(1,3,e))("active",i.active_link==e),t.xp6(2),t.hij(" ",e," ")}}let B=(()=>{class n extends g.cx{singular(e){return e.replace(/s$/,"")}newItem(e){switch(e){case"Playlists":this._state.editPlaylist();break;case"Displays":this._state.editDisplay()}}constructor(e,i){super(),this._state=e,this._router=i,this.loading=this._state.loading,this.links=["Playlists","Media","Displays","Zones","Triggers"],this.active_link=this.links[0]}ngOnInit(){this.subscription("route.query",this._router.events.subscribe(e=>{e instanceof b.m2&&(this.active_link=this.links.find(i=>this._router.url.includes(i.toLowerCase())))})),this.active_link=this.links.find(e=>this._router.url.includes(e.toLowerCase()))}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(w),t.Y36(b.F0))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["","app-new-staff",""]],features:[t.qOj],attrs:Gt,decls:14,vars:3,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"p-8","h-28","flex","items-center","justify-between"],[1,"text-2xl","font-medium"],["btn","","matRipple","","class","w-32",3,"click",4,"ngIf"],["mat-tab-nav-bar","",3,"tabPanel"],[1,"flex-1","h-1/2","overflow-auto"],["tabPanel",""],["btn","","matRipple","",1,"w-32",3,"click"],["mat-tab-link","",3,"routerLink","active","click"],["mat-tab-link","",3,"routerLink","active"]],template:function(i,a){if(1&i&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1)(4,"div",2)(5,"h2",3),t._uU(6),t.qZA(),t.YNc(7,Et,2,1,"button",4),t.qZA(),t.TgZ(8,"nav",5),t.SjG(9,Yt,3,5,"a",10,t.x6l),t.qZA(),t.TgZ(11,"mat-tab-nav-panel",6,7),t._UZ(13,"router-outlet"),t.qZA()()()),2&i){const o=t.MAs(12);t.xp6(6),t.hij(" Signage - ",a.active_link," "),t.xp6(),t.Q6J("ngIf","Media"!==a.active_link),t.xp6(),t.Q6J("tabPanel",o),t.xp6(),t.wJu(a.links)}},dependencies:[u.O5,Ft.O,Lt.u,Z.wG,b.lC,b.rH,F.BU,F.sW,F.Nj,u.i8],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}"]})}return n})();var zt=r(8419);let Kt=(()=>{class n extends g.cx{constructor(e,i,a,o){super(),this._state=e,this._org=i,this._route=a,this._router=o,this.zones=[],this.levels=this._org.active_levels}ngOnInit(){var e=this;return(0,v.Z)(function*(){yield e._org.initialised.pipe((0,zt.P)(i=>i)).toPromise(),e.subscription("route.query",e._route.queryParamMap.subscribe(i=>{if(i.has("zone_ids")){const a=i.get("zone_ids").split(",");if(a.length){const o=e._org.levelWithID(a);if(!o)return;e._org.building=e._org.buildings.find(s=>s.id===o.parent_id),e.zones=a}}})),e.subscription("levels",e._org.active_levels.subscribe(i=>{e.zones=e.zones.filter(a=>i.find(o=>o.id===a)),!e.zones.length&&i.length&&e.zones.push(i[0].id)}))})()}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(w),t.Y36(Y.w7),t.Y36(b.gz),t.Y36(b.F0))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-topbar"]],features:[t.qOj],decls:1,vars:0,consts:[[1,"flex","items-center","bg-base-100","h-20","px-4","border-b","border-base-200","space-x-2"]],template:function(i,a){1&i&&t._UZ(0,"div",0)},styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25em;width:8em}"]})}return n})();var tt=r(4025);function Ht(n,l){1&n&&t._uU(0),2&n&&t.hij(" ",l.row.media.length," Media Item(s) ")}function Vt(n,l){if(1&n&&(t.TgZ(0,"code"),t._uU(1),t.ALo(2,"mediaDuration"),t.qZA()),2&n){const e=l.row;t.xp6(),t.Oqu(t.lcZ(2,1,e.duration))}}function Wt(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",5),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.editItem(o))}),t.TgZ(1,"app-icon"),t._uU(2,"edit"),t.qZA()(),t.TgZ(3,"button",6),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.deleteItem(o))}),t.TgZ(4,"app-icon"),t._uU(5,"delete"),t.qZA()()}}function $t(n,l){1&n&&t._UZ(0,"mat-progress-bar",7)}const Xt=()=>["name","description","media","duration","actions"],Bt=()=>["Name","Description","Media","Duration"," "],te=()=>["8r","flex","10r","6r","5r"],ee=(n,l,e)=>({media:n,duration:l,actions:e});let et=(()=>{class n{constructor(e){this._state=e,this.loading=this._state.loading,this.playlists=this._state.playlists,this.media=this._state.media,this.deleteItem=i=>this._state.removePlaylist(i),this.editItem=i=>this._state.editPlaylist(i),this.playlist_list=(0,f.aj)([this.playlists,this.media]).pipe((0,h.U)(([i,a])=>i.map(o=>({...o,duration:o.media.reduce((s,c)=>s+(o.media_durations[c]||a.find(d=>d.id===c)?.duration||15),0)}))))}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-playlists"]],decls:9,vars:15,consts:[[1,"block","min-w-[48rem]",3,"dataSource","columns","display_column","column_size","template"],["media_template",""],["duration_template",""],["actions_template",""],["class","absolute inset-x-0 bottom-0","mode","indeterminate",4,"ngIf"],["icon","","matRipple","",3,"click"],["icon","","matRipple","",1,"text-error",3,"click"],["mode","indeterminate",1,"absolute","inset-x-0","bottom-0"]],template:function(i,a){if(1&i&&(t._UZ(0,"custom-table",0),t.YNc(1,Ht,1,1,"ng-template",null,1,t.W1O)(3,Vt,3,3,"ng-template",null,2,t.W1O)(5,Wt,6,0,"ng-template",null,3,t.W1O)(7,$t,1,0,"mat-progress-bar",4),t.ALo(8,"async")),2&i){const o=t.MAs(2),s=t.MAs(4),c=t.MAs(6);t.Q6J("dataSource",a.playlist_list)("columns",t.DdM(8,Xt))("display_column",t.DdM(9,Bt))("column_size",t.DdM(10,te))("template",t.kEZ(11,ee,o,s,c)),t.xp6(7),t.Q6J("ngIf",t.lcZ(8,6,a.loading))}},dependencies:[u.O5,tt.pW,Z.wG,C.o,R.C,u.Ov,O.C]})}return n})();function ie(n,l){1&n&&t._uU(0),2&n&&t.hij(" ",l.row.playlists.length," Playlist(s) ")}function ne(n,l){if(1&n&&(t.TgZ(0,"code"),t._uU(1),t.ALo(2,"mediaDuration"),t.qZA()),2&n){const e=l.row;t.xp6(),t.Oqu(t.lcZ(2,1,e.duration))}}function ae(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",5),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.editItem(o))}),t.TgZ(1,"app-icon"),t._uU(2,"edit"),t.qZA()(),t.TgZ(3,"button",6),t.NdJ("click",function(){const o=t.CHM(e).row,s=t.oxw();return t.KtG(s.deleteItem(o))}),t.TgZ(4,"app-icon"),t._uU(5,"delete"),t.qZA()()}}function oe(n,l){1&n&&t._UZ(0,"mat-progress-bar",7)}const se=()=>["name","description","playlists","orientation","duration","actions"],le=()=>["Name","Description","Media","Orientation","Duration"," "],re=()=>["8r","flex","8r","7r","6r","5r"],ce=(n,l,e)=>({playlists:n,duration:l,actions:e});let it=(()=>{class n{constructor(e){this._state=e,this.loading=this._state.loading,this.displays=this._state.displays,this.playlists=this._state.playlists,this.media=this._state.media,this.deleteItem=i=>this._state.removePlaylist(i),this.editItem=i=>this._state.editPlaylist(i),this.display_list=(0,f.aj)([this.displays,this.playlists,this.media]).pipe((0,h.U)(([i,a,o])=>(i||[]).map(s=>({...s,playlists:s.playlists?.map(c=>a.find(d=>d.id===c))||[],duration:s.playlists.reduce((c,d)=>{const m=a.find(T=>T.id===d);return m?c+m.media.reduce((T,y)=>T+(m.media_durations[y]||o.find(S=>S.id===y)?.duration||15),0):c},0)}))))}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-displays"]],decls:9,vars:15,consts:[[1,"block","min-w-[52rem]",3,"dataSource","columns","display_column","column_size","template"],["playlists_template",""],["duration_template",""],["actions_template",""],["class","absolute inset-x-0 bottom-0","mode","indeterminate",4,"ngIf"],["icon","","matRipple","",3,"click"],["icon","","matRipple","",1,"text-error",3,"click"],["mode","indeterminate",1,"absolute","inset-x-0","bottom-0"]],template:function(i,a){if(1&i&&(t._UZ(0,"custom-table",0),t.YNc(1,ie,1,1,"ng-template",null,1,t.W1O)(3,ne,3,3,"ng-template",null,2,t.W1O)(5,ae,6,0,"ng-template",null,3,t.W1O)(7,oe,1,0,"mat-progress-bar",4),t.ALo(8,"async")),2&i){const o=t.MAs(2),s=t.MAs(4),c=t.MAs(6);t.Q6J("dataSource",a.display_list)("columns",t.DdM(8,se))("display_column",t.DdM(9,le))("column_size",t.DdM(10,re))("template",t.kEZ(11,ce,o,s,c)),t.xp6(7),t.Q6J("ngIf",t.lcZ(8,6,a.loading))}},dependencies:[u.O5,tt.pW,Z.wG,C.o,R.C,u.Ov,O.C]})}return n})(),nt=(()=>{class n{constructor(e){this._state=e,this.loading=this._state.loading}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-zones"]],decls:0,vars:0,template:function(i,a){}})}return n})(),at=(()=>{class n{constructor(e){this._state=e,this.loading=this._state.loading}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-triggers"]],decls:0,vars:0,template:function(i,a){}})}return n})();var pe=r(4579);function de(n,l){if(1&n&&(t._UZ(0,"img",18),t.ALo(1,"thumbnail")),2&n){const e=t.oxw().$implicit;t.Q6J("src","video"===e.type?t.lcZ(1,1,e.url):e.url,t.LSH)}}function me(n,l){if(1&n&&(t.TgZ(0,"div",19),t._UZ(1,"div",11),t.TgZ(2,"div",12),t._uU(3),t.ALo(4,"mediaDuration"),t.qZA()()),2&n){const e=t.oxw().$implicit;t.xp6(3),t.hij(" ",t.lcZ(4,1,e.duration)," ")}}function ue(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",7)(1,"button",8),t.NdJ("click",function(){const o=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.previewMedia(o))}),t.YNc(2,de,2,3,"img",9),t.ALo(3,"thumbnail"),t.TgZ(4,"div",10),t._UZ(5,"div",11),t.TgZ(6,"div",12),t._uU(7),t.qZA()(),t.TgZ(8,"div",13),t._UZ(9,"div",11),t.TgZ(10,"div",12),t._uU(11),t.qZA()(),t.YNc(12,me,5,3,"div",14),t.qZA(),t.TgZ(13,"div",15)(14,"div",16),t._uU(15),t.qZA(),t.TgZ(16,"button",17)(17,"app-icon"),t._uU(18,"more_vert"),t.qZA()()()()}if(2&n){const e=l.$implicit,i=t.oxw(3);t.xp6(2),t.Q6J("ngIf","video"===e.type?t.lcZ(3,5,e.url):e.url),t.xp6(5),t.hij(" ","image"===e.type?"Image":"Video"," "),t.xp6(4),t.hij(" ",i.count||0," Playlist(s) "),t.xp6(),t.Q6J("ngIf",e.duration),t.xp6(3),t.hij(" ",e.name," ")}}function ge(n,l){if(1&n&&(t.ynx(0),t.TgZ(1,"div",5),t.YNc(2,ue,19,7,"div",6),t.ALo(3,"async"),t.qZA(),t.BQk()),2&n){const e=t.oxw(2);t.xp6(2),t.Q6J("ngForOf",t.lcZ(3,1,e.media))}}function _e(n,l){if(1&n&&(t.ynx(0),t.YNc(1,ge,4,3,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&n){const e=t.oxw(),i=t.MAs(5);let a;t.xp6(),t.Q6J("ngIf",null==(a=t.lcZ(2,2,e.media))?null:a.length)("ngIfElse",i)}}function fe(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"div",20),t._UZ(1,"div",21)(2,"div",22),t.TgZ(3,"div",23)(4,"app-icon",24),t._uU(5,"upload"),t.qZA(),t.TgZ(6,"p"),t._uU(7,"Drop file to upload file"),t.qZA()(),t.TgZ(8,"input",25),t.NdJ("change",function(a){t.CHM(e);const o=t.oxw();return t.KtG(o.previewFile(a))}),t.qZA()()}}function he(n,l){1&n&&(t.TgZ(0,"div",26)(1,"app-icon",24),t._uU(2,"hide_image"),t.qZA(),t.TgZ(3,"p"),t._uU(4,"No media found."),t.qZA()())}function xe(n,l){1&n&&(t.TgZ(0,"div",27),t._UZ(1,"mat-spinner",28),t.TgZ(2,"p"),t._uU(3,"Loading..."),t.qZA()())}let ot=(()=>{class n extends g.cx{onEnter(e){this.show_dropzone=e?.dataTransfer?.types.includes("Files")}hideOverlay(e){e.target instanceof HTMLInputElement||e.preventDefault(),this.timeout("hide_overlay",()=>this.show_dropzone=!1)}constructor(e){super(),this._state=e,this.loading=this._state.loading,this.media=this._state.media,this.show_dropzone=!1,this.previewMedia=i=>this._state.previewMedia(i)}previewFile(e){const i=e.target;if(!i?.files?.length)return;const o=i.files[0];o&&(o.type.includes("image")||o.type.includes("video"))?this._state.previewFileMedia(o):(0,g.cB)("Invalid file type.")}static#t=this.\u0275fac=function(i){return new(i||n)(t.Y36(w))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["signage-media"]],features:[t.qOj],decls:8,vars:5,consts:[[1,"relative","bg-base-200","min-h-full","w-full",3,"dragenter","drop"],[4,"ngIf","ngIfElse"],["class","absolute inset-0",4,"ngIf"],["empty_template",""],["load_template",""],[1,"flex","flex-wrap","items-start","justify-start","w-full","p-2"],["class","m-2 p-2 bg-base-100 rounded-lg overflow-hidden h-[13rem] w-[17rem] border border-base-300 shadow",4,"ngFor","ngForOf"],[1,"m-2","p-2","bg-base-100","rounded-lg","overflow-hidden","h-[13rem]","w-[17rem]","border","border-base-300","shadow"],[1,"w-64","h-36","overflow-hidden","bg-base-200","rounded","m-0","p-0","relative",3,"click"],["class","object-contain w-full h-full",3,"src",4,"ngIf"],[1,"absolute","top-2","left-2","flex","items-center","justify-center","rounded","overflow-hidden"],[1,"absolute","inset-0","bg-base-content","opacity-60","z-0"],[1,"relative","text-base-100","z-10","px-2","py-1","text-xs"],[1,"absolute","top-2","right-2","flex","items-center","justify-center","rounded","overflow-hidden"],["class","absolute bottom-2 right-2 flex items-center justify-center rounded overflow-hidden",4,"ngIf"],[1,"flex","items-center","justify-between","space-x-2"],[1,"truncate","flex-1","w-1/2","px-2"],["icon","","matRipple",""],[1,"object-contain","w-full","h-full",3,"src"],[1,"absolute","bottom-2","right-2","flex","items-center","justify-center","rounded","overflow-hidden"],[1,"absolute","inset-0"],[1,"absolute","inset-0","bg-base-200"],[1,"absolute","inset-0","bg-base-content","opacity-70"],[1,"absolute","inset-4","border-4","border-dashed","border-neutral","text-base-100","rounded-xl","flex","flex-col","items-center","justify-center"],[1,"text-8xl"],["type","file",1,"absolute","inset-0","w-full","opacity-0",3,"change"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2","opacity-30"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"]],template:function(i,a){if(1&i&&(t.TgZ(0,"div",0),t.NdJ("dragenter",function(s){return a.onEnter(s)},!1,t.evT)("drop",function(s){return a.hideOverlay(s)},!1,t.evT),t.YNc(1,_e,3,4,"ng-container",1),t.ALo(2,"async"),t.YNc(3,fe,9,0,"div",2),t.qZA(),t.YNc(4,he,5,0,"ng-template",null,3,t.W1O)(6,xe,4,0,"ng-template",null,4,t.W1O)),2&i){const o=t.MAs(7);t.xp6(),t.Q6J("ngIf",!t.lcZ(2,3,a.loading))("ngIfElse",o),t.xp6(2),t.Q6J("ngIf",a.show_dropzone)}},dependencies:[u.sg,u.O5,N.Ou,Z.wG,C.o,u.Ov,O.C,pe.m],styles:["[_nghost-%COMP%]{min-height:100%}"]})}return n})();var ye=r(1862);const ve=[{path:"",component:B,children:[{path:"",redirectTo:"playlists",pathMatch:"full"},{path:"playlists",component:et},{path:"media",component:ot},{path:"displays",component:it},{path:"zones",component:nt},{path:"triggers",component:at},{path:"*",redirectTo:"playlists",pathMatch:"full"}]}],Ze=[B,Kt,et,ot,it,nt,at,Q,$,X];let we=(()=>{class n{static#t=this.\u0275fac=function(i){return new(i||n)};static#e=this.\u0275mod=t.oAB({type:n});static#i=this.\u0275inj=t.cJS({imports:[u.ez,p.u5,st.v,ye.Kk,b.Bz.forChild(ve),F.Nh]})}return n})()}}]);