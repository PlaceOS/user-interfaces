"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([[614],{9614:(mo,Ht,f)=>{f.r(Ht),f.d(Ht,{ReportsModule:()=>uo});var x=f(4755),X=f(9401),B=f(5055),Ae=f(3045),Te=f(3276),t=f(2223),Me=f(4945),w=f(1426),it=f(1217),V=f(5306);const Oe=function(){return["/reports","desks"]};function Re(o,n){1&o&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2,"room"),t.qZA(),t.TgZ(3,"h3",6),t._uU(4,"Desks"),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,Oe))}const Ue=function(){return["/reports","bookings"]};function Le(o,n){1&o&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2,"meeting_room"),t.qZA(),t.TgZ(3,"h3",6),t._uU(4,"Rooms"),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,Ue))}const Ne=function(){return["/reports","catering"]};function Se(o,n){1&o&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2,"room_service"),t.qZA(),t.TgZ(3,"h3",6),t._uU(4,"Catering"),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,Ne))}const Ee=function(){return["/reports","contact-tracing"]};function ke(o,n){1&o&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2,"connect_without_contact"),t.qZA(),t.TgZ(3,"h3",6),t._uU(4,"Contact Tracing"),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&o&&t.Q6J("routerLink",t.DdM(1,Ee))}const De=function(o){return["/reports",o]};function Ye(o,n){if(1&o&&(t.TgZ(0,"a",4)(1,"app-icon",5),t._uU(2),t.qZA(),t.TgZ(3,"h3",6),t._uU(4),t.qZA(),t.TgZ(5,"div",7)(6,"p"),t._uU(7,"View Report"),t.qZA(),t.TgZ(8,"app-icon",8),t._uU(9,"chevron_right"),t.qZA()()()),2&o){const e=n.$implicit;t.Q6J("routerLink",t.VKq(3,De,e.id)),t.xp6(2),t.Oqu(e.icon),t.xp6(2),t.Oqu(e.name)}}const ze=["desks","spaces","catering","contact-tracing"];let $t=(()=>{class o{get custom_reports(){return this._settings.get("app.custom_reports")||[]}get features(){return this._settings.get("app.reports.features")||ze}constructor(e){this._settings=e}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(w.gb))},o.\u0275cmp=t.Xpm({type:o,selectors:[["reports-menu"],["","reports-menu",""]],decls:7,vars:5,consts:[[1,"absolute","inset-0","flex","items-center","justify-center","bg-gray-100","overflow-auto"],[1,"grid","w-full","justify-items-center"],["matRipple","","class","h-64 w-64 p-4 flex flex-col items-center justify-center bg-white dark:bg-neutral-700 rounded shadow hover:opacity-80 border border-gray-200",3,"routerLink",4,"ngIf"],["matRipple","","class","h-64 w-64 p-4 flex flex-col items-center justify-center bg-white dark:bg-neutral-700 rounded shadow hover:opacity-80 border border-gray-200",3,"routerLink",4,"ngFor","ngForOf"],["matRipple","",1,"h-64","w-64","p-4","flex","flex-col","items-center","justify-center","bg-white","dark:bg-neutral-700","rounded","shadow","hover:opacity-80","border","border-gray-200",3,"routerLink"],[1,"text-8xl"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center"],[1,"ml-2"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.YNc(2,Re,10,2,"a",2),t.YNc(3,Le,10,2,"a",2),t.YNc(4,Se,10,2,"a",2),t.YNc(5,ke,10,2,"a",2),t.YNc(6,Ye,10,5,"a",3),t.qZA()()),2&e&&(t.xp6(2),t.Q6J("ngIf",s.features.includes("desks")),t.xp6(1),t.Q6J("ngIf",s.features.includes("spaces")),t.xp6(1),t.Q6J("ngIf",s.features.includes("catering")),t.xp6(1),t.Q6J("ngIf",s.features.includes("contact-tracing")),t.xp6(1),t.Q6J("ngForOf",s.custom_reports))},dependencies:[x.sg,x.O5,it.wG,V.o,B.rH],styles:["[_nghost-%COMP%]{display:flex;flex-direction:row!important;align-items:center;justify-content:center;background:inherit}.grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(16rem,1fr));gap:1rem}"]}),o})();const Ie=["app-reports",""];function je(o,n){1&o&&t._UZ(0,"div",3)}let Be=(()=>{class o{get path(){const e=this._router.url.split("/");return e[e.length-1]}constructor(e){this._router=e}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(B.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["","app-reports",""]],attrs:Ie,decls:4,vars:1,consts:[[1,"h-full"],[1,"relative","overflow-hidden","flex","flex-col","flex-1","w-1/2","h-full","bg-gray-300","dark:bg-neutral-600"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(e,s){1&e&&(t._UZ(0,"sidebar",0),t.TgZ(1,"main",1),t._UZ(2,"router-outlet"),t.YNc(3,je,1,0,"div",2),t.qZA()),2&e&&(t.xp6(3),t.Q6J("ngIf","reports"===s.path))},dependencies:[x.O5,Me.k,B.lC,$t],styles:["[_nghost-%COMP%]{display:flex;height:100%;width:100%}main[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(router-outlet){display:flex;flex-direction:column;width:100%;height:100%}"]}),o})();var qe=f(2886),ft=f(7577),D=f(5861),Pe=f(7224),J=f(5912),Kt=f(8186),Je=f(5375),Nt=f(1320),St=f(5882),tt=f(8115),Qe=f(9756),et=f(2722),_t=f(9972),Fe=f(4960),Et=f(5650),G=f(9925),Xe=f(8929),nt=f(591),W=f(1086),Q=f(3426),vt=f(13),at=f(7545),xt=f(7221),Z=f(4850),q=f(5154),We=f(6198);let E=(()=>{class o{get duration(){const e=this._options.getValue();return Math.max(1,Math.abs((0,St.Z)((0,tt.Z)(e.start),(0,Qe.Z)((0,et.Z)(e.end),1))))}constructor(e){var s=this;this._org=e,this._space_pipe=new We.X(this._org),this._generate=new Xe.xQ,this._loading=new nt.X(""),this._active_bookings=new nt.X([]),this._options=new nt.X({start:new Date,end:new Date}),this._bookings_list=this._generate.pipe((0,vt.b)(500),(0,at.w)(r=>{const i=this._options.getValue();if(this._loading.next("Loading report details..."),!i?.type&&!i?.zones?.length)return(0,W.of)([]);const a=(0,tt.Z)(i.start||Date.now()),l=(0,et.Z)(i.end||a),d=i?.zones?i.zones.filter(c=>"All"!==c).join(","):"",u={period_start:(0,_t.Z)(a),period_end:(0,_t.Z)(l)};return"desks"===i.type?(0,Je.NP)({...u,zones:d,type:"desk",limit:1e3}):(0,Nt.CA)({...u,zone_ids:d,limit:1e3}).pipe((0,at.w)(function(){var c=(0,D.Z)(function*(g){return Promise.all(g.map(function(){var p=(0,D.Z)(function*(h){return new Nt.ym({...h,resources:yield Promise.all(h.resources.map(m=>s._space_pipe.transform(m.id||m.email)))})});return function(h){return p.apply(this,arguments)}}()))});return function(g){return c.apply(this,arguments)}}()))}),(0,xt.K)(r=>[]),(0,Z.U)(r=>(this._loading.next(""),r?.length||(0,w.cB)("No bookings for the selected levels and period"),this._active_bookings.next(r||[]),r)),(0,q.d)()),this.loading=this._loading.asObservable(),this.options=this._options.asObservable(),this.bookings=this._active_bookings.asObservable(),this.counts=this._options.pipe((0,vt.b)(500),(0,at.w)(r=>{const i=(r.zones||[]).filter(a=>-1!==a&&"All"!==a);return Promise.all(i.map(a=>(0,Kt.rlq)(a,"desks").pipe((0,Z.U)(l=>[a,l.details.length])).toPromise()))}),(0,xt.K)(r=>[]),(0,Z.U)(r=>{const i={};return this._active_bookings.next([]),r.forEach(([a,l])=>i[a]=l),i}),(0,q.d)()),this.stats=(0,Q.aj)([this.counts,this.bookings]).pipe((0,at.w)(function(){var r=(0,D.Z)(function*([i,a]){return a[0]instanceof Nt.ym?function Ge(o,n=8){n=Math.max(1,n);const e=o.reduce((a,l)=>a+l.attendees.length,0),s=o.reduce((a,l)=>a+l.system?.capacity,0),r=Math.floor(o.reduce((a,l)=>a+l.duration,0)/(60*n)*100)/100,i=Math.floor(e/s*100)/100;return{count:o.length,avg_length:Math.floor(o.reduce((a,l)=>a+l.duration,0)/o.length*100)/100,efficiency:Math.floor((r+i)/2*100)/100,total_users:e,total_capacity:s,occupancy:i,utilisation:r,events:o}}(a,8*s.duration):function Ve(o,n=1,e={}){n=Math.max(1,n);const s=Object.keys(e).reduce((i,a)=>i+(e[a]||0),0),r=Math.floor(o.length/s/n*1e4)/1e4;return{total:s,count:o.length,utilisation:r,events:o}}(a||[],s.duration,i)});return function(i){return r.apply(this,arguments)}}())),this.day_list=(0,Q.aj)([this.options,this.stats]).pipe((0,Z.U)(([r,i])=>{const{start:a}=r;let l=(0,tt.Z)(a);const d=(0,et.Z)(r.end||l),u=[];for(;(0,Fe.Z)(l,d);){const c=(0,tt.Z)(l).valueOf(),g=(0,et.Z)(c).valueOf(),p=i.events.filter(h=>(0,w.MZ)(c,g,h.date,h.date+60*h.duration*1e3));u.push({date:c,total:i.total,usage:(0,w.Tw)(p,"asset_id").length,free:i.total-p.length,approved:p.reduce((h,m)=>h+(m.approved?1:0),0),count:p.length,utilisation:(p.length/i.total*100).toFixed(1)}),l=(0,Et.Z)(l,1)}return u}),(0,q.d)(1)),this._bookings_list.subscribe(r=>r)}generateReport(){this._generate.next((new Date).valueOf())}setOptions(e){e.zones?.includes("All")?e.zones=["All",...this._org.levelsForBuilding(this._org.building).map(s=>s.id)]:e.zones&&this._options.getValue()?.zones?.includes("All")&&(e.zones=[]),e.start?.valueOf()!==this._options.getValue().start?.valueOf()&&e.end?.valueOf()!==this._options.getValue().end?.valueOf()&&this._options.next({...this._options.getValue(),...e})}downloadReport(){const e=this._options.getValue(),s=this._active_bookings.getValue();(0,w.Sv)(`report+${e.type}+${(0,G.Z)(e.start,"yyyy-MM-dd")}+${(0,G.Z)(e.end,"yyyy-MM-dd")}.csv`,(0,w.o3)(s.map(r=>{const i=r.toJSON();return delete i.zones,delete i.server_names,delete i.extension_data,i})))}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(J.w7))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var yt=f(9114),He=f(787),z=f(8280),wt=f(8467);function $e(o,n){if(1&o&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&o){const e=n.$implicit;t.Q6J("value",e.id),t.xp6(1),t.hij(" ",e.display_name||e.name," ")}}function Ke(o,n){1&o&&t._UZ(0,"mat-spinner",15),2&o&&t.Q6J("diameter",32)}function tn(o,n){1&o&&(t.TgZ(0,"p"),t._uU(1,"Generate Report"),t.qZA())}let Zt=(()=>{class o extends w.cx{constructor(e,s,r,i){super(),this._state=e,this._org=s,this._route=r,this._router=i,this.zones=[],this.types=[{id:"internal",name:"Internal"},{id:"external",name:"External"},{id:"cancelled",name:"Cancelled"}],this.type_list=this.types.map(a=>`${a.id}`),this.levels=this._org.active_levels,this.loading=this._state.loading,this.bookings=this._state.bookings,this.options=this._state.options,this.page="",this.generateReport=()=>this._state.generateReport(),this.downloadReport=()=>this._state.downloadReport(),this.setStartDate=a=>this._state.setOptions({start:new Date(a)}),this.setEndDate=a=>this._state.setOptions({end:new Date(a)}),this.setZones=a=>this._state.setOptions({zones:a})}ngOnInit(){var e=this;return(0,D.Z)(function*(){yield e._org.initialised.pipe((0,Pe.P)(s=>s)).toPromise(),e.page=e._router.url,e.subscription("routing",e._router.events.subscribe(()=>{e.page=e._router.url})),e.subscription("route.query",e._route.queryParamMap.subscribe(s=>{if(s.has("zone_ids")){const r=s.get("zone_ids").split(",");if(r.length){const i=e._org.levelWithID(r);if(!i)return;e._org.building=e._org.buildings.find(a=>a.id===i.parent_id),e.setZones(r)}}}))})()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E),t.Y36(J.w7),t.Y36(B.gz),t.Y36(B.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["reports-options"]],features:[t.qOj],decls:28,vars:28,consts:[[1,"bg-white","dark:bg-neutral-700","h-20","w-full","flex","items-center","px-2","shadow","z-20","border-b","border-gray-200"],["appearance","outline",1,"w-48"],["multiple","","placeholder","Select Levels...",3,"ngModel","ngModelChange"],["value","All"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-64"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["btn","","matRipple","",1,"ml-4",3,"disabled","click"],[3,"diameter",4,"ngIf"],[4,"ngIf"],[3,"value"],[3,"diameter"]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-select",2),t.NdJ("ngModelChange",function(i){return s.setZones(i)}),t.ALo(3,"async"),t.TgZ(4,"mat-option",3),t._uU(5,"All Levels"),t.qZA(),t.YNc(6,$e,2,2,"mat-option",4),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"mat-form-field",5)(9,"mat-date-range-input",6)(10,"input",7),t.NdJ("ngModelChange",function(i){return i?s.setStartDate(i):""}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"input",8),t.NdJ("ngModelChange",function(i){return i?s.setEndDate(i):""}),t.ALo(13,"async"),t.qZA()(),t._UZ(14,"mat-datepicker-toggle",9)(15,"mat-date-range-picker",null,10),t.qZA(),t.TgZ(17,"button",11),t.NdJ("click",function(){return s.generateReport()}),t.ALo(18,"async"),t.ALo(19,"async"),t.YNc(20,Ke,1,1,"mat-spinner",12),t.ALo(21,"async"),t.YNc(22,tn,2,0,"p",13),t.ALo(23,"async"),t.qZA(),t.TgZ(24,"button",11),t.NdJ("click",function(){return s.downloadReport()}),t.ALo(25,"async"),t.TgZ(26,"p"),t._uU(27,"Download Report"),t.qZA()()()),2&e){const r=t.MAs(16);let i,a,l,d,u;t.xp6(2),t.Q6J("ngModel",null==(i=t.lcZ(3,10,s.options))?null:i.zones),t.xp6(4),t.Q6J("ngForOf",t.lcZ(7,12,s.levels)),t.xp6(3),t.Q6J("rangePicker",r),t.xp6(1),t.Q6J("ngModel",null==(a=t.lcZ(11,14,s.options))?null:a.start),t.xp6(2),t.Q6J("ngModel",null==(l=t.lcZ(13,16,s.options))?null:l.end),t.xp6(2),t.Q6J("for",r),t.xp6(3),t.Q6J("disabled",!!t.lcZ(18,18,s.loading)||!(null!=(d=t.lcZ(19,20,s.options))&&null!=d.zones&&d.zones.length)),t.xp6(3),t.Q6J("ngIf",t.lcZ(21,22,s.loading)),t.xp6(2),t.Q6J("ngIf",!t.lcZ(23,24,s.loading)),t.xp6(2),t.Q6J("disabled",!(null!=(u=t.lcZ(25,26,s.bookings))&&u.length))}},dependencies:[x.sg,x.O5,X.Fj,X.JJ,X.On,yt.KE,yt.R9,He.gD,it.ey,z.nW,z.wx,z.zY,z.By,z._g,wt.Ou,it.wG,x.Ov],styles:["button[_ngcontent-%COMP%]{min-width:0;padding:0 .85rem}mat-form-field[_ngcontent-%COMP%]{height:3.25em;margin-left:1em}mat-slide-toggle[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{width:5.5em;white-space:initial;line-height:1.2em}"]}),o})();var en=f(7623),nn=f(2641),te=f(900),kt=f(953),ee=f(833);function sn(o){(0,ee.Z)(1,arguments);var e=(0,kt.Z)(o).getDay();return 0===e||6===e}var on=f(1998),Dt=f(9833);function an(o,n){if(1&o&&(t.TgZ(0,"div",0)(1,"div",3)(2,"h3"),t._uU(3,"No show count"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"div",3)(8,"h3"),t._uU(9,"% of No show Bookings"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",3)(14,"h3"),t._uU(15,"Total in-room attendance"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"async"),t.qZA()()()),2&o){const e=t.oxw();t.xp6(5),t.Oqu(t.lcZ(6,3,e.no_shows)||0),t.xp6(6),t.hij("",t.lcZ(12,5,e.no_show_percent)||0,"%"),t.xp6(6),t.Oqu(t.lcZ(18,7,e.attendance)||0)}}let ln=(()=>{class o{constructor(e){this._state=e,this.business_days=this._state.options.pipe((0,Z.U)(({start:s,end:r})=>function rn(o,n){(0,ee.Z)(2,arguments);var e=(0,kt.Z)(o),s=(0,kt.Z)(n);if(!(0,te.Z)(e)||!(0,te.Z)(s))return NaN;var r=(0,en.Z)(e,s),i=r<0?-1:1,a=(0,on.Z)(r/7),l=5*a;for(s=(0,Et.Z)(s,7*a);!(0,nn.Z)(e,s);)l+=sn(s)?0:i,s=(0,Et.Z)(s,i);return 0===l?0:l}((0,tt.Z)(r||Date.now()),(0,et.Z)(s||Date.now()))||1)),this.total_count=this._state.stats.pipe((0,Z.U)(s=>s.count||0)),this.avg_length=this._state.stats.pipe((0,Z.U)(s=>(0,Dt.Z)({minutes:Math.floor(s.avg_length||0)}))),this.attendance=this._state.stats.pipe((0,Z.U)(({events:s})=>s.reduce((r,{extension_data:i})=>r+(+i?.people_count?.max||0),0))),this.no_shows=this._state.stats.pipe((0,Z.U)(({events:s})=>s.reduce((r,{extension_data:i})=>r+ +i?.people_count?.max?1:0,0))),this.no_show_percent=this._state.stats.pipe((0,Z.U)(({events:s})=>Math.floor(s.reduce((r,{extension_data:i})=>r+ +i?.people_count?.max?1:0,0)/s.length*1e4)/100)),this.has_attendance=this._state.stats.pipe((0,Z.U)(({events:s})=>!!s.find(({extension_data:r})=>!!r?.people_count)))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E))},o.\u0275cmp=t.Xpm({type:o,selectors:[["report-spaces-overall"]],decls:21,vars:12,consts:[[1,"m-4","p-4","rounded","bg-white","dark:bg-neutral-700","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],["class","m-4 p-4 rounded bg-white dark:bg-neutral-700 shadow flex justify-center items-center space-x-2",4,"ngIf"],[1,"flex-1","flex","flex-col","items-center","justify-center"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3"),t._uU(3,"Business Days"),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.ALo(6,"async"),t.qZA()(),t.TgZ(7,"div",1)(8,"h3"),t._uU(9,"Total Bookings"),t.qZA(),t.TgZ(10,"p"),t._uU(11),t.ALo(12,"async"),t.qZA()(),t.TgZ(13,"div",1)(14,"h3"),t._uU(15,"Average Booking Length"),t.qZA(),t.TgZ(16,"p"),t._uU(17),t.ALo(18,"async"),t.qZA()()(),t.YNc(19,an,19,9,"div",2),t.ALo(20,"async")),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,4,s.business_days)||0),t.xp6(6),t.Oqu(t.lcZ(12,6,s.total_count)||0),t.xp6(6),t.Oqu(t.lcZ(18,8,s.avg_length)||"None"),t.xp6(2),t.Q6J("ngIf",t.lcZ(20,10,s.has_attendance)))},dependencies:[x.O5,x.Ov],styles:["h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}"]}),o})();var H=f(2986),$=f(1110);const cn=function(){return["flex"]};let un=(()=>{class o{constructor(e){var s=this;this._reports=e,this.space_list=(0,Q.aj)([this._reports.stats,this._reports.options]).pipe((0,vt.b)(300),(0,Z.U)(([r,{start:i,end:a}])=>{let l=[],d=!1;for(const c of r.events){const g=(0,w.Tw)(c.resources,"email")||[c.system];for(const p of g){let h=l.find(m=>m.id===p.id||m.id?.toLowerCase()===p.email.toLowerCase());if(!h){if(h={id:p.id||p.email,name:p.display_name||p.name,capacity:p.capacity||1,count:0,attendance:0,avg_attendance:0,min_attendance:99,max_attendance:0,attendees:0,avg_attendees:0,usage:0,no_shows:0,utilisation:0,occupancy:0},!h.id||!h.name)continue;l.push(h)}0===c.extension_data?.people_count?.max&&(h.no_shows+=1),h.count+=1,h.attendance+=c.extension_data?.people_count?.max??0,h.avg_attendance+=c.extension_data?.people_count?.avg??0,h.min_attendance=Math.min(h.max_attendance,c.extension_data?.people_count?.max??99),h.max_attendance=Math.max(h.max_attendance,c.extension_data?.people_count?.max??0),h.usage+=c.duration,h.attendees+=c.attendees.length,d=d||!!c.extension_data.people_count}}const u=Math.max(1,(0,St.Z)(a,i)+1);for(const c of l)c.avg_attendees=Math.floor(c.attendees/c.count*100)/100,c.avg_attendance=Math.floor(c.attendance/c.count*100)/100,c.utilisation=`${Math.floor(c.usage/60/8/u*100)}%`,c.min_attendance=99===c.min_attendance?"?":c.min_attendance,c.occupancy=Math.floor(c.avg_attendees/c.capacity*1e3)/10+"%",(c.attendance<0||!d)&&(c.attendance="?",c.avg_attendance="?");return l})),this.has_attendance=this.space_list.pipe((0,Z.U)(r=>!!r.find(({attendance:i})=>"?"!==i))),this.column_list=this.has_attendance.pipe((0,Z.U)(r=>r?["name","capacity","count","utilisation","avg_attendees","attendance","avg_attendance","no_shows","min_attendance","max_attendance"]:["name","capacity","count","utilisation","avg_attendees"])),this.column_name_list=this.has_attendance.pipe((0,Z.U)(r=>r?["Name","Room Capacity","Bookings","% Time booked during office hrs","Avg. invitees per booking","Total In-room Attendance","Avg. In-room Attendance","No Shows","Min. In-room Attendance","Max. In-room Attendance"]:["Name","Room Capacity","Bookings","% Time booked during office hrs","Avg. invitees per booking"])),this.download=(0,D.Z)(function*(){const r=yield s.space_list.pipe((0,H.q)(1)).toPromise();(0,w.Sv)("report-spaces-usage.csv",(0,w.o3)(r))})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E))},o.\u0275cmp=t.Xpm({type:o,selectors:[["report-spaces-space-listing"]],decls:10,vars:10,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Room Utilisation"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return s.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.ALo(8,"async"),t.ALo(9,"async"),t.qZA()),2&e&&(t.xp6(7),t.Q6J("dataSource",s.space_list)("pagination",!0)("columns",t.lcZ(8,5,s.column_list))("display_column",t.lcZ(9,7,s.column_name_list))("column_size",t.DdM(9,cn)))},dependencies:[V.o,$.C,x.Ov]}),o})();const pn=function(){return["name","count","avg_attendees","total_time","no_shows"]},dn=function(){return["Name","Bookings","Avg. Invitees per Booking","Total Booked Time","No Shows"]},mn=function(){return["flex"]};let hn=(()=>{class o{constructor(e){var s=this;this._reports=e,this.user_list=(0,Q.aj)([this._reports.stats]).pipe((0,vt.b)(300),(0,Z.U)(([r])=>{let i=[];for(const a of r.events){const l=a.attendees?.find(c=>c.email===a.extension_data?.host_override||c.email===a.host);if(!l)continue;const d=Math.max(a.resources.reduce((c,g)=>c+g.capacity,0)||1,1);let u=i.find(c=>c.id?.toLowerCase()===l.email.toLowerCase());u||(u={id:l.email,name:l.name,capacity:d,count:0,attendees:0,avg_attendees:0,no_shows:0,occupancy:0,total_time:0},i.push(u)),0===a.extension_data?.people_count?.max&&(u.no_shows+=1),u.count+=1,u.attendees+=a.attendees.length,u.total_time+=a.duration||15}for(const a of i)a.avg_attendees=Math.floor(a.attendees/a.count*100)/100,a.occupancy=Math.floor(a.avg_attendees/a.capacity*100)/100,a.total_time=(0,Dt.Z)({hours:Math.floor(a.total_time/60),minutes:a.total_time%60});return i}),(0,q.d)(1)),this.download=(0,D.Z)(function*(){const r=yield s.user_list.pipe((0,H.q)(1)).toPromise();(0,w.Sv)("report-space-attendee-usage.csv",(0,w.o3)(r))})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E))},o.\u0275cmp=t.Xpm({type:o,selectors:[["report-spaces-user-listing"]],decls:8,vars:8,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","px-4","py-2","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],[3,"dataSource","pagination","columns","display_column","column_size"]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Meeting Organisers"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return s.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.qZA()),2&e&&(t.xp6(7),t.Q6J("dataSource",s.user_list)("pagination",!0)("columns",t.DdM(5,pn))("display_column",t.DdM(6,dn))("column_size",t.DdM(7,mn)))},dependencies:[V.o,$.C]}),o})();const gn=["report-spaces",""];function fn(o,n){1&o&&(t.ynx(0),t._UZ(1,"report-spaces-overall")(2,"report-spaces-space-listing")(3,"report-spaces-user-listing"),t.BQk())}function _n(o,n){if(1&o&&(t.ynx(0),t.YNc(1,fn,4,0,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&o){const e=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,e.total_count))("ngIfElse",s)}}function vn(o,n){1&o&&(t.TgZ(0,"div",4),t._UZ(1,"mat-spinner",5),t.TgZ(2,"p",6),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function xn(o,n){1&o&&(t.TgZ(0,"div",4)(1,"p",6),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}let yn=(()=>{class o{constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,Z.U)(s=>s.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E))},o.\u0275cmp=t.Xpm({type:o,selectors:[["","report-spaces",""]],attrs:gn,decls:8,vars:4,consts:[[1,"relative","flex-1","h-1/2","w-full","overflow-auto","z-0"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,s){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,_n,3,4,"ng-container",1),t.ALo(3,"async"),t.qZA(),t.YNc(4,vn,4,1,"ng-template",null,2,t.W1O),t.YNc(6,xn,3,0,"ng-template",null,3,t.W1O)),2&e){const r=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,s.loading))("ngIfElse",r)}},dependencies:[x.O5,wt.Ou,Zt,ln,un,hn,x.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]}),o})();function wn(o,n){1&o&&(t._uU(0),t.ALo(1,"date")),2&o&&t.hij(" ",t.xi3(1,1,n.data,"mediumDate")," ")}function Zn(o,n){1&o&&t._uU(0),2&o&&t.hij(" ",n.data||"0","% ")}const bn=function(){return["date","approved","count","utilisation"]},Cn=function(){return["Date","Approved Bookings","Total Requests","Utilisation"]},An=function(){return["flex"]},Tn=function(o,n,e){return{date:o,usage:n,utilisation:e}};let Mn=(()=>{class o{constructor(e){var s=this;this._state=e,this.day_list=this._state.day_list,this.download=(0,D.Z)(function*(){let r=yield s.day_list.pipe((0,H.q)(1)).toPromise();r=r.map(i=>({...i,date:(0,G.Z)(i.date,"MMMM d, y(EEE)")})),(0,w.Sv)("desks-usage.csv",(0,w.o3)(r))})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E))},o.\u0275cmp=t.Xpm({type:o,selectors:[["report-desks-overall-list"]],decls:12,vars:13,consts:[[1,"m-4","rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size","template"],["date_view",""],["percent_view",""]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h3",2),t._uU(3,"Daily Utilisation"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return s.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.YNc(8,wn,2,4,"ng-template",null,5,t.W1O),t.YNc(10,Zn,1,1,"ng-template",null,6,t.W1O),t.qZA()),2&e){const r=t.MAs(9),i=t.MAs(11);t.xp6(7),t.Q6J("dataSource",s.day_list)("pagination",!0)("columns",t.DdM(6,bn))("display_column",t.DdM(7,Cn))("column_size",t.DdM(8,An))("template",t.kEZ(9,Tn,r,i,i))}},dependencies:[V.o,$.C,x.uU],encapsulation:2}),o})();function On(o,n){1&o&&t._uU(0),2&o&&t.hij(" ",n.data||"0","% ")}const Rn=function(){return["name","avg_usage","approved","count","utilisation"]},Un=function(){return["Level","Avg. Used Desks","Approved Bookings","Total Requests","Utilisation"]},Ln=function(){return["flex"]},Nn=function(o){return{utilisation:o}};let Sn=(()=>{class o{constructor(e,s){var r=this;this._state=e,this._org=s,this.level_list=(0,Q.aj)([this._state.options,this._state.stats,this._state.counts]).pipe((0,Z.U)(([i,a,l])=>{const{start:d,end:u,zones:c}=i,g=(0,St.Z)(u,d)||1,p=[];for(const h of c){if("All"===h)continue;const m=this._org.levelWithID([h]),A=l[h]||0,v=a.events.filter(N=>N.zones.includes(h));let R=(A*g-v.length)/g;R%1!=0&&(R=R.toFixed(2)),p.push({name:m?.display_name||m?.name,free:R,approved:v.filter(N=>N.approved).length||0,avg_usage:(v.length/g||0).toFixed(2),total:A,count:v.length,utilisation:(v.length/((A||1)*g)*100||0).toFixed(2)})}return p}),(0,q.d)(1)),this.download=(0,D.Z)(function*(){let i=yield r.level_list.pipe((0,H.q)(1)).toPromise();(0,w.Sv)("desks-levels-usage.csv",(0,w.o3)(i))})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E),t.Y36(J.w7))},o.\u0275cmp=t.Xpm({type:o,selectors:[["report-desks-levels-list"]],decls:11,vars:11,consts:[[1,"px-4","mb-4","w-full"],[1,"rounded","bg-white","dark:bg-neutral-700","shadow","overflow-hidden","w-full"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","flex","items-center"],[1,"font-bold","text-xl","flex-1"],["icon","",3,"click"],["red-header","",3,"dataSource","pagination","columns","display_column","column_size","template"],["percent_view",""]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),t._uU(4,"Level Utilisation"),t.qZA(),t.TgZ(5,"button",4),t.NdJ("click",function(){return s.download()}),t.TgZ(6,"app-icon"),t._uU(7,"download"),t.qZA()()(),t._UZ(8,"custom-table",5),t.YNc(9,On,1,1,"ng-template",null,6,t.W1O),t.qZA()()),2&e){const r=t.MAs(10);t.xp6(8),t.Q6J("dataSource",s.level_list)("pagination",!0)("columns",t.DdM(6,Rn))("display_column",t.DdM(7,Un))("column_size",t.DdM(8,Ln))("template",t.VKq(9,Nn,r))}},dependencies:[V.o,$.C],encapsulation:2}),o})();const lt={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",ct:"http://gionkunz.github.com/chartist-js/ct"},En=8,bt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};function ne(o,n){return"number"==typeof o?o+n:o}function Ct(o){if("string"==typeof o){const n=/^(\d+)\s*(.*)$/g.exec(o);return{value:n?+n[1]:0,unit:n?.[2]||void 0}}return{value:Number(o)}}function Yt(o){return String.fromCharCode(97+o%26)}const zt=2221e-19;function ct(o,n,e){return n/e.range*o}function Dn(o,n){const e=Math.pow(10,n||En);return Math.round(o*e)/e}function It(o,n,e,s){const r=(s-90)*Math.PI/180;return{x:o+e*Math.cos(r),y:n+e*Math.sin(r)}}function K(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var n=arguments.length,e=new Array(n>1?n-1:0),s=1;s<n;s++)e[s-1]=arguments[s];for(let r=0;r<e.length;r++){const i=e[r];for(const a in i){const l=i[a];o[a]="object"!=typeof l||null===l||l instanceof Array?l:K(o[a],l)}}return o}const ut=o=>o;function At(o,n){return Array.from({length:o},n?(e,s)=>n(s):()=>{})}const In=(o,n)=>o+(n||0);function b(o,n){return null!==o&&"object"==typeof o&&Reflect.has(o,n)}function pt(o){return null!==o&&isFinite(o)}function se(o){return!o&&0!==o}function st(o){return pt(o)?Number(o):void 0}function re(o,n){const e=Array.isArray(o)?o[n]:b(o,"data")?o.data[n]:null;return b(e,"meta")?e.meta:void 0}function ie(o){return null==o||"number"==typeof o&&isNaN(o)}function Tt(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"y";return function Pn(o){return"object"==typeof o&&null!==o&&(Reflect.has(o,"x")||Reflect.has(o,"y"))}(o)&&b(o,n)?st(o[n]):st(o)}function jt(o){let r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,s=arguments.length>3?arguments[3]:void 0;const i={labels:(o.labels||[]).slice(),series:Fn(o.series,e,s)},a=i.labels.length;return function Bn(o){return!!Array.isArray(o)&&o.every(Array.isArray)}(i.series)?(r=Math.max(a,...i.series.map(l=>l.length)),i.series.forEach(l=>{l.push(...At(Math.max(0,r-l.length)))})):r=i.series.length,i.labels.push(...At(Math.max(0,r-a),()=>"")),n&&function Jn(o){var n;null===(n=o.labels)||void 0===n||n.reverse(),o.series.reverse();for(const e of o.series)b(e,"data")?e.data.reverse():Array.isArray(e)&&e.reverse()}(i),i}function ae(o,n){if(!ie(o))return n?function Qn(o,n){let e,s;if("object"!=typeof o){const r=st(o);"x"===n?e=r:s=r}else b(o,"x")&&(e=st(o.x)),b(o,"y")&&(s=st(o.y));if(void 0!==e||void 0!==s)return{x:e,y:s}}(o,n):st(o)}function Bt(o,n){return Array.isArray(o)?o.map(e=>b(e,"value")?ae(e.value,n):ae(e,n)):Bt(o.data,n)}function Fn(o,n,e){if(function qn(o){return Array.isArray(o)&&o.every(n=>Array.isArray(n)||b(n,"data"))}(o))return o.map(r=>Bt(r,n));const s=Bt(o,n);return e?s.map(r=>[r]):s}function dt(o){let n="";return null==o?o:(n="number"==typeof o?""+o:"object"==typeof o?JSON.stringify({data:o}):String(o),Object.keys(bt).reduce((e,s)=>e.replaceAll(s,bt[s]),n))}class Xn{call(n,e){return this.svgElements.forEach(s=>Reflect.apply(s[n],s,e)),this}attr(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("attr",e)}elem(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("elem",e)}root(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("root",e)}getNode(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("getNode",e)}foreignObject(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("foreignObject",e)}text(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("text",e)}empty(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("empty",e)}remove(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("remove",e)}addClass(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("addClass",e)}removeClass(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("removeClass",e)}removeAllClasses(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("removeAllClasses",e)}animate(){for(var n=arguments.length,e=new Array(n),s=0;s<n;s++)e[s]=arguments[s];return this.call("animate",e)}constructor(n){this.svgElements=[];for(let e=0;e<n.length;e++)this.svgElements.push(new pe(n[e]))}}const ce={easeInSine:[.47,0,.745,.715],easeOutSine:[.39,.575,.565,1],easeInOutSine:[.445,.05,.55,.95],easeInQuad:[.55,.085,.68,.53],easeOutQuad:[.25,.46,.45,.94],easeInOutQuad:[.455,.03,.515,.955],easeInCubic:[.55,.055,.675,.19],easeOutCubic:[.215,.61,.355,1],easeInOutCubic:[.645,.045,.355,1],easeInQuart:[.895,.03,.685,.22],easeOutQuart:[.165,.84,.44,1],easeInOutQuart:[.77,0,.175,1],easeInQuint:[.755,.05,.855,.06],easeOutQuint:[.23,1,.32,1],easeInOutQuint:[.86,0,.07,1],easeInExpo:[.95,.05,.795,.035],easeOutExpo:[.19,1,.22,1],easeInOutExpo:[1,0,0,1],easeInCirc:[.6,.04,.98,.335],easeOutCirc:[.075,.82,.165,1],easeInOutCirc:[.785,.135,.15,.86],easeInBack:[.6,-.28,.735,.045],easeOutBack:[.175,.885,.32,1.275],easeInOutBack:[.68,-.55,.265,1.55]};function ue(o,n,e){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4?arguments[4]:void 0;const{easing:i,...a}=e,l={};let d,u;i&&(d=Array.isArray(i)?i:ce[i]),a.begin=ne(a.begin,"ms"),a.dur=ne(a.dur,"ms"),d&&(a.calcMode="spline",a.keySplines=d.join(" "),a.keyTimes="0;1"),s&&(a.fill="freeze",l[n]=a.from,o.attr(l),u=Ct(a.begin||0).value,a.begin="indefinite");const c=o.elem("animate",{attributeName:n,...a});s&&setTimeout(()=>{try{c._node.beginElement()}catch{l[n]=a.to,o.attr(l),c.remove()}},u);const g=c.getNode();r&&g.addEventListener("beginEvent",()=>r.emit("animationBegin",{element:o,animate:g,params:e})),g.addEventListener("endEvent",()=>{r&&r.emit("animationEnd",{element:o,animate:g,params:e}),s&&(l[n]=a.to,o.attr(l),c.remove())})}let pe=(()=>{class o{attr(e,s){return"string"==typeof e?s?this._node.getAttributeNS(s,e):this._node.getAttribute(e):(Object.keys(e).forEach(r=>{if(void 0!==e[r])if(-1!==r.indexOf(":")){const i=r.split(":");this._node.setAttributeNS(lt[i[0]],r,String(e[r]))}else this._node.setAttribute(r,String(e[r]))}),this)}elem(e,s,r){return new o(e,s,r,this,arguments.length>3&&void 0!==arguments[3]&&arguments[3])}parent(){return this._node.parentNode instanceof SVGElement?new o(this._node.parentNode):null}root(){let e=this._node;for(;"svg"!==e.nodeName&&e.parentElement;)e=e.parentElement;return new o(e)}querySelector(e){const s=this._node.querySelector(e);return s?new o(s):null}querySelectorAll(e){const s=this._node.querySelectorAll(e);return new Xn(s)}getNode(){return this._node}foreignObject(e,s,r){let a,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if("string"==typeof e){const d=document.createElement("div");d.innerHTML=e,a=d.firstChild}else a=e;a instanceof Element&&a.setAttribute("xmlns",lt.xmlns);const l=this.elem("foreignObject",s,r,i);return l._node.appendChild(a),l}text(e){return this._node.appendChild(document.createTextNode(e)),this}empty(){for(;this._node.firstChild;)this._node.removeChild(this._node.firstChild);return this}remove(){var e;return null===(e=this._node.parentNode)||void 0===e||e.removeChild(this._node),this.parent()}replace(e){var s;return null===(s=this._node.parentNode)||void 0===s||s.replaceChild(e._node,this._node),e}append(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this._node.firstChild?this._node.insertBefore(e._node,this._node.firstChild):this._node.appendChild(e._node),this}classes(){const e=this._node.getAttribute("class");return e?e.trim().split(/\s+/):[]}addClass(e){return this._node.setAttribute("class",this.classes().concat(e.trim().split(/\s+/)).filter(function(s,r,i){return i.indexOf(s)===r}).join(" ")),this}removeClass(e){const s=e.trim().split(/\s+/);return this._node.setAttribute("class",this.classes().filter(r=>-1===s.indexOf(r)).join(" ")),this}removeAllClasses(){return this._node.setAttribute("class",""),this}height(){return this._node.getBoundingClientRect().height}width(){return this._node.getBoundingClientRect().width}animate(e){let s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0;return Object.keys(e).forEach(i=>{const a=e[i];Array.isArray(a)?a.forEach(l=>ue(this,i,l,!1,r)):ue(this,i,a,s,r)}),this}constructor(e,s,r,i,a=!1){e instanceof Element?this._node=e:(this._node=document.createElementNS(lt.svg,e),"svg"===e&&this.attr({"xmlns:ct":lt.ct})),s&&this.attr(s),r&&this.addClass(r),i&&(a&&i._node.firstChild?i._node.insertBefore(this._node,i._node.firstChild):i._node.appendChild(this._node))}}return o.Easing=ce,o})();function qt(o){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"100%",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"100%",s=arguments.length>3?arguments[3]:void 0;Array.from(o.querySelectorAll("svg")).filter(i=>i.getAttributeNS(lt.xmlns,"ct")).forEach(i=>o.removeChild(i));const r=new pe("svg").attr({width:n,height:e}).attr({style:"width: ".concat(n,"; height: ").concat(e,";")});return s&&r.addClass(s),o.appendChild(r.getNode()),r}function Pt(o,n){var e,s,r,i;const a=!(!n.axisX&&!n.axisY),l=(null===(e=n.axisY)||void 0===e?void 0:e.offset)||0,d=(null===(s=n.axisX)||void 0===s?void 0:s.offset)||0,u=null===(r=n.axisY)||void 0===r?void 0:r.position,c=null===(i=n.axisX)||void 0===i?void 0:i.position;let g=o.width()||Ct(n.width).value||0,p=o.height()||Ct(n.height).value||0;const h=function Vn(o){return"number"==typeof o?{top:o,right:o,bottom:o,left:o}:void 0===o?{top:0,right:0,bottom:0,left:0}:{top:"number"==typeof o.top?o.top:0,right:"number"==typeof o.right?o.right:0,bottom:"number"==typeof o.bottom?o.bottom:0,left:"number"==typeof o.left?o.left:0}}(n.chartPadding);g=Math.max(g,l+h.left+h.right),p=Math.max(p,d+h.top+h.bottom);const m={x1:0,x2:0,y1:0,y2:0,padding:h,width(){return this.x2-this.x1},height(){return this.y1-this.y2}};return a?("start"===c?(m.y2=h.top+d,m.y1=Math.max(p-h.bottom,m.y2+1)):(m.y2=h.top,m.y1=Math.max(p-h.bottom-d,m.y2+1)),"start"===u?(m.x1=h.left+l,m.x2=Math.max(g-h.right,m.x1+1)):(m.x1=h.left,m.x2=Math.max(g-h.right-l,m.x1+1))):(m.x1=h.left,m.x2=Math.max(g-h.right,m.x1+1),m.y2=h.top,m.y1=Math.max(p-h.bottom,m.y2+1)),m}function me(o,n,e){let s;const r=[];function i(l){const d=s;s=K({},o),n&&n.forEach(u=>{window.matchMedia(u[0]).matches&&(s=K(s,u[1]))}),e&&l&&e.emit("optionsChanged",{previousOptions:d,currentOptions:s})}if(!window.matchMedia)throw new Error("window.matchMedia not found! Make sure you're using a polyfill.");return n&&n.forEach(l=>{const d=window.matchMedia(l[0]);d.addEventListener("change",i),r.push(d)}),i(),{removeMediaQueryListeners:function a(){r.forEach(l=>l.removeEventListener("change",i))},getCurrentOptions:()=>s}}const Jt={m:["x","y"],l:["x","y"],c:["x1","y1","x2","y2","x","y"],a:["rx","ry","xAr","lAf","sf","x","y"]},Hn={accuracy:3};function Ot(o,n,e,s,r,i){const a={command:r?o.toLowerCase():o.toUpperCase(),...n,...i?{data:i}:{}};e.splice(s,0,a)}function Qt(o,n){o.forEach((e,s)=>{Jt[e.command.toLowerCase()].forEach((r,i)=>{n(e,r,s,i,o)})})}class L{static join(n){const r=new L(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2?arguments[2]:void 0);for(let i=0;i<n.length;i++){const a=n[i];for(let l=0;l<a.pathElements.length;l++)r.pathElements.push(a.pathElements[l])}return r}position(n){return void 0!==n?(this.pos=Math.max(0,Math.min(this.pathElements.length,n)),this):this.pos}remove(n){return this.pathElements.splice(this.pos,n),this}move(n,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;return Ot("M",{x:+n,y:+e},this.pathElements,this.pos++,s,r),this}line(n,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;return Ot("L",{x:+n,y:+e},this.pathElements,this.pos++,s,r),this}curve(n,e,s,r,i,a){let l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0;return Ot("C",{x1:+n,y1:+e,x2:+s,y2:+r,x:+i,y:+a},this.pathElements,this.pos++,l,d),this}arc(n,e,s,r,i,a,l){let d=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8?arguments[8]:void 0;return Ot("A",{rx:n,ry:e,xAr:s,lAf:r,sf:i,x:a,y:l},this.pathElements,this.pos++,d,u),this}parse(n){const e=n.replace(/([A-Za-z])(-?[0-9])/g,"$1 $2").replace(/([0-9])([A-Za-z])/g,"$1 $2").split(/[\s,]+/).reduce((r,i)=>(i.match(/[A-Za-z]/)&&r.push([]),r[r.length-1].push(i),r),[]);"Z"===e[e.length-1][0].toUpperCase()&&e.pop();const s=e.map(r=>{const i=r.shift(),a=Jt[i.toLowerCase()];return{command:i,...a.reduce((l,d,u)=>(l[d]=+r[u],l),{})}});return this.pathElements.splice(this.pos,0,...s),this.pos+=s.length,this}stringify(){const n=Math.pow(10,this.options.accuracy);return this.pathElements.reduce((e,s)=>{const r=Jt[s.command.toLowerCase()].map(i=>{const a=s[i];return this.options.accuracy?Math.round(a*n)/n:a});return e+s.command+r.join(",")},"")+(this.close?"Z":"")}scale(n,e){return Qt(this.pathElements,(s,r)=>{s[r]*="x"===r[0]?n:e}),this}translate(n,e){return Qt(this.pathElements,(s,r)=>{s[r]+="x"===r[0]?n:e}),this}transform(n){return Qt(this.pathElements,(e,s,r,i,a)=>{const l=n(e,s,r,i,a);(l||0===l)&&(e[s]=l)}),this}clone(){const e=new L(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.close);return e.pos=this.pos,e.pathElements=this.pathElements.slice().map(s=>({...s})),e.options={...this.options},e}splitByCommand(n){const e=[new L];return this.pathElements.forEach(s=>{s.command===n.toUpperCase()&&0!==e[e.length-1].pathElements.length&&e.push(new L),e[e.length-1].pathElements.push(s)}),e}constructor(n=!1,e){this.close=n,this.pathElements=[],this.pos=0,this.options={...Hn,...e}}}function ot(o){const n={fillHoles:!1,...o};return function(s,r){const i=new L;let a=!0;for(let l=0;l<s.length;l+=2){const d=s[l],u=s[l+1],c=r[l/2];void 0!==Tt(c.value)?(a?i.move(d,u,!1,c):i.line(d,u,!1,c),a=!1):n.fillHoles||(a=!0)}return i}}function he(o){const n={fillHoles:!1,...o};return function e(s,r){const i=function le(o,n,e){const s={increasingX:!1,fillHoles:!1,...e},r=[];let i=!0;for(let a=0;a<o.length;a+=2)void 0===Tt(n[a/2].value)?s.fillHoles||(i=!0):(s.increasingX&&a>=2&&o[a]<=o[a-2]&&(i=!0),i&&(r.push({pathCoordinates:[],valueData:[]}),i=!1),r[r.length-1].pathCoordinates.push(o[a],o[a+1]),r[r.length-1].valueData.push(n[a/2]));return r}(s,r,{fillHoles:n.fillHoles,increasingX:!0});if(i.length){if(i.length>1)return L.join(i.map(a=>e(a.pathCoordinates,a.valueData)));{if(r=i[0].valueData,(s=i[0].pathCoordinates).length<=4)return ot()(s,r);const a=[],l=[],d=s.length/2,u=[],c=[],g=[],p=[];for(let m=0;m<d;m++)a[m]=s[2*m],l[m]=s[2*m+1];for(let m=0;m<d-1;m++)g[m]=l[m+1]-l[m],p[m]=a[m+1]-a[m],c[m]=g[m]/p[m];u[0]=c[0],u[d-1]=c[d-2];for(let m=1;m<d-1;m++)0===c[m]||0===c[m-1]||c[m-1]>0!=c[m]>0?u[m]=0:(u[m]=3*(p[m-1]+p[m])/((2*p[m]+p[m-1])/c[m-1]+(p[m]+2*p[m-1])/c[m]),isFinite(u[m])||(u[m]=0));const h=(new L).move(a[0],l[0],!1,r[0]);for(let m=0;m<d-1;m++)h.curve(a[m]+p[m]/3,l[m]+u[m]*p[m]/3,a[m+1]-p[m]/3,l[m+1]-u[m+1]*p[m]/3,a[m+1],l[m+1],!1,r[m+1]);return h}}return ot()([],[])}}class es{on(n,e){const{allListeners:s,listeners:r}=this;"*"===n?s.add(e):(r.has(n)||r.set(n,new Set),r.get(n).add(e))}off(n,e){const{allListeners:s,listeners:r}=this;if("*"===n)e?s.delete(e):s.clear();else if(r.has(n)){const i=r.get(n);e?i.delete(e):i.clear(),i.size||r.delete(n)}}emit(n,e){const{allListeners:s,listeners:r}=this;r.has(n)&&r.get(n).forEach(i=>i(e)),s.forEach(i=>i(n,e))}constructor(){this.listeners=new Map,this.allListeners=new Set}}const Ft=new WeakMap;class ge{update(n,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var r;return n&&(this.data=n||{},this.data.labels=this.data.labels||[],this.data.series=this.data.series||[],this.eventEmitter.emit("data",{type:"update",data:this.data})),e&&(this.options=K({},s?this.options:this.defaultOptions,e),!this.initializeTimeoutId)&&(null===(r=this.optionsProvider)||void 0===r||r.removeMediaQueryListeners(),this.optionsProvider=me(this.options,this.responsiveOptions,this.eventEmitter)),!this.initializeTimeoutId&&this.optionsProvider&&this.createChart(this.optionsProvider.getCurrentOptions()),this}detach(){var n;return this.initializeTimeoutId?window.clearTimeout(this.initializeTimeoutId):(window.removeEventListener("resize",this.resizeListener),null===(n=this.optionsProvider)||void 0===n||n.removeMediaQueryListeners()),Ft.delete(this.container),this}on(n,e){return this.eventEmitter.on(n,e),this}off(n,e){return this.eventEmitter.off(n,e),this}initialize(){window.addEventListener("resize",this.resizeListener),this.optionsProvider=me(this.options,this.responsiveOptions,this.eventEmitter),this.eventEmitter.on("optionsChanged",()=>this.update()),this.options.plugins&&this.options.plugins.forEach(n=>{Array.isArray(n)?n[0](this,n[1]):n(this)}),this.eventEmitter.emit("data",{type:"initial",data:this.data}),this.createChart(this.optionsProvider.getCurrentOptions()),this.initializeTimeoutId=null}constructor(n,e,s,r,i){this.data=e,this.defaultOptions=s,this.options=r,this.responsiveOptions=i,this.eventEmitter=new es,this.resizeListener=()=>this.update(),this.initializeTimeoutId=setTimeout(()=>this.initialize(),0);const a="string"==typeof n?document.querySelector(n):n;if(!a)throw new Error("Target element is not found");this.container=a;const l=Ft.get(a);l&&l.detach(),Ft.set(a,this)}}const O={x:{pos:"x",len:"width",dir:"horizontal",rectStart:"x1",rectEnd:"x2",rectOffset:"y2"},y:{pos:"y",len:"height",dir:"vertical",rectStart:"y2",rectEnd:"y1",rectOffset:"x1"}};class fe{createGridAndLabels(n,e,s,r){const i="x"===this.units.pos?s.axisX:s.axisY,a=this.ticks.map((d,u)=>this.projectValue(d,u)),l=this.ticks.map(i.labelInterpolationFnc);a.forEach((d,u)=>{const c=l[u],g={x:0,y:0};let p;p=a[u+1]?a[u+1]-d:Math.max(this.axisLength-d,this.axisLength/this.ticks.length),(""===c||!se(c))&&("x"===this.units.pos?(d=this.chartRect.x1+d,g.x=s.axisX.labelOffset.x,g.y="start"===s.axisX.position?this.chartRect.padding.top+s.axisX.labelOffset.y+5:this.chartRect.y1+s.axisX.labelOffset.y+5):(d=this.chartRect.y1-d,g.y=s.axisY.labelOffset.y-p,g.x="start"===s.axisY.position?this.chartRect.padding.left+s.axisY.labelOffset.x:this.chartRect.x2+s.axisY.labelOffset.x+10),i.showGrid&&function Gn(o,n,e,s,r,i,a,l){const d={["".concat(e.units.pos,"1")]:o,["".concat(e.units.pos,"2")]:o,["".concat(e.counterUnits.pos,"1")]:s,["".concat(e.counterUnits.pos,"2")]:s+r},u=i.elem("line",d,a.join(" "));l.emit("draw",{type:"grid",axis:e,index:n,group:i,element:u,...d})}(d,u,this,this.gridOffset,this.chartRect[this.counterUnits.len](),n,[s.classNames.grid,s.classNames[this.units.dir]],r),i.showLabel&&function Wn(o,n,e,s,r,i,a,l,d,u){const c={[r.units.pos]:o+a[r.units.pos],[r.counterUnits.pos]:a[r.counterUnits.pos],[r.units.len]:n,[r.counterUnits.len]:Math.max(0,i-10)},g=Math.round(c[r.units.len]),p=Math.round(c[r.counterUnits.len]),h=document.createElement("span");h.className=d.join(" "),h.style[r.units.len]=g+"px",h.style[r.counterUnits.len]=p+"px",h.textContent=String(s);const m=l.foreignObject(h,{style:"overflow: visible;",...c});u.emit("draw",{type:"label",axis:r,index:e,group:l,element:m,text:s,...c})}(d,p,u,c,this,i.offset,g,e,[s.classNames.label,s.classNames[this.units.dir],"start"===i.position?s.classNames[i.position]:s.classNames.end],r))})}constructor(n,e,s){this.units=n,this.chartRect=e,this.ticks=s,this.counterUnits=n===O.x?O.y:O.x,this.axisLength=e[this.units.rectEnd]-e[this.units.rectStart],this.gridOffset=e[this.units.rectOffset]}}class Xt extends fe{projectValue(n){const e=Number(Tt(n,this.units.pos));return this.axisLength*(e-this.bounds.min)/this.bounds.range}constructor(n,e,s,r){const i=r.highLow||function Mt(o,n,e){const s={high:void 0===(n={...n,...e?"x"===e?n.axisX:n.axisY:{}}).high?-Number.MAX_VALUE:+n.high,low:void 0===n.low?Number.MAX_VALUE:+n.low},r=void 0===n.high,i=void 0===n.low;return(r||i)&&function a(l){if(!ie(l))if(Array.isArray(l))for(let d=0;d<l.length;d++)a(l[d]);else{const d=Number(e&&b(l,e)?l[e]:l);r&&d>s.high&&(s.high=d),i&&d<s.low&&(s.low=d)}}(o),(n.referenceValue||0===n.referenceValue)&&(s.high=Math.max(n.referenceValue,s.high),s.low=Math.min(n.referenceValue,s.low)),s.high<=s.low&&(0===s.low?s.high=1:s.low<0?s.high=0:(s.high>0||(s.high=1),s.low=0)),s}(e,r,n.pos),a=function zn(o,n,e){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const r={high:n.high,low:n.low,valueRange:0,oom:0,step:0,min:0,max:0,range:0,numberOfSteps:0,values:[]};r.valueRange=r.high-r.low,r.oom=function kn(o){return Math.floor(Math.log(Math.abs(o))/Math.LN10)}(r.valueRange),r.step=Math.pow(10,r.oom),r.min=Math.floor(r.low/r.step)*r.step,r.max=Math.ceil(r.high/r.step)*r.step,r.range=r.max-r.min,r.numberOfSteps=Math.round(r.range/r.step);const a=ct(o,r.step,r)<e,l=s?function Yn(o){if(1===o)return o;function n(a,l){return a%l==0?l:n(l,a%l)}function e(a){return a*a+1}let i,s=2,r=2;if(o%2==0)return 2;do{s=e(s)%o,r=e(e(r))%o,i=n(Math.abs(s-r),o)}while(1===i);return i}(r.range):0;if(s&&ct(o,1,r)>=e)r.step=1;else if(s&&l<r.step&&ct(o,l,r)>=e)r.step=l;else{let p=0;for(;;){if(a&&ct(o,r.step,r)<=e)r.step*=2;else{if(a||!(ct(o,r.step/2,r)>=e))break;if(r.step/=2,s&&r.step%1!=0){r.step*=2;break}}if(p++>1e3)throw new Error("Exceeded maximum number of iterations while optimizing scale step!")}}function d(p,h){return p===(p+=h)&&(p*=1+(h>0?zt:-zt)),p}r.step=Math.max(r.step,zt);let u=r.min,c=r.max;for(;u+r.step<=r.low;)u=d(u,r.step);for(;c-r.step>=r.high;)c=d(c,-r.step);r.min=u,r.max=c,r.range=r.max-r.min;const g=[];for(let p=r.min;p<=r.max;p=d(p,r.step)){const h=Dn(p);h!==g[g.length-1]&&g.push(h)}return r.values=g,r}(s[n.rectEnd]-s[n.rectStart],i,r.scaleMinSpace||20,r.onlyInteger),l={min:a.min,max:a.max};super(n,s,a.values),this.bounds=a,this.range=l}}class Rt extends fe{projectValue(n,e){return this.stepLength*e}constructor(n,e,s,r){const i=r.ticks||[];super(n,s,i);const a=Math.max(1,i.length-(r.stretch?1:0));this.stepLength=this.axisLength/a,this.stretch=!!r.stretch}}function mt(o,n,e){var s;if(b(o,"name")&&o.name&&null!==(s=n.series)&&void 0!==s&&s[o.name]){const i=(n?.series[o.name])[e];return void 0===i?n[e]:i}return n[e]}const _e={axisX:{offset:30,position:"end",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:ut,type:void 0},axisY:{offset:40,position:"start",labelOffset:{x:0,y:0},showLabel:!0,showGrid:!0,labelInterpolationFnc:ut,type:void 0,scaleMinSpace:20,onlyInteger:!1},width:void 0,height:void 0,showLine:!0,showPoint:!0,showArea:!1,areaBase:0,lineSmooth:!0,showGridBackground:!1,low:void 0,high:void 0,chartPadding:{top:15,right:15,bottom:5,left:10},fullWidth:!1,reverseData:!1,classNames:{chart:"ct-chart-line",label:"ct-label",labelGroup:"ct-labels",series:"ct-series",line:"ct-line",point:"ct-point",area:"ct-area",grid:"ct-grid",gridGroup:"ct-grids",gridBackground:"ct-grid-background",vertical:"ct-vertical",horizontal:"ct-horizontal",start:"ct-start",end:"ct-end"}};class ns extends ge{createChart(n){const{data:e}=this,s=jt(e,n.reverseData,!0),r=qt(this.container,n.width,n.height,n.classNames.chart);this.svg=r;const i=r.elem("g").addClass(n.classNames.gridGroup),a=r.elem("g"),l=r.elem("g").addClass(n.classNames.labelGroup),d=Pt(r,n);let u,c;u=void 0===n.axisX.type?new Rt(O.x,s.series,d,{...n.axisX,ticks:s.labels,stretch:n.fullWidth}):new n.axisX.type(O.x,s.series,d,n.axisX),c=void 0===n.axisY.type?new Xt(O.y,s.series,d,{...n.axisY,high:pt(n.high)?n.high:n.axisY.high,low:pt(n.low)?n.low:n.axisY.low}):new n.axisY.type(O.y,s.series,d,n.axisY),u.createGridAndLabels(i,l,n,this.eventEmitter),c.createGridAndLabels(i,l,n,this.eventEmitter),n.showGridBackground&&function de(o,n,e,s){const r=o.elem("rect",{x:n.x1,y:n.y2,width:n.width(),height:n.height()},e,!0);s.emit("draw",{type:"gridBackground",group:o,element:r})}(i,d,n.classNames.gridBackground,this.eventEmitter),function oe(o,n){let s=0;o[arguments.length>2&&void 0!==arguments[2]&&arguments[2]?"reduceRight":"reduce"]((r,i,a)=>n(i,s++,a),void 0)}(e.series,(g,p)=>{const h=a.elem("g"),m=b(g,"name")&&g.name,A=b(g,"className")&&g.className,v=b(g,"meta")?g.meta:void 0;m&&h.attr({"ct:series-name":m}),v&&h.attr({"ct:meta":dt(v)}),h.addClass([n.classNames.series,A||"".concat(n.classNames.series,"-").concat(Yt(p))].join(" "));const R=[],N=[];s.series[p].forEach((_,y)=>{const C={x:d.x1+u.projectValue(_,y,s.series[p]),y:d.y1-c.projectValue(_,y,s.series[p])};R.push(C.x,C.y),N.push({value:_,valueIndex:y,meta:re(g,y)})});const k={lineSmooth:mt(g,n,"lineSmooth"),showPoint:mt(g,n,"showPoint"),showLine:mt(g,n,"showLine"),showArea:mt(g,n,"showArea"),areaBase:mt(g,n,"areaBase")};let I;I="function"==typeof k.lineSmooth?k.lineSmooth:k.lineSmooth?he():ot();const T=I(R,N);if(k.showPoint&&T.pathElements.forEach(_=>{const{data:y}=_,C=h.elem("line",{x1:_.x,y1:_.y,x2:_.x+.01,y2:_.y},n.classNames.point);if(y){let M,Y;b(y.value,"x")&&(M=y.value.x),b(y.value,"y")&&(Y=y.value.y),C.attr({"ct:value":[M,Y].filter(pt).join(","),"ct:meta":dt(y.meta)})}this.eventEmitter.emit("draw",{type:"point",value:y?.value,index:y?.valueIndex||0,meta:y?.meta,series:g,seriesIndex:p,axisX:u,axisY:c,group:h,element:C,x:_.x,y:_.y,chartRect:d})}),k.showLine){const _=h.elem("path",{d:T.stringify()},n.classNames.line,!0);this.eventEmitter.emit("draw",{type:"line",values:s.series[p],path:T.clone(),chartRect:d,index:p,series:g,seriesIndex:p,meta:v,axisX:u,axisY:c,group:h,element:_})}if(k.showArea&&c.range){const _=Math.max(Math.min(k.areaBase,c.range.max),c.range.min),y=d.y1-c.projectValue(_);T.splitByCommand("M").filter(C=>C.pathElements.length>1).map(C=>{const M=C.pathElements[0],Y=C.pathElements[C.pathElements.length-1];return C.clone(!0).position(0).remove(1).move(M.x,y).line(M.x,M.y).position(C.pathElements.length+1).line(Y.x,y)}).forEach(C=>{const M=h.elem("path",{d:C.stringify()},n.classNames.area,!0);this.eventEmitter.emit("draw",{type:"area",values:s.series[p],path:C.clone(),series:g,seriesIndex:p,axisX:u,axisY:c,chartRect:d,index:p,group:h,element:M,meta:v})})}},n.reverseData),this.eventEmitter.emit("created",{chartRect:d,axisX:u,axisY:c,svg:r,options:n})}constructor(n,e,s,r){super(n,e,_e,K({},_e,s),r),this.data=e}}const xe={width:void 0,height:void 0,chartPadding:5,classNames:{chartPie:"ct-chart-pie",chartDonut:"ct-chart-donut",series:"ct-series",slicePie:"ct-slice-pie",sliceDonut:"ct-slice-donut",label:"ct-label"},startAngle:0,total:void 0,donut:!1,donutWidth:60,showLabel:!0,labelOffset:0,labelPosition:"inside",labelInterpolationFnc:ut,labelDirection:"neutral",ignoreEmptyValues:!1};function os(o,n,e){const s=n.x>o.x;return s&&"explode"===e||!s&&"implode"===e?"start":s&&"implode"===e||!s&&"explode"===e?"end":"middle"}class rs extends ge{createChart(n){const{data:e}=this,s=jt(e),r=[];let i,a,l=n.startAngle;const d=qt(this.container,n.width,n.height,n.donut?n.classNames.chartDonut:n.classNames.chartPie);this.svg=d;const u=Pt(d,n);let c=Math.min(u.width()/2,u.height()/2);const g=n.total||s.series.reduce(In,0),p=Ct(n.donutWidth);"%"===p.unit&&(p.value*=c/100),c-=n.donut?p.value/2:0,a="outside"===n.labelPosition||n.donut?c:"center"===n.labelPosition?0:c/2,n.labelOffset&&(a+=n.labelOffset);const h={x:u.x1+u.width()/2,y:u.y2+u.height()/2},m=1===e.series.filter(A=>b(A,"value")?0!==A.value:0!==A).length;e.series.forEach((A,v)=>r[v]=d.elem("g")),n.showLabel&&(i=d.elem("g")),e.series.forEach((A,v)=>{var R,N;if(0===s.series[v]&&n.ignoreEmptyValues)return;const k=b(A,"name")&&A.name,I=b(A,"className")&&A.className,T=b(A,"meta")?A.meta:void 0;k&&r[v].attr({"ct:series-name":k}),r[v].addClass([null===(R=n.classNames)||void 0===R?void 0:R.series,I||"".concat(null===(N=n.classNames)||void 0===N?void 0:N.series,"-").concat(Yt(v))].join(" "));let _=g>0?l+s.series[v]/g*360:0;const y=Math.max(0,l-(0===v||m?0:.2));_-y>=359.99&&(_=y+359.99);const C=It(h.x,h.y,c,y),M=It(h.x,h.y,c,_),Y=new L(!n.donut).move(M.x,M.y).arc(c,c,0,+(_-l>180),0,C.x,C.y);n.donut||Y.line(h.x,h.y);const ht=r[v].elem("path",{d:Y.stringify()},n.donut?n.classNames.sliceDonut:n.classNames.slicePie);if(ht.attr({"ct:value":s.series[v],"ct:meta":dt(T)}),n.donut&&ht.attr({style:"stroke-width: "+p.value+"px"}),this.eventEmitter.emit("draw",{type:"slice",value:s.series[v],totalDataSum:g,index:v,meta:T,series:A,group:r[v],element:ht,path:Y.clone(),center:h,radius:c,startAngle:l,endAngle:_,chartRect:u}),n.showLabel){let P,j;P=1===e.series.length?{x:h.x,y:h.y}:It(h.x,h.y,a,l+(_-l)/2),j=s.labels&&!se(s.labels[v])?s.labels[v]:s.series[v];const S=n.labelInterpolationFnc(j,v);if(S||0===S){const rt=i.elem("text",{dx:P.x,dy:P.y,"text-anchor":os(h,P,n.labelDirection)},n.classNames.label).text(String(S));this.eventEmitter.emit("draw",{type:"label",index:v,group:i,element:rt,text:""+S,chartRect:u,series:A,meta:T,...P})}}l=_}),this.eventEmitter.emit("created",{chartRect:u,svg:d,options:n})}constructor(n,e,s,r){super(n,e,xe,K({},xe,s),r),this.data=e}}let is=(()=>{class o extends w.cx{constructor(e,s){super(),this._state=e,this._org=s,this.day_list=this._state.day_list,this.stats=(0,Q.aj)([this._state.options,this._state.counts])}ngOnInit(){this.subscription("day_list",this.day_list.subscribe(e=>this.updateDailyChart(e))),this.subscription("stats",this.stats.subscribe(([e,s])=>this.updateLevelChart(e,s)))}updateDailyChart(e){const s={labels:e.map(r=>(0,G.Z)(r.date,"dd MMM")),series:[e.map(r=>r.utilisation)]};this._day_chart=new ns("#day-chart",s)}updateLevelChart(e,s){let{zones:r}=e||{};r.includes("All")&&(r=this._org.levels.filter(a=>a.parent_id===this._org.building.id).map(a=>a.id));const i={labels:(r||[]).map(a=>{const l=this._org.levelWithID([a]);return l?.display_name||l.name||""}),series:(r||[]).map(a=>s[a])};this._level_chart=new rs("#level-chart",i)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E),t.Y36(J.w7))},o.\u0275cmp=t.Xpm({type:o,selectors:[["report-desks-charts"]],features:[t.qOj],decls:11,vars:0,consts:[[1,"flex","items-center","space-x-4","w-full","px-4"],[1,"bg-white","dark:bg-neutral-700","rounded","shadow","flex-1"],[1,"border-b","border-gray-300","dark:border-neutral-500","p-4","text-xl","font-bold"],["id","day-chart",1,"ct-chart","ct-octave"],["util_chart",""],["id","level-chart",1,"ct-chart","ct-octave"],["level_chart",""]],template:function(e,s){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2),t._uU(3," Daily Utilisation "),t.qZA(),t._UZ(4,"div",3,4),t.qZA(),t.TgZ(6,"div",1)(7,"div",2),t._uU(8," Level Utilisation "),t.qZA(),t._UZ(9,"div",5,6),t.qZA()())},styles:["[_nghost-%COMP%]{display:block}"]}),o})();const as=["report-desks",""];function ls(o,n){if(1&o&&(t.ynx(0),t.TgZ(1,"div",4)(2,"div",5)(3,"h3"),t._uU(4,"Total Bookings"),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.ALo(7,"async"),t.qZA()(),t.TgZ(8,"div",5)(9,"h3"),t._uU(10,"Utilisation"),t.qZA(),t.TgZ(11,"p"),t._uU(12),t.ALo(13,"async"),t.qZA()()(),t._UZ(14,"report-desks-charts")(15,"report-desks-overall-list")(16,"report-desks-levels-list"),t.BQk()),2&o){const e=t.oxw(2);t.xp6(6),t.Oqu(t.lcZ(7,2,e.total_count)||0),t.xp6(6),t.hij("",t.lcZ(13,4,e.utilisation)||0,"%")}}function cs(o,n){if(1&o&&(t.ynx(0),t.YNc(1,ls,17,6,"ng-container",1),t.ALo(2,"async"),t.BQk()),2&o){const e=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,e.total_count))("ngIfElse",s)}}function us(o,n){1&o&&(t.TgZ(0,"div",6),t._UZ(1,"mat-spinner",7),t.TgZ(2,"p",8),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function ps(o,n){1&o&&(t.TgZ(0,"div",6)(1,"p",8),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}let ds=(()=>{class o{constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,Z.U)(s=>s.count||0)),this.utilisation=this._state.stats.pipe((0,Z.U)(s=>(100*(s.utilisation||0)).toFixed(1))),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"desks"})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E))},o.\u0275cmp=t.Xpm({type:o,selectors:[["","report-desks",""]],attrs:as,decls:8,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],[1,"m-4","p-4","rounded","bg-white","shadow","flex","justify-center","items-center","space-x-2"],[1,"flex","flex-col","items-center","flex-1"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,s){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,cs,3,4,"ng-container",1),t.ALo(3,"async"),t.YNc(4,us,4,1,"ng-template",null,2,t.W1O),t.YNc(6,ps,3,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const r=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,s.loading))("ngIfElse",r)}},dependencies:[x.O5,wt.Ou,Zt,Mn,Sn,is,x.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}h3[_ngcontent-%COMP%]{font-weight:500}p[_ngcontent-%COMP%]:not([simple]){font-size:1.75rem}"]}),o})();var ye=f(1950);let Vt=(()=>{class o{constructor(e){this._reports=e,this.catering_orders=this._reports.bookings.pipe((0,Z.U)(s=>(0,w.xH)(s.filter(i=>i.extension_data?.catering?.length).map(i=>i.extension_data?.catering.map(a=>new ye.GX({...a,deliver_at:i.date,event:i})))).filter(i=>i).sort((i,a)=>i.event?.date-a.event?.date)),(0,q.d)(1)),this.catering_items=this.catering_orders.pipe((0,Z.U)(s=>{const r=[];for(const i of s)for(const a of i?.items||[]){const l=r.findIndex(d=>a.options_string===d.options_string);l>=0?a[l]=new ye.Ud({...a,quantity:a?.quantity+a[l]?.quantity}):r.push(a)}return r.sort((i,a)=>a.quantity-i.quantity)})),this.stats=(0,Q.aj)([this.catering_orders,this.catering_items]).pipe((0,Z.U)(([s,r])=>{const i=s.reduce((a,l)=>a+l.total_cost,0);return{order_count:s.length,unique_items:r.length,item_count:s.reduce((a,l)=>a+l.item_count,0),total_cost:i,avg_cost:i/s.length}}))}downloadOrders(){var e=this;return(0,D.Z)(function*(){const s=yield e.catering_orders.pipe((0,H.q)(1)).toPromise(),r=(0,w.o3)(s);return(0,w.Sv)("catering-orders.csv",r)})()}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(E))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),ms=(()=>{class o{get code(){return this._org.currency_code}constructor(e,s){this._report=e,this._org=s,this.stats=this._report.stats}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Vt),t.Y36(J.w7))},o.\u0275cmp=t.Xpm({type:o,selectors:[["catering-report-overall"]],decls:32,vars:21,consts:[[1,"bg-white","dark:bg-neutral-700","shadow","rounded","m-2","px-8","w-48","h-24","flex","flex-col","items-center","justify-center"],["count","",1,"text-3xl"],[1,""],["unique","",1,"text-3xl"],["items","",1,"text-3xl"],["total","",1,"text-3xl"],["average","",1,"text-3xl"]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"div",2),t._uU(5,"Orders"),t.qZA()(),t.TgZ(6,"div",0)(7,"div",3),t._uU(8),t.ALo(9,"async"),t.qZA(),t.TgZ(10,"div",2),t._uU(11,"Unique Items"),t.qZA()(),t.TgZ(12,"div",0)(13,"div",4),t._uU(14),t.ALo(15,"async"),t.qZA(),t.TgZ(16,"div",2),t._uU(17,"Ordered Items"),t.qZA()(),t.TgZ(18,"div",0)(19,"div",5),t._uU(20),t.ALo(21,"currency"),t.ALo(22,"async"),t.qZA(),t.TgZ(23,"div",2),t._uU(24,"Total"),t.qZA()(),t.TgZ(25,"div",0)(26,"div",6),t._uU(27),t.ALo(28,"currency"),t.ALo(29,"async"),t.qZA(),t.TgZ(30,"div",2),t._uU(31,"Order Average"),t.qZA()()),2&e){let r,i,a,l,d;t.xp6(2),t.hij(" ",(null==(r=t.lcZ(3,5,s.stats))?null:r.order_count)||"0"," "),t.xp6(6),t.hij(" ",(null==(i=t.lcZ(9,7,s.stats))?null:i.unique_items)||"0"," "),t.xp6(6),t.Oqu((null==(a=t.lcZ(15,9,s.stats))?null:a.item_count)||"0"),t.xp6(6),t.hij(" ",t.xi3(21,11,(null==(l=t.lcZ(22,14,s.stats))?null:l.total_cost)/100||0,s.code)," "),t.xp6(7),t.hij(" ",t.xi3(28,16,(null==(d=t.lcZ(29,19,s.stats))?null:d.avg_cost)/100||0,s.code)," ")}},dependencies:[x.Ov,x.H9],styles:["[_nghost-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;padding:.5rem}"]}),o})();var Gt=f(3649);function hs(o,n){if(1&o&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&o){const e=n.data;t.AsE(" ",t.lcZ(1,2,e)," at ",t.xi3(2,4,e,"shortTime")," ")}}function gs(o,n){if(1&o&&(t._uU(0),t.ALo(1,"currency")),2&o){const e=n.data,s=t.oxw();t.hij(" ",t.xi3(1,1,e/100,s.code)," ")}}const fs=function(){return["deliver_at","item_count","total_cost"]},_s=function(){return["Date","Items","Total Cost"]},vs=function(){return["flex"]},xs=function(o,n){return{deliver_at:o,total_cost:n}};let ys=(()=>{class o{get code(){return this._org.currency_code}constructor(e,s){this._report=e,this._org=s,this.orders=this._report.catering_orders,this.download=()=>this._report.downloadOrders()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Vt),t.Y36(J.w7))},o.\u0275cmp=t.Xpm({type:o,selectors:[["catering-report-orders"]],decls:12,vars:12,consts:[[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["matRipple-icon","","matTooltip","Download list",3,"click"],["empty","No orders for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination"],["date_state",""],["cost_state",""]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),t._uU(3,"Orders"),t.qZA(),t.TgZ(4,"button",3),t.NdJ("click",function(){return s.download()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()()(),t._UZ(7,"custom-table",4),t.YNc(8,hs,3,7,"ng-template",null,5,t.W1O),t.YNc(10,gs,2,4,"ng-template",null,6,t.W1O),t.qZA()),2&e){const r=t.MAs(9),i=t.MAs(11);t.xp6(7),t.Q6J("dataSource",s.orders)("columns",t.DdM(6,fs))("display_column",t.DdM(7,_s))("column_size",t.DdM(8,vs))("template",t.WLB(9,xs,r,i))("pagination",!0)}},dependencies:[Gt.gM,V.o,$.C,x.H9,x.uU]}),o})();function ws(o,n){if(1&o&&(t.TgZ(0,"span",7),t._uU(1),t.qZA()),2&o){const e=t.oxw().data,s=t.oxw();t.Q6J("matTooltip",s.options(e)),t.xp6(1),t.hij(" ",e.length," option(s) ")}}function Zs(o,n){1&o&&t.YNc(0,ws,2,2,"span",6),2&o&&t.Q6J("ngIf",n.data.length)}function bs(o,n){if(1&o&&(t._uU(0),t.ALo(1,"currency")),2&o){const e=n.data,s=t.oxw();t.hij(" ",t.xi3(1,1,(e||0)/100,s.code)," ")}}const Cs=function(){return["name","options","quantity","unit_price","total_cost"]},As=function(){return["Name","Options","Quantity","Unit Price","Total Cost"]},Ts=function(){return["flex"]},Ms=function(o,n,e){return{options:o,unit_price:n,total_cost:e}};let Os=(()=>{class o{get code(){return this._org.currency_code}constructor(e,s){this._report=e,this._org=s,this.items=this._report.catering_items}options(e){return e.map(s=>s.name).join("\n")}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(Vt),t.Y36(J.w7))},o.\u0275cmp=t.Xpm({type:o,selectors:[["catering-report-items"]],decls:9,vars:13,consts:[[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty","No orders for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination"],["option_state",""],["cost_state",""],["class","text-xs px-2 py-1 rounded bg-gray-300",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-gray-300",3,"matTooltip"]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2",2),t._uU(3,"Ordered Items"),t.qZA()(),t._UZ(4,"custom-table",3),t.YNc(5,Zs,1,1,"ng-template",null,4,t.W1O),t.YNc(7,bs,2,4,"ng-template",null,5,t.W1O),t.qZA()),2&e){const r=t.MAs(6),i=t.MAs(8);t.xp6(4),t.Q6J("dataSource",s.items)("columns",t.DdM(6,Cs))("display_column",t.DdM(7,As))("column_size",t.DdM(8,Ts))("template",t.kEZ(9,Ms,r,i,i))("pagination",!0)}},dependencies:[x.O5,Gt.gM,$.C,x.H9]}),o})();function Rs(o,n){1&o&&(t.TgZ(0,"div",5),t._UZ(1,"catering-report-overall")(2,"catering-report-orders")(3,"catering-report-items"),t.qZA())}function Us(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Rs,4,0,"div",4),t.ALo(2,"async"),t.BQk()),2&o){const e=t.oxw(),s=t.MAs(7);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,e.total_count))("ngIfElse",s)}}function Ls(o,n){1&o&&(t.TgZ(0,"div",6),t._UZ(1,"mat-spinner",7),t.TgZ(2,"p",8),t._uU(3,"Loading report data..."),t.qZA()()),2&o&&(t.xp6(1),t.Q6J("diameter",32))}function Ns(o,n){1&o&&(t.TgZ(0,"div",6)(1,"p",8),t._uU(2," Select levels and time period to generate a report. "),t.qZA()())}let Ss=(()=>{class o{constructor(e){this._state=e,this.total_count=this._state.stats.pipe((0,Z.U)(s=>s.count||0)),this.loading=this._state.loading}ngOnInit(){this._state.setOptions({type:"events"})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(E))},o.\u0275cmp=t.Xpm({type:o,selectors:[["catering-report"]],decls:8,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["load_state",""],["empty_state",""],["class","h-full w-full",4,"ngIf","ngIfElse"],[1,"h-full","w-full"],[1,"h-full","w-full","flex","flex-col","items-center","p-8"],[1,"mb-4",3,"diameter"],["simple",""]],template:function(e,s){if(1&e&&(t._UZ(0,"reports-options"),t.TgZ(1,"div",0),t.YNc(2,Us,3,4,"ng-container",1),t.ALo(3,"async"),t.YNc(4,Ls,4,1,"ng-template",null,2,t.W1O),t.YNc(6,Ns,3,0,"ng-template",null,3,t.W1O),t.qZA()),2&e){const r=t.MAs(5);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,s.loading))("ngIfElse",r)}},dependencies:[x.O5,wt.Ou,Zt,ms,ys,Os,x.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%}"]}),o})();var Es=f(5778),ks=f(2198),Ds=f(2994);const Ut={};let Wt=(()=>{class o{transform(e){return e?(Ut[e]||(Ut[e]=(0,ft.VE)(e).pipe((0,Z.U)(s=>s[0]||new ft.mO({id:e,name:e})),(0,xt.K)(s=>(0,W.of)(new ft.mO({id:e,name:e}))),(0,q.d)(1))),Ut[e]):(0,W.of)(null)}static addUser(e){Ut[e.id]=(0,W.of)(e).pipe((0,q.d)(1))}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275pipe=t.Yjl({name:"user",type:o,pure:!0}),o})(),we=(()=>{class o{get system_id(){return this._org.binding("contact_tracing")}constructor(e,s){this._org=e,this._reports=s,this._loading=new nt.X(""),this._generate=new nt.X(0),this._options=new nt.X({start:(0,tt.Z)(Date.now()),end:(0,et.Z)(Date.now())}),this.events=(0,Q.aj)([this._options,this._generate]).pipe((0,Es.x)((r,i)=>r[1]===i[1]),(0,ks.h)(([r,i])=>!!i),(0,at.w)(([{start:r,end:i,user:a}])=>{if(!a)return(0,W.of)([]);this._loading.next("Loading contact events...");const l=(0,Kt.rTZ)(this.system_id,"ContactTracing");return a=a||(0,w.ar)(),Wt.addUser(a),this.system_id&&l?l.execute("close_contacts",[a.email,a.username,(0,_t.Z)(r),(0,_t.Z)(i)]).catch(d=>((0,w.cB)(`${d?.msg||JSON.stringify(d)}`),[])):(0,W.of)([])}),(0,Z.U)(r=>{const i=this._options.getValue().user||(0,w.ar)();return r.map(a=>({mac_address:a.mac_address,date:1e3*a.contact_time,duration:Math.floor(a.duration/60)||0,user_id:i.id,user:i.name,contact_id:a.username,distance:1}))}),(0,xt.K)(r=>((0,w.cB)(`${r?.msg||JSON.stringify(r)}`),(0,W.of)([]))),(0,Ds.b)(r=>this._loading.next("")),(0,q.d)(1)),this.options=this._options.asObservable(),this.loading=this._loading.asObservable()}setOptions(e){this._options.next({...this._options.getValue(),...e})}generateReport(){this._generate.next(Date.now())}downloadReport(){var e=this;return(0,D.Z)(function*(){const{start:s,end:r}=yield e._reports.options.pipe((0,H.q)(1)).toPromise(),i=yield e.events.pipe((0,H.q)(1)).toPromise(),a=new Wt,l=yield Promise.all(i.map(function(){var d=(0,D.Z)(function*(u){return{"MAC Address":u.mac_address,Date:(0,G.Z)(u.date,"dd MMM yyyy, h:mm a"),"User Name":u.user,"Contact Name":(yield a.transform(u.contact_id).toPromise())?.name||("null"!==u.contact_id?u.contact_id:null)||u.mac_address,Duration:`${Math.floor(u.duration/60)?Math.floor(u.duration/60)+"h ":""}${Math.floor(u.duration%60)+"m"}`,Distance:u.distance}});return function(u){return d.apply(this,arguments)}}()));(0,w.Sv)(`report+contact-tracing+${(0,G.Z)(s,"yyyy-MM-dd")}+${(0,G.Z)(r,"yyyy-MM-dd")}.csv`,(0,w.o3)(l))})()}}return o.\u0275fac=function(e){return new(e||o)(t.LFG(J.w7),t.LFG(E))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var Ys=f(9697);let zs=(()=>{class o{constructor(e){this._state=e,this.options=this._state.options,this.setOptions=s=>this._state.setOptions(s),this.generate=()=>this._state.generateReport()}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(we))},o.\u0275cmp=t.Xpm({type:o,selectors:[["contact-tracing-options"]],decls:15,vars:14,consts:[[1,"flex","items-center","space-x-2","w-full","p-2","bg-white","dark:bg-neutral-700","shadow"],["appearance","outline",1,"w-[18rem]"],[3,"rangePicker"],["matStartDate","","placeholder","Start date",3,"ngModel","ngModelChange"],["matEndDate","","placeholder","End date",3,"ngModel","ngModelChange"],["matSuffix","",3,"for"],["picker",""],["placeholder","Search for user to trace...",1,"w-64","h-12","mb-2","mt-1",3,"ngModel","ngModelChange"],["matRipple","",3,"disabled","click"]],template:function(e,s){if(1&e&&(t.TgZ(0,"div",0)(1,"mat-form-field",1)(2,"mat-date-range-input",2)(3,"input",3),t.NdJ("ngModelChange",function(i){return i?s.setOptions({start:i,user:null}):""}),t.ALo(4,"async"),t.qZA(),t.TgZ(5,"input",4),t.NdJ("ngModelChange",function(i){return i?s.setOptions({end:i,user:null}):""}),t.ALo(6,"async"),t.qZA()(),t._UZ(7,"mat-datepicker-toggle",5)(8,"mat-date-range-picker",null,6),t.qZA(),t.TgZ(10,"a-user-search-field",7),t.NdJ("ngModelChange",function(i){return s.setOptions({user:i})}),t.ALo(11,"async"),t.qZA(),t.TgZ(12,"button",8),t.NdJ("click",function(){return s.generate()}),t.ALo(13,"async"),t._uU(14," Generate Report "),t.qZA()()),2&e){const r=t.MAs(9);let i,a,l,d;t.xp6(2),t.Q6J("rangePicker",r),t.xp6(1),t.Q6J("ngModel",null==(i=t.lcZ(4,6,s.options))?null:i.start),t.xp6(2),t.Q6J("ngModel",null==(a=t.lcZ(6,8,s.options))?null:a.end),t.xp6(2),t.Q6J("for",r),t.xp6(3),t.Q6J("ngModel",null==(l=t.lcZ(11,10,s.options))?null:l.user),t.xp6(2),t.Q6J("disabled",!(null!=(d=t.lcZ(13,12,s.options))&&d.user))}},dependencies:[X.Fj,X.JJ,X.On,yt.KE,yt.R9,z.nW,z.wx,z.zY,z.By,z._g,it.wG,Ys.d,x.Ov],styles:["mat-form-field[_ngcontent-%COMP%]{height:3.25rem}"]}),o})();function Is(o,n){if(1&o&&(t.TgZ(0,"span",16),t._uU(1),t.qZA()),2&o){const e=t.oxw().data,s=t.oxw(3);t.Q6J("matTooltip",s.options(e)),t.xp6(1),t.hij(" ",e.length," option(s) ")}}function js(o,n){1&o&&t.YNc(0,Is,2,2,"span",15),2&o&&t.Q6J("ngIf",n.data.length)}function Bs(o,n){if(1&o&&(t._uU(0),t.ALo(1,"async"),t.ALo(2,"user")),2&o){const s=n.row;let r;t.Oqu((null==(r=t.lcZ(1,1,t.lcZ(2,3,n.data)))?null:r.name)||s.mac_address)}}function qs(o,n){if(1&o&&(t._uU(0),t.ALo(1,"date"),t.ALo(2,"date")),2&o){const e=n.data;t.AsE(" ",t.xi3(1,2,e,"mediumDate"),", ",t.xi3(2,5,e,"shortTime")," ")}}function Ps(o,n){if(1&o&&t._uU(0),2&o){const e=n.data,s=t.oxw(3);t.hij(" ",s.formatDuration(e||0)||"Less than a minute"," ")}}function Js(o,n){1&o&&t._uU(0),2&o&&t.hij(" ",n.data,"m ")}const Qs=function(){return["date","user_id","contact_id","duration"]},Fs=function(){return["Time of Contact","Person","Close Contact","Duration"]},Xs=function(){return["12r","14r","flex","10r"]},Vs=function(o,n,e,s,r,i){return{options:o,date:n,distance:e,user_id:s,contact_id:r,duration:i}};function Gs(o,n){if(1&o&&(t.TgZ(0,"div",6)(1,"div",7)(2,"h2",8),t._uU(3,"Contact Events"),t.qZA()(),t._UZ(4,"custom-table",9),t.YNc(5,js,1,1,"ng-template",null,10,t.W1O),t.YNc(7,Bs,3,5,"ng-template",null,11,t.W1O),t.YNc(9,qs,3,8,"ng-template",null,12,t.W1O),t.YNc(11,Ps,1,1,"ng-template",null,13,t.W1O),t.YNc(13,Js,1,1,"ng-template",null,14,t.W1O),t.qZA()),2&o){const e=t.MAs(6),s=t.MAs(8),r=t.MAs(10),i=t.MAs(12),a=t.MAs(14),l=t.oxw(2);t.xp6(4),t.Q6J("dataSource",l.tracing_events)("columns",t.DdM(7,Qs))("display_column",t.DdM(8,Fs))("column_size",t.DdM(9,Xs))("template",t.HTZ(10,Vs,e,r,a,s,s,i))("pagination",!0)("page_size",30)}}function Ws(o,n){if(1&o&&(t.ynx(0),t.YNc(1,Gs,15,17,"div",5),t.ALo(2,"async"),t.BQk()),2&o){const e=t.oxw(),s=t.MAs(10);let r;t.xp6(1),t.Q6J("ngIf",null==(r=t.lcZ(2,2,e.options))?null:r.user)("ngIfElse",s)}}function Hs(o,n){if(1&o&&(t.TgZ(0,"div",17),t._UZ(1,"map-spinner",18),t.TgZ(2,"p"),t._uU(3),t.ALo(4,"async"),t.qZA()()),2&o){const e=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,1,e.loading))}}function $s(o,n){1&o&&(t.TgZ(0,"div",17)(1,"p",19),t._uU(2,"Select a user from the topbar to begin"),t.qZA()())}let Ks=(()=>{class o{constructor(e){this._state=e,this.loading=this._state.loading,this.options=this._state.options,this.tracing_events=this._state.events,this.setOptions=s=>this._state.setOptions(s),this.downloadReport=()=>this._state.downloadReport(),this.formatDuration=s=>(0,Dt.Z)({hours:Math.floor(s/60),minutes:s%60})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(we))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-contact-tracing-report"]],decls:11,vars:4,consts:[[1,"flex-1","h-1/2","w-full","overflow-auto"],[4,"ngIf","ngIfElse"],["icon","","matRipple","","matTooltip","Download Report",1,"bg-white","dark:bg-neutral-700","absolute","bottom-2","left-2","shadow",3,"click"],["load_state",""],["empty_state",""],["class","w-[64rem] max-w-[calc(100%-2rem)] rounded overflow-hidden bg-white dark:bg-neutral-700 shadow mx-auto my-2",4,"ngIf","ngIfElse"],[1,"w-[64rem]","max-w-[calc(100%-2rem)]","rounded","overflow-hidden","bg-white","dark:bg-neutral-700","shadow","mx-auto","my-2"],[1,"border-b","border-gray-200","dark:border-neutral-500","flex","items-center","justify-between","px-4"],[1,"py-2","text-xl","font-medium"],["empty","No contact records for selected period",1,"w-full","h-full",3,"dataSource","columns","display_column","column_size","template","pagination","page_size"],["option_state",""],["user_state",""],["date_state",""],["duration_state",""],["distance_state",""],["class","text-xs px-2 py-1 rounded bg-gray-300 dark:bg-neutral-600",3,"matTooltip",4,"ngIf"],[1,"text-xs","px-2","py-1","rounded","bg-gray-300","dark:bg-neutral-600",3,"matTooltip"],[1,"p-8","flex","flex-col","items-center","justify-center","space-y-2"],["diameter","32"],[1,"opacity-60"]],template:function(e,s){if(1&e&&(t._UZ(0,"contact-tracing-options"),t.TgZ(1,"div",0),t.YNc(2,Ws,3,4,"ng-container",1),t.ALo(3,"async"),t.qZA(),t.TgZ(4,"button",2),t.NdJ("click",function(){return s.downloadReport()}),t.TgZ(5,"app-icon"),t._uU(6,"download"),t.qZA()(),t.YNc(7,Hs,5,3,"ng-template",null,3,t.W1O),t.YNc(9,$s,3,0,"ng-template",null,4,t.W1O)),2&e){const r=t.MAs(8);t.xp6(2),t.Q6J("ngIf",!t.lcZ(3,2,s.loading))("ngIfElse",r)}},dependencies:[x.O5,Gt.gM,it.wG,V.o,$.C,zs,x.Ov,x.uU,Wt],styles:["[_nghost-%COMP%]{width:100%;height:100%;display:flex;flex-direction:column}"]}),o})();var to=f(158);function eo(o,n){if(1&o&&(t._UZ(0,"iframe",1),t.ALo(1,"safe")),2&o){const e=t.oxw();t.Q6J("src",t.xi3(1,1,e.report_url,"resource"),t.uOi)}}const no={};let so=(()=>{class o extends w.cx{get report_url(){let e=(this._settings.get("app.custom_reports")||[]).find(r=>r.id===this.id)||no;return e.url?e.url+(e.url.includes("?")?"&":"?")+"kiosk=tv"+(e.api_key?`&key=${encodeURIComponent(e.api_key)}`:""):""}constructor(e,s){super(),this._settings=e,this._route=s,this.id=""}ngOnInit(){this.subscription("route.params",this._route.paramMap.subscribe(e=>this.id=e.get("id")||""))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(w.gb),t.Y36(B.gz))},o.\u0275cmp=t.Xpm({type:o,selectors:[["custom-report"]],features:[t.qOj],decls:1,vars:1,consts:[["class","w-full h-full",3,"src",4,"ngIf"],[1,"w-full","h-full",3,"src"]],template:function(e,s){1&e&&t.YNc(0,eo,2,4,"iframe",0),2&e&&t.Q6J("ngIf",s.id)},dependencies:[x.O5,to.y],styles:["[_nghost-%COMP%]{height:100%;width:100%}"]}),o})();var oo=f(6866),ro=f(3320);const io=["app-new-reports",""];function ao(o,n){1&o&&t._UZ(0,"div",3)}const Ze=[{path:"",component:Zt},{path:"bookings",component:yn},{path:"desks",component:ds},{path:"catering",component:Ss},{path:"contact-tracing",component:Ks},{path:":id",component:so},{path:"**",redirectTo:"desks",pathMatch:"full"}],co=[{path:"new",component:(()=>{class o{get path(){const e=this._router.url.split("/");return e[e.length-1]}constructor(e){this._router=e}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(B.F0))},o.\u0275cmp=t.Xpm({type:o,selectors:[["","app-new-reports",""]],attrs:io,decls:6,vars:1,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full","relative"],["reports-menu","","class","absolute inset-0",4,"ngIf"],["reports-menu","",1,"absolute","inset-0"]],template:function(e,s){1&e&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1),t._UZ(4,"router-outlet"),t.YNc(5,ao,1,0,"div",2),t.qZA()()),2&e&&(t.xp6(5),t.Q6J("ngIf","reports"===s.path))},dependencies:[x.O5,oo.O,ro.u,B.lC,$t],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:#fff}main[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]:not(router-outlet){display:flex;flex-direction:column;width:100%;height:100%}"]}),o})(),children:Ze},{path:"",component:Be,children:Ze}];let uo=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[x.ez,X.u5,Ae.v,qe.YR,ft.PP,Te.TU,B.Bz.forChild(co)]}),o})()}}]);