"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_poi-manager_poi-manager_module_ts"],{72933:(Ge,S,s)=>{s.r(S),s.d(S,{POIManagerModule:()=>Re});var m=s(26575),p=s(28849),J=s(92649),U=s(97910),k=s(47049),Q=s(10060),v=s(71670),T=s(93121),g=s(70462),P=s(28159),N=s(36520),I=s(47422),F=s(680),f=s(17401),d=s(34592),M=s(47298),O=s(46939),y=s(9681),j=s(95933),q=s(15746),Y=s(11862),e=s(29039);let E=(()=>{class a{constructor(t){this._data=t}get hover(){return!!this._data?.hover}static#e=this.\u0275fac=function(o){return new(o||a)(e.Y36(Y.ui))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["map-show-element"]],decls:2,vars:8,consts:[[1,"relative","w-full","h-full","border-2"],[1,"opacity-30","absolute","inset-0"]],template:function(o,n){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"div",1),e.qZA()),2&o&&(e.ekj("border-secondary",n.hover)("border-primary",!n.hover),e.xp6(),e.ekj("bg-secondary",n.hover)("bg-primary",!n.hover))}})}return a})();var A=s(71268),w=s(99674),L=s(96355),h=s(10257),b=s(94888),X=s(51674);function H(a,r){if(1&a&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&a){const t=r.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function K(a,r){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"async"),e.ALo(3,"async"),e.qZA()),2&a){const t=e.oxw();let o;e.xp6(),e.AsE(" ",100*t.page+1," - ",(null==(o=e.lcZ(2,2,t.search_results))?null:o.length)>100*t.page+100?100*t.page+100:null==(o=e.lcZ(3,4,t.search_results))?null:o.length," ")}}function z(a,r){if(1&a&&(e.TgZ(0,"div",26),e._uU(1),e.qZA()),2&a){const t=e.oxw().$implicit;e.xp6(),e.hij(" ",t.location," ")}}function B(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){const l=e.CHM(t).$implicit,i=e.oxw(2);return e.KtG(i.selected.next(l.id))})("mouseover",function(){const l=e.CHM(t).$implicit,i=e.oxw(2);return e.KtG(i.hovered.next(l.id))}),e.TgZ(1,"div",23)(2,"div",24),e._uU(3),e.qZA(),e.YNc(4,z,2,1,"div",25),e.qZA()()}if(2&a){const t=r.$implicit,o=e.oxw(2);e.ekj("!bg-primary",t.id===o.selected.value)("!text-primary-content",t.id===o.selected.value),e.xp6(3),e.Oqu(t.name||t.id),e.xp6(),e.Q6J("ngIf",t.location)}}function W(a,r){if(1&a&&(e.ynx(0),e.YNc(1,B,5,6,"button",21),e.ALo(2,"slice"),e.ALo(3,"async"),e.BQk()),2&a){const t=e.oxw();e.xp6(),e.Q6J("ngForOf",e.Dn7(2,1,e.lcZ(3,5,t.search_results),100*t.page,100*t.page+100))}}function V(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",27)(1,"button",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.page=n.page-1)}),e.TgZ(2,"app-icon"),e._uU(3,"chevron_left"),e.qZA()(),e.TgZ(4,"button",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.page=0)}),e._uU(5," 1 "),e.qZA(),e.TgZ(6,"button",30)(7,"app-icon"),e._uU(8,"more_horiz"),e.qZA()(),e.TgZ(9,"button",31),e._uU(10),e.qZA(),e.TgZ(11,"button",30)(12,"app-icon"),e._uU(13,"more_horiz"),e.qZA()(),e.TgZ(14,"button",32),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.page=n.last_page)}),e._uU(15),e.ALo(16,"number"),e.ALo(17,"async"),e.qZA(),e.TgZ(18,"button",28),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.page=n.page+1)}),e.TgZ(19,"app-icon"),e._uU(20,"chevron_right"),e.qZA()()()}if(2&a){const t=e.oxw();let o;e.xp6(),e.Q6J("disabled",0===t.page),e.xp6(3),e.ekj("!bg-secondary",0===t.page)("text-secondary-content",0===t.page)("!rounded-full",0===t.page),e.xp6(2),e.ekj("opacity-0",t.page<1),e.xp6(3),e.ekj("opacity-0",t.page<1||t.page>t.last_page-2),e.xp6(),e.hij(" ",t.page+1," "),e.xp6(),e.ekj("opacity-0",t.page>t.last_page-1),e.xp6(3),e.ekj("!bg-secondary",t.page===t.last_page)("text-secondary-content",t.page===t.last_page)("!rounded-full",t.page===t.last_page),e.xp6(),e.hij(" ",e.xi3(16,22,(null==(o=e.lcZ(17,25,t.search_results))?null:o.length)/100,"1.0-0")," "),e.xp6(3),e.Q6J("disabled",t.page===t.last_page)}}function ee(a,r){1&a&&(e.TgZ(0,"div",33),e._UZ(1,"img",34),e.TgZ(2,"div",35),e._uU(3," No results found "),e.qZA()())}const te=()=>({controls:!0});let oe=(()=>{class a extends d.cx{poiItemFromMapsIndoorsItem(t){return{id:t.properties.externalId||t.properties.roomId||t.id,name:t.properties.name,location:t.properties.building?`${t.properties.building}, Level ${t.properties.floorName}`:"",area:Math.abs(t.geometry.bbox[0]-t.geometry.bbox[2])*Math.abs(t.geometry.bbox[1]-t.geometry.bbox[3])}}constructor(t,o){super(),this._org=t,this._maps_people=o,this.level=new T.Yo,this.map_info={},this.page=0,this.last_page=0,this.selected=new g.X(""),this.hovered=new g.X(""),this.search=new g.X(""),this.changed=new g.X(0),this.level_list=this._org.active_levels,this.actions=[{id:"*",action:"click",callback:(n,l)=>this.selectID(l||n)}],this.features=(0,P.aj)([this.selected,this.hovered]).pipe((0,I.U)(([n,l])=>[{location:n,content:E,full_size:!0,no_scale:!0},{location:l,content:E,data:{hover:!0},full_size:!0,no_scale:!0}].filter(i=>i.location))),this.search_results=(0,P.aj)([this.search,this._maps_people.available$,this.changed]).pipe((0,j.b)(300),(0,N.w)(([n,l])=>(console.log("Search:",n,l),l?n.length>2?mapsindoors?.services.LocationsService.getLocations({q:n}).then(i=>{const c=i.map(_=>this.poiItemFromMapsIndoorsItem(_));return this.selected_item&&c.unshift(this.poiItemFromMapsIndoorsItem(this.selected_item)),c}):(0,y.of)(this.selected_item?[this.poiItemFromMapsIndoorsItem(this.selected_item)]:[]):(0,y.of)(Object.entries(this.map_info).map(([i,c])=>({id:i,area:c.w*c.h})).filter(({id:i,area:c})=>i.toLowerCase().includes(n.toLowerCase())&&c<.5).sort((i,c)=>c.area-i.area)))),(0,q.b)(n=>{this.page=0,this.last_page=Math.floor(n.length/100)}),(0,F.d)(1)),this.setMapInfo=n=>this.map_info=n}ngOnInit(){var t=this;return(0,v.Z)(function*(){const o=yield t.level_list.pipe((0,O.q)(1)).toPromise();o.length&&(t.level=o[0])})()}onChange(){this.changed.next(Date.now())}selectID(t){var o=this;this.timeout("select_id",(0,v.Z)(function*(){if(yield o._maps_people.available$.pipe((0,O.q)(1)).toPromise()){console.log("Item:",t);const l=t.properties?.externalId||t.properties?.roomId||t.id;console.log("Selected ID:",l),o.selected_item=t,l&&o.selected.next(l),o.changed.next(Date.now())}else{const l=t,i=[];for(const[c,_]of Object.entries(o.map_info))_.x<=l.x&&l.x<=_.x+_.w&&_.y<=l.y&&l.y<=_.y+_.h&&i.push([c,_.h*_.w]);i.sort((c,_)=>c[1]-_[1]),i.filter(([c,_])=>_<=.5),i.length&&(console.log("Selected ID:",i[0][0]),o.selected.next(i[0][0]))}}))}static#e=this.\u0275fac=function(o){return new(o||a)(e.Y36(T.w7),e.Y36(d.sF))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["select-poi-map-modal"]],features:[e.qOj],decls:34,vars:26,consts:()=>{let t;return t=$localize`:@@searchPlaceholder␟7e892ba15f2c6c17e83510e273b3e10fc32ea016␟4580988005648117665:Search`,[["icon","","matRipple","","mat-dialog-close",""],[1,"flex","min-w-[80vw]","max-w-[calc(100vw-2rem)]","sm:max-w-[64rem]","max-h-[75vh]","h-[75vh]","overflow-hidden"],["map","",1,"relative","h-full","flex-1","w-1/2","bg-base-200"],[3,"src","actions","features","options","focus","mapInfo"],["poi-list","",1,"relative","flex","flex-col","h-full","w-[20rem]","border-l","border-base-300","shadow"],["search","",1,"flex","flex-col","border-b","border-base-200","p-2"],["appearance","outline",1,"w-full","no-subscript","mb-2"],["name","level",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-full","no-subscript"],["matInput","","name","search","placeholder",t,3,"ngModel","ngModelChange"],["matPrefix","",1,"text-2xl"],["list","",1,"flex","flex-col","flex-1","h-1/2","overflow-auto"],[1,"sticky","top-0","w-full","bg-base-100","p-3","z-10"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["pagination","","class","sticky flex items-center justify-center bottom-0 w-full bg-base-100 p-2 z-10 space-x-1",4,"ngIf"],["empty_state",""],["actions","",1,"p-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-full",3,"disabled","mat-dialog-close"],[3,"value"],["matRipple","","class","flex items-center text-left w-[calc(100%-1rem)] mx-2 my-1 p-2 rounded odd:border odd:border-base-200 even:bg-base-200 hover:bg-base-300 h-16 min-h-16",3,"!bg-primary","!text-primary-content","click","mouseover",4,"ngFor","ngForOf"],["matRipple","",1,"flex","items-center","text-left","w-[calc(100%-1rem)]","mx-2","my-1","p-2","rounded","odd:border","odd:border-base-200","even:bg-base-200","hover:bg-base-300","h-16","min-h-16",3,"click","mouseover"],[1,"flex","flex-col"],[1,""],["class","text-xs opacity-30",4,"ngIf"],[1,"text-xs","opacity-30"],["pagination","",1,"sticky","flex","items-center","justify-center","bottom-0","w-full","bg-base-100","p-2","z-10","space-x-1"],["icon","","matRipple","",1,"border","border-base-200","rounded",3,"disabled","click"],["icon","","matRipple","",3,"click"],["icon",""],["icon","","matRipple","",1,"!bg-secondary","text-secondary-content"],["icon","","matRipple","",1,"border","border-base-200","rounded",3,"click"],[1,"flex","flex-col","items-center","justify-center","h-full","flex-1","space-y-4"],["src","assets/icons/no-results.svg",1,"w-36"],[1,"text-center","opacity-30"]]},template:function(o,n){if(1&o&&(e.TgZ(0,"header")(1,"h2"),e._uU(2,"Select Point of Interest from Map"),e.qZA(),e.TgZ(3,"button",0)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.TgZ(6,"main",1)(7,"div",2)(8,"interactive-map",3),e.NdJ("mapInfo",function(i){return n.setMapInfo(i)}),e.ALo(9,"async"),e.qZA()(),e.TgZ(10,"div",4)(11,"div",5)(12,"mat-form-field",6)(13,"mat-select",7),e.NdJ("ngModelChange",function(i){return n.level=i})("ngModelChange",function(){return n.onChange()}),e.YNc(14,H,2,2,"mat-option",8),e.ALo(15,"async"),e.qZA()(),e.TgZ(16,"mat-form-field",9)(17,"input",10),e.NdJ("ngModelChange",function(i){return n.search.next(i)}),e.ALo(18,"async"),e.qZA(),e.TgZ(19,"app-icon",11),e._uU(20,"search"),e.qZA()()(),e.TgZ(21,"div",12)(22,"div",13),e._uU(23),e.ALo(24,"async"),e.YNc(25,K,4,6,"span",14),e.qZA(),e.YNc(26,W,4,7,"ng-container",15),e.ALo(27,"async"),e.YNc(28,V,21,27,"div",16)(29,ee,4,0,"ng-template",null,17,e.W1O),e.qZA(),e.TgZ(31,"div",18)(32,"button",19),e._uU(33," Save "),e.qZA()()()()),2&o){const l=e.MAs(30);let i,c;e.xp6(8),e.Q6J("src",null==n.level?null:n.level.map_id)("actions",n.actions)("features",e.lcZ(9,15,n.features))("options",e.DdM(25,te))("focus",n.selected.value),e.xp6(5),e.Q6J("ngModel",n.level),e.xp6(),e.Q6J("ngForOf",e.lcZ(15,17,n.level_list)),e.xp6(3),e.Q6J("ngModel",e.lcZ(18,19,n.search)),e.xp6(6),e.hij(" Results (",(null==(i=e.lcZ(24,21,n.search_results))?null:i.length)||0,") "),e.xp6(2),e.Q6J("ngIf",n.last_page),e.xp6(),e.Q6J("ngIf",null==(c=e.lcZ(27,23,n.search_results))?null:c.length)("ngIfElse",l),e.xp6(2),e.Q6J("ngIf",n.last_page>0),e.xp6(4),e.Q6J("disabled",!n.selected.value)("mat-dialog-close",n.selected.value)}},dependencies:[m.sg,m.O5,p.Fj,p.JJ,p.On,A.KE,A.qo,w.Nt,L.gD,h.ey,f.ZT,h.wG,b.o,X.p,m.Ov,m.OU,m.JJ]})}return a})();var ne=s(33910);function ae(a,r){1&a&&(e.TgZ(0,"button",4)(1,"app-icon"),e._uU(2,"close"),e.qZA()())}function le(a,r){1&a&&(e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,18),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12),e._UZ(5,"input",19),e.qZA()())}function ie(a,r){if(1&a&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&a){const t=r.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t.display_name," ")}}const C=()=>({standalone:!0});function se(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,20),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12)(5,"mat-select",21),e.NdJ("ngModelChange",function(n){e.CHM(t);const l=e.oxw(3);return e.KtG(l.building=n)}),e.YNc(6,ie,2,2,"mat-option",22),e.ALo(7,"async"),e.qZA()()()}if(2&a){const t=e.oxw(3);e.xp6(5),e.Q6J("ngModel",t.building)("ngModelOptions",e.DdM(5,C)),e.xp6(),e.Q6J("ngForOf",e.lcZ(7,3,t.building_list))}}function ce(a,r){if(1&a&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&a){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(),e.hij(" ",t.display_name," ")}}function re(a,r){if(1&a&&(e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,24),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12)(5,"mat-select",25),e.YNc(6,ce,2,2,"mat-option",22),e.ALo(7,"async"),e.qZA()()()),2&a){const t=e.oxw(3);e.xp6(6),e.Q6J("ngForOf",e.lcZ(7,1,t.level_list))}}function _e(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",26)(1,"mat-form-field",27),e._UZ(2,"input",28),e.qZA(),e.TgZ(3,"button",29),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(3);return e.KtG(n.selectPOIfromMap())}),e.TgZ(4,"app-icon"),e._uU(5,"place"),e.qZA()()()}}function pe(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",30)(1,"mat-form-field",31)(2,"input",32),e.NdJ("ngModelChange",function(n){e.CHM(t);const l=e.oxw(3);return e.KtG(l.form.patchValue({location:[n,l.form.value.location[1]]}))}),e.qZA()(),e.TgZ(3,"mat-form-field",31)(4,"input",33),e.NdJ("ngModelChange",function(n){e.CHM(t);const l=e.oxw(3);return e.KtG(l.form.patchValue({location:[l.form.value.location[0],n]}))}),e.qZA()()()}if(2&a){const t=e.oxw(3);e.xp6(2),e.Q6J("ngModel",t.form.value.location[0])("ngModelOptions",e.DdM(4,C)),e.xp6(2),e.Q6J("ngModel",t.form.value.location[1])("ngModelOptions",e.DdM(5,C))}}function de(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"form",7),e.YNc(1,le,6,0,"div",8)(2,se,8,6,"div",8),e.ALo(3,"async"),e.YNc(4,re,8,3,"div",8),e.TgZ(5,"div",9)(6,"label",10),e.tHW(7,11),e._UZ(8,"span"),e.N_p(),e.qZA(),e.TgZ(9,"mat-form-field",12)(10,"mat-select",13),e.NdJ("ngModelChange",function(n){e.CHM(t);const l=e.oxw(2);return e.KtG(l.location_type=n)}),e.TgZ(11,"mat-option",14),e._uU(12,"Map ID"),e.qZA(),e.TgZ(13,"mat-option",15),e._uU(14,"Coordinates"),e.qZA()()(),e.YNc(15,_e,6,0,"div",16)(16,pe,5,6,"div",17),e.qZA()()}if(2&a){const t=e.oxw(2);let o;e.Q6J("formGroup",t.form),e.xp6(),e.Q6J("ngIf",t.form.controls.name),e.xp6(),e.Q6J("ngIf",(null==(o=e.lcZ(3,8,t.building_list))?null:o.length)>1),e.xp6(2),e.Q6J("ngIf",t.form.controls.level_id),e.xp6(6),e.Q6J("ngModel",t.location_type)("ngModelOptions",e.DdM(10,C)),e.xp6(5),e.Q6J("ngIf","map_id"===t.location_type),e.xp6(),e.Q6J("ngIf","coordinates"===t.location_type)}}function me(a,r){if(1&a&&(e.TgZ(0,"main",5),e.YNc(1,de,17,11,"form",6),e.qZA()),2&a){const t=e.oxw();e.xp6(),e.Q6J("ngIf",t.form)}}function ue(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"footer",34)(1,"button",35),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.save())}),e._uU(2,"Save"),e.qZA()()}}function ge(a,r){1&a&&(e.TgZ(0,"div",36),e._UZ(1,"mat-spinner",37),e.TgZ(2,"p",38),e._uU(3,"Saving Point Of Interest..."),e.qZA()())}let fe=(()=>{class a extends d.cx{get building(){return this._org.building}set building(t){this._org.building=t}constructor(t,o,n,l,i){super(),this._org=t,this._data=o,this._dialog_ref=n,this._settings=l,this._dialog=i,this.loading=!1,this.location_type=this._data?.location instanceof Array?"coordinates":"map_id",this.building_list=this._org.building_list,this.level_list=this._org.active_levels,this.form=new p.cw({id:new p.NI(this._data?.id||""),name:new p.NI(this._data?.name||"",[p.kI.required]),level_id:new p.NI(this._data?.level_id||"",[p.kI.required]),location:new p.NI(this._data?.location||"",[p.kI.required])})}ngOnInit(){var t=this;return(0,v.Z)(function*(){if(!t.form.value.level_id){const o=yield t.level_list.pipe((0,O.q)(1)).toPromise();o.length&&t.form.patchValue({level_id:o[0].id})}})()}selectPOIfromMap(){this._dialog.open(oe,{data:this._data}).afterClosed().subscribe(o=>{o&&this.form.patchValue({location:o})})}save(){var t=this;return(0,v.Z)(function*(){if(!t.form.valid)return(0,d.cB)(`Some form fields are invalid. [${(0,d.RD)(t.form).join(", ")}]`);const o=t.form.getRawValue();o.id||(o.id=`POI-${(0,d.O1)(8)}`),o.short_link_id=t._data?.short_link_id;const n=t._settings.get("app.kiosk_url_path")||"/map-kiosk",l=t._settings.get("app.short_url_public_key"),i="string"==typeof o.location?o.location:o.location.join(",");let c=`${n}/#/explore?level=${o.level_id}&locate=${i}&public=true`;if(l&&(c+=`&x-api-key=${l}`),o.short_link_id)yield(0,d.rN)(o.short_link_id,{id:o.short_link_id,name:o.name,description:`Point of Interest: ${o.name}`,uri:`${window.location.origin}/auth/login?continue=${encodeURIComponent(c)}`}).toPromise();else{const{id:u}=yield(0,d.Ke)({name:o.name,description:`Point of Interest: ${o.name}`,uri:`${window.location.origin}/auth/login?continue=${encodeURIComponent(c)}`}).toPromise();o.short_link_id=u}t.loading=!0;const x=(yield(0,M.rlq)(t._org.building.id,"map_features",{}).toPromise()).details||{};x[o.level_id]||(x[o.level_id]=[]),x[o.level_id]=[...x[o.level_id].filter(u=>u.id!==o.id),o].sort((u,$e)=>u.name.localeCompare($e.name));const D=yield(0,M.Ymr)(t._org.building.id,{name:"map_features",details:x,description:""}).toPromise().catch(u=>(0,d.cB)(u));D.id&&t._dialog_ref.close(D),t.loading=!1})()}static#e=this.\u0275fac=function(o){return new(o||a)(e.Y36(T.w7),e.Y36(f.WI),e.Y36(f.so),e.Y36(d.gb),e.Y36(f.uw))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["poi-modal"]],features:[e.qOj],decls:8,vars:5,consts:()=>{let t,o,n,l,i,c;return t=$localize`:@@nameLabel␟5db92d8696af8c0f3aa9ce5bf1e1305c8c5aa456␟8054963382343596237: Location${"\ufffd#8\ufffd"}:START_TAG_SPAN:*${"\ufffd/#8\ufffd"}:CLOSE_TAG_SPAN:: `,o=$localize`:@@nameLabel␟5813c0ce49afffe90191cb912c58fa68674457d8␟1912970594501107766: Name${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,n=$localize`:@@namePlaceholder␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,l=$localize`:@@nameLabel␟5e09041a10f5eb39aadfaa1a8dd77f4dc8d77314␟711878476466678637: Building${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,i=$localize`:@@nameLabel␟805d5ab24c829f98df246a63541ee827ce04a4c4␟6308222021008136210: Level${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,c=$localize`:@@locationPlaceholder␟ed31c09fd77c36238c13d83635f3fe5294c733d2␟471816275243265264:Location`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[28rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[28rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","name"],t,["appearance","outline"],["placeholder","Location Type",3,"ngModel","ngModelOptions","ngModelChange"],["value","map_id"],["value","coordinates"],["class","flex items-center space-x-2 pb-2",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],o,["matInput","","name","name","placeholder",n,"formControlName","name"],l,["placeholder","Select Building",3,"ngModel","ngModelOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],i,["formControlName","level_id","placeholder","Select Level"],[1,"flex","items-center","space-x-2","pb-2"],["appearance","outline",1,"no-subscript"],["matInput","","name","location","placeholder",c,"formControlName","location"],["icon","","matRipple","",1,"rounded","border","border-base-300","h-12","w-12",3,"click"],[1,"flex","items-center","space-x-2"],["appearance","outline",1,"flex-1"],["matInput","","name","latitude",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","name","longitude",3,"ngModel","ngModelOptions","ngModelChange"],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(o,n){if(1&o&&(e.TgZ(0,"header")(1,"h2"),e._uU(2),e.qZA(),e.YNc(3,ae,3,0,"button",0),e.qZA(),e.YNc(4,me,2,1,"main",1)(5,ue,3,0,"footer",2)(6,ge,4,0,"ng-template",null,3,e.W1O)),2&o){const l=e.MAs(7);e.xp6(2),e.hij("",n.form.value.id?"Edit":"Add"," Point Of Interest"),e.xp6(),e.Q6J("ngIf",!n.loading),e.xp6(),e.Q6J("ngIf",!n.loading)("ngIfElse",l),e.xp6(),e.Q6J("ngIf",!n.loading)}},dependencies:[m.sg,m.O5,p._Y,p.Fj,p.JJ,p.JL,p.On,A.KE,w.Nt,L.gD,h.ey,ne.Ou,f.ZT,h.wG,p.sg,p.u,b.o,m.Ov]})}return a})(),R=(()=>{class a{constructor(t,o){this._org=t,this._dialog=o,this._options=new g.X({}),this._change=new g.X(0),this.options=this._options.asObservable(),this._features=(0,P.aj)([this._org.active_building,this._change]).pipe((0,N.w)(([n])=>(0,M.rlq)(n.id,"map_features",{})),(0,I.U)(n=>n.details||{}),(0,F.d)(1)),this.filtered_features=(0,P.aj)([this._features,this._options]).pipe((0,I.U)(([n,l])=>{let i=Object.values(n).reduce((c,_)=>[...c,..._],[]);return l.search&&(i=i.filter(c=>c.name.toLowerCase().includes(l.search.toLowerCase()))),i}))}setFilters(t){this._options.next({...this._options.getValue(),...t})}setSearchString(t){this._options.next({...this._options.getValue(),search:t})}editPointOfInterest(t){this._dialog.open(fe,{data:t}).afterClosed().subscribe(()=>this._change.next(Date.now()))}removePointOfInterest(t){var o=this;return(0,v.Z)(function*(){const n=yield(0,d._5)({title:"Remove Point of Interest",content:`Are you sure you want to remove the point of interest "${t.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},o._dialog);if("done"!==n.reason)return n.close();n.loading("Removing point of interest...");const i=(yield(0,M.rlq)(o._org.building.id,"map_features",{}).toPromise()).details||{};i[t.level_id]&&(i[t.level_id]=i[t.level_id].filter(c=>c.id!==t.id)),yield(0,M.Ymr)(o._org.building.id,{name:"map_features",details:i,description:""}).toPromise().catch(c=>{throw(0,d.cB)(c),n.close(),c}),(0,d.t5)("Successfully removed point of interest."),n.close(),o._change.next(Date.now())})()}static#e=this.\u0275fac=function(o){return new(o||a)(e.LFG(T.w7),e.LFG(f.uw))};static#t=this.\u0275prov=e.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})();var he=s(33005),ve=s(19842),$=s(89680),Z=s(78128),Me=s(60702),xe=s(27442),Te=s(33884),Pe=s(81886),Ce=s(16318),Ie=s(6612);function Oe(a,r){if(1&a&&(e._uU(0),e.ALo(1,"level")),2&a){let o;e.hij(" ",(null==(o=e.lcZ(1,1,r.row.level_id))?null:o.display_name)||"Unknown"," ")}}function Ae(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",16)(1,"div",17)(2,"a",18),e.ALo(3,"safe"),e._UZ(4,"img",19),e.qZA(),e.TgZ(5,"div",20),e._uU(6),e.qZA()(),e.TgZ(7,"button",21),e.NdJ("click",function(){e.CHM(t);const n=e.oxw(2);return e.KtG(n.print())}),e._uU(8," Print QR Code "),e.qZA()()}if(2&a){const t=e.oxw().row;e.xp6(2),e.Q6J("href",e.xi3(3,3,t.qr_link,"url"),e.LSH),e.xp6(2),e.Q6J("src",t.qr_code,e.LSH),e.xp6(2),e.hij(" ",t.name||t.id," ")}}function be(a,r){if(1&a){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"button",6),e.NdJ("click",function(){const l=e.CHM(t).row,i=e.oxw();return e.KtG(i.loadQrCode(l))}),e.TgZ(3,"app-icon"),e._uU(4,"qr_code"),e.qZA()()(),e.TgZ(5,"div",7)(6,"button",8),e.NdJ("click",function(){const l=e.CHM(t).row,i=e.oxw();return e.KtG(i.loadPublicQrCode(l))}),e.TgZ(7,"app-icon"),e._uU(8,"qr_code"),e.qZA()()(),e.YNc(9,Ae,9,6,"ng-template",null,9,e.W1O),e.TgZ(11,"button",10)(12,"app-icon"),e._uU(13,"more_vert"),e.qZA()(),e.TgZ(14,"mat-menu",null,11)(16,"button",12),e.NdJ("click",function(){const l=e.CHM(t).row,i=e.oxw();return e.KtG(i.edit(l))}),e.TgZ(17,"div",13)(18,"app-icon"),e._uU(19,"edit"),e.qZA(),e.TgZ(20,"span"),e._uU(21,"Edit Point of Interest"),e.qZA()()(),e.TgZ(22,"button",12),e.NdJ("click",function(){const l=e.CHM(t).row,i=e.oxw();return e.KtG(i.remove(l))}),e.TgZ(23,"div",14)(24,"app-icon",15),e._uU(25,"delete"),e.qZA(),e.TgZ(26,"span"),e._uU(27,"Delete Point of Interest"),e.qZA()()()()()}if(2&a){const t=r.row,o=e.MAs(10),n=e.MAs(15);e.xp6(2),e.Q6J("content",o),e.xp6(4),e.Q6J("disabled",!t.short_link_id)("content",o),e.xp6(5),e.Q6J("matMenuTriggerFor",n)}}const Ze=()=>["name","level","location","actions"],Se=()=>["Name","Level","Location"," "],Ne=()=>["flex","10r","10r","9r"],Fe=(a,r)=>({level:a,actions:r});let ye=(()=>{class a{get kiosk_url(){const t=this._settings.get("app.kiosk_url_path")||"/map-kiosk";return`${window.location.origin}${t}`}constructor(t,o){this._manager=t,this._settings=o,this.features=this._manager.filtered_features,this.edit=n=>this._manager.editPointOfInterest(n),this.remove=n=>this._manager.removePointOfInterest(n)}loadQrCode(t){const o="string"==typeof t.location?t.location:t.location.join(","),n=`${this.kiosk_url}/#/explore?level=${encodeURIComponent(t.level_id)}&locate=${encodeURIComponent(o)}`;t.qr_link=n,t.qr_code=(0,$.w)(n)}loadPublicQrCode(t){const o=`${location.origin}/r/${t.short_link_id.split("-")[1]}`;t.qr_link=o,t.qr_code=(0,$.w)(o)}print(){window.print()}static#e=this.\u0275fac=function(o){return new(o||a)(e.Y36(R),e.Y36(d.gb))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["poi-list"]],decls:6,vars:11,consts:[[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No Points of Interest found.",1,"block","min-w-[32rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["level_template",""],["action_template",""],[1,"w-full","flex","justify-end","space-x-2"],["matTooltip","Private QR Code"],["icon","","matRipple","","customTooltip","",3,"content","click"],["matTooltip","Public QR Code"],["icon","","matRipple","","customTooltip","",3,"disabled","content","click"],["qr_menu",""],["btn","","icon","","matRipple","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","space-x-2","text-red-500"],[1,"text-error"],[1,"bg-base-100","py-2","shadow","rounded"],["printable","",1,""],["target","_blank","ref","noopener noreferrer",1,"block","p-2","mx-4","my-2","rounded-lg","border","border-base-200","bg-base-100",3,"href"],[1,"w-48",3,"src"],[1,"w-[calc(100%-2rem)]","text-center","mt-2","font-mono","text-sm","bg-base-200","rounded","p-2","mx-4"],["btn","","matRipple","",1,"w-[calc(100%-2rem)]","mx-4","my-2",3,"click"]],template:function(o,n){if(1&o&&(e.TgZ(0,"div",0),e._UZ(1,"custom-table",1),e.qZA(),e.YNc(2,Oe,2,3,"ng-template",null,2,e.W1O)(4,be,28,4,"ng-template",null,3,e.W1O)),2&o){const l=e.MAs(3),i=e.MAs(5);e.xp6(),e.Q6J("dataSource",n.features)("columns",e.DdM(5,Ze))("display_column",e.DdM(6,Se))("column_size",e.DdM(7,Ne))("template",e.WLB(8,Fe,l,i))}},dependencies:[Z.VK,Z.OP,Z.p6,Me.gM,h.wG,b.o,xe.C,Te.X,Pe.o,Ce.y,Ie.M]})}return a})();const Ee=["app-poi-manager",""];let G=(()=>{class a{constructor(t){this._state=t,this.new=()=>this._state.editPointOfInterest()}static#e=this.\u0275fac=function(o){return new(o||a)(e.Y36(R))};static#t=this.\u0275cmp=e.Xpm({type:a,selectors:[["","app-poi-manager",""]],attrs:Ee,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","px-4","py-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(o,n){1&o&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1)(4,"header",2)(5,"h2",3),e._uU(6," Point of Interest Management "),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return n.new()}),e._uU(8," Add Point of Interest "),e.qZA()(),e._UZ(9,"poi-list",5),e.qZA()())},dependencies:[he.O,ve.u,h.wG,ye],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=poi-manager.component.ts-angular-inline--186.css.map*/"]})}return a})();var we=s(21757);const Le=[{path:"",component:G},{path:"new",component:G}];let Re=(()=>{class a{static#e=this.\u0275fac=function(o){return new(o||a)};static#t=this.\u0275mod=e.oAB({type:a});static#o=this.\u0275inj=e.cJS({imports:[m.ez,p.u5,U.v,k.YR,Q.PP,we.Hi,J.Bz.forChild(Le)]})}return a})()}}]);
//# sourceMappingURL=apps_concierge_src_app_poi-manager_poi-manager_module_ts.js.map