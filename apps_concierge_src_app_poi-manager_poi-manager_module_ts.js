"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_poi-manager_poi-manager_module_ts"],{72933:(j,I,s)=>{s.r(I),s.d(I,{POIManagerModule:()=>De});var g=s(26575),p=s(28849),L=s(92649),A=s(97910),Z=s(46514),S=s(59524),M=s(71670),f=s(93121),u=s(70462),T=s(28159),d=s(36520),F=s(47422),R=s(680),x=s(17401),m=s(34592),C=s(47298),y=s(46939),$=s(9681),Y=s(95933),q=s(15746),X=s(11862),e=s(29039);let G=(()=>{class i{constructor(t){this._data=t}get hover(){return!!this._data?.hover}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(X.ui))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["map-show-element"]],decls:2,vars:8,consts:[[1,"relative","w-full","h-full","border-2"],[1,"opacity-30","absolute","inset-0"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"div",1),e.qZA()),2&n&&(e.ekj("border-secondary",o.hover)("border-primary",!o.hover),e.xp6(),e.ekj("bg-secondary",o.hover)("bg-primary",!o.hover))}})}return i})();var O=s(71268),J=s(99674),N=s(96355),h=s(10257),E=s(94888),H=s(51674);function K(i,r){if(1&i&&(e.TgZ(0,"mat-option",20),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t.display_name||t.name," ")}}function z(i,r){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"async"),e.ALo(3,"async"),e.qZA()),2&i){const t=e.oxw();let n;e.xp6(),e.AsE(" ",100*t.page+1," - ",(null==(n=e.lcZ(2,2,t.search_results))?null:n.length)>100*t.page+100?100*t.page+100:null==(n=e.lcZ(3,4,t.search_results))?null:n.length," ")}}function B(i,r){if(1&i&&(e.TgZ(0,"div",26),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(),e.hij(" ",t.location," ")}}function W(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){const l=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.selected.next(l.id))})("mouseover",function(){const l=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.hovered.next(l.id))}),e.TgZ(1,"div",23)(2,"div",24),e._uU(3),e.qZA(),e.YNc(4,B,2,1,"div",25),e.qZA()()}if(2&i){const t=r.$implicit,n=e.oxw(2);e.ekj("!bg-primary",t.id===n.selected.value)("!text-primary-content",t.id===n.selected.value),e.xp6(3),e.Oqu(t.name||t.id),e.xp6(),e.Q6J("ngIf",t.location)}}function V(i,r){if(1&i&&(e.ynx(0),e.YNc(1,W,5,6,"button",21),e.ALo(2,"slice"),e.ALo(3,"async"),e.BQk()),2&i){const t=e.oxw();e.xp6(),e.Q6J("ngForOf",e.Dn7(2,1,e.lcZ(3,5,t.search_results),100*t.page,100*t.page+100))}}function ee(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",27)(1,"button",28),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.page=o.page-1)}),e.TgZ(2,"app-icon"),e._uU(3,"chevron_left"),e.qZA()(),e.TgZ(4,"button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.page=0)}),e._uU(5," 1 "),e.qZA(),e.TgZ(6,"button",30)(7,"app-icon"),e._uU(8,"more_horiz"),e.qZA()(),e.TgZ(9,"button",31),e._uU(10),e.qZA(),e.TgZ(11,"button",30)(12,"app-icon"),e._uU(13,"more_horiz"),e.qZA()(),e.TgZ(14,"button",32),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.page=o.last_page)}),e._uU(15),e.ALo(16,"number"),e.ALo(17,"async"),e.qZA(),e.TgZ(18,"button",28),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.page=o.page+1)}),e.TgZ(19,"app-icon"),e._uU(20,"chevron_right"),e.qZA()()()}if(2&i){const t=e.oxw();let n;e.xp6(),e.Q6J("disabled",0===t.page),e.xp6(3),e.ekj("!bg-secondary",0===t.page)("text-secondary-content",0===t.page)("!rounded-full",0===t.page),e.xp6(2),e.ekj("opacity-0",t.page<1),e.xp6(3),e.ekj("opacity-0",t.page<1||t.page>t.last_page-2),e.xp6(),e.hij(" ",t.page+1," "),e.xp6(),e.ekj("opacity-0",t.page>t.last_page-1),e.xp6(3),e.ekj("!bg-secondary",t.page===t.last_page)("text-secondary-content",t.page===t.last_page)("!rounded-full",t.page===t.last_page),e.xp6(),e.hij(" ",e.xi3(16,22,(null==(n=e.lcZ(17,25,t.search_results))?null:n.length)/100,"1.0-0")," "),e.xp6(3),e.Q6J("disabled",t.page===t.last_page)}}function te(i,r){1&i&&(e.TgZ(0,"div",33),e._UZ(1,"img",34),e.TgZ(2,"div",35),e._uU(3," No results found "),e.qZA()())}const ne=()=>({controls:!0});let oe=(()=>{class i extends m.cx{poiItemFromMapsIndoorsItem(t){return{id:t.properties.externalId||t.properties.roomId||t.id,name:t.properties.name,location:t.properties.building?`${t.properties.building}, Level ${t.properties.floorName}`:"",area:Math.abs(t.geometry.bbox[0]-t.geometry.bbox[2])*Math.abs(t.geometry.bbox[1]-t.geometry.bbox[3])}}constructor(t,n){super(),this._org=t,this._maps_people=n,this.level=new f.Yo,this.map_info={},this.page=0,this.last_page=0,this.selected=new u.X(""),this.hovered=new u.X(""),this.search=new u.X(""),this.changed=new u.X(0),this.level_list=this._org.active_levels,this.actions=[{id:"*",action:"click",callback:(o,l)=>this.selectID(l||o)}],this.features=(0,T.aj)([this.selected,this.hovered]).pipe((0,F.U)(([o,l])=>[{location:o,content:G,full_size:!0,no_scale:!0},{location:l,content:G,data:{hover:!0},full_size:!0,no_scale:!0}].filter(a=>a.location))),this.search_results=(0,T.aj)([this.search,this._maps_people.available$,this.changed]).pipe((0,Y.b)(300),(0,d.w)(([o,l])=>(console.log("Search:",o,l),l?o.length>2?mapsindoors?.services.LocationsService.getLocations({q:o}).then(a=>{const c=a.map(_=>this.poiItemFromMapsIndoorsItem(_));return this.selected_item&&c.unshift(this.poiItemFromMapsIndoorsItem(this.selected_item)),c}):(0,$.of)(this.selected_item?[this.poiItemFromMapsIndoorsItem(this.selected_item)]:[]):(0,$.of)(Object.entries(this.map_info).map(([a,c])=>({id:a,area:c.w*c.h})).filter(({id:a,area:c})=>a.toLowerCase().includes(o.toLowerCase())&&c<.5).sort((a,c)=>c.area-a.area)))),(0,q.b)(o=>{this.page=0,this.last_page=Math.floor(o.length/100)}),(0,R.d)(1)),this.setMapInfo=o=>this.map_info=o}ngOnInit(){var t=this;return(0,M.Z)(function*(){const n=yield t.level_list.pipe((0,y.q)(1)).toPromise();n.length&&(t.level=n[0])})()}onChange(){this.changed.next(Date.now())}selectID(t){var n=this;this.timeout("select_id",(0,M.Z)(function*(){if(yield n._maps_people.available$.pipe((0,y.q)(1)).toPromise()){console.log("Item:",t);const l=t.properties?.externalId||t.properties?.roomId||t.id;console.log("Selected ID:",l),n.selected_item=t,l&&n.selected.next(l),n.changed.next(Date.now())}else{const l=t,a=[];for(const[c,_]of Object.entries(n.map_info))_.x<=l.x&&l.x<=_.x+_.w&&_.y<=l.y&&l.y<=_.y+_.h&&a.push([c,_.h*_.w]);a.sort((c,_)=>c[1]-_[1]),a.filter(([c,_])=>_<=.5),a.length&&(console.log("Selected ID:",a[0][0]),n.selected.next(a[0][0]))}}))}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(f.w7),e.Y36(m.sF))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["select-poi-map-modal"]],features:[e.qOj],decls:34,vars:26,consts:()=>{let t;return t=$localize`:@@searchPlaceholder␟7e892ba15f2c6c17e83510e273b3e10fc32ea016␟4580988005648117665:Search`,[["icon","","matRipple","","mat-dialog-close",""],[1,"flex","min-w-[80vw]","max-w-[calc(100vw-2rem)]","sm:max-w-[64rem]","max-h-[75vh]","h-[75vh]","overflow-hidden"],["map","",1,"relative","h-full","flex-1","w-1/2","bg-base-200"],[3,"src","actions","features","options","focus","mapInfo"],["poi-list","",1,"relative","flex","flex-col","h-full","w-[20rem]","border-l","border-base-300","shadow"],["search","",1,"flex","flex-col","border-b","border-base-200","p-2"],["appearance","outline",1,"w-full","no-subscript","mb-2"],["name","level",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-full","no-subscript"],["matInput","","name","search","placeholder",t,3,"ngModel","ngModelChange"],["matPrefix","",1,"text-2xl"],["list","",1,"flex","flex-col","flex-1","h-1/2","overflow-auto"],[1,"sticky","top-0","w-full","bg-base-100","p-3","z-10"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["pagination","","class","sticky flex items-center justify-center bottom-0 w-full bg-base-100 p-2 z-10 space-x-1",4,"ngIf"],["empty_state",""],["actions","",1,"p-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-full",3,"disabled","mat-dialog-close"],[3,"value"],["matRipple","","class","flex items-center text-left w-[calc(100%-1rem)] mx-2 my-1 p-2 rounded odd:border odd:border-base-200 even:bg-base-200 hover:bg-base-300 h-16 min-h-16",3,"!bg-primary","!text-primary-content","click","mouseover",4,"ngFor","ngForOf"],["matRipple","",1,"flex","items-center","text-left","w-[calc(100%-1rem)]","mx-2","my-1","p-2","rounded","odd:border","odd:border-base-200","even:bg-base-200","hover:bg-base-300","h-16","min-h-16",3,"click","mouseover"],[1,"flex","flex-col"],[1,""],["class","text-xs opacity-30",4,"ngIf"],[1,"text-xs","opacity-30"],["pagination","",1,"sticky","flex","items-center","justify-center","bottom-0","w-full","bg-base-100","p-2","z-10","space-x-1"],["icon","","matRipple","",1,"border","border-base-200","rounded",3,"disabled","click"],["icon","","matRipple","",3,"click"],["icon",""],["icon","","matRipple","",1,"!bg-secondary","text-secondary-content"],["icon","","matRipple","",1,"border","border-base-200","rounded",3,"click"],[1,"flex","flex-col","items-center","justify-center","h-full","flex-1","space-y-4"],["src","assets/icons/no-results.svg",1,"w-36"],[1,"text-center","opacity-30"]]},template:function(n,o){if(1&n&&(e.TgZ(0,"header")(1,"h2"),e._uU(2,"Select Point of Interest from Map"),e.qZA(),e.TgZ(3,"button",0)(4,"app-icon"),e._uU(5,"close"),e.qZA()()(),e.TgZ(6,"main",1)(7,"div",2)(8,"interactive-map",3),e.NdJ("mapInfo",function(a){return o.setMapInfo(a)}),e.ALo(9,"async"),e.qZA()(),e.TgZ(10,"div",4)(11,"div",5)(12,"mat-form-field",6)(13,"mat-select",7),e.NdJ("ngModelChange",function(a){return o.level=a})("ngModelChange",function(){return o.onChange()}),e.YNc(14,K,2,2,"mat-option",8),e.ALo(15,"async"),e.qZA()(),e.TgZ(16,"mat-form-field",9)(17,"input",10),e.NdJ("ngModelChange",function(a){return o.search.next(a)}),e.ALo(18,"async"),e.qZA(),e.TgZ(19,"app-icon",11),e._uU(20,"search"),e.qZA()()(),e.TgZ(21,"div",12)(22,"div",13),e._uU(23),e.ALo(24,"async"),e.YNc(25,z,4,6,"span",14),e.qZA(),e.YNc(26,V,4,7,"ng-container",15),e.ALo(27,"async"),e.YNc(28,ee,21,27,"div",16)(29,te,4,0,"ng-template",null,17,e.W1O),e.qZA(),e.TgZ(31,"div",18)(32,"button",19),e._uU(33," Save "),e.qZA()()()()),2&n){const l=e.MAs(30);let a,c;e.xp6(8),e.Q6J("src",null==o.level?null:o.level.map_id)("actions",o.actions)("features",e.lcZ(9,15,o.features))("options",e.DdM(25,ne))("focus",o.selected.value),e.xp6(5),e.Q6J("ngModel",o.level),e.xp6(),e.Q6J("ngForOf",e.lcZ(15,17,o.level_list)),e.xp6(3),e.Q6J("ngModel",e.lcZ(18,19,o.search)),e.xp6(6),e.hij(" Results (",(null==(a=e.lcZ(24,21,o.search_results))?null:a.length)||0,") "),e.xp6(2),e.Q6J("ngIf",o.last_page),e.xp6(),e.Q6J("ngIf",null==(c=e.lcZ(27,23,o.search_results))?null:c.length)("ngIfElse",l),e.xp6(2),e.Q6J("ngIf",o.last_page>0),e.xp6(4),e.Q6J("disabled",!o.selected.value)("mat-dialog-close",o.selected.value)}},dependencies:[g.sg,g.O5,p.Fj,p.JJ,p.On,O.KE,O.qo,J.Nt,N.gD,h.ey,x.ZT,h.wG,E.o,H.p,g.Ov,g.OU,g.JJ]})}return i})();var ie=s(33910);function le(i,r){1&i&&(e.TgZ(0,"button",4)(1,"app-icon"),e._uU(2,"close"),e.qZA()())}function ae(i,r){1&i&&(e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,18),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12),e._UZ(5,"input",19),e.qZA()())}function se(i,r){if(1&i&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t.display_name," ")}}const b=()=>({standalone:!0});function ce(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,20),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12)(5,"mat-select",21),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw(3);return e.KtG(l.building=o)}),e.YNc(6,se,2,2,"mat-option",22),e.ALo(7,"async"),e.qZA()()()}if(2&i){const t=e.oxw(3);e.xp6(5),e.Q6J("ngModel",t.building)("ngModelOptions",e.DdM(5,b)),e.xp6(),e.Q6J("ngForOf",e.lcZ(7,3,t.building_list))}}function re(i,r){if(1&i&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t.id),e.xp6(),e.hij(" ",t.display_name," ")}}function _e(i,r){if(1&i&&(e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,24),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12)(5,"mat-select",25),e.YNc(6,re,2,2,"mat-option",22),e.ALo(7,"async"),e.qZA()()()),2&i){const t=e.oxw(3);e.xp6(6),e.Q6J("ngForOf",e.lcZ(7,1,t.level_list))}}function pe(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",26)(1,"mat-form-field",27),e._UZ(2,"input",28),e.qZA(),e.TgZ(3,"button",29),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(3);return e.KtG(o.selectPOIfromMap())}),e.TgZ(4,"app-icon"),e._uU(5,"place"),e.qZA()()()}}function de(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",30)(1,"mat-form-field",31)(2,"input",32),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw(3);return e.KtG(l.form.patchValue({location:[o,l.form.value.location[1]]}))}),e.qZA()(),e.TgZ(3,"mat-form-field",31)(4,"input",33),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw(3);return e.KtG(l.form.patchValue({location:[l.form.value.location[0],o]}))}),e.qZA()()()}if(2&i){const t=e.oxw(3);e.xp6(2),e.Q6J("ngModel",t.form.value.location[0])("ngModelOptions",e.DdM(4,b)),e.xp6(2),e.Q6J("ngModel",t.form.value.location[1])("ngModelOptions",e.DdM(5,b))}}function me(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"form",7),e.YNc(1,ae,6,0,"div",8)(2,ce,8,6,"div",8),e.ALo(3,"async"),e.YNc(4,_e,8,3,"div",8),e.TgZ(5,"div",9)(6,"label",10),e.tHW(7,11),e._UZ(8,"span"),e.N_p(),e.qZA(),e.TgZ(9,"mat-form-field",12)(10,"mat-select",13),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw(2);return e.KtG(l.location_type=o)}),e.TgZ(11,"mat-option",14),e._uU(12,"Map ID"),e.qZA(),e.TgZ(13,"mat-option",15),e._uU(14,"Coordinates"),e.qZA()()(),e.YNc(15,pe,6,0,"div",16)(16,de,5,6,"div",17),e.qZA()()}if(2&i){const t=e.oxw(2);let n;e.Q6J("formGroup",t.form),e.xp6(),e.Q6J("ngIf",t.form.controls.name),e.xp6(),e.Q6J("ngIf",(null==(n=e.lcZ(3,8,t.building_list))?null:n.length)>1),e.xp6(2),e.Q6J("ngIf",t.form.controls.level_id),e.xp6(6),e.Q6J("ngModel",t.location_type)("ngModelOptions",e.DdM(10,b)),e.xp6(5),e.Q6J("ngIf","map_id"===t.location_type),e.xp6(),e.Q6J("ngIf","coordinates"===t.location_type)}}function ge(i,r){if(1&i&&(e.TgZ(0,"main",5),e.YNc(1,me,17,11,"form",6),e.qZA()),2&i){const t=e.oxw();e.xp6(),e.Q6J("ngIf",t.form)}}function ue(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"footer",34)(1,"button",35),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.save())}),e._uU(2,"Save"),e.qZA()()}}function fe(i,r){1&i&&(e.TgZ(0,"div",36),e._UZ(1,"mat-spinner",37),e.TgZ(2,"p",38),e._uU(3,"Saving Point Of Interest..."),e.qZA()())}let he=(()=>{class i extends m.cx{get building(){return this._org.building}set building(t){this._org.building=t}constructor(t,n,o,l,a){super(),this._org=t,this._data=n,this._dialog_ref=o,this._settings=l,this._dialog=a,this.loading=!1,this.location_type=this._data?.location instanceof Array?"coordinates":"map_id",this.building_list=this._org.building_list,this.level_list=this._org.active_levels,this.form=new p.cw({id:new p.NI(this._data?.id||""),name:new p.NI(this._data?.name||"",[p.kI.required]),level_id:new p.NI(this._data?.level_id||"",[p.kI.required]),location:new p.NI(this._data?.location||"",[p.kI.required])})}ngOnInit(){var t=this;return(0,M.Z)(function*(){if(!t.form.value.level_id){const n=yield t.level_list.pipe((0,y.q)(1)).toPromise();n.length&&t.form.patchValue({level_id:n[0].id})}})()}selectPOIfromMap(){this._dialog.open(oe,{data:this._data}).afterClosed().subscribe(n=>{n&&this.form.patchValue({location:n})})}save(){var t=this;return(0,M.Z)(function*(){if(!t.form.valid)return(0,m.cB)(`Some form fields are invalid. [${(0,m.RD)(t.form).join(", ")}]`);const n=t.form.getRawValue();n.id||(n.id=`POI-${(0,m.O1)(8)}`),n.short_link_id=t._data?.short_link_id;const o=t._settings.get("app.kiosk_url_path")||"/map-kiosk",l=t._settings.get("app.short_url_public_key"),a="string"==typeof n.location?n.location:n.location.join(",");let c=`${o}/#/explore?level=${n.level_id}&locate=${a}&public=true`;if(l&&(c+=`&x-api-key=${l}`),n.short_link_id)yield(0,m.rN)(n.short_link_id,{id:n.short_link_id,name:n.name,description:`Point of Interest: ${n.name}`,uri:`${window.location.origin}/auth/login?continue=${encodeURIComponent(c)}`}).toPromise();else{const{id:v}=yield(0,m.Ke)({name:n.name,description:`Point of Interest: ${n.name}`,uri:`${window.location.origin}/auth/login?continue=${encodeURIComponent(c)}`}).toPromise();n.short_link_id=v}t.loading=!0;const P=(yield(0,C.rlq)(t._org.building.id,"map_features",{}).toPromise()).details||{};P[n.level_id]||(P[n.level_id]=[]),P[n.level_id]=[...P[n.level_id].filter(v=>v.id!==n.id),n].sort((v,Ue)=>v.name.localeCompare(Ue.name));const k=yield(0,C.Ymr)(t._org.building.id,{name:"map_features",details:P,description:""}).toPromise().catch(v=>(0,m.cB)(v));k.id&&t._dialog_ref.close(k),t.loading=!1})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(f.w7),e.Y36(x.WI),e.Y36(x.so),e.Y36(m.gb),e.Y36(x.uw))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["poi-modal"]],features:[e.qOj],decls:8,vars:5,consts:()=>{let t,n,o,l,a,c;return t=$localize`:@@nameLabel␟5db92d8696af8c0f3aa9ce5bf1e1305c8c5aa456␟8054963382343596237: Location${"\ufffd#8\ufffd"}:START_TAG_SPAN:*${"\ufffd/#8\ufffd"}:CLOSE_TAG_SPAN:: `,n=$localize`:@@nameLabel␟5813c0ce49afffe90191cb912c58fa68674457d8␟1912970594501107766: Name${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,o=$localize`:@@namePlaceholder␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,l=$localize`:@@nameLabel␟5e09041a10f5eb39aadfaa1a8dd77f4dc8d77314␟711878476466678637: Building${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,a=$localize`:@@nameLabel␟805d5ab24c829f98df246a63541ee827ce04a4c4␟6308222021008136210: Level${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,c=$localize`:@@locationPlaceholder␟ed31c09fd77c36238c13d83635f3fe5294c733d2␟471816275243265264:Location`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[28rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[28rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","name"],t,["appearance","outline"],["placeholder","Location Type",3,"ngModel","ngModelOptions","ngModelChange"],["value","map_id"],["value","coordinates"],["class","flex items-center space-x-2 pb-2",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],n,["matInput","","name","name","placeholder",o,"formControlName","name"],l,["placeholder","Select Building",3,"ngModel","ngModelOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],a,["formControlName","level_id","placeholder","Select Level"],[1,"flex","items-center","space-x-2","pb-2"],["appearance","outline",1,"no-subscript"],["matInput","","name","location","placeholder",c,"formControlName","location"],["icon","","matRipple","",1,"rounded","border","border-base-300","h-12","w-12",3,"click"],[1,"flex","items-center","space-x-2"],["appearance","outline",1,"flex-1"],["matInput","","name","latitude",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","name","longitude",3,"ngModel","ngModelOptions","ngModelChange"],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(n,o){if(1&n&&(e.TgZ(0,"header")(1,"h2"),e._uU(2),e.qZA(),e.YNc(3,le,3,0,"button",0),e.qZA(),e.YNc(4,ge,2,1,"main",1)(5,ue,3,0,"footer",2)(6,fe,4,0,"ng-template",null,3,e.W1O)),2&n){const l=e.MAs(7);e.xp6(2),e.hij("",o.form.value.id?"Edit":"Add"," Point Of Interest"),e.xp6(),e.Q6J("ngIf",!o.loading),e.xp6(),e.Q6J("ngIf",!o.loading)("ngIfElse",l),e.xp6(),e.Q6J("ngIf",!o.loading)}},dependencies:[g.sg,g.O5,p._Y,p.Fj,p.JJ,p.JL,p.On,O.KE,J.Nt,N.gD,h.ey,ie.Ou,x.ZT,h.wG,p.sg,p.u,E.o,g.Ov]})}return i})(),D=(()=>{class i{constructor(t,n){this._org=t,this._dialog=n,this._options=new u.X({}),this._change=new u.X(0),this.options=this._options.asObservable(),this._features=(0,T.aj)([this._org.active_building,this._change]).pipe((0,d.w)(([o])=>(0,C.rlq)(o.id,"map_features",{})),(0,F.U)(o=>o.details||{}),(0,R.d)(1)),this.filtered_features=(0,T.aj)([this._features,this._options]).pipe((0,F.U)(([o,l])=>{let a=Object.values(o).reduce((c,_)=>[...c,..._],[]);return l.search&&(a=a.filter(c=>c.name.toLowerCase().includes(l.search.toLowerCase()))),a}))}setFilters(t){this._options.next({...this._options.getValue(),...t})}setSearchString(t){this._options.next({...this._options.getValue(),search:t})}editPointOfInterest(t){this._dialog.open(he,{data:t}).afterClosed().subscribe(()=>this._change.next(Date.now()))}removePointOfInterest(t){var n=this;return(0,M.Z)(function*(){const o=yield(0,m._5)({title:"Remove Point of Interest",content:`Are you sure you want to remove the point of interest "${t.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},n._dialog);if("done"!==o.reason)return o.close();o.loading("Removing point of interest...");const a=(yield(0,C.rlq)(n._org.building.id,"map_features",{}).toPromise()).details||{};a[t.level_id]&&(a[t.level_id]=a[t.level_id].filter(c=>c.id!==t.id)),yield(0,C.Ymr)(n._org.building.id,{name:"map_features",details:a,description:""}).toPromise().catch(c=>{throw(0,m.cB)(c),o.close(),c}),(0,m.t5)("Successfully removed point of interest."),o.close(),n._change.next(Date.now())})()}static#e=this.\u0275fac=function(n){return new(n||i)(e.LFG(f.w7),e.LFG(x.uw))};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var ve=s(33005),Me=s(19842),U=s(89680),w=s(78128),xe=s(60702),Te=s(27442),Ce=s(33884),Pe=s(81886),Ie=s(16318),Oe=s(6612);function be(i,r){if(1&i&&(e._uU(0),e.ALo(1,"level")),2&i){let n;e.hij(" ",(null==(n=e.lcZ(1,1,r.row.level_id))?null:n.display_name)||"Unknown"," ")}}function Ae(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",16)(1,"div",17)(2,"a",18),e.ALo(3,"safe"),e._UZ(4,"img",19),e.qZA(),e.TgZ(5,"div",20),e._uU(6),e.qZA()(),e.TgZ(7,"button",21),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.print())}),e._uU(8," Print QR Code "),e.qZA()()}if(2&i){const t=e.oxw().row;e.xp6(2),e.Q6J("href",e.xi3(3,3,t.qr_link,"url"),e.LSH),e.xp6(2),e.Q6J("src",t.qr_code,e.LSH),e.xp6(2),e.hij(" ",t.name||t.id," ")}}function Ze(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",4)(1,"div",5)(2,"button",6),e.NdJ("click",function(){const l=e.CHM(t).row,a=e.oxw();return e.KtG(a.loadQrCode(l))}),e.TgZ(3,"app-icon"),e._uU(4,"qr_code"),e.qZA()()(),e.TgZ(5,"div",7)(6,"button",8),e.NdJ("click",function(){const l=e.CHM(t).row,a=e.oxw();return e.KtG(a.loadPublicQrCode(l))}),e.TgZ(7,"app-icon"),e._uU(8,"qr_code"),e.qZA()()(),e.YNc(9,Ae,9,6,"ng-template",null,9,e.W1O),e.TgZ(11,"button",10)(12,"app-icon"),e._uU(13,"more_vert"),e.qZA()(),e.TgZ(14,"mat-menu",null,11)(16,"button",12),e.NdJ("click",function(){const l=e.CHM(t).row,a=e.oxw();return e.KtG(a.edit(l))}),e.TgZ(17,"div",13)(18,"app-icon"),e._uU(19,"edit"),e.qZA(),e.TgZ(20,"span"),e._uU(21,"Edit Point of Interest"),e.qZA()()(),e.TgZ(22,"button",12),e.NdJ("click",function(){const l=e.CHM(t).row,a=e.oxw();return e.KtG(a.remove(l))}),e.TgZ(23,"div",14)(24,"app-icon",15),e._uU(25,"delete"),e.qZA(),e.TgZ(26,"span"),e._uU(27,"Delete Point of Interest"),e.qZA()()()()()}if(2&i){const t=r.row,n=e.MAs(10),o=e.MAs(15);e.xp6(2),e.Q6J("content",n),e.xp6(4),e.Q6J("disabled",!t.short_link_id)("content",n),e.xp6(5),e.Q6J("matMenuTriggerFor",o)}}const Se=()=>["name","level","location","actions"],Fe=()=>["Name","Level","Location"," "],ye=()=>["flex","10r","10r","9r"],Ne=(i,r)=>({level:i,actions:r});let Ee=(()=>{class i{get kiosk_url(){const t=this._settings.get("app.kiosk_url_path")||"/map-kiosk";return`${window.location.origin}${t}`}constructor(t,n){this._manager=t,this._settings=n,this.features=this._manager.filtered_features,this.edit=o=>this._manager.editPointOfInterest(o),this.remove=o=>this._manager.removePointOfInterest(o)}loadQrCode(t){const n="string"==typeof t.location?t.location:t.location.join(","),o=`${this.kiosk_url}/#/explore?level=${encodeURIComponent(t.level_id)}&locate=${encodeURIComponent(n)}`;t.qr_link=o,t.qr_code=(0,U.w)(o)}loadPublicQrCode(t){const n=`${location.origin}/r/${t.short_link_id.split("-")[1]}`;t.qr_link=n,t.qr_code=(0,U.w)(n)}print(){window.print()}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(D),e.Y36(m.gb))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["poi-list"]],decls:6,vars:11,consts:[[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No Points of Interest found.",1,"block","min-w-[32rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["level_template",""],["action_template",""],[1,"w-full","flex","justify-end","space-x-2"],["matTooltip","Private QR Code"],["icon","","matRipple","","customTooltip","",3,"content","click"],["matTooltip","Public QR Code"],["icon","","matRipple","","customTooltip","",3,"disabled","content","click"],["qr_menu",""],["btn","","icon","","matRipple","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","space-x-2","text-red-500"],[1,"text-error"],[1,"bg-base-100","py-2","shadow","rounded"],["printable","",1,""],["target","_blank","ref","noopener noreferrer",1,"block","p-2","mx-4","my-2","rounded-lg","border","border-base-200","bg-base-100",3,"href"],[1,"w-48",3,"src"],[1,"w-[calc(100%-2rem)]","text-center","mt-2","font-mono","text-sm","bg-base-200","rounded","p-2","mx-4"],["btn","","matRipple","",1,"w-[calc(100%-2rem)]","mx-4","my-2",3,"click"]],template:function(n,o){if(1&n&&(e.TgZ(0,"div",0),e._UZ(1,"custom-table",1),e.qZA(),e.YNc(2,be,2,3,"ng-template",null,2,e.W1O)(4,Ze,28,4,"ng-template",null,3,e.W1O)),2&n){const l=e.MAs(3),a=e.MAs(5);e.xp6(),e.Q6J("dataSource",o.features)("columns",e.DdM(5,Se))("display_column",e.DdM(6,Fe))("column_size",e.DdM(7,ye))("template",e.WLB(8,Ne,l,a))}},dependencies:[w.VK,w.OP,w.p6,xe.gM,h.wG,E.o,Te.C,Ce.X,Pe.o,Ie.y,Oe.M]})}return i})();const we=["app-poi-manager",""];function Le(i,r){if(1&i&&(e.TgZ(0,"mat-option",11),e._uU(1),e.qZA()),2&i){const t=r.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t.display_name||t.name," ")}}const Re=()=>({standalone:!0});function $e(i,r){if(1&i){const t=e.EpF();e.TgZ(0,"div",7)(1,"mat-form-field",8)(2,"mat-select",9),e.NdJ("ngModelChange",function(o){e.CHM(t);const l=e.oxw();return e.KtG(l.building=o)}),e.YNc(3,Le,2,2,"mat-option",10),e.ALo(4,"async"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngModel",t.building)("ngModelOptions",e.DdM(6,Re))("placeholder",(null==t.building?null:t.building.display_name)||(null==t.building?null:t.building.name)),e.xp6(),e.Q6J("ngForOf",e.lcZ(4,4,t.buildings))}}let Q=(()=>{class i{get building(){return this._org.building}set building(t){this._org.building=t}get use_region(){return!!this._settings.get("app.use_region")}constructor(t,n,o){this._org=t,this._state=n,this._settings=o,this.new=()=>this._state.editPointOfInterest(),this.buildings=this._org.active_buildings}static#e=this.\u0275fac=function(n){return new(n||i)(e.Y36(f.w7),e.Y36(D),e.Y36(m.gb))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["","app-poi-manager",""]],attrs:we,decls:13,vars:7,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","px-4","py-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],["class","flex items-center justify-between mb-2 px-4",4,"ngIf"],[1,"block","w-full","relative","flex-1","h-1/2"],[1,"flex","items-center","justify-between","mb-2","px-4"],["appearance","outline",1,"w-64"],["name","building",3,"ngModel","ngModelOptions","placeholder","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,o){if(1&n&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1)(4,"header",2),e.ALo(5,"async"),e.TgZ(6,"h2",3),e._uU(7," Point of Interest Management "),e.qZA(),e.TgZ(8,"button",4),e.NdJ("click",function(){return o.new()}),e._uU(9," Add Point of Interest "),e.qZA()(),e.YNc(10,$e,5,7,"div",5),e.ALo(11,"async"),e._UZ(12,"poi-list",6),e.qZA()()),2&n){let l,a;e.xp6(4),e.ekj("mb-2",!o.use_region||(null==(l=e.lcZ(5,3,o.buildings))?null:l.length)<=1),e.xp6(6),e.Q6J("ngIf",o.use_region&&(null==(a=e.lcZ(11,5,o.buildings))?null:a.length)>1)}},dependencies:[g.sg,g.O5,p.JJ,p.On,ve.O,Me.u,O.KE,N.gD,h.ey,h.wG,Ee,g.Ov],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=poi-manager.component.ts-angular-inline--189.css.map*/"]})}return i})();var Ge=s(21757);const Je=[{path:"",component:Q},{path:"new",component:Q}];let De=(()=>{class i{static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[g.ez,p.u5,A.v,Z.YR,S.PP,Ge.Hi,L.Bz.forChild(Je)]})}return i})()},59524:(j,I,s)=>{s.d(I,{Y:()=>Z,PP:()=>g.P,mO:()=>S.mO,VE:()=>u.VE,w0:()=>u.w0,sF:()=>f.sF});var g=s(43211),A=(s(86755),s(80882),s(67343));class Z{constructor(d={}){this.type=d.type||d.location||"other",this.position=d.position||d.map_id||d.asset_id||{x:d.x/d.map_width||0,y:d.y/d.map_height||0},this.variance=d.variance||0,this.last_seen=d.last_seen||(0,A.Z)(new Date),this.level=d.level,this.building=d.building,this.at_location=!!d.at_location,this.coordinates_from=d.coordinates_from||"top-left"}}var S=s(223),f=(s(11451),s(38125)),u=s(48675)}}]);
//# sourceMappingURL=apps_concierge_src_app_poi-manager_poi-manager_module_ts.js.map