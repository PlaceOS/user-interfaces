"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_poi-manager_poi-manager_module_ts"],{98977:(Me,h,i)=>{i.r(h),i.d(h,{POIManagerModule:()=>Pe});var f=i(26575),c=i(28849),N=i(92649),S=i(97910),Z=i(47049),E=i(10060),P=i(71670),v=i(93121),O=i(70462),C=i(28159),L=i(36520),A=i(47422),b=i(680),g=i(17401),d=i(22798),p=i(47298),R=i(46939),e=i(29039),y=i(71268),G=i(99674),D=i(96355),M=i(10257),$=i(33910),x=i(94888);function w(n,_){1&n&&(e.TgZ(0,"button",4)(1,"app-icon"),e._uU(2,"close"),e.qZA()())}function U(n,_){1&n&&(e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,18),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12),e._UZ(5,"input",19),e.qZA()())}function J(n,_){if(1&n&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&n){const t=_.$implicit;e.Q6J("value",t),e.xp6(),e.hij(" ",t.display_name," ")}}const u=()=>({standalone:!0});function Q(n,_){if(1&n){const t=e.EpF();e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,20),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12)(5,"mat-select",21),e.NdJ("ngModelChange",function(a){e.CHM(t);const l=e.oxw(3);return e.KtG(l.building=a)}),e.YNc(6,J,2,2,"mat-option",22),e.ALo(7,"async"),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(5),e.Q6J("ngModel",t.building)("ngModelOptions",e.DdM(5,u)),e.xp6(),e.Q6J("ngForOf",e.lcZ(7,3,t.building_list))}}function Y(n,_){if(1&n&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&n){const t=_.$implicit;e.Q6J("value",t.id),e.xp6(),e.hij(" ",t.display_name," ")}}function j(n,_){if(1&n&&(e.TgZ(0,"div",9)(1,"label",10),e.tHW(2,24),e._UZ(3,"span"),e.N_p(),e.qZA(),e.TgZ(4,"mat-form-field",12)(5,"mat-select",25),e.YNc(6,Y,2,2,"mat-option",22),e.ALo(7,"async"),e.qZA()()()),2&n){const t=e.oxw(3);e.xp6(6),e.Q6J("ngForOf",e.lcZ(7,1,t.level_list))}}function X(n,_){1&n&&(e.ynx(0),e.TgZ(1,"mat-form-field",12),e._UZ(2,"input",26),e.qZA(),e.BQk())}function H(n,_){if(1&n){const t=e.EpF();e.TgZ(0,"div",27)(1,"mat-form-field",28)(2,"input",29),e.NdJ("ngModelChange",function(a){e.CHM(t);const l=e.oxw(3);return e.KtG(l.form.patchValue({location:[a,l.form.value.location[1]]}))}),e.qZA()(),e.TgZ(3,"mat-form-field",28)(4,"input",30),e.NdJ("ngModelChange",function(a){e.CHM(t);const l=e.oxw(3);return e.KtG(l.form.patchValue({location:[l.form.value.location[0],a]}))}),e.qZA()()()}if(2&n){const t=e.oxw(3);e.xp6(2),e.Q6J("ngModel",t.form.value.location[0])("ngModelOptions",e.DdM(4,u)),e.xp6(2),e.Q6J("ngModel",t.form.value.location[1])("ngModelOptions",e.DdM(5,u))}}function q(n,_){if(1&n){const t=e.EpF();e.TgZ(0,"form",7),e.YNc(1,U,6,0,"div",8)(2,Q,8,6,"div",8),e.ALo(3,"async"),e.YNc(4,j,8,3,"div",8),e.TgZ(5,"div",9)(6,"label",10),e.tHW(7,11),e._UZ(8,"span"),e.N_p(),e.qZA(),e.TgZ(9,"mat-form-field",12)(10,"mat-select",13),e.NdJ("ngModelChange",function(a){e.CHM(t);const l=e.oxw(2);return e.KtG(l.location_type=a)}),e.TgZ(11,"mat-option",14),e._uU(12,"Map ID"),e.qZA(),e.TgZ(13,"mat-option",15),e._uU(14,"Coordinates"),e.qZA()()(),e.YNc(15,X,3,0,"ng-container",16)(16,H,5,6,"div",17),e.qZA()()}if(2&n){const t=e.oxw(2);let o;e.Q6J("formGroup",t.form),e.xp6(),e.Q6J("ngIf",t.form.controls.name),e.xp6(),e.Q6J("ngIf",(null==(o=e.lcZ(3,8,t.building_list))?null:o.length)>1),e.xp6(2),e.Q6J("ngIf",t.form.controls.level_id),e.xp6(6),e.Q6J("ngModel",t.location_type)("ngModelOptions",e.DdM(10,u)),e.xp6(5),e.Q6J("ngIf","map_id"===t.location_type),e.xp6(),e.Q6J("ngIf","coordinates"===t.location_type)}}function z(n,_){if(1&n&&(e.TgZ(0,"main",5),e.YNc(1,q,17,11,"form",6),e.qZA()),2&n){const t=e.oxw();e.xp6(),e.Q6J("ngIf",t.form)}}function B(n,_){if(1&n){const t=e.EpF();e.TgZ(0,"footer",31)(1,"button",32),e.NdJ("click",function(){e.CHM(t);const a=e.oxw();return e.KtG(a.save())}),e._uU(2,"Save"),e.qZA()()}}function K(n,_){1&n&&(e.TgZ(0,"div",33),e._UZ(1,"mat-spinner",34),e.TgZ(2,"p",35),e._uU(3,"Saving Point Of Interest..."),e.qZA()())}let W=(()=>{class n extends d.cx{get building(){return this._org.building}set building(t){this._org.building=t}constructor(t,o,a){super(),this._org=t,this._data=o,this._dialog_ref=a,this.loading=!1,this.location_type=this._data?.location instanceof Array?"coordinates":"map_id",this.building_list=this._org.building_list,this.level_list=this._org.active_levels,this.form=new c.cw({id:new c.NI(this._data?.id||""),name:new c.NI(this._data?.name||"",[c.kI.required]),level_id:new c.NI(this._data?.level_id||"",[c.kI.required]),location:new c.NI(this._data?.location||"",[c.kI.required])})}ngOnInit(){var t=this;return(0,P.Z)(function*(){if(!t.form.value.level_id){const o=yield t.level_list.pipe((0,R.q)(1)).toPromise();o.length&&t.form.patchValue({level_id:o[0].id})}})()}save(){var t=this;return(0,P.Z)(function*(){if(!t.form.valid)return(0,d.cB)(`Some form fields are invalid. [${(0,d.RD)(t.form).join(", ")}]`);const o=t.form.getRawValue();o.id||(o.id=`POI-${(0,d.O1)(8)}`),t.loading=!0;const l=(yield(0,p.rlq)(t._org.building.id,"map_features",{}).toPromise()).details||{};l[o.level_id]||(l[o.level_id]=[]),l[o.level_id]=[...l[o.level_id].filter(r=>r.id!==o.id),o].sort((r,m)=>r.name.localeCompare(m.name));const s=yield(0,p.Ymr)(t._org.building.id,{name:"map_features",details:l,description:""}).toPromise().catch(r=>(0,d.cB)(r));s.id&&t._dialog_ref.close(s),t.loading=!1})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(v.w7),e.Y36(g.WI),e.Y36(g.so))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["poi-modal"]],features:[e.qOj],decls:8,vars:5,consts:()=>{let t,o,a,l,s,r;return t=$localize`:@@nameLabel␟5db92d8696af8c0f3aa9ce5bf1e1305c8c5aa456␟8054963382343596237: Location${"\ufffd#8\ufffd"}:START_TAG_SPAN:*${"\ufffd/#8\ufffd"}:CLOSE_TAG_SPAN:: `,o=$localize`:@@nameLabel␟5813c0ce49afffe90191cb912c58fa68674457d8␟1912970594501107766: Name${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,a=$localize`:@@namePlaceholder␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,l=$localize`:@@nameLabel␟5e09041a10f5eb39aadfaa1a8dd77f4dc8d77314␟711878476466678637: Building${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,s=$localize`:@@nameLabel␟805d5ab24c829f98df246a63541ee827ce04a4c4␟6308222021008136210: Level${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,r=$localize`:@@locationPlaceholder␟ed31c09fd77c36238c13d83635f3fe5294c733d2␟471816275243265264:Location`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[28rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[28rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","name"],t,["appearance","outline"],["placeholder","Location Type",3,"ngModel","ngModelOptions","ngModelChange"],["value","map_id"],["value","coordinates"],[4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],o,["matInput","","name","name","placeholder",a,"formControlName","name"],l,["placeholder","Select Building",3,"ngModel","ngModelOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],s,["formControlName","level_id","placeholder","Select Level"],["matInput","","name","location","placeholder",r,"formControlName","location"],[1,"flex","items-center","space-x-2"],["appearance","outline",1,"flex-1"],["matInput","","name","latitude",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","name","longitude",3,"ngModel","ngModelOptions","ngModelChange"],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(o,a){if(1&o&&(e.TgZ(0,"header")(1,"h2"),e._uU(2),e.qZA(),e.YNc(3,w,3,0,"button",0),e.qZA(),e.YNc(4,z,2,1,"main",1)(5,B,3,0,"footer",2)(6,K,4,0,"ng-template",null,3,e.W1O)),2&o){const l=e.MAs(7);e.xp6(2),e.hij("",a.form.value.id?"Edit":"Add"," Point Of Interest"),e.xp6(),e.Q6J("ngIf",!a.loading),e.xp6(),e.Q6J("ngIf",!a.loading)("ngIfElse",l),e.xp6(),e.Q6J("ngIf",!a.loading)}},dependencies:[f.sg,f.O5,c._Y,c.Fj,c.JJ,c.JL,c.On,y.KE,G.Nt,D.gD,M.ey,$.Ou,g.ZT,c.sg,c.u,x.o,f.Ov]})}return n})(),I=(()=>{class n{constructor(t,o){this._org=t,this._dialog=o,this._options=new O.X({}),this._change=new O.X(0),this.options=this._options.asObservable(),this._features=(0,C.aj)([this._org.active_building,this._change]).pipe((0,L.w)(([a])=>(0,p.rlq)(a.id,"map_features",{})),(0,A.U)(a=>a.details||{}),(0,b.d)(1)),this.filtered_features=(0,C.aj)([this._features,this._options]).pipe((0,A.U)(([a,l])=>{let s=Object.values(a).reduce((r,m)=>[...r,...m],[]);return l.search&&(s=s.filter(r=>r.name.toLowerCase().includes(l.search.toLowerCase()))),s}))}setFilters(t){this._options.next({...this._options.getValue(),...t})}setSearchString(t){this._options.next({...this._options.getValue(),search:t})}editPointOfInterest(t){this._dialog.open(W,{data:t}).afterClosed().subscribe(()=>this._change.next(Date.now()))}removePointOfInterest(t){var o=this;return(0,P.Z)(function*(){const a=yield(0,d._5)({title:"Remove Point of Interest",content:`Are you sure you want to remove the point of interest "${t.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},o._dialog);if("done"!==a.reason)return a.close();a.loading("Removing point of interest...");const s=(yield(0,p.rlq)(o._org.building.id,"map_features",{}).toPromise()).details||{};s[t.level_id]&&(s[t.level_id]=s[t.level_id].filter(r=>r.id!==t.id)),yield(0,p.Ymr)(o._org.building.id,{name:"map_features",details:s,description:""}).toPromise().catch(r=>{throw(0,d.cB)(r),a.close(),r}),(0,d.t5)("Successfully removed point of interest."),a.close(),o._change.next(Date.now())})()}static#e=this.\u0275fac=function(o){return new(o||n)(e.LFG(v.w7),e.LFG(g.uw))};static#t=this.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var k=i(33005),V=i(19842),ee=i(89680),T=i(78128),te=i(27442),ne=i(33884),oe=i(81886),ae=i(16318),ie=i(6612);function le(n,_){if(1&n&&(e._uU(0),e.ALo(1,"level")),2&n){let o;e.hij(" ",(null==(o=e.lcZ(1,1,_.row.level_id))?null:o.display_name)||"Unknown"," ")}}function se(n,_){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"div",14)(2,"a",15),e.ALo(3,"safe"),e._UZ(4,"img",16),e.qZA(),e.TgZ(5,"div",17),e._uU(6),e.qZA()(),e.TgZ(7,"button",18),e.NdJ("click",function(){e.CHM(t);const a=e.oxw(2);return e.KtG(a.print())}),e._uU(8," Print QR Code "),e.qZA()()}if(2&n){const t=e.oxw().row;e.xp6(2),e.Q6J("href",e.xi3(3,3,t.qr_link,"url"),e.LSH),e.xp6(2),e.Q6J("src",t.qr_code,e.LSH),e.xp6(2),e.hij(" ",t.name||t.id," ")}}function _e(n,_){if(1&n){const t=e.EpF();e.TgZ(0,"div",4)(1,"button",5),e.NdJ("click",function(){const l=e.CHM(t).row,s=e.oxw();return e.KtG(s.loadQrCode(l))}),e.TgZ(2,"app-icon"),e._uU(3,"qr_code"),e.qZA()(),e.YNc(4,se,9,6,"ng-template",null,6,e.W1O),e.TgZ(6,"button",7)(7,"app-icon"),e._uU(8,"more_vert"),e.qZA()(),e.TgZ(9,"mat-menu",null,8)(11,"button",9),e.NdJ("click",function(){const l=e.CHM(t).row,s=e.oxw();return e.KtG(s.edit(l))}),e.TgZ(12,"div",10)(13,"app-icon"),e._uU(14,"edit"),e.qZA(),e.TgZ(15,"span"),e._uU(16,"Edit Point of Interest"),e.qZA()()(),e.TgZ(17,"button",9),e.NdJ("click",function(){const l=e.CHM(t).row,s=e.oxw();return e.KtG(s.remove(l))}),e.TgZ(18,"div",11)(19,"app-icon",12),e._uU(20,"delete"),e.qZA(),e.TgZ(21,"span"),e._uU(22,"Delete Point of Interest"),e.qZA()()()()()}if(2&n){const t=e.MAs(5),o=e.MAs(10);e.xp6(),e.Q6J("content",t),e.xp6(5),e.Q6J("matMenuTriggerFor",o)}}const re=()=>["name","level","location","actions"],ce=()=>["Name","Level","Location"," "],de=()=>["flex","10r","10r","6.5r"],me=(n,_)=>({level:n,actions:_});let pe=(()=>{class n{get kiosk_url(){const t=this._settings.get("app.kiosk_url_path")||"/map-kiosk";return`${window.location.origin}${t}`}loadQrCode(t){const o=`${this.kiosk_url}/#/explore?level=${encodeURIComponent(t.level_id)}&locate=${encodeURIComponent(t.id)}`;t.qr_link=o,t.qr_code=(0,ee.w)(o)}constructor(t,o){this._manager=t,this._settings=o,this.features=this._manager.filtered_features,this.edit=a=>this._manager.editPointOfInterest(a),this.remove=a=>this._manager.removePointOfInterest(a)}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(I),e.Y36(d.gb))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["poi-list"]],decls:6,vars:11,consts:[[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No Points of Interest found.",1,"block","min-w-[32rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["level_template",""],["action_template",""],[1,"w-full","flex","justify-end","space-x-2"],["icon","","matRipple","","customTooltip","",3,"content","click"],["qr_menu",""],["btn","","icon","","matRipple","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","space-x-2","text-red-500"],[1,"text-error"],[1,"bg-base-100","py-2","shadow","rounded"],["printable","",1,""],["target","_blank","ref","noopener noreferrer",1,"block","p-2","mx-4","my-2","rounded-lg","border","border-base-200","bg-base-100",3,"href"],[1,"w-48",3,"src"],[1,"w-[calc(100%-2rem)]","text-center","mt-2","font-mono","text-sm","bg-base-200","rounded","p-2","mx-4"],["btn","","matRipple","",1,"w-[calc(100%-2rem)]","mx-4","my-2",3,"click"]],template:function(o,a){if(1&o&&(e.TgZ(0,"div",0),e._UZ(1,"custom-table",1),e.qZA(),e.YNc(2,le,2,3,"ng-template",null,2,e.W1O)(4,_e,23,2,"ng-template",null,3,e.W1O)),2&o){const l=e.MAs(3),s=e.MAs(5);e.xp6(),e.Q6J("dataSource",a.features)("columns",e.DdM(5,re))("display_column",e.DdM(6,ce))("column_size",e.DdM(7,de))("template",e.WLB(8,me,l,s))}},dependencies:[T.VK,T.OP,T.p6,M.wG,x.o,te.C,ne.X,oe.o,ae.y,ie.M]})}return n})();const fe=["app-poi-manager",""];let F=(()=>{class n{constructor(t){this._state=t,this.new=()=>this._state.editPointOfInterest()}static#e=this.\u0275fac=function(o){return new(o||n)(e.Y36(I))};static#t=this.\u0275cmp=e.Xpm({type:n,selectors:[["","app-poi-manager",""]],attrs:fe,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","px-4","py-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(o,a){1&o&&(e._UZ(0,"app-topbar"),e.TgZ(1,"div",0),e._UZ(2,"app-sidebar"),e.TgZ(3,"main",1)(4,"header",2)(5,"h2",3),e._uU(6," Point of Interest Management "),e.qZA(),e.TgZ(7,"button",4),e.NdJ("click",function(){return a.new()}),e._uU(8," Add Point of Interest "),e.qZA()(),e._UZ(9,"poi-list",5),e.qZA()())},dependencies:[k.O,V.u,M.wG,pe],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=poi-manager.component.ts-angular-inline--186.css.map*/"]})}return n})();var ge=i(21757);const ue=[{path:"",component:F},{path:"new",component:F}];let Pe=(()=>{class n{static#e=this.\u0275fac=function(o){return new(o||n)};static#t=this.\u0275mod=e.oAB({type:n});static#n=this.\u0275inj=e.cJS({imports:[f.ez,c.u5,S.v,Z.YR,E.PP,ge.Hi,N.Bz.forChild(ue)]})}return n})()}}]);
//# sourceMappingURL=apps_concierge_src_app_poi-manager_poi-manager_module_ts.js.map