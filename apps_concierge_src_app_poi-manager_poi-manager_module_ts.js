"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_poi-manager_poi-manager_module_ts"],{2455:(B,C,a)=>{a.r(C),a.d(C,{POIManagerModule:()=>we});var u=a(60316),_=a(34456),G=a(26842),S=a(40363),R=a(22168),E=a(68390),I=a(89204),g=a(12185),f=a(90521),M=a(42175),d=a(71963),x=a(35443),A=a(7841),b=a(12587),m=a(82333),P=a(3998),y=a(33602),k=a(71536),U=a(19803),z=a(66e3),J=a(46815),e=a(68559);let D=(()=>{class l{constructor(t){this._data=t}get hover(){return!!this._data?.hover}static#e=this.\u0275fac=function(n){return new(n||l)(e.rXU(J.Nw))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["map-show-element"]],decls:2,vars:8,consts:[[1,"relative","w-full","h-full","border-2"],[1,"opacity-30","absolute","inset-0"]],template:function(n,o){1&n&&(e.j41(0,"div",0),e.nrm(1,"div",1),e.k0s()),2&n&&(e.AVh("border-secondary",o.hover)("border-primary",!o.hover),e.R7$(),e.AVh("bg-secondary",o.hover)("bg-primary",!o.hover))}})}return l})();var O=a(24950),L=a(87984),j=a(25175),h=a(85060),$=a(69434),Q=a(24918);const H=()=>({controls:!0});function Z(l,c){if(1&l&&(e.j41(0,"mat-option",20),e.EFF(1),e.k0s()),2&l){const t=c.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.display_name||t.name," ")}}function K(l,c){if(1&l&&(e.j41(0,"span"),e.EFF(1),e.nI1(2,"async"),e.nI1(3,"async"),e.k0s()),2&l){let t;const n=e.XpG();e.R7$(),e.Lme(" ",100*n.page+1," - ",(null==(t=e.bMT(2,2,n.search_results))?null:t.length)>100*n.page+100?100*n.page+100:null==(t=e.bMT(3,4,n.search_results))?null:t.length," ")}}function W(l,c){if(1&l&&(e.j41(0,"div",26),e.EFF(1),e.k0s()),2&l){const t=e.XpG().$implicit;e.R7$(),e.SpI(" ",t.location," ")}}function q(l,c){if(1&l){const t=e.RV6();e.j41(0,"button",22),e.bIt("click",function(){const o=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.selected.next(o.id))})("mouseover",function(){const o=e.eBV(t).$implicit,i=e.XpG(2);return e.Njj(i.hovered.next(o.id))}),e.j41(1,"div",23)(2,"div",24),e.EFF(3),e.k0s(),e.DNE(4,W,2,1,"div",25),e.k0s()()}if(2&l){const t=c.$implicit,n=e.XpG(2);e.AVh("!bg-primary",t.id===n.selected.value)("!text-primary-content",t.id===n.selected.value),e.R7$(3),e.JRh(t.name||t.id),e.R7$(),e.Y8G("ngIf",t.location)}}function ee(l,c){if(1&l&&(e.qex(0),e.DNE(1,q,5,6,"button",21),e.nI1(2,"async"),e.nI1(3,"slice"),e.bVm()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",e.brH(3,3,e.bMT(2,1,t.search_results),100*t.page,100*t.page+100))}}function te(l,c){if(1&l){const t=e.RV6();e.j41(0,"div",27)(1,"button",28),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.page=o.page-1)}),e.j41(2,"app-icon"),e.EFF(3,"chevron_left"),e.k0s()(),e.j41(4,"button",29),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.page=0)}),e.EFF(5," 1 "),e.k0s(),e.j41(6,"button",30)(7,"app-icon"),e.EFF(8,"more_horiz"),e.k0s()(),e.j41(9,"button",31),e.EFF(10),e.k0s(),e.j41(11,"button",30)(12,"app-icon"),e.EFF(13,"more_horiz"),e.k0s()(),e.j41(14,"button",32),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.page=o.last_page)}),e.EFF(15),e.nI1(16,"async"),e.nI1(17,"number"),e.k0s(),e.j41(18,"button",28),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.page=o.page+1)}),e.j41(19,"app-icon"),e.EFF(20,"chevron_right"),e.k0s()()()}if(2&l){let t;const n=e.XpG();e.R7$(),e.Y8G("disabled",0===n.page),e.R7$(3),e.AVh("!bg-secondary",0===n.page)("text-secondary-content",0===n.page)("!rounded-full",0===n.page),e.R7$(2),e.AVh("opacity-0",n.page<1),e.R7$(3),e.AVh("opacity-0",n.page<1||n.page>n.last_page-2),e.R7$(),e.SpI(" ",n.page+1," "),e.R7$(),e.AVh("opacity-0",n.page>n.last_page-1),e.R7$(3),e.AVh("!bg-secondary",n.page===n.last_page)("text-secondary-content",n.page===n.last_page)("!rounded-full",n.page===n.last_page),e.R7$(),e.SpI(" ",e.i5U(17,24,(null==(t=e.bMT(16,22,n.search_results))?null:t.length)/100,"1.0-0")," "),e.R7$(3),e.Y8G("disabled",n.page===n.last_page)}}function ne(l,c){1&l&&(e.j41(0,"div",33),e.nrm(1,"img",34),e.j41(2,"div",35),e.EFF(3," No results found "),e.k0s()())}let oe=(()=>{class l extends m.Tv{poiItemFromMapsIndoorsItem(t){return{id:t.properties.externalId||t.properties.roomId||t.id,name:t.properties.name,location:t.properties.building?`${t.properties.building}, Level ${t.properties.floorName}`:"",area:Math.abs(t.geometry.bbox[0]-t.geometry.bbox[2])*Math.abs(t.geometry.bbox[1]-t.geometry.bbox[3])}}constructor(t,n){super(),this._org=t,this._maps_people=n,this.level=new g.PD,this.map_info={},this.page=0,this.last_page=0,this.selected=new f.t(""),this.hovered=new f.t(""),this.search=new f.t(""),this.changed=new f.t(0),this.level_list=this._org.active_levels,this.actions=[{id:"*",action:"click",callback:(o,i)=>this.selectID(i||o)}],this.features=(0,M.zV)([this.selected,this.hovered]).pipe((0,x.T)(([o,i])=>[{location:o,content:D,full_size:!0,no_scale:!0},{location:i,content:D,data:{hover:!0},full_size:!0,no_scale:!0}].filter(s=>s.location))),this.search_results=(0,M.zV)([this.search,this._maps_people.available$,this.changed]).pipe((0,U.B)(300),(0,d.n)(([o,i])=>(console.log("Search:",o,i),i?o.length>2?mapsindoors?.services.LocationsService.getLocations({q:o}).then(s=>{const r=s.map(p=>this.poiItemFromMapsIndoorsItem(p));return this.selected_item&&r.unshift(this.poiItemFromMapsIndoorsItem(this.selected_item)),r}):(0,k.of)(this.selected_item?[this.poiItemFromMapsIndoorsItem(this.selected_item)]:[]):(0,k.of)(Object.entries(this.map_info).map(([s,r])=>({id:s,area:r.w*r.h})).filter(({id:s,area:r})=>s.toLowerCase().includes(o.toLowerCase())&&r<.5).sort((s,r)=>r.area-s.area)))),(0,z.M)(o=>{this.page=0,this.last_page=Math.floor(o.length/100)}),(0,A.t)(1)),this.setMapInfo=o=>this.map_info=o}ngOnInit(){var t=this;return(0,I.A)(function*(){const n=yield t.level_list.pipe((0,y.s)(1)).toPromise();n.length&&(t.level=n[0])})()}onChange(){this.changed.next(Date.now())}selectID(t){var n=this;this.timeout("select_id",(0,I.A)(function*(){if(yield n._maps_people.available$.pipe((0,y.s)(1)).toPromise()){console.log("Item:",t);const i=t.properties?.externalId||t.properties?.roomId||t.id;console.log("Selected ID:",i),n.selected_item=t,i&&n.selected.next(i),n.changed.next(Date.now())}else{const i=t,s=[];for(const[r,p]of Object.entries(n.map_info))p.x<=i.x&&i.x<=p.x+p.w&&p.y<=i.y&&i.y<=p.y+p.h&&s.push([r,p.h*p.w]);s.sort((r,p)=>r[1]-p[1]),s.filter(([r,p])=>p<=.5),s.length&&(console.log("Selected ID:",s[0][0]),n.selected.next(s[0][0]))}}))}static#e=this.\u0275fac=function(n){return new(n||l)(e.rXU(g.yb),e.rXU(m._e))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["select-poi-map-modal"]],features:[e.Vt3],decls:34,vars:26,consts:()=>{let t;return t=$localize`:@@searchPlaceholder␟7e892ba15f2c6c17e83510e273b3e10fc32ea016␟4580988005648117665:Search`,[["empty_state",""],["icon","","matRipple","","mat-dialog-close",""],[1,"flex","min-w-[80vw]","max-w-[calc(100vw-2rem)]","sm:max-w-[64rem]","max-h-[75vh]","h-[75vh]","overflow-hidden"],["map","",1,"relative","h-full","flex-1","w-1/2","bg-base-200"],[3,"mapInfo","src","actions","features","options","focus"],["poi-list","",1,"relative","flex","flex-col","h-full","w-[20rem]","border-l","border-base-300","shadow"],["search","",1,"flex","flex-col","border-b","border-base-200","p-2"],["appearance","outline",1,"w-full","no-subscript","mb-2"],["name","level",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["appearance","outline",1,"w-full","no-subscript"],["matInput","","name","search","placeholder",t,3,"ngModelChange","ngModel"],["matPrefix","",1,"text-2xl"],["list","",1,"flex","flex-col","flex-1","h-1/2","overflow-auto"],[1,"sticky","top-0","w-full","bg-base-100","p-3","z-10"],[4,"ngIf"],[4,"ngIf","ngIfElse"],["pagination","","class","sticky flex items-center justify-center bottom-0 w-full bg-base-100 p-2 z-10 space-x-1",4,"ngIf"],["actions","",1,"p-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-full",3,"disabled","mat-dialog-close"],[3,"value"],["matRipple","","class","flex items-center text-left w-[calc(100%-1rem)] mx-2 my-1 p-2 rounded odd:border odd:border-base-200 even:bg-base-200 hover:bg-base-300 h-16 min-h-16",3,"!bg-primary","!text-primary-content","click","mouseover",4,"ngFor","ngForOf"],["matRipple","",1,"flex","items-center","text-left","w-[calc(100%-1rem)]","mx-2","my-1","p-2","rounded","odd:border","odd:border-base-200","even:bg-base-200","hover:bg-base-300","h-16","min-h-16",3,"click","mouseover"],[1,"flex","flex-col"],[1,""],["class","text-xs opacity-30",4,"ngIf"],[1,"text-xs","opacity-30"],["pagination","",1,"sticky","flex","items-center","justify-center","bottom-0","w-full","bg-base-100","p-2","z-10","space-x-1"],["icon","","matRipple","",1,"border","border-base-200","rounded",3,"click","disabled"],["icon","","matRipple","",3,"click"],["icon",""],["icon","","matRipple","",1,"!bg-secondary","text-secondary-content"],["icon","","matRipple","",1,"border","border-base-200","rounded",3,"click"],[1,"flex","flex-col","items-center","justify-center","h-full","flex-1","space-y-4"],["src","assets/icons/no-results.svg",1,"w-36"],[1,"text-center","opacity-30"]]},template:function(n,o){if(1&n){const i=e.RV6();e.j41(0,"header")(1,"h2"),e.EFF(2,"Select Point of Interest from Map"),e.k0s(),e.j41(3,"button",1)(4,"app-icon"),e.EFF(5,"close"),e.k0s()()(),e.j41(6,"main",2)(7,"div",3)(8,"interactive-map",4),e.nI1(9,"async"),e.bIt("mapInfo",function(r){return e.eBV(i),e.Njj(o.setMapInfo(r))}),e.k0s()(),e.j41(10,"div",5)(11,"div",6)(12,"mat-form-field",7)(13,"mat-select",8),e.mxI("ngModelChange",function(r){return e.eBV(i),e.DH7(o.level,r)||(o.level=r),e.Njj(r)}),e.bIt("ngModelChange",function(){return e.eBV(i),e.Njj(o.onChange())}),e.DNE(14,Z,2,2,"mat-option",9),e.nI1(15,"async"),e.k0s()(),e.j41(16,"mat-form-field",10)(17,"input",11),e.nI1(18,"async"),e.bIt("ngModelChange",function(r){return e.eBV(i),e.Njj(o.search.next(r))}),e.k0s(),e.j41(19,"app-icon",12),e.EFF(20,"search"),e.k0s()()(),e.j41(21,"div",13)(22,"div",14),e.EFF(23),e.nI1(24,"async"),e.DNE(25,K,4,6,"span",15),e.k0s(),e.DNE(26,ee,4,7,"ng-container",16),e.nI1(27,"async"),e.DNE(28,te,21,27,"div",17)(29,ne,4,0,"ng-template",null,0,e.C5r),e.k0s(),e.j41(31,"div",18)(32,"button",19),e.EFF(33," Save "),e.k0s()()()()}if(2&n){let i,s;const r=e.sdS(30);e.R7$(8),e.Y8G("src",null==o.level?null:o.level.map_id)("actions",o.actions)("features",e.bMT(9,15,o.features))("options",e.lJ4(25,H))("focus",o.selected.value),e.R7$(5),e.R50("ngModel",o.level),e.R7$(),e.Y8G("ngForOf",e.bMT(15,17,o.level_list)),e.R7$(3),e.Y8G("ngModel",e.bMT(18,19,o.search)),e.R7$(6),e.SpI(" Results (",(null==(i=e.bMT(24,21,o.search_results))?null:i.length)||0,") "),e.R7$(2),e.Y8G("ngIf",o.last_page),e.R7$(),e.Y8G("ngIf",null==(s=e.bMT(27,23,o.search_results))?null:s.length)("ngIfElse",r),e.R7$(2),e.Y8G("ngIf",o.last_page>0),e.R7$(4),e.Y8G("disabled",!o.selected.value)("mat-dialog-close",o.selected.value)}},dependencies:[u.Sq,u.bT,_.me,_.BC,_.vS,O.rl,O.JW,L.fg,j.VO,h.wT,b.tx,h.r6,$.R,Q.S,u.Jj,u.P9,u.QX]})}return l})();var le=a(41134);const T=()=>({standalone:!0});function ie(l,c){1&l&&(e.j41(0,"button",8)(1,"app-icon"),e.EFF(2,"close"),e.k0s()())}function ae(l,c){1&l&&(e.j41(0,"div",13)(1,"label",14),e.PLo(2,2),e.nrm(3,"span"),e.YFu(),e.k0s(),e.j41(4,"mat-form-field",15),e.nrm(5,"input",21),e.k0s()())}function se(l,c){if(1&l&&(e.j41(0,"mat-option",24),e.EFF(1),e.k0s()),2&l){const t=c.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.display_name," ")}}function re(l,c){if(1&l){const t=e.RV6();e.j41(0,"div",13)(1,"label",14),e.PLo(2,3),e.nrm(3,"span"),e.YFu(),e.k0s(),e.j41(4,"mat-form-field",15)(5,"mat-select",22),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG(3);return e.DH7(i.building,o)||(i.building=o),e.Njj(o)}),e.DNE(6,se,2,2,"mat-option",23),e.nI1(7,"async"),e.k0s()()()}if(2&l){const t=e.XpG(3);e.R7$(5),e.R50("ngModel",t.building),e.Y8G("ngModelOptions",e.lJ4(5,T)),e.R7$(),e.Y8G("ngForOf",e.bMT(7,3,t.building_list))}}function ce(l,c){if(1&l&&(e.j41(0,"mat-option",24),e.EFF(1),e.k0s()),2&l){const t=c.$implicit;e.Y8G("value",t.id),e.R7$(),e.SpI(" ",t.display_name," ")}}function pe(l,c){if(1&l&&(e.j41(0,"div",13)(1,"label",14),e.PLo(2,4),e.nrm(3,"span"),e.YFu(),e.k0s(),e.j41(4,"mat-form-field",15)(5,"mat-select",25),e.DNE(6,ce,2,2,"mat-option",23),e.nI1(7,"async"),e.k0s()()()),2&l){const t=e.XpG(3);e.R7$(6),e.Y8G("ngForOf",e.bMT(7,1,t.level_list))}}function _e(l,c){if(1&l){const t=e.RV6();e.j41(0,"div",26)(1,"mat-form-field",27),e.nrm(2,"input",28),e.k0s(),e.j41(3,"button",29),e.bIt("click",function(){e.eBV(t);const o=e.XpG(3);return e.Njj(o.selectPOIfromMap())}),e.j41(4,"app-icon"),e.EFF(5,"place"),e.k0s()()()}}function de(l,c){if(1&l){const t=e.RV6();e.j41(0,"div",30)(1,"mat-form-field",31)(2,"input",32),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG(3);return e.Njj(i.form.patchValue({location:[o,i.form.value.location[1]]}))}),e.k0s()(),e.j41(3,"mat-form-field",31)(4,"input",33),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG(3);return e.Njj(i.form.patchValue({location:[i.form.value.location[0],o]}))}),e.k0s()()()}if(2&l){const t=e.XpG(3);e.R7$(2),e.Y8G("ngModel",t.form.value.location[0])("ngModelOptions",e.lJ4(4,T)),e.R7$(2),e.Y8G("ngModel",t.form.value.location[1])("ngModelOptions",e.lJ4(5,T))}}function me(l,c){if(1&l){const t=e.RV6();e.j41(0,"form",11),e.DNE(1,ae,6,0,"div",12)(2,re,8,6,"div",12),e.nI1(3,"async"),e.DNE(4,pe,8,3,"div",12),e.j41(5,"div",13)(6,"label",14),e.PLo(7,1),e.nrm(8,"span"),e.YFu(),e.k0s(),e.j41(9,"mat-form-field",15)(10,"mat-select",16),e.mxI("ngModelChange",function(o){e.eBV(t);const i=e.XpG(2);return e.DH7(i.location_type,o)||(i.location_type=o),e.Njj(o)}),e.j41(11,"mat-option",17),e.EFF(12,"Map ID"),e.k0s(),e.j41(13,"mat-option",18),e.EFF(14,"Coordinates"),e.k0s()()(),e.DNE(15,_e,6,0,"div",19)(16,de,5,6,"div",20),e.k0s()()}if(2&l){let t;const n=e.XpG(2);e.Y8G("formGroup",n.form),e.R7$(),e.Y8G("ngIf",n.form.controls.name),e.R7$(),e.Y8G("ngIf",(null==(t=e.bMT(3,8,n.building_list))?null:t.length)>1),e.R7$(2),e.Y8G("ngIf",n.form.controls.level_id),e.R7$(6),e.R50("ngModel",n.location_type),e.Y8G("ngModelOptions",e.lJ4(10,T)),e.R7$(5),e.Y8G("ngIf","map_id"===n.location_type),e.R7$(),e.Y8G("ngIf","coordinates"===n.location_type)}}function ue(l,c){if(1&l&&(e.j41(0,"main",9),e.DNE(1,me,17,11,"form",10),e.k0s()),2&l){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.form)}}function fe(l,c){if(1&l){const t=e.RV6();e.j41(0,"footer",34)(1,"button",35),e.bIt("click",function(){e.eBV(t);const o=e.XpG();return e.Njj(o.save())}),e.EFF(2,"Save"),e.k0s()()}}function ge(l,c){1&l&&(e.j41(0,"div",36),e.nrm(1,"mat-spinner",37),e.j41(2,"p",38),e.EFF(3,"Saving Point Of Interest..."),e.k0s()())}let he=(()=>{class l extends m.Tv{get building(){return this._org.building}set building(t){this._org.building=t}constructor(t,n,o,i,s){super(),this._org=t,this._data=n,this._dialog_ref=o,this._settings=i,this._dialog=s,this.loading=!1,this.location_type=this._data?.location instanceof Array?"coordinates":"map_id",this.building_list=this._org.building_list,this.level_list=this._org.active_levels,this.form=new _.gE({id:new _.MJ(this._data?.id||""),name:new _.MJ(this._data?.name||"",[_.k0.required]),level_id:new _.MJ(this._data?.level_id||"",[_.k0.required]),location:new _.MJ(this._data?.location||"",[_.k0.required])})}ngOnInit(){var t=this;return(0,I.A)(function*(){if(!t.form.value.level_id){const n=yield t.level_list.pipe((0,y.s)(1)).toPromise();n.length&&t.form.patchValue({level_id:n[0].id})}})()}selectPOIfromMap(){this._dialog.open(oe,{data:this._data}).afterClosed().subscribe(n=>{n&&this.form.patchValue({location:n})})}save(){var t=this;return(0,I.A)(function*(){if(!t.form.valid)return(0,m.UG)(`Some form fields are invalid. [${(0,m.F7)(t.form).join(", ")}]`);const n=t.form.getRawValue();n.id||(n.id=`POI-${(0,m.DU)(8)}`),n.short_link_id=t._data?.short_link_id;const o=t._settings.get("app.kiosk_url_path")||"/map-kiosk",i=t._settings.get("app.short_url_public_key"),s="string"==typeof n.location?n.location:n.location.join(",");let r=`${o}/#/explore?level=${n.level_id}&locate=${s}&public=true`;if(i&&(r+=`&x-api-key=${i}`),n.short_link_id)yield(0,m.$8)(n.short_link_id,{id:n.short_link_id,name:n.name,description:`Point of Interest: ${n.name}`,uri:`${window.location.origin}/auth/login?continue=${encodeURIComponent(r)}`}).toPromise();else{const{id:v}=yield(0,m.e1)({name:n.name,description:`Point of Interest: ${n.name}`,uri:`${window.location.origin}/auth/login?continue=${encodeURIComponent(r)}`}).toPromise();n.short_link_id=v}t.loading=!0;const F=(yield(0,P.bpY)(t._org.building.id,"map_features",{}).toPromise()).details||{};F[n.level_id]||(F[n.level_id]=[]),F[n.level_id]=[...F[n.level_id].filter(v=>v.id!==n.id),n].sort((v,Ve)=>v.name.localeCompare(Ve.name));const Y=yield(0,P.D58)(t._org.building.id,{name:"map_features",details:F,description:""}).toPromise().catch(v=>(0,m.UG)(v));Y.id&&t._dialog_ref.close(Y),t.loading=!1})()}static#e=this.\u0275fac=function(n){return new(n||l)(e.rXU(g.yb),e.rXU(b.Vh),e.rXU(b.CP),e.rXU(m.h$),e.rXU(b.bZ))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["poi-modal"]],features:[e.Vt3],decls:8,vars:5,consts:()=>{let t,n,o,i,s,r;return t=$localize`:@@nameLabel␟5db92d8696af8c0f3aa9ce5bf1e1305c8c5aa456␟8054963382343596237: Location${"\ufffd#8\ufffd"}:START_TAG_SPAN:*${"\ufffd/#8\ufffd"}:CLOSE_TAG_SPAN:: `,n=$localize`:@@namePlaceholder␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,o=$localize`:@@nameLabel␟5813c0ce49afffe90191cb912c58fa68674457d8␟1912970594501107766: Name${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,i=$localize`:@@nameLabel␟5e09041a10f5eb39aadfaa1a8dd77f4dc8d77314␟711878476466678637: Building${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,s=$localize`:@@nameLabel␟805d5ab24c829f98df246a63541ee827ce04a4c4␟6308222021008136210: Level${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,r=$localize`:@@locationPlaceholder␟ed31c09fd77c36238c13d83635f3fe5294c733d2␟471816275243265264:Location`,[["load_state",""],t,o,i,s,["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[28rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[28rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","name"],["appearance","outline"],["placeholder","Location Type",3,"ngModelChange","ngModel","ngModelOptions"],["value","map_id"],["value","coordinates"],["class","flex items-center space-x-2 pb-2",4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],["matInput","","name","name","placeholder",n,"formControlName","name"],["placeholder","Select Building",3,"ngModelChange","ngModel","ngModelOptions"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["formControlName","level_id","placeholder","Select Level"],[1,"flex","items-center","space-x-2","pb-2"],["appearance","outline",1,"no-subscript"],["matInput","","name","location","placeholder",r,"formControlName","location"],["icon","","matRipple","",1,"rounded","border","border-base-300","h-12","w-12",3,"click"],[1,"flex","items-center","space-x-2"],["appearance","outline",1,"flex-1"],["matInput","","name","latitude",3,"ngModelChange","ngModel","ngModelOptions"],["matInput","","name","longitude",3,"ngModelChange","ngModel","ngModelOptions"],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(n,o){if(1&n&&(e.j41(0,"header")(1,"h2"),e.EFF(2),e.k0s(),e.DNE(3,ie,3,0,"button",5),e.k0s(),e.DNE(4,ue,2,1,"main",6)(5,fe,3,0,"footer",7)(6,ge,4,0,"ng-template",null,0,e.C5r)),2&n){const i=e.sdS(7);e.R7$(2),e.SpI("",o.form.value.id?"Edit":"Add"," Point Of Interest"),e.R7$(),e.Y8G("ngIf",!o.loading),e.R7$(),e.Y8G("ngIf",!o.loading)("ngIfElse",i),e.R7$(),e.Y8G("ngIf",!o.loading)}},dependencies:[u.Sq,u.bT,_.qT,_.me,_.BC,_.cb,_.vS,O.rl,L.fg,j.VO,h.wT,le.LG,b.tx,h.r6,_.j4,_.JD,$.R,u.Jj]})}return l})(),w=(()=>{class l{constructor(t,n){this._org=t,this._dialog=n,this._options=new f.t({}),this._change=new f.t(0),this.options=this._options.asObservable(),this._features=(0,M.zV)([this._org.active_building,this._change]).pipe((0,d.n)(([o])=>(0,P.bpY)(o.id,"map_features",{})),(0,x.T)(o=>o.details||{}),(0,A.t)(1)),this.filtered_features=(0,M.zV)([this._features,this._options]).pipe((0,x.T)(([o,i])=>{let s=Object.values(o).reduce((r,p)=>[...r,...p],[]);return i.search&&(s=s.filter(r=>r.name.toLowerCase().includes(i.search.toLowerCase()))),s}))}setFilters(t){this._options.next({...this._options.getValue(),...t})}setSearchString(t){this._options.next({...this._options.getValue(),search:t})}editPointOfInterest(t){this._dialog.open(he,{data:t}).afterClosed().subscribe(()=>this._change.next(Date.now()))}removePointOfInterest(t){var n=this;return(0,I.A)(function*(){const o=yield(0,m.GE)({title:"Remove Point of Interest",content:`Are you sure you want to remove the point of interest "${t.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},n._dialog);if("done"!==o.reason)return o.close();o.loading("Removing point of interest...");const s=(yield(0,P.bpY)(n._org.building.id,"map_features",{}).toPromise()).details||{};s[t.level_id]&&(s[t.level_id]=s[t.level_id].filter(r=>r.id!==t.id)),yield(0,P.D58)(n._org.building.id,{name:"map_features",details:s,description:""}).toPromise().catch(r=>{throw(0,m.UG)(r),o.close(),r}),(0,m.VX)("Successfully removed point of interest."),o.close(),n._change.next(Date.now())})()}static#e=this.\u0275fac=function(n){return new(n||l)(e.KVO(g.yb),e.KVO(b.bZ))};static#t=this.\u0275prov=e.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var ve=a(45189),Ie=a(96843),V=a(83259),N=a(31034),be=a(80640),Me=a(12993),Pe=a(22238),Fe=a(74846),Ce=a(26781),Oe=a(23666);const Te=()=>["name","level","location","actions"],Se=()=>["Name","Level","Location"," "],Re=()=>["flex","10r","10r","9r"],Ee=(l,c)=>({level:l,actions:c});function xe(l,c){if(1&l&&(e.EFF(0),e.nI1(1,"level")),2&l){let t;e.SpI(" ",(null==(t=e.bMT(1,1,c.row.level_id))?null:t.display_name)||"Unknown"," ")}}function ye(l,c){if(1&l){const t=e.RV6();e.j41(0,"div",16)(1,"div",17)(2,"a",18),e.nI1(3,"safe"),e.nrm(4,"img",19),e.k0s(),e.j41(5,"div",20),e.EFF(6),e.k0s()(),e.j41(7,"button",21),e.bIt("click",function(){e.eBV(t);const o=e.XpG(2);return e.Njj(o.print())}),e.EFF(8," Print QR Code "),e.k0s()()}if(2&l){const t=e.XpG().row;e.R7$(2),e.Y8G("href",e.i5U(3,3,t.qr_link,"url"),e.B4B),e.R7$(2),e.Y8G("src",t.qr_code,e.B4B),e.R7$(2),e.SpI(" ",t.name||t.id," ")}}function je(l,c){if(1&l){const t=e.RV6();e.j41(0,"div",6)(1,"div",7)(2,"button",8),e.bIt("click",function(){const o=e.eBV(t).row,i=e.XpG();return e.Njj(i.loadQrCode(o))}),e.j41(3,"app-icon"),e.EFF(4,"qr_code"),e.k0s()()(),e.j41(5,"div",9)(6,"button",10),e.bIt("click",function(){const o=e.eBV(t).row,i=e.XpG();return e.Njj(i.loadPublicQrCode(o))}),e.j41(7,"app-icon"),e.EFF(8,"qr_code"),e.k0s()()(),e.DNE(9,ye,9,6,"ng-template",null,2,e.C5r),e.j41(11,"button",11)(12,"app-icon"),e.EFF(13,"more_vert"),e.k0s()(),e.j41(14,"mat-menu",null,3)(16,"button",12),e.bIt("click",function(){const o=e.eBV(t).row,i=e.XpG();return e.Njj(i.edit(o))}),e.j41(17,"div",13)(18,"app-icon"),e.EFF(19,"edit"),e.k0s(),e.j41(20,"span"),e.EFF(21,"Edit Point of Interest"),e.k0s()()(),e.j41(22,"button",12),e.bIt("click",function(){const o=e.eBV(t).row,i=e.XpG();return e.Njj(i.remove(o))}),e.j41(23,"div",14)(24,"app-icon",15),e.EFF(25,"delete"),e.k0s(),e.j41(26,"span"),e.EFF(27,"Delete Point of Interest"),e.k0s()()()()()}if(2&l){const t=c.row,n=e.sdS(10),o=e.sdS(15);e.R7$(2),e.Y8G("content",n),e.R7$(4),e.Y8G("disabled",!t.short_link_id)("content",n),e.R7$(5),e.Y8G("matMenuTriggerFor",o)}}let $e=(()=>{class l{get kiosk_url(){const t=this._settings.get("app.kiosk_url_path")||"/map-kiosk";return`${window.location.origin}${t}`}constructor(t,n){this._manager=t,this._settings=n,this.features=this._manager.filtered_features,this.edit=o=>this._manager.editPointOfInterest(o),this.remove=o=>this._manager.removePointOfInterest(o)}loadQrCode(t){const n="string"==typeof t.location?t.location:t.location.join(","),o=`${this.kiosk_url}/#/explore?level=${encodeURIComponent(t.level_id)}&locate=${encodeURIComponent(n)}`;t.qr_link=o,t.qr_code=(0,V.C)(o)}loadPublicQrCode(t){const n=`${location.origin}/r/${t.short_link_id.split("-")[1]}`;t.qr_link=n,t.qr_code=(0,V.C)(n)}print(){window.print()}static#e=this.\u0275fac=function(n){return new(n||l)(e.rXU(w),e.rXU(m.h$))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["poi-list"]],decls:6,vars:11,consts:[["level_template",""],["action_template",""],["qr_menu",""],["menu","matMenu"],[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No Points of Interest found.",1,"block","min-w-[32rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],[1,"w-full","flex","justify-end","space-x-2"],["matTooltip","Private QR Code"],["icon","","matRipple","","customTooltip","",3,"click","content"],["matTooltip","Public QR Code"],["icon","","matRipple","","customTooltip","",3,"click","disabled","content"],["btn","","icon","","matRipple","",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","space-x-2","text-red-500"],[1,"text-error"],[1,"bg-base-100","py-2","shadow","rounded"],["printable","",1,""],["target","_blank","ref","noopener noreferrer",1,"block","p-2","mx-4","my-2","rounded-lg","border","border-base-200","bg-base-100",3,"href"],[1,"w-48",3,"src"],[1,"w-[calc(100%-2rem)]","text-center","mt-2","font-mono","text-sm","bg-base-200","rounded","p-2","mx-4"],["btn","","matRipple","",1,"w-[calc(100%-2rem)]","mx-4","my-2",3,"click"]],template:function(n,o){if(1&n&&(e.j41(0,"div",4),e.nrm(1,"custom-table",5),e.k0s(),e.DNE(2,xe,2,3,"ng-template",null,0,e.C5r)(4,je,28,4,"ng-template",null,1,e.C5r)),2&n){const i=e.sdS(3),s=e.sdS(5);e.R7$(),e.Y8G("dataSource",o.features)("columns",e.lJ4(5,Te))("display_column",e.lJ4(6,Se))("column_size",e.lJ4(7,Re))("template",e.l_i(8,Ee,i,s))}},dependencies:[N.kk,N.fb,N.Cp,be.oV,h.r6,$.R,Me.r,Pe.I,Fe.L,Ce.m,Oe.D]})}return l})();const Ne=["app-poi-manager",""],Ge=()=>({standalone:!0});function Ae(l,c){if(1&l&&(e.j41(0,"mat-option",11),e.EFF(1),e.k0s()),2&l){const t=c.$implicit;e.Y8G("value",t),e.R7$(),e.SpI(" ",t.display_name||t.name," ")}}function ke(l,c){if(1&l){const t=e.RV6();e.j41(0,"div",7)(1,"mat-form-field",8)(2,"mat-select",9),e.bIt("ngModelChange",function(o){e.eBV(t);const i=e.XpG();return e.Njj(i.building=o)}),e.DNE(3,Ae,2,2,"mat-option",10),e.nI1(4,"async"),e.k0s()()()}if(2&l){const t=e.XpG();e.R7$(2),e.Y8G("ngModel",t.building)("ngModelOptions",e.lJ4(6,Ge))("placeholder",(null==t.building?null:t.building.display_name)||(null==t.building?null:t.building.name)),e.R7$(),e.Y8G("ngForOf",e.bMT(4,4,t.buildings))}}let X=(()=>{class l{get building(){return this._org.building}set building(t){this._org.building=t}get use_region(){return!!this._settings.get("app.use_region")}constructor(t,n,o){this._org=t,this._state=n,this._settings=o,this.new=()=>this._state.editPointOfInterest(),this.buildings=this._org.active_buildings}static#e=this.\u0275fac=function(n){return new(n||l)(e.rXU(g.yb),e.rXU(w),e.rXU(m.h$))};static#t=this.\u0275cmp=e.VBU({type:l,selectors:[["","app-poi-manager",""]],attrs:Ne,decls:13,vars:7,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","px-4","py-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],["class","flex items-center justify-between mb-2 px-4",4,"ngIf"],[1,"block","w-full","relative","flex-1","h-1/2"],[1,"flex","items-center","justify-between","mb-2","px-4"],["appearance","outline",1,"w-64"],["name","building",3,"ngModelChange","ngModel","ngModelOptions","placeholder"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,o){if(1&n&&(e.nrm(0,"app-topbar"),e.j41(1,"div",0),e.nrm(2,"app-sidebar"),e.j41(3,"main",1)(4,"header",2),e.nI1(5,"async"),e.j41(6,"h2",3),e.EFF(7," Point of Interest Management "),e.k0s(),e.j41(8,"button",4),e.bIt("click",function(){return o.new()}),e.EFF(9," Add Point of Interest "),e.k0s()(),e.DNE(10,ke,5,7,"div",5),e.nI1(11,"async"),e.nrm(12,"poi-list",6),e.k0s()()),2&n){let i,s;e.R7$(4),e.AVh("mb-2",!o.use_region||(null==(i=e.bMT(5,3,o.buildings))?null:i.length)<=1),e.R7$(6),e.Y8G("ngIf",o.use_region&&(null==(s=e.bMT(11,5,o.buildings))?null:s.length)>1)}},dependencies:[u.Sq,u.bT,_.BC,_.vS,ve.S,Ie.c,O.rl,j.VO,h.wT,h.r6,$e,u.Jj],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=poi-manager.component.ts-angular-inline--189.css.map*/"]})}return l})();var De=a(12772);const Le=[{path:"",component:X},{path:"new",component:X}];let we=(()=>{class l{static#e=this.\u0275fac=function(n){return new(n||l)};static#t=this.\u0275mod=e.$C({type:l});static#n=this.\u0275inj=e.G2t({imports:[u.MD,_.YN,S.r,R.lx,E.kR,De.YN,G.iI.forChild(Le)]})}return l})()},68390:(B,C,a)=>{a.d(C,{g8:()=>R,kR:()=>u.k,Gp:()=>E.Gp,N8:()=>f.N8,SZ:()=>f.SZ,is:()=>g.is});var u=a(11081),S=(a(11543),a(7282),a(67450));class R{constructor(d={}){this.type=d.type||d.location||"other",this.position=d.position||d.map_id||d.asset_id||{x:d.x/d.map_width||0,y:d.y/d.map_height||0},this.variance=d.variance||0,this.last_seen=d.last_seen||(0,S.A)(new Date),this.level=d.level,this.building=d.building,this.at_location=!!d.at_location,this.coordinates_from=d.coordinates_from||"top-left"}}var E=a(93693),g=(a(24129),a(86039)),f=a(2372)}}]);
//# sourceMappingURL=apps_concierge_src_app_poi-manager_poi-manager_module_ts.js.map