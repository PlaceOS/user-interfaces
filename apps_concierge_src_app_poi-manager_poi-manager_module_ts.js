"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_poi-manager_poi-manager_module_ts"],{98977:(Ot,C,i)=>{i.r(C),i.d(C,{POIManagerModule:()=>vt});var u=i(26575),c=i(28849),b=i(92649),L=i(97910),R=i(47049),y=i(10060),T=i(71670),O=i(93121),A=i(70462),x=i(28159),$=i(36520),I=i(47422),G=i(680),P=i(17401),d=i(34592),g=i(47298),w=i(46939),t=i(29039),D=i(71268),U=i(99674),J=i(96355),M=i(10257),Q=i(33910),F=i(94888);function k(o,r){1&o&&(t.TgZ(0,"button",4)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function Y(o,r){1&o&&(t.TgZ(0,"div",9)(1,"label",10),t.tHW(2,18),t._UZ(3,"span"),t.N_p(),t.qZA(),t.TgZ(4,"mat-form-field",12),t._UZ(5,"input",19),t.qZA()())}function j(o,r){if(1&o&&(t.TgZ(0,"mat-option",23),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e),t.xp6(),t.hij(" ",e.display_name," ")}}const h=()=>({standalone:!0});function X(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",9)(1,"label",10),t.tHW(2,20),t._UZ(3,"span"),t.N_p(),t.qZA(),t.TgZ(4,"mat-form-field",12)(5,"mat-select",21),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(3);return t.KtG(l.building=a)}),t.YNc(6,j,2,2,"mat-option",22),t.ALo(7,"async"),t.qZA()()()}if(2&o){const e=t.oxw(3);t.xp6(5),t.Q6J("ngModel",e.building)("ngModelOptions",t.DdM(5,h)),t.xp6(),t.Q6J("ngForOf",t.lcZ(7,3,e.building_list))}}function q(o,r){if(1&o&&(t.TgZ(0,"mat-option",23),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.display_name," ")}}function H(o,r){if(1&o&&(t.TgZ(0,"div",9)(1,"label",10),t.tHW(2,24),t._UZ(3,"span"),t.N_p(),t.qZA(),t.TgZ(4,"mat-form-field",12)(5,"mat-select",25),t.YNc(6,q,2,2,"mat-option",22),t.ALo(7,"async"),t.qZA()()()),2&o){const e=t.oxw(3);t.xp6(6),t.Q6J("ngForOf",t.lcZ(7,1,e.level_list))}}function K(o,r){1&o&&(t.ynx(0),t.TgZ(1,"mat-form-field",12),t._UZ(2,"input",26),t.qZA(),t.BQk())}function z(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",27)(1,"mat-form-field",28)(2,"input",29),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(3);return t.KtG(l.form.patchValue({location:[a,l.form.value.location[1]]}))}),t.qZA()(),t.TgZ(3,"mat-form-field",28)(4,"input",30),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(3);return t.KtG(l.form.patchValue({location:[l.form.value.location[0],a]}))}),t.qZA()()()}if(2&o){const e=t.oxw(3);t.xp6(2),t.Q6J("ngModel",e.form.value.location[0])("ngModelOptions",t.DdM(4,h)),t.xp6(2),t.Q6J("ngModel",e.form.value.location[1])("ngModelOptions",t.DdM(5,h))}}function B(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"form",7),t.YNc(1,Y,6,0,"div",8)(2,X,8,6,"div",8),t.ALo(3,"async"),t.YNc(4,H,8,3,"div",8),t.TgZ(5,"div",9)(6,"label",10),t.tHW(7,11),t._UZ(8,"span"),t.N_p(),t.qZA(),t.TgZ(9,"mat-form-field",12)(10,"mat-select",13),t.NdJ("ngModelChange",function(a){t.CHM(e);const l=t.oxw(2);return t.KtG(l.location_type=a)}),t.TgZ(11,"mat-option",14),t._uU(12,"Map ID"),t.qZA(),t.TgZ(13,"mat-option",15),t._uU(14,"Coordinates"),t.qZA()()(),t.YNc(15,K,3,0,"ng-container",16)(16,z,5,6,"div",17),t.qZA()()}if(2&o){const e=t.oxw(2);let n;t.Q6J("formGroup",e.form),t.xp6(),t.Q6J("ngIf",e.form.controls.name),t.xp6(),t.Q6J("ngIf",(null==(n=t.lcZ(3,8,e.building_list))?null:n.length)>1),t.xp6(2),t.Q6J("ngIf",e.form.controls.level_id),t.xp6(6),t.Q6J("ngModel",e.location_type)("ngModelOptions",t.DdM(10,h)),t.xp6(5),t.Q6J("ngIf","map_id"===e.location_type),t.xp6(),t.Q6J("ngIf","coordinates"===e.location_type)}}function W(o,r){if(1&o&&(t.TgZ(0,"main",5),t.YNc(1,B,17,11,"form",6),t.qZA()),2&o){const e=t.oxw();t.xp6(),t.Q6J("ngIf",e.form)}}function V(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"footer",31)(1,"button",32),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.save())}),t._uU(2,"Save"),t.qZA()()}}function tt(o,r){1&o&&(t.TgZ(0,"div",33),t._UZ(1,"mat-spinner",34),t.TgZ(2,"p",35),t._uU(3,"Saving Point Of Interest..."),t.qZA()())}let et=(()=>{class o extends d.cx{get building(){return this._org.building}set building(e){this._org.building=e}constructor(e,n,a,l){super(),this._org=e,this._data=n,this._dialog_ref=a,this._settings=l,this.loading=!1,this.location_type=this._data?.location instanceof Array?"coordinates":"map_id",this.building_list=this._org.building_list,this.level_list=this._org.active_levels,this.form=new c.cw({id:new c.NI(this._data?.id||""),name:new c.NI(this._data?.name||"",[c.kI.required]),level_id:new c.NI(this._data?.level_id||"",[c.kI.required]),location:new c.NI(this._data?.location||"",[c.kI.required])})}ngOnInit(){var e=this;return(0,T.Z)(function*(){if(!e.form.value.level_id){const n=yield e.level_list.pipe((0,w.q)(1)).toPromise();n.length&&e.form.patchValue({level_id:n[0].id})}})()}save(){var e=this;return(0,T.Z)(function*(){if(!e.form.valid)return(0,d.cB)(`Some form fields are invalid. [${(0,d.RD)(e.form).join(", ")}]`);const n=e.form.getRawValue();n.id||(n.id=`POI-${(0,d.O1)(8)}`),n.short_link_id=e._data?.short_link_id;const a=e._settings.get("app.kiosk_url_path")||"/map-kiosk",l=e._settings.get("app.short_url_public_key"),s="string"==typeof n.location?n.location:n.location.join(",");let _=`${a}/#/explore?level=${n.level_id}&locate=${s}&public=true`;if(l&&(_+=`&x-api-key=${l}`),n.short_link_id)yield(0,d.rN)(n.short_link_id,{id:n.short_link_id,name:n.name,description:`Point of Interest: ${n.name}`,uri:`${window.location.origin}/auth/login?continue=${encodeURIComponent(_)}`}).toPromise();else{const{id:p}=yield(0,d.Ke)({name:n.name,description:`Point of Interest: ${n.name}`,uri:`${window.location.origin}/auth/login?continue=${encodeURIComponent(_)}`}).toPromise();n.short_link_id=p}e.loading=!0;const f=(yield(0,g.rlq)(e._org.building.id,"map_features",{}).toPromise()).details||{};f[n.level_id]||(f[n.level_id]=[]),f[n.level_id]=[...f[n.level_id].filter(p=>p.id!==n.id),n].sort((p,Ct)=>p.name.localeCompare(Ct.name));const E=yield(0,g.Ymr)(e._org.building.id,{name:"map_features",details:f,description:""}).toPromise().catch(p=>(0,d.cB)(p));E.id&&e._dialog_ref.close(E),e.loading=!1})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(O.w7),t.Y36(P.WI),t.Y36(P.so),t.Y36(d.gb))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["poi-modal"]],features:[t.qOj],decls:8,vars:5,consts:()=>{let e,n,a,l,s,_;return e=$localize`:@@nameLabel␟5db92d8696af8c0f3aa9ce5bf1e1305c8c5aa456␟8054963382343596237: Location${"\ufffd#8\ufffd"}:START_TAG_SPAN:*${"\ufffd/#8\ufffd"}:CLOSE_TAG_SPAN:: `,n=$localize`:@@nameLabel␟5813c0ce49afffe90191cb912c58fa68674457d8␟1912970594501107766: Name${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,a=$localize`:@@namePlaceholder␟cff1428d10d59d14e45edec3c735a27b5482db59␟8953033926734869941:Name`,l=$localize`:@@nameLabel␟5e09041a10f5eb39aadfaa1a8dd77f4dc8d77314␟711878476466678637: Building${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,s=$localize`:@@nameLabel␟805d5ab24c829f98df246a63541ee827ce04a4c4␟6308222021008136210: Level${"\ufffd#3\ufffd"}:START_TAG_SPAN:*${"\ufffd/#3\ufffd"}:CLOSE_TAG_SPAN:: `,_=$localize`:@@locationPlaceholder␟ed31c09fd77c36238c13d83635f3fe5294c733d2␟471816275243265264:Location`,[["btn","","icon","","mat-dialog-close","",4,"ngIf"],["class","max-h-[65vh] overflow-y-auto overflow-x-hidden p-4",4,"ngIf","ngIfElse"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["load_state",""],["btn","","icon","","mat-dialog-close",""],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],["system","","class","flex flex-col w-[28rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["system","",1,"flex","flex-col","w-[28rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","name"],e,["appearance","outline"],["placeholder","Location Type",3,"ngModel","ngModelOptions","ngModelChange"],["value","map_id"],["value","coordinates"],[4,"ngIf"],["class","flex items-center space-x-2",4,"ngIf"],n,["matInput","","name","name","placeholder",a,"formControlName","name"],l,["placeholder","Select Building",3,"ngModel","ngModelOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],s,["formControlName","level_id","placeholder","Select Level"],["matInput","","name","location","placeholder",_,"formControlName","location"],[1,"flex","items-center","space-x-2"],["appearance","outline",1,"flex-1"],["matInput","","name","latitude",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","name","longitude",3,"ngModel","ngModelOptions","ngModelChange"],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(n,a){if(1&n&&(t.TgZ(0,"header")(1,"h2"),t._uU(2),t.qZA(),t.YNc(3,k,3,0,"button",0),t.qZA(),t.YNc(4,W,2,1,"main",1)(5,V,3,0,"footer",2)(6,tt,4,0,"ng-template",null,3,t.W1O)),2&n){const l=t.MAs(7);t.xp6(2),t.hij("",a.form.value.id?"Edit":"Add"," Point Of Interest"),t.xp6(),t.Q6J("ngIf",!a.loading),t.xp6(),t.Q6J("ngIf",!a.loading)("ngIfElse",l),t.xp6(),t.Q6J("ngIf",!a.loading)}},dependencies:[u.sg,u.O5,c._Y,c.Fj,c.JJ,c.JL,c.On,D.KE,U.Nt,J.gD,M.ey,Q.Ou,P.ZT,c.sg,c.u,F.o,u.Ov]})}return o})(),N=(()=>{class o{constructor(e,n){this._org=e,this._dialog=n,this._options=new A.X({}),this._change=new A.X(0),this.options=this._options.asObservable(),this._features=(0,x.aj)([this._org.active_building,this._change]).pipe((0,$.w)(([a])=>(0,g.rlq)(a.id,"map_features",{})),(0,I.U)(a=>a.details||{}),(0,G.d)(1)),this.filtered_features=(0,x.aj)([this._features,this._options]).pipe((0,I.U)(([a,l])=>{let s=Object.values(a).reduce((_,m)=>[..._,...m],[]);return l.search&&(s=s.filter(_=>_.name.toLowerCase().includes(l.search.toLowerCase()))),s}))}setFilters(e){this._options.next({...this._options.getValue(),...e})}setSearchString(e){this._options.next({...this._options.getValue(),search:e})}editPointOfInterest(e){this._dialog.open(et,{data:e}).afterClosed().subscribe(()=>this._change.next(Date.now()))}removePointOfInterest(e){var n=this;return(0,T.Z)(function*(){const a=yield(0,d._5)({title:"Remove Point of Interest",content:`Are you sure you want to remove the point of interest "${e.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},n._dialog);if("done"!==a.reason)return a.close();a.loading("Removing point of interest...");const s=(yield(0,g.rlq)(n._org.building.id,"map_features",{}).toPromise()).details||{};s[e.level_id]&&(s[e.level_id]=s[e.level_id].filter(_=>_.id!==e.id)),yield(0,g.Ymr)(n._org.building.id,{name:"map_features",details:s,description:""}).toPromise().catch(_=>{throw(0,d.cB)(_),a.close(),_}),(0,d.t5)("Successfully removed point of interest."),a.close(),n._change.next(Date.now())})()}static#t=this.\u0275fac=function(n){return new(n||o)(t.LFG(O.w7),t.LFG(P.uw))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var nt=i(33005),ot=i(19842),S=i(89680),v=i(78128),at=i(60702),it=i(27442),lt=i(33884),st=i(81886),rt=i(16318),ct=i(6612);function _t(o,r){if(1&o&&(t._uU(0),t.ALo(1,"level")),2&o){let n;t.hij(" ",(null==(n=t.lcZ(1,1,r.row.level_id))?null:n.display_name)||"Unknown"," ")}}function dt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",16)(1,"div",17)(2,"a",18),t.ALo(3,"safe"),t._UZ(4,"img",19),t.qZA(),t.TgZ(5,"div",20),t._uU(6),t.qZA()(),t.TgZ(7,"button",21),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.print())}),t._uU(8," Print QR Code "),t.qZA()()}if(2&o){const e=t.oxw().row;t.xp6(2),t.Q6J("href",t.xi3(3,3,e.qr_link,"url"),t.LSH),t.xp6(2),t.Q6J("src",e.qr_code,t.LSH),t.xp6(2),t.hij(" ",e.name||e.id," ")}}function mt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",4)(1,"div",5)(2,"button",6),t.NdJ("click",function(){const l=t.CHM(e).row,s=t.oxw();return t.KtG(s.loadQrCode(l))}),t.TgZ(3,"app-icon"),t._uU(4,"qr_code"),t.qZA()()(),t.TgZ(5,"div",7)(6,"button",8),t.NdJ("click",function(){const l=t.CHM(e).row,s=t.oxw();return t.KtG(s.loadPublicQrCode(l))}),t.TgZ(7,"app-icon"),t._uU(8,"qr_code"),t.qZA()()(),t.YNc(9,dt,9,6,"ng-template",null,9,t.W1O),t.TgZ(11,"button",10)(12,"app-icon"),t._uU(13,"more_vert"),t.qZA()(),t.TgZ(14,"mat-menu",null,11)(16,"button",12),t.NdJ("click",function(){const l=t.CHM(e).row,s=t.oxw();return t.KtG(s.edit(l))}),t.TgZ(17,"div",13)(18,"app-icon"),t._uU(19,"edit"),t.qZA(),t.TgZ(20,"span"),t._uU(21,"Edit Point of Interest"),t.qZA()()(),t.TgZ(22,"button",12),t.NdJ("click",function(){const l=t.CHM(e).row,s=t.oxw();return t.KtG(s.remove(l))}),t.TgZ(23,"div",14)(24,"app-icon",15),t._uU(25,"delete"),t.qZA(),t.TgZ(26,"span"),t._uU(27,"Delete Point of Interest"),t.qZA()()()()()}if(2&o){const e=r.row,n=t.MAs(10),a=t.MAs(15);t.xp6(2),t.Q6J("content",n),t.xp6(4),t.Q6J("disabled",!e.short_link_id)("content",n),t.xp6(5),t.Q6J("matMenuTriggerFor",a)}}const pt=()=>["name","level","location","actions"],gt=()=>["Name","Level","Location"," "],ft=()=>["flex","10r","10r","9r"],ut=(o,r)=>({level:o,actions:r});let Pt=(()=>{class o{get kiosk_url(){const e=this._settings.get("app.kiosk_url_path")||"/map-kiosk";return`${window.location.origin}${e}`}loadQrCode(e){const n="string"==typeof e.location?e.location:e.location.join(","),a=`${this.kiosk_url}/#/explore?level=${encodeURIComponent(e.level_id)}&locate=${encodeURIComponent(n)}`;e.qr_link=a,e.qr_code=(0,S.w)(a)}loadPublicQrCode(e){const n=`${location.origin}/r/${e.short_link_id.split("-")[1]}`;e.qr_link=n,e.qr_code=(0,S.w)(n)}constructor(e,n){this._manager=e,this._settings=n,this.features=this._manager.filtered_features,this.edit=a=>this._manager.editPointOfInterest(a),this.remove=a=>this._manager.removePointOfInterest(a)}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(N),t.Y36(d.gb))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["poi-list"]],decls:6,vars:11,consts:[[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No Points of Interest found.",1,"block","min-w-[32rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["level_template",""],["action_template",""],[1,"w-full","flex","justify-end","space-x-2"],["matTooltip","Private QR Code"],["icon","","matRipple","","customTooltip","",3,"content","click"],["matTooltip","Public QR Code"],["icon","","matRipple","","customTooltip","",3,"disabled","content","click"],["qr_menu",""],["btn","","icon","","matRipple","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"flex","items-center","space-x-2","text-red-500"],[1,"text-error"],[1,"bg-base-100","py-2","shadow","rounded"],["printable","",1,""],["target","_blank","ref","noopener noreferrer",1,"block","p-2","mx-4","my-2","rounded-lg","border","border-base-200","bg-base-100",3,"href"],[1,"w-48",3,"src"],[1,"w-[calc(100%-2rem)]","text-center","mt-2","font-mono","text-sm","bg-base-200","rounded","p-2","mx-4"],["btn","","matRipple","",1,"w-[calc(100%-2rem)]","mx-4","my-2",3,"click"]],template:function(n,a){if(1&n&&(t.TgZ(0,"div",0),t._UZ(1,"custom-table",1),t.qZA(),t.YNc(2,_t,2,3,"ng-template",null,2,t.W1O)(4,mt,28,4,"ng-template",null,3,t.W1O)),2&n){const l=t.MAs(3),s=t.MAs(5);t.xp6(),t.Q6J("dataSource",a.features)("columns",t.DdM(5,pt))("display_column",t.DdM(6,gt))("column_size",t.DdM(7,ft))("template",t.WLB(8,ut,l,s))}},dependencies:[v.VK,v.OP,v.p6,at.gM,M.wG,F.o,it.C,lt.X,st.o,rt.y,ct.M]})}return o})();const ht=["app-poi-manager",""];let Z=(()=>{class o{constructor(e){this._state=e,this.new=()=>this._state.editPointOfInterest()}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(N))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","app-poi-manager",""]],attrs:ht,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","px-4","py-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(n,a){1&n&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1)(4,"header",2)(5,"h2",3),t._uU(6," Point of Interest Management "),t.qZA(),t.TgZ(7,"button",4),t.NdJ("click",function(){return a.new()}),t._uU(8," Add Point of Interest "),t.qZA()(),t._UZ(9,"poi-list",5),t.qZA()())},dependencies:[nt.O,ot.u,M.wG,Pt],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=poi-manager.component.ts-angular-inline--186.css.map*/"]})}return o})();var Tt=i(21757);const Mt=[{path:"",component:Z},{path:"new",component:Z}];let vt=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[u.ez,c.u5,L.v,R.YR,y.PP,Tt.Hi,b.Bz.forChild(Mt)]})}return o})()}}]);
//# sourceMappingURL=apps_concierge_src_app_poi-manager_poi-manager_module_ts.js.map