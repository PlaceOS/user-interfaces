(self.webpackChunkplaceos=self.webpackChunkplaceos||[]).push([["apps_workplace_src_app_book_book_module_ts"],{6134:(t,n,i)=>{"use strict";i.r(n),i.d(n,{BookModule:()=>ai});var o=i(1511),s=i(6073),a=i(9861),r=i(4230),l=i(2619),c=i(1522),u=i(4621);
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
const d=["button"],g=["*"],p=new l.OlP("MAT_BUTTON_TOGGLE_DEFAULT_OPTIONS"),m=new l.OlP("MatButtonToggleGroup"),f={provide:s.JU,useExisting:(0,l.Gpc)(()=>v),multi:!0};let h=0;class _{constructor(e,t){this.source=e,this.value=t}}let v=(()=>{class e{constructor(e,t){this._changeDetector=e,this._vertical=!1,this._multiple=!1,this._disabled=!1,this._controlValueAccessorChangeFn=()=>{},this._onTouched=()=>{},this._name="mat-button-toggle-group-"+h++,this.valueChange=new l.vpe,this.change=new l.vpe,this.appearance=t&&t.appearance?t.appearance:"standard"}get name(){return this._name}set name(e){this._name=e,this._buttonToggles&&this._buttonToggles.forEach(e=>{e.name=this._name,e._markForCheck()})}get vertical(){return this._vertical}set vertical(e){this._vertical=(0,a.Ig)(e)}get value(){const e=this._selectionModel?this._selectionModel.selected:[];return this.multiple?e.map(e=>e.value):e[0]?e[0].value:void 0}set value(e){this._setSelectionByValue(e),this.valueChange.emit(this.value)}get selected(){const e=this._selectionModel?this._selectionModel.selected:[];return this.multiple?e:e[0]||null}get multiple(){return this._multiple}set multiple(e){this._multiple=(0,a.Ig)(e)}get disabled(){return this._disabled}set disabled(e){this._disabled=(0,a.Ig)(e),this._buttonToggles&&this._buttonToggles.forEach(e=>e._markForCheck())}ngOnInit(){this._selectionModel=new r.Ov(this.multiple,void 0,!1)}ngAfterContentInit(){this._selectionModel.select(...this._buttonToggles.filter(e=>e.checked))}writeValue(e){this.value=e,this._changeDetector.markForCheck()}registerOnChange(e){this._controlValueAccessorChangeFn=e}registerOnTouched(e){this._onTouched=e}setDisabledState(e){this.disabled=e}_emitChangeEvent(){const e=this.selected,t=Array.isArray(e)?e[e.length-1]:e,n=new _(t,this.value);this._controlValueAccessorChangeFn(n.value),this.change.emit(n)}_syncButtonToggle(e,t,n=!1,i=!1){this.multiple||!this.selected||e.checked||(this.selected.checked=!1),this._selectionModel?t?this._selectionModel.select(e):this._selectionModel.deselect(e):i=!0,i?Promise.resolve().then(()=>this._updateModelValue(n)):this._updateModelValue(n)}_isSelected(e){return this._selectionModel&&this._selectionModel.isSelected(e)}_isPrechecked(e){return void 0!==this._rawValue&&(this.multiple&&Array.isArray(this._rawValue)?this._rawValue.some(t=>null!=e.value&&t===e.value):e.value===this._rawValue)}_setSelectionByValue(e){this._rawValue=e,this._buttonToggles&&(this.multiple&&e?(Array.isArray(e),this._clearSelection(),e.forEach(e=>this._selectValue(e))):(this._clearSelection(),this._selectValue(e)))}_clearSelection(){this._selectionModel.clear(),this._buttonToggles.forEach(e=>e.checked=!1)}_selectValue(e){const t=this._buttonToggles.find(t=>null!=t.value&&t.value===e);t&&(t.checked=!0,this._selectionModel.select(t))}_updateModelValue(e){e&&this._emitChangeEvent(),this.valueChange.emit(this.value)}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(l.sBO),l.Y36(p,8))},e.\u0275dir=l.lG2({type:e,selectors:[["mat-button-toggle-group"]],contentQueries:function(e,t,n){if(1&e&&l.Suo(n,x,5),2&e){let e;l.iGM(e=l.CRH())&&(t._buttonToggles=e)}},hostAttrs:["role","group",1,"mat-button-toggle-group"],hostVars:5,hostBindings:function(e,t){2&e&&(l.uIk("aria-disabled",t.disabled),l.ekj("mat-button-toggle-vertical",t.vertical)("mat-button-toggle-group-appearance-standard","standard"===t.appearance))},inputs:{appearance:"appearance",name:"name",vertical:"vertical",value:"value",multiple:"multiple",disabled:"disabled"},outputs:{valueChange:"valueChange",change:"change"},exportAs:["matButtonToggleGroup"],features:[l._Bn([f,{provide:m,useExisting:e}])]}),e})();class Z{}const b=(0,c.Kr)(Z);let x=(()=>{class e extends b{constructor(e,t,n,i,o,s){super(),this._changeDetectorRef=t,this._elementRef=n,this._focusMonitor=i,this._isSingleSelector=!1,this._checked=!1,this.ariaLabelledby=null,this._disabled=!1,this.change=new l.vpe;const a=Number(o);this.tabIndex=a||0===a?a:null,this.buttonToggleGroup=e,this.appearance=s&&s.appearance?s.appearance:"standard"}get buttonId(){return`${this.id}-button`}get appearance(){return this.buttonToggleGroup?this.buttonToggleGroup.appearance:this._appearance}set appearance(e){this._appearance=e}get checked(){return this.buttonToggleGroup?this.buttonToggleGroup._isSelected(this):this._checked}set checked(e){const t=(0,a.Ig)(e);t!==this._checked&&(this._checked=t,this.buttonToggleGroup&&this.buttonToggleGroup._syncButtonToggle(this,this._checked),this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled||this.buttonToggleGroup&&this.buttonToggleGroup.disabled}set disabled(e){this._disabled=(0,a.Ig)(e)}ngOnInit(){const e=this.buttonToggleGroup;this._isSingleSelector=e&&!e.multiple,this.id=this.id||"mat-button-toggle-"+h++,this._isSingleSelector&&(this.name=e.name),e&&(e._isPrechecked(this)?this.checked=!0:e._isSelected(this)!==this._checked&&e._syncButtonToggle(this,this._checked))}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0)}ngOnDestroy(){const e=this.buttonToggleGroup;this._focusMonitor.stopMonitoring(this._elementRef),e&&e._isSelected(this)&&e._syncButtonToggle(this,!1,!1,!0)}focus(e){this._buttonElement.nativeElement.focus(e)}_onButtonClick(){const e=!!this._isSingleSelector||!this._checked;e!==this._checked&&(this._checked=e,this.buttonToggleGroup&&(this.buttonToggleGroup._syncButtonToggle(this,this._checked,!0),this.buttonToggleGroup._onTouched())),this.change.emit(new _(this,this.value))}_markForCheck(){this._changeDetectorRef.markForCheck()}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(m,8),l.Y36(l.sBO),l.Y36(l.SBq),l.Y36(u.tE),l.$8M("tabindex"),l.Y36(p,8))},e.\u0275cmp=l.Xpm({type:e,selectors:[["mat-button-toggle"]],viewQuery:function(e,t){if(1&e&&l.Gf(d,5),2&e){let e;l.iGM(e=l.CRH())&&(t._buttonElement=e.first)}},hostAttrs:["role","presentation",1,"mat-button-toggle"],hostVars:12,hostBindings:function(e,t){1&e&&l.NdJ("focus",function(){return t.focus()}),2&e&&(l.uIk("aria-label",null)("aria-labelledby",null)("id",t.id)("name",null),l.ekj("mat-button-toggle-standalone",!t.buttonToggleGroup)("mat-button-toggle-checked",t.checked)("mat-button-toggle-disabled",t.disabled)("mat-button-toggle-appearance-standard","standard"===t.appearance))},inputs:{disableRipple:"disableRipple",ariaLabelledby:["aria-labelledby","ariaLabelledby"],tabIndex:"tabIndex",appearance:"appearance",checked:"checked",disabled:"disabled",id:"id",name:"name",ariaLabel:["aria-label","ariaLabel"],value:"value"},outputs:{change:"change"},exportAs:["matButtonToggle"],features:[l.qOj],ngContentSelectors:g,decls:6,vars:9,consts:[["type","button",1,"mat-button-toggle-button","mat-focus-indicator",3,"id","disabled","click"],["button",""],[1,"mat-button-toggle-label-content"],[1,"mat-button-toggle-focus-overlay"],["matRipple","",1,"mat-button-toggle-ripple",3,"matRippleTrigger","matRippleDisabled"]],template:function(e,t){if(1&e&&(l.F$t(),l.TgZ(0,"button",0,1),l.NdJ("click",function(){return t._onButtonClick()}),l.TgZ(2,"span",2),l.Hsn(3),l.qZA(),l.qZA(),l._UZ(4,"span",3),l._UZ(5,"span",4)),2&e){const e=l.MAs(1);l.Q6J("id",t.buttonId)("disabled",t.disabled||null),l.uIk("tabindex",t.disabled?-1:t.tabIndex)("aria-pressed",t.checked)("name",t.name||null)("aria-label",t.ariaLabel)("aria-labelledby",t.ariaLabelledby),l.xp6(5),l.Q6J("matRippleTrigger",e)("matRippleDisabled",t.disableRipple||t.disabled)}},directives:[c.wG],styles:[".mat-button-toggle-standalone,.mat-button-toggle-group{position:relative;display:inline-flex;flex-direction:row;white-space:nowrap;overflow:hidden;border-radius:2px;-webkit-tap-highlight-color:transparent}.cdk-high-contrast-active .mat-button-toggle-standalone,.cdk-high-contrast-active .mat-button-toggle-group{outline:solid 1px}.mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.mat-button-toggle-group-appearance-standard{border-radius:4px}.cdk-high-contrast-active .mat-button-toggle-standalone.mat-button-toggle-appearance-standard,.cdk-high-contrast-active .mat-button-toggle-group-appearance-standard{outline:0}.mat-button-toggle-vertical{flex-direction:column}.mat-button-toggle-vertical .mat-button-toggle-label-content{display:block}.mat-button-toggle{white-space:nowrap;position:relative}.mat-button-toggle .mat-icon svg{vertical-align:top}.mat-button-toggle.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:1}.cdk-high-contrast-active .mat-button-toggle.cdk-keyboard-focused .mat-button-toggle-focus-overlay{opacity:.5}.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{opacity:.04}.mat-button-toggle-appearance-standard.cdk-keyboard-focused:not(.mat-button-toggle-disabled) .mat-button-toggle-focus-overlay{opacity:.12}.cdk-high-contrast-active .mat-button-toggle-appearance-standard.cdk-keyboard-focused:not(.mat-button-toggle-disabled) .mat-button-toggle-focus-overlay{opacity:.5}@media(hover: none){.mat-button-toggle-appearance-standard:not(.mat-button-toggle-disabled):hover .mat-button-toggle-focus-overlay{display:none}}.mat-button-toggle-label-content{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:inline-block;line-height:36px;padding:0 16px;position:relative}.mat-button-toggle-appearance-standard .mat-button-toggle-label-content{padding:0 12px}.mat-button-toggle-label-content>*{vertical-align:middle}.mat-button-toggle-focus-overlay{border-radius:inherit;pointer-events:none;opacity:0;top:0;left:0;right:0;bottom:0;position:absolute}.mat-button-toggle-checked .mat-button-toggle-focus-overlay{border-bottom:solid 36px}.cdk-high-contrast-active .mat-button-toggle-checked .mat-button-toggle-focus-overlay{opacity:.5;height:0}.cdk-high-contrast-active .mat-button-toggle-checked.mat-button-toggle-appearance-standard .mat-button-toggle-focus-overlay{border-bottom:solid 500px}.mat-button-toggle .mat-button-toggle-ripple{top:0;left:0;right:0;bottom:0;position:absolute;pointer-events:none}.mat-button-toggle-button{border:0;background:none;color:inherit;padding:0;margin:0;font:inherit;outline:none;width:100%;cursor:pointer}.mat-button-toggle-disabled .mat-button-toggle-button{cursor:default}.mat-button-toggle-button::-moz-focus-inner{border:0}\n"],encapsulation:2,changeDetection:0}),e})(),w=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({imports:[[c.BQ,c.si],c.BQ]}),e})();
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
var A=i(6898),T=i(4892),y=i(9676);let q=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["placeos-book"]],decls:5,vars:0,consts:[[1,"flex-1","flex","sm:flex-row","flex-col-reverse","h-1/2","z-10","relative"],[1,"relative","flex","flex-col","flex-1","h-1/2","sm:h-auto","overflow-hidden"]],template:function(e,t){1&e&&(l._UZ(0,"topbar"),l.TgZ(1,"div",0),l.TgZ(2,"main",1),l._UZ(3,"router-outlet"),l.qZA(),l.qZA(),l._UZ(4,"footer-menu"))},directives:[T.o,A.lC,y.i],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%}"]}),e})();class k{static hasCamera(){return k.listCameras(!1).then(e=>!!e.length).catch(()=>!1)}static listCameras(e=!1){if(!navigator.mediaDevices)return Promise.resolve([]);let t=null;return(e?navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(e=>t=e).catch(()=>{}):Promise.resolve()).then(()=>navigator.mediaDevices.enumerateDevices()).then(e=>e.filter(e=>"videoinput"===e.kind).map((e,t)=>({id:e.deviceId,label:e.label||(0===t?"Default Camera":`Camera ${t+1}`)}))).finally(()=>{if(t)for(const e of t.getTracks())e.stop(),t.removeTrack(e)})}constructor(e,t,n=this._onDecodeError,i=this._calculateScanRegion,o="environment"){this.$video=e,this.$canvas=document.createElement("canvas"),this._onDecode=t,this._legacyCanvasSize=k.DEFAULT_CANVAS_SIZE,this._preferredCamera=o,this._active=!1,this._paused=!1,this._flashOn=!1,"number"==typeof n?(this._legacyCanvasSize=n,console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in the future")):this._onDecodeError=n,"number"==typeof i?(this._legacyCanvasSize=i,console.warn("You're using a deprecated version of the QrScanner constructor which will be removed in the future")):this._calculateScanRegion=i,this._scanRegion=this._calculateScanRegion(e),this._onPlay=this._onPlay.bind(this),this._onLoadedMetaData=this._onLoadedMetaData.bind(this),this._onVisibilityChange=this._onVisibilityChange.bind(this),e.disablePictureInPicture=!0,e.playsInline=!0,e.muted=!0;let s=!1;e.hidden&&(e.hidden=!1,s=!0),document.body.contains(e)||(document.body.appendChild(e),s=!0),requestAnimationFrame(()=>{const t=window.getComputedStyle(e);"none"===t.display&&(e.style.setProperty("display","block","important"),s=!0),"visible"!==t.visibility&&(e.style.setProperty("visibility","visible","important"),s=!0),s&&(console.warn("QrScanner has overwritten the video hiding style to avoid Safari stopping the playback."),e.style.opacity=0,e.style.width=0,e.style.height=0)}),e.addEventListener("play",this._onPlay),e.addEventListener("loadedmetadata",this._onLoadedMetaData),document.addEventListener("visibilitychange",this._onVisibilityChange),this._qrEnginePromise=k.createQrEngine()}hasFlash(){let e=null;return(this.$video.srcObject?Promise.resolve(this.$video.srcObject.getVideoTracks()[0]):this._getCameraStream().then(({stream:t})=>(console.warn("Call hasFlash after successfully starting the scanner to avoid creating a temporary video stream"),e=t,t.getVideoTracks()[0]))).then(e=>"torch"in e.getSettings()).catch(()=>!1).finally(()=>{if(e)for(const t of e.getTracks())t.stop(),e.removeTrack(t)})}isFlashOn(){return this._flashOn}toggleFlash(){return this._flashOn?this.turnFlashOff():this.turnFlashOn()}turnFlashOn(){return this._flashOn?Promise.resolve():(this._flashOn=!0,!this._active||this._paused?Promise.resolve():this.hasFlash().then(e=>e?this.$video.srcObject.getVideoTracks()[0].applyConstraints({advanced:[{torch:!0}]}):Promise.reject("No flash available")).catch(()=>{throw this._flashOn=!1,e}))}turnFlashOff(){if(this._flashOn)return this._flashOn=!1,this._restartVideoStream()}destroy(){this.$video.removeEventListener("loadedmetadata",this._onLoadedMetaData),this.$video.removeEventListener("play",this._onPlay),document.removeEventListener("visibilitychange",this._onVisibilityChange),this.stop(),k._postWorkerMessage(this._qrEnginePromise,"close")}start(){return this._active&&!this._paused?Promise.resolve():("https:"!==window.location.protocol&&console.warn("The camera stream is only accessible if the page is transferred via https."),this._active=!0,document.hidden?Promise.resolve():(this._paused=!1,this.$video.srcObject?(this.$video.play(),Promise.resolve()):this._getCameraStream().then(({stream:e,facingMode:t})=>{this.$video.srcObject=e,this.$video.play(),this._setVideoMirror(t),this._flashOn&&(this._flashOn=!1,this.turnFlashOn().catch(()=>{}))}).catch(e=>{throw this._active=!1,e})))}stop(){this.pause(),this._active=!1}pause(e=!1){if(this._paused=!0,!this._active)return Promise.resolve(!0);this.$video.pause();const t=()=>{const e=this.$video.srcObject?this.$video.srcObject.getTracks():[];for(const t of e)t.stop(),this.$video.srcObject.removeTrack(t);this.$video.srcObject=null};return e?(t(),Promise.resolve(!0)):new Promise(e=>setTimeout(e,300)).then(()=>!!this._paused&&(t(),!0))}setCamera(e){return e===this._preferredCamera?Promise.resolve():(this._preferredCamera=e,this._restartVideoStream())}static scanImage(e,t=null,n=null,i=null,o=!1,s=!1){const a=n instanceof Worker;let r=Promise.all([n||k.createQrEngine(),k._loadImage(e)]).then(([e,s])=>{let r;return n=e,[i,r]=this._drawToCanvas(s,t,i,o),n instanceof Worker?(a||n.postMessage({type:"inversionMode",data:"both"}),new Promise((e,t)=>{let o,s,a;s=i=>{"qrResult"===i.data.type&&(n.removeEventListener("message",s),n.removeEventListener("error",a),clearTimeout(o),null!==i.data.data?e(i.data.data):t(k.NO_QR_CODE_FOUND))},a=e=>{n.removeEventListener("message",s),n.removeEventListener("error",a),clearTimeout(o),t("Scanner error: "+(e?e.message||e:"Unknown Error"))},n.addEventListener("message",s),n.addEventListener("error",a),o=setTimeout(()=>a("timeout"),1e4);const l=r.getImageData(0,0,i.width,i.height);n.postMessage({type:"decode",data:l},[l.data.buffer])})):new Promise((e,t)=>{const o=setTimeout(()=>t("Scanner error: timeout"),1e4);n.detect(i).then(n=>{n.length?e(n[0].rawValue):t(k.NO_QR_CODE_FOUND)}).catch(e=>t("Scanner error: "+(e.message||e))).finally(()=>clearTimeout(o))})});return t&&s&&(r=r.catch(()=>k.scanImage(e,null,n,i,o))),r=r.finally(()=>{a||k._postWorkerMessage(n,"close")}),r}setGrayscaleWeights(e,t,n,i=!0){k._postWorkerMessage(this._qrEnginePromise,"grayscaleWeights",{red:e,green:t,blue:n,useIntegerApproximation:i})}setInversionMode(e){k._postWorkerMessage(this._qrEnginePromise,"inversionMode",e)}static createQrEngine(e=k.WORKER_PATH){return("BarcodeDetector"in window&&BarcodeDetector.getSupportedFormats?BarcodeDetector.getSupportedFormats():Promise.resolve([])).then(t=>-1!==t.indexOf("qr_code")?new BarcodeDetector({formats:["qr_code"]}):new Worker(e))}_onPlay(){this._scanRegion=this._calculateScanRegion(this.$video),this._scanFrame()}_onLoadedMetaData(){this._scanRegion=this._calculateScanRegion(this.$video)}_onVisibilityChange(){document.hidden?this.pause():this._active&&this.start()}_calculateScanRegion(e){const t=Math.min(e.videoWidth,e.videoHeight),n=Math.round(2/3*t);return{x:Math.round((e.videoWidth-n)/2),y:Math.round((e.videoHeight-n)/2),width:n,height:n,downScaledWidth:this._legacyCanvasSize,downScaledHeight:this._legacyCanvasSize}}_scanFrame(){if(!this._active||this.$video.paused||this.$video.ended)return!1;requestAnimationFrame(()=>{this.$video.readyState<=1?this._scanFrame():this._qrEnginePromise.then(e=>k.scanImage(this.$video,this._scanRegion,e,this.$canvas)).then(this._onDecode,e=>{this._active&&(-1!==(e.message||e).indexOf("service unavailable")&&(this._qrEnginePromise=k.createQrEngine()),this._onDecodeError(e))}).then(()=>this._scanFrame())})}_onDecodeError(e){e!==k.NO_QR_CODE_FOUND&&console.log(e)}_getCameraStream(){if(!navigator.mediaDevices)return Promise.reject("Camera not found.");const e="environment"===this._preferredCamera||"user"===this._preferredCamera?"facingMode":"deviceId",t=[{width:{min:1024}},{width:{min:768}},{}];return[...t.map(t=>Object.assign({},t,{[e]:{exact:this._preferredCamera}})),...t].reduceRight((e,t)=>()=>navigator.mediaDevices.getUserMedia({video:t,audio:!1}).then(e=>({stream:e,facingMode:this._getFacingMode(e)||(t.facingMode?this._preferredCamera:"environment"===this._preferredCamera?"user":"environment")})).catch(e),()=>Promise.reject("Camera not found."))()}_restartVideoStream(){const e=this._paused;return this.pause(!0).then(t=>{if(t&&!e&&this._active)return this.start()})}_setVideoMirror(e){this.$video.style.transform="scaleX("+("user"===e?-1:1)+")"}_getFacingMode(e){const t=e.getVideoTracks()[0];return t?/rear|back|environment/i.test(t.label)?"environment":/front|user|face/i.test(t.label)?"user":null:null}static _drawToCanvas(e,t=null,n=null,i=!1){n=n||document.createElement("canvas");const o=t&&t.x?t.x:0,s=t&&t.y?t.y:0,a=t&&t.width?t.width:e.width||e.videoWidth,r=t&&t.height?t.height:e.height||e.videoHeight;if(!i){const e=t&&t.downScaledWidth?t.downScaledWidth:a,i=t&&t.downScaledHeight?t.downScaledHeight:r;n.width!==e&&(n.width=e),n.height!==i&&(n.height=i)}const l=n.getContext("2d",{alpha:!1});return l.imageSmoothingEnabled=!1,l.drawImage(e,o,s,a,r,0,0,n.width,n.height),[n,l]}static _loadImage(e){if(e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||window.ImageBitmap&&e instanceof window.ImageBitmap||window.OffscreenCanvas&&e instanceof window.OffscreenCanvas)return Promise.resolve(e);if(e instanceof Image)return k._awaitImageLoad(e).then(()=>e);if(e instanceof File||e instanceof Blob||e instanceof URL||"string"==typeof e){const t=new Image;return t.src=e instanceof File||e instanceof Blob?URL.createObjectURL(e):e,k._awaitImageLoad(t).then(()=>((e instanceof File||e instanceof Blob)&&URL.revokeObjectURL(t.src),t))}return Promise.reject("Unsupported image type.")}static _awaitImageLoad(e){return new Promise((t,n)=>{if(e.complete&&0!==e.naturalWidth)t();else{let i,o;i=()=>{e.removeEventListener("load",i),e.removeEventListener("error",o),t()},o=()=>{e.removeEventListener("load",i),e.removeEventListener("error",o),n("Image load error")},e.addEventListener("load",i),e.addEventListener("error",o)}})}static _postWorkerMessage(e,t,n){return Promise.resolve(e).then(e=>{e instanceof Worker&&e.postMessage({type:t,data:n})})}}k.DEFAULT_CANVAS_SIZE=400,k.NO_QR_CODE_FOUND="No QR code found",k.WORKER_PATH="qr-scanner-worker.min.js";var M=i(6756),O=i(5980);const C=["video"];function U(e,t){1&e&&(l.TgZ(0,"div",11),l.TgZ(1,"h2",12),l._uU(2," Scan QR Code "),l.qZA(),l.TgZ(3,"span",13),l._uU(4," Scan the QR code outisde a PlaceOS room or space. "),l.qZA(),l.qZA())}function J(e,t){1&e&&(l.TgZ(0,"div",11),l.TgZ(1,"h2",12),l._uU(2," Enter Room ID "),l.qZA(),l.TgZ(3,"span",13),l._uU(4," Enter the room ID number outisde a PlaceOS room or space. "),l.qZA(),l.qZA())}let I=(()=>{class e{constructor(e){this._router=e,this.is_scanning=!0,this.menu=new l.vpe(!1)}ngOnDestroy(){var e;this._video_el.nativeElement.srcObject&&this._video_el.nativeElement.srcObject.getTracks().forEach(e=>null==e?void 0:e.stop()),null===(e=this._qr_scanner)||void 0===e||e.stop()}ngOnInit(){var e;(null===(e=navigator.mediaDevices)||void 0===e?void 0:e.getUserMedia)&&(navigator.mediaDevices.getUserMedia({video:!0}).then(e=>this._video_el.nativeElement.srcObject=e).catch(e=>console.error("Unable to fetch media devices!",e)),this._qr_scanner=new k(this._video_el.nativeElement,e=>this.handleQrCode(e)),this._qr_scanner.start())}handleQrCode(e){const t=e;if(t.indexOf("/#/")>0){const e=/[?&]([^=#]+)=([^&#]*)/g,n={};let i;for(;i=e.exec(t);)n[i[1]]=i[2];this._router.navigate([t.split("/#")[1].split("?")[0]],n)}}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(A.F0))},e.\u0275cmp=l.Xpm({type:e,selectors:[["book-code-flow"]],viewQuery:function(e,t){if(1&e&&l.Gf(C,7),2&e){let e;l.iGM(e=l.CRH())&&(t._video_el=e.first)}},outputs:{menu:"menu"},decls:16,vars:9,consts:[[1,"flex-1","overflow-hidden","flex","items-center","justify-center","bg-black","relative"],["id","video",1,"min-w-full","min-h-full","object-cover"],["video",""],[1,"absolute","text-white","text-center","inset-0","flex","flex-col","items-center","justify-center"],["class","flex flex-col z-10 justify-end items-center relative",4,"ngIf"],[1,"flex","items-center","justify-center"],["box","",1,"rounded-2xl","h-64","w-64","transition-all","flex","items-center","justify-center","p-8","m-8","space-x-2"],[1,"uppercase"],["matInput","","name","booking-id","placeholder","e.g. 12102910",1,"border-none","bg-none","w-full","text-3xl","text-left",3,"ngModel","ngModelChange"],[1,"m-4","p-2","flex","items-center","space-x-2","bg-white","bg-opacity-50","rounded"],["mat-button","",3,"click"],[1,"flex","flex-col","z-10","justify-end","items-center","relative"],[1,"text-3xl","mb-1","uppercase","subpixel-antialiased"],[1,"mb-4"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l._UZ(1,"video",1,2),l.TgZ(3,"div",3),l.YNc(4,U,5,0,"div",4),l.YNc(5,J,5,0,"div",4),l.TgZ(6,"div",5),l.TgZ(7,"div",6),l.TgZ(8,"span",7),l._uU(9,"Booking ID"),l.qZA(),l.TgZ(10,"input",8),l.NdJ("ngModelChange",function(e){return t.room_code=e}),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"div",9),l.TgZ(12,"button",10),l.NdJ("click",function(){return t.is_scanning=!0}),l._uU(13," Scan Code "),l.qZA(),l.TgZ(14,"button",10),l.NdJ("click",function(){return t.is_scanning=!1}),l._uU(15," Enter Code "),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&e&&(l.xp6(4),l.Q6J("ngIf",t.is_scanning),l.xp6(1),l.Q6J("ngIf",!t.is_scanning),l.xp6(2),l.ekj("input",!t.is_scanning),l.xp6(3),l.Q6J("ngModel",t.room_code),l.xp6(2),l.Tol("flex-1 text-black border-none w-40 "+(t.is_scanning?"bg-white":"bg-transparent hover:bg-white bg-opacity-50")),l.xp6(2),l.Tol("flex-1 text-black border-none w-40 "+(t.is_scanning?"bg-transparent hover:bg-white bg-opacity-50":"bg-white")))},directives:[o.O5,M.Nt,s.Fj,s.JJ,s.On,O.lW],styles:["[_nghost-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:column}[box][_ngcontent-%COMP%]{box-shadow:0 0 0 100vw rgba(0,0,0,.5)}[box][_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{display:none}[box].input[_ngcontent-%COMP%]{width:32rem!important;max-width:calc(100% - 2rem)!important;padding:1rem!important;height:4rem!important;color:#000!important;background:#fff;box-shadow:0 0 0 100vw rgba(0,0,0,.8)}[box].input[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{display:initial}[box][_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-family:var(--heading-font);font-weight:500;text-transform:uppercase;letter-spacing:.05em}"]}),e})();var N=i(4762),Q=i(3730),F=i(3530),j=i(1663),E=i(1496),P=i(4441),Y=i(3080),L=i(8512),S=i(6238),D=i(9996),$=i(7701),B=i(859),G=i(1548),H=i(1924),V=i(8055),R=i(8125),z=i(3848),W=i(6762),X=i(6283),K=i(4786),ee=i(5089),te=i(9980),ne=i(3881),ie=i(2222);const oe=function(){return{standalone:!0}};function se(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",10),l.TgZ(1,"mat-button-toggle-group",11),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw(2).setOptions({group:"group"===t})}),l.ALo(2,"async"),l.TgZ(3,"mat-button-toggle",12),l._uU(4," Single "),l.qZA(),l.TgZ(5,"mat-button-toggle",13),l._uU(6," Group "),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw(2);let t;l.xp6(1),l.Q6J("ngModel",null!=(t=l.lcZ(2,2,e.options))&&t.group?"group":"single")("ngModelOptions",l.DdM(4,oe))}}function ae(e,t){if(1&e&&(l.TgZ(0,"mat-option",17),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e.display_name||e.name," ")}}function re(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",4),l.TgZ(1,"label"),l._uU(2,"Building"),l.qZA(),l.TgZ(3,"mat-form-field",14),l.TgZ(4,"mat-select",15),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw(2).building=t})("ngModelChange",function(t){return l.CHM(e),l.oxw(2).setOptions({zone_id:null==t?null:t.id})}),l.YNc(5,ae,2,2,"mat-option",16),l.ALo(6,"async"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw(2);l.xp6(4),l.Q6J("ngModel",e.building)("ngModelOptions",l.DdM(5,oe)),l.xp6(1),l.Q6J("ngForOf",l.lcZ(6,3,e.buildings))}}function le(e,t){if(1&e&&(l.TgZ(0,"mat-option",17),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e.id),l.xp6(1),l.hij(" ",e.display_name||e.name," ")}}function ce(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",4),l.TgZ(1,"label"),l._uU(2,"Level"),l.qZA(),l.TgZ(3,"mat-form-field",14),l.TgZ(4,"mat-select",18),l.NdJ("ngModelChange",function(t){l.CHM(e);const n=l.oxw(2);return n.setOptions({zone_id:t||n.building.id})}),l.YNc(5,le,2,2,"mat-option",16),l.ALo(6,"async"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw(2);l.xp6(4),l.Q6J("disabled",!e.building)("ngModelOptions",l.DdM(5,oe)),l.xp6(1),l.Q6J("ngForOf",l.lcZ(6,3,e.levels))}}function ue(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",3),l.TgZ(1,"div",19),l.TgZ(2,"label"),l._uU(3,"Start Time"),l.qZA(),l.TgZ(4,"a-time-field",20),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw(2).form.patchValue({date:t})}),l.qZA(),l.qZA(),l.TgZ(5,"div",19),l.TgZ(6,"label"),l._uU(7,"End Time"),l.qZA(),l._UZ(8,"a-duration-field",21),l.qZA(),l.qZA()}if(2&e){const e=l.oxw(2);let t;l.xp6(4),l.Q6J("ngModel",e.form.value.date)("ngModelOptions",l.DdM(6,oe)),l.xp6(4),l.Q6J("time",null==(t=e.form.get("date"))?null:t.value)("max",720)("min",60)("step",60)}}function de(e,t){1&e&&(l.TgZ(0,"div",22),l.TgZ(1,"label"),l._uU(2,"Host"),l.qZA(),l._UZ(3,"a-user-search-field",23),l.qZA())}function ge(e,t){1&e&&(l.TgZ(0,"div",24),l.TgZ(1,"label"),l._uU(2,"Details"),l.qZA(),l.TgZ(3,"mat-form-field",25),l._UZ(4,"input",26),l.qZA(),l.qZA())}const pe=function(){return[]};function me(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",24),l.TgZ(1,"label"),l._uU(2,"Group Members"),l.qZA(),l.TgZ(3,"a-user-list-field",27),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw(2).setOptions({members:t})}),l.ALo(4,"async"),l.qZA(),l.qZA()}if(2&e){const e=l.oxw(2);let t;l.xp6(3),l.Q6J("simple",!0)("ngModel",(null==(t=l.lcZ(4,3,e.options))?null:t.members)||l.DdM(5,pe))("ngModelOptions",l.DdM(6,oe))}}function fe(e,t){if(1&e&&(l.TgZ(0,"mat-option",17),l.TgZ(1,"span",31),l._uU(2),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(2),l.Oqu(e)}}function he(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",3),l.TgZ(1,"div",19),l.TgZ(2,"label"),l._uU(3,"Recurrence Period"),l.qZA(),l.TgZ(4,"mat-form-field",14),l.TgZ(5,"mat-select",28),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw(2).setOptions({pattern:t})}),l.ALo(6,"async"),l.TgZ(7,"mat-option",29),l._uU(8,"None"),l.qZA(),l.YNc(9,fe,3,2,"mat-option",16),l.qZA(),l.qZA(),l.qZA(),l.TgZ(10,"div",19),l.TgZ(11,"label"),l._uU(12,"Recurrence End"),l.qZA(),l.TgZ(13,"a-date-field",30),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw(2).setOptions({recurr_end:t})}),l.ALo(14,"async"),l.ALo(15,"async"),l.ALo(16,"async"),l._uU(17," Date and time must be in the future "),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw(2);let t,n,i;l.xp6(5),l.Q6J("ngModel",null==(t=l.lcZ(6,7,e.options))?null:t.recurrence_pattern)("ngModelOptions",l.DdM(15,oe)),l.xp6(4),l.Q6J("ngForOf",e.recurrence_options),l.xp6(4),l.Q6J("disabled",!(null!=(n=l.lcZ(14,9,e.options))&&n.pattern)||"none"===(null==(n=l.lcZ(15,11,e.options))?null:n.pattern))("ngModel",(null==(i=l.lcZ(16,13,e.options))?null:i.recurr_end)||(null==e.form||null==e.form.value?null:e.form.value.date))("ngModelOptions",l.DdM(16,oe))("to",e.book_until)}}function _e(e,t){if(1&e&&(l.TgZ(0,"mat-option",34),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e," ")}}function ve(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",24),l.TgZ(1,"label"),l._uU(2,"Desk Features"),l.qZA(),l.TgZ(3,"mat-form-field",25),l.TgZ(4,"mat-select",32),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw(2).setOptions({features:t||[]})}),l.ALo(5,"async"),l.YNc(6,_e,2,2,"mat-option",33),l.ALo(7,"async"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw(2);let t;l.xp6(4),l.Q6J("ngModel",(null==(t=l.lcZ(5,3,e.options))?null:t.features)||l.DdM(7,pe))("ngModelOptions",l.DdM(8,oe)),l.xp6(2),l.Q6J("ngForOf",l.lcZ(7,5,e.features))}}function Ze(e,t){if(1&e&&(l.TgZ(0,"form",1),l.YNc(1,se,7,5,"div",2),l.TgZ(2,"div",3),l.TgZ(3,"div",4),l.TgZ(4,"label"),l._uU(5,"Date"),l.qZA(),l.TgZ(6,"a-date-field",5),l._uU(7," Date and time must be in the future "),l.qZA(),l.qZA(),l.YNc(8,re,7,6,"div",6),l.ALo(9,"async"),l.YNc(10,ce,7,6,"div",6),l.ALo(11,"async"),l.qZA(),l.YNc(12,ue,9,7,"div",7),l.YNc(13,de,4,0,"div",8),l.YNc(14,ge,5,0,"div",9),l.YNc(15,me,5,7,"div",9),l.ALo(16,"async"),l.YNc(17,he,18,17,"div",7),l.YNc(18,ve,8,9,"div",9),l.ALo(19,"async"),l.qZA()),2&e){const e=l.oxw();let t,n,i,o;l.Q6J("formGroup",e.form),l.xp6(1),l.Q6J("ngIf",e.allow_groups),l.xp6(5),l.Q6J("to",e.book_until),l.xp6(2),l.Q6J("ngIf",(null==(t=l.lcZ(9,11,e.buildings))?null:t.length)>1),l.xp6(2),l.Q6J("ngIf",(null==(n=l.lcZ(11,13,e.levels))?null:n.length)>1),l.xp6(2),l.Q6J("ngIf",e.allow_time_changes),l.xp6(1),l.Q6J("ngIf",e.can_book_for_others),l.xp6(1),l.Q6J("ngIf",e.needs_reason),l.xp6(1),l.Q6J("ngIf",null==(i=l.lcZ(16,15,e.options))?null:i.group),l.xp6(2),l.Q6J("ngIf",e.can_recurr),l.xp6(1),l.Q6J("ngIf",null==(o=l.lcZ(19,17,e.features))?null:o.length)}}let be=(()=>{class e{constructor(e,t,n){this._state=e,this._org=t,this._settings=n,this.buildings=this._org.building_list,this.levels=this._org.active_levels,this.options=this._state.options,this.features=this._state.features,this.recurrence_options=["daily","weekly","monthly"],this.setOptions=e=>this._state.setOptions(e)}get building(){return this._org.building}set building(e){this._org.building=e}get can_book_for_others(){return this._settings.get("app.desks.can_book_for_others")}get can_recurr(){return this._settings.get("app.desks.recurrence_allowed")}get allow_groups(){return this._settings.get("app.desks.allow_groups")}get needs_reason(){return!0===this._settings.get("app.desks.needs_reason")}get allow_time_changes(){return!!this._settings.get("app.desks.allow_time_changes")}get book_until(){return(0,R.Z)((0,z.Z)(Date.now(),this._settings.get("app.desks.available_period")||90))}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(j.fy),l.Y36(E.w7),l.Y36(Q.gb))},e.\u0275cmp=l.Xpm({type:e,selectors:[["detailed-book-desks-form"]],inputs:{form:"form"},decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],["class","w-[640px] max-w-[calc(100%-2rem)] mx-auto mb-4",4,"ngIf"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/4"],["formControlName","date",3,"to"],["class","flex flex-col flex-1 w-full sm:w-1/4",4,"ngIf"],["class","flex flex-col sm:flex-row space-x-0 sm:space-x-2 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],["class","flex flex-col w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],["class","flex flex-col flex-1 w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"w-[640px]","max-w-[calc(100%-2rem)]","mx-auto","mb-4"],[1,"w-full",3,"ngModel","ngModelOptions","ngModelChange"],["value","single",1,"w-1/2"],["value","group",1,"w-1/2"],["appearance","outline"],["placeholder","Select building",3,"ngModel","ngModelOptions","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["placeholder","Any Level","ngModel","",3,"disabled","ngModelOptions","ngModelChange"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],[3,"ngModel","ngModelOptions","ngModelChange"],["formControlName","duration",3,"time","max","min","step"],[1,"flex","flex-col","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],["formControlName","user"],[1,"flex","flex-col","flex-1","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],["appearance","outline",1,"w-full"],["matInput","","formControlName","description","placeholder","Reason for booking..."],[3,"simple","ngModel","ngModelOptions","ngModelChange"],["placeholder","None",3,"ngModel","ngModelOptions","ngModelChange"],["value","none"],[3,"disabled","ngModel","ngModelOptions","to","ngModelChange"],[1,"capitalize"],["multiple","","placeholder","Any Feature",3,"ngModel","ngModelOptions","ngModelChange"],["class","capitalize",3,"value",4,"ngFor","ngForOf"],[1,"capitalize",3,"value"]],template:function(e,t){1&e&&l.YNc(0,Ze,20,19,"form",0),2&e&&l.Q6J("ngIf",t.form)},directives:[o.O5,s._Y,s.JL,s.sg,W.Q,s.JJ,s.u,v,s.On,x,X.KE,K.gD,o.sg,c.ey,ee.N,te.B,ne.d,M.Nt,s.Fj,ie.E],pipes:[o.Ov],styles:[""]}),e})();var xe=i(7256),we=i(7806);function Ae(e,t){if(1&e&&(l.TgZ(0,"div",27),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.xp6(1),l.hij(" ",e," ")}}const Te=function(){return[]};function ye(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"li",20),l.NdJ("click",function(){const t=l.CHM(e).$implicit;return l.oxw().setActiveDesk(t)}),l.TgZ(1,"app-icon",21),l._uU(2,"place"),l.qZA(),l.TgZ(3,"div",22),l.TgZ(4,"div",23),l._uU(5),l.qZA(),l.TgZ(6,"div",24),l._uU(7),l.qZA(),l.TgZ(8,"div",25),l.YNc(9,Ae,2,1,"div",26),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit,n=l.oxw();l.ekj("border-primary",(null==n.active_desk?null:n.active_desk.id)===e.id),l.uIk("desk-id",e.id),l.xp6(5),l.Oqu(e.name||e.id),l.xp6(2),l.hij(" ",(null==e.zone?null:e.zone.display_name)||(null==e.zone?null:e.zone.name)||"<No Level>"," "),l.xp6(2),l.Q6J("ngForOf",e.features||l.DdM(6,Te))}}function qe(e,t){if(1&e&&(l.TgZ(0,"div",28),l._uU(1),l.ALo(2,"async"),l.ALo(3,"async"),l.qZA()),2&e){const e=l.oxw();let t;l.xp6(1),l.hij(" ",(null==(t=l.lcZ(2,1,e.level))?null:t.display_name)||(null==(t=l.lcZ(3,3,e.level))?null:t.name)," ")}}function ke(e,t){if(1&e&&(l.TgZ(0,"div",29),l._UZ(1,"mat-spinner",30),l.TgZ(2,"p"),l._uU(3),l.ALo(4,"async"),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(1),l.Q6J("diameter",32),l.xp6(2),l.Oqu(l.lcZ(4,2,e.loading))}}function Me(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",31),l.TgZ(1,"div",32),l.TgZ(2,"div",23),l._uU(3),l.qZA(),l.TgZ(4,"div",24),l._uU(5),l.qZA(),l.qZA(),l.TgZ(6,"div",33),l.TgZ(7,"button",34),l.NdJ("click",function(){return l.CHM(e),l.oxw().setActiveDesk(null)}),l._uU(8," Clear "),l.qZA(),l.TgZ(9,"button",35),l.NdJ("click",function(){return l.CHM(e),l.oxw().makeBooking()}),l._uU(10," Book "),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.xp6(3),l.Oqu(e.active_desk.name),l.xp6(2),l.hij(" ",(null==e.active_desk.zone?null:e.active_desk.zone.display_name)||e.active_desk.zone.name||"<No Level>"," ")}}const Oe=function(){return["/book","desks","form"]};let Ce=(()=>{class e extends Q.KG{constructor(e,t){super(),this._state=e,this._explore=t,this.url=this._explore.map_url,this.styles=this._explore.map_styles,this.positions=this._explore.map_positions,this.features=this._explore.map_features,this.actions=this._explore.map_actions,this.labels=this._explore.map_labels,this.level=this._explore.level,this.desks=this._state.available_assets,this.loading=this._state.loading,this.form=this._state.form,this.option_details=(0,Y.aj)([this._state.options,this.form.valueChanges.pipe((0,S.O)({}))]).pipe((0,D.U)(([e])=>{var t,n;const i=this._state.form,o=(0,Q.IO)({pattern:e.pattern,end:e.recurr_end,start:i.value.date,interval:1,days_of_week:-1}),s=`${(0,P.Z)(i.value.date,"dd MMM yyyy")}${e.pattern&&"none"!==e.pattern?", "+o:""}${e.group?", "+e.group:""}, ${(null===(t=e.features)||void 0===t?void 0:t.length)||"Any"} Feature${((null===(n=e.features)||void 0===n?void 0:n.length)||0)<2?"":"s"}`;return e.zone_id&&this._explore.setLevel(e.zone_id),s})),this._active_desk=new L.X(null),this.makeBooking=()=>this._state.confirmPost()}get active_desk(){return this._active_desk.getValue()}ngOnInit(){this.subscription("assets-statue",(0,Y.aj)([this._state.assets,this._state.available_assets,this._active_desk]).pipe((0,$.b)(200)).subscribe(([e,t])=>{const n={},i=[];for(const o of e){const e=o.bookable&&t.find(e=>e.id===o.id);n[`#${o.map_id||o.id}`]={fill:o.bookable?t.find(e=>e.id===o.id)?"#43a047":"#e53935":"#999",opacity:.6},e&&i.push({id:o.map_id||o.id,action:"click",callback:()=>this.setActiveDesk(o)})}this._explore.setStyles("desks",n),this._explore.setActions("desks",i),this._explore.setFeatures("desks",this.active_desk?[{location:this.active_desk.map_id||this.active_desk.id,content:'\n                    <span class="flex h-2 w-2 rounded-full absolute top-1/4 left-1/4 transform -translate-x-1/2 -translate-y-1/2" >\n                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>\n                        <span class="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>\n                    </span>'}]:[])}))}setActiveDesk(e){var t,n,i;this._explore.setLevel(null===(t=null==e?void 0:e.zone)||void 0===t?void 0:t.id),this._active_desk.next(e),this._state.form.patchValue({asset_id:null==e?void 0:e.id,asset_name:e.name,map_id:(null==e?void 0:e.map_id)||(null==e?void 0:e.id),description:e.name,booking_type:"desk",zones:e.zone?[null===(n=e.zone)||void 0===n?void 0:n.parent_id,null===(i=e.zone)||void 0===i?void 0:i.id]:[]})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(j.fy),l.Y36(B.ck))},e.\u0275cmp=l.Xpm({type:e,selectors:[["desk-flow-map"]],features:[l.qOj],decls:38,vars:42,consts:[["topbar","",1,""],["button","","mat-button","",1,"clear","h-[2.75rem]","text-white",3,"routerLink"],[1,"flex","items-center","justify-center","h-full"],[1,"text-xl"],[1,"ml-2","mx-4"],[1,"flex","flex-col","flex-1","h-1/2","w-full"],[1,"text-2xl","px-4","pt-4","text-center"],[1,"my-4","mx-auto","w-[640px]","max-w-[calc(100vw-2rem)]",3,"matMenuTriggerFor"],["menu","matMenu"],[1,"pt-4","max-h-[65vh]","overflow-auto",3,"click"],[3,"form"],["listing","",1,"flex","flex-1","h-1/2","relative","space-x-2"],[1,"list-style-none","w-full","sm:w-[20rem]","bg-gray-100","p-2","pb-32","overflow-auto","h-full","rounded-tr-lg","space-y-2"],[1,"px-2","sticky","top-0","bg-gray-100","w-full","z-10"],["matRipple","","class","flex items-center p-2 bg-white rounded shadow cursor-pointer space-x-2 min-h-[5rem] border",3,"border-primary","click",4,"ngFor","ngForOf"],[1,"hidden","sm:block","flex-1","bg-gray-200","rounded-tl-lg","border-l","border-t","border-gray-300","relative","overflow-hidden","h-full"],[3,"src","zoom","center","styles","features","actions","labels","focus"],["class","absolute top-2 left-2 bg-white rounded-3xl h-10 px-3 flex items-center border border-gray-300",4,"ngIf"],["class","absolute inset-0 bg-white bg-opacity-60 flex flex-col items-center justify-center space-y-2 !m-0 z-20",4,"ngIf"],["selection","","class","absolute bottom-2 left-1/2 transform -translate-x-1/2 p-2 bg-white shadow rounded w-[24rem] max-w-[calc(100vw-1rem)] space-y-2 !m-0 border border-gray-200",4,"ngIf"],["matRipple","",1,"flex","items-center","p-2","bg-white","rounded","shadow","cursor-pointer","space-x-2","min-h-[5rem]","border",3,"click"],[1,"text-2xl"],[1,"flex","flex-col","w-1/2","flex-1"],["name","",1,""],["level","",1,"text-xs"],["features","",1,"w-full","flex","flex-wrap"],["class","text-xs bg-primary text-white rounded-xl px-2 py-1 mt-1 mr-2",4,"ngFor","ngForOf"],[1,"text-xs","bg-primary","text-white","rounded-xl","px-2","py-1","mt-1","mr-2"],[1,"absolute","top-2","left-2","bg-white","rounded-3xl","h-10","px-3","flex","items-center","border","border-gray-300"],[1,"absolute","inset-0","bg-white","bg-opacity-60","flex","flex-col","items-center","justify-center","space-y-2","!m-0","z-20"],[3,"diameter"],["selection","",1,"absolute","bottom-2","left-1/2","transform","-translate-x-1/2","p-2","bg-white","shadow","rounded","w-[24rem]","max-w-[calc(100vw-1rem)]","space-y-2","!m-0","border","border-gray-200"],[1,""],[1,"flex","items-center","space-x-2"],["mat-button","",1,"inverse","flex-1",3,"click"],["mat-button","",1,"flex-1",3,"click"]],template:function(e,t){if(1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"a",1),l.TgZ(2,"div",2),l.TgZ(3,"app-icon",3),l._uU(4,"arrow_back"),l.qZA(),l.TgZ(5,"span",4),l._uU(6,"Back"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(7,"div",5),l.TgZ(8,"h2",6),l._uU(9,"Available Desks"),l.qZA(),l.TgZ(10,"an-action-field",7),l._uU(11),l.ALo(12,"async"),l.qZA(),l.TgZ(13,"mat-menu",null,8),l.TgZ(15,"div",9),l.NdJ("click",function(e){return e.stopPropagation(),e.preventDefault}),l._UZ(16,"detailed-book-desks-form",10),l.qZA(),l.qZA(),l.TgZ(17,"div",11),l.TgZ(18,"ul",12),l.TgZ(19,"div",13),l._uU(20),l.ALo(21,"async"),l.qZA(),l.YNc(22,ye,10,7,"li",14),l.ALo(23,"async"),l.qZA(),l.TgZ(24,"div",15),l._UZ(25,"i-map",16),l.ALo(26,"async"),l.ALo(27,"async"),l.ALo(28,"async"),l.ALo(29,"async"),l.ALo(30,"async"),l.ALo(31,"async"),l.ALo(32,"async"),l.YNc(33,qe,4,5,"div",17),l.ALo(34,"async"),l.qZA(),l.YNc(35,ke,5,4,"div",18),l.ALo(36,"async"),l.YNc(37,Me,11,2,"div",19),l.qZA(),l.qZA()),2&e){const e=l.MAs(14);let n,i,o;l.xp6(1),l.Q6J("routerLink",l.DdM(41,Oe)),l.xp6(9),l.Q6J("matMenuTriggerFor",e),l.xp6(1),l.hij(" ",l.lcZ(12,17,t.option_details)||"No Filters"," "),l.xp6(5),l.Q6J("form",t.form),l.xp6(4),l.hij(" ",(null==(n=l.lcZ(21,19,t.desks))?null:n.length)||"0"," matches available "),l.xp6(2),l.Q6J("ngForOf",l.lcZ(23,21,t.desks)),l.xp6(3),l.Q6J("src",l.lcZ(26,23,t.url))("zoom",null==(i=l.lcZ(27,25,t.positions))?null:i.zoom)("center",null==(o=l.lcZ(28,27,t.positions))?null:o.center)("styles",l.lcZ(29,29,t.styles))("features",l.lcZ(30,31,t.features))("actions",l.lcZ(31,33,t.actions))("labels",l.lcZ(32,35,t.labels))("focus",(null==t.active_desk?null:t.active_desk.map_id)||(null==t.active_desk?null:t.active_desk.id)),l.xp6(8),l.Q6J("ngIf",l.lcZ(34,37,t.level)),l.xp6(2),l.Q6J("ngIf",l.lcZ(36,39,t.loading)),l.xp6(2),l.Q6J("ngIf",t.active_desk)}},directives:[O.zs,A.yS,G.o,H.s,V.p6,V.VK,be,o.sg,xe.p,o.O5,c.wG,we.$g,O.lW],pipes:[o.Ov],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[topbar][_ngcontent-%COMP%]{background-color:#00539f}"]}),e})();const Ue=function(){return["/book","desks","map"]};let Je=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["desk-flow-confirm"]],decls:7,vars:2,consts:[["topbar","",1,""],["button","","mat-button","",1,"clear","h-[2.75rem]","text-white",3,"routerLink"],[1,"flex","items-center","justify-center","h-full"],[1,"text-xl"],[1,"ml-2","mx-4"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"a",1),l.TgZ(2,"div",2),l.TgZ(3,"app-icon",3),l._uU(4,"arrow_back"),l.qZA(),l.TgZ(5,"span",4),l._uU(6,"Back"),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&e&&(l.xp6(1),l.Q6J("routerLink",l.DdM(1,Ue)))},directives:[O.zs,A.yS,G.o],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[topbar][_ngcontent-%COMP%]{background-color:#00539f}"]}),e})();const Ie=function(e){return["/book",e]},Ne=function(){return{}},Qe=function(){return["/schedule"]},Fe=function(e){return{email:e}};let je=(()=>{class e{constructor(){this.route="spaces",this.type="space"}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["flow-success"]],inputs:{calendar:"calendar",route:"route",type:"type"},decls:13,vars:11,consts:[["name","success",1,"fixed","inset-0","flex","flex-col","bg-secondary","items-center","justify-center","z-50"],[1,"text-4xl","rounded-full","bg-white","text-success","mb-4"],[1,"text-center","text-lg","text-white","mb-4"],[1,"flex","items-center","space-x-2"],["button","","mat-button","",1,"w-32",3,"routerLink","queryParams"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l.TgZ(2,"app-icon"),l._uU(3,"done"),l.qZA(),l.qZA(),l.TgZ(4,"div",2),l._uU(5),l._UZ(6,"br"),l._uU(7," An event has been added to your calendar "),l.qZA(),l.TgZ(8,"div",3),l.TgZ(9,"a",4),l._uU(10," New Booking "),l.qZA(),l.TgZ(11,"a",4),l._uU(12," My Day "),l.qZA(),l.qZA(),l.qZA()),2&e&&(l.xp6(5),l.hij(" Thank you, you ",t.type," booking was successful!"),l.xp6(4),l.Q6J("routerLink",l.VKq(5,Ie,t.route))("queryParams",l.DdM(7,Ne)),l.xp6(2),l.Q6J("routerLink",l.DdM(8,Qe))("queryParams",l.VKq(9,Fe,t.calendar)))},directives:[G.o,O.zs,A.yS],styles:[""]}),e})();var Ee=i(847),Pe=i(804),Ye=i(999);let Le=(()=>{class e{constructor(e,t,n){this._state=e,this._router=t,this._org=n,this.time=0,this.level="",this.quick_times=[{name:"Now",value:0},{name:"Tomorrow",value:(0,Ee.Z)((0,z.Z)(new Date,1),9).valueOf()}],this.levels=[],this.clearForm=()=>{this.time=0,this.level=this._org.building.id,this._state.clearForm()}}get is_edit(){var e,t;return!!(null===(t=null===(e=this.form)||void 0===e?void 0:e.get("id"))||void 0===t?void 0:t.value)}get form(){return this._state.form}ngOnInit(){var e,t;return(0,N.mG)(this,void 0,void 0,function*(){yield this._org.initialised.pipe((0,F.P)(e=>e)),yield this._org.active_levels.pipe((0,F.P)(e=>(null==e?void 0:e.length)>0)),this.level=null===(e=this._org.building)||void 0===e?void 0:e.id,this.levels=[{id:null===(t=this._org.building)||void 0===t?void 0:t.id,name:"Any Level"},...this._org.levelsForBuilding(this._org.building)]})}quickBook(){this.form.patchValue({date:(this.time<1440?(0,Pe.Z)((0,Ye.Z)(new Date,{nearestTo:5}),this.time):(0,Ee.Z)((0,z.Z)(new Date,1),8)).valueOf(),title:"Ad-hoc Desk Booking"}),this.findDesk()}findDesk(){this.form.markAllAsTouched(),this.form.valid&&this._router.navigate(["/book","desks","map"])}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(j.fy),l.Y36(A.F0),l.Y36(E.w7))},e.\u0275cmp=l.Xpm({type:e,selectors:[["desk-flow-form"]],decls:18,vars:4,consts:[["form","",1,"flex-1","min-h-[50%]"],[1,"text-xl","uppercase","font-medium","mb-2","mt-4","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[3,"form"],[1,"mb-4","border-b","border-gray-300","w-full"],[1,"flex","flex-col","sm:flex-row","items-center","justify-center","space-x-0","space-y-2","sm:space-y-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto","mb-4"],["mat-button","","clear","",1,"sm:flex-1","w-full","sm:w-auto","h-[2.75rem]","inverse",3,"click"],[1,"flex","items-center","justify-center"],[1,"text-xl"],[1,"ml-2","mx-4"],["find","","mat-button","",1,"sm:flex-1","w-full","sm:w-auto","h-[2.75rem]",3,"click"]],template:function(e,t){1&e&&(l.TgZ(0,"section",0),l.TgZ(1,"h2",1),l._uU(2),l.qZA(),l._UZ(3,"detailed-book-desks-form",2),l._UZ(4,"div",3),l.TgZ(5,"div",4),l.TgZ(6,"button",5),l.NdJ("click",function(){return t.clearForm()}),l.TgZ(7,"div",6),l.TgZ(8,"app-icon",7),l._uU(9,"clear"),l.qZA(),l.TgZ(10,"span",8),l._uU(11),l.qZA(),l.qZA(),l.qZA(),l.TgZ(12,"button",9),l.NdJ("click",function(){return t.findDesk()}),l.TgZ(13,"div",6),l.TgZ(14,"app-icon",7),l._uU(15,"search"),l.qZA(),l.TgZ(16,"span",8),l._uU(17),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&e&&(l.xp6(2),l.hij(" ",t.is_edit?"Edit":"Detailed"," Desk Booking "),l.xp6(1),l.Q6J("form",t.form),l.xp6(8),l.Oqu(t.is_edit?"Cancel Edit":"Clear Form"),l.xp6(6),l.Oqu(t.is_edit?"Update Desk":"Find Desk"))},directives:[be,O.lW,G.o],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column;overflow:auto}[quick][_ngcontent-%COMP%]{background-color:#007ac8}"]}),e})();function Se(e,t){1&e&&(l.ynx(0),l._UZ(1,"desk-flow-map"),l.BQk())}function De(e,t){1&e&&(l.ynx(0),l._UZ(1,"desk-flow-confirm"),l.BQk())}function $e(e,t){if(1&e&&(l.ynx(0),l._UZ(1,"flow-success",4),l.BQk()),2&e){const e=l.oxw();l.xp6(1),l.Q6J("calendar",null==e.last_success?null:e.last_success.user_email)}}function Be(e,t){1&e&&(l.ynx(0),l._UZ(1,"desk-flow-form"),l.BQk())}let Ge=(()=>{class e extends Q.KG{constructor(e,t,n){super(),this._state=e,this._route=t,this._org=n}get view(){return this._state.view}get last_success(){return this._state.last_success}ngOnInit(){return(0,N.mG)(this,void 0,void 0,function*(){yield this._org.initialised.pipe((0,F.P)(e=>e)).toPromise(),this._state.loadForm(),this._state.form||this._state.newForm(),this._state.form.patchValue({booking_type:"desk"}),this.subscription("route.params",this._route.paramMap.subscribe(e=>{e.has("step")&&this._state.setView(e.get("step"))})),this.subscription("route.query",this._route.queryParamMap.subscribe(e=>{e.has("success")&&this._state.setView(e.get("success"))}))})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(j.fy),l.Y36(A.gz),l.Y36(E.w7))},e.\u0275cmp=l.Xpm({type:e,selectors:[["placeos-book-desk-flow"]],features:[l.qOj],decls:6,vars:4,consts:[[1,"bg-white","h-full","w-full"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["type","desk","route","desks",3,"calendar"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l.ynx(1,1),l.YNc(2,Se,2,0,"ng-container",2),l.YNc(3,De,2,0,"ng-container",2),l.YNc(4,$e,2,1,"ng-container",2),l.YNc(5,Be,2,0,"ng-container",3),l.BQk(),l.qZA()),2&e&&(l.xp6(1),l.Q6J("ngSwitch",t.view),l.xp6(1),l.Q6J("ngSwitchCase","map"),l.xp6(1),l.Q6J("ngSwitchCase","confirm"),l.xp6(1),l.Q6J("ngSwitchCase","success"))},directives:[o.RF,o.n9,o.ED,Ce,Je,je,Le],styles:["[_nghost-%COMP%]{height:100%;width:100%}"]}),e})();var He=i(4266),Ve=i(3835),Re=i(611),ze=i(7209),We=i(8282),Xe=i(4608);let Ke=(()=>{class e{constructor(e){this._dialog=e,this.bookChange=new l.vpe}bookSpace(){this.book=!this.book,this.bookChange.emit(this.book)}viewLocation(){this._dialog.open(We.p,{width:"32em",maxWidth:"95vw",maxHeight:"95vh",data:{item:this.space}})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(Xe.uw))},e.\u0275cmp=l.Xpm({type:e,selectors:[["space-flow-find-item"]],inputs:{space:"space",multiple:"multiple",book:"book"},outputs:{bookChange:"bookChange"},decls:19,vars:8,consts:[[1,"flex","items-center","bg-white","p-2","my-2","shadow","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto","rounded"],[1,"flex","flex-col","flex-1","space-y-2"],[1,"flex","items-center"],[1,"p-2","rounded-full","bg-gray-300","mr-2"],[1,"flex","flex-col","space-y-2","ml-2"],["mat-button","","book","",3,"click"],["locate","","mat-button","",1,"inverse",3,"click"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"div",1),l.TgZ(2,"div",2),l.TgZ(3,"div",3),l.TgZ(4,"app-icon"),l._uU(5,"place"),l.qZA(),l.qZA(),l.TgZ(6,"span"),l._uU(7),l.qZA(),l.qZA(),l.TgZ(8,"div",2),l.TgZ(9,"div",3),l.TgZ(10,"app-icon"),l._uU(11,"group"),l.qZA(),l.qZA(),l.TgZ(12,"span"),l._uU(13),l.qZA(),l.qZA(),l.qZA(),l.TgZ(14,"div",4),l.TgZ(15,"button",5),l.NdJ("click",function(){return t.bookSpace()}),l._uU(16),l.qZA(),l.TgZ(17,"button",6),l.NdJ("click",function(){return t.viewLocation()}),l._uU(18," Map "),l.qZA(),l.qZA(),l.qZA()),2&e&&(l.xp6(7),l.AsE("",(null==t.space||null==t.space.level?null:t.space.level.display_name)||(null==t.space||null==t.space.level?null:t.space.level.name),", ",(null==t.space?null:t.space.display_name)||(null==t.space?null:t.space.name),""),l.xp6(6),l.hij("",(null==t.space?null:t.space.capacity)||0," People"),l.xp6(2),l.ekj("bg-pending",t.book)("border-pending",t.book),l.xp6(1),l.hij(" ",t.multiple?t.book?"Remove":"Select":"Book"," "))},directives:[G.o,O.lW],styles:["button[_ngcontent-%COMP%]{width:8rem}"]}),e})();function et(e,t){if(1&e&&(l.TgZ(0,"mat-option",21),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e.display_name||e.name," ")}}function tt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"mat-form-field",19),l.TgZ(1,"mat-select",20),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw().setBuilding(t)}),l.ALo(2,"async"),l.YNc(3,et,2,2,"mat-option",13),l.ALo(4,"async"),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.xp6(1),l.Q6J("ngModel",l.lcZ(2,2,e.building)),l.xp6(2),l.Q6J("ngForOf",l.lcZ(4,4,e.buildings))}}function nt(e,t){if(1&e&&(l.TgZ(0,"mat-option",21),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e.id),l.xp6(1),l.hij(" ",e.display_name||e.name," ")}}function it(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"mat-form-field",22),l.TgZ(1,"mat-select",23),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw().setOptions({zone_ids:[t]})}),l.ALo(2,"async"),l.ALo(3,"async"),l.YNc(4,nt,2,2,"mat-option",13),l.ALo(5,"async"),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();let t;l.xp6(1),l.Q6J("ngModel",null!=(t=l.lcZ(2,2,e.options))&&null!=t.zone_ids&&t.zone_ids.length?null==(t=l.lcZ(3,4,e.options))?null:t.zone_ids[0]:""),l.xp6(3),l.Q6J("ngForOf",l.lcZ(5,6,e.levels))}}function ot(e,t){if(1&e&&(l.TgZ(0,"mat-option",21),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e.value),l.xp6(1),l.hij(" ",e.name," ")}}function st(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"space-flow-find-item",26),l.NdJ("bookChange",function(t){const n=l.CHM(e).$implicit;return l.oxw(3).book_space[n.id]=t})("bookChange",function(t){const n=l.CHM(e).$implicit;return l.oxw(3).handleBookEvent(n,t)}),l.qZA()}if(2&e){const e=t.$implicit,n=l.oxw(3);l.Q6J("space",e)("multiple",n.multiple)("book",n.book_space[e.id])}}function at(e,t){if(1&e&&(l.ynx(0),l.YNc(1,st,1,3,"space-flow-find-item",24),l.ALo(2,"async"),l.TgZ(3,"p",25),l._uU(4," End of available spaces list "),l.qZA(),l.BQk()),2&e){const e=l.oxw(2);l.xp6(1),l.Q6J("ngForOf",l.lcZ(2,1,e.spaces))}}function rt(e,t){if(1&e&&(l.ynx(0),l.YNc(1,at,5,3,"ng-container",15),l.ALo(2,"async"),l.BQk()),2&e){const e=l.oxw(),t=l.MAs(27);let n;l.xp6(1),l.Q6J("ngIf",(null==(n=l.lcZ(2,2,e.spaces))?null:n.length)>0)("ngIfElse",t)}}function lt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",35),l.TgZ(1,"div",36),l.TgZ(2,"div"),l._uU(3),l.qZA(),l.TgZ(4,"div",37),l._uU(5),l.qZA(),l.qZA(),l.TgZ(6,"button",38),l.NdJ("click",function(t){const n=l.CHM(e).$implicit;return l.oxw(2).handleBookEvent(n,!1),t.stopPropagation()}),l.TgZ(7,"app-icon"),l._uU(8,"close"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(3),l.Oqu(e.display_name||e.name),l.xp6(2),l.AsE(" ",(null==e.level?null:e.level.display_name)||(null==e.level?null:e.level.name)," ~ ",e.capacity||"2+"," People ")}}function ct(e,t){1&e&&(l.TgZ(0,"div",39),l._uU(1," No selected spaces "),l.qZA())}function ut(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",27),l.TgZ(1,"div",28),l.TgZ(2,"div",29),l._uU(3),l.qZA(),l.TgZ(4,"button",30),l.NdJ("click",function(){return l.CHM(e),l.oxw().confirmBooking()}),l._uU(5," Book "),l.qZA(),l.qZA(),l.TgZ(6,"mat-menu",31,32),l.YNc(8,lt,9,3,"div",33),l.YNc(9,ct,2,0,"div",34),l.qZA(),l.qZA()}if(2&e){const e=l.MAs(7),t=l.oxw();l.xp6(2),l.Q6J("matMenuTriggerFor",e),l.xp6(1),l.hij(" ",t.space_list.length," space(s) selected "),l.xp6(1),l.Q6J("disabled",!t.space_list.length),l.xp6(4),l.Q6J("ngForOf",t.space_list),l.xp6(1),l.Q6J("ngIf",!(null!=t.space_list&&t.space_list.length))}}function dt(e,t){1&e&&(l.TgZ(0,"div",40),l._UZ(1,"mat-spinner",41),l.TgZ(2,"p"),l._uU(3,"Retrieving available spaces..."),l.qZA(),l.qZA()),2&e&&(l.xp6(1),l.Q6J("diameter",32))}function gt(e,t){1&e&&(l.TgZ(0,"div",42),l.TgZ(1,"p"),l._uU(2," No available spaces for selected time, capacity or level(s) "),l.qZA(),l.qZA())}const pt=function(){return["/book","spaces","form"]};let mt=(()=>{class e{constructor(e,t,n,i,o){this._org=e,this._spaces=t,this._state=n,this._settings=i,this._router=o,this.book_space={},this.quick_capacities=[{name:"Any Capacity",value:0},{name:"Small (1 - 4)",value:1},{name:"Medium (5 - 12)",value:5},{name:"Large (13 - 32)",value:13},{name:"Huge (32+)",value:33}],this.space_list=[],this.buildings=this._org.building_list,this.building=this._org.active_building,this.levels=(0,Y.aj)([this.building,this._state.options]).pipe((0,Ve.h)(([e])=>!!e),(0,D.U)(([e])=>[{id:this._org.building.id,name:"All Levels"},...this._org.levelsForBuilding(e)])),this.loading=this._state.loading,this.options=this._state.options,this.spaces=this._state.available_spaces,this.setOptions=e=>this._state.setOptions(e)}setBuilding(e){return(0,N.mG)(this,void 0,void 0,function*(){const t=yield this.options.pipe((0,Re.q)(1)).toPromise();e&&(this._org.building=e);const n=this._org.levelsForBuilding(this._org.building);!n.find(e=>{var n;return null===(n=t.zone_ids)||void 0===n?void 0:n.includes(e.id)})&&n.length&&this.setOptions({zone_ids:[n[0].id]})})}get multiple(){var e;return null!==(e=this._settings.get("app.events.multiple_spaces"))&&void 0!==e&&e}ngOnInit(){var e,t;return(0,N.mG)(this,void 0,void 0,function*(){yield this._org.initialised.pipe((0,F.P)(e=>!!e)).toPromise(),yield this._spaces.initialised.pipe((0,F.P)(e=>!!e)).toPromise(),this.setBuilding(this._org.building),this.book_space={},((null===(t=null===(e=this._state.form)||void 0===e?void 0:e.get("resources"))||void 0===t?void 0:t.value)||[]).forEach(e=>this.book_space[e.id]=!0),this.space_list=this._spaces.filter(e=>this.book_space[e.id])})}handleBookEvent(e,t=!0){this.multiple?this.book_space[e.id]=t:(this.book_space={},this.book_space[e.id]=t,this.confirmBooking()),this.space_list=this._spaces.filter(e=>this.book_space[e.id])}confirmBooking(){const e=this._spaces.filter(e=>this.book_space[e.id]);this._state.form.patchValue({resources:e,system:e[0]}),this._router.navigate(["/book","spaces","confirm"])}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(E.w7),l.Y36(ze.sK),l.Y36(He.MH),l.Y36(Q.gb),l.Y36(A.F0))},e.\u0275cmp=l.Xpm({type:e,selectors:[["space-flow-find"]],decls:28,vars:17,consts:[["topbar","",1,""],["button","","mat-button","",1,"clear","h-[2.75rem]","text-white",3,"routerLink"],[1,"flex","items-center","justify-center","h-full"],[1,"text-xl"],[1,"ml-2","mx-4"],["filters",""],[1,"w-[640px]","max-w-[calc(100%-2rem)]","mx-auto","py-4"],[1,"text-xl","uppercase","font-medium","text-white"],[1,"flex","flex-col","items-center","sm:flex-row","space-x-0","sm:space-x-2"],["overlay","","buildings","","class","w-full sm:w-auto sm:flex-1 h-[3.25rem]","appearance","outline",4,"ngIf"],["class","w-full sm:w-auto sm:flex-1 h-[3.25rem]","overlay","","appearance","outline",4,"ngIf"],["overlay","","appearance","outline",1,"w-full","sm:w-auto","sm:flex-1","h-[3.25rem]","hidden","sm:block"],["placeholder","Any Capacity",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"flex-1","w-full","bg-gray-100","overflow-auto"],[4,"ngIf","ngIfElse"],["class","bg-white border-t border-gray-200",4,"ngIf"],["load_state",""],["empty_state",""],["overlay","","buildings","","appearance","outline",1,"w-full","sm:w-auto","sm:flex-1","h-[3.25rem]"],["placeholder","Select Building...",3,"ngModel","ngModelChange"],[3,"value"],["overlay","","appearance","outline",1,"w-full","sm:w-auto","sm:flex-1","h-[3.25rem]"],["placeholder","Level",3,"ngModel","ngModelChange"],["class","w-[640px] max-w-[calc(100%-2rem)] mx-auto ",3,"space","multiple","book","bookChange",4,"ngFor","ngForOf"],[1,"p-4","text-center","opacity-60"],[1,"w-[640px]","max-w-[calc(100%-2rem)]","mx-auto",3,"space","multiple","book","bookChange"],[1,"bg-white","border-t","border-gray-200"],[1,"flex","items-center","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto","p-2"],[1,"flex-1","underline",3,"matMenuTriggerFor"],["mat-button","",1,"w-32",3,"disabled","click"],["yPosition","above"],["menu","matMenu"],["class","flex items-center pointer-events-none leading-tight","mat-menu-item","",4,"ngFor","ngForOf"],["mat-menu-item","","class"," opacity-60",4,"ngIf"],["mat-menu-item","",1,"flex","items-center","pointer-events-none","leading-tight"],[1,"flex","flex-col","mr-4"],[1,"text-xs","opacity-70"],["mat-icon-button","",1,"pointer-events-auto",3,"click"],["mat-menu-item","",1,"opacity-60"],[1,"h-full","w-full","flex","flex-col","items-center","justify-center","space-y-2"],[3,"diameter"],[1,"h-full","w-full","flex","flex-col","items-center","justify-center","space-y-2","p-8","text-center"]],template:function(e,t){if(1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"a",1),l.TgZ(2,"div",2),l.TgZ(3,"app-icon",3),l._uU(4,"arrow_back"),l.qZA(),l.TgZ(5,"span",4),l._uU(6,"Back"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(7,"div",5),l.TgZ(8,"div",6),l.TgZ(9,"h2",7),l._uU(10," Available Spaces "),l.qZA(),l.TgZ(11,"div",8),l.YNc(12,tt,5,6,"mat-form-field",9),l.ALo(13,"async"),l.YNc(14,it,6,8,"mat-form-field",10),l.ALo(15,"async"),l.TgZ(16,"mat-form-field",11),l.TgZ(17,"mat-select",12),l.NdJ("ngModelChange",function(e){return t.setOptions({capacity:e})}),l.ALo(18,"async"),l.YNc(19,ot,2,2,"mat-option",13),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(20,"div",14),l.YNc(21,rt,3,4,"ng-container",15),l.ALo(22,"async"),l.qZA(),l.YNc(23,ut,10,5,"div",16),l.YNc(24,dt,4,1,"ng-template",null,17,l.W1O),l.YNc(26,gt,3,0,"ng-template",null,18,l.W1O)),2&e){const e=l.MAs(25);let n,i,o;l.xp6(1),l.Q6J("routerLink",l.DdM(16,pt)),l.xp6(11),l.Q6J("ngIf",(null==(n=l.lcZ(13,8,t.buildings))?null:n.length)>1),l.xp6(2),l.Q6J("ngIf",(null==(i=l.lcZ(15,10,t.levels))?null:i.length)>0),l.xp6(3),l.Q6J("ngModel",null==(o=l.lcZ(18,12,t.options))?null:o.capacity),l.xp6(2),l.Q6J("ngForOf",t.quick_capacities),l.xp6(2),l.Q6J("ngIf",!l.lcZ(22,14,t.loading))("ngIfElse",e),l.xp6(2),l.Q6J("ngIf",t.multiple)}},directives:[O.zs,A.yS,G.o,o.O5,X.KE,K.gD,s.JJ,s.On,o.sg,c.ey,Ke,V.p6,O.lW,V.VK,V.OP,we.$g],pipes:[o.Ov],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[topbar][_ngcontent-%COMP%]{background-color:#00539f}[filters][_ngcontent-%COMP%]{background-color:#007ac8}"]}),e})();var ft=i(5969);function ht(e,t){if(1&e&&(l.TgZ(0,"div",20),l.TgZ(1,"span"),l._uU(2),l.qZA(),l.TgZ(3,"button",21),l._uU(4," Map "),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.xp6(2),l.AsE("",e.display_name||e.name," [",(null==e.level?null:e.level.display_name)||(null==e.level?null:e.level.name),"]")}}function _t(e,t){if(1&e&&(l.TgZ(0,"div",22),l._UZ(1,"a-user-avatar",23),l.TgZ(2,"span"),l._uU(3),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.xp6(1),l.Q6J("user",e),l.xp6(2),l.Oqu(e.name||e.email)}}function vt(e,t){1&e&&(l.TgZ(0,"span"),l._uU(1,"Confirm"),l.qZA())}function Zt(e,t){1&e&&l._UZ(0,"mat-spinner",24),2&e&&l.Q6J("diameter",24)}const bt=function(){return["/book","spaces","find"]},xt=function(){return["/book","spaces","form"]};let wt=(()=>{class e{constructor(e){this._state=e,this.show_spaces=!1,this.show_people=!1,this.loading=!1,this.postForm=()=>(0,N.mG)(this,void 0,void 0,function*(){this.loading=!0,yield this._state.postForm().catch(e=>(0,Q.cB)(e)),this.loading=!1})}get form(){return this._state.form}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(He.MH))},e.\u0275cmp=l.Xpm({type:e,selectors:[["space-flow-confirm"]],decls:59,vars:38,consts:[["topbar","",1,""],["button","","mat-button","",1,"clear","h-[2.75rem]","text-white",3,"routerLink"],[1,"flex","items-center","justify-center","h-full"],[1,"text-xl"],[1,"ml-2","mx-4"],[1,"flex","flex-col","items-center","space-y-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto","mb-4"],[1,"text-xl","uppercase","font-medium","w-full","my-4"],[1,"flex","items-center","py-2","space-x-2","border-b","border-gray-200","w-full"],[1,"p-2","rounded-full","bg-gray-300","mr-2"],[1,"flex-1","truncate"],["mat-button","",1,"clear","underline",3,"routerLink"],[1,"border-b","border-gray-200","w-full"],[1,"flex","items-center","py-2","space-x-2"],["mat-button","",1,"clear","bg-transparent","border-none","underline",3,"disabled","click"],["list","",1,"overflow-hidden"],["class","flex items-center h-10 pl-12",4,"ngFor","ngForOf"],["class","flex items-center h-12 pl-12 space-x-2",4,"ngFor","ngForOf"],["mat-button","","confirm","",1,"w-32",3,"disabled","click"],[4,"ngIf"],["class","mx-auto",3,"diameter",4,"ngIf"],[1,"flex","items-center","h-10","pl-12"],["mat-button","",1,"bg-transparent","border-none","underline"],[1,"flex","items-center","h-12","pl-12","space-x-2"],[1,"text-sm",3,"user"],[1,"mx-auto",3,"diameter"]],template:function(e,t){if(1&e&&(l.TgZ(0,"div",0),l.TgZ(1,"a",1),l.TgZ(2,"div",2),l.TgZ(3,"app-icon",3),l._uU(4,"arrow_back"),l.qZA(),l.TgZ(5,"span",4),l._uU(6,"Back"),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.TgZ(7,"div",5),l.TgZ(8,"h2",6),l._uU(9," Your meeting details "),l.qZA(),l.TgZ(10,"div",7),l.TgZ(11,"div",8),l.TgZ(12,"app-icon"),l._uU(13,"event"),l.qZA(),l.qZA(),l.TgZ(14,"div",9),l._uU(15),l.ALo(16,"date"),l.ALo(17,"date"),l.ALo(18,"date"),l.qZA(),l.TgZ(19,"a",10),l._uU(20,"Edit"),l.qZA(),l.qZA(),l.TgZ(21,"div",7),l.TgZ(22,"div",8),l.TgZ(23,"app-icon"),l._uU(24,"schedule"),l.qZA(),l.qZA(),l.TgZ(25,"div",9),l._uU(26),l.qZA(),l.TgZ(27,"a",10),l._uU(28,"Edit"),l.qZA(),l.qZA(),l.TgZ(29,"div",11),l.TgZ(30,"div",12),l.TgZ(31,"div",8),l.TgZ(32,"app-icon"),l._uU(33,"place"),l.qZA(),l.qZA(),l.TgZ(34,"div",9),l._uU(35),l.qZA(),l.TgZ(36,"button",13),l.NdJ("click",function(){return t.show_spaces=!t.show_spaces}),l._uU(37),l.qZA(),l.TgZ(38,"a",10),l._uU(39,"Edit"),l.qZA(),l.qZA(),l.TgZ(40,"div",14),l.YNc(41,ht,5,2,"div",15),l.qZA(),l.qZA(),l.TgZ(42,"div",11),l.TgZ(43,"div",12),l.TgZ(44,"div",8),l.TgZ(45,"app-icon"),l._uU(46,"group"),l.qZA(),l.qZA(),l.TgZ(47,"div",9),l._uU(48),l.qZA(),l.TgZ(49,"button",13),l.NdJ("click",function(){return t.show_people=!t.show_people}),l._uU(50),l.qZA(),l.TgZ(51,"a",10),l._uU(52,"Edit"),l.qZA(),l.qZA(),l.TgZ(53,"div",14),l.YNc(54,_t,4,2,"div",16),l.qZA(),l.qZA(),l.TgZ(55,"button",17),l.NdJ("click",function(){return t.postForm()}),l.YNc(56,vt,2,0,"span",18),l.YNc(57,Zt,1,1,"mat-spinner",19),l.qZA(),l.qZA(),l._uU(58," < ")),2&e){let e,n,i,o,s,a,r,c,u,d;l.xp6(1),l.Q6J("routerLink",l.DdM(33,bt)),l.xp6(14),l.lnq(" ",l.xi3(16,24,null==(e=t.form.get("date"))?null:e.value,"longDate")," at ",l.xi3(17,27,null==(e=t.form.get("date"))?null:e.value,"shortTime")," ~ ",l.xi3(18,30,(null==(e=t.form.get("date"))?null:e.value)+60*(null==(e=t.form.get("duration"))?null:e.value)*1e3,"shortTime")," "),l.xp6(4),l.Q6J("routerLink",l.DdM(34,xt)),l.xp6(7),l.hij(" ",null==(n=t.form.get("duration"))?null:n.value," minutes "),l.xp6(1),l.Q6J("routerLink",l.DdM(35,xt)),l.xp6(8),l.hij(" ",null==(i=t.form.get("resources"))||null==i.value?null:i.value.length," Space(s) "),l.xp6(1),l.Q6J("disabled",!(null!=(o=t.form.get("resources"))&&null!=o.value&&o.value.length)),l.xp6(1),l.hij(" ",t.show_spaces?"Hide":"Show"," "),l.xp6(1),l.Q6J("routerLink",l.DdM(36,bt)),l.xp6(2),l.Udp("height",t.show_spaces?2.5*(null==(s=t.form.get("resources"))||null==s.value?null:s.value.length)+"rem":"0"),l.xp6(1),l.Q6J("ngForOf",null==(a=t.form.get("resources"))?null:a.value),l.xp6(7),l.hij(" ",(null==(r=t.form.get("attendees"))||null==r.value?null:r.value.length)||0," Attendee(s) "),l.xp6(1),l.Q6J("disabled",!(null!=(c=t.form.get("attendees"))&&null!=c.value&&c.value.length)),l.xp6(1),l.hij(" ",t.show_people?"Hide":"Show"," "),l.xp6(1),l.Q6J("routerLink",l.DdM(37,xt)),l.xp6(2),l.Udp("height",t.show_people?3*(null==(u=t.form.get("attendees"))||null==u.value?null:u.value.length)+"rem":"0"),l.xp6(1),l.Q6J("ngForOf",null==(d=t.form.get("attendees"))?null:d.value),l.xp6(1),l.Q6J("disabled",t.loading),l.xp6(1),l.Q6J("ngIf",!t.loading),l.xp6(1),l.Q6J("ngIf",t.loading)}},directives:[O.zs,A.yS,G.o,O.lW,o.sg,o.O5,ft.k,we.$g],pipes:[o.uU],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column}[topbar][_ngcontent-%COMP%]{background-color:#00539f}[list][_ngcontent-%COMP%]{transition:height .2s}"]}),e})();i(7937),i(6974);const At=[{id:"after_hour",name:"After Hour"},{id:"before_hour",name:"Before Hour"},{id:"min_length",name:"Min. Meeting Length"},{id:"max_length",name:"Max. Meeting Length"},{id:"is_before",name:"Is Before Time"},{id:"is_after",name:"Is After Time"},{id:"visitor_type",name:"Visitor Type"},{id:"groups",name:"User in Groups"}];function Tt(e,t){1&e&&(l.TgZ(0,"button",5),l.TgZ(1,"app-icon"),l._uU(2,"close"),l.qZA(),l.qZA())}function yt(e,t){if(1&e&&(l.TgZ(0,"mat-option",18),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e.id),l.xp6(1),l.hij(" ",e.name," ")}}function qt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",14),l.TgZ(1,"mat-form-field",8),l.TgZ(2,"mat-select",15),l.NdJ("ngModelChange",function(t){return l.CHM(e).$implicit[0]=t}),l.YNc(3,yt,2,2,"mat-option",16),l.qZA(),l.qZA(),l.TgZ(4,"mat-form-field",8),l.TgZ(5,"input",17),l.NdJ("ngModelChange",function(t){return l.CHM(e).$implicit[1]=t}),l.qZA(),l.TgZ(6,"mat-error"),l._uU(7,"Rule value is required"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit,n=l.oxw(2);l.xp6(2),l.Q6J("ngModel",e[0]),l.xp6(1),l.Q6J("ngForOf",n.rule_types),l.xp6(2),l.Q6J("ngModel",e[1])}}function kt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",6),l.TgZ(1,"div",7),l.TgZ(2,"mat-form-field",8),l.TgZ(3,"input",9),l.NdJ("ngModelChange",function(t){return l.CHM(e).$implicit.name=t}),l.qZA(),l.TgZ(4,"mat-error"),l._uU(5,"Ruleset name is required"),l.qZA(),l.qZA(),l.TgZ(6,"button",10),l.NdJ("click",function(){const t=l.CHM(e).$implicit,n=l.oxw();return t.rules.push(["",""]),n.show_rules=t.id}),l.TgZ(7,"app-icon"),l._uU(8,"add"),l.qZA(),l.qZA(),l.TgZ(9,"button",11),l.NdJ("click",function(){const t=l.CHM(e).$implicit,n=l.oxw();return n.show_rules=n.show_rules!==t.id?t.id:""}),l.TgZ(10,"app-icon"),l._uU(11),l.qZA(),l.qZA(),l.qZA(),l.TgZ(12,"div",12),l.YNc(13,qt,8,3,"div",13),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit,n=l.oxw();l.xp6(3),l.Q6J("ngModel",e.name),l.xp6(6),l.Q6J("disabled",!e.rules.length),l.xp6(2),l.Oqu(n.show_rules===e.id?"expand_less":"expand_more"),l.xp6(1),l.Udp("height",(n.show_rules===e.id?3.5*e.rules.length:0)+"em"),l.xp6(1),l.Q6J("ngForOf",e.rules)}}let Mt=(()=>{class t{constructor(e){this._data=e,this.event=new l.vpe,this.loading=!1,this.rule_types=At,this.rulesets=(e.config||[]).map(e=>(e.rules=e.rules.map(e=>[e[0],JSON.stringify(e[1])]),e))}get new_id(){return"ruleset-"+Math.floor(99999999*Math.random())}saveChanges(){this.loading=!0;const t=this.rulesets.map(t=>Object.assign(Object.assign({},t),{rules:t.rules.map(t=>{let n=t[1];try{n=JSON.parse(t[1])}catch(e){}return[t[0],n]})}));this.event.emit({reason:"done",metadata:t})}}return t.\u0275fac=function(e){return new(e||t)(l.Y36(Xe.WI))},t.\u0275cmp=l.Xpm({type:t,selectors:[["catering-config-modal"]],outputs:{event:"event"},decls:11,vars:2,consts:[["mat-icon-button","","mat-dialog-close","",4,"ngIf"],[1,"overflow-auto","text-center"],["mat-button","",3,"click"],["class","ruleset",4,"ngFor","ngForOf"],[1,"flex","p-2","items-center","justify-center","border-none","border-t","border-solid","border-gray-300"],["mat-icon-button","","mat-dialog-close",""],[1,"ruleset"],[1,"flex"],["appearance","outline",1,"flex-1"],["matInput","","name","name","placeholder","Zone ID, Category or Tag","required","",3,"ngModel","ngModelChange"],["mat-icon-button","",1,"mb-6",3,"click"],["mat-icon-button","",1,"mb-6",3,"disabled","click"],["name","rules",1,"bg-gray-100","rounded","overflow-hidden"],["class","flex px-2 h-14 space-x-2",4,"ngFor","ngForOf"],[1,"flex","px-2","h-14","space-x-2"],["name","booking-type","placeholder","Select Rule",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["matInput","","name","value","placeholder","Rule value","required","",3,"ngModel","ngModelChange"],[3,"value"]],template:function(e,t){1&e&&(l.TgZ(0,"header"),l.TgZ(1,"h3"),l._uU(2,"Edit Catering Configuration"),l.qZA(),l.YNc(3,Tt,3,0,"button",0),l.qZA(),l.TgZ(4,"main",1),l.TgZ(5,"button",2),l.NdJ("click",function(){return t.rulesets.push({id:t.new_id,rules:[]})}),l._uU(6," New Ruleset "),l.qZA(),l.YNc(7,kt,14,6,"div",3),l.qZA(),l.TgZ(8,"footer",4),l.TgZ(9,"button",2),l.NdJ("click",function(){return t.saveChanges()}),l._uU(10,"Save Changes"),l.qZA(),l.qZA()),2&e&&(l.xp6(3),l.Q6J("ngIf",!t.loading),l.xp6(4),l.Q6J("ngForOf",t.rulesets))},directives:[o.O5,O.lW,o.sg,Xe.ZT,G.o,X.KE,M.Nt,s.Fj,s.Q7,s.JJ,s.On,X.TO,K.gD,c.ey],styles:["[name=rules][_ngcontent-%COMP%]{transition:height .2s}main[_ngcontent-%COMP%]{width:32em;padding:.5em 1em 1em}main[_ngcontent-%COMP%]   button.mat-button[_ngcontent-%COMP%]{margin:0 auto .5em;min-width:12em}"]}),t})();var Ot=i(5842),Ct=i(3016),Ut=i(84),Jt=i(9236),It=i(5135),Nt=i(33);function Qt(e,t){1&e&&(l.TgZ(0,"button",7),l.TgZ(1,"app-icon"),l._uU(2,"close"),l.qZA(),l.qZA())}function Ft(e,t){if(1&e&&(l.TgZ(0,"div",15),l.TgZ(1,"label",16),l._uU(2," Name"),l.TgZ(3,"span"),l._uU(4,"*"),l.qZA(),l._uU(5,": "),l.qZA(),l.TgZ(6,"mat-form-field",17),l._UZ(7,"input",18),l.TgZ(8,"mat-error"),l._uU(9,"Name is required"),l.qZA(),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(1),l.ekj("error",e.form.controls.name.invalid&&e.form.controls.name.touched)}}function jt(e,t){if(1&e&&(l.TgZ(0,"div",15),l.TgZ(1,"label",19),l._uU(2," Category"),l.TgZ(3,"span"),l._uU(4,"*"),l.qZA(),l._uU(5,": "),l.qZA(),l.TgZ(6,"mat-form-field",17),l._UZ(7,"input",20),l.TgZ(8,"mat-error"),l._uU(9,"Category is required"),l.qZA(),l.qZA(),l.qZA()),2&e){const e=l.oxw(2),t=l.MAs(9);l.xp6(1),l.ekj("error",e.form.controls.category.invalid&&e.form.controls.category.touched),l.xp6(6),l.Q6J("matAutocomplete",t)}}const Et=function(){return{class:"material-icons",content:"close"}};function Pt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"mat-chip",27),l.NdJ("removed",function(){const t=l.CHM(e).$implicit;return l.oxw(3).removeTag(t)}),l._uU(1),l._UZ(2,"app-icon",28),l.qZA()}if(2&e){const e=t.$implicit;l.Q6J("selectable",!0)("removable",!0),l.xp6(1),l.hij(" ",e," "),l.xp6(1),l.Q6J("icon",l.DdM(4,Et))}}function Yt(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",15),l.TgZ(1,"label",21),l.SDv(2,22),l.qZA(),l.TgZ(3,"mat-form-field",17),l.TgZ(4,"mat-chip-list",23,24),l.YNc(6,Pt,3,5,"mat-chip",25),l.TgZ(7,"input",26),l.NdJ("matChipInputTokenEnd",function(t){return l.CHM(e),l.oxw(2).addTag(t)}),l.qZA(),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.MAs(5),t=l.oxw(2);l.xp6(1),l.ekj("error",t.form.controls.tags.invalid&&t.form.controls.tags.touched),l.xp6(5),l.Q6J("ngForOf",t.tag_list),l.xp6(1),l.Q6J("matChipInputFor",e)("matChipInputSeparatorKeyCodes",t.separators)("matChipInputAddOnBlur",!0)}}function Lt(e,t){1&e&&(l.TgZ(0,"div",15),l.TgZ(1,"label",29),l._uU(2,"Description:"),l.qZA(),l.TgZ(3,"mat-form-field",17),l._UZ(4,"textarea",30),l.qZA(),l.qZA())}function St(e,t){if(1&e&&(l.TgZ(0,"div",15),l.TgZ(1,"label",16),l._uU(2," Unit Price"),l.TgZ(3,"span"),l._uU(4,"*"),l.qZA(),l._uU(5,": "),l.qZA(),l.TgZ(6,"mat-form-field",17),l._UZ(7,"input",31),l.TgZ(8,"mat-error"),l._uU(9,"Unit Price is required"),l.qZA(),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(1),l.ekj("error",e.form.controls.unit_price.invalid&&e.form.controls.unit_price.touched)}}function Dt(e,t){if(1&e&&(l.TgZ(0,"form",8),l.YNc(1,Ft,10,2,"div",9),l.YNc(2,jt,10,3,"div",9),l.YNc(3,Yt,8,6,"div",9),l.YNc(4,Lt,5,0,"div",9),l.YNc(5,St,10,2,"div",9),l.TgZ(6,"div",10),l.TgZ(7,"label",11),l._uU(8,"Accept Points?"),l.qZA(),l.TgZ(9,"mat-checkbox",12),l._uU(10),l.qZA(),l.qZA(),l.TgZ(11,"div",10),l.TgZ(12,"label",13),l._uU(13,"Discount Cap"),l.qZA(),l._UZ(14,"a-counter",14),l.qZA(),l.qZA()),2&e){const e=l.oxw();let t;l.Q6J("formGroup",e.form),l.xp6(1),l.Q6J("ngIf",e.form.controls.name),l.xp6(1),l.Q6J("ngIf",e.form.controls.category),l.xp6(1),l.Q6J("ngIf",e.form.controls.tags),l.xp6(1),l.Q6J("ngIf",e.form.controls.description),l.xp6(1),l.Q6J("ngIf",e.form.controls.unit_price),l.xp6(5),l.Oqu(null!=(t=e.form.get("accept_points"))&&t.value?"No":"Yes"),l.xp6(4),l.Q6J("min",0)("max",100)("step",5)("render_fn",e.renderPercent)}}function $t(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"footer",32),l.TgZ(1,"button",33),l.NdJ("click",function(){return l.CHM(e),l.oxw().saveChanges()}),l._uU(2," Save "),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.xp6(1),l.Q6J("disabled",!e.form.dirty)}}function Bt(e,t){1&e&&(l.TgZ(0,"div",34),l._UZ(1,"mat-spinner",35),l.TgZ(2,"p"),l._uU(3,"Saving catering item..."),l.qZA(),l.qZA())}function Gt(e,t){if(1&e&&(l.TgZ(0,"mat-option",36),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e," ")}}let Ht=(()=>{class e{constructor(e){this._data=e,this.event=new l.vpe,this.form=new s.cw({name:new s.NI(this.item.name||"",[s.kI.required]),description:new s.NI(this.item.description||""),category:new s.NI(this.item.category||"",[s.kI.required]),unit_price:new s.NI(this.item.unit_price,[s.kI.required]),tags:new s.NI(this.item.tags||[]),accept_points:new s.NI(this.item.accept_points||!1),discount_cap:new s.NI(this.item.discount_cap||0)}),this.loading=!1,this.separators=[Ot.K5,Ot.OC,Ot.L_]}get item(){return this._data.item||new Ct.U}get categories(){return this._data.categories||[]}get tag_list(){return this.form.controls.tags.value}renderPercent(e=0){return`${e}%`}addTag(e){if(!this.form||!this.form.controls.tags)return;this.form.controls.tags.markAsDirty();const t=e.input,n=e.value,i=this.tag_list;(n||"").trim()&&(i.push(n),this.form.controls.tags.setValue(i)),t&&(t.value="")}removeTag(e){if(!this.form||!this.form.controls.tags)return;const t=this.tag_list;this.form.controls.tags.markAsDirty();const n=t.indexOf(e);n>=0&&(t.splice(n,1),this.form.controls.tags.setValue(t))}saveChanges(){this.loading=!0,this.event.emit({reason:"done",metadata:{item:new Ct.U(Object.assign(Object.assign(Object.assign({},this.item),{id:this.item.id||`item-${(0,Q.Iy)(99999999)}`}),this.form.value))}})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(Xe.WI))},e.\u0275cmp=l.Xpm({type:e,selectors:[["catering-item-modal"]],outputs:{event:"event"},decls:11,vars:6,consts:function(){let e,t;return e=$localize`:@@tagsLabel800ffadd463cfe152c5af3fa9f13803ab2e77b934746186018558508280: Tags: `,t=$localize`:@@zoneTagsPlaceholder8dc7c13b0c6b8ad9c770bce0ad72e14b4aef84563986010900542572161:Zone tags...`,[["mat-dialog-title",""],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","p-4 overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex p-2 items-center justify-center border-t border-solid border-gray-300",4,"ngIf"],["load_state",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","mat-dialog-close",""],[1,"p-4","overflow-auto",3,"formGroup"],["class","field",4,"ngIf"],[1,"flex","items-center"],[1,"flex-none","w-28","min-w-0"],["formControlName","accept_points"],[1,"flex-1","w-24","min-w-0"],["formControlName","discount_cap",1,"border","border-gray-200","rounded",3,"min","max","step","render_fn"],[1,"field"],["for","title"],["appearance","outline"],["matInput","","name","name","placeholder","Item name","formControlName","name"],["for","category"],["matInput","","name","category","placeholder","Category","formControlName","category",3,"matAutocomplete"],["for","tags"],e,["aria-label","Item Tags"],["chipList",""],[3,"selectable","removable","removed",4,"ngFor","ngForOf"],["name","tags","placeholder",t,3,"matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputAddOnBlur","matChipInputTokenEnd"],[3,"selectable","removable","removed"],["matChipRemove","",3,"icon"],["for","description"],["matInput","","name","description","placeholder","Item Description","formControlName","description"],["matInput","","name","unit-price","type","number","placeholder","Unit Price","formControlName","unit_price"],[1,"flex","p-2","items-center","justify-center","border-t","border-solid","border-gray-300"],["mat-button","",3,"disabled","click"],[1,"flex","flex-col","items-center","p-8","space-y-2","w-64"],["diameter","32"],[3,"value"]]},template:function(e,t){if(1&e&&(l.TgZ(0,"header"),l.TgZ(1,"h3",0),l._uU(2),l.qZA(),l.YNc(3,Qt,3,0,"button",1),l.qZA(),l.YNc(4,Dt,15,11,"form",2),l.YNc(5,$t,3,1,"footer",3),l.YNc(6,Bt,4,0,"ng-template",null,4,l.W1O),l.TgZ(8,"mat-autocomplete",null,5),l.YNc(10,Gt,2,2,"mat-option",6),l.qZA()),2&e){const e=l.MAs(7);l.xp6(2),l.hij("",t.item.id?"Edit":"Add"," Item"),l.xp6(1),l.Q6J("ngIf",!t.loading),l.xp6(1),l.Q6J("ngIf",t.form&&!t.loading)("ngIfElse",e),l.xp6(1),l.Q6J("ngIf",!t.loading),l.xp6(5),l.Q6J("ngForOf",t.categories)}},directives:[Xe.uh,o.O5,Ut.XC,o.sg,O.lW,Xe.ZT,G.o,s._Y,s.JL,s.sg,Jt.oG,s.JJ,s.u,It.R,X.KE,M.Nt,s.Fj,X.TO,Ut.ZL,Nt.qn,Nt.oH,Nt.HS,Nt.qH,s.wV,we.$g,c.ey],styles:[".field[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}"]}),e})();var Vt=i(6817),Rt=i(7276);function zt(e,t){1&e&&(l.TgZ(0,"button",7),l.TgZ(1,"app-icon"),l._uU(2,"close"),l.qZA(),l.qZA())}function Wt(e,t){if(1&e&&(l.TgZ(0,"div",10),l.TgZ(1,"label",11),l._uU(2," Name"),l.TgZ(3,"span"),l._uU(4,"*"),l.qZA(),l._uU(5,": "),l.qZA(),l.TgZ(6,"mat-form-field",12),l._UZ(7,"input",13),l.TgZ(8,"mat-error"),l._uU(9,"Name is required"),l.qZA(),l.qZA(),l.qZA()),2&e){const e=l.oxw(2);l.xp6(1),l.ekj("error",e.form.controls.name.invalid&&e.form.controls.name.touched)}}function Xt(e,t){if(1&e&&(l.TgZ(0,"div",10),l.TgZ(1,"label",14),l._uU(2," Type"),l.TgZ(3,"span"),l._uU(4,"*"),l.qZA(),l._uU(5,": "),l.qZA(),l.TgZ(6,"mat-form-field",12),l._UZ(7,"input",15),l.TgZ(8,"mat-error"),l._uU(9,"Type is required"),l.qZA(),l.qZA(),l.qZA()),2&e){const e=l.oxw(2),t=l.MAs(9);l.xp6(1),l.ekj("error",e.form.controls.group.invalid&&e.form.controls.group.touched),l.xp6(6),l.Q6J("matAutocomplete",t)}}function Kt(e,t){1&e&&(l.TgZ(0,"div",10),l.TgZ(1,"label",11),l._uU(2,"Unit Price:"),l.qZA(),l.TgZ(3,"mat-form-field",12),l._UZ(4,"input",16),l.qZA(),l.qZA())}function en(e,t){1&e&&(l.TgZ(0,"div",10),l.TgZ(1,"mat-checkbox",17),l._uU(2," Can select multiple of type "),l.qZA(),l.qZA())}function tn(e,t){if(1&e&&(l.TgZ(0,"form",8),l.YNc(1,Wt,10,2,"div",9),l.YNc(2,Xt,10,3,"div",9),l.YNc(3,Kt,5,0,"div",9),l.YNc(4,en,3,0,"div",9),l.qZA()),2&e){const e=l.oxw();l.Q6J("formGroup",e.form),l.xp6(1),l.Q6J("ngIf",e.form.controls.name),l.xp6(1),l.Q6J("ngIf",e.form.controls.group),l.xp6(1),l.Q6J("ngIf",e.form.controls.unit_price),l.xp6(1),l.Q6J("ngIf",e.form.controls.multiple)}}function nn(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"footer",18),l.TgZ(1,"button",19),l.NdJ("click",function(){return l.CHM(e),l.oxw().saveChanges()}),l._uU(2," Save "),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();l.xp6(1),l.Q6J("disabled",!e.form.dirty)}}function on(e,t){1&e&&(l.TgZ(0,"div",20),l._UZ(1,"mat-spinner",21),l.TgZ(2,"p"),l._uU(3,"Saving catering item option..."),l.qZA(),l.qZA())}function sn(e,t){if(1&e&&(l.TgZ(0,"mat-option",22),l._uU(1),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e),l.xp6(1),l.hij(" ",e," ")}}let an=(()=>{class e{constructor(e){this._data=e,this.event=new l.vpe,this.loading=!1}get option(){return this._data.option}get types(){return this._data.types||[]}ngOnInit(){this.form=new s.cw({name:new s.NI(this.option.name||"",[s.kI.required]),group:new s.NI(this.option.group||"",[s.kI.required]),unit_price:new s.NI(this.option.unit_price),multiple:new s.NI(!!this.option.multiple,[])})}saveChanges(){this.loading=!0;const e=Object.assign(Object.assign(Object.assign({},this.option),{id:this.option.id||`option-${(0,Rt.Iy)(99999999)}`}),this.form.value);this.event.emit({reason:"done",metadata:{item:new Ct.U(Object.assign(Object.assign({},this._data.parent),{options:this._data.parent.options.filter(t=>t.id!==e.id).concat([e])}))}})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(Xe.WI))},e.\u0275cmp=l.Xpm({type:e,selectors:[["catering-option-modal"]],outputs:{event:"event"},decls:11,vars:6,consts:[["mat-dialog-title",""],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],["class","p-4 overflow-auto",3,"formGroup",4,"ngIf","ngIfElse"],["class","flex p-2 items-center justify-center border-none border-t border-solid border-gray-300",4,"ngIf"],["load_state",""],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["mat-icon-button","","mat-dialog-close",""],[1,"p-4","overflow-auto",3,"formGroup"],["class","field",4,"ngIf"],[1,"field"],["for","title"],["appearance","outline"],["matInput","","name","name","placeholder","Item name","formControlName","name"],["for","group"],["matInput","","name","group","placeholder","Type of option e.g. Number of sugars","formControlName","group",3,"matAutocomplete"],["matInput","","name","unit-price","type","number","placeholder","Unit Price","formControlName","unit_price"],["name","multiple","formControlName","multiple"],[1,"flex","p-2","items-center","justify-center","border-none","border-t","border-solid","border-gray-300"],["mat-button","",3,"disabled","click"],[1,"flex","flex-col","items-center","p-8","space-y-2","w-64"],["diameter","32"],[3,"value"]],template:function(e,t){if(1&e&&(l.TgZ(0,"header"),l.TgZ(1,"h3",0),l._uU(2),l.qZA(),l.YNc(3,zt,3,0,"button",1),l.qZA(),l.YNc(4,tn,5,5,"form",2),l.YNc(5,nn,3,1,"footer",3),l.YNc(6,on,4,0,"ng-template",null,4,l.W1O),l.TgZ(8,"mat-autocomplete",null,5),l.YNc(10,sn,2,2,"mat-option",6),l.qZA()),2&e){const e=l.MAs(7);l.xp6(2),l.hij(" ",t.option.id?"Edit":"Add"," Item Option "),l.xp6(1),l.Q6J("ngIf",!t.loading),l.xp6(1),l.Q6J("ngIf",t.form&&!t.loading)("ngIfElse",e),l.xp6(1),l.Q6J("ngIf",!t.loading),l.xp6(5),l.Q6J("ngForOf",t.types)}},directives:[Xe.uh,o.O5,Ut.XC,o.sg,O.lW,Xe.ZT,G.o,s._Y,s.JL,s.sg,X.KE,M.Nt,s.Fj,s.JJ,s.u,X.TO,Ut.ZL,s.wV,Jt.oG,we.$g,c.ey],styles:[".field[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap}"]}),e})();var rn=i(7968),ln=i(8774),cn=i(9310),un=i(391),dn=i(5109),gn=i(6828);function pn(e,t){1&e&&(l.TgZ(0,"div",17),l._uU(1," Options Available "),l.qZA())}function mn(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"a-counter",18),l.NdJ("ngModelChange",function(t){l.CHM(e);const n=l.oxw().$implicit;return l.oxw(5).updateItemQuantity(n,t)}),l.qZA()}if(2&e){const e=l.oxw().$implicit;l.Q6J("ngModel",e.quantity)}}function fn(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",19),l.TgZ(1,"div",20),l.TgZ(2,"button",21),l.TgZ(3,"app-icon"),l._uU(4,"remove"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(5,"div",22),l._uU(6),l.qZA(),l.TgZ(7,"button",23),l.NdJ("click",function(){l.CHM(e);const t=l.oxw().$implicit;return l.oxw(5).addItem(t)}),l.TgZ(8,"app-icon"),l._uU(9,"add"),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw().$implicit;l.xp6(1),l.Q6J("matTooltip",e.quantity?"Items with options must be removed from order confirmation page":""),l.xp6(1),l.Q6J("disabled",!0),l.xp6(4),l.hij(" ",e.quantity," ")}}function hn(e,t){if(1&e&&(l.TgZ(0,"div",11),l.TgZ(1,"div",12),l.TgZ(2,"div",12),l._uU(3),l.qZA(),l.YNc(4,pn,2,0,"div",13),l.qZA(),l.TgZ(5,"div",14),l._uU(6),l.ALo(7,"currency"),l.qZA(),l.YNc(8,mn,1,1,"a-counter",15),l.YNc(9,fn,10,3,"div",16),l.qZA()),2&e){const e=t.$implicit;l.xp6(3),l.hij(" ",e.name," "),l.xp6(1),l.Q6J("ngIf",e.options.length),l.xp6(2),l.hij(" ",l.lcZ(7,5,e.unit_price/100)," "),l.xp6(2),l.Q6J("ngIf",!e.options.length),l.xp6(1),l.Q6J("ngIf",e.options.length)}}const _n=function(){return{}};function vn(e,t){if(1&e&&(l.TgZ(0,"mat-tab",8),l.TgZ(1,"div",9),l.YNc(2,hn,10,7,"div",10),l.qZA(),l.qZA()),2&e){const e=l.oxw().$implicit,t=l.oxw(3);l.Q6J("label",e),l.xp6(2),l.Q6J("ngForOf",(t.menu_items||l.DdM(2,_n))[e])}}function Zn(e,t){if(1&e&&(l.ynx(0),l.YNc(1,vn,3,3,"mat-tab",7),l.BQk()),2&e){const e=t.$implicit,n=l.oxw(3);l.xp6(1),l.Q6J("ngIf",(n.menu_items||l.DdM(1,_n))[e].length)}}function bn(e,t){if(1&e&&(l.ynx(0),l.TgZ(1,"mat-tab-group"),l.YNc(2,Zn,2,2,"ng-container",6),l.qZA(),l.BQk()),2&e){const e=l.oxw(2);l.xp6(2),l.Q6J("ngForOf",e.categories)}}function xn(e,t){if(1&e&&(l.TgZ(0,"div",4),l.YNc(1,bn,3,1,"ng-container",5),l.qZA()),2&e){const e=l.oxw(),t=l.MAs(5);l.xp6(1),l.Q6J("ngIf",!e.show_order_details)("ngIfElse",t)}}function wn(e,t){if(1&e){const e=l.EpF();l.ynx(0),l.TgZ(1,"button",26),l._uU(2," Cancel "),l.qZA(),l.TgZ(3,"button",27),l.NdJ("click",function(){return l.CHM(e),l.oxw(2).show_order_details=!0}),l._uU(4," Confirm "),l.qZA(),l.BQk()}if(2&e){const e=l.oxw(2);l.xp6(3),l.Q6J("disabled",!e.order.item_count)("matBadge",e.order.item_count)("matBadgeHidden",!e.order.item_count)}}function An(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"button",28),l.NdJ("click",function(){return l.CHM(e),l.oxw(2).show_order_details=!1}),l._uU(1," Back "),l.qZA(),l.TgZ(2,"button",29),l.NdJ("click",function(){return l.CHM(e),l.oxw(2).saveOrder()}),l._uU(3," Save Order "),l.qZA()}}function Tn(e,t){if(1&e&&(l.TgZ(0,"footer",24),l.YNc(1,wn,5,3,"ng-container",5),l.YNc(2,An,4,0,"ng-template",null,25,l.W1O),l.qZA()),2&e){const e=l.MAs(3),t=l.oxw();l.xp6(1),l.Q6J("ngIf",!t.show_order_details)("ngIfElse",e)}}function yn(e,t){if(1&e&&(l.TgZ(0,"div",30),l._UZ(1,"mat-spinner",31),l.TgZ(2,"p"),l._uU(3),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(3),l.Oqu(e.loading)}}function qn(e,t){if(1&e&&(l.TgZ(0,"div",37),l._uU(1),l.qZA()),2&e){const e=l.oxw().$implicit,t=l.oxw(2);l.Q6J("matTooltip",t.optionsFor(e)),l.xp6(1),l.AsE(" ",e.options.length," option",1===e.options.length?"":"s"," selected ")}}function kn(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",34),l.TgZ(1,"div",12),l.TgZ(2,"div",12),l._uU(3),l.qZA(),l.YNc(4,qn,2,3,"div",35),l.qZA(),l.TgZ(5,"div",14),l._uU(6),l.ALo(7,"currency"),l.qZA(),l.TgZ(8,"a-counter",36),l.NdJ("ngModelChange",function(t){const n=l.CHM(e).$implicit;return l.oxw(2).updateItemQuantity(n,t)}),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit;l.xp6(3),l.Oqu(e.name),l.xp6(1),l.Q6J("ngIf",e.options.length),l.xp6(2),l.hij(" ",l.lcZ(7,4,e.total_cost/100)," "),l.xp6(2),l.Q6J("ngModel",e.quantity)}}function Mn(e,t){if(1&e&&(l.TgZ(0,"header",32),l.TgZ(1,"h3"),l._uU(2,"Confirm Order"),l.qZA(),l.qZA(),l.TgZ(3,"div",9),l.YNc(4,kn,9,6,"div",33),l.qZA()),2&e){const e=l.oxw();l.xp6(4),l.Q6J("ngForOf",e.order.items)}}function On(e,t,n){var i;let o=!0;for(const s of t)if(e.category===s.name||e.tags.includes(s.name)||(null===(i=n.space)||void 0===i?void 0:i.zones.includes(s.name))||"*"===s.name){let e=0;for(const t of s.rules){const i=new Date(n.date);switch(t[0]){case"after_hour":e+=(0,ln.Z)(i,(0,Ee.Z)(i,t[1]))?1:0;break;case"before_hour":e+=(0,cn.Z)(i,(0,Ee.Z)(i,t[1]))?1:0;break;case"min_length":e+=n.duration>=(0,un.H1)(t[1])?1:0;break;case"max_length":e+=n.duration<=(0,un.H1)(t[1])?1:0;break;case"visitor_type":e+=n.ext("visitor_type")===t[1]?1:0;break;default:e++}}o=e>=s.rules.length}return o}let Cn=(()=>{class e extends Q.KG{constructor(e){super(),this._data=e,this.event=new l.vpe,this.loading="",this.menu_items={},this.categories=[],this.loading="Loading menu..."}ngOnInit(){var e,t,n;return(0,N.mG)(this,void 0,void 0,function*(){this.loading="Loading menu...",this.order=new rn.G(this._data.order),this.rules=yield this._data.getCateringConfig(null===(n=null===(t=null===(e=this.order.event)||void 0===e?void 0:e.space)||void 0===t?void 0:t.level)||void 0===n?void 0:n.parent_id),this._data.menu.subscribe(e=>{this.loading="Loading menu...";const t=(0,Q.Tw)(e.map(e=>e.category)),n={};for(const i of t)n[i]=e.filter(e=>e.category===i&&On(e,this.rules,this.order.event));this.categories=t,this.menu_items=n,this.updateMenuQuantities(),this.timeout("clear_loading",()=>this.loading="",1e3)})})}addItem(e,t=!0){var n;const i=this.order.items.find(t=>t.id===e.id&&t.options.length===t.options.reduce((t,n)=>t+(e.options.find(e=>n.id===e.id)?1:0),0));t&&(null===(n=e.options)||void 0===n?void 0:n.length)?this._data.selectOptions(e.options).then(t=>{const n=new Ct.U(Object.assign(Object.assign({},e),{options:t}));this.addItem(n,!1)}):this.order=new rn.G(Object.assign(Object.assign({},this.order),i?{items:this.order.items.filter(t=>!(t.id===e.id&&t.options_string===e.options_string)).concat([new Ct.U(Object.assign(Object.assign({},e),{quantity:i.quantity+1}))])}:{items:this.order.items.concat([new Ct.U(Object.assign(Object.assign({},e),{quantity:1}))])})),this.updateMenuQuantities()}removeItem(e){this.order=new rn.G(Object.assign(Object.assign({},this.order),{items:this.order.items.filter(t=>t.id!==e.id&&t.options_string===e.options_string)})),this.updateMenuQuantities()}updateItemQuantity(e,t){const n=this.order.items.find(t=>t.id===e.id&&t.options_string===e.options_string);let i=[...this.order.items];i=n?this.order.items.filter(t=>!(t.id===e.id&&t.options_string===e.options_string)).concat([new Ct.U(Object.assign(Object.assign({},e),{quantity:t}))]):this.order.items.concat([new Ct.U(Object.assign(Object.assign({},e),{quantity:t}))]),i.sort((e,t)=>e.name.localeCompare(t.name)),this.order=new rn.G(Object.assign(Object.assign({},this.order),{items:i})),this.updateMenuQuantities()}updateMenuQuantities(){for(const e in this.menu_items)for(const t of this.menu_items[e])t.quantity=this.order.items.reduce((e,n)=>n.id===t.id?e+n.quantity:e,0)}optionsFor(e){return e.options.map(e=>e.name).join("\n")}saveOrder(){this.event.emit({reason:"done",metadata:{order:this.order}})}confirmOrder(){this.show_order_details=!0}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(Xe.WI))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-catering-order-modal"]],outputs:{event:"event"},features:[l.qOj],decls:6,vars:3,consts:[["class","main min-w-[20rem]",4,"ngIf","ngIfElse"],["class","flex items-center justify-center space-x-2 p-2 border-t border-gray-200",4,"ngIf"],["load_state",""],["order_details",""],[1,"main","min-w-[20rem]"],[4,"ngIf","ngIfElse"],[4,"ngFor","ngForOf"],[3,"label",4,"ngIf"],[3,"label"],[1,"list"],["item","","class","flex items-center p-2 border-b border-gray-200",4,"ngFor","ngForOf"],["item","",1,"flex","items-center","p-2","border-b","border-gray-200"],[1,"flex-1","w-1/2"],["class","text-xs no-underline",4,"ngIf"],[1,"bg-primary","text-xs","rounded","px-4","py-2","mx-2","text-white","font-medium"],["ngDefaultControl","",3,"ngModel","ngModelChange",4,"ngIf"],["class","flex items-center",4,"ngIf"],[1,"text-xs","no-underline"],["ngDefaultControl","",3,"ngModel","ngModelChange"],[1,"flex","items-center"],[3,"matTooltip"],["mat-icon-button","",3,"disabled"],[1,"count","h-12","w-12","flex","items-center","justify-center"],["mat-icon-button","",3,"click"],[1,"flex","items-center","justify-center","space-x-2","p-2","border-t","border-gray-200"],["order_actions",""],["mat-button","","mat-dialog-close","",1,"inverse"],["confirm","","mat-button","","matBadgeColor","warn",3,"disabled","matBadge","matBadgeHidden","click"],["mat-button","",1,"inverse",3,"click"],["save","","mat-button","",3,"click"],[1,"flex","flex-col","w-64","p-8","items-center","space-y-2"],["diameter","32"],[1,"h-[3.25rem]"],["item","","class","flex items-center p-2 border-b border-gray-50",4,"ngFor","ngForOf"],["item","",1,"flex","items-center","p-2","border-b","border-gray-50"],["class","text-xs underline",3,"matTooltip",4,"ngIf"],[3,"ngModel","ngModelChange"],[1,"text-xs","underline",3,"matTooltip"]],template:function(e,t){if(1&e&&(l.YNc(0,xn,2,2,"div",0),l.YNc(1,Tn,4,2,"footer",1),l.YNc(2,yn,4,1,"ng-template",null,2,l.W1O),l.YNc(4,Mn,5,1,"ng-template",null,3,l.W1O)),2&e){const e=l.MAs(3);l.Q6J("ngIf",!t.loading)("ngIfElse",e),l.xp6(1),l.Q6J("ngIf",!t.loading)}},directives:[o.O5,dn.SP,o.sg,dn.uX,It.R,s.Fj,s.JJ,s.On,gn.gM,O.lW,G.o,Xe.ZT,we.$g],pipes:[o.H9],styles:[".list[_ngcontent-%COMP%]{height:24em;min-width:32em;max-width:calc(100vw - 1em)}footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{min-width:12em}input[_ngcontent-%COMP%]{position:relative;width:100%;padding:1em;border-radius:0!important;border:1px solid #ccc;border-right:none;border-left:none;outline:none;font-size:1em;&:focus{border:none;border-top:2px solid var(--primary);border-bottom:2px solid var(--primary);box-shadow:none}&.error::placeholder{color:rgba(var(--error),.45)}}"]}),e})();var Un=i(4810);function Jn(e,t){if(1&e&&(l.TgZ(0,"div",18),l._uU(1),l.ALo(2,"currency"),l.qZA()),2&e){const e=l.oxw().$implicit;l.xp6(1),l.hij(" +",l.lcZ(2,1,e.unit_price/100)," ")}}function In(e,t){if(1&e&&(l.TgZ(0,"mat-radio-button",14),l.TgZ(1,"div",15),l.TgZ(2,"div",16),l._uU(3),l.qZA(),l.YNc(4,Jn,3,3,"div",17),l.qZA(),l.qZA()),2&e){const e=t.$implicit;l.Q6J("value",e.id),l.xp6(3),l.hij(" ",e.name," "),l.xp6(1),l.Q6J("ngIf",e.unit_price)}}function Nn(e,t){if(1&e){const e=l.EpF();l.ynx(0),l.TgZ(1,"mat-radio-group",10),l.NdJ("ngModelChange",function(t){l.CHM(e);const n=l.oxw().$implicit;return l.oxw().updateGroupOption(n,t)}),l.TgZ(2,"mat-radio-button",11),l.TgZ(3,"span",12),l._uU(4,"None"),l.qZA(),l.qZA(),l.YNc(5,In,5,3,"mat-radio-button",13),l.qZA(),l.BQk()}if(2&e){const e=l.oxw().$implicit;l.xp6(5),l.Q6J("ngForOf",null==e?null:e.options)}}function Qn(e,t){if(1&e&&(l.TgZ(0,"div",18),l._uU(1),l.ALo(2,"currency"),l.qZA()),2&e){const e=l.oxw().$implicit;l.xp6(1),l.hij(" +",l.lcZ(2,1,e.unit_price/100)," ")}}function Fn(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"mat-checkbox",20),l.NdJ("ngModelChange",function(t){const n=l.CHM(e).$implicit;return l.oxw(3).option_state[n.id]=t}),l.TgZ(1,"div",15),l.TgZ(2,"div",16),l._uU(3),l.qZA(),l.YNc(4,Qn,3,3,"div",17),l.qZA(),l.qZA()}if(2&e){const e=t.$implicit,n=l.oxw(3);l.Q6J("ngModel",n.option_state[e.id]),l.xp6(3),l.hij(" ",e.name," "),l.xp6(1),l.Q6J("ngIf",e.unit_price)}}function jn(e,t){if(1&e&&l.YNc(0,Fn,5,3,"mat-checkbox",19),2&e){const e=l.oxw().$implicit;l.Q6J("ngForOf",null==e?null:e.options)}}function En(e,t){if(1&e&&(l.TgZ(0,"div",5),l.TgZ(1,"div",6),l._uU(2),l.qZA(),l.TgZ(3,"div",7),l.YNc(4,Nn,6,1,"ng-container",8),l.YNc(5,jn,1,1,"ng-template",null,9,l.W1O),l.qZA(),l.qZA()),2&e){const e=t.$implicit,n=l.MAs(6);l.uIk("group",e.name),l.xp6(2),l.Oqu(e.name),l.xp6(2),l.Q6J("ngIf",!e.multiple)("ngIfElse",n)}}let Pn=(()=>{class e{constructor(e){this._data=e,this.event=new l.vpe,this.option_state={};const t=(0,Rt.Tw)(this._data.options.map(e=>e.group||"Other")),n=[];for(const i of t){const e=this._data.options.filter(e=>e.group===i);n.push({name:i,multiple:!!e.find(e=>e.multiple),options:e})}this.groups=n}updateGroupOption(e,t){for(const n of e.options)this.option_state[n.id]=n.id===t}saveOptions(){const e=this._data.options.filter(e=>this.option_state[e.id]);this.event.emit({reason:"done",metadata:{options:e}})}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(Xe.WI))},e.\u0275cmp=l.Xpm({type:e,selectors:[["app-catering-options-modal"]],outputs:{event:"event"},decls:11,vars:1,consts:[["mat-icon-button","","mat-dialog-close",""],[1,"overflow-auto"],["class","pt-1 pb-2 border-b border-gray-200",4,"ngFor","ngForOf"],[1,"p-2"],["mat-button","",1,"w-32",3,"click"],[1,"pt-1","pb-2","border-b","border-gray-200"],[1,"font-medium","p-2","capitalize"],[1,"flex","flex-col","pl-6"],[4,"ngIf","ngIfElse"],["multi_options",""],["aria-label","Select an option","ngModel","",1,"flex","flex-col",3,"ngModelChange"],["value","",1,"my-1","mx-0"],[1,"font-medium","p-2"],["class","my-1 mx-0",3,"value",4,"ngFor","ngForOf"],[1,"my-1","mx-0",3,"value"],[1,"flex","items-center","justify-center"],[1,"font-medium","p-2","flex-1","w-1/2"],["class","opacity-60 text-xs",4,"ngIf"],[1,"opacity-60","text-xs"],[3,"ngModel","ngModelChange",4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(l.TgZ(0,"header"),l.TgZ(1,"h3"),l._uU(2,"Select options"),l.qZA(),l.TgZ(3,"button",0),l.TgZ(4,"app-icon"),l._uU(5,"close"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(6,"main",1),l.YNc(7,En,7,4,"div",2),l.qZA(),l.TgZ(8,"footer",3),l.TgZ(9,"button",4),l.NdJ("click",function(){return t.saveOptions()}),l._uU(10," Save "),l.qZA(),l.qZA()),2&e&&(l.xp6(7),l.Q6J("ngForOf",t.groups))},directives:[O.lW,Xe.ZT,G.o,o.sg,o.O5,Un.VQ,s.JJ,s.On,Un.U0,Jt.oG],pipes:[o.H9],styles:["main[_ngcontent-%COMP%]{min-height:24em;width:24rem;max-width:calc(100vw - 2rem)}"]}),e})();function Yn(e,t){1&e&&(l.TgZ(0,"button",4),l.TgZ(1,"app-icon"),l._uU(2,"close"),l.qZA(),l.qZA())}function Ln(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"main"),l.TgZ(1,"div",5),l.TgZ(2,"app-icon",6),l._uU(3,"upload"),l.qZA(),l.TgZ(4,"p"),l._uU(5,"Click to select file or Drag and drop files"),l.qZA(),l.TgZ(6,"input",7),l.NdJ("change",function(t){return l.CHM(e),l.oxw().handleFileEvent(t)}),l.qZA(),l.qZA(),l.TgZ(7,"div",8),l.TgZ(8,"button",9),l.NdJ("click",function(){return l.CHM(e),l.oxw().downloadTemplate()}),l._uU(9," Download Template "),l.qZA(),l.qZA(),l.qZA()}}function Sn(e,t){if(1&e&&(l.TgZ(0,"main",10),l._UZ(1,"mat-spinner",11),l.TgZ(2,"p"),l._uU(3),l.qZA(),l.qZA()),2&e){const e=l.oxw();l.xp6(3),l.Oqu(e.loading)}}let Dn=(()=>{class e{constructor(){this.event=new l.vpe}handleFileEvent(e){this.loading="Processing menu data...";const t=e.target;if(!(null==t?void 0:t.files))return this.loading="";const n=t.files;if(!n.length)return this.loading="";const i=n[0],o=new FileReader;o.addEventListener("loadend",e=>{const t=(0,Q.n5)(e.target.result);this.loading="",this.event.emit({reason:"done",metadata:t.filter(e=>"item"===(e.type||"").toLowerCase()).map(e=>new Ct.U(Object.assign(Object.assign({},e),{options:t.filter(t=>"option"===(t.type||"").toLowerCase()&&t.tags===e.id).map(e=>({id:e.id,name:e.name,group:e.category,multiple:e.multiple,unit_price:e.unit_price}))})))})}),o.readAsText(i)}downloadTemplate(){(0,Q.Sv)("import-menu-template.csv","ID,Type,Name,Unit Price,Category,Description,Tags,Multiple\nitem-1,item,Coffee,200,Drink,Wake Up,,\noption-1,option,1 Sugar,20,Sugars,,item-1,false")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=l.Xpm({type:e,selectors:[["catering-import-menu-modal"]],outputs:{event:"event"},decls:7,vars:3,consts:[[1,"h-12","bg-primary","flex","items-center","justify-between","px-4"],["mat-icon-button","","mat-dialog-close","",4,"ngIf"],[4,"ngIf","ngIfElse"],["load_state",""],["mat-icon-button","","mat-dialog-close",""],[1,"relative","flex","flex-col","items-center","justify-center","space-y-2","h-[24rem]","w-[24rem]","border-4","border-gray-200","border-dashed","rounded-xl","hover:bg-gray-100","m-4","p-4","cursor-pointer"],[1,"text-4xl"],["type","file",1,"absolute","inset-0","opacity-0",3,"change"],[1,"flex","items-center","justify-center","px-4","pb-4"],["mat-button","",1,"clear","underline","w-48",3,"click"],[1,"flex","flex-col","items-center","justify-center","space-y-2","p-8","h-[24rem]","w-[24rem]"],["diameter","32"]],template:function(e,t){if(1&e&&(l.TgZ(0,"header",0),l.TgZ(1,"h2"),l._uU(2,"Import Catering Menu"),l.qZA(),l.YNc(3,Yn,3,0,"button",1),l.qZA(),l.YNc(4,Ln,10,0,"main",2),l.YNc(5,Sn,4,1,"ng-template",null,3,l.W1O)),2&e){const e=l.MAs(6);l.xp6(3),l.Q6J("ngIf",!t.loading),l.xp6(1),l.Q6J("ngIf",!t.loading)("ngIfElse",e)}},directives:[o.O5,O.lW,Xe.ZT,G.o,we.$g],styles:[""]}),e})(),$n=(()=>{class e extends Q.KG{constructor(e,t){super(),this._org=e,this._dialog=t,this._menu=new L.X([]),this._loading=new L.X(!1),this._currency=new L.X("USD"),this.menu=this._menu.asObservable(),this.loading=this._loading.asObservable(),this.currency=this._currency.asObservable(),this.subscription("building",this._org.active_building.subscribe(e=>(0,N.mG)(this,void 0,void 0,function*(){if(e){const t=(yield this.getCateringForZone(e.id)).map(e=>new Ct.U(e));this._currency.next(e.currency||"USD"),this._menu.next(t)}})))}get categories(){const e=this._menu.getValue();return(0,Q.Tw)(e.map(e=>e.category))}manageCateringOrder(e){var t;return(0,N.mG)(this,void 0,void 0,function*(){const n=this._dialog.open(Cn,{data:{order:e,menu:this.menu,loading:this.loading,getCateringConfig:e=>this.getCateringConfig(e),selectOptions:e=>this.selectOptions(e)}}),i=yield Promise.race([n.componentInstance.event.pipe((0,F.P)(e=>"done"===e.reason)).toPromise(),n.afterClosed().toPromise()]);return n.close(),(null===(t=null==i?void 0:i.metadata)||void 0===t?void 0:t.order)||e})}addItem(e=new Ct.U){return(0,N.mG)(this,void 0,void 0,function*(){const t=this._dialog.open(Ht,{data:{item:e,categories:this.categories}}),n=yield Promise.race([t.componentInstance.event.pipe((0,F.P)(e=>"done"===e.reason)).toPromise(),t.afterClosed().toPromise()]);if("done"!==(null==n?void 0:n.reason))return;const i=this._menu.getValue(),o=i.findIndex(t=>t.id===e.id);o>=0?i.splice(o,1,n.metadata.item):i.push(n.metadata.item),this.updateMenu(this._org.building.id,i).then(()=>{this._menu.next([...i]),t.close()},()=>t.componentInstance.loading=!1)})}addOption(e,t={}){return(0,N.mG)(this,void 0,void 0,function*(){const n=(0,Q.Tw)(e.options.map(e=>e.group)),i=this._dialog.open(an,{data:{parent:e,option:t,types:n}}),o=yield Promise.race([i.componentInstance.event.pipe((0,F.P)(e=>"done"===e.reason)).toPromise(),i.afterClosed().toPromise()]);if("done"!==(null==o?void 0:o.reason))return;const s=this._menu.getValue(),a=s.findIndex(t=>t.id===e.id);a>=0?s.splice(a,1,o.metadata.item):s.push(o.metadata.item),this.updateMenu(this._org.building.id,s).then(()=>{this._menu.next([...s]),i.close()},()=>i.componentInstance.loading=!1)})}selectOptions(e){return(0,N.mG)(this,void 0,void 0,function*(){const t=this._dialog.open(Pn,{data:{options:e}}),n=yield Promise.race([t.componentInstance.event.pipe((0,F.P)(e=>"done"===e.reason)).toPromise(),t.afterClosed().toPromise()]);return"done"!==(null==n?void 0:n.reason)?[]:(t.close(),n.metadata.options)})}deleteItem(e){return(0,N.mG)(this,void 0,void 0,function*(){const t=yield(0,Q._5)({title:"Delete Catering Item",content:`Are you sure you wish to remove the catering item ${e.name} from the menu?`,icon:{type:"icon",class:"material-icons",content:"delete"}},this._dialog);if("done"!==t.reason)return;t.loading("Removing catering item...");const n=this._menu.getValue().filter(t=>e.id!==t.id);this.updateMenu(this._org.building.id,n).then(()=>{this._menu.next([...n]),t.close()},()=>t.loading(""))})}deleteOption(e,t){return(0,N.mG)(this,void 0,void 0,function*(){const n=yield(0,Q._5)({title:"Delete Catering Item Option",content:`Are you sure you wish to remove the catering option "${t.name}" from "${e.name}"?`,icon:{type:"icon",class:"material-icons",content:"delete"}},this._dialog);if("done"!==n.reason)return;n.loading("Removing catering item option...");const i=this._menu.getValue();i.splice(i.findIndex(t=>t.id===e.id),1,new Ct.U(Object.assign(Object.assign({},e),{options:e.options.filter(e=>e.id!==t.id)}))),this.updateMenu(this._org.building.id,i).then(()=>{this._menu.next([...i]),n.close()},()=>n.loading(""))})}editConfig(){return(0,N.mG)(this,void 0,void 0,function*(){const e=yield this.getCateringConfig(this._org.building.id),t=this._menu.getValue(),n=(0,Q.Tw)((0,Q.xH)(t.map(e=>[e.category,...e.tags]))),i=this._dialog.open(Mt,{data:{config:e,types:n}}),o=yield Promise.race([i.componentInstance.event.pipe((0,F.P)(e=>"done"===e.reason)).toPromise(),i.afterClosed().toPromise()]);"done"===(null==o?void 0:o.reason)&&this.updateConfig(this._org.building.id,o.metadata).then(()=>i.close(),()=>i.componentInstance.loading=!1)})}importMenu(){return(0,N.mG)(this,void 0,void 0,function*(){const e=this._dialog.open(Dn),t=yield Promise.race([e.componentInstance.event.pipe((0,F.P)(e=>"done"===e.reason)).toPromise(),e.afterClosed().toPromise()]);if("done"!==(null==t?void 0:t.reason))return;e.componentInstance.loading="Updating menu...";const n=this._menu.getValue(),i=this._org.building,o=(0,Q.Tw)(t.metadata.concat(n),"id");yield this.updateMenu(i.id,o).catch(t=>{throw(0,Q.cB)("Error importing catering menu"),e.close(),t}),(0,Q.t5)(`Successfully imported catering menu. ${t.metadata.length} item(s) added.`),e.close()})}updateMenu(e,t){return(0,Vt.Ymr)(e,{id:e,name:"catering",details:t,description:`Catering menu for ${e}`}).toPromise()}getCateringForZone(e){return(0,N.mG)(this,void 0,void 0,function*(){const t=(yield(0,Vt.rlq)(e,"catering").toPromise()).details;return t instanceof Array?t:[]})}getCateringConfig(e=this._org.building.id){return(0,N.mG)(this,void 0,void 0,function*(){const t=(yield(0,Vt.rlq)(e,"catering_config").toPromise()).details;return t instanceof Array?t:[]})}updateConfig(e,t){return(0,Vt.Ymr)(e,{id:e,name:"catering_config",details:t,description:`Catering menu config for ${e}`}).toPromise()}addItemToOrder(e,t){let n=e.items;const i=n.find(e=>{var n,i;return e.id===t.id&&(null===(n=t.options)||void 0===n?void 0:n.length)===(null===(i=e.options)||void 0===i?void 0:i.reduce((e,n)=>e+(t.options.find(e=>n.id===e.id)?1:0),0))});return i?i.quantity+=1:n=n.concat([new Ct.U(Object.assign(Object.assign({},t),{quantity:1}))]),new rn.G(Object.assign(Object.assign({},e),{items:n,event:null}))}}return e.\u0275fac=function(t){return new(t||e)(l.LFG(E.w7),l.LFG(Xe.uw))},e.\u0275prov=l.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function Bn(e,t){1&e&&(l.TgZ(0,"div",9),l.TgZ(1,"label"),l._uU(2,"Host"),l.qZA(),l._UZ(3,"a-user-search-field",18),l.qZA())}function Gn(e,t){1&e&&(l.TgZ(0,"div",23),l._uU(1," Add catering "),l.qZA())}function Hn(e,t){if(1&e&&(l.TgZ(0,"div",24),l.TgZ(1,"div",25),l._uU(2),l.qZA(),l.TgZ(3,"div",26),l._uU(4),l.ALo(5,"currency"),l.qZA(),l.qZA()),2&e){const e=l.oxw(3);l.xp6(2),l.hij(" ",null==e.form?null:e.form.value.catering[0].item_count," item(s) "),l.xp6(2),l.hij(" ",l.lcZ(5,2,(null==e.form?null:e.form.value.catering[0].total_cost)/100)," ")}}function Vn(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"div",19),l.TgZ(1,"label"),l._uU(2,"Catering"),l.qZA(),l.TgZ(3,"an-action-field",20),l.NdJ("onAction",function(){return l.CHM(e),l.oxw(2).editCatering()}),l.YNc(4,Gn,2,0,"div",21),l.YNc(5,Hn,6,4,"div",22),l.qZA(),l.qZA()}if(2&e){const e=l.oxw(2);l.xp6(4),l.Q6J("ngIf",!(null!=e.form&&null!=e.form.value.catering&&e.form.value.catering.length)),l.xp6(1),l.Q6J("ngIf",null==e.form||null==e.form.value.catering?null:e.form.value.catering.length)}}i(4689),i(4019),i(8303),i(4914),i(205),i(3499),i(9005);const Rn=function(){return{standalone:!0}};function zn(e,t){if(1&e){const e=l.EpF();l.TgZ(0,"form",1),l.TgZ(1,"section",2),l.TgZ(2,"div",3),l.TgZ(3,"div",4),l.TgZ(4,"label"),l._uU(5,"Date"),l.qZA(),l.TgZ(6,"a-date-field",5),l._uU(7," Date and time must be in the future "),l.qZA(),l.qZA(),l.TgZ(8,"div",4),l.TgZ(9,"label"),l._uU(10,"Start Time"),l.qZA(),l.TgZ(11,"a-time-field",6),l.NdJ("ngModelChange",function(t){return l.CHM(e),l.oxw().form.patchValue({date:t})}),l.qZA(),l.qZA(),l.TgZ(12,"div",4),l.TgZ(13,"label"),l._uU(14,"End Time"),l.qZA(),l._UZ(15,"a-duration-field",7),l.qZA(),l.qZA(),l.qZA(),l.TgZ(16,"section",2),l.YNc(17,Bn,4,0,"div",8),l.TgZ(18,"div",9),l.TgZ(19,"label"),l._uU(20,"Attendees"),l.qZA(),l._UZ(21,"a-user-list-field",10),l.qZA(),l.qZA(),l.TgZ(22,"section",2),l.TgZ(23,"div",11),l.TgZ(24,"div",12),l.TgZ(25,"label"),l._uU(26,"Meeting Subject "),l.TgZ(27,"span"),l._uU(28,"*"),l.qZA(),l.qZA(),l.TgZ(29,"mat-form-field",13),l._UZ(30,"input",14),l.TgZ(31,"mat-error"),l._uU(32,"Meeting Subject is required"),l.qZA(),l.qZA(),l.qZA(),l.TgZ(33,"div",15),l.TgZ(34,"label"),l._uU(35,"Notes"),l.qZA(),l.TgZ(36,"mat-form-field",13),l._UZ(37,"textarea",16),l.qZA(),l.qZA(),l.YNc(38,Vn,6,2,"div",17),l.qZA(),l.qZA(),l.qZA()}if(2&e){const e=l.oxw();let t;l.Q6J("formGroup",e.form),l.xp6(11),l.Q6J("ngModel",e.form.value.date)("ngModelOptions",l.DdM(8,Rn)),l.xp6(4),l.Q6J("time",null==(t=e.form.get("date"))?null:t.value)("max",e.max_duration),l.xp6(2),l.Q6J("ngIf",e.can_book_for_others),l.xp6(4),l.Q6J("hideActions",e.hide_actions),l.xp6(17),l.Q6J("ngIf",e.has_catering)}}let Wn=(()=>{class e{constructor(e,t){this._catering=e,this._settings=t,this.editCatering=()=>(0,N.mG)(this,void 0,void 0,function*(){return this.form.patchValue({catering:[yield this._catering.manageCateringOrder((this.form.value.catering?this.form.value.catering[0]:null)||new rn.G)]})})}get has_catering(){return!!this._settings.get("app.events.has_catering")}get hide_actions(){return!!this._settings.get("app.events.hide_user_actions")}get can_book_for_others(){return this._settings.get("app.events.can_book_for_others")}get max_duration(){return this._settings.get("app.events.max_duration")||240}}return e.\u0275fac=function(t){return new(t||e)(l.Y36($n),l.Y36(Q.gb))},e.\u0275cmp=l.Xpm({type:e,selectors:[["detailed-book-space-form"]],inputs:{form:"form"},decls:1,vars:1,consts:[[3,"formGroup",4,"ngIf"],[3,"formGroup"],[1,"mb-4","border-b","border-gray-300"],[1,"flex","flex-col","sm:flex-row","space-x-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col","flex-1","w-full","sm:w-1/3"],["formControlName","date"],[3,"ngModel","ngModelOptions","ngModelChange"],["formControlName","duration",3,"time","max"],["class","flex flex-col w-[640px] max-w-[calc(100%-2rem)] mx-auto",4,"ngIf"],[1,"flex","flex-col","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],["formControlName","attendees",3,"hideActions"],[1,"w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[1,"flex","flex-col"],["appearance","outline"],["matInput","","formControlName","title","placeholder","Meeting title"],[1,"flex","flex-col","resize-y"],["matInput","","formControlName","body","placeholder","Add meeting notes here..."],["class","flex flex-col mb-4",4,"ngIf"],["formControlName","organiser"],[1,"flex","flex-col","mb-4"],[3,"onAction"],["class","opacity-40",4,"ngIf"],["class","flex items-center",4,"ngIf"],[1,"opacity-40"],[1,"flex","items-center"],[1,"flex-1","w-1/2"],[1,"text-xs","opacity-60","px-4"]],template:function(e,t){1&e&&l.YNc(0,zn,39,9,"form",0),2&e&&l.Q6J("ngIf",t.form)},directives:[o.O5,s._Y,s.JL,s.sg,W.Q,s.JJ,s.u,ee.N,s.On,te.B,ie.E,X.KE,M.Nt,s.Fj,X.TO,ne.d,H.s],pipes:[o.H9],styles:[""]}),e})(),Xn=(()=>{class e{constructor(e,t){this._state=e,this._router=t,this.time=0,this.capacity=0,this.quick_times=[{name:"Now",value:0},{name:"Later Today",value:120},{name:"Tomorrow",value:(0,Ee.Z)((0,z.Z)(new Date,1),9).valueOf()}],this.quick_capacities=[{name:"Any Capacity",value:0},{name:"Small (1 - 4)",value:1},{name:"Medium (5 - 12)",value:5},{name:"Large (13 - 32)",value:13},{name:"Huge (32+)",value:33}],this.clearForm=()=>{this.time=this.capacity=0,this._state.clearForm()}}get is_edit(){var e,t;return!!(null===(t=null===(e=this.form)||void 0===e?void 0:e.get("id"))||void 0===t?void 0:t.value)}get form(){return this._state.form}quickBook(){this.form.patchValue({date:(this.time<1440?(0,Pe.Z)((0,Ye.Z)(new Date,{nearestTo:5}),this.time):(0,Ee.Z)((0,z.Z)(new Date,1),8)).valueOf(),title:"Ad-hoc Meeting"}),this._state.setOptions({capacity:this.capacity}),this._router.navigate(["/book","spaces","find"])}findSpace(){this.form.markAllAsTouched(),this.form.valid&&this._router.navigate(["/book","spaces","find"])}confirmBooking(){this.form.markAllAsTouched(),this.form.valid&&this._router.navigate(["/book","spaces","confirm"])}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(He.MH),l.Y36(A.F0))},e.\u0275cmp=l.Xpm({type:e,selectors:[["space-flow-form"]],decls:23,vars:5,consts:[["form","",1,"flex-1","min-h-[50%]"],[1,"text-xl","uppercase","font-medium","mb-2","mt-4","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto"],[3,"form"],[1,"flex","flex-col","sm:flex-row","items-center","justify-center","space-x-0","space-y-2","sm:space-y-0","sm:space-x-2","w-[640px]","max-w-[calc(100%-2rem)]","mx-auto","mb-4"],["mat-button","","clear","",1,"sm:flex-1","w-full","sm:w-auto","h-[2.75rem]","inverse",3,"click"],[1,"flex","items-center","justify-center"],[1,"text-xl"],[1,"ml-2","mx-4"],["mat-button","","find-space","",1,"sm:flex-1","w-full","sm:w-auto","h-[2.75rem]",3,"click"],["mat-button","","standalone","",1,"sm:flex-1","w-full","sm:w-auto","h-[2.75rem]",3,"click"]],template:function(e,t){1&e&&(l.TgZ(0,"section",0),l.TgZ(1,"h2",1),l._uU(2),l.qZA(),l._UZ(3,"detailed-book-space-form",2),l.TgZ(4,"div",3),l.TgZ(5,"button",4),l.NdJ("click",function(){return t.clearForm()}),l.TgZ(6,"div",5),l.TgZ(7,"app-icon",6),l._uU(8,"clear"),l.qZA(),l.TgZ(9,"span",7),l._uU(10),l.qZA(),l.qZA(),l.qZA(),l.TgZ(11,"button",8),l.NdJ("click",function(){return t.findSpace()}),l.TgZ(12,"div",5),l.TgZ(13,"app-icon",6),l._uU(14,"search"),l.qZA(),l.TgZ(15,"span",7),l._uU(16),l.qZA(),l.qZA(),l.qZA(),l.TgZ(17,"button",9),l.NdJ("click",function(){return t.confirmBooking()}),l.TgZ(18,"div",5),l.TgZ(19,"app-icon",6),l._uU(20,"event_available"),l.qZA(),l.TgZ(21,"span",7),l._uU(22),l.qZA(),l.qZA(),l.qZA(),l.qZA(),l.qZA()),2&e&&(l.xp6(2),l.hij(" ",t.is_edit?"Edit":"Detailed"," Space Booking "),l.xp6(1),l.Q6J("form",t.form),l.xp6(7),l.Oqu(t.is_edit?"Cancel Edit":"Clear Form"),l.xp6(6),l.Oqu(t.is_edit?"Update Spaces":"Find Space"),l.xp6(6),l.Oqu(t.is_edit?"Confirm changes":"Book without Space"))},directives:[Wn,O.lW,G.o],styles:["[_nghost-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column;overflow:auto}[quick][_ngcontent-%COMP%]{background-color:#007ac8}"]}),e})();function Kn(e,t){1&e&&(l.ynx(0),l._UZ(1,"space-flow-find"),l.BQk())}function ei(e,t){1&e&&(l.ynx(0),l._UZ(1,"space-flow-confirm"),l.BQk())}function ti(e,t){if(1&e&&(l.ynx(0),l._UZ(1,"flow-success",4),l.BQk()),2&e){const e=l.oxw();l.xp6(1),l.Q6J("calendar",null==e.last_success?null:e.last_success.host)}}function ni(e,t){1&e&&(l.ynx(0),l._UZ(1,"space-flow-form"),l.BQk())}let ii=(()=>{class e extends Q.KG{constructor(e,t){super(),this._state=e,this._route=t}get view(){return this._state.view}get last_success(){return this._state.last_success}ngOnInit(){this._state.loadForm(),this._state.form||this._state.newForm(),this.subscription("route.params",this._route.paramMap.subscribe(e=>{e.has("step")&&this._state.setView(e.get("step"))})),this.subscription("route.query",this._route.queryParamMap.subscribe(e=>{e.has("success")&&this._state.setView(e.get("success"))}))}}return e.\u0275fac=function(t){return new(t||e)(l.Y36(He.MH),l.Y36(A.gz))},e.\u0275cmp=l.Xpm({type:e,selectors:[["placeos-book-space-flow"]],features:[l.qOj],decls:6,vars:4,consts:[[1,"bg-white","h-full","w-full"],[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[3,"calendar"]],template:function(e,t){1&e&&(l.TgZ(0,"div",0),l.ynx(1,1),l.YNc(2,Kn,2,0,"ng-container",2),l.YNc(3,ei,2,0,"ng-container",2),l.YNc(4,ti,2,1,"ng-container",2),l.YNc(5,ni,2,0,"ng-container",3),l.BQk(),l.qZA()),2&e&&(l.xp6(1),l.Q6J("ngSwitch",t.view),l.xp6(1),l.Q6J("ngSwitchCase","find"),l.xp6(1),l.Q6J("ngSwitchCase","confirm"),l.xp6(1),l.Q6J("ngSwitchCase","success"))},directives:[o.RF,o.n9,o.ED,mt,wt,je,Xn],styles:["[_nghost-%COMP%]{height:100%;width:100%}"]}),e})();var oi=i(1781);const si=[{path:"",component:q,children:[{path:"code",component:I},{path:"desks",redirectTo:"desks/form"},{path:"desks/:step",component:Ge},{path:"spaces",redirectTo:"spaces/form"},{path:"spaces/:step",component:ii},{path:"*",redirectTo:"spaces/form"}]},{path:"*",redirectTo:"spaces/form"}];let ai=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=l.oAB({type:e}),e.\u0275inj=l.cJS({imports:[[o.ez,oi.v,s.u5,s.UX,w,A.Bz.forChild(si)]]}),e})()}}]);
//# sourceMappingURL=apps_workplace_src_app_book_book_module_ts.js.map