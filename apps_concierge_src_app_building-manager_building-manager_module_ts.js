"use strict";(self.webpackChunkconcierge=self.webpackChunkconcierge||[]).push([["apps_concierge_src_app_building-manager_building-manager_module_ts"],{9075:(J,Z,l)=>{l.r(Z),l.d(Z,{BuildingManagerModule:()=>St});var p=l(26575),c=l(28849),B=l(92649),b=l(97910),A=l(46514),y=l(59524),f=l(71670),m=l(34592),x=l(93121),d=l(47298),_=l(70462),P=l(28159),I=l(47422),u=l(17401),t=l(29039),v=l(94888),M=l(71268),L=l(99674),R=l(96355),h=l(10257),N=l(33910),U=l(99892);function G(o,r){if(1&o&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e.id),t.xp6(),t.hij(" ",e.display_name||e.name," ")}}function F(o,r){if(1&o&&(t.TgZ(0,"div",5)(1,"label",19),t.SDv(2,20),t.qZA(),t.TgZ(3,"mat-form-field",8)(4,"mat-select",21)(5,"mat-option",22),t._uU(6,"None"),t.qZA(),t.YNc(7,G,2,2,"mat-option",14),t.ALo(8,"async"),t.qZA()()()),2&o){const e=t.oxw(3);t.xp6(5),t.Q6J("value",e.default_parent),t.xp6(2),t.Q6J("ngForOf",t.lcZ(8,2,e.region_list))}}function z(o,r){if(1&o&&(t.TgZ(0,"mat-option",22),t._uU(1),t.qZA()),2&o){const e=r.$implicit;t.Q6J("value",e),t.xp6(),t.Oqu(e)}}function q(o,r){1&o&&(t.TgZ(0,"mat-option",23),t._uU(1," No matching timezones "),t.qZA()),2&o&&t.Q6J("disabled",!0)}function D(o,r){if(1&o&&(t.TgZ(0,"form",3),t.YNc(1,F,9,4,"div",4),t.ALo(2,"async"),t.TgZ(3,"div",5)(4,"label",6),t.SDv(5,7),t.qZA(),t.TgZ(6,"mat-form-field",8),t._UZ(7,"input",9),t.qZA()(),t.TgZ(8,"div",5)(9,"label",6),t.SDv(10,10),t.qZA(),t.TgZ(11,"mat-form-field",8)(12,"app-icon",11),t._uU(13,"search"),t.qZA(),t._UZ(14,"input",12),t.qZA(),t.TgZ(15,"mat-autocomplete",null,13),t.YNc(17,z,2,2,"mat-option",14)(18,q,2,1,"mat-option",15),t.qZA()(),t.TgZ(19,"div",5)(20,"label",16),t.SDv(21,17),t.qZA(),t.TgZ(22,"mat-form-field",8),t._UZ(23,"input",18),t.qZA()()()),2&o){const e=t.MAs(16),i=t.oxw(2);let n;t.Q6J("formGroup",i.form),t.xp6(),t.Q6J("ngIf",null==(n=t.lcZ(2,5,i.region_list))?null:n.length),t.xp6(13),t.Q6J("matAutocomplete",e),t.xp6(3),t.Q6J("ngForOf",i.filtered_timezones),t.xp6(),t.Q6J("ngIf",!i.timezones.length)}}function k(o,r){if(1&o&&(t.ynx(0),t.YNc(1,D,24,7,"form",2),t.BQk()),2&o){const e=t.oxw();t.xp6(),t.Q6J("ngIf",e.form)}}function Q(o,r){1&o&&(t.TgZ(0,"div",24),t._UZ(1,"mat-spinner",25),t.TgZ(2,"p",26),t._uU(3,"Saving building..."),t.qZA()())}let Y=(()=>{class o extends m.cx{get default_parent(){return this._org.organisation.id}constructor(e){super(),this._org=e,this.building=null,this.save=0,this.loading=!1,this.loadingChange=new t.vpe,this.done=new t.vpe,this.timezones=[],this.filtered_timezones=[],this.region_list=this._org.region_list,this.form=new c.cw({id:new c.NI(""),parent_id:new c.NI(this._org.organisation.id,[c.kI.required]),display_name:new c.NI("",[c.kI.required]),timezone:new c.NI(Intl?.DateTimeFormat()?.resolvedOptions()?.timeZone||""),location:new c.NI("")})}ngOnInit(){this._updateTimezoneList(),this.subscription("tz-change",this.form.valueChanges.subscribe(()=>this._updateTimezoneList())),this.building&&this.form.patchValue(this.building)}ngOnChanges(e){e.building&&this.building&&this.form.patchValue(this.building),e.save&&this.save&&this.saveChanges()}saveChanges(){var e=this;return(0,f.Z)(function*(){if(e.form.patchValue({parent_id:e.form.value.parent_id||e._org.organisation.id}),!e.form.valid)return(0,m.cB)(`Some form fields are invalid. [${(0,m.RD)(e.form).join(", ")}]`);const i=e.form.getRawValue();e.loading=!0,e.loadingChange.emit(!0);const n={...i,tags:["building"],name:`BLD ${(0,d.N9E)().description} ${i.display_name}`},s=yield(i.id?(0,d.BfP)(i.id,n):(0,d.ri3)(n)).toPromise().catch(a=>{throw(0,m.cB)(`Error saving building: ${a.message||a.error||a}`),e.loading=!1,e.loadingChange.emit(!1),a});(0,m.t5)("Successfully saved building."),e.loading=!1,e.loadingChange.emit(!1),e.done.emit(s)})()}_updateTimezoneList(){const e=this.form?.value?.timezone||"";this.timezones=m.sM,this.filtered_timezones=this.timezones.filter(i=>i.toLowerCase().includes(e.toLowerCase()))}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(x.w7))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["building-form"]],inputs:{building:"building",save:"save",loading:"loading"},outputs:{loadingChange:"loadingChange",done:"done"},features:[t.qOj,t.TTD],decls:3,vars:2,consts:()=>{let e,i,n,s;return e=$localize`:@@displayNameLabel␟8d766661ed5e178519720ec8e959d2a737f600a6␟1377207093952578744: Display Name: `,i=$localize`:@@displayNameLabel␟dbd34479df566856113383ebef3a2cb98e494642␟7608711767660448404: Timezone: `,n=$localize`:@@displayNameLabel␟8dfcfa872af9be0ad27411537a6944e3d33a278f␟2698045878883517755: Location: `,s=$localize`:@@displayNameLabel␟88b397510643ec67156f0eb2d333d4012801a8c1␟2672381863752151894: Region: `,[[4,"ngIf","ngIfElse"],["load_state",""],["building","","class","flex flex-col w-[36rem] max-w-[calc(100vw-4rem)]",3,"formGroup",4,"ngIf"],["building","",1,"flex","flex-col","w-[36rem]","max-w-[calc(100vw-4rem)]",3,"formGroup"],["class","flex flex-col",4,"ngIf"],[1,"flex","flex-col"],["for","display-name"],e,["appearance","outline"],["matInput","","name","display-name","placeholder","Display Name","formControlName","display_name"],i,["matPrefix","",1,"text-2xl"],["matInput","","formControlName","timezone","placeholder","Building timezone",3,"matAutocomplete"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"disabled",4,"ngIf"],["for","address"],n,["matInput","","name","address","placeholder","Location or Address...","formControlName","location"],["for","region"],s,["name","region","formControlName","parent_id","placeholder","Select Region..."],[3,"value"],[3,"disabled"],[1,"flex","flex-col","items-center","justify-center","w-64","h-64"],["diameter","32"],[1,"mt-4"]]},template:function(i,n){if(1&i&&t.YNc(0,k,2,1,"ng-container",0)(1,Q,4,0,"ng-template",null,1,t.W1O),2&i){const s=t.MAs(2);t.Q6J("ngIf",!n.loading)("ngIfElse",s)}},dependencies:[p.sg,p.O5,c._Y,c.Fj,c.JJ,c.JL,M.KE,M.qo,L.Nt,R.gD,h.ey,N.Ou,U.XC,U.ZL,c.sg,c.u,v.o,p.Ov]})}return o})();function $(o,r){1&o&&(t.TgZ(0,"button",4)(1,"app-icon"),t._uU(2,"close"),t.qZA()())}function j(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"footer",5)(1,"button",6),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.save())}),t._uU(2,"Save"),t.qZA()()}}let K=(()=>{class o{constructor(e,i){this._data=e,this._dialog_ref=i,this.loading=!1,this.save_state=0,this.building=this._data,this.close=n=>this._dialog_ref.close(n),this.save=()=>this.save_state=Date.now()}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(u.WI),t.Y36(u.so))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["building-modal"]],decls:7,vars:6,consts:[["btn","","icon","","mat-dialog-close","",4,"ngIf"],[1,"max-h-[65vh]","overflow-y-auto","overflow-x-hidden","p-4"],[3,"building","save","loading","loadingChange","done"],["class","p-2 flex justify-end border-t border-base-200",4,"ngIf"],["btn","","icon","","mat-dialog-close",""],[1,"p-2","flex","justify-end","border-t","border-base-200"],["btn","",1,"w-32",3,"click"]],template:function(i,n){1&i&&(t.TgZ(0,"header")(1,"h2"),t._uU(2),t.qZA(),t.YNc(3,$,3,0,"button",0),t.qZA(),t.TgZ(4,"main",1)(5,"building-form",2),t.NdJ("loadingChange",function(a){return n.loading=a})("done",function(a){return n.close(a)}),t.qZA()(),t.YNc(6,j,3,0,"footer",3)),2&i&&(t.xp6(2),t.hij("",n.building.id?"Edit":"Add"," Building"),t.xp6(),t.Q6J("ngIf",!n.loading),t.xp6(2),t.Q6J("building",n.building)("save",n.save_state)("loading",n.loading),t.xp6(),t.Q6J("ngIf",!n.loading))},dependencies:[p.O5,u.ZT,v.o,Y]})}return o})();var H=l(66229),w=l(43811),X=l(28442);function V(o,r){1&o&&(t.TgZ(0,"button",6)(1,"app-icon",7),t._uU(2,"close"),t.qZA()())}function W(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"main",8)(1,"label"),t._uU(2,"Before Event"),t.qZA(),t.TgZ(3,"a-duration-field",9),t.NdJ("ngModelChange",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.settings.time_before=n)}),t.qZA(),t.TgZ(4,"label"),t._uU(5,"After Event"),t.qZA(),t.TgZ(6,"a-duration-field",9),t.NdJ("ngModelChange",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.settings.time_after=n)}),t.qZA(),t.TgZ(7,"label"),t._uU(8,"Event Types"),t.qZA(),t.TgZ(9,"mat-form-field",10)(10,"mat-select",11),t.NdJ("ngModelChange",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.settings.resources=n)}),t.TgZ(11,"mat-option",12),t._uU(12," Desks "),t.qZA(),t.TgZ(13,"mat-option",13),t._uU(14," Visitors "),t.qZA(),t.TgZ(15,"mat-option",14),t._uU(16," Parking "),t.qZA()()()()}if(2&o){const e=t.oxw();t.xp6(3),t.Q6J("min",0)("ngModel",e.settings.time_before),t.xp6(3),t.Q6J("min",0)("ngModel",e.settings.time_after),t.xp6(4),t.Q6J("ngModel",e.settings.resources)}}function tt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"footer",15)(1,"button",16),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.save())}),t._uU(2,"Save"),t.qZA()()}}function et(o,r){if(1&o&&(t.TgZ(0,"main",17),t._UZ(1,"mat-spinner",18),t.TgZ(2,"p"),t._uU(3),t.qZA()()),2&o){const e=t.oxw();t.xp6(),t.Q6J("diameter",48),t.xp6(2),t.Oqu(e.loading)}}let nt=(()=>{class o{constructor(e,i,n){this._id=e,this._dialog_ref=i,this._settings=n,this.loading="",this.id=this._id,this.settings={}}ngOnInit(){this.loadSettings(this.id)}loadSettings(e){var i=this;return(0,f.Z)(function*(){i.loading="Loading auto-release settings for building...",i.settings={};const s=(yield(0,d.oOs)({parent_id:e}).pipe((0,I.U)(a=>a.data)).toPromise()).find(a=>a.encryption_level===d.sUp.None);if(s){try{i.settings=w.zD(s.settings_string)?.auto_release||{}}catch{}i.loading=""}})()}save(){var e=this;return(0,f.Z)(function*(){e.loading="Saving changes to auto-release settings...";let n=(yield(0,d.oOs)({parent_id:e.id}).pipe((0,I.U)(T=>T.data)).toPromise()).find(T=>T.encryption_level===d.sUp.None);n||(n=new d.iJM({parent_id:e.id,encryption_level:d.sUp.None,settings_string:""}));let s={};try{s=w.zD(n.settings_string)||{}}catch{}n.settings_string=w.$w({...s,auto_release:e.settings}),n.id?yield(0,d.VPJ)(n.id,n).toPromise():yield(0,d.zZM)(n).toPromise();const a=e._settings.get("app.workplace_metadata_key")||"workplace_app",C=(yield(0,d.rlq)(e.id,a).toPromise()).details||{};C.auto_release=e.settings,yield(0,d.Ymr)(e.id,{name:a,details:C,description:""}).toPromise(),(0,m.t5)("Auto-release settings updated"),e.loading="",e._dialog_ref.close()})()}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(u.WI),t.Y36(u.so),t.Y36(m.gb))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["auto-release-modal"]],decls:8,vars:4,consts:[[1,"flex","items-center","justify-between","border-b","border-gray-300","p-4"],[1,"text-xl","font-medium"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","px-2 w-[20rem]",4,"ngIf","ngIfElse"],["class","p-4 flex justify-end",4,"ngIf"],["load_state",""],["icon","","matRipple","","mat-dialog-close",""],[1,"text-2xl"],[1,"px-2","w-[20rem]"],[3,"min","ngModel","ngModelChange"],["appearance","outline",1,"w-full"],["multiple","","placeholder","Set Event Types...",3,"ngModel","ngModelChange"],["value","desk"],["value","visitor"],["value","parking"],[1,"p-4","flex","justify-end"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-32","space-y-2"],[3,"diameter"]],template:function(i,n){if(1&i&&(t.TgZ(0,"header",0)(1,"h3",1),t._uU(2,"Auto-Release Settings"),t.qZA(),t.YNc(3,V,3,0,"button",2),t.qZA(),t.YNc(4,W,17,5,"main",3)(5,tt,3,0,"footer",4)(6,et,4,2,"ng-template",null,5,t.W1O)),2&i){const s=t.MAs(7);t.xp6(3),t.Q6J("ngIf",!n.loading),t.xp6(),t.Q6J("ngIf",!n.loading)("ngIfElse",s),t.xp6(),t.Q6J("ngIf",!n.loading)}},dependencies:[p.O5,c.JJ,c.On,M.KE,R.gD,h.ey,N.Ou,u.ZT,h.wG,X.B,v.o]})}return o})();var it=l(56658);function ot(o,r){1&o&&(t.TgZ(0,"button",6)(1,"app-icon",7),t._uU(2,"close"),t.qZA()())}function st(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"main",8)(1,"mat-form-field",9)(2,"textarea",10),t.NdJ("ngModelChange",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.induction_details=n)}),t.qZA()(),t.TgZ(3,"mat-checkbox",11),t.NdJ("ngModelChange",function(n){t.CHM(e);const s=t.oxw();return t.KtG(s.is_enabled=n)}),t._uU(4," Enable Induction for Building "),t.qZA()()}if(2&o){const e=t.oxw();t.xp6(2),t.Q6J("ngModel",e.induction_details),t.xp6(),t.Q6J("ngModel",e.is_enabled)}}function at(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"footer",12)(1,"button",13),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.save())}),t._uU(2,"Save"),t.qZA()()}}function lt(o,r){if(1&o&&(t.TgZ(0,"main",14),t._UZ(1,"mat-spinner",15),t.TgZ(2,"p"),t._uU(3),t.qZA()()),2&o){const e=t.oxw();t.xp6(),t.Q6J("diameter",48),t.xp6(2),t.Oqu(e.loading)}}let rt=(()=>{class o{constructor(e,i,n,s){this._zone_id=e,this._settings=i,this._org=n,this._dialog_ref=s,this.loading="",this.induction_details="",this.is_enabled=!1,this.settings={}}ngOnInit(){this._zone_id&&this.loadSettings()}loadSettings(){var e=this;return(0,f.Z)(function*(){e.loading="Loading induction settings for building...";const i=e._settings.get("app.visitor_kiosk_app")||"visitor-kiosk_app";e.settings={};const[n,s,a]=yield Promise.all([yield(0,d.rlq)(e._zone_id,i).toPromise(),yield(0,d.rlq)(e._org.organisation.id,i).toPromise(),yield(0,d.rlq)(e._org.organisation.id,"settings").toPromise()]);e.settings={...a.details,...s.details,...n.details},e.induction_details=e.settings.induction_details||"",e.is_enabled=e.settings.induction_enabled??!1,e.loading=""})()}save(){var e=this;return(0,f.Z)(function*(){e.loading="Saving induction settings...";const i=e._settings.get("app.visitor_kiosk_app")||"visitor-kiosk_app";e._dialog_ref.disableClose=!0;const n=yield(0,d.rlq)(e._zone_id,i).toPromise(),s={...n.details,induction_details:e.induction_details,induction_enabled:e.is_enabled},a=yield(0,d.Ymr)(e._zone_id,{name:n.name||i,description:n.description||"",details:s}).toPromise().catch(g=>{console.error(g),(0,m.cB)("Error saving induction settings")});e.loading="",a&&((0,m.t5)("Successfully saved induction settings"),e._dialog_ref.close())})()}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(u.WI),t.Y36(m.gb),t.Y36(x.w7),t.Y36(u.so))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["induction-settings-modal"]],decls:8,vars:4,consts:[[1,"flex","items-center","justify-between","border-b","border-gray-300","p-4"],[1,"text-xl","font-medium"],["icon","","matRipple","","mat-dialog-close","",4,"ngIf"],["class","p-4 flex flex-col space-y-2",4,"ngIf","ngIfElse"],["class","px-4 pb-4 flex justify-end",4,"ngIf"],["load_state",""],["icon","","matRipple","","mat-dialog-close",""],[1,"text-2xl"],[1,"p-4","flex","flex-col","space-y-2"],["appearance","outline",1,"w-[36rem]","max-w-[80vw]","h-[50vh]"],["matInput","","placeholder","Induction Details",1,"w-[34rem]","max-w-[calc(80vw-2rem)]","h-[calc(50vh-2rem)]","resize-none",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],[1,"px-4","pb-4","flex","justify-end"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"flex","flex-col","items-center","justify-center","p-32","space-y-2"],[3,"diameter"]],template:function(i,n){if(1&i&&(t.TgZ(0,"header",0)(1,"h3",1),t._uU(2,"Induction Settings"),t.qZA(),t.YNc(3,ot,3,0,"button",2),t.qZA(),t.YNc(4,st,5,2,"main",3)(5,at,3,0,"footer",4)(6,lt,4,2,"ng-template",null,5,t.W1O)),2&i){const s=t.MAs(7);t.xp6(3),t.Q6J("ngIf",!n.loading),t.xp6(),t.Q6J("ngIf",!n.loading)("ngIfElse",s),t.xp6(),t.Q6J("ngIf",!n.loading)}},dependencies:[p.O5,c.Fj,c.JJ,c.On,M.KE,L.Nt,it.oG,N.Ou,u.ZT,h.wG,v.o]})}return o})();var dt=l(60702);function ct(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",6)(1,"input",7),t.NdJ("ngModelChange",function(n){const a=t.CHM(e).index,g=t.oxw();return t.KtG(g.item_list[a].name=n)}),t.qZA(),t.TgZ(2,"input",8),t.NdJ("ngModelChange",function(n){const a=t.CHM(e).index,g=t.oxw();return t.KtG(g.item_list[a].email=n)}),t.qZA(),t.TgZ(3,"button",9),t.NdJ("click",function(){const s=t.CHM(e).index,a=t.oxw();return t.KtG(a.item_list.splice(s,1))}),t.TgZ(4,"app-icon"),t._uU(5,"close"),t.qZA()()()}if(2&o){const e=r.index,i=t.oxw();t.xp6(),t.Q6J("ngModel",i.item_list[e].name),t.xp6(),t.Q6J("ngModel",i.item_list[e].email)}}let gt=(()=>{class o{constructor(e,i,n){this._bld_id=e,this._settings=i,this._dialog_ref=n,this.item_list=[],this.loading=!1,this.identify=(s,a)=>s}ngOnInit(){var e=this;return(0,f.Z)(function*(){const i=e._settings.get("app.workplace_metadata_key")||"workplace_app",s=(yield(0,d.rlq)(e._bld_id,i).toPromise())?.details?.support_issue_types||[];e.item_list=s})()}save(){var e=this;return(0,f.Z)(function*(){const i=e._settings.get("app.workplace_metadata_key")||"workplace_app";e.loading=!0;const n=e.item_list.filter(g=>g),s=yield(0,d.rlq)(e._bld_id,i).toPromise();s.details.support_issue_types=n;const a=yield(0,d.Ymr)(e._bld_id,{name:i,details:s.details,description:s.description||""}).toPromise().catch(g=>{(0,m.cB)(`Failed to save issue types. ${g}`)});e.loading=!1,a&&e._dialog_ref.close()})()}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(u.WI),t.Y36(m.gb),t.Y36(u.so))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["item-list-modal"]],decls:13,vars:2,consts:[["icon","","matRipple","","mat-dialog-close",""],[1,"w-[36rem]","overflow-auto","h-[50vh]","p-2","space-y-2"],["btn","","matRipple","",1,"w-full",3,"click"],["class","w-full flex items-center space-x-2",4,"ngFor","ngForOf","ngForTrackBy"],[1,"flex","items-center","justify-end","p-2","border-t","border-base-200"],["btn","","matRipple","",1,"w-32",3,"click"],[1,"w-full","flex","items-center","space-x-2"],["type","text","placeholder","Issue Name",1,"flex-1","border","border-base-200","px-4","py-3","rounded",3,"ngModel","ngModelChange"],["type","email","placeholder","Issue Email",1,"flex-[2]","border","border-base-200","px-4","py-3","rounded",3,"ngModel","ngModelChange"],["icon","","matRipple","","matTooltip","Remove Item",3,"click"]],template:function(i,n){1&i&&(t.TgZ(0,"header")(1,"h2"),t._uU(2,"Support Request Issue Types"),t.qZA(),t.TgZ(3,"button",0)(4,"app-icon"),t._uU(5,"close"),t.qZA()()(),t.TgZ(6,"main",1)(7,"button",2),t.NdJ("click",function(){return n.item_list.push({name:"",email:""})}),t._uU(8," Add Item "),t.qZA(),t.YNc(9,ct,6,2,"div",3),t.qZA(),t.TgZ(10,"footer",4)(11,"button",5),t.NdJ("click",function(){return n.save()}),t._uU(12,"Save"),t.qZA()()),2&i&&(t.xp6(9),t.Q6J("ngForOf",n.item_list)("ngForTrackBy",n.identify))},dependencies:[p.sg,c.Fj,c.JJ,c.On,dt.gM,u.ZT,h.wG,v.o]})}return o})(),E=(()=>{class o{constructor(e,i){this._org=e,this._dialog=i,this._options=new _.X({}),this._change=new _.X(0),this.options=this._options.asObservable(),this.filtered_buildings=(0,P.aj)([this._org.region_list,this._org.building_list,this._options,this._org.initialised]).pipe((0,I.U)(([n,s,a])=>{a.zone&&(s=s.filter(g=>g.parent_id===a.zone)),a.search&&(s=s.filter(g=>g.name.toLowerCase().includes(a.search.toLowerCase())));for(const g of s){const C=n.find(T=>T.id===g.parent_id);C&&(g.region=C.display_name||C.name),g.level_count=this._org.levelsForBuilding(g)?.length||0}return s}))}setFilters(e){this._options.next({...this._options.getValue(),...e})}setSearchString(e){this._options.next({...this._options.getValue(),search:e})}editBuilding(e=new d.TT8){this._dialog.open(K,{data:e}).afterClosed().subscribe(n=>{n&&this._org.addZone(n)})}editBuildingMetadata(e=new d.TT8){this._dialog.open(H.K,{data:{zone:e}}).afterClosed().subscribe(n=>{n&&setTimeout(()=>location.reload(),300)})}setAutoRelease(e){e?.id&&this._dialog.open(nt,{data:e.id})}setInduction(e){e?.id&&this._dialog.open(rt,{data:e.id})}setSupportIssueTypes(e){e?.id&&this._dialog.open(gt,{data:e.id})}removeBuilding(e){var i=this;return(0,f.Z)(function*(){const n=yield(0,m._5)({title:"Remove Building",content:`Are you sure you want to remove the building "${e.name}"?`,icon:{content:"delete_forever"},confirm_text:"Remove"},i._dialog);if("done"!==n.reason)return n.close();n.loading("Removing building..."),yield(0,d.Jwl)(e.id).toPromise(),i._org.removeZone({id:e.id,tags:["building"]}),(0,m.t5)("Successfully removed building."),n.close()})()}static#t=this.\u0275fac=function(i){return new(i||o)(t.LFG(x.w7),t.LFG(u.uw))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var mt=l(33005),_t=l(19842),S=l(78128),ut=l(27442),pt=l(78075),ft=l(6612);function ht(o,r){if(1&o&&(t._uU(0),t.ALo(1,"level"),t.ALo(2,"level")),2&o){const e=r.data;let i;t.hij(" ",(null==(i=t.lcZ(1,1,e))?null:i.display_name)||(null==(i=t.lcZ(2,3,e))?null:i.name)," ")}}function xt(o,r){if(1&o&&t._UZ(0,"img",7),2&o){const e=t.oxw().data;t.Q6J("source",e[0])}}function vt(o,r){1&o&&(t.TgZ(0,"span",8),t._uU(1,"No Images"),t.qZA())}function Ct(o,r){if(1&o&&t.YNc(0,xt,1,1,"img",5)(1,vt,2,0,"span",6),2&o){const e=r.data;t.Q6J("ngIf",e.length),t.xp6(),t.Q6J("ngIf",!e.length)}}function Tt(o,r){if(1&o){const e=t.EpF();t.TgZ(0,"div",9)(1,"button",10)(2,"app-icon"),t._uU(3,"more_vert"),t.qZA()(),t.TgZ(4,"mat-menu",null,11)(6,"button",12),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.editBuildingMetadata(s))}),t.TgZ(7,"div",13)(8,"app-icon",14),t._uU(9,"edit_square"),t.qZA(),t.TgZ(10,"span"),t._uU(11,"App Configuration"),t.qZA()()(),t.TgZ(12,"button",12),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.editBuilding(s))}),t.TgZ(13,"div",13)(14,"app-icon",14),t._uU(15,"edit"),t.qZA(),t.TgZ(16,"span"),t._uU(17,"Edit Building"),t.qZA()()(),t.TgZ(18,"button",12),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.setAutoRelease(s))}),t.TgZ(19,"div",13)(20,"app-icon",15),t._uU(21," release_alert "),t.qZA(),t.TgZ(22,"span"),t._uU(23,"Auto-release Settings"),t.qZA()()(),t.TgZ(24,"button",12),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.setInduction(s))}),t.TgZ(25,"div",13)(26,"app-icon",15),t._uU(27," badge "),t.qZA(),t.TgZ(28,"span"),t._uU(29,"Induction Settings"),t.qZA()()(),t.TgZ(30,"button",12),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.setSupportIssueTypes(s))}),t.TgZ(31,"div",13)(32,"app-icon",15),t._uU(33," support_agent "),t.qZA(),t.TgZ(34,"span"),t._uU(35,"Support Request Types"),t.qZA()()(),t.TgZ(36,"button",12),t.NdJ("click",function(){const s=t.CHM(e).row,a=t.oxw();return t.KtG(a.removeBuilding(s))}),t.TgZ(37,"div",16)(38,"app-icon",17),t._uU(39," delete "),t.qZA(),t.TgZ(40,"span"),t._uU(41,"Delete Building"),t.qZA()()()()()}if(2&o){const e=t.MAs(5);t.xp6(),t.Q6J("matMenuTriggerFor",e)}}const Zt=()=>["display_name","address","timezone","region","level_count","actions"],Mt=()=>["Name","Location","Timezone","Region","Levels"," "],bt=()=>["12r","flex","12r","10r","6r","3.75r"],At=(o,r,e)=>({images:o,zones:r,actions:e});let yt=(()=>{class o{constructor(e,i){this._manager=e,this._settings=i,this.buildings=this._manager.filtered_buildings,this.settings={},this.editBuilding=n=>this._manager.editBuilding(n),this.editBuildingMetadata=n=>this._manager.editBuildingMetadata(n),this.removeBuilding=n=>this._manager.removeBuilding(n),this.setAutoRelease=n=>this._manager.setAutoRelease(n),this.setInduction=n=>this._manager.setInduction(n),this.setSupportIssueTypes=n=>this._manager.setSupportIssueTypes(n)}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(E),t.Y36(m.gb))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["building-list"]],decls:8,vars:12,consts:[[1,"absolute","inset-0","overflow-auto","px-4"],["empty","No buildings",1,"block","min-w-[60rem]","w-full","h-full",3,"dataSource","columns","display_column","column_size","template"],["level_template",""],["image_template",""],["action_template",""],["auth","","class","max-h-[3rem] max-w-[8rem]",3,"source",4,"ngIf"],["class","opacity-30",4,"ngIf"],["auth","",1,"max-h-[3rem]","max-w-[8rem]",3,"source"],[1,"opacity-30"],[1,"w-full","flex","justify-end","space-x-2"],["btn","","icon","","matRipple","",3,"matMenuTriggerFor"],["menu","matMenu"],["mat-menu-item","",3,"click"],[1,"flex","items-center","space-x-2"],[1,"text-xl"],["className","material-symbols-rounded",1,"text-xl"],[1,"flex","items-center","space-x-2","text-red-500"],[1,"text-error","text-xl"]],template:function(i,n){if(1&i&&(t.TgZ(0,"div",0),t._UZ(1,"custom-table",1),t.qZA(),t.YNc(2,ht,3,5,"ng-template",null,2,t.W1O)(4,Ct,2,2,"ng-template",null,3,t.W1O)(6,Tt,42,1,"ng-template",null,4,t.W1O)),2&i){const s=t.MAs(3),a=t.MAs(5),g=t.MAs(7);t.xp6(),t.Q6J("dataSource",n.buildings)("columns",t.DdM(5,Zt))("display_column",t.DdM(6,Mt))("column_size",t.DdM(7,bt))("template",t.kEZ(8,At,a,s,g))}},dependencies:[p.O5,S.VK,S.OP,S.p6,h.wG,v.o,ut.C,pt.A,ft.M]})}return o})();const It=["app-building-manager",""];let O=(()=>{class o{constructor(e){this._state=e,this.newBuilding=()=>this._state.editBuilding()}static#t=this.\u0275fac=function(i){return new(i||o)(t.Y36(E))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["","app-building-manager",""]],attrs:It,decls:10,vars:0,consts:[[1,"flex","flex-1","h-px"],[1,"flex","flex-col","flex-1","w-1/2","h-full"],[1,"flex","items-center","justify-between","mb-2","p-8"],[1,"text-2xl","font-medium"],["btn","","matRipple","",3,"click"],[1,"block","w-full","relative","flex-1","h-1/2"]],template:function(i,n){1&i&&(t._UZ(0,"app-topbar"),t.TgZ(1,"div",0),t._UZ(2,"app-sidebar"),t.TgZ(3,"main",1)(4,"header",2)(5,"h2",3),t._uU(6,"Building Management"),t.qZA(),t.TgZ(7,"button",4),t.NdJ("click",function(){return n.newBuilding()}),t._uU(8," Add Building "),t.qZA()(),t._UZ(9,"building-list",5),t.qZA()())},dependencies:[mt.O,_t.u,h.wG,yt],styles:["[_nghost-%COMP%]{display:flex;flex-direction:column;height:100%;width:100%;background-color:var(--b1)}sidebar[_ngcontent-%COMP%]{height:100%}main[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;min-width:50%;height:100%}\n\n/*# sourceMappingURL=building-manager.component.ts-angular-inline--187.css.map*/"]})}return o})();var Nt=l(21757);const wt=[{path:"",component:O},{path:"new",component:O}];let St=(()=>{class o{static#t=this.\u0275fac=function(i){return new(i||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[p.ez,c.u5,b.v,A.YR,y.PP,Nt.Hi,B.Bz.forChild(wt)]})}return o})()},59524:(J,Z,l)=>{l.d(Z,{Y:()=>A,PP:()=>p.P,mO:()=>y.mO,VE:()=>x.VE,w0:()=>x.w0,sF:()=>m.sF});var p=l(43211),b=(l(86755),l(80882),l(67343));class A{constructor(_={}){this.type=_.type||_.location||"other",this.position=_.position||_.map_id||_.asset_id||{x:_.x/_.map_width||0,y:_.y/_.map_height||0},this.variance=_.variance||0,this.last_seen=_.last_seen||(0,b.Z)(new Date),this.level=_.level,this.building=_.building,this.at_location=!!_.at_location,this.coordinates_from=_.coordinates_from||"top-left"}}var y=l(223),m=(l(11451),l(38125)),x=l(48675)}}]);
//# sourceMappingURL=apps_concierge_src_app_building-manager_building-manager_module_ts.js.map