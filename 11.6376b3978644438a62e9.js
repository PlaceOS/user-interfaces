(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{kanD:function(t,e,i){"use strict";i.r(e),i.d(e,"COMPONENTS",(function(){return Q})),i.d(e,"StaffModule",(function(){return X}));var n=i("2kYt"),s=i("EM62"),c=i("nIj0"),o=i("sEIs"),l=i("D57K"),r=i("mjT4"),a=i("C05f"),f=i("HM3f"),u=i("05Mk"),d=i("YtkY"),h=i("TLy2"),g=i("wqq/"),m=i("9MvL"),p=i("KuCG"),b=i("20lr"),_=i("dJst");let v=(()=>{class t extends b.b{constructor(t){super(),this._org=t,this._onsite={},this._events={},this._filters=new a.a({}),this._search=new a.a(""),this._loading=new a.a(!1),this._users=new a.a([]),this.loading=this._loading.asObservable(),this.filters=this._filters.asObservable(),this.users=this._filters.asObservable(),this.filtered_users=Object(f.a)([this._search,this._users,this._filters]).pipe(Object(d.a)(t=>{const[e,i,n]=t;return i.filter(t=>(!e||t.name.toLowerCase().includes(e)||t.email.toLowerCase().includes(e))&&(!n.only_onsite||this._onsite[t.email]))})),this.user_events=Object(f.a)([this._filters]).pipe(Object(h.a)(t=>Object(l.a)(this,void 0,void 0,(function*(){this._loading.next(!0);const t=yield Object(u.e)({period_start:Math.floor(Object(m.a)(new Date).valueOf()/1e3),period_end:Math.floor(Object(p.a)(new Date).valueOf()/1e3),type:"staff"}).toPromise(),e={},i=(new Date).valueOf();for(const n of t)Object(b.w)(i,i,n.date,n.date+60*n.duration*1e3)&&(e[n.asset_id]=n.checked_in,this._events[n.asset_id]=n);return this._onsite=e,this._loading.next(!1),e}))),Object(g.a)()),this.loadUsers()}setFilters(t){this._filters.next(Object.assign(Object.assign({},this._filters.getValue()),t))}setSearchString(t){this._search.next(t)}startPolling(t=3e4){this.setFilters(this._filters.getValue()),this.interval("poll",()=>this.setFilters(this._filters.getValue()),t)}stopPolling(){this.clearInterval("poll")}checkin(t){return Object(l.a)(this,void 0,void 0,(function*(){const e=yield Object(u.g)({booking_start:Math.floor((new Date).valueOf()/1e3),booking_end:Math.floor(Object(p.a)(new Date).valueOf()/1e3),asset_id:t.email,title:"Checked-in Onsite",description:this._org.building.display_name||this._org.building.name,zones:[this._org.building.id],booking_type:"staff"}).toPromise();yield Object(u.d)(e.id,!0),this._events[t.email]=e,this._onsite[t.email]=!0}))}checkout(t){return Object(l.a)(this,void 0,void 0,(function*(){const e=this._events[t.email];if(e){const i=yield Object(u.g)(Object.assign(Object.assign({},e.toJSON()),{booking_end:Math.floor((new Date).valueOf()/1e3)})).toPromise();yield Object(u.d)(i.id,!1).toPromise(),this._events[t.email]=i,this._onsite[t.email]=!1}}))}loadUsers(){return Object(l.a)(this,void 0,void 0,(function*(){const t=yield Object(r.f)("").toPromise();t.sort((t,e)=>t.name.localeCompare(e.name)),this._users.next(t)}))}}return t.\u0275fac=function(e){return new(e||t)(s.tc(_.c))},t.\u0275prov=s.cc({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var O=i("UfDH"),y=i("jOdJ"),x=i("29Wa"),w=i("R7+U"),j=i("k8N0"),C=i("wobF"),k=i("mFH5");function M(t,e){if(1&t&&(s.mc(0,"mat-option",7),s.ad(1),s.lc()),2&t){const t=e.$implicit;s.Hc("value",t.id),s.Ub(1),s.cd(" ",t.display_name||t.name," ")}}let P=(()=>{class t extends b.b{constructor(t,e,i,n){super(),this._state=t,this._org=e,this._route=i,this._router=n,this.zones=[],this.levels=this._org.active_levels,this.filters=this._state.filters,this.setDate=t=>this._state.setFilters({date:t}),this.setFilters=t=>this._state.setFilters(t),this.setSearch=t=>this._state.setSearchString(t),this.updateZones=t=>{this._router.navigate([],{relativeTo:this._route,queryParams:{zone_ids:t.join(",")}}),this._state.setFilters({zones:t})}}ngOnInit(){return Object(l.a)(this,void 0,void 0,(function*(){yield this._org.initialised.pipe(Object(y.a)(t=>t)).toPromise(),this.subscription("route.query",this._route.queryParamMap.subscribe(t=>{if(t.has("zone_ids")){const e=t.get("zone_ids").split(",");if(e.length){const t=this._org.levelWithID(e);if(!t)return;this._org.building=this._org.buildings.find(e=>e.id===t.parent_id),this.zones=e}}})),this.subscription("levels",this._org.active_levels.subscribe(t=>{this.zones=this.zones.filter(e=>t.find(t=>t.id===e)),!this.zones.length&&t.length&&this.zones.push(t[0].id),this.updateZones(this.zones)})),this.setSearch("")}))}}return t.\u0275fac=function(e){return new(e||t)(s.gc(v),s.gc(_.c),s.gc(o.a),s.gc(o.d))},t.\u0275cmp=s.ac({type:t,selectors:[["staff-topbar"]],features:[s.Rb],decls:10,vars:7,consts:[["appearance","outline"],["multiple","","placeholder","All Levels",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"m-2",3,"ngModel","ngModelChange"],[1,"text-xs"],[1,"flex-1","w-2"],[1,"mr-2",3,"modelChange"],[3,"value"]],template:function(t,e){if(1&t&&(s.mc(0,"mat-form-field",0),s.mc(1,"mat-select",1),s.xc("ngModelChange",(function(t){return e.zones=t}))("ngModelChange",(function(t){return e.updateZones(t)})),s.Yc(2,M,2,2,"mat-option",2),s.Cc(3,"async"),s.lc(),s.lc(),s.mc(4,"mat-slide-toggle",3),s.xc("ngModelChange",(function(t){return e.setFilters({only_onsite:t})})),s.Cc(5,"async"),s.mc(6,"div",4),s.ad(7,"Onsite Only"),s.lc(),s.lc(),s.hc(8,"div",5),s.mc(9,"searchbar",6),s.xc("modelChange",(function(t){return e.setSearch(t)})),s.lc()),2&t){let t=null;s.Ub(1),s.Hc("ngModel",e.zones),s.Ub(1),s.Hc("ngForOf",s.Dc(3,3,e.levels)),s.Ub(2),s.Hc("ngModel",null==(t=s.Dc(5,5,e.filters))?null:t.only_onsite)}},directives:[x.c,w.a,c.l,c.o,n.m,j.a,C.a,k.l],pipes:[n.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                align-items: center;\n                background-color: #fff;\n                height: 5em;\n                padding: 0 1em;\n                border-bottom: 1px solid #ccc;\n            }\n\n            [_nghost-%COMP%]    > *[_ngcontent-%COMP%]    + *[_ngcontent-%COMP%] {\n                margin-left: 0.5rem;\n            }\n\n            mat-form-field[_ngcontent-%COMP%] {\n                height: 3.25em;\n                width: 8em;\n            }"]}),t})();var U=i("/ILR"),D=i("WKsi"),F=i("Y2X+"),z=i("PBFl"),H=i("0/Ep");function I(t,e){1&t&&(s.mc(0,"div",10),s.ad(1,"Onsite"),s.lc())}let S=(()=>{class t{constructor(t){this._state=t,this.checkin=()=>Object(l.a)(this,void 0,void 0,(function*(){this.loading=!0,yield this._state.checkin(this.user).catch(t=>Object(b.m)("Error checking in Staff member")),this.loading=!1})),this.checkout=()=>Object(l.a)(this,void 0,void 0,(function*(){this.loading=!0,yield this._state.checkout(this.user).catch(t=>Object(b.m)("Error checking out Staff member")),this.loading=!1}))}}return t.\u0275fac=function(e){return new(e||t)(s.gc(v))},t.\u0275cmp=s.ac({type:t,selectors:[["staff-details"]],inputs:{user:"user",onsite:"onsite"},decls:16,vars:11,consts:[[1,"w-full","flex","items-center","px-4","py-2","bg-white","border-b","border-gray-200"],[3,"user"],[1,"flex","flex-col","flex-1"],[1,"px-2"],[1,"px-2","text-xs","text-opacity-50"],["class","text-xs opacity-50 px-4",4,"ngIf"],[1,"flex","items-center"],[3,"matTooltip","loading","content","click"],["mat-icon-button","","matTooltip","Email Staff",3,"disabled","href"],["mat-icon-button","","matTooltip","Phone Staff",3,"disabled","href"],[1,"text-xs","opacity-50","px-4"]],template:function(t,e){1&t&&(s.mc(0,"div",0),s.hc(1,"a-user-avatar",1),s.mc(2,"div",2),s.mc(3,"div",3),s.ad(4),s.lc(),s.mc(5,"div",4),s.ad(6),s.lc(),s.lc(),s.Yc(7,I,2,0,"div",5),s.mc(8,"div",6),s.mc(9,"action-icon",7),s.xc("click",(function(){return e.onsite?e.checkout():e.checkin()})),s.lc(),s.mc(10,"a",8),s.mc(11,"app-icon"),s.ad(12,"email"),s.lc(),s.lc(),s.mc(13,"a",9),s.mc(14,"app-icon"),s.ad(15,"call"),s.lc(),s.lc(),s.lc(),s.lc()),2&t&&(s.Ub(1),s.Hc("user",e.user),s.Ub(3),s.bd(null==e.user?null:e.user.name),s.Ub(2),s.bd(null==e.user?null:e.user.email),s.Ub(1),s.Hc("ngIf",e.onsite),s.Ub(2),s.Hc("matTooltip",e.onsite?"Checkout Staff":"Checkin Staff")("loading",e.loading)("content",e.onsite?"event_busy":"event_available"),s.Ub(1),s.Hc("disabled",!(null!=e.user&&e.user.email))("href","mailto:"+(null==e.user?null:e.user.email),s.Rc),s.Ub(3),s.Hc("disabled",!(null!=e.user&&e.user.phone))("href","tel:"+(null==e.user?null:e.user.phone),s.Rc))},directives:[U.a,n.n,D.a,F.a,z.a,H.a],styles:["[_nghost-%COMP%]    > div[_ngcontent-%COMP%]:hover {\n            background-color: #f0f0f0 !important;\n        }"]}),t})();var Y=i("66mq");const T=["container"];function E(t,e){if(1&t){const t=s.nc();s.mc(0,"div",7),s.xc("click",(function(){s.Pc(t);const i=e.$implicit;return s.Bc().scrollTo(i)})),s.Cc(1,"async"),s.ad(2),s.lc()}if(2&t){const t=e.$implicit,i=s.Bc();s.Yb("disabled",s.Dc(1,5,i.user_list)[t].length<=0)("active",t===i.active_group),s.Ub(2),s.cd(" ",t," ")}}function q(t,e){if(1&t&&(s.hc(0,"staff-details",12),s.Cc(1,"async"),s.Cc(2,"async")),2&t){const t=e.$implicit,i=e.index,n=s.Bc(2).$implicit,c=s.Bc(2);s.Hc("id","letter-"+n+"-"+i)("user",t)("onsite",!!s.Dc(1,3,c.events)&&s.Dc(2,5,c.events)[t.email])}}function B(t,e){if(1&t&&(s.kc(0),s.mc(1,"div",10),s.ad(2),s.lc(),s.Yc(3,q,3,7,"staff-details",11),s.Cc(4,"async"),s.jc()),2&t){const t=s.Bc().$implicit,e=s.Bc(2);s.Ub(1),s.Hc("id","letter-"+("#"===t?"0":t)),s.Ub(1),s.cd(" ",t," "),s.Ub(1),s.Hc("ngForOf",s.Dc(4,3,e.user_list)[t])}}function L(t,e){if(1&t&&(s.kc(0),s.Yc(1,B,5,5,"ng-container",9),s.Cc(2,"async"),s.jc()),2&t){const t=e.$implicit,i=s.Bc(2);s.Ub(1),s.Hc("ngIf",s.Dc(2,1,i.user_list)[t].length)}}function $(t,e){if(1&t&&(s.kc(0),s.Yc(1,L,3,3,"ng-container",8),s.jc()),2&t){const t=s.Bc();s.Ub(1),s.Hc("ngForOf",t.groups)}}function R(t,e){1&t&&s.hc(0,"mat-progress-bar",13)}function J(t,e){1&t&&(s.mc(0,"div",14),s.mc(1,"p"),s.ad(2,"No matching staff members"),s.lc(),s.lc())}const N="#abcdefghijklmnopqrstuvwxyz".split("");let V=(()=>{class t extends b.b{constructor(t){super(),this._state=t,this.active_group="#",this.groups=N,this.events=this._state.user_events,this.loading=this._state.loading,this.user_count=this._state.filtered_users.pipe(Object(d.a)(t=>t.length)),this.user_list=this._state.filtered_users.pipe(Object(d.a)(t=>{const e={};for(const i of N)e[i]=(t||[]).filter(t=>t.name.toLowerCase()[0].startsWith(i)||"#"===i&&!N.includes(t.name.toLowerCase()[0]));return this.timeout("scroll",()=>this.onScroll({}),30),e}))}onScroll(t){const e=this._el.nativeElement.scrollTop;for(const i of N){const t=document.querySelector("#letter-"+("#"===i?"0":i));if(t){if(t.offsetTop-e>0)break;this.active_group=i}}}scrollTo(t){const e=document.querySelector(`#letter-${t}-0`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),this.active_group=t)}}return t.\u0275fac=function(e){return new(e||t)(s.gc(v))},t.\u0275cmp=s.ac({type:t,selectors:[["staff-listings"]],viewQuery:function(t,e){if(1&t&&s.fd(T,1),2&t){let t;s.Lc(t=s.yc())&&(e._el=t.first)}},features:[s.Rb],decls:10,vars:8,consts:[[1,"w-full","p-2","flex","items-center","justify-center"],["letter","","class","capitalize h-6 w-6 flex items-center justify-center text-xs cursor-pointer",3,"disabled","active","click",4,"ngFor","ngForOf"],[1,"flex-1","overflow-auto","w-full","relative","bg-gray-100",2,"height","50%",3,"scroll"],["container",""],[4,"ngIf","ngIfElse"],["mode","indeterminate",4,"ngIf"],["empty_state",""],["letter","",1,"capitalize","h-6","w-6","flex","items-center","justify-center","text-xs","cursor-pointer",3,"click"],[4,"ngFor","ngForOf"],[4,"ngIf"],["group","",1,"capitalize","bg-gray-300","border-b","text-sm","font-medium","sticky","top-0","z-10",3,"id"],[3,"id","user","onsite",4,"ngFor","ngForOf"],[3,"id","user","onsite"],["mode","indeterminate"],[1,"absolute","inset-0","flex","flex-col","items-center","justify-center"]],template:function(t,e){if(1&t&&(s.mc(0,"div",0),s.Yc(1,E,3,7,"div",1),s.lc(),s.mc(2,"div",2,3),s.xc("scroll",(function(t){return e.onScroll(t)})),s.Yc(4,$,2,1,"ng-container",4),s.Cc(5,"async"),s.lc(),s.Yc(6,R,1,0,"mat-progress-bar",5),s.Cc(7,"async"),s.Yc(8,J,3,0,"ng-template",null,6,s.Zc)),2&t){const t=s.Mc(9);s.Ub(1),s.Hc("ngForOf",e.groups),s.Ub(3),s.Hc("ngIf",s.Dc(5,4,e.user_count))("ngIfElse",t),s.Ub(2),s.Hc("ngIf",s.Dc(7,6,e.loading))}},directives:[n.m,n.n,S,Y.a],pipes:[n.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                width: 100%;\n                height: 50%;\n            }\n\n            [letter][_ngcontent-%COMP%] {\n                transition: font-size 200ms, color 200ms;\n            }\n\n            [group][_ngcontent-%COMP%] {\n                border-color: #ccc;\n                padding: 0.5rem 1.65rem;\n            }\n\n            .disabled[_ngcontent-%COMP%] {\n                opacity: 0.2;\n                pointer-events: none;\n            }\n\n            .active[_ngcontent-%COMP%] {\n                font-size: 1.25rem;\n                opacity: 1;\n                color: #d81b60;\n            }"]}),t})();const W=["app-staff",""];function Z(t,e){1&t&&s.hc(0,"mat-progress-bar",4)}let K=(()=>{class t{constructor(t){this._state=t,this.loading=this._state.loading}ngOnInit(){this._state.startPolling()}ngOnDestroy(){this._state.stopPolling()}}return t.\u0275fac=function(e){return new(e||t)(s.gc(v))},t.\u0275cmp=s.ac({type:t,selectors:[["","app-staff",""]],attrs:W,decls:6,vars:3,consts:[[1,"relative","overflow-hidden","flex-1","flex","flex-col"],[1,"w-full"],[1,"w-full","flex-1","h-0"],["class","w-full","mode","indeterminate",4,"ngIf"],["mode","indeterminate",1,"w-full"]],template:function(t,e){1&t&&(s.hc(0,"sidebar"),s.mc(1,"main",0),s.hc(2,"staff-topbar",1),s.hc(3,"staff-listings",2),s.Yc(4,Z,1,0,"mat-progress-bar",3),s.Cc(5,"async"),s.lc()),2&t&&(s.Ub(4),s.Hc("ngIf",s.Dc(5,1,e.loading)))},directives:[O.a,P,V,n.n,Y.a],pipes:[n.b],styles:["[_nghost-%COMP%] {\n                display: flex;\n                height: 100%;\n                width: 100%;\n                background: var(--bg);\n            }"]}),t})();var A=i("oRDy");const G=[{path:"",component:K}],Q=[K,P,V,S];let X=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=s.ec({type:t}),t.\u0275inj=s.dc({imports:[[n.c,c.h,A.a,o.g.forChild(G)]]}),t})()}}]);