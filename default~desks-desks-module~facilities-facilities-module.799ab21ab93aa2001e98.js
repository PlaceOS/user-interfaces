(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{T50y:function(t,e,s){"use strict";s.d(e,"a",(function(){return d}));var n=s("C05f"),i=s("HM3f"),o=s("YtkY"),a=s("mWib"),c=s("jOdJ"),r=s("xVbo"),l=s("20lr"),u=s("EM62"),b=s("dJst"),h=s("6CBO");let d=(()=>{class t extends l.b{constructor(t,e,s){super(),this._org=t,this._spaces=e,this._settings=s,this._level=new n.a(null),this._positions=new n.a({zoom:1,center:{x:.5,y:.5}}),this._styles=new n.a({}),this._features=new n.a({}),this._actions=new n.a({}),this._labels=new n.a({}),this._options=new n.a({}),this.level=this._level.asObservable(),this.spaces=Object(i.b)([this._level,this._spaces.list]).pipe(Object(o.a)(t=>t[1].filter(e=>e.zones.includes(t[0].id)))),this.map_url=this._level.pipe(Object(o.a)(t=>(t?t.map_id:"")||"")),this.map_positions=this._positions.asObservable(),this.map_features=Object(i.b)([this._features,this._options]).pipe(Object(a.a)(500),Object(o.a)(t=>{const[e,s]=t;let n=[];for(const i in e)switch(i){case"devices":s.show_zones&&s.show_devices&&(n=n.concat(e[i]));break;case"contacts":s.show_contacts&&(n=n.concat(e[i]));break;default:n=n.concat(e[i])}return n})),this.map_actions=this._actions.pipe(Object(a.a)(500),Object(o.a)(t=>Object.values(t).reduce((t,e)=>t.concat(e),[]))),this.map_labels=Object(i.b)([this._labels,this._options]).pipe(Object(a.a)(500),Object(o.a)(t=>{const[e,s]=t;let n=[];for(const i in e)("zones"!==i||s.show_zones)&&(n=n.concat(e[i]));return n})),this.map_styles=Object(i.b)([this._styles,this._options]).pipe(Object(a.a)(500),Object(o.a)(t=>{const[e,s]=t,n=Object.keys(e).reduce((t,s)=>Object.assign(Object.assign({},t),e[s]),{});return s.show_zones||(n["#zones"]={display:"none"},n["#Zones"]={display:"none"}),n.text={display:"none"},n})),this.options=this._options.asObservable(),this._org.initialised.pipe(Object(c.a)(t=>t)).subscribe(()=>{this.subscription("building",this._org.active_building.pipe(Object(r.a)(t=>!!t)).subscribe(t=>{const e=this._level.getValue(),s=this._org.levelsForBuilding(t);!s.find(t=>(null==e?void 0:e.id)===t.id)&&s.length&&this.setLevel(s[0].id),this.setOptions({show_devices:!1!==this._settings.get("app.explore.display_devices")})}))})}get positions(){return this._positions.getValue()}get active_level(){return this._level.getValue()}setOptions(t){this._options.next(Object.assign(Object.assign({},this._options.getValue()),t))}setLevel(t){const e=this._org.levelWithID([t]);e&&this._level.next(e)}setStyles(t,e){const s=this._styles.getValue();s[t]=e,this._styles.next(s)}setFeatures(t,e){const s=this._features.getValue();s[t]=e,this._features.next(s)}setActions(t,e){const s=this._actions.getValue();s[t]=e,this._actions.next(s)}setLabels(t,e){const s=this._labels.getValue();s[t]=e,this._labels.next(s)}setPositions(t,e){this._positions.next({zoom:t,center:e})}}return t.\u0275fac=function(e){return new(e||t)(u.cc(b.c),u.cc(h.c),u.cc(l.e))},t.\u0275prov=u.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})()},aAMe:function(t,e,s){"use strict";s.d(e,"a",(function(){return Y})),s.d(e,"b",(function(){return h.a})),s.d(e,"c",(function(){return A}));var n=s("D57K"),i=s("/It1"),o=s("C05f"),a=s("HM3f"),c=s("20lr"),r=(s("eZII"),s("Rc+I")),l=s("EM62"),u=s("2kYt");s("OZ4H"),s("7JBE"),s("PBFl"),s("0/Ep");var b=s("nIj0");s("29Wa"),s("Cd2c"),s("csyo");var h=s("T50y");const d={free:"#43a047",pending:"#ffb300",reserved:"#e65100",busy:"#e53935","not-bookable":"#757575",unknown:"#757575"};var p=s("dJst"),_=s("JuBR"),f=s("mrqE");function m(t,e){Object(f.a)(2,arguments);var s=Object(_.a)(t),n=Object(_.a)(e),i=s.getTime()-n.getTime();return i<0?-1:i>0?1:i}function g(t,e){Object(f.a)(2,arguments);var s=Object(_.a)(t),n=Object(_.a)(e),i=s.getFullYear()-n.getFullYear(),o=s.getMonth()-n.getMonth();return 12*i+o}function v(t,e){Object(f.a)(2,arguments);var s=Object(_.a)(t),n=Object(_.a)(e),i=m(s,n),o=Math.abs(g(s,n));s.setMonth(s.getMonth()-i*o);var a=m(s,n)===-i,c=i*(o-a);return 0===c?0:c}var O=s("BySP");function j(t,e){Object(f.a)(2,arguments);var s=Object(O.a)(t,e)/1e3;return s>0?Math.floor(s):Math.ceil(s)}var k=s("dI1K");function y(t){return function(t,e){if(null==t)throw new TypeError("assign requires that input parameter not be null or undefined");for(var s in e=e||{})e.hasOwnProperty(s)&&(t[s]=e[s]);return t}({},t)}var w=s("njY1"),M=1440,D=43200;function x(t,e,s){Object(f.a)(2,arguments);var n=s||{},i=n.locale||k.a;if(!i.formatDistance)throw new RangeError("locale must contain formatDistance property");var o=m(t,e);if(isNaN(o))throw new RangeError("Invalid time value");var a,c,r=y(n);r.addSuffix=Boolean(n.addSuffix),r.comparison=o,o>0?(a=Object(_.a)(e),c=Object(_.a)(t)):(a=Object(_.a)(t),c=Object(_.a)(e));var l,u=j(c,a),b=(Object(w.a)(c)-Object(w.a)(a))/1e3,h=Math.round((u-b)/60);if(h<2)return n.includeSeconds?u<5?i.formatDistance("lessThanXSeconds",5,r):u<10?i.formatDistance("lessThanXSeconds",10,r):u<20?i.formatDistance("lessThanXSeconds",20,r):u<40?i.formatDistance("halfAMinute",null,r):i.formatDistance(u<60?"lessThanXMinutes":"xMinutes",1,r):0===h?i.formatDistance("lessThanXMinutes",1,r):i.formatDistance("xMinutes",h,r);if(h<45)return i.formatDistance("xMinutes",h,r);if(h<90)return i.formatDistance("aboutXHours",1,r);if(h<M){var d=Math.round(h/60);return i.formatDistance("aboutXHours",d,r)}if(h<2520)return i.formatDistance("xDays",1,r);if(h<D){var p=Math.round(h/M);return i.formatDistance("xDays",p,r)}if(h<86400)return l=Math.round(h/D),i.formatDistance("aboutXMonths",l,r);if((l=v(c,a))<12){var g=Math.round(h/D);return i.formatDistance("xMonths",g,r)}var O=l%12,x=Math.floor(l/12);return O<3?i.formatDistance("aboutXYears",x,r):O<9?i.formatDistance("overXYears",x,r):i.formatDistance("almostXYears",x+1,r)}var V=s("w+hZ");function U(t,e){if(1&t&&(l.Vb(0,"p"),l.Vb(1,"label"),l.Lc(2,"Manufacturer:"),l.Ub(),l.Lc(3),l.Ub()),2&t){const t=l.jc();l.Db(3),l.Nc(" ",t.manufacturer,"")}}function P(t,e){if(1&t&&(l.Vb(0,"p"),l.Vb(1,"label"),l.Lc(2,"OS:"),l.Ub(),l.Lc(3),l.Ub()),2&t){const t=l.jc();l.Db(3),l.Nc(" ",t.os,"")}}function I(t,e){if(1&t&&(l.Vb(0,"p"),l.Vb(1,"label"),l.Lc(2,"SSID:"),l.Ub(),l.Lc(3),l.Ub()),2&t){const t=l.jc();l.Db(3),l.Nc(" ",t.ssid,"")}}function L(t,e){if(1&t&&(l.Vb(0,"p"),l.Vb(1,"label"),l.Lc(2,"Username:"),l.Ub(),l.Lc(3),l.Ub()),2&t){const t=l.jc();l.Db(3),l.Nc(" ",(null==t.user?null:t.user.name)||(null==t.user?null:t.user.username)||t.username,"")}}function C(t,e){if(1&t&&(l.Vb(0,"p"),l.Vb(1,"label"),l.Lc(2,"Type:"),l.Ub(),l.Lc(3),l.Ub()),2&t){const t=l.jc();l.Db(3),l.Nc(" ",t.user.type,"")}}let T=(()=>{class t{constructor(t,e){this._details=t,this._element=e,this.username="",this.user=this._details.user,this.mac=this._details.mac,this.manufacturer=this._details.manufacturer,this.os=this._details.os,this.ssid=this._details.ssid,this.variance=this._details.variance.toFixed(2),this.diameter=100*this._details.variance,this.bg_color=this._details.bg_color||(this.distance<10?"#43a047":this.distance<20?"#ffb300":"#e53935"),this.onEnter=()=>this.loadUser(),this.onClick=()=>this.loadUser(),this.onTouch=()=>this.loadUser()}get last_seen(){return function(t,e){return Object(f.a)(1,arguments),x(t,Date.now(),e)}(new Date(1e3*this._details.last_seen),{addSuffix:!0})}get distance(){return Math.abs(Object(V.a)(1e3*this._details.last_seen,new Date))}ngOnInit(t=0){t>10||setTimeout(()=>{var e;const s=null===(e=this._element.nativeElement.parentElement)||void 0===e?void 0:e.parentElement;if(!s)return this.ngOnInit(++t);const n=parseInt(s.style.top,10)/100,i=parseInt(s.style.left,10)/100;this.y_pos=n>=.5?"bottom":"top",this.x_pos=i>=.5?"right":"left"},200)}loadUser(){return Object(n.a)(this,void 0,void 0,(function*(){if(this.username)return;const t=Object(i.e)(this._details.system,"LocationServices");if(t){this.username="Loading...";const e=yield t.execute("check_ownership_of",[this.mac]).catch(t=>null);this.username=e&&e.assigned_to?e.assigned_to:""}}))}}return t.\u0275fac=function(e){return new(e||t)(l.Pb(r.d),l.Pb(l.m))},t.\u0275cmp=l.Jb({type:t,selectors:[["explore-device-info"]],hostBindings:function(t,e){1&t&&l.fc("mouseenter",(function(){return e.onEnter()}))("click",(function(){return e.onClick()}))("touchend",(function(){return e.onTouch()}))},decls:22,vars:14,consts:[["name","radius",1,"radius","absolute","center","bg-blue-600","bg-opacity-25","border-4","border-dashed","border-blue-600","rounded-full",3,"mouseenter"],["name","dot",1,"h-2","w-2","absolute","center","rounded-full","pointer-events-auto"],["name","device-info"],[1,"arrow"],[1,"details"],[4,"ngIf"]],template:function(t,e){1&t&&(l.Vb(0,"div",0),l.fc("mouseenter",(function(){return e.loadUser()})),l.Ub(),l.Qb(1,"div",1),l.Vb(2,"div",2),l.Qb(3,"div",3),l.Vb(4,"div",4),l.Vb(5,"p"),l.Vb(6,"label"),l.Lc(7,"MAC:"),l.Ub(),l.Lc(8),l.Ub(),l.Vb(9,"p"),l.Vb(10,"label"),l.Lc(11,"Accuracy:"),l.Ub(),l.Lc(12),l.Ub(),l.Vb(13,"p"),l.Vb(14,"label"),l.Lc(15,"Last Seen:"),l.Ub(),l.Lc(16),l.Ub(),l.Jc(17,U,4,1,"p",5),l.Jc(18,P,4,1,"p",5),l.Jc(19,I,4,1,"p",5),l.Jc(20,L,4,1,"p",5),l.Jc(21,C,4,1,"p",5),l.Ub(),l.Ub()),2&t&&(l.Fc("height: "+e.diameter+"%; width: "+e.diameter+"%;"),l.Db(1),l.Gc("background-color",e.bg_color),l.Db(1),l.Fb("absolute rounded bg-white p-4 top-0 left-0 shadow pointer-events-none "+e.x_pos+" "+e.y_pos),l.Db(6),l.Nc(" ",e.mac,""),l.Db(4),l.Nc(" ",e.variance,"m"),l.Db(4),l.Nc(" ",e.last_seen,""),l.Db(1),l.qc("ngIf",e.manufacturer),l.Db(1),l.qc("ngIf",e.os),l.Db(1),l.qc("ngIf",e.ssid),l.Db(1),l.qc("ngIf",e.username),l.Db(1),l.qc("ngIf",e.user))},directives:[u.n],styles:["[_nghost-%COMP%] {\n                pointer-events: auto;\n            }\n\n            [_nghost-%COMP%]    > [name='dot'][_ngcontent-%COMP%] {\n                box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.35);\n                background-color: #616161;\n            }\n\n            [_nghost-%COMP%]:hover    > [name='device-info'][_ngcontent-%COMP%], [_nghost-%COMP%]:hover    > [name='radius'][_ngcontent-%COMP%] {\n                opacity: 1;\n            }\n\n            [name='radius'][_ngcontent-%COMP%] {\n                opacity: 0;\n                transition: opacity 200ms;\n                pointer-events: none;\n            }\n\n            [name='device-info'][_ngcontent-%COMP%] {\n                opacity: 0;\n                transition: opacity 200ms;\n                width: 16rem;\n                z-index: 999;\n                pointer-events: none;\n            }"]}),t})();function E(t,e){if(1&t&&(l.Vb(0,"p",6),l.Lc(1),l.Ub()),2&t){const t=l.jc();l.Db(1),l.Mc(t.user)}}function z(t,e){if(1&t&&(l.Vb(0,"p",7),l.Lc(1),l.kc(2,"date"),l.kc(3,"date"),l.Ub()),2&t){const t=l.jc();l.Db(1),l.Oc(" ",l.mc(2,2,t.start,"shortTime")," \u2013 ",l.mc(3,5,t.end,"shortTime")," ")}}let J=(()=>{class t{constructor(t,e){this._details=t,this._element=e,this.map_id=this._details.map_id,this.user=this._details.user,this.start=this._details.start,this.end=this._details.end}ngOnInit(t=0){t>10||setTimeout(()=>{var e;const s=null===(e=this._element.nativeElement.parentElement)||void 0===e?void 0:e.parentElement;if(!s)return this.ngOnInit(++t);const n=parseInt(s.style.top,10)/100,i=parseInt(s.style.left,10)/100;this.y_pos=n>=.5?"bottom":"top",this.x_pos=i>=.5?"right":"left"},200)}get available_until(){return""}}return t.\u0275fac=function(e){return new(e||t)(l.Pb(r.d),l.Pb(l.m))},t.\u0275cmp=l.Jb({type:t,selectors:[["explore-desk-info"]],decls:7,vars:6,consts:[["name","space-info",3,"id"],[1,"arrow"],[1,"details"],[1,"m-0","font-medium"],["class","mt-2 text-sm",4,"ngIf"],["class","mt-1 text-sm",4,"ngIf"],[1,"mt-2","text-sm"],[1,"mt-1","text-sm"]],template:function(t,e){1&t&&(l.Vb(0,"div",0),l.Qb(1,"div",1),l.Vb(2,"div",2),l.Vb(3,"h4",3),l.Lc(4),l.Ub(),l.Jc(5,E,2,1,"p",4),l.Jc(6,z,4,8,"p",5),l.Ub(),l.Ub()),2&t&&(l.Fb("absolute rounded bg-white p-4 top-0 left-0 shadow "+e.x_pos+" "+e.y_pos),l.qc("id",e.map_id),l.Db(4),l.Mc(e.map_id),l.Db(1),l.qc("ngIf",e.user),l.Db(1),l.qc("ngIf",e.start))},directives:[u.n],pipes:[u.f],styles:["[_nghost-%COMP%] {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                pointer-events: none;\n                z-index: 1;\n            }\n\n            [name='space-info'][_ngcontent-%COMP%] {\n                width: 16rem;\n            }\n\n            [name='status'][_ngcontent-%COMP%] {\n                background-color: #43a047;\n                font-weight: 500;\n            }\n\n            [name='status'].busy[_ngcontent-%COMP%] {\n                background-color: #e53935;\n            }\n\n            [name='status'].pending[_ngcontent-%COMP%] {\n                background-color: #ffb300;\n            }\n\n            [name='status'].not-bookable[_ngcontent-%COMP%] {\n                background-color: #757575;\n            }"]}),t})();var S=s("TLy2"),B=s("YtkY"),F=s("4e/d"),N=s("jOdJ"),q=s("05Mk");let Y=(()=>{class t extends c.b{constructor(t,e,s,n){super(),this._state=t,this._org=e,this._settings=s,this._desks_service=n,this._level=null,this._in_use=new o.a([]),this._options=new o.a({}),this._desks=new o.a([]),this._reserved=new o.a([]),this._statuses={},this._bindings=[],this._stats=new o.a({free:0,occupied:0,total:0}),this.desk_list=this._state.level.pipe(Object(S.a)(t=>Object(i.s)(t.id,{name:"desks"}).pipe(Object(B.a)(e=>e.details.map(e=>new p.b(Object.assign(Object.assign({},e),{zone:t})))))),Object(F.a)(t=>[])),this.ngOnInit()}ngOnInit(){return Object(n.a)(this,void 0,void 0,(function*(){yield this._org.initialised.pipe(Object(N.a)(t=>t)).toPromise(),this.setOptions({enable_booking:!1!==this._settings.get("app.desks.enabled")}),this.subscription("spaces",this._state.level.subscribe(t=>{this.clearBindings(),this._level=t,this.bindToDesks()})),this.subscription("changes",Object(a.b)([this.desk_list,this._in_use,this._reserved,this._options]).subscribe(([t,e,s])=>{this._statuses={};for(const{id:n,bookable:i}of t){const t=e.some(t=>n===t),o=s.some(t=>n===t);this._statuses[n]=i?t?o?"reserved":"busy":"free":"not-bookable"}this.processDesks(t),this.timeout("update",()=>this.updateStatus(),100)})),this.subscription("desks",this.desk_list.subscribe(t=>this.processDesks(t)))}))}ngOnDestroy(){super.ngOnDestroy(),this.clearBindings()}setOptions(t){this._options.next(Object.assign(Object.assign({},this._options.getValue()),t))}clearBindings(){const t=["desks_in_use","desk_list"];for(const e of t)this.unsub(e);this._bindings.forEach(t=>t.unbind()),this._bindings=[],this._statuses={}}bindToDesks(){if(!this._level)return;if(!this._org.buildings.find(t=>t.id===this._level.parent_id))return;const t=this._org.building.bindings.area_management||this._org.organisation.bindings.area_management;if(!t)return;let e=Object(i.e)(t,"AreaManagement").binding(this._level.id);this.subscription("desks_in_use",e.listen().subscribe(e=>{const s=((null==e?void 0:e.value)||[]).filter(t=>"desk"!==t.location),n=((null==e?void 0:e.value)||[]).filter(t=>"desk"===t.location);this._in_use.next(n.map(t=>t.map_id)),this._reserved.next(n.filter(t=>!t.at_location).map(t=>t.map_id)),this.processDevices(s,t)})),e.bind(),this._bindings.push(e),e=Object(i.e)(t,"AreaManagement").binding(this._level.id+":desk_ids"),this.subscription("desks_list",e.listen().subscribe(t=>this._desks.next(t||[]))),e.bind(),this._bindings.push(e)}updateStatus(){const t={},e=this._settings.get("app.explore.colors")||{};for(const s in this._statuses)this._statuses.hasOwnProperty(s)&&(t["#"+s]={fill:e["desk-"+this._statuses[s]]||e[""+this._statuses[s]]||d[""+this._statuses[s]],opacity:.6});this._state.setStyles("desks",t)}processDevices(t,e){var s,n;const i=[];for(const o of t){const t=o.x/o.map_width,a=o.y/o.map_height;i.push({location:{x:(null===(s=o.coordinates_from)||void 0===s?void 0:s.includes("right"))?1-t:t,y:(null===(n=o.coordinates_from)||void 0===n?void 0:n.includes("bottom"))?1-a:a},content:T,data:Object.assign(Object.assign({},o),{system:e})})}i.sort((t,e)=>1-Math.sqrt(Math.pow(t.x-.5,2)+Math.pow(t.x-.5,2))-(1-Math.sqrt(Math.pow(e.x-.5,2)+Math.pow(e.x-.5,2)))),this._state.setFeatures("devices",i)}processDesks(t){const e=[],s=[],n=this._options.getValue();for(const i of t)e.push({location:i.id,content:J,hover:!0,data:{map_id:i.name,status:this._statuses[i.map_id]}}),s.push({id:i.id,action:"click",callback:()=>this._desks_service.bookDesk({desk:i,host:n.host,date:n.date})}),s.push({id:i.id,action:"touchend",callback:()=>this._desks_service.bookDesk({desk:i,host:n.host,date:n.date})});this._state.setActions("desks",this._options.getValue().enable_booking?s:[]),this._state.setFeatures("desks",e)}}return t.\u0275fac=function(e){return new(e||t)(l.cc(h.a),l.cc(p.c),l.cc(c.e),l.cc(q.b))},t.\u0275prov=l.Lb({token:t,factory:t.\u0275fac}),t})();s("R7+U"),s("mFH5"),s("mjT4"),s("sEIs"),s("6CBO"),s("lYMz"),s("gGs/");var X=s("k8N0");s("mWib"),s("ulve");let A=(()=>{class t{}return t.\u0275mod=l.Nb({type:t}),t.\u0275inj=l.Mb({factory:function(e){return new(e||t)},imports:[[u.c,r.b,b.h,b.p,X.b]]}),t})()},"gGs/":function(t,e,s){"use strict";s.d(e,"a",(function(){return c}));var n=s("EM62"),i=s("T50y"),o=s("PBFl"),a=s("0/Ep");let c=(()=>{class t{constructor(t){this._state=t,this.zoomIn=()=>this._state.setPositions(Math.min(10,1.2*this._state.positions.zoom),this._state.positions.center),this.zoomOut=()=>this._state.setPositions(Math.max(1,this._state.positions.zoom*(1/1.2)),this._state.positions.center),this.reset=()=>this._state.setPositions(1,{x:.5,y:.5})}}return t.\u0275fac=function(e){return new(e||t)(n.Pb(i.a))},t.\u0275cmp=n.Jb({type:t,selectors:[["explore-zoom-controls"]],decls:9,vars:0,consts:[["mat-icon-button","",1,"bg-white",3,"click"],["className","material-icons"]],template:function(t,e){1&t&&(n.Vb(0,"button",0),n.fc("click",(function(){return e.zoomIn()})),n.Vb(1,"app-icon",1),n.Lc(2,"add"),n.Ub(),n.Ub(),n.Vb(3,"button",0),n.fc("click",(function(){return e.zoomOut()})),n.Vb(4,"app-icon",1),n.Lc(5,"remove"),n.Ub(),n.Ub(),n.Vb(6,"button",0),n.fc("click",(function(){return e.reset()})),n.Vb(7,"app-icon",1),n.Lc(8,"autorenew"),n.Ub(),n.Ub())},directives:[o.b,a.a],styles:["[_nghost-%COMP%] {\n                display: flex;\n                flex-direction: column;\n                padding: .5rem;\n            }\n\n            button[_ngcontent-%COMP%] {\n                border: 1px solid #ccc;\n                border-radius: 0;\n            }\n\n            button[_ngcontent-%COMP%]:first-child {\n                border-radius: 0.25rem 0.25rem 0 0;\n                border-bottom: none;\n            }\n\n            button[_ngcontent-%COMP%]:last-child {\n                border-radius: 0 0 0.25rem 0.25rem;\n                border-top: none;\n            }"]}),t})()}}]);
//# sourceMappingURL=default~desks-desks-module~facilities-facilities-module.799ab21ab93aa2001e98.js.map