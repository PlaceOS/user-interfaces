{"version":3,"file":"apps_workplace_src_app_landing_landing_module_ts.js","mappings":"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","names":["LandingStateService","BaseClass","constructor","_calendar","_schedule","_org","super","this","BehaviorSubject","_free_spaces","asObservable","filtered_bookings","pipe","map","_","filter","i","CalendarEvent","_contacts","_options","debounceTime","switchMap","search","searchStaff","of","catchError","shareReplay","_level_occupancy","init","n","initialised","first","toPromise","subscription","active_building","bld","subscribe","updateBuildingMetadata","sys_id","binding","getModule","listen","d","updateOccupancy","bind","setOptions","options","next","getValue","pollFreeSpaces","delay","updateFreeSpaces","interval","stopPollingFreeSpaces","clearInterval","pollUpcomingEvents","setDate","Date","now","startPolling","stopPollingUpcomingEvents","stopPolling","updateContacts","metadata","showMetadata","currentUser","id","details","Array","User","addContact","user","users","o","push","unique","updateMetadata","name","description","removeContact","u","email","levels","sort","a","b","recommendation","building","period_start","Math","floor","valueOf","period_end","endOfDay","list","freeBusy","zone_ids","space","availability","length","find","status","capacity","occupancy","module","sys","index","_occupancy_binding","unbind","value","Object","keys","key","recommendation_factor","levelWithID","i0","factory","LandingAvailabilityComponent","_state","free_spaces","level_occupancy","ngOnInit","ngOnDestroy","selectors","LandingColleaguesComponent","contacts","search_results","s","LandingUpcomingComponent","_event_form","_router","_dialog","upcoming_events","type","event","Booking","trackByFn","item","edit","navigate","newForm","remove","time","format","date","content","display_name","asset_name","asset_id","resp","openConfirmModal","title","icon","reason","loading","removeEvent","removeBooking","catch","e","notifyError","close","notifySuccess","ROUTES","path","component","LandingComponent","startOfMinute","AppLandingModule","CommonModule","SharedComponentModule","RouterModule"],"sourceRoot":"webpack:///","sources":["./apps/workplace/src/app/landing/landing-state.service.ts","./apps/workplace/src/app/landing/landing-availability.component.ts","./apps/workplace/src/app/landing/landing-colleagues.component.ts","./apps/workplace/src/app/landing/landing-upcoming.component.ts","./apps/workplace/src/app/landing/landing.module.ts","./apps/workplace/src/app/landing/landing.component.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport {\n    getModule,\n    PlaceMetadata,\n    PlaceVariableBinding,\n    showMetadata,\n    updateMetadata,\n} from '@placeos/ts-client';\nimport { BehaviorSubject, of } from 'rxjs';\nimport {\n    catchError,\n    debounceTime,\n    filter,\n    first,\n    map,\n    shareReplay,\n    switchMap,\n} from 'rxjs/operators';\nimport { endOfDay } from 'date-fns';\n\nimport { BaseClass, currentUser, HashMap, unique } from '@placeos/common';\nimport { Space } from '@placeos/spaces';\nimport { CalendarEvent, queryEvents } from '@placeos/events';\nimport { searchStaff, User } from '@placeos/users';\nimport { BuildingLevel, OrganisationService } from '@placeos/organisation';\nimport { CalendarService } from '@placeos/calendar';\nimport { ScheduleStateService } from '../new-schedule/schedule-state.service';\n\nexport interface LandingOptions {\n    search?: string;\n}\n\n@Injectable({\n    providedIn: 'root',\n})\nexport class LandingStateService extends BaseClass {\n    private _options = new BehaviorSubject<LandingOptions>({});\n    /**  */\n    private _free_spaces = new BehaviorSubject<Space[]>([]);\n    /**  */\n    private _contacts = new BehaviorSubject<User[]>([]);\n    /**  */\n    private _level_occupancy = new BehaviorSubject<BuildingLevel[]>([]);\n    /**  */\n    private _occupancy_binding: PlaceVariableBinding;\n    /**  */\n    public free_spaces = this._free_spaces.asObservable();\n    /**  */\n    public readonly upcoming_events = this._schedule.filtered_bookings.pipe(map(_ => _.filter(i => i instanceof CalendarEvent)));\n    /**  */\n    public contacts = this._contacts.asObservable();\n    /**  */\n    public options = this._options.asObservable();\n\n    public readonly search_results = this._options.pipe(\n        debounceTime(500),\n        switchMap(({ search }) => (search ? searchStaff(search) : of([]))),\n        catchError((_) => []),\n        shareReplay(1)\n    );\n    /**  */\n    public level_occupancy = this._level_occupancy.asObservable();\n\n    constructor(\n        private _calendar: CalendarService,\n        private _schedule: ScheduleStateService,\n        private _org: OrganisationService\n    ) {\n        super();\n        this.init();\n    }\n\n    public async init() {\n        await this._org.initialised.pipe(first((_) => _)).toPromise();\n        this.subscription(\n            'building',\n            this._org.active_building\n                .pipe(filter((bld) => !!bld))\n                .subscribe(() => this.updateBuildingMetadata())\n        );\n        let sys_id = this._org.binding('area_management');\n        if (!sys_id) return;\n        const binding = getModule(sys_id, 'AreaManagement').binding('overview');\n        binding.listen().subscribe((d) => this.updateOccupancy(d || {}));\n        binding.bind();\n    }\n\n    public setOptions(options: Partial<LandingOptions>) {\n        this._options.next({ ...this._options.getValue(), ...options });\n    }\n\n    public pollFreeSpaces(delay: number = 10 * 1000) {\n        this.updateFreeSpaces();\n        this.interval('free_spaces', () => this.updateFreeSpaces(), delay);\n    }\n\n    public stopPollingFreeSpaces() {\n        this.clearInterval('free_spaces');\n    }\n\n    public pollUpcomingEvents(delay: number = 10 * 1000) {\n        this._schedule.setDate(Date.now());\n        return this._schedule.startPolling(delay);\n    }\n\n    public stopPollingUpcomingEvents() {\n        this._schedule.stopPolling();\n    }\n\n    public async updateContacts() {\n        const metadata: PlaceMetadata = (await showMetadata(\n            currentUser().id,\n            'contacts'\n        ).toPromise()) as any;\n        const list = metadata.details instanceof Array ? metadata.details : [];\n        this._contacts.next(list.map((i) => new User(i)));\n    }\n\n    public async addContact(user: User) {\n        let users = [...this._contacts.getValue()];\n        users.push(user);\n        users = unique(users, 'email');\n        const metadata = await updateMetadata(currentUser().id, {\n            name: 'contacts',\n            description: 'Contacts for the User',\n            details: users,\n        }).toPromise();\n        const list = metadata.details instanceof Array ? metadata.details : [];\n        this._contacts.next(list.map((i) => new User(i)));\n    }\n\n    public async removeContact(user: User) {\n        let users = [...this._contacts.getValue()];\n        users = users.filter((u) => u.email !== user.email);\n        const metadata = await updateMetadata(currentUser().id, {\n            name: 'contacts',\n            description: 'Contacts for the User',\n            details: users,\n        }).toPromise();\n        const list = metadata.details instanceof Array ? metadata.details : [];\n        this._contacts.next(list.map((i) => new User(i)));\n    }\n\n    private async updateOccupancy(map: HashMap<{ recommendation: number }>) {\n        const levels = [...this._org.levels];\n        levels.sort(\n            (a, b) => map[a.id]?.recommendation - map[b.id]?.recommendation\n        );\n        this._level_occupancy.next(levels);\n    }\n\n    private async updateFreeSpaces() {\n        if (!this._org.building) return;\n        const period_start = Math.floor(new Date().valueOf() / 1000);\n        const period_end = Math.floor(endOfDay(new Date()).valueOf() / 1000);\n        const list = await this._calendar\n            .freeBusy({\n                period_start,\n                period_end,\n                zone_ids: this._org.building.id,\n            })\n            .pipe(\n                map((_) =>\n                    _.filter(\n                        (space) =>\n                            !space.availability.length ||\n                            space.availability.find((_) => _.status !== 'busy')\n                    )\n                )\n            )\n            .toPromise();\n        list.sort((a, b) => a.capacity - b.capacity);\n        this._free_spaces.next(list);\n    }\n\n    private async updateBuildingMetadata() {\n        const building = this._org.building;\n        const metadata = await showMetadata(\n            building.id,\n            'bindings'\n        ).toPromise();\n        if (!(metadata.details as HashMap).occupancy) return;\n        const details = (metadata.details as HashMap).occupancy;\n        const module = getModule(details.sys, details.module, details.index);\n        if (!module) return;\n        if (this._occupancy_binding) {\n            this._occupancy_binding.unbind();\n        }\n        this._occupancy_binding = module.binding('occupancy');\n        this._occupancy_binding.bind();\n        this.subscription(\n            'occupancy_binding',\n            this._occupancy_binding.listen().subscribe((value) => {\n                const levels = Object.keys(value).map((key) => ({\n                    id: key,\n                    ...value[key],\n                }));\n                levels.sort(\n                    (a, b) => a.recommendation_factor - b.recommendation_factor\n                );\n                this._level_occupancy.next(\n                    levels.map((i) => this._org.levelWithID([i.id]))\n                );\n            })\n        );\n    }\n}\n","import { Component } from '@angular/core';\nimport { LandingStateService } from './landing-state.service';\n\n@Component({\n    selector: 'landing-availability',\n    template: `\n        <div class=\"py-2\">\n            <div class=\"sm:text-lg font-medium mb-2 sm:mb-4 px-4\">Available Now</div>\n            <div class=\"text-sm sm:text-base px-4\">Spaces</div>\n            <div class=\"w-full overflow-auto flex items-center space-x-4 px-4 py-2\">\n                <button\n                    matRipple\n                    *ngFor=\"let lvl of levels_free | async\"\n                    class=\"flex items-center h-24 min-w-[12.5rem] rounded-lg bg-white dark:bg-neutral-800 shadow p-4 space-x-2\"\n                    [routerLink]=\"['/explore']\"\n                    [queryParams]=\"{ level: lvl.id }\"\n                >\n                    <div\n                        class=\"min-w-[4.5rem] h-[4.5rem] rounded bg-gray-200 dark:bg-neutral-700\"\n                    ></div>\n                    <div class=\"text-left\">\n                        <div class=\"max-w-full truncate px-1.5\">\n                        {{ lvl.display_name || lvl.name }}\n                        </div>\n                        <div class=\"max-w-full truncate text-sm opacity-60 flex items-center\">\n                            <app-icon class=\"text-blue-500 text-lg\">place</app-icon>\n                            <span>Unknown Building</span>\n                        </div>\n                    </div>\n                </button>\n                <span\n                    *ngIf=\"!(levels_free | async).length\"\n                    class=\"text-dark-fade text-sm mb-2\"\n                >\n                    No free spaces\n                </span>\n            </div>\n            <div class=\"text-sm sm:text-base my-2 px-4\">Rooms</div>\n            <div class=\"w-full overflow-auto flex items-center space-x-4 px-4 py-2\">\n                <button\n                    matRipple\n                    *ngFor=\"let space of space_list | async\"\n                    class=\"flex items-center h-24 min-w-[12.5rem] rounded-lg bg-white dark:bg-neutral-800 shadow p-4 space-x-2\"\n                    [routerLink]=\"['/explore']\"\n                    [queryParams]=\"{ space: space.email }\"\n                >\n                    <div\n                        class=\"min-w-[4.5rem] h-[4.5rem] rounded bg-gray-200 dark:bg-neutral-700\"\n                    ></div>\n                    <div class=\"text-left\">\n                        <div class=\"max-w-full truncate px-1.5\">\n                            {{ space.display_name || space.name }}\n                        </div>\n                        <div class=\"max-w-full truncate text-sm opacity-60 flex items-center\">\n                            <app-icon class=\"text-blue-500 text-lg\">place</app-icon>\n                            <span>{{ space.level.display_name || space.level.name }}</span>\n                        </div>\n                    </div>\n                </button>\n                <span\n                    *ngIf=\"!(space_list | async).length\"\n                    class=\"text-dark-fade text-sm mb-2\"\n                >\n                    No free rooms\n                </span>\n            </div>\n        </div>\n    `,\n    styles: [`\n        * {\n            flex-shrink: 0;\n        }\n    `],\n})\nexport class LandingAvailabilityComponent {\n    public readonly space_list = this._state.free_spaces;\n    public readonly levels_free = this._state.level_occupancy;\n\n    constructor(private _state: LandingStateService) {}\n\n    public async ngOnInit() {\n        this._state.pollFreeSpaces();\n    }\n\n    public ngOnDestroy() {\n        this._state.stopPollingFreeSpaces();\n    }\n}\n","import { Component } from '@angular/core';\nimport { LandingStateService } from './landing-state.service';\n\n@Component({\n    selector: 'landing-colleagues',\n    template: `\n        <div\n            class=\"flex flex-col w-[18rem] h-full overflow-hidden bg-white dark:bg-neutral-700 border-r border-gray-200 dark:border-neutral-500\"\n        >\n            <div class=\"flex items-center justify-between px-4 py-2\">\n                <h2 class=\"font-medium\">Colleagues</h2>\n                <button mat-button class=\"inverse\">Add</button>\n            </div>\n            <div class=\"flex-1 h-1/2 w-full space-y-4 overflow-auto pt-4\">\n                <ng-container *ngIf=\"(contacts | async)?.length; else empty_state\">\n                <div\n                    class=\"flex items-center px-4 space-x-4\"\n                    *ngFor=\"let user of contacts | async\"\n                >\n                    <div class=\"text-xl relative\">\n                        <a-user-avatar [user]=\"user\"></a-user-avatar>\n                        <div\n                            class=\"rounded-full h-3 w-3 border border-white dark:border-neutral-400 absolute bottom-1 right-1\"\n                            [class.bg-error]=\"!user.location\"\n                            [class.bg-success]=\"user.location\"\n                        ></div>\n                    </div>\n                    <div class=\"leading-tight\">\n                        <div class=\"truncate\">{{ user.name }}</div>\n                        <div class=\"text-sm truncate\">\n                            {{ user.organisation }}\n                        </div>\n                        <div class=\"text-xs opacity-60 truncate\">\n                            {{ user.location }}\n                        </div>\n                    </div>\n                </div>\n</ng-container>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div class=\"w-full h-full flex flex-col items-center justify-center space-y-2 p-8\">\n                <img src=\"assets/icons/no-contacts.svg\" />\n                <p class=\"opacity-60 text-sm text-center\">You have no colleagues added. Please select the \"Add\" button to get started.</p>\n            </div>\n        </ng-template>\n    `,\n})\nexport class LandingColleaguesComponent {\n    public readonly contacts = this._state.contacts;\n\n    public readonly search_results = this._state.search_results;\n\n    public readonly addUser = (u) => this._state.addContact(u);\n\n    public readonly removeUser = (u) => this._state.removeContact(u);\n\n    public readonly updateSearch = (s) => this._state.setOptions({ search: s });\n\n    constructor(private _state: LandingStateService) {}\n}\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Router } from '@angular/router';\nimport { Booking, removeBooking } from '@placeos/bookings';\nimport { notifyError, notifySuccess, openConfirmModal } from '@placeos/common';\nimport { CalendarEvent, EventFormService, removeEvent } from '@placeos/events';\nimport { format } from 'date-fns';\nimport { LandingStateService } from './landing-state.service';\n\n@Component({\n    selector: 'landing-upcoming',\n    template: `\n        <div class=\"py-2\">\n            <div class=\"flex items-center justify-between mb-2 sm:mb-4 px-4\">\n                <div class=\"sm:text-lg font-medium\">Your Bookings</div>\n                <a\n                    button\n                    mat-button\n                    class=\"inverse hidden sm:block\"\n                    [routerLink]=\"['/your-bookings']\"\n                >\n                    View All\n                </a>\n                <a\n                    class=\"inverse block sm:hidden text-blue-500 underline relative top-8\"\n                    [routerLink]=\"['/your-bookings']\"\n                >\n                    View All\n                </a>\n            </div>\n            <div class=\"space-y-4 px-4\">\n                <ng-container\n                    *ngIf=\"(upcoming_events | async)?.length; else empty_state\"\n                >\n                    <ng-container\n                        *ngFor=\"\n                            let event of upcoming_events | async | slice: 0:3;\n                            trackBy: trackByFn\n                        \"\n                    >\n                        <ng-container [ngSwitch]=\"type(event)\">\n                            <event-card\n                                *ngSwitchCase=\"'event'\"\n                                [event]=\"event\"\n                                [show_day]=\"true\"\n                                (edit)=\"edit(event)\"\n                                (remove)=\"remove(event)\"\n                            ></event-card>\n                            <booking-card\n                                *ngSwitchCase=\"'booking'\"\n                                [booking]=\"event\"\n                                [show_day]=\"true\"\n                                (remove)=\"remove(event)\"\n                            ></booking-card>\n                        </ng-container>\n                    </ng-container>\n                </ng-container>\n            </div>\n        </div>\n        <ng-template #empty_state>\n            <div\n                class=\"w-full p-8 flex flex-col items-center justify-center space-y-4\"\n            >\n                <img src=\"assets/img/no-events.svg\" class=\"mr-4\" />\n                <p class=\"opacity-30\">You have no upcoming bookings</p>\n            </div>\n        </ng-template>\n    `,\n    styles: [``],\n})\nexport class LandingUpcomingComponent implements OnInit, OnDestroy {\n    public readonly upcoming_events = this._state.upcoming_events;\n\n    public type(event: CalendarEvent | Booking) {\n        return event instanceof Booking ? 'booking' : 'event';\n    }\n\n    constructor(\n        private _state: LandingStateService,\n        private _event_form: EventFormService,\n        private _router: Router,\n        private _dialog: MatDialog\n    ) {}\n\n    public ngOnInit() {\n        this._state.pollUpcomingEvents();\n    }\n\n    public ngOnDestroy() {\n        this._state.stopPollingUpcomingEvents();\n    }\n\n    public trackByFn(_: number, item: any) {\n        return item?.id;\n    }\n\n    public edit(event: CalendarEvent) {\n        this._router.navigate(['/book', 'meeting', 'form']);\n        this._event_form.newForm(event);\n    }\n\n    public async remove(item: CalendarEvent | Booking) {\n        const time = `${format(item.date, 'dd MMM yyyy h:mma')}`;\n        const resource_name =\n            item instanceof CalendarEvent\n                ? item.space?.display_name\n                : item.asset_name || item.asset_id;\n        const content = `Delete the booking for ${resource_name} at ${time}`;\n        const resp = await openConfirmModal(\n            { title: `Delete booking`, content, icon: { content: 'delete' } },\n            this._dialog\n        );\n        console\n        if (resp.reason !== 'done') return;\n        resp.loading('Requesting booking deletion...');\n        await (item instanceof CalendarEvent ? removeEvent : removeBooking)(\n            item.id\n        ).toPromise().catch(e => {\n            notifyError(`Unable to delete booking. ${e}`);\n            resp.close();\n            throw e;\n        });\n        notifySuccess('Successfully deleted booking.');\n        resp.close();\n    }\n}\n","import { CommonModule } from \"@angular/common\";\nimport { NgModule } from \"@angular/core\";\nimport { RouterModule } from \"@angular/router\";\nimport { SharedComponentModule } from \"../components/shared.module\";\nimport { LandingAvailabilityComponent } from \"./landing-availability.component\";\nimport { LandingColleaguesComponent } from \"./landing-colleagues.component\";\nimport { LandingUpcomingComponent } from \"./landing-upcoming.component\";\nimport { LandingComponent } from \"./landing.component\";\n\nconst COMPONENTS = [\n    LandingComponent,\n    LandingColleaguesComponent,\n    LandingAvailabilityComponent,\n    LandingUpcomingComponent\n]\n\nconst ROUTES = [\n    { path: '', component: LandingComponent }\n]\n\n@NgModule({\n    declarations: [...COMPONENTS],\n    imports: [\n        CommonModule,\n        SharedComponentModule,\n        RouterModule.forChild(ROUTES)\n    ]\n})\nexport class AppLandingModule {}\n","import { Component } from '@angular/core';\nimport { currentUser } from '@placeos/common';\nimport { startOfMinute } from 'date-fns';\n\n@Component({\n    selector: 'app-dashboard',\n    template: `\n        <topbar></topbar>\n        <div class=\"flex flex-1 h-1/2 bg-[#E5E5E5] dark:bg-zinc-700\">\n            <landing-colleagues\n                class=\"h-full hidden sm:block\"\n            ></landing-colleagues>\n            <div class=\"flex-1 h-full w-1/2 sm:px-4 overflow-auto\">\n                <header class=\"sticky top-0 z-50 bg-[#ECF0F3] dark:bg-neutral-800 px-4 rounded-b flex items-center justify-between overflow-hidden\">\n                    <div class=\"\">\n                        <div class=\"sm:text-xl font-medium\">Hello {{ user?.name }},</div>\n                        <div date class=\"text-sm sm:text-base\">{{ date | date:'fullDate' }}</div>\n                        <div class=\"text-sm sm:text-base\">Sydney Australia</div>\n                    </div>\n                    <div class=\"h-32 pt-4\">\n                        <img src=\"assets/img/landing.svg\" />\n                    </div>\n                </header>\n                <landing-availability></landing-availability>\n                <div class=\"mx-4 w-[calc(100%-2rem)] h-px bg-gray-300 mb-2\" ></div>\n                <landing-upcoming></landing-upcoming>\n            </div>\n        </div>\n        <footer-menu></footer-menu>\n    `,\n    styles: [\n        `\n            :host {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 0;\n                overflow: hidden;\n                display: flex;\n                flex-direction: column;\n            }\n\n            main {\n                min-height: 50%;\n            }\n        `,\n    ],\n})\nexport class LandingComponent {\n    public time: number;\n\n    public get date() {\n        return startOfMinute(this.time || Date.now());\n    }\n\n    public get user() {\n        return currentUser();\n    }\n}\n"]}